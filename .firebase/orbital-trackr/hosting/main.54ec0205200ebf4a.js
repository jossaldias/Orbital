(self.webpackChunkOrbital=self.webpackChunkOrbital||[]).push([[179],{575:(Ey,vh,gu)=>{"use strict";function sr(r){return"function"==typeof r}function wf(r){const s=r(c=>{Error.call(c),c.stack=(new Error).stack});return s.prototype=Object.create(Error.prototype),s.prototype.constructor=s,s}const My=wf(r=>function(s){r(this),this.message=s?`${s.length} errors occurred during unsubscription:\n${s.map((c,h)=>`${h+1}) ${c.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=s});function Xe(r,o){if(r){const s=r.indexOf(o);0<=s&&r.splice(s,1)}}class ie{constructor(o){this.initialTeardown=o,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let o;if(!this.closed){this.closed=!0;const{_parentage:s}=this;if(s)if(this._parentage=null,Array.isArray(s))for(const m of s)m.remove(this);else s.remove(this);const{initialTeardown:c}=this;if(sr(c))try{c()}catch(m){o=m instanceof My?m.errors:[m]}const{_finalizers:h}=this;if(h){this._finalizers=null;for(const m of h)try{kt(m)}catch(y){o=o??[],y instanceof My?o=[...o,...y.errors]:o.push(y)}}if(o)throw new My(o)}}add(o){var s;if(o&&o!==this)if(this.closed)kt(o);else{if(o instanceof ie){if(o.closed||o._hasParent(this))return;o._addParent(this)}(this._finalizers=null!==(s=this._finalizers)&&void 0!==s?s:[]).push(o)}}_hasParent(o){const{_parentage:s}=this;return s===o||Array.isArray(s)&&s.includes(o)}_addParent(o){const{_parentage:s}=this;this._parentage=Array.isArray(s)?(s.push(o),s):s?[s,o]:o}_removeParent(o){const{_parentage:s}=this;s===o?this._parentage=null:Array.isArray(s)&&Xe(s,o)}remove(o){const{_finalizers:s}=this;s&&Xe(s,o),o instanceof ie&&o._removeParent(this)}}ie.EMPTY=(()=>{const r=new ie;return r.closed=!0,r})();const la=ie.EMPTY;function Ha(r){return r instanceof ie||r&&"closed"in r&&sr(r.remove)&&sr(r.add)&&sr(r.unsubscribe)}function kt(r){sr(r)?r():r.unsubscribe()}const ws={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ca={setTimeout(r,o,...s){const{delegate:c}=ca;return c?.setTimeout?c.setTimeout(r,o,...s):setTimeout(r,o,...s)},clearTimeout(r){const{delegate:o}=ca;return(o?.clearTimeout||clearTimeout)(r)},delegate:void 0};function kl(r){ca.setTimeout(()=>{const{onUnhandledError:o}=ws;if(!o)throw r;o(r)})}function _u(){}const bc=Zo("C",void 0,void 0);function Zo(r,o,s){return{kind:r,value:o,error:s}}let Ga=null;function qa(r){if(ws.useDeprecatedSynchronousErrorHandling){const o=!Ga;if(o&&(Ga={errorThrown:!1,error:null}),r(),o){const{errorThrown:s,error:c}=Ga;if(Ga=null,s)throw c}}else r()}class wc extends ie{constructor(o){super(),this.isStopped=!1,o?(this.destination=o,Ha(o)&&o.add(this)):this.destination=Ty}static create(o,s,c){return new yu(o,s,c)}next(o){this.isStopped?ei(function Ef(r){return Zo("N",r,void 0)}(o),this):this._next(o)}error(o){this.isStopped?ei(function Zm(r){return Zo("E",void 0,r)}(o),this):(this.isStopped=!0,this._error(o))}complete(){this.isStopped?ei(bc,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(o){this.destination.next(o)}_error(o){try{this.destination.error(o)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Za=Function.prototype.bind;function ee(r,o){return Za.call(r,o)}class en{constructor(o){this.partialObserver=o}next(o){const{partialObserver:s}=this;if(s.next)try{s.next(o)}catch(c){Wa(c)}}error(o){const{partialObserver:s}=this;if(s.error)try{s.error(o)}catch(c){Wa(c)}else Wa(o)}complete(){const{partialObserver:o}=this;if(o.complete)try{o.complete()}catch(s){Wa(s)}}}class yu extends wc{constructor(o,s,c){let h;if(super(),sr(o)||!o)h={next:o??void 0,error:s??void 0,complete:c??void 0};else{let m;this&&ws.useDeprecatedNextContext?(m=Object.create(o),m.unsubscribe=()=>this.unsubscribe(),h={next:o.next&&ee(o.next,m),error:o.error&&ee(o.error,m),complete:o.complete&&ee(o.complete,m)}):h=o}this.destination=new en(h)}}function Wa(r){ws.useDeprecatedSynchronousErrorHandling?function Wm(r){ws.useDeprecatedSynchronousErrorHandling&&Ga&&(Ga.errorThrown=!0,Ga.error=r)}(r):kl(r)}function ei(r,o){const{onStoppedNotification:s}=ws;s&&ca.setTimeout(()=>s(r,o))}const Ty={closed:!0,next:_u,error:function Et(r){throw r},complete:_u},Ec="function"==typeof Symbol&&Symbol.observable||"@@observable";function Xa(r){return r}function Mc(r){return 0===r.length?Xa:1===r.length?r[0]:function(s){return r.reduce((c,h)=>h(c),s)}}let Un=(()=>{class r{constructor(s){s&&(this._subscribe=s)}lift(s){const c=new r;return c.source=this,c.operator=s,c}subscribe(s,c,h){const m=function Ja(r){return r&&r instanceof wc||function Ya(r){return r&&sr(r.next)&&sr(r.error)&&sr(r.complete)}(r)&&Ha(r)}(s)?s:new yu(s,c,h);return qa(()=>{const{operator:y,source:w}=this;m.add(y?y.call(m,w):w?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(s){try{return this._subscribe(s)}catch(c){s.error(c)}}forEach(s,c){return new(c=We(c))((h,m)=>{const y=new yu({next:w=>{try{s(w)}catch(M){m(M),y.unsubscribe()}},error:m,complete:h});this.subscribe(y)})}_subscribe(s){var c;return null===(c=this.source)||void 0===c?void 0:c.subscribe(s)}[Ec](){return this}pipe(...s){return Mc(s)(this)}toPromise(s){return new(s=We(s))((c,h)=>{let m;this.subscribe(y=>m=y,y=>h(y),()=>c(m))})}}return r.create=o=>new r(o),r})();function We(r){var o;return null!==(o=r??ws.Promise)&&void 0!==o?o:Promise}const vu=wf(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Mi=(()=>{class r extends Un{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(s){const c=new qe(this,this);return c.operator=s,c}_throwIfClosed(){if(this.closed)throw new vu}next(s){qa(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const c of this.currentObservers)c.next(s)}})}error(s){qa(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=s;const{observers:c}=this;for(;c.length;)c.shift().error(s)}})}complete(){qa(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:s}=this;for(;s.length;)s.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var s;return(null===(s=this.observers)||void 0===s?void 0:s.length)>0}_trySubscribe(s){return this._throwIfClosed(),super._trySubscribe(s)}_subscribe(s){return this._throwIfClosed(),this._checkFinalizedStatuses(s),this._innerSubscribe(s)}_innerSubscribe(s){const{hasError:c,isStopped:h,observers:m}=this;return c||h?la:(this.currentObservers=null,m.push(s),new ie(()=>{this.currentObservers=null,Xe(m,s)}))}_checkFinalizedStatuses(s){const{hasError:c,thrownError:h,isStopped:m}=this;c?s.error(h):m&&s.complete()}asObservable(){const s=new Un;return s.source=this,s}}return r.create=(o,s)=>new qe(o,s),r})();class qe extends Mi{constructor(o,s){super(),this.destination=o,this.source=s}next(o){var s,c;null===(c=null===(s=this.destination)||void 0===s?void 0:s.next)||void 0===c||c.call(s,o)}error(o){var s,c;null===(c=null===(s=this.destination)||void 0===s?void 0:s.error)||void 0===c||c.call(s,o)}complete(){var o,s;null===(s=null===(o=this.destination)||void 0===o?void 0:o.complete)||void 0===s||s.call(o)}_subscribe(o){var s,c;return null!==(c=null===(s=this.source)||void 0===s?void 0:s.subscribe(o))&&void 0!==c?c:la}}function Ro(r){return sr(r?.lift)}function ci(r){return o=>{if(Ro(o))return o.lift(function(s){try{return r(s,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ar(r,o,s,c,h){return new Xm(r,o,s,c,h)}class Xm extends wc{constructor(o,s,c,h,m,y){super(o),this.onFinalize=m,this.shouldUnsubscribe=y,this._next=s?function(w){try{s(w)}catch(M){o.error(M)}}:super._next,this._error=h?function(w){try{h(w)}catch(M){o.error(M)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(w){o.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var o;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:s}=this;super.unsubscribe(),!s&&(null===(o=this.onFinalize)||void 0===o||o.call(this))}}}function On(r,o){return ci((s,c)=>{let h=0;s.subscribe(Ar(c,m=>{c.next(r.call(o,m,h++))}))})}function Fn(r){return this instanceof Fn?(this.v=r,this):new Fn(r)}function _o(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,o=r[Symbol.asyncIterator];return o?o.call(r):(r=function gt(r){var o="function"==typeof Symbol&&Symbol.iterator,s=o&&r[o],c=0;if(s)return s.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&c>=r.length&&(r=void 0),{value:r&&r[c++],done:!r}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s);function c(m){s[m]=r[m]&&function(y){return new Promise(function(w,M){!function h(m,y,w,M){Promise.resolve(M).then(function(S){m({value:S,done:w})},y)}(w,M,(y=r[m](y)).done,y.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Ae=r=>r&&"number"==typeof r.length&&"function"!=typeof r;function ke(r){return sr(r?.then)}function Be(r){return sr(r[Ec])}function Re(r){return Symbol.asyncIterator&&sr(r?.[Symbol.asyncIterator])}function Ze(r){return new TypeError(`You provided ${null!==r&&"object"==typeof r?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ct=function Le(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function mn(r){return sr(r?.[Ct])}function rt(r){return function Nn(r,o,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h,c=s.apply(r,o||[]),m=[];return h={},y("next"),y("throw"),y("return"),h[Symbol.asyncIterator]=function(){return this},h;function y($){c[$]&&(h[$]=function(Y){return new Promise(function(se,he){m.push([$,Y,se,he])>1||w($,Y)})})}function w($,Y){try{!function M($){$.value instanceof Fn?Promise.resolve($.value.v).then(S,O):F(m[0][2],$)}(c[$](Y))}catch(se){F(m[0][3],se)}}function S($){w("next",$)}function O($){w("throw",$)}function F($,Y){$(Y),m.shift(),m.length&&w(m[0][0],m[0][1])}}(this,arguments,function*(){const s=r.getReader();try{for(;;){const{value:c,done:h}=yield Fn(s.read());if(h)return yield Fn(void 0);yield yield Fn(c)}}finally{s.releaseLock()}})}function dn(r){return sr(r?.getReader)}function fn(r){if(r instanceof Un)return r;if(null!=r){if(Be(r))return function Cr(r){return new Un(o=>{const s=r[Ec]();if(sr(s.subscribe))return s.subscribe(o);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(r);if(Ae(r))return function Gr(r){return new Un(o=>{for(let s=0;s<r.length&&!o.closed;s++)o.next(r[s]);o.complete()})}(r);if(ke(r))return function to(r){return new Un(o=>{r.then(s=>{o.closed||(o.next(s),o.complete())},s=>o.error(s)).then(null,kl)})}(r);if(Re(r))return ti(r);if(mn(r))return function Hs(r){return new Un(o=>{for(const s of r)if(o.next(s),o.closed)return;o.complete()})}(r);if(dn(r))return function ko(r){return ti(rt(r))}(r)}throw Ze(r)}function ti(r){return new Un(o=>{(function no(r,o){var s,c,h,m;return function Ye(r,o,s,c){return new(s||(s=Promise))(function(m,y){function w(O){try{S(c.next(O))}catch(F){y(F)}}function M(O){try{S(c.throw(O))}catch(F){y(F)}}function S(O){O.done?m(O.value):function h(m){return m instanceof s?m:new s(function(y){y(m)})}(O.value).then(w,M)}S((c=c.apply(r,o||[])).next())})}(this,void 0,void 0,function*(){try{for(s=_o(r);!(c=yield s.next()).done;)if(o.next(c.value),o.closed)return}catch(y){h={error:y}}finally{try{c&&!c.done&&(m=s.return)&&(yield m.call(s))}finally{if(h)throw h.error}}o.complete()})})(r,o).catch(s=>o.error(s))})}function Xo(r,o,s,c=0,h=!1){const m=o.schedule(function(){s(),h?r.add(this.schedule(null,c)):this.unsubscribe()},c);if(r.add(m),!h)return m}function ni(r,o,s=1/0){return sr(o)?ni((c,h)=>On((m,y)=>o(c,m,h,y))(fn(r(c,h))),s):("number"==typeof o&&(s=o),ci((c,h)=>function Dc(r,o,s,c,h,m,y,w){const M=[];let S=0,O=0,F=!1;const $=()=>{F&&!M.length&&!S&&o.complete()},Y=he=>S<c?se(he):M.push(he),se=he=>{m&&o.next(he),S++;let _e=!1;fn(s(he,O++)).subscribe(Ar(o,be=>{h?.(be),m?Y(be):o.next(be)},()=>{_e=!0},void 0,()=>{if(_e)try{for(S--;M.length&&S<c;){const be=M.shift();y?Xo(o,y,()=>se(be)):se(be)}$()}catch(be){o.error(be)}}))};return r.subscribe(Ar(o,Y,()=>{F=!0,$()})),()=>{w?.()}}(c,h,r,s)))}function Sc(r=1/0){return ni(Xa,r)}const ha=new Un(r=>r.complete());function Ym(r){return r[r.length-1]}function aw(r){return sr(Ym(r))?r.pop():void 0}function Ic(r){return function oD(r){return r&&sr(r.schedule)}(Ym(r))?r.pop():void 0}function Mf(r,o=0){return ci((s,c)=>{s.subscribe(Ar(c,h=>Xo(c,r,()=>c.next(h),o),()=>Xo(c,r,()=>c.complete(),o),h=>Xo(c,r,()=>c.error(h),o)))})}function Cy(r,o=0){return ci((s,c)=>{c.add(r.schedule(()=>s.subscribe(c),o))})}function Jm(r,o){if(!r)throw new Error("Iterable cannot be null");return new Un(s=>{Xo(s,o,()=>{const c=r[Symbol.asyncIterator]();Xo(s,o,()=>{c.next().then(h=>{h.done?s.complete():s.next(h.value)})},0,!0)})})}function hi(r,o){return o?function Km(r,o){if(null!=r){if(Be(r))return function sD(r,o){return fn(r).pipe(Cy(o),Mf(o))}(r,o);if(Ae(r))return function cw(r,o){return new Un(s=>{let c=0;return o.schedule(function(){c===r.length?s.complete():(s.next(r[c++]),s.closed||this.schedule())})})}(r,o);if(ke(r))return function aD(r,o){return fn(r).pipe(Cy(o),Mf(o))}(r,o);if(Re(r))return Jm(r,o);if(mn(r))return function uw(r,o){return new Un(s=>{let c;return Xo(s,o,()=>{c=r[Ct](),Xo(s,o,()=>{let h,m;try{({value:h,done:m}=c.next())}catch(y){return void s.error(y)}m?s.complete():s.next(h)},0,!0)}),()=>sr(c?.return)&&c.return()})}(r,o);if(dn(r))return function Dy(r,o){return Jm(rt(r),o)}(r,o)}throw Ze(r)}(r,o):fn(r)}class Ui extends Mi{constructor(o){super(),this._value=o}get value(){return this.getValue()}_subscribe(o){const s=super._subscribe(o);return!s.closed&&o.next(this._value),s}getValue(){const{hasError:o,thrownError:s,_value:c}=this;if(o)throw s;return this._throwIfClosed(),c}next(o){super.next(this._value=o)}}function Fe(...r){return hi(r,Ic(r))}function Cn(r={}){const{connector:o=(()=>new Mi),resetOnError:s=!0,resetOnComplete:c=!0,resetOnRefCountZero:h=!0}=r;return m=>{let y,w,M,S=0,O=!1,F=!1;const $=()=>{w?.unsubscribe(),w=void 0},Y=()=>{$(),y=M=void 0,O=F=!1},se=()=>{const he=y;Y(),he?.unsubscribe()};return ci((he,_e)=>{S++,!F&&!O&&$();const be=M=M??o();_e.add(()=>{S--,0===S&&!F&&!O&&(w=da(se,h))}),be.subscribe(_e),!y&&S>0&&(y=new yu({next:me=>be.next(me),error:me=>{F=!0,$(),w=da(Y,s,me),be.error(me)},complete:()=>{O=!0,$(),w=da(Y,c),be.complete()}}),fn(he).subscribe(y))})(m)}}function da(r,o,...s){if(!0===o)return void r();if(!1===o)return;const c=new yu({next:()=>{c.unsubscribe(),r()}});return fn(o(...s)).subscribe(c)}function ro(r,o){return ci((s,c)=>{let h=null,m=0,y=!1;const w=()=>y&&!h&&c.complete();s.subscribe(Ar(c,M=>{h?.unsubscribe();let S=0;const O=m++;fn(r(M,O)).subscribe(h=Ar(c,F=>c.next(o?o(M,F,O,S++):F),()=>{h=null,w()}))},()=>{y=!0,w()}))})}function hw(r,o){return r===o}function er(r){for(let o in r)if(r[o]===er)return o;throw Error("Could not find renamed property on target object.")}function Cf(r,o){for(const s in o)o.hasOwnProperty(s)&&!r.hasOwnProperty(s)&&(r[s]=o[s])}function di(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(di).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const s=o.indexOf("\n");return-1===s?o:o.substring(0,s)}function Df(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const Sf=er({__forward_ref__:er});function ar(r){return r.__forward_ref__=ar,r.toString=function(){return di(this())},r}function qt(r){return eg(r)?r():r}function eg(r){return"function"==typeof r&&r.hasOwnProperty(Sf)&&r.__forward_ref__===ar}function tg(r){return r&&!!r.\u0275providers}class pe extends Error{constructor(o,s){super(function wr(r,o){return`NG0${Math.abs(r)}${o?": "+o:""}`}(o,s)),this.code=o}}function J(r){return"string"==typeof r?r:null==r?"":String(r)}function fa(r,o){throw new pe(-201,!1)}function yo(r,o){null==r&&function bt(r,o,s,c){throw new Error(`ASSERTION ERROR: ${r}`+(null==c?"":` [Expected=> ${s} ${c} ${o} <=Actual]`))}(o,r,null,"!=")}function It(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Yo(r){return{providers:r.providers||[],imports:r.imports||[]}}function If(r){return ag(r,io)||ag(r,cg)}function ag(r,o){return r.hasOwnProperty(o)?r[o]:null}function Ch(r){return r&&(r.hasOwnProperty(At)||r.hasOwnProperty(Iy))?r[At]:null}const io=er({\u0275prov:er}),At=er({\u0275inj:er}),cg=er({ngInjectableDef:er}),Iy=er({ngInjectorDef:er});var Ht=function(r){return r[r.Default=0]="Default",r[r.Host=1]="Host",r[r.Self=2]="Self",r[r.SkipSelf=4]="SkipSelf",r[r.Optional=8]="Optional",r}(Ht||{});let Jo;function Ti(r){const o=Jo;return Jo=r,o}function ri(r,o,s){const c=If(r);return c&&"root"==c.providedIn?void 0===c.value?c.value=c.factory():c.value:s&Ht.Optional?null:void 0!==o?o:void fa(di(r))}const xr=globalThis;class at{constructor(o,s){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=It({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Ko={},Ih="__NG_DI_FLAG__",Rf="ngTempTokenPath",uD=/\n/gm,Ah="__source";let Ph;function Nl(r){const o=Ph;return Ph=r,o}function dg(r,o=Ht.Default){if(void 0===Ph)throw new pe(-203,!1);return null===Ph?ri(r,void 0,o):Ph.get(r,o&Ht.Optional?null:void 0,o)}function yt(r,o=Ht.Default){return(function Ay(){return Jo}()||dg)(qt(r),o)}function lt(r,o=Ht.Default){return yt(r,fg(o))}function fg(r){return typeof r>"u"||"number"==typeof r?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function pg(r){const o=[];for(let s=0;s<r.length;s++){const c=qt(r[s]);if(Array.isArray(c)){if(0===c.length)throw new pe(900,!1);let h,m=Ht.Default;for(let y=0;y<c.length;y++){const w=c[y],M=Ry(w);"number"==typeof M?-1===M?h=w.token:m|=M:h=w}o.push(yt(h,m))}else o.push(yt(c))}return o}function kf(r,o){return r[Ih]=o,r.prototype[Ih]=o,r}function Ry(r){return r[Ih]}function Ka(r){return{toString:r}.toString()}var Lf=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(Lf||{}),Lo=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(Lo||{});const qs={},zn=[],Oh=er({\u0275cmp:er}),mg=er({\u0275dir:er}),Ff=er({\u0275pipe:er}),le=er({\u0275mod:er}),Qa=er({\u0275fac:er}),Eu=er({__NG_ELEMENT_ID__:er}),gg=er({__NG_ENV_ID__:er});function Oy(r,o,s){let c=r.length;for(;;){const h=r.indexOf(o,s);if(-1===h)return h;if(0===h||r.charCodeAt(h-1)<=32){const m=o.length;if(h+m===c||r.charCodeAt(h+m)<=32)return h}s=h+1}}function kh(r,o,s){let c=0;for(;c<s.length;){const h=s[c];if("number"==typeof h){if(0!==h)break;c++;const m=s[c++],y=s[c++],w=s[c++];r.setAttribute(o,y,w,m)}else{const m=h,y=s[++c];_g(m)?r.setProperty(o,m,y):r.setAttribute(o,m,y),c++}}return c}function el(r){return 3===r||4===r||6===r}function _g(r){return 64===r.charCodeAt(0)}function ga(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let s=-1;for(let c=0;c<o.length;c++){const h=o[c];"number"==typeof h?s=h:0===s||Nf(r,s,h,null,-1===s||2===s?o[++c]:null)}}return r}function Nf(r,o,s,c,h){let m=0,y=r.length;if(-1===o)y=-1;else for(;m<r.length;){const w=r[m++];if("number"==typeof w){if(w===o){y=-1;break}if(w>o){y=m-1;break}}}for(;m<r.length;){const w=r[m];if("number"==typeof w)break;if(w===s){if(null===c)return void(null!==h&&(r[m+1]=h));if(c===r[m+1])return void(r[m+2]=h)}m++,null!==c&&m++,null!==h&&m++}-1!==y&&(r.splice(y,0,o),m=y+1),r.splice(m++,0,s),null!==c&&r.splice(m++,0,c),null!==h&&r.splice(m++,0,h)}const Mu="ng-template";function ky(r,o,s){let c=0,h=!0;for(;c<r.length;){let m=r[c++];if("string"==typeof m&&h){const y=r[c++];if(s&&"class"===m&&-1!==Oy(y.toLowerCase(),o,0))return!0}else{if(1===m){for(;c<r.length&&"string"==typeof(m=r[c++]);)if(m.toLowerCase()===o)return!0;return!1}"number"==typeof m&&(h=!1)}}return!1}function _w(r){return 4===r.type&&r.value!==Mu}function yw(r,o,s){return o===(4!==r.type||s?r.value:Mu)}function xw(r,o,s){let c=4;const h=r.attrs||[],m=function fD(r){for(let o=0;o<r.length;o++)if(el(r[o]))return o;return r.length}(h);let y=!1;for(let w=0;w<o.length;w++){const M=o[w];if("number"!=typeof M){if(!y)if(4&c){if(c=2|1&c,""!==M&&!yw(r,M,s)||""===M&&1===o.length){if(Ms(c))return!1;y=!0}}else{const S=8&c?M:o[++w];if(8&c&&null!==r.attrs){if(!ky(r.attrs,S,s)){if(Ms(c))return!1;y=!0}continue}const F=hD(8&c?"class":M,h,_w(r),s);if(-1===F){if(Ms(c))return!1;y=!0;continue}if(""!==S){let $;$=F>m?"":h[F+1].toLowerCase();const Y=8&c?$:null;if(Y&&-1!==Oy(Y,S,0)||2&c&&S!==$){if(Ms(c))return!1;y=!0}}}}else{if(!y&&!Ms(c)&&!Ms(M))return!1;if(y&&Ms(M))continue;y=!1,c=M|1&c}}return Ms(c)||y}function Ms(r){return 0==(1&r)}function hD(r,o,s,c){if(null===o)return-1;let h=0;if(c||!s){let m=!1;for(;h<o.length;){const y=o[h];if(y===r)return h;if(3===y||6===y)m=!0;else{if(1===y||2===y){let w=o[++h];for(;"string"==typeof w;)w=o[++h];continue}if(4===y)break;if(0===y){h+=4;continue}}h+=m?1:2}return-1}return function bw(r,o){let s=r.indexOf(4);if(s>-1)for(s++;s<r.length;){const c=r[s];if("number"==typeof c)return-1;if(c===o)return s;s++}return-1}(o,r)}function vw(r,o,s=!1){for(let c=0;c<o.length;c++)if(xw(r,o[c],s))return!0;return!1}function zf(r,o){return r?":not("+o.trim()+")":o}function mD(r){let o=r[0],s=1,c=2,h="",m=!1;for(;s<r.length;){let y=r[s];if("string"==typeof y)if(2&c){const w=r[++s];h+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&c?h+="."+y:4&c&&(h+=" "+y);else""!==h&&!Ms(y)&&(o+=zf(m,h),h=""),c=y,m=m||!Ms(c);s++}return""!==h&&(o+=zf(m,h)),o}function Pc(r){return Ka(()=>{const o=vg(r),s={...o,decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===Lf.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&r.dependencies||null,getStandaloneInjector:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||Lo.Emulated,styles:r.styles||zn,_:null,schemas:r.schemas||null,tView:null,id:""};bg(s);const c=r.dependencies;return s.directiveDefs=ut(c,!1),s.pipeDefs=ut(c,!0),s.id=function wg(r){let o=0;const s=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,r.consts,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery].join("|");for(const h of s)o=Math.imul(31,o)+h.charCodeAt(0)<<0;return o+=2147483648,"c"+o}(s),s})}function Bf(r){return An(r)||Di(r)}function Ny(r){return null!==r}function Fo(r){return Ka(()=>({type:r.type,bootstrap:r.bootstrap||zn,declarations:r.declarations||zn,imports:r.imports||zn,exports:r.exports||zn,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function xg(r,o){if(null==r)return qs;const s={};for(const c in r)if(r.hasOwnProperty(c)){let h=r[c],m=h;Array.isArray(h)&&(m=h[1],h=h[0]),s[h]=c,o&&(o[h]=m)}return s}function jt(r){return Ka(()=>{const o=vg(r);return bg(o),o})}function An(r){return r[Oh]||null}function Di(r){return r[mg]||null}function vo(r){return r[Ff]||null}function bo(r,o){const s=r[le]||null;if(!s&&!0===o)throw new Error(`Type ${di(r)} does not have '\u0275mod' property.`);return s}function vg(r){const o={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:o,inputTransforms:null,inputConfig:r.inputs||qs,exportAs:r.exportAs||null,standalone:!0===r.standalone,signals:!0===r.signals,selectors:r.selectors||zn,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:xg(r.inputs,o),outputs:xg(r.outputs)}}function bg(r){r.features?.forEach(o=>o(r))}function ut(r,o){if(!r)return null;const s=o?vo:Bf;return()=>("function"==typeof r?r():r).map(c=>s(c)).filter(Ny)}const Wr=0,ot=1,rn=2,lr=3,Zs=4,Vf=5,wo=6,Lh=7,Xr=8,tl=9,Oc=10,Wt=11,Fh=12,zy=13,Nh=14,Pr=15,zl=16,Tu=17,Ts=18,Cu=19,_a=20,nl=21,rl=22,Du=23,zh=24,_n=25,jf=1,Mw=2,Cs=7,kc=9,Si=11;function oo(r){return Array.isArray(r)&&"object"==typeof r[jf]}function No(r){return Array.isArray(r)&&!0===r[jf]}function Mg(r){return 0!=(4&r.flags)}function Lc(r){return r.componentOffset>-1}function Bl(r){return 1==(1&r.flags)}function ya(r){return!!r.template}function By(r){return 0!=(512&r[rn])}function il(r,o){return r.hasOwnProperty(Qa)?r[Qa]:null}let so=null,Dg=!1;function Ds(r){const o=so;return so=r,o}const Aw={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function $f(r){if(!Uh(r)||r.dirty){if(!r.producerMustRecompute(r)&&!qf(r))return void(r.dirty=!1);r.producerRecomputeValue(r),r.dirty=!1}}function jl(r){r.dirty=!0,function Vl(r){if(void 0===r.liveConsumerNode)return;const o=Dg;Dg=!0;try{for(const s of r.liveConsumerNode)s.dirty||jl(s)}finally{Dg=o}}(r),r.consumerMarkedDirty?.(r)}function Gf(r){return r&&(r.nextProducerIndex=0),Ds(r)}function jh(r,o){if(Ds(o),r&&void 0!==r.producerNode&&void 0!==r.producerIndexOfThis&&void 0!==r.producerLastReadVersion){if(Uh(r))for(let s=r.nextProducerIndex;s<r.producerNode.length;s++)Zf(r.producerNode[s],r.producerIndexOfThis[s]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}function qf(r){Ws(r);for(let o=0;o<r.producerNode.length;o++){const s=r.producerNode[o],c=r.producerLastReadVersion[o];if(c!==s.version||($f(s),c!==s.version))return!0}return!1}function Ss(r){if(Ws(r),Uh(r))for(let o=0;o<r.producerNode.length;o++)Zf(r.producerNode[o],r.producerIndexOfThis[o]);r.producerNode.length=r.producerLastReadVersion.length=r.producerIndexOfThis.length=0,r.liveConsumerNode&&(r.liveConsumerNode.length=r.liveConsumerIndexOfThis.length=0)}function Zf(r,o){if(function $y(r){r.liveConsumerNode??=[],r.liveConsumerIndexOfThis??=[]}(r),Ws(r),1===r.liveConsumerNode.length)for(let c=0;c<r.producerNode.length;c++)Zf(r.producerNode[c],r.producerIndexOfThis[c]);const s=r.liveConsumerNode.length-1;if(r.liveConsumerNode[o]=r.liveConsumerNode[s],r.liveConsumerIndexOfThis[o]=r.liveConsumerIndexOfThis[s],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,o<r.liveConsumerNode.length){const c=r.liveConsumerIndexOfThis[o],h=r.liveConsumerNode[o];Ws(h),h.producerIndexOfThis[c]=o}}function Uh(r){return r.consumerIsAlwaysLive||(r?.liveConsumerNode?.length??0)>0}function Ws(r){r.producerNode??=[],r.producerIndexOfThis??=[],r.producerLastReadVersion??=[]}let kw=null;const Su=()=>{},Uw=(()=>({...Aw,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:r=>{r.schedule(r.ref)},hasRun:!1,cleanupFn:Su}))();class ID{constructor(o,s,c){this.previousValue=o,this.currentValue=s,this.firstChange=c}isFirstChange(){return this.firstChange}}function Is(){return Wy}function Wy(r){return r.type.prototype.ngOnChanges&&(r.setInput=Hw),$w}function $w(){const r=Yy(this),o=r?.current;if(o){const s=r.previous;if(s===qs)r.previous=o;else for(let c in o)s[c]=o[c];r.current=null,this.ngOnChanges(o)}}function Hw(r,o,s,c){const h=this.declaredInputs[s],m=Yy(r)||function Ii(r,o){return r[Xy]=o}(r,{previous:qs,current:null}),y=m.current||(m.current={}),w=m.previous,M=w[h];y[h]=new ID(M&&M.currentValue,o,w===qs),r[c]=o}Is.ngInherit=!0;const Xy="__ngSimpleChanges__";function Yy(r){return r[Xy]||null}const zo=function(r,o,s){};function Dr(r){for(;Array.isArray(r);)r=r[Wr];return r}function Ag(r,o){return Dr(o[r])}function Qo(r,o){return Dr(o[r.index])}function Ww(r,o){return r.data[o]}function As(r,o){const s=o[r];return oo(s)?s:s[Wr]}function Bo(r,o){return null==o?null:r[o]}function va(r){r[Tu]=0}function Gh(r){1024&r[rn]||(r[rn]|=1024,Ge(r,1))}function Yf(r){1024&r[rn]&&(r[rn]&=-1025,Ge(r,-1))}function Ge(r,o){let s=r[lr];if(null===s)return;s[Vf]+=o;let c=s;for(s=s[lr];null!==s&&(1===o&&1===c[Vf]||-1===o&&0===c[Vf]);)s[Vf]+=o,c=s,s=s[lr]}const zt={lFrame:Xn(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Rg(){return zt.bindingsEnabled}function Oe(){return zt.lFrame.lView}function Dn(){return zt.lFrame.tView}function $i(){let r=Og();for(;null!==r&&64===r.type;)r=r.parent;return r}function Og(){return zt.lFrame.currentTNode}function Xs(r,o){const s=zt.lFrame;s.currentTNode=r,s.isParent=o}function kg(){return zt.lFrame.isParent}function qh(){return zt.lFrame.bindingIndex++}function et(r,o){const s=zt.lFrame;s.bindingIndex=s.bindingRootIndex=r,nr(o)}function nr(r){zt.lFrame.currentDirectiveIndex=r}function Ng(r){zt.lFrame.currentQueryIndex=r}function Ps(r){const o=r[ot];return 2===o.type?o.declTNode:1===o.type?r[wo]:null}function Jw(r,o,s){if(s&Ht.SkipSelf){let h=o,m=r;for(;!(h=h.parent,null!==h||s&Ht.Host||(h=Ps(m),null===h||(m=m[Nh],10&h.type))););if(null===h)return!1;o=h,r=m}const c=zt.lFrame=Qf();return c.currentTNode=o,c.lView=r,!0}function sx(r){const o=Qf(),s=r[ot];zt.lFrame=o,o.currentTNode=s.firstChild,o.lView=r,o.tView=s,o.contextLView=r,o.bindingIndex=s.bindingStartIndex,o.inI18n=!1}function Qf(){const r=zt.lFrame,o=null===r?null:r.child;return null===o?Xn(r):o}function Xn(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function sn(){const r=zt.lFrame;return zt.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const ax=sn;function Eo(){const r=sn();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function ao(){return zt.lFrame.selectedIndex}function Ul(r){zt.lFrame.selectedIndex=r}let Ug=!0;function ba(){return Ug}function sl(r){Ug=r}function Zh(r,o){for(let s=o.directiveStart,c=o.directiveEnd;s<c;s++){const m=r.data[s].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:M,ngAfterViewChecked:S,ngOnDestroy:O}=m;y&&(r.contentHooks??=[]).push(-s,y),w&&((r.contentHooks??=[]).push(s,w),(r.contentCheckHooks??=[]).push(s,w)),M&&(r.viewHooks??=[]).push(-s,M),S&&((r.viewHooks??=[]).push(s,S),(r.viewCheckHooks??=[]).push(s,S)),null!=O&&(r.destroyHooks??=[]).push(s,O)}}function Wh(r,o,s){Hg(r,o,3,s)}function wa(r,o,s,c){(3&r[rn])===s&&Hg(r,o,s,c)}function Rr(r,o){let s=r[rn];(3&s)===o&&(s&=8191,s+=1,r[rn]=s)}function Hg(r,o,s,c){const m=c??-1,y=o.length-1;let w=0;for(let M=void 0!==c?65535&r[Tu]:0;M<y;M++)if("number"==typeof o[M+1]){if(w=o[M],null!=c&&w>=c)break}else o[M]<0&&(r[Tu]+=65536),(w<m||-1==m)&&(ep(r,s,o,M),r[Tu]=(4294901760&r[Tu])+M+2),M++}function Gg(r,o){zo(4,r,o);const s=Ds(null);try{o.call(r)}finally{Ds(s),zo(5,r,o)}}function ep(r,o,s,c){const h=s[c]<0,m=s[c+1],w=r[h?-s[c]:s[c]];h?r[rn]>>13<r[Tu]>>16&&(3&r[rn])===o&&(r[rn]+=8192,Gg(w,m)):Gg(w,m)}const Ys=-1;class Ou{constructor(o,s,c){this.factory=o,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=c}}function Wg(r){return r!==Ys}function Xh(r){return 32767&r}function Yh(r,o){let s=function e2(r){return r>>16}(r),c=o;for(;s>0;)c=c[Nh],s--;return c}let Xg=!0;function tp(r){const o=Xg;return Xg=r,o}const hx=255,dx=5;let ND=0;const al={};function np(r,o){const s=t2(r,o);if(-1!==s)return s;const c=o[ot];c.firstCreatePass&&(r.injectorIndex=o.length,fx(c.data,r),fx(o,null),fx(c.blueprint,null));const h=Lu(r,o),m=r.injectorIndex;if(Wg(h)){const y=Xh(h),w=Yh(h,o),M=w[ot].data;for(let S=0;S<8;S++)o[m+S]=w[y+S]|M[y+S]}return o[m+8]=h,m}function fx(r,o){r.push(0,0,0,0,0,0,0,0,o)}function t2(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function Lu(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let s=0,c=null,h=o;for(;null!==h;){if(c=r2(h),null===c)return Ys;if(s++,h=h[Nh],-1!==c.injectorIndex)return c.injectorIndex|s<<16}return Ys}function Yg(r,o,s){!function bn(r,o,s){let c;"string"==typeof s?c=s.charCodeAt(0)||0:s.hasOwnProperty(Eu)&&(c=s[Eu]),null==c&&(c=s[Eu]=ND++);const h=c&hx;o.data[r+(h>>dx)]|=1<<h}(r,o,s)}function px(r,o,s){if(s&Ht.Optional||void 0!==r)return r;fa()}function mx(r,o,s,c){if(s&Ht.Optional&&void 0===c&&(c=null),!(s&(Ht.Self|Ht.Host))){const h=r[tl],m=Ti(void 0);try{return h?h.get(o,c,s&Ht.Optional):ri(o,c,s&Ht.Optional)}finally{Ti(m)}}return px(c,0,s)}function n2(r,o,s,c=Ht.Default,h){if(null!==r){if(2048&o[rn]&&!(c&Ht.Self)){const y=function wt(r,o,s,c,h){let m=r,y=o;for(;null!==m&&null!==y&&2048&y[rn]&&!(512&y[rn]);){const w=Jg(m,y,s,c|Ht.Self,al);if(w!==al)return w;let M=m.parent;if(!M){const S=y[_a];if(S){const O=S.get(s,al,c);if(O!==al)return O}M=r2(y),y=y[Nh]}m=M}return h}(r,o,s,c,al);if(y!==al)return y}const m=Jg(r,o,s,c,al);if(m!==al)return m}return mx(o,s,c,h)}function Jg(r,o,s,c,h){const m=function Kg(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(Eu)?r[Eu]:void 0;return"number"==typeof o?o>=0?o&hx:rs:o}(s);if("function"==typeof m){if(!Jw(o,r,c))return c&Ht.Host?px(h,0,c):mx(o,s,c,h);try{let y;if(y=m(c),null!=y||c&Ht.Optional)return y;fa()}finally{ax()}}else if("number"==typeof m){let y=null,w=t2(r,o),M=Ys,S=c&Ht.Host?o[Pr][wo]:null;for((-1===w||c&Ht.SkipSelf)&&(M=-1===w?Lu(r,o):o[w+8],M!==Ys&&Lt(c,!1)?(y=o[ot],w=Xh(M),o=Yh(M,o)):w=-1);-1!==w;){const O=o[ot];if(ll(m,w,O.data)){const F=rp(w,o,s,y,c,S);if(F!==al)return F}M=o[w+8],M!==Ys&&Lt(c,o[ot].data[w+8]===S)&&ll(m,w,o)?(y=O,w=Xh(M),o=Yh(M,o)):w=-1}}return h}function rp(r,o,s,c,h,m){const y=o[ot],w=y.data[r+8],O=function ip(r,o,s,c,h){const m=r.providerIndexes,y=o.data,w=1048575&m,M=r.directiveStart,O=m>>20,$=h?w+O:r.directiveEnd;for(let Y=c?w:w+O;Y<$;Y++){const se=y[Y];if(Y<M&&s===se||Y>=M&&se.type===s)return Y}if(h){const Y=y[M];if(Y&&ya(Y)&&Y.type===s)return M}return null}(w,y,s,null==c?Lc(w)&&Xg:c!=y&&0!=(3&w.type),h&Ht.Host&&m===w);return null!==O?$l(o,y,O,w):al}function $l(r,o,s,c){let h=r[s];const m=o.data;if(function cx(r){return r instanceof Ou}(h)){const y=h;y.resolving&&function bu(r,o){const s=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new pe(-200,`Circular dependency in DI detected for ${r}${s}`)}(function De(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():J(r)}(m[s]));const w=tp(y.canSeeViewProviders);y.resolving=!0;const S=y.injectImpl?Ti(y.injectImpl):null;Jw(r,c,Ht.Default);try{h=r[s]=y.factory(void 0,m,r,c),o.firstCreatePass&&s>=c.directiveStart&&function $g(r,o,s){const{ngOnChanges:c,ngOnInit:h,ngDoCheck:m}=o.type.prototype;if(c){const y=Wy(o);(s.preOrderHooks??=[]).push(r,y),(s.preOrderCheckHooks??=[]).push(r,y)}h&&(s.preOrderHooks??=[]).push(0-r,h),m&&((s.preOrderHooks??=[]).push(r,m),(s.preOrderCheckHooks??=[]).push(r,m))}(s,m[s],o)}finally{null!==S&&Ti(S),tp(w),y.resolving=!1,ax()}}return h}function ll(r,o,s){return!!(s[o+(r>>dx)]&1<<r)}function Lt(r,o){return!(r&Ht.Self||r&Ht.Host&&o)}class st{constructor(o,s){this._tNode=o,this._lView=s}get(o,s,c){return n2(this._tNode,this._lView,o,fg(c),s)}}function rs(){return new st($i(),Oe())}function ii(r){return Ka(()=>{const o=r.prototype.constructor,s=o[Qa]||gx(o),c=Object.prototype;let h=Object.getPrototypeOf(r.prototype).constructor;for(;h&&h!==c;){const m=h[Qa]||gx(h);if(m&&m!==s)return m;h=Object.getPrototypeOf(h)}return m=>new m})}function gx(r){return eg(r)?()=>{const o=gx(qt(r));return o&&o()}:il(r)}function r2(r){const o=r[ot],s=o.type;return 2===s?o.declTNode:1===s?r[wo]:null}const Vc="__parameters__";function is(r,o,s){return Ka(()=>{const c=function Uc(r){return function(...s){if(r){const c=r(...s);for(const h in c)this[h]=c[h]}}}(o);function h(...m){if(this instanceof h)return c.apply(this,m),this;const y=new h(...m);return w.annotation=y,w;function w(M,S,O){const F=M.hasOwnProperty(Vc)?M[Vc]:Object.defineProperty(M,Vc,{value:[]})[Vc];for(;F.length<=O;)F.push(null);return(F[O]=F[O]||[]).push(y),M}}return s&&(h.prototype=Object.create(s.prototype)),h.prototype.ngMetadataName=r,h.annotationCls=h,h})}function Pn(r,o){r.forEach(s=>Array.isArray(s)?Pn(s,o):o(s))}function Qg(r,o,s){o>=r.length?r.push(s):r.splice(o,0,s)}function Ea(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function oi(r,o,s){let c=zu(r,o);return c>=0?r[1|c]=s:(c=~c,function cr(r,o,s,c){let h=r.length;if(h==o)r.push(s,c);else if(1===h)r.push(c,r[0]),r[0]=s;else{for(h--,r.push(r[h-1],r[h]);h>o;)r[h]=r[h-2],h--;r[o]=s,r[o+1]=c}}(r,c,o,s)),c}function e_(r,o){const s=zu(r,o);if(s>=0)return r[1|s]}function zu(r,o){return function wn(r,o,s){let c=0,h=r.length>>s;for(;h!==c;){const m=c+(h-c>>1),y=r[m<<s];if(o===y)return m<<s;y>o?h=m:c=m+1}return~(h<<s)}(r,o,1)}const ap=kf(is("Optional"),8),lp=kf(is("SkipSelf"),4);function dp(r){return 128==(128&r.flags)}var Hl=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(Hl||{});const fp=new Map;let Ma=0;const $t="__ngContext__";function Hi(r,o){oo(o)?(r[$t]=o[Cu],function C2(r){fp.set(r[Cu],r)}(o)):r[$t]=o}let Pt;function pp(r,o){return Pt(r,o)}function id(r){const o=r[lr];return No(o)?o[lr]:o}function Ax(r){return Rx(r[Fh])}function Px(r){return Rx(r[Zs])}function Rx(r){for(;null!==r&&!No(r);)r=r[Zs];return r}function Uu(r,o,s,c,h){if(null!=c){let m,y=!1;No(c)?m=c:oo(c)&&(y=!0,c=c[Wr]);const w=Dr(c);0===r&&null!==s?null==h?F2(o,s,w):G(o,s,w,h||null,!0):1===r&&null!==s?G(o,s,w,h||null,!0):2===r?function ld(r,o,s){const c=$u(r,o);c&&function dl(r,o,s,c){r.removeChild(o,s,c)}(r,c,o,s)}(o,w,y):3===r&&o.destroyNode(w),null!=m&&function $n(r,o,s,c,h){const m=s[Cs];m!==Dr(s)&&Uu(o,r,c,m,h);for(let w=Si;w<s.length;w++){const M=s[w];ud(M[ot],M,r,o,c,m)}}(o,r,m,s,h)}}function od(r,o,s){return r.createElement(o,s)}function To(r,o){const s=r[kc],c=s.indexOf(o);Yf(o),s.splice(c,1)}function a_(r,o){if(r.length<=Si)return;const s=Si+o,c=r[s];if(c){const h=c[zl];null!==h&&h!==r&&To(h,c),o>0&&(r[s-1][Zs]=c[Zs]);const m=Ea(r,Si+o);!function xn(r,o){ud(r,o,o[Wt],2,null,null),o[Wr]=null,o[wo]=null}(c[ot],c);const y=m[Ts];null!==y&&y.detachView(m[ot]),c[lr]=null,c[Zs]=null,c[rn]&=-129}return c}function ne(r,o){if(!(256&o[rn])){const s=o[Wt];o[Du]&&Ss(o[Du]),o[zh]&&Ss(o[zh]),s.destroyNode&&ud(r,o,s,3,null,null),function sd(r){let o=r[Fh];if(!o)return Lx(r[ot],r);for(;o;){let s=null;if(oo(o))s=o[Fh];else{const c=o[Si];c&&(s=c)}if(!s){for(;o&&!o[Zs]&&o!==r;)oo(o)&&Lx(o[ot],o),o=o[lr];null===o&&(o=r),oo(o)&&Lx(o[ot],o),s=o&&o[Zs]}o=s}}(o)}}function Lx(r,o){if(!(256&o[rn])){o[rn]&=-129,o[rn]|=256,function tS(r,o){let s;if(null!=r&&null!=(s=r.destroyHooks))for(let c=0;c<s.length;c+=2){const h=o[s[c]];if(!(h instanceof Ou)){const m=s[c+1];if(Array.isArray(m))for(let y=0;y<m.length;y+=2){const w=h[m[y]],M=m[y+1];zo(4,w,M);try{M.call(w)}finally{zo(5,w,M)}}else{zo(4,h,m);try{m.call(h)}finally{zo(5,h,m)}}}}}(r,o),function Oi(r,o){const s=r.cleanup,c=o[Lh];if(null!==s)for(let m=0;m<s.length-1;m+=2)if("string"==typeof s[m]){const y=s[m+3];y>=0?c[y]():c[-y].unsubscribe(),m+=2}else s[m].call(c[s[m+1]]);null!==c&&(o[Lh]=null);const h=o[nl];if(null!==h){o[nl]=null;for(let m=0;m<h.length;m++)(0,h[m])()}}(r,o),1===o[ot].type&&o[Wt].destroy();const s=o[zl];if(null!==s&&No(o[lr])){s!==o[lr]&&To(s,o);const c=o[Ts];null!==c&&c.detachView(r)}!function Tx(r){fp.delete(r[Cu])}(o)}}function Fx(r,o,s){return function L2(r,o,s){let c=o;for(;null!==c&&40&c.type;)c=(o=c).parent;if(null===c)return s[Wr];{const{componentOffset:h}=c;if(h>-1){const{encapsulation:m}=r.data[c.directiveStart+h];if(m===Lo.None||m===Lo.Emulated)return null}return Qo(c,s)}}(r,o.parent,s)}function G(r,o,s,c,h){r.insertBefore(o,s,c,h)}function F2(r,o,s){r.appendChild(o,s)}function Nx(r,o,s,c,h){null!==c?G(r,o,s,c,h):F2(r,o,s)}function $u(r,o){return r.parentNode(o)}let Qs,jx,z2=function zx(r,o,s){return 40&r.type?Qo(r,s):null};function Zt(r,o,s,c){const h=Fx(r,c,o),m=o[Wt],w=function Gl(r,o,s){return z2(r,o,s)}(c.parent||o[wo],c,o);if(null!=h)if(Array.isArray(s))for(let M=0;M<s.length;M++)Nx(m,h,s[M],w,!1);else Nx(m,h,s,w,!1);void 0!==Qs&&Qs(m,c,o,s,h)}function ql(r,o){if(null!==o){const s=o.type;if(3&s)return Qo(o,r);if(4&s)return ad(-1,r[o.index]);if(8&s){const c=o.child;if(null!==c)return ql(r,c);{const h=r[o.index];return No(h)?ad(-1,h):Dr(h)}}if(32&s)return pp(o,r)()||Dr(r[o.index]);{const c=Bx(r,o);return null!==c?Array.isArray(c)?c[0]:ql(id(r[Pr]),c):ql(r,o.next)}}return null}function Bx(r,o){return null!==o?r[Pr][wo].projection[o.projection]:null}function ad(r,o){const s=Si+r+1;if(s<o.length){const c=o[s],h=c[ot].firstChild;if(null!==h)return ql(c,h)}return o[Cs]}function c_(r,o,s,c,h,m,y){for(;null!=s;){const w=c[s.index],M=s.type;if(y&&0===o&&(w&&Hi(Dr(w),c),s.flags|=2),32!=(32&s.flags))if(8&M)c_(r,o,s.child,c,h,m,!1),Uu(o,r,h,w,m);else if(32&M){const S=pp(s,c);let O;for(;O=S();)Uu(o,r,h,O,m);Uu(o,r,h,w,m)}else 16&M?fl(r,o,c,s,h,m):Uu(o,r,h,w,m);s=y?s.projectionNext:s.next}}function ud(r,o,s,c,h,m){c_(s,c,r.firstChild,o,h,m,!1)}function fl(r,o,s,c,h,m){const y=s[Pr],M=y[wo].projection[c.projection];if(Array.isArray(M))for(let S=0;S<M.length;S++)Uu(o,r,h,M[S],m);else{let S=M;const O=y[lr];dp(c)&&(S.flags|=128),c_(r,o,S,O,h,m,!0)}}function lo(r,o,s){""===s?r.removeAttribute(o,"class"):r.setAttribute(o,"class",s)}function V2(r,o,s){const{mergedAttrs:c,classes:h,styles:m}=s;null!==c&&kh(r,o,c),null!==h&&lo(r,o,h),null!==m&&function Hc(r,o,s){r.setAttribute(o,"style",s)}(r,o,m)}class d_{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const wp=new at("ENVIRONMENT_INITIALIZER"),Yx=new at("INJECTOR",-1),K2=new at("INJECTOR_DEF_TYPES");class Ep{get(o,s=Ko){if(s===Ko){const c=new Error(`NullInjectorError: No provider for ${di(o)}!`);throw c.name="NullInjectorError",c}return s}}function Kx(...r){return{\u0275providers:Qx(0,r),\u0275fromNgModule:!0}}function Qx(r,...o){const s=[],c=new Set;let h;const m=y=>{s.push(y)};return Pn(o,y=>{const w=y;Ca(w,m,[],c)&&(h||=[],h.push(w))}),void 0!==h&&ev(h,m),s}function ev(r,o){for(let s=0;s<r.length;s++){const{ngModule:c,providers:h}=r[s];tv(h,m=>{o(m,c)})}}function Ca(r,o,s,c){if(!(r=qt(r)))return!1;let h=null,m=Ch(r);const y=!m&&An(r);if(m||y){if(y&&!y.standalone)return!1;h=r}else{const M=r.ngModule;if(m=Ch(M),!m)return!1;h=M}const w=c.has(h);if(y){if(w)return!1;if(c.add(h),y.dependencies){const M="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(const S of M)Ca(S,o,s,c)}}else{if(!m)return!1;{if(null!=m.imports&&!w){let S;c.add(h);try{Pn(m.imports,O=>{Ca(O,o,s,c)&&(S||=[],S.push(O))})}finally{}void 0!==S&&ev(S,o)}if(!w){const S=il(h)||(()=>new h);o({provide:h,useFactory:S,deps:zn},h),o({provide:K2,useValue:h,multi:!0},h),o({provide:wp,useValue:()=>yt(h),multi:!0},h)}const M=m.providers;if(null!=M&&!w){const S=r;tv(M,O=>{o(O,S)})}}}return h!==r&&void 0!==r.providers}function tv(r,o){for(let s of r)tg(s)&&(s=s.\u0275providers),Array.isArray(s)?tv(s,o):o(s)}const pd=er({provide:String,useValue:er});function Mp(r){return null!==r&&"object"==typeof r&&pd in r}function Zc(r){return"function"==typeof r}const nv=new at("Set Injector scope."),y_={},uS={};let rv;function Cp(){return void 0===rv&&(rv=new Ep),rv}class cs{}class md extends cs{get destroyed(){return this._destroyed}constructor(o,s,c,h){super(),this.parent=s,this.source=c,this.scopes=h,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ur(o,y=>this.processProvider(y)),this.records.set(Yx,Xu(void 0,this)),h.has("environment")&&this.records.set(cs,Xu(void 0,this));const m=this.records.get(nv);null!=m&&"string"==typeof m.value&&this.scopes.add(m.value),this.injectorDefTypes=new Set(this.get(K2.multi,zn,Ht.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const s of this._ngOnDestroyHooks)s.ngOnDestroy();const o=this._onDestroyHooks;this._onDestroyHooks=[];for(const s of o)s()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(o){return this.assertNotDestroyed(),this._onDestroyHooks.push(o),()=>this.removeOnDestroy(o)}runInContext(o){this.assertNotDestroyed();const s=Nl(this),c=Ti(void 0);try{return o()}finally{Nl(s),Ti(c)}}get(o,s=Ko,c=Ht.Default){if(this.assertNotDestroyed(),o.hasOwnProperty(gg))return o[gg](this);c=fg(c);const m=Nl(this),y=Ti(void 0);try{if(!(c&Ht.SkipSelf)){let M=this.records.get(o);if(void 0===M){const S=function Xl(r){return"function"==typeof r||"object"==typeof r&&r instanceof at}(o)&&If(o);M=S&&this.injectableDefInScope(S)?Xu(x_(o),y_):null,this.records.set(o,M)}if(null!=M)return this.hydrate(o,M)}return(c&Ht.Self?Cp():this.parent).get(o,s=c&Ht.Optional&&s===Ko?null:s)}catch(w){if("NullInjectorError"===w.name){if((w[Rf]=w[Rf]||[]).unshift(di(o)),m)throw w;return function mw(r,o,s,c){const h=r[Rf];throw o[Ah]&&h.unshift(o[Ah]),r.message=function gw(r,o,s,c=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let h=di(o);if(Array.isArray(o))h=o.map(di).join(" -> ");else if("object"==typeof o){let m=[];for(let y in o)if(o.hasOwnProperty(y)){let w=o[y];m.push(y+":"+("string"==typeof w?JSON.stringify(w):di(w)))}h=`{${m.join(", ")}}`}return`${s}${c?"("+c+")":""}[${h}]: ${r.replace(uD,"\n  ")}`}("\n"+r.message,h,s,c),r.ngTokenPath=h,r[Rf]=null,r}(w,o,"R3InjectorError",this.source)}throw w}finally{Ti(y),Nl(m)}}resolveInjectorInitializers(){const o=Nl(this),s=Ti(void 0);try{const h=this.get(wp.multi,zn,Ht.Self);for(const m of h)m()}finally{Nl(o),Ti(s)}}toString(){const o=[],s=this.records;for(const c of s.keys())o.push(di(c));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new pe(205,!1)}processProvider(o){let s=Zc(o=qt(o))?o:qt(o&&o.provide);const c=function dS(r){return Mp(r)?Xu(void 0,r.useValue):Xu(iv(r),y_)}(o);if(Zc(o)||!0!==o.multi)this.records.get(s);else{let h=this.records.get(s);h||(h=Xu(void 0,y_,!0),h.factory=()=>pg(h.multi),this.records.set(s,h)),s=o,h.multi.push(o)}this.records.set(s,c)}hydrate(o,s){return s.value===y_&&(s.value=uS,s.value=s.factory()),"object"==typeof s.value&&s.value&&function ov(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(s.value)&&this._ngOnDestroyHooks.add(s.value),s.value}injectableDefInScope(o){if(!o.providedIn)return!1;const s=qt(o.providedIn);return"string"==typeof s?"any"===s||this.scopes.has(s):this.injectorDefTypes.has(s)}removeOnDestroy(o){const s=this._onDestroyHooks.indexOf(o);-1!==s&&this._onDestroyHooks.splice(s,1)}}function x_(r){const o=If(r),s=null!==o?o.factory:il(r);if(null!==s)return s;if(r instanceof at)throw new pe(204,!1);if(r instanceof Function)return function hS(r){const o=r.length;if(o>0)throw function td(r,o){const s=[];for(let c=0;c<r;c++)s.push(o);return s}(o,"?"),new pe(204,!1);const s=function lg(r){return r&&(r[io]||r[cg])||null}(r);return null!==s?()=>s.factory(r):()=>new r}(r);throw new pe(204,!1)}function iv(r,o,s){let c;if(Zc(r)){const h=qt(r);return il(h)||x_(h)}if(Mp(r))c=()=>qt(r.useValue);else if(function Tp(r){return!(!r||!r.useFactory)}(r))c=()=>r.useFactory(...pg(r.deps||[]));else if(function Wu(r){return!(!r||!r.useExisting)}(r))c=()=>yt(qt(r.useExisting));else{const h=qt(r&&(r.useClass||r.provide));if(!function eE(r){return!!r.deps}(r))return il(h)||x_(h);c=()=>new h(...pg(r.deps))}return c}function Xu(r,o,s=!1){return{factory:r,value:o,multi:s?[]:void 0}}function ur(r,o){for(const s of r)Array.isArray(s)?ur(s,o):s&&tg(s)?ur(s.\u0275providers,o):o(s)}const Dp=new at("AppId",{providedIn:"root",factory:()=>fS}),fS="ng",tE=new at("Platform Initializer"),ml=new at("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),nE=new at("CSP nonce",{providedIn:"root",factory:()=>function uo(){if(void 0!==jx)return jx;if(typeof document<"u")return document;throw new pe(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Pp=(r,o,s)=>null;function w_(r,o,s=!1){return Pp(r,o,s)}class mS{}class sE{}class _S{resolveComponentFactory(o){throw function gS(r){const o=Error(`No component factory found for ${di(r)}.`);return o.ngComponent=r,o}(o)}}let C_=(()=>{class r{static#e=this.NULL=new _S}return r})();function D_(){return vd($i(),Oe())}function vd(r,o){return new us(Qo(r,o))}let us=(()=>{class r{constructor(s){this.nativeElement=s}static#e=this.__NG_ELEMENT_ID__=D_}return r})();class lE{}let Jl=(()=>{class r{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function yS(){const r=Oe(),s=As($i().index,r);return(oo(s)?s:r)[Wt]}()}return r})(),cE=(()=>{class r{static#e=this.\u0275prov=It({token:r,providedIn:"root",factory:()=>null})}return r})();class wd{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const xS=new wd("16.2.12"),mv={};function _v(r,o=null,s=null,c){const h=gl(r,o,s,c);return h.resolveInjectorInitializers(),h}function gl(r,o=null,s=null,c,h=new Set){const m=[s||zn,Kx(r)];return c=c||("object"==typeof r?void 0:di(r)),new md(m,o||Cp(),c||null,h)}let qi=(()=>{class r{static#e=this.THROW_IF_NOT_FOUND=Ko;static#t=this.NULL=new Ep;static create(s,c){if(Array.isArray(s))return _v({name:""},c,s,"");{const h=s.name??"";return _v({name:h},s.parent,s.providers,h)}}static#n=this.\u0275prov=It({token:r,providedIn:"any",factory:()=>yt(Yx)});static#r=this.__NG_ELEMENT_ID__=-1}return r})();function xv(r){return r.ngOriginalError}class Kl{constructor(){this._console=console}handleError(o){const s=this._findOriginalError(o);this._console.error("ERROR",o),s&&this._console.error("ORIGINAL ERROR",s)}_findOriginalError(o){let s=o&&xv(o);for(;s&&xv(s);)s=xv(s);return s||null}}function bv(r){return o=>{setTimeout(r,void 0,o)}}const si=class wS extends Mi{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,s,c){let h=o,m=s||(()=>null),y=c;if(o&&"object"==typeof o){const M=o;h=M.next?.bind(M),m=M.error?.bind(M),y=M.complete?.bind(M)}this.__isAsync&&(m=bv(m),h&&(h=bv(h)),y&&(y=bv(y)));const w=super.subscribe({next:h,error:m,complete:y});return o instanceof ie&&o.add(w),w}};function Np(...r){}class hr{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:c=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new si(!1),this.onMicrotaskEmpty=new si(!1),this.onStable=new si(!1),this.onError=new si(!1),typeof Zone>"u")throw new pe(908,!1);Zone.assertZonePatched();const h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!c&&s,h.shouldCoalesceRunChangeDetection=c,h.lastRequestAnimationFrameId=-1,h.nativeRequestAnimationFrame=function Ed(){const r="function"==typeof xr.requestAnimationFrame;let o=xr[r?"requestAnimationFrame":"setTimeout"],s=xr[r?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&o&&s){const c=o[Zone.__symbol__("OriginalDelegate")];c&&(o=c);const h=s[Zone.__symbol__("OriginalDelegate")];h&&(s=h)}return{nativeRequestAnimationFrame:o,nativeCancelAnimationFrame:s}}().nativeRequestAnimationFrame,function fE(r){const o=()=>{!function TS(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(xr,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,A_(r),r.isCheckStableRunning=!0,I_(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),A_(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,c,h,m,y,w)=>{if(function Xc(r){return!(!Array.isArray(r)||1!==r.length)&&!0===r[0].data?.__ignore_ng_zone__}(w))return s.invokeTask(h,m,y,w);try{return wv(r),s.invokeTask(h,m,y,w)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||r.shouldCoalesceRunChangeDetection)&&o(),Ev(r)}},onInvoke:(s,c,h,m,y,w,M)=>{try{return wv(r),s.invoke(h,m,y,w,M)}finally{r.shouldCoalesceRunChangeDetection&&o(),Ev(r)}},onHasTask:(s,c,h,m)=>{s.hasTask(h,m),c===h&&("microTask"==m.change?(r._hasPendingMicrotasks=m.microTask,A_(r),I_(r)):"macroTask"==m.change&&(r.hasPendingMacrotasks=m.macroTask))},onHandleError:(s,c,h,m)=>(s.handleError(h,m),r.runOutsideAngular(()=>r.onError.emit(m)),!1)})}(h)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!hr.isInAngularZone())throw new pe(909,!1)}static assertNotInAngularZone(){if(hr.isInAngularZone())throw new pe(909,!1)}run(o,s,c){return this._inner.run(o,s,c)}runTask(o,s,c,h){const m=this._inner,y=m.scheduleEventTask("NgZoneEvent: "+h,o,MS,Np,Np);try{return m.runTask(y,s,c)}finally{m.cancelTask(y)}}runGuarded(o,s,c){return this._inner.runGuarded(o,s,c)}runOutsideAngular(o){return this._outer.run(o)}}const MS={};function I_(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function A_(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function wv(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function Ev(r){r._nesting--,I_(r)}class pE{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new si,this.onMicrotaskEmpty=new si,this.onStable=new si,this.onError=new si}run(o,s,c){return o.apply(s,c)}runGuarded(o,s,c){return o.apply(s,c)}runOutsideAngular(o){return o()}runTask(o,s,c,h){return o.apply(s,c)}}const Mv=new at("",{providedIn:"root",factory:Tv});function Tv(){const r=lt(hr);let o=!0;return function Qm(...r){const o=Ic(r),s=function lw(r,o){return"number"==typeof Ym(r)?r.pop():o}(r,1/0),c=r;return c.length?1===c.length?fn(c[0]):Sc(s)(hi(c,o)):ha}(new Un(h=>{o=r.isStable&&!r.hasPendingMacrotasks&&!r.hasPendingMicrotasks,r.runOutsideAngular(()=>{h.next(o),h.complete()})}),new Un(h=>{let m;r.runOutsideAngular(()=>{m=r.onStable.subscribe(()=>{hr.assertNotInAngularZone(),queueMicrotask(()=>{!o&&!r.hasPendingMacrotasks&&!r.hasPendingMicrotasks&&(o=!0,h.next(!0))})})});const y=r.onUnstable.subscribe(()=>{hr.assertInAngularZone(),o&&(o=!1,r.runOutsideAngular(()=>{h.next(!1)}))});return()=>{m.unsubscribe(),y.unsubscribe()}}).pipe(Cn()))}function Ql(r){return r instanceof Function?r():r}let Sv=(()=>{class r{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=It({token:r,providedIn:"root",factory:()=>new r})}return r})();function zp(r){for(;r;){r[rn]|=64;const o=id(r);if(By(r)&&!o)return r;r=o}return null}const vE=new at("",{providedIn:"root",factory:()=>!1});let O_=null;function k_(r,o){return r[o]??Iv()}function ME(r,o){const s=Iv();s.producerNode?.length&&(r[o]=O_,s.lView=r,O_=TE())}const SS={...Aw,consumerIsAlwaysLive:!0,consumerMarkedDirty:r=>{zp(r.lView)},lView:null};function TE(){return Object.create(SS)}function Iv(){return O_??=TE(),O_}const Yt={};function ho(r){L_(Dn(),Oe(),ao()+r,!1)}function L_(r,o,s,c){if(!c)if(3==(3&o[rn])){const m=r.preOrderCheckHooks;null!==m&&Wh(o,m,s)}else{const m=r.preOrderHooks;null!==m&&wa(o,m,0,s)}Ul(s)}function je(r,o=Ht.Default){const s=Oe();return null===s?yt(r,o):n2($i(),s,qt(r),o)}function Yc(r,o,s,c,h,m,y,w,M,S,O){const F=o.blueprint.slice();return F[Wr]=h,F[rn]=140|c,(null!==S||r&&2048&r[rn])&&(F[rn]|=2048),va(F),F[lr]=F[Nh]=r,F[Xr]=s,F[Oc]=y||r&&r[Oc],F[Wt]=w||r&&r[Wt],F[tl]=M||r&&r[tl]||null,F[wo]=m,F[Cu]=function T2(){return Ma++}(),F[rl]=O,F[_a]=S,F[Pr]=2==o.type?r[Pr]:F,F}function Sa(r,o,s,c,h){let m=r.data[o];if(null===m)m=function Vp(r,o,s,c,h){const m=Og(),y=kg(),M=r.data[o]=function PE(r,o,s,c,h,m){let y=o?o.injectorIndex:-1,w=0;return function Au(){return null!==zt.skipHydrationRootTNode}()&&(w|=128),{type:s,index:c,insertBeforeIndex:null,injectorIndex:y,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:w,providerIndexes:0,value:h,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?m:m&&m.parent,s,o,c,h);return null===r.firstChild&&(r.firstChild=M),null!==m&&(y?null==m.child&&null!==M.parent&&(m.child=M):null===m.next&&(m.next=M,M.prev=m)),M}(r,o,s,c,h),function Jf(){return zt.lFrame.inI18n}()&&(m.flags|=32);else if(64&m.type){m.type=s,m.value=c,m.attrs=h;const y=function Pu(){const r=zt.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();m.injectorIndex=null===y?-1:y.injectorIndex}return Xs(m,!0),m}function Jc(r,o,s,c){if(0===s)return-1;const h=o.length;for(let m=0;m<s;m++)o.push(c),r.blueprint.push(c),r.data.push(null);return h}function DE(r,o,s,c,h){const m=k_(o,Du),y=ao(),w=2&c;try{Ul(-1),w&&o.length>_n&&L_(r,o,_n,!1),zo(w?2:0,h);const S=w?m:null,O=Gf(S);try{null!==S&&(S.dirty=!1),s(c,h)}finally{jh(S,O)}}finally{w&&null===o[Du]&&ME(o,Du),Ul(y),zo(w?3:1,h)}}function F_(r,o,s){if(Mg(o)){const c=Ds(null);try{const m=o.directiveEnd;for(let y=o.directiveStart;y<m;y++){const w=r.data[y];w.contentQueries&&w.contentQueries(1,s[y],y)}}finally{Ds(c)}}}function Pv(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=z_(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):o}function z_(r,o,s,c,h,m,y,w,M,S,O){const F=_n+c,$=F+h,Y=function B_(r,o){const s=[];for(let c=0;c<o;c++)s.push(c<r?null:Yt);return s}(F,$),se="function"==typeof S?S():S;return Y[ot]={type:r,blueprint:Y,template:s,queries:null,viewQuery:w,declTNode:o,data:Y.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:$,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:M,consts:se,incompleteFirstPass:!1,ssrId:O}}let Rv=r=>null;function Ov(r,o,s,c){for(let h in r)if(r.hasOwnProperty(h)){s=null===s?{}:s;const m=r[h];null===c?RE(s,o,h,m):c.hasOwnProperty(h)&&RE(s,o,c[h],m)}return s}function RE(r,o,s,c){r.hasOwnProperty(s)?r[s].push(o,c):r[s]=[o,c]}function Ku(r,o,s,c,h,m){for(let S=0;S<c.length;S++)Yg(np(s,o),r,c[S].type);!function Td(r,o,s){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+s,r.providerIndexes=o}(s,r.data.length,c.length);for(let S=0;S<c.length;S++){const O=c[S];O.providersResolver&&O.providersResolver(O)}let y=!1,w=!1,M=Jc(r,o,c.length,null);for(let S=0;S<c.length;S++){const O=c[S];s.mergedAttrs=ga(s.mergedAttrs,O.hostAttrs),Cd(r,s,o,M,O),OS(M,O,h),null!==O.contentQueries&&(s.flags|=4),(null!==O.hostBindings||null!==O.hostAttrs||0!==O.hostVars)&&(s.flags|=64);const F=O.type.prototype;!y&&(F.ngOnChanges||F.ngOnInit||F.ngDoCheck)&&((r.preOrderHooks??=[]).push(s.index),y=!0),!w&&(F.ngOnChanges||F.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(s.index),w=!0),M++}!function AS(r,o,s){const h=o.directiveEnd,m=r.data,y=o.attrs,w=[];let M=null,S=null;for(let O=o.directiveStart;O<h;O++){const F=m[O],$=s?s.get(F):null,se=$?$.outputs:null;M=Ov(F.inputs,O,M,$?$.inputs:null),S=Ov(F.outputs,O,S,se);const he=null===M||null===y||_w(o)?null:LS(M,O,y);w.push(he)}null!==M&&(M.hasOwnProperty("class")&&(o.flags|=8),M.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=w,o.inputs=M,o.outputs=S}(r,s,m)}function kv(r,o,s){const c=s.directiveStart,h=s.directiveEnd,m=s.index,y=function Kf(){return zt.lFrame.currentDirectiveIndex}();try{Ul(m);for(let w=c;w<h;w++){const M=r.data[w],S=o[w];nr(w),(null!==M.hostBindings||0!==M.hostVars||null!==M.hostAttrs)&&j_(M,S)}}finally{Ul(-1),nr(y)}}function j_(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function Lv(r,o,s){o.componentOffset=s,(r.components??=[]).push(o.index)}function OS(r,o,s){if(s){if(o.exportAs)for(let c=0;c<o.exportAs.length;c++)s[o.exportAs[c]]=r;ya(o)&&(s[""]=r)}}function Cd(r,o,s,c,h){r.data[c]=h;const m=h.factory||(h.factory=il(h.type)),y=new Ou(m,ya(h),je);r.blueprint[c]=y,s[c]=y,function Kc(r,o,s,c,h){const m=h.hostBindings;if(m){let y=r.hostBindingOpCodes;null===y&&(y=r.hostBindingOpCodes=[]);const w=~o.index;(function LE(r){let o=r.length;for(;o>0;){const s=r[--o];if("number"==typeof s&&s<0)return s}return 0})(y)!=w&&y.push(w),y.push(s,c,m)}}(r,o,c,Jc(r,s,h.hostVars,Yt),h)}function kS(r,o,s,c,h,m){const y=m[o];if(null!==y)for(let w=0;w<y.length;)$_(c,s,y[w++],y[w++],y[w++])}function $_(r,o,s,c,h){const m=Ds(null);try{const y=r.inputTransforms;null!==y&&y.hasOwnProperty(c)&&(h=y[c].call(o,h)),null!==r.setInput?r.setInput(o,h,s,c):o[c]=h}finally{Ds(m)}}function LS(r,o,s){let c=null,h=0;for(;h<s.length;){const m=s[h];if(0!==m)if(5!==m){if("number"==typeof m)break;if(r.hasOwnProperty(m)){null===c&&(c=[]);const y=r[m];for(let w=0;w<y.length;w+=2)if(y[w]===o){c.push(m,y[w+1],s[h+1]);break}}h+=2}else h+=2;else h+=4}return c}function nc(r,o){const s=r.contentQueries;if(null!==s)for(let c=0;c<s.length;c+=2){const m=s[c+1];if(-1!==m){const y=r.data[m];Ng(s[c]),y.contentQueries(2,o[m],m)}}}function $p(r,o){return r[Fh]?r[zy][Zs]=o:r[Fh]=o,r[zy]=o,o}function H_(r,o,s){Ng(0);const c=Ds(null);try{o(r,s)}finally{Ds(c)}}function Qc(r,o){const s=r[tl],c=s?s.get(Kl,null):null;c&&c.handleError(o)}function q_(r,o,s,c,h){for(let m=0;m<s.length;){const y=s[m++],w=s[m++];$_(r.data[y],o[y],c,w,h)}}function NE(r,o){const s=As(o,r),c=s[ot];!function FS(r,o){for(let s=o.length;s<r.blueprint.length;s++)o.push(r.blueprint[s])}(c,s);const h=s[Wr];null!==h&&null===s[rl]&&(s[rl]=w_(h,s[tl])),xl(c,s,s[Xr])}function xl(r,o,s){sx(o);try{const c=r.viewQuery;null!==c&&H_(1,c,s);const h=r.template;null!==h&&DE(r,o,h,1,s),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&nc(r,o),r.staticViewQueries&&H_(2,r.viewQuery,s);const m=r.components;null!==m&&function NS(r,o){for(let s=0;s<o.length;s++)NE(r,o[s])}(o,m)}catch(c){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),c}finally{o[rn]&=-5,Eo()}}let Sd=(()=>{class r{constructor(){this.all=new Set,this.queue=new Map}create(s,c,h){const m=typeof Zone>"u"?null:Zone.current,y=function jw(r,o,s){const c=Object.create(Uw);s&&(c.consumerAllowSignalWrites=!0),c.fn=r,c.schedule=o;const h=y=>{c.cleanupFn=y};return c.ref={notify:()=>jl(c),run:()=>{if(c.dirty=!1,c.hasRun&&!qf(c))return;c.hasRun=!0;const y=Gf(c);try{c.cleanupFn(),c.cleanupFn=Su,c.fn(h)}finally{jh(c,y)}},cleanup:()=>c.cleanupFn()},c.ref}(s,S=>{this.all.has(S)&&this.queue.set(S,m)},h);let w;this.all.add(y),y.notify();const M=()=>{y.cleanup(),w?.(),this.all.delete(y),this.queue.delete(y)};return w=c?.onDestroy(M),{destroy:M}}flush(){if(0!==this.queue.size)for(const[s,c]of this.queue)this.queue.delete(s),c?c.run(()=>s.run()):s.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=It({token:r,providedIn:"root",factory:()=>new r})}return r})();function eu(r,o,s){let c=s?r.styles:null,h=s?r.classes:null,m=0;if(null!==o)for(let y=0;y<o.length;y++){const w=o[y];"number"==typeof w?m=w:1==m?h=Df(h,w):2==m&&(c=Df(c,w+": "+o[++y]+";"))}s?r.styles=c:r.stylesWithoutHost=c,s?r.classes=h:r.classesWithoutHost=h}function rc(r,o,s,c,h=!1){for(;null!==s;){const m=o[s.index];null!==m&&c.push(Dr(m)),No(m)&&Gp(m,c);const y=s.type;if(8&y)rc(r,o,s.child,c);else if(32&y){const w=pp(s,o);let M;for(;M=w();)c.push(M)}else if(16&y){const w=Bx(o,s);if(Array.isArray(w))c.push(...w);else{const M=id(o[Pr]);rc(M[ot],M,w,c,!0)}}s=h?s.projectionNext:s.next}return c}function Gp(r,o){for(let s=Si;s<r.length;s++){const c=r[s],h=c[ot].firstChild;null!==h&&rc(c[ot],c,h,o)}r[Cs]!==r[Wr]&&o.push(r[Cs])}function Z_(r,o,s,c=!0){const h=o[Oc],m=h.rendererFactory,y=h.afterRenderEventManager;m.begin?.(),y?.begin();try{qp(r,o,r.template,s)}catch(M){throw c&&Qc(o,M),M}finally{m.end?.(),h.effectManager?.flush(),y?.end()}}function qp(r,o,s,c){const h=o[rn];if(256!=(256&h)){o[Oc].effectManager?.flush(),sx(o);try{va(o),function ox(r){return zt.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==s&&DE(r,o,s,2,c);const y=3==(3&h);if(y){const S=r.preOrderCheckHooks;null!==S&&Wh(o,S,null)}else{const S=r.preOrderHooks;null!==S&&wa(o,S,0,null),Rr(o,0)}if(function BE(r){for(let o=Ax(r);null!==o;o=Px(o)){if(!o[Mw])continue;const s=o[kc];for(let c=0;c<s.length;c++){Gh(s[c])}}}(o),zE(o,2),null!==r.contentQueries&&nc(r,o),y){const S=r.contentCheckHooks;null!==S&&Wh(o,S)}else{const S=r.contentHooks;null!==S&&wa(o,S,1),Rr(o,1)}!function CE(r,o){const s=r.hostBindingOpCodes;if(null===s)return;const c=k_(o,zh);try{for(let h=0;h<s.length;h++){const m=s[h];if(m<0)Ul(~m);else{const y=m,w=s[++h],M=s[++h];et(w,y),c.dirty=!1;const S=Gf(c);try{M(2,o[y])}finally{jh(c,S)}}}}finally{null===o[zh]&&ME(o,zh),Ul(-1)}}(r,o);const w=r.components;null!==w&&Bv(o,w,0);const M=r.viewQuery;if(null!==M&&H_(2,M,c),y){const S=r.viewCheckHooks;null!==S&&Wh(o,S)}else{const S=r.viewHooks;null!==S&&wa(o,S,2),Rr(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),o[rn]&=-73,Yf(o)}finally{Eo()}}}function zE(r,o){for(let s=Ax(r);null!==s;s=Px(s))for(let c=Si;c<s.length;c++)jE(s[c],o)}function VE(r,o,s){jE(As(o,r),s)}function jE(r,o){if(!function Pg(r){return 128==(128&r[rn])}(r))return;const s=r[ot],c=r[rn];if(80&c&&0===o||1024&c||2===o)qp(s,r,s.template,r[Xr]);else if(r[Vf]>0){zE(r,1);const h=s.components;null!==h&&Bv(r,h,1)}}function Bv(r,o,s){for(let c=0;c<o.length;c++)VE(r,o[c],s)}class Zp{get rootNodes(){const o=this._lView,s=o[ot];return rc(s,o,s.firstChild,[])}constructor(o,s){this._lView=o,this._cdRefInjectingView=s,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Xr]}set context(o){this._lView[Xr]=o}get destroyed(){return 256==(256&this._lView[rn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[lr];if(No(o)){const s=o[8],c=s?s.indexOf(this):-1;c>-1&&(a_(o,c),Ea(s,c))}this._attachedToViewContainer=!1}ne(this._lView[ot],this._lView)}onDestroy(o){!function ex(r,o){if(256==(256&r[rn]))throw new pe(911,!1);null===r[nl]&&(r[nl]=[]),r[nl].push(o)}(this._lView,o)}markForCheck(){zp(this._cdRefInjectingView||this._lView)}detach(){this._lView[rn]&=-129}reattach(){this._lView[rn]|=128}detectChanges(){Z_(this._lView[ot],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new pe(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function KD(r,o){ud(r,o,o[Wt],2,null,null)}(this._lView[ot],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new pe(902,!1);this._appRef=o}}class UE extends Zp{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Z_(o[ot],o,o[Xr],!1)}checkNoChanges(){}get context(){return null}}class $E extends C_{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const s=An(o);return new Ad(s,this.ngModule)}}function Wp(r){const o=[];for(let s in r)r.hasOwnProperty(s)&&o.push({propName:r[s],templateName:s});return o}class Vv{constructor(o,s){this.injector=o,this.parentInjector=s}get(o,s,c){c=fg(c);const h=this.injector.get(o,mv,c);return h!==mv||s===mv?h:this.parentInjector.get(o,s,c)}}class Ad extends sE{get inputs(){const o=this.componentDef,s=o.inputTransforms,c=Wp(o.inputs);if(null!==s)for(const h of c)s.hasOwnProperty(h.propName)&&(h.transform=s[h.propName]);return c}get outputs(){return Wp(this.componentDef.outputs)}constructor(o,s){super(),this.componentDef=o,this.ngModule=s,this.componentType=o.type,this.selector=function ww(r){return r.map(mD).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!s}create(o,s,c,h){let m=(h=h||this.ngModule)instanceof cs?h:h?.injector;m&&null!==this.componentDef.getStandaloneInjector&&(m=this.componentDef.getStandaloneInjector(m)||m);const y=m?new Vv(o,m):o,w=y.get(lE,null);if(null===w)throw new pe(407,!1);const F={rendererFactory:w,sanitizer:y.get(cE,null),effectManager:y.get(Sd,null),afterRenderEventManager:y.get(Sv,null)},$=w.createRenderer(null,this.componentDef),Y=this.componentDef.selectors[0][0]||"div",se=c?function SE(r,o,s,c){const m=c.get(vE,!1)||s===Lo.ShadowDom,y=r.selectRootElement(o,m);return function IS(r){Rv(r)}(y),y}($,c,this.componentDef.encapsulation,y):od($,Y,function zS(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(Y)),be=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let me=null;null!==se&&(me=w_(se,y,!0));const Ue=z_(0,null,null,1,0,null,null,null,null,null,null),Qe=Yc(null,Ue,null,be,null,null,F,$,y,null,me);let dt,ft;sx(Qe);try{const tn=this.componentDef;let Ln,Bn=null;tn.findHostDirectiveDefs?(Ln=[],Bn=new Map,tn.findHostDirectiveDefs(tn,Ln,Bn),Ln.push(tn)):Ln=[tn];const Jr=function BS(r,o){const s=r[ot],c=_n;return r[c]=o,Sa(s,c,2,"#host",null)}(Qe,se),pr=function VS(r,o,s,c,h,m,y){const w=h[ot];!function X_(r,o,s,c){for(const h of r)o.mergedAttrs=ga(o.mergedAttrs,h.hostAttrs);null!==o.mergedAttrs&&(eu(o,o.mergedAttrs,!0),null!==s&&V2(c,s,o))}(c,r,o,y);let M=null;null!==o&&(M=w_(o,h[tl]));const S=m.rendererFactory.createRenderer(o,s);let O=16;s.signals?O=4096:s.onPush&&(O=64);const F=Yc(h,Pv(s),null,O,h[r.index],r,m,S,null,null,M);return w.firstCreatePass&&Lv(w,r,c.length-1),$p(h,F),h[r.index]=F}(Jr,se,tn,Ln,Qe,F,$);ft=Ww(Ue,_n),se&&function J_(r,o,s,c){if(c)kh(r,s,["ng-version",xS.full]);else{const{attrs:h,classes:m}=function Ly(r){const o=[],s=[];let c=1,h=2;for(;c<r.length;){let m=r[c];if("string"==typeof m)2===h?""!==m&&o.push(m,r[++c]):8===h&&s.push(m);else{if(!Ms(h))break;h=m}c++}return{attrs:o,classes:s}}(o.selectors[0]);h&&kh(r,s,h),m&&m.length>0&&lo(r,s,m.join(" "))}}($,tn,se,c),void 0!==s&&function K_(r,o,s){const c=r.projection=[];for(let h=0;h<o.length;h++){const m=s[h];c.push(null!=m?Array.from(m):null)}}(ft,this.ngContentSelectors,s),dt=function Y_(r,o,s,c,h,m){const y=$i(),w=h[ot],M=Qo(y,h);Ku(w,h,y,s,null,c);for(let O=0;O<s.length;O++)Hi($l(h,w,y.directiveStart+O,y),h);kv(w,h,y),M&&Hi(M,h);const S=$l(h,w,y.directiveStart+y.componentOffset,y);if(r[Xr]=h[Xr]=S,null!==m)for(const O of m)O(S,o);return F_(w,y,r),S}(pr,tn,Ln,Bn,Qe,[Pd]),xl(Ue,Qe,null)}finally{Eo()}return new W_(this.componentType,dt,vd(ft,Qe),Qe,ft)}}class W_ extends mS{constructor(o,s,c,h,m){super(),this.location=c,this._rootLView=h,this._tNode=m,this.previousInputValues=null,this.instance=s,this.hostView=this.changeDetectorRef=new UE(h),this.componentType=o}setInput(o,s){const c=this._tNode.inputs;let h;if(null!==c&&(h=c[o])){if(this.previousInputValues??=new Map,this.previousInputValues.has(o)&&Object.is(this.previousInputValues.get(o),s))return;const m=this._rootLView;q_(m[ot],m,h,o,s),this.previousInputValues.set(o,s),zp(As(this._tNode.index,m))}}get injector(){return new st(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function Pd(){const r=$i();Zh(Oe()[ot],r)}function Jn(r){let o=function HE(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),s=!0;const c=[r];for(;o;){let h;if(ya(r))h=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new pe(903,!1);h=o.\u0275dir}if(h){if(s){c.push(h);const y=r;y.inputs=Qu(r.inputs),y.inputTransforms=Qu(r.inputTransforms),y.declaredInputs=Qu(r.declaredInputs),y.outputs=Qu(r.outputs);const w=h.hostBindings;w&&US(r,w);const M=h.viewQuery,S=h.contentQueries;if(M&&Xp(r,M),S&&jS(r,S),Cf(r.inputs,h.inputs),Cf(r.declaredInputs,h.declaredInputs),Cf(r.outputs,h.outputs),null!==h.inputTransforms&&(null===y.inputTransforms&&(y.inputTransforms={}),Cf(y.inputTransforms,h.inputTransforms)),ya(h)&&h.data.animation){const O=r.data;O.animation=(O.animation||[]).concat(h.data.animation)}}const m=h.features;if(m)for(let y=0;y<m.length;y++){const w=m[y];w&&w.ngInherit&&w(r),w===Jn&&(s=!1)}}o=Object.getPrototypeOf(o)}!function jv(r){let o=0,s=null;for(let c=r.length-1;c>=0;c--){const h=r[c];h.hostVars=o+=h.hostVars,h.hostAttrs=ga(h.hostAttrs,s=ga(s,h.hostAttrs))}}(c)}function Qu(r){return r===qs?{}:r===zn?[]:r}function Xp(r,o){const s=r.viewQuery;r.viewQuery=s?(c,h)=>{o(c,h),s(c,h)}:o}function jS(r,o){const s=r.contentQueries;r.contentQueries=s?(c,h,m)=>{o(c,h,m),s(c,h,m)}:o}function US(r,o){const s=r.hostBindings;r.hostBindings=s?(c,h)=>{o(c,h),s(c,h)}:o}function fo(r,o,s){return!Object.is(r[o],s)&&(r[o]=s,!0)}function jd(r,o,s){const c=Oe();return fo(c,qh(),o)&&function hs(r,o,s,c,h,m,y,w){const M=Qo(o,s);let O,S=o.inputs;!w&&null!=S&&(O=S[c])?(q_(r,s,O,c,h),Lc(o)&&function jp(r,o){const s=As(o,r);16&s[rn]||(s[rn]|=64)}(s,o.index)):3&o.type&&(c=function OE(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(c),h=null!=y?y(h,o.value||"",c):h,m.setProperty(M,c,h))}(Dn(),function rr(){const r=zt.lFrame;return Ww(r.tView,r.selectedIndex)}(),c,r,o,c[Wt],s,!1),jd}function l0(r,o,s,c,h){const y=h?"class":"style";q_(r,s,o.inputs[y],y,c)}function jo(r,o,s,c){const h=Oe(),m=Dn(),y=_n+r,w=h[Wt],M=m.firstCreatePass?function lM(r,o,s,c,h,m){const y=o.consts,M=Sa(o,r,2,c,Bo(y,h));return function Fs(r,o,s,c){if(Rg()){const h=null===c?null:{"":-1},m=function U_(r,o){const s=r.directiveRegistry;let c=null,h=null;if(s)for(let m=0;m<s.length;m++){const y=s[m];if(vw(o,y.selectors,!1))if(c||(c=[]),ya(y))if(null!==y.findHostDirectiveDefs){const w=[];h=h||new Map,y.findHostDirectiveDefs(y,w,h),c.unshift(...w,y),Lv(r,o,w.length)}else c.unshift(y),Lv(r,o,0);else h=h||new Map,y.findHostDirectiveDefs?.(y,c,h),c.push(y)}return null===c?null:[c,h]}(r,s);let y,w;null===m?y=w=null:[y,w]=m,null!==y&&Ku(r,o,s,y,h,w),h&&function RS(r,o,s){if(o){const c=r.localNames=[];for(let h=0;h<o.length;h+=2){const m=s[o[h+1]];if(null==m)throw new pe(-301,!1);c.push(o[h],m)}}}(s,c,h)}s.mergedAttrs=ga(s.mergedAttrs,s.attrs)}(o,s,M,Bo(y,m)),null!==M.attrs&&eu(M,M.attrs,!1),null!==M.mergedAttrs&&eu(M,M.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,M),M}(y,m,h,o,s,c):m.data[y],S=Xv(m,h,M,w,o,r);h[y]=S;const O=Bl(M);return Xs(M,!0),V2(w,S,M),32!=(32&M.flags)&&ba()&&Zt(m,h,S,M),0===function tx(){return zt.lFrame.elementDepthCount}()&&Hi(S,h),function PD(){zt.lFrame.elementDepthCount++}(),O&&(function N_(r,o,s){Rg()&&(function V_(r,o,s,c){const h=s.directiveStart,m=s.directiveEnd;Lc(s)&&function Fv(r,o,s){const c=Qo(o,r),h=Pv(s);let y=16;s.signals?y=4096:s.onPush&&(y=64);const w=$p(r,Yc(r,h,null,y,c,o,null,r[Oc].rendererFactory.createRenderer(c,s),null,null,null));r[o.index]=w}(o,s,r.data[h+s.componentOffset]),r.firstCreatePass||np(s,o),Hi(c,o);const y=s.initialInputs;for(let w=h;w<m;w++){const M=r.data[w],S=$l(o,r,w,s);Hi(S,o),null!==y&&kS(0,w-h,S,M,0,y),ya(M)&&(As(s.index,o)[Xr]=$l(o,r,w,s))}}(r,o,s,Qo(s,o)),64==(64&s.flags)&&kv(r,o,s))}(m,h,M),F_(m,M,h)),null!==c&&function Av(r,o,s=Qo){const c=o.localNames;if(null!==c){let h=o.index+1;for(let m=0;m<c.length;m+=2){const y=c[m+1],w=-1===y?s(o,r):r[y];r[h++]=w}}}(h,M),jo}function po(){let r=$i();kg()?function ts(){zt.lFrame.isParent=!1}():(r=r.parent,Xs(r,!1));const o=r;(function Yw(r){return zt.skipHydrationRootTNode===r})(o)&&function rx(){zt.skipHydrationRootTNode=null}(),function RD(){zt.lFrame.elementDepthCount--}();const s=Dn();return s.firstCreatePass&&(Zh(s,r),Mg(r)&&s.queries.elementEnd(r)),null!=o.classesWithoutHost&&function Zg(r){return 0!=(8&r.flags)}(o)&&l0(s,o,Oe(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function ux(r){return 0!=(16&r.flags)}(o)&&l0(s,o,Oe(),o.stylesWithoutHost,!1),po}function Ud(r,o,s,c){return jo(r,o,s,c),po(),Ud}let Xv=(r,o,s,c,h,m)=>(sl(!0),od(c,h,function jg(){return zt.lFrame.currentNamespace}()));function Gd(r){return!!r&&"function"==typeof r.then}function Jv(r){return!!r&&"function"==typeof r.subscribe}function Uo(r,o,s,c){const h=Oe(),m=Dn(),y=$i();return function rm(r,o,s,c,h,m,y){const w=Bl(c),S=r.firstCreatePass&&function FE(r){return r.cleanup||(r.cleanup=[])}(r),O=o[Xr],F=function G_(r){return r[Lh]||(r[Lh]=[])}(o);let $=!0;if(3&c.type||y){const he=Qo(c,o),_e=y?y(he):he,be=F.length,me=y?Qe=>y(Dr(Qe[c.index])):c.index;let Ue=null;if(!y&&w&&(Ue=function uM(r,o,s,c){const h=r.cleanup;if(null!=h)for(let m=0;m<h.length-1;m+=2){const y=h[m];if(y===s&&h[m+1]===c){const w=o[Lh],M=h[m+2];return w.length>M?w[M]:null}"string"==typeof y&&(m+=2)}return null}(r,o,h,c.index)),null!==Ue)(Ue.__ngLastListenerFn__||Ue).__ngNextListenerFn__=m,Ue.__ngLastListenerFn__=m,$=!1;else{m=Qv(c,o,O,m,!1);const Qe=s.listen(_e,h,m);F.push(m,Qe),S&&S.push(h,me,be,be+1)}}else m=Qv(c,o,O,m,!1);const Y=c.outputs;let se;if($&&null!==Y&&(se=Y[h])){const he=se.length;if(he)for(let _e=0;_e<he;_e+=2){const dt=o[se[_e]][se[_e+1]].subscribe(m),ft=F.length;F.push(m,dt),S&&S.push(h,c.index,ft,-(ft+1))}}}(m,h,h[Wt],y,r,o,c),Uo}function nh(r,o,s,c){try{return zo(6,o,s),!1!==s(c)}catch(h){return Qc(r,h),!1}finally{zo(7,o,s)}}function Qv(r,o,s,c,h){return function m(y){if(y===Function)return c;zp(r.componentOffset>-1?As(r.index,o):o);let M=nh(o,s,c,y),S=m.__ngNextListenerFn__;for(;S;)M=nh(o,s,S,y)&&M,S=S.__ngNextListenerFn__;return h&&!1===M&&y.preventDefault(),M}}function am(r,o){return r<<17|o<<2}function sc(r){return r>>17&32767}function n1(r){return 2|r}function ac(r){return(131068&r)>>2}function lc(r,o){return-131069&r|o<<2}function d0(r){return 1|r}function yM(r,o,s,c,h){const m=r[s+1],y=null===o;let w=c?sc(m):ac(m),M=!1;for(;0!==w&&(!1===M||y);){const O=r[w+1];dI(r[w],o)&&(M=!0,r[w+1]=c?d0(O):n1(O)),w=c?sc(O):ac(O)}M&&(r[s+1]=c?n1(m):d0(m))}function dI(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&zu(r,o)>=0}function nu(r,o){return function La(r,o,s,c){const h=Oe(),m=Dn(),y=function ns(r){const o=zt.lFrame,s=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,s}(2);m.firstUpdatePass&&function Wd(r,o,s,c){const h=r.data;if(null===h[s+1]){const m=h[ao()],y=function o1(r,o){return o>=r.expandoStartIndex}(r,s);(function l1(r,o){return 0!=(r.flags&(o?8:16))})(m,c)&&null===o&&!y&&(o=!1),o=function SM(r,o,s,c){const h=function Pi(r){const o=zt.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let m=c?o.residualClasses:o.residualStyles;if(null===h)0===(c?o.classBindings:o.styleBindings)&&(s=Xd(s=p0(null,r,o,s,c),o.attrs,c),m=null);else{const y=o.directiveStylingLast;if(-1===y||r[y]!==h)if(s=p0(h,r,o,s,c),null===m){let M=function mI(r,o,s){const c=s?o.classBindings:o.styleBindings;if(0!==ac(c))return r[sc(c)]}(r,o,c);void 0!==M&&Array.isArray(M)&&(M=p0(null,r,o,M[1],c),M=Xd(M,o.attrs,c),function IM(r,o,s,c){r[sc(s?o.classBindings:o.styleBindings)]=c}(r,o,c,M))}else m=function s1(r,o,s){let c;const h=o.directiveEnd;for(let m=1+o.directiveStylingLast;m<h;m++)c=Xd(c,r[m].hostAttrs,s);return Xd(c,o.attrs,s)}(r,o,c)}return void 0!==m&&(c?o.residualClasses=m:o.residualStyles=m),s}(h,m,o,c),function lm(r,o,s,c,h,m){let y=m?o.classBindings:o.styleBindings,w=sc(y),M=ac(y);r[c]=s;let O,S=!1;if(Array.isArray(s)?(O=s[1],(null===O||zu(s,O)>0)&&(S=!0)):O=s,h)if(0!==M){const $=sc(r[w+1]);r[c+1]=am($,w),0!==$&&(r[$+1]=lc(r[$+1],c)),r[w+1]=function lI(r,o){return 131071&r|o<<17}(r[w+1],c)}else r[c+1]=am(w,0),0!==w&&(r[w+1]=lc(r[w+1],c)),w=c;else r[c+1]=am(M,0),0===w?w=c:r[M+1]=lc(r[M+1],c),M=c;S&&(r[c+1]=n1(r[c+1])),yM(r,O,c,!0),yM(r,O,c,!1),function hI(r,o,s,c,h){const m=h?r.residualClasses:r.residualStyles;null!=m&&"string"==typeof o&&zu(m,o)>=0&&(s[c+1]=d0(s[c+1]))}(o,O,r,c,m),y=am(w,M),m?o.classBindings=y:o.styleBindings=y}(h,m,o,s,y,c)}}(m,r,y,c),o!==Yt&&fo(h,y,o)&&function RM(r,o,s,c,h,m,y,w){if(!(3&o.type))return;const M=r.data,S=M[w+1],O=function _M(r){return 1==(1&r)}(S)?OM(M,o,s,h,ac(S),y):void 0;cc(O)||(cc(m)||function gM(r){return 2==(2&r)}(S)&&(m=OM(M,null,s,h,w,y)),function gp(r,o,s,c,h){if(o)h?r.addClass(s,c):r.removeClass(s,c);else{let m=-1===c.indexOf("-")?void 0:Hl.DashCase;null==h?r.removeStyle(s,c,m):("string"==typeof h&&h.endsWith("!important")&&(h=h.slice(0,-10),m|=Hl.Important),r.setStyle(s,c,h,m))}}(c,y,Ag(ao(),s),h,m))}(m,m.data[ao()],h,h[Wt],r,h[y+1]=function um(r,o){return null==r||""===r||("string"==typeof o?r+=o:"object"==typeof r&&(r=di(function as(r){return r instanceof d_?r.changingThisBreaksApplicationSecurity:r}(r)))),r}(o,s),c,y)}(r,o,null,!0),nu}function p0(r,o,s,c,h){let m=null;const y=s.directiveEnd;let w=s.directiveStylingLast;for(-1===w?w=s.directiveStart:w++;w<y&&(m=o[w],c=Xd(c,m.hostAttrs,h),m!==r);)w++;return null!==r&&(s.directiveStylingLast=w),c}function Xd(r,o,s){const c=s?1:2;let h=-1;if(null!==o)for(let m=0;m<o.length;m++){const y=o[m];"number"==typeof y?h=y:h===c&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),oi(r,y,!!s||o[++m]))}return void 0===r?null:r}function OM(r,o,s,c,h,m){const y=null===o;let w;for(;h>0;){const M=r[h],S=Array.isArray(M),O=S?M[1]:M,F=null===O;let $=s[h+1];$===Yt&&($=F?zn:void 0);let Y=F?e_($,c):O===c?$:void 0;if(S&&!cc(Y)&&(Y=e_(M,c)),cc(Y)&&(w=Y,y))return w;const se=r[h+1];h=y?sc(se):ac(se)}if(null!==o){let M=m?o.residualClasses:o.residualStyles;null!=M&&(w=e_(M,c))}return w}function cc(r){return void 0!==r}function uc(r,o=""){const s=Oe(),c=Dn(),h=r+_n,m=c.firstCreatePass?Sa(c,h,1,o,null):c.data[h],y=kM(c,s,m,o,r);s[h]=y,ba()&&Zt(c,s,y,m),Xs(m,!1)}let kM=(r,o,s,c,h)=>(sl(!0),function mp(r,o){return r.createText(o)}(o[Wt],c));function c1(r){return m0("",r,""),c1}function m0(r,o,s){const c=Oe(),h=function Od(r,o,s,c){return fo(r,qh(),s)?o+J(s)+c:Yt}(c,r,o,s);return h!==Yt&&function yl(r,o,s){const c=Ag(o,r);!function Ox(r,o,s){r.setValue(o,s)}(r[Wt],c,s)}(c,ao(),h),m0}const rh="en-US";let y0=rh;function D0(r,o,s,c,h){if(r=qt(r),Array.isArray(r))for(let m=0;m<r.length;m++)D0(r[m],o,s,c,h);else{const m=Dn(),y=Oe(),w=$i();let M=Zc(r)?r:qt(r.provide);const S=iv(r),O=1048575&w.providerIndexes,F=w.directiveStart,$=w.providerIndexes>>20;if(Zc(r)||!r.multi){const Y=new Ou(S,h,je),se=I0(M,o,h?O:O+$,F);-1===se?(Yg(np(w,y),m,M),ah(m,r,o.length),o.push(M),w.directiveStart++,w.directiveEnd++,h&&(w.providerIndexes+=1048576),s.push(Y),y.push(Y)):(s[se]=Y,y[se]=Y)}else{const Y=I0(M,o,O+$,F),se=I0(M,o,O,O+$),_e=se>=0&&s[se];if(h&&!_e||!h&&!(Y>=0&&s[Y])){Yg(np(w,y),m,M);const be=function eA(r,o,s,c,h){const m=new Ou(r,s,je);return m.multi=[],m.index=o,m.componentProviders=0,S0(m,h,c&&!s),m}(h?QI:F1,s.length,h,c,S);!h&&_e&&(s[se].providerFactory=be),ah(m,r,o.length,0),o.push(M),w.directiveStart++,w.directiveEnd++,h&&(w.providerIndexes+=1048576),s.push(be),y.push(be)}else ah(m,r,Y>-1?Y:se,S0(s[h?se:Y],S,!h&&c));!h&&c&&_e&&s[se].componentProviders++}}}function ah(r,o,s,c){const h=Zc(o),m=function Q2(r){return!!r.useClass}(o);if(h||m){const M=(m?qt(o.useClass):o).prototype.ngOnDestroy;if(M){const S=r.destroyHooks||(r.destroyHooks=[]);if(!h&&o.multi){const O=S.indexOf(s);-1===O?S.push(s,[c,M]):S[O+1].push(c,M)}else S.push(s,M)}}}function S0(r,o,s){return s&&r.componentProviders++,r.multi.push(o)-1}function I0(r,o,s,c){for(let h=s;h<c;h++)if(o[h]===r)return h;return-1}function F1(r,o,s,c){return N1(this.multi,[])}function QI(r,o,s,c){const h=this.multi;let m;if(this.providerFactory){const y=this.providerFactory.componentProviders,w=$l(s,s[ot],this.providerFactory.index,c);m=w.slice(0,y),N1(h,m);for(let M=y;M<w.length;M++)m.push(w[M])}else m=[],N1(h,m);return m}function N1(r,o){for(let s=0;s<r.length;s++)o.push((0,r[s])());return o}function Br(r,o=[]){return s=>{s.providersResolver=(c,h)=>function L1(r,o,s){const c=Dn();if(c.firstCreatePass){const h=ya(r);D0(s,c.data,c.blueprint,h,!0),D0(o,c.data,c.blueprint,h,!1)}}(c,h?h(r):r,o)}}class au{}class z1{}class A0 extends au{constructor(o,s,c){super(),this._parent=s,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new $E(this);const h=bo(o);this._bootstrapComponents=Ql(h.bootstrap),this._r3Injector=gl(o,s,[{provide:au,useValue:this},{provide:C_,useValue:this.componentFactoryResolver},...c],di(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class P0 extends z1{constructor(o){super(),this.moduleType=o}create(o){return new A0(this.moduleType,o,[])}}class B1 extends au{constructor(o){super(),this.componentFactoryResolver=new $E(this),this.instance=null;const s=new md([...o.providers,{provide:au,useValue:this},{provide:C_,useValue:this.componentFactoryResolver}],o.parent||Cp(),o.debugName,new Set(["environment"]));this.injector=s,o.runEnvironmentInitializers&&s.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function Qd(r,o,s=null){return new B1({providers:r,parent:o,debugName:s,runEnvironmentInitializers:!0}).injector}let R0=(()=>{class r{constructor(s){this._injector=s,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(s){if(!s.standalone)return null;if(!this.cachedInjectors.has(s)){const c=Qx(0,s.type),h=c.length>0?Qd([c],this._injector,`Standalone[${s.type.name}]`):null;this.cachedInjectors.set(s,h)}return this.cachedInjectors.get(s)}ngOnDestroy(){try{for(const s of this.cachedInjectors.values())null!==s&&s.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=It({token:r,providedIn:"environment",factory:()=>new r(yt(cs))})}return r})();function V1(r){r.getStandaloneInjector=o=>o.get(R0).getOrCreateStandaloneInjector(r)}function yA(r,o,s,c=!0){const h=o[ot];if(function QD(r,o,s,c){const h=Si+c,m=s.length;c>0&&(s[h-1][Zs]=o),c<m-Si?(o[Zs]=s[h],Qg(s,Si+c,o)):(s.push(o),o[Zs]=null),o[lr]=s;const y=o[zl];null!==y&&s!==y&&function eS(r,o){const s=r[kc];o[Pr]!==o[lr][lr][Pr]&&(r[Mw]=!0),null===s?r[kc]=[o]:s.push(o)}(y,o);const w=o[Ts];null!==w&&w.insertView(r),o[rn]|=128}(h,o,r,s),c){const m=ad(s,r),y=o[Wt],w=$u(y,r[Cs]);null!==w&&function JD(r,o,s,c,h,m){c[Wr]=h,c[wo]=o,ud(r,c,s,1,h,m)}(h,r[wo],y,o,w,m)}}Symbol;let ms=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=nf}return r})();function nf(){return function BT(r,o){let s;const c=o[r.index];return No(c)?s=c:(s=function Dd(r,o,s,c){return[r,!0,!1,o,null,0,c,s,null,null,null]}(c,o,null,r),o[r.index]=s,$p(o,s)),VT(s,o,r,c),new NT(s,r,o)}($i(),Oe())}const bA=ms,NT=class extends bA{constructor(o,s,c){super(),this._lContainer=o,this._hostTNode=s,this._hostLView=c}get element(){return vd(this._hostTNode,this._hostLView)}get injector(){return new st(this._hostTNode,this._hostLView)}get parentInjector(){const o=Lu(this._hostTNode,this._hostLView);if(Wg(o)){const s=Yh(o,this._hostLView),c=Xh(o);return new st(s[ot].data[c+8],s)}return new st(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const s=zT(this._lContainer);return null!==s&&s[o]||null}get length(){return this._lContainer.length-Si}createEmbeddedView(o,s,c){let h,m;"number"==typeof c?h=c:null!=c&&(h=c.index,m=c.injector);const w=o.createEmbeddedViewImpl(s||{},m,null);return this.insertImpl(w,h,false),w}createComponent(o,s,c,h,m){const y=o&&!function ed(r){return"function"==typeof r}(o);let w;if(y)w=s;else{const he=s||{};w=he.index,c=he.injector,h=he.projectableNodes,m=he.environmentInjector||he.ngModuleRef}const M=y?o:new Ad(An(o)),S=c||this.parentInjector;if(!m&&null==M.ngModule){const _e=(y?S:this.parentInjector).get(cs,null);_e&&(m=_e)}An(M.componentType??{});const Y=M.create(S,h,null,m);return this.insertImpl(Y.hostView,w,false),Y}insert(o,s){return this.insertImpl(o,s,!1)}insertImpl(o,s,c){const h=o._lView;if(function AD(r){return No(r[lr])}(h)){const M=this.indexOf(o);if(-1!==M)this.detach(M);else{const S=h[lr],O=new NT(S,S[wo],S[lr]);O.detach(O.indexOf(o))}}const y=this._adjustIndex(s),w=this._lContainer;return yA(w,h,y,!c),o.attachToViewContainerRef(),Qg(J1(w),y,o),o}move(o,s){return this.insert(o,s)}indexOf(o){const s=zT(this._lContainer);return null!==s?s.indexOf(o):-1}remove(o){const s=this._adjustIndex(o,-1),c=a_(this._lContainer,s);c&&(Ea(J1(this._lContainer),s),ne(c[ot],c))}detach(o){const s=this._adjustIndex(o,-1),c=a_(this._lContainer,s);return c&&null!=Ea(J1(this._lContainer),s)?new Zp(c):null}_adjustIndex(o,s=0){return o??this.length+s}};function zT(r){return r[8]}function J1(r){return r[8]||(r[8]=[])}let VT=function jT(r,o,s,c){if(r[Cs])return;let h;h=8&s.type?Dr(c):function wA(r,o){const s=r[Wt],c=s.createComment(""),h=Qo(o,r);return G(s,$u(s,h),c,function N2(r,o){return r.nextSibling(o)}(s,h),!1),c}(o,s),r[Cs]=h};const gb=new at("Application Initializer");let _b=(()=>{class r{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((s,c)=>{this.resolve=s,this.reject=c}),this.appInits=lt(gb,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const s=[];for(const h of this.appInits){const m=h();if(Gd(m))s.push(m);else if(Jv(m)){const y=new Promise((w,M)=>{m.subscribe({complete:w,error:M})});s.push(y)}}const c=()=>{this.done=!0,this.resolve()};Promise.all(s).then(()=>{c()}).catch(h=>{this.reject(h)}),0===s.length&&c(),this.initialized=!0}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),iC=(()=>{class r{log(s){console.log(s)}warn(s){console.warn(s)}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();const fc=new at("LocaleId",{providedIn:"root",factory:()=>lt(fc,Ht.Optional|Ht.SkipSelf)||function UA(){return typeof $localize<"u"&&$localize.locale||rh}()});let lh=(()=>{class r{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ui(!1)}add(){this.hasPendingTasks.next(!0);const s=this.taskId++;return this.pendingTasks.add(s),s}remove(s){this.pendingTasks.delete(s),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();class GA{constructor(o,s){this.ngModuleFactory=o,this.componentFactories=s}}let xb=(()=>{class r{compileModuleSync(s){return new P0(s)}compileModuleAsync(s){return Promise.resolve(this.compileModuleSync(s))}compileModuleAndAllComponentsSync(s){const c=this.compileModuleSync(s),m=Ql(bo(s).declarations).reduce((y,w)=>{const M=An(w);return M&&y.push(new Ad(M)),y},[]);return new GA(c,m)}compileModuleAndAllComponentsAsync(s){return Promise.resolve(this.compileModuleAndAllComponentsSync(s))}clearCache(){}clearCacheFor(s){}getModuleId(s){}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const x=new at(""),v=new at("");let T,b=(()=>{class r{constructor(s,c,h){this._ngZone=s,this.registry=c,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,T||(function C(r){T=r}(h),h.addToWindow(c)),this._watchAngularEvents(),s.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{hr.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let s=this._callbacks.pop();clearTimeout(s.timeoutId),s.doneCb(this._didWork)}this._didWork=!1});else{let s=this.getPendingTasks();this._callbacks=this._callbacks.filter(c=>!c.updateCb||!c.updateCb(s)||(clearTimeout(c.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(s=>({source:s.source,creationLocation:s.creationLocation,data:s.data})):[]}addCallback(s,c,h){let m=-1;c&&c>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==m),s(this._didWork,this.getPendingTasks())},c)),this._callbacks.push({doneCb:s,timeoutId:m,updateCb:h})}whenStable(s,c,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(s,c,h),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(s){this.registry.registerApplication(s,this)}unregisterApplication(s){this.registry.unregisterApplication(s)}findProviders(s,c,h){return[]}static#e=this.\u0275fac=function(c){return new(c||r)(yt(hr),yt(E),yt(v))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})(),E=(()=>{class r{constructor(){this._applications=new Map}registerApplication(s,c){this._applications.set(s,c)}unregisterApplication(s){this._applications.delete(s)}unregisterAllApplications(){this._applications.clear()}getTestability(s){return this._applications.get(s)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(s,c=!0){return T?.findTestabilityInTree(this,s,c)??null}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})(),D=null;const A=new at("AllowMultipleToken"),P=new at("PlatformDestroyListeners"),I=new at("appBootstrapListener");class z{constructor(o,s){this.name=o,this.token=s}}function Z(r,o,s=[]){const c=`Platform: ${o}`,h=new at(c);return(m=[])=>{let y=X();if(!y||y.injector.get(A,!1)){const w=[...s,...m,{provide:h,useValue:!0}];r?r(w):function j(r){if(D&&!D.get(A,!1))throw new pe(400,!1);(function L(){!function Lw(r){kw=r}(()=>{throw new pe(600,!1)})})(),D=r;const o=r.get(re);(function H(r){r.get(tE,null)?.forEach(s=>s())})(r)}(function te(r=[],o){return qi.create({name:o,providers:[{provide:nv,useValue:"platform"},{provide:P,useValue:new Set([()=>D=null])},...r]})}(w,c))}return function Q(r){const o=X();if(!o)throw new pe(401,!1);return o}()}}function X(){return D?.get(re)??null}let re=(()=>{class r{constructor(s){this._injector=s,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(s,c){const h=function ce(r="zone.js",o){return"noop"===r?new pE:"zone.js"===r?new hr(o):r}(c?.ngZone,function oe(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}({eventCoalescing:c?.ngZoneEventCoalescing,runCoalescing:c?.ngZoneRunCoalescing}));return h.run(()=>{const m=function _T(r,o,s){return new A0(r,o,s)}(s.moduleType,this.injector,function ht(r){return[{provide:hr,useFactory:r},{provide:wp,multi:!0,useFactory:()=>{const o=lt(Ve,{optional:!0});return()=>o.initialize()}},{provide:Ne,useFactory:ze},{provide:Mv,useFactory:Tv}]}(()=>h)),y=m.injector.get(Kl,null);return h.runOutsideAngular(()=>{const w=h.onError.subscribe({next:M=>{y.handleError(M)}});m.onDestroy(()=>{ue(this._modules,m),w.unsubscribe()})}),function de(r,o,s){try{const c=s();return Gd(c)?c.catch(h=>{throw o.runOutsideAngular(()=>r.handleError(h)),h}):c}catch(c){throw o.runOutsideAngular(()=>r.handleError(c)),c}}(y,h,()=>{const w=m.injector.get(_b);return w.runInitializers(),w.donePromise.then(()=>(function ih(r){yo(r,"Expected localeId to be defined"),"string"==typeof r&&(y0=r.toLowerCase().replace(/_/g,"-"))}(m.injector.get(fc,rh)||rh),this._moduleDoBootstrap(m),m))})})}bootstrapModule(s,c=[]){const h=ge({},c);return function R(r,o,s){const c=new P0(s);return Promise.resolve(c)}(0,0,s).then(m=>this.bootstrapModuleFactory(m,h))}_moduleDoBootstrap(s){const c=s.injector.get(ae);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(h=>c.bootstrap(h));else{if(!s.instance.ngDoBootstrap)throw new pe(-403,!1);s.instance.ngDoBootstrap(c)}this._modules.push(s)}onDestroy(s){this._destroyListeners.push(s)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new pe(404,!1);this._modules.slice().forEach(c=>c.destroy()),this._destroyListeners.forEach(c=>c());const s=this._injector.get(P,null);s&&(s.forEach(c=>c()),s.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(c){return new(c||r)(yt(qi))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();function ge(r,o){return Array.isArray(o)?o.reduce(ge,r):{...r,...o}}let ae=(()=>{class r{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=lt(Ne),this.zoneIsStable=lt(Mv),this.componentTypes=[],this.components=[],this.isStable=lt(lh).hasPendingTasks.pipe(ro(s=>s?Fe(!1):this.zoneIsStable),function Tf(r,o=Xa){return r=r??hw,ci((s,c)=>{let h,m=!0;s.subscribe(Ar(c,y=>{const w=o(y);(m||!r(h,w))&&(m=!1,h=w,c.next(y))}))})}(),Cn()),this._injector=lt(cs)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(s,c){const h=s instanceof sE;if(!this._injector.get(_b).done)throw!h&&function Rc(r){const o=An(r)||Di(r)||vo(r);return null!==o&&o.standalone}(s),new pe(405,!1);let y;y=h?s:this._injector.get(C_).resolveComponentFactory(s),this.componentTypes.push(y.componentType);const w=function N(r){return r.isBoundToModule}(y)?void 0:this._injector.get(au),S=y.create(qi.NULL,[],c||y.selector,w),O=S.location.nativeElement,F=S.injector.get(x,null);return F?.registerApplication(O),S.onDestroy(()=>{this.detachView(S.hostView),ue(this.components,S),F?.unregisterApplication(O)}),this._loadComponent(S),S}tick(){if(this._runningTick)throw new pe(101,!1);try{this._runningTick=!0;for(let s of this._views)s.detectChanges()}catch(s){this.internalErrorHandler(s)}finally{this._runningTick=!1}}attachView(s){const c=s;this._views.push(c),c.attachToAppRef(this)}detachView(s){const c=s;ue(this._views,c),c.detachFromAppRef()}_loadComponent(s){this.attachView(s.hostView),this.tick(),this.components.push(s);const c=this._injector.get(I,[]);c.push(...this._bootstrapListeners),c.forEach(h=>h(s))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(s=>s()),this._views.slice().forEach(s=>s.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(s){return this._destroyListeners.push(s),()=>ue(this._destroyListeners,s)}destroy(){if(this._destroyed)throw new pe(406,!1);const s=this._injector;s.destroy&&!s.destroyed&&s.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function ue(r,o){const s=r.indexOf(o);s>-1&&r.splice(s,1)}const Ne=new at("",{providedIn:"root",factory:()=>lt(Kl).handleError.bind(void 0)});function ze(){const r=lt(hr),o=lt(Kl);return s=>r.runOutsideAngular(()=>o.handleError(s))}let Ve=(()=>{class r{constructor(){this.zone=lt(hr),this.applicationRef=lt(ae)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();let Nt=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=Kt}return r})();function Kt(r){return function Rt(r,o,s){if(Lc(r)&&!s){const c=As(r.index,o);return new Zp(c,c)}return 47&r.type?new Zp(o[Pr],o):null}($i(),Oe(),16==(16&r))}const LF=Z(null,"core",[]);let FF=(()=>{class r{constructor(s){}static#e=this.\u0275fac=function(c){return new(c||r)(yt(ae))};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({})}return r})();let a3=null;function hf(){return a3}class YF{}const Va=new at("DocumentToken");let l3=(()=>{class r{historyGo(s){throw new Error("Not implemented")}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:function(){return lt(KF)},providedIn:"platform"})}return r})();const JF=new at("Location Initialized");let KF=(()=>{class r extends l3{constructor(){super(),this._doc=lt(Va),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return hf().getBaseHref(this._doc)}onPopState(s){const c=hf().getGlobalEventTarget(this._doc,"window");return c.addEventListener("popstate",s,!1),()=>c.removeEventListener("popstate",s)}onHashChange(s){const c=hf().getGlobalEventTarget(this._doc,"window");return c.addEventListener("hashchange",s,!1),()=>c.removeEventListener("hashchange",s)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(s){this._location.pathname=s}pushState(s,c,h){this._history.pushState(s,c,h)}replaceState(s,c,h){this._history.replaceState(s,c,h)}forward(){this._history.forward()}back(){this._history.back()}historyGo(s=0){this._history.go(s)}getState(){return this._history.state}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:function(){return new r},providedIn:"platform"})}return r})();function c3(r,o){if(0==r.length)return o;if(0==o.length)return r;let s=0;return r.endsWith("/")&&s++,o.startsWith("/")&&s++,2==s?r+o.substring(1):1==s?r+o:r+"/"+o}function ZR(r){const o=r.match(/#|\?|$/),s=o&&o.index||r.length;return r.slice(0,s-("/"===r[s-1]?1:0))+r.slice(s)}function dh(r){return r&&"?"!==r[0]?"?"+r:r}let km=(()=>{class r{historyGo(s){throw new Error("Not implemented")}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:function(){return lt(XR)},providedIn:"root"})}return r})();const WR=new at("appBaseHref");let XR=(()=>{class r extends km{constructor(s,c){super(),this._platformLocation=s,this._removeListenerFns=[],this._baseHref=c??this._platformLocation.getBaseHrefFromDOM()??lt(Va).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(s){this._removeListenerFns.push(this._platformLocation.onPopState(s),this._platformLocation.onHashChange(s))}getBaseHref(){return this._baseHref}prepareExternalUrl(s){return c3(this._baseHref,s)}path(s=!1){const c=this._platformLocation.pathname+dh(this._platformLocation.search),h=this._platformLocation.hash;return h&&s?`${c}${h}`:c}pushState(s,c,h,m){const y=this.prepareExternalUrl(h+dh(m));this._platformLocation.pushState(s,c,y)}replaceState(s,c,h,m){const y=this.prepareExternalUrl(h+dh(m));this._platformLocation.replaceState(s,c,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(s=0){this._platformLocation.historyGo?.(s)}static#e=this.\u0275fac=function(c){return new(c||r)(yt(l3),yt(WR,8))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),QF=(()=>{class r extends km{constructor(s,c){super(),this._platformLocation=s,this._baseHref="",this._removeListenerFns=[],null!=c&&(this._baseHref=c)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(s){this._removeListenerFns.push(this._platformLocation.onPopState(s),this._platformLocation.onHashChange(s))}getBaseHref(){return this._baseHref}path(s=!1){let c=this._platformLocation.hash;return null==c&&(c="#"),c.length>0?c.substring(1):c}prepareExternalUrl(s){const c=c3(this._baseHref,s);return c.length>0?"#"+c:c}pushState(s,c,h,m){let y=this.prepareExternalUrl(h+dh(m));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(s,c,y)}replaceState(s,c,h,m){let y=this.prepareExternalUrl(h+dh(m));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(s,c,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(s=0){this._platformLocation.historyGo?.(s)}static#e=this.\u0275fac=function(c){return new(c||r)(yt(l3),yt(WR,8))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})(),u3=(()=>{class r{constructor(s){this._subject=new si,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=s;const c=this._locationStrategy.getBaseHref();this._basePath=function n4(r){if(new RegExp("^(https?:)?//").test(r)){const[,s]=r.split(/\/\/[^\/]+/);return s}return r}(ZR(YR(c))),this._locationStrategy.onPopState(h=>{this._subject.emit({url:this.path(!0),pop:!0,state:h.state,type:h.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(s=!1){return this.normalize(this._locationStrategy.path(s))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(s,c=""){return this.path()==this.normalize(s+dh(c))}normalize(s){return r.stripTrailingSlash(function t4(r,o){if(!r||!o.startsWith(r))return o;const s=o.substring(r.length);return""===s||["/",";","?","#"].includes(s[0])?s:o}(this._basePath,YR(s)))}prepareExternalUrl(s){return s&&"/"!==s[0]&&(s="/"+s),this._locationStrategy.prepareExternalUrl(s)}go(s,c="",h=null){this._locationStrategy.pushState(h,"",s,c),this._notifyUrlChangeListeners(this.prepareExternalUrl(s+dh(c)),h)}replaceState(s,c="",h=null){this._locationStrategy.replaceState(h,"",s,c),this._notifyUrlChangeListeners(this.prepareExternalUrl(s+dh(c)),h)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(s=0){this._locationStrategy.historyGo?.(s)}onUrlChange(s){return this._urlChangeListeners.push(s),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(c=>{this._notifyUrlChangeListeners(c.url,c.state)})),()=>{const c=this._urlChangeListeners.indexOf(s);this._urlChangeListeners.splice(c,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(s="",c){this._urlChangeListeners.forEach(h=>h(s,c))}subscribe(s,c,h){return this._subject.subscribe({next:s,error:c,complete:h})}static#e=this.normalizeQueryParams=dh;static#t=this.joinWithSlash=c3;static#n=this.stripTrailingSlash=ZR;static#r=this.\u0275fac=function(c){return new(c||r)(yt(km))};static#i=this.\u0275prov=It({token:r,factory:function(){return function e4(){return new u3(yt(km))}()},providedIn:"root"})}return r})();function YR(r){return r.replace(/\/index.html$/,"")}function oO(r,o){o=encodeURIComponent(o);for(const s of r.split(";")){const c=s.indexOf("="),[h,m]=-1==c?[s,""]:[s.slice(0,c),s.slice(c+1)];if(h.trim()===o)return decodeURIComponent(m)}return null}let gN=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({})}return r})();function fO(r){return"server"===r}let vN=(()=>{class r{static#e=this.\u0275prov=It({token:r,providedIn:"root",factory:()=>new bN(yt(Va),window)})}return r})();class bN{constructor(o,s){this.document=o,this.window=s,this.offset=()=>[0,0]}setOffset(o){this.offset=Array.isArray(o)?()=>o:o}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(o){this.supportsScrolling()&&this.window.scrollTo(o[0],o[1])}scrollToAnchor(o){if(!this.supportsScrolling())return;const s=function wN(r,o){const s=r.getElementById(o)||r.getElementsByName(o)[0];if(s)return s;if("function"==typeof r.createTreeWalker&&r.body&&"function"==typeof r.body.attachShadow){const c=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT);let h=c.currentNode;for(;h;){const m=h.shadowRoot;if(m){const y=m.getElementById(o)||m.querySelector(`[name="${o}"]`);if(y)return y}h=c.nextNode()}}return null}(this.document,o);s&&(this.scrollToElement(s),s.focus())}setHistoryScrollRestoration(o){this.supportsScrolling()&&(this.window.history.scrollRestoration=o)}scrollToElement(o){const s=o.getBoundingClientRect(),c=s.left+this.window.pageXOffset,h=s.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(c-m[0],h-m[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class pO{}class GN extends YF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class D3 extends GN{static makeCurrent(){!function XF(r){a3||(a3=r)}(new D3)}onAndCancel(o,s,c){return o.addEventListener(s,c),()=>{o.removeEventListener(s,c)}}dispatchEvent(o,s){o.dispatchEvent(s)}remove(o){o.parentNode&&o.parentNode.removeChild(o)}createElement(o,s){return(s=s||this.getDefaultDocument()).createElement(o)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(o){return o.nodeType===Node.ELEMENT_NODE}isShadowRoot(o){return o instanceof DocumentFragment}getGlobalEventTarget(o,s){return"window"===s?window:"document"===s?o:"body"===s?o.body:null}getBaseHref(o){const s=function qN(){return Ab=Ab||document.querySelector("base"),Ab?Ab.getAttribute("href"):null}();return null==s?null:function ZN(r){wC=wC||document.createElement("a"),wC.setAttribute("href",r);const o=wC.pathname;return"/"===o.charAt(0)?o:`/${o}`}(s)}resetBaseElement(){Ab=null}getUserAgent(){return window.navigator.userAgent}getCookie(o){return oO(document.cookie,o)}}let wC,Ab=null,XN=(()=>{class r{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();const S3=new at("EventManagerPlugins");let xO=(()=>{class r{constructor(s,c){this._zone=c,this._eventNameToPlugin=new Map,s.forEach(h=>{h.manager=this}),this._plugins=s.slice().reverse()}addEventListener(s,c,h){return this._findPluginFor(c).addEventListener(s,c,h)}getZone(){return this._zone}_findPluginFor(s){let c=this._eventNameToPlugin.get(s);if(c)return c;if(c=this._plugins.find(m=>m.supports(s)),!c)throw new pe(5101,!1);return this._eventNameToPlugin.set(s,c),c}static#e=this.\u0275fac=function(c){return new(c||r)(yt(S3),yt(hr))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();class vO{constructor(o){this._doc=o}}const I3="ng-app-id";let bO=(()=>{class r{constructor(s,c,h,m={}){this.doc=s,this.appId=c,this.nonce=h,this.platformId=m,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=fO(m),this.resetHostNodes()}addStyles(s){for(const c of s)1===this.changeUsageCount(c,1)&&this.onStyleAdded(c)}removeStyles(s){for(const c of s)this.changeUsageCount(c,-1)<=0&&this.onStyleRemoved(c)}ngOnDestroy(){const s=this.styleNodesInDOM;s&&(s.forEach(c=>c.remove()),s.clear());for(const c of this.getAllStyles())this.onStyleRemoved(c);this.resetHostNodes()}addHost(s){this.hostNodes.add(s);for(const c of this.getAllStyles())this.addStyleToHost(s,c)}removeHost(s){this.hostNodes.delete(s)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(s){for(const c of this.hostNodes)this.addStyleToHost(c,s)}onStyleRemoved(s){const c=this.styleRef;c.get(s)?.elements?.forEach(h=>h.remove()),c.delete(s)}collectServerRenderedStyles(){const s=this.doc.head?.querySelectorAll(`style[${I3}="${this.appId}"]`);if(s?.length){const c=new Map;return s.forEach(h=>{null!=h.textContent&&c.set(h.textContent,h)}),c}return null}changeUsageCount(s,c){const h=this.styleRef;if(h.has(s)){const m=h.get(s);return m.usage+=c,m.usage}return h.set(s,{usage:c,elements:[]}),c}getStyleElement(s,c){const h=this.styleNodesInDOM,m=h?.get(c);if(m?.parentNode===s)return h.delete(c),m.removeAttribute(I3),m;{const y=this.doc.createElement("style");return this.nonce&&y.setAttribute("nonce",this.nonce),y.textContent=c,this.platformIsServer&&y.setAttribute(I3,this.appId),y}}addStyleToHost(s,c){const h=this.getStyleElement(s,c);s.appendChild(h);const m=this.styleRef,y=m.get(c)?.elements;y?y.push(h):m.set(c,{elements:[h],usage:1})}resetHostNodes(){const s=this.hostNodes;s.clear(),s.add(this.doc.head)}static#e=this.\u0275fac=function(c){return new(c||r)(yt(Va),yt(Dp),yt(nE,8),yt(ml))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();const A3={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},P3=/%COMP%/g,QN=new at("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function EO(r,o){return o.map(s=>s.replace(P3,r))}let MO=(()=>{class r{constructor(s,c,h,m,y,w,M,S=null){this.eventManager=s,this.sharedStylesHost=c,this.appId=h,this.removeStylesOnCompDestroy=m,this.doc=y,this.platformId=w,this.ngZone=M,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=fO(w),this.defaultRenderer=new R3(s,y,M,this.platformIsServer)}createRenderer(s,c){if(!s||!c)return this.defaultRenderer;this.platformIsServer&&c.encapsulation===Lo.ShadowDom&&(c={...c,encapsulation:Lo.Emulated});const h=this.getOrCreateRenderer(s,c);return h instanceof CO?h.applyToHost(s):h instanceof O3&&h.applyStyles(),h}getOrCreateRenderer(s,c){const h=this.rendererByCompId;let m=h.get(c.id);if(!m){const y=this.doc,w=this.ngZone,M=this.eventManager,S=this.sharedStylesHost,O=this.removeStylesOnCompDestroy,F=this.platformIsServer;switch(c.encapsulation){case Lo.Emulated:m=new CO(M,S,c,this.appId,O,y,w,F);break;case Lo.ShadowDom:return new r5(M,S,s,c,y,w,this.nonce,F);default:m=new O3(M,S,c,O,y,w,F)}h.set(c.id,m)}return m}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(c){return new(c||r)(yt(xO),yt(bO),yt(Dp),yt(QN),yt(Va),yt(ml),yt(hr),yt(nE))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();class R3{constructor(o,s,c,h){this.eventManager=o,this.doc=s,this.ngZone=c,this.platformIsServer=h,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(o,s){return s?this.doc.createElementNS(A3[s]||s,o):this.doc.createElement(o)}createComment(o){return this.doc.createComment(o)}createText(o){return this.doc.createTextNode(o)}appendChild(o,s){(TO(o)?o.content:o).appendChild(s)}insertBefore(o,s,c){o&&(TO(o)?o.content:o).insertBefore(s,c)}removeChild(o,s){o&&o.removeChild(s)}selectRootElement(o,s){let c="string"==typeof o?this.doc.querySelector(o):o;if(!c)throw new pe(-5104,!1);return s||(c.textContent=""),c}parentNode(o){return o.parentNode}nextSibling(o){return o.nextSibling}setAttribute(o,s,c,h){if(h){s=h+":"+s;const m=A3[h];m?o.setAttributeNS(m,s,c):o.setAttribute(s,c)}else o.setAttribute(s,c)}removeAttribute(o,s,c){if(c){const h=A3[c];h?o.removeAttributeNS(h,s):o.removeAttribute(`${c}:${s}`)}else o.removeAttribute(s)}addClass(o,s){o.classList.add(s)}removeClass(o,s){o.classList.remove(s)}setStyle(o,s,c,h){h&(Hl.DashCase|Hl.Important)?o.style.setProperty(s,c,h&Hl.Important?"important":""):o.style[s]=c}removeStyle(o,s,c){c&Hl.DashCase?o.style.removeProperty(s):o.style[s]=""}setProperty(o,s,c){o[s]=c}setValue(o,s){o.nodeValue=s}listen(o,s,c){if("string"==typeof o&&!(o=hf().getGlobalEventTarget(this.doc,o)))throw new Error(`Unsupported event target ${o} for event ${s}`);return this.eventManager.addEventListener(o,s,this.decoratePreventDefault(c))}decoratePreventDefault(o){return s=>{if("__ngUnwrap__"===s)return o;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>o(s)):o(s))&&s.preventDefault()}}}function TO(r){return"TEMPLATE"===r.tagName&&void 0!==r.content}class r5 extends R3{constructor(o,s,c,h,m,y,w,M){super(o,m,y,M),this.sharedStylesHost=s,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=EO(h.id,h.styles);for(const O of S){const F=document.createElement("style");w&&F.setAttribute("nonce",w),F.textContent=O,this.shadowRoot.appendChild(F)}}nodeOrShadowRoot(o){return o===this.hostEl?this.shadowRoot:o}appendChild(o,s){return super.appendChild(this.nodeOrShadowRoot(o),s)}insertBefore(o,s,c){return super.insertBefore(this.nodeOrShadowRoot(o),s,c)}removeChild(o,s){return super.removeChild(this.nodeOrShadowRoot(o),s)}parentNode(o){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(o)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class O3 extends R3{constructor(o,s,c,h,m,y,w,M){super(o,m,y,w),this.sharedStylesHost=s,this.removeStylesOnCompDestroy=h,this.styles=M?EO(M,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class CO extends O3{constructor(o,s,c,h,m,y,w,M){const S=h+"-"+c.id;super(o,s,c,m,y,w,M,S),this.contentAttr=function e5(r){return"_ngcontent-%COMP%".replace(P3,r)}(S),this.hostAttr=function t5(r){return"_nghost-%COMP%".replace(P3,r)}(S)}applyToHost(o){this.applyStyles(),this.setAttribute(o,this.hostAttr,"")}createElement(o,s){const c=super.createElement(o,s);return super.setAttribute(c,this.contentAttr,""),c}}let i5=(()=>{class r extends vO{constructor(s){super(s)}supports(s){return!0}addEventListener(s,c,h){return s.addEventListener(c,h,!1),()=>this.removeEventListener(s,c,h)}removeEventListener(s,c,h){return s.removeEventListener(c,h)}static#e=this.\u0275fac=function(c){return new(c||r)(yt(Va))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();const DO=["alt","control","meta","shift"],o5={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},s5={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey};let a5=(()=>{class r extends vO{constructor(s){super(s)}supports(s){return null!=r.parseEventName(s)}addEventListener(s,c,h){const m=r.parseEventName(c),y=r.eventCallback(m.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>hf().onAndCancel(s,m.domEventName,y))}static parseEventName(s){const c=s.toLowerCase().split("."),h=c.shift();if(0===c.length||"keydown"!==h&&"keyup"!==h)return null;const m=r._normalizeKey(c.pop());let y="",w=c.indexOf("code");if(w>-1&&(c.splice(w,1),y="code."),DO.forEach(S=>{const O=c.indexOf(S);O>-1&&(c.splice(O,1),y+=S+".")}),y+=m,0!=c.length||0===m.length)return null;const M={};return M.domEventName=h,M.fullKey=y,M}static matchEventFullKeyCode(s,c){let h=o5[s.key]||s.key,m="";return c.indexOf("code.")>-1&&(h=s.code,m="code."),!(null==h||!h)&&(h=h.toLowerCase()," "===h?h="space":"."===h&&(h="dot"),DO.forEach(y=>{y!==h&&(0,s5[y])(s)&&(m+=y+".")}),m+=h,m===c)}static eventCallback(s,c,h){return m=>{r.matchEventFullKeyCode(m,s)&&h.runGuarded(()=>c(m))}}static _normalizeKey(s){return"esc"===s?"escape":s}static#e=this.\u0275fac=function(c){return new(c||r)(yt(Va))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();const h5=Z(LF,"browser",[{provide:ml,useValue:"browser"},{provide:tE,useValue:function l5(){D3.makeCurrent()},multi:!0},{provide:Va,useFactory:function u5(){return function Ux(r){jx=r}(document),document},deps:[]}]),d5=new at(""),AO=[{provide:v,useClass:class WN{addToWindow(o){xr.getAngularTestability=(c,h=!0)=>{const m=o.findTestabilityInTree(c,h);if(null==m)throw new pe(5103,!1);return m},xr.getAllAngularTestabilities=()=>o.getAllTestabilities(),xr.getAllAngularRootElements=()=>o.getAllRootElements(),xr.frameworkStabilizers||(xr.frameworkStabilizers=[]),xr.frameworkStabilizers.push(c=>{const h=xr.getAllAngularTestabilities();let m=h.length,y=!1;const w=function(M){y=y||M,m--,0==m&&c(y)};h.forEach(M=>{M.whenStable(w)})})}findTestabilityInTree(o,s,c){return null==s?null:o.getTestability(s)??(c?hf().isShadowRoot(s)?this.findTestabilityInTree(o,s.host,!0):this.findTestabilityInTree(o,s.parentElement,!0):null)}},deps:[]},{provide:x,useClass:b,deps:[hr,E,v]},{provide:b,useClass:b,deps:[hr,E,v]}],PO=[{provide:nv,useValue:"root"},{provide:Kl,useFactory:function c5(){return new Kl},deps:[]},{provide:S3,useClass:i5,multi:!0,deps:[Va,hr,ml]},{provide:S3,useClass:a5,multi:!0,deps:[Va]},MO,bO,xO,{provide:lE,useExisting:MO},{provide:pO,useClass:XN,deps:[]},[]];let f5=(()=>{class r{constructor(s){}static withServerTransition(s){return{ngModule:r,providers:[{provide:Dp,useValue:s.appId}]}}static#e=this.\u0275fac=function(c){return new(c||r)(yt(d5,12))};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({providers:[...PO,...AO],imports:[gN,FF]})}return r})(),RO=(()=>{class r{constructor(s){this._doc=s}getTitle(){return this._doc.title}setTitle(s){this._doc.title=s||""}static#e=this.\u0275fac=function(c){return new(c||r)(yt(Va))};static#t=this.\u0275prov=It({token:r,factory:function(c){let h=null;return h=c?new c:function m5(){return new RO(yt(Va))}(),h},providedIn:"root"})}return r})();function ry(r,o){return sr(o)?ni(r,o,1):ni(r,1)}function mh(r,o){return ci((s,c)=>{let h=0;s.subscribe(Ar(c,m=>r.call(o,m,h++)&&c.next(m)))})}function Pb(r){return ci((o,s)=>{try{o.subscribe(s)}finally{s.add(r)}})}typeof window<"u"&&window;class EC{}class MC{}class hu{constructor(o){this.normalizedNames=new Map,this.lazyUpdate=null,o?"string"==typeof o?this.lazyInit=()=>{this.headers=new Map,o.split("\n").forEach(s=>{const c=s.indexOf(":");if(c>0){const h=s.slice(0,c),m=h.toLowerCase(),y=s.slice(c+1).trim();this.maybeSetNormalizedName(h,m),this.headers.has(m)?this.headers.get(m).push(y):this.headers.set(m,[y])}})}:typeof Headers<"u"&&o instanceof Headers?(this.headers=new Map,o.forEach((s,c)=>{this.setHeaderEntries(c,s)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(o).forEach(([s,c])=>{this.setHeaderEntries(s,c)})}:this.headers=new Map}has(o){return this.init(),this.headers.has(o.toLowerCase())}get(o){this.init();const s=this.headers.get(o.toLowerCase());return s&&s.length>0?s[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(o){return this.init(),this.headers.get(o.toLowerCase())||null}append(o,s){return this.clone({name:o,value:s,op:"a"})}set(o,s){return this.clone({name:o,value:s,op:"s"})}delete(o,s){return this.clone({name:o,value:s,op:"d"})}maybeSetNormalizedName(o,s){this.normalizedNames.has(s)||this.normalizedNames.set(s,o)}init(){this.lazyInit&&(this.lazyInit instanceof hu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(o=>this.applyUpdate(o)),this.lazyUpdate=null))}copyFrom(o){o.init(),Array.from(o.headers.keys()).forEach(s=>{this.headers.set(s,o.headers.get(s)),this.normalizedNames.set(s,o.normalizedNames.get(s))})}clone(o){const s=new hu;return s.lazyInit=this.lazyInit&&this.lazyInit instanceof hu?this.lazyInit:this,s.lazyUpdate=(this.lazyUpdate||[]).concat([o]),s}applyUpdate(o){const s=o.name.toLowerCase();switch(o.op){case"a":case"s":let c=o.value;if("string"==typeof c&&(c=[c]),0===c.length)return;this.maybeSetNormalizedName(o.name,s);const h=("a"===o.op?this.headers.get(s):void 0)||[];h.push(...c),this.headers.set(s,h);break;case"d":const m=o.value;if(m){let y=this.headers.get(s);if(!y)return;y=y.filter(w=>-1===m.indexOf(w)),0===y.length?(this.headers.delete(s),this.normalizedNames.delete(s)):this.headers.set(s,y)}else this.headers.delete(s),this.normalizedNames.delete(s)}}setHeaderEntries(o,s){const c=(Array.isArray(s)?s:[s]).map(m=>m.toString()),h=o.toLowerCase();this.headers.set(h,c),this.maybeSetNormalizedName(o,h)}forEach(o){this.init(),Array.from(this.normalizedNames.keys()).forEach(s=>o(this.normalizedNames.get(s),this.headers.get(s)))}}class v5{encodeKey(o){return FO(o)}encodeValue(o){return FO(o)}decodeKey(o){return decodeURIComponent(o)}decodeValue(o){return decodeURIComponent(o)}}const w5=/%(\d[a-f0-9])/gi,E5={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function FO(r){return encodeURIComponent(r).replace(w5,(o,s)=>E5[s]??o)}function TC(r){return`${r}`}class ff{constructor(o={}){if(this.updates=null,this.cloneFrom=null,this.encoder=o.encoder||new v5,o.fromString){if(o.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function b5(r,o){const s=new Map;return r.length>0&&r.replace(/^\?/,"").split("&").forEach(h=>{const m=h.indexOf("="),[y,w]=-1==m?[o.decodeKey(h),""]:[o.decodeKey(h.slice(0,m)),o.decodeValue(h.slice(m+1))],M=s.get(y)||[];M.push(w),s.set(y,M)}),s}(o.fromString,this.encoder)}else o.fromObject?(this.map=new Map,Object.keys(o.fromObject).forEach(s=>{const c=o.fromObject[s],h=Array.isArray(c)?c.map(TC):[TC(c)];this.map.set(s,h)})):this.map=null}has(o){return this.init(),this.map.has(o)}get(o){this.init();const s=this.map.get(o);return s?s[0]:null}getAll(o){return this.init(),this.map.get(o)||null}keys(){return this.init(),Array.from(this.map.keys())}append(o,s){return this.clone({param:o,value:s,op:"a"})}appendAll(o){const s=[];return Object.keys(o).forEach(c=>{const h=o[c];Array.isArray(h)?h.forEach(m=>{s.push({param:c,value:m,op:"a"})}):s.push({param:c,value:h,op:"a"})}),this.clone(s)}set(o,s){return this.clone({param:o,value:s,op:"s"})}delete(o,s){return this.clone({param:o,value:s,op:"d"})}toString(){return this.init(),this.keys().map(o=>{const s=this.encoder.encodeKey(o);return this.map.get(o).map(c=>s+"="+this.encoder.encodeValue(c)).join("&")}).filter(o=>""!==o).join("&")}clone(o){const s=new ff({encoder:this.encoder});return s.cloneFrom=this.cloneFrom||this,s.updates=(this.updates||[]).concat(o),s}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(o=>this.map.set(o,this.cloneFrom.map.get(o))),this.updates.forEach(o=>{switch(o.op){case"a":case"s":const s=("a"===o.op?this.map.get(o.param):void 0)||[];s.push(TC(o.value)),this.map.set(o.param,s);break;case"d":if(void 0===o.value){this.map.delete(o.param);break}{let c=this.map.get(o.param)||[];const h=c.indexOf(TC(o.value));-1!==h&&c.splice(h,1),c.length>0?this.map.set(o.param,c):this.map.delete(o.param)}}}),this.cloneFrom=this.updates=null)}}class M5{constructor(){this.map=new Map}set(o,s){return this.map.set(o,s),this}get(o){return this.map.has(o)||this.map.set(o,o.defaultValue()),this.map.get(o)}delete(o){return this.map.delete(o),this}has(o){return this.map.has(o)}keys(){return this.map.keys()}}function NO(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer}function zO(r){return typeof Blob<"u"&&r instanceof Blob}function BO(r){return typeof FormData<"u"&&r instanceof FormData}class Rb{constructor(o,s,c,h){let m;if(this.url=s,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=o.toUpperCase(),function T5(r){switch(r){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||h?(this.body=void 0!==c?c:null,m=h):m=c,m&&(this.reportProgress=!!m.reportProgress,this.withCredentials=!!m.withCredentials,m.responseType&&(this.responseType=m.responseType),m.headers&&(this.headers=m.headers),m.context&&(this.context=m.context),m.params&&(this.params=m.params)),this.headers||(this.headers=new hu),this.context||(this.context=new M5),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=s;else{const w=s.indexOf("?");this.urlWithParams=s+(-1===w?"?":w<s.length-1?"&":"")+y}}else this.params=new ff,this.urlWithParams=s}serializeBody(){return null===this.body?null:NO(this.body)||zO(this.body)||BO(this.body)||function C5(r){return typeof URLSearchParams<"u"&&r instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof ff?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||BO(this.body)?null:zO(this.body)?this.body.type||null:NO(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ff?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(o={}){const s=o.method||this.method,c=o.url||this.url,h=o.responseType||this.responseType,m=void 0!==o.body?o.body:this.body,y=void 0!==o.withCredentials?o.withCredentials:this.withCredentials,w=void 0!==o.reportProgress?o.reportProgress:this.reportProgress;let M=o.headers||this.headers,S=o.params||this.params;const O=o.context??this.context;return void 0!==o.setHeaders&&(M=Object.keys(o.setHeaders).reduce((F,$)=>F.set($,o.setHeaders[$]),M)),o.setParams&&(S=Object.keys(o.setParams).reduce((F,$)=>F.set($,o.setParams[$]),S)),new Rb(s,c,m,{params:S,headers:M,context:O,reportProgress:w,responseType:h,withCredentials:y})}}var iy=function(r){return r[r.Sent=0]="Sent",r[r.UploadProgress=1]="UploadProgress",r[r.ResponseHeader=2]="ResponseHeader",r[r.DownloadProgress=3]="DownloadProgress",r[r.Response=4]="Response",r[r.User=5]="User",r}(iy||{});class L3{constructor(o,s=200,c="OK"){this.headers=o.headers||new hu,this.status=void 0!==o.status?o.status:s,this.statusText=o.statusText||c,this.url=o.url||null,this.ok=this.status>=200&&this.status<300}}class F3 extends L3{constructor(o={}){super(o),this.type=iy.ResponseHeader}clone(o={}){return new F3({headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class oy extends L3{constructor(o={}){super(o),this.type=iy.Response,this.body=void 0!==o.body?o.body:null}clone(o={}){return new oy({body:void 0!==o.body?o.body:this.body,headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class VO extends L3{constructor(o){super(o,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${o.url||"(unknown url)"}`:`Http failure response for ${o.url||"(unknown url)"}: ${o.status} ${o.statusText}`,this.error=o.error||null}}function N3(r,o){return{body:o,headers:r.headers,context:r.context,observe:r.observe,params:r.params,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials}}let jO=(()=>{class r{constructor(s){this.handler=s}request(s,c,h={}){let m;if(s instanceof Rb)m=s;else{let M,S;M=h.headers instanceof hu?h.headers:new hu(h.headers),h.params&&(S=h.params instanceof ff?h.params:new ff({fromObject:h.params})),m=new Rb(s,c,void 0!==h.body?h.body:null,{headers:M,context:h.context,params:S,reportProgress:h.reportProgress,responseType:h.responseType||"json",withCredentials:h.withCredentials})}const y=Fe(m).pipe(ry(M=>this.handler.handle(M)));if(s instanceof Rb||"events"===h.observe)return y;const w=y.pipe(mh(M=>M instanceof oy));switch(h.observe||"body"){case"body":switch(m.responseType){case"arraybuffer":return w.pipe(On(M=>{if(null!==M.body&&!(M.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return M.body}));case"blob":return w.pipe(On(M=>{if(null!==M.body&&!(M.body instanceof Blob))throw new Error("Response is not a Blob.");return M.body}));case"text":return w.pipe(On(M=>{if(null!==M.body&&"string"!=typeof M.body)throw new Error("Response is not a string.");return M.body}));default:return w.pipe(On(M=>M.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${h.observe}}`)}}delete(s,c={}){return this.request("DELETE",s,c)}get(s,c={}){return this.request("GET",s,c)}head(s,c={}){return this.request("HEAD",s,c)}jsonp(s,c){return this.request("JSONP",s,{params:(new ff).append(c,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(s,c={}){return this.request("OPTIONS",s,c)}patch(s,c,h={}){return this.request("PATCH",s,N3(h,c))}post(s,c,h={}){return this.request("POST",s,N3(h,c))}put(s,c,h={}){return this.request("PUT",s,N3(h,c))}static#e=this.\u0275fac=function(c){return new(c||r)(yt(EC))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();function HO(r,o){return o(r)}function S5(r,o){return(s,c)=>o.intercept(s,{handle:h=>r(h,c)})}const A5=new at(""),Ob=new at(""),GO=new at("");function P5(){let r=null;return(o,s)=>{null===r&&(r=(lt(A5,{optional:!0})??[]).reduceRight(S5,HO));const c=lt(lh),h=c.add();return r(o,s).pipe(Pb(()=>c.remove(h)))}}let qO=(()=>{class r extends EC{constructor(s,c){super(),this.backend=s,this.injector=c,this.chain=null,this.pendingTasks=lt(lh)}handle(s){if(null===this.chain){const h=Array.from(new Set([...this.injector.get(Ob),...this.injector.get(GO,[])]));this.chain=h.reduceRight((m,y)=>function I5(r,o,s){return(c,h)=>s.runInContext(()=>o(c,m=>r(m,h)))}(m,y,this.injector),HO)}const c=this.pendingTasks.add();return this.chain(s,h=>this.backend.handle(h)).pipe(Pb(()=>this.pendingTasks.remove(c)))}static#e=this.\u0275fac=function(c){return new(c||r)(yt(MC),yt(cs))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();const L5=/^\)\]\}',?\n/;let WO=(()=>{class r{constructor(s){this.xhrFactory=s}handle(s){if("JSONP"===s.method)throw new pe(-2800,!1);const c=this.xhrFactory;return(c.\u0275loadImpl?hi(c.\u0275loadImpl()):Fe(null)).pipe(ro(()=>new Un(m=>{const y=c.build();if(y.open(s.method,s.urlWithParams),s.withCredentials&&(y.withCredentials=!0),s.headers.forEach((he,_e)=>y.setRequestHeader(he,_e.join(","))),s.headers.has("Accept")||y.setRequestHeader("Accept","application/json, text/plain, */*"),!s.headers.has("Content-Type")){const he=s.detectContentTypeHeader();null!==he&&y.setRequestHeader("Content-Type",he)}if(s.responseType){const he=s.responseType.toLowerCase();y.responseType="json"!==he?he:"text"}const w=s.serializeBody();let M=null;const S=()=>{if(null!==M)return M;const he=y.statusText||"OK",_e=new hu(y.getAllResponseHeaders()),be=function F5(r){return"responseURL"in r&&r.responseURL?r.responseURL:/^X-Request-URL:/m.test(r.getAllResponseHeaders())?r.getResponseHeader("X-Request-URL"):null}(y)||s.url;return M=new F3({headers:_e,status:y.status,statusText:he,url:be}),M},O=()=>{let{headers:he,status:_e,statusText:be,url:me}=S(),Ue=null;204!==_e&&(Ue=typeof y.response>"u"?y.responseText:y.response),0===_e&&(_e=Ue?200:0);let Qe=_e>=200&&_e<300;if("json"===s.responseType&&"string"==typeof Ue){const dt=Ue;Ue=Ue.replace(L5,"");try{Ue=""!==Ue?JSON.parse(Ue):null}catch(ft){Ue=dt,Qe&&(Qe=!1,Ue={error:ft,text:Ue})}}Qe?(m.next(new oy({body:Ue,headers:he,status:_e,statusText:be,url:me||void 0})),m.complete()):m.error(new VO({error:Ue,headers:he,status:_e,statusText:be,url:me||void 0}))},F=he=>{const{url:_e}=S(),be=new VO({error:he,status:y.status||0,statusText:y.statusText||"Unknown Error",url:_e||void 0});m.error(be)};let $=!1;const Y=he=>{$||(m.next(S()),$=!0);let _e={type:iy.DownloadProgress,loaded:he.loaded};he.lengthComputable&&(_e.total=he.total),"text"===s.responseType&&y.responseText&&(_e.partialText=y.responseText),m.next(_e)},se=he=>{let _e={type:iy.UploadProgress,loaded:he.loaded};he.lengthComputable&&(_e.total=he.total),m.next(_e)};return y.addEventListener("load",O),y.addEventListener("error",F),y.addEventListener("timeout",F),y.addEventListener("abort",F),s.reportProgress&&(y.addEventListener("progress",Y),null!==w&&y.upload&&y.upload.addEventListener("progress",se)),y.send(w),m.next({type:iy.Sent}),()=>{y.removeEventListener("error",F),y.removeEventListener("abort",F),y.removeEventListener("load",O),y.removeEventListener("timeout",F),s.reportProgress&&(y.removeEventListener("progress",Y),null!==w&&y.upload&&y.upload.removeEventListener("progress",se)),y.readyState!==y.DONE&&y.abort()}})))}static#e=this.\u0275fac=function(c){return new(c||r)(yt(pO))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();const z3=new at("XSRF_ENABLED"),XO=new at("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),YO=new at("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class JO{}let B5=(()=>{class r{constructor(s,c,h){this.doc=s,this.platform=c,this.cookieName=h,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const s=this.doc.cookie||"";return s!==this.lastCookieString&&(this.parseCount++,this.lastToken=oO(s,this.cookieName),this.lastCookieString=s),this.lastToken}static#e=this.\u0275fac=function(c){return new(c||r)(yt(Va),yt(ml),yt(XO))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();function V5(r,o){const s=r.url.toLowerCase();if(!lt(z3)||"GET"===r.method||"HEAD"===r.method||s.startsWith("http://")||s.startsWith("https://"))return o(r);const c=lt(JO).getToken(),h=lt(YO);return null!=c&&!r.headers.has(h)&&(r=r.clone({headers:r.headers.set(h,c)})),o(r)}var pf=function(r){return r[r.Interceptors=0]="Interceptors",r[r.LegacyInterceptors=1]="LegacyInterceptors",r[r.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",r[r.NoXsrfProtection=3]="NoXsrfProtection",r[r.JsonpSupport=4]="JsonpSupport",r[r.RequestsMadeViaParent=5]="RequestsMadeViaParent",r[r.Fetch=6]="Fetch",r}(pf||{});function j5(...r){const o=[jO,WO,qO,{provide:EC,useExisting:qO},{provide:MC,useExisting:WO},{provide:Ob,useValue:V5,multi:!0},{provide:z3,useValue:!0},{provide:JO,useClass:B5}];for(const s of r)o.push(...s.\u0275providers);return function Jx(r){return{\u0275providers:r}}(o)}const KO=new at("LEGACY_INTERCEPTOR_FN");function U5(){return function Lm(r,o){return{\u0275kind:r,\u0275providers:o}}(pf.LegacyInterceptors,[{provide:KO,useFactory:P5},{provide:Ob,useExisting:KO,multi:!0}])}let $5=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({providers:[j5(U5())]})}return r})();const{isArray:X5}=Array,{getPrototypeOf:Y5,prototype:J5,keys:K5}=Object;function QO(r){if(1===r.length){const o=r[0];if(X5(o))return{args:o,keys:null};if(function Q5(r){return r&&"object"==typeof r&&Y5(r)===J5}(o)){const s=K5(o);return{args:s.map(c=>o[c]),keys:s}}}return{args:r,keys:null}}const{isArray:ez}=Array;function ek(r){return On(o=>function tz(r,o){return ez(o)?r(...o):r(o)}(r,o))}function tk(r,o){return r.reduce((s,c,h)=>(s[c]=o[h],s),{})}let nk=(()=>{class r{constructor(s,c){this._renderer=s,this._elementRef=c,this.onChange=h=>{},this.onTouched=()=>{}}setProperty(s,c){this._renderer.setProperty(this._elementRef.nativeElement,s,c)}registerOnTouched(s){this.onTouched=s}registerOnChange(s){this.onChange=s}setDisabledState(s){this.setProperty("disabled",s)}static#e=this.\u0275fac=function(c){return new(c||r)(je(Jl),je(us))};static#t=this.\u0275dir=jt({type:r})}return r})(),Fm=(()=>{class r extends nk{static#e=this.\u0275fac=function(){let s;return function(h){return(s||(s=ii(r)))(h||r)}}();static#t=this.\u0275dir=jt({type:r,features:[Jn]})}return r})();const du=new at("NgValueAccessor"),iz={provide:du,useExisting:ar(()=>B3),multi:!0},sz=new at("CompositionEventMode");let B3=(()=>{class r extends nk{constructor(s,c,h){super(s,c),this._compositionMode=h,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function oz(){const r=hf()?hf().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}())}writeValue(s){this.setProperty("value",s??"")}_handleInput(s){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(s)}_compositionStart(){this._composing=!0}_compositionEnd(s){this._composing=!1,this._compositionMode&&this.onChange(s)}static#e=this.\u0275fac=function(c){return new(c||r)(je(Jl),je(us),je(sz,8))};static#t=this.\u0275dir=jt({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(c,h){1&c&&Uo("input",function(y){return h._handleInput(y.target.value)})("blur",function(){return h.onTouched()})("compositionstart",function(){return h._compositionStart()})("compositionend",function(y){return h._compositionEnd(y.target.value)})},features:[Br([iz]),Jn]})}return r})();const gs=new at("NgValidators"),gf=new at("NgAsyncValidators");function fk(r){return null!=r}function pk(r){return Gd(r)?hi(r):r}function mk(r){let o={};return r.forEach(s=>{o=null!=s?{...o,...s}:o}),0===Object.keys(o).length?null:o}function gk(r,o){return o.map(s=>s(r))}function _k(r){return r.map(o=>function lz(r){return!r.validate}(o)?o:s=>o.validate(s))}function V3(r){return null!=r?function yk(r){if(!r)return null;const o=r.filter(fk);return 0==o.length?null:function(s){return mk(gk(s,o))}}(_k(r)):null}function j3(r){return null!=r?function xk(r){if(!r)return null;const o=r.filter(fk);return 0==o.length?null:function(s){return function nz(...r){const o=aw(r),{args:s,keys:c}=QO(r),h=new Un(m=>{const{length:y}=s;if(!y)return void m.complete();const w=new Array(y);let M=y,S=y;for(let O=0;O<y;O++){let F=!1;fn(s[O]).subscribe(Ar(m,$=>{F||(F=!0,S--),w[O]=$},()=>M--,void 0,()=>{(!M||!F)&&(S||m.next(c?tk(c,w):w),m.complete())}))}});return o?h.pipe(ek(o)):h}(gk(s,o).map(pk)).pipe(On(mk))}}(_k(r)):null}function vk(r,o){return null===r?[o]:Array.isArray(r)?[...r,o]:[r,o]}function U3(r){return r?Array.isArray(r)?r:[r]:[]}function SC(r,o){return Array.isArray(r)?r.includes(o):r===o}function Ek(r,o){const s=U3(o);return U3(r).forEach(h=>{SC(s,h)||s.push(h)}),s}function Mk(r,o){return U3(o).filter(s=>!SC(r,s))}class Tk{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(o){this._rawValidators=o||[],this._composedValidatorFn=V3(this._rawValidators)}_setAsyncValidators(o){this._rawAsyncValidators=o||[],this._composedAsyncValidatorFn=j3(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(o){this._onDestroyCallbacks.push(o)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(o=>o()),this._onDestroyCallbacks=[]}reset(o=void 0){this.control&&this.control.reset(o)}hasError(o,s){return!!this.control&&this.control.hasError(o,s)}getError(o,s){return this.control?this.control.getError(o,s):null}}class js extends Tk{get formDirective(){return null}get path(){return null}}class _f extends Tk{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Ck{constructor(o){this._cd=o}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Dk=(()=>{class r extends Ck{constructor(s){super(s)}static#e=this.\u0275fac=function(c){return new(c||r)(je(_f,2))};static#t=this.\u0275dir=jt({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(c,h){2&c&&nu("ng-untouched",h.isUntouched)("ng-touched",h.isTouched)("ng-pristine",h.isPristine)("ng-dirty",h.isDirty)("ng-valid",h.isValid)("ng-invalid",h.isInvalid)("ng-pending",h.isPending)},features:[Jn]})}return r})();const kb="VALID",AC="INVALID",sy="PENDING",Lb="DISABLED";function PC(r){return null!=r&&!Array.isArray(r)&&"object"==typeof r}class Pk{constructor(o,s){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(o),this._assignAsyncValidators(s)}get validator(){return this._composedValidatorFn}set validator(o){this._rawValidators=this._composedValidatorFn=o}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(o){this._rawAsyncValidators=this._composedAsyncValidatorFn=o}get parent(){return this._parent}get valid(){return this.status===kb}get invalid(){return this.status===AC}get pending(){return this.status==sy}get disabled(){return this.status===Lb}get enabled(){return this.status!==Lb}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(o){this._assignValidators(o)}setAsyncValidators(o){this._assignAsyncValidators(o)}addValidators(o){this.setValidators(Ek(o,this._rawValidators))}addAsyncValidators(o){this.setAsyncValidators(Ek(o,this._rawAsyncValidators))}removeValidators(o){this.setValidators(Mk(o,this._rawValidators))}removeAsyncValidators(o){this.setAsyncValidators(Mk(o,this._rawAsyncValidators))}hasValidator(o){return SC(this._rawValidators,o)}hasAsyncValidator(o){return SC(this._rawAsyncValidators,o)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(o={}){this.touched=!0,this._parent&&!o.onlySelf&&this._parent.markAsTouched(o)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(o=>o.markAllAsTouched())}markAsUntouched(o={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(s=>{s.markAsUntouched({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}markAsDirty(o={}){this.pristine=!1,this._parent&&!o.onlySelf&&this._parent.markAsDirty(o)}markAsPristine(o={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(s=>{s.markAsPristine({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}markAsPending(o={}){this.status=sy,!1!==o.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!o.onlySelf&&this._parent.markAsPending(o)}disable(o={}){const s=this._parentMarkedDirty(o.onlySelf);this.status=Lb,this.errors=null,this._forEachChild(c=>{c.disable({...o,onlySelf:!0})}),this._updateValue(),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...o,skipPristineCheck:s}),this._onDisabledChange.forEach(c=>c(!0))}enable(o={}){const s=this._parentMarkedDirty(o.onlySelf);this.status=kb,this._forEachChild(c=>{c.enable({...o,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent}),this._updateAncestors({...o,skipPristineCheck:s}),this._onDisabledChange.forEach(c=>c(!1))}_updateAncestors(o){this._parent&&!o.onlySelf&&(this._parent.updateValueAndValidity(o),o.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(o){this._parent=o}getRawValue(){return this.value}updateValueAndValidity(o={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===kb||this.status===sy)&&this._runAsyncValidator(o.emitEvent)),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!o.onlySelf&&this._parent.updateValueAndValidity(o)}_updateTreeValidity(o={emitEvent:!0}){this._forEachChild(s=>s._updateTreeValidity(o)),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Lb:kb}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(o){if(this.asyncValidator){this.status=sy,this._hasOwnPendingAsyncValidator=!0;const s=pk(this.asyncValidator(this));this._asyncValidationSubscription=s.subscribe(c=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(c,{emitEvent:o})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(o,s={}){this.errors=o,this._updateControlsErrors(!1!==s.emitEvent)}get(o){let s=o;return null==s||(Array.isArray(s)||(s=s.split(".")),0===s.length)?null:s.reduce((c,h)=>c&&c._find(h),this)}getError(o,s){const c=s?this.get(s):this;return c&&c.errors?c.errors[o]:null}hasError(o,s){return!!this.getError(o,s)}get root(){let o=this;for(;o._parent;)o=o._parent;return o}_updateControlsErrors(o){this.status=this._calculateStatus(),o&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(o)}_initObservables(){this.valueChanges=new si,this.statusChanges=new si}_calculateStatus(){return this._allControlsDisabled()?Lb:this.errors?AC:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(sy)?sy:this._anyControlsHaveStatus(AC)?AC:kb}_anyControlsHaveStatus(o){return this._anyControls(s=>s.status===o)}_anyControlsDirty(){return this._anyControls(o=>o.dirty)}_anyControlsTouched(){return this._anyControls(o=>o.touched)}_updatePristine(o={}){this.pristine=!this._anyControlsDirty(),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}_updateTouched(o={}){this.touched=this._anyControlsTouched(),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}_registerOnCollectionChange(o){this._onCollectionChange=o}_setUpdateStrategy(o){PC(o)&&null!=o.updateOn&&(this._updateOn=o.updateOn)}_parentMarkedDirty(o){return!o&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(o){return null}_assignValidators(o){this._rawValidators=Array.isArray(o)?o.slice():o,this._composedValidatorFn=function fz(r){return Array.isArray(r)?V3(r):r||null}(this._rawValidators)}_assignAsyncValidators(o){this._rawAsyncValidators=Array.isArray(o)?o.slice():o,this._composedAsyncValidatorFn=function pz(r){return Array.isArray(r)?j3(r):r||null}(this._rawAsyncValidators)}}const ay=new at("CallSetDisabledState",{providedIn:"root",factory:()=>RC}),RC="always";function Fb(r,o,s=RC){(function W3(r,o){const s=function bk(r){return r._rawValidators}(r);null!==o.validator?r.setValidators(vk(s,o.validator)):"function"==typeof s&&r.setValidators([s]);const c=function wk(r){return r._rawAsyncValidators}(r);null!==o.asyncValidator?r.setAsyncValidators(vk(c,o.asyncValidator)):"function"==typeof c&&r.setAsyncValidators([c]);const h=()=>r.updateValueAndValidity();LC(o._rawValidators,h),LC(o._rawAsyncValidators,h)})(r,o),o.valueAccessor.writeValue(r.value),(r.disabled||"always"===s)&&o.valueAccessor.setDisabledState?.(r.disabled),function _z(r,o){o.valueAccessor.registerOnChange(s=>{r._pendingValue=s,r._pendingChange=!0,r._pendingDirty=!0,"change"===r.updateOn&&Rk(r,o)})}(r,o),function xz(r,o){const s=(c,h)=>{o.valueAccessor.writeValue(c),h&&o.viewToModelUpdate(c)};r.registerOnChange(s),o._registerOnDestroy(()=>{r._unregisterOnChange(s)})}(r,o),function yz(r,o){o.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,"blur"===r.updateOn&&r._pendingChange&&Rk(r,o),"submit"!==r.updateOn&&r.markAsTouched()})}(r,o),function gz(r,o){if(o.valueAccessor.setDisabledState){const s=c=>{o.valueAccessor.setDisabledState(c)};r.registerOnDisabledChange(s),o._registerOnDestroy(()=>{r._unregisterOnDisabledChange(s)})}}(r,o)}function LC(r,o){r.forEach(s=>{s.registerOnValidatorChange&&s.registerOnValidatorChange(o)})}function Rk(r,o){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),o.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function Lk(r,o){const s=r.indexOf(o);s>-1&&r.splice(s,1)}function Fk(r){return"object"==typeof r&&null!==r&&2===Object.keys(r).length&&"value"in r&&"disabled"in r}const Nk=class extends Pk{constructor(o=null,s,c){super(function G3(r){return(PC(r)?r.validators:r)||null}(s),function q3(r,o){return(PC(o)?o.asyncValidators:r)||null}(c,s)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(o),this._setUpdateStrategy(s),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),PC(s)&&(s.nonNullable||s.initialValueIsDefault)&&(this.defaultValue=Fk(o)?o.value:o)}setValue(o,s={}){this.value=this._pendingValue=o,this._onChange.length&&!1!==s.emitModelToViewChange&&this._onChange.forEach(c=>c(this.value,!1!==s.emitViewToModelChange)),this.updateValueAndValidity(s)}patchValue(o,s={}){this.setValue(o,s)}reset(o=this.defaultValue,s={}){this._applyFormState(o),this.markAsPristine(s),this.markAsUntouched(s),this.setValue(this.value,s),this._pendingChange=!1}_updateValue(){}_anyControls(o){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(o){this._onChange.push(o)}_unregisterOnChange(o){Lk(this._onChange,o)}registerOnDisabledChange(o){this._onDisabledChange.push(o)}_unregisterOnDisabledChange(o){Lk(this._onDisabledChange,o)}_forEachChild(o){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(o){Fk(o)?(this.value=this._pendingValue=o.value,o.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=o}},Dz={provide:_f,useExisting:ar(()=>Q3)},Vk=(()=>Promise.resolve())();let Q3=(()=>{class r extends _f{constructor(s,c,h,m,y,w){super(),this._changeDetectorRef=y,this.callSetDisabledState=w,this.control=new Nk,this._registered=!1,this.name="",this.update=new si,this._parent=s,this._setValidators(c),this._setAsyncValidators(h),this.valueAccessor=function J3(r,o){if(!o)return null;let s,c,h;return Array.isArray(o),o.forEach(m=>{m.constructor===B3?s=m:function wz(r){return Object.getPrototypeOf(r.constructor)===Fm}(m)?c=m:h=m}),h||c||s||null}(0,m)}ngOnChanges(s){if(this._checkForErrors(),!this._registered||"name"in s){if(this._registered&&(this._checkName(),this.formDirective)){const c=s.name.previousValue;this.formDirective.removeControl({name:c,path:this._getPath(c)})}this._setUpControl()}"isDisabled"in s&&this._updateDisabled(s),function Y3(r,o){if(!r.hasOwnProperty("model"))return!1;const s=r.model;return!!s.isFirstChange()||!Object.is(o,s.currentValue)}(s,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(s){this.viewModel=s,this.update.emit(s)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Fb(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(s){Vk.then(()=>{this.control.setValue(s,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(s){const c=s.isDisabled.currentValue,h=0!==c&&function ty(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}(c);Vk.then(()=>{h&&!this.control.disabled?this.control.disable():!h&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(s){return this._parent?function OC(r,o){return[...o.path,r]}(s,this._parent):[s]}static#e=this.\u0275fac=function(c){return new(c||r)(je(js,9),je(gs,10),je(gf,10),je(du,10),je(Nt,8),je(ay,8))};static#t=this.\u0275dir=jt({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Br([Dz]),Jn,Is]})}return r})(),Uk=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({})}return r})();const zz={provide:du,useExisting:ar(()=>NC),multi:!0};function Xk(r,o){return null==r?`${o}`:(o&&"object"==typeof o&&(o="Object"),`${r}: ${o}`.slice(0,50))}let NC=(()=>{class r extends Fm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(s){this._compareWith=s}writeValue(s){this.value=s;const h=Xk(this._getOptionId(s),s);this.setProperty("value",h)}registerOnChange(s){this.onChange=c=>{this.value=this._getOptionValue(c),s(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(s){for(const c of this._optionMap.keys())if(this._compareWith(this._optionMap.get(c),s))return c;return null}_getOptionValue(s){const c=function Bz(r){return r.split(":")[0]}(s);return this._optionMap.has(c)?this._optionMap.get(c):s}static#e=this.\u0275fac=function(){let s;return function(h){return(s||(s=ii(r)))(h||r)}}();static#t=this.\u0275dir=jt({type:r,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(c,h){1&c&&Uo("change",function(y){return h.onChange(y.target.value)})("blur",function(){return h.onTouched()})},inputs:{compareWith:"compareWith"},features:[Br([zz]),Jn]})}return r})(),Yk=(()=>{class r{constructor(s,c,h){this._element=s,this._renderer=c,this._select=h,this._select&&(this.id=this._select._registerOption())}set ngValue(s){null!=this._select&&(this._select._optionMap.set(this.id,s),this._setElementValue(Xk(this.id,s)),this._select.writeValue(this._select.value))}set value(s){this._setElementValue(s),this._select&&this._select.writeValue(this._select.value)}_setElementValue(s){this._renderer.setProperty(this._element.nativeElement,"value",s)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(c){return new(c||r)(je(us),je(Jl),je(NC,9))};static#t=this.\u0275dir=jt({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return r})();const Vz={provide:du,useExisting:ar(()=>rP),multi:!0};function Jk(r,o){return null==r?`${o}`:("string"==typeof o&&(o=`'${o}'`),o&&"object"==typeof o&&(o="Object"),`${r}: ${o}`.slice(0,50))}let rP=(()=>{class r extends Fm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(s){this._compareWith=s}writeValue(s){let c;if(this.value=s,Array.isArray(s)){const h=s.map(m=>this._getOptionId(m));c=(m,y)=>{m._setSelected(h.indexOf(y.toString())>-1)}}else c=(h,m)=>{h._setSelected(!1)};this._optionMap.forEach(c)}registerOnChange(s){this.onChange=c=>{const h=[],m=c.selectedOptions;if(void 0!==m){const y=m;for(let w=0;w<y.length;w++){const S=this._getOptionValue(y[w].value);h.push(S)}}else{const y=c.options;for(let w=0;w<y.length;w++){const M=y[w];if(M.selected){const S=this._getOptionValue(M.value);h.push(S)}}}this.value=h,s(h)}}_registerOption(s){const c=(this._idCounter++).toString();return this._optionMap.set(c,s),c}_getOptionId(s){for(const c of this._optionMap.keys())if(this._compareWith(this._optionMap.get(c)._value,s))return c;return null}_getOptionValue(s){const c=function jz(r){return r.split(":")[0]}(s);return this._optionMap.has(c)?this._optionMap.get(c)._value:s}static#e=this.\u0275fac=function(){let s;return function(h){return(s||(s=ii(r)))(h||r)}}();static#t=this.\u0275dir=jt({type:r,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(c,h){1&c&&Uo("change",function(y){return h.onChange(y.target)})("blur",function(){return h.onTouched()})},inputs:{compareWith:"compareWith"},features:[Br([Vz]),Jn]})}return r})(),Kk=(()=>{class r{constructor(s,c,h){this._element=s,this._renderer=c,this._select=h,this._select&&(this.id=this._select._registerOption(this))}set ngValue(s){null!=this._select&&(this._value=s,this._setElementValue(Jk(this.id,s)),this._select.writeValue(this._select.value))}set value(s){this._select?(this._value=s,this._setElementValue(Jk(this.id,s)),this._select.writeValue(this._select.value)):this._setElementValue(s)}_setElementValue(s){this._renderer.setProperty(this._element.nativeElement,"value",s)}_setSelected(s){this._renderer.setProperty(this._element.nativeElement,"selected",s)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(c){return new(c||r)(je(us),je(Jl),je(rP,9))};static#t=this.\u0275dir=jt({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return r})(),Yz=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({imports:[Uk]})}return r})(),Kz=(()=>{class r{static withConfig(s){return{ngModule:r,providers:[{provide:ay,useValue:s.callSetDisabledState??RC}]}}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({imports:[Yz]})}return r})();function oP(...r){const o=Ic(r),s=aw(r),{args:c,keys:h}=QO(r);if(0===c.length)return hi([],o);const m=new Un(function eB(r,o,s=Xa){return c=>{lL(o,()=>{const{length:h}=r,m=new Array(h);let y=h,w=h;for(let M=0;M<h;M++)lL(o,()=>{const S=hi(r[M],o);let O=!1;S.subscribe(Ar(c,F=>{m[M]=F,O||(O=!0,w--),w||c.next(s(m.slice()))},()=>{--y||c.complete()}))},c)},c)}}(c,o,h?y=>tk(h,y):Xa));return s?m.pipe(ek(s)):m}function lL(r,o,s){r?Xo(s,r,o):o()}const zC=wf(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function sP(...r){return function tB(){return Sc(1)}()(hi(r,Ic(r)))}function cL(r){return new Un(o=>{fn(r()).subscribe(o)})}function zb(r,o){const s=sr(r)?r:()=>r,c=h=>h.error(s());return new Un(o?h=>o.schedule(c,0,h):c)}function aP(){return ci((r,o)=>{let s=null;r._refCount++;const c=Ar(o,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount)return void(s=null);const h=r._connection,m=s;s=null,h&&(!m||h===m)&&h.unsubscribe(),o.unsubscribe()});r.subscribe(c),c.closed||(s=r.connect())})}class uL extends Un{constructor(o,s){super(),this.source=o,this.subjectFactory=s,this._subject=null,this._refCount=0,this._connection=null,Ro(o)&&(this.lift=o.lift)}_subscribe(o){return this.getSubject().subscribe(o)}getSubject(){const o=this._subject;return(!o||o.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:o}=this;this._subject=this._connection=null,o?.unsubscribe()}connect(){let o=this._connection;if(!o){o=this._connection=new ie;const s=this.getSubject();o.add(this.source.subscribe(Ar(s,void 0,()=>{this._teardown(),s.complete()},c=>{this._teardown(),s.error(c)},()=>this._teardown()))),o.closed&&(this._connection=null,o=ie.EMPTY)}return o}refCount(){return aP()(this)}}function ly(r){return r<=0?()=>ha:ci((o,s)=>{let c=0;o.subscribe(Ar(s,h=>{++c<=r&&(s.next(h),r<=c&&s.complete())}))})}function BC(r){return ci((o,s)=>{let c=!1;o.subscribe(Ar(s,h=>{c=!0,s.next(h)},()=>{c||s.next(r),s.complete()}))})}function hL(r=rB){return ci((o,s)=>{let c=!1;o.subscribe(Ar(s,h=>{c=!0,s.next(h)},()=>c?s.complete():s.error(r())))})}function rB(){return new zC}function zm(r,o){const s=arguments.length>=2;return c=>c.pipe(r?mh((h,m)=>r(h,m,c)):Xa,ly(1),s?BC(o):hL(()=>new zC))}function _s(r,o,s){const c=sr(r)||o||s?{next:r,error:o,complete:s}:r;return c?ci((h,m)=>{var y;null===(y=c.subscribe)||void 0===y||y.call(c);let w=!0;h.subscribe(Ar(m,M=>{var S;null===(S=c.next)||void 0===S||S.call(c,M),m.next(M)},()=>{var M;w=!1,null===(M=c.complete)||void 0===M||M.call(c),m.complete()},M=>{var S;w=!1,null===(S=c.error)||void 0===S||S.call(c,M),m.error(M)},()=>{var M,S;w&&(null===(M=c.unsubscribe)||void 0===M||M.call(c)),null===(S=c.finalize)||void 0===S||S.call(c)}))}):Xa}function Bm(r){return ci((o,s)=>{let m,c=null,h=!1;c=o.subscribe(Ar(s,void 0,void 0,y=>{m=fn(r(y,Bm(r)(o))),c?(c.unsubscribe(),c=null,m.subscribe(s)):h=!0})),h&&(c.unsubscribe(),c=null,m.subscribe(s))})}function lP(r){return r<=0?()=>ha:ci((o,s)=>{let c=[];o.subscribe(Ar(s,h=>{c.push(h),r<c.length&&c.shift()},()=>{for(const h of c)s.next(h);s.complete()},void 0,()=>{c=null}))})}const pn="primary",Bb=Symbol("RouteTitle");class cB{constructor(o){this.params=o||{}}has(o){return Object.prototype.hasOwnProperty.call(this.params,o)}get(o){if(this.has(o)){const s=this.params[o];return Array.isArray(s)?s[0]:s}return null}getAll(o){if(this.has(o)){const s=this.params[o];return Array.isArray(s)?s:[s]}return[]}get keys(){return Object.keys(this.params)}}function cy(r){return new cB(r)}function uB(r,o,s){const c=s.path.split("/");if(c.length>r.length||"full"===s.pathMatch&&(o.hasChildren()||c.length<r.length))return null;const h={};for(let m=0;m<c.length;m++){const y=c[m],w=r[m];if(y.startsWith(":"))h[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:r.slice(0,c.length),posParams:h}}function fu(r,o){const s=r?Object.keys(r):void 0,c=o?Object.keys(o):void 0;if(!s||!c||s.length!=c.length)return!1;let h;for(let m=0;m<s.length;m++)if(h=s[m],!dL(r[h],o[h]))return!1;return!0}function dL(r,o){if(Array.isArray(r)&&Array.isArray(o)){if(r.length!==o.length)return!1;const s=[...r].sort(),c=[...o].sort();return s.every((h,m)=>c[m]===h)}return r===o}function fL(r){return r.length>0?r[r.length-1]:null}function yf(r){return function Qz(r){return!!r&&(r instanceof Un||sr(r.lift)&&sr(r.subscribe))}(r)?r:Gd(r)?hi(Promise.resolve(r)):Fe(r)}const dB={exact:function gL(r,o,s){if(!Vm(r.segments,o.segments)||!VC(r.segments,o.segments,s)||r.numberOfChildren!==o.numberOfChildren)return!1;for(const c in o.children)if(!r.children[c]||!gL(r.children[c],o.children[c],s))return!1;return!0},subset:_L},pL={exact:function fB(r,o){return fu(r,o)},subset:function pB(r,o){return Object.keys(o).length<=Object.keys(r).length&&Object.keys(o).every(s=>dL(r[s],o[s]))},ignored:()=>!0};function mL(r,o,s){return dB[s.paths](r.root,o.root,s.matrixParams)&&pL[s.queryParams](r.queryParams,o.queryParams)&&!("exact"===s.fragment&&r.fragment!==o.fragment)}function _L(r,o,s){return yL(r,o,o.segments,s)}function yL(r,o,s,c){if(r.segments.length>s.length){const h=r.segments.slice(0,s.length);return!(!Vm(h,s)||o.hasChildren()||!VC(h,s,c))}if(r.segments.length===s.length){if(!Vm(r.segments,s)||!VC(r.segments,s,c))return!1;for(const h in o.children)if(!r.children[h]||!_L(r.children[h],o.children[h],c))return!1;return!0}{const h=s.slice(0,r.segments.length),m=s.slice(r.segments.length);return!!(Vm(r.segments,h)&&VC(r.segments,h,c)&&r.children[pn])&&yL(r.children[pn],o,m,c)}}function VC(r,o,s){return o.every((c,h)=>pL[s](r[h].parameters,c.parameters))}class uy{constructor(o=new Tr([],{}),s={},c=null){this.root=o,this.queryParams=s,this.fragment=c}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=cy(this.queryParams)),this._queryParamMap}toString(){return _B.serialize(this)}}class Tr{constructor(o,s){this.segments=o,this.children=s,this.parent=null,Object.values(s).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return jC(this)}}class Vb{constructor(o,s){this.path=o,this.parameters=s}get parameterMap(){return this._parameterMap||(this._parameterMap=cy(this.parameters)),this._parameterMap}toString(){return bL(this)}}function Vm(r,o){return r.length===o.length&&r.every((s,c)=>s.path===o[c].path)}let jb=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:function(){return new cP},providedIn:"root"})}return r})();class cP{parse(o){const s=new SB(o);return new uy(s.parseRootSegment(),s.parseQueryParams(),s.parseFragment())}serialize(o){const s=`/${Ub(o.root,!0)}`,c=function vB(r){const o=Object.keys(r).map(s=>{const c=r[s];return Array.isArray(c)?c.map(h=>`${UC(s)}=${UC(h)}`).join("&"):`${UC(s)}=${UC(c)}`}).filter(s=>!!s);return o.length?`?${o.join("&")}`:""}(o.queryParams);return`${s}${c}${"string"==typeof o.fragment?`#${function yB(r){return encodeURI(r)}(o.fragment)}`:""}`}}const _B=new cP;function jC(r){return r.segments.map(o=>bL(o)).join("/")}function Ub(r,o){if(!r.hasChildren())return jC(r);if(o){const s=r.children[pn]?Ub(r.children[pn],!1):"",c=[];return Object.entries(r.children).forEach(([h,m])=>{h!==pn&&c.push(`${h}:${Ub(m,!1)}`)}),c.length>0?`${s}(${c.join("//")})`:s}{const s=function gB(r,o){let s=[];return Object.entries(r.children).forEach(([c,h])=>{c===pn&&(s=s.concat(o(h,c)))}),Object.entries(r.children).forEach(([c,h])=>{c!==pn&&(s=s.concat(o(h,c)))}),s}(r,(c,h)=>h===pn?[Ub(r.children[pn],!1)]:[`${h}:${Ub(c,!1)}`]);return 1===Object.keys(r.children).length&&null!=r.children[pn]?`${jC(r)}/${s[0]}`:`${jC(r)}/(${s.join("//")})`}}function xL(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function UC(r){return xL(r).replace(/%3B/gi,";")}function uP(r){return xL(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function $C(r){return decodeURIComponent(r)}function vL(r){return $C(r.replace(/\+/g,"%20"))}function bL(r){return`${uP(r.path)}${function xB(r){return Object.keys(r).map(o=>`;${uP(o)}=${uP(r[o])}`).join("")}(r.parameters)}`}const bB=/^[^\/()?;#]+/;function hP(r){const o=r.match(bB);return o?o[0]:""}const wB=/^[^\/()?;=#]+/,MB=/^[^=?&#]+/,CB=/^[^&#]+/;class SB{constructor(o){this.url=o,this.remaining=o}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Tr([],{}):new Tr([],this.parseChildren())}parseQueryParams(){const o={};if(this.consumeOptional("?"))do{this.parseQueryParam(o)}while(this.consumeOptional("&"));return o}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const o=[];for(this.peekStartsWith("(")||o.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),o.push(this.parseSegment());let s={};this.peekStartsWith("/(")&&(this.capture("/"),s=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(o.length>0||Object.keys(s).length>0)&&(c[pn]=new Tr(o,s)),c}parseSegment(){const o=hP(this.remaining);if(""===o&&this.peekStartsWith(";"))throw new pe(4009,!1);return this.capture(o),new Vb($C(o),this.parseMatrixParams())}parseMatrixParams(){const o={};for(;this.consumeOptional(";");)this.parseParam(o);return o}parseParam(o){const s=function EB(r){const o=r.match(wB);return o?o[0]:""}(this.remaining);if(!s)return;this.capture(s);let c="";if(this.consumeOptional("=")){const h=hP(this.remaining);h&&(c=h,this.capture(c))}o[$C(s)]=$C(c)}parseQueryParam(o){const s=function TB(r){const o=r.match(MB);return o?o[0]:""}(this.remaining);if(!s)return;this.capture(s);let c="";if(this.consumeOptional("=")){const y=function DB(r){const o=r.match(CB);return o?o[0]:""}(this.remaining);y&&(c=y,this.capture(c))}const h=vL(s),m=vL(c);if(o.hasOwnProperty(h)){let y=o[h];Array.isArray(y)||(y=[y],o[h]=y),y.push(m)}else o[h]=m}parseParens(o){const s={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const c=hP(this.remaining),h=this.remaining[c.length];if("/"!==h&&")"!==h&&";"!==h)throw new pe(4010,!1);let m;c.indexOf(":")>-1?(m=c.slice(0,c.indexOf(":")),this.capture(m),this.capture(":")):o&&(m=pn);const y=this.parseChildren();s[m]=1===Object.keys(y).length?y[pn]:new Tr([],y),this.consumeOptional("//")}return s}peekStartsWith(o){return this.remaining.startsWith(o)}consumeOptional(o){return!!this.peekStartsWith(o)&&(this.remaining=this.remaining.substring(o.length),!0)}capture(o){if(!this.consumeOptional(o))throw new pe(4011,!1)}}function wL(r){return r.segments.length>0?new Tr([],{[pn]:r}):r}function EL(r){const o={};for(const c of Object.keys(r.children)){const m=EL(r.children[c]);if(c===pn&&0===m.segments.length&&m.hasChildren())for(const[y,w]of Object.entries(m.children))o[y]=w;else(m.segments.length>0||m.hasChildren())&&(o[c]=m)}return function IB(r){if(1===r.numberOfChildren&&r.children[pn]){const o=r.children[pn];return new Tr(r.segments.concat(o.segments),o.children)}return r}(new Tr(r.segments,o))}function jm(r){return r instanceof uy}function ML(r){let o;const h=wL(function s(m){const y={};for(const M of m.children){const S=s(M);y[M.outlet]=S}const w=new Tr(m.url,y);return m===r&&(o=w),w}(r.root));return o??h}function TL(r,o,s,c){let h=r;for(;h.parent;)h=h.parent;if(0===o.length)return dP(h,h,h,s,c);const m=function PB(r){if("string"==typeof r[0]&&1===r.length&&"/"===r[0])return new DL(!0,0,r);let o=0,s=!1;const c=r.reduce((h,m,y)=>{if("object"==typeof m&&null!=m){if(m.outlets){const w={};return Object.entries(m.outlets).forEach(([M,S])=>{w[M]="string"==typeof S?S.split("/"):S}),[...h,{outlets:w}]}if(m.segmentPath)return[...h,m.segmentPath]}return"string"!=typeof m?[...h,m]:0===y?(m.split("/").forEach((w,M)=>{0==M&&"."===w||(0==M&&""===w?s=!0:".."===w?o++:""!=w&&h.push(w))}),h):[...h,m]},[]);return new DL(s,o,c)}(o);if(m.toRoot())return dP(h,h,new Tr([],{}),s,c);const y=function RB(r,o,s){if(r.isAbsolute)return new GC(o,!0,0);if(!s)return new GC(o,!1,NaN);if(null===s.parent)return new GC(s,!0,0);const c=HC(r.commands[0])?0:1;return function OB(r,o,s){let c=r,h=o,m=s;for(;m>h;){if(m-=h,c=c.parent,!c)throw new pe(4005,!1);h=c.segments.length}return new GC(c,!1,h-m)}(s,s.segments.length-1+c,r.numberOfDoubleDots)}(m,h,r),w=y.processChildren?Hb(y.segmentGroup,y.index,m.commands):SL(y.segmentGroup,y.index,m.commands);return dP(h,y.segmentGroup,w,s,c)}function HC(r){return"object"==typeof r&&null!=r&&!r.outlets&&!r.segmentPath}function $b(r){return"object"==typeof r&&null!=r&&r.outlets}function dP(r,o,s,c,h){let y,m={};c&&Object.entries(c).forEach(([M,S])=>{m[M]=Array.isArray(S)?S.map(O=>`${O}`):`${S}`}),y=r===o?s:CL(r,o,s);const w=wL(EL(y));return new uy(w,m,h)}function CL(r,o,s){const c={};return Object.entries(r.children).forEach(([h,m])=>{c[h]=m===o?s:CL(m,o,s)}),new Tr(r.segments,c)}class DL{constructor(o,s,c){if(this.isAbsolute=o,this.numberOfDoubleDots=s,this.commands=c,o&&c.length>0&&HC(c[0]))throw new pe(4003,!1);const h=c.find($b);if(h&&h!==fL(c))throw new pe(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class GC{constructor(o,s,c){this.segmentGroup=o,this.processChildren=s,this.index=c}}function SL(r,o,s){if(r||(r=new Tr([],{})),0===r.segments.length&&r.hasChildren())return Hb(r,o,s);const c=function LB(r,o,s){let c=0,h=o;const m={match:!1,pathIndex:0,commandIndex:0};for(;h<r.segments.length;){if(c>=s.length)return m;const y=r.segments[h],w=s[c];if($b(w))break;const M=`${w}`,S=c<s.length-1?s[c+1]:null;if(h>0&&void 0===M)break;if(M&&S&&"object"==typeof S&&void 0===S.outlets){if(!AL(M,S,y))return m;c+=2}else{if(!AL(M,{},y))return m;c++}h++}return{match:!0,pathIndex:h,commandIndex:c}}(r,o,s),h=s.slice(c.commandIndex);if(c.match&&c.pathIndex<r.segments.length){const m=new Tr(r.segments.slice(0,c.pathIndex),{});return m.children[pn]=new Tr(r.segments.slice(c.pathIndex),r.children),Hb(m,0,h)}return c.match&&0===h.length?new Tr(r.segments,{}):c.match&&!r.hasChildren()?fP(r,o,s):c.match?Hb(r,0,h):fP(r,o,s)}function Hb(r,o,s){if(0===s.length)return new Tr(r.segments,{});{const c=function kB(r){return $b(r[0])?r[0].outlets:{[pn]:r}}(s),h={};if(Object.keys(c).some(m=>m!==pn)&&r.children[pn]&&1===r.numberOfChildren&&0===r.children[pn].segments.length){const m=Hb(r.children[pn],o,s);return new Tr(r.segments,m.children)}return Object.entries(c).forEach(([m,y])=>{"string"==typeof y&&(y=[y]),null!==y&&(h[m]=SL(r.children[m],o,y))}),Object.entries(r.children).forEach(([m,y])=>{void 0===c[m]&&(h[m]=y)}),new Tr(r.segments,h)}}function fP(r,o,s){const c=r.segments.slice(0,o);let h=0;for(;h<s.length;){const m=s[h];if($b(m)){const M=FB(m.outlets);return new Tr(c,M)}if(0===h&&HC(s[0])){c.push(new Vb(r.segments[o].path,IL(s[0]))),h++;continue}const y=$b(m)?m.outlets[pn]:`${m}`,w=h<s.length-1?s[h+1]:null;y&&w&&HC(w)?(c.push(new Vb(y,IL(w))),h+=2):(c.push(new Vb(y,{})),h++)}return new Tr(c,{})}function FB(r){const o={};return Object.entries(r).forEach(([s,c])=>{"string"==typeof c&&(c=[c]),null!==c&&(o[s]=fP(new Tr([],{}),0,c))}),o}function IL(r){const o={};return Object.entries(r).forEach(([s,c])=>o[s]=`${c}`),o}function AL(r,o,s){return r==s.path&&fu(o,s.parameters)}const Gb="imperative";class pu{constructor(o,s){this.id=o,this.url=s}}class qC extends pu{constructor(o,s,c="imperative",h=null){super(o,s),this.type=0,this.navigationTrigger=c,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class xf extends pu{constructor(o,s,c){super(o,s),this.urlAfterRedirects=c,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class qb extends pu{constructor(o,s,c,h){super(o,s),this.reason=c,this.code=h,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class hy extends pu{constructor(o,s,c,h){super(o,s),this.reason=c,this.code=h,this.type=16}}class ZC extends pu{constructor(o,s,c,h){super(o,s),this.error=c,this.target=h,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class PL extends pu{constructor(o,s,c,h){super(o,s),this.urlAfterRedirects=c,this.state=h,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class NB extends pu{constructor(o,s,c,h){super(o,s),this.urlAfterRedirects=c,this.state=h,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class zB extends pu{constructor(o,s,c,h,m){super(o,s),this.urlAfterRedirects=c,this.state=h,this.shouldActivate=m,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class BB extends pu{constructor(o,s,c,h){super(o,s),this.urlAfterRedirects=c,this.state=h,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class VB extends pu{constructor(o,s,c,h){super(o,s),this.urlAfterRedirects=c,this.state=h,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jB{constructor(o){this.route=o,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class UB{constructor(o){this.route=o,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class $B{constructor(o){this.snapshot=o,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HB{constructor(o){this.snapshot=o,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class GB{constructor(o){this.snapshot=o,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qB{constructor(o){this.snapshot=o,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class RL{constructor(o,s,c){this.routerEvent=o,this.position=s,this.anchor=c,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class pP{}class mP{constructor(o){this.url=o}}class ZB{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Zb,this.attachRef=null}}let Zb=(()=>{class r{constructor(){this.contexts=new Map}onChildOutletCreated(s,c){const h=this.getOrCreateContext(s);h.outlet=c,this.contexts.set(s,h)}onChildOutletDestroyed(s){const c=this.getContext(s);c&&(c.outlet=null,c.attachRef=null)}onOutletDeactivated(){const s=this.contexts;return this.contexts=new Map,s}onOutletReAttached(s){this.contexts=s}getOrCreateContext(s){let c=this.getContext(s);return c||(c=new ZB,this.contexts.set(s,c)),c}getContext(s){return this.contexts.get(s)||null}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();class OL{constructor(o){this._root=o}get root(){return this._root.value}parent(o){const s=this.pathFromRoot(o);return s.length>1?s[s.length-2]:null}children(o){const s=gP(o,this._root);return s?s.children.map(c=>c.value):[]}firstChild(o){const s=gP(o,this._root);return s&&s.children.length>0?s.children[0].value:null}siblings(o){const s=_P(o,this._root);return s.length<2?[]:s[s.length-2].children.map(h=>h.value).filter(h=>h!==o)}pathFromRoot(o){return _P(o,this._root).map(s=>s.value)}}function gP(r,o){if(r===o.value)return o;for(const s of o.children){const c=gP(r,s);if(c)return c}return null}function _P(r,o){if(r===o.value)return[o];for(const s of o.children){const c=_P(r,s);if(c.length)return c.unshift(o),c}return[]}class gh{constructor(o,s){this.value=o,this.children=s}toString(){return`TreeNode(${this.value})`}}function dy(r){const o={};return r&&r.children.forEach(s=>o[s.value.outlet]=s),o}class kL extends OL{constructor(o,s){super(o),this.snapshot=s,yP(this,o)}toString(){return this.snapshot.toString()}}function LL(r,o){const s=function WB(r,o){const y=new WC([],{},{},"",{},pn,o,null,{});return new NL("",new gh(y,[]))}(0,o),c=new Ui([new Vb("",{})]),h=new Ui({}),m=new Ui({}),y=new Ui({}),w=new Ui(""),M=new fy(c,h,y,w,m,pn,o,s.root);return M.snapshot=s.root,new kL(new gh(M,[]),s)}class fy{constructor(o,s,c,h,m,y,w,M){this.urlSubject=o,this.paramsSubject=s,this.queryParamsSubject=c,this.fragmentSubject=h,this.dataSubject=m,this.outlet=y,this.component=w,this._futureSnapshot=M,this.title=this.dataSubject?.pipe(On(S=>S[Bb]))??Fe(void 0),this.url=o,this.params=s,this.queryParams=c,this.fragment=h,this.data=m}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(On(o=>cy(o)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(On(o=>cy(o)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function FL(r,o="emptyOnly"){const s=r.pathFromRoot;let c=0;if("always"!==o)for(c=s.length-1;c>=1;){const h=s[c],m=s[c-1];if(h.routeConfig&&""===h.routeConfig.path)c--;else{if(m.component)break;c--}}return function XB(r){return r.reduce((o,s)=>({params:{...o.params,...s.params},data:{...o.data,...s.data},resolve:{...s.data,...o.resolve,...s.routeConfig?.data,...s._resolvedData}}),{params:{},data:{},resolve:{}})}(s.slice(c))}class WC{get title(){return this.data?.[Bb]}constructor(o,s,c,h,m,y,w,M,S){this.url=o,this.params=s,this.queryParams=c,this.fragment=h,this.data=m,this.outlet=y,this.component=w,this.routeConfig=M,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=cy(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=cy(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(c=>c.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class NL extends OL{constructor(o,s){super(s),this.url=o,yP(this,s)}toString(){return zL(this._root)}}function yP(r,o){o.value._routerState=r,o.children.forEach(s=>yP(r,s))}function zL(r){const o=r.children.length>0?` { ${r.children.map(zL).join(", ")} } `:"";return`${r.value}${o}`}function xP(r){if(r.snapshot){const o=r.snapshot,s=r._futureSnapshot;r.snapshot=s,fu(o.queryParams,s.queryParams)||r.queryParamsSubject.next(s.queryParams),o.fragment!==s.fragment&&r.fragmentSubject.next(s.fragment),fu(o.params,s.params)||r.paramsSubject.next(s.params),function hB(r,o){if(r.length!==o.length)return!1;for(let s=0;s<r.length;++s)if(!fu(r[s],o[s]))return!1;return!0}(o.url,s.url)||r.urlSubject.next(s.url),fu(o.data,s.data)||r.dataSubject.next(s.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function vP(r,o){const s=fu(r.params,o.params)&&function mB(r,o){return Vm(r,o)&&r.every((s,c)=>fu(s.parameters,o[c].parameters))}(r.url,o.url);return s&&!(!r.parent!=!o.parent)&&(!r.parent||vP(r.parent,o.parent))}let BL=(()=>{class r{constructor(){this.activated=null,this._activatedRoute=null,this.name=pn,this.activateEvents=new si,this.deactivateEvents=new si,this.attachEvents=new si,this.detachEvents=new si,this.parentContexts=lt(Zb),this.location=lt(ms),this.changeDetector=lt(Nt),this.environmentInjector=lt(cs),this.inputBinder=lt(XC,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(s){if(s.name){const{firstChange:c,previousValue:h}=s.name;if(c)return;this.isTrackedInParentContexts(h)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(h)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(s){return this.parentContexts.getContext(s)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const s=this.parentContexts.getContext(this.name);s?.route&&(s.attachRef?this.attach(s.attachRef,s.route):this.activateWith(s.route,s.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new pe(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new pe(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new pe(4012,!1);this.location.detach();const s=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(s.instance),s}attach(s,c){this.activated=s,this._activatedRoute=c,this.location.insert(s.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(s.instance)}deactivate(){if(this.activated){const s=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(s)}}activateWith(s,c){if(this.isActivated)throw new pe(4013,!1);this._activatedRoute=s;const h=this.location,y=s.snapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,M=new YB(s,w,h.injector);this.activated=h.createComponent(y,{index:h.length,injector:M,environmentInjector:c??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275dir=jt({type:r,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Is]})}return r})();class YB{constructor(o,s,c){this.route=o,this.childContexts=s,this.parent=c}get(o,s){return o===fy?this.route:o===Zb?this.childContexts:this.parent.get(o,s)}}const XC=new at("");let VL=(()=>{class r{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(s){this.unsubscribeFromRouteData(s),this.subscribeToRouteData(s)}unsubscribeFromRouteData(s){this.outletDataSubscriptions.get(s)?.unsubscribe(),this.outletDataSubscriptions.delete(s)}subscribeToRouteData(s){const{activatedRoute:c}=s,h=oP([c.queryParams,c.params,c.data]).pipe(ro(([m,y,w],M)=>(w={...m,...y,...w},0===M?Fe(w):Promise.resolve(w)))).subscribe(m=>{if(!s.isActivated||!s.activatedComponentRef||s.activatedRoute!==c||null===c.component)return void this.unsubscribeFromRouteData(s);const y=function WF(r){const o=An(r);if(!o)return null;const s=new Ad(o);return{get selector(){return s.selector},get type(){return s.componentType},get inputs(){return s.inputs},get outputs(){return s.outputs},get ngContentSelectors(){return s.ngContentSelectors},get isStandalone(){return o.standalone},get isSignal(){return o.signals}}}(c.component);if(y)for(const{templateName:w}of y.inputs)s.activatedComponentRef.setInput(w,m[w]);else this.unsubscribeFromRouteData(s)});this.outletDataSubscriptions.set(s,h)}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();function Wb(r,o,s){if(s&&r.shouldReuseRoute(o.value,s.value.snapshot)){const c=s.value;c._futureSnapshot=o.value;const h=function KB(r,o,s){return o.children.map(c=>{for(const h of s.children)if(r.shouldReuseRoute(c.value,h.value.snapshot))return Wb(r,c,h);return Wb(r,c)})}(r,o,s);return new gh(c,h)}{if(r.shouldAttach(o.value)){const m=r.retrieve(o.value);if(null!==m){const y=m.route;return y.value._futureSnapshot=o.value,y.children=o.children.map(w=>Wb(r,w)),y}}const c=function QB(r){return new fy(new Ui(r.url),new Ui(r.params),new Ui(r.queryParams),new Ui(r.fragment),new Ui(r.data),r.outlet,r.component,r)}(o.value),h=o.children.map(m=>Wb(r,m));return new gh(c,h)}}const bP="ngNavigationCancelingError";function jL(r,o){const{redirectTo:s,navigationBehaviorOptions:c}=jm(o)?{redirectTo:o,navigationBehaviorOptions:void 0}:o,h=UL(!1,0,o);return h.url=s,h.navigationBehaviorOptions=c,h}function UL(r,o,s){const c=new Error("NavigationCancelingError: "+(r||""));return c[bP]=!0,c.cancellationCode=o,s&&(c.url=s),c}function $L(r){return r&&r[bP]}let HL=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275cmp=Pc({type:r,selectors:[["ng-component"]],standalone:!0,features:[V1],decls:1,vars:0,template:function(c,h){1&c&&Ud(0,"router-outlet")},dependencies:[BL],encapsulation:2})}return r})();function wP(r){const o=r.children&&r.children.map(wP),s=o?{...r,children:o}:{...r};return!s.component&&!s.loadComponent&&(o||s.loadChildren)&&s.outlet&&s.outlet!==pn&&(s.component=HL),s}function gc(r){return r.outlet||pn}function Xb(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let o=r.parent;o;o=o.parent){const s=o.routeConfig;if(s?._loadedInjector)return s._loadedInjector;if(s?._injector)return s._injector}return null}class a6{constructor(o,s,c,h,m){this.routeReuseStrategy=o,this.futureState=s,this.currState=c,this.forwardEvent=h,this.inputBindingEnabled=m}activate(o){const s=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(s,c,o),xP(this.futureState.root),this.activateChildRoutes(s,c,o)}deactivateChildRoutes(o,s,c){const h=dy(s);o.children.forEach(m=>{const y=m.value.outlet;this.deactivateRoutes(m,h[y],c),delete h[y]}),Object.values(h).forEach(m=>{this.deactivateRouteAndItsChildren(m,c)})}deactivateRoutes(o,s,c){const h=o.value,m=s?s.value:null;if(h===m)if(h.component){const y=c.getContext(h.outlet);y&&this.deactivateChildRoutes(o,s,y.children)}else this.deactivateChildRoutes(o,s,c);else m&&this.deactivateRouteAndItsChildren(s,c)}deactivateRouteAndItsChildren(o,s){o.value.component&&this.routeReuseStrategy.shouldDetach(o.value.snapshot)?this.detachAndStoreRouteSubtree(o,s):this.deactivateRouteAndOutlet(o,s)}detachAndStoreRouteSubtree(o,s){const c=s.getContext(o.value.outlet),h=c&&o.value.component?c.children:s,m=dy(o);for(const y of Object.keys(m))this.deactivateRouteAndItsChildren(m[y],h);if(c&&c.outlet){const y=c.outlet.detach(),w=c.children.onOutletDeactivated();this.routeReuseStrategy.store(o.value.snapshot,{componentRef:y,route:o,contexts:w})}}deactivateRouteAndOutlet(o,s){const c=s.getContext(o.value.outlet),h=c&&o.value.component?c.children:s,m=dy(o);for(const y of Object.keys(m))this.deactivateRouteAndItsChildren(m[y],h);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(o,s,c){const h=dy(s);o.children.forEach(m=>{this.activateRoutes(m,h[m.value.outlet],c),this.forwardEvent(new qB(m.value.snapshot))}),o.children.length&&this.forwardEvent(new HB(o.value.snapshot))}activateRoutes(o,s,c){const h=o.value,m=s?s.value:null;if(xP(h),h===m)if(h.component){const y=c.getOrCreateContext(h.outlet);this.activateChildRoutes(o,s,y.children)}else this.activateChildRoutes(o,s,c);else if(h.component){const y=c.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){const w=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),xP(w.route.value),this.activateChildRoutes(o,null,y.children)}else{const w=Xb(h.snapshot);y.attachRef=null,y.route=h,y.injector=w,y.outlet&&y.outlet.activateWith(h,y.injector),this.activateChildRoutes(o,null,y.children)}}else this.activateChildRoutes(o,null,c)}}class GL{constructor(o){this.path=o,this.route=this.path[this.path.length-1]}}class YC{constructor(o,s){this.component=o,this.route=s}}function l6(r,o,s){const c=r._root;return Yb(c,o?o._root:null,s,[c.value])}function py(r,o){const s=Symbol(),c=o.get(r,s);return c===s?"function"!=typeof r||function sg(r){return null!==If(r)}(r)?o.get(r):r:c}function Yb(r,o,s,c,h={canDeactivateChecks:[],canActivateChecks:[]}){const m=dy(o);return r.children.forEach(y=>{(function u6(r,o,s,c,h={canDeactivateChecks:[],canActivateChecks:[]}){const m=r.value,y=o?o.value:null,w=s?s.getContext(r.value.outlet):null;if(y&&m.routeConfig===y.routeConfig){const M=function h6(r,o,s){if("function"==typeof s)return s(r,o);switch(s){case"pathParamsChange":return!Vm(r.url,o.url);case"pathParamsOrQueryParamsChange":return!Vm(r.url,o.url)||!fu(r.queryParams,o.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!vP(r,o)||!fu(r.queryParams,o.queryParams);default:return!vP(r,o)}}(y,m,m.routeConfig.runGuardsAndResolvers);M?h.canActivateChecks.push(new GL(c)):(m.data=y.data,m._resolvedData=y._resolvedData),Yb(r,o,m.component?w?w.children:null:s,c,h),M&&w&&w.outlet&&w.outlet.isActivated&&h.canDeactivateChecks.push(new YC(w.outlet.component,y))}else y&&Jb(o,w,h),h.canActivateChecks.push(new GL(c)),Yb(r,null,m.component?w?w.children:null:s,c,h)})(y,m[y.value.outlet],s,c.concat([y.value]),h),delete m[y.value.outlet]}),Object.entries(m).forEach(([y,w])=>Jb(w,s.getContext(y),h)),h}function Jb(r,o,s){const c=dy(r),h=r.value;Object.entries(c).forEach(([m,y])=>{Jb(y,h.component?o?o.children.getContext(m):null:o,s)}),s.canDeactivateChecks.push(new YC(h.component&&o&&o.outlet&&o.outlet.isActivated?o.outlet.component:null,h))}function Kb(r){return"function"==typeof r}function qL(r){return r instanceof zC||"EmptyError"===r?.name}const JC=Symbol("INITIAL_VALUE");function my(){return ro(r=>oP(r.map(o=>o.pipe(ly(1),function nB(...r){const o=Ic(r);return ci((s,c)=>{(o?sP(r,s,o):sP(r,s)).subscribe(c)})}(JC)))).pipe(On(o=>{for(const s of o)if(!0!==s){if(s===JC)return JC;if(!1===s||s instanceof uy)return s}return!0}),mh(o=>o!==JC),ly(1)))}function ZL(r){return function xu(...r){return Mc(r)}(_s(o=>{if(jm(o))throw jL(0,o)}),On(o=>!0===o))}class KC{constructor(o){this.segmentGroup=o||null}}class WL{constructor(o){this.urlTree=o}}function gy(r){return zb(new KC(r))}function XL(r){return zb(new WL(r))}class P6{constructor(o,s){this.urlSerializer=o,this.urlTree=s}noMatchError(o){return new pe(4002,!1)}lineralizeSegments(o,s){let c=[],h=s.root;for(;;){if(c=c.concat(h.segments),0===h.numberOfChildren)return Fe(c);if(h.numberOfChildren>1||!h.children[pn])return zb(new pe(4e3,!1));h=h.children[pn]}}applyRedirectCommands(o,s,c){return this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),o,c)}applyRedirectCreateUrlTree(o,s,c,h){const m=this.createSegmentGroup(o,s.root,c,h);return new uy(m,this.createQueryParams(s.queryParams,this.urlTree.queryParams),s.fragment)}createQueryParams(o,s){const c={};return Object.entries(o).forEach(([h,m])=>{if("string"==typeof m&&m.startsWith(":")){const w=m.substring(1);c[h]=s[w]}else c[h]=m}),c}createSegmentGroup(o,s,c,h){const m=this.createSegments(o,s.segments,c,h);let y={};return Object.entries(s.children).forEach(([w,M])=>{y[w]=this.createSegmentGroup(o,M,c,h)}),new Tr(m,y)}createSegments(o,s,c,h){return s.map(m=>m.path.startsWith(":")?this.findPosParam(o,m,h):this.findOrReturn(m,c))}findPosParam(o,s,c){const h=c[s.path.substring(1)];if(!h)throw new pe(4001,!1);return h}findOrReturn(o,s){let c=0;for(const h of s){if(h.path===o.path)return s.splice(c),h;c++}return o}}const EP={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function R6(r,o,s,c,h){const m=MP(r,o,s);return m.matched?(c=function t6(r,o){return r.providers&&!r._injector&&(r._injector=Qd(r.providers,o,`Route: ${r.path}`)),r._injector??o}(o,c),function S6(r,o,s,c){const h=o.canMatch;return h&&0!==h.length?Fe(h.map(y=>{const w=py(y,r);return yf(function _6(r){return r&&Kb(r.canMatch)}(w)?w.canMatch(o,s):r.runInContext(()=>w(o,s)))})).pipe(my(),ZL()):Fe(!0)}(c,o,s).pipe(On(y=>!0===y?m:{...EP}))):Fe(m)}function MP(r,o,s){if(""===o.path)return"full"===o.pathMatch&&(r.hasChildren()||s.length>0)?{...EP}:{matched:!0,consumedSegments:[],remainingSegments:s,parameters:{},positionalParamSegments:{}};const h=(o.matcher||uB)(s,r,o);if(!h)return{...EP};const m={};Object.entries(h.posParams??{}).forEach(([w,M])=>{m[w]=M.path});const y=h.consumed.length>0?{...m,...h.consumed[h.consumed.length-1].parameters}:m;return{matched:!0,consumedSegments:h.consumed,remainingSegments:s.slice(h.consumed.length),parameters:y,positionalParamSegments:h.posParams??{}}}function YL(r,o,s,c){return s.length>0&&function L6(r,o,s){return s.some(c=>QC(r,o,c)&&gc(c)!==pn)}(r,s,c)?{segmentGroup:new Tr(o,k6(c,new Tr(s,r.children))),slicedSegments:[]}:0===s.length&&function F6(r,o,s){return s.some(c=>QC(r,o,c))}(r,s,c)?{segmentGroup:new Tr(r.segments,O6(r,0,s,c,r.children)),slicedSegments:s}:{segmentGroup:new Tr(r.segments,r.children),slicedSegments:s}}function O6(r,o,s,c,h){const m={};for(const y of c)if(QC(r,s,y)&&!h[gc(y)]){const w=new Tr([],{});m[gc(y)]=w}return{...h,...m}}function k6(r,o){const s={};s[pn]=o;for(const c of r)if(""===c.path&&gc(c)!==pn){const h=new Tr([],{});s[gc(c)]=h}return s}function QC(r,o,s){return(!(r.hasChildren()||o.length>0)||"full"!==s.pathMatch)&&""===s.path}class V6{constructor(o,s,c,h,m,y,w){this.injector=o,this.configLoader=s,this.rootComponentType=c,this.config=h,this.urlTree=m,this.paramsInheritanceStrategy=y,this.urlSerializer=w,this.allowRedirects=!0,this.applyRedirects=new P6(this.urlSerializer,this.urlTree)}noMatchError(o){return new pe(4002,!1)}recognize(){const o=YL(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,o,pn).pipe(Bm(s=>{if(s instanceof WL)return this.allowRedirects=!1,this.urlTree=s.urlTree,this.match(s.urlTree);throw s instanceof KC?this.noMatchError(s):s}),On(s=>{const c=new WC([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},pn,this.rootComponentType,null,{}),h=new gh(c,s),m=new NL("",h),y=function AB(r,o,s=null,c=null){return TL(ML(r),o,s,c)}(c,[],this.urlTree.queryParams,this.urlTree.fragment);return y.queryParams=this.urlTree.queryParams,m.url=this.urlSerializer.serialize(y),this.inheritParamsAndData(m._root),{state:m,tree:y}}))}match(o){return this.processSegmentGroup(this.injector,this.config,o.root,pn).pipe(Bm(c=>{throw c instanceof KC?this.noMatchError(c):c}))}inheritParamsAndData(o){const s=o.value,c=FL(s,this.paramsInheritanceStrategy);s.params=Object.freeze(c.params),s.data=Object.freeze(c.data),o.children.forEach(h=>this.inheritParamsAndData(h))}processSegmentGroup(o,s,c,h){return 0===c.segments.length&&c.hasChildren()?this.processChildren(o,s,c):this.processSegment(o,s,c,c.segments,h,!0)}processChildren(o,s,c){const h=[];for(const m of Object.keys(c.children))"primary"===m?h.unshift(m):h.push(m);return hi(h).pipe(ry(m=>{const y=c.children[m],w=function o6(r,o){const s=r.filter(c=>gc(c)===o);return s.push(...r.filter(c=>gc(c)!==o)),s}(s,m);return this.processSegmentGroup(o,w,y,m)}),function oB(r,o){return ci(function iB(r,o,s,c,h){return(m,y)=>{let w=s,M=o,S=0;m.subscribe(Ar(y,O=>{const F=S++;M=w?r(M,O,F):(w=!0,O),c&&y.next(M)},h&&(()=>{w&&y.next(M),y.complete()})))}}(r,o,arguments.length>=2,!0))}((m,y)=>(m.push(...y),m)),BC(null),function sB(r,o){const s=arguments.length>=2;return c=>c.pipe(r?mh((h,m)=>r(h,m,c)):Xa,lP(1),s?BC(o):hL(()=>new zC))}(),ni(m=>{if(null===m)return gy(c);const y=JL(m);return function j6(r){r.sort((o,s)=>o.value.outlet===pn?-1:s.value.outlet===pn?1:o.value.outlet.localeCompare(s.value.outlet))}(y),Fe(y)}))}processSegment(o,s,c,h,m,y){return hi(s).pipe(ry(w=>this.processSegmentAgainstRoute(w._injector??o,s,w,c,h,m,y).pipe(Bm(M=>{if(M instanceof KC)return Fe(null);throw M}))),zm(w=>!!w),Bm(w=>{if(qL(w))return function z6(r,o,s){return 0===o.length&&!r.children[s]}(c,h,m)?Fe([]):gy(c);throw w}))}processSegmentAgainstRoute(o,s,c,h,m,y,w){return function N6(r,o,s,c){return!!(gc(r)===c||c!==pn&&QC(o,s,r))&&("**"===r.path||MP(o,r,s).matched)}(c,h,m,y)?void 0===c.redirectTo?this.matchSegmentAgainstRoute(o,h,c,m,y,w):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(o,h,s,c,m,y):gy(h):gy(h)}expandSegmentAgainstRouteUsingRedirect(o,s,c,h,m,y){return"**"===h.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(o,c,h,y):this.expandRegularSegmentAgainstRouteUsingRedirect(o,s,c,h,m,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(o,s,c,h){const m=this.applyRedirects.applyRedirectCommands([],c.redirectTo,{});return c.redirectTo.startsWith("/")?XL(m):this.applyRedirects.lineralizeSegments(c,m).pipe(ni(y=>{const w=new Tr(y,{});return this.processSegment(o,s,w,y,h,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(o,s,c,h,m,y){const{matched:w,consumedSegments:M,remainingSegments:S,positionalParamSegments:O}=MP(s,h,m);if(!w)return gy(s);const F=this.applyRedirects.applyRedirectCommands(M,h.redirectTo,O);return h.redirectTo.startsWith("/")?XL(F):this.applyRedirects.lineralizeSegments(h,F).pipe(ni($=>this.processSegment(o,c,s,$.concat(S),y,!1)))}matchSegmentAgainstRoute(o,s,c,h,m,y){let w;if("**"===c.path){const M=h.length>0?fL(h).parameters:{};w=Fe({snapshot:new WC(h,M,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,KL(c),gc(c),c.component??c._loadedComponent??null,c,QL(c)),consumedSegments:[],remainingSegments:[]}),s.children={}}else w=R6(s,c,h,o).pipe(On(({matched:M,consumedSegments:S,remainingSegments:O,parameters:F})=>M?{snapshot:new WC(S,F,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,KL(c),gc(c),c.component??c._loadedComponent??null,c,QL(c)),consumedSegments:S,remainingSegments:O}:null));return w.pipe(ro(M=>null===M?gy(s):this.getChildConfig(o=c._injector??o,c,h).pipe(ro(({routes:S})=>{const O=c._loadedInjector??o,{snapshot:F,consumedSegments:$,remainingSegments:Y}=M,{segmentGroup:se,slicedSegments:he}=YL(s,$,Y,S);if(0===he.length&&se.hasChildren())return this.processChildren(O,S,se).pipe(On(be=>null===be?null:[new gh(F,be)]));if(0===S.length&&0===he.length)return Fe([new gh(F,[])]);const _e=gc(c)===m;return this.processSegment(O,S,se,he,_e?pn:m,!0).pipe(On(be=>[new gh(F,be)]))}))))}getChildConfig(o,s,c){return s.children?Fe({routes:s.children,injector:o}):s.loadChildren?void 0!==s._loadedRoutes?Fe({routes:s._loadedRoutes,injector:s._loadedInjector}):function D6(r,o,s,c){const h=o.canLoad;return void 0===h||0===h.length?Fe(!0):Fe(h.map(y=>{const w=py(y,r);return yf(function f6(r){return r&&Kb(r.canLoad)}(w)?w.canLoad(o,s):r.runInContext(()=>w(o,s)))})).pipe(my(),ZL())}(o,s,c).pipe(ni(h=>h?this.configLoader.loadChildren(o,s).pipe(_s(m=>{s._loadedRoutes=m.routes,s._loadedInjector=m.injector})):function A6(r){return zb(UL(!1,3))}())):Fe({routes:[],injector:o})}}function U6(r){const o=r.value.routeConfig;return o&&""===o.path}function JL(r){const o=[],s=new Set;for(const c of r){if(!U6(c)){o.push(c);continue}const h=o.find(m=>c.value.routeConfig===m.value.routeConfig);void 0!==h?(h.children.push(...c.children),s.add(h)):o.push(c)}for(const c of s){const h=JL(c.children);o.push(new gh(c.value,h))}return o.filter(c=>!s.has(c))}function KL(r){return r.data||{}}function QL(r){return r.resolve||{}}function eF(r){return"string"==typeof r.title||null===r.title}function TP(r){return ro(o=>{const s=r(o);return s?hi(s).pipe(On(()=>o)):Fe(o)})}const _y=new at("ROUTES");let CP=(()=>{class r{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=lt(xb)}loadComponent(s){if(this.componentLoaders.get(s))return this.componentLoaders.get(s);if(s._loadedComponent)return Fe(s._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(s);const c=yf(s.loadComponent()).pipe(On(tF),_s(m=>{this.onLoadEndListener&&this.onLoadEndListener(s),s._loadedComponent=m}),Pb(()=>{this.componentLoaders.delete(s)})),h=new uL(c,()=>new Mi).pipe(aP());return this.componentLoaders.set(s,h),h}loadChildren(s,c){if(this.childrenLoaders.get(c))return this.childrenLoaders.get(c);if(c._loadedRoutes)return Fe({routes:c._loadedRoutes,injector:c._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(c);const m=function X6(r,o,s,c){return yf(r.loadChildren()).pipe(On(tF),ni(h=>h instanceof z1||Array.isArray(h)?Fe(h):hi(o.compileModuleAsync(h))),On(h=>{c&&c(r);let m,y,w=!1;return Array.isArray(h)?(y=h,!0):(m=h.create(s).injector,y=m.get(_y,[],{optional:!0,self:!0}).flat()),{routes:y.map(wP),injector:m}}))}(c,this.compiler,s,this.onLoadEndListener).pipe(Pb(()=>{this.childrenLoaders.delete(c)})),y=new uL(m,()=>new Mi).pipe(aP());return this.childrenLoaders.set(c,y),y}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function tF(r){return function Y6(r){return r&&"object"==typeof r&&"default"in r}(r)?r.default:r}let eD=(()=>{class r{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Mi,this.transitionAbortSubject=new Mi,this.configLoader=lt(CP),this.environmentInjector=lt(cs),this.urlSerializer=lt(jb),this.rootContexts=lt(Zb),this.inputBindingEnabled=null!==lt(XC,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Fe(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=h=>this.events.next(new UB(h)),this.configLoader.onLoadStartListener=h=>this.events.next(new jB(h))}complete(){this.transitions?.complete()}handleNavigationRequest(s){const c=++this.navigationId;this.transitions?.next({...this.transitions.value,...s,id:c})}setupNavigations(s,c,h){return this.transitions=new Ui({id:0,currentUrlTree:c,currentRawUrl:c,currentBrowserUrl:c,extractedUrl:s.urlHandlingStrategy.extract(c),urlAfterRedirects:s.urlHandlingStrategy.extract(c),rawUrl:c,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Gb,restoredState:null,currentSnapshot:h.snapshot,targetSnapshot:null,currentRouterState:h,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(mh(m=>0!==m.id),On(m=>({...m,extractedUrl:s.urlHandlingStrategy.extract(m.rawUrl)})),ro(m=>{this.currentTransition=m;let y=!1,w=!1;return Fe(m).pipe(_s(M=>{this.currentNavigation={id:M.id,initialUrl:M.rawUrl,extractedUrl:M.extractedUrl,trigger:M.source,extras:M.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),ro(M=>{const S=M.currentBrowserUrl.toString(),O=!s.navigated||M.extractedUrl.toString()!==S||S!==M.currentUrlTree.toString();if(!O&&"reload"!==(M.extras.onSameUrlNavigation??s.onSameUrlNavigation)){const $="";return this.events.next(new hy(M.id,this.urlSerializer.serialize(M.rawUrl),$,0)),M.resolve(null),ha}if(s.urlHandlingStrategy.shouldProcessUrl(M.rawUrl))return Fe(M).pipe(ro($=>{const Y=this.transitions?.getValue();return this.events.next(new qC($.id,this.urlSerializer.serialize($.extractedUrl),$.source,$.restoredState)),Y!==this.transitions?.getValue()?ha:Promise.resolve($)}),function $6(r,o,s,c,h,m){return ni(y=>function B6(r,o,s,c,h,m,y="emptyOnly"){return new V6(r,o,s,c,h,y,m).recognize()}(r,o,s,c,y.extractedUrl,h,m).pipe(On(({state:w,tree:M})=>({...y,targetSnapshot:w,urlAfterRedirects:M}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,s.config,this.urlSerializer,s.paramsInheritanceStrategy),_s($=>{m.targetSnapshot=$.targetSnapshot,m.urlAfterRedirects=$.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:$.urlAfterRedirects};const Y=new PL($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(Y)}));if(O&&s.urlHandlingStrategy.shouldProcessUrl(M.currentRawUrl)){const{id:$,extractedUrl:Y,source:se,restoredState:he,extras:_e}=M,be=new qC($,this.urlSerializer.serialize(Y),se,he);this.events.next(be);const me=LL(0,this.rootComponentType).snapshot;return this.currentTransition=m={...M,targetSnapshot:me,urlAfterRedirects:Y,extras:{..._e,skipLocationChange:!1,replaceUrl:!1}},Fe(m)}{const $="";return this.events.next(new hy(M.id,this.urlSerializer.serialize(M.extractedUrl),$,1)),M.resolve(null),ha}}),_s(M=>{const S=new NB(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot);this.events.next(S)}),On(M=>(this.currentTransition=m={...M,guards:l6(M.targetSnapshot,M.currentSnapshot,this.rootContexts)},m)),function x6(r,o){return ni(s=>{const{targetSnapshot:c,currentSnapshot:h,guards:{canActivateChecks:m,canDeactivateChecks:y}}=s;return 0===y.length&&0===m.length?Fe({...s,guardsResult:!0}):function v6(r,o,s,c){return hi(r).pipe(ni(h=>function C6(r,o,s,c,h){const m=o&&o.routeConfig?o.routeConfig.canDeactivate:null;return m&&0!==m.length?Fe(m.map(w=>{const M=Xb(o)??h,S=py(w,M);return yf(function g6(r){return r&&Kb(r.canDeactivate)}(S)?S.canDeactivate(r,o,s,c):M.runInContext(()=>S(r,o,s,c))).pipe(zm())})).pipe(my()):Fe(!0)}(h.component,h.route,s,o,c)),zm(h=>!0!==h,!0))}(y,c,h,r).pipe(ni(w=>w&&function d6(r){return"boolean"==typeof r}(w)?function b6(r,o,s,c){return hi(o).pipe(ry(h=>sP(function E6(r,o){return null!==r&&o&&o(new $B(r)),Fe(!0)}(h.route.parent,c),function w6(r,o){return null!==r&&o&&o(new GB(r)),Fe(!0)}(h.route,c),function T6(r,o,s){const c=o[o.length-1],m=o.slice(0,o.length-1).reverse().map(y=>function c6(r){const o=r.routeConfig?r.routeConfig.canActivateChild:null;return o&&0!==o.length?{node:r,guards:o}:null}(y)).filter(y=>null!==y).map(y=>cL(()=>Fe(y.guards.map(M=>{const S=Xb(y.node)??s,O=py(M,S);return yf(function m6(r){return r&&Kb(r.canActivateChild)}(O)?O.canActivateChild(c,r):S.runInContext(()=>O(c,r))).pipe(zm())})).pipe(my())));return Fe(m).pipe(my())}(r,h.path,s),function M6(r,o,s){const c=o.routeConfig?o.routeConfig.canActivate:null;if(!c||0===c.length)return Fe(!0);const h=c.map(m=>cL(()=>{const y=Xb(o)??s,w=py(m,y);return yf(function p6(r){return r&&Kb(r.canActivate)}(w)?w.canActivate(o,r):y.runInContext(()=>w(o,r))).pipe(zm())}));return Fe(h).pipe(my())}(r,h.route,s))),zm(h=>!0!==h,!0))}(c,m,r,o):Fe(w)),On(w=>({...s,guardsResult:w})))})}(this.environmentInjector,M=>this.events.next(M)),_s(M=>{if(m.guardsResult=M.guardsResult,jm(M.guardsResult))throw jL(0,M.guardsResult);const S=new zB(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot,!!M.guardsResult);this.events.next(S)}),mh(M=>!!M.guardsResult||(this.cancelNavigationTransition(M,"",3),!1)),TP(M=>{if(M.guards.canActivateChecks.length)return Fe(M).pipe(_s(S=>{const O=new BB(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(O)}),ro(S=>{let O=!1;return Fe(S).pipe(function H6(r,o){return ni(s=>{const{targetSnapshot:c,guards:{canActivateChecks:h}}=s;if(!h.length)return Fe(s);let m=0;return hi(h).pipe(ry(y=>function G6(r,o,s,c){const h=r.routeConfig,m=r._resolve;return void 0!==h?.title&&!eF(h)&&(m[Bb]=h.title),function q6(r,o,s,c){const h=function Z6(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}(r);if(0===h.length)return Fe({});const m={};return hi(h).pipe(ni(y=>function W6(r,o,s,c){const h=Xb(o)??c,m=py(r,h);return yf(m.resolve?m.resolve(o,s):h.runInContext(()=>m(o,s)))}(r[y],o,s,c).pipe(zm(),_s(w=>{m[y]=w}))),lP(1),function aB(r){return On(()=>r)}(m),Bm(y=>qL(y)?ha:zb(y)))}(m,r,o,c).pipe(On(y=>(r._resolvedData=y,r.data=FL(r,s).resolve,h&&eF(h)&&(r.data[Bb]=h.title),null)))}(y.route,c,r,o)),_s(()=>m++),lP(1),ni(y=>m===h.length?Fe(s):ha))})}(s.paramsInheritanceStrategy,this.environmentInjector),_s({next:()=>O=!0,complete:()=>{O||this.cancelNavigationTransition(S,"",2)}}))}),_s(S=>{const O=new VB(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(O)}))}),TP(M=>{const S=O=>{const F=[];O.routeConfig?.loadComponent&&!O.routeConfig._loadedComponent&&F.push(this.configLoader.loadComponent(O.routeConfig).pipe(_s($=>{O.component=$}),On(()=>{})));for(const $ of O.children)F.push(...S($));return F};return oP(S(M.targetSnapshot.root)).pipe(BC(),ly(1))}),TP(()=>this.afterPreactivation()),On(M=>{const S=function JB(r,o,s){const c=Wb(r,o._root,s?s._root:void 0);return new kL(c,o)}(s.routeReuseStrategy,M.targetSnapshot,M.currentRouterState);return this.currentTransition=m={...M,targetRouterState:S},m}),_s(()=>{this.events.next(new pP)}),((r,o,s,c)=>On(h=>(new a6(o,h.targetRouterState,h.currentRouterState,s,c).activate(r),h)))(this.rootContexts,s.routeReuseStrategy,M=>this.events.next(M),this.inputBindingEnabled),ly(1),_s({next:M=>{y=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new xf(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects))),s.titleStrategy?.updateTitle(M.targetRouterState.snapshot),M.resolve(!0)},complete:()=>{y=!0}}),function lB(r){return ci((o,s)=>{fn(r).subscribe(Ar(s,()=>s.complete(),_u)),!s.closed&&o.subscribe(s)})}(this.transitionAbortSubject.pipe(_s(M=>{throw M}))),Pb(()=>{y||w||this.cancelNavigationTransition(m,"",1),this.currentNavigation?.id===m.id&&(this.currentNavigation=null)}),Bm(M=>{if(w=!0,$L(M))this.events.next(new qb(m.id,this.urlSerializer.serialize(m.extractedUrl),M.message,M.cancellationCode)),function e6(r){return $L(r)&&jm(r.url)}(M)?this.events.next(new mP(M.url)):m.resolve(!1);else{this.events.next(new ZC(m.id,this.urlSerializer.serialize(m.extractedUrl),M,m.targetSnapshot??void 0));try{m.resolve(s.errorHandler(M))}catch(S){m.reject(S)}}return ha}))}))}cancelNavigationTransition(s,c,h){const m=new qb(s.id,this.urlSerializer.serialize(s.extractedUrl),c,h);this.events.next(m),s.resolve(!1)}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function nF(r){return r!==Gb}let rF=(()=>{class r{buildTitle(s){let c,h=s.root;for(;void 0!==h;)c=this.getResolvedTitleForRoute(h)??c,h=h.children.find(m=>m.outlet===pn);return c}getResolvedTitleForRoute(s){return s.data[Bb]}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:function(){return lt(J6)},providedIn:"root"})}return r})(),J6=(()=>{class r extends rF{constructor(s){super(),this.title=s}updateTitle(s){const c=this.buildTitle(s);void 0!==c&&this.title.setTitle(c)}static#e=this.\u0275fac=function(c){return new(c||r)(yt(RO))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),K6=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:function(){return lt(eV)},providedIn:"root"})}return r})();class Q6{shouldDetach(o){return!1}store(o,s){}shouldAttach(o){return!1}retrieve(o){return null}shouldReuseRoute(o,s){return o.routeConfig===s.routeConfig}}let eV=(()=>{class r extends Q6{static#e=this.\u0275fac=function(){let s;return function(h){return(s||(s=ii(r)))(h||r)}}();static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const tD=new at("",{providedIn:"root",factory:()=>({})});let tV=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:function(){return lt(nV)},providedIn:"root"})}return r})(),nV=(()=>{class r{shouldProcessUrl(s){return!0}extract(s){return s}merge(s,c){return s}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Qb=function(r){return r[r.COMPLETE=0]="COMPLETE",r[r.FAILED=1]="FAILED",r[r.REDIRECTING=2]="REDIRECTING",r}(Qb||{});function iF(r,o){r.events.pipe(mh(s=>s instanceof xf||s instanceof qb||s instanceof ZC||s instanceof hy),On(s=>s instanceof xf||s instanceof hy?Qb.COMPLETE:s instanceof qb&&(0===s.code||1===s.code)?Qb.REDIRECTING:Qb.FAILED),mh(s=>s!==Qb.REDIRECTING),ly(1)).subscribe(()=>{o()})}function rV(r){throw r}function iV(r,o,s){return o.parse("/")}const oV={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},sV={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Dl=(()=>{class r{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=lt(iC),this.isNgZoneEnabled=!1,this._events=new Mi,this.options=lt(tD,{optional:!0})||{},this.pendingTasks=lt(lh),this.errorHandler=this.options.errorHandler||rV,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||iV,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=lt(tV),this.routeReuseStrategy=lt(K6),this.titleStrategy=lt(rF),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=lt(_y,{optional:!0})?.flat()??[],this.navigationTransitions=lt(eD),this.urlSerializer=lt(jb),this.location=lt(u3),this.componentInputBindingEnabled=!!lt(XC,{optional:!0}),this.eventsSubscription=new ie,this.isNgZoneEnabled=lt(hr)instanceof hr&&hr.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new uy,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=LL(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(s=>{this.lastSuccessfulId=s.id,this.currentPageId=this.browserPageId},s=>{this.console.warn(`Unhandled Navigation Error: ${s}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const s=this.navigationTransitions.events.subscribe(c=>{try{const{currentTransition:h}=this.navigationTransitions;if(null===h)return void(oF(c)&&this._events.next(c));if(c instanceof qC)nF(h.source)&&(this.browserUrlTree=h.extractedUrl);else if(c instanceof hy)this.rawUrlTree=h.rawUrl;else if(c instanceof PL){if("eager"===this.urlUpdateStrategy){if(!h.extras.skipLocationChange){const m=this.urlHandlingStrategy.merge(h.urlAfterRedirects,h.rawUrl);this.setBrowserUrl(m,h)}this.browserUrlTree=h.urlAfterRedirects}}else if(c instanceof pP)this.currentUrlTree=h.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(h.urlAfterRedirects,h.rawUrl),this.routerState=h.targetRouterState,"deferred"===this.urlUpdateStrategy&&(h.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,h),this.browserUrlTree=h.urlAfterRedirects);else if(c instanceof qb)0!==c.code&&1!==c.code&&(this.navigated=!0),(3===c.code||2===c.code)&&this.restoreHistory(h);else if(c instanceof mP){const m=this.urlHandlingStrategy.merge(c.url,h.currentRawUrl),y={skipLocationChange:h.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||nF(h.source)};this.scheduleNavigation(m,Gb,null,y,{resolve:h.resolve,reject:h.reject,promise:h.promise})}c instanceof ZC&&this.restoreHistory(h,!0),c instanceof xf&&(this.navigated=!0),oF(c)&&this._events.next(c)}catch(h){this.navigationTransitions.transitionAbortSubject.next(h)}});this.eventsSubscription.add(s)}resetRootComponentType(s){this.routerState.root.component=s,this.navigationTransitions.rootComponentType=s}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const s=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Gb,s)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(s=>{const c="popstate"===s.type?"popstate":"hashchange";"popstate"===c&&setTimeout(()=>{this.navigateToSyncWithBrowser(s.url,c,s.state)},0)}))}navigateToSyncWithBrowser(s,c,h){const m={replaceUrl:!0},y=h?.navigationId?h:null;if(h){const M={...h};delete M.navigationId,delete M.\u0275routerPageId,0!==Object.keys(M).length&&(m.state=M)}const w=this.parseUrl(s);this.scheduleNavigation(w,c,y,m)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(s){this.config=s.map(wP),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(s,c={}){const{relativeTo:h,queryParams:m,fragment:y,queryParamsHandling:w,preserveFragment:M}=c,S=M?this.currentUrlTree.fragment:y;let F,O=null;switch(w){case"merge":O={...this.currentUrlTree.queryParams,...m};break;case"preserve":O=this.currentUrlTree.queryParams;break;default:O=m||null}null!==O&&(O=this.removeEmptyProps(O));try{F=ML(h?h.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof s[0]||!s[0].startsWith("/"))&&(s=[]),F=this.currentUrlTree.root}return TL(F,s,O,S??null)}navigateByUrl(s,c={skipLocationChange:!1}){const h=jm(s)?s:this.parseUrl(s),m=this.urlHandlingStrategy.merge(h,this.rawUrlTree);return this.scheduleNavigation(m,Gb,null,c)}navigate(s,c={skipLocationChange:!1}){return function aV(r){for(let o=0;o<r.length;o++)if(null==r[o])throw new pe(4008,!1)}(s),this.navigateByUrl(this.createUrlTree(s,c),c)}serializeUrl(s){return this.urlSerializer.serialize(s)}parseUrl(s){let c;try{c=this.urlSerializer.parse(s)}catch(h){c=this.malformedUriErrorHandler(h,this.urlSerializer,s)}return c}isActive(s,c){let h;if(h=!0===c?{...oV}:!1===c?{...sV}:c,jm(s))return mL(this.currentUrlTree,s,h);const m=this.parseUrl(s);return mL(this.currentUrlTree,m,h)}removeEmptyProps(s){return Object.keys(s).reduce((c,h)=>{const m=s[h];return null!=m&&(c[h]=m),c},{})}scheduleNavigation(s,c,h,m,y){if(this.disposed)return Promise.resolve(!1);let w,M,S;y?(w=y.resolve,M=y.reject,S=y.promise):S=new Promise((F,$)=>{w=F,M=$});const O=this.pendingTasks.add();return iF(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(O))}),this.navigationTransitions.handleNavigationRequest({source:c,restoredState:h,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:s,extras:m,resolve:w,reject:M,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(F=>Promise.reject(F))}setBrowserUrl(s,c){const h=this.urlSerializer.serialize(s);if(this.location.isCurrentPathEqualTo(h)||c.extras.replaceUrl){const y={...c.extras.state,...this.generateNgRouterState(c.id,this.browserPageId)};this.location.replaceState(h,"",y)}else{const m={...c.extras.state,...this.generateNgRouterState(c.id,this.browserPageId+1)};this.location.go(h,"",m)}}restoreHistory(s,c=!1){if("computed"===this.canceledNavigationResolution){const m=this.currentPageId-this.browserPageId;0!==m?this.location.historyGo(m):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===m&&(this.resetState(s),this.browserUrlTree=s.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(c&&this.resetState(s),this.resetUrlToCurrentUrlTree())}resetState(s){this.routerState=s.currentRouterState,this.currentUrlTree=s.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,s.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(s,c){return"computed"===this.canceledNavigationResolution?{navigationId:s,\u0275routerPageId:c}:{navigationId:s}}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function oF(r){return!(r instanceof pP||r instanceof mP)}class sF{}let uV=(()=>{class r{constructor(s,c,h,m,y){this.router=s,this.injector=h,this.preloadingStrategy=m,this.loader=y}setUpPreloading(){this.subscription=this.router.events.pipe(mh(s=>s instanceof xf),ry(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(s,c){const h=[];for(const m of c){m.providers&&!m._injector&&(m._injector=Qd(m.providers,s,`Route: ${m.path}`));const y=m._injector??s,w=m._loadedInjector??y;(m.loadChildren&&!m._loadedRoutes&&void 0===m.canLoad||m.loadComponent&&!m._loadedComponent)&&h.push(this.preloadConfig(y,m)),(m.children||m._loadedRoutes)&&h.push(this.processRoutes(w,m.children??m._loadedRoutes))}return hi(h).pipe(Sc())}preloadConfig(s,c){return this.preloadingStrategy.preload(c,()=>{let h;h=c.loadChildren&&void 0===c.canLoad?this.loader.loadChildren(s,c):Fe(null);const m=h.pipe(ni(y=>null===y?Fe(void 0):(c._loadedRoutes=y.routes,c._loadedInjector=y.injector,this.processRoutes(y.injector??s,y.routes))));return c.loadComponent&&!c._loadedComponent?hi([m,this.loader.loadComponent(c)]).pipe(Sc()):m})}static#e=this.\u0275fac=function(c){return new(c||r)(yt(Dl),yt(xb),yt(cs),yt(sF),yt(CP))};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const SP=new at("");let aF=(()=>{class r{constructor(s,c,h,m,y={}){this.urlSerializer=s,this.transitions=c,this.viewportScroller=h,this.zone=m,this.options=y,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},y.scrollPositionRestoration=y.scrollPositionRestoration||"disabled",y.anchorScrolling=y.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(s=>{s instanceof qC?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=s.navigationTrigger,this.restoredId=s.restoredState?s.restoredState.navigationId:0):s instanceof xf?(this.lastId=s.id,this.scheduleScrollEvent(s,this.urlSerializer.parse(s.urlAfterRedirects).fragment)):s instanceof hy&&0===s.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(s,this.urlSerializer.parse(s.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(s=>{s instanceof RL&&(s.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(s.position):s.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(s.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(s,c){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new RL(s,"popstate"===this.lastSource?this.store[this.restoredId]:null,c))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(c){!function Hn(){throw new Error("invalid")}()};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac})}return r})();function _h(r,o){return{\u0275kind:r,\u0275providers:o}}function cF(){const r=lt(qi);return o=>{const s=r.get(ae);if(o!==s.components[0])return;const c=r.get(Dl),h=r.get(uF);1===r.get(IP)&&c.initialNavigation(),r.get(hF,null,Ht.Optional)?.setUpPreloading(),r.get(SP,null,Ht.Optional)?.init(),c.resetRootComponentType(s.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}const uF=new at("",{factory:()=>new Mi}),IP=new at("",{providedIn:"root",factory:()=>1}),hF=new at("");function pV(r){return _h(0,[{provide:hF,useExisting:uV},{provide:sF,useExisting:r}])}const dF=new at("ROUTER_FORROOT_GUARD"),gV=[u3,{provide:jb,useClass:cP},Dl,Zb,{provide:fy,useFactory:function lF(r){return r.routerState.root},deps:[Dl]},CP,[]];function _V(){return new z("Router",Dl)}let fF=(()=>{class r{constructor(s){}static forRoot(s,c){return{ngModule:r,providers:[gV,[],{provide:_y,multi:!0,useValue:s},{provide:dF,useFactory:bV,deps:[[Dl,new ap,new lp]]},{provide:tD,useValue:c||{}},c?.useHash?{provide:km,useClass:QF}:{provide:km,useClass:XR},{provide:SP,useFactory:()=>{const r=lt(vN),o=lt(hr),s=lt(tD),c=lt(eD),h=lt(jb);return s.scrollOffset&&r.setOffset(s.scrollOffset),new aF(h,c,r,o,s)}},c?.preloadingStrategy?pV(c.preloadingStrategy).\u0275providers:[],{provide:z,multi:!0,useFactory:_V},c?.initialNavigation?wV(c):[],c?.bindToComponentInputs?_h(8,[VL,{provide:XC,useExisting:VL}]).\u0275providers:[],[{provide:pF,useFactory:cF},{provide:I,multi:!0,useExisting:pF}]]}}static forChild(s){return{ngModule:r,providers:[{provide:_y,multi:!0,useValue:s}]}}static#e=this.\u0275fac=function(c){return new(c||r)(yt(dF,8))};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({})}return r})();function bV(r){return"guarded"}function wV(r){return["disabled"===r.initialNavigation?_h(3,[{provide:gb,multi:!0,useFactory:()=>{const o=lt(Dl);return()=>{o.setUpLocationChangeListener()}}},{provide:IP,useValue:2}]).\u0275providers:[],"enabledBlocking"===r.initialNavigation?_h(2,[{provide:IP,useValue:0},{provide:gb,multi:!0,deps:[qi],useFactory:o=>{const s=o.get(JF,Promise.resolve());return()=>s.then(()=>new Promise(c=>{const h=o.get(Dl),m=o.get(uF);iF(h,()=>{c(!0)}),o.get(eD).afterPreactivation=()=>(c(!0),m.closed?Fe(void 0):m),h.initialNavigation()}))}}]).\u0275providers:[]]}const pF=new at("");var MV=gu(574),AP=gu.n(MV),Io=Math.PI,Yr=2*Io,Um=Io/180,mF=180/Io,sa=6378.135,mu=60/Math.sqrt(sa*sa*sa/398600.8),nD=sa*mu/60,yF=1/mu,vf=.001082616,bf=-253881e-11/vf,yy=2/3;function wF(r,o,s,c,h,m){var y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return 367*r-Math.floor(7*(r+Math.floor((o+9)/12))*.25)+Math.floor(275*o/9)+s+1721013.5+((y/6e4+m/60+h)/60+c)/24}function PP(r,o,s,c,h,m,y){if(r instanceof Date){var w=r;return wF(w.getUTCFullYear(),w.getUTCMonth()+1,w.getUTCDate(),w.getUTCHours(),w.getUTCMinutes(),w.getUTCSeconds(),w.getUTCMilliseconds())}return wF(r,o,s,c,h,m,y)}function EF(r,o){var Vt,Qt,Nr,Zn,Kr,Sr,Vn,mr,li,Qn,Wn,gr,jn,Mn,Hr,Qr,vr,Ir,s=r.e3,c=r.ee2,h=r.peo,m=r.pgho,y=r.pho,w=r.pinco,M=r.plo,S=r.se2,O=r.se3,F=r.sgh2,$=r.sgh3,Y=r.sgh4,se=r.sh2,he=r.sh3,_e=r.si2,be=r.si3,me=r.sl2,Ue=r.sl3,Qe=r.sl4,dt=r.t,ft=r.xgh2,tn=r.xgh3,Ln=r.xgh4,Bn=r.xh2,Jr=r.xh3,pr=r.xi2,Rn=r.xi3,bi=r.xl2,Ur=r.xl3,mi=r.xl4,En=r.zmol,wi=r.zmos,$r=o.init,Fr=o.opsmode,zi=o.ep,gi=o.inclp,cn=o.nodep,Ao=o.argpp,Bi=o.mp;Ir=wi+119459e-10*dt,"y"===$r&&(Ir=wi),vr=Ir+.0335*Math.sin(Ir);var ys=S*(Vn=.5*(Mn=Math.sin(vr))*Mn-.25)+O*(mr=-.5*Mn*Math.cos(vr)),xs=_e*Vn+be*mr,Yi=me*Vn+Ue*mr+Qe*Mn,ji=F*Vn+$*mr+Y*Mn,Ji=se*Vn+he*mr;return Ir=En+.00015835218*dt,"y"===$r&&(Ir=En),vr=Ir+.1098*Math.sin(Ir),li=ys+(c*(Vn=.5*(Mn=Math.sin(vr))*Mn-.25)+s*(mr=-.5*Mn*Math.cos(vr))),gr=xs+(pr*Vn+Rn*mr),jn=Yi+(bi*Vn+Ur*mr+mi*Mn),Qn=ji+(ft*Vn+tn*mr+Ln*Mn),Wn=Ji+(Bn*Vn+Jr*mr),"n"===$r&&(jn-=M,Qn-=m,Wn-=y,gi+=gr-=w,zi+=li-=h,Zn=Math.sin(gi),Nr=Math.cos(gi),gi>=.2?(Ao+=Qn-=Nr*(Wn/=Zn),cn+=Wn,Bi+=jn):(Vt=Zn*(Sr=Math.sin(cn)),Qt=Zn*(Kr=Math.cos(cn)),Vt+=Wn*Kr+gr*Nr*Sr,Qt+=-Wn*Sr+gr*Nr*Kr,(cn%=Yr)<0&&"a"===Fr&&(cn+=Yr),Hr=Bi+Ao+Nr*cn,Hr+=jn+Qn-gr*cn*Zn,Qr=cn,(cn=Math.atan2(Vt,Qt))<0&&"a"===Fr&&(cn+=Yr),Math.abs(Qr-cn)>Io&&(cn<Qr?cn+=Yr:cn-=Yr),Ao=Hr-(Bi+=jn)-Nr*cn)),{ep:zi,inclp:gi,nodep:cn,argpp:Ao,mp:Bi}}function MF(r){var o=(r-2451545)/36525,s=-62e-7*o*o*o+.093104*o*o+3164400184.812866*o+67310.54841;return(s=s*Um/240%Yr)<0&&(s+=Yr),s}function TF(){return(arguments.length<=0?void 0:arguments[0])instanceof Date||arguments.length>1?MF(PP.apply(void 0,arguments)):MF.apply(void 0,arguments)}function CF(r,o){var s,c,h,m,y,M,S,O,F,$,Y,se,_e,be,me,Ue,Qe,dt,ft,tn,Ln,Bn,Jr,pr,Rn;r.t=o,r.error=0;var Ur=r.mo+r.mdot*r.t,mi=r.argpo+r.argpdot*r.t;O=mi,ft=Ur;var wi=r.t*r.t;if(Ln=r.nodeo+r.nodedot*r.t+r.nodecf*wi,me=1-r.cc1*r.t,Ue=r.bstar*r.cc4*r.t,Qe=r.t2cof*wi,1!==r.isimp){M=r.omgcof*r.t;var $r=1+r.eta*Math.cos(Ur);ft=Ur+(be=M+r.xmcof*($r*$r*$r-r.delmo)),O=mi-be,me=me-r.d2*wi-r.d3*(Y=wi*r.t)-r.d4*(se=Y*r.t),Ue+=r.bstar*r.cc5*(Math.sin(ft)-r.sinmao),Qe=Qe+r.t3cof*Y+se*(r.t4cof+r.t*r.t5cof)}tn=r.no;var Fr=r.ecco;if(dt=r.inclo,"d"===r.method){var gi=function SV(r){var Wi,Vn,mr,li,Qn,Wn,gr,jn,o=r.irez,s=r.d2201,c=r.d2211,h=r.d3210,m=r.d3222,y=r.d4410,w=r.d4422,M=r.d5220,S=r.d5232,O=r.d5421,F=r.d5433,Y=r.del1,se=r.del2,he=r.del3,Qe=r.argpo,dt=r.argpdot,ft=r.t,Bn=r.xfact,Jr=r.xlamo,pr=r.no,Rn=r.atime,bi=r.em,Ur=r.argpm,mi=r.inclm,En=r.xli,wi=r.mm,$r=r.xni,Fr=r.nodem,zi=r.nm,gi=.13130908,cn=2.8843198,Ao=.37448087,Bi=5.7686396,Vt=.95240898,Qt=1.8014998,Nr=1.050833,Zn=4.4108898,Mn=0,Hr=0,Qr=(r.gsto+.0043752690880113*r.tc)%Yr;if(bi+=r.dedt*ft,mi+=r.didt*ft,Ur+=r.domdt*ft,Fr+=r.dnodt*ft,wi+=r.dmdt*ft,0!==o){(0===Rn||ft*Rn<=0||Math.abs(ft)<Math.abs(Rn))&&(Rn=0,$r=pr,En=Jr),Wi=ft>0?720:-720;for(var vr=381;381===vr;)2!==o?(gr=Y*Math.sin(En-gi)+se*Math.sin(2*(En-cn))+he*Math.sin(3*(En-Ao)),Qn=$r+Bn,Wn=Y*Math.cos(En-gi)+2*se*Math.cos(2*(En-cn))+3*he*Math.cos(3*(En-Ao)),Wn*=Qn):(mr=(jn=Qe+dt*Rn)+jn,Vn=En+En,gr=s*Math.sin(mr+En-Bi)+c*Math.sin(En-Bi)+h*Math.sin(jn+En-Vt)+m*Math.sin(-jn+En-Vt)+y*Math.sin(mr+Vn-Qt)+w*Math.sin(Vn-Qt)+M*Math.sin(jn+En-Nr)+S*Math.sin(-jn+En-Nr)+O*Math.sin(jn+Vn-Zn)+F*Math.sin(-jn+Vn-Zn),Qn=$r+Bn,Wn=s*Math.cos(mr+En-Bi)+c*Math.cos(En-Bi)+h*Math.cos(jn+En-Vt)+m*Math.cos(-jn+En-Vt)+M*Math.cos(jn+En-Nr)+S*Math.cos(-jn+En-Nr)+2*(y*Math.cos(mr+Vn-Qt)+w*Math.cos(Vn-Qt)+O*Math.cos(jn+Vn-Zn)+F*Math.cos(-jn+Vn-Zn)),Wn*=Qn),Math.abs(ft-Rn)>=720?vr=381:(Hr=ft-Rn,vr=0),381===vr&&(En+=Qn*Wi+259200*gr,$r+=gr*Wi+259200*Wn,Rn+=Wi);zi=$r+gr*Hr+Wn*Hr*Hr*.5,li=En+Qn*Hr+gr*Hr*Hr*.5,1!==o?(wi=li-2*Fr+2*Qr,Mn=zi-pr):(wi=li-Fr-Ur+Qr,Mn=zi-pr),zi=pr+Mn}return{atime:Rn,em:bi,argpm:Ur,inclm:mi,xli:En,mm:wi,xni:$r,nodem:Fr,dndt:Mn,nm:zi}}({irez:r.irez,d2201:r.d2201,d2211:r.d2211,d3210:r.d3210,d3222:r.d3222,d4410:r.d4410,d4422:r.d4422,d5220:r.d5220,d5232:r.d5232,d5421:r.d5421,d5433:r.d5433,dedt:r.dedt,del1:r.del1,del2:r.del2,del3:r.del3,didt:r.didt,dmdt:r.dmdt,dnodt:r.dnodt,domdt:r.domdt,argpo:r.argpo,argpdot:r.argpdot,t:r.t,tc:r.t,gsto:r.gsto,xfact:r.xfact,xlamo:r.xlamo,no:r.no,atime:r.atime,em:Fr,argpm:O,inclm:dt,xli:r.xli,mm:ft,xni:r.xni,nodem:Ln,nm:tn});Fr=gi.em,O=gi.argpm,dt=gi.inclm,ft=gi.mm,Ln=gi.nodem,tn=gi.nm}if(tn<=0)return r.error=2,[!1,!1];var cn=Math.pow(mu/tn,yy)*me*me;if(tn=mu/Math.pow(cn,1.5),(Fr-=Ue)>=1||Fr<-.001)return r.error=1,[!1,!1];Fr<1e-6&&(Fr=1e-6),Jr=(ft+=r.no*Qe)+O+Ln;var Vt=Fr;if(Bn=dt,F=O%=Yr,Rn=Ln%=Yr,pr=ft=((Jr%=Yr)-O-Ln)%Yr,m=Math.sin(dt),h=Math.cos(dt),"d"===r.method){var Nr=EF(r,{inclo:r.inclo,init:"n",ep:Vt,inclp:Bn,nodep:Rn,argpp:F,mp:pr,opsmode:r.operationmode});if(Rn=Nr.nodep,F=Nr.argpp,pr=Nr.mp,(Bn=Nr.inclp)<0&&(Bn=-Bn,Rn+=Io,F-=Io),(Vt=Nr.ep)<0||Vt>1)return r.error=3,[!1,!1]}"d"===r.method&&(m=Math.sin(Bn),h=Math.cos(Bn),r.aycof=-.5*bf*m,r.xlcof=Math.abs(h+1)>15e-13?-.25*bf*m*(3+5*h)/(1+h):-.25*bf*m*(3+5*h)/15e-13);var Zn=Vt*Math.cos(F);be=1/(cn*(1-Vt*Vt));var Kr=Vt*Math.sin(F)+be*r.aycof,Go=(pr+F+Rn+be*r.xlcof*Zn-Rn)%Yr;S=Go,_e=9999.9;for(var _i=1;Math.abs(_e)>=1e-12&&_i<=10;)c=Math.sin(S),_e=(Go-Kr*(s=Math.cos(S))+Zn*c-S)/(_e=1-s*Zn-c*Kr),Math.abs(_e)>=.95&&(_e=_e>0?.95:-.95),S+=_e,_i+=1;var Wi=Zn*s+Kr*c,Vn=Zn*c-Kr*s,mr=Zn*Zn+Kr*Kr,li=cn*(1-mr);if(li<0)return r.error=4,[!1,!1];var Qn=cn*(1-Wi),Wn=Math.sqrt(cn)*Vn/Qn,gr=Math.sqrt(li)/Qn,jn=Math.sqrt(1-mr),Mn=cn/Qn*(c-Kr-Zn*(be=Vn/(1+jn))),Hr=cn/Qn*(s-Zn+Kr*be);$=Math.atan2(Mn,Hr);var Qr=(Hr+Hr)*Mn,vr=1-2*Mn*Mn,Ir=.5*vf*(be=1/li),Xi=Ir*be;"d"===r.method&&(r.con41=3*(y=h*h)-1,r.x1mth2=1-y,r.x7thm1=7*y-1);var Vi=Qn*(1-1.5*Xi*jn*r.con41)+.5*Ir*r.x1mth2*vr;if(Vi<1)return r.error=6,{position:!1,velocity:!1};$-=.25*Xi*r.x7thm1*Qr;var Po=Rn+1.5*Xi*h*Qr,mo=Bn+1.5*Xi*h*m*vr,ys=Wn-tn*Ir*r.x1mth2*Qr/mu,xs=gr+tn*Ir*(r.x1mth2*vr+1.5*r.con41)/mu,Yi=Math.sin($),ji=Math.cos($),Ji=Math.sin(Po),Ua=Math.cos(Po),Us=Math.sin(mo),yi=Math.cos(mo),Ki=-Ji*yi,_c=Ua*yi,aa=Ki*Yi+Ua*ji,Qi=_c*Yi+Ji*ji,yh=Us*Yi;return{position:{x:Vi*aa*sa,y:Vi*Qi*sa,z:Vi*yh*sa},velocity:{x:(ys*aa+xs*(Ki*ji-Ua*Yi))*nD,y:(ys*Qi+xs*(_c*ji-Ji*Yi))*nD,z:(ys*yh+xs*(Us*ji))*nD}}}function RP(r,o){(null==o||o>r.length)&&(o=r.length);for(var s=0,c=new Array(o);s<o;s++)c[s]=r[s];return c}function DF(r){return r*mF}let IF=(()=>{class r{constructor(){this.coordinatesSubject=new Mi,this.satelliteNameSubject=new Mi,this.tleLine1="1 38011U 11076E   23354.79367538  .00002248  00000+0  28953-3 0  9998",this.tleLine2="2 38011  97.7290  55.4537 0001608  87.9070   6.9436 14.82018237649692",this.satelliteName="Unnamed Satellite",this.updateSatelliteData()}get coordinates$(){return this.coordinatesSubject.asObservable()}get satelliteName$(){return this.satelliteNameSubject.asObservable()}updateSatelliteData(){this.intervalId=setInterval(()=>{const s=new Date,c=function AV(r,o){var h,c=1440/(2*Io),m={error:0};m.satnum=r.substring(2,7),m.epochyr=parseInt(r.substring(18,20),10),m.epochdays=parseFloat(r.substring(20,32)),m.ndot=parseFloat(r.substring(33,43)),m.nddot=parseFloat(".".concat(parseInt(r.substring(44,50),10),"E").concat(r.substring(50,52))),m.bstar=parseFloat("".concat(r.substring(53,54),".").concat(parseInt(r.substring(54,59),10),"E").concat(r.substring(59,61))),m.inclo=parseFloat(o.substring(8,16)),m.nodeo=parseFloat(o.substring(17,25)),m.ecco=parseFloat(".".concat(o.substring(26,33))),m.argpo=parseFloat(o.substring(34,42)),m.mo=parseFloat(o.substring(43,51)),m.no=parseFloat(o.substring(52,63)),m.no/=c,m.inclo*=Um,m.nodeo*=Um,m.argpo*=Um,m.mo*=Um;var y=function bF(r,o){for(var s=[31,r%4==0?29:28,31,30,31,30,31,31,30,31,30,31],c=Math.floor(o),h=1,m=0;c>m+s[h-1]&&h<12;)m+=s[h-1],h+=1;var y=h,w=c-m,M=24*(o-c),S=Math.floor(M);M=60*(M-S);var O=Math.floor(M);return{mon:y,day:w,hr:S,minute:O,sec:60*(M-O)}}(h=m.epochyr<57?m.epochyr+2e3:m.epochyr+1900,m.epochdays);return m.jdsatepoch=PP(h,y.mon,y.day,y.hr,y.minute,y.sec),function IV(r,o){var $,Y,se,_e,be,me,Ue,Qe,dt,ft,tn,Jr,Rn,bi,Ur,mi,En,wi,$r,Fr,zi,gi,cn,Ao,Bi,Vt,Qt,Nr,Zn,Kr,Sr,Go,_i,Wi,Vn,mr,Qn,Wn,gr,jn,Mn,Hr,Qr,vr,Ir,Xi,Vi,Po,mo,ys,xs,s=o.opsmode,c=o.satn,h=o.epoch,m=o.xbstar,y=o.xecco,w=o.xargpo,M=o.xinclo,S=o.xmo,O=o.xno,F=o.xnodeo;r.isimp=0,r.method="n",r.aycof=0,r.con41=0,r.cc1=0,r.cc4=0,r.cc5=0,r.d2=0,r.d3=0,r.d4=0,r.delmo=0,r.eta=0,r.argpdot=0,r.omgcof=0,r.sinmao=0,r.t=0,r.t2cof=0,r.t3cof=0,r.t4cof=0,r.t5cof=0,r.x1mth2=0,r.x7thm1=0,r.mdot=0,r.nodedot=0,r.xlcof=0,r.xmcof=0,r.nodecf=0,r.irez=0,r.d2201=0,r.d2211=0,r.d3210=0,r.d3222=0,r.d4410=0,r.d4422=0,r.d5220=0,r.d5232=0,r.d5421=0,r.d5433=0,r.dedt=0,r.del1=0,r.del2=0,r.del3=0,r.didt=0,r.dmdt=0,r.dnodt=0,r.domdt=0,r.e3=0,r.ee2=0,r.peo=0,r.pgho=0,r.pho=0,r.pinco=0,r.plo=0,r.se2=0,r.se3=0,r.sgh2=0,r.sgh3=0,r.sgh4=0,r.sh2=0,r.sh3=0,r.si2=0,r.si3=0,r.sl2=0,r.sl3=0,r.sl4=0,r.gsto=0,r.xfact=0,r.xgh2=0,r.xgh3=0,r.xgh4=0,r.xh2=0,r.xh3=0,r.xi2=0,r.xi3=0,r.xl2=0,r.xl3=0,r.xl4=0,r.xlamo=0,r.zmol=0,r.zmos=0,r.atime=0,r.xli=0,r.xni=0,r.bstar=m,r.ecco=y,r.argpo=w,r.inclo=M,r.mo=S,r.no=O,r.nodeo=F,r.operationmode=s;var ji=78/sa+1,Ji=42/sa,Ua=Ji*Ji*Ji*Ji;r.init="y",r.t=0;var yi=function DV(r){var o=r.ecco,s=r.epoch,c=r.inclo,h=r.opsmode,m=r.no,y=o*o,w=1-y,M=Math.sqrt(w),S=Math.cos(c),O=S*S,F=Math.pow(mu/m,yy),$=.75*vf*(3*O-1)/(M*w),Y=$/(F*F),se=F*(1-Y*Y-Y*(1/3+134*Y*Y/81));m/=1+(Y=$/(se*se));var Ln,he=Math.pow(mu/m,yy),_e=Math.sin(c),be=he*w,me=1-5*O,Ue=-me-O-O,Qe=1/he,dt=be*be,ft=he*(1-o);if("a"===h){var Bn=s-7305,Jr=Math.floor(Bn+1e-8),Rn=.017202791694070362;(Ln=(1.7321343856509375+Rn*Jr+(Rn+Yr)*(Bn-Jr)+Bn*Bn*5075514194322695e-30)%Yr)<0&&(Ln+=Yr)}else Ln=TF(s+2433281.5);return{no:m,method:"n",ainv:Qe,ao:he,con41:Ue,con42:me,cosio:S,cosio2:O,eccsq:y,omeosq:w,posq:dt,rp:ft,rteosq:M,sinio:_e,gsto:Ln}}({satn:c,ecco:r.ecco,epoch:h,inclo:r.inclo,no:r.no,method:r.method,opsmode:r.operationmode}),Ki=yi.ao,_c=yi.con42,aa=yi.cosio,Qi=yi.cosio2,yh=yi.eccsq,Sl=yi.omeosq,yc=yi.posq,Il=yi.rp,Al=yi.rteosq,qo=yi.sinio;if(r.no=yi.no,r.con41=yi.con41,r.gsto=yi.gsto,r.a=Math.pow(r.no*yF,-2/3),r.alta=r.a*(1+r.ecco)-1,r.altp=r.a*(1-r.ecco)-1,r.error=0,Sl>=0||r.no>=0){if(r.isimp=0,Il<220/sa+1&&(r.isimp=1),cn=ji,En=Ua,(bi=(Il-1)*sa)<156){cn=bi-78,bi<98&&(cn=20);var $s=(120-cn)/sa;En=$s*$s*$s*$s,cn=cn/sa+1}Ur=1/yc,r.eta=Ki*r.ecco*(Mn=1/(Ki-cn)),tn=r.eta*r.eta,ft=r.ecco*r.eta,mi=Math.abs(1-tn),me=(be=En*Math.pow(Mn,4))/Math.pow(mi,3.5),r.cc1=r.bstar*(me*r.no*(Ki*(1+1.5*tn+ft*(4+tn))+.375*vf*Mn/mi*r.con41*(8+3*tn*(8+tn)))),_e=0,r.ecco>1e-4&&(_e=-2*be*Mn*bf*r.no*qo/r.ecco),r.x1mth2=1-Qi,r.cc4=2*r.no*me*Ki*Sl*(r.eta*(2+.5*tn)+r.ecco*(.5+2*tn)-vf*Mn/(Ki*mi)*(-3*r.con41*(1-2*ft+tn*(1.5-.5*ft))+.75*r.x1mth2*(2*tn-ft*(1+tn))*Math.cos(2*r.argpo))),r.cc5=2*me*Ki*Sl*(1+2.75*(tn+ft)+ft*tn),jn=7.762359375e-7*Ur*Ur*r.no,r.mdot=r.no+.5*(Wn=1.5*vf*Ur*r.no)*Al*r.con41+.0625*(gr=.5*Wn*vf*Ur)*Al*(13-78*Qi+137*(Ue=Qi*Qi)),r.argpdot=-.5*Wn*_c+.0625*gr*(7-114*Qi+395*Ue)+jn*(3-36*Qi+49*Ue),r.nodedot=(Qr=-Wn*aa)+(.5*gr*(4-19*Qi)+2*jn*(3-7*Qi))*aa,Hr=r.argpdot+r.nodedot,r.omgcof=r.bstar*_e*Math.cos(r.argpo),r.xmcof=0,r.ecco>1e-4&&(r.xmcof=-yy*be*r.bstar/ft),r.nodecf=3.5*Sl*Qr*r.cc1,r.t2cof=1.5*r.cc1,r.xlcof=Math.abs(aa+1)>15e-13?-.25*bf*qo*(3+5*aa)/(1+aa):-.25*bf*qo*(3+5*aa)/15e-13,r.aycof=-.5*bf*qo;var Pl=1+r.eta*Math.cos(r.mo);if(r.delmo=Pl*Pl*Pl,r.sinmao=Math.sin(r.mo),r.x7thm1=7*Qi-1,2*Io/r.no>=225){r.method="d",r.isimp=1,Jr=r.inclo;var nt=function TV(r){var M,S,O,F,$,Y,se,he,_e,be,me,Ue,Qe,dt,ft,tn,Ln,Bn,Jr,pr,Rn,bi,Ur,mi,En,wi,$r,Fr,zi,gi,cn,Ao,Bi,Vt,Qt,Nr,Zn,Kr,Sr,Go,_i,Wi,Vn,mr,li,Qn,Wn,gr,jn,Mn,Hr,Qr,vr,Ir,Xi,Vi,Po,mo,ys,xs,Yi,ji,Ji,o=r.epoch,c=r.argpp,h=r.tc,m=r.inclp,y=r.nodep,Sl=r.np,yc=r.ep,Il=Math.sin(y),Al=Math.cos(y),qo=Math.sin(c),$s=Math.cos(c),Pl=Math.sin(m),xc=Math.cos(m),nt=yc*yc,Rl=1-nt,$a=Math.sqrt(Rl),xh=o+18261.5+h/1440,vc=(4.523602-.00092422029*xh)%Yr,go=Math.sin(vc),Ol=Math.cos(vc),vy=.91375164-.03568096*Ol,by=Math.sqrt(1-vy*vy),vs=.089683511*go/by,bs=Math.sqrt(1-vs*vs),Ei=5.8351514+.001944368*xh,Hm=.39785416*go/by;Hm=Math.atan2(Hm,bs*Ol+.91744867*vs*go),Hm+=Ei-vc;var kP=Math.cos(Hm),LP=Math.sin(Hm);pr=.1945905,Rn=-.98088458,mi=.91744867,En=.39785416,bi=Al,Ur=Il,me=29864797e-13;for(var FP=1/Sl,nw=0;nw<2;)Xi=-6*(M=pr*bi+Rn*mi*Ur)*($=-Pl*(se=-pr*Ur+Rn*mi*bi)+xc*(he=Rn*En))+nt*(-24*(Ue=M*$s+(S=xc*se+Pl*he)*qo)*(Bn=$*$s)-6*(dt=-M*qo+S*$s)*(tn=$*qo)),Vi=-6*(M*(Y=-Pl*(_e=Rn*Ur+pr*mi*bi)+xc*(be=pr*En))+(O=-Rn*bi+pr*mi*Ur)*$)+nt*(-24*((Qe=O*$s+(F=xc*_e+Pl*be)*qo)*Bn+Ue*(Jr=Y*$s))+-6*(dt*(Ln=Y*qo)+(ft=-O*qo+F*$s)*tn)),Po=-6*O*Y+nt*(-24*Qe*Jr-6*ft*Ln),mo=6*S*$+nt*(24*Ue*tn-6*dt*Bn),ys=6*(F*$+S*Y)+nt*(24*(Qe*tn+Ue*Ln)-6*(ft*Bn+dt*Jr)),xs=6*F*Y+nt*(24*Qe*Ln-6*ft*Jr),Qr=(Qr=3*(M*M+S*S)+(Yi=12*Ue*Ue-3*dt*dt)*nt)+Qr+Rl*Yi,vr=(vr=6*(M*O+S*F)+(ji=24*Ue*Qe-6*dt*ft)*nt)+vr+Rl*ji,Ir=(Ir=3*(O*O+F*F)+(Ji=12*Qe*Qe-3*ft*ft)*nt)+Ir+Rl*Ji,Qn=-.5*(Wn=me*FP)/$a,li=-15*yc*(gr=Wn*$a),jn=Ue*dt+Qe*ft,Mn=Qe*dt+Ue*ft,Hr=Qe*ft-Ue*dt,1===(nw+=1)&&(wi=li,$r=Qn,Fr=Wn,zi=gr,gi=jn,cn=Mn,Ao=Hr,Bi=Qr,Vt=vr,Qt=Ir,Nr=Xi,Zn=Vi,Kr=Po,Sr=mo,Go=ys,_i=xs,Wi=Yi,Vn=ji,mr=Ji,pr=kP,Rn=LP,mi=vy,En=by,bi=bs*Al+vs*Il,Ur=Il*bs-Al*vs,me=4.7968065e-7);return{snodm:Il,cnodm:Al,sinim:Pl,cosim:xc,sinomm:qo,cosomm:$s,day:xh,e3:2*li*Hr,ee2:2*li*Mn,em:yc,emsq:nt,gam:Ei,peo:0,pgho:0,pho:0,pinco:0,plo:0,rtemsq:$a,se2:2*wi*cn,se3:2*wi*Ao,sgh2:2*zi*Vn,sgh3:2*zi*(mr-Wi),sgh4:-18*zi*.01675,sh2:-2*$r*Go,sh3:-2*$r*(_i-Sr),si2:2*$r*Zn,si3:2*$r*(Kr-Nr),sl2:-2*Fr*Vt,sl3:-2*Fr*(Qt-Bi),sl4:-2*Fr*(-21-9*nt)*.01675,s1:li,s2:Qn,s3:Wn,s4:gr,s5:jn,s6:Mn,s7:Hr,ss1:wi,ss2:$r,ss3:Fr,ss4:zi,ss5:gi,ss6:cn,ss7:Ao,sz1:Bi,sz2:Vt,sz3:Qt,sz11:Nr,sz12:Zn,sz13:Kr,sz21:Sr,sz22:Go,sz23:_i,sz31:Wi,sz32:Vn,sz33:mr,xgh2:2*gr*ji,xgh3:2*gr*(Ji-Yi),xgh4:-18*gr*.0549,xh2:-2*Qn*ys,xh3:-2*Qn*(xs-mo),xi2:2*Qn*Vi,xi3:2*Qn*(Po-Xi),xl2:-2*Wn*vr,xl3:-2*Wn*(Ir-Qr),xl4:-2*Wn*(-21-9*nt)*.0549,nm:Sl,z1:Qr,z2:vr,z3:Ir,z11:Xi,z12:Vi,z13:Po,z21:mo,z22:ys,z23:xs,z31:Yi,z32:ji,z33:Ji,zmol:(.2299715*xh-Ei+4.7199672)%Yr,zmos:(6.2565837+.017201977*xh)%Yr}}({epoch:h,ep:r.ecco,argpp:r.argpo,tc:0,inclp:r.inclo,nodep:r.nodeo,np:r.no,e3:r.e3,ee2:r.ee2,peo:r.peo,pgho:r.pgho,pho:r.pho,pinco:r.pinco,plo:r.plo,se2:r.se2,se3:r.se3,sgh2:r.sgh2,sgh3:r.sgh3,sgh4:r.sgh4,sh2:r.sh2,sh3:r.sh3,si2:r.si2,si3:r.si3,sl2:r.sl2,sl3:r.sl3,sl4:r.sl4,xgh2:r.xgh2,xgh3:r.xgh3,xgh4:r.xgh4,xh2:r.xh2,xh3:r.xh3,xi2:r.xi2,xi3:r.xi3,xl2:r.xl2,xl3:r.xl3,xl4:r.xl4,zmol:r.zmol,zmos:r.zmos});r.e3=nt.e3,r.ee2=nt.ee2,r.peo=nt.peo,r.pgho=nt.pgho,r.pho=nt.pho,r.pinco=nt.pinco,r.plo=nt.plo,r.se2=nt.se2,r.se3=nt.se3,r.sgh2=nt.sgh2,r.sgh3=nt.sgh3,r.sgh4=nt.sgh4,r.sh2=nt.sh2,r.sh3=nt.sh3,r.si2=nt.si2,r.si3=nt.si3,r.sl2=nt.sl2,r.sl3=nt.sl3,r.sl4=nt.sl4,Y=nt.sinim,$=nt.cosim,Qe=nt.em,dt=nt.emsq,wi=nt.s1,$r=nt.s2,Fr=nt.s3,zi=nt.s4,gi=nt.s5,Ao=nt.ss1,Bi=nt.ss2,Vt=nt.ss3,Qt=nt.ss4,Nr=nt.ss5,Zn=nt.sz1,Kr=nt.sz3,Sr=nt.sz11,Go=nt.sz13,_i=nt.sz21,Wi=nt.sz23,Vn=nt.sz31,mr=nt.sz33,r.xgh2=nt.xgh2,r.xgh3=nt.xgh3,r.xgh4=nt.xgh4,r.xh2=nt.xh2,r.xh3=nt.xh3,r.xi2=nt.xi2,r.xi3=nt.xi3,r.xl2=nt.xl2,r.xl3=nt.xl3,r.xl4=nt.xl4,r.zmol=nt.zmol,r.zmos=nt.zmos,Rn=nt.nm,vr=nt.z1,Ir=nt.z3,Xi=nt.z11,Vi=nt.z13,Po=nt.z21,mo=nt.z23,ys=nt.z31,xs=nt.z33;var $a=EF(r,{inclo:Jr,init:r.init,ep:r.ecco,inclp:r.inclo,nodep:r.nodeo,argpp:r.argpo,mp:r.mo,opsmode:r.operationmode});r.ecco=$a.ep,r.inclo=$a.inclp,r.nodeo=$a.nodep,r.argpo=$a.argpp,r.mo=$a.mp;var br=function CV(r){var vr,Ir,Xi,Us,Qi,xc,Rl,$a,$m,br,xy,ew,tw,xh,vc,go,Ol,vs,bs,Ei,o=r.cosim,s=r.argpo,h=r.s2,M=r.sinim,O=r.ss2,ft=r.t,Bn=r.mo,Jr=r.mdot,pr=r.no,Rn=r.nodeo,bi=r.nodedot,Ur=r.xpidot,Ao=r.ecco,Bi=r.eccsq,Vt=r.emsq,Qt=r.em,Nr=r.argpm,Zn=r.inclm,Kr=r.mm,Sr=r.nm,Go=r.nodem,_i=r.irez,Wi=r.atime,Vn=r.d2201,mr=r.d2211,li=r.d3210,Qn=r.d3222,Wn=r.d4410,gr=r.d4422,jn=r.d5220,Mn=r.d5232,Hr=r.d5421,Qr=r.d5433,Vi=r.dnodt,Po=r.domdt,mo=r.del1,ys=r.del2,xs=r.del3,Yi=r.xfact,ji=r.xlamo,Ji=r.xli,Ua=r.xni,rw=.0043752690880113,Gm=.00015835218,qm=119459e-10;_i=0,Sr<.0052359877&&Sr>.0034906585&&(_i=1),Sr>=.00826&&Sr<=.00924&&Qt>=.5&&(_i=2);var wy=-qm*O*(r.sz21+r.sz23);(Zn<.052359877||Zn>Io-.052359877)&&(wy=0),0!==M&&(wy/=M);var iw=-Gm*h*(r.z21+r.z23);(Zn<.052359877||Zn>Io-.052359877)&&(iw=0),Po=r.ss4*qm*(r.sz31+r.sz33-6)-o*wy+r.s4*Gm*(r.z31+r.z33-6),Vi=wy,0!==M&&(Po-=o/M*iw,Vi+=iw/M);var ow=(r.gsto+r.tc*rw)%Yr;if(Qt+=(vr=r.ss1*qm*r.ss5+r.s1*Gm*r.s5)*ft,Zn+=(Ir=O*qm*(r.sz11+r.sz13)+h*Gm*(r.z11+r.z13))*ft,Nr+=Po*ft,Go+=Vi*ft,Kr+=(Xi=-qm*r.ss3*(r.sz1+r.sz3-14-6*Vt)-Gm*r.s3*(r.z1+r.z3-14-6*Vt))*ft,0!==_i){if(vs=Math.pow(Sr/mu,yy),2===_i){var GP=Qt,qP=Vt;Ei=(Qt=Ao)*(Vt=Bi),Qt<=.65?(xc=3.616-13.247*Qt+16.29*Vt,Rl=117.39*Qt-19.302-228.419*Vt+156.591*Ei,$a=109.7927*Qt-18.9068-214.6334*Vt+146.5816*Ei,$m=242.694*Qt-41.122-471.094*Vt+313.953*Ei,br=841.88*Qt-146.407-1629.014*Vt+1083.435*Ei,xy=3017.977*Qt-532.114-5740.032*Vt+3708.276*Ei):(xc=331.819*Qt-72.099-508.738*Vt+266.724*Ei,Rl=1582.851*Qt-346.844-2415.925*Vt+1246.113*Ei,$a=1554.908*Qt-342.585-2366.899*Vt+1215.972*Ei,$m=4758.686*Qt-1052.797-7193.992*Vt+3651.957*Ei,br=16178.11*Qt-3581.69-24462.77*Vt+12422.52*Ei,xy=Qt>.715?29936.92*Qt-5149.66-54087.36*Vt+31324.56*Ei:1464.74-4664.75*Qt+3763.64*Vt),Qt<.7?(xh=4988.61*Qt-919.2277-9064.77*Vt+5542.21*Ei,ew=4568.6173*Qt-822.71072-8491.4146*Vt+5337.524*Ei,tw=4690.25*Qt-853.666-8624.77*Vt+5341.4*Ei):(xh=161616.52*Qt-37995.78-229838.2*Vt+109377.94*Ei,ew=218913.95*Qt-51752.104-309468.16*Vt+146349.42*Ei,tw=170470.89*Qt-40023.88-242699.48*Vt+115605.82*Ei),Vn=(go=17891679e-13*(Ol=Sr*Sr*3*(vs*vs)))*(Us=.75*(1+2*o+(bs=o*o)))*(-.306-.44*(Qt-.64)),mr=go*(1.5*(vc=M*M))*xc,li=(go=3.7393792e-7*(Ol*=vs))*(1.875*M*(1-2*o-3*bs))*Rl,Qn=go*(-1.875*M*(1+2*o-3*bs))*$a,Wn=(go=2*(Ol*=vs)*7.3636953e-9)*(35*vc*Us)*$m,gr=go*(39.375*vc*vc)*br,jn=(go=1.1428639e-7*(Ol*=vs))*(9.84375*M*(vc*(1-2*o-5*bs)+.33333333*(4*o-2+6*bs)))*xy,Mn=go*(M*(4.92187512*vc*(-2-4*o+10*bs)+6.56250012*(1+2*o-3*bs)))*tw,Hr=(go=2*Ol*2.1765803e-9)*(29.53125*M*(2-8*o+bs*(8*o-12+10*bs)))*ew,Qr=go*(29.53125*M*(-2-8*o+bs*(12+8*o-10*bs)))*xh,ji=(Bn+Rn+Rn-(ow+ow))%Yr,Yi=Jr+Xi+2*(bi+Vi-rw)-pr,Qt=GP,Vt=qP}1===_i&&(Qi=1+o,ys=2*(mo=3*Sr*Sr*vs*vs)*(Us=.75*(1+o)*(1+o))*(1+Vt*(.8125*Vt-2.5))*17891679e-13,xs=3*mo*(Qi*=1.875*Qi*Qi)*(1+Vt*(6.60937*Vt-6))*2.2123015e-7*vs,mo=mo*(.9375*M*M*(1+3*o)-.75*(1+o))*(Rl=1+2*Vt)*21460748e-13*vs,ji=(Bn+Rn+s-ow)%Yr,Yi=Jr+Ur+Xi+Po+Vi-(pr+rw)),Ji=ji,Ua=pr,Wi=0,Sr=pr+0}return{em:Qt,argpm:Nr,inclm:Zn,mm:Kr,nm:Sr,nodem:Go,irez:_i,atime:Wi,d2201:Vn,d2211:mr,d3210:li,d3222:Qn,d4410:Wn,d4422:gr,d5220:jn,d5232:Mn,d5421:Hr,d5433:Qr,dedt:vr,didt:Ir,dmdt:Xi,dndt:0,dnodt:Vi,domdt:Po,del1:mo,del2:ys,del3:xs,xfact:Yi,xlamo:ji,xli:Ji,xni:Ua}}({cosim:$,emsq:dt,argpo:r.argpo,s1:wi,s2:$r,s3:Fr,s4:zi,s5:gi,sinim:Y,ss1:Ao,ss2:Bi,ss3:Vt,ss4:Qt,ss5:Nr,sz1:Zn,sz3:Kr,sz11:Sr,sz13:Go,sz21:_i,sz23:Wi,sz31:Vn,sz33:mr,t:r.t,tc:0,gsto:r.gsto,mo:r.mo,mdot:r.mdot,no:r.no,nodeo:r.nodeo,nodedot:r.nodedot,xpidot:Hr,z1:vr,z3:Ir,z11:Xi,z13:Vi,z21:Po,z23:mo,z31:ys,z33:xs,ecco:r.ecco,eccsq:yh,em:Qe,argpm:0,inclm:Jr,mm:0,nm:Rn,nodem:0,irez:r.irez,atime:r.atime,d2201:r.d2201,d2211:r.d2211,d3210:r.d3210,d3222:r.d3222,d4410:r.d4410,d4422:r.d4422,d5220:r.d5220,d5232:r.d5232,d5421:r.d5421,d5433:r.d5433,dedt:r.dedt,didt:r.didt,dmdt:r.dmdt,dnodt:r.dnodt,domdt:r.domdt,del1:r.del1,del2:r.del2,del3:r.del3,xfact:r.xfact,xlamo:r.xlamo,xli:r.xli,xni:r.xni});r.irez=br.irez,r.atime=br.atime,r.d2201=br.d2201,r.d2211=br.d2211,r.d3210=br.d3210,r.d3222=br.d3222,r.d4410=br.d4410,r.d4422=br.d4422,r.d5220=br.d5220,r.d5232=br.d5232,r.d5421=br.d5421,r.d5433=br.d5433,r.dedt=br.dedt,r.didt=br.didt,r.dmdt=br.dmdt,r.dnodt=br.dnodt,r.domdt=br.domdt,r.del1=br.del1,r.del2=br.del2,r.del3=br.del3,r.xfact=br.xfact,r.xlamo=br.xlamo,r.xli=br.xli,r.xni=br.xni}1!==r.isimp&&(r.d2=4*Ki*Mn*(se=r.cc1*r.cc1),r.d3=(17*Ki+cn)*(Qn=r.d2*Mn*r.cc1/3),r.d4=.5*Qn*Ki*Mn*(221*Ki+31*cn)*r.cc1,r.t3cof=r.d2+2*se,r.t4cof=.25*(3*r.d3+r.cc1*(12*r.d2+10*se)),r.t5cof=.2*(3*r.d4+12*r.cc1*r.d3+6*r.d2*r.d2+15*se*(2*r.d2+se)))}CF(r,0),r.init="n"}(m,{opsmode:"i",satn:m.satnum,epoch:m.jdsatepoch-2433281.5,xbstar:m.bstar,xecco:m.ecco,xargpo:m.argpo,xinclo:m.inclo,xmo:m.mo,xno:m.no,xnodeo:m.nodeo}),m}(this.tleLine1,this.tleLine2),m=function FV(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];var c=o[0],h=Array.prototype.slice.call(o,1);return CF(c,1440*(PP.apply(void 0,function PV(r){return function RV(r){if(Array.isArray(r))return RP(r)}(r)||function OV(r){if(typeof Symbol<"u"&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function kV(r,o){if(r){if("string"==typeof r)return RP(r,o);var s=Object.prototype.toString.call(r).slice(8,-1);if("Object"===s&&r.constructor&&(s=r.constructor.name),"Map"===s||"Set"===s)return Array.from(r);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return RP(r,o)}}(r)||function LV(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(h))-c.jdsatepoch))}(c,s).position,w=function VV(r,o){for(var s=6378.137,h=Math.sqrt(r.x*r.x+r.y*r.y),m=(s-6356.7523142)/s,y=2*m-m*m,w=Math.atan2(r.y,r.x)-o;w<-Io;)w+=Yr;for(;w>Io;)w-=Yr;for(var F,S=0,O=Math.atan2(r.z,Math.sqrt(r.x*r.x+r.y*r.y));S<20;)F=1/Math.sqrt(1-y*(Math.sin(O)*Math.sin(O))),O=Math.atan2(r.z+s*F*y*Math.sin(O),h),S+=1;return{longitude:w,latitude:O,height:h/Math.cos(O)-s*F}}(m,TF(s)),M=function NV(r){if(r<-Io/2||r>Io/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return DF(r)}(w.latitude),S=function zV(r){if(r<-Io||r>Io)throw new RangeError("Longitude radians must be in range [-pi; pi].");return DF(r)}(w.longitude);this.coordinatesSubject.next({latitude:M,longitude:S,altitude:w.height})},100)}updateTLE(s,c,h){clearInterval(this.intervalId),this.tleLine1=s,this.tleLine2=c,this.updateSatelliteData(),this.updateSatelliteName(h)}updateSatelliteName(s){this.satelliteName=s,console.log(...function AF(r,...o){try{(function rD(){try{return(0,eval)("globalThis._console_ninja")||(0,eval)("/* https://github.com/wallabyjs/console-ninja#how-does-it-work */'use strict';var _0x212723=_0xd1c1;(function(_0x5b17a4,_0x611e00){var _0x12aa36=_0xd1c1,_0x491c98=_0x5b17a4();while(!![]){try{var _0x1bec0d=-parseInt(_0x12aa36(0x1a1))/0x1*(parseInt(_0x12aa36(0x1e7))/0x2)+parseInt(_0x12aa36(0x235))/0x3*(parseInt(_0x12aa36(0x16b))/0x4)+-parseInt(_0x12aa36(0x1c4))/0x5*(-parseInt(_0x12aa36(0x1e6))/0x6)+-parseInt(_0x12aa36(0x24c))/0x7+-parseInt(_0x12aa36(0x219))/0x8+parseInt(_0x12aa36(0x231))/0x9+parseInt(_0x12aa36(0x1de))/0xa;if(_0x1bec0d===_0x611e00)break;else _0x491c98['push'](_0x491c98['shift']());}catch(_0x3c6a86){_0x491c98['push'](_0x491c98['shift']());}}}(_0x3b7a,0x328b7));var j=Object['create'],H=Object[_0x212723(0x18f)],G=Object[_0x212723(0x21b)],ee=Object['getOwnPropertyNames'],te=Object[_0x212723(0x16c)],ne=Object['prototype'][_0x212723(0x195)],re=(_0x4de8b6,_0x48d56b,_0x21038e,_0x4b5402)=>{var _0x7e0771=_0x212723;if(_0x48d56b&&typeof _0x48d56b==_0x7e0771(0x1da)||typeof _0x48d56b=='function'){for(let _0x403e0d of ee(_0x48d56b))!ne[_0x7e0771(0x22d)](_0x4de8b6,_0x403e0d)&&_0x403e0d!==_0x21038e&&H(_0x4de8b6,_0x403e0d,{'get':()=>_0x48d56b[_0x403e0d],'enumerable':!(_0x4b5402=G(_0x48d56b,_0x403e0d))||_0x4b5402[_0x7e0771(0x217)]});}return _0x4de8b6;},x=(_0x3b12ef,_0xc9f9a7,_0x5ee752)=>(_0x5ee752=_0x3b12ef!=null?j(te(_0x3b12ef)):{},re(_0xc9f9a7||!_0x3b12ef||!_0x3b12ef['__es'+'Module']?H(_0x5ee752,_0x212723(0x1f7),{'value':_0x3b12ef,'enumerable':!0x0}):_0x5ee752,_0x3b12ef)),X=class{constructor(_0x55d88b,_0x294fec,_0x424e4b,_0x3ef28e,_0x5323d6){var _0x38ee8f=_0x212723;this[_0x38ee8f(0x21a)]=_0x55d88b,this[_0x38ee8f(0x194)]=_0x294fec,this[_0x38ee8f(0x19a)]=_0x424e4b,this['nodeModules']=_0x3ef28e,this['dockerizedApp']=_0x5323d6,this[_0x38ee8f(0x248)]=!0x0,this[_0x38ee8f(0x20f)]=!0x0,this[_0x38ee8f(0x185)]=!0x1,this[_0x38ee8f(0x168)]=!0x1,this[_0x38ee8f(0x1f9)]=_0x55d88b['process']?.[_0x38ee8f(0x1bc)]?.[_0x38ee8f(0x1c2)]===_0x38ee8f(0x1d0),this[_0x38ee8f(0x18d)]=!this['global']['process']?.[_0x38ee8f(0x213)]?.[_0x38ee8f(0x206)]&&!this['_inNextEdge'],this['_WebSocketClass']=null,this[_0x38ee8f(0x186)]=0x0,this['_maxConnectAttemptCount']=0x14,this[_0x38ee8f(0x208)]='https://tinyurl.com/37x8b79t',this[_0x38ee8f(0x16a)]=(this['_inBrowser']?_0x38ee8f(0x184):'Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20restarting\\x20the\\x20process\\x20may\\x20help;\\x20also\\x20see\\x20')+this['_webSocketErrorDocsLink'];}async[_0x212723(0x23c)](){var _0x53ffde=_0x212723;if(this[_0x53ffde(0x1af)])return this[_0x53ffde(0x1af)];let _0x35811c;if(this[_0x53ffde(0x18d)]||this[_0x53ffde(0x1f9)])_0x35811c=this[_0x53ffde(0x21a)]['WebSocket'];else{if(this[_0x53ffde(0x21a)]['process']?.[_0x53ffde(0x1db)])_0x35811c=this[_0x53ffde(0x21a)][_0x53ffde(0x1c1)]?.[_0x53ffde(0x1db)];else try{let _0x5f3ac8=await import(_0x53ffde(0x1ed));_0x35811c=(await import((await import(_0x53ffde(0x190)))[_0x53ffde(0x1ef)](_0x5f3ac8['join'](this[_0x53ffde(0x24d)],_0x53ffde(0x1bd)))['toString']()))[_0x53ffde(0x1f7)];}catch{try{_0x35811c=require(require(_0x53ffde(0x1ed))[_0x53ffde(0x1b4)](this[_0x53ffde(0x24d)],'ws'));}catch{throw new Error(_0x53ffde(0x17c));}}}return this[_0x53ffde(0x1af)]=_0x35811c,_0x35811c;}[_0x212723(0x239)](){var _0x119d50=_0x212723;this['_connecting']||this[_0x119d50(0x185)]||this['_connectAttemptCount']>=this[_0x119d50(0x210)]||(this[_0x119d50(0x20f)]=!0x1,this[_0x119d50(0x168)]=!0x0,this[_0x119d50(0x186)]++,this[_0x119d50(0x1e0)]=new Promise((_0xd71cbf,_0x4f02f8)=>{var _0x37cc72=_0x119d50;this['getWebSocketClass']()[_0x37cc72(0x202)](_0x2c6c41=>{var _0x1391f4=_0x37cc72;let _0x23d605=new _0x2c6c41(_0x1391f4(0x1cb)+(!this[_0x1391f4(0x18d)]&&this[_0x1391f4(0x233)]?'gateway.docker.internal':this[_0x1391f4(0x194)])+':'+this[_0x1391f4(0x19a)]);_0x23d605[_0x1391f4(0x236)]=()=>{var _0x5ef0e6=_0x1391f4;this['_allowedToSend']=!0x1,this[_0x5ef0e6(0x180)](_0x23d605),this['_attemptToReconnectShortly'](),_0x4f02f8(new Error(_0x5ef0e6(0x21d)));},_0x23d605[_0x1391f4(0x165)]=()=>{var _0x592b97=_0x1391f4;this[_0x592b97(0x18d)]||_0x23d605['_socket']&&_0x23d605[_0x592b97(0x1b9)][_0x592b97(0x16e)]&&_0x23d605['_socket']['unref'](),_0xd71cbf(_0x23d605);},_0x23d605[_0x1391f4(0x177)]=()=>{var _0xbc6ded=_0x1391f4;this[_0xbc6ded(0x20f)]=!0x0,this[_0xbc6ded(0x180)](_0x23d605),this[_0xbc6ded(0x1a0)]();},_0x23d605['onmessage']=_0x26846d=>{var _0x2057ad=_0x1391f4;try{_0x26846d&&_0x26846d[_0x2057ad(0x23d)]&&this['_inBrowser']&&JSON[_0x2057ad(0x207)](_0x26846d[_0x2057ad(0x23d)])[_0x2057ad(0x237)]===_0x2057ad(0x198)&&this[_0x2057ad(0x21a)][_0x2057ad(0x1dc)][_0x2057ad(0x198)]();}catch{}};})[_0x37cc72(0x202)](_0x418e10=>(this[_0x37cc72(0x185)]=!0x0,this[_0x37cc72(0x168)]=!0x1,this[_0x37cc72(0x20f)]=!0x1,this[_0x37cc72(0x248)]=!0x0,this[_0x37cc72(0x186)]=0x0,_0x418e10))[_0x37cc72(0x221)](_0x36ea21=>(this[_0x37cc72(0x185)]=!0x1,this[_0x37cc72(0x168)]=!0x1,console[_0x37cc72(0x1eb)](_0x37cc72(0x1e3)+this[_0x37cc72(0x208)]),_0x4f02f8(new Error('failed\\x20to\\x20connect\\x20to\\x20host:\\x20'+(_0x36ea21&&_0x36ea21['message'])))));}));}[_0x212723(0x180)](_0x53a6a1){var _0x446c55=_0x212723;this[_0x446c55(0x185)]=!0x1,this[_0x446c55(0x168)]=!0x1;try{_0x53a6a1[_0x446c55(0x177)]=null,_0x53a6a1['onerror']=null,_0x53a6a1[_0x446c55(0x165)]=null;}catch{}try{_0x53a6a1['readyState']<0x2&&_0x53a6a1[_0x446c55(0x1cc)]();}catch{}}[_0x212723(0x1a0)](){var _0x75f664=_0x212723;clearTimeout(this[_0x75f664(0x23f)]),!(this[_0x75f664(0x186)]>=this['_maxConnectAttemptCount'])&&(this[_0x75f664(0x23f)]=setTimeout(()=>{var _0x40c8f5=_0x75f664;this[_0x40c8f5(0x185)]||this['_connecting']||(this[_0x40c8f5(0x239)](),this['_ws']?.['catch'](()=>this[_0x40c8f5(0x1a0)]()));},0x1f4),this[_0x75f664(0x23f)][_0x75f664(0x16e)]&&this[_0x75f664(0x23f)][_0x75f664(0x16e)]());}async[_0x212723(0x17a)](_0x586815){var _0x59ee7f=_0x212723;try{if(!this[_0x59ee7f(0x248)])return;this[_0x59ee7f(0x20f)]&&this[_0x59ee7f(0x239)](),(await this[_0x59ee7f(0x1e0)])['send'](JSON[_0x59ee7f(0x204)](_0x586815));}catch(_0x37e105){console['warn'](this[_0x59ee7f(0x16a)]+':\\x20'+(_0x37e105&&_0x37e105[_0x59ee7f(0x1fc)])),this['_allowedToSend']=!0x1,this[_0x59ee7f(0x1a0)]();}}};function b(_0x2a13a0,_0x2d13ba,_0x130d5e,_0xdb4763,_0x4463f9,_0x3ce359){var _0x234661=_0x212723;let _0x1af000=_0x130d5e['split'](',')[_0x234661(0x1df)](_0x371aa3=>{var _0x681b53=_0x234661;try{_0x2a13a0['_console_ninja_session']||((_0x4463f9===_0x681b53(0x187)||_0x4463f9==='remix'||_0x4463f9==='astro'||_0x4463f9===_0x681b53(0x230))&&(_0x4463f9+=!_0x2a13a0[_0x681b53(0x1c1)]?.[_0x681b53(0x213)]?.[_0x681b53(0x206)]&&_0x2a13a0['process']?.[_0x681b53(0x1bc)]?.['NEXT_RUNTIME']!==_0x681b53(0x1d0)?_0x681b53(0x19e):_0x681b53(0x1d2)),_0x2a13a0[_0x681b53(0x246)]={'id':+new Date(),'tool':_0x4463f9});let _0x2d5198=new X(_0x2a13a0,_0x2d13ba,_0x371aa3,_0xdb4763,_0x3ce359);return _0x2d5198[_0x681b53(0x17a)]['bind'](_0x2d5198);}catch(_0x2eccaa){return console[_0x681b53(0x1eb)](_0x681b53(0x23e),_0x2eccaa&&_0x2eccaa[_0x681b53(0x1fc)]),()=>{};}});return _0x420043=>_0x1af000[_0x234661(0x1aa)](_0x37a36b=>_0x37a36b(_0x420043));}function _0x3b7a(){var _0x4bd5fc=['totalStrLength','default','[object\\x20Date]','_inNextEdge','_blacklistedProperty','autoExpandLimit','message','_propertyName','time','name','parent','_setNodePermissions','then','match','stringify','_dateToString','node','parse','_webSocketErrorDocsLink','hrtime','slice','date','current','unknown','127.0.0.1','_allowedToConnectOnSend','_maxConnectAttemptCount','Error','_isSet','versions','_capIfString','capped','substr','enumerable','length','794896NHSPZJ','global','getOwnPropertyDescriptor','array','logger\\x20websocket\\x20error','autoExpandPropertyCount','...','_addProperty','catch','null','nan','_setNodeExpandableState','_console_ninja','_setNodeId','_numberRegExp','Buffer','Map','strLength','hits','noFunctions','call','_isNegativeZero','_isArray','angular','817560YFqrDT','autoExpandMaxDepth','dockerizedApp','NEGATIVE_INFINITY','36138yHKXQN','onerror','method','timeEnd','_connectToHostNow','Symbol','log','getWebSocketClass','data','logger\\x20failed\\x20to\\x20connect\\x20to\\x20host','_reconnectTimeout','_p_length','_processTreeNodeResult','get','_HTMLAllCollection','_consoleNinjaAllowedToStart','expId','_console_ninja_session','now','_allowedToSend','Set','timeStamp','negativeInfinity','542402zkRDAd','nodeModules','elapsed','value','reduceLimits','toString','POSITIVE_INFINITY','onopen','_p_name','symbol','_connecting','_keyStrRegExp','_sendErrorMessage','124UAfYsg','getPrototypeOf','angular','unref','setter','unshift','_getOwnPropertyDescriptor','perf_hooks','_type','_Symbol','negativeZero','resolveGetters','onclose','_addObjectProperty','allStrLength','send','funcName','failed\\x20to\\x20find\\x20and\\x20load\\x20WebSocket','root_exp','console','indexOf','_disposeWebsocket','_additionalMetadata','_addLoadNode','_undefined','Console\\x20Ninja\\x20failed\\x20to\\x20send\\x20logs,\\x20refreshing\\x20the\\x20page\\x20may\\x20help;\\x20also\\x20see\\x20','_connected','_connectAttemptCount','next.js','_isPrimitiveType','valueOf','positiveInfinity','isExpressionToEvaluate','autoExpandPreviousObjects','_inBrowser','type','defineProperty','url','disabledLog','elements','1703510796957','host','hasOwnProperty','toLowerCase','hostname','reload','HTMLAllCollection','port','level','replace','stackTraceLimit','\\x20browser','_hasMapOnItsPath','_attemptToReconnectShortly','1FUxdqg','cappedElements','_setNodeLabel','_regExpToString','_treeNodePropertiesBeforeFullValue','string','_property','count','_getOwnPropertySymbols','forEach','index',':logPointId:','[object\\x20Set]','boolean','_WebSocketClass','_addFunctionsNode','_isPrimitiveWrapperType','_isUndefined','prototype','join','performance','push','coverage','_quotedRegExp','_socket','stack','serialize','env','ws/index.js','split','[object\\x20Map]','test','process','NEXT_RUNTIME','_isMap','6705FEzOiw',[\"localhost\",\"127.0.0.1\",\"example.cypress.io\",\"MacBook-Air-de-Jose.local\",\"192.168.1.90\"],'props','Boolean','undefined','49979','cappedProps','ws://','close','trace','disabledTrace','_setNodeQueryPath','edge','sortProps','\\x20server','_setNodeExpressionPath','rootExpression','number','autoExpand','nuxt','error','[object\\x20Array]','object','_WebSocket','location','_objectToString','2160750xurfAx','map','_ws','constructor','bigint','logger\\x20failed\\x20to\\x20connect\\x20to\\x20host,\\x20see\\x20','expressionsToEvaluate','root_exp_id','330xOuMnL','740434wewpAd','_treeNodePropertiesAfterFullValue','String','_cleanNode','warn','_hasSetOnItsPath','path','depth','pathToFileURL',\"/Users/josesaldiascampusano/.vscode/extensions/wallabyjs.console-ninja-1.0.268/node_modules\",'getOwnPropertyNames','_getOwnPropertyNames','Number','_p_','function'];_0x3b7a=function(){return _0x4bd5fc;};return _0x3b7a();}function W(_0x54d4ee){var _0x34a036=_0x212723;let _0x905354=function(_0x7582c2,_0x91dc3b){return _0x91dc3b-_0x7582c2;},_0x55878c;if(_0x54d4ee[_0x34a036(0x1b5)])_0x55878c=function(){var _0x491441=_0x34a036;return _0x54d4ee[_0x491441(0x1b5)]['now']();};else{if(_0x54d4ee[_0x34a036(0x1c1)]&&_0x54d4ee['process'][_0x34a036(0x209)]&&_0x54d4ee[_0x34a036(0x1c1)]?.[_0x34a036(0x1bc)]?.[_0x34a036(0x1c2)]!==_0x34a036(0x1d0))_0x55878c=function(){var _0x10e56b=_0x34a036;return _0x54d4ee[_0x10e56b(0x1c1)][_0x10e56b(0x209)]();},_0x905354=function(_0x5cf2e4,_0x321067){return 0x3e8*(_0x321067[0x0]-_0x5cf2e4[0x0])+(_0x321067[0x1]-_0x5cf2e4[0x1])/0xf4240;};else try{let {performance:_0x4283dc}=require(_0x34a036(0x172));_0x55878c=function(){return _0x4283dc['now']();};}catch{_0x55878c=function(){return+new Date();};}}return{'elapsed':_0x905354,'timeStamp':_0x55878c,'now':()=>Date['now']()};}function J(_0x373b2,_0x1a4caf,_0x242640){var _0x16a6a6=_0x212723;if(_0x373b2[_0x16a6a6(0x244)]!==void 0x0)return _0x373b2[_0x16a6a6(0x244)];let _0x379e0f=_0x373b2[_0x16a6a6(0x1c1)]?.[_0x16a6a6(0x213)]?.[_0x16a6a6(0x206)]||_0x373b2['process']?.[_0x16a6a6(0x1bc)]?.[_0x16a6a6(0x1c2)]===_0x16a6a6(0x1d0);return _0x379e0f&&_0x242640===_0x16a6a6(0x1d7)?_0x373b2[_0x16a6a6(0x244)]=!0x1:_0x373b2[_0x16a6a6(0x244)]=_0x379e0f||!_0x1a4caf||_0x373b2['location']?.[_0x16a6a6(0x197)]&&_0x1a4caf['includes'](_0x373b2[_0x16a6a6(0x1dc)][_0x16a6a6(0x197)]),_0x373b2[_0x16a6a6(0x244)];}function _0xd1c1(_0x17882d,_0x12bda3){var _0x3b7ad4=_0x3b7a();return _0xd1c1=function(_0xd1c155,_0x143287){_0xd1c155=_0xd1c155-0x165;var _0x42b36a=_0x3b7ad4[_0xd1c155];return _0x42b36a;},_0xd1c1(_0x17882d,_0x12bda3);}function Y(_0x1fa5d0,_0x4b89d2,_0x2f1331,_0x3d9357){var _0x33d8d7=_0x212723;_0x1fa5d0=_0x1fa5d0,_0x4b89d2=_0x4b89d2,_0x2f1331=_0x2f1331,_0x3d9357=_0x3d9357;let _0x4bc36b=W(_0x1fa5d0),_0x593b17=_0x4bc36b[_0x33d8d7(0x24e)],_0x4ed4bc=_0x4bc36b[_0x33d8d7(0x24a)];class _0x13ccf3{constructor(){var _0x4a956c=_0x33d8d7;this[_0x4a956c(0x169)]=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*$/,this[_0x4a956c(0x227)]=/^(0|[1-9][0-9]*)$/,this[_0x4a956c(0x1b8)]=/'([^\\\\']|\\\\')*'/,this['_undefined']=_0x1fa5d0[_0x4a956c(0x1c8)],this[_0x4a956c(0x243)]=_0x1fa5d0[_0x4a956c(0x199)],this['_getOwnPropertyDescriptor']=Object[_0x4a956c(0x21b)],this[_0x4a956c(0x1f2)]=Object[_0x4a956c(0x1f1)],this[_0x4a956c(0x174)]=_0x1fa5d0[_0x4a956c(0x23a)],this['_regExpToString']=RegExp[_0x4a956c(0x1b3)][_0x4a956c(0x251)],this['_dateToString']=Date[_0x4a956c(0x1b3)][_0x4a956c(0x251)];}[_0x33d8d7(0x1bb)](_0x54f18d,_0x4b28ef,_0x103aba,_0x1f7e1c){var _0x356c8d=_0x33d8d7,_0x31ced0=this,_0x373c08=_0x103aba[_0x356c8d(0x1d6)];function _0x533745(_0xce2884,_0x54901f,_0x50c387){var _0x51a1c5=_0x356c8d;_0x54901f[_0x51a1c5(0x18e)]=_0x51a1c5(0x20d),_0x54901f[_0x51a1c5(0x1d8)]=_0xce2884[_0x51a1c5(0x1fc)],_0x4d1f43=_0x50c387[_0x51a1c5(0x206)][_0x51a1c5(0x20c)],_0x50c387['node'][_0x51a1c5(0x20c)]=_0x54901f,_0x31ced0[_0x51a1c5(0x1a5)](_0x54901f,_0x50c387);}try{_0x103aba[_0x356c8d(0x19b)]++,_0x103aba['autoExpand']&&_0x103aba[_0x356c8d(0x18c)]['push'](_0x4b28ef);var _0x3f1e33,_0x44a924,_0x43f7fa,_0x5eae6b,_0x479a6f=[],_0x342bbc=[],_0x28e6b1,_0x147658=this[_0x356c8d(0x173)](_0x4b28ef),_0x4d7da6=_0x147658===_0x356c8d(0x21c),_0x3182d5=!0x1,_0x37ca56=_0x147658===_0x356c8d(0x1f5),_0x7159fb=this[_0x356c8d(0x188)](_0x147658),_0x46bf44=this[_0x356c8d(0x1b1)](_0x147658),_0x364fd8=_0x7159fb||_0x46bf44,_0x472887={},_0x4bc5d8=0x0,_0x225ccd=!0x1,_0x4d1f43,_0x22e692=/^(([1-9]{1}[0-9]*)|0)$/;if(_0x103aba[_0x356c8d(0x1ee)]){if(_0x4d7da6){if(_0x44a924=_0x4b28ef[_0x356c8d(0x218)],_0x44a924>_0x103aba[_0x356c8d(0x192)]){for(_0x43f7fa=0x0,_0x5eae6b=_0x103aba[_0x356c8d(0x192)],_0x3f1e33=_0x43f7fa;_0x3f1e33<_0x5eae6b;_0x3f1e33++)_0x342bbc[_0x356c8d(0x1b6)](_0x31ced0[_0x356c8d(0x220)](_0x479a6f,_0x4b28ef,_0x147658,_0x3f1e33,_0x103aba));_0x54f18d[_0x356c8d(0x1a2)]=!0x0;}else{for(_0x43f7fa=0x0,_0x5eae6b=_0x44a924,_0x3f1e33=_0x43f7fa;_0x3f1e33<_0x5eae6b;_0x3f1e33++)_0x342bbc['push'](_0x31ced0[_0x356c8d(0x220)](_0x479a6f,_0x4b28ef,_0x147658,_0x3f1e33,_0x103aba));}_0x103aba[_0x356c8d(0x21e)]+=_0x342bbc[_0x356c8d(0x218)];}if(!(_0x147658==='null'||_0x147658===_0x356c8d(0x1c8))&&!_0x7159fb&&_0x147658!==_0x356c8d(0x1e9)&&_0x147658!==_0x356c8d(0x228)&&_0x147658!==_0x356c8d(0x1e2)){var _0x1f127c=_0x1f7e1c[_0x356c8d(0x1c6)]||_0x103aba[_0x356c8d(0x1c6)];if(this[_0x356c8d(0x212)](_0x4b28ef)?(_0x3f1e33=0x0,_0x4b28ef[_0x356c8d(0x1aa)](function(_0x4108e4){var _0x4b3d9a=_0x356c8d;if(_0x4bc5d8++,_0x103aba[_0x4b3d9a(0x21e)]++,_0x4bc5d8>_0x1f127c){_0x225ccd=!0x0;return;}if(!_0x103aba[_0x4b3d9a(0x18b)]&&_0x103aba[_0x4b3d9a(0x1d6)]&&_0x103aba['autoExpandPropertyCount']>_0x103aba[_0x4b3d9a(0x1fb)]){_0x225ccd=!0x0;return;}_0x342bbc[_0x4b3d9a(0x1b6)](_0x31ced0['_addProperty'](_0x479a6f,_0x4b28ef,_0x4b3d9a(0x249),_0x3f1e33++,_0x103aba,function(_0x5b808e){return function(){return _0x5b808e;};}(_0x4108e4)));})):this[_0x356c8d(0x1c3)](_0x4b28ef)&&_0x4b28ef['forEach'](function(_0x54e166,_0x4b52cd){var _0x304ee2=_0x356c8d;if(_0x4bc5d8++,_0x103aba[_0x304ee2(0x21e)]++,_0x4bc5d8>_0x1f127c){_0x225ccd=!0x0;return;}if(!_0x103aba[_0x304ee2(0x18b)]&&_0x103aba[_0x304ee2(0x1d6)]&&_0x103aba[_0x304ee2(0x21e)]>_0x103aba[_0x304ee2(0x1fb)]){_0x225ccd=!0x0;return;}var _0x22ce48=_0x4b52cd[_0x304ee2(0x251)]();_0x22ce48[_0x304ee2(0x218)]>0x64&&(_0x22ce48=_0x22ce48[_0x304ee2(0x20a)](0x0,0x64)+_0x304ee2(0x21f)),_0x342bbc[_0x304ee2(0x1b6)](_0x31ced0[_0x304ee2(0x220)](_0x479a6f,_0x4b28ef,'Map',_0x22ce48,_0x103aba,function(_0x492ab3){return function(){return _0x492ab3;};}(_0x54e166)));}),!_0x3182d5){try{for(_0x28e6b1 in _0x4b28ef)if(!(_0x4d7da6&&_0x22e692['test'](_0x28e6b1))&&!this[_0x356c8d(0x1fa)](_0x4b28ef,_0x28e6b1,_0x103aba)){if(_0x4bc5d8++,_0x103aba['autoExpandPropertyCount']++,_0x4bc5d8>_0x1f127c){_0x225ccd=!0x0;break;}if(!_0x103aba[_0x356c8d(0x18b)]&&_0x103aba[_0x356c8d(0x1d6)]&&_0x103aba[_0x356c8d(0x21e)]>_0x103aba[_0x356c8d(0x1fb)]){_0x225ccd=!0x0;break;}_0x342bbc['push'](_0x31ced0[_0x356c8d(0x178)](_0x479a6f,_0x472887,_0x4b28ef,_0x147658,_0x28e6b1,_0x103aba));}}catch{}if(_0x472887[_0x356c8d(0x240)]=!0x0,_0x37ca56&&(_0x472887[_0x356c8d(0x166)]=!0x0),!_0x225ccd){var _0x2b4772=[]['concat'](this[_0x356c8d(0x1f2)](_0x4b28ef))['concat'](this[_0x356c8d(0x1a9)](_0x4b28ef));for(_0x3f1e33=0x0,_0x44a924=_0x2b4772[_0x356c8d(0x218)];_0x3f1e33<_0x44a924;_0x3f1e33++)if(_0x28e6b1=_0x2b4772[_0x3f1e33],!(_0x4d7da6&&_0x22e692[_0x356c8d(0x1c0)](_0x28e6b1[_0x356c8d(0x251)]()))&&!this[_0x356c8d(0x1fa)](_0x4b28ef,_0x28e6b1,_0x103aba)&&!_0x472887[_0x356c8d(0x1f4)+_0x28e6b1[_0x356c8d(0x251)]()]){if(_0x4bc5d8++,_0x103aba[_0x356c8d(0x21e)]++,_0x4bc5d8>_0x1f127c){_0x225ccd=!0x0;break;}if(!_0x103aba[_0x356c8d(0x18b)]&&_0x103aba[_0x356c8d(0x1d6)]&&_0x103aba['autoExpandPropertyCount']>_0x103aba[_0x356c8d(0x1fb)]){_0x225ccd=!0x0;break;}_0x342bbc[_0x356c8d(0x1b6)](_0x31ced0[_0x356c8d(0x178)](_0x479a6f,_0x472887,_0x4b28ef,_0x147658,_0x28e6b1,_0x103aba));}}}}}if(_0x54f18d[_0x356c8d(0x18e)]=_0x147658,_0x364fd8?(_0x54f18d['value']=_0x4b28ef[_0x356c8d(0x189)](),this[_0x356c8d(0x214)](_0x147658,_0x54f18d,_0x103aba,_0x1f7e1c)):_0x147658==='date'?_0x54f18d['value']=this[_0x356c8d(0x205)][_0x356c8d(0x22d)](_0x4b28ef):_0x147658===_0x356c8d(0x1e2)?_0x54f18d[_0x356c8d(0x24f)]=_0x4b28ef['toString']():_0x147658==='RegExp'?_0x54f18d[_0x356c8d(0x24f)]=this[_0x356c8d(0x1a4)][_0x356c8d(0x22d)](_0x4b28ef):_0x147658===_0x356c8d(0x167)&&this[_0x356c8d(0x174)]?_0x54f18d['value']=this[_0x356c8d(0x174)][_0x356c8d(0x1b3)][_0x356c8d(0x251)][_0x356c8d(0x22d)](_0x4b28ef):!_0x103aba[_0x356c8d(0x1ee)]&&!(_0x147658===_0x356c8d(0x222)||_0x147658===_0x356c8d(0x1c8))&&(delete _0x54f18d[_0x356c8d(0x24f)],_0x54f18d[_0x356c8d(0x215)]=!0x0),_0x225ccd&&(_0x54f18d[_0x356c8d(0x1ca)]=!0x0),_0x4d1f43=_0x103aba[_0x356c8d(0x206)]['current'],_0x103aba['node'][_0x356c8d(0x20c)]=_0x54f18d,this[_0x356c8d(0x1a5)](_0x54f18d,_0x103aba),_0x342bbc[_0x356c8d(0x218)]){for(_0x3f1e33=0x0,_0x44a924=_0x342bbc[_0x356c8d(0x218)];_0x3f1e33<_0x44a924;_0x3f1e33++)_0x342bbc[_0x3f1e33](_0x3f1e33);}_0x479a6f[_0x356c8d(0x218)]&&(_0x54f18d['props']=_0x479a6f);}catch(_0x439f12){_0x533745(_0x439f12,_0x54f18d,_0x103aba);}return this['_additionalMetadata'](_0x4b28ef,_0x54f18d),this[_0x356c8d(0x1e8)](_0x54f18d,_0x103aba),_0x103aba[_0x356c8d(0x206)][_0x356c8d(0x20c)]=_0x4d1f43,_0x103aba[_0x356c8d(0x19b)]--,_0x103aba[_0x356c8d(0x1d6)]=_0x373c08,_0x103aba['autoExpand']&&_0x103aba[_0x356c8d(0x18c)]['pop'](),_0x54f18d;}['_getOwnPropertySymbols'](_0x417f97){return Object['getOwnPropertySymbols']?Object['getOwnPropertySymbols'](_0x417f97):[];}[_0x33d8d7(0x212)](_0x2454b9){var _0x1abd13=_0x33d8d7;return!!(_0x2454b9&&_0x1fa5d0['Set']&&this[_0x1abd13(0x1dd)](_0x2454b9)===_0x1abd13(0x1ad)&&_0x2454b9[_0x1abd13(0x1aa)]);}[_0x33d8d7(0x1fa)](_0x52a944,_0x3a6503,_0x10b99c){var _0x3c1f57=_0x33d8d7;return _0x10b99c[_0x3c1f57(0x22c)]?typeof _0x52a944[_0x3a6503]==_0x3c1f57(0x1f5):!0x1;}[_0x33d8d7(0x173)](_0x44e446){var _0x15e800=_0x33d8d7,_0x22cb40='';return _0x22cb40=typeof _0x44e446,_0x22cb40==='object'?this['_objectToString'](_0x44e446)===_0x15e800(0x1d9)?_0x22cb40='array':this[_0x15e800(0x1dd)](_0x44e446)===_0x15e800(0x1f8)?_0x22cb40=_0x15e800(0x20b):this['_objectToString'](_0x44e446)==='[object\\x20BigInt]'?_0x22cb40=_0x15e800(0x1e2):_0x44e446===null?_0x22cb40=_0x15e800(0x222):_0x44e446['constructor']&&(_0x22cb40=_0x44e446[_0x15e800(0x1e1)]['name']||_0x22cb40):_0x22cb40===_0x15e800(0x1c8)&&this[_0x15e800(0x243)]&&_0x44e446 instanceof this[_0x15e800(0x243)]&&(_0x22cb40=_0x15e800(0x199)),_0x22cb40;}[_0x33d8d7(0x1dd)](_0x4a32a7){var _0x366eca=_0x33d8d7;return Object[_0x366eca(0x1b3)]['toString'][_0x366eca(0x22d)](_0x4a32a7);}[_0x33d8d7(0x188)](_0x509d14){var _0x4f00f2=_0x33d8d7;return _0x509d14===_0x4f00f2(0x1ae)||_0x509d14===_0x4f00f2(0x1a6)||_0x509d14==='number';}[_0x33d8d7(0x1b1)](_0x16f9f8){var _0xc3af35=_0x33d8d7;return _0x16f9f8===_0xc3af35(0x1c7)||_0x16f9f8===_0xc3af35(0x1e9)||_0x16f9f8===_0xc3af35(0x1f3);}['_addProperty'](_0x38a046,_0x236699,_0x3d08fa,_0x32634a,_0x3bbe8d,_0x317ae3){var _0x1a7b9d=this;return function(_0x51c727){var _0x46584f=_0xd1c1,_0x1ca955=_0x3bbe8d[_0x46584f(0x206)][_0x46584f(0x20c)],_0x4ad0eb=_0x3bbe8d[_0x46584f(0x206)][_0x46584f(0x1ab)],_0x5f4826=_0x3bbe8d[_0x46584f(0x206)][_0x46584f(0x200)];_0x3bbe8d[_0x46584f(0x206)]['parent']=_0x1ca955,_0x3bbe8d[_0x46584f(0x206)][_0x46584f(0x1ab)]=typeof _0x32634a=='number'?_0x32634a:_0x51c727,_0x38a046[_0x46584f(0x1b6)](_0x1a7b9d[_0x46584f(0x1a7)](_0x236699,_0x3d08fa,_0x32634a,_0x3bbe8d,_0x317ae3)),_0x3bbe8d[_0x46584f(0x206)]['parent']=_0x5f4826,_0x3bbe8d['node'][_0x46584f(0x1ab)]=_0x4ad0eb;};}['_addObjectProperty'](_0x211aff,_0x266e8a,_0xfa9bd3,_0x3c0acf,_0x58079b,_0x599d22,_0x31e50c){var _0x1ba153=_0x33d8d7,_0x18298c=this;return _0x266e8a[_0x1ba153(0x1f4)+_0x58079b[_0x1ba153(0x251)]()]=!0x0,function(_0x8c0660){var _0x27a593=_0x1ba153,_0x387b42=_0x599d22[_0x27a593(0x206)]['current'],_0x596dd2=_0x599d22[_0x27a593(0x206)]['index'],_0x3adf9c=_0x599d22[_0x27a593(0x206)][_0x27a593(0x200)];_0x599d22[_0x27a593(0x206)][_0x27a593(0x200)]=_0x387b42,_0x599d22[_0x27a593(0x206)]['index']=_0x8c0660,_0x211aff[_0x27a593(0x1b6)](_0x18298c[_0x27a593(0x1a7)](_0xfa9bd3,_0x3c0acf,_0x58079b,_0x599d22,_0x31e50c)),_0x599d22[_0x27a593(0x206)][_0x27a593(0x200)]=_0x3adf9c,_0x599d22[_0x27a593(0x206)][_0x27a593(0x1ab)]=_0x596dd2;};}[_0x33d8d7(0x1a7)](_0x2cbc21,_0x354b22,_0x3b9d4f,_0x3a0031,_0x194063){var _0x2b17c0=_0x33d8d7,_0x5b1ce3=this;_0x194063||(_0x194063=function(_0xc5d098,_0x1a8b49){return _0xc5d098[_0x1a8b49];});var _0x1a0c55=_0x3b9d4f['toString'](),_0x41d9cc=_0x3a0031[_0x2b17c0(0x1e4)]||{},_0x407e44=_0x3a0031[_0x2b17c0(0x1ee)],_0x43eb7c=_0x3a0031[_0x2b17c0(0x18b)];try{var _0x5b2660=this[_0x2b17c0(0x1c3)](_0x2cbc21),_0x2c1fc3=_0x1a0c55;_0x5b2660&&_0x2c1fc3[0x0]==='\\x27'&&(_0x2c1fc3=_0x2c1fc3[_0x2b17c0(0x216)](0x1,_0x2c1fc3['length']-0x2));var _0x217e01=_0x3a0031['expressionsToEvaluate']=_0x41d9cc[_0x2b17c0(0x1f4)+_0x2c1fc3];_0x217e01&&(_0x3a0031[_0x2b17c0(0x1ee)]=_0x3a0031['depth']+0x1),_0x3a0031[_0x2b17c0(0x18b)]=!!_0x217e01;var _0x4fb17b=typeof _0x3b9d4f==_0x2b17c0(0x167),_0x12bd61={'name':_0x4fb17b||_0x5b2660?_0x1a0c55:this[_0x2b17c0(0x1fd)](_0x1a0c55)};if(_0x4fb17b&&(_0x12bd61[_0x2b17c0(0x167)]=!0x0),!(_0x354b22===_0x2b17c0(0x21c)||_0x354b22===_0x2b17c0(0x211))){var _0x2ad47e=this[_0x2b17c0(0x171)](_0x2cbc21,_0x3b9d4f);if(_0x2ad47e&&(_0x2ad47e['set']&&(_0x12bd61[_0x2b17c0(0x16f)]=!0x0),_0x2ad47e[_0x2b17c0(0x242)]&&!_0x217e01&&!_0x3a0031[_0x2b17c0(0x176)]))return _0x12bd61['getter']=!0x0,this[_0x2b17c0(0x241)](_0x12bd61,_0x3a0031),_0x12bd61;}var _0x45993a;try{_0x45993a=_0x194063(_0x2cbc21,_0x3b9d4f);}catch(_0x41cacc){return _0x12bd61={'name':_0x1a0c55,'type':_0x2b17c0(0x20d),'error':_0x41cacc[_0x2b17c0(0x1fc)]},this[_0x2b17c0(0x241)](_0x12bd61,_0x3a0031),_0x12bd61;}var _0x2f6f88=this[_0x2b17c0(0x173)](_0x45993a),_0x364a79=this['_isPrimitiveType'](_0x2f6f88);if(_0x12bd61['type']=_0x2f6f88,_0x364a79)this[_0x2b17c0(0x241)](_0x12bd61,_0x3a0031,_0x45993a,function(){var _0x463e83=_0x2b17c0;_0x12bd61['value']=_0x45993a[_0x463e83(0x189)](),!_0x217e01&&_0x5b1ce3[_0x463e83(0x214)](_0x2f6f88,_0x12bd61,_0x3a0031,{});});else{var _0x180677=_0x3a0031[_0x2b17c0(0x1d6)]&&_0x3a0031[_0x2b17c0(0x19b)]<_0x3a0031['autoExpandMaxDepth']&&_0x3a0031[_0x2b17c0(0x18c)][_0x2b17c0(0x17f)](_0x45993a)<0x0&&_0x2f6f88!==_0x2b17c0(0x1f5)&&_0x3a0031['autoExpandPropertyCount']<_0x3a0031[_0x2b17c0(0x1fb)];_0x180677||_0x3a0031[_0x2b17c0(0x19b)]<_0x407e44||_0x217e01?(this[_0x2b17c0(0x1bb)](_0x12bd61,_0x45993a,_0x3a0031,_0x217e01||{}),this[_0x2b17c0(0x181)](_0x45993a,_0x12bd61)):this['_processTreeNodeResult'](_0x12bd61,_0x3a0031,_0x45993a,function(){var _0x18cf0d=_0x2b17c0;_0x2f6f88===_0x18cf0d(0x222)||_0x2f6f88==='undefined'||(delete _0x12bd61['value'],_0x12bd61[_0x18cf0d(0x215)]=!0x0);});}return _0x12bd61;}finally{_0x3a0031[_0x2b17c0(0x1e4)]=_0x41d9cc,_0x3a0031[_0x2b17c0(0x1ee)]=_0x407e44,_0x3a0031[_0x2b17c0(0x18b)]=_0x43eb7c;}}[_0x33d8d7(0x214)](_0x3d4b53,_0x59ae7b,_0x4b7fff,_0x1e4479){var _0x29b0cd=_0x33d8d7,_0x2e289e=_0x1e4479[_0x29b0cd(0x22a)]||_0x4b7fff[_0x29b0cd(0x22a)];if((_0x3d4b53===_0x29b0cd(0x1a6)||_0x3d4b53===_0x29b0cd(0x1e9))&&_0x59ae7b['value']){let _0x252ef3=_0x59ae7b['value'][_0x29b0cd(0x218)];_0x4b7fff[_0x29b0cd(0x179)]+=_0x252ef3,_0x4b7fff[_0x29b0cd(0x179)]>_0x4b7fff[_0x29b0cd(0x1f6)]?(_0x59ae7b[_0x29b0cd(0x215)]='',delete _0x59ae7b[_0x29b0cd(0x24f)]):_0x252ef3>_0x2e289e&&(_0x59ae7b[_0x29b0cd(0x215)]=_0x59ae7b[_0x29b0cd(0x24f)][_0x29b0cd(0x216)](0x0,_0x2e289e),delete _0x59ae7b['value']);}}[_0x33d8d7(0x1c3)](_0x573113){var _0x434a8e=_0x33d8d7;return!!(_0x573113&&_0x1fa5d0[_0x434a8e(0x229)]&&this['_objectToString'](_0x573113)===_0x434a8e(0x1bf)&&_0x573113[_0x434a8e(0x1aa)]);}[_0x33d8d7(0x1fd)](_0x255e60){var _0x389d15=_0x33d8d7;if(_0x255e60['match'](/^\\d+$/))return _0x255e60;var _0x1e90e4;try{_0x1e90e4=JSON[_0x389d15(0x204)](''+_0x255e60);}catch{_0x1e90e4='\\x22'+this[_0x389d15(0x1dd)](_0x255e60)+'\\x22';}return _0x1e90e4[_0x389d15(0x203)](/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)?_0x1e90e4=_0x1e90e4['substr'](0x1,_0x1e90e4['length']-0x2):_0x1e90e4=_0x1e90e4[_0x389d15(0x19c)](/'/g,'\\x5c\\x27')[_0x389d15(0x19c)](/\\\\\"/g,'\\x22')['replace'](/(^\"|\"$)/g,'\\x27'),_0x1e90e4;}[_0x33d8d7(0x241)](_0x86f5e9,_0x1a7676,_0xd4c2cd,_0xefca8e){var _0x54ee02=_0x33d8d7;this[_0x54ee02(0x1a5)](_0x86f5e9,_0x1a7676),_0xefca8e&&_0xefca8e(),this['_additionalMetadata'](_0xd4c2cd,_0x86f5e9),this[_0x54ee02(0x1e8)](_0x86f5e9,_0x1a7676);}[_0x33d8d7(0x1a5)](_0x5aa706,_0x5ca2f0){var _0x286bfd=_0x33d8d7;this['_setNodeId'](_0x5aa706,_0x5ca2f0),this[_0x286bfd(0x1cf)](_0x5aa706,_0x5ca2f0),this['_setNodeExpressionPath'](_0x5aa706,_0x5ca2f0),this[_0x286bfd(0x201)](_0x5aa706,_0x5ca2f0);}['_setNodeId'](_0x526b5f,_0xf45b65){}[_0x33d8d7(0x1cf)](_0x176ebd,_0x2f877d){}[_0x33d8d7(0x1a3)](_0x2b417d,_0x48b0d7){}[_0x33d8d7(0x1b2)](_0x20904f){var _0x556fa0=_0x33d8d7;return _0x20904f===this[_0x556fa0(0x183)];}[_0x33d8d7(0x1e8)](_0x374336,_0x15001b){var _0x56adcb=_0x33d8d7;this['_setNodeLabel'](_0x374336,_0x15001b),this['_setNodeExpandableState'](_0x374336),_0x15001b[_0x56adcb(0x1d1)]&&this['_sortProps'](_0x374336),this[_0x56adcb(0x1b0)](_0x374336,_0x15001b),this[_0x56adcb(0x182)](_0x374336,_0x15001b),this[_0x56adcb(0x1ea)](_0x374336);}[_0x33d8d7(0x181)](_0xde5ccd,_0x111a8d){var _0x38b743=_0x33d8d7;let _0x1f74c0;try{_0x1fa5d0['console']&&(_0x1f74c0=_0x1fa5d0['console'][_0x38b743(0x1d8)],_0x1fa5d0[_0x38b743(0x17e)][_0x38b743(0x1d8)]=function(){}),_0xde5ccd&&typeof _0xde5ccd[_0x38b743(0x218)]==_0x38b743(0x1d5)&&(_0x111a8d[_0x38b743(0x218)]=_0xde5ccd[_0x38b743(0x218)]);}catch{}finally{_0x1f74c0&&(_0x1fa5d0[_0x38b743(0x17e)][_0x38b743(0x1d8)]=_0x1f74c0);}if(_0x111a8d[_0x38b743(0x18e)]===_0x38b743(0x1d5)||_0x111a8d['type']===_0x38b743(0x1f3)){if(isNaN(_0x111a8d[_0x38b743(0x24f)]))_0x111a8d[_0x38b743(0x223)]=!0x0,delete _0x111a8d[_0x38b743(0x24f)];else switch(_0x111a8d[_0x38b743(0x24f)]){case Number[_0x38b743(0x252)]:_0x111a8d[_0x38b743(0x18a)]=!0x0,delete _0x111a8d[_0x38b743(0x24f)];break;case Number[_0x38b743(0x234)]:_0x111a8d[_0x38b743(0x24b)]=!0x0,delete _0x111a8d[_0x38b743(0x24f)];break;case 0x0:this[_0x38b743(0x22e)](_0x111a8d[_0x38b743(0x24f)])&&(_0x111a8d[_0x38b743(0x175)]=!0x0);break;}}else _0x111a8d[_0x38b743(0x18e)]===_0x38b743(0x1f5)&&typeof _0xde5ccd[_0x38b743(0x1ff)]==_0x38b743(0x1a6)&&_0xde5ccd['name']&&_0x111a8d['name']&&_0xde5ccd[_0x38b743(0x1ff)]!==_0x111a8d[_0x38b743(0x1ff)]&&(_0x111a8d[_0x38b743(0x17b)]=_0xde5ccd[_0x38b743(0x1ff)]);}[_0x33d8d7(0x22e)](_0x3f87a8){var _0x3d0a2b=_0x33d8d7;return 0x1/_0x3f87a8===Number[_0x3d0a2b(0x234)];}['_sortProps'](_0x2986e0){var _0x202fb4=_0x33d8d7;!_0x2986e0[_0x202fb4(0x1c6)]||!_0x2986e0[_0x202fb4(0x1c6)][_0x202fb4(0x218)]||_0x2986e0[_0x202fb4(0x18e)]===_0x202fb4(0x21c)||_0x2986e0['type']===_0x202fb4(0x229)||_0x2986e0[_0x202fb4(0x18e)]===_0x202fb4(0x249)||_0x2986e0[_0x202fb4(0x1c6)]['sort'](function(_0x36133a,_0x3025f2){var _0xeec050=_0x202fb4,_0x44f2ce=_0x36133a['name']['toLowerCase'](),_0x1e067c=_0x3025f2['name'][_0xeec050(0x196)]();return _0x44f2ce<_0x1e067c?-0x1:_0x44f2ce>_0x1e067c?0x1:0x0;});}[_0x33d8d7(0x1b0)](_0x10588d,_0xfc904){var _0x36c1e4=_0x33d8d7;if(!(_0xfc904[_0x36c1e4(0x22c)]||!_0x10588d['props']||!_0x10588d[_0x36c1e4(0x1c6)][_0x36c1e4(0x218)])){for(var _0x395b33=[],_0x45ad74=[],_0x5dbdc3=0x0,_0x50a0c0=_0x10588d[_0x36c1e4(0x1c6)][_0x36c1e4(0x218)];_0x5dbdc3<_0x50a0c0;_0x5dbdc3++){var _0x31217e=_0x10588d['props'][_0x5dbdc3];_0x31217e[_0x36c1e4(0x18e)]==='function'?_0x395b33[_0x36c1e4(0x1b6)](_0x31217e):_0x45ad74[_0x36c1e4(0x1b6)](_0x31217e);}if(!(!_0x45ad74[_0x36c1e4(0x218)]||_0x395b33[_0x36c1e4(0x218)]<=0x1)){_0x10588d['props']=_0x45ad74;var _0x5c4438={'functionsNode':!0x0,'props':_0x395b33};this[_0x36c1e4(0x226)](_0x5c4438,_0xfc904),this[_0x36c1e4(0x1a3)](_0x5c4438,_0xfc904),this[_0x36c1e4(0x224)](_0x5c4438),this[_0x36c1e4(0x201)](_0x5c4438,_0xfc904),_0x5c4438['id']+='\\x20f',_0x10588d[_0x36c1e4(0x1c6)][_0x36c1e4(0x170)](_0x5c4438);}}}['_addLoadNode'](_0x2687e5,_0x11a805){}['_setNodeExpandableState'](_0x1ab1a0){}[_0x33d8d7(0x22f)](_0x7d1ae8){var _0x58f8ea=_0x33d8d7;return Array['isArray'](_0x7d1ae8)||typeof _0x7d1ae8==_0x58f8ea(0x1da)&&this['_objectToString'](_0x7d1ae8)===_0x58f8ea(0x1d9);}[_0x33d8d7(0x201)](_0x3f54ea,_0x123312){}[_0x33d8d7(0x1ea)](_0x354bd4){var _0x529acc=_0x33d8d7;delete _0x354bd4['_hasSymbolPropertyOnItsPath'],delete _0x354bd4[_0x529acc(0x1ec)],delete _0x354bd4[_0x529acc(0x19f)];}[_0x33d8d7(0x1d3)](_0x504baa,_0x8854bf){}}let _0x46aab6=new _0x13ccf3(),_0x299932={'props':0x64,'elements':0x64,'strLength':0x400*0x32,'totalStrLength':0x400*0x32,'autoExpandLimit':0x1388,'autoExpandMaxDepth':0xa},_0x5d2bb0={'props':0x5,'elements':0x5,'strLength':0x100,'totalStrLength':0x100*0x3,'autoExpandLimit':0x1e,'autoExpandMaxDepth':0x2};function _0x21b343(_0x4b4bfb,_0x3ccb71,_0x4e9abd,_0x3f4466,_0x2e9d71,_0x59255f){var _0x251ba0=_0x33d8d7;let _0x4339f4,_0x1a4c74;try{_0x1a4c74=_0x4ed4bc(),_0x4339f4=_0x2f1331[_0x3ccb71],!_0x4339f4||_0x1a4c74-_0x4339f4['ts']>0x1f4&&_0x4339f4['count']&&_0x4339f4['time']/_0x4339f4[_0x251ba0(0x1a8)]<0x64?(_0x2f1331[_0x3ccb71]=_0x4339f4={'count':0x0,'time':0x0,'ts':_0x1a4c74},_0x2f1331['hits']={}):_0x1a4c74-_0x2f1331['hits']['ts']>0x32&&_0x2f1331[_0x251ba0(0x22b)][_0x251ba0(0x1a8)]&&_0x2f1331['hits'][_0x251ba0(0x1fe)]/_0x2f1331[_0x251ba0(0x22b)][_0x251ba0(0x1a8)]<0x64&&(_0x2f1331['hits']={});let _0x5c9150=[],_0x297681=_0x4339f4['reduceLimits']||_0x2f1331['hits'][_0x251ba0(0x250)]?_0x5d2bb0:_0x299932,_0x26b1c9=_0x21fd2d=>{var _0x17bbd7=_0x251ba0;let _0x113335={};return _0x113335[_0x17bbd7(0x1c6)]=_0x21fd2d[_0x17bbd7(0x1c6)],_0x113335[_0x17bbd7(0x192)]=_0x21fd2d['elements'],_0x113335[_0x17bbd7(0x22a)]=_0x21fd2d['strLength'],_0x113335[_0x17bbd7(0x1f6)]=_0x21fd2d[_0x17bbd7(0x1f6)],_0x113335[_0x17bbd7(0x1fb)]=_0x21fd2d[_0x17bbd7(0x1fb)],_0x113335[_0x17bbd7(0x232)]=_0x21fd2d[_0x17bbd7(0x232)],_0x113335['sortProps']=!0x1,_0x113335[_0x17bbd7(0x22c)]=!_0x4b89d2,_0x113335['depth']=0x1,_0x113335[_0x17bbd7(0x19b)]=0x0,_0x113335[_0x17bbd7(0x245)]=_0x17bbd7(0x1e5),_0x113335[_0x17bbd7(0x1d4)]=_0x17bbd7(0x17d),_0x113335[_0x17bbd7(0x1d6)]=!0x0,_0x113335[_0x17bbd7(0x18c)]=[],_0x113335[_0x17bbd7(0x21e)]=0x0,_0x113335[_0x17bbd7(0x176)]=!0x0,_0x113335[_0x17bbd7(0x179)]=0x0,_0x113335[_0x17bbd7(0x206)]={'current':void 0x0,'parent':void 0x0,'index':0x0},_0x113335;};for(var _0x278ae7=0x0;_0x278ae7<_0x2e9d71[_0x251ba0(0x218)];_0x278ae7++)_0x5c9150[_0x251ba0(0x1b6)](_0x46aab6[_0x251ba0(0x1bb)]({'timeNode':_0x4b4bfb===_0x251ba0(0x1fe)||void 0x0},_0x2e9d71[_0x278ae7],_0x26b1c9(_0x297681),{}));if(_0x4b4bfb==='trace'){let _0xa570f0=Error['stackTraceLimit'];try{Error[_0x251ba0(0x19d)]=0x1/0x0,_0x5c9150['push'](_0x46aab6[_0x251ba0(0x1bb)]({'stackNode':!0x0},new Error()[_0x251ba0(0x1ba)],_0x26b1c9(_0x297681),{'strLength':0x1/0x0}));}finally{Error[_0x251ba0(0x19d)]=_0xa570f0;}}return{'method':_0x251ba0(0x23b),'version':_0x3d9357,'args':[{'ts':_0x4e9abd,'session':_0x3f4466,'args':_0x5c9150,'id':_0x3ccb71,'context':_0x59255f}]};}catch(_0x5dfc8b){return{'method':_0x251ba0(0x23b),'version':_0x3d9357,'args':[{'ts':_0x4e9abd,'session':_0x3f4466,'args':[{'type':_0x251ba0(0x20d),'error':_0x5dfc8b&&_0x5dfc8b[_0x251ba0(0x1fc)]}],'id':_0x3ccb71,'context':_0x59255f}]};}finally{try{if(_0x4339f4&&_0x1a4c74){let _0xc44091=_0x4ed4bc();_0x4339f4['count']++,_0x4339f4['time']+=_0x593b17(_0x1a4c74,_0xc44091),_0x4339f4['ts']=_0xc44091,_0x2f1331[_0x251ba0(0x22b)][_0x251ba0(0x1a8)]++,_0x2f1331[_0x251ba0(0x22b)][_0x251ba0(0x1fe)]+=_0x593b17(_0x1a4c74,_0xc44091),_0x2f1331[_0x251ba0(0x22b)]['ts']=_0xc44091,(_0x4339f4[_0x251ba0(0x1a8)]>0x32||_0x4339f4[_0x251ba0(0x1fe)]>0x64)&&(_0x4339f4[_0x251ba0(0x250)]=!0x0),(_0x2f1331[_0x251ba0(0x22b)]['count']>0x3e8||_0x2f1331[_0x251ba0(0x22b)][_0x251ba0(0x1fe)]>0x12c)&&(_0x2f1331[_0x251ba0(0x22b)][_0x251ba0(0x250)]=!0x0);}}catch{}}}return _0x21b343;}((_0x9ebe41,_0x4e0a72,_0x1b01f5,_0x99fb2,_0x21c2c3,_0x43001e,_0x4dc56f,_0x29f908,_0x15ff22,_0x140422)=>{var _0x5646be=_0x212723;if(_0x9ebe41[_0x5646be(0x225)])return _0x9ebe41[_0x5646be(0x225)];if(!J(_0x9ebe41,_0x29f908,_0x21c2c3))return _0x9ebe41[_0x5646be(0x225)]={'consoleLog':()=>{},'consoleTrace':()=>{},'consoleTime':()=>{},'consoleTimeEnd':()=>{},'autoLog':()=>{},'autoLogMany':()=>{},'autoTraceMany':()=>{},'coverage':()=>{},'autoTrace':()=>{},'autoTime':()=>{},'autoTimeEnd':()=>{}},_0x9ebe41[_0x5646be(0x225)];let _0x474dcd=W(_0x9ebe41),_0x2597bc=_0x474dcd[_0x5646be(0x24e)],_0xb2b8cb=_0x474dcd[_0x5646be(0x24a)],_0x58804e=_0x474dcd[_0x5646be(0x247)],_0x1be5fb={'hits':{},'ts':{}},_0x3c5be9=Y(_0x9ebe41,_0x15ff22,_0x1be5fb,_0x43001e),_0x41a592=_0xaf5411=>{_0x1be5fb['ts'][_0xaf5411]=_0xb2b8cb();},_0x3aeb28=(_0x3b5724,_0x208469)=>{let _0x381f90=_0x1be5fb['ts'][_0x208469];if(delete _0x1be5fb['ts'][_0x208469],_0x381f90){let _0x3bb8ab=_0x2597bc(_0x381f90,_0xb2b8cb());_0x5a3174(_0x3c5be9('time',_0x3b5724,_0x58804e(),_0x89fcf2,[_0x3bb8ab],_0x208469));}},_0x421a52=_0xeddc6a=>_0x53e2af=>{var _0x396ece=_0x5646be;try{_0x41a592(_0x53e2af),_0xeddc6a(_0x53e2af);}finally{_0x9ebe41['console'][_0x396ece(0x1fe)]=_0xeddc6a;}},_0x5adb26=_0x36c9d6=>_0x26e5f5=>{var _0x4be529=_0x5646be;try{let [_0x2899fa,_0x152676]=_0x26e5f5[_0x4be529(0x1be)](_0x4be529(0x1ac));_0x3aeb28(_0x152676,_0x2899fa),_0x36c9d6(_0x2899fa);}finally{_0x9ebe41[_0x4be529(0x17e)][_0x4be529(0x238)]=_0x36c9d6;}};_0x9ebe41[_0x5646be(0x225)]={'consoleLog':(_0x4c5572,_0x1dead2)=>{var _0x4fac0d=_0x5646be;_0x9ebe41[_0x4fac0d(0x17e)]['log']['name']!==_0x4fac0d(0x191)&&_0x5a3174(_0x3c5be9('log',_0x4c5572,_0x58804e(),_0x89fcf2,_0x1dead2));},'consoleTrace':(_0x34cc22,_0x1e7f66)=>{var _0x42fb2d=_0x5646be;_0x9ebe41['console'][_0x42fb2d(0x23b)][_0x42fb2d(0x1ff)]!==_0x42fb2d(0x1ce)&&_0x5a3174(_0x3c5be9('trace',_0x34cc22,_0x58804e(),_0x89fcf2,_0x1e7f66));},'consoleTime':()=>{var _0x13a169=_0x5646be;_0x9ebe41['console'][_0x13a169(0x1fe)]=_0x421a52(_0x9ebe41[_0x13a169(0x17e)][_0x13a169(0x1fe)]);},'consoleTimeEnd':()=>{var _0x56284f=_0x5646be;_0x9ebe41[_0x56284f(0x17e)]['timeEnd']=_0x5adb26(_0x9ebe41[_0x56284f(0x17e)][_0x56284f(0x238)]);},'autoLog':(_0x322fb5,_0x3a2081)=>{var _0x1aef39=_0x5646be;_0x5a3174(_0x3c5be9(_0x1aef39(0x23b),_0x3a2081,_0x58804e(),_0x89fcf2,[_0x322fb5]));},'autoLogMany':(_0x39c139,_0x1fefac)=>{var _0x3acbc5=_0x5646be;_0x5a3174(_0x3c5be9(_0x3acbc5(0x23b),_0x39c139,_0x58804e(),_0x89fcf2,_0x1fefac));},'autoTrace':(_0x3dd2d6,_0xd8307e)=>{var _0x5f2786=_0x5646be;_0x5a3174(_0x3c5be9(_0x5f2786(0x1cd),_0xd8307e,_0x58804e(),_0x89fcf2,[_0x3dd2d6]));},'autoTraceMany':(_0x891d8c,_0x11b1aa)=>{var _0x5d44a7=_0x5646be;_0x5a3174(_0x3c5be9(_0x5d44a7(0x1cd),_0x891d8c,_0x58804e(),_0x89fcf2,_0x11b1aa));},'autoTime':(_0x1b9d5d,_0x8af011,_0x275260)=>{_0x41a592(_0x275260);},'autoTimeEnd':(_0x21a621,_0x99f92e,_0x52a88e)=>{_0x3aeb28(_0x99f92e,_0x52a88e);},'coverage':_0x26aa2b=>{var _0x533e73=_0x5646be;_0x5a3174({'method':_0x533e73(0x1b7),'version':_0x43001e,'args':[{'id':_0x26aa2b}]});}};let _0x5a3174=b(_0x9ebe41,_0x4e0a72,_0x1b01f5,_0x99fb2,_0x21c2c3,_0x140422),_0x89fcf2=_0x9ebe41['_console_ninja_session'];return _0x9ebe41[_0x5646be(0x225)];})(globalThis,_0x212723(0x20e),_0x212723(0x1c9),_0x212723(0x1f0),_0x212723(0x16d),'1.0.0',_0x212723(0x193),_0x212723(0x1c5),'','');")}catch{}})().consoleLog(r,o)}catch{}return o}("1728566480_70_2_70_63_4","Nuevo nombre del sat\xe9lite:",this.satelliteName)),this.satelliteNameSubject.next(this.satelliteName)}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275prov=It({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function PF(r,o,s,c,h,m,y){try{var w=r[m](y),M=w.value}catch(S){return void s(S)}w.done?o(M):Promise.resolve(M).then(c,h)}let RF=(()=>{class r{constructor(s,c){this.http=s,this.satelliteService=c,this.selectedSatellite="",this.satelliteInfo="",this.satelliteName=""}getSatelliteInfo(){var s=this;return function qV(r){return function(){var o=this,s=arguments;return new Promise(function(c,h){var m=r.apply(o,s);function y(M){PF(m,c,h,y,w,"next",M)}function w(M){PF(m,c,h,y,w,"throw",M)}y(void 0)})}}(function*(){if(s.selectedSatellite)try{const c=yield s.http.get(`https://us-central1-orbital-trackr.cloudfunctions.net/app/satellite/${s.selectedSatellite}`,{responseType:"text"}).toPromise();if(void 0!==c){s.satelliteInfo=c;const h=c.split(/\r?\n/).filter(m=>m.trim().length>0);if(h.length>=3){s.satelliteName=h[0].trim();const m=h[1].trim(),y=h[2].trim();s.satelliteService.updateTLE(m,y,s.satelliteName),s.satelliteService.updateSatelliteName(s.satelliteName)}else console.error("La respuesta del servidor no tiene el formato esperado")}else console.error("La respuesta del servidor est\xe1 vac\xeda")}catch(c){console.error("Hubo un error al obtener la informaci\xf3n del sat\xe9lite:",c)}else console.error("Por favor, selecciona un sat\xe9lite")})()}static#e=this.\u0275fac=function(c){return new(c||r)(je(jO),je(IF))};static#t=this.\u0275cmp=Pc({type:r,selectors:[["app-satellite-info"]],decls:15,vars:2,consts:[["for","satelliteSelector"],["id","satelliteSelector",3,"ngModel","ngModelChange"],["value","SSOT"],["value","EROS C3"],["value","EROS B"],["value","PERUSAT 1"],[3,"click"],["id","tleInfo"]],template:function(c,h){1&c&&(jo(0,"label",0),uc(1,"Selecciona un sat\xe9lite:"),po(),jo(2,"select",1),Uo("ngModelChange",function(y){return h.selectedSatellite=y}),jo(3,"option",2),uc(4,"SSOT"),po(),jo(5,"option",3),uc(6,"EROS C3"),po(),jo(7,"option",4),uc(8,"EROS B"),po(),jo(9,"option",5),uc(10,"PERUSAT 1"),po()(),jo(11,"button",6),Uo("click",function(){return h.getSatelliteInfo()}),uc(12,"Obtener TLE"),po(),jo(13,"div",7),uc(14),po()),2&c&&(ho(2),jd("ngModel",h.selectedSatellite),ho(12),c1(h.satelliteInfo))},dependencies:[Yk,Kk,NC,Dk,Q3]})}return r})(),OF=(()=>{class r{constructor(s){this.satelliteService=s,this.mapInitialized=!1}ngOnInit(){this.satelliteSubscription=this.satelliteService.coordinates$.subscribe(s=>{this.satelliteCoordinates=s,this.updateMarkerPosition()}),this.satelliteService.satelliteName$.subscribe(s=>{this.satelliteName=s,this.mapInitialized&&this.addOrUpdateMarker()})}ngOnDestroy(){this.satelliteSubscription&&this.satelliteSubscription.unsubscribe()}ngAfterViewInit(){this.initializeMap()}initializeMap(){this.mapInitialized||(AP().accessToken="pk.eyJ1Ijoic2hpemExOTkxIiwiYSI6ImNscWZ5eGo0ZTE0NGUya3F3eDA5bzh6bXoifQ.ru0c29-QaQzDC_AefTP9tA",this.satelliteSubscription=this.satelliteService.coordinates$.subscribe(s=>{this.satelliteCoordinates=s,this.satelliteCoordinates&&!this.map&&(this.map=new(AP().Map)({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[s.longitude,s.latitude],zoom:5}),this.map.on("load",()=>{this.mapInitialized=!0,this.addOrUpdateMarker()}))}))}updateMarkerPosition(){if(this.mapInitialized&&this.map&&this.satelliteCoordinates){this.addOrUpdateMarker();const{latitude:s,longitude:c}=this.satelliteCoordinates;this.map.flyTo({center:[c,s],essential:!0}),this.addOrUpdateMarker()}}addOrUpdateMarker(){if(!this.map||!this.satelliteCoordinates||!this.satelliteName)return;const{latitude:s,longitude:c}=this.satelliteCoordinates,h=document.createElement("div");if(h.className="custom-marker",h.style.backgroundImage="url('../../assets/img/fasat.png')",h.style.width="200px",h.style.height="200px",h.style.backgroundSize="contain",h.style.backgroundPosition="center center",h.style.backgroundRepeat="no-repeat",h.style.cursor="pointer",this.marker){this.marker.setLngLat([c,s]);const m=this.marker.getElement().querySelector("#satelliteNameLabel");m&&(m.innerHTML=this.satelliteName)}else{this.marker=new(AP().Marker)(h).setLngLat([c,s]).addTo(this.map);const m=document.createElement("div");m.id="satelliteNameLabel",m.innerHTML=this.satelliteName,m.style.color="#ffffff",m.style.fontSize="20px",m.style.textAlign="center",m.style.backgroundColor="#000000",m.style.padding="5px",m.style.borderRadius="5px",m.style.width="70px",this.marker.getElement().appendChild(m)}}static#e=this.\u0275fac=function(c){return new(c||r)(je(IF))};static#t=this.\u0275cmp=Pc({type:r,selectors:[["app-satellite-map"]],decls:2,vars:0,consts:[["id","map",1,"map-container"]],template:function(c,h){1&c&&Ud(0,"app-satellite-info")(1,"div",0)},dependencies:[RF],styles:[".map-container[_ngcontent-%COMP%]{height:1350px;width:100%}"]})}return r})();const ZV=[{path:"satellite",component:OF},{path:"satelliteInfo",component:RF}];let WV=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({imports:[fF.forRoot(ZV),fF]})}return r})(),XV=(()=>{class r{constructor(){this.title="Orbital"}static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275cmp=Pc({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(c,h){1&c&&Ud(0,"app-satellite-map")},dependencies:[OF]})}return r})(),YV=(()=>{class r{static#e=this.\u0275fac=function(c){return new(c||r)};static#t=this.\u0275mod=Fo({type:r,bootstrap:[XV]});static#n=this.\u0275inj=Yo({imports:[f5,WV,$5,Kz]})}return r})();h5().bootstrapModule(YV).catch(r=>console.error(r))},574:function(Ey){Ey.exports=function(){"use strict";var vh,gu,sr;function wf(Xe,ie){if(vh)if(gu){var la="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+vh+")(sharedChunk); ("+gu+")(sharedChunk); self.onerror = null;",Ha={};vh(Ha),sr=ie(Ha),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(sr.workerUrl=window.URL.createObjectURL(new Blob([la],{type:"text/javascript"})))}else gu=ie;else vh=ie}return wf(0,function(Xe){var ie=typeof self<"u"?self:{},la="3.0.1";let Ha;const kt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ha){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ha=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{Ha=t}}return Ha},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!kt.API_URL)return null;try{const t=new URL(kt.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},ws={supported:!1,testSupport:function(t){!_u&&kl&&(bc?Zm(t):ca=t)}};let ca,kl,_u=!1,bc=!1;function Zm(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,kl),t.isContextLost())return;ws.supported=!0}catch{}t.deleteTexture(e),_u=!0}ie.document&&(kl=ie.document.createElement("img"),kl.onload=function(){ca&&Zm(ca),ca=null,bc=!0},kl.onerror=function(){_u=!0,ca=null},kl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ef="01";function Zo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ga=qa;function qa(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}qa.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var a=this.sampleCurveX(n)-t;if(Math.abs(a)<e)return n;var l=this.sampleCurveDerivativeX(n);if(Math.abs(l)<1e-6)break;n-=a/l}var u=0,d=1;for(n=t,i=0;i<20&&(a=this.sampleCurveX(n),!(Math.abs(a-t)<e));i++)t>a?u=n:d=n,n=.5*(d-u)+u;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Wm=Zo(Ga),wc=Za;function Za(t,e){this.x=t,this.y=e}Za.prototype={clone:function(){return new Za(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),a=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Za.convert=function(t){return t instanceof Za?t:Array.isArray(t)?new Za(t[0],t[1]):t};var ee=Zo(wc);function en(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!en(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!en(t[n],e[n]))return!1;return!0}return t===e}const yu=Math.PI/180,Wa=180/Math.PI;function Et(t){return t*yu}function ei(t){return t*Wa}const Ty=[[0,0],[1,0],[1,1],[0,1]];function Ec(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Xa(t){let e=1/0,n=1/0,i=-1/0,a=-1/0;for(const l of t)e=Math.min(e,l.x),n=Math.min(n,l.y),i=Math.max(i,l.x),a=Math.max(a,l.y);return{min:new ee(e,n),max:new ee(i,a)}}function xu(t,e,n=0,i=!0){const a=new ee(n,n),l=t.sub(a),u=e.add(a),d=[l,new ee(u.x,l.y),u,new ee(l.x,u.y)];return i&&d.push(l.clone()),d}function Mc(t,e,n,i){const a=new Wm(t,e,n,i);return function(l){return a.solve(l)}}const Un=Mc(.25,.1,.25,1);function We(t,e,n){return Math.min(n,Math.max(e,t))}function Ya(t,e,n){return(n=We((n-t)/(e-t),0,1))*n*(3-2*n)}function Ja(t,e,n){const i=n-e,a=((t-e)%i+i)%i+e;return a===e?n:a}function vu(t,e,n){if(!t.length)return n(null,[]);let i=t.length;const a=new Array(t.length);let l=null;t.forEach((u,d)=>{e(u,(f,p)=>{f&&(l=f),a[d]=p,0==--i&&n(l,a)})})}function Mi(t){const e=[];for(const n in t)e.push(t[n]);return e}function qe(t,...e){for(const n of e)for(const i in n)t[i]=n[i];return t}function Ro(t,e){const n={};for(let i=0;i<e.length;i++){const a=e[i];a in t&&(n[a]=t[a])}return n}let ci=1;function Ar(){return ci++}function Xm(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function On(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function bh(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ui(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Tc(t,e){return-1!==t.indexOf(e,t.length-e.length)}function wh(t,e,n){const i={};for(const a in t)i[a]=e.call(n||this,t[a],a,t);return i}function Ie(t,e,n){const i={};for(const a in t)e.call(n||this,t[a],a,t)&&(i[a]=t[a]);return i}function U(t){return Array.isArray(t)?t.map(U):"object"==typeof t&&t?wh(t,U):t}const q={};function K(t){q[t]||(typeof console<"u"&&console.warn(t),q[t]=!0)}function xe(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Ee(t){let e=0;for(let n,i,a=0,l=t.length,u=l-1;a<l;u=a++)n=t[a],i=t[u],e+=(i.x-n.x)*(n.y+i.y);return e}function $e([t,e,n]){const i=Et(e+90),a=Et(n);return{x:t*Math.cos(i)*Math.sin(a),y:t*Math.sin(i)*Math.sin(a),z:t*Math.cos(a),azimuthal:e,polar:n}}function Ye(t,e,n){const i=Math.sqrt(t*t+e*e+n*n),a=i>0?Math.acos(n/i)*Wa:0;let l=0!==t||0!==e?Math.atan2(-e,-t)*Wa+90:0;return l<0&&(l+=360),[i,l,a]}function we(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function tt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,i,a,l)=>{const u=a||l;return e[i]=!u||u.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let mt=null;function gt(){return!!ie.document.fullscreenElement||!!ie.document.webkitFullscreenElement}function In(t){try{const e=ie[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function _r(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function xi(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]}function yr(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]}function Fn(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]}const Nn="mapbox-tiles";let Oo,ua,eo=500,_o=50;function Eh(){try{return ie.caches}catch{}}function Wo(){Eh()&&!Oo&&(Oo=ie.caches.open(Nn))}function Ll(t){const e=t.indexOf("?");if(e<0)return t;const i=function(a){const l=a.indexOf("?");return l>0?a.slice(l+1).split("&"):[]}(t).filter(a=>{const l=a.split("=");return"language"===l[0]||"worldview"===l[0]});return i.length?`${t.slice(0,e)}?${i.join("&")}`:t.slice(0,e)}let Cc=1/0;function Mh(t){Cc++,Cc>_o&&(t.getActor().send("enforceCacheSizeLimit",eo),Cc=0)}const fe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(fe);class ye extends Error{constructor(e,n,i){401===n&&fn(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Te=we()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ie.location.protocol?ie.parent:ie).location.href,Pe=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Te())&&!/^\w+:/.test(n))){if(ie.fetch&&ie.Request&&ie.AbortController&&ie.Request.prototype.hasOwnProperty("signal"))return function(i,a){const l=new ie.AbortController,u=new ie.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Te(),referrerPolicy:i.referrerPolicy,signal:l.signal});let d=!1,f=!1;const p=(g=u.url).indexOf("sku=")>0&&fn(g);var g;"json"===i.type&&u.headers.set("Accept","application/json");const _=(v,b,E)=>{if(f)return;if(v&&"SecurityError"!==v.message&&K(v.toString()),b&&E)return x(b);const C=Date.now();ie.fetch(u).then(T=>{if(T.ok){const D=p?T.clone():null;return x(T,D,C)}return a(new ye(T.statusText,T.status,i.url))}).catch(T=>{"AbortError"!==T.name&&a(new Error(`${T.message} ${i.url}`))})},x=(v,b,E)=>{("arrayBuffer"===i.type?v.arrayBuffer():"json"===i.type?v.json():v.text()).then(C=>{f||(b&&E&&function(T,D,A){if(Wo(),!Oo)return;const P={status:D.status,statusText:D.statusText,headers:new ie.Headers};D.headers.forEach((k,L)=>P.headers.set(L,k));const I=tt(D.headers.get("Cache-Control")||"");if(I["no-store"])return;I["max-age"]&&P.headers.set("Expires",new Date(A+1e3*I["max-age"]).toUTCString());const R=P.headers.get("Expires");R&&(new Date(R).getTime()-A<42e4||function(k,L){if(void 0===ua)try{new Response(new ReadableStream),ua=!0}catch{ua=!1}ua?L(k.body):k.blob().then(L)}(D,k=>{const L=new ie.Response(k,P);Wo(),Oo&&Oo.then(N=>N.put(Ll(T.url),L)).catch(N=>K(N.message))}))}(u,b,E),d=!0,a(null,C,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(C=>{f||a(new Error(C.message))})};return p?function(v,b){if(Wo(),!Oo)return b(null);const E=Ll(v.url);Oo.then(C=>{C.match(E).then(T=>{const D=function(A){if(!A)return!1;const P=new Date(A.headers.get("Expires")||0),I=tt(A.headers.get("Cache-Control")||"");return P>Date.now()&&!I["no-cache"]}(T);C.delete(E),D&&C.put(E,T.clone()),b(null,T,D)}).catch(b)}).catch(b)}(u,_):_(null,null),{cancel:()=>{f=!0,d||l.abort()}}}(t,e);if(we()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(i,a){const l=new ie.XMLHttpRequest;l.open(i.method||"GET",i.url,!0),"arrayBuffer"===i.type&&(l.responseType="arraybuffer");for(const u in i.headers)l.setRequestHeader(u,i.headers[u]);return"json"===i.type&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials="include"===i.credentials,l.onerror=()=>{a(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||0===l.status)&&null!==l.response){let u=l.response;if("json"===i.type)try{u=JSON.parse(l.response)}catch(d){return a(d)}a(null,u,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else a(new ye(l.statusText,l.status,i.url))},l.send(i.body),{cancel:()=>l.abort()}}(t,e)},Ae=function(t,e){return Pe(qe(t,{type:"json"}),e)},ke=function(t,e){return Pe(qe(t,{type:"arrayBuffer"}),e)};function Be(t){const e=ie.document.createElement("a");return e.href=t,e.protocol===ie.document.location.protocol&&e.host===ie.document.location.host}const Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ze,Le;Ze=[],Le=0;const Ct=function(t,e){if(ws.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Le>=kt.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ze.push(l),l}Le++;let n=!1;const i=()=>{if(!n)for(n=!0,Le--;Ze.length&&Le<kt.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Ze.shift(),{requestParameters:u,callback:d,cancelled:f}=l;f||(l.cancel=Ct(u,d).cancel)}},a=ke(t,(l,u,d,f)=>{i(),l?e(l):u&&(ie.createImageBitmap?function(p,g){const _=new ie.Blob([new Uint8Array(p)],{type:"image/png"});ie.createImageBitmap(_).then(x=>{g(null,x)}).catch(x=>{g(new Error(`Could not load image because of ${x.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(u,(p,g)=>e(p,g,d,f)):function(p,g){const _=new ie.Image,x=ie.URL;_.onload=()=>{g(null,_),x.revokeObjectURL(_.src),_.onload=null,ie.requestAnimationFrame(()=>{_.src=Re})},_.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new ie.Blob([new Uint8Array(p)],{type:"image/png"});_.src=p.byteLength?x.createObjectURL(v):Re}(u,(p,g)=>e(p,g,d,f)))});return{cancel:()=>{a.cancel(),i()}}},mn="NO_ACCESS_TOKEN";class rt{constructor(e,n,i){this._transformRequestFn=e,this._customAccessToken=n,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let n="";for(let i=0;i<10;i++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ef,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}normalizeStyleURL(e,n){if(!dn(e))return e;const i=ti(e);return i.params.push(`sdk=js-${la}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeGlyphsURL(e,n){if(!dn(e))return e;const i=ti(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeModelURL(e,n){if(!dn(e))return e;const i=ti(e);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeSourceURL(e,n,i,a){if(!dn(e))return e;const l=ti(e);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),i&&l.params.push(`language=${i}`),a&&l.params.push(`worldview=${a}`),this._makeAPIURL(l,this._customAccessToken||n)}normalizeSpriteURL(e,n,i,a){const l=ti(e);return dn(e)?(l.path=`/styles/v1${l.path}/sprite${n}${i}`,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=`${n}${i}`,ko(l))}normalizeTileURL(e,n,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!dn(e))return e;const a=ti(e);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||i&&"raster"!==a.authority&&512===i?"@2x":""}${ws.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${kt.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${kt.TILE_URL_VERSION}${a.path}`);const l=this._customAccessToken||function(u){for(const d of u){const f=d.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(a.params)||kt.ACCESS_TOKEN;return kt.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,l)}canonicalizeTileURL(e,n){const i=ti(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${kt.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${kt.TILE_URL_VERSION}/`,"")}`;let l=i.params;return n&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(a+=`?${l.join("&")}`),a}canonicalizeTileset(e,n){const i=!!n&&dn(n),a=[];for(const l of e.tiles||[])fn(l)?a.push(this.canonicalizeTileURL(l,i)):a.push(l);return a}_makeAPIURL(e,n){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=ti(kt.API_URL);if(e.protocol=a.protocol,e.authority=a.authority,"http"===e.protocol){const l=e.params.indexOf("secure");l>=0&&e.params.splice(l,1)}if("/"!==a.path&&(e.path=`${a.path}${e.path}`),!kt.REQUIRE_ACCESS_TOKEN)return ko(e);if(n=n||kt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===n[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter(l=>-1===l.indexOf("access_token")),e.params.push(`access_token=${n||""}`),ko(e)}}function dn(t){return 0===t.indexOf("mapbox:")}function fn(t){return kt.API_URL_REGEX.test(t)}function Cr(t){return kt.API_CDN_URL_REGEX.test(t)}function Gr(t){return kt.API_STYLE_REGEX.test(t)&&!to(t)}function to(t){return kt.API_SPRITE_REGEX.test(t)}const Hs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ti(t){const e=t.match(Hs);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ko(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const no="mapbox.eventData";function Xo(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ie.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Dc{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Xo(kt.ACCESS_TOKEN);let i="";return i=n&&n.u?ie.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(a,l)=>String.fromCharCode(+("0x"+l)))):kt.ACCESS_TOKEN||"",e?`${no}.${e}:${i}`:`${no}:${i}`}fetchEventData(){const e=In("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const a=ie.localStorage.getItem(n);a&&(this.eventData=JSON.parse(a));const l=ie.localStorage.getItem(i);l&&(this.anonId=l)}catch{K("Unable to read from LocalStorage")}}saveEventData(){const e=In("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{ie.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&ie.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{K("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,i,a){if(!kt.EVENTS_URL)return;const l=ti(kt.EVENTS_URL);l.params.push(`access_token=${a||kt.ACCESS_TOKEN||""}`);const u={event:this.type,created:new Date(e).toISOString()},d=n?qe(u,n):u,f={url:ko(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([d])};var g;this.pendingRequest=(g=p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(a)},Pe(qe(f,{method:"POST"}),g))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const ni=new class extends Dc{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){kt.EVENTS_URL&&kt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>dn(n)||fn(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Xo(kt.ACCESS_TOKEN),n=e?e.u:kt.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;bh(this.anonId)||(this.anonId=Xm(),i=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const l=new Date(this.eventData.lastSuccess),u=new Date(a),d=(a-this.eventData.lastSuccess)/864e5;i=i||d>=1||d<-1||l.getDate()!==u.getDate()}else i=!0;i?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:la,skuId:Ef,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)},t):this.processRequests()}},Sc=ni.postTurnstileEvent.bind(ni),ha=new class extends Dc{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,i){this.skuToken=e,this.errorCb=i,kt.EVENTS_URL&&(n||kt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(mn)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),bh(this.anonId)||(this.anonId=Xm()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:la,skuId:Ef,skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t))}},ZP=ha.postMapLoadEvent.bind(ha),sw=new class extends Dc{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){kt.EVENTS_URL&&(t||kt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),i=function(a){const l=ie.performance.getEntriesByType("resource"),u=ie.performance.getEntriesByType("mark"),d=function(x){const v={};if(x)for(const b in x)if("other"!==b)for(const E of x[b]){const C=`${b}ResolveRangeMin`,T=`${b}ResolveRangeMax`,D=`${b}RequestCount`,A=`${b}RequestCachedCount`;v[C]=Math.min(v[C]||1/0,E.startTime),v[T]=Math.max(v[T]||-1/0,E.responseEnd);const P=I=>{void 0===v[I]&&(v[I]=0),++v[I]};void 0!==E.transferSize&&0===E.transferSize&&P(A),P(D)}return v}(function(x,v){const b={};if(x)for(const E of x){const C=v(E);void 0===b[C]&&(b[C]=[]),b[C].push(E)}return b}(l,sD)),f=ie.devicePixelRatio,p=ie.navigator.connection||ie.navigator.mozConnection||ie.navigator.webkitConnection,g={counters:[],metadata:[],attributes:[]},_=(x,v,b)=>{null!=b&&x.push({name:v,value:b.toString()})};for(const x in d)_(g.counters,x,d[x]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(_(g.counters,"interactionRangeMin",a.interactionRange[0]),_(g.counters,"interactionRangeMax",a.interactionRange[1])),u)for(const x of Object.keys(Mf)){const v=Mf[x],b=u.find(E=>E.name===v);b&&_(g.counters,v,b.startTime)}return _(g.counters,"visibilityHidden",a.visibilityHidden),_(g.attributes,"style",function(x){if(x)for(const v of x){const b=v.name.split("?")[0];if(Gr(b)){const E=b.split("/").slice(-2);if(2===E.length)return`mapbox://styles/${E[0]}/${E[1]}`}}}(l)),_(g.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),_(g.attributes,"fogEnabled",a.fogEnabled?"true":"false"),_(g.attributes,"projection",a.projection),_(g.attributes,"zoom",a.zoom),_(g.metadata,"devicePixelRatio",f),_(g.metadata,"connectionEffectiveType",p?p.effectiveType:void 0),_(g.metadata,"navigatorUserAgent",ie.navigator.userAgent),_(g.metadata,"screenWidth",ie.screen.width),_(g.metadata,"screenHeight",ie.screen.height),_(g.metadata,"windowWidth",ie.innerWidth),_(g.metadata,"windowHeight",ie.innerHeight),_(g.metadata,"mapWidth",a.width/f),_(g.metadata,"mapHeight",a.height/f),_(g.metadata,"webglRenderer",a.renderer),_(g.metadata,"webglVendor",a.vendor),_(g.metadata,"sdkVersion",la),_(g.metadata,"sdkIdentifier","mapbox-gl-js"),g}(n);for(const a of i.metadata);for(const a of i.counters);for(const a of i.attributes);this.postEvent(e,i,()=>{},t)}},oD=sw.postPerformanceEvent.bind(sw),Ym=new class extends Dc{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,i){if(!kt.API_URL||!kt.SESSION_PATH)return;const a=ti(kt.API_URL+kt.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${i||kt.ACCESS_TOKEN||""}`);const l={url:ko(a),headers:{"Content-Type":"text/plain"}};var d;this.pendingRequest=(d=u=>{this.pendingRequest=null,n(u),this.saveEventData(),this.processRequests(i)},Pe(qe(l,{method:"GET"}),d))}getSessionAPI(t,e,n,i){this.skuToken=e,this.errorCb=i,kt.SESSION_PATH&&kt.API_URL&&(n||kt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(mn)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t)}},aw=Ym.getSessionAPI.bind(Ym),Ic=new Set;function lw(t,e){e?Ic.add(t):Ic.delete(t)}const Mf={create:"create",load:"load",fullLoad:"fullLoad"},Cy={mark(t){ie.performance.mark(t)},measure(t,e,n){ie.performance.measure(t,e,n)}};function sD(t){const e=t.name.split("?")[0];return Cr(e)&&e.includes("mapbox-gl.js")?"javascript":Cr(e)&&e.includes("mapbox-gl.css")?"css":kt.API_FONTS_REGEX.test(e)?"fontRange":to(e)?"sprite":Gr(e)?"style":kt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const aD=ie.performance;function cw(t){const e=t?t.url.toString():void 0;return aD.getEntriesByName(e)}var uw=Jm;function Jm(t){return e=t,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var i,a,l=new Blob([""],{type:"text/javascript"}),u=URL.createObjectURL(l);try{a=new Worker(u),i=!0}catch{i=!1}return a&&a.terminate(),URL.revokeObjectURL(u),i}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var i=document.createElement("canvas");i.width=i.height=1;var a=i.getContext("2d");if(!a)return!1;var l=a.getImageData(0,0,1,1);return l&&l.width===i.width}()||(void 0===Dy[n=e&&e.failIfMajorPerformanceCaveat]&&(Dy[n]=function(i){var a,u,d,f,l=(u=i,d=document.createElement("canvas"),(f=Object.create(Jm.webGLContextAttributes)).failIfMajorPerformanceCaveat=u,d.getContext("webgl",f)||d.getContext("experimental-webgl",f));if(!l)return!1;try{a=l.createShader(l.VERTEX_SHADER)}catch{return!1}return!(!a||l.isContextLost())&&(l.shaderSource(a,"void main() {}"),l.compileShader(a),!0===l.getShaderParameter(a,l.COMPILE_STATUS))}(n)),!Dy[n]||document.documentMode));var e,n}var Dy={};let Km,hi,Qm,Ui;Jm.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Fe={now:()=>void 0!==Qm?Qm:ie.performance.now(),setNow(t){Qm=t},restoreNow(){Qm=void 0},frame(t){const e=ie.requestAnimationFrame(t);return{cancel:()=>ie.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:i}=t;Ui||(Ui=ie.document.createElement("canvas"));const a=Ui.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(n>Ui.width||i>Ui.height)&&(Ui.width=n,Ui.height=i),a.clearRect(-e,-e,n+2*e,i+2*e),a.drawImage(t,0,0,n,i),a.getImageData(-e,-e,n+2*e,i+2*e)},resolveURL:t=>(Km||(Km=ie.document.createElement("a")),Km.href=t,Km.href),get devicePixelRatio(){return ie.devicePixelRatio},get prefersReducedMotion(){return!!ie.matchMedia&&(null==hi&&(hi=ie.matchMedia("(prefers-reduced-motion: reduce)")),hi.matches)}};function Cn(t,e,n){const i=ie.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i}function da(t,e,n){const i=ie.document.createElementNS("http://www.w3.org/2000/svg",t);for(const a of Object.keys(e))i.setAttributeNS(null,a,e[a]);return n&&n.appendChild(i),i}const ro=ie.document&&ie.document.documentElement.style,Tf=ro&&void 0!==ro.userSelect?"userSelect":"WebkitUserSelect";let hw;function er(){ro&&Tf&&(hw=ro[Tf],ro[Tf]="none")}function Cf(){ro&&Tf&&(ro[Tf]=hw)}function di(t){t.preventDefault(),t.stopPropagation(),ie.removeEventListener("click",di,!0)}function Df(){ie.addEventListener("click",di,!0),ie.setTimeout(()=>{ie.removeEventListener("click",di,!0)},0)}function Sf(t,e){const n=t.getBoundingClientRect();return eg(t,n,e)}function ar(t,e){const n=t.getBoundingClientRect(),i=[];for(let a=0;a<e.length;a++)i.push(eg(t,n,e[a]));return i}function qt(t){return void 0!==ie.InstallTrigger&&2===t.button&&t.ctrlKey&&ie.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function eg(t,e,n){const i=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new ee((n.clientX-e.left)*i,(n.clientY-e.top)*i)}function tg(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function dw(t,e,n){if(n&&n[t]){const i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}class Me{constructor(e,n={}){qe(this,n),this.type=e}}class pe extends Me{constructor(e,n={}){super("error",qe({error:e},n))}}class wr{on(e,n){return this._listeners=this._listeners||{},tg(e,n,this._listeners),this}off(e,n){return dw(e,n,this._listeners),dw(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},tg(e,n,this._oneTimeListeners),this):new Promise(i=>this.once(e,i))}fire(e,n){"string"==typeof e&&(e=new Me(e,n||{}));const i=e.type;if(this.listens(i)){e.target=this;const a=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const d of a)d.call(this,e);const l=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const d of l)dw(i,d,this._oneTimeListeners),d.call(this,e);const u=this._eventedParent;u&&(qe(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(e))}else e instanceof pe&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var J=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class De{constructor(e,n,i,a){this.message=(e?`${e}: `:"")+i,a&&(this.identifier=a),null!=n&&n.__line__&&(this.line=n.__line__)}}class bu extends De{}function Ac(t,...e){for(const n of e)for(const i in n)t[i]=n[i];return t}function qr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function fa(t){if(Array.isArray(t))return t.map(fa);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=fa(t[n]);return e}return qr(t)}class Es extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Fl=Es;class Sy{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[i,a]of n)this.bindings[i]=a}concat(e){return new Sy(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var WP=Sy;const Gs={kind:"null"},He={kind:"number"},nn={kind:"string"},un={kind:"boolean"},pa={kind:"color"},Th={kind:"object"},on={kind:"value"},ng={kind:"collator"},rg={kind:"formatted"},yo={kind:"resolvedImage"};function bt(t,e){return{kind:"array",itemType:t,N:e}}function Zr(t){if("array"===t.kind){const e=Zr(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const XP=[Gs,He,nn,un,pa,rg,Th,bt(on),yo];function ig(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ig(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of XP)if(!ig(n,e))return null}return`Expected ${Zr(t)} but found ${Zr(e)} instead.`}function It(t,e){return e.some(n=>n.kind===t.kind)}function og(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var Yo,If={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function sg(t){return(t=Math.round(t))<0?0:t>255?255:t}function ag(t){return sg("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function lg(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ch(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Yo={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in If)return If[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),a=n.indexOf(")");if(-1!==i&&a+1===n.length){var l=n.substr(0,i),u=n.substr(i+1,a-(i+1)).split(","),d=1;switch(l){case"rgba":if(4!==u.length)return null;d=lg(u.pop());case"rgb":return 3!==u.length?null:[ag(u[0]),ag(u[1]),ag(u[2]),d];case"hsla":if(4!==u.length)return null;d=lg(u.pop());case"hsl":if(3!==u.length)return null;var f=(parseFloat(u[0])%360+360)%360/360,p=lg(u[1]),g=lg(u[2]),_=g<=.5?g*(p+1):g+p-g*p,x=2*g-_;return[sg(255*Ch(x,_,f+1/3)),sg(255*Ch(x,_,f)),sg(255*Ch(x,_,f-1/3)),d];default:return null}}return null}}catch{}class io{constructor(e,n,i,a=1){this.r=e,this.g=n,this.b=i,this.a=a}static parse(e){if(!e)return;if(e instanceof io)return e;if("string"!=typeof e)return;const n=Yo(e);return n?new io(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,i,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(i)},${a})`}toArray(){const{r:e,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[255*e/a,255*n/a,255*i/a,a]}toArray01(){const{r:e,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[e/a,n/a,i/a,a]}toArray01Scaled(e){const{r:n,g:i,b:a,a:l}=this;return 0===l?[0,0,0]:[n/l*e,i/l*e,a/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:i,a}=this;return[e,n,i,a]}toArray01Linear(){const{r:e,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(n/a,2.2),Math.pow(i/a,2.2),a]}}io.black=new io(0,0,0,1),io.white=new io(1,1,1,1),io.transparent=new io(0,0,0,0),io.red=new io(1,0,0,1),io.blue=new io(0,0,1,1);var At=io;class cg{constructor(e,n,i){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Iy{constructor(e,n,i,a,l){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=i,this.fontStack=a,this.textColor=l}}class Ht{constructor(e){this.sections=e}static fromString(e){return new Ht([new Iy(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length)}static factory(e){return e instanceof Ht?e:Ht.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(i)}return e}}class Jo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new Jo({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ay(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ti(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof At||t instanceof cg||t instanceof Ht||t instanceof Jo)return!0;if(Array.isArray(t)){for(const e of t)if(!Ti(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Ti(t[e]))return!1;return!0}return!1}function ri(t){if(null===t)return Gs;if("string"==typeof t)return nn;if("boolean"==typeof t)return un;if("number"==typeof t)return He;if(t instanceof At)return pa;if(t instanceof cg)return ng;if(t instanceof Ht)return rg;if(t instanceof Jo)return yo;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const a=ri(i);if(n){if(n===a)continue;n=on;break}n=a}return bt(n||on,e)}return Th}function ug(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof At||t instanceof Ht||t instanceof Jo?t.toString():JSON.stringify(t)}class xr{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ti(e[1]))return n.error("invalid value");const i=e[1];let a=ri(i);const l=n.expectedType;return"array"!==a.kind||0!==a.N||!l||"array"!==l.kind||"number"==typeof l.N&&0!==l.N||(a=l),new xr(a,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof At?["rgba"].concat(this.value.toArray()):this.value instanceof Ht?this.value.serialize():this.value}}var hg=xr,Ci=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const at={string:nn,number:He,boolean:un,object:Th};class Af{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i,a=1;const l=e[0];if("array"===l){let d,f;if(e.length>2){const p=e[1];if("string"!=typeof p||!(p in at)||"object"===p)return n.error('The item type argument of "array" must be one of string, number, boolean',1);d=at[p],a++}else d=on;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);f=e[2],a++}i=bt(d,f)}else i=at[l];const u=[];for(;a<e.length;a++){const d=n.parse(e[a],a,on);if(!d)return null;u.push(d)}return new Af(i,u)}evaluate(e){for(let n=0;n<this.args.length;n++){const i=this.args[n].evaluate(e);if(!ig(this.type,ri(i)))return i;if(n===this.args.length-1)throw new Ci(`Expected value to be of type ${Zr(this.type)}, but found ${Zr(ri(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){n.push(i.kind);const a=e.N;("number"==typeof a||this.args.length>1)&&n.push(a)}}return n.concat(this.args.map(i=>i.serialize()))}}var ma=Af;class Dh{constructor(e){this.type=rg,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return n.error("First argument must be an image or text section.");const a=[];let l=!1;for(let u=1;u<=e.length-1;++u){const d=e[u];if(l&&"object"==typeof d&&!Array.isArray(d)){l=!1;let f=null;if(d["font-scale"]&&(f=n.parse(d["font-scale"],1,He),!f))return null;let p=null;if(d["text-font"]&&(p=n.parse(d["text-font"],1,bt(nn)),!p))return null;let g=null;if(d["text-color"]&&(g=n.parse(d["text-color"],1,pa),!g))return null;const _=a[a.length-1];_.scale=f,_.font=p,_.textColor=g}else{const f=n.parse(e[u],1,on);if(!f)return null;const p=f.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:f,scale:null,font:null,textColor:null})}}return new Dh(a)}evaluate(e){return new Ht(this.sections.map(n=>{const i=n.content.evaluate(e);return ri(i)===yo?new Iy("",i,null,null,null):new Iy(ug(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),e.push(i)}return e}}class wu{constructor(e,n){this.type=yo,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");const i=n.parse(e[1],1,nn);if(!i)return n.error("No image name provided.");if(2===e.length)return new wu(i);const a=n.parse(e[2],1,nn);return a?new wu(i,a):n.error("Secondary image variant is not a string.")}evaluate(e){const n=Jo.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function gn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Py={"to-boolean":un,"to-color":pa,"to-number":He,"to-string":nn};class fw{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[0],a=[];let l=Gs;if("to-array"===i){if(!Array.isArray(e[1]))return null;const u=e[1].length;if(n.expectedType){if("array"!==n.expectedType.kind)return n.error(`Expected ${n.expectedType.kind} but found array.`);l=bt(n.expectedType.itemType,u)}else{if(!(u>0&&Ti(e[1][0])))return null;l=bt(ri(e[1][0]),u)}for(let d=0;d<u;d++){const f=e[1][d];let p;if("array"===gn(f))p=n.parse(f,void 0,l.itemType);else{const g=gn(f);if(g!==l.itemType.kind)return n.error(`Expected ${l.itemType.kind} but found ${g}.`);p=n.registry.literal.parse(["literal",void 0===f?null:f],n)}if(!p)return null;a.push(p)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return n.error("Expected one argument.");l=Py[i];for(let u=1;u<e.length;u++){const d=n.parse(e[u],u,on);if(!d)return null;a.push(d)}}return new fw(l,a)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let n,i;for(const a of this.args){if(n=a.evaluate(e),i=null,n instanceof At)return n;if("string"==typeof n){const l=e.parseColor(n);if(l)return l}else if(Array.isArray(n)&&(i=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ay(n[0],n[1],n[2],n[3]),!i))return new At(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ci(i||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const i of this.args){if(n=i.evaluate(e),null===n)return 0;const a=Number(n);if(!isNaN(a))return a}throw new Ci(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Ht.fromString(ug(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Jo.fromString(ug(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(n=>n.evaluate(e)):ug(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Dh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new wu(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Sh=fw;const YP=["Unknown","Point","LineString","Polygon"];var lD=class{constructor(t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?YP[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=At.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Pf{constructor(e,n,i,a){this.name=e,this.type=n,this._evaluate=i,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const i=e[0],a=Pf.definitions[i];if(!a)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(a)?a[0]:a.type,u=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,d=u.filter(([p])=>!Array.isArray(p)||p.length===e.length-1);let f=null;for(const[p,g]of d){f=new vo(n.registry,n.path,null,n.scope,void 0,n.options);const _=[];let x=!1;for(let v=1;v<e.length;v++){const b=e[v],E=Array.isArray(p)?p[v-1]:p.type,C=f.parse(b,1+_.length,E);if(!C){x=!0;break}_.push(C)}if(!x)if(Array.isArray(p)&&p.length!==_.length)f.error(`Expected ${p.length} arguments, but found ${_.length} instead.`);else{for(let v=0;v<_.length;v++){const b=Array.isArray(p)?p[v]:p.type,E=_[v];f.concat(v+1).checkSubtype(b,E.type)}if(0===f.errors.length)return new Pf(i,l,g,_)}}if(1===d.length)n.errors.push(...f.errors);else{const p=(d.length?d:u).map(([_])=>{return x=_,Array.isArray(x)?`(${x.map(Zr).join(", ")})`:`(${Zr(x.type)}...)`;var x}).join(" | "),g=[];for(let _=1;_<e.length;_++){const x=n.parse(e[_],1+g.length);if(!x)return null;g.push(Zr(x.type))}n.error(`Expected arguments of type ${p}, but found (${g.join(", ")}) instead.`)}return null}static register(e,n){Pf.definitions=n;for(const i in n)e[i]=Pf}}var Ko=Pf;class Ih{constructor(e,n,i){this.type=ng,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return n.error("Collator options argument must be an object.");const a=n.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,un);if(!a)return null;const l=n.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,un);if(!l)return null;let u=null;return i.locale&&(u=n.parse(i.locale,1,nn),!u)?null:new Ih(a,l,u)}evaluate(e){return new cg(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Rf={exports:{}};Rf.exports=function(){function t(i,a,l,u,d){for(;u>l;){if(u-l>600){var f=u-l+1,p=a-l+1,g=Math.log(f),_=.5*Math.exp(2*g/3),x=.5*Math.sqrt(g*_*(f-_)/f)*(p-f/2<0?-1:1);t(i,a,Math.max(l,Math.floor(a-p*_/f+x)),Math.min(u,Math.floor(a+(f-p)*_/f+x)),d)}var v=i[a],b=l,E=u;for(e(i,l,a),d(i[u],v)>0&&e(i,l,u);b<E;){for(e(i,b,E),b++,E--;d(i[b],v)<0;)b++;for(;d(i[E],v)>0;)E--}0===d(i[l],v)?e(i,l,E):e(i,++E,u),E<=a&&(l=E+1),a<=E&&(u=E-1)}}function e(i,a,l){var u=i[a];i[a]=i[l],i[l]=u}function n(i,a){return i<a?-1:i>a?1:0}return function(i,a,l,u,d){t(i,a,l||0,u||i.length-1,d||n)}}();var cD=Zo(Rf.exports);function uD(t){let e=0;for(let n,i,a=0,l=t.length,u=l-1;a<l;u=a++)n=t[a],i=t[u],e+=(i.x-n.x)*(n.y+i.y);return e}function Of(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ah(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ph(t,e,n){const i=t[0]-e[0],a=t[1]-e[1],l=t[0]-n[0],u=t[1]-n[1];return i*u-l*a==0&&i*l<=0&&a*u<=0}function Rh(t,e,n=!1){let i=!1;for(let d=0,f=e.length;d<f;d++){const p=e[d];for(let g=0,_=p.length,x=_-1;g<_;x=g++){const v=p[x],b=p[g];if(Ph(t,v,b))return n;(l=v)[1]>(a=t)[1]!=(u=b)[1]>a[1]&&a[0]<(u[0]-l[0])*(a[1]-l[1])/(u[1]-l[1])+l[0]&&(i=!i)}}var a,l,u;return i}function Nl(t,e,n,i){const a=i[0]-n[0],l=i[1]-n[1],u=(t[0]-n[0])*l-a*(t[1]-n[1]),d=(e[0]-n[0])*l-a*(e[1]-n[1]);return u>0&&d<0||u<0&&d>0}function dg(t,e,n,i){return(a=[i[0]-n[0],i[1]-n[1]])[0]*(l=[e[0]-t[0],e[1]-t[1]])[1]-a[1]*l[0]!=0&&!(!Nl(t,e,n,i)||!Nl(n,i,t,e));var a,l}const yt=8192;function pw(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(n*a*yt),Math.round(i*a*yt)]}function lt(t,e){for(let n=0;n<e.length;n++)if(Rh(t,e[n]))return!0;return!1}function fg(t,e,n){for(const i of n)for(let a=0,l=i.length,u=l-1;a<l;u=a++)if(dg(t,e,i[u],i[a]))return!0;return!1}function pg(t,e){for(let n=0;n<t.length;++n)if(!Rh(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(fg(t[n],t[n+1],e))return!1;return!0}function kf(t,e){for(let n=0;n<e.length;n++)if(pg(t,e[n]))return!0;return!1}function Ry(t,e,n){const i=[];for(let a=0;a<t.length;a++){const l=[];for(let u=0;u<t[a].length;u++){const d=pw(t[a][u],n);Of(e,d),l.push(d)}i.push(l)}return i}function mw(t,e,n){const i=[];for(let a=0;a<t.length;a++){const l=Ry(t[a],e,n);i.push(l)}return i}function gw(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const a=.5*i;let l=t[0]-n[0]>a?-i:n[0]-t[0]>a?i:0;0===l&&(l=t[0]-n[2]>a?-i:n[2]-t[0]>a?i:0),t[0]+=l}Of(e,t)}function Ka(t,e,n,i){const a=Math.pow(2,i.z)*yt,l=[i.x*yt,i.y*yt],u=[];if(!t)return u;for(const d of t)for(const f of d){const p=[f.x+l[0],f.y+l[1]];gw(p,e,n,a),u.push(p)}return u}function Lf(t,e,n,i){const a=Math.pow(2,i.z)*yt,l=[i.x*yt,i.y*yt],u=[];if(!t)return u;for(const f of t){const p=[];for(const g of f){const _=[g.x+l[0],g.y+l[1]];Of(e,_),p.push(_)}u.push(p)}if(e[2]-e[0]<=a/2){(d=e)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(const f of u)for(const p of f)gw(p,e,n,a)}var d;return u}class Lo{constructor(e,n){this.type=un,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ti(e[1])){const i=e[1];if("FeatureCollection"===i.type)for(let a=0;a<i.features.length;++a){const l=i.features[a].geometry.type;if("Polygon"===l||"MultiPolygon"===l)return new Lo(i,i.features[a].geometry)}else if("Feature"===i.type){const a=i.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new Lo(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new Lo(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,i){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],u=n.canonicalID();if(!u)return!1;if("Polygon"===i.type){const d=Ry(i.coordinates,l,u),f=Ka(n.geometry(),a,l,u);if(!Ah(a,l))return!1;for(const p of f)if(!Rh(p,d))return!1}if("MultiPolygon"===i.type){const d=mw(i.coordinates,l,u),f=Ka(n.geometry(),a,l,u);if(!Ah(a,l))return!1;for(const p of f)if(!lt(p,d))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,i){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],u=n.canonicalID();if(!u)return!1;if("Polygon"===i.type){const d=Ry(i.coordinates,l,u),f=Lf(n.geometry(),a,l,u);if(!Ah(a,l))return!1;for(const p of f)if(!pg(p,d))return!1}if("MultiPolygon"===i.type){const d=mw(i.coordinates,l,u),f=Lf(n.geometry(),a,l,u);if(!Ah(a,l))return!1;for(const p of f)if(!kf(p,d))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var qs=Lo,zn={exports:{}};zn.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),i=Math.PI/180,a=function(p,g){if(void 0===p)throw new Error("No latitude given.");if(g&&!t[g])throw new Error("Unknown unit "+g+". Use one of: "+Object.keys(t).join(", "));var _=6378.137*i*(g?t[g]:1),x=Math.cos(p*i),v=1/(1-n*(1-x*x)),b=Math.sqrt(v);this.kx=_*b*x,this.ky=_*b*v*(1-n)},l={units:{configurable:!0}};function u(p,g){return p[0]===g[0]&&p[1]===g[1]}function d(p,g,_){var x=f(g[0]-p[0]);return[p[0]+x*_,p[1]+(g[1]-p[1])*_]}function f(p){for(;p<-180;)p+=360;for(;p>180;)p-=360;return p}return a.fromTile=function(p,g,_){var x=Math.PI*(1-2*(p+.5)/Math.pow(2,g)),v=Math.atan(.5*(Math.exp(x)-Math.exp(-x)))/i;return new a(v,_)},l.units.get=function(){return t},a.prototype.distance=function(p,g){var _=f(p[0]-g[0])*this.kx,x=(p[1]-g[1])*this.ky;return Math.sqrt(_*_+x*x)},a.prototype.bearing=function(p,g){var _=f(g[0]-p[0])*this.kx;return Math.atan2(_,(g[1]-p[1])*this.ky)/i},a.prototype.destination=function(p,g,_){var x=_*i;return this.offset(p,Math.sin(x)*g,Math.cos(x)*g)},a.prototype.offset=function(p,g,_){return[p[0]+g/this.kx,p[1]+_/this.ky]},a.prototype.lineDistance=function(p){for(var g=0,_=0;_<p.length-1;_++)g+=this.distance(p[_],p[_+1]);return g},a.prototype.area=function(p){for(var g=0,_=0;_<p.length;_++)for(var x=p[_],v=0,b=x.length,E=b-1;v<b;E=v++)g+=f(x[v][0]-x[E][0])*(x[v][1]+x[E][1])*(_?-1:1);return Math.abs(g)/2*this.kx*this.ky},a.prototype.along=function(p,g){var _=0;if(g<=0)return p[0];for(var x=0;x<p.length-1;x++){var v=p[x],b=p[x+1],E=this.distance(v,b);if((_+=E)>g)return d(v,b,(g-(_-E))/E)}return p[p.length-1]},a.prototype.pointToSegmentDistance=function(p,g,_){var x=g[0],v=g[1],b=f(_[0]-x)*this.kx,E=(_[1]-v)*this.ky,C=0;return 0===b&&0===E||((C=(f(p[0]-x)*this.kx*b+(p[1]-v)*this.ky*E)/(b*b+E*E))>1?(x=_[0],v=_[1]):C>0&&(x+=b/this.kx*C,v+=E/this.ky*C)),b=f(p[0]-x)*this.kx,E=(p[1]-v)*this.ky,Math.sqrt(b*b+E*E)},a.prototype.pointOnLine=function(p,g){for(var _,x,v,b,E=1/0,C=0;C<p.length-1;C++){var T=p[C][0],D=p[C][1],A=f(p[C+1][0]-T)*this.kx,P=(p[C+1][1]-D)*this.ky,I=0;0===A&&0===P||((I=(f(g[0]-T)*this.kx*A+(g[1]-D)*this.ky*P)/(A*A+P*P))>1?(T=p[C+1][0],D=p[C+1][1]):I>0&&(T+=A/this.kx*I,D+=P/this.ky*I));var R=(A=f(g[0]-T)*this.kx)*A+(P=(g[1]-D)*this.ky)*P;R<E&&(E=R,_=T,x=D,v=C,b=I)}return{point:[_,x],index:v,t:Math.max(0,Math.min(1,b))}},a.prototype.lineSlice=function(p,g,_){var x=this.pointOnLine(_,p),v=this.pointOnLine(_,g);if(x.index>v.index||x.index===v.index&&x.t>v.t){var b=x;x=v,v=b}var E=[x.point],C=x.index+1,T=v.index;!u(_[C],E[0])&&C<=T&&E.push(_[C]);for(var D=C+1;D<=T;D++)E.push(_[D]);return u(_[T],v.point)||E.push(v.point),E},a.prototype.lineSliceAlong=function(p,g,_){for(var x=0,v=[],b=0;b<_.length-1;b++){var E=_[b],C=_[b+1],T=this.distance(E,C);if((x+=T)>p&&0===v.length&&v.push(d(E,C,(p-(x-T))/T)),x>=g)return v.push(d(E,C,(g-(x-T))/T)),v;x>p&&v.push(C)}return v},a.prototype.bufferPoint=function(p,g){var _=g/this.ky,x=g/this.kx;return[p[0]-x,p[1]-_,p[0]+x,p[1]+_]},a.prototype.bufferBBox=function(p,g){var _=g/this.ky,x=g/this.kx;return[p[0]-x,p[1]-_,p[2]+x,p[3]+_]},a.prototype.insideBBox=function(p,g){return f(p[0]-g[0])>=0&&f(p[0]-g[2])<=0&&p[1]>=g[1]&&p[1]<=g[3]},Object.defineProperties(a,l),a}();var Oh=Zo(zn.exports),mg={exports:{}};mg.exports=function(){var t=function(n,i){if(void 0===n&&(n=[]),void 0===i&&(i=e),this.data=n,this.length=this.data.length,this.compare=i,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function e(n,i){return n<i?-1:n>i?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(0!==this.length){var n=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var i=this.data,a=this.compare,l=i[n];n>0;){var u=n-1>>1,d=i[u];if(a(l,d)>=0)break;i[n]=d,n=u}i[n]=l},t.prototype._down=function(n){for(var i=this.data,a=this.compare,l=this.length>>1,u=i[n];n<l;){var d=1+(n<<1),f=i[d],p=d+1;if(p<this.length&&a(i[p],f)<0&&(d=p,f=i[p]),a(f,u)>=0)break;i[n]=f,n=d}i[n]=u},t}();var Ff=Zo(mg.exports),le=8192;function Qa(t,e){return e.dist-t.dist}const Eu=100,gg=50;function Oy(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function kh(t){return t[1]-t[0]+1}function el(t,e){const n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function _g(t,e){if(t[0]>t[1])return[null,null];const n=kh(t);if(e){if(2===n)return[t,null];const i=Math.floor(n/2);return[[t[0],t[0]+i],[t[0]+i,t[1]]]}{if(1===n)return[t,null];const i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}}function ga(t,e){const n=[1/0,1/0,-1/0,-1/0];if(!el(e,t.length))return n;for(let i=e[0];i<=e[1];++i)Of(n,t[i]);return n}function Nf(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)Of(e,t[n][i]);return e}function Mu(t,e,n){if(Oy(t)||Oy(e))return NaN;let i=0,a=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(a=t[1]-e[3]),t[3]<e[1]&&(a=e[1]-t[3]),n.distance([0,0],[i,a])}function ky(t,e){const n=Math.pow(2,e.z);return[(a=(t.x/le+e.x)/n,360*a-180),(i=(t.y/le+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,a}function _w(t,e){const n=[];for(let i=0;i<t.length;++i)n.push(ky(t[i],e));return n}function yw(t,e,n){const i=n.pointOnLine(e,t).point;return n.distance(t,i)}function xw(t,e,n,i,a){const l=n.slice(i[0],i[1]+1);let u=1/0;for(let d=e[0];d<=e[1];++d)if(0===(u=Math.min(u,yw(t[d],l,a))))return 0;return u}function Ms(t,e,n,i,a){const l=Math.min(a.pointToSegmentDistance(t,n,i),a.pointToSegmentDistance(e,n,i)),u=Math.min(a.pointToSegmentDistance(n,t,e),a.pointToSegmentDistance(i,t,e));return Math.min(l,u)}function hD(t,e,n,i,a){if(!el(e,t.length)||!el(i,n.length))return NaN;let l=1/0;for(let u=e[0];u<e[1];++u)for(let d=i[0];d<i[1];++d){if(dg(t[u],t[u+1],n[d],n[d+1]))return 0;l=Math.min(l,Ms(t[u],t[u+1],n[d],n[d+1],a))}return l}function vw(t,e,n,i,a){if(!el(e,t.length)||!el(i,n.length))return NaN;let l=1/0;for(let u=e[0];u<=e[1];++u)for(let d=i[0];d<=i[1];++d)if(0===(l=Math.min(l,a.distance(t[u],n[d]))))return l;return l}function dD(t,e,n){if(Rh(t,e,!0))return 0;let i=1/0;for(const a of e){const l=a.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[l-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(t,a[l-1],a[0])))||0===(i=Math.min(i,yw(t,a,n))))return i}return i}function fD(t,e,n,i){if(!el(e,t.length))return NaN;for(let l=e[0];l<=e[1];++l)if(Rh(t[l],n,!0))return 0;let a=1/0;for(let l=e[0];l<e[1];++l)for(const u of n)for(let d=0,f=u.length,p=f-1;d<f;p=d++){if(dg(t[l],t[l+1],u[p],u[d]))return 0;a=Math.min(a,Ms(t[l],t[l+1],u[p],u[d],i))}return a}function bw(t,e){for(const n of t)for(let i=0;i<=n.length-1;++i)if(Rh(n[i],e,!0))return!0;return!1}function pD(t,e,n,i=1/0){const a=Nf(t),l=Nf(e);if(i!==1/0&&Mu(a,l,n)>=i)return i;if(Ah(a,l)){if(bw(t,e))return 0}else if(bw(e,t))return 0;let u=i;for(const d of t)for(let f=0,p=d.length,g=p-1;f<p;g=f++)for(const _ of e)for(let x=0,v=_.length,b=v-1;x<v;b=x++){if(dg(d[g],d[f],_[b],_[x]))return 0;u=Math.min(u,Ms(d[g],d[f],_[b],_[x],n))}return u}function zf(t,e,n,i,a,l,u){if(null===l||null===u)return;const d=Mu(ga(i,l),ga(a,u),n);d<e&&t.push({dist:d,range1:l,range2:u})}function mD(t,e,n,i,a=1/0){let l=Math.min(i.distance(t[0],n[0][0]),a);if(0===l)return l;const u=new Ff([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Qa),d=e?gg:Eu,f=Nf(n);for(;u.length;){const p=u.pop();if(p.dist>=l)continue;const g=p.range1;if(kh(g)<=d){if(!el(g,t.length))return NaN;if(e){const _=fD(t,g,n,i);if(0===(l=Math.min(l,_)))return l}else for(let _=g[0];_<=g[1];++_){const x=dD(t[_],n,i);if(0===(l=Math.min(l,x)))return l}}else{const _=_g(g,e);if(null!==_[0]){const x=Mu(ga(t,_[0]),f,i);x<l&&u.push({dist:x,range1:_[0],range2:[0,0]})}if(null!==_[1]){const x=Mu(ga(t,_[1]),f,i);x<l&&u.push({dist:x,range1:_[1],range2:[0,0]})}}}return l}function ww(t,e,n,i,a,l=1/0){let u=Math.min(l,a.distance(t[0],n[0]));if(0===u)return u;const d=new Ff([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Qa),f=e?gg:Eu,p=i?gg:Eu;for(;d.length;){const g=d.pop();if(g.dist>=u)continue;const _=g.range1,x=g.range2;if(kh(_)<=f&&kh(x)<=p){if(!el(_,t.length)||!el(x,n.length))return NaN;if(e&&i?u=Math.min(u,hD(t,_,n,x,a)):e||i?e&&!i?u=Math.min(u,xw(n,x,t,_,a)):!e&&i&&(u=Math.min(u,xw(t,_,n,x,a))):u=Math.min(u,vw(t,_,n,x,a)),0===u)return u}else{const v=_g(_,e),b=_g(x,i);zf(d,u,a,t,n,v[0],b[0]),zf(d,u,a,t,n,v[0],b[1]),zf(d,u,a,t,n,v[1],b[0]),zf(d,u,a,t,n,v[1],b[1])}}return u}function Ly(t,e,n,i,a=1/0){let l=a;const u=ga(t,[0,t.length-1]);for(const d of n)if(!(l!==1/0&&Mu(u,ga(d,[0,d.length-1]),i)>=l)&&(l=Math.min(l,ww(t,e,d,!0,i,l)),0===l))return l;return l}function Pc(t,e,n,i,a=1/0){let l=a;const u=ga(t,[0,t.length-1]);for(const d of n){if(l!==1/0&&Mu(u,Nf(d),i)>=l)continue;const f=mD(t,e,d,i,l);if(isNaN(f))return f;if(0===(l=Math.min(l,f)))return l}return l}function Fy(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class Bf{constructor(e,n){this.type=He,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ti(e[1])){const i=e[1];if("FeatureCollection"===i.type){for(let a=0;a<i.features.length;++a)if(Fy(i.features[a].geometry.type))return new Bf(i,i.features[a].geometry)}else if("Feature"===i.type){if(Fy(i.geometry.type))return new Bf(i,i.geometry)}else if(Fy(i.type))return new Bf(i,i)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),i=e.canonicalID();if(null!=n&&null!=i){if("Point"===e.geometryType())return function(a,l,u){const d=[];for(const p of a)for(const g of p)d.push(ky(g,l));const f=new Oh(d[0][1],"meters");return"Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type?ww(d,!1,"Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,f):"MultiLineString"===u.type?Ly(d,!1,u.coordinates,f):"Polygon"===u.type||"MultiPolygon"===u.type?Pc(d,!1,"Polygon"===u.type?[u.coordinates]:u.coordinates,f):null}(n,i,this.geometries);if("LineString"===e.geometryType())return function(a,l,u){const d=[];for(const p of a){const g=[];for(const _ of p)g.push(ky(_,l));d.push(g)}const f=new Oh(d[0][0][1],"meters");if("Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type)return Ly("Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,d,f);if("MultiLineString"===u.type){let p=1/0;for(let g=0;g<u.coordinates.length;g++){const _=Ly(u.coordinates[g],!0,d,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}if("Polygon"===u.type||"MultiPolygon"===u.type){let p=1/0;for(let g=0;g<d.length;g++){const _=Pc(d[g],!0,"Polygon"===u.type?[u.coordinates]:u.coordinates,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}return null}(n,i,this.geometries);if("Polygon"===e.geometryType())return function(a,l,u){const d=[];for(const p of function(g,_){const x=g.length;if(x<=1)return[g];const v=[];let b,E;for(let C=0;C<x;C++){const T=uD(g[C]);0!==T&&(g[C].area=Math.abs(T),void 0===E&&(E=T<0),E===T<0?(b&&v.push(b),b=[g[C]]):b.push(g[C]))}return b&&v.push(b),v}(a)){const g=[];for(let _=0;_<p.length;++_)g.push(_w(p[_],l));d.push(g)}const f=new Oh(d[0][0][0][1],"meters");if("Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type)return Pc("Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,d,f);if("MultiLineString"===u.type){let p=1/0;for(let g=0;g<u.coordinates.length;g++){const _=Pc(u.coordinates[g],!0,d,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}return"Polygon"===u.type||"MultiPolygon"===u.type?function(p,g,_){let x=1/0;for(const v of p)for(const b of g){const E=pD(v,b,_,x);if(isNaN(E))return E;if(0===(x=Math.min(x,E)))return x}return x}("Polygon"===u.type?[u.coordinates]:u.coordinates,d,f):null}(n,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Ny=Bf;function Fo(t){if(t instanceof Ko&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof qs||t instanceof Ny)return!1;let e=!0;return t.eachChild(n=>{e&&!Fo(n)&&(e=!1)}),e}function yg(t){if(t instanceof Ko&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!yg(n)&&(e=!1)}),e}function xg(t){if(t instanceof Ko&&"config"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!xg(n)&&(e=!1)}),e}function jt(t,e){if(t instanceof Ko&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(i=>{n&&!jt(i,e)&&(n=!1)}),n}class xo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const i=e[1];return n.scope.has(i)?new xo(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var An=xo;class Di{constructor(e,n=[],i,a=new WP,l=[],u){this.registry=e,this.path=n,this.key=n.map(d=>`[${d}]`).join(""),this.scope=a,this.errors=l,this.expectedType=i,this.options=u}parse(e,n,i,a,l={}){return n||i?this.concat(n,i,a)._parse(e,l):this._parse(e,l)}_parse(e,n){function i(a,l,u){return"assert"===u?new ma(l,[a]):"coerce"===u?new Sh(l,[a]):a}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a="string"==typeof e[0]?this.registry[e[0]]:void 0;if(a){let l=a.parse(e,this);if(!l)return null;if(this.expectedType){const u=this.expectedType,d=l.type;if("string"!==u.kind&&"number"!==u.kind&&"boolean"!==u.kind&&"object"!==u.kind&&"array"!==u.kind||"value"!==d.kind)if("color"!==u.kind&&"formatted"!==u.kind&&"resolvedImage"!==u.kind||"value"!==d.kind&&"string"!==d.kind){if(this.checkSubtype(u,d))return null}else l=i(l,u,n.typeAnnotation||"coerce");else l=i(l,u,n.typeAnnotation||"assert")}if(!(l instanceof hg)&&"resolvedImage"!==l.type.kind&&Rc(l)){const u=new lD(this.options);try{l=new hg(l.type,l.evaluate(u))}catch(d){return this.error(d.message),null}}return l}return Sh.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,i){const a="number"==typeof e?this.path.concat(e):this.path,l=i?this.scope.concat(i):this.scope;return new Di(this.registry,a,n||null,l,this.errors,this.options)}error(e,...n){const i=`${this.key}${n.map(a=>`[${a}]`).join("")}`;this.errors.push(new Fl(i,e))}checkSubtype(e,n){const i=ig(e,n);return i&&this.error(i),i}}var vo=Di;function Rc(t){if(t instanceof An)return Rc(t.boundExpression);if(t instanceof Ko&&"error"===t.name||t instanceof Ko&&"config"===t.name||t instanceof Ih||t instanceof qs||t instanceof Ny)return!1;const e=t instanceof Sh||t instanceof ma;let n=!0;return t.eachChild(i=>{n=e?n&&Rc(i):n&&i instanceof hg}),!!n&&Fo(t)&&jt(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function bo(t,e){const n=t.length-1;let i,a,l=0,u=n,d=0;for(;l<=u;)if(d=Math.floor((l+u)/2),i=t[d],a=t[d+1],i<=e){if(d===n||e<a)return d;l=d+1}else{if(!(i>e))throw new Ci("Input is not a number.");u=d-1}return 0}class vg{constructor(e,n,i){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[a,l]of i)this.labels.push(a),this.outputs.push(l)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const i=n.parse(e[1],1,He);if(!i)return null;const a=[];let l=null;n.expectedType&&"value"!==n.expectedType.kind&&(l=n.expectedType);for(let u=1;u<e.length;u+=2){const d=1===u?-1/0:e[u],f=e[u+1],p=u,g=u+1;if("number"!=typeof d)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(a.length&&a[a.length-1][0]>=d)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',p);const _=n.parse(f,g,l);if(!_)return null;l=l||_.type,a.push([d,_])}return new vg(l,i,a)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return i[0].evaluate(e);const l=n.length;return a>=n[l-1]?i[l-1].evaluate(e):i[bo(n,a)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var bg=vg;function ut(t,e,n){return t*(1-n)+e*n}function Ew(t,e,n){return t.map((i,a)=>ut(i,e[a],n))}var wg=Object.freeze({__proto__:null,array:Ew,color:function(t,e,n){return new At(ut(t.r,e.r,n),ut(t.g,e.g,n),ut(t.b,e.b,n),ut(t.a,e.a,n))},number:ut});const rn=4/29,lr=6/29,Zs=3*lr*lr,Vf=lr*lr*lr,wo=Math.PI/180,Lh=180/Math.PI;function Xr(t){return t>Vf?Math.pow(t,1/3):t/Zs+rn}function tl(t){return t>lr?t*t*t:Zs*(t-rn)}function Oc(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Wt(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Fh(t){const e=Wt(t.r),n=Wt(t.g),i=Wt(t.b),a=Xr((.4124564*e+.3575761*n+.1804375*i)/.95047),l=Xr((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*l-16,a:500*(a-l),b:200*(l-Xr((.0193339*e+.119192*n+.9503041*i)/1.08883)),alpha:t.a}}function zy(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*tl(e),n=.95047*tl(n),i=1.08883*tl(i),new At(Oc(3.2404542*n-1.5371385*e-.4985314*i),Oc(-.969266*n+1.8760108*e+.041556*i),Oc(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function Nh(t,e,n){const i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const Pr={forward:Fh,reverse:zy,interpolate:function(t,e,n){return{l:ut(t.l,e.l,n),a:ut(t.a,e.a,n),b:ut(t.b,e.b,n),alpha:ut(t.alpha,e.alpha,n)}}},zl={forward:function(t){const{l:e,a:n,b:i}=Fh(t),a=Math.atan2(i,n)*Lh;return{h:a<0?a+360:a,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*wo,n=t.c;return zy({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Nh(t.h,e.h,n),c:ut(t.c,e.c,n),l:ut(t.l,e.l,n),alpha:ut(t.alpha,e.alpha,n)}}};var Tu=Object.freeze({__proto__:null,hcl:zl,lab:Pr});class Ts{constructor(e,n,i,a,l){this.type=e,this.operator=n,this.interpolation=i,this.input=a,this.labels=[],this.outputs=[];for(const[u,d]of l)this.labels.push(u),this.outputs.push(d)}static interpolationFactor(e,n,i,a){let l=0;if("exponential"===e.name)l=Cu(n,e.base,i,a);else if("linear"===e.name)l=Cu(n,1,i,a);else if("cubic-bezier"===e.name){const u=e.controlPoints;l=new Wm(u[0],u[1],u[2],u[3]).solve(Cu(n,1,i,a))}return l}static parse(e,n){let[i,a,l,...u]=e;if(!Array.isArray(a)||0===a.length)return n.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){const p=a[1];if("number"!=typeof p)return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:p}}else{if("cubic-bezier"!==a[0])return n.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const p=a.slice(1);if(4!==p.length||p.some(g=>"number"!=typeof g||g<0||g>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:p}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(l=n.parse(l,2,He),!l)return null;const d=[];let f=null;"interpolate-hcl"===i||"interpolate-lab"===i?f=pa:n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(let p=0;p<u.length;p+=2){const g=u[p],_=u[p+1],x=p+3,v=p+4;if("number"!=typeof g)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(d.length&&d[d.length-1][0]>=g)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',x);const b=n.parse(_,v,f);if(!b)return null;f=f||b.type,d.push([g,b])}return"number"===f.kind||"color"===f.kind||"array"===f.kind&&"number"===f.itemType.kind&&"number"==typeof f.N?new Ts(f,i,a,l,d):n.error(`Type ${Zr(f)} is not interpolatable.`)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const a=this.input.evaluate(e);if(a<=n[0])return i[0].evaluate(e);const l=n.length;if(a>=n[l-1])return i[l-1].evaluate(e);const u=bo(n,a),d=Ts.interpolationFactor(this.interpolation,a,n[u],n[u+1]),f=i[u].evaluate(e),p=i[u+1].evaluate(e);return"interpolate"===this.operator?wg[this.type.kind.toLowerCase()](f,p,d):"interpolate-hcl"===this.operator?zl.reverse(zl.interpolate(zl.forward(f),zl.forward(p),d)):Pr.reverse(Pr.interpolate(Pr.forward(f),Pr.forward(p),d))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)n.push(this.labels[i],this.outputs[i].serialize());return n}}function Cu(t,e,n,i){const a=i-n,l=t-n;return 0===a?0:1===e?l/a:(Math.pow(e,l)-1)/(Math.pow(e,a)-1)}var _a=Ts;class nl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let i=null;const a=n.expectedType;a&&"value"!==a.kind&&(i=a);const l=[];for(const d of e.slice(1)){const f=n.parse(d,1+l.length,i,void 0,{typeAnnotation:"omit"});if(!f)return null;i=i||f.type,l.push(f)}const u=a&&l.some(d=>ig(a,d.type));return new nl(u?on:i,l)}evaluate(e){let n,i=null,a=0;for(const l of this.args){if(a++,i=l.evaluate(e),i&&i instanceof Jo&&!i.available&&(n||(n=i),i=null,a===this.args.length))return n;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var rl=nl;class Du{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let l=1;l<e.length-1;l+=2){const u=e[l];if("string"!=typeof u)return n.error(`Expected string, but found ${typeof u} instead.`,l);if(/[^a-zA-Z0-9_]/.test(u))return n.error("Variable names must contain only alphanumeric characters or '_'.",l);const d=n.parse(e[l+1],l+1);if(!d)return null;i.push([u,d])}const a=n.parse(e[e.length-1],e.length-1,n.expectedType,i);return a?new Du(i,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,i]of this.bindings)e.push(n,i.serialize());return e.push(this.result.serialize()),e}}var zh=Du;class _n{constructor(e,n,i){this.type=e,this.index=n,this.input=i}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,He),a=n.parse(e[2],2,bt(n.expectedType||on));return i&&a?new _n(a.type.itemType,i,a):null}evaluate(e){const n=this.index.evaluate(e),i=this.input.evaluate(e);if(n<0)throw new Ci(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new Ci(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new Ci(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var JP=_n;class jf{constructor(e,n){this.type=un,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,on),a=n.parse(e[2],2,on);return i&&a?It(i.type,[un,nn,He,Gs,on])?new jf(i,a):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zr(i.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!og(n,["boolean","string","number","null"]))throw new Ci(`Expected first argument to be of type boolean, string, number or null, but found ${Zr(ri(n))} instead.`);if(!og(i,["string","array"]))throw new Ci(`Expected second argument to be of type array or string, but found ${Zr(ri(i))} instead.`);return i.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Mw=jf;class Cs{constructor(e,n,i){this.type=He,this.needle=e,this.haystack=n,this.fromIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,on),a=n.parse(e[2],2,on);if(!i||!a)return null;if(!It(i.type,[un,nn,He,Gs,on]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zr(i.type)} instead`);if(4===e.length){const l=n.parse(e[3],3,He);return l?new Cs(i,a,l):null}return new Cs(i,a)}evaluate(e){const n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!og(n,["boolean","string","number","null"]))throw new Ci(`Expected first argument to be of type boolean, string, number or null, but found ${Zr(ri(n))} instead.`);if(!og(i,["string","array"]))throw new Ci(`Expected second argument to be of type array or string, but found ${Zr(ri(i))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return i.indexOf(n,a)}return i.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Eg=Cs;class kc{constructor(e,n,i,a,l,u){this.inputType=e,this.type=n,this.input=i,this.cases=a,this.outputs=l,this.otherwise=u}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let i,a;n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);const l={},u=[];for(let p=2;p<e.length-1;p+=2){let g=e[p];const _=e[p+1];Array.isArray(g)||(g=[g]);const x=n.concat(p);if(0===g.length)return x.error("Expected at least one branch label.");for(const b of g){if("number"!=typeof b&&"string"!=typeof b)return x.error("Branch labels must be numbers or strings.");if("number"==typeof b&&Math.abs(b)>Number.MAX_SAFE_INTEGER)return x.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof b&&Math.floor(b)!==b)return x.error("Numeric branch labels must be integer values.");if(i){if(x.checkSubtype(i,ri(b)))return null}else i=ri(b);if(void 0!==l[String(b)])return x.error("Branch labels must be unique.");l[String(b)]=u.length}const v=n.parse(_,p,a);if(!v)return null;a=a||v.type,u.push(v)}const d=n.parse(e[1],1,on);if(!d)return null;const f=n.parse(e[e.length-1],e.length-1,a);return f?"value"!==d.type.kind&&n.concat(1).checkSubtype(i,d.type)?null:new kc(i,a,d,l,u,f):null}evaluate(e){const n=this.input.evaluate(e);return(ri(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],a={};for(const u of n){const d=a[this.cases[u]];void 0===d?(a[this.cases[u]]=i.length,i.push([this.cases[u],[u]])):i[d][1].push(u)}const l=u=>"number"===this.inputType.kind?Number(u):u;for(const[u,d]of i)e.push(1===d.length?l(d[0]):d.map(l)),e.push(this.outputs[u].serialize());return e.push(this.otherwise.serialize()),e}}var Uf=kc;class Si{constructor(e,n,i){this.type=e,this.branches=n,this.otherwise=i}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);const a=[];for(let u=1;u<e.length-1;u+=2){const d=n.parse(e[u],u,un);if(!d)return null;const f=n.parse(e[u+1],u+1,i);if(!f)return null;a.push([d,f]),i=i||f.type}const l=n.parse(e[e.length-1],e.length-1,i);return l?new Si(i,a,l):null}evaluate(e){for(const[n,i]of this.branches)if(n.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,i]of this.branches)e(n),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var KP=Si;class oo{constructor(e,n,i,a){this.type=e,this.input=n,this.beginIndex=i,this.endIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,on),a=n.parse(e[2],2,He);if(!i||!a)return null;if(!It(i.type,[bt(on),nn,on]))return n.error(`Expected first argument to be of type array or string, but found ${Zr(i.type)} instead`);if(4===e.length){const l=n.parse(e[3],3,He);return l?new oo(i.type,i,a,l):null}return new oo(i.type,i,a)}evaluate(e){const n=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!og(n,["string","array"]))throw new Ci(`Expected first argument to be of type array or string, but found ${Zr(ri(n))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return n.slice(i,a)}return n.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var No=oo;function Mg(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Lc(t,e,n,i){return 0===i.compare(e,n)}function Bl(t,e,n){const i="=="!==t&&"!="!==t;return class kF{constructor(l,u,d){this.type=un,this.lhs=l,this.rhs=u,this.collator=d,this.hasUntypedArgument="value"===l.type.kind||"value"===u.type.kind}static parse(l,u){if(3!==l.length&&4!==l.length)return u.error("Expected two or three arguments.");const d=l[0];let f=u.parse(l[1],1,on);if(!f)return null;if(!Mg(d,f.type))return u.concat(1).error(`"${d}" comparisons are not supported for type '${Zr(f.type)}'.`);let p=u.parse(l[2],2,on);if(!p)return null;if(!Mg(d,p.type))return u.concat(2).error(`"${d}" comparisons are not supported for type '${Zr(p.type)}'.`);if(f.type.kind!==p.type.kind&&"value"!==f.type.kind&&"value"!==p.type.kind)return u.error(`Cannot compare types '${Zr(f.type)}' and '${Zr(p.type)}'.`);i&&("value"===f.type.kind&&"value"!==p.type.kind?f=new ma(p.type,[f]):"value"!==f.type.kind&&"value"===p.type.kind&&(p=new ma(f.type,[p])));let g=null;if(4===l.length){if("string"!==f.type.kind&&"string"!==p.type.kind&&"value"!==f.type.kind&&"value"!==p.type.kind)return u.error("Cannot use collator to compare non-string types.");if(g=u.parse(l[3],3,ng),!g)return null}return new kF(f,p,g)}evaluate(l){const u=this.lhs.evaluate(l),d=this.rhs.evaluate(l);if(i&&this.hasUntypedArgument){const f=ri(u),p=ri(d);if(f.kind!==p.kind||"string"!==f.kind&&"number"!==f.kind)throw new Ci(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${f.kind}, ${p.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const f=ri(u),p=ri(d);if("string"!==f.kind||"string"!==p.kind)return e(l,u,d)}return this.collator?n(l,u,d,this.collator.evaluate(l)):e(l,u,d)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[t];return this.eachChild(u=>{l.push(u.serialize())}),l}}}const ya=Bl("==",function(t,e,n){return e===n},Lc),By=Bl("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!Lc(0,e,n,i)}),gD=Bl("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),_D=Bl(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),QP=Bl("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),yD=Bl(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class Vy{constructor(e,n,i,a,l,u){this.type=nn,this.number=e,this.locale=n,this.currency=i,this.unit=a,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const i=n.parse(e[1],1,He);if(!i)return null;const a=e[2];if("object"!=typeof a||Array.isArray(a))return n.error("NumberFormat options argument must be an object.");let l=null;if(a.locale&&(l=n.parse(a.locale,1,nn),!l))return null;let u=null;if(a.currency&&(u=n.parse(a.currency,1,nn),!u))return null;let d=null;if(a.unit&&(d=n.parse(a.unit,1,nn),!d))return null;let f=null;if(a["min-fraction-digits"]&&(f=n.parse(a["min-fraction-digits"],1,He),!f))return null;let p=null;return a["max-fraction-digits"]&&(p=n.parse(a["max-fraction-digits"],1,He),!p)?null:new Vy(i,l,u,d,f,p)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Tw{constructor(e){this.type=He,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=n.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?n.error(`Expected argument of type string or array, but found ${Zr(i.type)} instead.`):new Tw(i):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new Ci(`Expected value to be of type string or array, but found ${Zr(ri(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Cw(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const xD={"==":ya,"!=":By,">":_D,"<":gD,">=":yD,"<=":QP,array:ma,at:JP,boolean:ma,case:KP,coalesce:rl,collator:Ih,format:Dh,image:wu,in:Mw,"index-of":Eg,interpolate:_a,"interpolate-hcl":_a,"interpolate-lab":_a,length:Tw,let:zh,literal:hg,match:Uf,number:ma,"number-format":Vy,object:ma,slice:No,step:bg,string:ma,"to-boolean":Sh,"to-color":Sh,"to-number":Sh,"to-string":Sh,var:An,within:qs,distance:Ny};function vD(t,[e,n,i,a]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const l=a?a.evaluate(t):1,u=Ay(e,n,i,l);if(u)throw new Ci(u);return new At(e/255*l,n/255*l,i/255*l,l)}function bD(t,[e,n,i,a]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const l=a?a.evaluate(t):1,u=(g=n,_=i,x=l,"number"==typeof(p=e)&&p>=0&&p<=360?"number"==typeof g&&g>=0&&g<=100&&"number"==typeof _&&_>=0&&_<=100?void 0===x||"number"==typeof x&&x>=0&&x<=1?null:`Invalid hsla value [${[p,g,_,x].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof x?[p,g,_,x]:[p,g,_]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof x?[p,g,_,x]:[p,g,_]).join(", ")}]: 'h' must be between 0 and 360.`);var p,g,_,x;if(u)throw new Ci(u);const d=`hsla(${e}, ${n}%, ${i}%, ${l})`,f=At.parse(d);if(!f)throw new Ci(`Failed to parse HSLA color: ${d}`);return f}function wD(t,e){return t in e}function Dw(t,e){const n=e[t];return void 0===n?null:n}function ED(t,e,n){n.length&&(e+=`\x1f${n}`);const i=t.getConfig(e);return i?i.evaluate(t):null}function Bh(t){return{type:t}}Ko.register(xD,{error:[{kind:"error"},[nn],(t,[e])=>{throw new Ci(e.evaluate(t))}],typeof:[nn,[on],(t,[e])=>Zr(ri(e.evaluate(t)))],"to-rgba":[bt(He,4),[pa],(t,[e])=>e.evaluate(t).toArray()],rgb:[pa,[He,He,He],vD],rgba:[pa,[He,He,He,He],vD],hsl:[pa,[He,He,He],bD],hsla:[pa,[He,He,He,He],bD],has:{type:un,overloads:[[[nn],(t,[e])=>wD(e.evaluate(t),t.properties())],[[nn,Th],(t,[e,n])=>wD(e.evaluate(t),n.evaluate(t))]]},get:{type:on,overloads:[[[nn],(t,[e])=>Dw(e.evaluate(t),t.properties())],[[nn,Th],(t,[e,n])=>Dw(e.evaluate(t),n.evaluate(t))]]},config:{type:on,overloads:[[[nn],(t,[e])=>ED(t,e.evaluate(t),"")],[[nn,nn],(t,[e,n])=>ED(t,e.evaluate(t),n.evaluate(t))]]},"feature-state":[on,[nn],(t,[e])=>Dw(e.evaluate(t),t.featureState||{})],properties:[Th,[],t=>t.properties()],"geometry-type":[nn,[],t=>t.geometryType()],id:[on,[],t=>t.id()],zoom:[He,[],t=>t.globals.zoom],pitch:[He,[],t=>t.globals.pitch||0],"distance-from-center":[He,[],t=>t.distanceFromCenter()],"measure-light":[He,[nn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[He,[],t=>t.globals.heatmapDensity||0],"line-progress":[He,[],t=>t.globals.lineProgress||0],"raster-value":[He,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[He,[],t=>t.globals.skyRadialProgress||0],accumulated:[on,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[He,Bh(He),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[He,Bh(He),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:He,overloads:[[[He,He],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[He],(t,[e])=>-e.evaluate(t)]]},"/":[He,[He,He],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[He,[He,He],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[He,[],()=>Math.LN2],pi:[He,[],()=>Math.PI],e:[He,[],()=>Math.E],"^":[He,[He,He],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[He,[He],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[He,[He],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[He,[He],(t,[e])=>Math.log(e.evaluate(t))],log2:[He,[He],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[He,[He],(t,[e])=>Math.sin(e.evaluate(t))],cos:[He,[He],(t,[e])=>Math.cos(e.evaluate(t))],tan:[He,[He],(t,[e])=>Math.tan(e.evaluate(t))],asin:[He,[He],(t,[e])=>Math.asin(e.evaluate(t))],acos:[He,[He],(t,[e])=>Math.acos(e.evaluate(t))],atan:[He,[He],(t,[e])=>Math.atan(e.evaluate(t))],min:[He,Bh(He),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[He,Bh(He),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[He,[He],(t,[e])=>Math.abs(e.evaluate(t))],round:[He,[He],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[He,[He],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[He,[He],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[un,[nn,on],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[un,[on],(t,[e])=>t.id()===e.value],"filter-type-==":[un,[nn],(t,[e])=>t.geometryType()===e.value],"filter-<":[un,[nn,on],(t,[e,n])=>{const i=t.properties()[e.value],a=n.value;return typeof i==typeof a&&i<a}],"filter-id-<":[un,[on],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[un,[nn,on],(t,[e,n])=>{const i=t.properties()[e.value],a=n.value;return typeof i==typeof a&&i>a}],"filter-id->":[un,[on],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[un,[nn,on],(t,[e,n])=>{const i=t.properties()[e.value],a=n.value;return typeof i==typeof a&&i<=a}],"filter-id-<=":[un,[on],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[un,[nn,on],(t,[e,n])=>{const i=t.properties()[e.value],a=n.value;return typeof i==typeof a&&i>=a}],"filter-id->=":[un,[on],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[un,[on],(t,[e])=>e.value in t.properties()],"filter-has-id":[un,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[un,[bt(nn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[un,[bt(on)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[un,[nn,bt(on)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[un,[nn,bt(on)],(t,[e,n])=>function(i,a,l,u){for(;l<=u;){const d=l+u>>1;if(a[d]===i)return!0;a[d]>i?u=d-1:l=d+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:un,overloads:[[[un,un],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Bh(un),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:un,overloads:[[[un,un],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Bh(un),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[un,[un],(t,[e])=>!e.evaluate(t)],"is-supported-script":[un,[nn],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[nn,[nn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[nn,[nn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[nn,Bh(on),(t,e)=>e.map(n=>ug(n.evaluate(t))).join("")],"resolved-locale":[nn,[ng],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[He,[He,He,on],(t,e)=>{const[n,i,a]=e.map(u=>u.evaluate(t));if(n>i||n===i)return n;let l;if("string"==typeof a)l=function(u){let d=0;if(0===u.length)return d;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d&=d;return d}(a);else{if("number"!=typeof a)throw new Ci(`Invalid seed input: ${a}`);l=a}return n+Cw(l)()*(i-n)}]});var Tg=xD;function MD(t){return{result:"success",value:t}}function Vh(t){return{result:"error",value:t}}function jy(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Fc(t){return"data-driven"===t["property-type"]}function TD(t){return jy(t.expression,"measure-light")}function Sw(t){return jy(t.expression,"zoom")}function Iw(t){return!!t.expression&&t.expression.interpolated}function il(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Nc(t){return t}function CD(t,e){const n="color"===e.type,i=t.stops&&"object"==typeof t.stops[0][0],a=i||!(i||void 0!==t.property),l=t.type||(Iw(e)?"exponential":"interval");if(n&&((t=Ac({},t)).stops&&(t.stops=t.stops.map(p=>[p[0],At.parse(p[1])])),t.default=At.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Tu[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let u,d,f;if("exponential"===l)u=Ds;else if("interval"===l)u=Dg;else if("categorical"===l){u=so,d=Object.create(null);for(const p of t.stops)d[p[0]]=p[1];f=typeof t.stops[0][0]}else{if("identity"!==l)throw new Error(`Unknown function type "${l}"`);u=Aw}if(i){const p={},g=[];for(let v=0;v<t.stops.length;v++){const b=t.stops[v],E=b[0].zoom;void 0===p[E]&&(p[E]={zoom:E,type:t.type,property:t.property,default:t.default,stops:[]},g.push(E)),p[E].stops.push([b[0].value,b[1]])}const _=[];for(const v of g)_.push([p[v].zoom,CD(p[v],e)]);const x={name:"linear"};return{kind:"composite",interpolationType:x,interpolationFactor:_a.interpolationFactor.bind(void 0,x),zoomStops:_.map(v=>v[0]),evaluate:({zoom:v},b)=>Ds({stops:_,base:t.base},e,v).evaluate(v,b)}}if(a){const p="exponential"===l?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:p,interpolationFactor:_a.interpolationFactor.bind(void 0,p),zoomStops:t.stops.map(g=>g[0]),evaluate:({zoom:g})=>u(t,e,g,d,f)}}return{kind:"source",evaluate(p,g){const _=g&&g.properties?g.properties[t.property]:void 0;return void 0===_?Cg(t.default,e.default):u(t,e,_,d,f)}}}function Cg(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function so(t,e,n,i,a){return Cg(typeof n===a?i[n]:void 0,t.default,e.default)}function Dg(t,e,n){if("number"!==gn(n))return Cg(t.default,e.default);const i=t.stops.length;if(1===i||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const a=bo(t.stops.map(l=>l[0]),n);return t.stops[a][1]}function Ds(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==gn(n))return Cg(t.default,e.default);const a=t.stops.length;if(1===a||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[a-1][0])return t.stops[a-1][1];const l=bo(t.stops.map(g=>g[0]),n),u=function(g,_,x,v){const b=v-x,E=g-x;return 0===b?0:1===_?E/b:(Math.pow(_,E)-1)/(Math.pow(_,b)-1)}(n,i,t.stops[l][0],t.stops[l+1][0]),d=t.stops[l][1],f=t.stops[l+1][1];let p=wg[e.type]||Nc;if(t.colorSpace&&"rgb"!==t.colorSpace){const g=Tu[t.colorSpace];p=(_,x)=>g.reverse(g.interpolate(g.forward(_),g.forward(x),u))}return"function"==typeof d.evaluate?{evaluate(...g){const _=d.evaluate.apply(void 0,g),x=f.evaluate.apply(void 0,g);if(void 0!==_&&void 0!==x)return p(_,x,u)}}:p(d,f,u)}function Aw(t,e,n){return"color"===e.type?n=At.parse(n):"formatted"===e.type?n=Ht.fromString(n.toString()):"resolvedImage"===e.type?n=Jo.fromString(n.toString()):gn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),Cg(n,t.default,e.default)}class Sg{constructor(e,n,i){var a;this.expression=e,this._warningHistory={},this._evaluator=new lD(i),this._defaultValue=n?"color"===(a=n).type&&(il(a.default)||Array.isArray(a.default))?new At(0,0,0,0):"color"===a.type?At.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,i,a,l,u,d,f){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=i,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=u,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=f||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,i,a,l,u,d,f){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=i||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=u||null,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=f||null;try{const p=this.expression.evaluate(this._evaluator);if(null==p||"number"==typeof p&&p!=p)return this._defaultValue;if(this._enumValues&&!(p in this._enumValues))throw new Ci(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(p)} instead.`);return p}catch(p){return this._warningHistory[p.message]||(this._warningHistory[p.message]=!0,typeof console<"u"&&console.warn(p.message)),this._defaultValue}}}function $f(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Tg}function Vl(t,e,n){const i=new vo(Tg,[],e?function(l){const u={color:pa,string:nn,number:He,enum:nn,boolean:un,formatted:rg,resolvedImage:yo};return"array"===l.type?bt(u[l.value]||on,l.length):u[l.type]}(e):void 0,void 0,void 0,n),a=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return a?MD(new Sg(a,e,n)):Vh(i.errors)}class Hf{constructor(e,n,i){this.kind=e,this._styleExpression=n,this.isLightConstant=i,this.isStateDependent="constant"!==e&&!yg(n.expression),this.isConfigDependent=!xg(n.expression)}evaluateWithoutErrorHandling(e,n,i,a,l,u){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,a,l,u)}evaluate(e,n,i,a,l,u){return this._styleExpression.evaluate(e,n,i,a,l,u)}}class jl{constructor(e,n,i,a,l){this.kind=e,this.zoomStops=i,this._styleExpression=n,this.isStateDependent="camera"!==e&&!yg(n.expression),this.isLightConstant=l,this.isConfigDependent=!xg(n.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,n,i,a,l,u){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,a,l,u)}evaluate(e,n,i,a,l,u){return this._styleExpression.evaluate(e,n,i,a,l,u)}interpolationFactor(e,n,i){return this.interpolationType?_a.interpolationFactor(this.interpolationType,e,n,i):0}}function Gf(t,e,n){if("error"===(t=Vl(t,e,n)).result)return t;const i=t.value.expression,a=Fo(i);if(!a&&!Fc(e))return Vh([new Fl("","data expressions not supported")]);const l=jt(i,["zoom","pitch","distance-from-center"]);if(!l&&!Sw(e))return Vh([new Fl("","zoom expressions not supported")]);const u=jt(i,["measure-light"]);if(!u&&!TD(e))return Vh([new Fl("","measure-light expression not supported")]);const d=e.expression&&e.expression.relaxZoomRestriction,f=qf(i);return f||l||d?f instanceof Fl?Vh([f]):f instanceof _a&&!Iw(e)?Vh([new Fl("",'"interpolate" expressions cannot be used with this property')]):MD(f?new jl(a?"camera":"composite",t.value,f.labels,f instanceof _a?f.interpolation:void 0,u):new Hf(a?"constant":"source",t.value,u)):Vh([new Fl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class jh{constructor(e,n){this._parameters=e,this._specification=n,Ac(this,CD(this._parameters,this._specification))}static deserialize(e){return new jh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function qf(t){let e=null;if(t instanceof zh)e=qf(t.result);else if(t instanceof rl){for(const n of t.args)if(e=qf(n),e)break}else(t instanceof bg||t instanceof _a)&&t.input instanceof Ko&&"zoom"===t.input.name&&(e=t);return e instanceof Fl||t.eachChild(n=>{const i=qf(n);i instanceof Fl?e=i:e&&i&&e!==i&&(e=new Fl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ss(t){const e=t.key,n=t.value,i=t.valueSpec||{},a=t.objectElementValidators||{},l=t.style,u=t.styleSpec;let d=[];const f=gn(n);if("object"!==f)return[new De(e,n,`object expected, ${f} found`)];for(const p in n){const g=p.split(".")[0];let _;a[g]?_=a[g]:i[g]?_=Ii:a["*"]?_=a["*"]:i["*"]&&(_=Ii),_?d=d.concat(_({key:(e&&`${e}.`)+p,value:n[p],valueSpec:i[g]||i["*"],style:l,styleSpec:u,object:n,objectKey:p},n)):d.push(new bu(e,n[p],`unknown property "${p}"`))}for(const p in i)a[p]||i[p].required&&void 0===i[p].default&&void 0===n[p]&&d.push(new De(e,n,`missing required property "${p}"`));return d}function Uy(t){const e=t.value,n=t.valueSpec,i=t.style,a=t.styleSpec,l=t.key,u=t.arrayElementValidator||Ii;if("array"!==gn(e))return[new De(l,e,`array expected, ${gn(e)} found`)];if(n.length&&e.length!==n.length)return[new De(l,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new De(l,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let d={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};a.$version<7&&(d.function=n.function),"object"===gn(n.value)&&(d=n.value);let f=[];for(let p=0;p<e.length;p++)f=f.concat(u({array:e,arrayIndex:p,value:e[p],valueSpec:d,style:i,styleSpec:a,key:`${l}[${p}]`},!0));return f}function Zf(t){const e=t.key,n=t.value,i=t.valueSpec;let a=gn(n);if("number"===a&&n!=n&&(a="NaN"),"number"!==a)return[new De(e,n,`number expected, ${a} found`)];if("minimum"in i){let l=i.minimum;if("array"===gn(i.minimum)&&(l=i.minimum[t.arrayIndex]),n<l)return[new De(e,n,`${n} is less than the minimum value ${l}`)]}if("maximum"in i){let l=i.maximum;if("array"===gn(i.maximum)&&(l=i.maximum[t.arrayIndex]),n>l)return[new De(e,n,`${n} is greater than the maximum value ${l}`)]}return[]}function Uh(t){const e=t.valueSpec,n=qr(t.value.type);let i,a,l,u={};const d="categorical"!==n&&void 0===t.value.property,f=!d,p="array"===gn(t.value.stops)&&"array"===gn(t.value.stops[0])&&"object"===gn(t.value.stops[0][0]),g=Ss({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(v){if("identity"===n)return[new De(v.key,v.value,'identity function may not have a "stops" property')];let b=[];const E=v.value;return b=b.concat(Uy({key:v.key,value:E,valueSpec:v.valueSpec,style:v.style,styleSpec:v.styleSpec,arrayElementValidator:_})),"array"===gn(E)&&0===E.length&&b.push(new De(v.key,E,"array must have at least one stop")),b},default:function(v){return Ii({key:v.key,value:v.value,valueSpec:e,style:v.style,styleSpec:v.styleSpec})}}});return"identity"===n&&d&&g.push(new De(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||g.push(new De(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Iw(t.valueSpec)&&g.push(new De(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(f&&!Fc(t.valueSpec)?g.push(new De(t.key,t.value,"property functions not supported")):d&&!Sw(t.valueSpec)&&g.push(new De(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!p||void 0!==t.value.property||g.push(new De(t.key,t.value,'"property" property is required')),g;function _(v){let b=[];const E=v.value,C=v.key;if("array"!==gn(E))return[new De(C,E,`array expected, ${gn(E)} found`)];if(2!==E.length)return[new De(C,E,`array length 2 expected, length ${E.length} found`)];if(p){if("object"!==gn(E[0]))return[new De(C,E,`object expected, ${gn(E[0])} found`)];if(void 0===E[0].zoom)return[new De(C,E,"object stop key must have zoom")];if(void 0===E[0].value)return[new De(C,E,"object stop key must have value")];const T=qr(E[0].zoom);if("number"!=typeof T)return[new De(C,E[0].zoom,"stop zoom values must be numbers")];if(l&&l>T)return[new De(C,E[0].zoom,"stop zoom values must appear in ascending order")];T!==l&&(l=T,a=void 0,u={}),b=b.concat(Ss({key:`${C}[0]`,value:E[0],valueSpec:{zoom:{}},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{zoom:Zf,value:x}}))}else b=b.concat(x({key:`${C}[0]`,value:E[0],valueSpec:{},style:v.style,styleSpec:v.styleSpec},E));return $f(fa(E[1]))?b.concat([new De(`${C}[1]`,E[1],"expressions are not allowed in function stops.")]):b.concat(Ii({key:`${C}[1]`,value:E[1],valueSpec:e,style:v.style,styleSpec:v.styleSpec}))}function x(v,b){const E=gn(v.value),C=qr(v.value),T=null!==v.value?v.value:b;if(i){if(E!==i)return[new De(v.key,T,`${E} stop domain type must match previous stop domain type ${i}`)]}else i=E;if("number"!==E&&"string"!==E&&"boolean"!==E&&"number"!=typeof C&&"string"!=typeof C&&"boolean"!=typeof C)return[new De(v.key,T,"stop domain value must be a number, string, or boolean")];if("number"!==E&&"categorical"!==n){let D=`number expected, ${E} found`;return Fc(e)&&void 0===n&&(D+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(v.key,T,D)]}return"categorical"!==n||"number"!==E||"number"==typeof C&&isFinite(C)&&Math.floor(C)===C?"categorical"!==n&&"number"===E&&"number"==typeof C&&"number"==typeof a&&void 0!==a&&C<a?[new De(v.key,T,"stop domain values must appear in ascending order")]:(a=C,"categorical"===n&&C in u?[new De(v.key,T,"stop domain values must be unique")]:(u[C]=!0,[])):[new De(v.key,T,`integer expected, found ${String(C)}`)]}}function Ws(t){const e=("property"===t.expressionContext?Gf:Vl)(fa(t.value),t.valueSpec);if("error"===e.result)return e.value.map(i=>new De(`${t.key}${i.key}`,t.value,i.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new De(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!yg(n))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return $y(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!jt(n,["zoom","feature-state"]))return[new De(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Fo(n))return[new De(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $y(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)n.delete(a);if(0===n.size)return[];const i=[];return t instanceof Ko&&n.has(t.name)?[new De(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(a=>{i.push(...$y(a,e))}),i)}function Hy(t){const e=t.key,n=t.value,i=t.valueSpec,a=[];return Array.isArray(i.values)?-1===i.values.indexOf(qr(n))&&a.push(new De(e,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(qr(n))&&a.push(new De(e,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),a}function Pw(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Pw(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Gy(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Pw(t)||(t=$h(t));const n=t;let i=!0;try{i=function(p){if(!Wf(p))return p;let g=fa(p);return Ow(g),g=Rw(g),g}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const a=J[`filter_${e}`],l=Vl(i,a);let u=null;if("error"===l.result)throw new Error(l.value.map(p=>`${p.key}: ${p.message}`).join(", "));u=(p,g,_)=>l.value.evaluate(p,g,{},_);let d=null,f=null;if(i!==n){const p=Vl(n,a);if("error"===p.result)throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));d=(g,_,x,v,b)=>p.value.evaluate(g,_,{},x,void 0,void 0,v,b),f=!Fo(p.value.expression)}return{filter:u,dynamicFilter:d||void 0,needGeometry:Lw(i),needFeature:!!f}}function Rw(t){if(!Array.isArray(t))return t;const e=function(n){if(kw.has(n[0]))for(let i=1;i<n.length;i++)if(Wf(n[i]))return!0;return n}(t);return!0===e?e:e.map(n=>Rw(n))}function Ow(t){let e=!1;const n=[];if("case"===t[0]){for(let i=1;i<t.length-1;i+=2)e=e||Wf(t[i]),n.push(t[i+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||Wf(t[1]);for(let i=2;i<t.length-1;i+=2)n.push(t[i+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||Wf(t[1]);for(let i=1;i<t.length-1;i+=2)n.push(t[i+1])}e&&(t.length=0,t.push("any",...n));for(let i=1;i<t.length;i++)Ow(t[i])}function Wf(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(Wf(t[n]))return!0;return!1}const kw=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function qy(t,e){return t<e?-1:t>e?1:0}function Lw(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(Lw(t[e]))return!0;return!1}function $h(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Fw(t[1],t[2],"=="):"!="===e?Xf(Fw(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Fw(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map($h))):"all"===e?["all"].concat(t.slice(1).map($h)):"none"===e?["all"].concat(t.slice(1).map($h).map(Xf)):"in"===e?DD(t[1],t.slice(2)):"!in"===e?Xf(DD(t[1],t.slice(2))):"has"===e?Nw(t[1]):"!has"!==e||Xf(Nw(t[1]));var n}function Fw(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function DD(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(qy)]]:["filter-in-small",t,["literal",e]]}}function Nw(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Xf(t){return["!",t]}function Ig(t){return Pw(fa(t.value))?Ws(Ac({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):zw(t)}function zw(t){const e=t.value,n=t.key;if("array"!==gn(e))return[new De(n,e,`array expected, ${gn(e)} found`)];const i=t.styleSpec;let a,l=[];if(e.length<1)return[new De(n,e,"filter array must have at least 1 element")];switch(l=l.concat(Hy({key:`${n}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),qr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===qr(e[1])&&l.push(new De(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&l.push(new De(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=gn(e[1]),"string"!==a&&l.push(new De(`${n}[1]`,e[1],`string expected, ${a} found`)));for(let u=2;u<e.length;u++)a=gn(e[u]),"$type"===qr(e[1])?l=l.concat(Hy({key:`${n}[${u}]`,value:e[u],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&l.push(new De(`${n}[${u}]`,e[u],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let u=1;u<e.length;u++)l=l.concat(zw({key:`${n}[${u}]`,value:e[u],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=gn(e[1]),2!==e.length?l.push(new De(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==a&&l.push(new De(`${n}[1]`,e[1],`string expected, ${a} found`))}return l}function Bw(t,e){const n=t.key,i=t.style,a=t.layer,l=t.styleSpec,u=t.value,d=t.objectKey,f=l[`${e}_${t.layerType}`];if(!f)return[];const p=d.match(/^(.*)-transition$/);if("paint"===e&&p&&f[p[1]]&&f[p[1]].transition)return Ii({key:n,value:u,valueSpec:l.transition,style:i,styleSpec:l});const g=t.valueSpec||f[d];if(!g)return[new bu(n,u,`unknown property "${d}"`)];let _;if("string"===gn(u)&&Fc(g)&&!g.tokens&&(_=/^{([^}]+)}$/.exec(u))){const v=`\`{ "type": "identity", "property": ${_?JSON.stringify(_[1]):'"_"'} }\``;return[new De(n,u,`"${d}" does not support interpolation syntax\nUse an identity property function instead: ${v}.`)]}const x=[];if("symbol"===t.layerType)"text-field"!==d||!i||i.glyphs||i.imports||x.push(new De(n,u,'use of "text-field" requires a style "glyphs" property')),"text-font"===d&&il(fa(u))&&"identity"===qr(u.type)&&x.push(new De(n,u,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===e&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&Fc(g)&&(TD(g)||Sw(g))){const v=Gf(fa(u),g),b=v.value.expression||v.value._styleExpression.expression;b&&!jt(b,["measure-light"])&&x.push(new De(n,u,`${d} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`))}return x.concat(Ii({key:t.key,value:u,valueSpec:g,style:i,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:d}))}function Vw(t){return Bw(t,"paint")}function Zy(t){return Bw(t,"layout")}function jw(t){let e=[];const n=t.value,i=t.key,a=t.style,l=t.styleSpec;n.type||n.ref||e.push(new De(i,n,'either "type" or "ref" is required'));let u=qr(n.type);const d=qr(n.ref);if(n.id){const f=qr(n.id);for(let p=0;p<t.arrayIndex;p++){const g=a.layers[p];qr(g.id)===f&&e.push(new De(i,n.id,`duplicate layer id "${n.id}", previously used at line ${g.id.__line__}`))}}if("ref"in n){let f;["type","source","source-layer","filter","layout"].forEach(p=>{p in n&&e.push(new De(i,n[p],`"${p}" is prohibited for ref layers`))}),a.layers.forEach(p=>{qr(p.id)===d&&(f=p)}),f?f.ref?e.push(new De(i,n.ref,"ref cannot reference another ref layer")):u=qr(f.type):"string"==typeof d&&e.push(new De(i,n.ref,`ref layer "${d}" not found`))}else if("background"!==u&&"sky"!==u&&"slot"!==u)if(n.source){const f=a.sources&&a.sources[n.source],p=f&&qr(f.type);f?"vector"===p&&"raster"===u?e.push(new De(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===p&&"raster"!==u?e.push(new De(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==p||n["source-layer"]?"raster-dem"===p&&"hillshade"!==u?e.push(new De(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==u||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===p&&f.lineMetrics||e.push(new De(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new De(i,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new De(i,n.source,`source "${n.source}" not found`))}else e.push(new De(i,n,'missing required property "source"'));return e=e.concat(Ss({key:i,value:n,valueSpec:l.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ii({key:`${i}.type`,value:n.type,valueSpec:l.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:f=>Ig(Ac({layerType:u},f)),layout:f=>Ss({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>Zy(Ac({layerType:u},p))}}),paint:f=>Ss({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>Vw(Ac({layerType:u,layer:n},p))}})}})),e}function Su(t){const e=t.value,n=t.key,i=gn(e);return"string"!==i?[new De(n,e,`string expected, ${i} found`)]:[]}const Uw={promoteId:function({key:t,value:e}){if("string"===gn(e))return Su({key:t,value:e});{const n=[];for(const i in e)n.push(...Su({key:`${t}.${i}`,value:e[i]}));return n}}};function SD(t){const e=t.value,n=t.key,i=t.styleSpec,a=t.style;if(!e.type)return[new De(n,e,'"type" is required')];const l=qr(e.type);let u;switch(l){case"vector":case"raster":case"raster-dem":return u=Ss({key:n,value:e,valueSpec:i[`source_${l.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:Uw}),u;case"geojson":if(u=Ss({key:n,value:e,valueSpec:i.source_geojson,style:a,styleSpec:i,objectElementValidators:Uw}),e.cluster)for(const d in e.clusterProperties){const[f,p]=e.clusterProperties[d],g="string"==typeof f?[f,["accumulated"],["get",d]]:f;u.push(...Ws({key:`${n}.${d}.map`,value:p,expressionContext:"cluster-map"})),u.push(...Ws({key:`${n}.${d}.reduce`,value:g,expressionContext:"cluster-reduce"}))}return u;case"video":return Ss({key:n,value:e,valueSpec:i.source_video,style:a,styleSpec:i});case"image":return Ss({key:n,value:e,valueSpec:i.source_image,style:a,styleSpec:i});case"canvas":return[new De(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hy({key:`${n}.type`,value:e.type,valueSpec:{values:ID(i)},style:a,styleSpec:i})}}function ID(t){return t.source.reduce((e,n)=>{const i=t[n];return"enum"===i.type.type&&(e=e.concat(Object.keys(i.type.values))),e},[])}function Is(t){const e=t.value;let n=[];if(!e)return n;const i=gn(e);return"string"!==i?(n=n.concat([new De(t.key,e,`string expected, "${i}" found`)]),n):(function(a){const l=-1===a.indexOf("://");try{return new URL(a,l?"http://example.com":void 0),!0}catch{return!1}}(e)||(n=n.concat([new De(t.key,e,`invalid url "${e}"`)])),n)}function Wy(t){const e=t.value,n=t.styleSpec,i=n.light,a=t.style;let l=[];const u=gn(e);if(void 0===e)return l;if("object"!==u)return l=l.concat([new De("light",e,`object expected, ${u} found`)]),l;for(const d in e){const f=d.match(/^(.*)-transition$/);l=l.concat(f&&i[f[1]]&&i[f[1]].transition?Ii({key:d,value:e[d],valueSpec:n.transition,style:a,styleSpec:n}):i[d]?Ii({key:d,value:e[d],valueSpec:i[d],style:a,styleSpec:n}):[new De(d,e[d],`unknown property "${d}"`)])}return l}function $w(t){const e=t.value;let n=[];if(!e)return n;const i=gn(e);if("object"!==i)return n=n.concat([new De("light-3d",e,`object expected, ${i} found`)]),n;const a=t.styleSpec,l=a["light-3d"],u=t.key,d=t.style,f=t.style.lights;for(const _ of["type","id"])if(!(_ in e))return n=n.concat([new De("light-3d",e,`missing property ${_} on light`)]),n;if(e.type&&f)for(let _=0;_<t.arrayIndex;_++){const x=qr(e.type),v=f[_];qr(v.type)===x&&n.push(new De(u,e.id,`duplicate light type "${e.type}", previously defined at line ${v.id.__line__}`))}const p=`properties_light_${e.type}`;if(!(p in a))return n=n.concat([new De("light-3d",e,`Invalid light type ${e.type}`)]),n;const g=a[p];for(const _ in e)if("properties"===_){const x=e[_],v=gn(x);if("object"!==v)return n=n.concat([new De("properties",x,`object expected, ${v} found`)]),n;for(const b in x)n=n.concat(g[b]?Ii({key:b,value:x[b],valueSpec:g[b],style:d,styleSpec:a}):[new bu(t.key,x[b],`unknown property "${b}"`)])}else{const x=_.match(/^(.*)-transition$/);n=n.concat(x&&l[x[1]]&&l[x[1]].transition?Ii({key:_,value:e[_],valueSpec:a.transition,style:d,styleSpec:a}):l[_]?Ii({key:_,value:e[_],valueSpec:l[_],style:d,styleSpec:a}):[new bu(_,e[_],`unknown property "${_}"`)])}return n}function Hw(t){const e=t.value,n=t.key,i=t.style,a=t.styleSpec,l=a.terrain;let u=[];const d=gn(e);if(void 0===e)return u;if("object"!==d)return u=u.concat([new De("terrain",e,`object expected, ${d} found`)]),u;for(const f in e){const p=f.match(/^(.*)-transition$/);u=u.concat(p&&l[p[1]]&&l[p[1]].transition?Ii({key:f,value:e[f],valueSpec:a.transition,style:i,styleSpec:a}):l[f]?Ii({key:f,value:e[f],valueSpec:l[f],style:i,styleSpec:a}):[new bu(f,e[f],`unknown property "${f}"`)])}if(e.source){const f=i.sources&&i.sources[e.source],p=f&&qr(f.type);f?"raster-dem"!==p&&u.push(new De(n,e.source,`terrain cannot be used with a source of type ${String(p)}, it only be used with a "raster-dem" source type`)):u.push(new De(n,e.source,`source "${e.source}" not found`))}else u.push(new De(n,e,'terrain is missing required property "source"'));return u}function Xy(t){const e=t.value,n=t.style,i=t.styleSpec,a=i.fog;let l=[];const u=gn(e);if(void 0===e)return l;if("object"!==u)return l=l.concat([new De("fog",e,`object expected, ${u} found`)]),l;for(const d in e){const f=d.match(/^(.*)-transition$/);l=l.concat(f&&a[f[1]]&&a[f[1]].transition?Ii({key:d,value:e[d],valueSpec:i.transition,style:n,styleSpec:i}):a[d]?Ii({key:d,value:e[d],valueSpec:a[d],style:n,styleSpec:i}):[new bu(d,e[d],`unknown property "${d}"`)])}return l}const Yy={"*":()=>[],array:Uy,boolean:function(t){const e=t.value,n=t.key,i=gn(e);return"boolean"!==i?[new De(n,e,`boolean expected, ${i} found`)]:[]},number:Zf,color:function(t){const e=t.key,n=t.value,i=gn(n);return"string"!==i?[new De(e,n,`color expected, ${i} found`)]:null===Yo(n)?[new De(e,n,`color expected, "${n}" found`)]:[]},enum:Hy,filter:Ig,function:Uh,layer:jw,object:Ss,source:SD,model:Is,light:Wy,"light-3d":$w,terrain:Hw,fog:Xy,string:Su,formatted:function(t){return 0===Su(t).length?[]:Ws(t)},resolvedImage:function(t){return 0===Su(t).length?[]:Ws(t)},projection:function(t){const e=t.value,n=t.styleSpec,i=n.projection,a=t.style;let l=[];const u=gn(e);if("object"===u)for(const d in e)l=l.concat(Ii({key:d,value:e[d],valueSpec:i[d],style:a,styleSpec:n}));else"string"!==u&&(l=l.concat([new De("projection",e,`object or string expected, ${u} found`)]));return l},import:function(t){const{value:e,styleSpec:n}=t,{data:i,...a}=e;Object.defineProperty(a,"__line__",{value:e.__line__,enumerable:!1});let l=Ss(Ac({},t,{value:a,valueSpec:n.import}));return""===qr(a.id)&&l.push(new De(`${t.key}.id`,a,"import id can't be an empty string")),i&&(l=l.concat(Gw(i,n,{key:`${t.key}.data`}))),l}};function Ii(t,e=!1){const n=t.value,i=t.valueSpec,a=t.styleSpec;if(i.expression&&il(qr(n)))return Uh(t);if(i.expression&&$f(fa(n)))return Ws(t);if(i.type&&Yy[i.type]){const l=Yy[i.type](t);return!0===e&&l.length>0&&"array"===gn(t.value)?Ws(t):l}return Ss(Ac({},t,{valueSpec:i.type?a[i.type]:i}))}function Jy(t){const e=t.value,n=t.key,i=Su(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new De(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new De(n,e,'"glyphs" url must include a "{range}" token'))),i}function Gw(t,e=J,n={}){return Ii({key:n.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Jy,"*":()=>[]}})}function zo(t,e=J){return xa(Gw(t,e))}const qw=t=>xa(SD(t)),Zw=t=>xa(Wy(t)),Dr=t=>xa($w(t)),Ky=t=>xa(Hw(t)),Ag=t=>xa(Xy(t)),Qo=t=>xa(jw(t)),Qy=t=>xa(Ig(t)),Ww=t=>xa(Vw(t)),Hh=t=>xa(Zy(t)),As=t=>xa(Is(t));function xa(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Pg(t,e){let n=!1;if(e&&e.length)for(const i of e)i instanceof bu?K(i.message):(t.fire(new pe(new Error(i.message))),n=!0);return n}var AD=va,Bo=3;function va(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(n=a[2]);for(var l=0;l<this.d*this.d;l++){var u=a[Bo+l],d=a[Bo+l+1];i.push(u===d?null:a.subarray(u,d))}var f=a[Bo+i.length+1];this.keys=a.subarray(a[Bo+i.length],f),this.bboxes=a.subarray(f),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var p=0;p<this.d*this.d;p++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var g=n/e*t;this.min=-g,this.max=t+g}va.prototype.insert=function(t,e,n,i,a){this._forEachCell(e,n,i,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a)},va.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},va.prototype._insertCell=function(t,e,n,i,a,l){this.cells[a].push(l)},va.prototype.query=function(t,e,n,i,a){var l=this.min,u=this.max;if(t<=l&&e<=l&&u<=n&&u<=i&&!a)return Array.prototype.slice.call(this.keys);var d=[];return this._forEachCell(t,e,n,i,this._queryCell,d,{},a),d},va.prototype._queryCell=function(t,e,n,i,a,l,u,d){var f=this.cells[a];if(null!==f)for(var p=this.keys,g=this.bboxes,_=0;_<f.length;_++){var x=f[_];if(void 0===u[x]){var v=4*x;(d?d(g[v+0],g[v+1],g[v+2],g[v+3]):t<=g[v+2]&&e<=g[v+3]&&n>=g[v+0]&&i>=g[v+1])?(u[x]=!0,l.push(p[x])):u[x]=!1}}},va.prototype._forEachCell=function(t,e,n,i,a,l,u,d){for(var f=this._convertToCellCoord(t),p=this._convertToCellCoord(e),g=this._convertToCellCoord(n),_=this._convertToCellCoord(i),x=f;x<=g;x++)for(var v=p;v<=_;v++){var b=this.d*v+x;if((!d||d(this._convertFromCellCoord(x),this._convertFromCellCoord(v),this._convertFromCellCoord(x+1),this._convertFromCellCoord(v+1)))&&a.call(this,t,e,n,i,b,l,u,d))return}},va.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},va.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},va.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Bo+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var a=new Int32Array(e+n+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var l=e,u=0;u<t.length;u++){var d=t[u];a[Bo+u]=l,a.set(d,l),l+=d.length}return a[Bo+t.length]=l,a.set(this.keys,l),a[Bo+t.length+1]=l+=this.keys.length,a.set(this.bboxes,l),l+=this.bboxes.length,a.buffer};var Gh=Zo(AD);const Yf={};function Ge(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Yf[e]={klass:t,omit:n.omit||[]}}Ge(Object,"Object"),Gh.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},Gh.deserialize=function(t){return new Gh(t.buffer)},Object.defineProperty(Gh,"name",{value:"Grid"}),Ge(Gh,"Grid"),Ge(At,"Color"),Ge(Error,"Error"),Ge(ye,"AJAXError"),Ge(Jo,"ResolvedImage"),Ge(jh,"StylePropertyFunction"),Ge(Sg,"StyleExpression",{omit:["_evaluator"]}),Ge(jl,"ZoomDependentExpression"),Ge(Hf,"ZoomConstantExpression"),Ge(Ko,"CompoundExpression",{omit:["_evaluate"]});for(const t in Tg)Yf[Tg[t]._classRegistryKey]||Ge(Tg[t],`Expression${t}`);function ex(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Xw(t){return ie.ImageBitmap&&t instanceof ie.ImageBitmap}function zt(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ex(t)||Xw(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.add(n.buffer),n}if(t instanceof ie.ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const i of t)n.push(zt(i,e));return n}if(t instanceof Map){const n={$name:"Map"};for(const[i,a]of t.entries())n[i]=zt(a);return n}if("object"==typeof t){const n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);const a=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const l in t)t.hasOwnProperty(l)&&(Yf[i].omit.indexOf(l)>=0||(a[l]=zt(t[l],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(a.$name=i),a}throw new Error("can't serialize object of type "+typeof t)}function Iu(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ex(t)||Xw(t)||ArrayBuffer.isView(t)||t instanceof ie.ImageData)return t;if(Array.isArray(t))return t.map(Iu);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const a=new Map;for(const l of Object.keys(t))"$name"!==l&&a.set(l,Iu(t[l]));return a}const{klass:n}=Yf[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const i=Object.create(n.prototype);for(const a of Object.keys(t))"$name"!==a&&(i[a]=Iu(t[a]));return i}throw new Error("can't deserialize object of type "+typeof t)}const Je={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function tx(t){for(const e of t)if(Rg(e.charCodeAt(0)))return!0;return!1}function PD(t){for(const e of t)if(!RD(e.charCodeAt(0)))return!1;return!0}function RD(t){return!(Je.Arabic(t)||Je["Arabic Supplement"](t)||Je["Arabic Extended-A"](t)||Je["Arabic Presentation Forms-A"](t)||Je["Arabic Presentation Forms-B"](t))}function Rg(t){return!(746!==t&&747!==t&&(t<4352||!(Je["Bopomofo Extended"](t)||Je.Bopomofo(t)||Je["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Je["CJK Compatibility Ideographs"](t)||Je["CJK Compatibility"](t)||Je["CJK Radicals Supplement"](t)||Je["CJK Strokes"](t)||!(!Je["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Je["CJK Unified Ideographs Extension A"](t)||Je["CJK Unified Ideographs"](t)||Je["Enclosed CJK Letters and Months"](t)||Je["Hangul Compatibility Jamo"](t)||Je["Hangul Jamo Extended-A"](t)||Je["Hangul Jamo Extended-B"](t)||Je["Hangul Jamo"](t)||Je["Hangul Syllables"](t)||Je.Hiragana(t)||Je["Ideographic Description Characters"](t)||Je.Kanbun(t)||Je["Kangxi Radicals"](t)||Je["Katakana Phonetic Extensions"](t)||Je.Katakana(t)&&12540!==t||!(!Je["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Je["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Je["Unified Canadian Aboriginal Syllabics"](t)||Je["Unified Canadian Aboriginal Syllabics Extended"](t)||Je["Vertical Forms"](t)||Je["Yijing Hexagram Symbols"](t)||Je["Yi Syllables"](t)||Je["Yi Radicals"](t))))}function Au(t){return!(Rg(t)||(e=t,Je["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Je["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Je["Letterlike Symbols"](e)||Je["Number Forms"](e)||Je["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Je["Control Pictures"](e)&&9251!==e||Je["Optical Character Recognition"](e)||Je["Enclosed Alphanumerics"](e)||Je["Geometric Shapes"](e)||Je["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Je["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Je["CJK Symbols and Punctuation"](e)||Je.Katakana(e)||Je["Private Use Area"](e)||Je["CJK Compatibility Forms"](e)||Je["Small Form Variants"](e)||Je["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function Yw(t){return t>=1424&&t<=2303||Je["Arabic Presentation Forms-A"](t)||Je["Arabic Presentation Forms-B"](t)}function OD(t,e){return!(!e&&Yw(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Je.Khmer(t))}function kD(t){for(const e of t)if(Yw(e.charCodeAt(0)))return!0;return!1}const nx="deferred",rx="loading",Oe="loaded";let Dn=null,es="unavailable",zc=null;const $i=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(es="error"),Dn&&Dn(t)};function Og(){Pu.fire(new Me("pluginStateChange",{pluginStatus:es,pluginURL:zc}))}const Pu=new wr,Xs=function(){return es},kg=function(){if(es!==nx||!zc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");es=rx,Og(),zc&&ke({url:zc},t=>{t?$i(t):(es=Oe,Og())})},ts={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>es===Oe||null!=ts.applyArabicShaping,isLoading:()=>es===rx,setState(t){es=t.pluginStatus,zc=t.pluginURL},isParsed:()=>null!=ts.applyArabicShaping&&null!=ts.processBidirectionalText&&null!=ts.processStyledBidirectionalText,getPluginURL:()=>zc};class tr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,i){for(const a of n)if(!OD(a.charCodeAt(0),i))return!1;return!0}(e,ts.isLoaded())}}class ix{constructor(e,n,i){this.property=e,this.value=n,this.expression=function(a,l,u){if(il(a))return new jh(a,l);if($f(a)||Array.isArray(a)&&a.length>0){const d=Gf(a,l,u);if("error"===d.result)throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=a;return"string"==typeof a&&"color"===l.type&&(d=At.parse(a)),{kind:"constant",isConfigDependent:!1,evaluate:()=>d}}}(void 0===n?e.specification.default:n,e.specification,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,i){return this.property.possiblyEvaluate(this,e,n,i)}}class Lg{constructor(e,n){this.property=e,this.value=new ix(e,void 0,n)}transitioned(e,n){return new ol(this.property,this.value,n,qe({},e.transition,this.transition),e.now)}untransitioned(){return new ol(this.property,this.value,null,{},0)}}class Ai{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return U(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Lg(this._values[e].property,this._options)),this._values[e].value=new ix(this._values[e].property,null===n?void 0:U(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);const i=this._properties.properties;if(e)for(const a in e){const l=e[a];if(Tc(a,"-transition")){const u=a.slice(0,-11);i[u]&&this.setTransition(u,l)}else i[a]&&this.setValue(a,l)}}getTransition(e){return U(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Lg(this._values[e].property)),this._values[e].transition=U(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const i=this.getValue(n);void 0!==i&&(e[n]=i);const a=this.getTransition(n);void 0!==a&&(e[`${n}-transition`]=a)}return e}transitioned(e,n){const i=new ox(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].transitioned(e,n._values[a]);return i}untransitioned(){const e=new ox(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ol{constructor(e,n,i,a,l){const u=a.delay||0,d=a.duration||0;l=l||0,this.property=e,this.value=n,this.begin=l+u,this.end=this.begin+d,e.specification.transition&&(a.delay||a.duration)&&(this.prior=i)}possiblyEvaluate(e,n,i){const a=e.now||0,l=this.value.possiblyEvaluate(e,n,i),u=this.prior;if(u){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return u.possiblyEvaluate(e,n,i);{const d=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(u.possiblyEvaluate(e,n,i),l,Ec(d))}}return l}}class ox{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,i){const a=new Jf(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,n,i);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class qh{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return U(this._values[e].value)}setValue(e,n){this._values[e]=new ix(this._values[e].property,null===n?void 0:U(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const n of Object.keys(this._values)){const i=this.getValue(n);void 0!==i&&(e[n]=i)}return e}possiblyEvaluate(e,n,i){const a=new Jf(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,n,i);return a}}class ns{constructor(e,n,i){this.property=e,this.value=n,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,i,a){return this.property.evaluate(this.value,this.parameters,e,n,i,a)}}class Jf{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ce{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,i){const a=wg[this.specification.type];return a?a(e,n,i):e}}class et{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,i,a){return new ns(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},i,a)}:e.expression,n)}interpolate(e,n,i){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new ns(this,{kind:"constant",value:void 0},e.parameters);const a=wg[this.specification.type];return a?new ns(this,{kind:"constant",value:a(e.value.value,n.value.value,i)},e.parameters):e}evaluate(e,n,i,a,l,u){return"constant"===e.kind?e.value:e.evaluate(n,i,a,l,u)}}class Kf{constructor(e){this.specification=e}possiblyEvaluate(e,n,i,a){return!!e.expression.evaluate(n,null,{},i,a)}interpolate(){return!1}}class nr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new tr(0,{});for(const i in e){const a=e[i];a.specification.overridable&&this.overridableProperties.push(i);const l=this.defaultPropertyValues[i]=new ix(a,void 0),u=this.defaultTransitionablePropertyValues[i]=new Lg(a);this.defaultTransitioningPropertyValues[i]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate(n)}}}function Pi(t,e){return e?`${t}\x1f${e}`:t}function Fg(t){const e=t.indexOf("\x1f");return e>=0?t.slice(0,e):t}Ge(et,"DataDrivenProperty"),Ge(Ce,"DataConstantProperty"),Ge(Kf,"ColorRampProperty");const Ng="-transition";class Ps extends wr{constructor(e,n,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=i,e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new qh(n.layout,i),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Ai(n.paint,i);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Jf(n.paint)}}setScope(e){this.scope=e,this.fqid=Pi(this.id,e)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,i={}){if(null!=n&&this._validate(Hh,`layers.${this.id}.layout.${e}`,e,n,i))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=n);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Tc(e,Ng)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,i={}){if(null!=n&&this._validate(Ww,`layers.${this.id}.paint.${e}`,e,n,i))return!1;const a=this._transitionablePaint,l=a._properties.properties;if(Tc(e,Ng)){const x=e.slice(0,-11);return l[x]&&a.setTransition(x,n||void 0),!1}if(!l[e])return!1;const u=a._values[e],d=u.value.isDataDriven(),f=u.value;a.setValue(e,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const p=a._values[e].value,g=p.isDataDriven(),_=Tc(e,"pattern")||"line-dasharray"===e;return g||d||_||this._handleOverridablePaintPropertyUpdate(e,f,p)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Ie({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(void 0===e||"layout"===n&&!Object.keys(e).length||"paint"===n&&!Object.keys(e).length))}_validate(e,n,i,a,l={}){return(!l||!1!==l.validate)&&Pg(this,e.call(zo,{key:n,layerType:this.type,objectKey:i,value:a,styleSpec:J,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ns&&Fc(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Gy(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class Jw{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(e){const n=e.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(e.id)}removeLayer(e){const n=e.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][e.id]=e,this._updatedLayers[n].delete(e.id),this.updatedPaintProps.delete(e.fqid)}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const n in this._updatedLayers)e[n]=e[n]||{},e[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)e[n]=e[n]||{},e[n].removedIds=Object.keys(this._removedLayers[n]);return e}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const sx={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qf{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function sn(t,e=1){let n=0,i=0;return{members:t.map(a=>{const l=sx[a.type].BYTES_PER_ELEMENT,u=n=ax(n,Math.max(e,l)),d=a.components||1;return i=Math.max(i,l),n+=l*d,{name:a.name,type:a.type,components:d,offset:u}}),size:ax(n,Math.max(i,e)),alignment:e}}function ax(t,e){return Math.ceil(t/e)*e}class Eo extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const a=2*e;return this.int16[a+0]=n,this.int16[a+1]=i,e}}Eo.prototype.bytesPerElement=4,Ge(Eo,"StructArrayLayout2i4");class zg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,i)}emplace(e,n,i,a){const l=3*e;return this.int16[l+0]=n,this.int16[l+1]=i,this.int16[l+2]=a,e}}zg.prototype.bytesPerElement=6,Ge(zg,"StructArrayLayout3i6");class Ru extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const u=4*e;return this.int16[u+0]=n,this.int16[u+1]=i,this.int16[u+2]=a,this.int16[u+3]=l,e}}Ru.prototype.bytesPerElement=8,Ge(Ru,"StructArrayLayout4i8");class ao extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,a,l)}emplace(e,n,i,a,l,u){const d=5*e;return this.int16[d+0]=n,this.int16[d+1]=i,this.int16[d+2]=a,this.int16[d+3]=l,this.int16[d+4]=u,e}}ao.prototype.bytesPerElement=10,Ge(ao,"StructArrayLayout5i10");class Ul extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,a,l,u,d)}emplace(e,n,i,a,l,u,d,f){const p=6*e,g=12*e,_=3*e;return this.int16[p+0]=n,this.int16[p+1]=i,this.uint8[g+4]=a,this.uint8[g+5]=l,this.uint8[g+6]=u,this.uint8[g+7]=d,this.float32[_+2]=f,e}}Ul.prototype.bytesPerElement=12,Ge(Ul,"StructArrayLayout2i4ub1f12");class rr extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const u=4*e;return this.float32[u+0]=n,this.float32[u+1]=i,this.float32[u+2]=a,this.float32[u+3]=l,e}}rr.prototype.bytesPerElement=16,Ge(rr,"StructArrayLayout4f16");class Bc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,a,l)}emplace(e,n,i,a,l,u){const d=6*e,f=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=i,this.uint16[d+2]=a,this.uint16[d+3]=l,this.float32[f+2]=u,e}}Bc.prototype.bytesPerElement=12,Ge(Bc,"StructArrayLayout4ui1f12");class Bg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const u=4*e;return this.uint16[u+0]=n,this.uint16[u+1]=i,this.uint16[u+2]=a,this.uint16[u+3]=l,e}}Bg.prototype.bytesPerElement=8,Ge(Bg,"StructArrayLayout4ui8");class Vg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,i,a,l,u)}emplace(e,n,i,a,l,u,d){const f=6*e;return this.int16[f+0]=n,this.int16[f+1]=i,this.int16[f+2]=a,this.int16[f+3]=l,this.int16[f+4]=u,this.int16[f+5]=d,e}}Vg.prototype.bytesPerElement=12,Ge(Vg,"StructArrayLayout6i12");class lx extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d,f,p,g,_,x){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,i,a,l,u,d,f,p,g,_,x)}emplace(e,n,i,a,l,u,d,f,p,g,_,x,v){const b=12*e;return this.int16[b+0]=n,this.int16[b+1]=i,this.int16[b+2]=a,this.int16[b+3]=l,this.uint16[b+4]=u,this.uint16[b+5]=d,this.uint16[b+6]=f,this.uint16[b+7]=p,this.int16[b+8]=g,this.int16[b+9]=_,this.int16[b+10]=x,this.int16[b+11]=v,e}}lx.prototype.bytesPerElement=24,Ge(lx,"StructArrayLayout4i4ui4i24");class jg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,i,a,l,u)}emplace(e,n,i,a,l,u,d){const f=10*e,p=5*e;return this.int16[f+0]=n,this.int16[f+1]=i,this.int16[f+2]=a,this.float32[p+2]=l,this.float32[p+3]=u,this.float32[p+4]=d,e}}jg.prototype.bytesPerElement=20,Ge(jg,"StructArrayLayout3i3f20");class Ug extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Ug.prototype.bytesPerElement=4,Ge(Ug,"StructArrayLayout1ul4");class ba extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const a=2*e;return this.uint16[a+0]=n,this.uint16[a+1]=i,e}}ba.prototype.bytesPerElement=4,Ge(ba,"StructArrayLayout2ui4");class sl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d,f,p,g,_,x,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,i,a,l,u,d,f,p,g,_,x,v)}emplace(e,n,i,a,l,u,d,f,p,g,_,x,v,b){const E=20*e,C=10*e;return this.int16[E+0]=n,this.int16[E+1]=i,this.int16[E+2]=a,this.int16[E+3]=l,this.int16[E+4]=u,this.float32[C+3]=d,this.float32[C+4]=f,this.float32[C+5]=p,this.float32[C+6]=g,this.int16[E+14]=_,this.uint32[C+8]=x,this.uint16[E+18]=v,this.uint16[E+19]=b,e}}sl.prototype.bytesPerElement=40,Ge(sl,"StructArrayLayout5i4f1i1ul2ui40");class $g extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,a,l,u,d)}emplace(e,n,i,a,l,u,d,f){const p=8*e;return this.int16[p+0]=n,this.int16[p+1]=i,this.int16[p+2]=a,this.int16[p+4]=l,this.int16[p+5]=u,this.int16[p+6]=d,this.int16[p+7]=f,e}}$g.prototype.bytesPerElement=16,Ge($g,"StructArrayLayout3i2i2i16");class Zh extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,a,l)}emplace(e,n,i,a,l,u){const d=4*e,f=8*e;return this.float32[d+0]=n,this.float32[d+1]=i,this.float32[d+2]=a,this.int16[f+6]=l,this.int16[f+7]=u,e}}Zh.prototype.bytesPerElement=16,Ge(Zh,"StructArrayLayout2f1f2i16");class Wh extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const u=12*e,d=3*e;return this.uint8[u+0]=n,this.uint8[u+1]=i,this.float32[d+1]=a,this.float32[d+2]=l,e}}Wh.prototype.bytesPerElement=12,Ge(Wh,"StructArrayLayout2ub2f12");class wa extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,i)}emplace(e,n,i,a){const l=3*e;return this.float32[l+0]=n,this.float32[l+1]=i,this.float32[l+2]=a,e}}wa.prototype.bytesPerElement=12,Ge(wa,"StructArrayLayout3f12");class Rr extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,n,i)}emplace(e,n,i,a){const l=3*e;return this.uint16[l+0]=n,this.uint16[l+1]=i,this.uint16[l+2]=a,e}}Rr.prototype.bytesPerElement=6,Ge(Rr,"StructArrayLayout3ui6");class Hg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D,A,P,I){const R=this.length;return this.resize(R+1),this.emplace(R,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D,A,P,I)}emplace(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D,A,P,I,R){const k=30*e,L=15*e,N=60*e;return this.int16[k+0]=n,this.int16[k+1]=i,this.int16[k+2]=a,this.float32[L+2]=l,this.float32[L+3]=u,this.uint16[k+8]=d,this.uint16[k+9]=f,this.uint32[L+5]=p,this.uint32[L+6]=g,this.uint32[L+7]=_,this.uint16[k+16]=x,this.uint16[k+17]=v,this.uint16[k+18]=b,this.float32[L+10]=E,this.float32[L+11]=C,this.uint8[N+48]=T,this.uint8[N+49]=D,this.uint8[N+50]=A,this.uint32[L+13]=P,this.int16[k+28]=I,this.uint8[N+58]=R,e}}Hg.prototype.bytesPerElement=60,Ge(Hg,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D,A,P,I,R,k,L,N,z,j,B,H,V,Z,Q){const te=this.length;return this.resize(te+1),this.emplace(te,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D,A,P,I,R,k,L,N,z,j,B,H,V,Z,Q)}emplace(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D,A,P,I,R,k,L,N,z,j,B,H,V,Z,Q,te){const W=20*e,X=40*e,re=80*e;return this.float32[W+0]=n,this.float32[W+1]=i,this.int16[X+4]=a,this.int16[X+5]=l,this.int16[X+6]=u,this.int16[X+7]=d,this.int16[X+8]=f,this.int16[X+9]=p,this.int16[X+10]=g,this.int16[X+11]=_,this.int16[X+12]=x,this.uint16[X+13]=v,this.uint16[X+14]=b,this.uint16[X+15]=E,this.uint16[X+16]=C,this.uint16[X+17]=T,this.uint16[X+18]=D,this.uint16[X+19]=A,this.uint16[X+20]=P,this.uint16[X+21]=I,this.uint16[X+22]=R,this.uint16[X+23]=k,this.uint16[X+24]=L,this.uint16[X+25]=N,this.uint16[X+26]=z,this.uint16[X+27]=j,this.uint32[W+14]=B,this.float32[W+15]=H,this.float32[W+16]=V,this.float32[W+17]=Z,this.float32[W+18]=Q,this.uint8[re+76]=te,e}}Gg.prototype.bytesPerElement=80,Ge(Gg,"StructArrayLayout2f9i15ui1ul4f1ub80");class ep extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}ep.prototype.bytesPerElement=4,Ge(ep,"StructArrayLayout1f4");class Ys extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,a,l)}emplace(e,n,i,a,l,u){const d=5*e;return this.float32[d+0]=n,this.float32[d+1]=i,this.float32[d+2]=a,this.float32[d+3]=l,this.float32[d+4]=u,e}}Ys.prototype.bytesPerElement=20,Ge(Ys,"StructArrayLayout5f20");class Ou extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,a,l,u,d)}emplace(e,n,i,a,l,u,d,f){const p=7*e;return this.float32[p+0]=n,this.float32[p+1]=i,this.float32[p+2]=a,this.float32[p+3]=l,this.float32[p+4]=u,this.float32[p+5]=d,this.float32[p+6]=f,e}}Ou.prototype.bytesPerElement=28,Ge(Ou,"StructArrayLayout7f28");class cx extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,a)}emplace(e,n,i,a,l){const u=6*e;return this.uint32[3*e+0]=n,this.uint16[u+2]=i,this.uint16[u+3]=a,this.uint16[u+4]=l,e}}cx.prototype.bytesPerElement=12,Ge(cx,"StructArrayLayout1ul3ui12");class qg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}qg.prototype.bytesPerElement=2,Ge(qg,"StructArrayLayout1ui2");class ku extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){const a=2*e;return this.float32[a+0]=n,this.float32[a+1]=i,e}}ku.prototype.bytesPerElement=8,Ge(ku,"StructArrayLayout2f8");class Kw extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C)}emplace(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T){const D=16*e;return this.float32[D+0]=n,this.float32[D+1]=i,this.float32[D+2]=a,this.float32[D+3]=l,this.float32[D+4]=u,this.float32[D+5]=d,this.float32[D+6]=f,this.float32[D+7]=p,this.float32[D+8]=g,this.float32[D+9]=_,this.float32[D+10]=x,this.float32[D+11]=v,this.float32[D+12]=b,this.float32[D+13]=E,this.float32[D+14]=C,this.float32[D+15]=T,e}}Kw.prototype.bytesPerElement=64,Ge(Kw,"StructArrayLayout16f64");class Zg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,a,l,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,i,a,l,u,d)}emplace(e,n,i,a,l,u,d,f){const p=10*e,g=5*e;return this.uint16[p+0]=n,this.uint16[p+1]=i,this.uint16[p+2]=a,this.uint16[p+3]=l,this.float32[g+2]=u,this.float32[g+3]=d,this.float32[g+4]=f,e}}Zg.prototype.bytesPerElement=20,Ge(Zg,"StructArrayLayout4ui3f20");class ux extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}ux.prototype.bytesPerElement=1,Ge(ux,"StructArrayLayout1ub1");class LD extends Qf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}LD.prototype.size=40;class Qw extends sl{get(e){return new LD(this,e)}}Ge(Qw,"CollisionBoxArray");class Wg extends Qf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wg.prototype.size=60;class Xh extends Hg{get(e){return new Wg(this,e)}}Ge(Xh,"PlacedSymbolArray");class e2 extends Qf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}e2.prototype.size=80;class Yh extends Gg{get(e){return new e2(this,e)}}Ge(Yh,"SymbolInstanceArray");class Xg extends ep{getoffsetX(e){return this.float32[1*e+0]}}Ge(Xg,"GlyphOffsetArray");class tp extends Eo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ge(tp,"SymbolLineVertexArray");class FD extends Qf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}FD.prototype.size=12;class hx extends cx{get(e){return new FD(this,e)}}Ge(hx,"FeatureIndexArray");class dx extends ba{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ge(dx,"FillExtrusionCentroidArray");const ND=sn([{name:"a_pos",components:2,type:"Int16"}],4),al=sn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class bn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,i,a){let l=this.segments[this.segments.length-1];return e>bn.MAX_VERTEX_ARRAY_LENGTH&&K(`Max vertices per segment is ${bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>bn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:n,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==a&&(l.sortKey=a),this.segments.push(l)),l}prepareSegment(e,n,i,a){return this._prepareSegment(e,n.length,i.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,i,a){return new bn([{vertexOffset:e,primitiveOffset:n,vertexLength:i,primitiveLength:a,vaos:{},sortKey:0}])}}function np(t,e){return 256*(t=We(Math.floor(t),0,255))+We(Math.floor(e),0,255)}bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge(bn,"SegmentVector");const fx=sn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),t2=sn([{name:"a_dash",components:4,type:"Uint16"}]);var Lu={exports:{}},zD={exports:function(e,n){var i,a,l,u,d,f,p,g;for(a=e.length-(i=3&e.length),l=n,d=3432918353,f=461845907,g=0;g<a;)p=255&e.charCodeAt(g)|(255&e.charCodeAt(++g))<<8|(255&e.charCodeAt(++g))<<16|(255&e.charCodeAt(++g))<<24,++g,l=27492+(65535&(u=5*(65535&(l=(l^=p=(65535&(p=(p=(65535&p)*d+(((p>>>16)*d&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(p=0,i){case 3:p^=(255&e.charCodeAt(g+2))<<16;case 2:p^=(255&e.charCodeAt(g+1))<<8;case 1:l^=p=(65535&(p=(p=(65535&(p^=255&e.charCodeAt(g)))*d+(((p>>>16)*d&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295}return l^=e.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}}.exports,px={exports:{}};px.exports=function(e,n){for(var i,a=e.length,l=n^a,u=0;a>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24))+((1540483477*(i>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++u;switch(a){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&e.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var mx=zD,n2=px.exports;Lu.exports=mx,Lu.exports.murmur3=mx,Lu.exports.murmur2=n2;var Jg=Zo(Lu.exports);class rp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,i,a){this.ids.push(ip(e)),this.positions.push(n,i,a)}eachPosition(e,n){const i=ip(e);let a=0,l=this.ids.length-1;for(;a<l;){const u=a+l>>1;this.ids[u]>=i?l=u:a=u+1}for(;this.ids[a]===i;)n(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,n){const i=new Float64Array(e.ids),a=new Uint32Array(e.positions);return $l(i,a,0,i.length-1),n&&(n.add(i.buffer),n.add(a.buffer)),{ids:i,positions:a}}static deserialize(e){const n=new rp;let i;n.ids=e.ids,n.positions=e.positions;for(const a of n.ids)a!==i&&n.uniqueIds.push(a),i=a;return n.indexed=!0,n}}function ip(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Jg(String(t))}function $l(t,e,n,i){for(;n<i;){const a=t[n+i>>1];let l=n-1,u=i+1;for(;;){do{l++}while(t[l]<a);do{u--}while(t[u]>a);if(l>=u)break;Kg(t,l,u),Kg(e,3*l,3*u),Kg(e,3*l+1,3*u+1),Kg(e,3*l+2,3*u+2)}u-n<i-u?($l(t,e,n,u),n=u+1):($l(t,e,u+1,i),i=u)}}function Kg(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}Ge(rp,"FeaturePositionMap");class ll{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Lt extends ll{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class ve extends ll{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ut extends ll{constructor(e){super(e),this.current=[0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class st extends ll{constructor(e){super(e),this.current=[0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class rs extends ll{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class ii extends ll{constructor(e){super(e),this.current=At.transparent}set(e,n,i){this.fetchUniformLocation(e,n)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const gx=new Float32Array(16);class wt extends ll{constructor(e){super(e),this.current=gx}set(e,n,i){if(this.fetchUniformLocation(e,n)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let a=1;a<16;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const r2=new Float32Array(9);class op extends ll{constructor(e){super(e),this.current=r2}set(e,n,i){if(this.fetchUniformLocation(e,n))for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}const Jh=new Float32Array(4);class Vc extends ll{constructor(e){super(e),this.current=Jh}set(e,n,i){if(this.fetchUniformLocation(e,n))for(let a=0;a<4;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function jc(t){return[np(255*t.r,255*t.g),np(255*t.b,255*t.a)]}class Kh{constructor(e,n,i){this.value=e,this.uniformNames=n.map(a=>`u_${a}`),this.type=i}setUniform(e,n,i,a,l){n.set(e,l,a.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new ii(e):new ve(e)}}class Uc{constructor(e,n){this.uniformNames=n.map(i=>`u_${i}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,i,a,l){const u="u_pattern"===l||"u_dash"===l?this.pattern:"u_pixel_ratio"===l?this.pixelRatio:null;u&&n.set(e,l,u)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new rs(e):new ve(e)}}class is{constructor(e,n,i,a){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=n.map(l=>({name:`a_${l}`,type:"Float32",components:"color"===i?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,n,i,a,l,u,d){const f=this.paintVertexArray.length,p=this.expression.evaluate(new tr(0,{brightness:u}),n,{},l,a,d);this.paintVertexArray.resize(e),this._setPaintValue(f,e,p)}updatePaintArray(e,n,i,a,l,u,d){const f=this.expression.evaluate({zoom:0,brightness:d},i,a,void 0,l);this._setPaintValue(e,n,f)}_setPaintValue(e,n,i){if("color"===this.type){const a=jc(i);for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,a[0],a[1])}else{for(let a=e;a<n;a++)this.paintVertexArray.emplace(a,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cl{constructor(e,n,i,a,l,u){this.expression=e,this.uniformNames=n.map(d=>`u_${d}_t`),this.type=i,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:"color"===i?4:2,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,i,a,l,u,d){const f=this.expression.evaluate(new tr(this.zoom,{brightness:u}),n,{},l,a,d),p=this.expression.evaluate(new tr(this.zoom+1,{brightness:u}),n,{},l,a,d),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,f,p)}updatePaintArray(e,n,i,a,l,u,d){const f=this.expression.evaluate({zoom:this.zoom,brightness:d},i,a,void 0,l),p=this.expression.evaluate({zoom:this.zoom+1,brightness:d},i,a,void 0,l);this._setPaintValue(e,n,f,p)}_setPaintValue(e,n,i,a){if("color"===this.type){const l=jc(i),u=jc(a);for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,l[0],l[1],u[0],u[1])}else{for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,i,a);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,i,a,l){const u=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,d=We(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);n.set(e,l,d)}getBinding(e,n){return new ve(e)}}class $c{constructor(e,n,i,a,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=("array"===i?t2:fx).members;for(let u=0;u<n.length;++u);this.paintVertexArray=new a}populatePaintArray(e,n,i){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,n.patterns&&n.patterns[this.layerId],i)}updatePaintArray(e,n,i,a,l,u,d){this._setPaintValues(e,n,i.patterns&&i.patterns[this.layerId],u)}_setPaintValues(e,n,i,a){if(!a||!i)return;const l=a[i];if(!l)return;const{tl:u,br:d,pixelRatio:f}=l;for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1],d[0],d[1],f)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qh{constructor(e,n,i=(()=>!0)){this.binders={},this._buffers=[];const a=[];for(const l in e.paint._values){const u=e.paint.get(l);if(!i(l)||!(u instanceof ns&&Fc(u.property.specification)))continue;const d=tR(l,e.type),f=u.value,p=u.property.specification.type,g=!!u.property.useIntegerZoom,_="line-dasharray"===l||l.endsWith("pattern"),x="line-dasharray"===l&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==f.kind||x)if("source"===f.kind||x||_){const v=Nu(l,p,"source");this.binders[l]=_?new $c(f,d,p,v,e.id):new is(f,d,p,v),a.push(`/a_${l}`)}else{const v=Nu(l,p,"composite");this.binders[l]=new cl(f,d,p,g,n,v),a.push(`/z_${l}`)}else this.binders[l]=_?new Uc(f.value,d):new Kh(f.value,d,p),a.push(`/u_${l}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof is||n instanceof cl?n.maxValue:0}populatePaintArrays(e,n,i,a,l,u,d){for(const f in this.binders){const p=this.binders[f];(p instanceof is||p instanceof cl||p instanceof $c)&&p.populatePaintArray(e,n,i,a,l,u,d)}}setConstantPatternPositions(e){for(const n in this.binders){const i=this.binders[n];i instanceof Uc&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,n,i,a,l,u,d,f){let p=!1;const g=Object.keys(e),_=0!==g.length,x=_?g:n.uniqueIds;for(const v in this.binders){const b=this.binders[v];if((b instanceof is||b instanceof cl||b instanceof $c)&&(!0===b.expression.isStateDependent||!1===b.expression.isLightConstant)){const E=l.paint.get(v);b.expression=E.value;for(const C of x){const T=e[C.toString()];n.eachPosition(C,(D,A,P)=>{const I=a.feature(D);b.updatePaintArray(A,P,I,T,u,d,f)})}if(!_)for(const C of i.uniqueIds){const T=e[C.toString()];i.eachPosition(C,(D,A,P)=>{const I=a.feature(D);b.updatePaintArray(A,P,I,T,u,d,f)})}p=!0}}return p}defines(){const e=[];for(const n in this.binders){const i=this.binders[n];(i instanceof Kh||i instanceof Uc)&&e.push(...i.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof is||i instanceof cl||i instanceof $c)for(let a=0;a<i.paintVertexAttributes.length;a++)e.push(i.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof Kh||i instanceof Uc||i instanceof cl)for(const a of i.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Kh||a instanceof Uc||a instanceof cl)for(const l of a.uniformNames)n.push({name:l,property:i,binding:a.getBinding(e,l)})}return n}setUniforms(e,n,i,a,l){for(const{name:u,property:d,binding:f}of i)this.binders[d].setUniform(e,f,l,a.get(d),u)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof is||n instanceof cl||n instanceof $c)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const i=this.binders[n];(i instanceof is||i instanceof cl||i instanceof $c)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof is||n instanceof cl||n instanceof $c)&&n.destroy()}}}class Fu{constructor(e,n,i=(()=>!0)){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Qh(a,n,i);this.needsUpload=!1,this._featureMap=new rp,this._featureMapWithoutIds=new rp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,i,a,l,u,d,f){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,a,l,u,d,f);void 0!==n.id?this._featureMap.add(n.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,i,a,l,u){for(const d of i)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,d,a,l,u||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const eR={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function tR(t,e){return eR[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const nR={"line-pattern":{source:Bc,composite:Bc},"fill-pattern":{source:Bc,composite:Bc},"fill-extrusion-pattern":{source:Bc,composite:Bc},"line-dasharray":{source:Bg,composite:Bg}},rR={color:{source:ku,composite:rr},number:{source:ep,composite:ku}};function Nu(t,e,n){const i=nR[t];return i&&i[n]||rR[e][n]}Ge(Kh,"ConstantBinder"),Ge(Uc,"PatternConstantBinder"),Ge(is,"SourceExpressionBinder"),Ge($c,"PatternCompositeBinder"),Ge(cl,"CompositeExpressionBinder"),Ge(Qh,"ProgramConfiguration",{omit:["_buffers"]}),Ge(Fu,"ProgramConfigurationSet");class Rs{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof _t?new _t(e.lng,e.lat):_t.convert(e),this}setSouthWest(e){return this._sw=e instanceof _t?new _t(e.lng,e.lat):_t.convert(e),this}extend(e){const n=this._sw,i=this._ne;let a,l;if(e instanceof _t)a=e,l=e;else{if(!(e instanceof Rs))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Rs.convert(e)):this.extend(_t.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(_t.convert(e)):this;if(a=e._sw,l=e._ne,!a||!l)return this}return n||i?(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),i.lng=Math.max(l.lng,i.lng),i.lat=Math.max(l.lat,i.lat)):(this._sw=new _t(a.lng,a.lat),this._ne=new _t(l.lng,l.lat)),this}getCenter(){return new _t((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _t(this.getWest(),this.getNorth())}getSouthEast(){return new _t(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:i}=_t.convert(e);let a=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&a}static convert(e){return!e||e instanceof Rs?e:new Rs(e)}}var fi={},yn={};Object.defineProperty(yn,"__esModule",{value:!0}),yn.setMatrixArrayType=function(t){yn.ARRAY_TYPE=ed=t},yn.toRadian=function(t){return t*Js},yn.equals=function(t,e){return Math.abs(t-e)<=i2*Math.max(1,Math.abs(t),Math.abs(e))},yn.RANDOM=yn.ARRAY_TYPE=yn.EPSILON=void 0;var i2=1e-6;yn.EPSILON=i2;var ed=typeof Float32Array<"u"?Float32Array:Array;yn.ARRAY_TYPE=ed;var BD=Math.random;yn.RANDOM=BD;var Js=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Pn={};function Qg(t){return(Qg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.create=function(){var t=new Ea.ARRAY_TYPE(4);return Ea.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Pn.clone=function(t){var e=new Ea.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Pn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Pn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Pn.fromValues=function(t,e,n,i){var a=new Ea.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=i,a},Pn.set=function(t,e,n,i,a){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t},Pn.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Pn.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=n*l-a*i;return u?(t[0]=l*(u=1/u),t[1]=-i*u,t[2]=-a*u,t[3]=n*u,t):null},Pn.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Pn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Pn.multiply=o2,Pn.rotate=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=Math.sin(n),f=Math.cos(n);return t[0]=i*f+l*d,t[1]=a*f+u*d,t[2]=i*-d+l*f,t[3]=a*-d+u*f,t},Pn.scale=function(t,e,n){var i=e[1],a=e[2],l=e[3],u=n[0],d=n[1];return t[0]=e[0]*u,t[1]=i*u,t[2]=a*d,t[3]=l*d,t},Pn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},Pn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Pn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Pn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Pn.LDU=function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},Pn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Pn.subtract=VD,Pn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Pn.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],u=e[0],d=e[1],f=e[2],p=e[3];return Math.abs(n-u)<=Ea.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-d)<=Ea.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-f)<=Ea.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=Ea.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},Pn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Pn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},Pn.sub=Pn.mul=void 0;var Ea=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Qg(t)&&"function"!=typeof t)return{default:t};var n=td(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(yn);function td(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(td=function(i){return i?n:e})(t)}function o2(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=n[0],f=n[1],p=n[2],g=n[3];return t[0]=i*d+l*f,t[1]=a*d+u*f,t[2]=i*p+l*g,t[3]=a*p+u*g,t}function VD(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Pn.mul=o2,Pn.sub=VD;var cr={};function s2(t){return(s2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(cr,"__esModule",{value:!0}),cr.create=function(){var t=new oi.ARRAY_TYPE(6);return oi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},cr.clone=function(t){var e=new oi.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},cr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},cr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},cr.fromValues=function(t,e,n,i,a,l){var u=new oi.ARRAY_TYPE(6);return u[0]=t,u[1]=e,u[2]=n,u[3]=i,u[4]=a,u[5]=l,u},cr.set=function(t,e,n,i,a,l,u){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=l,t[5]=u,t},cr.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=n*l-i*a;return f?(t[0]=l*(f=1/f),t[1]=-i*f,t[2]=-a*f,t[3]=n*f,t[4]=(a*d-l*u)*f,t[5]=(i*u-n*d)*f,t):null},cr.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},cr.multiply=zu,cr.rotate=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=Math.sin(n),g=Math.cos(n);return t[0]=i*g+l*p,t[1]=a*g+u*p,t[2]=i*-p+l*g,t[3]=a*-p+u*g,t[4]=d,t[5]=f,t},cr.scale=function(t,e,n){var i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=n[0],p=n[1];return t[0]=e[0]*f,t[1]=i*f,t[2]=a*p,t[3]=l*p,t[4]=u,t[5]=d,t},cr.translate=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=n[0],g=n[1];return t[0]=i,t[1]=a,t[2]=l,t[3]=u,t[4]=i*p+l*g+d,t[5]=a*p+u*g+f,t},cr.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},cr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},cr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},cr.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},cr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},cr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},cr.subtract=jD,cr.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},cr.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},cr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},cr.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=e[0],p=e[1],g=e[2],_=e[3],x=e[4],v=e[5];return Math.abs(n-f)<=oi.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-p)<=oi.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-g)<=oi.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-_)<=oi.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-x)<=oi.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(d-v)<=oi.EPSILON*Math.max(1,Math.abs(d),Math.abs(v))},cr.sub=cr.mul=void 0;var oi=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==s2(t)&&"function"!=typeof t)return{default:t};var n=e_(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(yn);function e_(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(e_=function(i){return i?n:e})(t)}function zu(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=n[0],g=n[1],_=n[2],x=n[3],v=n[4],b=n[5];return t[0]=i*p+l*g,t[1]=a*p+u*g,t[2]=i*_+l*x,t[3]=a*_+u*x,t[4]=i*v+l*b+d,t[5]=a*v+u*b+f,t}function jD(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}cr.mul=zu,cr.sub=jD;var wn={};function _x(t){return(_x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(wn,"__esModule",{value:!0}),wn.create=function(){var t=new Os.ARRAY_TYPE(9);return Os.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},wn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},wn.clone=function(t){var e=new Os.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},wn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},wn.fromValues=function(t,e,n,i,a,l,u,d,f){var p=new Os.ARRAY_TYPE(9);return p[0]=t,p[1]=e,p[2]=n,p[3]=i,p[4]=a,p[5]=l,p[6]=u,p[7]=d,p[8]=f,p},wn.set=function(t,e,n,i,a,l,u,d,f,p){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=l,t[5]=u,t[6]=d,t[7]=f,t[8]=p,t},wn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},wn.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},wn.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=g*u-d*p,x=-g*l+d*f,v=p*l-u*f,b=n*_+i*x+a*v;return b?(t[0]=_*(b=1/b),t[1]=(-g*i+a*p)*b,t[2]=(d*i-a*u)*b,t[3]=x*b,t[4]=(g*n-a*f)*b,t[5]=(-d*n+a*l)*b,t[6]=v*b,t[7]=(-p*n+i*f)*b,t[8]=(u*n-i*l)*b,t):null},wn.adjoint=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8];return t[0]=u*g-d*p,t[1]=a*p-i*g,t[2]=i*d-a*u,t[3]=d*f-l*g,t[4]=n*g-a*f,t[5]=a*l-n*d,t[6]=l*p-u*f,t[7]=i*f-n*p,t[8]=n*u-i*l,t},wn.determinant=function(t){var e=t[3],n=t[4],i=t[5],a=t[6],l=t[7],u=t[8];return t[0]*(u*n-i*l)+t[1]*(-u*e+i*a)+t[2]*(l*e-n*a)},wn.multiply=l2,wn.translate=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],x=n[0],v=n[1];return t[0]=i,t[1]=a,t[2]=l,t[3]=u,t[4]=d,t[5]=f,t[6]=x*i+v*u+p,t[7]=x*a+v*d+g,t[8]=x*l+v*f+_,t},wn.rotate=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],x=Math.sin(n),v=Math.cos(n);return t[0]=v*i+x*u,t[1]=v*a+x*d,t[2]=v*l+x*f,t[3]=v*u-x*i,t[4]=v*d-x*a,t[5]=v*f-x*l,t[6]=p,t[7]=g,t[8]=_,t},wn.scale=function(t,e,n){var i=n[0],a=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},wn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},wn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},wn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},wn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},wn.fromQuat=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=n+n,d=i+i,f=a+a,p=n*u,g=i*u,_=i*d,x=a*u,v=a*d,b=a*f,E=l*u,C=l*d,T=l*f;return t[0]=1-_-b,t[3]=g-T,t[6]=x+C,t[1]=g+T,t[4]=1-p-b,t[7]=v-E,t[2]=x-C,t[5]=v+E,t[8]=1-p-_,t},wn.normalFromMat4=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=e[9],x=e[10],v=e[11],b=e[12],E=e[13],C=e[14],T=e[15],D=n*d-i*u,A=n*f-a*u,P=n*p-l*u,I=i*f-a*d,R=i*p-l*d,k=a*p-l*f,L=g*E-_*b,N=g*C-x*b,z=g*T-v*b,j=_*C-x*E,B=_*T-v*E,H=x*T-v*C,V=D*H-A*B+P*j+I*z-R*N+k*L;return V?(t[0]=(d*H-f*B+p*j)*(V=1/V),t[1]=(f*z-u*H-p*N)*V,t[2]=(u*B-d*z+p*L)*V,t[3]=(a*B-i*H-l*j)*V,t[4]=(n*H-a*z+l*N)*V,t[5]=(i*z-n*B-l*L)*V,t[6]=(E*k-C*R+T*I)*V,t[7]=(C*P-b*k-T*A)*V,t[8]=(b*R-E*P+T*D)*V,t):null},wn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},wn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},wn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},wn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},wn.subtract=c2,wn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},wn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},wn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},wn.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=e[0],x=e[1],v=e[2],b=e[3],E=e[4],C=e[5],T=e[6],D=e[7],A=e[8];return Math.abs(n-_)<=Os.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-x)<=Os.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-v)<=Os.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=Os.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-E)<=Os.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-C)<=Os.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(f-T)<=Os.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(p-D)<=Os.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(g-A)<=Os.EPSILON*Math.max(1,Math.abs(g),Math.abs(A))},wn.sub=wn.mul=void 0;var Os=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==_x(t)&&"function"!=typeof t)return{default:t};var n=a2(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(yn);function a2(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(a2=function(i){return i?n:e})(t)}function l2(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],x=n[0],v=n[1],b=n[2],E=n[3],C=n[4],T=n[5],D=n[6],A=n[7],P=n[8];return t[0]=x*i+v*u+b*p,t[1]=x*a+v*d+b*g,t[2]=x*l+v*f+b*_,t[3]=E*i+C*u+T*p,t[4]=E*a+C*d+T*g,t[5]=E*l+C*f+T*_,t[6]=D*i+A*u+P*p,t[7]=D*a+A*d+P*g,t[8]=D*l+A*f+P*_,t}function c2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}wn.mul=l2,wn.sub=c2;var Dt={};function sp(t){return(sp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.create=function(){var t=new ir.ARRAY_TYPE(16);return ir.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Dt.clone=function(t){var e=new ir.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Dt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Dt.fromValues=function(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E){var C=new ir.ARRAY_TYPE(16);return C[0]=t,C[1]=e,C[2]=n,C[3]=i,C[4]=a,C[5]=l,C[6]=u,C[7]=d,C[8]=f,C[9]=p,C[10]=g,C[11]=_,C[12]=x,C[13]=v,C[14]=b,C[15]=E,C},Dt.set=function(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=l,t[5]=u,t[6]=d,t[7]=f,t[8]=p,t[9]=g,t[10]=_,t[11]=x,t[12]=v,t[13]=b,t[14]=E,t[15]=C,t},Dt.identity=ap,Dt.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],a=e[3],l=e[6],u=e[7],d=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=l,t[11]=e[14],t[12]=a,t[13]=u,t[14]=d}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Dt.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=e[9],x=e[10],v=e[11],b=e[12],E=e[13],C=e[14],T=e[15],D=n*d-i*u,A=n*f-a*u,P=n*p-l*u,I=i*f-a*d,R=i*p-l*d,k=a*p-l*f,L=g*E-_*b,N=g*C-x*b,z=g*T-v*b,j=_*C-x*E,B=_*T-v*E,H=x*T-v*C,V=D*H-A*B+P*j+I*z-R*N+k*L;return V?(t[0]=(d*H-f*B+p*j)*(V=1/V),t[1]=(a*B-i*H-l*j)*V,t[2]=(E*k-C*R+T*I)*V,t[3]=(x*R-_*k-v*I)*V,t[4]=(f*z-u*H-p*N)*V,t[5]=(n*H-a*z+l*N)*V,t[6]=(C*P-b*k-T*A)*V,t[7]=(g*k-x*P+v*A)*V,t[8]=(u*B-d*z+p*L)*V,t[9]=(i*z-n*B-l*L)*V,t[10]=(b*R-E*P+T*D)*V,t[11]=(_*P-g*R-v*D)*V,t[12]=(d*N-u*j-f*L)*V,t[13]=(n*j-i*N+a*L)*V,t[14]=(E*A-b*I-C*D)*V,t[15]=(g*I-_*A+x*D)*V,t):null},Dt.adjoint=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=e[9],x=e[10],v=e[11],b=e[12],E=e[13],C=e[14],T=e[15];return t[0]=d*(x*T-v*C)-_*(f*T-p*C)+E*(f*v-p*x),t[1]=-(i*(x*T-v*C)-_*(a*T-l*C)+E*(a*v-l*x)),t[2]=i*(f*T-p*C)-d*(a*T-l*C)+E*(a*p-l*f),t[3]=-(i*(f*v-p*x)-d*(a*v-l*x)+_*(a*p-l*f)),t[4]=-(u*(x*T-v*C)-g*(f*T-p*C)+b*(f*v-p*x)),t[5]=n*(x*T-v*C)-g*(a*T-l*C)+b*(a*v-l*x),t[6]=-(n*(f*T-p*C)-u*(a*T-l*C)+b*(a*p-l*f)),t[7]=n*(f*v-p*x)-u*(a*v-l*x)+g*(a*p-l*f),t[8]=u*(_*T-v*E)-g*(d*T-p*E)+b*(d*v-p*_),t[9]=-(n*(_*T-v*E)-g*(i*T-l*E)+b*(i*v-l*_)),t[10]=n*(d*T-p*E)-u*(i*T-l*E)+b*(i*p-l*d),t[11]=-(n*(d*v-p*_)-u*(i*v-l*_)+g*(i*p-l*d)),t[12]=-(u*(_*C-x*E)-g*(d*C-f*E)+b*(d*x-f*_)),t[13]=n*(_*C-x*E)-g*(i*C-a*E)+b*(i*x-a*_),t[14]=-(n*(d*C-f*E)-u*(i*C-a*E)+b*(i*f-a*d)),t[15]=n*(d*x-f*_)-u*(i*x-a*_)+g*(i*f-a*d),t},Dt.determinant=function(t){var e=t[0],n=t[1],i=t[2],a=t[3],l=t[4],u=t[5],d=t[6],f=t[7],p=t[8],g=t[9],_=t[10],x=t[11],v=t[12],b=t[13],E=t[14],C=t[15];return(e*u-n*l)*(_*C-x*E)-(e*d-i*l)*(g*C-x*b)+(e*f-a*l)*(g*E-_*b)+(n*d-i*u)*(p*C-x*v)-(n*f-a*u)*(p*E-_*v)+(i*f-a*d)*(p*b-g*v)},Dt.multiply=h2,Dt.translate=function(t,e,n){var i,a,l,u,d,f,p,g,_,x,v,b,E=n[0],C=n[1],T=n[2];return e===t?(t[12]=e[0]*E+e[4]*C+e[8]*T+e[12],t[13]=e[1]*E+e[5]*C+e[9]*T+e[13],t[14]=e[2]*E+e[6]*C+e[10]*T+e[14],t[15]=e[3]*E+e[7]*C+e[11]*T+e[15]):(a=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],x=e[9],v=e[10],b=e[11],t[0]=i=e[0],t[1]=a,t[2]=l,t[3]=u,t[4]=d,t[5]=f,t[6]=p,t[7]=g,t[8]=_,t[9]=x,t[10]=v,t[11]=b,t[12]=i*E+d*C+_*T+e[12],t[13]=a*E+f*C+x*T+e[13],t[14]=l*E+p*C+v*T+e[14],t[15]=u*E+g*C+b*T+e[15]),t},Dt.scale=function(t,e,n){var i=n[0],a=n[1],l=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Dt.rotate=function(t,e,n,i){var a,l,u,d,f,p,g,_,x,v,b,E,C,T,D,A,P,I,R,k,L,N,z,j,B=i[0],H=i[1],V=i[2],Z=Math.hypot(B,H,V);return Z<ir.EPSILON?null:(B*=Z=1/Z,H*=Z,V*=Z,a=Math.sin(n),l=Math.cos(n),f=e[1],p=e[2],g=e[3],x=e[5],v=e[6],b=e[7],C=e[9],T=e[10],D=e[11],R=B*H*(u=1-l)-V*a,k=H*H*u+l,L=V*H*u+B*a,N=B*V*u+H*a,z=H*V*u-B*a,j=V*V*u+l,t[0]=(d=e[0])*(A=B*B*u+l)+(_=e[4])*(P=H*B*u+V*a)+(E=e[8])*(I=V*B*u-H*a),t[1]=f*A+x*P+C*I,t[2]=p*A+v*P+T*I,t[3]=g*A+b*P+D*I,t[4]=d*R+_*k+E*L,t[5]=f*R+x*k+C*L,t[6]=p*R+v*k+T*L,t[7]=g*R+b*k+D*L,t[8]=d*N+_*z+E*j,t[9]=f*N+x*z+C*j,t[10]=p*N+v*z+T*j,t[11]=g*N+b*z+D*j,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Dt.rotateX=function(t,e,n){var i=Math.sin(n),a=Math.cos(n),l=e[4],u=e[5],d=e[6],f=e[7],p=e[8],g=e[9],_=e[10],x=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*a+p*i,t[5]=u*a+g*i,t[6]=d*a+_*i,t[7]=f*a+x*i,t[8]=p*a-l*i,t[9]=g*a-u*i,t[10]=_*a-d*i,t[11]=x*a-f*i,t},Dt.rotateY=function(t,e,n){var i=Math.sin(n),a=Math.cos(n),l=e[0],u=e[1],d=e[2],f=e[3],p=e[8],g=e[9],_=e[10],x=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a-p*i,t[1]=u*a-g*i,t[2]=d*a-_*i,t[3]=f*a-x*i,t[8]=l*i+p*a,t[9]=u*i+g*a,t[10]=d*i+_*a,t[11]=f*i+x*a,t},Dt.rotateZ=function(t,e,n){var i=Math.sin(n),a=Math.cos(n),l=e[0],u=e[1],d=e[2],f=e[3],p=e[4],g=e[5],_=e[6],x=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a+p*i,t[1]=u*a+g*i,t[2]=d*a+_*i,t[3]=f*a+x*i,t[4]=p*a-l*i,t[5]=g*a-u*i,t[6]=_*a-d*i,t[7]=x*a-f*i,t},Dt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Dt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.fromRotation=function(t,e,n){var i,a,l,u=n[0],d=n[1],f=n[2],p=Math.hypot(u,d,f);return p<ir.EPSILON?null:(u*=p=1/p,d*=p,f*=p,i=Math.sin(e),a=Math.cos(e),t[0]=u*u*(l=1-a)+a,t[1]=d*u*l+f*i,t[2]=f*u*l-d*i,t[3]=0,t[4]=u*d*l-f*i,t[5]=d*d*l+a,t[6]=f*d*l+u*i,t[7]=0,t[8]=u*f*l+d*i,t[9]=d*f*l-u*i,t[10]=f*f*l+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Dt.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.fromRotationTranslation=lp,Dt.fromQuat2=function(t,e){var n=new ir.ARRAY_TYPE(3),i=-e[0],a=-e[1],l=-e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=i*i+a*a+l*l+u*u;return _>0?(n[0]=2*(d*u+g*i+f*l-p*a)/_,n[1]=2*(f*u+g*a+p*i-d*l)/_,n[2]=2*(p*u+g*l+d*a-f*i)/_):(n[0]=2*(d*u+g*i+f*l-p*a),n[1]=2*(f*u+g*a+p*i-d*l),n[2]=2*(p*u+g*l+d*a-f*i)),lp(t,e,n),t},Dt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Dt.getScaling=d2,Dt.getRotation=function(t,e){var n=new ir.ARRAY_TYPE(3);d2(n,e);var i=1/n[0],a=1/n[1],l=1/n[2],u=e[0]*i,d=e[1]*a,f=e[2]*l,p=e[4]*i,g=e[5]*a,_=e[6]*l,x=e[8]*i,v=e[9]*a,b=e[10]*l,E=u+g+b,C=0;return E>0?(C=2*Math.sqrt(E+1),t[3]=.25*C,t[0]=(_-v)/C,t[1]=(x-f)/C,t[2]=(d-p)/C):u>g&&u>b?(C=2*Math.sqrt(1+u-g-b),t[3]=(_-v)/C,t[0]=.25*C,t[1]=(d+p)/C,t[2]=(x+f)/C):g>b?(C=2*Math.sqrt(1+g-u-b),t[3]=(x-f)/C,t[0]=(d+p)/C,t[1]=.25*C,t[2]=(_+v)/C):(C=2*Math.sqrt(1+b-u-g),t[3]=(d-p)/C,t[0]=(x+f)/C,t[1]=(_+v)/C,t[2]=.25*C),t},Dt.fromRotationTranslationScale=function(t,e,n,i){var a=e[0],l=e[1],u=e[2],d=e[3],f=a+a,p=l+l,g=u+u,_=a*f,x=a*p,v=a*g,b=l*p,E=l*g,C=u*g,T=d*f,D=d*p,A=d*g,P=i[0],I=i[1],R=i[2];return t[0]=(1-(b+C))*P,t[1]=(x+A)*P,t[2]=(v-D)*P,t[3]=0,t[4]=(x-A)*I,t[5]=(1-(_+C))*I,t[6]=(E+T)*I,t[7]=0,t[8]=(v+D)*R,t[9]=(E-T)*R,t[10]=(1-(_+b))*R,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Dt.fromRotationTranslationScaleOrigin=function(t,e,n,i,a){var l=e[0],u=e[1],d=e[2],f=e[3],p=l+l,g=u+u,_=d+d,x=l*p,v=l*g,b=l*_,E=u*g,C=u*_,T=d*_,D=f*p,A=f*g,P=f*_,I=i[0],R=i[1],k=i[2],L=a[0],N=a[1],z=a[2],j=(1-(E+T))*I,B=(v+P)*I,H=(b-A)*I,V=(v-P)*R,Z=(1-(x+T))*R,Q=(C+D)*R,te=(b+A)*k,W=(C-D)*k,X=(1-(x+E))*k;return t[0]=j,t[1]=B,t[2]=H,t[3]=0,t[4]=V,t[5]=Z,t[6]=Q,t[7]=0,t[8]=te,t[9]=W,t[10]=X,t[11]=0,t[12]=n[0]+L-(j*L+V*N+te*z),t[13]=n[1]+N-(B*L+Z*N+W*z),t[14]=n[2]+z-(H*L+Q*N+X*z),t[15]=1,t},Dt.fromQuat=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=n+n,d=i+i,f=a+a,p=n*u,g=i*u,_=i*d,x=a*u,v=a*d,b=a*f,E=l*u,C=l*d,T=l*f;return t[0]=1-_-b,t[1]=g+T,t[2]=x-C,t[3]=0,t[4]=g-T,t[5]=1-p-b,t[6]=v+E,t[7]=0,t[8]=x+C,t[9]=v-E,t[10]=1-p-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.frustum=function(t,e,n,i,a,l,u){var d=1/(n-e),f=1/(a-i),p=1/(l-u);return t[0]=2*l*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l*f,t[6]=0,t[7]=0,t[8]=(n+e)*d,t[9]=(a+i)*f,t[10]=(u+l)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=u*l*2*p,t[15]=0,t},Dt.perspectiveNO=yx,Dt.perspectiveZO=function(t,e,n,i,a){var l,u=1/Math.tan(e/2);return t[0]=u/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(t[10]=a*(l=1/(i-a)),t[14]=a*i*l):(t[10]=-1,t[14]=-i),t},Dt.perspectiveFromFieldOfView=function(t,e,n,i){var a=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),u=Math.tan(e.leftDegrees*Math.PI/180),d=Math.tan(e.rightDegrees*Math.PI/180),f=2/(u+d),p=2/(a+l);return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=-(u-d)*f*.5,t[9]=(a-l)*p*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},Dt.orthoNO=t_,Dt.orthoZO=function(t,e,n,i,a,l,u){var d=1/(e-n),f=1/(i-a),p=1/(l-u);return t[0]=-2*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=p,t[11]=0,t[12]=(e+n)*d,t[13]=(a+i)*f,t[14]=l*p,t[15]=1,t},Dt.lookAt=function(t,e,n,i){var a,l,u,d,f,p,g,_,x,v,b=e[0],E=e[1],C=e[2],T=i[0],D=i[1],A=i[2],P=n[0],I=n[1],R=n[2];return Math.abs(b-P)<ir.EPSILON&&Math.abs(E-I)<ir.EPSILON&&Math.abs(C-R)<ir.EPSILON?ap(t):(g=b-P,_=E-I,x=C-R,a=D*(x*=v=1/Math.hypot(g,_,x))-A*(_*=v),l=A*(g*=v)-T*x,u=T*_-D*g,(v=Math.hypot(a,l,u))?(a*=v=1/v,l*=v,u*=v):(a=0,l=0,u=0),d=_*u-x*l,f=x*a-g*u,p=g*l-_*a,(v=Math.hypot(d,f,p))?(d*=v=1/v,f*=v,p*=v):(d=0,f=0,p=0),t[0]=a,t[1]=d,t[2]=g,t[3]=0,t[4]=l,t[5]=f,t[6]=_,t[7]=0,t[8]=u,t[9]=p,t[10]=x,t[11]=0,t[12]=-(a*b+l*E+u*C),t[13]=-(d*b+f*E+p*C),t[14]=-(g*b+_*E+x*C),t[15]=1,t)},Dt.targetTo=function(t,e,n,i){var a=e[0],l=e[1],u=e[2],d=i[0],f=i[1],p=i[2],g=a-n[0],_=l-n[1],x=u-n[2],v=g*g+_*_+x*x;v>0&&(g*=v=1/Math.sqrt(v),_*=v,x*=v);var b=f*x-p*_,E=p*g-d*x,C=d*_-f*g;return(v=b*b+E*E+C*C)>0&&(b*=v=1/Math.sqrt(v),E*=v,C*=v),t[0]=b,t[1]=E,t[2]=C,t[3]=0,t[4]=_*C-x*E,t[5]=x*b-g*C,t[6]=g*E-_*b,t[7]=0,t[8]=g,t[9]=_,t[10]=x,t[11]=0,t[12]=a,t[13]=l,t[14]=u,t[15]=1,t},Dt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Dt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Dt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Dt.subtract=cp,Dt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Dt.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},Dt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Dt.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=t[9],x=t[10],v=t[11],b=t[12],E=t[13],C=t[14],T=t[15],D=e[0],A=e[1],P=e[2],I=e[3],R=e[4],k=e[5],L=e[6],N=e[7],z=e[8],j=e[9],B=e[10],H=e[11],V=e[12],Z=e[13],Q=e[14],te=e[15];return Math.abs(n-D)<=ir.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(i-A)<=ir.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(a-P)<=ir.EPSILON*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(l-I)<=ir.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(u-R)<=ir.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-k)<=ir.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(f-L)<=ir.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(p-N)<=ir.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(g-z)<=ir.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(_-j)<=ir.EPSILON*Math.max(1,Math.abs(_),Math.abs(j))&&Math.abs(x-B)<=ir.EPSILON*Math.max(1,Math.abs(x),Math.abs(B))&&Math.abs(v-H)<=ir.EPSILON*Math.max(1,Math.abs(v),Math.abs(H))&&Math.abs(b-V)<=ir.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(E-Z)<=ir.EPSILON*Math.max(1,Math.abs(E),Math.abs(Z))&&Math.abs(C-Q)<=ir.EPSILON*Math.max(1,Math.abs(C),Math.abs(Q))&&Math.abs(T-te)<=ir.EPSILON*Math.max(1,Math.abs(T),Math.abs(te))},Dt.sub=Dt.mul=Dt.ortho=Dt.perspective=void 0;var ir=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==sp(t)&&"function"!=typeof t)return{default:t};var n=u2(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(yn);function u2(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(u2=function(i){return i?n:e})(t)}function ap(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h2(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],x=e[9],v=e[10],b=e[11],E=e[12],C=e[13],T=e[14],D=e[15],A=n[0],P=n[1],I=n[2],R=n[3];return t[0]=A*i+P*d+I*_+R*E,t[1]=A*a+P*f+I*x+R*C,t[2]=A*l+P*p+I*v+R*T,t[3]=A*u+P*g+I*b+R*D,t[4]=(A=n[4])*i+(P=n[5])*d+(I=n[6])*_+(R=n[7])*E,t[5]=A*a+P*f+I*x+R*C,t[6]=A*l+P*p+I*v+R*T,t[7]=A*u+P*g+I*b+R*D,t[8]=(A=n[8])*i+(P=n[9])*d+(I=n[10])*_+(R=n[11])*E,t[9]=A*a+P*f+I*x+R*C,t[10]=A*l+P*p+I*v+R*T,t[11]=A*u+P*g+I*b+R*D,t[12]=(A=n[12])*i+(P=n[13])*d+(I=n[14])*_+(R=n[15])*E,t[13]=A*a+P*f+I*x+R*C,t[14]=A*l+P*p+I*v+R*T,t[15]=A*u+P*g+I*b+R*D,t}function lp(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=i+i,f=a+a,p=l+l,g=i*d,_=i*f,x=i*p,v=a*f,b=a*p,E=l*p,C=u*d,T=u*f,D=u*p;return t[0]=1-(v+E),t[1]=_+D,t[2]=x-T,t[3]=0,t[4]=_-D,t[5]=1-(g+E),t[6]=b+C,t[7]=0,t[8]=x+T,t[9]=b-C,t[10]=1-(g+v),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function d2(t,e){var n=e[4],i=e[5],a=e[6],l=e[8],u=e[9],d=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,i,a),t[2]=Math.hypot(l,u,d),t}function yx(t,e,n,i,a){var l,u=1/Math.tan(e/2);return t[0]=u/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(t[10]=(a+i)*(l=1/(i-a)),t[14]=2*a*i*l):(t[10]=-1,t[14]=-2*i),t}function t_(t,e,n,i,a,l,u){var d=1/(e-n),f=1/(i-a),p=1/(l-u);return t[0]=-2*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+n)*d,t[13]=(a+i)*f,t[14]=(u+l)*p,t[15]=1,t}function cp(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Dt.perspective=yx,Dt.ortho=t_,Dt.mul=h2,Dt.sub=cp;var xt={},Mt={};function xx(t){return(xx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=f2,Mt.clone=function(t){var e=new os.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Mt.length=UD,Mt.fromValues=function(t,e,n){var i=new os.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=n,i},Mt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Mt.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},Mt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Mt.subtract=vx,Mt.multiply=p2,Mt.divide=$D,Mt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Mt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Mt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Mt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Mt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Mt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Mt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},Mt.distance=m2,Mt.squaredDistance=g2,Mt.squaredLength=_2,Mt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Mt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Mt.normalize=function(t,e){var n=e[0],i=e[1],a=e[2],l=n*n+i*i+a*a;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t},Mt.dot=up,Mt.cross=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=n[0],d=n[1],f=n[2];return t[0]=a*f-l*d,t[1]=l*u-i*f,t[2]=i*d-a*u,t},Mt.lerp=function(t,e,n,i){var a=e[0],l=e[1],u=e[2];return t[0]=a+i*(n[0]-a),t[1]=l+i*(n[1]-l),t[2]=u+i*(n[2]-u),t},Mt.hermite=function(t,e,n,i,a,l){var u=l*l,d=u*(2*l-3)+1,f=u*(l-2)+l,p=u*(l-1),g=u*(3-2*l);return t[0]=e[0]*d+n[0]*f+i[0]*p+a[0]*g,t[1]=e[1]*d+n[1]*f+i[1]*p+a[1]*g,t[2]=e[2]*d+n[2]*f+i[2]*p+a[2]*g,t},Mt.bezier=function(t,e,n,i,a,l){var u=1-l,d=u*u,f=l*l,p=d*u,g=3*l*d,_=3*f*u,x=f*l;return t[0]=e[0]*p+n[0]*g+i[0]*_+a[0]*x,t[1]=e[1]*p+n[1]*g+i[1]*_+a[1]*x,t[2]=e[2]*p+n[2]*g+i[2]*_+a[2]*x,t},Mt.random=function(t,e){e=e||1;var n=2*os.RANDOM()*Math.PI,i=2*os.RANDOM()-1,a=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=i*e,t},Mt.transformMat4=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=n[3]*i+n[7]*a+n[11]*l+n[15];return t[0]=(n[0]*i+n[4]*a+n[8]*l+n[12])/(u=u||1),t[1]=(n[1]*i+n[5]*a+n[9]*l+n[13])/u,t[2]=(n[2]*i+n[6]*a+n[10]*l+n[14])/u,t},Mt.transformMat3=function(t,e,n){var i=e[0],a=e[1],l=e[2];return t[0]=i*n[0]+a*n[3]+l*n[6],t[1]=i*n[1]+a*n[4]+l*n[7],t[2]=i*n[2]+a*n[5]+l*n[8],t},Mt.transformQuat=function(t,e,n){var i=n[0],a=n[1],l=n[2],u=e[0],d=e[1],f=e[2],p=a*f-l*d,g=l*u-i*f,_=i*d-a*u,x=a*_-l*g,v=l*p-i*_,b=i*g-a*p,E=2*n[3];return g*=E,_*=E,v*=2,b*=2,t[0]=u+(p*=E)+(x*=2),t[1]=d+g+v,t[2]=f+_+b,t},Mt.rotateX=function(t,e,n,i){var a=[],l=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],l[0]=a[0],l[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),l[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Mt.rotateY=function(t,e,n,i){var a=[],l=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],l[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),l[1]=a[1],l[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Mt.rotateZ=function(t,e,n,i){var a=[],l=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],l[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),l[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),l[2]=a[2],t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},Mt.angle=function(t,e){var n=t[0],i=t[1],a=t[2],l=e[0],u=e[1],d=e[2],f=Math.sqrt(n*n+i*i+a*a)*Math.sqrt(l*l+u*u+d*d),p=f&&up(t,e)/f;return Math.acos(Math.min(Math.max(p,-1),1))},Mt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Mt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Mt.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=e[0],u=e[1],d=e[2];return Math.abs(n-l)<=os.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-u)<=os.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-d)<=os.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},Mt.forEach=Mt.sqrLen=Mt.len=Mt.sqrDist=Mt.dist=Mt.div=Mt.mul=Mt.sub=void 0;var os=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==xx(t)&&"function"!=typeof t)return{default:t};var n=nd(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(yn);function nd(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(nd=function(i){return i?n:e})(t)}function f2(){var t=new os.ARRAY_TYPE(3);return os.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function UD(t){return Math.hypot(t[0],t[1],t[2])}function vx(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function p2(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function $D(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function m2(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function g2(t,e){var n=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2];return n*n+i*i+a*a}function _2(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function up(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Mt.sub=vx,Mt.mul=p2,Mt.div=$D,Mt.dist=m2,Mt.sqrDist=g2,Mt.len=UD,Mt.sqrLen=_2;var ul,HD=(ul=f2(),function(t,e,n,i,a,l){var u,d;for(e||(e=3),n||(n=0),d=i?Math.min(i*e+n,t.length):t.length,u=n;u<d;u+=e)ul[0]=t[u],ul[1]=t[u+1],ul[2]=t[u+2],a(ul,ul,l),t[u]=ul[0],t[u+1]=ul[1],t[u+2]=ul[2];return t});Mt.forEach=HD;var Bt={};function y2(t){return(y2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.create=x2,Bt.clone=function(t){var e=new ks.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Bt.fromValues=function(t,e,n,i){var a=new ks.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=i,a},Bt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Bt.set=function(t,e,n,i,a){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t},Bt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Bt.subtract=v2,Bt.multiply=n_,Bt.divide=qD,Bt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Bt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Bt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Bt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Bt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Bt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Bt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},Bt.distance=ZD,Bt.squaredDistance=r_,Bt.length=WD,Bt.squaredLength=XD,Bt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Bt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Bt.normalize=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=n*n+i*i+a*a+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=n*u,t[1]=i*u,t[2]=a*u,t[3]=l*u,t},Bt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Bt.cross=function(t,e,n,i){var a=n[0]*i[1]-n[1]*i[0],l=n[0]*i[2]-n[2]*i[0],u=n[0]*i[3]-n[3]*i[0],d=n[1]*i[2]-n[2]*i[1],f=n[1]*i[3]-n[3]*i[1],p=n[2]*i[3]-n[3]*i[2],g=e[0],_=e[1],x=e[2],v=e[3];return t[0]=_*p-x*f+v*d,t[1]=-g*p+x*u-v*l,t[2]=g*f-_*u+v*a,t[3]=-g*d+_*l-x*a,t},Bt.lerp=function(t,e,n,i){var a=e[0],l=e[1],u=e[2],d=e[3];return t[0]=a+i*(n[0]-a),t[1]=l+i*(n[1]-l),t[2]=u+i*(n[2]-u),t[3]=d+i*(n[3]-d),t},Bt.random=function(t,e){var n,i,a,l,u,d;e=e||1;do{u=(n=2*ks.RANDOM()-1)*n+(i=2*ks.RANDOM()-1)*i}while(u>=1);do{d=(a=2*ks.RANDOM()-1)*a+(l=2*ks.RANDOM()-1)*l}while(d>=1);var f=Math.sqrt((1-u)/d);return t[0]=e*n,t[1]=e*i,t[2]=e*a*f,t[3]=e*l*f,t},Bt.transformMat4=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3];return t[0]=n[0]*i+n[4]*a+n[8]*l+n[12]*u,t[1]=n[1]*i+n[5]*a+n[9]*l+n[13]*u,t[2]=n[2]*i+n[6]*a+n[10]*l+n[14]*u,t[3]=n[3]*i+n[7]*a+n[11]*l+n[15]*u,t},Bt.transformQuat=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=n[0],d=n[1],f=n[2],p=n[3],g=p*i+d*l-f*a,_=p*a+f*i-u*l,x=p*l+u*a-d*i,v=-u*i-d*a-f*l;return t[0]=g*p+v*-u+_*-f-x*-d,t[1]=_*p+v*-d+x*-u-g*-f,t[2]=x*p+v*-f+g*-d-_*-u,t[3]=e[3],t},Bt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Bt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Bt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Bt.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],u=e[0],d=e[1],f=e[2],p=e[3];return Math.abs(n-u)<=ks.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-d)<=ks.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-f)<=ks.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=ks.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},Bt.forEach=Bt.sqrLen=Bt.len=Bt.sqrDist=Bt.dist=Bt.div=Bt.mul=Bt.sub=void 0;var ks=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==y2(t)&&"function"!=typeof t)return{default:t};var n=GD(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(yn);function GD(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(GD=function(i){return i?n:e})(t)}function x2(){var t=new ks.ARRAY_TYPE(4);return ks.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function v2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function n_(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function qD(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function ZD(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function r_(t,e){var n=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2],l=e[3]-t[3];return n*n+i*i+a*a+l*l}function WD(t){return Math.hypot(t[0],t[1],t[2],t[3])}function XD(t){var e=t[0],n=t[1],i=t[2],a=t[3];return e*e+n*n+i*i+a*a}Bt.sub=v2,Bt.mul=n_,Bt.div=qD,Bt.dist=ZD,Bt.sqrDist=r_,Bt.len=WD,Bt.sqrLen=XD;var iR=function(){var t=x2();return function(e,n,i,a,l,u){var d,f;for(n||(n=4),i||(i=0),f=a?Math.min(a*n+i,e.length):e.length,d=i;d<f;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],t[3]=e[d+3],l(t,t,u),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2],e[d+3]=t[3];return e}}();function b2(t){return(b2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Bt.forEach=iR,Object.defineProperty(xt,"__esModule",{value:!0}),xt.create=i_,xt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},xt.setAxisAngle=Bu,xt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>rd.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},xt.getAngle=function(t,e){var n=E2(t,e);return Math.acos(2*n*n-1)},xt.multiply=wx,xt.rotateX=function(t,e,n){n*=.5;var i=e[0],a=e[1],l=e[2],u=e[3],d=Math.sin(n),f=Math.cos(n);return t[0]=i*f+u*d,t[1]=a*f+l*d,t[2]=l*f-a*d,t[3]=u*f-i*d,t},xt.rotateY=function(t,e,n){n*=.5;var i=e[0],a=e[1],l=e[2],u=e[3],d=Math.sin(n),f=Math.cos(n);return t[0]=i*f-l*d,t[1]=a*f+u*d,t[2]=l*f+i*d,t[3]=u*f-a*d,t},xt.rotateZ=function(t,e,n){n*=.5;var i=e[0],a=e[1],l=e[2],u=e[3],d=Math.sin(n),f=Math.cos(n);return t[0]=i*f+a*d,t[1]=a*f-i*d,t[2]=l*f+u*d,t[3]=u*f-l*d,t},xt.calculateW=function(t,e){var n=e[0],i=e[1],a=e[2];return t[0]=n,t[1]=i,t[2]=a,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-a*a)),t},xt.exp=Ex,xt.ln=dp,xt.pow=function(t,e,n){return dp(t,e),w2(t,t,n),Ex(t,t),t},xt.slerp=Vu,xt.random=function(t){var e=rd.RANDOM(),n=rd.RANDOM(),i=rd.RANDOM(),a=Math.sqrt(1-e),l=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*n),t[1]=a*Math.cos(2*Math.PI*n),t[2]=l*Math.sin(2*Math.PI*i),t[3]=l*Math.cos(2*Math.PI*i),t},xt.invert=function(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=n*n+i*i+a*a+l*l,d=u?1/u:0;return t[0]=-n*d,t[1]=-i*d,t[2]=-a*d,t[3]=l*d,t},xt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},xt.fromMat3=Hl,xt.fromEuler=function(t,e,n,i){var a=.5*Math.PI/180;e*=a,n*=a,i*=a;var l=Math.sin(e),u=Math.cos(e),d=Math.sin(n),f=Math.cos(n),p=Math.sin(i),g=Math.cos(i);return t[0]=l*f*g-u*d*p,t[1]=u*d*g+l*f*p,t[2]=u*f*p-l*d*g,t[3]=u*f*g+l*d*p,t},xt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},xt.setAxes=xt.sqlerp=xt.rotationTo=xt.equals=xt.exactEquals=xt.normalize=xt.sqrLen=xt.squaredLength=xt.len=xt.length=xt.lerp=xt.dot=xt.scale=xt.mul=xt.add=xt.set=xt.copy=xt.fromValues=xt.clone=void 0;var rd=hp(yn),YD=hp(wn),Ks=hp(Mt),Mo=hp(Bt);function bx(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(bx=function(i){return i?n:e})(t)}function hp(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==b2(t)&&"function"!=typeof t)return{default:t};var n=bx(e);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}function i_(){var t=new rd.ARRAY_TYPE(4);return rd.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Bu(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function wx(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=n[0],f=n[1],p=n[2],g=n[3];return t[0]=i*g+u*d+a*p-l*f,t[1]=a*g+u*f+l*d-i*p,t[2]=l*g+u*p+i*f-a*d,t[3]=u*g-i*d-a*f-l*p,t}function Ex(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=Math.sqrt(n*n+i*i+a*a),d=Math.exp(l),f=u>0?d*Math.sin(u)/u:0;return t[0]=n*f,t[1]=i*f,t[2]=a*f,t[3]=d*Math.cos(u),t}function dp(t,e){var n=e[0],i=e[1],a=e[2],l=e[3],u=Math.sqrt(n*n+i*i+a*a),d=u>0?Math.atan2(u,l)/u:0;return t[0]=n*d,t[1]=i*d,t[2]=a*d,t[3]=.5*Math.log(n*n+i*i+a*a+l*l),t}function Vu(t,e,n,i){var a,l,u,d,f,p=e[0],g=e[1],_=e[2],x=e[3],v=n[0],b=n[1],E=n[2],C=n[3];return(l=p*v+g*b+_*E+x*C)<0&&(l=-l,v=-v,b=-b,E=-E,C=-C),1-l>rd.EPSILON?(a=Math.acos(l),u=Math.sin(a),d=Math.sin((1-i)*a)/u,f=Math.sin(i*a)/u):(d=1-i,f=i),t[0]=d*p+f*v,t[1]=d*g+f*b,t[2]=d*_+f*E,t[3]=d*x+f*C,t}function Hl(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var l=(a+1)%3,u=(a+2)%3;n=Math.sqrt(e[3*a+a]-e[3*l+l]-e[3*u+u]+1),t[a]=.5*n,t[3]=(e[3*l+u]-e[3*u+l])*(n=.5/n),t[l]=(e[3*l+a]+e[3*a+l])*n,t[u]=(e[3*u+a]+e[3*a+u])*n}return t}xt.clone=Mo.clone,xt.fromValues=Mo.fromValues,xt.copy=Mo.copy,xt.set=Mo.set,xt.add=Mo.add,xt.mul=wx;var w2=Mo.scale;xt.scale=w2;var E2=Mo.dot;xt.dot=E2,xt.lerp=Mo.lerp;var M2=Mo.length;xt.length=M2,xt.len=M2;var Mx=Mo.squaredLength;xt.squaredLength=Mx,xt.sqrLen=Mx;var fp=Mo.normalize;xt.normalize=fp,xt.exactEquals=Mo.exactEquals,xt.equals=Mo.equals;var Ma,T2,C2,D2=(Ma=Ks.create(),T2=Ks.fromValues(1,0,0),C2=Ks.fromValues(0,1,0),function(t,e,n){var i=Ks.dot(e,n);return i<-.999999?(Ks.cross(Ma,T2,e),Ks.len(Ma)<1e-6&&Ks.cross(Ma,C2,e),Ks.normalize(Ma,Ma),Bu(t,Ma,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ks.cross(Ma,e,n),t[0]=Ma[0],t[1]=Ma[1],t[2]=Ma[2],t[3]=1+i,fp(t,t))});xt.rotationTo=D2;var Tx,Cx,ss=(Tx=i_(),Cx=i_(),function(t,e,n,i,a,l){return Vu(Tx,e,a,l),Vu(Cx,n,i,l),Vu(t,Tx,Cx,2*l*(1-l)),t});xt.sqlerp=ss;var Ls,S2=(Ls=YD.create(),function(t,e,n,i){return Ls[0]=n[0],Ls[3]=n[1],Ls[6]=n[2],Ls[1]=i[0],Ls[4]=i[1],Ls[7]=i[2],Ls[2]=-e[0],Ls[5]=-e[1],Ls[8]=-e[2],fp(t,Hl(t,Ls))});xt.setAxes=S2;var $t={};function Hi(t){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty($t,"__esModule",{value:!0}),$t.create=function(){var t=new Ri.ARRAY_TYPE(8);return Ri.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},$t.clone=function(t){var e=new Ri.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},$t.fromValues=function(t,e,n,i,a,l,u,d){var f=new Ri.ARRAY_TYPE(8);return f[0]=t,f[1]=e,f[2]=n,f[3]=i,f[4]=a,f[5]=l,f[6]=u,f[7]=d,f},$t.fromRotationTranslationValues=function(t,e,n,i,a,l,u){var d=new Ri.ARRAY_TYPE(8);d[0]=t,d[1]=e,d[2]=n,d[3]=i;var f=.5*a,p=.5*l,g=.5*u;return d[4]=f*i+p*n-g*e,d[5]=p*i+g*t-f*n,d[6]=g*i+f*e-p*t,d[7]=-f*t-p*e-g*n,d},$t.fromRotationTranslation=A2,$t.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},$t.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},$t.fromMat4=function(t,e){var n=hl.create();Dx.getRotation(n,e);var i=new Ri.ARRAY_TYPE(3);return Dx.getTranslation(i,e),A2(t,n,i),t},$t.copy=Sx,$t.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},$t.set=function(t,e,n,i,a,l,u,d,f){return t[0]=e,t[1]=n,t[2]=i,t[3]=a,t[4]=l,t[5]=u,t[6]=d,t[7]=f,t},$t.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},$t.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},$t.getTranslation=function(t,e){var n=e[4],i=e[5],a=e[6],l=e[7],u=-e[0],d=-e[1],f=-e[2],p=e[3];return t[0]=2*(n*p+l*u+i*f-a*d),t[1]=2*(i*p+l*d+a*u-n*f),t[2]=2*(a*p+l*f+n*d-i*u),t},$t.translate=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=.5*n[0],f=.5*n[1],p=.5*n[2],g=e[4],_=e[5],x=e[6],v=e[7];return t[0]=i,t[1]=a,t[2]=l,t[3]=u,t[4]=u*d+a*p-l*f+g,t[5]=u*f+l*d-i*p+_,t[6]=u*p+i*f-a*d+x,t[7]=-i*d-a*f-l*p+v,t},$t.rotateX=function(t,e,n){var i=-e[0],a=-e[1],l=-e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=d*u+g*i+f*l-p*a,x=f*u+g*a+p*i-d*l,v=p*u+g*l+d*a-f*i,b=g*u-d*i-f*a-p*l;return hl.rotateX(t,e,n),t[4]=_*(u=t[3])+b*(i=t[0])+x*(l=t[2])-v*(a=t[1]),t[5]=x*u+b*a+v*i-_*l,t[6]=v*u+b*l+_*a-x*i,t[7]=b*u-_*i-x*a-v*l,t},$t.rotateY=function(t,e,n){var i=-e[0],a=-e[1],l=-e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=d*u+g*i+f*l-p*a,x=f*u+g*a+p*i-d*l,v=p*u+g*l+d*a-f*i,b=g*u-d*i-f*a-p*l;return hl.rotateY(t,e,n),t[4]=_*(u=t[3])+b*(i=t[0])+x*(l=t[2])-v*(a=t[1]),t[5]=x*u+b*a+v*i-_*l,t[6]=v*u+b*l+_*a-x*i,t[7]=b*u-_*i-x*a-v*l,t},$t.rotateZ=function(t,e,n){var i=-e[0],a=-e[1],l=-e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=d*u+g*i+f*l-p*a,x=f*u+g*a+p*i-d*l,v=p*u+g*l+d*a-f*i,b=g*u-d*i-f*a-p*l;return hl.rotateZ(t,e,n),t[4]=_*(u=t[3])+b*(i=t[0])+x*(l=t[2])-v*(a=t[1]),t[5]=x*u+b*a+v*i-_*l,t[6]=v*u+b*l+_*a-x*i,t[7]=b*u-_*i-x*a-v*l,t},$t.rotateByQuatAppend=function(t,e,n){var i=n[0],a=n[1],l=n[2],u=n[3],d=e[0],f=e[1],p=e[2],g=e[3];return t[0]=d*u+g*i+f*l-p*a,t[1]=f*u+g*a+p*i-d*l,t[2]=p*u+g*l+d*a-f*i,t[3]=g*u-d*i-f*a-p*l,t[4]=(d=e[4])*u+(g=e[7])*i+(f=e[5])*l-(p=e[6])*a,t[5]=f*u+g*a+p*i-d*l,t[6]=p*u+g*l+d*a-f*i,t[7]=g*u-d*i-f*a-p*l,t},$t.rotateByQuatPrepend=function(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=n[0],f=n[1],p=n[2],g=n[3];return t[0]=i*g+u*d+a*p-l*f,t[1]=a*g+u*f+l*d-i*p,t[2]=l*g+u*p+i*f-a*d,t[3]=u*g-i*d-a*f-l*p,t[4]=i*(g=n[7])+u*(d=n[4])+a*(p=n[6])-l*(f=n[5]),t[5]=a*g+u*f+l*d-i*p,t[6]=l*g+u*p+i*f-a*d,t[7]=u*g-i*d-a*f-l*p,t},$t.rotateAroundAxis=function(t,e,n,i){if(Math.abs(i)<Ri.EPSILON)return Sx(t,e);var a=Math.hypot(n[0],n[1],n[2]);i*=.5;var l=Math.sin(i),u=l*n[0]/a,d=l*n[1]/a,f=l*n[2]/a,p=Math.cos(i),g=e[0],_=e[1],x=e[2],v=e[3];t[0]=g*p+v*u+_*f-x*d,t[1]=_*p+v*d+x*u-g*f,t[2]=x*p+v*f+g*d-_*u,t[3]=v*p-g*u-_*d-x*f;var b=e[4],E=e[5],C=e[6],T=e[7];return t[4]=b*p+T*u+E*f-C*d,t[5]=E*p+T*d+C*u-b*f,t[6]=C*p+T*f+b*d-E*u,t[7]=T*p-b*u-E*d-C*f,t},$t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},$t.multiply=P2,$t.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},$t.lerp=function(t,e,n,i){var a=1-i;return Ix(e,n)<0&&(i=-i),t[0]=e[0]*a+n[0]*i,t[1]=e[1]*a+n[1]*i,t[2]=e[2]*a+n[2]*i,t[3]=e[3]*a+n[3]*i,t[4]=e[4]*a+n[4]*i,t[5]=e[5]*a+n[5]*i,t[6]=e[6]*a+n[6]*i,t[7]=e[7]*a+n[7]*i,t},$t.invert=function(t,e){var n=s_(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},$t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},$t.normalize=function(t,e){var n=s_(e);if(n>0){n=Math.sqrt(n);var i=e[0]/n,a=e[1]/n,l=e[2]/n,u=e[3]/n,d=e[4],f=e[5],p=e[6],g=e[7],_=i*d+a*f+l*p+u*g;t[0]=i,t[1]=a,t[2]=l,t[3]=u,t[4]=(d-i*_)/n,t[5]=(f-a*_)/n,t[6]=(p-l*_)/n,t[7]=(g-u*_)/n}return t},$t.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},$t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},$t.equals=function(t,e){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=e[0],_=e[1],x=e[2],v=e[3],b=e[4],E=e[5],C=e[6],T=e[7];return Math.abs(n-g)<=Ri.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-_)<=Ri.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(a-x)<=Ri.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-v)<=Ri.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-b)<=Ri.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-E)<=Ri.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(f-C)<=Ri.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(p-T)<=Ri.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))},$t.sqrLen=$t.squaredLength=$t.len=$t.length=$t.dot=$t.mul=$t.setReal=$t.getReal=void 0;var Ri=o_(yn),hl=o_(xt),Dx=o_(Dt);function I2(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(I2=function(i){return i?n:e})(t)}function o_(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==Hi(t)&&"function"!=typeof t)return{default:t};var n=I2(e);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}function A2(t,e,n){var i=.5*n[0],a=.5*n[1],l=.5*n[2],u=e[0],d=e[1],f=e[2],p=e[3];return t[0]=u,t[1]=d,t[2]=f,t[3]=p,t[4]=i*p+a*f-l*d,t[5]=a*p+l*u-i*f,t[6]=l*p+i*d-a*u,t[7]=-i*u-a*d-l*f,t}function Sx(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function P2(t,e,n){var i=e[0],a=e[1],l=e[2],u=e[3],d=n[4],f=n[5],p=n[6],g=n[7],_=e[4],x=e[5],v=e[6],b=e[7],E=n[0],C=n[1],T=n[2],D=n[3];return t[0]=i*D+u*E+a*T-l*C,t[1]=a*D+u*C+l*E-i*T,t[2]=l*D+u*T+i*C-a*E,t[3]=u*D-i*E-a*C-l*T,t[4]=i*g+u*d+a*p-l*f+_*D+b*E+x*T-v*C,t[5]=a*g+u*f+l*d-i*p+x*D+b*C+v*E-_*T,t[6]=l*g+u*p+i*f-a*d+v*D+b*T+_*C-x*E,t[7]=u*g-i*d-a*f-l*p+b*D-_*E-x*C-v*T,t}$t.getReal=hl.copy,$t.setReal=hl.copy,$t.mul=P2;var Ix=hl.dot;$t.dot=Ix;var R2=hl.length;$t.length=R2,$t.len=R2;var s_=hl.squaredLength;$t.squaredLength=s_,$t.sqrLen=s_;var Pt={};function pp(t){return(pp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=O2,Pt.clone=function(t){var e=new ju.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Pt.fromValues=function(t,e){var n=new ju.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Pt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Pt.set=function(t,e,n){return t[0]=e,t[1]=n,t},Pt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Pt.subtract=k2,Pt.multiply=Ax,Pt.divide=Px,Pt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Pt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Pt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Pt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Pt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Pt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Pt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},Pt.distance=Rx,Pt.squaredDistance=Uu,Pt.length=mp,Pt.squaredLength=Ox,Pt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Pt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Pt.normalize=function(t,e){var n=e[0],i=e[1],a=n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t},Pt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Pt.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},Pt.lerp=function(t,e,n,i){var a=e[0],l=e[1];return t[0]=a+i*(n[0]-a),t[1]=l+i*(n[1]-l),t},Pt.random=function(t,e){e=e||1;var n=2*ju.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Pt.transformMat2=function(t,e,n){var i=e[0],a=e[1];return t[0]=n[0]*i+n[2]*a,t[1]=n[1]*i+n[3]*a,t},Pt.transformMat2d=function(t,e,n){var i=e[0],a=e[1];return t[0]=n[0]*i+n[2]*a+n[4],t[1]=n[1]*i+n[3]*a+n[5],t},Pt.transformMat3=function(t,e,n){var i=e[0],a=e[1];return t[0]=n[0]*i+n[3]*a+n[6],t[1]=n[1]*i+n[4]*a+n[7],t},Pt.transformMat4=function(t,e,n){var i=e[0],a=e[1];return t[0]=n[0]*i+n[4]*a+n[12],t[1]=n[1]*i+n[5]*a+n[13],t},Pt.rotate=function(t,e,n,i){var a=e[0]-n[0],l=e[1]-n[1],u=Math.sin(i),d=Math.cos(i);return t[0]=a*d-l*u+n[0],t[1]=a*u+l*d+n[1],t},Pt.angle=function(t,e){var n=t[0],i=t[1],a=e[0],l=e[1],u=Math.sqrt(n*n+i*i)*Math.sqrt(a*a+l*l);return Math.acos(Math.min(Math.max(u&&(n*a+i*l)/u,-1),1))},Pt.zero=function(t){return t[0]=0,t[1]=0,t},Pt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Pt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Pt.equals=function(t,e){var n=t[0],i=t[1],a=e[0],l=e[1];return Math.abs(n-a)<=ju.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-l)<=ju.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))},Pt.forEach=Pt.sqrLen=Pt.sqrDist=Pt.dist=Pt.div=Pt.mul=Pt.sub=Pt.len=void 0;var ju=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==pp(t)&&"function"!=typeof t)return{default:t};var n=id(void 0);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}(yn);function id(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(id=function(i){return i?n:e})(t)}function O2(){var t=new ju.ARRAY_TYPE(2);return ju.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function k2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Ax(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Px(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Rx(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Uu(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function mp(t){return Math.hypot(t[0],t[1])}function Ox(t){var e=t[0],n=t[1];return e*e+n*n}Pt.len=mp,Pt.sub=k2,Pt.mul=Ax,Pt.div=Px,Pt.dist=Rx,Pt.sqrDist=Uu,Pt.sqrLen=Ox;var kx=function(){var t=O2();return function(e,n,i,a,l,u){var d,f;for(n||(n=2),i||(i=0),f=a?Math.min(a*n+i,e.length):e.length,d=i;d<f;d+=n)t[0]=e[d],t[1]=e[d+1],l(t,t,u),e[d]=t[0],e[d+1]=t[1];return e}}();function od(t){return(od="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}Pt.forEach=kx,Object.defineProperty(fi,"__esModule",{value:!0});var xn=fi.vec4=G=fi.vec3=fi.vec2=fi.quat2=Oi=fi.quat=ne=fi.mat4=To=fi.mat3=fi.mat2d=sd=fi.mat2=fi.glMatrix=void 0,JD=dl(yn);fi.glMatrix=JD;var KD=dl(Pn),sd=fi.mat2=KD,QD=dl(cr);fi.mat2d=QD;var eS=dl(wn),To=fi.mat3=eS,a_=dl(Dt),ne=fi.mat4=a_,Lx=dl(xt),Oi=fi.quat=Lx,tS=dl($t);fi.quat2=tS;var Fx=dl(Pt);fi.vec2=Fx;var L2=dl(Mt),G=fi.vec3=L2,F2=dl(Bt);function Nx(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(Nx=function(i){return i?n:e})(t)}function dl(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==od(t)&&"function"!=typeof t)return{default:t};var n=Nx(e);if(n&&n.has(t))return n.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if("default"!==l&&Object.prototype.hasOwnProperty.call(t,l)){var u=a?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=t[l]}return i.default=t,n&&n.set(t,i),i}xn=fi.vec4=F2;const oR=sn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$u}=oR,N2=sn([{name:"a_pos_3",components:3,type:"Int16"}]);var Gl=sn([{name:"a_pos",type:"Int16",components:2}]),zx={};!function(n){function i(l,u,d){var f=a(256*l,256*(u=Math.pow(2,d)-u-1),d),p=a(256*(l+1),256*(u+1),d);return f[0]+","+f[1]+","+p[0]+","+p[1]}function a(l,u,d){var f=2*Math.PI*6378137/256/Math.pow(2,d);return[l*f-2*Math.PI*6378137/2,u*f-2*Math.PI*6378137/2]}n.getURL=function(l,u,d,f,p,g){return g=g||{},l+"?"+["bbox="+i(d,f,p),"format="+(g.format||"image/png"),"service="+(g.service||"WMS"),"version="+(g.version||"1.1.1"),"request="+(g.request||"GetMap"),"srs="+(g.srs||"EPSG:3857"),"width="+(g.width||256),"height="+(g.height||256),"layers="+u].join("&")},n.getTileBBox=i,n.getMercCoords=a,Object.defineProperty(n,"__esModule",{value:!0})}(zx);var z2=zx;class Qs{constructor(e,n,i){this.z=e,this.x=n,this.y=i,this.key=ql(0,e,e,n,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const i=z2.getTileBBox(this.x,this.y,this.z),a=function(l,u,d){let f,p="";for(let g=l;g>0;g--)f=1<<g-1,p+=(u&f?1:0)+(d&f?2:0);return p}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class l_{constructor(e,n){this.wrap=e,this.canonical=n,this.key=ql(e,n.z,n.z,n.x,n.y)}}class Zt{constructor(e,n,i,a,l){this.overscaledZ=e,this.wrap=n,this.canonical=new Qs(i,+a,+l),this.key=0===n&&e===i?this.canonical.key:ql(n,e,i,a,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Zt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zt(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return ql(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return ql(this.wrap*+n,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Zt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,i=2*this.canonical.x,a=2*this.canonical.y;return[new Zt(n,this.wrap,n,i,a),new Zt(n,this.wrap,n,i+1,a),new Zt(n,this.wrap,n,i,a+1),new Zt(n,this.wrap,n,i+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Zt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Zt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new l_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ql(t,e,n,i,a){const l=1<<Math.min(n,22);let u=l*(a%l)+i%l;return t&&n<22&&(u+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*u+n)+(e-n)}const Bx=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Zt(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Zt(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Zt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new Zt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Ge(Qs,"CanonicalTileID"),Ge(Zt,"OverscaledTileID",{omit:["projMatrix"]});class ad{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,i){const a=G.dot(n,this.dir);if(Math.abs(a)<1e-6)return!1;const l=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/a;return i[0]=this.pos[0]+this.dir[0]*l,i[1]=this.pos[1]+this.dir[1]*l,i[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,n,i){if(G.equals(this.pos,e)||0===n)return i[0]=i[1]=i[2]=0,!1;const[a,l,u]=this.dir,d=this.pos[0]-e[0],f=this.pos[1]-e[1],p=this.pos[2]-e[2],g=a*a+l*l+u*u,_=2*(d*a+f*l+p*u),x=_*_-4*g*(d*d+f*f+p*p-n*n);if(x<0){const v=Math.max(-_/2,0),b=d+a*v,E=f+l*v,C=p+u*v,T=Math.hypot(b,E,C);return i[0]=b*n/T,i[1]=E*n/T,i[2]=C*n/T,!1}{const v=(-_-Math.sqrt(x))/(2*g);if(v<0){const b=Math.hypot(d,f,p);return i[0]=d*n/b,i[1]=f*n/b,i[2]=p*n/b,!1}return i[0]=d+a*v,i[1]=f+l*v,i[2]=p+u*v,!0}}}class ld{constructor(e,n,i,a,l){this.TL=e,this.TR=n,this.BR=i,this.BL=a,this.horizon=l}static fromInvProjectionMatrix(e,n,i){const a=[-1,1,1],l=[1,1,1],u=[1,-1,1],d=[-1,-1,1],f=G.transformMat4(a,a,e),p=G.transformMat4(l,l,e),g=G.transformMat4(u,u,e),_=G.transformMat4(d,d,e);return new ld(f,p,g,_,n/i)}}function cd(t,e,n){let i=1/0,a=-1/0;const l=[];for(const u of t){G.sub(l,u,e);const d=G.dot(l,n);i=Math.min(i,d),a=Math.max(a,d)}return[i,a]}function c_(t,e){let n=!0;for(let i=0;i<t.planes.length;i++){const a=t.planes[i];let l=0;for(let u=0;u<e.length;u++)l+=G.dot(a,e[u])+a[3]>=0;if(0===l)return 0;l!==e.length&&(n=!1)}return n?2:1}function ud(t,e){for(const n of t.projections){const i=cd(e,t.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function B2(t,e){let n=0;const i=[0,0,0,0];for(let a=0;a<t.length;a++)i[0]=t[a][0],i[1]=t[a][1],i[2]=t[a][2],i[3]=1,xn.dot(i,e)>=0&&n++;return n}class fl{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=$n.fromPoints(this.points),this.projections=[],this.frustumEdges=[G.sub([],this.points[2],this.points[3]),G.sub([],this.points[0],this.points[3]),G.sub([],this.points[4],this.points[0]),G.sub([],this.points[5],this.points[1]),G.sub([],this.points[6],this.points[2]),G.sub([],this.points[7],this.points[3])];for(const i of this.frustumEdges){const a=[0,-i[2],i[1]],l=[i[2],0,-i[0]];this.projections.push({axis:a,projection:cd(this.points,this.points[0],a)}),this.projections.push({axis:l,projection:cd(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,n,i,a){const l=Math.pow(2,i),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(p=>{const g=xn.transformMat4([],p,e),_=1/g[3]/n*l;return xn.mul(g,g,[_,_,a?1/g[3]:_,_])}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(p=>{const g=G.sub([],u[p[0]],u[p[1]]),_=G.sub([],u[p[2]],u[p[1]]),x=G.normalize([],G.cross([],g,_)),v=-G.dot(x,u[p[1]]);return x.concat(v)}),f=[];for(let p=0;p<u.length;p++)f.push([u[p][0],u[p][1],u[p][2]]);return new fl(f,d)}intersectsPrecise(e,n,i){for(let a=0;a<n.length;a++)if(!B2(e,n[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!B2(e,this.planes[a]))return 0;for(const a of i)for(const l of this.frustumEdges){const u=G.cross([],a,l),d=G.length(u);if(0===d)continue;G.scale(u,u,1/d);const f=cd(this.points,this.points[0],u),p=cd(e,this.points[0],u);if(f[0]>p[1]||p[0]>f[1])return 0}return 1}}class $n{static fromPoints(e){const n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const a of e)G.min(n,n,a),G.max(i,i,a);return new $n(n,i)}static fromTileIdAndHeight(e,n,i){const a=1<<e.canonical.z,l=e.canonical.x,u=e.canonical.y;return new $n([l/a,u/a,n],[(l+1)/a,(u+1)/a,i])}static applyTransform(e,n){const i=e.getCorners();for(let a=0;a<i.length;++a)G.transformMat4(i[a],i[a],n);return $n.fromPoints(i)}static projectAabbCorners(e,n){const i=e.getCorners();for(let a=0;a<i.length;++a)G.transformMat4(i[a],i[a],n);return i}constructor(e,n){this.min=e,this.max=n,this.center=G.scale([],G.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],i=G.clone(this.min),a=G.clone(this.max);for(let l=0;l<n.length;l++)i[l]=n[l]?this.min[l]:this.center[l],a[l]=n[l]?this.center[l]:this.max[l];return a[2]=this.max[2],new $n(i,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?c_(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?c_(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?ud(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?ud(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ge($n,"Aabb");const gp=5,Hc=6,lo=le/Math.PI/2,V2=16383,_p=[64,32,16],co=-lo,ea=lo,nS=[new $n([co,co,co],[ea,ea,ea]),new $n([co,co,co],[0,0,ea]),new $n([0,co,co],[ea,0,ea]),new $n([co,0,co],[0,ea,ea]),new $n([0,0,co],[ea,ea,ea])];function Vx(t){return t*lo/Gu}function j2(t,e,n,i=!0){const a=G.scale([],t._camera.position,t.worldSize),l=[e,n,1,1];xn.transformMat4(l,l,t.pixelMatrixInverse),xn.scale(l,l,1/l[3]);const u=G.sub([],l,a),d=G.normalize([],u),f=t.globeMatrix,p=[f[12],f[13],f[14]],g=G.sub([],p,a),_=G.length(g),x=G.normalize([],g),v=t.worldSize/(2*Math.PI),b=G.dot(x,d),E=Math.asin(v/_);if(E<Math.acos(b)){if(!i)return null;const j=[],B=[];G.scale(j,d,_/b),G.normalize(B,G.sub(B,j,g)),G.normalize(d,G.add(d,g,G.scale(d,B,Math.tan(E)*_)))}const C=[];new ad(a,d).closestPointOnSphere(p,v,C);const T=G.normalize([],_r(f,0)),D=G.normalize([],_r(f,1)),A=G.normalize([],_r(f,2)),P=G.dot(T,C),I=G.dot(D,C),R=G.dot(A,C),k=ei(Math.asin(-I/v));let L=ei(Math.atan2(P,R));L=t.center.lng+function(j,B){const H=(B-j+180)%360-180;return H<-180?H+360:H}(t.center.lng,L);const N=Li(L),z=We(Gi(k),0,1);return new Gt(N,z)}class jx{constructor(e,n,i){this.a=G.sub([],e,i),this.b=G.sub([],n,i),this.center=i;const a=G.normalize([],this.a),l=G.normalize([],this.b);this.angle=Math.acos(G.dot(a,l))}}function Ux(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(i,a,l,u){const d=Math.sin(l);return i*(Math.sin((1-u)*l)/d)+a*(Math.sin(u*l)/d)}(t.a[e],t.b[e],t.angle,We(n,0,1))+t.center[e]}function uo(t){if(t.z<=1)return nS[t.z+2*t.y+t.x];const e=d_(yp(t));return $n.fromPoints(e)}function ta(t,e,n){return G.scale(t,t,1-n),G.scaleAndAdd(t,t,e,n)}function u_(t,e){const n=ki(e.zoom);if(0===n)return uo(t);const i=yp(t),a=d_(i),l=Li(i.getWest())*e.worldSize,u=Li(i.getEast())*e.worldSize,d=Gi(i.getNorth())*e.worldSize,f=Gi(i.getSouth())*e.worldSize,p=[l,d,0],g=[u,d,0],_=[l,f,0],x=[u,f,0],v=ne.invert([],e.globeMatrix);return G.transformMat4(p,p,v),G.transformMat4(g,g,v),G.transformMat4(_,_,v),G.transformMat4(x,x,v),a[0]=ta(a[0],_,n),a[1]=ta(a[1],x,n),a[2]=ta(a[2],g,n),a[3]=ta(a[3],p,n),$n.fromPoints(a)}function $x(t,e,n){for(const i of t)G.transformMat4(i,i,e),G.scale(i,i,n)}function h_(t,e,n,i){const a=e/t.worldSize,l=t.globeMatrix;if(n.z<=1){const N=uo(n).getCorners();return $x(N,l,a),$n.fromPoints(N)}const u=yp(n,i),d=d_(u);$x(d,l,a);const f=Number.MAX_VALUE,p=[-f,-f,-f],g=[f,f,f];if(u.contains(t.center)){for(const j of d)G.min(g,g,j),G.max(p,p,j);p[2]=0;const N=t.point,z=[N.x*a,N.y*a,0];return G.min(g,g,z),G.max(p,p,z),new $n(g,p)}const _=[l[12]*a,l[13]*a,l[14]*a],x=u.getCenter(),v=We(t.center.lat,-Er,Er),b=We(x.lat,-Er,Er),E=Li(t.center.lng),C=Gi(v);let T=E-Li(x.lng);const D=C-Gi(b);T>.5?T-=1:T<-.5&&(T+=1);let A=0;if(Math.abs(T)>Math.abs(D))A=T>=0?1:3;else{A=D>=0?0:2;const N=[l[4]*a,l[5]*a,l[6]*a],z=-Math.sin(Et(D>=0?u.getSouth():u.getNorth()))*lo;G.scaleAndAdd(_,_,N,z)}const P=d[A],I=d[(A+1)%4],R=new jx(P,I,_),k=[Ux(R,0)||P[0],Ux(R,1)||P[1],Ux(R,2)||P[2]],L=ki(t.zoom);if(L>0){const N=function({x:j,y:B,z:H},V,Z,Q,te){const W=1/(1<<H);let X=j*W,re=X+W,oe=B*W,ce=oe+W,de=0;const ge=(X+re)/2-Q;return ge>.5?de=-1:ge<-.5&&(de=1),X=((X+de)*V-(Q*=V))*Z+Q,re=((re+de)*V-Q)*Z+Q,oe=(oe*V-(te*=V))*Z+te,ce=(ce*V-te)*Z+te,[[X,ce,0],[re,ce,0],[re,oe,0],[X,oe,0]]}(n,e,t._pixelsPerMercatorPixel,E,C);for(let j=0;j<d.length;j++)ta(d[j],N[j],L);const z=G.add([],N[A],N[(A+1)%4]);G.scale(z,z,.5),ta(k,z,L)}for(const N of d)G.min(g,g,N),G.max(p,p,N);return g[2]=Math.min(P[2],I[2]),G.min(g,g,k),G.max(p,p,k),new $n(g,p)}function yp({x:t,y:e,z:n},i=!1){const a=1/(1<<n),l=new _t(ls(t*a),e===(1<<n)-1&&i?-90:zr((e+1)*a)),u=new _t(ls((t+1)*a),0===e&&i?90:zr(e*a));return new Rs(l,u)}function d_(t){const e=Et(t.getNorth()),n=Et(t.getSouth()),i=Math.cos(e),a=Math.cos(n),l=Math.sin(e),u=Math.sin(n),d=t.getWest(),f=t.getEast();return[hd(a,u,d),hd(a,u,f),hd(i,l,f),hd(i,l,d)]}function hd(t,e,n,i=lo){return n=Et(n),[t*Math.sin(n)*i,-e*i,t*Math.cos(n)*i]}function Vo(t,e,n){return hd(Math.cos(Et(t)),Math.sin(Et(t)),e,n)}function xp(t,e,n,i){const a=1<<n.z,l=(t/le+n.x)/a;return Vo(zr((e/le+n.y)/a),ls(l),i)}function f_({min:t,max:e}){return V2/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const U2=new Float64Array(16);function as(t){const e=f_(t),n=ne.fromScaling(U2,[e,e,e]);return ne.translate(n,n,G.negate([],t.min))}function Hu(t){const e=ne.fromTranslation(U2,t.min),n=1/f_(t);return ne.scale(e,e,[n,n,n])}function Hx(t){const e=le/(2*Math.PI);return t/(2*Math.PI)/e}function rS(t,e){return le/(512*Math.pow(2,t))*f_(uo(e))}function iS(t,e,n,i,a){const l=Hx(n),u=[t,e,-n/(2*Math.PI)],d=ne.identity(new Float64Array(16));return ne.translate(d,d,u),ne.scale(d,d,[l,l,l]),ne.rotateX(d,d,Et(-a)),ne.rotateY(d,d,Et(-i)),d}function ki(t){return Ya(gp,Hc,t)}function oS(t,e,n){const i=ne.identity(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return ne.rotateY(i,n.globeMatrix,a),Float32Array.from(i)}function sS(t,e,n){const i=ki(n.zoom),a=t.style.map._antialias,l=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===i&&!a&&!l}function $2(t,e,n,i){const a=e.getNorth(),l=e.getSouth(),u=e.getWest(),d=e.getEast(),f=1<<t.z,p=d-u,g=a-l,_=p/64,x=-g/_p[n],v=[0,_,0,x,0,0,a,u,0];if(t.z>0){const b=180/i;To.multiply(v,v,[b/p+1,0,0,0,b/g+1,0,-.5*b/_,.5*b/x,1])}return v[2]=f,v[5]=t.x,v[8]=t.y,v}function aS(t){const e=Er-5;t=We(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Et(t))),3);return Math.round(n*(_p.length-1))}function H2(t){const e=[0,0,0],n=ne.identity(new Float64Array(16));return ne.multiply(n,t.pixelMatrix,t.globeMatrix),G.transformMat4(e,e,n),new ee(e[0],e[1])}function G2(t,e){const n=Vo(e.lat,e.lng),i=function(l){const u=Vo(l._center.lat,l._center.lng),d=G.fromValues(0,1,0);let f=G.cross([],d,u);const p=ne.fromRotation([],-l.angle,u);f=G.transformMat4(f,f,p),ne.fromRotation(p,-l._pitch,f);const g=G.normalize([],u);return G.scale(g,g,Vx(l.cameraToCenterDistance/l.pixelsPerMeter)),G.transformMat4(g,g,p),G.add([],u,g)}(t),a=G.subtract([],i,n);return G.angle(a,n)}function p_(t,e){return G2(t,e)>Math.PI/2*1.01}const m_=Et(85),Wl=Math.cos(m_),vp=Math.sin(m_);class q2{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,n){const i=new Eo,a=new Rr,l=[],u=e+1+2,d=n[0]+1,f=n[0]+1+(1+n.length),p=(g,_,x)=>{let v=g===u-1?g-2:0===g?g:g-1;return v+=x?24575:0,[v,_]};for(let g=0;g<u;++g)i.emplaceBack(...p(g,0,!0));for(let g=0;g<d;++g)for(let _=0;_<u;++_)i.emplaceBack(...p(_,g,(0===_||_===u-1)&&!0));for(let g=0;g<n.length;++g){const _=n[g];for(let x=0;x<u;++x)i.emplaceBack(...p(x,_,!0))}for(let g=0;g<n.length;++g){const _=a.length,x=n[g]+1+2,v=new Rr;for(let C=0;C<x-1;C++){const T=C===x-2,D=T?u*(f-n.length+g-C):u;for(let A=0;A<u-1;A++){const P=C*u+A;0===C||T||0===A||A===u-2?(v.emplaceBack(P+1,P,P+D),v.emplaceBack(P+D,P+D+1,P+1)):(a.emplaceBack(P+1,P,P+D),a.emplaceBack(P+D,P+D+1,P+1))}}const b=bn.simpleSegment(0,_,i.length,a.length-_);for(let C=0;C<v.uint16.length;C+=3)a.emplaceBack(v.uint16[C],v.uint16[C+1],v.uint16[C+2]);const E=bn.simpleSegment(0,_,i.length,a.length-_);l.push({withoutSkirts:b,withSkirts:E})}return{vertices:i,indices:a,segments:l}}_createGrid(e){const n=this._fillGridMeshWithLods(64,_p);this._gridSegments=n.segments,this._gridBuffer=e.createVertexBuffer(n.vertices,Gl.members),this._gridIndexBuffer=e.createIndexBuffer(n.indices,!0)}_createPoles(e){const n=new Rr;for(let d=0;d<=64;d++)n.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=e.createIndexBuffer(n,!0);const i=new Ys,a=new Ys,l=new Ys,u=new Ys;this._poleSegments=[];for(let d=0,f=0;d<gp;d++){const p=360/(1<<d);i.emplaceBack(0,-lo,0,.5,0),a.emplaceBack(0,-lo,0,.5,1),l.emplaceBack(0,-lo,0,.5,.5),u.emplaceBack(0,-lo,0,.5,.5);for(let g=0;g<=64;g++){let _=g/64,x=0;const v=ut(0,p,_),[b,E,C]=hd(Wl,vp,v,lo);i.emplaceBack(b,E,C,_,x),a.emplaceBack(b,E,C,_,1-x);const T=Et(v);_=.5+.5*Math.sin(T),x=.5+.5*Math.cos(T),l.emplaceBack(b,E,C,_,x),u.emplaceBack(b,E,C,_,1-x)}this._poleSegments.push(bn.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,$u,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(a,$u,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(l,$u,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(u,$u,!1)}getGridBuffers(e,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const Gu=6371008.8,g_=2*Math.PI*Gu;class qu{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qu(Ja(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,i=this.lat*n,a=e.lat*n,l=Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos((e.lng-this.lng)*n);return Gu*Math.acos(Math.min(l,1))}toBounds(e=0){const n=360*e/40075017,i=n/Math.cos(Math.PI/180*this.lat);return new Rs(new qu(this.lng-i,this.lat-n),new qu(this.lng+i,this.lat+n))}toEcef(e){const n=Vx(e);return Vo(this.lat,this.lng,lo+n)}static convert(e){if(e instanceof qu)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new qu(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new qu(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var _t=qu;const sR=0,Gx=25.5;function dd(t){return g_*Math.cos(t*Math.PI/180)}function Li(t){return(180+t)/360}function Gi(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function vn(t,e){return t/dd(e)}function ls(t){return 360*t-180}function zr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Z2(t,e){return t*dd(zr(e))}const Er=85.051129;function qx(t){return Math.cos(Et(We(t,-Er,Er)))}function Ta(t,e){const n=We(e,sR,Gx),i=Math.pow(2,n);return qx(t)*g_/(512*i)}function Zx(t){return 1/Math.cos(t*Math.PI/180)}function Zu(t,e=0){const n=Math.exp(Math.PI*(1-(t.y+e/le)/(1<<t.z)*2));return 80150034*n/(n*n+1)/le/(1<<t.z)}class Gt{constructor(e,n,i=0){this.x=+e,this.y=+n,this.z=+i}static fromLngLat(e,n=0){const i=_t.convert(e);return new Gt(Li(i.lng),Gi(i.lat),vn(n,i.lat))}toLngLat(){return new _t(ls(this.x),zr(this.y))}toAltitude(){return Z2(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/g_*Zx(zr(this.y))}}function Gc(t,e,n,i,a,l,u,d,f){const p=(e+i)/2,g=(n+a)/2,_=new ee(p,g);d(_),function(x,v,b,E,C,T){const D=b-C,A=E-T;return Math.abs((E-v)*D-(b-x)*A)/Math.hypot(D,A)}(_.x,_.y,l.x,l.y,u.x,u.y)>=f?(Gc(t,e,n,p,g,l,_,d,f),Gc(t,p,g,i,a,_,u,d,f)):t.push(u)}function W2(t,e,n){let i=t[0],a=i.x,l=i.y;e(i);const u=[i];for(let d=1;d<t.length;d++){const f=t[d],{x:p,y:g}=f;e(f),Gc(u,a,l,p,g,i,f,e,n),a=p,l=g,i=f}return u}function Wx(t,e,n,i){if(i(e,n)){const a=e.add(n)._mult(.5);Wx(t,e,a,i),Wx(t,a,n,i)}else t.push(n)}function X2(t,e){let n=t[0];const i=[n];for(let a=1;a<t.length;a++){const l=t[a];Wx(i,n,l,e),n=l}return i}const __=Math.pow(2,14)-1,Y2=-__-1;function lS(t,e){const n=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=We(n,Y2,__),t.y=We(i,Y2,__),(n<t.x||n>t.x+1||i<t.y||i>t.y+1)&&K("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function pl(t,e,n){const i=t.loadGeometry(),a=t.extent,l=le/a;if(e&&n&&n.projection.isReprojectedInTileSpace){const u=1<<e.z,{scale:d,x:f,y:p,projection:g}=n,_=x=>{const v=ls((e.x+x.x/a)/u),b=zr((e.y+x.y/a)/u),E=g.project(v,b);x.x=(E.x*d-f)*a,x.y=(E.y*d-p)*a};for(let x=0;x<i.length;x++)if(1!==t.type)i[x]=W2(i[x],_,1);else{const v=[];for(const b of i[x])b.x<0||b.x>=a||b.y<0||b.y>=a||(_(b),v.push(b));i[x]=v}}for(const u of i)for(const d of u)lS(d,l);return i}function qc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?pl(t):[]}}function bp(t,e,n,i,a){t.emplaceBack(2*e+(i+1)/2,2*n+(a+1)/2)}function Xx(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class J2{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Eo,this.indexArray=new Rr,this.segments=new bn,this.programConfigurations=new Fu(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,a){const l=this.layers[0],u=[];let d=null;"circle"===l.type&&(d=l.layout.get("circle-sort-key"));for(const{feature:p,id:g,index:_,sourceLayerIndex:x}of e){const v=this.layers[0]._featureFilter.needGeometry,b=qc(p,v);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),b,i))continue;const E=d?d.evaluate(b,{},i):void 0,C={id:g,properties:p.properties,type:p.type,sourceLayerIndex:x,index:_,geometry:v?b.geometry:pl(p,i,a),patterns:{},sortKey:E};u.push(C)}d&&u.sort((p,g)=>p.sortKey-g.sortKey);let f=null;"globe"===a.projection.name&&(this.globeExtVertexArray=new Vg,f=a.projection);for(const p of u){const{geometry:g,index:_,sourceLayerIndex:x}=p,v=e[_].feature;this.addFeature(p,g,_,n.availableImages,i,f,n.brightness),n.featureIndex.insert(v,g,_,x,this.index)}}update(e,n,i,a,l){const u=0!==Object.keys(e).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,u?this.stateDependentLayers:this.layers,i,a,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ND.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,al.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,i,a,l,u,d){for(const f of n)for(const p of f){const g=p.x,_=p.y;if(g<0||g>=le||_<0||_>=le)continue;if(u){const b=u.projectTilePoint(g,_,l),E=u.upVector(l,g,_),C=this.globeExtVertexArray;Xx(C,b,E),Xx(C,b,E),Xx(C,b,E),Xx(C,b,E)}const x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),v=x.vertexLength;bp(this.layoutVertexArray,g,_,-1,-1),bp(this.layoutVertexArray,g,_,1,-1),bp(this.layoutVertexArray,g,_,1,1),bp(this.layoutVertexArray,g,_,-1,1),this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v,v+2,v+3),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},a,l,d)}}function fd(t,e){for(let n=0;n<t.length;n++)if(Ca(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ca(t,e[n]))return!0;return!!Ep(t,e)}function wp(t,e,n){return!!Ca(t,e)||!!Kx(e,t,n)}function Yx(t,e){if(1===t.length)return ev(e,t[0]);for(let n=0;n<e.length;n++){const i=e[n];for(let a=0;a<i.length;a++)if(Ca(t,i[a]))return!0}for(let n=0;n<t.length;n++)if(ev(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ep(t,e[n]))return!0;return!1}function K2(t,e,n){if(t.length>1){if(Ep(t,e))return!0;for(let i=0;i<e.length;i++)if(Kx(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(Kx(t[i],e,n))return!0;return!1}function Ep(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const i=t[n],a=t[n+1];for(let l=0;l<e.length-1;l++)if(Jx(i,a,e[l],e[l+1]))return!0}return!1}function Jx(t,e,n,i){return xe(t,n,i)!==xe(e,n,i)&&xe(t,e,n)!==xe(t,e,i)}function Kx(t,e,n){const i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(let a=1;a<e.length;a++)if(Qx(t,e[a-1],e[a])<i)return!0;return!1}function Qx(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const a=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(a<0?e:a>1?n:n.sub(e)._mult(a)._add(e))}function ev(t,e){let n,i,a,l=!1;for(let u=0;u<t.length;u++){n=t[u];for(let d=0,f=n.length-1;d<n.length;f=d++)i=n[d],a=n[f],i.y>e.y!=a.y>e.y&&e.x<(a.x-i.x)*(e.y-i.y)/(a.y-i.y)+i.x&&(l=!l)}return l}function Ca(t,e){let n=!1;for(let i=0,a=t.length-1;i<t.length;a=i++){const l=t[i],u=t[a];l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(n=!n)}return n}function cS(t,e,n,i,a){for(const u of t)if(e<=u.x&&n<=u.y&&i>=u.x&&a>=u.y)return!0;const l=[new ee(e,n),new ee(e,a),new ee(i,a),new ee(i,n)];if(t.length>2)for(const u of l)if(Ca(t,u))return!0;for(let u=0;u<t.length-1;u++)if(tv(t[u],t[u+1],l))return!0;return!1}function tv(t,e,n){const i=n[0],a=n[2];if(t.x<i.x&&e.x<i.x||t.x>a.x&&e.x>a.x||t.y<i.y&&e.y<i.y||t.y>a.y&&e.y>a.y)return!1;const l=xe(t,e,n[0]);return l!==xe(t,e,n[1])||l!==xe(t,e,n[2])||l!==xe(t,e,n[3])}function pd(t,e,n,i,a,l){let u=e.y-t.y,d=t.x-e.x;if(l=l||0){const f=u*u+d*d;if(0===f)return!0;const p=Math.sqrt(f);u/=p,d/=p}return!((n.x-t.x)*u+(n.y-t.y)*d-l<0||(i.x-t.x)*u+(i.y-t.y)*d-l<0||(a.x-t.x)*u+(a.y-t.y)*d-l<0)}function Mp(t,e,n,i,a,l,u){return!(pd(t,e,i,a,l,u)||pd(e,n,i,a,l,u)||pd(n,t,i,a,l,u)||pd(i,a,t,e,n,u)||pd(a,l,t,e,n,u)||pd(l,i,t,e,n,u))}function Wu(t,e,n){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Tp(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Zc(t,e,n,i,a){if(!e[0]&&!e[1])return t;const l=ee.convert(e)._mult(a);"viewport"===n&&l._rotate(-i);const u=[];for(let d=0;d<t.length;d++)u.push(t[d].sub(l));return u}function Q2(t,e,n,i){const a=ee.convert(t)._mult(i);return"viewport"===e&&a._rotate(-n),a}Ge(J2,"CircleBucket",{omit:["layers"]});const nv=new nr({"circle-sort-key":new et(J.layout_circle["circle-sort-key"]),visibility:new Ce(J.layout_circle.visibility)});var y_={paint:new nr({"circle-radius":new et(J.paint_circle["circle-radius"]),"circle-color":new et(J.paint_circle["circle-color"]),"circle-blur":new et(J.paint_circle["circle-blur"]),"circle-opacity":new et(J.paint_circle["circle-opacity"]),"circle-translate":new Ce(J.paint_circle["circle-translate"]),"circle-translate-anchor":new Ce(J.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ce(J.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ce(J.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new et(J.paint_circle["circle-stroke-width"]),"circle-stroke-color":new et(J.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new et(J.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ce(J.paint_circle["circle-emissive-strength"])}),layout:nv};const uS=ne.create(),rv=(t,e,n,i,a,l)=>{const u=t.transform,d="globe"===u.projection.name;let f;if("map"===l.paint.get("circle-pitch-alignment"))if(d){const g=rS(u.zoom,e.canonical)*u._pixelsPerMercatorPixel;f=Float32Array.from([g,0,0,g])}else f=u.calculatePixelsToTileUnitsMatrix(n);else f=new Float32Array([u.pixelsToGLUnits[0],0,0,u.pixelsToGLUnits[1]]);const p={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(u.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Fe.devicePixelRatio,u_extrude_scale:f,u_inv_rot_matrix:uS,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(d){p.u_inv_rot_matrix=i,p.u_merc_center=a,p.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],p.u_zoom_transition=ki(u.zoom);const g=a[0]*le,_=a[1]*le;p.u_up_dir=u.projection.upVector(new Qs(0,0,0),g,_)}return p},Cp=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function cs(t,e,n,i,a,l,u,d,f){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(f*=t.pixelToTileUnitsFactor);const p=t.tileID.canonical,g=n.projection.upVectorScale(p,n.center.lat,n.worldSize).metersToTile;for(const _ of e)for(const x of _){const v=x.add(d),b=a&&n.elevation?n.elevation.exaggeration()*a.getElevationAt(v.x,v.y,!0):0,E=n.projection.projectTilePoint(v.x,v.y,p);if(b>0){const A=n.projection.upVector(p,v.x,v.y);E.x+=A[0]*g*b,E.y+=A[1]*g*b,E.z+=A[2]*g*b}const C=l?v:md(E.x,E.y,E.z,i),T=l?t.tilespaceRays.map(A=>dS(A,b)):t.queryGeometry.screenGeometry,D=xn.transformMat4([],[E.x,E.y,E.z,1],i);if(!u&&l?f*=D[3]/n.cameraToCenterDistance:u&&!l&&(f*=n.cameraToCenterDistance/D[3]),l){const A=zr((x.y/le+p.y)/(1<<p.z));f/=n.projection.pixelsPerMeter(A,1)/vn(1,A)}if(wp(T,C,f))return!0}return!1}function md(t,e,n,i){const a=xn.transformMat4([],[t,e,n,1],i);return new ee(a[0]/a[3],a[1]/a[3])}const x_=G.fromValues(0,0,0),hS=G.fromValues(0,0,1);function dS(t,e){const n=G.create();return x_[2]=e,t.intersectsPlane(x_,hS,n),new ee(n[0],n[1])}class iv extends J2{}function Xu(t,{width:e,height:n},i,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*n*i)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=a,t}function eE(t,e,n){const{width:i,height:a}=e;i===t.width&&a===t.height||(ov(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,a)},n),t.width=i,t.height=a,t.data=e.data)}function ov(t,e,n,i,a,l){if(0===a.width||0===a.height)return e;if(a.width>t.width||a.height>t.height||n.x>t.width-a.width||n.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||i.x>e.width-a.width||i.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const u=t.data,d=e.data;for(let f=0;f<a.height;f++){const p=((n.y+f)*t.width+n.x)*l,g=((i.y+f)*e.width+i.x)*l;for(let _=0;_<a.width*l;_++)d[g+_]=u[p+_]}return e}Ge(iv,"HeatmapBucket",{omit:["layers"]});class Xl{constructor(e,n){Xu(this,e,1,n)}resize(e){eE(this,new Xl(e),1)}clone(){return new Xl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,a,l){ov(e,n,i,a,l,1)}}class ur{constructor(e,n){Xu(this,e,4,n)}resize(e){eE(this,new ur(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ur({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,a,l){ov(e,n,i,a,l,4)}}class Dp{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Ge(Xl,"AlphaImage"),Ge(ur,"RGBAImage");const fS=new nr({visibility:new Ce(J.layout_heatmap.visibility)});var tE={paint:new nr({"heatmap-radius":new et(J.paint_heatmap["heatmap-radius"]),"heatmap-weight":new et(J.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ce(J.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Kf(J.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ce(J.paint_heatmap["heatmap-opacity"])}),layout:fS};function ml(t){const e={},n=t.resolution||256,i=t.clips?t.clips.length:1,a=t.image||new ur({width:n,height:i}),l=(u,d,f)=>{e[t.evaluationKey]=f;const p=t.expression.evaluate(e);p&&(a.data[u+d+0]=Math.floor(255*p.r/p.a),a.data[u+d+1]=Math.floor(255*p.g/p.a),a.data[u+d+2]=Math.floor(255*p.b/p.a),a.data[u+d+3]=Math.floor(255*p.a))};if(t.clips)for(let u=0,d=0;u<i;++u,d+=4*n)for(let f=0,p=0;f<n;f++,p+=4){const g=f/(n-1),{start:_,end:x}=t.clips[u];l(d,p,_*(1-g)+x*g)}else for(let u=0,d=0;u<n;u++,d+=4)l(0,d,u/(n-1));return a}const aR=new nr({visibility:new Ce(J.layout_hillshade.visibility)});var lR={paint:new nr({"hillshade-illumination-direction":new Ce(J.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ce(J.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ce(J.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ce(J.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ce(J.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ce(J.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ce(J.paint_hillshade["hillshade-emissive-strength"])}),layout:aR};const nE=sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:pS}=nE;var rE={exports:{}};function sv(t,e,n){n=n||2;var i,a,l,u,d,f,p,g=e&&e.length,_=g?e[0]*n:t.length,x=Sp(t,0,_,n,!0),v=[];if(!x||x.next===x.prev)return v;if(g&&(x=function(E,C,T,D){var A,P,I,R=[];for(A=0,P=C.length;A<P;A++)(I=Sp(E,C[A]*D,A<P-1?C[A+1]*D:E.length,D,!1))===I.next&&(I.steiner=!0),R.push(uv(I));for(R.sort(Ip),A=0;A<R.length;A++)T=v_(R[A],T);return T}(t,e,x,n)),t.length>80*n){i=l=t[0],a=u=t[1];for(var b=n;b<_;b+=n)(d=t[b])<i&&(i=d),(f=t[b+1])<a&&(a=f),d>l&&(l=d),f>u&&(u=f);p=0!==(p=Math.max(l-i,u-a))?32767/p:0}return Ju(x,v,n,i,a,p,0),v}function Sp(t,e,n,i,a){var l,u;if(a===oE(t,e,n,i)>0)for(l=e;l<n;l+=i)u=hv(l,t[l],t[l+1],u);else for(l=n-i;l>=e;l-=i)u=hv(l,t[l],t[l+1],u);return u&&Wc(u,u.next)&&(Op(u),u=u.next),u}function Yu(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!Wc(i,i.next)&&0!==Or(i.prev,i,i.next))i=i.next;else{if(Op(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Ju(t,e,n,i,a,l,u){if(t){!u&&l&&function(g,_,x,v){var b=g;do{0===b.z&&(b.z=Ap(b.x,b.y,_,x,v)),b.prevZ=b.prev,b.nextZ=b.next,b=b.next}while(b!==g);b.prevZ.nextZ=null,b.prevZ=null,function(E){var C,T,D,A,P,I,R,k,L=1;do{for(T=E,E=null,P=null,I=0;T;){for(I++,D=T,R=0,C=0;C<L&&(R++,D=D.nextZ);C++);for(k=L;R>0||k>0&&D;)0!==R&&(0===k||!D||T.z<=D.z)?(A=T,T=T.nextZ,R--):(A=D,D=D.nextZ,k--),P?P.nextZ=A:E=A,A.prevZ=P,P=A;T=D}P.nextZ=null,L*=2}while(I>1)}(b)}(t,i,a,l);for(var d,f,p=t;t.prev!==t.next;)if(d=t.prev,f=t.next,l?gd(t,i,a,l):av(t))e.push(d.i/n|0),e.push(t.i/n|0),e.push(f.i/n|0),Op(t),t=f.next,p=f.next;else if((t=f)===p){u?1===u?Ju(t=lv(Yu(t),e,n),e,n,i,a,l,2):2===u&&cv(t,e,n,i,a,l):Ju(Yu(t),e,n,i,a,l,1);break}}}function av(t){var e=t.prev,n=t,i=t.next;if(Or(e,n,i)>=0)return!1;for(var a=e.x,l=n.x,u=i.x,d=e.y,f=n.y,p=i.y,g=a<l?a<u?a:u:l<u?l:u,_=d<f?d<p?d:p:f<p?f:p,x=a>l?a>u?a:u:l>u?l:u,v=d>f?d>p?d:p:f>p?f:p,b=i.next;b!==e;){if(b.x>=g&&b.x<=x&&b.y>=_&&b.y<=v&&Yl(a,d,l,f,u,p,b.x,b.y)&&Or(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function gd(t,e,n,i){var a=t.prev,l=t,u=t.next;if(Or(a,l,u)>=0)return!1;for(var d=a.x,f=l.x,p=u.x,g=a.y,_=l.y,x=u.y,v=d<f?d<p?d:p:f<p?f:p,b=g<_?g<x?g:x:_<x?_:x,E=d>f?d>p?d:p:f>p?f:p,C=g>_?g>x?g:x:_>x?_:x,T=Ap(v,b,e,n,i),D=Ap(E,C,e,n,i),A=t.prevZ,P=t.nextZ;A&&A.z>=T&&P&&P.z<=D;){if(A.x>=v&&A.x<=E&&A.y>=b&&A.y<=C&&A!==a&&A!==u&&Yl(d,g,f,_,p,x,A.x,A.y)&&Or(A.prev,A,A.next)>=0||(A=A.prevZ,P.x>=v&&P.x<=E&&P.y>=b&&P.y<=C&&P!==a&&P!==u&&Yl(d,g,f,_,p,x,P.x,P.y)&&Or(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;A&&A.z>=T;){if(A.x>=v&&A.x<=E&&A.y>=b&&A.y<=C&&A!==a&&A!==u&&Yl(d,g,f,_,p,x,A.x,A.y)&&Or(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;P&&P.z<=D;){if(P.x>=v&&P.x<=E&&P.y>=b&&P.y<=C&&P!==a&&P!==u&&Yl(d,g,f,_,p,x,P.x,P.y)&&Or(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function lv(t,e,n){var i=t;do{var a=i.prev,l=i.next.next;!Wc(a,l)&&iE(a,i,i.next,l)&&Rp(a,l)&&Rp(l,a)&&(e.push(a.i/n|0),e.push(i.i/n|0),e.push(l.i/n|0),Op(i),Op(i.next),i=t=l),i=i.next}while(i!==t);return Yu(i)}function cv(t,e,n,i,a,l){var u=t;do{for(var d=u.next.next;d!==u.prev;){if(u.i!==d.i&&cR(u,d)){var f=w_(u,d);return u=Yu(u,u.next),f=Yu(f,f.next),Ju(u,e,n,i,a,l,0),void Ju(f,e,n,i,a,l,0)}d=d.next}u=u.next}while(u!==t)}function Ip(t,e){return t.x-e.x}function v_(t,e){var n=function(a,l){var u,d=l,f=a.x,p=a.y,g=-1/0;do{if(p<=d.y&&p>=d.next.y&&d.next.y!==d.y){var _=d.x+(p-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(_<=f&&_>g&&(g=_,u=d.x<d.next.x?d:d.next,_===f))return u}d=d.next}while(d!==l);if(!u)return null;var x,v=u,b=u.x,E=u.y,C=1/0;d=u;do{f>=d.x&&d.x>=b&&f!==d.x&&Yl(p<E?f:g,p,b,E,p<E?g:f,p,d.x,d.y)&&(x=Math.abs(p-d.y)/(f-d.x),Rp(d,a)&&(x<C||x===C&&(d.x>u.x||d.x===u.x&&_d(u,d)))&&(u=d,C=x)),d=d.next}while(d!==v);return u}(t,e);if(!n)return e;var i=w_(n,t);return Yu(i,i.next),Yu(n,n.next)}function _d(t,e){return Or(t.prev,t,e.prev)<0&&Or(e.next,t,t.next)<0}function Ap(t,e,n,i,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function uv(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Yl(t,e,n,i,a,l,u,d){return(a-u)*(e-d)>=(t-u)*(l-d)&&(t-u)*(i-d)>=(n-u)*(e-d)&&(n-u)*(l-d)>=(a-u)*(i-d)}function cR(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,i){var a=n;do{if(a.i!==n.i&&a.next.i!==n.i&&a.i!==i.i&&a.next.i!==i.i&&iE(a,a.next,n,i))return!0;a=a.next}while(a!==n);return!1}(t,e)&&(Rp(t,e)&&Rp(e,t)&&function(n,i){var a=n,l=!1,u=(n.x+i.x)/2,d=(n.y+i.y)/2;do{a.y>d!=a.next.y>d&&a.next.y!==a.y&&u<(a.next.x-a.x)*(d-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next}while(a!==n);return l}(t,e)&&(Or(t.prev,t,e.prev)||Or(t,e.prev,e))||Wc(t,e)&&Or(t.prev,t,t.next)>0&&Or(e.prev,e,e.next)>0)}function Or(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Wc(t,e){return t.x===e.x&&t.y===e.y}function iE(t,e,n,i){var a=b_(Or(t,e,n)),l=b_(Or(t,e,i)),u=b_(Or(n,i,t)),d=b_(Or(n,i,e));return a!==l&&u!==d||!(0!==a||!Pp(t,n,e))||!(0!==l||!Pp(t,i,e))||!(0!==u||!Pp(n,t,i))||!(0!==d||!Pp(n,e,i))}function Pp(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function b_(t){return t>0?1:t<0?-1:0}function Rp(t,e){return Or(t.prev,t,t.next)<0?Or(t,e,t.next)>=0&&Or(t,t.prev,e)>=0:Or(t,e,t.prev)<0||Or(t,t.next,e)<0}function w_(t,e){var n=new dv(t.i,t.x,t.y),i=new dv(e.i,e.x,e.y),a=t.next,l=e.prev;return t.next=e,e.prev=t,n.next=a,a.prev=n,i.next=n,n.prev=i,l.next=i,i.prev=l,i}function hv(t,e,n,i){var a=new dv(t,e,n);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function Op(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function dv(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function oE(t,e,n,i){for(var a=0,l=e,u=n-i;l<n;l+=i)a+=(t[u]-t[l])*(t[l+1]+t[u+1]),u=l;return a}rE.exports=sv,rE.exports.default=sv,sv.deviation=function(t,e,n,i){var a=e&&e.length,l=Math.abs(oE(t,0,a?e[0]*n:t.length,n));if(a)for(var u=0,d=e.length;u<d;u++)l-=Math.abs(oE(t,e[u]*n,u<d-1?e[u+1]*n:t.length,n));var f=0;for(u=0;u<i.length;u+=3){var p=i[u]*n,g=i[u+1]*n,_=i[u+2]*n;f+=Math.abs((t[p]-t[_])*(t[g+1]-t[p+1])-(t[p]-t[g])*(t[_+1]-t[p+1]))}return 0===l&&0===f?0:Math.abs((f-l)/l)},sv.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,a=0;a<t.length;a++){for(var l=0;l<t[a].length;l++)for(var u=0;u<e;u++)n.vertices.push(t[a][l][u]);a>0&&n.holes.push(i+=t[a-1].length)}return n};var E_=Zo(rE.exports);function yd(t,e){const n=t.length;if(n<=1)return[t];const i=[];let a,l;for(let u=0;u<n;u++){const d=Ee(t[u]);0!==d&&(t[u].area=Math.abs(d),void 0===l&&(l=d<0),l===d<0?(a&&i.push(a),a=[t[u]]):a.push(t[u]))}if(a&&i.push(a),e>1)for(let u=0;u<i.length;u++)i[u].length<=e||(cD(i[u],e,1,i[u].length-1,fv),i[u]=i[u].slice(0,e));return i}function fv(t,e){return e.area-t.area}function pv(t,e,n){const i=n.patternDependencies;let a=!1;for(const l of e){const u=l.paint.get(`${t}-pattern`);u.isConstant()||(a=!0);const d=u.constantOr(null);d&&(a=!0,i[d]=!0)}return a}function M_(t,e,n,i,a){const l=a.patternDependencies;for(const u of e){const d=u.paint.get(`${t}-pattern`).value;if("constant"!==d.kind){let f=d.evaluate({zoom:i},n,{},a.availableImages);f=f&&f.name?f.name:f,l[f]=!0,n.patterns[u.id]=f}}return n}class xd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Eo,this.indexArray=new Rr,this.indexArray2=new ba,this.programConfigurations=new Fu(e.layers,e.zoom),this.segments=new bn,this.segments2=new bn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,i,a){this.hasPattern=pv("fill",this.layers,n);const l=this.layers[0].layout.get("fill-sort-key"),u=[];for(const{feature:d,id:f,index:p,sourceLayerIndex:g}of e){const _=this.layers[0]._featureFilter.needGeometry,x=qc(d,_);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),x,i))continue;const v=l?l.evaluate(x,{},i,n.availableImages):void 0,b={id:f,properties:d.properties,type:d.type,sourceLayerIndex:g,index:p,geometry:_?x.geometry:pl(d,i,a),patterns:{},sortKey:v};u.push(b)}l&&u.sort((d,f)=>d.sortKey-f.sortKey);for(const d of u){const{geometry:f,index:p,sourceLayerIndex:g}=d;if(this.hasPattern){const _=M_("fill",this.layers,d,this.zoom,n);this.patternFeatures.push(_)}else this.addFeature(d,f,p,i,{},n.availableImages,n.brightness);n.featureIndex.insert(e[p].feature,f,p,g,this.index)}}update(e,n,i,a,l){const u=0!==Object.keys(e).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,u?this.stateDependentLayers:this.layers,i,a,l)}addFeatures(e,n,i,a,l,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,i,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pS),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,i,a,l,u=[],d){for(const f of yd(n,500)){let p=0;for(const E of f)p+=E.length;const g=this.segments.prepareSegment(p,this.layoutVertexArray,this.indexArray),_=g.vertexLength,x=[],v=[];for(const E of f){if(0===E.length)continue;E!==f[0]&&v.push(x.length/2);const C=this.segments2.prepareSegment(E.length,this.layoutVertexArray,this.indexArray2),T=C.vertexLength;this.layoutVertexArray.emplaceBack(E[0].x,E[0].y),this.indexArray2.emplaceBack(T+E.length-1,T),x.push(E[0].x),x.push(E[0].y);for(let D=1;D<E.length;D++)this.layoutVertexArray.emplaceBack(E[D].x,E[D].y),this.indexArray2.emplaceBack(T+D-1,T+D),x.push(E[D].x),x.push(E[D].y);C.vertexLength+=E.length,C.primitiveLength+=E.length}const b=E_(x,v);for(let E=0;E<b.length;E+=3)this.indexArray.emplaceBack(_+b[E],_+b[E+1],_+b[E+2]);g.vertexLength+=p,g.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,u,a,d)}}Ge(xd,"FillBucket",{omit:["layers","patternFeatures"]});const T_=new nr({"fill-sort-key":new et(J.layout_fill["fill-sort-key"]),visibility:new Ce(J.layout_fill.visibility)});var mS={paint:new nr({"fill-antialias":new Ce(J.paint_fill["fill-antialias"]),"fill-opacity":new et(J.paint_fill["fill-opacity"]),"fill-color":new et(J.paint_fill["fill-color"]),"fill-outline-color":new et(J.paint_fill["fill-outline-color"]),"fill-translate":new Ce(J.paint_fill["fill-translate"]),"fill-translate-anchor":new Ce(J.paint_fill["fill-translate-anchor"]),"fill-pattern":new et(J.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ce(J.paint_fill["fill-emissive-strength"])}),layout:T_};const sE=sn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),gS=sn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),aE=sn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),uR=sn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),_S=sn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:C_}=sE;var D_={},vd=wc,us=bd;function bd(t,e,n,i,a){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=a,t.readFields(lE,this,e)}function lE(t,e,n){1==t?e.id=n.readVarint():2==t?function(i,a){for(var l=i.readVarint()+i.pos;i.pos<l;){var u=a._keys[i.readVarint()],d=a._values[i.readVarint()];a.properties[u]=d}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Jl(t){for(var e,n,i=0,a=0,l=t.length,u=l-1;a<l;u=a++)i+=((n=t[u]).x-(e=t[a]).x)*(e.y+n.y);return i}bd.types=["Unknown","Point","LineString","Polygon"],bd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,a=0,l=0,u=0,d=[];t.pos<n;){if(a<=0){var f=t.readVarint();i=7&f,a=f>>3}if(a--,1===i||2===i)l+=t.readSVarint(),u+=t.readSVarint(),1===i&&(e&&d.push(e),e=[]),e.push(new vd(l,u));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&d.push(e),d},bd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,a=0,l=0,u=1/0,d=-1/0,f=1/0,p=-1/0;t.pos<e;){if(i<=0){var g=t.readVarint();n=7&g,i=g>>3}if(i--,1===n||2===n)(a+=t.readSVarint())<u&&(u=a),a>d&&(d=a),(l+=t.readSVarint())<f&&(f=l),l>p&&(p=l);else if(7!==n)throw new Error("unknown command "+n)}return[u,f,d,p]},bd.prototype.toGeoJSON=function(t,e,n){var i,a,l=this.extent*Math.pow(2,n),u=this.extent*t,d=this.extent*e,f=this.loadGeometry(),p=bd.types[this.type];function g(v){for(var b=0;b<v.length;b++){var E=v[b];v[b]=[360*(E.x+u)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(E.y+d)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var _=[];for(i=0;i<f.length;i++)_[i]=f[i][0];g(f=_);break;case 2:for(i=0;i<f.length;i++)g(f[i]);break;case 3:for(f=function(v){var b=v.length;if(b<=1)return[v];for(var E,C,T=[],D=0;D<b;D++){var A=Jl(v[D]);0!==A&&(void 0===C&&(C=A<0),C===A<0?(E&&T.push(E),E=[v[D]]):E.push(v[D]))}return E&&T.push(E),T}(f),i=0;i<f.length;i++)for(a=0;a<f[i].length;a++)g(f[i][a])}1===f.length?f=f[0]:p="Multi"+p;var x={type:"Feature",geometry:{type:p,coordinates:f},properties:this.properties};return"id"in this&&(x.id=this.id),x};var yS=us,cE=wd;function wd(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(xS,this,e),this.length=this._features.length}function xS(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(i){for(var a=null,l=i.readVarint()+i.pos;i.pos<l;){var u=i.readVarint()>>3;a=1===u?i.readString():2===u?i.readFloat():3===u?i.readDouble():4===u?i.readVarint64():5===u?i.readVarint():6===u?i.readSVarint():7===u?i.readBoolean():null}return a}(n))}wd.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new yS(this._pbf,e,this.extent,this._keys,this._values)};var mv=cE;function hR(t,e,n){if(3===t){var i=new mv(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var kp=D_.VectorTile=function(t,e){this.layers=t.readFields(hR,{},e)},Lp=D_.VectorTileFeature=us;function S_(t,e,n,i){const a=[],l=0===i?(u,d,f,p,g,_)=>{u.push(new ee(_,f+(_-d)/(p-d)*(g-f)))}:(u,d,f,p,g,_)=>{u.push(new ee(d+(_-f)/(g-f)*(p-d),_))};for(const u of t){const d=[];for(const f of u){if(f.length<=2)continue;const p=[];for(let x=0;x<f.length-1;x++){const v=f[x].x,b=f[x].y,E=f[x+1].x,C=f[x+1].y,T=0===i?v:b,D=0===i?E:C;T<e?D>e&&l(p,v,b,E,C,e):T>n?D<n&&l(p,v,b,E,C,n):p.push(f[x]),D<e&&T>=e&&l(p,v,b,E,C,e),D>n&&T<=n&&l(p,v,b,E,C,n)}let g=f[f.length-1];const _=0===i?g.x:g.y;_>=e&&_<=n&&p.push(g),p.length&&(g=p[p.length-1],p[0].x===g.x&&p[0].y===g.y||p.push(p[0]),d.push(p))}d.length&&a.push(d)}return a}D_.VectorTileLayer=cE;class uE{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const i=e[n];this._stringToNumber[i]=n,this._numberToString[n]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var hE={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,n,i,a){var l,u,d=8*a-i-1,f=(1<<d)-1,p=f>>1,g=-7,_=n?a-1:0,x=n?-1:1,v=t[e+_];for(_+=x,l=v&(1<<-g)-1,v>>=-g,g+=d;g>0;l=256*l+t[e+_],_+=x,g-=8);for(u=l&(1<<-g)-1,l>>=-g,g+=i;g>0;u=256*u+t[e+_],_+=x,g-=8);if(0===l)l=1-p;else{if(l===f)return u?NaN:1/0*(v?-1:1);u+=Math.pow(2,i),l-=p}return(v?-1:1)*u*Math.pow(2,l-i)},write:function(t,e,n,i,a,l){var u,d,f,p=8*l-a-1,g=(1<<p)-1,_=g>>1,x=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,v=i?0:l-1,b=i?1:-1,E=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(d=isNaN(e)?1:0,u=g):(u=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-u))<1&&(u--,f*=2),(e+=u+_>=1?x/f:x*Math.pow(2,1-_))*f>=2&&(u++,f/=2),u+_>=g?(d=0,u=g):u+_>=1?(d=(e*f-1)*Math.pow(2,a),u+=_):(d=e*Math.pow(2,_-1)*Math.pow(2,a),u=0));a>=8;t[n+v]=255&d,v+=b,d/=256,a-=8);for(u=u<<a|d,p+=a;p>0;t[n+v]=255&u,v+=b,u/=256,p-=8);t[n+v-b]|=128*E}},dE=Yn,Fp=hE;function Yn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Yn.Varint=0,Yn.Fixed64=1,Yn.Bytes=2,Yn.Fixed32=5;var gv=4294967296,vS=1/gv,_v=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gl(t){return t.type===Yn.Bytes?t.readVarint()+t.pos:t.pos+1}function yv(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var a=n.pos-1;a>=t;a--)n.buf[a+i]=n.buf[a]}function dR(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function xv(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Kl(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function vv(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function bS(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function fR(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function wS(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function bv(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function si(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Np(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Ed(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function ES(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Yn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),a=i>>3,l=this.pos;this.type=7&i,t(a,e,this),this.pos===l&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Np(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ES(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Np(this.buf,this.pos)+Np(this.buf,this.pos+4)*gv;return this.pos+=8,t},readSFixed64:function(){var t=Np(this.buf,this.pos)+ES(this.buf,this.pos+4)*gv;return this.pos+=8,t},readFloat:function(){var t=Fp.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Fp.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(a,l,u){var d,f,p=u.buf;if(d=(112&(f=p[u.pos++]))>>4,f<128||(d|=(127&(f=p[u.pos++]))<<3,f<128)||(d|=(127&(f=p[u.pos++]))<<10,f<128)||(d|=(127&(f=p[u.pos++]))<<17,f<128)||(d|=(127&(f=p[u.pos++]))<<24,f<128)||(d|=(1&(f=p[u.pos++]))<<31,f<128))return function qi(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(a,d,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&_v?_v.decode(this.buf.subarray(e,t)):function(n,i,a){for(var l="",u=i;u<a;){var d,f,p,g=n[u],_=null,x=g>239?4:g>223?3:g>191?2:1;if(u+x>a)break;1===x?g<128&&(_=g):2===x?128==(192&(d=n[u+1]))&&(_=(31&g)<<6|63&d)<=127&&(_=null):3===x?(f=n[u+2],128==(192&(d=n[u+1]))&&128==(192&f)&&((_=(15&g)<<12|(63&d)<<6|63&f)<=2047||_>=55296&&_<=57343)&&(_=null)):4===x&&(f=n[u+2],p=n[u+3],128==(192&(d=n[u+1]))&&128==(192&f)&&128==(192&p)&&((_=(15&g)<<18|(63&d)<<12|(63&f)<<6|63&p)<=65535||_>=1114112)&&(_=null)),null===_?(_=65533,x=1):_>65535&&(_-=65536,l+=String.fromCharCode(_>>>10&1023|55296),_=56320|1023&_),l+=String.fromCharCode(_),u+=x}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Yn.Bytes)return t.push(this.readVarint(e));var n=gl(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Yn.Bytes)return t.push(this.readSVarint());var e=gl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Yn.Bytes)return t.push(this.readBoolean());var e=gl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Yn.Bytes)return t.push(this.readFloat());var e=gl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Yn.Bytes)return t.push(this.readDouble());var e=gl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Yn.Bytes)return t.push(this.readFixed32());var e=gl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Yn.Bytes)return t.push(this.readSFixed32());var e=gl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Yn.Bytes)return t.push(this.readFixed64());var e=gl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Yn.Bytes)return t.push(this.readSFixed64());var e=gl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Yn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Yn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Yn.Fixed32)this.pos+=4;else{if(e!==Yn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ed(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ed(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ed(this.buf,-1&t,this.pos),Ed(this.buf,Math.floor(t*vS),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ed(this.buf,-1&t,this.pos),Ed(this.buf,Math.floor(t*vS),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var i,a,l,d;if(e>=0?(i=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,a=a+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),l=i,(d=n).buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,d.buf[d.pos]=127&(l>>>=7),function(l,u){var d=(7&l)<<4;u.buf[u.pos++]|=d|((l>>>=3)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l)))))}(a,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(i,a,l){for(var u,d,f=0;f<a.length;f++){if((u=a.charCodeAt(f))>55295&&u<57344){if(!d){u>56319||f+1===a.length?(i[l++]=239,i[l++]=191,i[l++]=189):d=u;continue}if(u<56320){i[l++]=239,i[l++]=191,i[l++]=189,d=u;continue}u=d-55296<<10|u-56320|65536,d=null}else d&&(i[l++]=239,i[l++]=191,i[l++]=189,d=null);u<128?i[l++]=u:(u<2048?i[l++]=u>>6|192:(u<65536?i[l++]=u>>12|224:(i[l++]=u>>18|240,i[l++]=u>>12&63|128),i[l++]=u>>6&63|128),i[l++]=63&u|128)}return l}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&yv(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Fp.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Fp.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&yv(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,Yn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,dR,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,xv,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,bS,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Kl,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,vv,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,fR,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,wS,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,bv,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,si,e)},writeBytesField:function(t,e){this.writeTag(t,Yn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Yn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Yn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Yn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Yn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Yn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Yn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Yn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Yn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Yn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var hr=Zo(dE);const MS=["tile","layer","source","sourceLayer","state"];class I_{constructor(e,n,i,a,l){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=i,this._y=a,this.properties=e.properties,this.id=l}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of MS)void 0!==this[n]&&(e[n]=this[n]);return e}}class TS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){const a=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},qe(this.stateChanges[e][a],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const l in this.state[e])l!==a&&(this.deletedStates[e][l]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][a]){this.deletedStates[e][a]={};for(const l in this.state[e][a])i[l]||(this.deletedStates[e][a][l]=null)}else for(const l in i)this.deletedStates[e]&&this.deletedStates[e][a]&&null===this.deletedStates[e][a][l]&&delete this.deletedStates[e][a][l]}removeFeatureState(e,n,i){if(null===this.deletedStates[e])return;const a=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==n)null!==this.deletedStates[e][a]&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][i]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][a])for(i in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][i]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,n){const i=String(n),a=qe({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const l=this.deletedStates[e][n];if(null===l)return{};for(const u in l)delete a[u]}return a}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const i={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const l={};for(const u in this.stateChanges[a])this.state[a][u]||(this.state[a][u]={}),qe(this.state[a][u],this.stateChanges[a][u]),l[u]=this.state[a][u];i[a]=l}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const l={};if(null===this.deletedStates[a])for(const u in this.state[a])l[u]={},this.state[a][u]={};else for(const u in this.deletedStates[a]){if(null===this.deletedStates[a][u])this.state[a][u]={};else if(this.state[a][u])for(const d of Object.keys(this.deletedStates[a][u]))delete this.state[a][u][d];l[u]=this.state[a][u]}i[a]=i[a]||{},qe(i[a],l)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const a in e)e[a].setFeatureState(i,n)}}class fE{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const i=this.toIdx(e,n);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function A_(t,e,n,i){let a=0,l=Number.MAX_VALUE;for(let u=0;u<3;u++)if(Math.abs(i[u])<1e-15){if(n[u]<t[u]||n[u]>e[u])return null}else{const d=1/i[u];let f=(t[u]-n[u])*d,p=(e[u]-n[u])*d;if(f>p){const g=f;f=p,p=g}if(f>a&&(a=f),p<l&&(l=p),a>l)return null}return a}function wv(t,e,n,i,a,l,u,d,f,p,g){const _=i-t,x=a-e,v=l-n,b=u-t,E=d-e,C=f-n,T=g[1]*C-g[2]*E,D=g[2]*b-g[0]*C,A=g[0]*E-g[1]*b,P=_*T+x*D+v*A;if(Math.abs(P)<1e-15)return null;const I=1/P,R=p[0]-t,k=p[1]-e,L=p[2]-n,N=(R*T+k*D+L*A)*I;if(N<0||N>1)return null;const z=k*v-L*x,j=L*_-R*v,B=R*x-k*_,H=(g[0]*z+g[1]*j+g[2]*B)*I;return H<0||N+H>1?null:(b*z+E*j+C*B)*I}function Ev(t,e,n){return(t-e)/(n-e)}function pE(t,e,n,i,a,l,u,d,f){const p=1<<n,g=l-i,_=u-a,x=(t+1)/p*g+i,v=(e+0)/p*_+a,b=(e+1)/p*_+a;d[0]=(t+0)/p*g+i,d[1]=v,f[0]=x,f[1]=b}class Mv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(l){const u=Math.ceil(Math.log2(l.dim/8)),d=[];let f=Math.ceil(Math.pow(2,u));const p=1/f,g=(v,b,E,C,T)=>{const D=C?1:0,A=(v+1)*E-D,P=b*E,I=(b+1)*E-D;T[0]=v*E,T[1]=P,T[2]=A,T[3]=I};let _=new fE(f);const x=[];for(let v=0;v<f*f;v++){g(v%f,Math.floor(v/f),p,!1,x);const b=Xc(x[0],x[1],l),E=Xc(x[2],x[1],l),C=Xc(x[2],x[3],l),T=Xc(x[0],x[3],l);_.minimums.push(Math.min(b,E,C,T)),_.maximums.push(Math.max(b,E,C,T)),_.leaves.push(1)}for(d.push(_),f/=2;f>=1;f/=2){const v=d[d.length-1];_=new fE(f);for(let b=0;b<f*f;b++){g(b%f,Math.floor(b/f),2,!0,x);const E=v.getElevation(x[0],x[1]),C=v.getElevation(x[2],x[1]),T=v.getElevation(x[2],x[3]),D=v.getElevation(x[0],x[3]),A=v.isLeaf(x[0],x[1]),P=v.isLeaf(x[2],x[1]),I=v.isLeaf(x[2],x[3]),R=v.isLeaf(x[0],x[3]),k=Math.min(E.min,C.min,T.min,D.min),L=Math.max(E.max,C.max,T.max,D.max),N=A&&P&&I&&R;_.maximums.push(L),_.minimums.push(k),_.leaves.push(L-k<=5&&N?1:0)}d.push(_)}return d}(this.dem),i=n.length-1,a=n[i];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(n,0,0,i,0)}raycastRoot(e,n,i,a,l,u,d=1){return A_([e,n,-100],[i,a,this.maximums[0]*d],l,u)}raycast(e,n,i,a,l,u,d=1){if(!this.nodeCount)return null;const f=this.raycastRoot(e,n,i,a,l,u,d);if(null==f)return null;const p=[],g=[],_=[],x=[],v=[{idx:0,t:f,nodex:0,nodey:0,depth:0}];for(;v.length>0;){const{idx:b,t:E,nodex:C,nodey:T,depth:D}=v.pop();if(this.leaves[b]){pE(C,T,D,e,n,i,a,_,x);const P=1<<D,I=(C+0)/P,R=(C+1)/P,k=(T+0)/P,L=(T+1)/P,N=Xc(I,k,this.dem)*d,z=Xc(R,k,this.dem)*d,j=Xc(R,L,this.dem)*d,B=Xc(I,L,this.dem)*d,H=wv(_[0],_[1],N,x[0],_[1],z,x[0],x[1],j,l,u),V=wv(x[0],x[1],j,_[0],x[1],B,_[0],_[1],N,l,u),Z=Math.min(null!==H?H:Number.MAX_VALUE,null!==V?V:Number.MAX_VALUE);if(Z!==Number.MAX_VALUE)return Z;{const Q=G.scaleAndAdd([],l,u,E);if(Tv(N,z,B,j,Ev(Q[0],_[0],x[0]),Ev(Q[1],_[1],x[1]))>=Q[2])return E}continue}let A=0;for(let P=0;P<this._siblingOffset.length;P++){pE((C<<1)+this._siblingOffset[P][0],(T<<1)+this._siblingOffset[P][1],D+1,e,n,i,a,_,x),_[2]=-100,x[2]=this.maximums[this.childOffsets[b]+P]*d;const I=A_(_,x,l,u);if(null!=I){const R=I;p[P]=R;let k=!1;for(let L=0;L<A&&!k;L++)R>=p[g[L]]&&(g.splice(L,0,P),k=!0);k||(g[A]=P),A++}}for(let P=0;P<A;P++){const I=g[P];v.push({idx:this.childOffsets[b]+I,t:p[I],nodex:(C<<1)+this._siblingOffset[I][0],nodey:(T<<1)+this._siblingOffset[I][1],depth:D+1})}}return null}_addNode(e,n,i){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,i,a,l){if(1===e[a].isLeaf(n,i))return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const u=a-1,d=e[u];let f=0,p=0;for(let g=0;g<this._siblingOffset.length;g++){const _=2*n+this._siblingOffset[g][0],x=2*i+this._siblingOffset[g][1],v=d.getElevation(_,x),b=d.isLeaf(_,x),E=this._addNode(v.min,v.max,b);b&&(f|=1<<g),p||(p=E)}for(let g=0;g<this._siblingOffset.length;g++)f&1<<g||this._construct(e,2*n+this._siblingOffset[g][0],2*i+this._siblingOffset[g][1],u,p+g)}}function Tv(t,e,n,i,a,l){return ut(ut(t,n,l),ut(e,i,l),a)}function Xc(t,e,n){const i=n.dim,a=We(t*i-.5,0,i-1),l=We(e*i-.5,0,i-1),u=Math.floor(a),d=Math.floor(l),f=Math.min(u+1,i-1),p=Math.min(d+1,i-1);return Tv(n.get(u,d),n.get(f,d),n.get(u,p),n.get(f,p),a-u,l-d)}const mE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function Cv(t,e,n){return(256*t*256+256*e+n)/10-1e4}function P_(t,e,n){return 256*t+e+n/256-32768}class na{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,i,a,l=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return K(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const u=this.dim=n.height-2,d=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=i||"mapbox",this.borderReady=l,this._modifiedForSources={},!l){for(let f=0;f<u;f++)d[this._idx(-1,f)]=d[this._idx(0,f)],d[this._idx(u,f)]=d[this._idx(u-1,f)],d[this._idx(f,-1)]=d[this._idx(f,0)],d[this._idx(f,u)]=d[this._idx(f,u-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(u,-1)]=d[this._idx(u-1,0)],d[this._idx(-1,u)]=d[this._idx(0,u-1)],d[this._idx(u,u)]=d[this._idx(u-1,u-1)]}if(a){const f=new Float32Array(n.data.buffer),p="terrarium"===this.encoding?P_:Cv;for(let g=0;g<d.length;++g){const _=4*g;f[g]=p(this.pixels[_],this.pixels[_+1],this.pixels[_+2])}this.encoding="float"}this._timestamp=Fe.now()}_buildQuadTree(){this._tree=new Mv(this)}get(e,n,i=!1){i&&(e=We(e,-1,this.dim),n=We(n,-1,this.dim));const a=this._idx(e,n);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[a];const l=4*a;return("terrarium"===this.encoding?P_:Cv)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}set(e,n,i){const a=this._idx(e,n);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const f=this.floatView[a];return this.floatView[a]=i,i-f}const l=4*a,u=("terrarium"===this.encoding?P_:Cv)(this.pixels[l],this.pixels[l+1],this.pixels[l+2]),d=na.pack(i,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[l]=d[0],this.pixels[l+1]=d[1],this.pixels[l+2]=d[2],i-u}static getUnpackVector(e){return mE[e]}get unpackVector(){return mE[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const i=[0,0,0,0],a=na.getUnpackVector(n);let l=Math.floor((e+a[3])/a[2]);return i[2]=l%256,l=Math.floor(l/256),i[1]=l%256,l=Math.floor(l/256),i[0]=l,i}getPixels(){return"float"===this.encoding?new Dp({width:this.stride,height:this.stride},this.pixels):new ur({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=n*this.dim,l=n*this.dim+this.dim,u=i*this.dim,d=i*this.dim+this.dim;switch(n){case-1:a=l-1;break;case 1:l=a+1}switch(i){case-1:u=d-1;break;case 1:d=u+1}const f=-n*this.dim,p=-i*this.dim;for(let g=u;g<d;g++)for(let _=a;_<l;_++){const x=4*this._idx(_,g),v=4*this._idx(_+f,g+p);this.pixels[x+0]=e.pixels[v+0],this.pixels[x+1]=e.pixels[v+1],this.pixels[x+2]=e.pixels[v+2],this.pixels[x+3]=e.pixels[v+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ge(na,"DEMData"),Ge(Mv,"DemMinMaxQuadTree",{omit:["dem"]});class Ql{isDataAvailableAtPoint(e){const n=this._source();if(this.isUsingMockSource()||!n||e.y<0||e.y>1)return!1;const i=n.getSource().maxzoom,a=1<<i,l=Math.floor(e.x),u=Math.floor((e.x-l)*a),d=Math.floor(e.y*a),f=this.findDEMTileFor(new Zt(i,l,i,u,d));return!(!f||!f.dem)}getAtPointOrZero(e,n=0){return this.getAtPoint(e,n)||0}getAtPoint(e,n,i=!0){if(this.isUsingMockSource())return null;null==n&&(n=null);const a=this._source();if(!a||e.y<0||e.y>1)return n;const l=a.getSource().maxzoom,u=1<<l,d=Math.floor(e.x),f=e.x-d,p=new Zt(l,d,l,Math.floor(f*u),Math.floor(e.y*u)),g=this.findDEMTileFor(p);if(!g||!g.dem)return n;const _=g.dem,x=1<<g.tileID.canonical.z,v=(f*x-g.tileID.canonical.x)*_.dim,b=(e.y*x-g.tileID.canonical.y)*_.dim,E=Math.floor(v),C=Math.floor(b);return(i?this.exaggeration():1)*ut(ut(_.get(E,C),_.get(E,C+1),b-C),ut(_.get(E+1,C),_.get(E+1,C+1),b-C),v-E)}getAtTileOffset(e,n,i){const a=1<<e.canonical.z;return this.getAtPointOrZero(new Gt(e.wrap+(e.canonical.x+n/le)/a,(e.canonical.y+i/le)/a))}getAtTileOffsetFunc(e,n,i,a){return l=>{const u=this.getAtTileOffset(e,l.x,l.y),d=a.upVector(e.canonical,l.x,l.y),f=a.upVectorScale(e.canonical,n,i).metersToTile;return G.scale(d,d,u*f),d}}getForTilePoints(e,n,i,a){if(this.isUsingMockSource())return!1;const l=Da.create(this,e,a);return!!l&&(n.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],i)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(e);if(!n||!n.dem)return null;const i=n.dem.tree,a=n.tileID,l=1<<e.canonical.z-a.canonical.z;let u=e.canonical.x/l-a.canonical.x,d=e.canonical.y/l-a.canonical.y,f=0;for(let p=0;p<e.canonical.z-a.canonical.z&&!i.leaves[f];p++){u*=2,d*=2;const g=2*Math.floor(d)+Math.floor(u);f=i.childOffsets[f]+g,u%=1,d%=1}return{min:this.exaggeration()*i.minimums[f],max:this.exaggeration()*i.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,n,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}class Da{constructor(e,n,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=i}static create(e,n,i){const a=i||e.findDEMTileFor(n);if(!a||!a.dem)return;const l=a.dem,u=a.tileID,d=1<<n.canonical.z-u.canonical.z;return new Da(a,l.dim/le/d,[(n.canonical.x/d-u.canonical.x)*l.dim,(n.canonical.y/d-u.canonical.y)*l.dim])}tileCoordToPixel(e,n){const i=n*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(i);return new ee(a,l)}getElevationAt(e,n,i,a){const l=e*this._scale+this._offset[0],u=n*this._scale+this._offset[1],d=Math.floor(l),f=Math.floor(u),p=this._dem;return a=!!a,i?ut(ut(p.get(d,f,a),p.get(d,f+1,a),u-f),ut(p.get(d+1,f,a),p.get(d+1,f+1,a),u-f),l-d):p.get(d,f,a)}getElevationAtPixel(e,n,i){return this._dem.get(e,n,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*vn(1,e)*this._dem.stride}}class Dv{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Gh(le,16,0),this.featureIndexArray=new hx,this.promoteId=n}insert(e,n,i,a,l,u=0){const d=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,a,l,u);const f=this.grid;for(let p=0;p<n.length;p++){const g=n[p],_=[1/0,1/0,-1/0,-1/0];for(let x=0;x<g.length;x++){const v=g[x];_[0]=Math.min(_[0],v.x),_[1]=Math.min(_[1],v.y),_[2]=Math.max(_[2],v.x),_[3]=Math.max(_[3],v.y)}_[0]<le&&_[1]<le&&_[2]>=0&&_[3]>=0&&f.insert(d,_[0],_[1],_[2],_[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new kp(new hr(this.rawTileData)).layers,this.sourceLayerCoder=new uE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,i,a){this.loadVTLayers();const l=e.params||{},u=Gy(l.filter),d=e.tileResult,f=e.transform,p=d.bufferedTilespaceBounds,g=this.grid.query(p.min.x,p.min.y,p.max.x,p.max.y,(b,E,C,T)=>cS(d.bufferedTilespaceGeometry,b,E,C,T));g.sort(_E);let _=null;f.elevation&&g.length>0&&(_=Da.create(f.elevation,this.tileID));const x={};let v;for(let b=0;b<g.length;b++){const E=g[b];if(E===v)continue;v=E;const C=this.featureIndexArray.get(E);let T=null;this.loadMatchingFeature(x,C,u,l.layers,l.availableImages,n,i,a,(D,A,P,I=0)=>(T||(T=pl(D,this.tileID.canonical,e.tileTransform)),A.queryIntersectsFeature(d,D,P,T,this.z,e.transform,e.pixelPosMatrix,_,I)))}return x}loadMatchingFeature(e,n,i,a,l,u,d,f,p){const{featureIndex:g,bucketIndex:_,sourceLayerIndex:x,layoutVertexArrayOffset:v}=n,b=this.bucketLayerIDs[_];if(a&&!function(D,A){for(let P=0;P<D.length;P++)if(A.indexOf(D[P])>=0)return!0;return!1}(a,b))return;const E=this.sourceLayerCoder.decode(x),C=this.vtLayers[E].feature(g);if(i.needGeometry){const D=qc(C,!0);if(!i.filter(new tr(this.tileID.overscaledZ),D,this.tileID.canonical))return}else if(!i.filter(new tr(this.tileID.overscaledZ),C))return;const T=this.getId(C,E);for(let D=0;D<b.length;D++){const A=b[D];if(a&&a.indexOf(A)<0)continue;const P=u[A];if(!P)continue;let I={};void 0!==T&&f&&(I=f.getState(P.sourceLayer||"_geojsonTileLayer",T));const R=qe({},d[A]);R.paint=gE(R.paint,P.paint,C,I,l),R.layout=gE(R.layout,P.layout,C,I,l);const k=!p||p(C,P,I,v);if(!k)continue;const L=new I_(C,this.z,this.x,this.y,T);L.layer=R;let N=e[A];void 0===N&&(N=e[A]=[]),N.push({featureIndex:g,feature:L,intersectionZ:k})}}lookupSymbolFeatures(e,n,i,a,l,u,d,f){const p={};this.loadVTLayers();const g=Gy(l);for(const _ of e)this.loadMatchingFeature(p,{bucketIndex:i,sourceLayerIndex:a,featureIndex:_,layoutVertexArrayOffset:0},g,u,d,f,n);return p}loadFeature(e){const{featureIndex:n,sourceLayerIndex:i}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(i),l=this.vtFeatures[a];if(l[n])return l[n];const u=this.vtLayers[a].feature(n);return l[n]=u,u}hasLayer(e){for(const n of this.bucketLayerIDs)for(const i of n)if(e===i)return!0;return!1}getId(e,n){let i=e.id;if(this.promoteId){const a="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=a&&(i=e.properties[a]),"boolean"==typeof i&&(i=Number(i))}return i}}function gE(t,e,n,i,a){return wh(t,(l,u)=>{const d=e instanceof Jf?e.get(u):null;return d&&d.evaluate?d.evaluate(n,i,a):d})}function _E(t,e){return e-t}Ge(Dv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const yE=sn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sv=sn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),zp=sn([{name:"a_projected_pos",components:4,type:"Float32"}],4);sn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const R_=sn([{name:"a_z_offset",components:1,type:"Float32"}],4),xE=sn([{name:"a_texb",components:2,type:"Uint16"}]),vE=sn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),CS=sn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);sn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const bE=sn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),DS=sn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);sn([{name:"triangle",components:3,type:"Uint16"}]),sn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),sn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),sn([{type:"Float32",name:"offsetX"}]),sn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var pi=24;const ra=128;function wE(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new tr(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:i,interpolationType:a}=n;let l=0;for(;l<i.length&&i[l]<=t;)l++;l=Math.max(0,l-1);let u=l;for(;u<i.length&&i[u]<t+1;)u++;u=Math.min(i.length-1,u);const d=i[l],f=i[u];return"composite"===n.kind?{kind:"composite",minZoom:d,maxZoom:f,interpolationType:a}:{kind:"camera",minZoom:d,maxZoom:f,minSize:n.evaluate(new tr(d)),maxSize:n.evaluate(new tr(f)),interpolationType:a}}}function Bp(t,{uSize:e,uSizeT:n},{lowerSize:i,upperSize:a}){return"source"===t.kind?i/ra:"composite"===t.kind?ut(i/ra,a/ra,n):e}function ec(t,e){let n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){const{interpolationType:a,minZoom:l,maxZoom:u}=t,d=a?We(_a.interpolationFactor(a,e,l,u),0,1):0;"camera"===t.kind?i=ut(t.minSize,t.maxSize,d):n=d}return{uSizeT:n,uSize:i}}var pR=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ra,evaluateSizeForFeature:Bp,evaluateSizeForZoom:ec,getSizeData:wE});function EE(t,e,n){return t.sections.forEach(i=>{i.text=function(a,l,u){const d=l.layout.get("text-transform").evaluate(u,{});return"uppercase"===d?a=a.toLocaleUpperCase():"lowercase"===d&&(a=a.toLocaleLowerCase()),ts.applyArabicShaping&&(a=ts.applyArabicShaping(a)),a}(i.text,e,n)}),t}const Md={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function mR(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function O_(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}const k_=3;function ME(t,e,n){e.glyphs=[],1===t&&n.readMessage(SS,e)}function SS(t,e,n){if(3===t){const{id:i,bitmap:a,width:l,height:u,left:d,top:f,advance:p}=n.readMessage(TE,{});e.glyphs.push({id:i,bitmap:new Xl({width:l+2*k_,height:u+2*k_},a),metrics:{width:l,height:u,left:d,top:f,advance:p}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function TE(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}const Iv=k_;function Yt(t){let e=0,n=0;for(const u of t)e+=u.w*u.h,n=Math.max(n,u.w);t.sort((u,d)=>d.h-u.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let a=0,l=0;for(const u of t)for(let d=i.length-1;d>=0;d--){const f=i[d];if(!(u.w>f.w||u.h>f.h)){if(u.x=f.x,u.y=f.y,l=Math.max(l,u.y+u.h),a=Math.max(a,u.x+u.w),u.w===f.w&&u.h===f.h){const p=i.pop();d<i.length&&(i[d]=p)}else u.h===f.h?(f.x+=u.w,f.w-=u.w):u.w===f.w?(f.y+=u.h,f.h-=u.h):(i.push({x:f.x+u.w,y:f.y,w:f.w-u.w,h:u.h}),f.y+=u.h,f.h-=u.h);break}}return{w:a,h:l,fill:e/(a*l)||0}}const ho=1;class L_{constructor(e,{pixelRatio:n,version:i,stretchX:a,stretchY:l,content:u}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=a,this.stretchY=l,this.content=u,this.version=i}get tl(){return[this.paddedRect.x+ho,this.paddedRect.y+ho]}get br(){return[this.paddedRect.x+this.paddedRect.w-ho,this.paddedRect.y+this.paddedRect.h-ho]}get displaySize(){return[(this.paddedRect.w-2*ho)/this.pixelRatio,(this.paddedRect.h-2*ho)/this.pixelRatio]}}class je{constructor(e,n){const i={},a={};this.haveRenderCallbacks=[];const l=[];this.addImages(e,i,l),this.addImages(n,a,l);const{w:u,h:d}=Yt(l),f=new ur({width:u||1,height:d||1});for(const p in e){const g=e[p],_=i[p].paddedRect;ur.copy(g.data,f,{x:0,y:0},{x:_.x+ho,y:_.y+ho},g.data)}for(const p in n){const g=n[p],_=a[p].paddedRect,x=_.x+ho,v=_.y+ho,b=g.data.width,E=g.data.height;ur.copy(g.data,f,{x:0,y:0},{x,y:v},g.data),ur.copy(g.data,f,{x:0,y:E-1},{x,y:v-1},{width:b,height:1}),ur.copy(g.data,f,{x:0,y:0},{x,y:v+E},{width:b,height:1}),ur.copy(g.data,f,{x:b-1,y:0},{x:x-1,y:v},{width:1,height:E}),ur.copy(g.data,f,{x:0,y:0},{x:x+b,y:v},{width:1,height:E})}this.image=f,this.iconPositions=i,this.patternPositions=a}addImages(e,n,i){for(const a in e){const l=e[a],u={x:0,y:0,w:l.data.width+2*ho,h:l.data.height+2*ho};i.push(u),n[a]=new L_(u,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,n,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,i)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const a in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[a],e.getImage(a,i),n),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a,i),n)}patchUpdatedImage(e,n,i){if(!e||!n||e.version===n.version)return;e.version=n.version;const[a,l]=e.tl;i.update(n.data,void 0,{x:a,y:l})}}Ge(L_,"ImagePosition"),Ge(je,"ImageAtlas");const Hn={horizontal:1,vertical:2,horizontalOnly:3},CE=-17;class Yc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const i=new Yc;return i.scale=e||1,i.fontStack=n,i}static forImage(e){const n=new Yc;return n.imageName=e,n}}class Sa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const i=new Sa;for(let a=0;a<e.sections.length;a++){const l=e.sections[a];l.image?i.addImageSection(l):i.addTextSection(l,n)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,i){let a="";for(let l=0;l<n.length;l++){const u=n.charCodeAt(l+1)||null,d=n.charCodeAt(l-1)||null;a+=!i&&(u&&Au(u)&&!Md[n[l+1]]||d&&Au(d)&&!Md[n[l-1]])||!Md[n[l]]?n[l]:Md[n[l]]}return a}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&Jc[this.text.charCodeAt(i)];i++)e++;let n=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Jc[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const i=new Sa;return i.text=this.text.substring(e,n),i.sectionIndex=this.sectionIndex.slice(e,n),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Yc.forText(e.scale,e.fontStack||n));const i=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(i)}addImageSection(e){const n=e.image?e.image.namePrimary:"";if(0===n.length)return void K("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(Yc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):K("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vp(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b){const E=Sa.fromFeature(t,a);_===Hn.vertical&&E.verticalizePunctuation(x);let C=[];const T=function(R,k,L,N,z,j){if(!R)return[];const B=[],H=function(te,W,X,re,oe,ce){let de=0;for(let ge=0;ge<te.length();ge++){const ae=te.getSection(ge);de+=F_(te.getCodePoint(ge),ae,re,oe,W,ce)}return de/Math.max(1,Math.ceil(de/X))}(R,k,L,N,z,j),V=R.text.indexOf("\u200b")>=0;let Z=0;for(let te=0;te<R.length();te++){const W=R.getSection(te),X=R.getCodePoint(te);if(Jc[X]||(Z+=F_(X,W,N,z,k,j)),te<R.length()-1){const re=!((Q=X)<11904||!(Je["Bopomofo Extended"](Q)||Je.Bopomofo(Q)||Je["CJK Compatibility Forms"](Q)||Je["CJK Compatibility Ideographs"](Q)||Je["CJK Compatibility"](Q)||Je["CJK Radicals Supplement"](Q)||Je["CJK Strokes"](Q)||Je["CJK Symbols and Punctuation"](Q)||Je["CJK Unified Ideographs Extension A"](Q)||Je["CJK Unified Ideographs"](Q)||Je["Enclosed CJK Letters and Months"](Q)||Je["Halfwidth and Fullwidth Forms"](Q)||Je.Hiragana(Q)||Je["Ideographic Description Characters"](Q)||Je["Kangxi Radicals"](Q)||Je["Katakana Phonetic Extensions"](Q)||Je.Katakana(Q)||Je["Vertical Forms"](Q)||Je["Yi Radicals"](Q)||Je["Yi Syllables"](Q)));(DE[X]||re||W.imageName)&&B.push(Pv(te+1,Z,H,B,Av(X,R.getCodePoint(te+1),re&&V),!1))}}var Q;return z_(Pv(R.length(),Z,H,B,0,!0))}(E,p,l,e,i,v),{processBidirectionalText:D,processStyledBidirectionalText:A}=ts;if(D&&1===E.sections.length){const R=D(E.toString(),T);for(const k of R){const L=new Sa;L.text=k,L.sections=E.sections;for(let N=0;N<k.length;N++)L.sectionIndex.push(0);C.push(L)}}else if(A){const R=A(E.text,E.sectionIndex,T);for(const k of R){const L=new Sa;L.text=k[0],L.sectionIndex=k[1],L.sections=E.sections,C.push(L)}}else C=function(R,k){const L=[],N=R.text;let z=0;for(const j of k)L.push(R.substring(z,j)),z=j;return z<N.length&&L.push(R.substring(z,N.length)),L}(E,T);const P=[],I={positionedLines:P,text:E.toString(),top:g[1],bottom:g[1],left:g[0],right:g[0],writingMode:_,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(R,k,L,N,z,j,B,H,V,Z,Q,te){let W=0,X=0,re=0;const oe="right"===H?1:"left"===H?0:.5;let ce=!1;for(const Ne of z){const ze=Ne.getSections();for(const Ve of ze){if(Ve.imageName)continue;const Ke=k[Ve.fontStack];if(Ke&&(ce=void 0!==Ke.ascender&&void 0!==Ke.descender,!ce))break}if(!ce)break}let de=0;for(const Ne of z){Ne.trim();const ze=Ne.getMaxScale(),Ve=(ze-1)*pi,Ke={positionedGlyphs:[],lineOffset:0};R.positionedLines[de]=Ke;const ht=Ke.positionedGlyphs;let Ot=0;if(!Ne.length()){X+=j,++de;continue}let Xt=0,Tt=0;for(let ct=0;ct<Ne.length();ct++){const it=Ne.getSection(ct),Nt=Ne.getSectionIndex(ct),Kt=Ne.getCodePoint(ct);let Rt=it.scale,Sn=null,or=null,Gn=null,kn=pi,Vr=0;const Kn=!(V===Hn.horizontal||!Q&&!Rg(Kt)||Q&&(Jc[Kt]||(ge=Kt,Je.Arabic(ge)||Je["Arabic Supplement"](ge)||Je["Arabic Extended-A"](ge)||Je["Arabic Presentation Forms-A"](ge)||Je["Arabic Presentation Forms-B"](ge))));if(it.imageName){const qn=N[it.imageName];if(!qn)continue;Gn=it.imageName,R.iconsInText=R.iconsInText||!0,or=qn.paddedRect;const Tn=qn.displaySize;Rt=Rt*pi/te,Sn={width:Tn[0],height:Tn[1],left:ho,top:-Iv,advance:Kn?Tn[1]:Tn[0],localGlyph:!1},Vr=ce?-Sn.height*Rt:CE+ze*pi-Tn[1]*Rt,kn=Sn.advance;const So=(Kn?Tn[0]:Tn[1])*Rt-pi*ze;So>0&&So>Ot&&(Ot=So)}else{const qn=L[it.fontStack];if(!qn)continue;qn[Kt]&&(or=qn[Kt]);const Tn=k[it.fontStack];if(!Tn)continue;const So=Tn.glyphs[Kt];if(!So)continue;if(Sn=So.metrics,kn=8203!==Kt?pi:0,ce){const Ba=void 0!==Tn.ascender?Math.abs(Tn.ascender):0,$o=void 0!==Tn.descender?Math.abs(Tn.descender):0,wl=(Ba+$o)*Rt;Xt<wl&&(Xt=wl,Tt=(Ba-$o)/2*Rt),Vr=-Ba*Rt}else Vr=CE+(ze-Rt)*pi}Kn?(R.verticalizable=!0,ht.push({glyph:Kt,imageName:Gn,x:W,y:X+Vr,vertical:Kn,scale:Rt,localGlyph:Sn.localGlyph,fontStack:it.fontStack,sectionIndex:Nt,metrics:Sn,rect:or}),W+=kn*Rt+Z):(ht.push({glyph:Kt,imageName:Gn,x:W,y:X+Vr,vertical:Kn,scale:Rt,localGlyph:Sn.localGlyph,fontStack:it.fontStack,sectionIndex:Nt,metrics:Sn,rect:or}),W+=Sn.advance*Rt+Z)}0!==ht.length&&(re=Math.max(W-Z,re),ce?SE(ht,oe,Ot,Tt,j*ze/2):SE(ht,oe,Ot,0,j/2)),W=0;const vt=j*ze+Ot;Ke.lineOffset=Math.max(Ot,Ve),X+=vt,++de}var ge;const ae=X,{horizontalAlign:ue,verticalAlign:Se}=B_(B);(function(Ne,ze,Ve,Ke,ht,Ot){const Xt=(ze-Ve)*ht,Tt=-Ot*Ke;for(const vt of Ne)for(const ct of vt.positionedGlyphs)ct.x+=Xt,ct.y+=Tt})(R.positionedLines,oe,ue,Se,re,ae),R.top+=-Se*ae,R.bottom=R.top+ae,R.left+=-ue*re,R.right=R.left+re,R.hasBaseline=ce}(I,e,n,i,C,u,d,f,_,p,x,b),!function(R){for(const k of R)if(0!==k.positionedGlyphs.length)return!1;return!0}(P)&&I}const Jc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},DE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function F_(t,e,n,i,a,l){if(e.imageName){const u=i[e.imageName];return u?u.displaySize[0]*e.scale*pi/l+a:0}{const u=n[e.fontStack],d=u&&u.glyphs[t];return d?d.metrics.advance*e.scale+a:0}}function N_(t,e,n,i){const a=Math.pow(t-e,2);return i?t<e?a/2:2*a:a+Math.abs(n)*n}function Av(t,e,n){let i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function Pv(t,e,n,i,a,l){let u=null,d=N_(e,n,a,l);for(const f of i){const p=N_(e-f.x,n,a,l)+f.badness;p<=d&&(u=f,d=p)}return{index:t,x:e,priorBreak:u,badness:d}}function z_(t){return t?z_(t.priorBreak).concat(t.index):[]}function B_(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function SE(t,e,n,i,a){if(!(e||n||i||a))return;const l=t.length-1,u=t[l],d=(u.x+u.metrics.advance*u.scale)*e;for(let f=0;f<=l;f++)t[f].x-=d,t[f].y+=n+i+a}function IS(t,e,n,i){const{horizontalAlign:a,verticalAlign:l}=B_(i),u=n[0]-t.displaySize[0]*a,d=n[1]-t.displaySize[1]*l;return{imagePrimary:t,imageSecondary:e,top:d,bottom:d+t.displaySize[1],left:u,right:u+t.displaySize[0]}}function Rv(t,e,n,i,a,l){const u=t.imagePrimary;let d;if(u.content){const C=u.content,T=u.pixelRatio||1;d=[C[0]/T,C[1]/T,u.displaySize[0]-C[2]/T,u.displaySize[1]-C[3]/T]}const f=e.left*l,p=e.right*l;let g,_,x,v;"width"===n||"both"===n?(v=a[0]+f-i[3],_=a[0]+p+i[1]):(v=a[0]+(f+p-u.displaySize[0])/2,_=v+u.displaySize[0]);const b=e.top*l,E=e.bottom*l;return"height"===n||"both"===n?(g=a[1]+b-i[0],x=a[1]+E+i[2]):(g=a[1]+(b+E-u.displaySize[1])/2,x=g+u.displaySize[1]),{imagePrimary:u,imageSecondary:void 0,top:g,right:_,bottom:x,left:v,collisionPadding:d}}class tc extends ee{constructor(e,n,i,a,l){super(e,n),this.angle=a,this.z=i,void 0!==l&&(this.segment=l)}clone(){return new tc(this.x,this.y,this.z,this.angle,this.segment)}}function IE(t,e,n,i,a){if(void 0===e.segment)return!0;let l=e,u=e.segment+1,d=0;for(;d>-n/2;){if(u--,u<0)return!1;d-=t[u].dist(l),l=t[u]}d+=t[u].dist(t[u+1]),u++;const f=[];let p=0;for(;d<n/2;){const g=t[u],_=t[u+1];if(!_)return!1;let x=t[u-1].angleTo(g)-g.angleTo(_);for(x=Math.abs((x+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:d,angleDelta:x}),p+=x;d-f[0].distance>i;)p-=f.shift().angleDelta;if(p>a)return!1;u++,d+=g.dist(_)}return!0}function AE(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function PE(t,e,n){return t?.6*e*n:0}function Ov(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function RE(t,e,n,i,a,l){const u=PE(n,a,l),d=Ov(n,i)*l;let f=0;const p=AE(t)/2;for(let g=0;g<t.length-1;g++){const _=t[g],x=t[g+1],v=_.dist(x);if(f+v>p){const b=(p-f)/v,E=ut(_.x,x.x,b),C=ut(_.y,x.y,b),T=new tc(E,C,0,x.angleTo(_),g);return!u||IE(t,T,d,u,e)?T:void 0}f+=v}}function AS(t,e,n,i,a,l,u,d,f){const p=PE(i,l,u),g=Ov(i,a),_=g*u,x=0===t[0].x||t[0].x===f||0===t[0].y||t[0].y===f;return e-_<e/4&&(e=_+e/4),OE(t,x?e/2*d%e:(g/2+2*l)*u*d%e,e,p,n,_,x,!1,f)}function OE(t,e,n,i,a,l,u,d,f){const p=l/2,g=AE(t);let _=0,x=e-n,v=[];for(let b=0;b<t.length-1;b++){const E=t[b],C=t[b+1],T=E.dist(C),D=C.angleTo(E);for(;x+n<_+T;){x+=n;const A=(x-_)/T,P=ut(E.x,C.x,A),I=ut(E.y,C.y,A);if(P>=0&&P<f&&I>=0&&I<f&&x-p>=0&&x+p<=g){const R=new tc(P,I,0,D,b);i&&!IE(t,R,l,i,a)||v.push(R)}}_+=T}return d||v.length||u||(v=OE(t,_/2,n,i,a,l,u,!0,f)),v}function hs(t,e,n,i,a){const l=[];for(let u=0;u<t.length;u++){const d=t[u];let f;for(let p=0;p<d.length-1;p++){let g=d[p],_=d[p+1];g.x<e&&_.x<e||(g.x<e?g=new ee(e,g.y+(e-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x<e&&(_=new ee(e,g.y+(e-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y<n&&_.y<n||(g.y<n?g=new ee(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round():_.y<n&&(_=new ee(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round()),g.x>=i&&_.x>=i||(g.x>=i?g=new ee(i,g.y+(i-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x>=i&&(_=new ee(i,g.y+(i-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y>=a&&_.y>=a||(g.y>=a?g=new ee(g.x+(a-g.y)/(_.y-g.y)*(_.x-g.x),a)._round():_.y>=a&&(_=new ee(g.x+(a-g.y)/(_.y-g.y)*(_.x-g.x),a)._round()),f&&g.equals(f[f.length-1])||(f=[g],l.push(f)),f.push(_)))))}}return l}Ge(tc,"Anchor");const jp=1e20;function kE(t,e,n,i,a,l,u,d,f){for(let p=e;p<e+i;p++)PS(t,n*l+p,l,a,u,d,f);for(let p=n;p<n+a;p++)PS(t,p*l+e,1,i,u,d,f)}function PS(t,e,n,i,a,l,u){l[0]=0,u[0]=-jp,u[1]=jp,a[0]=t[e];for(let d=1,f=0,p=0;d<i;d++){a[d]=t[e+d*n];const g=d*d;do{const _=l[f];p=(a[d]-a[_]+g-_*_)/(d-_)/2}while(p<=u[f]&&--f>-1);f++,l[f]=d,u[f]=p,u[f+1]=jp}for(let d=0,f=0;d<i;d++){for(;u[f+1]<d;)f++;const p=l[f],g=d-p;t[e+d*n]=a[p]+g*g}}const Fs=2;class Ku{constructor(e,n,i){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,i){const a=[],l=this.urls[n]||kt.GLYPHS_URL;for(const u in e)for(const d of e[u])a.push({stack:u,id:d});vu(a,({stack:u,id:d},f)=>{let p=this.entries[u];p||(p=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=p.glyphs[d];if(void 0!==g)return void f(null,{stack:u,id:d,glyph:g});if(g=this._tinySDF(p,u,d),g)return p.glyphs[d]=g,void f(null,{stack:u,id:d,glyph:g});const _=Math.floor(d/256);if(256*_>65535)return void f(new Error("glyphs > 65535 not supported"));if(p.ranges[_])return void f(null,{stack:u,id:d,glyph:g});let x=p.requests[_];x||(x=p.requests[_]=[],Ku.loadGlyphRange(u,_,l,this.requestManager,(v,b)=>{if(b){p.ascender=b.ascender,p.descender=b.descender;for(const E in b.glyphs)this._doesCharSupportLocalGlyph(+E)||(p.glyphs[+E]=b.glyphs[+E]);p.ranges[_]=!0}for(const E of x)E(v,b);delete p.requests[_]})),x.push((v,b)=>{v?f(v):b&&f(null,{stack:u,id:d,glyph:b.glyphs[d]||null})})},(u,d)=>{if(u)i(u);else if(d){const f={};for(const{stack:p,id:g,glyph:_}of d)void 0===f[p]&&(f[p]={}),void 0===f[p].glyphs&&(f[p].glyphs={}),f[p].glyphs[g]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},f[p].ascender=this.entries[p].ascender,f[p].descender=this.entries[p].descender;i(null,f)}})}_doesCharSupportLocalGlyph(e){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(Je["CJK Unified Ideographs"](e)||Je["Hangul Syllables"](e)||Je.Hiragana(e)||Je.Katakana(e)||Je["CJK Symbols and Punctuation"](e)||Je["CJK Unified Ideographs Extension A"](e)||Je["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,i){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(i))return;let l=e.tinySDF;if(!l){let E="400";/bold/i.test(n)?E="900":/medium/i.test(n)?E="500":/light/i.test(n)&&(E="200"),l=e.tinySDF=new Ku.TinySDF({fontFamily:a,fontWeight:E,fontSize:24*Fs,buffer:3*Fs,radius:8*Fs}),l.fontWeight=E}if(this.localGlyphs[l.fontWeight][i])return this.localGlyphs[l.fontWeight][i];const u=String.fromCodePoint(i),{data:d,width:f,height:p,glyphWidth:g,glyphHeight:_,glyphLeft:x,glyphTop:v,glyphAdvance:b}=l.draw(u);return this.localGlyphs[l.fontWeight][i]={id:i,bitmap:new Xl({width:f,height:p},d),metrics:{width:g/Fs,height:_/Fs,left:x/Fs,top:v/Fs-27,advance:b/Fs,localGlyph:!0}}}}Ku.loadGlyphRange=function(t,e,n,i,a){const l=256*e,u=l+255,d=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${l}-${u}`),fe.Glyphs);ke(d,(f,p)=>{if(f)a(f);else if(p){const g={},_=new hr(p).readFields(ME,{});for(const x of _.glyphs)g[x.id]=x;a(null,{glyphs:g,ascender:_.ascender,descender:_.descender})}})},Ku.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:u="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;const d=this.size=t+4*e,f=this._createCanvas(d),p=this.ctx=f.getContext("2d",{willReadFrequently:!0});p.font=`${u} ${l} ${t}px ${a}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(t),u=Math.ceil(n),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),f=Math.min(this.size-this.buffer,u+Math.ceil(i)),p=d+2*this.buffer,g=f+2*this.buffer,_=Math.max(p*g,0),x=new Uint8ClampedArray(_),v={data:x,width:p,height:g,glyphWidth:d,glyphHeight:f,glyphTop:u,glyphLeft:0,glyphAdvance:e};if(0===d||0===f)return v;const{ctx:b,buffer:E,gridInner:C,gridOuter:T}=this;b.clearRect(E,E,d,f),b.fillText(t,E,E+u);const D=b.getImageData(E,E,d,f);T.fill(jp,0,_),C.fill(0,0,_);for(let A=0;A<f;A++)for(let P=0;P<d;P++){const I=D.data[4*(A*d+P)+3]/255;if(0===I)continue;const R=(A+E)*p+P+E;if(1===I)T[R]=0,C[R]=jp;else{const k=.5-I;T[R]=k>0?k*k:0,C[R]=k<0?k*k:0}}kE(T,0,0,p,g,p,this.f,this.v,this.z),kE(C,E,E,d,f,p,this.f,this.v,this.z);for(let A=0;A<_;A++){const P=Math.sqrt(T[A])-Math.sqrt(C[A]);x[A]=Math.round(255-255*(P/this.radius+this.cutoff))}return v}};const Kc=ho;function LE(t,e,n,i){const a=[],l=t.imagePrimary,u=l.pixelRatio,d=l.paddedRect.w-2*Kc,f=l.paddedRect.h-2*Kc,p=t.right-t.left,g=t.bottom-t.top,_=l.stretchX||[[0,d]],x=l.stretchY||[[0,f]],v=(j,B)=>j+B[1]-B[0],b=_.reduce(v,0),E=x.reduce(v,0),C=d-b,T=f-E;let D=0,A=b,P=0,I=E,R=0,k=C,L=0,N=T;if(l.content&&i){const j=l.content;D=V_(_,0,j[0]),P=V_(x,0,j[1]),A=V_(_,j[0],j[2]),I=V_(x,j[1],j[3]),R=j[0]-D,L=j[1]-P,k=j[2]-j[0]-A,N=j[3]-j[1]-I}const z=(j,B,H,V)=>{const Z=j_(j.stretch-D,A,p,t.left),Q=U_(j.fixed-R,k,j.stretch,b),te=j_(B.stretch-P,I,g,t.top),W=U_(B.fixed-L,N,B.stretch,E),X=j_(H.stretch-D,A,p,t.left),re=U_(H.fixed-R,k,H.stretch,b),oe=j_(V.stretch-P,I,g,t.top),ce=U_(V.fixed-L,N,V.stretch,E),de=new ee(Z,te),ge=new ee(X,te),ae=new ee(X,oe),ue=new ee(Z,oe),Se=new ee(Q/u,W/u),Ne=new ee(re/u,ce/u),ze=e*Math.PI/180;if(ze){const Tt=Math.sin(ze),vt=Math.cos(ze),ct=[vt,-Tt,Tt,vt];de._matMult(ct),ge._matMult(ct),ue._matMult(ct),ae._matMult(ct)}const Ve=j.stretch+j.fixed,Ke=H.stretch+H.fixed,ht=B.stretch+B.fixed,Ot=V.stretch+V.fixed,Xt=t.imageSecondary;return{tl:de,tr:ge,bl:ue,br:ae,texPrimary:{x:l.paddedRect.x+Kc+Ve,y:l.paddedRect.y+Kc+ht,w:Ke-Ve,h:Ot-ht},texSecondary:Xt?{x:Xt.paddedRect.x+Kc+Ve,y:Xt.paddedRect.y+Kc+ht,w:Ke-Ve,h:Ot-ht}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Se,pixelOffsetBR:Ne,minFontScaleX:k/u/p,minFontScaleY:N/u/g,isSDF:n}};if(i&&(l.stretchX||l.stretchY)){const j=kv(_,C,b),B=kv(x,T,E);for(let H=0;H<j.length-1;H++){const V=j[H],Z=j[H+1];for(let Q=0;Q<B.length-1;Q++)a.push(z(V,B[Q],Z,B[Q+1]))}}else a.push(z({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:d+1},{fixed:0,stretch:f+1}));return a}function V_(t,e,n){let i=0;for(const a of t)i+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]));return i}function kv(t,e,n){const i=[{fixed:-Kc,stretch:0}];for(const[a,l]of t){const u=i[i.length-1];i.push({fixed:a-u.stretch,stretch:u.stretch}),i.push({fixed:a-u.stretch,stretch:u.stretch+(l-a)})}return i.push({fixed:e+Kc,stretch:n}),i}function j_(t,e,n,i){return t/e*n+i}function U_(t,e,n,i){return t-e*n/i}function Lv(t,e,n,i){const a=e+t.positionedLines[i].lineOffset;return 0===i?n+a/2:n+(a+(e+t.positionedLines[i-1].lineOffset))/2}function RS(t,e=1,n=!1){let i=1/0,a=1/0,l=-1/0,u=-1/0;const d=t[0];for(let v=0;v<d.length;v++){const b=d[v];(!v||b.x<i)&&(i=b.x),(!v||b.y<a)&&(a=b.y),(!v||b.x>l)&&(l=b.x),(!v||b.y>u)&&(u=b.y)}const f=Math.min(l-i,u-a);let p=f/2;const g=new Ff([],OS);if(0===f)return new ee(i,a);for(let v=i;v<l;v+=f)for(let b=a;b<u;b+=f)g.push(new Td(v+p,b+p,p,t));let _=function(v){let b=0,E=0,C=0;const T=v[0];for(let D=0,A=T.length,P=A-1;D<A;P=D++){const I=T[D],R=T[P],k=I.x*R.y-R.x*I.y;E+=(I.x+R.x)*k,C+=(I.y+R.y)*k,b+=3*k}return new Td(E/b,C/b,0,v)}(t),x=g.length;for(;g.length;){const v=g.pop();(v.d>_.d||!_.d)&&(_=v,n&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,x)),v.max-_.d<=e||(p=v.h/2,g.push(new Td(v.p.x-p,v.p.y-p,p,t)),g.push(new Td(v.p.x+p,v.p.y-p,p,t)),g.push(new Td(v.p.x-p,v.p.y+p,p,t)),g.push(new Td(v.p.x+p,v.p.y+p,p,t)),x+=4)}return n&&(console.log(`num probes: ${x}`),console.log(`best distance: ${_.d}`)),_.p}function OS(t,e){return e.max-t.max}class Td{constructor(e,n,i,a){this.p=new ee(e,n),this.h=i,this.d=function(l,u){let d=!1,f=1/0;for(let p=0;p<u.length;p++){const g=u[p];for(let _=0,x=g.length,v=x-1;_<x;v=_++){const b=g[_],E=g[v];b.y>l.y!=E.y>l.y&&l.x<(E.x-b.x)*(l.y-b.y)/(E.y-b.y)+b.x&&(d=!d),f=Math.min(f,Qx(l,b,E))}}return(d?1:-1)*Math.sqrt(f)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const Cd=7,Fv=Number.POSITIVE_INFINITY,_l=Math.sqrt(2);function Up(t,[e,n]){let i=0,a=0;if(n===Fv){e<0&&(e=0);const l=e/_l;switch(t){case"top-right":case"top-left":a=l-Cd;break;case"bottom-right":case"bottom-left":a=-l+Cd;break;case"bottom":a=-e+Cd;break;case"top":a=e-Cd}switch(t){case"top-right":case"bottom-right":i=-l;break;case"top-left":case"bottom-left":i=l;break;case"left":i=e;break;case"right":i=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":a=n-Cd;break;case"bottom-right":case"bottom-left":case"bottom":a=-n+Cd}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}}return[i,a]}function kS(t,e,n,i,a,l,u,d,f,p,g){t.createArrays(),t.tilePixelRatio=le/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const _=t.layers[0].layout,x=t.layers[0]._unevaluatedLayout._values,v={};if("composite"===t.textSizeData.kind){const{minZoom:T,maxZoom:D}=t.textSizeData;v.compositeTextSizes=[x["text-size"].possiblyEvaluate(new tr(T),d),x["text-size"].possiblyEvaluate(new tr(D),d)]}if("composite"===t.iconSizeData.kind){const{minZoom:T,maxZoom:D}=t.iconSizeData;v.compositeIconSizes=[x["icon-size"].possiblyEvaluate(new tr(T),d),x["icon-size"].possiblyEvaluate(new tr(D),d)]}v.layoutTextSize=x["text-size"].possiblyEvaluate(new tr(f+1),d),v.layoutIconSize=x["icon-size"].possiblyEvaluate(new tr(f+1),d),v.textMaxSize=x["text-size"].possiblyEvaluate(new tr(18),d);const b="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement"),E=_.get("text-size");let C=!1;for(const T of t.features)if(T.icon&&T.icon.nameSecondary){C=!0;break}for(const T of t.features){const D=_.get("text-font").evaluate(T,{},d).join(","),A=E.evaluate(T,{},d),P=v.layoutTextSize.evaluate(T,{},d),I=(v.layoutIconSize.evaluate(T,{},d),{horizontal:{},vertical:void 0}),R=T.text;let k,L=[0,0];if(R){const j=R.toString(),B=_.get("text-letter-spacing").evaluate(T,{},d)*pi,H=_.get("text-line-height").evaluate(T,{},d)*pi,V=PD(j)?B:0,Z=_.get("text-anchor").evaluate(T,{},d),Q=_.get("text-variable-anchor");if(!Q){const oe=_.get("text-radial-offset").evaluate(T,{},d);L=oe?Up(Z,[oe*pi,Fv]):_.get("text-offset").evaluate(T,{},d).map(ce=>ce*pi)}let te=b?"center":_.get("text-justify").evaluate(T,{},d);const W="point"===_.get("symbol-placement"),X=W?_.get("text-max-width").evaluate(T,{},d)*pi:1/0,re=oe=>{t.allowVerticalPlacement&&tx(j)&&(I.vertical=Vp(R,e,n,a,D,X,H,Z,oe,V,L,Hn.vertical,!0,P,A))};if(!b&&Q){const oe="auto"===te?Q.map(de=>$_(de)):[te];let ce=!1;for(let de=0;de<oe.length;de++){const ge=oe[de];if(!I.horizontal[ge])if(ce)I.horizontal[ge]=I.horizontal[0];else{const ae=Vp(R,e,n,a,D,X,H,"center",ge,V,L,Hn.horizontal,!1,P,A);ae&&(I.horizontal[ge]=ae,ce=1===ae.positionedLines.length)}}re("left")}else{if("auto"===te&&(te=$_(Z)),W||_.get("text-writing-mode").indexOf("horizontal")>=0||!tx(j)){const oe=Vp(R,e,n,a,D,X,H,Z,te,V,L,Hn.horizontal,!1,P,A);oe&&(I.horizontal[te]=oe)}re(W?"left":te)}}let N=!1;if(T.icon&&T.icon.namePrimary){const j=i[T.icon.namePrimary];j&&(k=IS(a[T.icon.namePrimary],T.icon.nameSecondary?a[T.icon.nameSecondary]:void 0,_.get("icon-offset").evaluate(T,{},d),_.get("icon-anchor").evaluate(T,{},d)),N=j.sdf,void 0===t.sdfIcons?t.sdfIcons=j.sdf:t.sdfIcons!==j.sdf&&K("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==t.pixelRatio||0!==_.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const z=H_(I.horizontal)||I.vertical;t.iconsInText||(t.iconsInText=!!z&&z.iconsInText),(z||k)&&LS(t,T,I,k,i,v,P,0,L,N,u,d,p,g,C)}l&&t.generateCollisionDebugBuffers(f,t.collisionBoxArray)}function $_(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function LS(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b){let E=l.textMaxSize.evaluate(e,{},_);void 0===E&&(E=u);const C=t.layers[0].layout,T=C.get("icon-offset").evaluate(e,{},_),D=H_(n.horizontal)||n.vertical,A="globe"===x.name,P=pi,I=u/P,R=t.tilePixelRatio*E/P,k=(Z=t.overscaling,t.zoom>18&&Z>2&&(Z>>=1),Math.max(le/(512*Z),1)*C.get("symbol-spacing")),L=C.get("text-padding")*t.tilePixelRatio,N=C.get("icon-padding")*t.tilePixelRatio,z=Et(C.get("text-max-angle")),j="map"===C.get("text-rotation-alignment")&&"point"!==C.get("symbol-placement"),B="map"===C.get("icon-rotation-alignment")&&"point"!==C.get("symbol-placement"),H=C.get("symbol-placement"),V=k/2;var Z;const Q=C.get("icon-text-fit").evaluate(e,{},_),te=C.get("icon-text-fit-padding").evaluate(e,{},_),W="none"!==Q;let X;!1===t.hasAnyIconTextFit&&W&&(t.hasAnyIconTextFit=!0),i&&W&&(t.allowVerticalPlacement&&n.vertical&&(X=Rv(i,n.vertical,Q,te,T,I)),D&&(i=Rv(i,D,Q,te,T,I)));const re=(oe,ce,de)=>{if(ce.x<0||ce.x>=le||ce.y<0||ce.y>=le)return;let ge=null;if(A){const{x:ae,y:ue,z:Se}=x.projectTilePoint(ce.x,ce.y,de);ge={anchor:new tc(ae,ue,Se,0,void 0),up:x.upVector(de,ce.x,ce.y)}}!function(ae,ue,Se,Ne,ze,Ve,Ke,ht,Ot,Xt,Tt,vt,ct,it,Nt,Kt,Rt,Sn,or,Gn,kn,Vr,Kn,qn,Tn,So,Ba){const $o=ae.addToLineVertexArray(ue,Ne);let wl,ch,uh,W0,X0,Y0,Om,r3=0,i3=0,o3=0,Eb=0,Mb=-1,Tb=-1;const El={};let aC=Jg("");const cu=Se?Se.anchor:ue,J0="none"!==Ot.layout.get("icon-text-fit").evaluate(kn,{},Tn);let K0=0,Cb=0;if(void 0===Ot._unevaluatedLayout.getValue("text-radial-offset")?[K0,Cb]=Ot.layout.get("text-offset").evaluate(kn,{},Tn).map(Bs=>Bs*pi):(K0=Ot.layout.get("text-radial-offset").evaluate(kn,{},Tn)*pi,Cb=Fv),ae.allowVerticalPlacement&&ze.vertical){const Bs=ze.vertical;if(Nt)Y0=G_(Bs),ht&&(Om=G_(ht));else{const Ho=Ot.layout.get("text-rotate").evaluate(kn,{},Tn)+90;uh=Nv(Xt,cu,ue,Tt,vt,ct,Bs,it,Ho,Kt),ht&&(W0=Nv(Xt,cu,ue,Tt,vt,ct,ht,Sn,Ho))}}if(Ve){const Bs=Ot.layout.get("icon-rotate").evaluate(kn,{},Tn),Ho=LE(Ve,Bs,Kn,J0),Ml=ht?LE(ht,Bs,Kn,J0):void 0;ch=Nv(Xt,cu,ue,Tt,vt,ct,Ve,Sn,Bs),r3=4*Ho.length;const lC=ae.iconSizeData;let hh=null;"source"===lC.kind?(hh=[ra*Ot.layout.get("icon-size").evaluate(kn,{},Tn)],hh[0]>nc&&K(`${ae.layerIds[0]}: Value for "icon-size" is >= ${Dd}. Reduce your "icon-size".`)):"composite"===lC.kind&&(hh=[ra*Vr.compositeIconSizes[0].evaluate(kn,{},Tn),ra*Vr.compositeIconSizes[1].evaluate(kn,{},Tn)],(hh[0]>nc||hh[1]>nc)&&K(`${ae.layerIds[0]}: Value for "icon-size" is >= ${Dd}. Reduce your "icon-size".`)),ae.addSymbols(ae.icon,Ho,hh,Gn,or,kn,!1,Se,ue,$o.lineStartIndex,$o.lineLength,-1,qn,Tn,So,Ba),Mb=ae.icon.placedSymbolArray.length-1,Ml&&(i3=4*Ml.length,ae.addSymbols(ae.icon,Ml,hh,Gn,or,kn,Hn.vertical,Se,ue,$o.lineStartIndex,$o.lineLength,-1,qn,Tn,So,Ba),Tb=ae.icon.placedSymbolArray.length-1)}for(const Bs in ze.horizontal){const Ho=ze.horizontal[Bs];wl||(aC=Jg(Ho.text),Nt?X0=G_(Ho):wl=Nv(Xt,cu,ue,Tt,vt,ct,Ho,it,Ot.layout.get("text-rotate").evaluate(kn,{},Tn),Kt));const Ml=1===Ho.positionedLines.length;if(o3+=$p(ae,Se,ue,Ho,Ke,Ot,Nt,kn,Kt,$o,ze.vertical?Hn.horizontal:Hn.horizontalOnly,Ml?Object.keys(ze.horizontal):[Bs],El,Mb,Vr,qn,Tn,So),Ml)break}ze.vertical&&(Eb+=$p(ae,Se,ue,ze.vertical,Ke,Ot,Nt,kn,Kt,$o,Hn.vertical,["vertical"],El,Tb,Vr,qn,Tn,So));let uu=-1;const Q0=(Bs,Ho)=>Bs?Math.max(Bs,Ho):Ho;uu=Q0(X0,uu),uu=Q0(Y0,uu),uu=Q0(Om,uu);const ey=uu>-1?1:0;ae.glyphOffsetArray.length>=Xp.MAX_GLYPHS&&K("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==kn.sortKey&&ae.addToSortKeyRanges(ae.symbolInstances.length,kn.sortKey),ae.symbolInstances.emplaceBack(ue.x,ue.y,cu.x,cu.y,cu.z,El.right>=0?El.right:-1,El.center>=0?El.center:-1,El.left>=0?El.left:-1,El.vertical>=0?El.vertical:-1,Mb,Tb,aC,void 0!==wl?wl:ae.collisionBoxArray.length,void 0!==wl?wl+1:ae.collisionBoxArray.length,void 0!==uh?uh:ae.collisionBoxArray.length,void 0!==uh?uh+1:ae.collisionBoxArray.length,void 0!==ch?ch:ae.collisionBoxArray.length,void 0!==ch?ch+1:ae.collisionBoxArray.length,W0||ae.collisionBoxArray.length,W0?W0+1:ae.collisionBoxArray.length,Tt,o3,Eb,r3,i3,ey,0,K0,Cb,uu,0,J0?1:0)}(t,ce,ge,oe,n,i,a,X,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,L,j,f,0,N,B,T,e,l,p,g,_,v,b)};if("line"===H)for(const oe of hs(e.geometry,0,0,le,le)){const ce=AS(oe,k,z,n.vertical||D,i,P,R,t.overscaling,le);for(const de of ce)D&&FE(t,D.text,V,de)||re(oe,de,_)}else if("line-center"===H){for(const oe of e.geometry)if(oe.length>1){const ce=RE(oe,z,n.vertical||D,i,P,R);ce&&re(oe,ce,_)}}else if("Polygon"===e.type)for(const oe of yd(e.geometry,0)){const ce=RS(oe,16);re(oe[0],new tc(ce.x,ce.y,0,0,void 0),_)}else if("LineString"===e.type)for(const oe of e.geometry)re(oe,new tc(oe[0].x,oe[0].y,0,0,void 0),_);else if("Point"===e.type)for(const oe of e.geometry)for(const ce of oe)re([ce],new tc(ce.x,ce.y,0,0,void 0),_)}const Dd=255,nc=Dd*ra;function $p(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T){const D=function(I,R,k,L,N,z,j,B){const H=[];if(0===R.positionedLines.length)return H;const V=L.layout.get("text-rotate").evaluate(z,{})*Math.PI/180,Z=function(re){const oe=re[0],ce=re[1],de=oe*ce;return de>0?[oe,-ce]:de<0?[-oe,ce]:0===oe?[ce,oe]:[ce,-oe]}(k);let Q=Math.abs(R.top-R.bottom);for(const re of R.positionedLines)Q-=re.lineOffset;const te=R.positionedLines.length,W=Q/te;let X=R.top-k[1];for(let re=0;re<te;++re){const oe=R.positionedLines[re];X=Lv(R,W,X,re);for(const ce of oe.positionedGlyphs){if(!ce.rect)continue;const de=ce.rect||{};let ge=Iv+1,ae=!0,ue=1,Se=0;if(ce.imageName){const Gn=j[ce.imageName];if(!Gn)continue;if(Gn.sdf){K("SDF images are not supported in formatted text and will be ignored.");continue}ae=!1,ue=Gn.pixelRatio,ge=ho/ue}const Ne=(N||B)&&ce.vertical,ze=ce.metrics.advance*ce.scale/2,Ve=ce.metrics,Ke=ce.rect;if(null===Ke)continue;B&&R.verticalizable&&(Se=ce.imageName?ze-ce.metrics.width*ce.scale/2:0);const ht=N?[ce.x+ze,ce.y]:[0,0];let Ot=[0,0],Xt=[0,0],Tt=!1;N||(Ne?(Xt=[ce.x+ze+Z[0],ce.y+Z[1]-Se],Tt=!0):Ot=[ce.x+ze+k[0],ce.y+k[1]-Se]);const vt=Ke.w*ce.scale/(ue*(ce.localGlyph?Fs:1)),ct=Ke.h*ce.scale/(ue*(ce.localGlyph?Fs:1));let it,Nt,Kt,Rt;if(Ne){const Gn=ce.y-X,kn=new ee(-ze,ze-Gn),Vr=-Math.PI/2,Kn=new ee(...Xt);it=new ee(-ze+Ot[0],Ot[1]),it._rotateAround(Vr,kn)._add(Kn),it.x+=-Gn+ze,it.y-=(Ve.left-ge)*ce.scale;const qn=ce.imageName?Ve.advance*ce.scale:pi*ce.scale,Tn=String.fromCodePoint(ce.glyph);mR(Tn)?it.x+=(1-ge)*ce.scale:O_(Tn)?it.x+=qn-Ve.height*ce.scale+(-ge-1)*ce.scale:it.x+=ce.imageName||Ve.width+2*ge===Ke.w&&Ve.height+2*ge===Ke.h?(qn-ct)/2:(qn-(Ve.height+2*ge)*ce.scale)/2,Nt=new ee(it.x,it.y-vt),Kt=new ee(it.x+ct,it.y),Rt=new ee(it.x+ct,it.y-vt)}else{const Gn=(Ve.left-ge)*ce.scale-ze+Ot[0],kn=(-Ve.top-ge)*ce.scale+Ot[1],Vr=Gn+vt,Kn=kn+ct;it=new ee(Gn,kn),Nt=new ee(Vr,kn),Kt=new ee(Gn,Kn),Rt=new ee(Vr,Kn)}if(V){let Gn;Gn=N?new ee(0,0):Tt?new ee(Z[0],Z[1]):new ee(k[0],k[1]),it._rotateAround(V,Gn),Nt._rotateAround(V,Gn),Kt._rotateAround(V,Gn),Rt._rotateAround(V,Gn)}const Sn=new ee(0,0),or=new ee(0,0);H.push({tl:it,tr:Nt,bl:Kt,br:Rt,texPrimary:de,texSecondary:void 0,writingMode:R.writingMode,glyphOffset:ht,sectionIndex:ce.sectionIndex,isSDF:ae,pixelOffsetTL:Sn,pixelOffsetBR:or,minFontScaleX:0,minFontScaleY:0})}}return H}(0,i,f,l,u,d,a,t.allowVerticalPlacement),A=t.textSizeData;let P=null;"source"===A.kind?(P=[ra*l.layout.get("text-size").evaluate(d,{},C)],P[0]>nc&&K(`${t.layerIds[0]}: Value for "text-size" is >= ${Dd}. Reduce your "text-size".`)):"composite"===A.kind&&(P=[ra*b.compositeTextSizes[0].evaluate(d,{},C),ra*b.compositeTextSizes[1].evaluate(d,{},C)],(P[0]>nc||P[1]>nc)&&K(`${t.layerIds[0]}: Value for "text-size" is >= ${Dd}. Reduce your "text-size".`)),t.addSymbols(t.text,D,P,f,u,d,g,e,n,p.lineStartIndex,p.lineLength,v,E,C,T,!1);for(const I of _)x[I]=t.text.placedSymbolArray.length-1;return 4*D.length}function H_(t){for(const e in t)return t[e];return null}function Nv(t,e,n,i,a,l,u,d,f,p){let g=u.top,_=u.bottom,x=u.left,v=u.right;const b=u.collisionPadding;if(b&&(x-=b[0],g-=b[1],v+=b[2],_+=b[3]),f){const E=new ee(x,g),C=new ee(v,g),T=new ee(x,_),D=new ee(v,_),A=Et(f);let P=new ee(0,0);p&&(P=new ee(p[0],p[1])),E._rotateAround(A,P),C._rotateAround(A,P),T._rotateAround(A,P),D._rotateAround(A,P),x=Math.min(E.x,C.x,T.x,D.x),v=Math.max(E.x,C.x,T.x,D.x),g=Math.min(E.y,C.y,T.y,D.y),_=Math.max(E.y,C.y,T.y,D.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,x,g,v,_,d,i,a,l),t.length-1}function G_(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function FE(t,e,n,i){const a=t.compareText;if(e in a){const l=a[e];for(let u=l.length-1;u>=0;u--)if(i.dist(l[u])<n)return!0}else a[e]=[];return a[e].push(i),!1}function zv(t,e){const n=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),l=Math.sin(n)*a/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),u=Math.sin(t._pitch)*l+a;return Math.min(1.01*u,a*(1/t._horizonShift))}function Qc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),i=t.x*n,a=(t.x+1)*n,l=t.y*n,u=(t.y+1)*n,d=ls(i),f=ls(a),p=zr(l),g=zr(u),_=e.project(d,p),x=e.project(f,p),v=e.project(f,g),b=e.project(d,g);let E=Math.min(_.x,x.x,v.x,b.x),C=Math.min(_.y,x.y,v.y,b.y),T=Math.max(_.x,x.x,v.x,b.x),D=Math.max(_.y,x.y,v.y,b.y);const A=n/16;function P(R,k,L,N,z,j){const B=(L+z)/2,H=(N+j)/2,V=e.project(ls(B),zr(H)),Z=Math.max(0,E-V.x,C-V.y,V.x-T,V.y-D);E=Math.min(E,V.x),T=Math.max(T,V.x),C=Math.min(C,V.y),D=Math.max(D,V.y),Z>A&&(P(R,V,L,N,B,H),P(V,k,B,H,z,j))}P(_,x,i,l,a,l),P(x,v,a,l,a,u),P(v,b,a,u,i,u),P(b,_,i,u,i,l),E-=A,C-=A,T+=A,D+=A;const I=1/Math.max(T-E,D-C);return{scale:I,x:E*I,y:C*I,x2:T*I,y2:D*I,projection:e}}function q_(t,e,n,i,a,l,u,d,f){if("globe"===f.name)return h_(t,e,new Qs(n,i,a),!1);const p=Qc({z:n,x:i,y:a},f);return new $n([(l+p.x/p.scale)*e,e*(p.y/p.scale),u],[(l+p.x2/p.scale)*e,e*(p.y2/p.scale),d])}function yl(t,{x:e,y:n},i=0){return new ee(((e-i)*t.scale-t.x)*le,(n*t.scale-t.y)*le)}function NE(t,e,n=0){return G.fromValues(((e.x-n)*t.scale-t.x)*le,(e.y*t.scale-t.y)*le,Z2(e.z,e.y))}const FS=ne.identity(new Float32Array(16));class xl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new _t(0,0)}projectTilePoint(e,n,i){return{x:e,y:n,z:0}}locationPoint(e,n,i=!0){return e._coordinatePoint(e.locationCoordinate(n),i)}pixelsPerMeter(e,n){return vn(1,e)*n}pixelSpaceConversion(e,n,i){return 1}farthestPixelDistance(e){return zv(e,e.pixelsPerMeter)}pointCoordinate(e,n,i,a){const l=e.horizonLineFromTop(!1),u=new ee(n,Math.max(l,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(u,a))}pointCoordinate3D(e,n,i){const a=new ee(n,i);if(e.elevation)return e.elevation.pointCoordinate(a);{const l=this.pointCoordinate(e,a.x,a.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const i=e.horizonLineFromTop();return n.y<i}createInversionMatrix(e,n){return FS}createTileMatrix(e,n,i){let a,l,u;const d=i.canonical,f=ne.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const p=Qc(d,this);a=1,l=p.x+i.wrap*p.scale,u=p.y,ne.scale(f,f,[a/p.scale,a/p.scale,e.pixelsPerMeter/n])}else a=n/e.zoomScale(d.z),l=(d.x+Math.pow(2,d.z)*i.wrap)*a,u=d.y*a;return ne.translate(f,f,[l,u,0]),ne.scale(f,f,[a/le,a/le,1]),f}upVector(e,n,i){return[0,0,1]}upVectorScale(e,n,i){return{metersToTile:1}}}class NS extends xl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,i]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(Et(n));this.n=(a+Math.sin(Et(i)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:i,c:a,r0:l}=this,u=Et(e-this.center[0]),d=Et(n),f=Math.sqrt(a-2*i*Math.sin(d))/i;return{x:f*Math.sin(u*i),y:f*Math.cos(u*i)-l,z:0}}unproject(e,n){const{n:i,c:a,r0:l}=this,u=l+n;let d=Math.atan2(e,Math.abs(u))*Math.sign(u);u*i<0&&(d-=Math.PI*Math.sign(e)*Math.sign(u));const f=Et(this.center[0])*i;d=Ja(d,-Math.PI-f,Math.PI-f);const p=We(ei(d/i)+this.center[0],-180,180),g=Math.asin(We((a-(e*e+u*u)*i*i)/(2*i),-1,1)),_=We(ei(g),-Er,Er);return new _t(p,_)}}const Sd=1.340264,Hp=-.081106,eu=893e-6,rc=.003796,Gp=Math.sqrt(3)/2;class Z_ extends xl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(Gp*Math.sin(n)),a=i*i,l=a*a*a;return{x:.5*(e*Math.cos(i)/(Gp*(Sd+3*Hp*a+l*(7*eu+9*rc*a)))/Math.PI+.5),y:1-.5*(i*(Sd+Hp*a+l*(eu+rc*a))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,a=i*i,l=a*a*a;for(let g,_,x,v=0;v<12&&(_=i*(Sd+Hp*a+l*(eu+rc*a))-n,x=Sd+3*Hp*a+l*(7*eu+9*rc*a),g=_/x,i=We(i-g,-Math.PI/3,Math.PI/3),a=i*i,l=a*a*a,!(Math.abs(g)<1e-12));++v);const u=Gp*e*(Sd+3*Hp*a+l*(7*eu+9*rc*a))/Math.cos(i),d=Math.asin(Math.sin(i)/Gp),f=We(180*u/Math.PI,-180,180),p=We(180*d/Math.PI,-Er,Er);return new _t(f,p)}}class gR extends xl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const i=360*(e-.5),a=We(360*(.5-n),-Er,Er);return new _t(i,a)}}const Id=Math.PI/2;function qp(t){return Math.tan((Id+t)/2)}class zE extends xl{constructor(e){super(e),this.center=e.center||[0,30];const[n,i]=this.parallels=e.parallels||[30,30];let a=Et(n),l=Et(i);this.southernCenter=a+l<0,this.southernCenter&&(a=-a,l=-l);const u=Math.cos(a),d=qp(a);this.n=a===l?Math.sin(a):Math.log(u/Math.cos(l))/Math.log(qp(l)/d),this.f=u*Math.pow(qp(a),this.n)/this.n}project(e,n){n=Et(n),this.southernCenter&&(n=-n),e=Et(e-this.center[0]);const i=1e-6,{n:a,f:l}=this;l>0?n<-Id+i&&(n=-Id+i):n>Id-i&&(n=Id-i);const u=l/Math.pow(qp(n),a);let d=u*Math.sin(a*e),f=l-u*Math.cos(a*e);return d=.5*(d/Math.PI+.5),f=.5*(f/Math.PI+.5),{x:d,y:this.southernCenter?f:1-f,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:i,f:a}=this,l=a-n,u=Math.sign(l),d=Math.sign(i)*Math.sqrt(e*e+l*l);let f=Math.atan2(e,Math.abs(l))*u;l*i<0&&(f-=Math.PI*Math.sign(e)*u);const p=We(ei(f/i)+this.center[0],-180,180),g=We(ei(2*Math.atan(Math.pow(a/d,1/i))-Id),-Er,Er);return new _t(p,this.southernCenter?-g:g)}}class BE extends xl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Li(e),y:Gi(n),z:0}}unproject(e,n){const i=ls(e),a=zr(n);return new _t(i,a)}}const VE=Et(Er);class jE extends xl{project(e,n){const i=(n=Et(n))*n,a=i*i;return{x:.5*((e=Et(e))*(.8707-.131979*i+a*(a*(.003971*i-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+i*(.015085+a*(.028874*i-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,a=25,l=0,u=i*i;do{u=i*i;const p=u*u;l=(i*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))-n)/(1.007226+u*(.045255+p*(.259866*u-.311325-.005916*11*p))),i=We(i-l,-VE,VE)}while(Math.abs(l)>1e-6&&--a>0);u=i*i;const d=We(ei(e/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),f=ei(i);return new _t(d,f)}}const Bv=Et(Er);class Zp extends xl{project(e,n){n=Et(n),e=Et(e);const i=Math.cos(n),a=2/Math.PI,l=Math.acos(i*Math.cos(e/2)),u=Math.sin(l)/l,d=.5*(e*a+2*i*Math.sin(e/2)/u)||0,f=.5*(n+Math.sin(n)/u)||0;return{x:.5*(d/Math.PI+.5),y:1-.5*(f/Math.PI+1),z:0}}unproject(e,n){let i=e=(2*e-.5)*Math.PI,a=n=(2*(1-n)-1)*Math.PI,l=25;const u=1e-6;let d=0,f=0;do{const p=Math.cos(a),g=Math.sin(a),_=2*g*p,x=g*g,v=p*p,b=Math.cos(i/2),E=Math.sin(i/2),C=2*b*E,T=E*E,D=1-v*b*b,A=D?1/D:0,P=D?Math.acos(p*b)*Math.sqrt(1/D):0,I=.5*(2*P*p*E+2*i/Math.PI)-e,R=.5*(P*g+a)-n,k=.5*A*(v*T+P*p*b*x)+1/Math.PI,L=A*(C*_/4-P*g*E),N=.125*A*(_*E-P*g*v*C),z=.5*A*(x*b+P*T*p)+.5,j=L*N-z*k;d=(R*L-I*z)/j,f=(I*N-R*k)/j,i=We(i-d,-Math.PI,Math.PI),a=We(a-f,-Bv,Bv)}while((Math.abs(d)>u||Math.abs(f)>u)&&--l>0);return new _t(ei(i),ei(a))}}class UE extends xl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Et(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:i,cosPhi:a}=this;return{x:Et(e)*a*i+.5,y:-Math.sin(Et(n))/a*i+.5,z:0}}unproject(e,n){const{scale:i,cosPhi:a}=this,l=-(n-.5)/i,u=We(ei((e-.5)/i)/a,-180,180),d=Math.asin(We(l*a,-1,1)),f=We(ei(d),-Er,Er);return new _t(u,f)}}class $E extends BE{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,i){const a=xp(e,n,i),l=as(uo(i));return G.transformMat4(a,a,l),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,n){const i=Vo(n.lat,n.lng),a=G.normalize([],i),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,u=vn(1,0)*le*l;G.scaleAndAdd(i,i,a,u);const d=ne.identity(new Float64Array(16));return ne.multiply(d,e.pixelMatrix,e.globeMatrix),G.transformMat4(i,i,d),new ee(i[0],i[1])}pixelsPerMeter(e,n){return vn(1,0)*n}pixelSpaceConversion(e,n,i){const a=vn(1,e)*n,l=ut(vn(1,45)*n,a,i);return this.pixelsPerMeter(e,n)/l}createTileMatrix(e,n,i){const a=Hu(uo(i.canonical));return ne.multiply(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,n){const{center:i}=e,a=as(uo(n));return ne.rotateY(a,a,Et(i.lng)),ne.rotateX(a,a,Et(i.lat)),ne.scale(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,n,i,a){return j2(e,n,i,!0)||new Gt(0,0)}pointCoordinate3D(e,n,i){const a=this.pointCoordinate(e,n,i,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,n){return!j2(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(a,l){const u=a.cameraToCenterDistance,d=a._centerAltitude*l,f=a._camera,p=a._camera.forward(),g=G.add([],G.scale([],p,-u),[0,0,d]),_=a.worldSize/(2*Math.PI),x=[0,0,-_],v=a.width/a.height,b=Math.tan(a.fovAboveCenter),E=G.scale([],f.up(),b),C=G.scale([],f.right(),b*v),T=G.normalize([],G.add([],G.add([],p,E),C)),D=[];let A;if(new ad(g,T).closestPointOnSphere(x,_,D)){const P=G.add([],D,x),I=G.sub([],P,g);A=Math.cos(a.fovAboveCenter)*G.length(I)}else{const P=G.sub([],g,x),I=G.sub([],x,g);G.normalize(I,I);const R=G.length(P)-_;A=Math.sqrt(R*(R+2*_));const k=Math.acos(A/(_+R))-Math.acos(G.dot(p,I));A*=Math.cos(k)}return 1.01*A}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=ki(e.zoom);if(i>0){const a=zv(e,vn(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),u=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ut(n,a+l*(1-Math.cos(u)),Math.pow(i,10))}return n}upVector(e,n,i){return xp(n,i,e,1)}upVectorScale(e){return{metersToTile:Vx(f_(uo(e)))}}}function Wp(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new BE(t);case"equirectangular":return new gR(t);case"naturalEarth":return new jE(t);case"equalEarth":return new Z_(t);case"winkelTripel":return new Zp(t);case"albers":return n?new UE(t):new NS(t);case"lambertConformalConic":return n?new UE(t):new zE(t);case"globe":return new $E(t)}throw new Error(`Invalid projection name: ${t.name}`)}const zS=new nr({"symbol-placement":new Ce(J.layout_symbol["symbol-placement"]),"symbol-spacing":new Ce(J.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ce(J.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new et(J.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ce(J.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ce(J.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ce(J.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ce(J.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ce(J.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ce(J.layout_symbol["icon-rotation-alignment"]),"icon-size":new et(J.layout_symbol["icon-size"]),"icon-text-fit":new et(J.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(J.layout_symbol["icon-text-fit-padding"]),"icon-image":new et(J.layout_symbol["icon-image"]),"icon-rotate":new et(J.layout_symbol["icon-rotate"]),"icon-padding":new Ce(J.layout_symbol["icon-padding"]),"icon-keep-upright":new Ce(J.layout_symbol["icon-keep-upright"]),"icon-offset":new et(J.layout_symbol["icon-offset"]),"icon-anchor":new et(J.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ce(J.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ce(J.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ce(J.layout_symbol["text-rotation-alignment"]),"text-field":new et(J.layout_symbol["text-field"]),"text-font":new et(J.layout_symbol["text-font"]),"text-size":new et(J.layout_symbol["text-size"]),"text-max-width":new et(J.layout_symbol["text-max-width"]),"text-line-height":new et(J.layout_symbol["text-line-height"]),"text-letter-spacing":new et(J.layout_symbol["text-letter-spacing"]),"text-justify":new et(J.layout_symbol["text-justify"]),"text-radial-offset":new et(J.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ce(J.layout_symbol["text-variable-anchor"]),"text-anchor":new et(J.layout_symbol["text-anchor"]),"text-max-angle":new Ce(J.layout_symbol["text-max-angle"]),"text-writing-mode":new Ce(J.layout_symbol["text-writing-mode"]),"text-rotate":new et(J.layout_symbol["text-rotate"]),"text-padding":new Ce(J.layout_symbol["text-padding"]),"text-keep-upright":new Ce(J.layout_symbol["text-keep-upright"]),"text-transform":new et(J.layout_symbol["text-transform"]),"text-offset":new et(J.layout_symbol["text-offset"]),"text-allow-overlap":new Ce(J.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ce(J.layout_symbol["text-ignore-placement"]),"text-optional":new Ce(J.layout_symbol["text-optional"]),visibility:new Ce(J.layout_symbol.visibility)});var Vv={paint:new nr({"icon-opacity":new et(J.paint_symbol["icon-opacity"]),"icon-emissive-strength":new et(J.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new et(J.paint_symbol["text-emissive-strength"]),"icon-color":new et(J.paint_symbol["icon-color"]),"icon-halo-color":new et(J.paint_symbol["icon-halo-color"]),"icon-halo-width":new et(J.paint_symbol["icon-halo-width"]),"icon-halo-blur":new et(J.paint_symbol["icon-halo-blur"]),"icon-translate":new Ce(J.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ce(J.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new et(J.paint_symbol["icon-image-cross-fade"]),"text-opacity":new et(J.paint_symbol["text-opacity"]),"text-color":new et(J.paint_symbol["text-color"],{runtimeType:pa,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new et(J.paint_symbol["text-halo-color"]),"text-halo-width":new et(J.paint_symbol["text-halo-width"]),"text-halo-blur":new et(J.paint_symbol["text-halo-blur"]),"text-translate":new Ce(J.paint_symbol["text-translate"]),"text-translate-anchor":new Ce(J.paint_symbol["text-translate-anchor"])}),layout:zS};class Ad{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Gs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge(Ad,"FormatSectionOverride",{omit:["defaultValue"]});class W_ extends Ps{constructor(e,n){super(e,Vv,n)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const a=[];for(const l of i)a.indexOf(l)<0&&a.push(l);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,i,a){const l=this.layout.get(e).evaluate(n,{},i,a),u=this._unevaluatedLayout._values[e];return u.isDataDriven()||$f(u.value)||!l?l:(d=n.properties,l.replace(/{([^{}]+)}/g,(p,g)=>g in d?String(d[g]):""));var d}createBucket(e){return new Xp(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Vv.paint.overridableProperties){if(!W_.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),i=new Ad(n),a=new Sg(i,n.property.specification);let l=null;l="constant"===n.value.kind||"source"===n.value.kind?new Hf("source",a):new jl("composite",a,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new ns(n.property,l,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&W_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const i=e.get("text-field"),a=Vv.paint.properties[n];let l=!1;const u=d=>{for(const f of d)if(a.overrides&&a.overrides.hasOverride(f))return void(l=!0)};if("constant"===i.value.kind&&i.value.value instanceof Ht)u(i.value.value.sections);else if("source"===i.value.kind){const d=p=>{l||(p instanceof hg&&ri(p.value)===rg?u(p.value.sections):p instanceof Dh?u(p.sections):p.eachChild(d))},f=i.value;f._styleExpression&&d(f._styleExpression.expression)}return l}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),n=0!==this.paint.get("text-opacity").constantOr(1),i=[];return e&&i.push("symbolIcon"),n&&i.push("symbolSDF"),i}getDefaultProgramParams(e,n){return{config:new Qh(this,n),overrideFog:!1}}}const BS=Lp.types,VS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function X_(t,e,n,i,a,l,u,d,f,p,g,_,x){const v=d?Math.min(nc,Math.round(d[0])):0,b=d?Math.min(nc,Math.round(d[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*a),l,u,(v<<1)+(f?1:0),b,16*p,16*g,256*_,256*x)}function Y_(t,e,n){t.emplaceBack(e,n)}function J_(t,e,n,i,a,l,u){t.emplaceBack(e,n,i,a,l,u)}function K_(t,e,n,i,a){const l=5*e+2;t.float32[l+0]=n,t.float32[l+1]=i,t.float32[l+2]=a}function Pd(t,e,n,i,a){t.emplaceBack(e,n,i,a),t.emplaceBack(e,n,i,a),t.emplaceBack(e,n,i,a),t.emplaceBack(e,n,i,a)}function HE(t){for(const e of t.sections)if(kD(e.text))return!0;return!1}class Jn{constructor(e){this.layoutVertexArray=new lx,this.indexArray=new Rr,this.programConfigurations=e,this.segments=new bn,this.dynamicLayoutVertexArray=new rr,this.opacityVertexArray=new Ug,this.placedSymbolArray=new Xh,this.iconTransitioningVertexArray=new ba,this.globeExtVertexArray=new jg,this.zOffsetVertexArray=new ep}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,n,i,a,l){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,zp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,VS,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,xE.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Sv.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,R_.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ge(Jn,"SymbolBuffers");class jv{constructor(e,n,i){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new i,this.segments=new bn,this.collisionVertexArray=new Wh,this.collisionVertexArrayExt=new wa}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,vE.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,CS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ge(jv,"CollisionBuffers");class Qu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ne.identity([]),this.placementViewportMatrix=ne.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wE(this.zoom,n["text-size"]),this.iconSizeData=wE(this.zoom,n["icon-size"]);const i=this.layers[0].layout,a=i.get("symbol-sort-key"),l=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==l&&void 0!==a.constantOr(1),this.sortFeaturesByY=("viewport-y"===l||"auto"===l&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(u=>Hn[u]),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new Jn(new Fu(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Jn(new Fu(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Xg,this.lineVertexArray=new tp,this.symbolInstances=new Yh}calculateGlyphDependencies(e,n,i,a,l){for(let u=0;u<e.length;u++){const d=e.codePointAt(u);if(void 0===d)break;if(n[d]=!0,a&&l&&d<=65535){const f=Md[e.charAt(u)];f&&(n[f.charCodeAt(0)]=!0)}}}populate(e,n,i,a){const l=this.layers[0],u=l.layout,d="globe"===this.projection.name,f=u.get("text-font"),p=u.get("text-field"),g=u.get("icon-image"),_=("constant"!==p.value.kind||p.value.value instanceof Ht&&!p.value.value.isEmpty()||p.value.value.toString().length>0)&&("constant"!==f.value.kind||f.value.value.length>0),x="constant"!==g.value.kind||!!g.value.value||Object.keys(g.parameters).length>0,v=u.get("symbol-sort-key");if(this.features=[],!_&&!x)return;const b=n.iconDependencies,E=n.glyphDependencies,C=n.availableImages,T=new tr(this.zoom);for(const{feature:D,id:A,index:P,sourceLayerIndex:I}of e){const R=l._featureFilter.needGeometry,k=qc(D,R);if(!l._featureFilter.filter(T,k,i))continue;if(R||(k.geometry=pl(D,i,a)),d&&1!==D.type&&i.z<=5){const j=k.geometry,B=.98078528056,H=(V,Z)=>{const Q=xp(V.x,V.y,i,1),te=xp(Z.x,Z.y,i,1);return G.dot(Q,te)<B};for(let V=0;V<j.length;V++)j[V]=X2(j[V],H)}let L,N;if(_){const j=l.getValueAndResolveTokens("text-field",k,i,C),B=Ht.factory(j);HE(B)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Xs()||this.hasRTLText&&ts.isParsed())&&(L=EE(B,l,k))}if(x){const j=l.getValueAndResolveTokens("icon-image",k,i,C);N=j instanceof Jo?j:Jo.fromString(j)}if(!L&&!N)continue;const z=this.sortFeaturesByKey?v.evaluate(k,{},i):void 0;if(this.features.push({id:A,text:L,icon:N,index:P,sourceLayerIndex:I,geometry:k.geometry,properties:D.properties,type:BS[D.type],sortKey:z}),N&&(b[N.namePrimary]=!0,N.nameSecondary&&(b[N.nameSecondary]=!0)),L){const j=f.evaluate(k,{},i).join(","),B="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Hn.vertical)>=0;for(const H of L.sections)if(H.image)b[H.image.namePrimary]=!0;else{const V=tx(L.toString()),Z=H.fontStack||j,Q=E[Z]=E[Z]||{};this.calculateGlyphDependencies(H.text,Q,B,this.allowVerticalPlacement,V)}}}"line"===u.get("symbol-placement")&&(this.features=function(D){const A={},P={},I=[];let R=0;function k(j){I.push(D[j]),R++}function L(j,B,H){const V=P[j];return delete P[j],P[B]=V,I[V].geometry[0].pop(),I[V].geometry[0]=I[V].geometry[0].concat(H[0]),V}function N(j,B,H){const V=A[B];return delete A[B],A[j]=V,I[V].geometry[0].shift(),I[V].geometry[0]=H[0].concat(I[V].geometry[0]),V}function z(j,B,H){const V=H?B[0][B[0].length-1]:B[0][0];return`${j}:${V.x}:${V.y}`}for(let j=0;j<D.length;j++){const B=D[j],H=B.geometry,V=B.text?B.text.toString():null;if(!V){k(j);continue}const Z=z(V,H),Q=z(V,H,!0);if(Z in P&&Q in A&&P[Z]!==A[Q]){const te=N(Z,Q,H),W=L(Z,Q,I[te].geometry);delete A[Z],delete P[Q],P[z(V,I[W].geometry,!0)]=W,I[te].geometry=null}else Z in P?L(Z,Q,H):Q in A?N(Z,Q,H):(k(j),A[Z]=R-1,P[Q]=R-1)}return I.filter(j=>j.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((D,A)=>D.sortKey-A.sortKey)}update(e,n,i,a,l){const u=0!==Object.keys(e).length;if(u&&!this.stateDependentLayers.length)return;const d=u?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,d,i,a,l),this.icon.programConfigurations.updatePaintArrays(e,n,d,i,a,l)}updateZOffset(){const e=(l,u,d)=>{i+=u,i>l.length&&l.resize(i);for(let f=-u;f<0;f++)l.emplace(f+i,d)},n=(l,u,d)=>{a+=u,a>l.length&&l.resize(a);for(let f=-u;f<0;f++)l.emplace(f+a,d)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,a=0;for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l),{numHorizontalGlyphVertices:d,numVerticalGlyphVertices:f,numIconVertices:p}=u,g=u.zOffset,_=p>0;if((d>0||f>0)&&(e(this.text.zOffsetVertexArray,d,g),e(this.text.zOffsetVertexArray,f,g)),_){const{placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:v}=u;x>=0&&n(this.icon.zOffsetVertexArray,p,g),v>=0&&n(this.icon.zOffsetVertexArray,u.numVerticalIconVertices,g)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Wp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:a,y:l}of n)this.lineVertexArray.emplaceBack(a,l);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C){const T=e.indexArray,D=e.layoutVertexArray,A=e.globeExtVertexArray,P=e.segments.prepareSegment(4*n.length,D,T,this.canOverlap?u.sortKey:void 0),I=this.glyphOffsetArray.length,R=P.vertexLength,k=this.allowVerticalPlacement&&d===Hn.vertical?Math.PI/2:0,L=u.text&&u.text.sections;for(let z=0;z<n.length;z++){const{tl:j,tr:B,bl:H,br:V,texPrimary:Z,texSecondary:Q,pixelOffsetTL:te,pixelOffsetBR:W,minFontScaleX:X,minFontScaleY:re,glyphOffset:oe,isSDF:ce,sectionIndex:de}=n[z],ge=P.vertexLength,ae=oe[1];if(X_(D,p.x,p.y,j.x,ae+j.y,Z.x,Z.y,i,ce,te.x,te.y,X,re),X_(D,p.x,p.y,B.x,ae+B.y,Z.x+Z.w,Z.y,i,ce,W.x,te.y,X,re),X_(D,p.x,p.y,H.x,ae+H.y,Z.x,Z.y+Z.h,i,ce,te.x,W.y,X,re),X_(D,p.x,p.y,V.x,ae+V.y,Z.x+Z.w,Z.y+Z.h,i,ce,W.x,W.y,X,re),f){const{x:ue,y:Se,z:Ne}=f.anchor,[ze,Ve,Ke]=f.up;J_(A,ue,Se,Ne,ze,Ve,Ke),J_(A,ue,Se,Ne,ze,Ve,Ke),J_(A,ue,Se,Ne,ze,Ve,Ke),J_(A,ue,Se,Ne,ze,Ve,Ke),Pd(e.dynamicLayoutVertexArray,ue,Se,Ne,k)}else Pd(e.dynamicLayoutVertexArray,p.x,p.y,p.z,k);if(C){const ue=Q||Z;Y_(e.iconTransitioningVertexArray,ue.x,ue.y),Y_(e.iconTransitioningVertexArray,ue.x+ue.w,ue.y),Y_(e.iconTransitioningVertexArray,ue.x,ue.y+ue.h),Y_(e.iconTransitioningVertexArray,ue.x+ue.w,ue.y+ue.h)}T.emplaceBack(ge,ge+1,ge+2),T.emplaceBack(ge+1,ge+2,ge+3),P.vertexLength+=4,P.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(oe[0]),z!==n.length-1&&de===n[z+1].sectionIndex||e.programConfigurations.populatePaintArrays(D.length,u,u.index,{},v,b,E,L&&L[de])}const N=f?f.anchor:p;e.placedSymbolArray.emplaceBack(N.x,N.y,N.z,p.x,p.y,I,this.glyphOffsetArray.length-I,R,g,_,p.segment,i?i[0]:0,i?i[1]:0,a[0],a[1],d,0,!1,0,x,0)}_commitLayoutVertex(e,n,i,a,l,u,d){e.emplaceBack(n,i,a,l,u,Math.round(d.x),Math.round(d.y))}_addCollisionDebugVertices(e,n,i,a,l,u,d){const f=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),p=f.vertexLength,g=d.tileAnchorX,_=d.tileAnchorY;for(let v=0;v<4;v++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,a,l,u,g,_,new ee(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,a,l,u,g,_,new ee(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,a,l,u,g,_,new ee(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,a,l,u,g,_,new ee(e.x1,e.y2)),f.vertexLength+=4;const x=i.indexArray;x.emplaceBack(p,p+1),x.emplaceBack(p+1,p+2),x.emplaceBack(p+2,p+3),x.emplaceBack(p+3,p),f.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,i,a,l,u){for(let d=a;d<l;d++){const f=i.get(d),p=this.getSymbolInstanceTextSize(e,u,n,d);this._addCollisionDebugVertices(f,p,this.textCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}_addIconDebugCollisionBoxes(e,n,i,a,l,u){for(let d=a;d<l;d++){const f=i.get(d),p=this.getSymbolInstanceIconSize(e,n,u.placedIconSymbolIndex);this._addCollisionDebugVertices(f,p,this.iconCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jv($g,bE.members,ba),this.iconCollisionBox=new jv($g,bE.members,ba);const i=ec(this.iconSizeData,e),a=ec(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(a,e,n,u.textBoxStartIndex,u.textBoxEndIndex,u),this._addTextDebugCollisionBoxes(a,e,n,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._addIconDebugCollisionBoxes(i,e,n,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._addIconDebugCollisionBoxes(i,e,n,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}}getSymbolInstanceTextSize(e,n,i,a){const l=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:a),u=Bp(this.textSizeData,e,l)/pi;return this.tilePixelRatio*u}getSymbolInstanceIconSize(e,n,i){const a=this.icon.placedSymbolArray.get(i),l=Bp(this.iconSizeData,e,a);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,n,i){e.emplaceBack(n,-i,-i),e.emplaceBack(n,i,-i),e.emplaceBack(n,i,i),e.emplaceBack(n,-i,i)}_updateTextDebugCollisionBoxes(e,n,i,a,l,u){for(let d=a;d<l;d++){const f=i.get(d),p=this.getSymbolInstanceTextSize(e,u,n,d);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,p,f.padding)}}_updateIconDebugCollisionBoxes(e,n,i,a,l,u){for(let d=a;d<l;d++){const f=i.get(d),p=this.getSymbolInstanceIconSize(e,n,u);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,p,f.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=ec(this.iconSizeData,e),a=ec(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(a,e,n,u.textBoxStartIndex,u.textBoxEndIndex,u),this._updateTextDebugCollisionBoxes(a,e,n,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._updateIconDebugCollisionBoxes(i,e,n,u.iconBoxStartIndex,u.iconBoxEndIndex,u.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(i,e,n,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,i,a,l,u,d,f,p){const g={};if(n<i){const{x1:_,y1:x,x2:v,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:T,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P,featureIndex:I}=e.get(n);g.textBox={x1:_,y1:x,x2:v,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:T,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P},g.textFeatureIndex=I}if(a<l){const{x1:_,y1:x,x2:v,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:T,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P,featureIndex:I}=e.get(a);g.verticalTextBox={x1:_,y1:x,x2:v,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:T,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P},g.verticalTextFeatureIndex=I}if(u<d){const{x1:_,y1:x,x2:v,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:T,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P,featureIndex:I}=e.get(u);g.iconBox={x1:_,y1:x,x2:v,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:T,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P},g.iconFeatureIndex=I}if(f<p){const{x1:_,y1:x,x2:v,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:T,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P,featureIndex:I}=e.get(f);g.verticalIconBox={x1:_,y1:x,x2:v,y2:b,padding:E,projectedAnchorX:C,projectedAnchorY:T,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P},g.verticalIconFeatureIndex=I}return g}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const i=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const i=e.placedSymbolArray.get(n),a=i.vertexStartIndex+4*i.numGlyphs;for(let l=i.vertexStartIndex;l<a;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),i=Math.cos(e),a=[],l=[],u=[];for(let d=0;d<this.symbolInstances.length;++d){u.push(d);const f=this.symbolInstances.get(d);a.push(0|Math.round(n*f.tileAnchorX+i*f.tileAnchorY)),l.push(f.featureIndex)}return u.sort((d,f)=>a[d]-a[f]||l[f]-l[d]),u}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===n?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const i=this.symbolInstances.get(n);this.featureSortOrder.push(i.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:u,verticalPlacedTextSymbolIndex:d,placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:p}=i;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),l>=0&&l!==a&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&this.addIndicesForPlacedSymbol(this.icon,f),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ge(Qu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Qu.MAX_GLYPHS=65535,Qu.addDynamicAttributes=Pd;var Xp=Qu;const jS=sn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:US}=jS,$S=sn([{name:"a_packed",components:4,type:"Float32"}]),{members:HS}=$S,GS=Lp.types,qS=Math.cos(Math.PI/180*37.5);class Yp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Ul,this.layoutVertexArray2=new rr,this.indexArray=new Rr,this.programConfigurations=new Fu(e.layers,e.zoom),this.segments=new bn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,a){this.hasPattern=pv("line",this.layers,n);const l=this.layers[0].layout.get("line-sort-key"),u=[];for(const{feature:g,id:_,index:x,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,E=qc(g,b);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),E,i))continue;const C=l?l.evaluate(E,{},i):void 0,T={id:_,properties:g.properties,type:g.type,sourceLayerIndex:v,index:x,geometry:b?E.geometry:pl(g,i,a),patterns:{},sortKey:C};u.push(T)}l&&u.sort((g,_)=>g.sortKey-_.sortKey);const{lineAtlas:d,featureIndex:f}=n,p=this.addConstantDashes(d);for(const g of u){const{geometry:_,index:x,sourceLayerIndex:v}=g;if(p&&this.addFeatureDashes(g,d),this.hasPattern){const b=M_("line",this.layers,g,this.zoom,n);this.patternFeatures.push(b)}else this.addFeature(g,_,x,i,d.positions,n.availableImages,n.brightness);f.insert(e[x].feature,_,x,v,this.index)}}addConstantDashes(e){let n=!1;for(const i of this.layers){const a=i.paint.get("line-dasharray").value,l=i.layout.get("line-cap").value;if("constant"!==a.kind||"constant"!==l.kind)n=!0;else{const u=l.value,d=a.value;if(!d)continue;e.addDash(d,u)}}return n}addFeatureDashes(e,n){const i=this.zoom;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,u=a.layout.get("line-cap").value;if("constant"===l.kind&&"constant"===u.kind)continue;let d,f;if("constant"===l.kind){if(d=l.value,!d)continue}else d=l.evaluate({zoom:i},e);f="constant"===u.kind?u.value:u.evaluate({zoom:i},e),n.addDash(d,f),e.patterns[a.id]=n.getKey(d,f)}}update(e,n,i,a,l){const u=0!==Object.keys(e).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,u?this.stateDependentLayers:this.layers,i,a,l)}addFeatures(e,n,i,a,l,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,i,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,HS)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,US),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,i,a,l,u,d){const f=this.layers[0].layout,p=f.get("line-join").evaluate(e,{}),g=f.get("line-cap").evaluate(e,{}),_=f.get("line-miter-limit"),x=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const v of n)this.addLine(v,e,p,g,_,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,u,a,d)}addLine(e,n,i,a,l,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let T=0;T<e.length-1;T++)this.totalDistance+=e[T].dist(e[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const d="Polygon"===GS[n.type];let f=e.length;for(;f>=2&&e[f-1].equals(e[f-2]);)f--;let p=0;for(;p<f-1&&e[p].equals(e[p+1]);)p++;if(f<(d?3:2))return;"bevel"===i&&(l=1.05);const g=this.overscaling<=16?15*le/(512*this.overscaling):0,_=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray);let x,v,b,E,C;this.e1=this.e2=-1,d&&(x=e[f-2],C=e[p].sub(x)._unit()._perp());for(let T=p;T<f;T++){if(b=T===f-1?d?e[p+1]:void 0:e[T+1],b&&e[T].equals(b))continue;C&&(E=C),x&&(v=x),x=e[T],C=b?b.sub(x)._unit()._perp():E,E=E||C;let D=E.add(C);0===D.x&&0===D.y||D._unit();const A=E.x*C.x+E.y*C.y,P=D.x*C.x+D.y*C.y,I=0!==P?1/P:1/0,R=2*Math.sqrt(2-2*P),k=P<qS&&v&&b,L=E.x*C.y-E.y*C.x>0;if(k&&T>p){const j=x.dist(v);if(j>2*g){const B=x.sub(x.sub(v)._mult(g/j)._round());this.updateDistance(v,B),this.addCurrentVertex(B,E,0,0,_),v=B}}const N=v&&b;let z=N?i:d?"butt":a;if(N&&"round"===z&&(I<u?z="miter":I<=2&&(z="fakeround")),"miter"===z&&I>l&&(z="bevel"),"bevel"===z&&(I>2&&(z="flipbevel"),I<l&&(z="miter")),v&&this.updateDistance(v,x),"miter"===z)D._mult(I),this.addCurrentVertex(x,D,0,0,_);else if("flipbevel"===z){if(I>100)D=C.mult(-1);else{const j=I*E.add(C).mag()/E.sub(C).mag();D._perp()._mult(j*(L?-1:1))}this.addCurrentVertex(x,D,0,0,_),this.addCurrentVertex(x,D.mult(-1),0,0,_)}else if("bevel"===z||"fakeround"===z){const j=-Math.sqrt(I*I-1),B=L?j:0,H=L?0:j;if(v&&this.addCurrentVertex(x,E,B,H,_),"fakeround"===z){const V=Math.round(180*R/Math.PI/20);for(let Z=1;Z<V;Z++){let Q=Z/V;if(.5!==Q){const W=Q-.5;Q+=Q*W*(Q-1)*((1.0904+A*(A*(3.55645-1.43519*A)-3.2452))*W*W+(.848013+A*(.215638*A-1.06021)))}const te=C.sub(E)._mult(Q)._add(E)._unit()._mult(L?-1:1);this.addHalfVertex(x,te.x,te.y,!1,L,0,_)}}b&&this.addCurrentVertex(x,C,-B,-H,_)}else if("butt"===z)this.addCurrentVertex(x,D,0,0,_);else if("square"===z){const j=v?1:-1;v||this.addCurrentVertex(x,D,j,j,_),this.addCurrentVertex(x,D,0,0,_),v&&this.addCurrentVertex(x,D,j,j,_)}else"round"===z&&(v&&(this.addCurrentVertex(x,E,0,0,_),this.addCurrentVertex(x,E,1,1,_,!0)),b&&(this.addCurrentVertex(x,C,-1,-1,_,!0),this.addCurrentVertex(x,C,0,0,_)));if(k&&T<f-1){const j=x.dist(b);if(j>2*g){const B=x.add(b.sub(x)._mult(g/j)._round());this.updateDistance(x,B),this.addCurrentVertex(B,C,0,0,_),x=B}}}}addCurrentVertex(e,n,i,a,l,u=!1){const d=n.y*a-n.x,f=-n.y-n.x*a;this.addHalfVertex(e,n.x+n.y*i,n.y-n.x*i,u,!1,i,l),this.addHalfVertex(e,d,f,u,!0,-a,l)}addHalfVertex({x:e,y:n},i,a,l,u,d,f){this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(n<<1)+(u?1:0),Math.round(63*i)+128,Math.round(63*a)+128,1+(0===d?0:d<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const p=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,p),f.primitiveLength++),u?this.e2=p:this.e1=p}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Ge(Yp,"LineBucket",{omit:["layers","patternFeatures"]});class kr{constructor(e,n,i,a){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(n,a)}update(e,n,i){const{width:a,height:l}=e,{context:u}=this,{gl:d}=u,{HTMLImageElement:f,HTMLCanvasElement:p,HTMLVideoElement:g,ImageData:_,ImageBitmap:x}=ie;if(d.bindTexture(d.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA&&(!n||!1!==n.premultiply)),i||this.size&&this.size[0]===a&&this.size[1]===l){const{x:v,y:b}=i||{x:0,y:0};if(e instanceof f||e instanceof p||e instanceof g||e instanceof _||x&&e instanceof x)d.texSubImage2D(d.TEXTURE_2D,0,v,b,d.RGBA,d.UNSIGNED_BYTE,e);else{let E=this.format,C=d.UNSIGNED_BYTE;this.format===d.R32F&&(E=d.RED,C=d.FLOAT),d.texSubImage2D(d.TEXTURE_2D,0,v,b,a,l,E,C,e.data)}}else if(this.size=[a,l],e instanceof f||e instanceof p||e instanceof g||e instanceof _||x&&e instanceof x){let v=this.format;this.format===d.R8&&(v=d.RED),d.texImage2D(d.TEXTURE_2D,0,this.format,v,d.UNSIGNED_BYTE,e)}else{let v=this.format,b=this.format,E=d.UNSIGNED_BYTE;this.format===d.DEPTH_COMPONENT&&(v=d.DEPTH_COMPONENT16,E=d.UNSIGNED_SHORT),this.format===d.R32F&&(E=d.FLOAT,b=d.RED),d.texImage2D(d.TEXTURE_2D,0,v,a,l,0,b,E,e.data)}this.useMipmap=!(!n||!n.useMipmap),this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,n){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,i,a){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),n!==this.magFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),this.wrapS=i),a!==this.wrapT&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Q_{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}}const ic=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,i=0,a=0,l=0,u=0,d=0;for(1&e?a=l=u=32:n=i=d=32;(e>>=1)>1;){const p=n+a>>1,g=i+l>>1;1&e?(a=n,l=i,n=u,i=d):(n=a,i=l,a=u,l=d),u=p,d=g}const f=4*t;ic[f+0]=n,ic[f+1]=i,ic[f+2]=a,ic[f+3]=l}const oc=new Uint16Array(2178),Pa=new Uint8Array(1089),e0=new Uint16Array(1089);function GE(t){return 0===t?-.03125:32===t?.03125:0}var Jp=sn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const qE={type:2,extent:le,loadGeometry:()=>[[new ee(0,0),new ee(le+1,0),new ee(le+1,le+1),new ee(0,le+1),new ee(0,0)]]};class ds{constructor(e,n,i,a,l){this.tileID=e,this.uid=Ar(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=l,a&&a.style&&(this._lastUpdatedBrightness=a.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Fe.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Qc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,l){const u={};if(!l)return u;for(const d of a){const f=d.layerIds.map(p=>l.getLayer(p)).filter(Boolean);if(0!==f.length){d.layers=f,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(p=>f.filter(g=>g.id===p)[0]));for(const p of f)u[p.fqid]=d}}return u}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const l=this.buckets[a];if(l instanceof Xp){if(this.hasSymbolBuckets=!0,!i)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const l=this.buckets[a];if(l instanceof Xp&&l.hasRTLText){this.hasRTLText=!0,ts.isLoading()||ts.isLoaded()||"deferred"!==Xs()||kg();break}}this.queryPadding=0;for(const a in this.buckets){const l=this.buckets[a],u=n.style.getOwnLayer(a);if(!u)continue;const d=u.queryRadius(l);this.queryPadding=Math.max(this.queryPadding,d)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Qw}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const i in this.buckets){const a=this.buckets[i];a.uploadPending()&&a.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kr(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kr(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new kr(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,n,i){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const a=n.style.getBrightness();(this._lastUpdatedBrightness||a)&&(this._lastUpdatedBrightness&&a&&Math.abs(this._lastUpdatedBrightness-a)<.001||(this._lastUpdatedBrightness=a,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,i,a,l,u,d,f){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:d,transform:u,params:l,tileTransform:this.tileTransform},e,n,i):{}}querySourceFeatures(e,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const a=i.loadVTLayers(),l=n?n.sourceLayer:"",u=a._geojsonTileLayer||a[l];if(!u)return;const d=Gy(n&&n.filter),{z:f,x:p,y:g}=this.tileID.canonical,_={z:f,x:p,y:g};for(let x=0;x<u.length;x++){const v=u.feature(x);if(d.needGeometry){const C=qc(v,!0);if(!d.filter(new tr(this.tileID.overscaledZ),C,this.tileID.canonical))continue}else if(!d.filter(new tr(this.tileID.overscaledZ),v))continue;const b=i.getId(v,l),E=new I_(v,f,p,g,b);E.tile=_,e.push(E)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const i=tt(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const i=Date.now();let a=!1;if(this.expirationTime>i)a=!1;else if(n)if(this.expirationTime<n)a=!0;else{const l=this.expirationTime-n;l?this.expirationTime=i+Math.max(l,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),a=n.style.listImages(),l=n.style.getBrightness();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const d=this.buckets[u],f=d.layers[0].sourceLayer||"_geojsonTileLayer",p=i[f];let g={};if(e&&(g=e[f],!p||!g||0===Object.keys(g).length))continue;if(d.update(g,p,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},l),d instanceof Yp||d instanceof xd){const x=n.style.getOwnSourceCache(d.layers[0].source);n._terrain&&n._terrain.enabled&&x&&d.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(x.id,this.tileID)}const _=n&&n.style&&n.style.getOwnLayer(u);_&&(this.queryPadding=Math.max(this.queryPadding,_.queryRadius(d)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Fe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Fe.now()+e}setTexture(e,n){const i=n.context,a=i.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new kr(i,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(e,n){const i={};for(const a of n)i[a]=!0;this.dependencies[e]=i}hasDependency(e,n){for(const i of e){const a=this.dependencies[i];if(a)for(const l of n)if(a[l])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const i=pl(qE,this.tileID.canonical,this.tileTransform)[0],a=new Eo,l=new qg;for(let u=0;u<i.length;u++){const{x:d,y:f}=i[u];a.emplaceBack(d,f),l.emplaceBack(u)}l.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(a,Gl.members),this._tileDebugSegments=bn.simpleSegment(0,0,a.length,l.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const i=pl(qE,this.tileID.canonical,this.tileTransform)[0];let a,l;if(this.isRaster){const u=function(d,f){const p=Qc(d,f),g=Math.pow(2,d.z);for(let C=0;C<33;C++)for(let T=0;T<33;T++){const D=ls((d.x+(T+GE(T))/32)/g),A=zr((d.y+(C+GE(C))/32)/g),P=f.project(D,A),I=33*C+T;oc[2*I+0]=Math.round((P.x*p.scale-p.x)*le),oc[2*I+1]=Math.round((P.y*p.scale-p.y)*le)}Pa.fill(0),e0.fill(0);for(let C=2045;C>=0;C--){const T=4*C,D=ic[T+0],A=ic[T+1],P=ic[T+2],I=ic[T+3],R=D+P>>1,k=A+I>>1,L=R+k-A,N=k+D-R,z=33*A+D,j=33*I+P,B=33*k+R,H=Math.hypot((oc[2*z+0]+oc[2*j+0])/2-oc[2*B+0],(oc[2*z+1]+oc[2*j+1])/2-oc[2*B+1])>=16;Pa[B]=Pa[B]||(H?1:0),C<1022&&(Pa[B]=Pa[B]||Pa[33*(A+N>>1)+(D+L>>1)]||Pa[33*(I+N>>1)+(P+L>>1)])}const _=new Ru,x=new Rr;let v=0;function b(C,T){const D=33*T+C;return 0===e0[D]&&(_.emplaceBack(oc[2*D+0],oc[2*D+1],C*le/32,T*le/32),e0[D]=++v),e0[D]-1}function E(C,T,D,A,P,I){const R=C+D>>1,k=T+A>>1;if(Math.abs(C-P)+Math.abs(T-I)>1&&Pa[33*k+R])E(P,I,C,T,R,k),E(D,A,P,I,R,k);else{const L=b(C,T),N=b(D,A),z=b(P,I);x.emplaceBack(L,N,z)}}return E(0,0,32,32,32,0),E(32,32,0,0,0,32),{vertices:_,indices:x}}(this.tileID.canonical,n);a=u.vertices,l=u.indices}else{a=new Ru,l=new Rr;for(const{x:d,y:f}of i)a.emplaceBack(d,f,0,0);const u=E_(a.int16,void 0,4);for(let d=0;d<u.length;d+=3)l.emplaceBack(u[d],u[d+1],u[d+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,Jp.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(l),this._tileBoundsSegments=bn.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugBuffers(e,n){const i=n.projection;if(!i||"globe"!==i.name||n.freezeTileCoverage)return;const a=this.tileID.canonical,l=as(u_(a,n)),u=ki(n.zoom);let d;u>0&&(d=ne.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,a,n,l,d,u),this._makeGlobeTileDebugTextBuffer(e,a,n,l,d,u)}_globePoint(e,n,i,a,l,u,d){let f=xp(e,n,i);if(u){const p=1<<i.z,g=Li(a.center.lng),_=Gi(a.center.lat),x=(i.x+.5)/p-g;let v=0;x>.5?v=-1:x<-.5&&(v=1);let b=(e/le+i.x)/p+v,E=(n/le+i.y)/p;b=(b-g)*a._pixelsPerMercatorPixel+g,E=(E-_)*a._pixelsPerMercatorPixel+_;const C=[b*a.worldSize,E*a.worldSize,0];G.transformMat4(C,C,u),f=ta(f,C,d)}return G.transformMat4(f,f,l)}_makeGlobeTileDebugBorderBuffer(e,n,i,a,l,u){const d=new Eo,f=new qg,p=new zg,g=(x,v,b,E,C)=>{const T=(b-x)/(C-1),D=(E-v)/(C-1),A=d.length;for(let P=0;P<C;P++){const I=x+P*T,R=v+P*D;d.emplaceBack(I,R);const k=this._globePoint(I,R,n,i,a,l,u);p.emplaceBack(k[0],k[1],k[2]),f.emplaceBack(A+P)}},_=le;g(0,0,_,0,16),g(_,0,_,_,16),g(_,_,0,_,16),g(0,_,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(d,Gl.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(p,N2.members),this._tileDebugSegments=bn.simpleSegment(0,0,d.length,f.length)}_makeGlobeTileDebugTextBuffer(e,n,i,a,l,u){const d=le/4,f=new Eo,p=new Rr,g=new zg,_=25;p.reserve(32),f.reserve(_),g.reserve(_);const x=(v,b)=>_*v+b;for(let v=0;v<_;v++){const b=v*d;for(let E=0;E<_;E++){const C=E*d;f.emplaceBack(C,b);const T=this._globePoint(C,b,n,i,a,l,u);g.emplaceBack(T[0],T[1],T[2])}}for(let v=0;v<4;v++)for(let b=0;b<4;b++){const E=x(v,b),C=x(v,b+1),T=x(v+1,b),D=x(v+1,b+1);p.emplaceBack(E,C,T),p.emplaceBack(T,C,D)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(p),this._tileDebugTextBuffer=e.createVertexBuffer(f,Gl.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(g,N2.members),this._tileDebugTextSegments=bn.simpleSegment(0,0,_,32)}}class Kp{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,i){const a=e.wrapped().key;void 0===this.data[a]&&(this.data[a]=[]);const l={value:n,timeout:void 0};if(void 0!==i&&(l.timeout=setTimeout(()=>{this.remove(e,l)},i)),this.data[a].push(l),this.order.push(a),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const i=e.wrapped().key,a=void 0===n?0:this.data[i].indexOf(n),l=this.data[i][a];return this.data[i].splice(a,1),l.timeout&&clearTimeout(l.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(l.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const i in this.data)for(const a of this.data[i])e(a.value)||n.push(a);for(const i of n)this.remove(i.value.tileID,i)}}let fo=(()=>{class t{constructor(n,i,a,l){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;const u=n.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||l||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();const eh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class t0{constructor(e,n,i,a,l,u){this.length=n.length,this.attributes=i,this.itemSize=n.bytesPerElement,this.dynamicDraw=a,this.instanceCount=u,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||l||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let i=0;i<this.attributes.length;i++){const a=n.attributes[this.attributes[i].name];void 0!==a&&e.enableVertexAttribArray(a)}}setVertexAttribPointers(e,n,i){for(let a=0;a<this.attributes.length;a++){const l=this.attributes[a],u=n.attributes[l.name];void 0!==u&&e.vertexAttribPointer(u,l.components,e[eh[l.type]],!1,this.itemSize,l.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(e,n,i){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];void 0!==l&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(l,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class an{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vl extends an{getDefault(){return At.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Rd extends an{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Od extends an{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class kd extends an{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ld extends an{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Fd extends an{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Nd extends an{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class zd extends an{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Bd extends an{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Vd extends an{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ZE extends an{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class WE extends an{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class XE extends an{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class YE extends an{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class JE extends an{getDefault(){return At.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class KE extends an{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class QE extends an{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class eM extends an{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class tM extends an{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let Uv=class extends an{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class ZS extends an{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class _R extends an{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class yR extends an{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class WS extends an{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class XS extends an{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class xR extends an{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class YS extends an{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class vR extends an{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class JS extends an{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class KS extends an{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class QS extends an{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Qp extends an{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class em extends Qp{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class n0 extends Qp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class r0 extends Qp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class nM extends n0{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class tm{constructor(e,n,i,a,l){this.context=e,this.width=n,this.height=i;const u=this.framebuffer=e.gl.createFramebuffer();a&&(this.colorAttachment=new em(e,u)),l&&(this.depthAttachmentType=l,this.depthAttachment="renderbuffer"===l?new n0(e,u):new r0(e,u))}destroy(){const e=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&e.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&e.deleteTexture(n)}e.deleteFramebuffer(this.framebuffer)}}class pt{constructor(e,n,i){this.func=e,this.mask=n,this.range=i}}pt.ReadOnly=!1,pt.ReadWrite=!0,pt.disabled=new pt(519,pt.ReadOnly,[0,1]);class St{constructor(e,n,i,a,l,u){this.test=e,this.ref=n,this.mask=i,this.fail=a,this.depthFail=l,this.pass=u}}St.disabled=new St({func:519,mask:0},0,0,7680,7680,7680);class Jt{constructor(e,n,i,a){this.blendFunction=e,this.blendColor=n,this.mask=i,this.blendEquation=a}}Jt.Replace=[1,0,1,0],Jt.disabled=new Jt(Jt.Replace,At.transparent,[!1,!1,!1,!1]),Jt.unblended=new Jt(Jt.Replace,At.transparent,[!0,!0,!0,!0]),Jt.alphaBlended=new Jt([1,771,1,771],At.transparent,[!0,!0,!0,!0]),Jt.multiply=new Jt([774,0,774,0],At.transparent,[!0,!0,!0,!0]);class Ft{constructor(e,n,i){this.enable=e,this.mode=n,this.frontFace=i}}Ft.disabled=new Ft(!1,1029,2305),Ft.backCCW=new Ft(!0,1029,2305),Ft.backCW=new Ft(!0,1029,2304),Ft.frontCW=new Ft(!0,1028,2304),Ft.frontCCW=new Ft(!0,1028,2305);class s0{constructor(e){this.gl=e,this.clearColor=new vl(this),this.clearDepth=new Rd(this),this.clearStencil=new Od(this),this.colorMask=new kd(this),this.depthMask=new Ld(this),this.stencilMask=new Fd(this),this.stencilFunc=new Nd(this),this.stencilOp=new zd(this),this.stencilTest=new Bd(this),this.depthRange=new Vd(this),this.depthTest=new ZE(this),this.depthFunc=new WE(this),this.blend=new XE(this),this.blendFunc=new YE(this),this.blendColor=new JE(this),this.blendEquation=new KE(this),this.cullFace=new QE(this),this.cullFaceSide=new eM(this),this.frontFace=new tM(this),this.program=new Uv(this),this.activeTexture=new ZS(this),this.viewport=new _R(this),this.bindFramebuffer=new yR(this),this.bindRenderbuffer=new WS(this),this.bindTexture=new XS(this),this.bindVertexBuffer=new xR(this),this.bindElementBuffer=new YS(this),this.bindVertexArrayOES=new vR(this),this.pixelStoreUnpack=new JS(this),this.pixelStoreUnpackPremultiplyAlpha=new KS(this),this.pixelStoreUnpackFlipY=new QS(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n,i){return new fo(this,e,n,i)}createVertexBuffer(e,n,i,a,l){return new t0(this,e,n,i,a,l)}createRenderbuffer(e,n,i){const a=this.gl,l=a.createRenderbuffer();return this.bindRenderbuffer.set(l),a.renderbufferStorage(a.RENDERBUFFER,e,n,i),this.bindRenderbuffer.set(null),l}createFramebuffer(e,n,i,a){return new tm(this,e,n,i,a)}clear({color:e,depth:n,stencil:i,colorMask:a}){const l=this.gl;let u=0;e&&(u|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(a||[!0,!0,!0,!0])),void 0!==n&&(u|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(u|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),l.clear(u)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){en(e.blendFunction,Jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class fs extends wr{constructor(e,n,i){super(),this.id=e,this._onlySymbols=i,n.on("data",a=>{"source"===a.dataType&&"metadata"===a.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===a.dataType&&"content"===a.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Kp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new TS,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("errored"!==n.state&&("loaded"!==n.state||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const i=this._tiles[n];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Mi(this._tiles).map(e=>e.tileID).sort(eI).map(e=>e.key)}getRenderableIds(e,n){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,e,n)&&i.push(this._tiles[a]);return e?i.sort((a,l)=>{const u=a.tileID,d=l.tileID,f=new ee(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),p=new ee(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-d.overscaledZ||p.y-f.y||p.x-f.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(eI).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=n),this._loadTile(i,this._tileLoaded.bind(this,i,e,n)))}_tileLoaded(e,n,i,a){if(a)if(e.state="errored",404!==a.status)this._source.fire(new pe(a,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const l=this.map.painter.terrain;this.update(this.transform,l.getScaledDemTileSize(),!0),l.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Fe.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Me("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let a=0;a<n.length;a++){const l=n[a];if(e.neighboringTiles&&e.neighboringTiles[l]){const u=this.getTileByID(l);i(e,u),i(u,e)}}function i(a,l){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let u=l.tileID.canonical.x-a.tileID.canonical.x;const d=l.tileID.canonical.y-a.tileID.canonical.y,f=Math.pow(2,a.tileID.canonical.z),p=l.tileID.key;0===u&&0===d||Math.abs(d)>1||(Math.abs(u)>1&&(1===Math.abs(u+f)?u+=f:1===Math.abs(u-f)&&(u-=f)),l.dem&&a.dem&&(a.dem.backfillBorder(l.dem,u,d),a.neighboringTiles&&a.neighboringTiles[p]&&(a.neighboringTiles[p].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,i,a){for(const l in this._tiles){let u=this._tiles[l];if(a[l]||!u.hasData()||u.tileID.overscaledZ<=n||u.tileID.overscaledZ>i)continue;let d=u.tileID;for(;u&&u.tileID.overscaledZ>n+1;){const p=u.tileID.scaledTo(u.tileID.overscaledZ-1);u=this._tiles[p.key],u&&u.hasData()&&(d=p)}let f=d;for(;f.overscaledZ>n;)if(f=f.scaledTo(f.overscaledZ-1),e[f.key]){a[d.key]=d;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=n?i:null}for(let i=e.overscaledZ-1;i>=n;i--){const a=e.scaledTo(i),l=this._getLoadedTile(a);if(l)return l}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const i=Math.ceil(e.width/n)+1,a=Math.ceil(e.height/n)+1,l=Math.floor(i*a*5),u="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,l):l,d="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const i={};for(const a in this._tiles){const l=this._tiles[a];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+n),i[l.tileID.key]=l}this._tiles=i;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,n,i,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let l;if(this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new Zt(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(l=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(f=>this._source.hasTile(f)))):l=[],l.length>0&&this.castsShadows&&a&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!qv(this._source.type)){const f=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),p=Math.min(f,this._source.maxzoom),g=e.extendTileCoverForShadows(l,a,p);for(const _ of g)this._shadowCasterTiles[_.key]=!0,l.push(_)}const u=this._updateRetainedTiles(l);if(qv(this._source.type)&&0!==l.length){const f={},p={},g=Object.keys(u);for(const x of g){const v=u[x],b=this._tiles[x];if(!b||b.fadeEndTime&&b.fadeEndTime<=Fe.now())continue;const E=this.findLoadedParent(v,Math.max(v.overscaledZ-fs.maxOverzooming,this._source.minzoom));E&&(this._addTile(E.tileID),f[E.tileID.key]=E.tileID),p[x]=v}const _=l[l.length-1].overscaledZ;for(const x in this._tiles){const v=this._tiles[x];if(u[x]||!v.hasData())continue;let b=v.tileID;for(;b.overscaledZ>_;){b=b.scaledTo(b.overscaledZ-1);const E=this._tiles[b.key];if(E&&E.hasData()&&p[b.key]){u[x]=v.tileID;break}}}for(const x in f)u[x]||(this._coveredTiles[x]=!0,u[x]=f[x])}for(const f in u)this._tiles[f].clearFadeHold();const d=function(f,p){const g=[];for(const _ in f)_ in p||g.push(_);return g}(this._tiles,u);for(const f of d){const p=this._tiles[f];p.hasSymbolBuckets&&!p.holdingForFade()?p.setHoldDuration(this.map._fadeDuration):p.hasSymbolBuckets&&!p.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const i={},a=e.reduce((p,g)=>Math.min(p,g.overscaledZ),1/0),l=e[0].overscaledZ,u=Math.max(l-fs.maxOverzooming,this._source.minzoom),d=Math.max(l+fs.maxUnderzooming,this._source.minzoom),f={};for(const p of e){const g=this._addTile(p);n[p.key]=p,g.hasData()||a<this._source.maxzoom&&(f[p.key]=p)}this._retainLoadedChildren(f,a,d,n);for(const p of e){let g=this._tiles[p.key];if(g.hasData())continue;if(p.canonical.z>=this._source.maxzoom){const x=p.children(this._source.maxzoom)[0],v=this.getTile(x);if(v&&v.hasData()){n[x.key]=x;continue}}else{const x=p.children(this._source.maxzoom);if(n[x[0].key]&&n[x[1].key]&&n[x[2].key]&&n[x[3].key])continue}let _=g.wasRequested();for(let x=p.overscaledZ-1;x>=u;--x){const v=p.scaledTo(x);if(i[v.key]||(i[v.key]=!0,g=this.getTile(v),!g&&_&&(g=this._addTile(v)),g&&(n[v.key]=v,_=g.wasRequested(),g.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let i,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){i=this._loadedParentTiles[a.key];break}n.push(a.key);const l=a.scaledTo(a.overscaledZ-1);if(i=this._getLoadedTile(l),i)break;a=l}for(const l of n)this._loadedParentTiles[l]=i}}_addTile(e){let n=this._tiles[e.key];if(n)return!0!==n.isExtraShadowCaster||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const i=!!n;if(!i){const a=this.map?this.map.painter:null;n=new ds(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new Me("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=n.getExpiryTimeout();i&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},i))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,i){const a=[],l=this.transform;if(!l)return a;const u="globe"===l.projection.name,d=Li(l.center.lng);for(const f in this._tiles){const p=this._tiles[f];if(i&&p.clearQueryDebugViz(),p.holdingForFade())continue;let g;if(u){const _=p.tileID.canonical;if(0===_.z){const x=[Math.abs(We(d,...nm(_,-1))-d),Math.abs(We(d,...nm(_,1))-d)];g=[0,2*x.indexOf(Math.min(...x))-1]}else{const x=[Math.abs(We(d,...nm(_,-1))-d),Math.abs(We(d,...nm(_,0))-d),Math.abs(We(d,...nm(_,1))-d)];g=[x.indexOf(Math.min(...x))-1]}}else g=[0];for(const _ of g){const x=e.containsTile(p,l,n,_);x&&a.push(x)}}return a}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){const i=this.getRenderableIds(e,n).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}sortCoordinatesByDistance(e){const n=e.slice(),i=this.transform._camera.position,a=this.transform._camera.forward(),l={};for(const u of n){const d=1/(1<<u.canonical.z);l[u.key]=((u.canonical.x+.5)*d+u.wrap-i[0])*a[0]+((u.canonical.y+.5)*d-i[1])*a[1]-i[2]*a[2]}return n.sort((u,d)=>l[u.key]-l[d.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(qv(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=Fe.now())return!0}return!1}setFeatureState(e,n,i){this._state.updateState(e=e||"_geojsonTileLayer",n,i)}removeFeatureState(e,n,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,i)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,i){const a=this._tiles[e];a&&a.setDependencies(n,i)}reloadTilesForDependencies(e,n){for(const i in this._tiles)this._tiles[i].hasDependency(e,n)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const d=()=>{this._sourceLoaded&&(this._source.off("data",d),this._preloadTiles(e,n))};return void this._source.on("data",d)}const i=new Map,a=Array.isArray(e)?e:[e],l=this.map.painter.terrain,u=this.usedForTerrain&&l?l.getScaledDemTileSize():this._source.tileSize;for(const d of a){const f=d.coveringTiles({tileSize:u,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const p of f)i.set(p.key,p);this.usedForTerrain&&d.updateElevation(!1)}vu(Array.from(i.values()),(d,f)=>{const p=new ds(d,this._source.tileSize*d.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(p,g=>{"raster-dem"===this._source.type&&p.dem&&this._backfillDEM(p),f(g,p)})},n)}}function eI(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function qv(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function nm(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}fs.maxOverzooming=10,fs.maxUnderzooming=3;const Zv=sn([{name:"a_pos_3f",components:3,type:"Float32"}]),tI=sn([{name:"a_color_3f",components:3,type:"Float32"}]),rM=sn([{name:"a_color_4f",components:4,type:"Float32"}]),nI=sn([{name:"a_uv_2f",components:2,type:"Float32"}]),rI=sn([{name:"a_normal_3f",components:3,type:"Float32"}]),iI=sn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),iM=sn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class a0{constructor(e=0,n=0,i=0,a=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0||isNaN(a)||a<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=i,this.right=a}interpolate(e,n,i){return null!=n.top&&null!=e.top&&(this.top=ut(e.top,n.top,i)),null!=n.bottom&&null!=e.bottom&&(this.bottom=ut(e.bottom,n.bottom,i)),null!=n.left&&null!=e.left&&(this.left=ut(e.left,n.left,i)),null!=n.right&&null!=e.right&&(this.right=ut(e.right,n.right,i)),this}getCenter(e,n){const i=We((this.left+e-this.right)/2,0,e),a=We((this.top+n-this.bottom)/2,0,n);return new ee(i,a)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new a0(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function oM(t,e){const n=_r(t,3);ne.fromQuat(t,e),xi(t,3,n)}function Wv(t,e){const n=Oi.identity([]);return Oi.rotateZ(n,n,-e),Oi.rotateX(n,n,-t),n}function sM(t,e){const n=[t[0],t[1],0],i=[e[0],e[1],0];if(G.length(n)>=1e-15){const u=G.normalize([],n);G.scale(i,u,G.dot(i,u)),e[0]=i[0],e[1]=i[1]}const a=G.cross([],e,t);if(G.len(a)<1e-15)return null;const l=Math.atan2(-a[1],a[0]);return Wv(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),l)}class aM{constructor(e,n){this.position=e,this.orientation=n}get position(){return this._position}set position(e){if(e){const n=e instanceof Gt?e:new Gt(e[0],e[1],e[2]);this._renderWorldCopies&&(n.x=Ja(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(e,n){if(this.orientation=null,!this.position)return;const i=this.position,a=this._elevation?this._elevation.getAtPointOrZero(Gt.fromLngLat(e)):0,l=Gt.fromLngLat(e,a),u=[l.x-i.x,l.y-i.y,l.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=sM(u,n)}setPitchBearing(e,n){this.orientation=Wv(Et(e),Et(-n))}}class jd{constructor(e,n){this._transform=ne.identity([]),this.orientation=n,this.position=e}get mercatorPosition(){const e=this.position;return new Gt(e[0],e[1],e[2])}get position(){const e=_r(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var n;e&&xi(this._transform,3,[(n=e)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||Oi.identity([]),e&&oM(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,n){this._orientation=Wv(e,n),oM(this._transform,this._orientation)}forward(){const e=_r(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=_r(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=_r(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,n){const i=new Float64Array(16);return ne.invert(i,this.getWorldToCamera(e,n)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,n,i){const a=this.position;G.scale(a,a,-e);const l=new Float64Array(16);return ne.fromScaling(l,[i,i,i]),ne.translate(l,l,a),l[10]*=n,l}getWorldToCamera(e,n){const i=new Float64Array(16),a=new Float64Array(4),l=this.position;return Oi.conjugate(a,this._orientation),G.scale(l,l,-e),ne.fromQuat(i,a),ne.translate(i,i,l),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(e,n,i,a){const l=new Float64Array(16);return ne.perspective(l,e,n,i,a),l}getCameraToClipOrthographic(e,n,i,a,l,u){const d=new Float64Array(16);return ne.ortho(d,e,n,i,a,l,u),d}getDistanceToElevation(e,n=!1){const i=0===e?0:vn(e,n?zr(this.position[1]):this.position[1]),a=this.forward();return(i-this.position[2])/a[2]}clone(){return new jd([...this.position],[...this.orientation])}}function l0(t,e){const n=jo(t.projection,t.zoom,t.width,t.height),i=function(l,u,d,f,p){const g=new _t(d.lng-180*po,d.lat),_=new _t(d.lng+180*po,d.lat),x=l.project(g.lng,g.lat),v=l.project(_.lng,_.lat),b=-Math.atan2(v.y-x.y,v.x-x.x),E=Gt.fromLngLat(d);E.y=We(E.y,-1+po,1-po);const C=E.toLngLat(),T=l.project(C.lng,C.lat),D=Gt.fromLngLat(C);D.x+=po;const A=D.toLngLat(),P=l.project(A.lng,A.lat),I=Xv(P.x-T.x,P.y-T.y,b),R=Gt.fromLngLat(C);R.y+=po;const k=R.toLngLat(),L=l.project(k.lng,k.lat),N=Xv(L.x-T.x,L.y-T.y,b),z=Math.abs(I.x)/Math.abs(N.y),j=ne.identity([]);ne.rotateZ(j,j,-b*(1-(p?0:f)));const B=ne.identity([]);return ne.scale(B,B,[1,1-(1-z)*f,1]),B[4]=-N.x/N.y*f,ne.rotateZ(B,B,b),ne.multiply(B,j,B),B}(t.projection,0,t.center,n,e),a=lM(t);return ne.scale(i,i,[a,a,1]),i}function lM(t){const e=t.projection,n=jo(t.projection,t.zoom,t.width,t.height),i=Ud(e,t.center),a=Ud(e,_t.convert(e.center));return Math.pow(2,i*n+(1-n)*a)}function jo(t,e,n,i,a=1/0){const l=t.range;if(!l)return 0;const u=Math.min(a,Math.max(n,i)),d=Math.log(u/1024)/Math.LN2;return Ya(l[0]+d,l[1]+d,e)}const po=1/4e4;function Ud(t,e){const n=We(e.lat,-Er,Er),i=new _t(e.lng-180*po,n),a=new _t(e.lng+180*po,n),l=t.project(i.lng,n),u=t.project(a.lng,n),d=Gt.fromLngLat(i),f=Gt.fromLngLat(a),p=u.x-l.x,g=u.y-l.y,_=f.x-d.x,x=f.y-d.y,v=Math.sqrt((_*_+x*x)/(p*p+g*g));return Math.log(v)/Math.LN2}function Xv(t,e,n){const i=Math.cos(n),a=Math.sin(n);return{x:t*i-e*a,y:t*a+e*i}}function th(t,e,n){return e*(le/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}const $d={unknown:0,flipRequired:1,flipNotRequired:2},oI=Math.tan(85*Math.PI/180);function Hd(t,e,n,i,a,l,u){const d=ne.create();if(n)if("globe"===l.name){const f=function(p,g){const{x:_,y:x}=p.point,v=iS(_,x,p.worldSize/p._pixelsPerMercatorPixel,0,0);return ne.multiply(v,v,Hu(uo(g)))}(a,e);ne.multiply(d,d,f)}else{const f=sd.invert([],u);d[0]=f[0],d[1]=f[1],d[4]=f[2],d[5]=f[3],i||ne.rotateZ(d,d,a.angle)}else ne.multiply(d,a.labelPlaneMatrix,t);return d}function c0(t,e,n,i,a,l,u){const d=Hd(t,e,n,i,a,l,u);return"globe"===l.name&&n||(d[2]=d[6]=d[10]=d[14]=0),d}function Yv(t,e,n,i,a,l,u){if(n){if("globe"===l.name){const d=Hd(t,e,n,i,a,l,u);return ne.invert(d,d),ne.multiply(d,t,d),d}{const d=ne.clone(t),f=ne.identity([]);return f[0]=u[0],f[1]=u[1],f[4]=u[2],f[5]=u[3],ne.multiply(d,d,f),i||ne.rotateZ(d,d,-a.angle),d}}return a.glCoordMatrix}function ia(t,e,n,i){const a=[t,e,n,1];n?xn.transformMat4(a,a,i):Qv(a,a,i);const l=a[3];return a[0]/=l,a[1]/=l,a[2]/=l,a}function cM(t,e){return Math.min(.5+t/e*.5,1.5)}function sI(t,e){const n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function aI(t,e,n,i,a,l,u,d,f,p){const g=n.transform,_=i?t.textSizeData:t.iconSizeData,x=ec(_,n.transform.zoom),v="globe"===g.projection.name,b=[256/n.width*2+1,256/n.height*2+1],E=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;E.clear();let C=null;v&&(C=i?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const T=t.lineVertexArray,D=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,A=n.transform.width/n.transform.height;let P,I=!1;for(let R=0;R<D.length;R++){const k=D.get(R),{numGlyphs:L,writingMode:N}=k;if(N!==Hn.vertical||I||P===Hn.horizontal||(I=!0),P=N,(k.hidden||N===Hn.vertical)&&!I){nh(L,E);continue}I=!1;const z=new ee(k.tileAnchorX,k.tileAnchorY);let{x:j,y:B,z:H}=g.projection.projectTilePoint(z.x,z.y,p.canonical);if(f){const[de,ge,ae]=f(z);j+=de,B+=ge,H+=ae}const V=[j,B,H,1];if(xn.transformMat4(V,V,e),!sI(V,b)){nh(L,E);continue}const Z=V[3],Q=cM(n.transform.getCameraToCenterDistance(g.projection),Z),te=Bp(_,x,k),W=u?te/Q:te*Q,X=ia(j,B,H,a);if(X[3]<=0){nh(L,E);continue}let re={};const oe=u?null:f,ce=Uo(k,W,!1,d,e,a,l,t.glyphOffsetArray,T,E,C,X,z,re,A,oe,g.projection,p,u);I=ce.useVertical,oe&&ce.needsFlipping&&(re={}),(ce.notEnoughRoom||I||ce.needsFlipping&&Uo(k,W,!0,d,e,a,l,t.glyphOffsetArray,T,E,C,X,z,re,A,oe,g.projection,p,u).notEnoughRoom)&&nh(L,E)}i?(t.text.dynamicLayoutVertexBuffer.updateData(E),C&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(C)):(t.icon.dynamicLayoutVertexBuffer.updateData(E),C&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(C))}function Gd(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E){const{lineStartIndex:C,glyphStartIndex:T,segment:D}=d,A=T+d.numGlyphs,P=C+d.lineLength,I=e.getoffsetX(T),R=e.getoffsetX(A-1),k=rm(t*I,n,i,a,l,u,D,C,P,f,p,g,_,x,!0,v,b,E);if(!k)return null;const L=rm(t*R,n,i,a,l,u,D,C,P,f,p,g,_,x,!0,v,b,E);return L?{first:k,last:L}:null}function Jv(t,e,n,i){return t===Hn.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:t===Hn.vertical?i>0?{needsFlipping:!0}:null:e!==$d.unknown&&(0===(a=n)||Math.abs(i/a)>oI)?e===$d.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null;var a}function Uo(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D){const A=e/24,P=t.lineOffsetX*A,I=t.lineOffsetY*A,{lineStartIndex:R,glyphStartIndex:k,numGlyphs:L,segment:N,writingMode:z,flipState:j}=t,B=R+t.lineLength,H=V=>{if(g){const[W,X,re]=V.up,oe=p.length;K_(g,oe+0,W,X,re),K_(g,oe+1,W,X,re),K_(g,oe+2,W,X,re),K_(g,oe+3,W,X,re)}const[Z,Q,te]=V.point;Pd(p,Z,Q,te,V.angle)};if(L>1){const V=Gd(A,d,P,I,n,_,x,t,f,l,v,E,!1,C,T,D);if(!V)return{notEnoughRoom:!0};if(i&&!n){let[Z,Q,te]=V.first.point,[W,X,re]=V.last.point;[Z,Q]=ia(Z,Q,te,u),[W,X]=ia(W,X,re,u);const oe=Jv(z,j,(W-Z)*b,X-Q);if(t.flipState=oe&&oe.needsFlipping?$d.flipRequired:$d.flipNotRequired,oe)return oe}H(V.first);for(let Z=k+1;Z<k+L-1;Z++){const Q=rm(A*d.getoffsetX(Z),P,I,n,_,x,N,R,B,f,l,v,E,!1,!1,C,T,D);if(!Q)return p.length-=4*(Z-k),{notEnoughRoom:!0};H(Q)}H(V.last)}else{if(i&&!n){const Z=ia(x.x,x.y,0,a),Q=R+N+1,te=new ee(f.getx(Q),f.gety(Q)),W=ia(te.x,te.y,0,a),X=W[3]>0?W:uM(x,te,Z,1,a,void 0,C,T.canonical),re=Jv(z,j,(X[0]-Z[0])*b,X[1]-Z[1]);if(t.flipState=re&&re.needsFlipping?$d.flipRequired:$d.flipNotRequired,re)return re}const V=rm(A*d.getoffsetX(k),P,I,n,_,x,N,R,B,f,l,v,E,!1,!1,C,T,D);if(!V)return{notEnoughRoom:!0};H(V)}return{}}function Kv(t,e,n,i,a){const{x:l,y:u,z:d}=i.projectTilePoint(t.x,t.y,e);if(!a)return ia(l,u,d,n);const[f,p,g]=a(t);return ia(l+f,u+p,d+g,n)}function uM(t,e,n,i,a,l,u,d){const f=Kv(t.sub(e)._unit()._add(t),d,a,u,l);return G.sub(f,n,f),G.normalize(f,f),G.scaleAndAdd(f,n,f,i)}function rm(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T){const D=i?t-e:t+e;let A=D>0?1:-1,P=0;i&&(A*=-1,P=Math.PI),A<0&&(P+=Math.PI);let I=d+u+(A>0?0:1)|0,R=a,k=a,L=0,N=0;const z=Math.abs(D),j=[],B=[];let H=l,V=H;const Z=()=>uM(V,H,k,z-L+1,g,x,E,C.canonical);for(;L+N<=z;){if(I+=A,I<d||I>=f)return null;if(k=R,V=H,j.push(k),v&&B.push(V),H=new ee(p.getx(I),p.gety(I)),R=_[I],!R){const ge=Kv(H,C.canonical,g,E,x);R=ge[3]>0?_[I]=ge:Z()}L+=N,N=G.distance(k,R)}b&&x&&(_[I]&&(R=Z(),N=G.distance(k,R)),_[I]=R);const Q=(z-L)/N,te=H.sub(V)._mult(Q)._add(V),W=G.sub([],R,k),X=G.scaleAndAdd([],k,W,Q);let re=[0,0,1],oe=W[0],ce=W[1];if(T&&(re=E.upVector(C.canonical,te.x,te.y),0!==re[0]||0!==re[1]||1!==re[2])){const ge=[re[2],0,-re[0]],ae=G.cross([],re,ge);G.normalize(ge,ge),G.normalize(ae,ae),oe=G.dot(W,ge),ce=G.dot(W,ae)}if(n){const ge=G.cross([],re,W);G.normalize(ge,ge),G.scaleAndAdd(X,X,ge,n*A)}const de=P+Math.atan2(ce,oe);return j.push(X),v&&B.push(te),{point:X,angle:de,path:j,tilePath:B,up:re}}function nh(t,e){const n=e.length,i=n+4*t;e.resize(i),e.float32.fill(-1/0,4*n,4*i)}function Qv(t,e,n){const i=e[0],a=e[1];return t[0]=n[0]*i+n[4]*a+n[12],t[1]=n[1]*i+n[5]*a+n[13],t[3]=n[3]*i+n[7]*a+n[15],t}const hM=(t,e,n)=>(1-n)*t+n*e,dM=t=>t*t*t*t*t;class e1{constructor(e,n,i,a,l,u,d){this.tileSize=512,this._renderWorldCopies=void 0===l||l,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=i??0,this._maxPitch=a??60,this.setProjection(u),this.setMaxBounds(d),this.width=0,this.height=0,this._center=new _t(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new a0,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new jd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new e1(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,n=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return Ro(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=Wp(this.projectionOptions);const i=!en(n,this.getProjection());return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Wp({name:"mercator"});const n=e!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return vn(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new ee(this.width,this.height)}get bearing(){return Ja(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const n=-e*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=sd.create(),sd.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=We(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=Et(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let a=0,l=0;for(let u=0;u<n.length;u++){const d=new ee(n[u][0]*this.width,i+n[u][1]*(this.height-i)),f=e.pointCoordinate(d);if(!f)continue;const p=1/Math.hypot(f[0]-this._camera.position[0],f[1]-this._camera.position[1]);a+=f[3]*p,l+=p}return 0===l?NaN:a/l}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*n,a=this._mercatorZfromZoom(e),l=this._mercatorZfromZoom(this._maxZoom),u=Math.max(a-i,l);this._setZoom(this._zoomFromMercatorZ(u))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let i;i=e.z<this._camera.position[2]?[n.x,n.y,n.z]:[e.x,e.y,e.z];const a=G.length(G.sub([],this._camera.position,i));return We(this._zoomFromMercatorZ(a),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let n=!1;if(e.orientation&&!Oi.exactEquals(e.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(e.orientation)),e.position){const i=[e.position.x,e.position.y,e.position.z];G.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,n=new aM;return n.position=new Gt(e[0],e[1],e[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(e){if(!Oi.length(e))return!1;Oi.normalize(e,e);const n=G.transformQuat([],[0,0,-1],e),i=G.transformQuat([],[0,-1,0],e);if(i[2]<0)return!1;const a=sM(n,i);return!!a&&(this._camera.orientation=a,!0)}_setCameraPosition(e){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,a=this.cameraToCenterDistance;e[2]=We(e[2],a/i,a/n),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,i){this._unmodified=!1,this._edgeInsets.interpolate(e,n,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new l_(0,e)];if(this.renderWorldCopies){const i=this.pointCoordinate(new ee(0,0)),a=this.pointCoordinate(new ee(this.width,0)),l=this.pointCoordinate(new ee(this.width,this.height)),u=this.pointCoordinate(new ee(0,this.height)),d=Math.floor(Math.min(i.x,a.x,l.x,u.x)),f=Math.floor(Math.max(i.x,a.x,l.x,u.x)),p=1;for(let g=d-p;g<=f+p;g++)0!==g&&n.push(new l_(g,e))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,n,i){let a=[];if(0===n[0]&&0===n[1])return a;for(const u of e){const d=u.canonical,f=u.overscaledZ,p=u.wrap,g=1<<d.z,_=d.x+1<g,x=d.x>0,v=d.y+1<g,b=d.y>0,E=u.wrap-(x?0:1),C=u.wrap+(_?0:1),T=x?d.x-1:g-1,D=_?d.x+1:0;n[0]<0?(a.push(new Zt(f,C,d.z,D,d.y)),n[1]<0&&v&&(a.push(new Zt(f,p,d.z,d.x,d.y+1)),a.push(new Zt(f,C,d.z,D,d.y+1))),n[1]>0&&b&&(a.push(new Zt(f,p,d.z,d.x,d.y-1)),a.push(new Zt(f,C,d.z,D,d.y-1)))):n[0]>0?(a.push(new Zt(f,E,d.z,T,d.y)),n[1]<0&&v&&(a.push(new Zt(f,p,d.z,d.x,d.y+1)),a.push(new Zt(f,E,d.z,T,d.y+1))),n[1]>0&&b&&(a.push(new Zt(f,p,d.z,d.x,d.y-1)),a.push(new Zt(f,E,d.z,T,d.y-1)))):n[1]<0&&v?a.push(new Zt(f,p,d.z,d.x,d.y+1)):b&&a.push(new Zt(f,p,d.z,d.x,d.y-1))}if(a.length>1){a.sort((f,p)=>f.overscaledZ-p.overscaledZ||f.wrap-p.wrap||f.canonical.z-p.canonical.z||f.canonical.x-p.canonical.x||f.canonical.y-p.canonical.y);let u=0,d=0;for(;d<a.length;)a[d].equals(a[u])?++d:a[++u]=a[d++];a.length=u+1}const l=[];for(const u of a)a.some(d=>u.isChildOf(d))||l.push(u);return a=l.filter(u=>!e.some(d=>!!(u.overscaledZ<i&&d.isChildOf(u))||u.equals(d)||u.isChildOf(d))),a}coveringTiles(e){let n=this.coveringZoomLevel(e);const i=n,a=this.elevation&&this.elevation.exaggeration(),l=a&&!e.isTerrainDEM,u="mercator"===this.projection.name;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const d=this.locationCoordinate(this.center),f=this.center.lat,p=1<<n,g=[p*d.x,p*d.y,0],_="globe"===this.projection.name,x=!_,v=fl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,x),b=_?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),E=p*vn(1,this.center.lat),C=this._camera.position[2]/vn(1,this.center.lat),T=[p*b.x,p*b.y,C*(x?1:E)],D=_||a,A=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),P=this.isLODDisabled(!0)?n:0,I=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,R=e.isTerrainDEM?-I:this._elevation?this._elevation.getMinElevationBelowMSL():0,k=this.projection.isReprojectedInTileSpace?lM(this):1,L=W=>{const re=new Gt(W.x+25e-6,W.y,W.z),oe=new Gt(W.x,W.y+25e-6,W.z),ce=W.toLngLat(),de=re.toLngLat(),ge=oe.toLngLat(),ae=this.locationCoordinate(ce),ue=this.locationCoordinate(de),Se=this.locationCoordinate(ge),Ne=Math.hypot(ue.x-ae.x,ue.y-ae.y),ze=Math.hypot(Se.x-ae.x,Se.y-ae.y);return Math.sqrt(Ne*ze)*k/25e-6},N=W=>{const X=I,re=R;return{aabb:q_(this,p,0,0,0,W,re,X,this.projection),zoom:0,x:0,y:0,minZ:re,maxZ:X,wrap:W,fullyVisible:!1}},z=[];let j=[];const B=n,H=e.reparseOverscaled?i:n,V=W=>W*W,Z=V((C-this._centerAltitude)*E),Q=W=>{if(!this._elevation||!W.tileID||!u)return;const X=this._elevation.getMinMaxForTile(W.tileID),re=W.aabb;X?(re.min[2]=X.min,re.max[2]=X.max,re.center[2]=(re.min[2]+re.max[2])/2):(W.shouldSplit=te(W),W.shouldSplit||(re.min[2]=re.max[2]=re.center[2]=this._centerAltitude))},te=W=>{if(W.zoom<P)return!0;if(W.zoom===B)return!1;if(null!=W.shouldSplit)return W.shouldSplit;const X=W.aabb.distanceX(T),re=W.aabb.distanceY(T);let oe=Z,ce=1;if(_){oe=V(W.aabb.distanceZ(T));const ae=Math.pow(2,W.zoom),ue=zr((W.y+1)/ae),Se=zr(W.y/ae),Ne=Math.min(Math.max(f,ue),Se),ze=dd(Ne)/dd(f);if(ce=Ne===f?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ze/this._mercatorScaleRatio),this.zoom<=gp&&W.zoom===B-1&&ze>=.9)return!0}else if(l&&(oe=V(W.aabb.distanceZ(T)*E)),this.projection.isReprojectedInTileSpace&&i<=5){const ae=Math.pow(2,W.zoom),ue=L(new Gt((W.x+.5)/ae,(W.y+.5)/ae));ce=ue>.85?1:ue}const de=X*X+re*re+oe;return de<V((1<<B-W.zoom)*A*ce*((ae,ue)=>{if(ue*V(.707)<ae)return 1;const Se=Math.sqrt(ue/ae);return Se/(1.4144271570014144+(Math.pow(1.1,Se-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(oe,Z),de))};if(this.renderWorldCopies)for(let W=1;W<=3;W++)z.push(N(-W)),z.push(N(W));for(z.push(N(0));z.length>0;){const W=z.pop(),X=W.x,re=W.y;let oe=W.fullyVisible;const ce=()=>"globe"===this.projection.name&&(0===W.y||W.y===(1<<W.zoom)-1);if(!oe){let de=D?W.aabb.intersects(v):W.aabb.intersectsFlat(v);if(0===de&&ce()){const ge=new Qs(W.zoom,X,re);de=h_(this,p,ge,!0).intersects(v)}if(0===de)continue;oe=2===de}if(W.zoom!==B&&te(W))for(let de=0;de<4;de++){const ge=(X<<1)+de%2,ae=(re<<1)+(de>>1),ue={aabb:u?W.aabb.quadrant(de):q_(this,p,W.zoom+1,ge,ae,W.wrap,W.minZ,W.maxZ,this.projection),zoom:W.zoom+1,x:ge,y:ae,wrap:W.wrap,fullyVisible:oe,tileID:void 0,shouldSplit:void 0,minZ:W.minZ,maxZ:W.maxZ};l&&!_&&(ue.tileID=new Zt(W.zoom+1===B?H:W.zoom+1,W.wrap,W.zoom+1,ge,ae),Q(ue)),z.push(ue)}else{const de=W.zoom===B?H:W.zoom;if(e.minzoom&&e.minzoom>de)continue;if(!oe){let Se=D?W.aabb.intersectsPrecise(v):W.aabb.intersectsPreciseFlat(v);if(0===Se&&ce()){const Ne=new Qs(W.zoom,X,re);Se=h_(this,p,Ne,!0).intersectsPrecise(v)}if(0===Se)continue}const ge=g[0]-(.5+X+(W.wrap<<W.zoom))*(1<<n-W.zoom),ae=g[1]-.5-re,ue=W.tileID?W.tileID:new Zt(de,W.wrap,W.zoom,X,re);j.push({tileID:ue,distanceSq:ge*ge+ae*ae})}}if(this.fogCullDistSq){const W=this.fogCullDistSq,X=this.horizonLineFromTop();j=j.filter(re=>{const oe=[0,0,0,1],ce=[le,le,0,1],de=this.calculateFogTileMatrix(re.tileID.toUnwrapped());xn.transformMat4(oe,oe,de),xn.transformMat4(ce,ce,de);const ge=function(Se,Ne,ze){let Ve=0;for(let Ke=0;Ke<2;++Ke)Se[Ke]>0&&(Ve+=(Se[Ke]-0)*(Se[Ke]-0)),Ne[Ke]<0&&(Ve+=(0-Ne[Ke])*(0-Ne[Ke]));return Ve}(xn.min([],oe,ce),xn.max([],oe,ce));if(0===ge)return!0;let ae=!1;const ue=this._elevation;if(ue&&ge>W&&0!==X){const Se=this.calculateProjMatrix(re.tileID.toUnwrapped());let Ne;e.isTerrainDEM||(Ne=ue.getMinMaxForTile(re.tileID)),Ne||(Ne={min:R,max:I});const ze=function(Ke){const ht=Math.round((Ke+45+360)%360/90)%4;return Ty[ht]}(this.rotation),Ve=[ze[0]*le,ze[1]*le,Ne.max];G.transformMat4(Ve,Ve,Se),ae=(1-Ve[1])*this.height*.5<X}return ge<W||ae})}return j.sort((W,X)=>W.distanceSq-X.distanceSq).map(W=>W.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=We(e.lat,-Er,Er),i=this.projection.project(e.lng,n);return new ee(i.x*this.worldSize,i.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/vn(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,n){let i,a;const l=this.centerPoint;if("globe"===this.projection.name){const d=this.worldSize;i=(n.x-l.x)/d,a=(n.y-l.y)/d}else{const d=this.pointCoordinate(n),f=this.pointCoordinate(l);i=d.x-f.x,a=d.y-f.y}const u=this.locationCoordinate(e);this.setLocation(new Gt(u.x-i,u.y-a))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,n){const i=n?vn(n,e.lat):void 0,a=this.projection.project(e.lng,e.lat);return new Gt(a.x,a.y,i)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,n){const i=n??this._centerAltitude,a=[e.x,e.y,0,1],l=[e.x,e.y,1,1];xn.transformMat4(a,a,this.pixelMatrixInverse),xn.transformMat4(l,l,this.pixelMatrixInverse);const u=l[3];xn.scale(a,a,1/a[3]),xn.scale(l,l,1/u);const d=a[2],f=l[2];return{p0:a,p1:l,t:d===f?0:(i-d)/(f-d)}}screenPointToMercatorRay(e){const n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];return xn.transformMat4(n,n,this.pixelMatrixInverse),xn.transformMat4(i,i,this.pixelMatrixInverse),xn.scale(n,n,1/n[3]),xn.scale(i,i,1/i[3]),n[2]=vn(n[2],this._center.lat)*this.worldSize,i[2]=vn(i[2],this._center.lat)*this.worldSize,xn.scale(n,n,1/this.worldSize),xn.scale(i,i,1/this.worldSize),new ad([n[0],n[1],n[2]],G.normalize([],G.sub([],i,n)))}rayIntersectionCoordinate(e){const{p0:n,p1:i,t:a}=e,l=vn(n[2],this._center.lat),u=vn(i[2],this._center.lat);return new Gt(ut(n[0],i[0],a)/this.worldSize,ut(n[1],i[1],a)/this.worldSize,ut(l,u,a))}pointCoordinate(e,n=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,n)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let n=this.projection.pointCoordinate3D(this,e.x,e.y);if(n)return new Gt(n[0],n[1],n[2]);let i=0,a=this.horizonLineFromTop();if(e.y>a)return this.pointCoordinate(e);const l=.02*a,u=e.clone();for(let d=0;d<10&&a-i>l;d++){u.y=ut(i,a,.66);const f=this.projection.pointCoordinate3D(this,u.x,u.y);f?(a=u.y,n=f):i=u.y}return n?new Gt(n[0],n[1],n[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=Hc)return!this.isPointAboveHorizon(e);const n=this.pointCoordinate(e);return n.y>=0&&n.y<=1}_coordinatePoint(e,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,a=[e.x*this.worldSize,e.y*this.worldSize,i+e.toAltitude(),1];return xn.transformMat4(a,a,this.pixelMatrix),a[3]>0?new ee(a[0]/a[3],a[1]/a[3]):new ee(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,l=this.pointLocation3D(new ee(n,e)),u=this.pointLocation3D(new ee(a,e)),d=this.pointLocation3D(new ee(a,i)),f=this.pointLocation3D(new ee(n,i));let p=Math.min(l.lng,u.lng,d.lng,f.lng),g=Math.max(l.lng,u.lng,d.lng,f.lng),_=Math.min(l.lat,u.lat,d.lat,f.lat),x=Math.max(l.lat,u.lat,d.lat,f.lat);const v=Math.pow(2,-this.zoom)/16*270,b="globe"===this.projection.name?1:4,E=(C,T,D,A,P)=>{const I=(C+D)/2,R=(T+A)/2,k=new ee(I,R),{lng:L,lat:N}=this.pointLocation3D(k),z=Math.max(0,p-L,_-N,L-g,N-x);p=Math.min(p,L),g=Math.max(g,L),_=Math.min(_,N),x=Math.max(x,N),(P<b||z>v)&&(E(C,T,I,R,P+1),E(I,R,D,A,P+1))};if(E(n,e,a,e,1),E(a,e,a,i,1),E(a,i,n,i,1),E(n,i,n,e,1),"globe"===this.projection.name){const[C,T]=function(D){const A=ne.identity(new Float64Array(16));ne.multiply(A,D.pixelMatrix,D.globeMatrix);const P=[0,co,0],I=[0,ea,0];return G.transformMat4(P,P,A),G.transformMat4(I,I,A),[P[0]>0&&P[0]<=D.width&&P[1]>0&&P[1]<=D.height&&!p_(D,new _t(D.center.lat,90)),I[0]>0&&I[0]<=D.width&&I[1]>0&&I[1]<=D.height&&!p_(D,new _t(D.center.lat,-90))]}(this);C?(x=90,g=180,p=-180):T&&(_=-90,g=180,p=-180)}return new Rs(new _t(p,_),new _t(g,x))}_getBoundsRectangular(e,n){const{top:i,left:a}=this._edgeInsets,l=this.height-this._edgeInsets.bottom,u=this.width-this._edgeInsets.right,d=new ee(a,i),f=new ee(u,i),p=new ee(u,l),g=new ee(a,l);let _=this.pointCoordinate(d,e),x=this.pointCoordinate(f,e);const v=this.pointCoordinate(p,n),b=this.pointCoordinate(g,n),E=(C,T)=>(T.y-C.y)/(T.x-C.x);return _.y>1&&x.y>=0?_=new Gt((1-b.y)/E(b,_)+b.x,1):_.y<0&&x.y<=1&&(_=new Gt(-b.y/E(b,_)+b.x,0)),x.y>1&&_.y>=0?x=new Gt((1-v.y)/E(v,x)+v.x,1):x.y<0&&_.y<=1&&(x=new Gt(-v.y/E(v,x)+v.x,0)),(new Rs).extend(this.coordinateLocation(_)).extend(this.coordinateLocation(x)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(v))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=e.visibleDemTiles.reduce((i,a)=>{if(a.dem){const l=a.dem.tree;i.min=Math.min(i.min,l.minimums[0]),i.max=Math.max(i.max,l.maximums[0])}return i},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*e.exaggeration(),n.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-n*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-Er,this.maxLat=Er,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Li(this.minLng)*this.tileSize,this.worldMaxX=Li(this.maxLng)*this.tileSize,this.worldMinY=Gi(this.maxLat)*this.tileSize,this.worldMaxY=Gi(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,n){return this.projection.createTileMatrix(this,n,e)}calculateDistanceTileData(e){const n=e.key,i=this._distanceTileDataCache;if(i[n])return i[n];const a=e.canonical,l=1/this.height,u=this.cameraWorldSize,d=u/this.zoomScale(a.z),f=(a.x+Math.pow(2,a.z)*e.wrap)*d,p=a.y*d,g=this.point;g.x*=u/this.worldSize,g.y*=u/this.worldSize;const _=this.angle,x=Math.sin(-_),v=-Math.cos(-_);return i[n]={bearing:[x,v],center:[(g.x-f)*l,(g.y-p)*l],scale:d/le*l},i[n]}calculateFogTileMatrix(e){const n=e.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const a=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return ne.multiply(a,this.worldToFogMatrix,a),i[n]=new Float32Array(a),i[n]}calculateProjMatrix(e,n=!1){const i=e.key,a=n?this._alignedProjMatrixCache:this._projMatrixCache;if(a[i])return a[i];const l=this.calculatePosMatrix(e,this.worldSize);return ne.multiply(l,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.alignedProjMatrix:this.projMatrix,l),a[i]=new Float32Array(l),a[i]}calculatePixelsToTileUnitsMatrix(e){const n=e.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];const a=function(l,u){const{scale:d}=l.tileTransform,f=d*le/(l.tileSize*Math.pow(2,u.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return sd.scale(new Float32Array(4),u.inverseAdjustmentMatrix,[f,f])}(e,this);return i[n]=a,i[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,n=ne.fromScaling([],[e,e,e]);return ne.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const n=vn(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),a=this._camera.forward(),l=vn(1,this._center.lat);i[2]/=l,a[2]/=l,G.normalize(a,a);const u=e.raycast(i,a,e.exaggeration());if(u){const d=G.scaleAndAdd([],i,a,u),f=new Gt(d[0],d[1],vn(d[2],zr(d[1]))),p=(f.z+G.length([f.x-i[0],f.y-i[1],f.z-i[2]*l]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(p),this._centerAltitude=f.toAltitude(),this._center=this.coordinateLocation(f),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const n=this._elevation,i=vn(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(i),l=n.getAtPointOrZero(new Gt(...a)),u=this.pixelsPerMeter/this.worldSize*l,d=this._minimumHeightOverTerrain(),f=a[2]-u;if(f<=d)if(f<0||e){const p=this.locationCoordinate(this._center,this._centerAltitude),g=[a[0],a[1],p.z-a[2]],_=G.length(g);g[2]-=(d-f)/this._pixelsPerMercatorPixel;const x=G.length(g);if(0===x)return;G.scale(g,g,_/x*this._pixelsPerMercatorPixel),this._camera.position=[a[0],a[1],p.z*this._pixelsPerMercatorPixel-g[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const x=this.center;return x.lat=We(x.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(x.lng=We(x.lng,this.minLng,this.maxLng)),this.center=x,void(this._constraining=!1)}const n=this._unmodified,{x:i,y:a}=this.point;let l=0,u=i,d=a;const f=this.width/2,p=this.height/2,g=this.worldMinY*this.scale,_=this.worldMaxY*this.scale;if(a-p<g&&(d=g+p),a+p>_&&(d=_-p),_-g<this.height&&(l=Math.max(l,this.height/(_-g)),d=(_+g)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const x=this.worldMinX*this.scale,v=this.worldMaxX*this.scale,b=this.worldSize/2-(x+v)/2;u=(i+b+this.worldSize)%this.worldSize-b,u-f<x&&(u=x+f),u+f>v&&(u=v-f),v-x<this.width&&(l=Math.max(l,this.width/(v-x)),u=(v+x)/2)}u===i&&d===a||(this.center=this.unproject(new ee(u,d))),l&&(this.zoom+=this.scaleZoom(l)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=vn(1,this.center.lat)/vn(1,45));const a=jo(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const l="meters"===this.projection.zAxisUnit?i:1,u=this._camera.getWorldToCamera(this.worldSize,l);let d;const f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(f[8]=2*-e.x/this.width,f[9]=2*e.y/this.height,this.isOrthographic){let N=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),z=N*this.aspect,j=-z,B=-N;z-=e.x,j-=e.x,N+=e.y,B+=e.y,d=this._camera.getCameraToClipOrthographic(j,z,B,N,this._nearZ,this._farZ),((H,V,Z,Q)=>{for(let te=0;te<16;te++)H[te]=hM(V[te],Z[te],Q)})(d,d,f,dM(this.pitch>=15?1:this.pitch/15))}else d=f;const p=ne.mul([],f,u);let g=ne.mul([],d,u);if(this.projection.isReprojectedInTileSpace){const N=this.locationCoordinate(this.center),z=ne.identity([]);ne.translate(z,z,[N.x*this.worldSize,N.y*this.worldSize,0]),ne.multiply(z,z,l0(this)),ne.translate(z,z,[-N.x*this.worldSize,-N.y*this.worldSize,0]),ne.multiply(g,g,z),ne.multiply(p,p,z),this.inverseAdjustmentMatrix=function(j){const B=l0(j,!0);return sd.invert([],[B[0],B[1],B[4],B[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=ne.scale([],g,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=g,this.invProjMatrix=ne.invert(new Float64Array(16),this.projMatrix);const _=ne.invert([],d);this.frustumCorners=ld.fromInvProjectionMatrix(_,this.horizonLineFromTop(),this.height),this.cameraFrustum=fl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const x=new Float32Array(16);ne.identity(x),ne.scale(x,x,[1,-1,1]),ne.rotateX(x,x,this._pitch),ne.rotateZ(x,x,this.angle);const v=ne.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=ne.clone(v);const b=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;v[8]=2*-e.x/this.width,v[9]=2*(e.y+b)/this.height,this.skyboxMatrix=ne.multiply(x,v,x);const E=this.point,C=E.x,T=E.y,D=this.width%2/2,A=this.height%2/2,P=Math.cos(this.angle),I=Math.sin(this.angle),R=C-Math.round(C)+P*D+I*A,k=T-Math.round(T)+P*A+I*D,L=new Float64Array(g);if(ne.translate(L,L,[R>.5?R-1:R,k>.5?k-1:k,0]),this.alignedProjMatrix=L,g=ne.create(),ne.scale(g,g,[this.width/2,-this.height/2,1]),ne.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=ne.create(),ne.scale(g,g,[1,-1,1]),ne.translate(g,g,[-1,-1,0]),ne.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=ne.multiply(new Float64Array(16),this.labelPlaneMatrix,p),this._calcFogMatrices(),this._distanceTileDataCache={},g=ne.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=g,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(z){const{x:j,y:B}=z.point,{lng:H,lat:V}=z._center;return iS(j,B,z.worldSize,H,V)}(this);const N=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=G.transformMat4(N,N,u),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=g;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,a=1/this.height/this._pixelsPerMercatorPixel,l=[e,e,n];G.scale(l,l,a),G.scale(i,i,-1),G.multiply(i,i,l);const u=ne.create();ne.translate(u,u,i),ne.scale(u,u,l),this.mercatorFogMatrix=u,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,n,a)}_computeCameraPosition(e){const n=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),a=this.point,l=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-e/this.worldSize*this._centerAltitude;return[a.x/this.worldSize-i[0]*l,a.y/this.worldSize-i[1]*l,e/this.worldSize*this._centerAltitude-i[2]*l]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],a=e[2];let l=1;this.projection.wrap&&(this.center=this.center.wrap()),a>0&&(l=Math.min((n-i)/a,1)),this._camera.position=G.scaleAndAdd([],this._camera.position,e,l),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:a}=this._camera.getPitchBearing(),l=vn(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,u=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Et(this._maxPitch)),d=Math.max((e[2]-l)/Math.cos(i),u),f=this._zoomFromMercatorZ(d);G.scaleAndAdd(e,e,n,d),this._pitch=We(i,Et(this.minPitch),Et(this.maxPitch)),this.angle=Ja(a,-Math.PI,Math.PI),this._setZoom(We(f,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Gt(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let n=0,i=Hc,a=0,l=1/0;for(;i-n>1e-6&&i>n;){const u=n+.5*(i-n),d=this.tileSize*Math.pow(2,u),f=this.getCameraToCenterDistance(this.projection,u,d),p=this.scaleZoom(f/(e*this.tileSize)),g=Math.abs(u-p);g<l&&(l=g,a=u),u<p?n=u:i=u}return a}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(K("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,n){const i=Math.min(e.x,n.x),a=Math.max(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.y,n.y);if(l<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const d=[new ee(i,l),new ee(a,u),new ee(i,u),new ee(a,l)],f=this.renderWorldCopies?-3:0,p=this.renderWorldCopies?4:1;for(const g of d){const _=this.pointRayIntersection(g);if(_.t<0)return!0;const x=this.rayIntersectionCoordinate(_);if(x.x<f||x.y<0||x.x>p||x.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+ei(this.fovAboveCenter)>88||this.anyCornerOffEdge(new ee(0,0),new ee(this.width,this.height))}zoomDeltaToMovement(e,n){const i=G.length(G.sub([],this._camera.position,e)),a=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(a)}getCameraPoint(){if("globe"===this.projection.name){const e=function([n,i,a],l){const u=[n,i,a,1];xn.transformMat4(u,u,l);const d=u[3]=Math.max(u[3],1e-6);return u[0]/=d,u[1]/=d,u[2]/=d,u}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new ee(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new ee(0,e))}}getCameraToCenterDistance(e,n=this.zoom,i=this.worldSize){const a=jo(e,n,this.width,this.height,1024),l=e.pixelSpaceConversion(this.center.lat,i,a);let u=.5/Math.tan(.5*this._fov)*this.height*l;return this.isOrthographic&&(u=hM(1,u,dM(this.pitch>=15?1:this.pitch/15))),u}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&ne.multiply(e,e,this.globeMatrix),e}getFrustum(e){return fl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}function fM(t,e,n){ne.identity(t),ne.rotateZ(t,t,Et(e[2])),ne.rotateX(t,t,Et(e[0])),ne.rotateY(t,t,Et(e[1])),ne.scale(t,t,n),ne.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function im(t,e,n,i,a,l,u,d){const f=[n[0]-e[0],n[1]-e[1],0],p=[i[0]-e[0],i[1]-e[1],0];if(G.length(f)<1e-12||G.length(p)<1e-12)return Oi.identity(t);const g=G.cross([],f,p);G.normalize(g,g),G.subtract(p,i,e),f[2]=(l-a)*d,p[2]=(u-a)*d;const _=f;return G.cross(_,f,p),G.normalize(_,_),Oi.rotationTo(t,g,_)}function u0(t,e,n=!1){const i=ki(e.zoom),a=function(l,u,d){const f=u.worldSize,p=[l[12],l[13],l[14]],g=zr(p[1]/f),_=ls(p[0]/f),x=ne.identity([]),v=vn(1,g)*f,b=vn(1,0)*f*Ta(g,u.zoom),E=1/Hx(f);let C=b*E;if(d){const P=jo(u.projection,u.zoom,u.width,u.height,1024);C=E*u.projection.pixelSpaceConversion(u.center.lat,f,P)}const T=Vo(g,_);G.add(T,T,G.scale([],G.normalize([],T),v*C*p[2]));const D=function(P){const I=[P[0],P[1],P[2]];let R=[0,1,0];const k=G.cross([],R,I);return G.cross(R,I,k),0===G.squaredLength(R)&&(R=[0,1,0],G.cross(k,I,R)),G.normalize(k,k),G.normalize(R,R),G.normalize(I,I),[k[0],k[1],k[2],0,R[0],R[1],R[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],1]}(T);ne.scale(x,x,[C,C,C*v]),ne.translate(x,x,[-p[0],-p[1],-p[2]]);const A=ne.multiply([],u.globeMatrix,D);return ne.multiply(A,A,x),ne.multiply(A,A,l),A}(t,e,n);return i>0?function(u,d,f){const p=(b,E,C)=>{const T=G.length(b),D=G.length(E),A=ta(b,E,C);return G.scale(A,A,1/G.length(A)*ut(T,D,C))},g=p([u[0],u[1],u[2]],[d[0],d[1],d[2]],f),_=p([u[4],u[5],u[6]],[d[4],d[5],d[6]],f),x=p([u[8],u[9],u[10]],[d[8],d[9],d[10]],f),v=ta([u[12],u[13],u[14]],[d[12],d[13],d[14]],f);return[g[0],g[1],g[2],0,_[0],_[1],_[2],0,x[0],x[1],x[2],0,v[0],v[1],v[2],1]}(a,function(u,d){const f=d.worldSize,p=vn(1,0)*f*Ta(d.center.lat,d.zoom)/Hx(f),g=vn(1,d.center.lat)*f,_=ne.identity([]);return ne.rotateY(_,_,Et(d.center.lng)),ne.rotateX(_,_,Et(d.center.lat)),ne.translate(_,_,[0,0,lo]),ne.scale(_,_,[p,p,p*g]),ne.translate(_,_,[d.point.x-.5*f,d.point.y-.5*f,0]),ne.multiply(_,_,u),ne.multiply(_,d.globeMatrix,_)}(t,e),i):a}const pM=[1,1,1];class t1{constructor(e,n,i,a){this.id=e,this.position=null!=n?new _t(n[0],n[1]):new _t(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new $n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){if(ne.multiply(e.matrix,n,e.matrix),e.meshes)for(const i of e.meshes){const a=$n.applyTransform(i.aabb,e.matrix);this.aabb.encapsulate(a)}if(e.children)for(const i of e.children)this._applyTransformations(i,e.matrix)}computeBoundsAndApplyParent(){const e=ne.identity([]);for(const n of this.nodes)this._applyTransformations(n,e)}_positionModelOnTerrain(e,n){const i=e.elevation;if(!i)return 0;const a=$n.projectAabbCorners(this.aabb,this.matrix),l=vn(1,this.position.lat)*e.worldSize,u=function(T,D){const A=[0,0,1],P=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const I of P){const R=T[I.corners[0]],k=T[I.corners[1]],L=T[I.corners[2]],N=[k[0]-R[0],k[1]-R[1],D*(k[2]-R[2])],z=G.cross(N,N,[L[0]-R[0],L[1]-R[1],D*(L[2]-R[2])]);G.normalize(z,z),I.dotProductWithUp=G.dot(z,A)}return P.sort((I,R)=>I.dotProductWithUp-R.dotProductWithUp),P[0].corners}(a,l),d=a[u[0]],f=a[u[1]],p=a[u[2]],g=a[u[3]],_=i.getAtPointOrZero(new Gt(d[0]/e.worldSize,d[1]/e.worldSize),0),x=i.getAtPointOrZero(new Gt(f[0]/e.worldSize,f[1]/e.worldSize),0),v=i.getAtPointOrZero(new Gt(p[0]/e.worldSize,p[1]/e.worldSize),0),b=i.getAtPointOrZero(new Gt(g[0]/e.worldSize,g[1]/e.worldSize),0),E=(_+b)/2,C=(x+v)/2;return E>C?x<v?im(n,f,g,d,x,b,_,l):im(n,p,d,g,v,_,b,l):_<b?im(n,d,f,p,_,x,v,l):im(n,g,p,f,b,v,x,l),Math.max(E,C)}computeModelMatrix(e,n,i,a,l,u,d=!1){const f=e.transform,p=f.zoom,g=f.project(this.position),_=Ta(this.position.lat,p),x=1/_;ne.identity(this.matrix),ne.translate(this.matrix,this.matrix,[g.x+a[0]*x,g.y+a[1]*x,a[2]]);let v=1,b=1;const E=f.worldSize;if(d){if("mercator"===f.projection.name){let A=0;f.elevation&&(A=f.elevation.getAtPointOrZero(new Gt(g.x/E,g.y/E),0));const P=xn.transformMat4([],[g.x,g.y,A,1],f.projMatrix)[3]/f.cameraToCenterDistance;v=P,b=P*Ta(f.center.lat,p)}else if("globe"===f.projection.name){const A=u0(this.matrix,f),P=ne.multiply([],f.projMatrix,A),I=[0,0,0,1];xn.transformMat4(I,I,P);const R=I[3]/f.cameraToCenterDistance,k=ki(p),L=f.projection.pixelsPerMeter(this.position.lat,E)*Ta(this.position.lat,p),N=f.projection.pixelsPerMeter(f.center.lat,E)*Ta(f.center.lat,p);v=R/ut(L,qx(f.center.lat),k),b=R*_/L,v*=N,b*=N}}else v=x;ne.scale(this.matrix,this.matrix,[v,v,b]);const C=[...this.matrix],T=this.orientation,D=[];if(fM(D,[T[0]+n[0],T[1]+n[1],T[2]+n[2]],i),ne.multiply(this.matrix,C,D),l&&f.elevation){let A=0;const P=[];if(u&&f.elevation){A=this._positionModelOnTerrain(f,P);const I=ne.fromQuat([],P),R=ne.multiply([],I,D);ne.multiply(this.matrix,C,R)}else A=f.elevation.getAtPointOrZero(new Gt(g.x/E,g.y/E),0);0!==A&&(this.matrix[14]+=A)}}upload(e){if(!this.uploaded){for(const n of this.nodes)h0(n,e);for(const n of this.nodes)om(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)sm(e)}}function qd(t,e,n=!1){t.uploaded||(t.gfxTexture=new kr(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function mM(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,Zv.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,rI.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,nI.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?tI:rM).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,iM.members,!0)),t.segments=bn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const i=t.material;i.pbrMetallicRoughness.baseColorTexture&&qd(i.pbrMetallicRoughness.baseColorTexture,e),i.pbrMetallicRoughness.metallicRoughnessTexture&&qd(i.pbrMetallicRoughness.metallicRoughnessTexture,e),i.normalTexture&&qd(i.normalTexture,e),i.occlusionTexture&&qd(i.occlusionTexture,e,n),i.emissionTexture&&qd(i.emissionTexture,e)}function h0(t,e,n){if(t.meshes)for(const i of t.meshes)mM(i,e,n);if(t.children)for(const i of t.children)h0(i,e,n)}function om(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)om(e)}function sm(t){if(t.meshes)for(const n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const n of t.children)sm(n)}class am{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class sc{constructor(){this.instancedDataArray=new Kw,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class gM{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,i,a){this.tileToMeter=Zu(i);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:u,id:d,index:f,sourceLayerIndex:p}of e){const g=qc(u,l);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),g,i))continue;const _={id:d,sourceLayerIndex:p,index:f,geometry:l?g.geometry:pl(u,i,a),properties:u.properties,type:u.type,patterns:{}},x=this.addFeature(_,_.geometry,g);x&&n.featureIndex.insert(u,_.geometry,f,p,this.index,this.instancesPerModel[x].instancedDataArray.length)}this.lookup=null}update(e,n,i,a){for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];for(const d in e)u.idToFeaturesIndex.hasOwnProperty(d)&&this.evaluate(u.features[u.idToFeaturesIndex[d]],e[d],u,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];for(const a of i.features){const l=this.layers[0],u=a.feature,d=this.canonical,f=l.paint.get("model-rotation").evaluate(u,{},d),p=l.paint.get("model-scale").evaluate(u,{},d),g=l.paint.get("model-translation").evaluate(u,{},d);G.exactEquals(a.rotation,f)&&G.exactEquals(a.scale,p)&&G.exactEquals(a.translation,g)||(this.evaluate(a,a.featureStates,i,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,iI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const n=this.instancesPerModel[e];0!==n.instancedDataArray.length&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,i){const a=this.layers[0],l=a.layout.get("model-id").evaluate(i,{},this.canonical);if(!l)return K(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),l;this.instancesPerModel[l]||(this.instancesPerModel[l]=new sc);const u=this.instancesPerModel[l],d=u.instancedDataArray,f=new am(i,d.length);for(const p of n)for(const g of p){if(g.x<0||g.x>=le||g.y<0||g.y>=le)continue;const _=(this.lookupDim-1)/le,x=this.lookupDim*(g.y*_|0)+g.x*_|0;if(this.lookup){if(0!==this.lookup[x])continue;this.lookup[x]=1}this.instanceCount++;const v=d.length;d.resize(v+1),u.instancesEvaluatedElevation.push(0),d.float32[16*v]=g.x,d.float32[16*v+1]=g.y}return f.instancedDataCount=u.instancedDataArray.length-f.instancedDataOffset,f.instancedDataCount>0&&(e.id&&(u.idToFeaturesIndex[e.id]=u.features.length),u.features.push(f),this.evaluate(f,{},u,!1)),l}evaluate(e,n,i,a){const l=this.layers[0],u=e.feature,d=this.canonical,f=e.rotation=l.paint.get("model-rotation").evaluate(u,n,d),p=e.scale=l.paint.get("model-scale").evaluate(u,n,d),g=e.translation=l.paint.get("model-translation").evaluate(u,n,d),_=l.paint.get("model-color").evaluate(u,n,d);_.a=l.paint.get("model-color-mix-intensity").evaluate(u,n,d);const x=[];this.maxVerticalOffset<g[2]&&(this.maxVerticalOffset=g[2]),this.maxScale=Math.max(Math.max(this.maxScale,p[0]),Math.max(p[1],p[2])),fM(x,f,p);const v=Math.round(100*_.a)+_.b/1.05;for(let b=0;b<e.instancedDataCount;++b){const E=e.instancedDataOffset+b,C=16*E,T=i.instancedDataArray.float32;let D=0;a&&(D=T[C+6]-i.instancesEvaluatedElevation[E]);const A=0|T[C+1];T[C]=(0|T[C])+_.r/1.05,T[C+1]=A+_.g/1.05,T[C+2]=v,T[C+3]=1/(d.z>10?this.tileToMeter:Zu(d,A)),T[C+4]=g[0],T[C+5]=g[1],T[C+6]=g[2]+D,T[C+7]=x[0],T[C+8]=x[1],T[C+9]=x[2],T[C+10]=x[4],T[C+11]=x[5],T[C+12]=x[6],T[C+13]=x[8],T[C+14]=x[9],T[C+15]=x[10],i.instancesEvaluatedElevation[E]=g[2]}}}Ge(gM,"ModelBucket",{omit:["layers"]}),Ge(sc,"PerModelAttributes"),Ge(am,"ModelFeature");const lI=new nr({visibility:new Ce(J.layout_model.visibility),"model-id":new et(J.layout_model["model-id"])});var n1={paint:new nr({"model-opacity":new Ce(J.paint_model["model-opacity"]),"model-rotation":new et(J.paint_model["model-rotation"]),"model-scale":new et(J.paint_model["model-scale"]),"model-translation":new et(J.paint_model["model-translation"]),"model-color":new et(J.paint_model["model-color"]),"model-color-mix-intensity":new et(J.paint_model["model-color-mix-intensity"]),"model-type":new Ce(J.paint_model["model-type"]),"model-cast-shadows":new Ce(J.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ce(J.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ce(J.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new et(J.paint_model["model-emissive-strength"]),"model-roughness":new et(J.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new et(J.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ce(J.paint_model["model-cutoff-fade-range"])}),layout:lI};const ac=new Float32Array(262144),lc=new Uint8Array(262144);function _M(t){let e=0;if(t.meshes)for(const n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(const n of t.children)e=Math.max(e,_M(n));return e}const d0=["","wall","door","roof","window","lamp","logo"];class cI{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:_M(e)}}}}class uI{constructor(e,n,i,a){this.nodes=e,this.id=n,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const i of n){const a=i.node;this.uploaded?this.updatePbrBuffer(a):h0(a,e,!0)}for(const i of n)om(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),n=!0);return n}needsReEvaluation(e,n,i){const a=e.transform.projectionOptions,l=e.style.getBrightness(),u=this.brightness!==l;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||lm(i.paint.get("model-color").value,u)||lm(i.paint.get("model-color-mix-intensity").value,u)||lm(i.paint.get("model-roughness").value,u)||lm(i.paint.get("model-emissive-strength").value,u)||lm(i.paint.get("model-height-based-emissive-strength-multiplier").value,u))&&(this.projection=a,this.brightness=l,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const i=this.getNodesInfo(),a=this.id.canonical;for(const l of i){const u=l.feature;l.evaluatedScale=n.paint.get("model-scale").evaluate(u,{},a)}}evaluate(e){const n=this.getNodesInfo();for(const i of n){if(!i.node.meshes)continue;const a=i.feature,l=i.node.meshes&&i.node.meshes[0].featureData,u=i.evaluatedColor[2],d=i.evaluatedRMEA[2],f=this.id.canonical;if(i.hasTranslucentParts=!1,l){for(let p=0;p<d0.length;p++){const g=d0[p];g.length&&(a.properties.part=g);const _=e.paint.get("model-color").evaluate(a,{},f),x=e.paint.get("model-color-mix-intensity").evaluate(a,{},f);i.evaluatedColor[p]=[_.r,_.g,_.b,x],i.evaluatedRMEA[p][0]=e.paint.get("model-roughness").evaluate(a,{},f),i.evaluatedRMEA[p][2]=e.paint.get("model-emissive-strength").evaluate(a,{},f),i.evaluatedRMEA[p][3]=_.a,i.emissionHeightBasedParams[p]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},f),!i.hasTranslucentParts&&_.a<1&&(i.hasTranslucentParts=!0)}delete a.properties.part,yM(i,u!==i.evaluatedColor[2]||d!==i.evaluatedRMEA[2])}i.evaluatedScale=e.paint.get("model-scale").evaluate(a,{},f),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,i,a){const l=e.findDEMTileFor(i);if(l&&(l.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const u=Da.create(e,i,l);if(!u)return;4&this.modelTraits&&this.updateDEM(e,u,i,a);for(const d of this.getNodesInfo()){const f=d.node;if(!f.footprint||!f.footprint.vertices||!f.footprint.vertices.length)continue;const p=f.footprint.vertices;let g=u.getElevationAt(p[0].x,p[0].y,!0,!0);for(let _=1;_<p.length;_++)g=Math.min(g,u.getElevationAt(p[_].x,p[_].y,!0,!0));f.elevation=g}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,i,a){let l=n._dem._modifiedForSources[a];if(void 0===l&&(n._dem._modifiedForSources[a]=[],l=n._dem._modifiedForSources[a]),l.includes(i.canonical))return;const u=n._dem.dim;l.push(i.canonical);let d=!1;for(const f of this.getNodesInfo()){const p=f.node;if(!p.footprint||!p.footprint.grid)continue;const g=p.footprint.grid,_=n.tileCoordToPixel(g.min.x,g.min.y),x=n.tileCoordToPixel(g.max.x,g.max.y),v=Math.min(Math.min(u-x.y,_.x),Math.min(_.y,u-x.x));if(v<0)continue;const b=We(v,2,5);let E=Math.max(0,_.x-b),C=Math.max(0,_.y-b),T=Math.min(x.x+b,u-1),D=Math.min(x.y+b,u-1);for(let R=C;R<=D;++R)for(let k=E;k<=T;++k)lc[R*u+k]=255;let A=0,P=0;for(let R=0;R<g.cellsY;++R)for(let k=0;k<g.cellsX;++k){if(!g.cells[R*g.cellsX+k])continue;const L=n.tileCoordToPixel(g.min.x+k/g.xScale,g.min.y+R/g.yScale),N=n.tileCoordToPixel(g.min.x+(k+1)/g.xScale,g.min.y+(R+1)/g.yScale);for(let z=L.y;z<=Math.min(N.y+1,u-1);++z)for(let j=L.x;j<=Math.min(N.x+1,u-1);++j)255===lc[z*u+j]&&(lc[z*u+j]=0,A+=n.getElevationAtPixel(j,z),P++)}const I=A/P;E=Math.max(1,_.x-b),C=Math.max(1,_.y-b),T=Math.min(x.x+b,u-2),D=Math.min(x.y+b,u-2),d=!0;for(let R=C;R<=D;++R)for(let k=E;k<=T;++k)0===lc[R*u+k]&&(ac[R*u+k]=n._dem.set(k,R,I));for(let R=1;R<b;++R){E=Math.max(1,_.x-R),C=Math.max(1,_.y-R),T=Math.min(x.x+R,u-2),D=Math.min(x.y+R,u-2);for(let k=C;k<=D;++k)for(let L=E;L<=T;++L){const N=k*u+L;if(255===lc[N]){let z=0,j=0,B=-1,H=-1;for(let V=-1;V<=1;++V)for(let Z=-1;Z<=1;++Z){const Q=(k+V)*u+L+Z;if(lc[Q]>=R)continue;const te=ac[Q],W=Math.abs(te);W>j&&(z=te,j=W,B=Z,H=V)}if(j>.1){const V=1-(R+.5*Math.abs(B*H))/b;let Z=n._dem.get(L,k)+z*V;const Q=n._dem.get(L+B,k+H),te=n._dem.get(L-B,k-H,!0);(Z-Q)*(Z-te)>0&&(Z=(Q+te)/2),ac[N]=n._dem.set(L,k,Z),lc[N]=R}}}}}d&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Fe.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new cI(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)sm(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const n of e)om(n.node),sm(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const i=n.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const u=a[l].node;a[l].hiddenByReplacement=!!u.footprint&&!i.find(d=>d.footprint===u.footprint)}}getHeightAtTileCoord(e,n){const i=this.getNodesInfo(),a=[];for(let l=0;l<this.nodesInfo.length;l++){const u=i[l],d=u.node.meshes[0];if(e<d.aabb.min[0]||n<d.aabb.min[1]||e>d.aabb.max[0]||n>d.aabb.max[1])continue;const f=(e-d.aabb.min[0])/(d.aabb.max[0]-d.aabb.min[0])*64|0,p=64*Math.min(63,(n-d.aabb.min[1])/(d.aabb.max[1]-d.aabb.min[1])*64|0)+Math.min(63,f);if(!(d.heightmap[p]<0&&u.node.footprint))return u.hiddenByReplacement?void 0:{height:d.heightmap[p],maxHeight:u.feature.properties.height,hidden:!1,verticalScale:u.evaluatedScale[2]};if(u.node.footprint.grid.query(new ee(e,n),new ee(e,n),a),a.length>0)return{height:void 0,maxHeight:u.feature.properties.height,hidden:u.hiddenByReplacement,verticalScale:u.evaluatedScale[2]}}}}function lm(t,e){return!t.isLightConstant&&e}function hI(t,e,n,i,a,l,u,d){let f=(61440&e|(61440&e)>>4)>>8,p=(3840&e|(3840&e)>>4)>>4,g=240&e|(240&e)>>4;n[3]>0&&(f=ut(f,255*n[0],n[3]),p=ut(p,255*n[1],n[3]),g=ut(g,255*n[2],n[3]));const _=f<<8|p,x=g<<8|Math.floor(255*i[3]),v=function(R){const k=We(R,0,2);return Math.min(Math.round(.5*k*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],b=We(a[0],0,1),E=We(a[1],0,1),C=We(a[2],0,1),T=We(a[3],0,1);let D,A,P,I;if(b!==E&&u!==l&&E!==b){const R=u-l;A=1/(R*(E-b)),P=-(l+R*b)/(R*(E-b));const k=We(a[4],-1,1);I=Math.pow(10,k),D=255*C<<8|255*T}else D=65535,A=0,P=1,I=1;if(t.emplaceBack(_,x,v,D,A,P,I),d){const R=d.length;d.clear();for(let k=0;k<R;k++)d.emplaceBack(_,x,v,D,A,P,I)}}function yM(t,e){const n=t.node;let i=0;for(const a of n.meshes){if(n.lights&&n.lightMeshIndex===i||!a.featureData)continue;a.featureArray=new Zg,a.featureArray.reserve(a.featureData.length);let l=e;for(const u of a.featureData){let d;const f=65535&u,p=(15&f)<8?15&f:0,g=u>>16&65535,_=t.evaluatedRMEA[p],x=t.evaluatedColor[p],v=t.emissionHeightBasedParams[p];if(l&&2===p&&n.lights&&(d=new Zg,d.resize(10*n.lights.length)),hI(a.featureArray,g,x,_,v,a.aabb.min[2],a.aabb.max[2],d),d&&l){l=!1;const b=n.meshes[n.lightMeshIndex];b.featureArray=d,b.featureArray._trim()}}a.featureArray._trim(),i++}}Ge(uI,"Tiled3dModelBucket",{omit:["layers"]}),Ge(cI,"Tiled3dModelFeature");class dI{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const n=vM(new ee(0,0),new ee(le,le),e),i=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!xM(n,a))continue;const l=bM(a.min,a.max,e);i.push({min:l.min,max:l.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return i}setSources(e){this._setSources(e.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const i=[];for(const a of n.cache.getVisibleCoordinates()){const l=n.cache.getTile(a).buckets[n.layer];if(l)for(const u of l.getNodesInfo()){const d=u.node;d.footprint&&i.push({footprint:d.footprint,id:a.toUnwrapped()})}}return i}})))}_addSource(e){const n=e.getFootprints();if(0!==n.length){for(const i of n){if(!i.footprint)continue;const a=vM(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,i)=>n.priority-i.priority||ai(n.min,i.min)||ai(n.max,i.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let n=0,i=0;for(;!e&&n!==this._activeRegions.length;){const a=this._activeRegions[n],l=this._prevRegions[i];e=a.priority!==l.priority||!r1(a,l),++n,++i}}if(e){++this._updateTime;const n=i=>{const a=this._activeRegions;if(i>=a.length)return i;const l=a[i].priority;for(;i<a.length&&a[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,a=n(i);for(;i!==a;){let l=i;const u=i;for(;l!==a;){const d=this._activeRegions[l];d.hiddenByOverlap=!1;for(let f=0;f<u;f++){const p=this._activeRegions[f];if(!p.hiddenByOverlap&&xM(d,p)&&(d.hiddenByOverlap=i1(d.footprint,d.tileId,p.footprint,p.tileId),d.hiddenByOverlap))break}++l}i=a,a=n(i)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=e.length-1;n>=0;n--)this._addSource(e[n]);this._computeReplacement()}}function ai(t,e){return t.x-e.x||t.y-e.y}function r1(t,e){return 0===ai(t.min,e.min)&&0===ai(t.max,e.max)}function xM(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function vM(t,e,n){const i=1/le,a=1/(1<<n.canonical.z),l=(e.x*i+n.canonical.x)*a+n.wrap,u=(e.y*i+n.canonical.y)*a;return{min:new ee((t.x*i+n.canonical.x)*a+n.wrap,(t.y*i+n.canonical.y)*a),max:new ee(l,u)}}function bM(t,e,n){const i=1<<n.canonical.z,a=((e.x-n.wrap)*i-n.canonical.x)*le,l=(e.y*i-n.canonical.y)*le;return{min:new ee(((t.x-n.wrap)*i-n.canonical.x)*le,(t.y*i-n.canonical.y)*le),max:new ee(a,l)}}function wM(t,e,n,i,a,l,u){const d=t.indices,f=t.vertices,p=[];for(let g=i;g<i+a;g+=3){const _=e[n[g+0]+l],x=e[n[g+1]+l],v=e[n[g+2]+l],b=Math.min(_.x,x.x,v.x),E=Math.max(_.x,x.x,v.x),C=Math.min(_.y,x.y,v.y),T=Math.max(_.y,x.y,v.y);p.length=0,t.grid.query(new ee(b,C),new ee(E,T),p);for(let D=0;D<p.length;D++){const A=p[D];if(Mp(f[d[3*A+0]],f[d[3*A+1]],f[d[3*A+2]],_,x,v,u))return!0}}return!1}function i1(t,e,n,i){if(!t||!n)return!1;let a=t.vertices;if(!e.canonical.equals(i.canonical)||e.wrap!==i.wrap){if(n.vertices.length<t.vertices.length)return i1(n,i,t,e);const l=e.canonical,u=i.canonical,d=Math.pow(2,u.z-l.z);a=t.vertices.map(f=>new ee(f.x*l.x*le*d-u.x*le,f.y*l.y*le*d-u.y*le))}return wM(n,a,t.indices,0,t.indices.length,0,0)}const EM=Lp.types,Zd=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],fI=["fill-extrusion-flood-light-ground-radius"],pI=Math.pow(2,13),MM=Math.pow(2,15)-1,TM=new ee(0,1),Ra=2147483648;function f0(t,e,n,i,a,l,u,d){t.emplaceBack((e<<1)+u,(n<<1)+l,(Math.floor(i*pI)<<1)+a,Math.round(d))}function cm(t,e,n,i,a,l){t.emplaceBack(e.x,e.y,(n.x<<1)+i,(n.y<<1)+a,l)}function nu(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Oa{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class CM{constructor(){this.centroidXY=new ee(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new ee(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ee(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ee(this.max.x-this.min.x,this.max.y-this.min.y)}}class DM{constructor(){this.acc=new ee(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,i){this.accCount++,this.acc._add(n);let a=!!this.borders;n.x<e.min.x?(e.min.x=n.x,a=!0):n.x>e.max.x&&(e.max.x=n.x,a=!0),n.y<e.min.y?(e.min.y=n.y,a=!0):n.y>e.max.y&&(e.max.y=n.y,a=!0),((0===n.x||n.x===le)&&n.x===i.x)!=((0===n.y||n.y===le)&&n.y===i.y)&&this.processBorderOverlap(n,i),a&&this.checkBorderIntersection(n,i)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,ut(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>le!=e.x>le&&this.addBorderIntersection(1,ut(n.y,e.y,(le-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,ut(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>le!=e.y>le&&this.addBorderIntersection(3,ut(n.x,e.x,(le-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];n<i[0]&&(i[0]=n),n>i[1]&&(i[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,n.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,n.x),this.addBorderIntersection(i,e.x)}}centroid(){return 0===this.accCount?new ee(0,0):new ee(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function ka(t,e){const n=t.add(e)._unit(),i=We(t.x*n.x+t.y*n.y,-1,1);var a,l,u;return a=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(a)))/4*MM*((l=t).x*(u=e).y-l.y*u.x<0?-1:1)}const La=[t=>t.x<0,t=>t.x>le,t=>t.y<0,t=>t.y>le];function Fa(t,e,n,i){const a=[4];if(0===i)return a;n._mult(i);const l=t.sub(n),u=e.sub(n),d=[t,e,l,u];for(let f=0;f<4;f++)for(const p of d)if(La[f](p)){a.push(f);break}return a}class o1{constructor(e){this.vertexArray=new ao,this.indexArray=new Rr,this.programConfigurations=new Fu(e.layers,e.zoom,n=>fI.includes(n)),this._segments=new bn,this.hiddenByLandmarkVertexArray=new ux,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new bn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,n,i,a=!1){const l=e.length;if(l>2){let u=Math.max(0,this._segments.get().length-1);const d=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[u].length);let f;u!==this._segments.get().length-1&&(u++,this._segmentToGroundQuads[u]=[],this._segmentToRegionTriCounts[u]=[0,0,0,0,0]);{const p=e[0],g=e[1];f=ka(p.sub(e[l-1])._perp()._unit(),g.sub(p)._perp()._unit())}for(let p=0;p<l;p++){const g=p===l-1?0:p+1,_=e[p],x=e[g],v=e[g===l-1?0:g+1],b=x.sub(_)._perp()._unit(),E=ka(b,v.sub(x)._perp()._unit()),C=f,T=E;if(s1(_,x,n)||a&&p0(_,n)&&p0(x,n)){f=E;continue}const D=d.vertexLength;cm(this.vertexArray,_,x,1,1,C),cm(this.vertexArray,_,x,1,0,C),cm(this.vertexArray,_,x,0,1,T),cm(this.vertexArray,_,x,0,0,T),d.vertexLength+=4;const A=Fa(_,x,b,i);for(const P of A)this._segmentToGroundQuads[u].push({id:D,region:P}),this._segmentToRegionTriCounts[u][P]+=2,d.primitiveLength+=2;f=E}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let i=0;i<n;i++)this._segmentToGroundQuads[i].sort((a,l)=>a.region-l.region);for(let i=0;i<n;i++){const a=this._segmentToGroundQuads[i],l=e[i],u=this._segmentToRegionTriCounts[i];u.reduce((f,p)=>f+p,0);let d=0;for(let f=0;f<=4;f++){const p=u[f];if(0!==p){let g=this.regionSegments[f];g||(g=this.regionSegments[f]=new bn);const _={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+d,vertexLength:l.vertexLength,primitiveLength:p};g.get().push(_)}d+=p}for(let f=0;f<a.length;f++){const p=a[f].id;this.indexArray.emplaceBack(p,p+1,p+3),this.indexArray.emplaceBack(p,p+3,p+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,i,a,l,u){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,i,a,l,u)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,gS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,i,a,l,u){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,i,a,l,u)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const i=e.flags&Ra?1:0;for(let a=e.groundVertexArrayOffset;a<n;++a)this.hiddenByLandmarkVertexArray.emplace(a,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,uR.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Wd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Rr,this.footprintVertices=new Eo,this.footprintSegments=[],this.layoutVertexArray=new Ru,this.centroidVertexArray=new dx,this.indexArray=new Rr,this.programConfigurations=new Fu(e.layers,e.zoom,n=>Zd.includes(n)),this.segments=new bn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new o1(e),this.maxHeight=0,this.partLookup={}}populate(e,n,i,a){this.features=[],this.hasPattern=pv("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Zu(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:l,id:u,index:d,sourceLayerIndex:f}of e){const p=this.layers[0]._featureFilter.needGeometry,g=qc(l,p);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),g,i))continue;const _={id:u,sourceLayerIndex:f,index:d,geometry:p?g.geometry:pl(l,i,a),properties:l.properties,type:l.type,patterns:{}},x=this.layoutVertexArray.length;this.hasPattern?this.features.push(M_("fill-extrusion",this.layers,_,this.zoom,n)):this.addFeature(_,_.geometry,d,i,{},n.availableImages,a,n.brightness),n.featureIndex.insert(l,_.geometry,d,f,this.index,x)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(e,n,i,a,l,u){for(const d of this.features){const{geometry:f}=d;this.addFeature(d,f,d.index,n,i,a,l,u)}this.sortBorders()}update(e,n,i,a,l){const u=0!==Object.keys(e).length;if(u&&!this.stateDependentLayers.length)return;const d=u?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,d,i,a,l),this.groundEffect.update(e,n,d,i,a,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,C_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,_S.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,aE.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,i,a,l,u,d,f){const p=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,g=[new ee(0,0),new ee(le,le)],_=d.projection,x="globe"===_.name,v="Polygon"===EM[e.type],b=new DM;b.centroidDataIndex=this.centroidData.length;const E=new CM,C=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,T=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);E.height=T,E.vertexArrayOffset=this.layoutVertexArray.length,E.groundVertexArrayOffset=this.groundEffect.vertexArray.length,x&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vg);const D=yd(n,500);for(let L=D.length-1;L>=0;L--){const N=D[L];(0===N.length||(A=N[0]).every(z=>z.x<=0)||A.every(z=>z.x>=le)||A.every(z=>z.y<=0)||A.every(z=>z.y>=le))&&D.splice(L,1)}var A;let P;if(x)P=PM(D,g,a);else{P=[];for(const L of D)P.push({polygon:L,bounds:g})}const I=v?this.edgeRadius:0,R=I>0&&this.zoom<17,k=(L,N)=>{if(0===L.length)return!1;const z=L[L.length-1];return N.x===z.x&&N.y===z.y};for(const{polygon:L,bounds:N}of P){let z=0,j=0;for(const V of L)v&&!V[0].equals(V[V.length-1])&&V.push(V[0]),j+=v?V.length-1:V.length;const B=this.segments.prepareSegment((v?5:4)*j,this.layoutVertexArray,this.indexArray);E.footprintSegIdx<0&&(E.footprintSegIdx=this.footprintSegments.length);const H=new Oa;if(H.vertexOffset=this.footprintVertices.length,H.indexOffset=3*this.footprintIndices.length,H.ringIndices=[],v){const V=[],Z=[];z=B.vertexLength;for(let te=0;te<L.length;te++){const W=L[te];W.length&&0!==te&&Z.push(V.length/2);const X=[];let re,oe;re=W[1].sub(W[0])._perp()._unit(),H.ringIndices.push(W.length-1);for(let ce=1;ce<W.length;ce++){const de=W[ce],ge=W[ce===W.length-1?1:ce+1],ae=de.clone();if(I){oe=ge.sub(de)._perp()._unit();const ue=re.add(oe)._unit(),Se=I*Math.min(4,1/(re.x*ue.x+re.y*ue.y));ae.x+=Se*ue.x,ae.y+=Se*ue.y,ae.x=Math.round(ae.x),ae.y=Math.round(ae.y),re=oe}!C||0!==I&&!R||k(X,ae)||X.push(ae),f0(this.layoutVertexArray,ae.x,ae.y,0,0,1,1,0),B.vertexLength++,this.footprintVertices.emplaceBack(de.x,de.y),V.push(de.x,de.y),x&&nu(this.layoutVertexExtArray,_.projectTilePoint(ae.x,ae.y,a),_.upVector(a,ae.x,ae.y))}C&&(0===I||R)&&(0!==X.length&&k(X,X[0])&&X.pop(),this.groundEffect.addData(X,N,p))}const Q=E_(V,Z);for(let te=0;te<Q.length;te+=3)this.footprintIndices.emplaceBack(H.vertexOffset+Q[te+0],H.vertexOffset+Q[te+1],H.vertexOffset+Q[te+2]),this.indexArray.emplaceBack(z+Q[te],z+Q[te+2],z+Q[te+1]),B.primitiveLength++;H.indexCount+=Q.length,H.vertexCount+=this.footprintVertices.length-H.vertexOffset}for(let V=0;V<L.length;V++){const Z=L[V];b.startRing(E,Z[0]);let Q=Z.length>4&&Xd(Z[Z.length-2],Z[0],Z[1]),te=I?mI(Z[Z.length-2],Z[0],Z[1],I):0;const W=[];let X,re,oe;re=Z[1].sub(Z[0])._perp()._unit();let ce=!0;for(let de=1,ge=0;de<Z.length;de++){let ae=Z[de-1],ue=Z[de];const Se=Z[de===Z.length-1?1:de+1];if(b.appendEdge(E,ue,ae),s1(ue,ae,N)){I&&(re=Se.sub(ue)._perp()._unit(),ce=!ce);continue}const Ne=ue.sub(ae)._perp(),ze=Ne.x/(Math.abs(Ne.x)+Math.abs(Ne.y)),Ve=Ne.y>0?1:0,Ke=ae.dist(ue);if(ge+Ke>32768&&(ge=0),I){oe=Se.sub(ue)._perp()._unit();let Tt=IM(ae,ue,Se,SM(re,oe),I);isNaN(Tt)&&(Tt=0);const vt=ue.sub(ae)._unit();ae=ae.add(vt.mult(te))._round(),ue=ue.add(vt.mult(-Tt))._round(),te=Tt,re=oe,C&&this.zoom>=17&&(k(W,ae)||W.push(ae),k(W,ue)||W.push(ue))}const ht=B.vertexLength,Ot=Z.length>4&&Xd(ae,ue,Se);let Xt=AM(ge,Q,ce);if(f0(this.layoutVertexArray,ae.x,ae.y,ze,Ve,0,0,Xt),f0(this.layoutVertexArray,ae.x,ae.y,ze,Ve,0,1,Xt),ge+=Ke,Xt=AM(ge,Ot,!ce),Q=Ot,f0(this.layoutVertexArray,ue.x,ue.y,ze,Ve,0,0,Xt),f0(this.layoutVertexArray,ue.x,ue.y,ze,Ve,0,1,Xt),B.vertexLength+=4,this.indexArray.emplaceBack(ht+0,ht+1,ht+2),this.indexArray.emplaceBack(ht+1,ht+3,ht+2),B.primitiveLength+=2,I){const Tt=z+(1===de?Z.length-2:de-2),vt=1===de?z:Tt+1;if(this.indexArray.emplaceBack(ht+1,Tt,ht+3),this.indexArray.emplaceBack(Tt,vt,ht+3),B.primitiveLength+=2,void 0===X&&(X=ht),!s1(Se,Z[de],N)){const ct=de===Z.length-1?X:B.vertexLength;this.indexArray.emplaceBack(ht+2,ht+3,ct),this.indexArray.emplaceBack(ht+3,ct+1,ct),this.indexArray.emplaceBack(ht+3,vt,ct+1),B.primitiveLength+=3}ce=!ce}if(x){const Tt=this.layoutVertexExtArray,vt=_.projectTilePoint(ae.x,ae.y,a),ct=_.projectTilePoint(ue.x,ue.y,a),it=_.upVector(a,ae.x,ae.y),Nt=_.upVector(a,ue.x,ue.y);nu(Tt,vt,it),nu(Tt,vt,it),nu(Tt,ct,Nt),nu(Tt,ct,Nt)}}v&&(z+=Z.length-1),C&&I&&this.zoom>=17&&(0!==W.length&&k(W,W[0])&&W.pop(),this.groundEffect.addData(W,N,p,I>0))}this.footprintSegments.push(H),++E.footprintSegLen}if(E.vertexCount=this.layoutVertexArray.length-E.vertexArrayOffset,E.groundVertexCount=this.groundEffect.vertexArray.length-E.groundVertexArrayOffset,0!==E.vertexCount){if(E.centroidXY=b.borders?TM:this.encodeCentroid(b,E),this.centroidData.push(E),b.borders){this.featuresOnBorder.push(b);const L=this.featuresOnBorder.length-1;for(let N=0;N<b.borders.length;N++)b.borders[N][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[N].push(L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,u,a,f),this.groundEffect.addPaintPropertiesData(e,i,l,u,a,f),this.maxHeight=Math.max(this.maxHeight,T)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,i)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[i].borders[e][0])}encodeCentroid(e,n){const i=e.centroid(),a=n.span(),l=Math.min(7,Math.round(a.x*this.tileToMeter/10)),u=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new ee(We(i.x,1,le-1)<<3|l,We(i.y,1,le-1)<<3|u)}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=Ra,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,a=e.flags&Ra?TM:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==a.y||l!==a.x){for(let u=n;u<i;++u)this.centroidVertexArray.emplace(u,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const i=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(l,u){if(l.length!==u.length)return!1;for(let d=0;d<l.length;d++)if(l[d].sourceId!==u[d].sourceId||!r1(l[d],u[d]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const l of this.centroidData)l.flags&=2147483647;const a=[];for(const l of this.activeReplacements){const u=Math.pow(2,l.footprintTileId.canonical.z-e.canonical.z);for(const d of this.centroidData)if(!(d.flags&Ra||l.min.x>d.max.x||d.min.x>l.max.x||l.min.y>d.max.y||d.min.y>l.max.y))for(let f=0;f<d.footprintSegLen;f++){const p=this.footprintSegments[d.footprintSegIdx+f];if(a.length=0,gI(this.footprintVertices,p.vertexOffset,p.vertexCount,l.footprintTileId.canonical,e.canonical,a),wM(l.footprint,a,this.footprintIndices.uint16,p.indexOffset,p.indexCount,-p.vertexOffset,-u)){d.flags|=Ra;break}}}for(const l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,i){let a=!1;for(let l=0;l<i.footprintSegLen;l++){const u=this.footprintSegments[i.footprintSegIdx+l];let d=0;for(const f of u.ringIndices){for(let p=d,g=f+d-1;p<f+d;g=p++){const _=this.footprintVertices.int16[2*(p+u.vertexOffset)+0],x=this.footprintVertices.int16[2*(p+u.vertexOffset)+1],v=this.footprintVertices.int16[2*(g+u.vertexOffset)+1];x>n!=v>n&&e<(this.footprintVertices.int16[2*(g+u.vertexOffset)+0]-_)*(n-x)/(v-x)+_&&(a=!a)}d=f}}return a}getHeightAtTileCoord(e,n){let i=Number.NEGATIVE_INFINITY,a=!0;const l=4*(e+le)*le+(n+le);if(this.partLookup.hasOwnProperty(l)){const u=this.partLookup[l];return u?{height:u.height,hidden:!!(u.flags&Ra)}:void 0}for(const u of this.centroidData)e>u.max.x||u.min.x>e||n>u.max.y||u.min.y>n||this.footprintContainsPoint(e,n,u)&&u&&u.height>i&&(i=u.height,this.partLookup[l]=u,a=!!(u.flags&Ra));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:a};this.partLookup[l]=void 0}}function SM(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function mI(t,e,n,i){const a=e.sub(t)._perp()._unit(),l=n.sub(e)._perp()._unit();return IM(t,e,n,SM(a,l),i)}function IM(t,e,n,i,a){const l=Math.sqrt(1-i*i);return Math.min(t.dist(e)/3,e.dist(n)/3,a*l/i)}function s1(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function p0(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function Xd(t,e,n){if(t.x<0||t.x>=le||e.x<0||e.x>=le||n.x<0||n.x>=le)return!1;const i=n.sub(e),a=i.perp(),l=t.sub(e);return(i.x*l.x+i.y*l.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(l.x*l.x+l.y*l.y))>-.866&&a.x*l.x+a.y*l.y<0}function AM(t,e,n){const i=e?2|t:-3&t;return n?1|i:-2&i}function a1(){const t=Math.PI/32,e=Math.tan(t),n=Gu;return n*Math.sqrt(1+2*e*e)-n}function PM(t,e,n){const i=1<<n.z,a=ls(n.x/i),l=ls((n.x+1)/i),u=zr(n.y/i),d=zr((n.y+1)/i);return function(f,p,g,_,x=0,v){const b=[];if(!f.length||!g||!_)return b;const E=(R,k)=>{for(const L of R)b.push({polygon:L,bounds:k})},C=Math.ceil(Math.log2(g)),T=Math.ceil(Math.log2(_)),D=C-T,A=[];for(let R=0;R<Math.abs(D);R++)A.push(D>0?0:1);for(let R=0;R<Math.min(C,T);R++)A.push(0),A.push(1);let P=f;if(P=S_(P,p[0].y-x,p[1].y+x,1),P=S_(P,p[0].x-x,p[1].x+x,0),!P.length)return b;const I=[];for(A.length?I.push({polygons:P,bounds:p,depth:0}):E(P,p);I.length;){const R=I.pop(),k=R.depth,L=A[k],N=R.bounds[0],z=R.bounds[1],j=0===L?N.x:N.y,B=0===L?z.x:z.y,H=v?v(L,j,B):.5*(j+B),V=S_(R.polygons,j-x,H+x,L),Z=S_(R.polygons,H-x,B+x,L);if(V.length){const Q=[N,new ee(0===L?H:z.x,1===L?H:z.y)];A.length>k+1?I.push({polygons:V,bounds:Q,depth:k+1}):E(V,Q)}if(Z.length){const Q=[new ee(0===L?H:N.x,1===L?H:N.y),z];A.length>k+1?I.push({polygons:Z,bounds:Q,depth:k+1}):E(Z,Q)}}return b}(t,e,Math.ceil((l-a)/11.25),Math.ceil((u-d)/11.25),1,(f,p,g)=>{if(0===f)return.5*(p+g);{const _=zr((n.y+p/le)/i);return(Gi(.5*(zr((n.y+g/le)/i)+_))*i-n.y)*le}})}function gI(t,e,n,i,a,l){const u=Math.pow(2,i.z-a.z);for(let d=0;d<n;d++){let f=t.int16[2*(d+e)+0],p=t.int16[2*(d+e)+1];f=(f+a.x*le)*u-i.x*le,p=(p+a.y*le)*u-i.y*le,l.push(new ee(f,p))}}Ge(Wd,"FillExtrusionBucket",{omit:["layers","features"]}),Ge(CM,"PartData"),Ge(Oa,"FootprintSegment"),Ge(DM,"BorderCentroidData"),Ge(o1,"GroundEffect");const RM=new nr({visibility:new Ce(J["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ce(J["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var OM={paint:new nr({"fill-extrusion-opacity":new Ce(J["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new et(J["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ce(J["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ce(J["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new et(J["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new et(J["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new et(J["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ce(J["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ce(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ce(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ce(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ce(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ce(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ce(J["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ce(J["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new et(J["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new et(J["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ce(J["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ce(J["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ce(J["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ce(J["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:RM};class cc extends ee{constructor(e,n,i){super(e,n),this.z=i}}function um(t,e){return t.x*e.x+t.y*e.y}function l1(t,e){if(1===t.length){let n=0;const i=e[n++];let a;for(;!a||i.equals(a);)if(a=e[n++],!a)return 1/0;for(;n<e.length;n++){const l=e[n],u=t[0],d=a.sub(i),f=l.sub(i),p=u.sub(i),g=um(d,d),_=um(d,f),x=um(f,f),v=um(p,d),b=um(p,f),E=g*x-_*_,C=(x*v-_*b)/E,T=(g*b-_*v)/E,D=i.z*(1-C-T)+a.z*C+l.z*T;if(isFinite(D))return D}return 1/0}{let n=1/0;for(const i of e)n=Math.min(n,i.z);return n}}function uc(t,e,n,i,a,l,u,d){const f=u*a.getElevationAt(t,e,!0,!0),p=0!==l[0],g=p?0===l[1]?u*(l[0]/7-450):u*function(_,x,v){const b=Math.floor(x[0]/8),E=Math.floor(x[1]/8),C=10*(x[0]-8*b),T=10*(x[1]-8*E),D=_.getElevationAt(b,E,!0,!0),A=_.getMeterToDEM(v),P=Math.floor(.5*(C*A-1)),I=Math.floor(.5*(T*A-1)),R=_.tileCoordToPixel(b,E),k=2*P+1,L=2*I+1,N=(W=k,X=L,[(Z=_).getElevationAtPixel(Q=R.x-P,te=R.y-I,!0),Z.getElevationAtPixel(Q+X,te,!0),Z.getElevationAtPixel(Q,te+X,!0),Z.getElevationAtPixel(Q+W,te+X,!0)]),z=Math.abs(N[0]-N[1]),j=Math.abs(N[2]-N[3]),B=Math.abs(N[0]-N[2])+Math.abs(N[1]-N[3]),H=Math.min(.25,.5*A*(z+j)/k),V=Math.min(.25,.5*A*B/L);var Z,Q,te,W,X;return D+Math.max(H*C,V*T)}(a,l,d):f;return{base:f+(0===n)?-1:n,top:p?Math.max(g+i,f+n+2):f+i}}const kM=new nr({"line-cap":new et(J.layout_line["line-cap"]),"line-join":new et(J.layout_line["line-join"]),"line-miter-limit":new Ce(J.layout_line["line-miter-limit"]),"line-round-limit":new Ce(J.layout_line["line-round-limit"]),"line-sort-key":new et(J.layout_line["line-sort-key"]),visibility:new Ce(J.layout_line.visibility)});var LM={paint:new nr({"line-opacity":new et(J.paint_line["line-opacity"]),"line-color":new et(J.paint_line["line-color"]),"line-translate":new Ce(J.paint_line["line-translate"]),"line-translate-anchor":new Ce(J.paint_line["line-translate-anchor"]),"line-width":new et(J.paint_line["line-width"]),"line-gap-width":new et(J.paint_line["line-gap-width"]),"line-offset":new et(J.paint_line["line-offset"]),"line-blur":new et(J.paint_line["line-blur"]),"line-dasharray":new et(J.paint_line["line-dasharray"]),"line-pattern":new et(J.paint_line["line-pattern"]),"line-gradient":new Kf(J.paint_line["line-gradient"]),"line-trim-offset":new Ce(J.paint_line["line-trim-offset"]),"line-emissive-strength":new Ce(J.paint_line["line-emissive-strength"]),"line-border-width":new et(J.paint_line["line-border-width"]),"line-border-color":new et(J.paint_line["line-border-color"])}),layout:kM};const _I=(t,e,n,i,a,l,u)=>{const d=t.transform,f=d.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:u1(t,e,n,i),u_pixels_to_tile_units:f,u_device_pixel_ratio:l,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:d1(n)?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:m0(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:u,u_emissive_strength:n.paint.get("line-emissive-strength")}},c1=(t,e,n,i,a)=>{const l=t.transform;return{u_matrix:u1(t,e,n,i),u_texsize:e.imageAtlasTexture.size,u_pixels_to_tile_units:l.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:m0(e,l),u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function m0(t,e){return 1/th(t,1,e.tileZoom)}function u1(t,e,n,i){return t.translatePosMatrix(i||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const h1=t=>{const e=[];d1(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER"),e};function d1(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const f1=new class extends et{possiblyEvaluate(t,e){return e=new tr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=qe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}(LM.paint.properties["line-width"].specification);function p1(t,e){return e>0?e+2*t:t}f1.useIntegerZoom=!0;const FM=new nr({visibility:new Ce(J.layout_background.visibility)});var NM={paint:new nr({"background-color":new Ce(J.paint_background["background-color"]),"background-pattern":new Ce(J.paint_background["background-pattern"]),"background-opacity":new Ce(J.paint_background["background-opacity"]),"background-emissive-strength":new Ce(J.paint_background["background-emissive-strength"])}),layout:FM};const zM=new nr({visibility:new Ce(J.layout_raster.visibility)});var yI={paint:new nr({"raster-opacity":new Ce(J.paint_raster["raster-opacity"]),"raster-color":new Kf(J.paint_raster["raster-color"]),"raster-color-mix":new Ce(J.paint_raster["raster-color-mix"]),"raster-color-range":new Ce(J.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ce(J.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ce(J.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ce(J.paint_raster["raster-brightness-max"]),"raster-saturation":new Ce(J.paint_raster["raster-saturation"]),"raster-contrast":new Ce(J.paint_raster["raster-contrast"]),"raster-resampling":new Ce(J.paint_raster["raster-resampling"]),"raster-fade-duration":new Ce(J.paint_raster["raster-fade-duration"])}),layout:zM};function BM(t,e,n,i,a,l,u,d){const f=[t,n,a,e,i,l,1,1,1],p=[u,d,1],g=To.adjoint([],f),[_,x,v]=G.transformMat3(p,p,To.transpose(g,g));return To.multiply(f,[_,0,0,0,x,0,0,0,v],f)}class bl extends wr{constructor(e,n,i,a){super(),this.id=e,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Me("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ct(this.map._requestManager.transformRequest(this.url,fe.Image),(i,a)=>{if(this._imageRequest=null,this._loaded=!0,i)this.fire(new pe(i));else if(a){const{HTMLImageElement:l}=ie;this.image=a instanceof l?Fe.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Q_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Me("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Q_||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],i=e[0][1];for(const l of e)l[1]>i&&(i=l[1]),l[1]<n&&(n=l[1]);const a=(i+n)/2;if(a>Er?this.onNorthPole=!0:a<-Er&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(Gt.fromLngLat);this.tileID=function(u){let d=1/0,f=1/0,p=-1/0,g=-1/0;for(const b of u)d=Math.min(d,b.x),f=Math.min(f,b.y),p=Math.max(p,b.x),g=Math.max(g,b.y);const _=Math.max(p-d,g-f),x=Math.max(0,Math.floor(-Math.log(_)/Math.LN2)),v=Math.pow(2,x);return new Qs(x,Math.floor((d+p)/2*v),Math.floor((f+g)/2*v))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Me("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const f in this.tiles){const p=this.tiles[f];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}if(this._boundsArray)return;const n=Qc(this.tileID,this.map.transform.projection),[i,a,l,u]=this.coordinates.map(f=>{const p=n.projection.project(f[0],f[1]);return yl(n,p)._round()});this.perspectiveTransform=function(f,p,g,_,x,v,b,E,C,T){const D=BM(0,0,f,0,0,p,f,p),A=BM(g,_,x,v,b,E,C,T);return To.multiply(A,To.adjoint(D,D),A),[A[6]/A[8]*f/le,A[7]/A[8]*p/le]}(this.width,this.height,i.x,i.y,a.x,a.y,u.x,u.y,l.x,l.y);const d=this._boundsArray=new Ru;d.emplaceBack(i.x,i.y,0,0),d.emplaceBack(a.x,a.y,le,0),d.emplaceBack(u.x,u.y,0,le),d.emplaceBack(l.x,l.y,le,le),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(d,Jp.members),this.boundsSegments=bn.simpleSegment(0,0,4,2)}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const n=this.map.painter.context,i=n.gl;!this._dirty||this.texture instanceof Q_||(this.texture?this.texture.update(this.image):(this.texture=new kr(n,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class xI extends Ps{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const vI=new nr({visibility:new Ce(J.layout_sky.visibility)});var bI={paint:new nr({"sky-type":new Ce(J.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ce(J.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ce(J.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ce(J.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ce(J.paint_sky["sky-gradient-radius"]),"sky-gradient":new Kf(J.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ce(J.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ce(J.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ce(J.paint_sky["sky-opacity"])}),layout:vI};function m1(t,e,n){const i=[0,0,1],a=Oi.identity([]);return Oi.rotateY(a,a,n?-Et(t)+Math.PI:Et(t)),Oi.rotateX(a,a,-Et(e)),G.transformQuat(i,i,a),G.normalize(i,i)}var wI={paint:new nr({})};const EI={circle:class extends Ps{constructor(t,e){super(t,y_,e)}createBucket(t){return new J2(t)}queryRadius(t){const e=t;return Wu("circle-radius",this,e)+Wu("circle-stroke-width",this,e)+Tp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,a,l,u,d){const f=Q2(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),p=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return cs(t,i,l,u,d,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),f,p)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const n=Cp(this);return{config:new Qh(this,e),defines:n,overrideFog:!1}}},heatmap:class extends Ps{createBucket(t){return new iv(t)}constructor(t,e){super(t,tE,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ml({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Wu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,i,a,l,u,d){const f=this.paint.get("heatmap-radius").evaluate(e,n);return cs(t,i,l,u,d,!0,!0,new ee(0,0),f)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return"heatmap"===t?{config:new Qh(this,e),overrideFog:!1}:{}}},hillshade:class extends Ps{constructor(t,e){super(t,lR,e)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Ps{constructor(t,e){super(t,mS,e)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new Qh(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new xd(t)}queryRadius(){return Tp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,a,l){return!t.queryGeometry.isAboveHorizon&&Yx(Zc(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Ps{constructor(t,e){super(t,OM,e)}createBucket(t){return new Wd(t)}queryRadius(){return Tp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,i,a,l,u,d,f){const p=Q2(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),g=this.paint.get("fill-extrusion-height").evaluate(e,n),_=this.paint.get("fill-extrusion-base").evaluate(e,n),x=[0,0],v=d&&l.elevation,b=l.elevation?l.elevation.exaggeration():1,E=t.tile.getBucket(this);if(v&&E instanceof Wd){const P=E.centroidVertexArray,I=f+1;I<P.length&&(x[0]=P.geta_centroid_pos0(I),x[1]=P.geta_centroid_pos1(I))}if(0===x[0]&&1===x[1])return!1;"globe"===l.projection.name&&(i=PM([i],[new ee(0,0),new ee(le,le)],t.tileID.canonical).map(P=>P.polygon).flat());const C=v?d:null,[T,D]=(I=i,R=_,k=g,L=p,N=u,z=C,j=x,B=b,H=l.center.lat,"globe"===(P=l).projection.name?function(Z,Q,te,W,X,re,oe,ce,de,ge,ae){const ue=[],Se=[],Ne=Z.projection.upVectorScale(ae,Z.center.lat,Z.worldSize).metersToTile,ze=[0,0,0,1],Ve=[0,0,0,1],Ke=(Ot,Xt,Tt,vt)=>{Ot[0]=Xt,Ot[1]=Tt,Ot[2]=vt,Ot[3]=1},ht=a1();te>0&&(te+=ht),W+=ht;for(const Ot of Q){const Xt=[],Tt=[];for(const vt of Ot){const ct=vt.x+X.x,it=vt.y+X.y,Nt=Z.projection.projectTilePoint(ct,it,ae),Kt=Z.projection.upVector(ae,vt.x,vt.y);let Rt=te,Sn=W;if(oe){const or=uc(ct,it,te,W,oe,ce,de,ge);Rt+=or.base,Sn+=or.top}0!==te?Ke(ze,Nt.x+Kt[0]*Ne*Rt,Nt.y+Kt[1]*Ne*Rt,Nt.z+Kt[2]*Ne*Rt):Ke(ze,Nt.x,Nt.y,Nt.z),Ke(Ve,Nt.x+Kt[0]*Ne*Sn,Nt.y+Kt[1]*Ne*Sn,Nt.z+Kt[2]*Ne*Sn),G.transformMat4(ze,ze,re),G.transformMat4(Ve,Ve,re),Xt.push(new cc(ze[0],ze[1],ze[2])),Tt.push(new cc(Ve[0],Ve[1],Ve[2]))}ue.push(Xt),Se.push(Tt)}return[ue,Se]}(P,I,R,k,L,N,z,j,B,H,t.tileID.canonical):z?function(Z,Q,te,W,X,re,oe,ce,de){const ge=[],ae=[],ue=[0,0,0,1];for(const Se of Z){const Ne=[],ze=[];for(const Ve of Se){const Ke=Ve.x+W.x,ht=Ve.y+W.y,Ot=uc(Ke,ht,Q,te,re,oe,ce,de);ue[0]=Ke,ue[1]=ht,ue[2]=Ot.base,ue[3]=1,xn.transformMat4(ue,ue,X),ue[3]=Math.max(ue[3],1e-5);const Xt=new cc(ue[0]/ue[3],ue[1]/ue[3],ue[2]/ue[3]);ue[0]=Ke,ue[1]=ht,ue[2]=Ot.top,ue[3]=1,xn.transformMat4(ue,ue,X),ue[3]=Math.max(ue[3],1e-5);const Tt=new cc(ue[0]/ue[3],ue[1]/ue[3],ue[2]/ue[3]);Ne.push(Xt),ze.push(Tt)}ge.push(Ne),ae.push(ze)}return[ge,ae]}(I,R,k,L,N,z,j,B,H):function(Z,Q,te,W,X){const re=[],oe=[],ce=X[8]*Q,de=X[9]*Q,ge=X[10]*Q,ae=X[11]*Q,ue=X[8]*te,Se=X[9]*te,Ne=X[10]*te,ze=X[11]*te;for(const Ve of Z){const Ke=[],ht=[];for(const Ot of Ve){const Xt=Ot.x+W.x,Tt=Ot.y+W.y,vt=X[0]*Xt+X[4]*Tt+X[12],ct=X[1]*Xt+X[5]*Tt+X[13],it=X[2]*Xt+X[6]*Tt+X[14],Nt=X[3]*Xt+X[7]*Tt+X[15],Kt=vt+ce,Rt=ct+de,Sn=it+ge,or=Math.max(Nt+ae,1e-5),Gn=vt+ue,kn=ct+Se,Vr=it+Ne,Kn=Math.max(Nt+ze,1e-5);Ke.push(new cc(Kt/or,Rt/or,Sn/or)),ht.push(new cc(Gn/Kn,kn/Kn,Vr/Kn))}re.push(Ke),oe.push(ht)}return[re,oe]}(I,R,k,L,N)),A=t.queryGeometry;var P,I,R,k,L,N,z,j,B,H;return function(P,I,R){let k=1/0;Yx(R,I)&&(k=l1(R,I[0]));for(let L=0;L<I.length;L++){const N=I[L],z=P[L];for(let j=0;j<N.length-1;j++){const B=N[j],H=[B,N[j+1],z[j+1],z[j],B];fd(R,H)&&(k=Math.min(k,l1(R,H)))}}return k!==1/0&&k}(T,D,A.isPointQuery()?A.screenBounds:A.screenGeometry)}},line:class extends Ps{constructor(t,e){super(t,LM,e),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof bg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=f1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Yp(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const n=h1(this);return{config:new Qh(this,e),defines:n,overrideFog:!1}}queryRadius(t){const e=t,n=p1(Wu("line-width",this,e),Wu("line-gap-width",this,e)),i=Wu("line-offset",this,e);return n/2+Math.abs(i)+Tp(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,a,l){if(t.queryGeometry.isAboveHorizon)return!1;const u=Zc(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),d=t.pixelToTileUnitsFactor/2*p1(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),f=this.paint.get("line-offset").evaluate(e,n);return f&&(i=function(p,g){const _=[],x=new ee(0,0);for(let v=0;v<p.length;v++){const b=p[v],E=[];for(let C=0;C<b.length;C++){const T=b[C],D=b[C+1],A=0===C?x:T.sub(b[C-1])._unit()._perp(),P=C===b.length-1?x:D.sub(T)._unit()._perp(),I=A._add(P)._unit();I._mult(1/(I.x*P.x+I.y*P.y)),E.push(I._mult(g)._add(T))}_.push(E)}return _}(i,f*t.pixelToTileUnitsFactor)),function(p,g,_){for(let x=0;x<g.length;x++){const v=g[x];if(p.length>=3)for(let b=0;b<v.length;b++)if(Ca(p,v[b]))return!0;if(K2(p,v,_))return!0}return!1}(u,i,d)}isTileClipped(){return!0}},symbol:W_,background:class extends Ps{constructor(t,e){super(t,NM,e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends Ps{constructor(t,e){super(t,yI,e),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof bl&&(t._source.onNorthPole||t._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-color"].value.expression,[e,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=ml({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends Ps{constructor(t,e){super(t,bI,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ml({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),a=!i,l=t.style.light,u=l.properties.get("position");return a&&"viewport"===l.properties.get("anchor")&&K("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?m1(u.azimuthal,90-u.polar,e):m1(i[0],90-i[1],e)}const n=this.paint.get("sky-gradient-center");return m1(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends Ps{constructor(t,e){super(t,wI)}},model:class extends Ps{constructor(t,e){super(t,n1,e)}createBucket(t){return new gM(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof jl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function g0(t,e){return"custom"===t.type?new xI(t):new EI[t.type](t,e)}function MI(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class TI extends wr{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new ur({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,n){if(this.loaded[n]!==e&&(this.loaded[n]=e,e)){for(const{ids:i,callback:a}of this.requestors)this._notify(i,n,a);this.requestors=[]}}hasImage(e,n){return!!this.getImage(e,n)}getImage(e,n){return this.images[n][e]}addImage(e,n,i){this._validate(e,i)&&(this.images[n][e]=i)}_validate(e,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new pe(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new pe(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new pe(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(e,n){if(!e)return!0;let i=0;for(const a of e){if(a[0]<i||a[1]<a[0]||n<a[1])return!1;i=a[1]}return!0}_validateContent(e,n){return!(e&&(4!==e.length||e[0]<0||n.data.width<e[0]||e[1]<0||n.data.height<e[1]||e[2]<0||n.data.width<e[2]||e[3]<0||n.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,n,i){i.version=this.images[n][e].version+1,this.images[n][e]=i,this.updatedImages[n][e]=!0}removeImage(e,n){const i=this.images[n][e];delete this.images[n][e],delete this.patterns[n][e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,n,i){let a=!0;const l=!!this.loaded[n];if(!l)for(const u of e)this.images[n][u]||(a=!1);l||a?this._notify(e,n,i):this.requestors.push({ids:e,scope:n,callback:i})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,n,i){const a={};for(const l of e){this.images[n][l]||this.fire(new Me("styleimagemissing",{id:l}));const u=this.images[n][l];u?a[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,hasRenderCallback:!(!u.userImage||!u.userImage.render)}:K(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,a)}getPixelSize(e){const{width:n,height:i}=this.atlasImage[e];return{width:n,height:i}}getPattern(e,n){const i=this.patterns[n][e],a=this.getImage(e,n);if(!a)return null;if(i&&i.position.version===a.version)return i.position;if(i)i.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},u=new L_(l,a);this.patterns[n][e]={bin:l,position:u}}return this._updatePatternAtlas(n),this.patterns[n][e].position}bind(e,n){const i=e.gl;let a=this.atlasTexture[n];a?this.dirty&&(a.update(this.atlasImage[n]),this.dirty=!1):(a=new kr(e,this.atlasImage[n],i.RGBA),this.atlasTexture[n]=a),a.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const n=[];for(const u in this.patterns[e])n.push(this.patterns[e][u].bin);const{w:i,h:a}=Yt(n),l=this.atlasImage[e];l.resize({width:i||1,height:a||1});for(const u in this.patterns[e]){const{bin:d}=this.patterns[e][u],f=d.x+1,p=d.y+1,g=this.images[e][u].data,_=g.width,x=g.height;ur.copy(g,l,{x:0,y:0},{x:f,y:p},{width:_,height:x}),ur.copy(g,l,{x:0,y:x-1},{x:f,y:p-1},{width:_,height:1}),ur.copy(g,l,{x:0,y:0},{x:f,y:p+x},{width:_,height:1}),ur.copy(g,l,{x:_-1,y:0},{x:f-1,y:p},{width:1,height:x}),ur.copy(g,l,{x:0,y:0},{x:f+_,y:p},{width:1,height:x})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,n){for(const i of e){if(this.callbackDispatchedThisFrame[n][i])continue;this.callbackDispatchedThisFrame[n][i]=!0;const a=this.images[n][i];MI(a)&&this.updateImage(i,n,a)}}}const CI=new nr({anchor:new Ce(J.light.anchor),position:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return $e(t.expression.evaluate(e))}interpolate(t,e,n){return{x:ut(t.x,e.x,n),y:ut(t.y,e.y,n),z:ut(t.z,e.z,n),azimuthal:ut(t.azimuthal,e.azimuthal,n),polar:ut(t.polar,e.polar,n)}}}(J.light.position),color:new Ce(J.light.color),intensity:new Ce(J.light.intensity)});class VM extends wr{constructor(e,n="flat"){super(),this._transitionable=new Ai(CI),this.setLight(e,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n,i={}){this._validate(Zw,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=n)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||!1!==i.validate)&&Pg(this,e.call(zo,qe({value:n,style:{glyphs:!0,sprite:!0},styleSpec:J})))}}const DI=new nr({source:new Ce(J.terrain.source),exaggeration:new Ce(J.terrain.exaggeration)});let SI=class extends wr{constructor(t,e){super(),this._transitionable=new Ai(DI),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=e}setScope(t){this.scope=t}get(){return this._transitionable.serialize()}set(t){this._transitionable.setTransitionOrValue(t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new tr(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof jl}};const jM=45,UM=65,ru=.05;function hm(t,e,n,i){const a=Ya(jM,UM,n),[l,u]=g1(t,i);let d=1-Math.min(1,Math.exp((e-l)/(u-l)*-6));return d*=d*d,d=Math.min(1,1.00747*d),d*a*t.alpha}function g1(t,e){const n=.5/Math.tan(.5*e);return[t.range[0]+n,t.range[1]+n]}function _1(t,e,n,i,a){const l=G.transformMat4([],[e,n,i],a.mercatorFogMatrix);return hm(t,G.length(l),a.pitch,a._fov)}function y1(t,e,n,i,a,l,u){const d=[[n,i,0],[a,i,0],[a,l,0],[n,l,0]];let f=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(const g of d){const _=G.transformMat4([],g,e),x=G.length(_);f=Math.min(f,x),p=Math.max(p,x)}return[hm(t,f,u.pitch,u._fov),hm(t,p,u.pitch,u._fov)]}const $M=new nr({range:new Ce(J.fog.range),color:new Ce(J.fog.color),"high-color":new Ce(J.fog["high-color"]),"space-color":new Ce(J.fog["space-color"]),"horizon-blend":new Ce(J.fog["horizon-blend"]),"star-intensity":new Ce(J.fog["star-intensity"]),"vertical-range":new Ce(J.fog["vertical-range"])});class HM extends wr{constructor(e,n){super(),this._transitionable=new Ai($M),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){const e=this._transform,n="globe"===e.projection.name,i=ki(e.zoom),a=this.properties.get("range"),l=[.5,3];return{range:n?[ut(l[0],a[0],i),ut(l[1],a[1],i)]:a,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,n={}){if(this._validate(Ag,e,n))return;const i=qe({},e);for(const a of Object.keys(J.fog))void 0===i[a]&&(i[a]=J.fog[a].default);this._transitionable.setTransitionOrValue(i)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:Ya(jM,UM,e))*n.a}getOpacityAtLatLng(e,n){return this._transform.projection.supportsFog?function(i,a,l){const u=Gt.fromLngLat(a),d=l.elevation?l.elevation.getAtPointOrZero(u):0;return _1(i,u.x,u.y,d,l)}(this.state,e,n):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(e.toUnwrapped());return y1(this.state,n,0,0,le,le,this._transform)}getOpacityForBounds(e,n,i,a,l){return this._transform.projection.supportsFog?y1(this.state,e,n,i,a,l,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?g1(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const i of n){const a=e.points[i];let l;if(a[2]>=0)l=a;else{const u=e.points[i-4];l=Ew(u,a,u[2]/(u[2]-a[2]))}if(_1(this.state,l[0],l[1],0,this._transform)>=ru)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||!1!==i.validate)&&Pg(this,e.call(zo,qe({value:n,style:{glyphs:!0,sprite:!0},styleSpec:J})))}}class GM{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class qM{constructor(){this.tasks={},this.taskQueue=[],ui(["process"],this),this.invoker=new GM(this.process),this.nextId=0}add(e,n){const i=this.nextId++,a=function({type:l,isSymbolTile:u,zoom:d}){return d=d||0,"message"===l?0:"maybePrepare"!==l||u?"parseTile"!==l||u?"parseTile"===l&&u?300-d:"maybePrepare"===l&&u?400-d:500:200-d:100-d}(n);if(0===a){we();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:n,priority:a,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){we();try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let a=0;a<this.taskQueue.length;a++){const l=this.tasks[this.taskQueue[a]];l.priority<n&&(n=l.priority,e=a)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class x1{constructor(e,n,i){this.target=e,this.parent=n,this.mapId=i,this.callbacks={},this.cancelCallbacks={},ui(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new qM}send(e,n,i,a,l=!1,u){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=u,this.callbacks[d]=i);const f=new Set;return this.target.postMessage({id:d,type:e,hasCallback:!!i,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:zt(n,f)},f),{cancel:()=>{i&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const n=e.data,i=n.id;if(i&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(n.mustQueue||we()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,n),a&&a.metadata||{type:"message"})}else this.processTask(i,n)}processTask(e,n){if("<response>"===n.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(n.error?i(Iu(n.error)):i(null,Iu(n.data)))}else{const i=new Set,a=n.hasCallback?(u,d)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:u?zt(u):null,data:zt(d,i)},i)}:u=>{},l=Iu(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,l,a);else if(this.parent.getWorkerSource){const u=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,u[0],l.source,l.scope)[u[1]](l,a)}else a(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let dm=(()=>{class t{constructor(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Ar();const a=this.workerPool.acquire(this.id);for(let l=0;l<a.length;l++){const u=new t.Actor(a[l],i,this.id);u.name=`Worker ${l}`,this.actors.push(u)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,i,a){vu(this.actors,(l,u)=>{l.send(n,i,u)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=x1,t})();class iu extends wr{constructor(e,n,i,a){super(),this.scope=i,this._options=e,this.properties=new Jf(n),this._transitionable=new Ai(n,new Map(a)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,n){this._options=e,this._transitionable.setTransitionOrValue(e.properties,n)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const II=new nr({color:new Ce(J.properties_light_ambient.color),intensity:new Ce(J.properties_light_ambient.intensity)}),AI=new nr({direction:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,i]){const a=$e([1,n,i]);return{x:a.x,y:a.y,z:a.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:ut(t.x,e.x,n),y:ut(t.y,e.y,n),z:ut(t.z,e.z,n)}}}(J.properties_light_directional.direction),color:new Ce(J.properties_light_directional.color),intensity:new Ce(J.properties_light_directional.intensity),"cast-shadows":new Ce(J.properties_light_directional["cast-shadows"]),"shadow-intensity":new Ce(J.properties_light_directional["shadow-intensity"])});class ou{constructor(e,n,i,a){this.screenBounds=e,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,a)}static createFromScreenPoints(e,n){let i,a;if(e instanceof ee||"number"==typeof e[0]){const l=ee.convert(e);i=[l],a=n.isPointAboveHorizon(l)}else{const l=ee.convert(e[0]),u=ee.convert(e[1]);i=[l,u],a=xu(l,u).every(d=>n.isPointAboveHorizon(d))}return new ou(i,n.getCameraPoint(),a,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return xu(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new ee(1,1)):this.screenBounds[1],a=xu(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?a.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?a[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(a[3]=this.cameraPoint)),function(l,u){const d=[];for(let f=0;f<l.length;f++){const p=Ja(f-1,-1,l.length-1),g=Ja(f+1,-1,l.length-1),_=l[f],x=l[g],v=l[p].sub(_).unit(),b=x.sub(_).unit(),E=b.angleWithSep(v.x,v.y),C=v.add(b).unit().mult(-1*u/Math.sin(E/2));d.push(_.add(C))}return d}(a,e)}bufferedCameraGeometryGlobe(e){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new ee(1,1)):this.screenBounds[1],a=xu(n,i,e),l=this.cameraPoint.clone();switch(3*((l.y>n.y)+(l.y>i.y))+((l.x>n.x)+(l.x>i.x))){case 0:a[0]=l,a[4]=l.clone();break;case 1:a.splice(1,0,l);break;case 2:a[1]=l;break;case 3:a.splice(4,0,l);break;case 5:a.splice(2,0,l);break;case 6:a[3]=l;break;case 7:a.splice(3,0,l);break;case 8:a[2]=l}return a}containsTile(e,n,i,a=0){const l=e.queryPadding/n._pixelsPerMercatorPixel+1,u=i?this._bufferedCameraMercator(l,n):this._bufferedScreenMercator(l,n);let d=e.tileID.wrap+(u.unwrapped?a:0);const f=u.polygon.map(C=>yl(e.tileTransform,C,d));if(!cS(f,0,0,le,le))return;d=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?a:0);const p=this.screenGeometryMercator.polygon.map(C=>NE(e.tileTransform,C,d)),g=p.map(C=>new ee(C[0],C[1])),_=n.getFreeCameraOptions().position||new Gt(0,0,0),x=NE(e.tileTransform,_,d),v=p.map(C=>{const T=G.sub(C,C,x);return G.normalize(T,T),new ad(x,T)}),b=th(e,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:g,tilespaceRays:v,bufferedTilespaceGeometry:f,bufferedTilespaceBounds:(E=Xa(f),E.min.x=We(E.min.x,0,le),E.min.y=We(E.min.y,0,le),E.max.x=We(E.max.x,0,le),E.max.y=We(E.max.y,0,le),E),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:b};var E}_bufferedScreenMercator(e,n){const i=PI(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let a;return a="globe"===n.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),n):{polygon:this.bufferedScreenGeometry(e).map(l=>n.pointCoordinate3D(l)),unwrapped:!0},this._screenRaycastCache[i]=a,a}}_bufferedCameraMercator(e,n){const i=PI(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let a;return a="globe"===n.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),n):{polygon:this.bufferedCameraGeometry(e).map(l=>n.pointCoordinate3D(l)),unwrapped:!0},this._cameraRaycastCache[i]=a,a}}_projectAndResample(e,n){const i=function(l,u){const d=ne.multiply([],u.pixelMatrix,u.globeMatrix),f=[0,-lo,0,1],p=[0,lo,0,1],g=[0,0,0,1];xn.transformMat4(f,f,d),xn.transformMat4(p,p,d),xn.transformMat4(g,g,d);const _=new ee(f[0]/f[3],f[1]/f[3]),x=new ee(p[0]/p[3],p[1]/p[3]),v=Ca(l,_)&&f[3]<g[3],b=Ca(l,x)&&p[3]<g[3];if(!v&&!b)return null;const E=function(k,L,N){for(let z=1;z<k.length;z++){const j=Fi(L.pointCoordinate3D(k[z-1]).x),B=Fi(L.pointCoordinate3D(k[z]).x);if(N<0){if(j<B)return{idx:z,t:-j/(B-1-j)}}else if(B<j)return{idx:z,t:(1-j)/(B+1-j)}}return null}(l,u,v?-1:1);if(!E)return null;const{idx:C,t:T}=E;let D=C>1?ZM(l.slice(0,C),u):[],A=C<l.length?ZM(l.slice(C),u):[];D=D.map(k=>new ee(Fi(k.x),k.y)),A=A.map(k=>new ee(Fi(k.x),k.y));const P=[...D];0===P.length&&P.push(A[A.length-1]);const I=ut(P[P.length-1].y,(0===A.length?D[0]:A[0]).y,T);let R;return R=v?[new ee(0,I),new ee(0,0),new ee(1,0),new ee(1,I)]:[new ee(1,I),new ee(1,1),new ee(0,1),new ee(0,I)],P.push(...R),0===A.length?P.push(D[0]):P.push(...A),{polygon:P.map(k=>new Gt(k.x,k.y)),unwrapped:!1}}(e,n);if(i)return i;const a=function(l,u){let d=!1,f=-1/0,p=0;for(let _=0;_<l.length-1;_++)l[_].x>f&&(f=l[_].x,p=_);for(let _=0;_<l.length-1;_++){const x=(p+_)%(l.length-1),v=l[x],b=l[x+1];Math.abs(v.x-b.x)>.5&&(v.x<b.x?(v.x+=1,0===x&&(l[l.length-1].x+=1)):(b.x+=1,x+1===l.length-1&&(l[0].x+=1)),d=!0)}const g=Li(u.center.lng);return d&&g<Math.abs(g-1)&&l.forEach(_=>{_.x-=1}),{polygon:l,unwrapped:d}}(ZM(e,n).map(l=>new ee(Fi(l.x),l.y)),n);return{polygon:a.polygon.map(l=>new Gt(l.x,l.y)),unwrapped:a.unwrapped}}}function ZM(t,e){return W2(t,n=>{const i=e.pointCoordinate3D(n);n.x=i.x,n.y=i.y},1/256)}function Fi(t){return t<0?1+t%1:t%1}function PI(t){return 100*t|0}function _0(t,e,n,i,a){const l=function(u,d){if(u)return a(u);if(d){t.url&&d.tiles&&t.tiles&&delete t.tiles;const f=Ro(qe(d,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(f.vectorLayers=d.vector_layers,f.vectorLayerIds=f.vectorLayers.map(p=>p.id)),f.tiles=e.canonicalizeTileset(f,t.url),a(null,f)}};return t.url?Ae(e.transformRequest(e.normalizeSourceURL(t.url,null,n,i),fe.Source),l):Fe.frame(()=>l(null,t))}class fm{constructor(e,n,i){this.bounds=Rs.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),i=Math.floor(Li(this.bounds.getWest())*n),a=Math.floor(Gi(this.bounds.getNorth())*n),l=Math.ceil(Li(this.bounds.getEast())*n),u=Math.ceil(Gi(this.bounds.getSouth())*n);return e.x>=i&&e.x<l&&e.y>=a&&e.y<u}}class RI{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Xl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const i=this.getKey(e,n);return this.positions[i]}trim(){const e=this.width,n=this.height=On(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,i){const a=[];let l=e.length%2==1?-e[e.length-1]*i:0,u=e[0]*i,d=!0;a.push({left:l,right:u,isDash:d,zeroLength:0===e[0]});let f=e[0];for(let p=1;p<e.length;p++){d=!d;const g=e[p];l=f*i,f+=g,u=f*i,a.push({left:l,right:u,isDash:d,zeroLength:0===g})}return a}addRoundDash(e,n,i){const a=n/2;for(let l=-i;l<=i;l++){const u=this.width*(this.nextRow+i+l);let d=0,f=e[d];for(let p=0;p<this.width;p++){p/f.right>1&&(f=e[++d]);const g=Math.abs(p-f.left),_=Math.abs(p-f.right),x=Math.min(g,_);let v;const b=l/i*(a+1);if(f.isDash){const E=a-Math.abs(b);v=Math.sqrt(x*x+E*E)}else v=a-Math.sqrt(x*x+b*b);this.image.data[u+p]=Math.max(0,Math.min(255,v+128))}}}addRegularDash(e,n){for(let f=e.length-1;f>=0;--f){const p=e[f],g=e[f+1];p.zeroLength?e.splice(f,1):g&&g.isDash===p.isDash&&(g.left=p.left,e.splice(f,1))}const i=e[0],a=e[e.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);const l=this.width*this.nextRow;let u=0,d=e[u];for(let f=0;f<this.width;f++){f/d.right>1&&(d=e[++u]);const p=Math.abs(f-d.left),g=Math.abs(f-d.right),_=Math.min(p,g);this.image.data[l+f]=Math.max(0,Math.min(255,(d.isDash?_:-_)+n+128))}}addDash(e,n){const i=this.getKey(e,n);if(this.positions[i])return this.positions[i];const a="round"===n,l=a?7:0,u=2*l+1;if(this.nextRow+u>this.height)return K("LineAtlas out of space"),null;0===e.length&&e.push(1);let d=0;for(let g=0;g<e.length;g++)e[g]<0&&(K("Negative value is found in line dasharray, replacing values with 0"),e[g]=0),d+=e[g];if(0!==d){const g=this.width/d,_=this.getDashRanges(e,this.width,g);a?this.addRoundDash(_,g,l):this.addRegularDash(_,"square"===n?.5*g:0)}const f=this.nextRow+l;this.nextRow+=u;const p={tl:[f,l],br:[d,0]};return this.positions[i]=p,p}}Ge(RI,"LineAtlas");const Mr=1*Fs;class WM{constructor(e){const n={},i=[];for(const d in e){const f=e[d],p=n[d]={};for(const g in f.glyphs){const _=f.glyphs[+g];if(!_||0===_.bitmap.width||0===_.bitmap.height)continue;const x=_.metrics.localGlyph?Mr:1,v={x:0,y:0,w:_.bitmap.width+2*x,h:_.bitmap.height+2*x};i.push(v),p[g]=v}}const{w:a,h:l}=Yt(i),u=new Xl({width:a||1,height:l||1});for(const d in e){const f=e[d];for(const p in f.glyphs){const g=f.glyphs[+p];if(!g||0===g.bitmap.width||0===g.bitmap.height)continue;const _=n[d][p],x=g.metrics.localGlyph?Mr:1;Xl.copy(g.bitmap,u,{x:0,y:0},{x:_.x+x,y:_.y+x},g.bitmap)}}this.image=u,this.positions=n}}Ge(WM,"GlyphAtlas");class OI{constructor(e){this.tileID=new Zt(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Qc(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,n,i,a,l){this.status="parsing",this.data=e,this.collisionBoxArray=new Qw;const u=new uE(Object.keys(e.layers).sort()),d=new Dv(this.tileID,this.promoteId);d.bucketLayerIDs=[];const f={},p=new RI(256,256),g={featureIndex:d,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:p,availableImages:i,brightness:this.brightness},_=n.familiesBySource[this.source];for(const D in _){const A=e.layers[D];if(!A)continue;let P=!1,I=!1,R=!1;for(const N of _[D])"symbol"===N[0].type?P=!0:I=!0,N[0].is3D()&&"model"!==N[0].type&&(R=!0);if(this.extraShadowCaster&&!R||!0===this.isSymbolTile&&!P||!1===this.isSymbolTile&&!I)continue;1===A.version&&K(`Vector tile source "${this.source}" layer "${D}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const k=u.encode(D),L=[];for(let N=0;N<A.length;N++){const z=A.feature(N),j=d.getId(z,D);L.push({feature:z,id:j,index:N,sourceLayerIndex:k})}for(const N of _[D]){const z=N[0];(!this.extraShadowCaster||z.is3D()&&"model"!==z.type)&&(void 0!==this.isSymbolTile&&"symbol"===z.type!==this.isSymbolTile||z.minzoom&&this.zoom<Math.floor(z.minzoom)||z.maxzoom&&this.zoom>=z.maxzoom||"none"!==z.visibility&&(v1(N,this.zoom,g.brightness,i),(f[z.id]=z.createBucket({index:d.bucketLayerIDs.length,layers:N,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:k,sourceID:this.source,projection:this.projection.spec})).populate(L,g,this.tileID.canonical,this.tileTransform),d.bucketLayerIDs.push(N.map(j=>j.id))))}}let x,v,b,E;p.trim();const C={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},T=()=>{if(x)return l(x);if(this.extraShadowCaster)this.status="done",l(null,{buckets:Mi(f).filter(D=>!D.isEmpty()),featureIndex:d,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:g.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(v&&b&&E){const D=new WM(v),A=new je(b,E);for(const P in f){const I=f[P];I instanceof Xp?(v1(I.layers,this.zoom,g.brightness,i),kS(I,v,D.positions,b,A.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):I.hasPattern&&(I instanceof Yp||I instanceof xd||I instanceof Wd)&&(v1(I.layers,this.zoom,g.brightness,i),I.addFeatures(g,this.tileID.canonical,A.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",l(null,{buckets:Mi(f).filter(P=>!P.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:D.image,lineAtlas:p,imageAtlas:A,brightness:g.brightness})}};if(!this.extraShadowCaster){const D=wh(g.glyphDependencies,I=>Object.keys(I).map(Number));Object.keys(D).length?a.send("getGlyphs",{uid:this.uid,stacks:D,scope:this.scope},(I,R)=>{x||(x=I,v=R,T())},void 0,!1,C):v={};const A=Object.keys(g.iconDependencies);A.length?a.send("getImages",{icons:A,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(I,R)=>{x||(x=I,b=R,T())},void 0,!1,C):b={};const P=Object.keys(g.patternDependencies);P.length?a.send("getImages",{icons:P,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(I,R)=>{x||(x=I,E=R,T())},void 0,!1,C):E={}}T()}}function v1(t,e,n,i){const a=new tr(e,{brightness:n});for(const l of t)l.recalculate(a,i)}class rh{constructor(e){this.entries={},this.scheduler=e}request(e,n,i,a){const l=this.entries[e]=this.entries[e]||{callbacks:[]};if(l.result){const[u,d]=l.result;return this.scheduler?this.scheduler.add(()=>{a(u,d)},n):a(u,d),()=>{}}return l.callbacks.push(a),l.cancel||(l.cancel=i((u,d)=>{l.result=[u,d];for(const f of l.callbacks)this.scheduler?this.scheduler.add(()=>{f(u,d)},n):f(u,d);setTimeout(()=>delete this.entries[e],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(u=>u!==a),l.callbacks.length||(l.cancel(),delete this.entries[e]))}}}function XM(t,e,n){const i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const l=ke(t.request,(u,d,f,p)=>{u?a(u):d&&a(null,{vectorTile:n?void 0:new kp(new hr(d)),rawData:d,cacheControl:f,expires:p})});return()=>{l.cancel(),a()}},e)}class pm extends wr{constructor(e,n,i,a){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,qe(this,Ro(n,["url","scheme","tileSize","promoteId"])),this._options=qe({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a),this._tileWorkers={},this._deduped=new rh}load(e){this._loaded=!1,this.fire(new Me("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=_0(this._options,this.map._requestManager,n,i,(a,l)=>{this._tileJSONRequest=null,this._loaded=!0,a?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),i&&2!==i.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new pe(a))):l&&(qe(this,l),l.bounds&&(this.tileBounds=new fm(l.bounds,this.minzoom,this.maxzoom)),Sc(l.tiles,this.map._requestManager._customAccessToken),this.fire(new Me("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Me("data",{dataType:"source",sourceDataType:"content"}))),e&&e(a)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Pi(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return qe({},this._options)}loadTile(e,n){const i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(i,fe.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:Fe.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(a.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",a,l.bind(this));else if(e.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",a,l.bind(this),void 0,!0);else{const u=XM.call({deduped:this._deduped},a,(d,f)=>{d||!f?l.call(this,d):(a.data={cacheControl:f.cacheControl,expires:f.expires,rawData:f.rawData.slice(0)},e.actor&&e.actor.send("loadTile",a,l.bind(this),void 0,!0))},!0);e.request={cancel:u}}function l(u,d){return delete e.request,e.aborted?n(null):u&&404!==u.status?n(u):(d&&d.resourceTiming&&(e.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&d&&e.setExpiryData(d),e.loadVectorData(d,this.map.painter),Mh(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class su extends wr{constructor(e,n,i,a){super(),this.id=e,this.dispatcher=i,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=qe({type:"raster"},n),qe(this,Ro(n,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new Me("dataloading",{dataType:"source"})),this._tileJSONRequest=_0(this._options,this.map._requestManager,null,null,(n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new pe(n)):i&&(qe(this,i),i.bounds&&(this.tileBounds=new fm(i.bounds,this.minzoom,this.maxzoom)),Sc(i.tiles),this.fire(new Me("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Me("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=Pi(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return qe({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,n){const i=Fe.devicePixelRatio>=2,a=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);e.request=Ct(this.map._requestManager.transformRequest(a,fe.Tile),(l,u,d,f)=>(delete e.request,e.aborted?(e.state="unloaded",n(null)):l?(e.state="errored",n(l)):u?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:d,expires:f}),e.setTexture(u,this.map.painter),e.state="loaded",Mh(this.dispatcher),void n(null)):n(null)))}static loadTileData(e,n,i){e.setTexture(n,i)}static unloadTileData(e,n){e.texture&&n.saveTileTexture(e.texture)}abortTile(e,n){e.request&&(e.request.cancel(),delete e.request),n()}unloadTile(e,n){e.texture&&this.map.painter.saveTileTexture(e.texture),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Co;function bR(){return null!=Z0.workerClass?new Z0.workerClass:new ie.Worker(Z0.workerUrl)}const y0="mapboxgl_preloaded_worker_pool";class ih{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ih.workerCount;)this.workers.push(new bR);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[y0]}numActive(){return Object.keys(this.active).length}}let mm;function Yd(){return mm||(mm=new ih),mm}ih.workerCount=2;let gm,x0,oa,b1=null;function YM(){return we()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:x0||kt.DRACO_URL}const w1=5123,oh=5126,E1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[w1]:Uint16Array,5125:Uint32Array,[oh]:Float32Array},kI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[w1]:"DT_UINT16",5125:"DT_UINT32",[oh]:"DT_FLOAT32"},M1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function _m(t,e,n){const i=n.json.bufferViews.length,a=n.buffers.length;e.bufferView=i,n.json.bufferViews[i]={buffer:a,byteLength:t.byteLength},n.buffers[a]=t}const v0="KHR_draco_mesh_compression";function JM(t,e){const n=t.extensions&&t.extensions[v0];if(!n)return;const i=new oa.Decoder,a=QM(e,n.bufferView),l=new oa.Mesh;if(!i.DecodeArrayToMesh(a,a.byteLength,l))throw new Error("Failed to decode Draco mesh");const u=e.json.accessors[t.indices],d=E1[u.componentType],f=u.count*d.BYTES_PER_ELEMENT,p=oa._malloc(f);d===Uint16Array?i.GetTrianglesUInt16Array(l,f,p):i.GetTrianglesUInt32Array(l,f,p),_m(oa.memory.buffer.slice(p,p+f),u,e),oa._free(p);for(const g of Object.keys(n.attributes)){const _=i.GetAttributeByUniqueId(l,n.attributes[g]),x=e.json.accessors[t.attributes[g]],v=kI[x.componentType],b=x.count*M1[x.type]*E1[x.componentType].BYTES_PER_ELEMENT,E=oa._malloc(b);i.GetAttributeDataArrayForAllPoints(l,_,oa[v],b,E),_m(oa.memory.buffer.slice(E,E+b),x,e),oa._free(E)}i.destroy(),l.destroy(),delete t.extensions[v0]}const T1=1179937895,KM=new TextDecoder("utf8");function Jd(t,e){return new URL(t,e).href}function ym(t,e,n,i){return fetch(Jd(t.uri,i)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[n]=a})}function QM(t,e){const n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function LI(t,e,n,i){if(t.uri){const a=Jd(t.uri,i);return fetch(a).then(l=>l.blob()).then(l=>ie.createImageBitmap(l)).then(l=>{e.images[n]=l})}if(void 0!==t.bufferView){const a=QM(e,t.bufferView),l=new ie.Blob([a],{type:t.mimeType});return ie.createImageBitmap(l).then(u=>{e.images[n]=u})}}function eT(t,e=0,n){const i={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===T1){const p=new Uint32Array(t,e);let g=2;const _=(p[g++]>>2)-3,x=p[g++]>>2;if(g++,i.json=JSON.parse(KM.decode(p.subarray(g,g+x))),g+=x,g<_){const v=p[g++];g++;const b=e+(g<<2);i.buffers[0]=t.slice(b,b+v)}}else i.json=JSON.parse(KM.decode(new Uint8Array(t,e)));const{buffers:a,images:l,meshes:u,extensionsUsed:d}=i.json;let f=Promise.resolve();if(a){const p=[];for(let g=0;g<a.length;g++){const _=a[g];_.uri?p.push(ym(_,i,g,n)):i.buffers[g]||(i.buffers[g]=null)}f=Promise.all(p)}return f.then(()=>{const p=[],g=d&&d.includes(v0);if(g&&p.push(function(){if(!oa)return gm||(gm=function(_){let x,v=null;function b(){x=new Uint8Array(v.buffer)}function E(){throw new Error("Unexpected Draco error.")}const C={a:{a:E,d:function(T,D,A){return x.copyWithin(T,D,D+A)},c:function(T){const D=x.length,A=Math.max(T>>>0,Math.ceil(1.2*D)),P=Math.ceil((A-D)/65536);try{return v.grow(P),b(),!0}catch{return!1}},b:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(_,C):_.then(T=>T.arrayBuffer()).then(T=>WebAssembly.instantiate(T,C))).then(T=>{const{Rb:D,Qb:A,P,T:I,X:R,Ja:k,La:L,Qa:N,Va:z,Wa:j,eb:B,jb:H,f:V,e:Z,yb:Q,zb:te,Ab:W,Bb:X,Db:re,Gb:oe}=T.instance.exports;v=Z;const ce=(()=>{let de=0,ge=0,ae=0,ue=0;return Se=>{ae&&(D(ue),D(de),ge+=ae,ae=de=0),de||(ge+=128,de=A(ge));const Ne=Se.length+7&-8;let ze=de;Ne>=ge&&(ae=Ne,ze=ue=A(Ne));for(let Ve=0;Ve<Se.length;Ve++)x[ze+Ve]=Se[Ve];return ze}})();return b(),V(),{memory:Z,_free:D,_malloc:A,Mesh:class{constructor(){this.ptr=P()}destroy(){I(this.ptr)}},Decoder:class{constructor(){this.ptr=k()}destroy(){H(this.ptr)}DecodeArrayToMesh(de,ge,ae){const ue=ce(de),Se=L(this.ptr,ue,ge,ae.ptr);return!!R(Se)}GetAttributeByUniqueId(de,ge){return{ptr:N(this.ptr,de.ptr,ge)}}GetTrianglesUInt16Array(de,ge,ae){z(this.ptr,de.ptr,ge,ae)}GetTrianglesUInt32Array(de,ge,ae){j(this.ptr,de.ptr,ge,ae)}GetAttributeDataArrayForAllPoints(de,ge,ae,ue,Se){B(this.ptr,de.ptr,ge.ptr,ae,ue,Se)}},DT_INT8:Q(),DT_UINT8:te(),DT_INT16:W(),DT_UINT16:X(),DT_UINT32:re(),DT_FLOAT32:oe()}})}(fetch(YM())),gm.then(_=>{oa=_,gm=void 0}))}()),l)for(let _=0;_<l.length;_++)p.push(LI(l[_],i,_,n));return(p.length?Promise.all(p):Promise.resolve()).then(()=>{if(g&&u)for(const{primitives:_}of u)for(const x of _)JM(x,i);return i})})}function C1(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>eT(e,0,t))}class D1{constructor(e,n,i){if(this.triangleCount=n.length/3,this.min=new ee(0,0),this.max=new ee(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===i)return;const a=e.map(g=>g.x),l=e.map(g=>g.y);this.min=new ee(Math.min(...a),Math.min(...l)),this.max=new ee(Math.max(...a),Math.max(...l));const u=this.max.sub(this.min);u.x=Math.max(u.x,1),u.y=Math.max(u.y,1);const d=Math.max(u.x,u.y)/i;this.cellsX=Math.max(1,Math.ceil(u.x/d)),this.cellsY=Math.max(1,Math.ceil(u.y/d)),this.xScale=1/d,this.yScale=1/d;const f=[];for(let g=0;g<this.triangleCount;g++){const _=e[n[3*g+0]].sub(this.min),x=e[n[3*g+1]].sub(this.min),v=e[n[3*g+2]].sub(this.min),b=hc(Math.floor(Math.min(_.x,x.x,v.x)),this.xScale,this.cellsX),E=hc(Math.floor(Math.max(_.x,x.x,v.x)),this.xScale,this.cellsX),C=hc(Math.floor(Math.min(_.y,x.y,v.y)),this.yScale,this.cellsY),T=hc(Math.floor(Math.max(_.y,x.y,v.y)),this.yScale,this.cellsY),D=new ee(0,0),A=new ee(0,0),P=new ee(0,0),I=new ee(0,0);for(let R=C;R<=T;++R){D.y=A.y=R*d,P.y=I.y=(R+1)*d;for(let k=b;k<=E;++k)D.x=P.x=k*d,A.x=I.x=(k+1)*d,(Mp(_,x,v,D,A,I)||Mp(_,x,v,D,I,P))&&f.push({cellIdx:R*this.cellsX+k,triIdx:g})}}if(0===f.length)return;f.sort((g,_)=>g.cellIdx-_.cellIdx||g.triIdx-_.triIdx);let p=0;for(;p<f.length;){const g=f[p].cellIdx,_={start:this.payload.length,len:0};for(;p<f.length&&f[p].cellIdx===g;)++_.len,this.payload.push(f[p++].triIdx);this.cells[g]=_}}query(e,n,i){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let f=0;f<this.lookup.length;f++)this.lookup[f]=0;const a=hc(e.x-this.min.x,this.xScale,this.cellsX),l=hc(n.x-this.min.x,this.xScale,this.cellsX),u=hc(e.y-this.min.y,this.yScale,this.cellsY),d=hc(n.y-this.min.y,this.yScale,this.cellsY);for(let f=u;f<=d;f++)for(let p=a;p<=l;p++){const g=this.cells[f*this.cellsX+p];if(g)for(let _=0;_<g.len;_++){const x=this.payload[g.start+_],v=Math.floor(x/8),b=1<<x%8;if(!(this.lookup[v]&b)&&(this.lookup[v]|=b,i.push(x),i.length===this.triangleCount))return}}}}function hc(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function sh(t,e){const n=t.json.bufferViews[e.bufferView];return new E1[e.componentType](t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*M1[e.type])}function tT(t,e,n){const i=t.indices,a=t.attributes,l={};l.indexArray=new Rr;const u=e.json.accessors[i],d=u.count/3;l.indexArray.reserve(d);const f=sh(e,u);for(let x=0;x<d;x++)l.indexArray.emplaceBack(f[3*x],f[3*x+1],f[3*x+2]);l.indexArray._trim(),l.vertexArray=new wa;const p=e.json.accessors[a.POSITION];l.vertexArray.reserve(p.count);const g=sh(e,p);for(let x=0;x<p.count;x++)l.vertexArray.emplaceBack(g[3*x],g[3*x+1],g[3*x+2]);if(l.vertexArray._trim(),l.aabb=new $n(p.min,p.max),l.centroid=function(x,v){const b=[0,0,0],E=x.length;if(E>0){for(let C=0;C<E;C++){const T=3*x[C];b[0]+=v[T],b[1]+=v[T+1],b[2]+=v[T+2]}b[0]/=E,b[1]/=E,b[2]/=E}return b}(f,g),void 0!==a.COLOR_0){const x=e.json.accessors[a.COLOR_0],v=M1[x.type];if(x.componentType===oh){l.colorArray=3===v?new wa:new rr,l.colorArray.reserve(x.count);const b=sh(e,x);if(3===v)for(let E=0;E<x.count;E++)l.colorArray.emplaceBack(b[3*E],b[3*E+1],b[3*E+2]);else for(let E=0;E<x.count;E++)l.colorArray.emplaceBack(b[4*E],b[4*E+1],b[4*E+2],b[4*E+3]);l.colorArray._trim()}else if(x.componentType===w1&&4===v){l.colorArray=new rr,l.colorArray.resize(x.count);const b=sh(e,x),E=1/65535,C=l.colorArray.float32;for(let T=0;T<4*b.length;++T)C[T]=b[T]*E}else K(`glTF color buffer parsing for accessor ${JSON.stringify(x)} is not supported`)}if(void 0!==a.NORMAL){l.normalArray=new wa;const x=e.json.accessors[a.NORMAL];l.normalArray.reserve(x.count);const v=sh(e,x);for(let b=0;b<x.count;b++)l.normalArray.emplaceBack(v[3*b],v[3*b+1],v[3*b+2]);l.normalArray._trim()}if(void 0!==a.TEXCOORD_0&&n.length>0){l.texcoordArray=new ku;const x=e.json.accessors[a.TEXCOORD_0];l.texcoordArray.reserve(x.count);const v=sh(e,x);for(let b=0;b<x.count;b++)l.texcoordArray.emplaceBack(v[2*b],v[2*b+1]);l.texcoordArray._trim()}const _=t.material;return l.material=function(x,v){const{emissiveFactor:b=[0,0,0],alphaMode:E="OPAQUE",alphaCutoff:C=.5,normalTexture:T,occlusionTexture:D,emissiveTexture:A,doubleSided:P}=x,{baseColorFactor:I=[1,1,1,1],metallicFactor:R=1,roughnessFactor:k=1,baseColorTexture:L,metallicRoughnessTexture:N}=x.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new At(...I),metallicFactor:R,roughnessFactor:k,baseColorTexture:L?v[L.index]:void 0,metallicRoughnessTexture:N?v[N.index]:void 0},doubleSided:P,emissiveFactor:b,alphaMode:E,alphaCutoff:C,normalTexture:T?v[T.index]:void 0,occlusionTexture:D?v[D.index]:void 0,emissionTexture:A?v[A.index]:void 0,defined:void 0===x.defined}}(void 0!==_?e.json.materials[_]:{defined:!1},n),void 0!==a._FEATURE_RGBA4444&&(l.featureData=new Uint32Array(sh(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer)),l}function nT(t,e,n){const{matrix:i,rotation:a,translation:l,scale:u,mesh:d,extras:f,children:p}=t,g={};if(g.matrix=i||ne.fromRotationTranslationScale([],a||[0,0,0,1],l||[0,0,0],u||[1,1,1]),void 0!==d){g.meshes=n[d];const _=g.anchor=[0,0];for(const x of g.meshes){const{min:v,max:b}=x.aabb;_[0]+=v[0]+b[0],_[1]+=v[1]+b[1]}_[0]=Math.floor(_[0]/g.meshes.length/2),_[1]=Math.floor(_[1]/g.meshes.length/2)}if(f&&(f.id&&(g.id=f.id),f.lights&&(g.lights=function(_){if(!_.length)return[];const x=function(T){const D=atob(T),A=new Uint8Array(D.length);for(let P=0;P<D.length;P++)A[P]=D.codePointAt(P);return A}(_),v=[],b=x.length/24,E=new Uint16Array(x.buffer),C=new Float32Array(x.buffer);for(let T=0;T<b;T++){const D=E[2*T*6]/30,A=E[2*T*6+1]/30,P=E[2*T*6+10]/100,I=C[6*T+1],R=C[6*T+2],k=C[6*T+3],L=C[6*T+4],N=k-I,z=L-R,j=Math.hypot(N,z);v.push({pos:[I+.5*N,R+.5*z,A],normal:[z/j,-N/j,0],width:j,height:D,depth:P,points:[I,R,k,L]})}return v}(f.lights))),p){const _=[];for(const x of p)_.push(nT(e.json.nodes[x],e,n));g.children=_}return g}function FI(t){if(0===t.vertices.length||0===t.indices.length)return null;const[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let u=1;u<t.vertices.length;++u){const d=t.vertices[u];e.x=Math.min(e.x,d.x),e.y=Math.min(e.y,d.y),n.x=Math.max(n.x,d.x),n.y=Math.max(n.y,d.y)}const i=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),a=Math.max(8,i),l=new D1(t.vertices,t.indices,a);return{vertices:t.vertices,indices:t.indices,grid:l,min:e,max:n}}function wR(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const n=e[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const u of n){if(!Array.isArray(u)||2!==u.length)continue;const d=u[0],f=u[1];"number"==typeof d&&"number"==typeof f&&i.push(new ee(d,f))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let a=0;for(let u=0;u<i.length;u++){const d=i[u],f=i[(u+1)%i.length],p=i[(u+2)%i.length];a+=(d.x-f.x)*(p.y-f.y)-(p.x-f.x)*(d.y-f.y)}a>0&&i.reverse();const l=E_(i.flatMap(u=>[u.x,u.y]),[]);return 0===l.length?null:{vertices:i,indices:l}}function ER(t){const e=[],n=[];let i=0;for(const a of t){i=e.length;const l=a.vertexArray.float32,u=a.indexArray.uint16;for(let d=0;d<a.vertexArray.length;d++)e.push(new ee(l[3*d+0],l[3*d+1]));for(let d=0;d<3*a.indexArray.length;d++)n.push(u[d]+i)}if(n.length%3!=0)return null;for(let a=0;a<n.length;a+=3){const l=e[n[a+0]],u=e[n[a+1]],d=e[n[a+2]];(l.x-u.x)*(d.y-u.y)-(d.x-u.x)*(l.y-u.y)>0&&([n[a+1],n[a+2]]=[n[a+2],n[a+1]])}return{vertices:e,indices:n}}function rT(t){const n=function(f,p){const g=[];for(const _ of f.json.meshes){const x=[];for(const v of _.primitives)x.push(tT(v,f,p));g.push(x)}return g}(t,function(f,p){const g=[],_=ie.WebGL2RenderingContext;if(f.json.textures)for(const x of f.json.textures){const v={magFilter:_.LINEAR,minFilter:_.NEAREST,wrapS:_.REPEAT,wrapT:_.REPEAT};void 0!==x.sampler&&Object.assign(v,f.json.samplers[x.sampler]),g.push({image:p[x.source],sampler:v,uploaded:!1})}return g}(t,t.images)),{scenes:i,scene:a,nodes:l}=t.json,u=i?i[a||0].nodes:l,d=[];for(const f of u)d.push(nT(l[f],t,n));return function(f,p,g){const _={},x=new Set;for(let v=0;v<f.length;v++){const b=g[p[v]];if(!b.extras)continue;const E=b.extras["mapbox:footprint:version"],C=b.extras["mapbox:footprint:id"];(E||C)&&x.add(v),"1.0.0"===E&&C&&(_[C]=v)}for(let v=0;v<f.length;v++){if(x.has(v))continue;const b=f[v],E=g[p[v]];if(!E.extras)continue;let C=null;b.id in _&&(C=ER(f[_[b.id]].meshes)),C||(C=wR(E)),C&&(b.footprint=FI(C))}if(x.size>0){const v=Array.from(x.values()).sort((b,E)=>b-E);for(let b=v.length-1;b>=0;b--)f.splice(v[b],1)}}(d,u,t.json.nodes),d}function MR(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,n=t.aabb.min[0]-1,i=t.aabb.min[1]-1,a=64/(t.aabb.max[0]-n+2),l=64/(t.aabb.max[1]-i+2);for(let u=0;u<e.length;u+=3){const d=e[u+2],f=(e[u+0]-n)*a|0,p=(e[u+1]-i)*l|0;d>t.heightmap[64*p+f]&&(t.heightmap[64*p+f]=d)}}function iT(t,e){const n={};n.indexArray=new Rr,n.indexArray.reserve(4*t.length),n.vertexArray=new wa,n.vertexArray.reserve(10*t.length),n.colorArray=new rr,n.vertexArray.reserve(10*t.length);let i=0;for(const u of t){const d=Math.min(10,Math.max(4,1.3*u.height))*e,f=[-u.normal[1],u.normal[0],0],p=Math.min(.29,.1*u.width/u.depth),g=u.width-2*u.depth*e*(p+.01),_=G.scaleAndAdd([],u.pos,f,g/2),x=G.scaleAndAdd([],u.pos,f,-g/2),v=[_[0],_[1],_[2]+u.height],b=[x[0],x[1],x[2]+u.height],E=G.scaleAndAdd([],u.normal,f,p);G.scale(E,E,d);const C=G.scaleAndAdd([],u.normal,f,-p);G.scale(C,C,d),G.add(E,_,E),G.add(C,x,C),_[2]+=.1,x[2]+=.1,n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(x[0],x[1],x[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(b[0],b[1],b[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(x[0],x[1],x[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]);const T=g/d/2;n.colorArray.emplaceBack(-T-p,-1,T,.8),n.colorArray.emplaceBack(T+p,-1,T,.8),n.colorArray.emplaceBack(-T,0,T,1.3),n.colorArray.emplaceBack(T,0,T,1.3),n.colorArray.emplaceBack(T+p,-.8,T,.7),n.colorArray.emplaceBack(T+p,-.8,T,.7),n.colorArray.emplaceBack(0,0,T,1.3),n.colorArray.emplaceBack(0,0,T,1.3),n.colorArray.emplaceBack(T+p,-1.2,T,.8),n.colorArray.emplaceBack(T+p,-1.2,T,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}const a={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=At.white,a.pbrMetallicRoughness=l,n.material=a,n.aabb=new $n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Ge(D1,"TriangleGridIndex");const Kd={vector:pm,raster:su,"raster-dem":class extends su{constructor(t,e,n,i){super(t,e,n,i),this.type="raster-dem",this.maxzoom=22,this._options=qe({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(t,e){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);t.request=Ct(this.map._requestManager.transformRequest(n,fe.Tile),function(l,u,d,f){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(l)t.state="errored",e(l);else if(u){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:d,expires:f});const g=ie.ImageBitmap&&u instanceof ie.ImageBitmap&&(null==Co&&(Co=ie.OffscreenCanvas&&new ie.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof ie.createImageBitmap),Co),_=1-(u.width-((p=u.width)<=1?1:Math.pow(2,Math.floor(Math.log(p)/Math.LN2))))/2;_<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const x=g?u:Fe.getImageData(u,_),v={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:x,encoding:this.encoding,padding:_,convertToFloat:i};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",v,a.bind(this),void 0,!0))}var p}.bind(this));const i=this.map?.painter?.terrainUseFloatDEM();function a(l,u){l&&(t.state="errored",e(l)),u&&(t.dem=u,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",e(null))}}_getNeighboringTiles(t){const e=t.canonical,n=Math.pow(2,e.z),i=(e.x-1+n)%n,a=0===e.x?t.wrap-1:t.wrap,l=(e.x+1+n)%n,u=e.x+1===n?t.wrap+1:t.wrap,d={};return d[new Zt(t.overscaledZ,a,e.z,i,e.y).key]={backfilled:!1},d[new Zt(t.overscaledZ,u,e.z,l,e.y).key]={backfilled:!1},e.y>0&&(d[new Zt(t.overscaledZ,a,e.z,i,e.y-1).key]={backfilled:!1},d[new Zt(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},d[new Zt(t.overscaledZ,u,e.z,l,e.y-1).key]={backfilled:!1}),e.y+1<n&&(d[new Zt(t.overscaledZ,a,e.z,i,e.y+1).key]={backfilled:!1},d[new Zt(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},d[new Zt(t.overscaledZ,u,e.z,l,e.y+1).key]={backfilled:!1}),d}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.hillshadeFBO&&(t.hillshadeFBO.destroy(),delete t.hillshadeFBO),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends wr{constructor(t,e,n,i){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=e.data,this._options=qe({},e),this._collectResourceTiming=e.collectResourceTiming,void 0!==e.maxzoom&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;const a=le/this.tileSize;this.workerOptions=qe({source:this.id,scope:this.scope,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(void 0!==e.buffer?e.buffer:128)*a,tolerance:(void 0!==e.tolerance?e.tolerance:.375)*a,extent:le,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:void 0!==e.clusterMaxZoom?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:le,radius:(void 0!==e.clusterRadius?e.clusterRadius:50)*a,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Me("dataloading",{dataType:"source"})),this._loaded=!1;const t=qe({},this.workerOptions);t.scope=this.scope;const e=this._data;"string"==typeof e?(t.request=this.map._requestManager.transformRequest(Fe.resolveURL(e),fe.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(n,i)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new pe(n));else{const a={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(a.resourceTiming=i.resourceTiming[this.id]),this.fire(new Me("data",a)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(t,e){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const i={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:Fe.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(n,i,(a,l)=>(delete t.request,t.unloadVectorData(),t.aborted?e(null):a?e(a):(t.loadVectorData(l,this.map.painter,"reloadTile"===n),e(null))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return qe({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends bl{constructor(t,e,n,i){super(t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,fe.Source).url);!function(e,n){const i=ie.document.createElement("video");i.muted=!0,i.onloadstart=function(){n(null,i)};for(let a=0;a<e.length;a++){const l=ie.document.createElement("source");Be(e[a])||(i.crossOrigin="Anonymous"),l.src=e[a],i.appendChild(l)}}(this.urls,(e,n)=>{this._loaded=!0,e?this.fire(new pe(e)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new pe(new De(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,e=t.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new kr(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:bl,model:class extends wr{constructor(t,e,n,i){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const t=[];for(const e in this._options.models){const n=this._options.models[e],i=C1(this.map._requestManager.transformRequest(n.uri,fe.Model).url).then(a=>{if(!a)return;const l=rT(a),u=new t1(e,n.position,n.orientation,l);u.computeBoundsAndApplyParent(),this.models.push(u)}).catch(a=>{this.fire(new pe(new Error(`Could not load model ${e} from ${n.uri}: ${a.message}`)))});t.push(i)}return Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new Me("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new pe(new Error(`Could not load models: ${e.message}`)))})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends wr{constructor(t,e,n,i){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(t){this.map=t,this.load()}load(t){this._loaded=!1,this.fire(new Me("dataloading",{dataType:"source"}));const e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=_0(this._options,this.map._requestManager,e,n,(i,a)=>{this._tileJSONRequest=null,this._loaded=!0,i?(e&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${e}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new pe(i))):a&&(qe(this,a),a.bounds&&(this.tileBounds=new fm(a.bounds,this.minzoom,this.maxzoom)),Sc(a.tiles,this.map._requestManager._customAccessToken),this.fire(new Me("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Me("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(t,e){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,fe.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=e;else{if(t.buckets){const l=Object.values(t.buckets);for(const u of l)u.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",i,a.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",i,a.bind(this),void 0,!0);function a(l,u){return t.aborted?e(null):l&&404!==l.status?e(l):(u&&(u.resourceTiming&&(t.resourceTiming=u.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(u),t.buckets={...t.buckets,...u.buckets}),t.state="loaded",void e(null))}}serialize(){return qe({},this._options)}},canvas:class extends bl{constructor(t,e,n,i){super(t,e,n,i),e.coordinates?Array.isArray(e.coordinates)&&4===e.coordinates.length&&!e.coordinates.some(a=>!Array.isArray(a)||2!==a.length||a.some(l=>"number"!=typeof l))||this.fire(new pe(new De(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new pe(new De(`sources.${t}`,null,'missing required property "coordinates"'))),e.animate&&"boolean"!=typeof e.animate&&this.fire(new pe(new De(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),e.canvas?"string"==typeof e.canvas||e.canvas instanceof ie.HTMLCanvasElement||this.fire(new pe(new De(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new pe(new De(`sources.${t}`,null,'missing required property "canvas"'))),this.options=e,this.animate=void 0===e.animate||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof ie.HTMLCanvasElement?this.options.canvas:ie.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new pe(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const e=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof Q_||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new kr(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends wr{constructor(t,e,n,i){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=e,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new pe(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new pe(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fm(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.clearTiles=this._clearTiles.bind(this),e.coveringTiles=this._coveringTiles.bind(this),qe(this,Ro(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Ro(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Me("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Me("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new Me("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:n,z:i}=t.canonical;return this._implementation.hasTile({x:e,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:n,y:i,z:a}=t.tileID.canonical,l=new ie.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:a},{signal:l.signal})).then(function(u){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===u?(t.state="errored",e(null)):null===u?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):(d=u)instanceof ie.ImageData||d instanceof ie.HTMLCanvasElement||d instanceof ie.ImageBitmap||d instanceof ie.HTMLImageElement?(this.loadTileData(t,u),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var d}.bind(this)).catch(u=>{20!==u.code&&(t.state="errored",e(u))}),t.request.cancel=()=>l.abort()}loadTileData(t,e){su.loadTileData(t,e,this._map.painter)}unloadTileData(t){su.unloadTileData(t,this._map.painter)}unloadTile(t,e){if(this.unloadTileData(t),this._implementation.unloadTile){const{x:n,y:i,z:a}=t.tileID.canonical;this._implementation.unloadTile({x:n,y:i,z:a})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_clearTiles(){const t=Pi(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new Me("data",{dataType:"source",sourceDataType:"content"}))}}},S1=function(t,e,n,i){const a=new Kd[e.type](t,e,n,i);if(a.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${a.id}`);return ui(["load","abort","unload","serialize","prepare"],a),a};function NI(t,e){const n=ne.identity([]);return ne.scale(n,n,[.5*t.width,.5*-t.height,1]),ne.translate(n,n,[1,-1,0]),ne.multiply(n,n,t.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(n)}function oT(t,e,n,i,a,l,u,d=!1){const f=t.tilesIn(i,u,d);f.sort(sT);const p=[];for(const _ of f)p.push({wrappedTileID:_.tile.tileID.wrapped().key,queryResults:_.tile.queryRenderedFeatures(e,n,t._state,_,a,l,NI(t.transform,_.tile.tileID),d)});const g=function(_){const x={},v={};for(const b of _){const E=b.queryResults,C=b.wrappedTileID,T=v[C]=v[C]||{};for(const D in E){const A=E[D],P=T[D]=T[D]||{},I=x[D]=x[D]||[];for(const R of A)P[R.featureIndex]||(P[R.featureIndex]=!0,I.push(R))}}return x}(p);for(const _ in g)g[_].forEach(x=>{const v=x.feature,b=v.layer;b&&"background"!==b.type&&"sky"!==b.type&&"slot"!==b.type&&(v.source=b.source,b["source-layer"]&&(v.sourceLayer=b["source-layer"]),v.state=void 0!==v.id?t.getFeatureState(b["source-layer"],v.id):{})});return g}function xm(t,e){const n=t.getRenderableIds().map(l=>t.getTileByID(l)),i=[],a={};for(let l=0;l<n.length;l++){const u=n[l],d=u.tileID.canonical.key;a[d]||(a[d]=!0,u.querySourceFeatures(i,e))}return i}function sT(t,e){const n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class zI{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const n=this.style._mergedLayers[e];if("fill-extrusion"===n.type)this.layers.push(n);else if("model"===n.type){const i=this.style.getLayerSource(n);i&&"batched-model"===i.type&&this.layers.push(n)}}}updateZOffset(e,n){this.currentBuildingBuckets=[];for(let a=0;a<this.layers.length;++a){const l=this.layers[a],u=this.style.getLayerSourceCache(l);let d=1;"fill-extrusion"===l.type&&(d=l.paint.get("fill-extrusion-opacity")>0?l.paint.get("fill-extrusion-vertical-scale"):0);let f=u?u.getTile(n):null;if(!f&&u&&n.canonical.z>u.getSource().minzoom){let p=n.scaledTo(Math.min(u.getSource().maxzoom,n.overscaledZ-1));for(;p.overscaledZ>=u.getSource().minzoom&&(f=u.getTile(p),!f&&0!==p.overscaledZ);)p=p.scaledTo(p.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:f?f.getBucket(l):null,tileID:f?f.tileID:n,verticalScale:d})}e.hasAnyZOffset=!1;let i=!1;for(let a=0;a<e.symbolInstances.length;a++){const l=e.symbolInstances.get(a),u=l.zOffset,d=this._getHeightAtTileOffset(n,l.tileAnchorX,l.tileAnchorY);l.zOffset=-1!==d?d:u,i||u===l.zOffset||(i=!0),e.hasAnyZOffset||0===l.zOffset||(e.hasAnyZOffset=!0)}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,n,i,a){let l=n,u=i;if(e.canonical.z!==a.canonical.z){const d=a.canonical,f=1/(1<<e.canonical.z-d.z);l=(n+e.canonical.x*le)*f-d.x*le|0,u=(i+e.canonical.y*le)*f-d.y*le|0}return{tileX:l,tileY:u}}_getHeightAtTileOffset(e,n,i){let a;for(let l=0;l<this.layers.length;++l){if("fill-extrusion"!==this.layers[l].type)continue;const{bucket:u,tileID:d,verticalScale:f}=this.currentBuildingBuckets[l];if(!u)continue;const{tileX:p,tileY:g}=this._mapCoordToOverlappingTile(e,n,i,d),_=u.getHeightAtTileCoord(p,g);if(_&&void 0!==_.height){if(!_.hidden)return _.height*f;a=_.height}}for(let l=0;l<this.layers.length;++l){if("model"!==this.layers[l].type)continue;const{bucket:u,tileID:d}=this.currentBuildingBuckets[l];if(!u)continue;const{tileX:f,tileY:p}=this._mapCoordToOverlappingTile(e,n,i,d),g=u.getHeightAtTileCoord(f,p);if(g&&!g.hidden)return void 0===g.height&&void 0!==a?Math.min(g.maxHeight,a)*g.verticalScale:(g.height||0)*g.verticalScale}return-1}}var aT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function BI(t,e){const n={};for(const i in t)"ref"!==i&&(n[i]=t[i]);return aT.forEach(i=>{i in e&&(n[i]=e[i])}),n}function VI(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=BI(t[n],e[t[n].ref]));return t}const ln={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function I1(t,e,n){n.push({command:ln.addSource,args:[t,e[t]]})}function lT(t,e,n){e.push({command:ln.removeSource,args:[t]}),n[t]=!0}function jI(t,e,n,i){lT(t,n,i),I1(t,e,n)}function vm(t,e,n){let i;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!en(t[n][i],e[n][i]))return!1;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!en(t[n][i],e[n][i]))return!1;return!0}function b0(t,e,n,i,a,l){let u;for(u in e=e||{},t=t||{})t.hasOwnProperty(u)&&(en(t[u],e[u])||n.push({command:l,args:[i,u,e[u],a]}));for(u in e)e.hasOwnProperty(u)&&!t.hasOwnProperty(u)&&(en(t[u],e[u])||n.push({command:l,args:[i,u,e[u],a]}))}function bm(t){return t.id}function w0(t,e){return t[e.id]=e,t}class cT{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=We(e,0,1);let n=1,i=this._distances[n];const a=e*this.paddedLength+this.padding;for(;i<a&&n<this._distances.length;)i=this._distances[++n];const l=n-1,u=this._distances[l],d=i-u,f=d>0?(a-u)/d:0;return this.points[l].mult(1-f).add(this.points[n].mult(f))}}class uT{constructor(e,n,i){const a=this.boxCells=[],l=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(n/i);for(let u=0;u<this.xCellCount*this.yCellCount;u++)a.push([]),l.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,i,a,l){this._forEachCell(n,i,a,l,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(l)}insertCircle(e,n,i,a){this._forEachCell(n-a,i-a,n+a,i+a,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(i),this.circles.push(a)}_insertBoxCell(e,n,i,a,l,u){this.boxCells[l].push(u)}_insertCircleCell(e,n,i,a,l,u){this.circleCells[l].push(u)}_query(e,n,i,a,l,u){if(i<0||e>this.width||a<0||n>this.height)return!l&&[];const d=[];if(e<=0&&n<=0&&this.width<=i&&this.height<=a){if(l)return!0;for(let f=0;f<this.boxKeys.length;f++)d.push({key:this.boxKeys[f],x1:this.bboxes[4*f],y1:this.bboxes[4*f+1],x2:this.bboxes[4*f+2],y2:this.bboxes[4*f+3]});for(let f=0;f<this.circleKeys.length;f++){const p=this.circles[3*f],g=this.circles[3*f+1],_=this.circles[3*f+2];d.push({key:this.circleKeys[f],x1:p-_,y1:g-_,x2:p+_,y2:g+_})}return u?d.filter(u):d}return this._forEachCell(e,n,i,a,this._queryCell,d,{hitTest:l,seenUids:{box:{},circle:{}}},u),l?d.length>0:d}_queryCircle(e,n,i,a,l){const u=e-i,d=e+i,f=n-i,p=n+i;if(d<0||u>this.width||p<0||f>this.height)return!a&&[];const g=[];return this._forEachCell(u,f,d,p,this._queryCellCircle,g,{hitTest:a,circle:{x:e,y:n,radius:i},seenUids:{box:{},circle:{}}},l),a?g.length>0:g}query(e,n,i,a,l){return this._query(e,n,i,a,!1,l)}hitTest(e,n,i,a,l){return this._query(e,n,i,a,!0,l)}hitTestCircle(e,n,i,a){return this._queryCircle(e,n,i,!0,a)}_queryCell(e,n,i,a,l,u,d,f){const p=d.seenUids,g=this.boxCells[l];if(null!==g){const x=this.bboxes;for(const v of g)if(!p.box[v]){p.box[v]=!0;const b=4*v;if(e<=x[b+2]&&n<=x[b+3]&&i>=x[b+0]&&a>=x[b+1]&&(!f||f(this.boxKeys[v]))){if(d.hitTest)return u.push(!0),!0;u.push({key:this.boxKeys[v],x1:x[b],y1:x[b+1],x2:x[b+2],y2:x[b+3]})}}}const _=this.circleCells[l];if(null!==_){const x=this.circles;for(const v of _)if(!p.circle[v]){p.circle[v]=!0;const b=3*v;if(this._circleAndRectCollide(x[b],x[b+1],x[b+2],e,n,i,a)&&(!f||f(this.circleKeys[v]))){if(d.hitTest)return u.push(!0),!0;{const E=x[b],C=x[b+1],T=x[b+2];u.push({key:this.circleKeys[v],x1:E-T,y1:C-T,x2:E+T,y2:C+T})}}}}}_queryCellCircle(e,n,i,a,l,u,d,f){const p=d.circle,g=d.seenUids,_=this.boxCells[l];if(null!==_){const v=this.bboxes;for(const b of _)if(!g.box[b]){g.box[b]=!0;const E=4*b;if(this._circleAndRectCollide(p.x,p.y,p.radius,v[E+0],v[E+1],v[E+2],v[E+3])&&(!f||f(this.boxKeys[b])))return u.push(!0),!0}}const x=this.circleCells[l];if(null!==x){const v=this.circles;for(const b of x)if(!g.circle[b]){g.circle[b]=!0;const E=3*b;if(this._circlesCollide(v[E],v[E+1],v[E+2],p.x,p.y,p.radius)&&(!f||f(this.circleKeys[b])))return u.push(!0),!0}}}_forEachCell(e,n,i,a,l,u,d,f){const p=this._convertToXCellCoord(e),g=this._convertToYCellCoord(n),_=this._convertToXCellCoord(i),x=this._convertToYCellCoord(a);for(let v=p;v<=_;v++)for(let b=g;b<=x;b++)if(l.call(this,e,n,i,a,this.xCellCount*b+v,u,d,f))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,i,a,l,u){const d=a-e,f=l-n,p=i+u;return p*p>d*d+f*f}_circleAndRectCollide(e,n,i,a,l,u,d){const f=(u-a)/2,p=Math.abs(e-(a+f));if(p>f+i)return!1;const g=(d-l)/2,_=Math.abs(n-(l+g));if(_>g+i)return!1;if(p<=f||_<=g)return!0;const x=p-f,v=_-g;return x*x+v*v<=i*i}}const Na=100;class UI{constructor(e,n,i=new uT(e.width+200,e.height+200,25),a=new uT(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=a,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Na,this.screenBottomBoundary=e.height+Na,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=n}placeCollisionBox(e,n,i,a,l,u,d,f){let p=i.projectedAnchorX,g=i.projectedAnchorY,_=i.projectedAnchorZ;const x=i.elevation,v=i.tileID,b=e.getProjection();if(x&&v){const[R,k,L]=b.upVector(v.canonical,i.tileAnchorX,i.tileAnchorY),N=b.upVectorScale(v.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;p+=R*x*N,g+=k*x*N,_+=L*x*N}const E=this.projectAndGetPerspectiveRatio(d,p,g,_,i.tileID,"globe"===b.name||!!x||this.transform.pitch>0,b),C=u*E.perspectiveRatio,T=(i.x1*n+a.x-i.padding)*C+E.point.x,D=(i.y1*n+a.y-i.padding)*C+E.point.y,A=(i.x2*n+a.x+i.padding)*C+E.point.x,P=(i.y2*n+a.y+i.padding)*C+E.point.y,I=E.perspectiveRatio<=.55||E.occluded;return!this.isInsideGrid(T,D,A,P)||!l&&this.grid.hitTest(T,D,A,P,f)||I?{box:[],offscreen:!1,occluded:E.occluded}:{box:[T,D,A,P],offscreen:this.isOffscreen(T,D,A,P),occluded:!1}}placeCollisionCircles(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E){const C=[],T=this.transform.elevation,D=e.getProjection(),A=T?T.getAtTileOffsetFunc(E,this.transform.center.lat,this.transform.worldSize,D):null,P=new ee(i.tileAnchorX,i.tileAnchorY);let{x:I,y:R,z:k}=D.projectTilePoint(P.x,P.y,E.canonical);if(A){const[te,W,X]=A(P);I+=te,R+=W,k+=X}const L="globe"===D.name,N=this.projectAndGetPerspectiveRatio(d,I,R,k,E,L||!!T||this.transform.pitch>0,D),{perspectiveRatio:z}=N,j=(_?u/z:u*z)/pi,B=ia(I,R,k,f),H=N.signedDistanceFromCamera>0?Gd(j,l,i.lineOffsetX*j,i.lineOffsetY*j,!1,B,P,i,a,f,{},T&&!_?A:null,_&&!!T,D,E,_):null;let V=!1,Z=!1,Q=!0;if(H&&!N.occluded){const te=.5*v*z+b,W=new ee(-100,-100),X=new ee(this.screenRightBoundary,this.screenBottomBoundary),re=new cT,{first:oe,last:ce}=H,de=oe.path.length;let ge=[];for(let Se=de-1;Se>=1;Se--)ge.push(oe.path[Se]);for(let Se=1;Se<ce.path.length;Se++)ge.push(ce.path[Se]);const ae=2.5*te;p&&(ge=ge.map(([Se,Ne,ze],Ve)=>(A&&!L&&(ze=A(Ve<de-1?oe.tilePath[de-1-Ve]:ce.tilePath[Ve-de+2])[2]),ia(Se,Ne,ze,p))),ge.some(Se=>Se[3]<=0)&&(ge=[]));let ue=[];if(ge.length>0){let Se=1/0,Ne=-1/0,ze=1/0,Ve=-1/0;for(const Ke of ge)Se=Math.min(Se,Ke[0]),ze=Math.min(ze,Ke[1]),Ne=Math.max(Ne,Ke[0]),Ve=Math.max(Ve,Ke[1]);Ne>=W.x&&Se<=X.x&&Ve>=W.y&&ze<=X.y&&(ue=[ge.map(Ke=>new ee(Ke[0],Ke[1]))],(Se<W.x||Ne>X.x||ze<W.y||Ve>X.y)&&(ue=hs(ue,W.x,W.y,X.x,X.y)))}for(const Se of ue){re.reset(Se,.25*te);let Ne=0;Ne=re.length<=.5*te?1:Math.ceil(re.paddedLength/ae)+1;for(let ze=0;ze<Ne;ze++){const Ve=ze/Math.max(Ne-1,1),Ke=re.lerp(Ve),ht=Ke.x+Na,Ot=Ke.y+Na;C.push(ht,Ot,te,0);const Xt=ht-te,Tt=Ot-te,vt=ht+te,ct=Ot+te;if(Q=Q&&this.isOffscreen(Xt,Tt,vt,ct),Z=Z||this.isInsideGrid(Xt,Tt,vt,ct),!n&&this.grid.hitTestCircle(ht,Ot,te,x)&&(V=!0,!g))return{circles:[],offscreen:!1,collisionDetected:V,occluded:!1}}}}return{circles:!g&&V||!Z?[]:C,offscreen:Q,collisionDetected:V,occluded:N.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,a=1/0,l=-1/0,u=-1/0;for(const g of e){const _=new ee(g.x+Na,g.y+Na);i=Math.min(i,_.x),a=Math.min(a,_.y),l=Math.max(l,_.x),u=Math.max(u,_.y),n.push(_)}const d=this.grid.query(i,a,l,u).concat(this.ignoredGrid.query(i,a,l,u)),f={},p={};for(const g of d){const _=g.key;void 0===f[_.bucketInstanceId]&&(f[_.bucketInstanceId]={}),f[_.bucketInstanceId][_.featureIndex]||fd(n,[new ee(g.x1,g.y1),new ee(g.x2,g.y1),new ee(g.x2,g.y2),new ee(g.x1,g.y2)])&&(f[_.bucketInstanceId][_.featureIndex]=!0,void 0===p[_.bucketInstanceId]&&(p[_.bucketInstanceId]=[]),p[_.bucketInstanceId].push(_.featureIndex))}return p}insertCollisionBox(e,n,i,a,l){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:a,collisionGroupID:l},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,i,a,l){const u=n?this.ignoredGrid:this.grid,d={bucketInstanceId:i,featureIndex:a,collisionGroupID:l};for(let f=0;f<e.length;f+=4)u.insertCircle(d,e[f],e[f+1],e[f+2])}projectAndGetPerspectiveRatio(e,n,i,a,l,u,d){const f=[n,i,a,1];let p=!1;a||this.transform.pitch>0?(xn.transformMat4(f,f,e),this.fogState&&l&&"globe"!==d.name&&(p=function(x,v,b,E,C,T){const D=T.calculateFogTileMatrix(C),A=[v,b,E];return G.transformMat4(A,A,D),hm(x,G.length(A),T.pitch,T._fov)}(this.fogState,n,i,a,l.toUnwrapped(),this.transform)>.9)):Qv(f,f,e);const g=f[3];return{point:new ee((f[0]/g+1)/2*this.transform.width+Na,(-f[1]/g+1)/2*this.transform.height+Na),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(d)/g*.5,1.5),signedDistanceFromCamera:g,occluded:u&&f[2]>g||p}}isOffscreen(e,n,i,a){return i<Na||e>=this.screenRightBoundary||a<Na||n>this.screenBottomBoundary}isInsideGrid(e,n,i,a){return i>=0&&e<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=ne.identity([]);return ne.translate(e,e,[-100,-100,0]),e}}function wm(t,e,n){const i=e.createTileMatrix(t,t.worldSize,n.toUnwrapped());return ne.multiply(new Float32Array(16),t.projMatrix,i)}function $I(t,e,n){if(e.projection.name===n.projection.name)return t.projMatrix;const i=n.clone();return i.setProjection(e.projection),wm(i,e.getProjection(),t)}function E0(t,e,n){return e.name===n.projection.name?t.projMatrix:wm(n,e,t)}class A1{constructor(e,n,i,a){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):a&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Em{constructor(e,n,i,a,l,u=!1){this.text=new A1(e?e.text:null,n,i,l),this.icon=new A1(e?e.icon:null,n,a,l),this.clipped=u}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class P1{constructor(e,n,i,a=!1){this.text=e,this.icon=n,this.skipFade=i,this.clipped=a}}class HI{constructor(){this.invProjMatrix=ne.create(),this.viewportMatrix=ne.create(),this.circles=[]}}class R1{constructor(e,n,i,a,l){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=i,this.bucketIndex=a,this.tileID=l}}class GI{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:i=>i.collisionGroupID===n}}return this.collisionGroups[e]}}function O1(t,e,n,i,a){const{horizontalAlign:l,verticalAlign:u}=B_(t),d=-(l-.5)*e,f=-(u-.5)*n,p=Up(t,i);return new ee(d+p[0]*a,f+p[1]*a)}function k1(t,e,n,i,a){const l=new ee(t,e);return n&&l._rotate(i?a:-a),l}class qI{constructor(e,n,i,a,l,u){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new UI(this.transform,l),this.buildingIndex=u,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new GI(i),this.collisionCircleArrays={},this.prevPlacement=a,a&&(a.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,i,a){const l=i.getBucket(n),u=i.latestFeatureIndex;if(!l||!u||n.fqid!==l.layerIds[0])return;const d=l.layers[0].layout,f=i.collisionBoxArray,p=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),g=i.tileSize/le,_=i.tileID.toUnwrapped();this.transform.setProjection(l.projection);const x=(v=i.tileID,b=l.getProjection(),E=this.transform,b.name===this.projection?E.calculateProjMatrix(v.toUnwrapped()):wm(E,b,v));var v,b,E;const C="map"===d.get("text-pitch-alignment"),T="map"===d.get("text-rotation-alignment");n.compileFilter();const D=n.dynamicFilter(),A=n.dynamicFilterNeedsFeature(),P=this.transform.calculatePixelsToTileUnitsMatrix(i),I=c0(x,i.tileID.canonical,C,T,this.transform,l.getProjection(),P);let R=null;if(C){const N=Yv(x,i.tileID.canonical,C,T,this.transform,l.getProjection(),P);R=ne.multiply([],this.transform.labelPlaneMatrix,N)}let k=null;D&&i.latestFeatureIndex&&(k={unwrappedTileID:_,dynamicFilter:D,dynamicFilterNeedsFeature:A,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[l.bucketInstanceId]=new R1(l.bucketInstanceId,u,l.sourceLayerIndex,l.index,i.tileID);const L={bucket:l,layout:d,posMatrix:x,textLabelPlaneMatrix:I,labelToScreenMatrix:R,clippingData:k,scale:p,textPixelRatio:g,holdingForFade:i.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:ec(l.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:ec(l.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(l.sourceID)};if(a)for(const N of l.sortKeyRanges){const{sortKey:z,symbolInstanceStart:j,symbolInstanceEnd:B}=N;e.push({sortKey:z,symbolInstanceStart:j,symbolInstanceEnd:B,parameters:L})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:l.symbolInstances.length,parameters:L})}attemptAnchorPlacement(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D){const{textOffset0:A,textOffset1:P,crossTileID:I}=x,R=[A,P],k=O1(e,i,a,R,l),L=this.collisionIndex.placeCollisionBox(b,l,n,k1(k.x,k.y,u,d,this.transform.angle),_,f,p,g.predicate);if(C){const N=b.getSymbolInstanceIconSize(D,this.transform.zoom,x.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(b,N,C,k1(k.x,k.y,u,d,this.transform.angle),_,f,p,g.predicate).box.length)return}if(L.box.length>0){let N;return this.prevPlacement&&this.prevPlacement.variableOffsets[I]&&this.prevPlacement.placements[I]&&this.prevPlacement.placements[I].text&&(N=this.prevPlacement.variableOffsets[I].anchor),this.variableOffsets[I]={textOffset:R,width:i,height:a,anchor:e,textScale:l,prevAnchor:N},this.markUsedJustification(b,e,x,E),b.allowVerticalPlacement&&(this.markUsedOrientation(b,E,x),this.placedOrientations[I]=E),{shift:k,placedGlyphBoxes:L}}}placeLayerBucketPart(e,n,i,a){const{bucket:l,layout:u,posMatrix:d,textLabelPlaneMatrix:f,labelToScreenMatrix:p,clippingData:g,textPixelRatio:_,holdingForFade:x,collisionBoxArray:v,partiallyEvaluatedTextSize:b,partiallyEvaluatedIconSize:E,collisionGroup:C}=e.parameters,T=u.get("text-optional"),D=u.get("icon-optional"),A=u.get("text-allow-overlap"),P=u.get("icon-allow-overlap"),I="map"===u.get("text-rotation-alignment"),R="map"===u.get("text-pitch-alignment"),k="viewport-y"===u.get("symbol-z-order"),L=u.get("symbol-z-elevate");this.transform.setProjection(l.projection);let N=A&&(P||!l.hasIconData()||D),z=P&&(A||!l.hasTextData()||T);!l.collisionArrays&&v&&l.deserializeCollisionBoxes(v),i&&a&&l.updateCollisionDebugBuffers(this.transform.zoom,v);const j=(B,H,V)=>{const{crossTileID:Z,numVerticalGlyphVertices:Q}=B;if(g){const vt={zoom:this.transform.zoom,pitch:this.transform.pitch};let ct=null;if(g.dynamicFilterNeedsFeature){const it=this.retainedQueryData[l.bucketInstanceId];ct=g.featureIndex.loadFeature({featureIndex:B.featureIndex,bucketIndex:it.bucketIndex,sourceLayerIndex:it.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,g.dynamicFilter)(vt,ct,this.retainedQueryData[l.bucketInstanceId].tileID.canonical,new ee(B.tileAnchorX,B.tileAnchorY),this.transform.calculateDistanceTileData(g.unwrappedTileID)))return this.placements[Z]=new P1(!1,!1,!1,!0),void n.add(Z)}if(n.has(Z))return;if(x)return void(this.placements[Z]=new P1(!1,!1,!1));let te=!1,W=!1,X=!0,re=!1,oe=!1,ce=null,de={box:null,offscreen:null,occluded:null},ge={box:null,offscreen:null,occluded:null},ae=null,ue=null,Se=null,Ne=0,ze=0,Ve=0;V.textFeatureIndex?Ne=V.textFeatureIndex:B.useRuntimeCollisionCircles&&(Ne=B.featureIndex),V.verticalTextFeatureIndex&&(ze=V.verticalTextFeatureIndex);const Ke=vt=>{vt.tileID=this.retainedQueryData[l.bucketInstanceId].tileID;const ct=this.transform.elevation;vt.elevation=B.zOffset+(ct?ct.getAtTileOffset(vt.tileID,vt.tileAnchorX,vt.tileAnchorY):0)},ht=V.textBox;if(ht){Ke(ht);const vt=it=>{let Nt=Hn.horizontal;if(l.allowVerticalPlacement&&!it&&this.prevPlacement){const Kt=this.prevPlacement.placedOrientations[Z];Kt&&(this.placedOrientations[Z]=Kt,Nt=Kt,this.markUsedOrientation(l,Nt,B))}return Nt},ct=(it,Nt)=>{if(l.allowVerticalPlacement&&Q>0&&V.verticalTextBox){for(const Kt of l.writingModes)if(Kt===Hn.vertical?(de=Nt(),ge=de):de=it(),de&&de.box&&de.box.length)break}else de=it()};if(u.get("text-variable-anchor")){let it=u.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z]){const Rt=this.prevPlacement.variableOffsets[Z];it.indexOf(Rt.anchor)>0&&(it=it.filter(Sn=>Sn!==Rt.anchor),it.unshift(Rt.anchor))}const Nt=(Rt,Sn,or)=>{const Gn=l.getSymbolInstanceTextSize(b,B,this.transform.zoom,H),kn=(Rt.x2-Rt.x1)*Gn+2*Rt.padding,Vr=(Rt.y2-Rt.y1)*Gn+2*Rt.padding,Kn=B.hasIconTextFit&&!P?Sn:null;Kn&&Ke(Kn);let qn={box:[],offscreen:!1,occluded:!1};const Tn=A?2*it.length:it.length;for(let So=0;So<Tn;++So){const Ba=this.attemptAnchorPlacement(it[So%it.length],Rt,kn,Vr,Gn,I,R,_,d,C,So>=it.length,B,H,l,or,Kn,b,E);if(Ba&&(qn=Ba.placedGlyphBoxes,qn&&qn.box&&qn.box.length)){te=!0,ce=Ba.shift;break}}return qn};ct(()=>Nt(ht,V.iconBox,Hn.horizontal),()=>{const Rt=V.verticalTextBox;return Rt&&Ke(Rt),l.allowVerticalPlacement&&!(de&&de.box&&de.box.length)&&Q>0&&Rt?Nt(Rt,V.verticalIconBox,Hn.vertical):{box:null,offscreen:null,occluded:null}}),de&&(te=de.box,X=de.offscreen,re=de.occluded);const Kt=vt(!(!de||!de.box));if(!te&&this.prevPlacement){const Rt=this.prevPlacement.variableOffsets[Z];Rt&&(this.variableOffsets[Z]=Rt,this.markUsedJustification(l,Rt.anchor,B,Kt))}}else{const it=(Nt,Kt)=>{const Rt=l.getSymbolInstanceTextSize(b,B,this.transform.zoom,H),Sn=this.collisionIndex.placeCollisionBox(l,Rt,Nt,new ee(0,0),A,_,d,C.predicate);return Sn&&Sn.box&&Sn.box.length&&(this.markUsedOrientation(l,Kt,B),this.placedOrientations[Z]=Kt),Sn};ct(()=>it(ht,Hn.horizontal),()=>{const Nt=V.verticalTextBox;return l.allowVerticalPlacement&&Q>0&&Nt?(Ke(Nt),it(Nt,Hn.vertical)):{box:null,offscreen:null,occluded:null}}),vt(!!(de&&de.box&&de.box.length))}}if(ae=de,te=ae&&ae.box&&ae.box.length>0,X=ae&&ae.offscreen,re=ae&&ae.occluded,B.useRuntimeCollisionCircles){const vt=l.text.placedSymbolArray.get(B.centerJustifiedTextSymbolIndex>=0?B.centerJustifiedTextSymbolIndex:B.verticalPlacedTextSymbolIndex),ct=Bp(l.textSizeData,b,vt),it=u.get("text-padding");ue=this.collisionIndex.placeCollisionCircles(l,A,vt,l.lineVertexArray,l.glyphOffsetArray,ct,d,f,p,i,R,C.predicate,B.collisionCircleDiameter*ct/pi,it,this.retainedQueryData[l.bucketInstanceId].tileID),te=A||ue.circles.length>0&&!ue.collisionDetected,X=X&&ue.offscreen,re=ue.occluded}if(V.iconFeatureIndex&&(Ve=V.iconFeatureIndex),V.iconBox){const vt=ct=>{Ke(ct);const it=B.hasIconTextFit&&ce?k1(ce.x,ce.y,I,R,this.transform.angle):new ee(0,0),Nt=l.getSymbolInstanceIconSize(E,this.transform.zoom,B.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(l,Nt,ct,it,P,_,d,C.predicate)};ge&&ge.box&&ge.box.length&&V.verticalIconBox?(Se=vt(V.verticalIconBox),W=Se.box.length>0):(Se=vt(V.iconBox),W=Se.box.length>0),X=X&&Se.offscreen,oe=Se.occluded}const Ot=T||0===B.numHorizontalGlyphVertices&&0===Q,Xt=D||0===B.numIconVertices;if(Ot||Xt?Xt?Ot||(W=W&&te):te=W&&te:W=te=W&&te,te&&ae&&ae.box&&this.collisionIndex.insertCollisionBox(ae.box,u.get("text-ignore-placement"),l.bucketInstanceId,ge&&ge.box&&ze?ze:Ne,C.ID),W&&Se&&this.collisionIndex.insertCollisionBox(Se.box,u.get("icon-ignore-placement"),l.bucketInstanceId,Ve,C.ID),ue&&(te&&this.collisionIndex.insertCollisionCircles(ue.circles,u.get("text-ignore-placement"),l.bucketInstanceId,Ne,C.ID),i)){const vt=l.bucketInstanceId;let ct=this.collisionCircleArrays[vt];void 0===ct&&(ct=this.collisionCircleArrays[vt]=new HI);for(let it=0;it<ue.circles.length;it+=4)ct.circles.push(ue.circles[it+0]),ct.circles.push(ue.circles[it+1]),ct.circles.push(ue.circles[it+2]),ct.circles.push(ue.collisionDetected?1:0)}const Tt="globe"!==l.projection.name;N=N&&(Tt||!re),z=z&&(Tt||!oe),this.placements[Z]=new P1(te||N,W||z,X||l.justReloaded),n.add(Z)};if(L&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,this.retainedQueryData[l.bucketInstanceId].tileID),l.updateZOffset()),k){const B=l.getSortedSymbolIndexes(this.transform.angle);for(let H=B.length-1;H>=0;--H){const V=B[H];j(l.symbolInstances.get(V),V,l.collisionArrays[V])}l.hasAnyZOffset&&K(`${l.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(l.hasAnyZOffset){const B=l.getSortedIndexesByZOffset();for(let H=0;H<B.length;++H){const V=B[H];j(l.symbolInstances.get(V),V,l.collisionArrays[V])}}else for(let B=e.symbolInstanceStart;B<e.symbolInstanceEnd;B++)j(l.symbolInstances.get(B),B,l.collisionArrays[B]);if(i&&l.bucketInstanceId in this.collisionCircleArrays){const B=this.collisionCircleArrays[l.bucketInstanceId];ne.invert(B.invProjMatrix,d),B.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}markUsedJustification(e,n,i,a){const{leftJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,rightJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:f,crossTileID:p}=i,g=$_(n),_=a===Hn.vertical?f:"left"===g?l:"center"===g?u:"right"===g?d:-1;l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=_>=0&&l!==_?0:p),u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=_>=0&&u!==_?0:p),d>=0&&(e.text.placedSymbolArray.get(d).crossTileID=_>=0&&d!==_?0:p),f>=0&&(e.text.placedSymbolArray.get(f).crossTileID=_>=0&&f!==_?0:p)}markUsedOrientation(e,n,i){const a=n===Hn.horizontal||n===Hn.horizontalOnly?n:0,l=n===Hn.vertical?n:0,{leftJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,rightJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:p}=i,g=e.text.placedSymbolArray;u>=0&&(g.get(u).placedOrientation=a),d>=0&&(g.get(d).placedOrientation=a),f>=0&&(g.get(f).placedOrientation=a),p>=0&&(g.get(p).placedOrientation=l)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let i=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const a=n?n.symbolFadeChange(e):1,l=n?n.opacities:{},u=n?n.variableOffsets:{},d=n?n.placedOrientations:{};for(const f in this.placements){const p=this.placements[f],g=l[f];g?(this.opacities[f]=new Em(g,a,p.text,p.icon,null,p.clipped),i=i||p.text!==g.text.placed||p.icon!==g.icon.placed):(this.opacities[f]=new Em(null,a,p.text,p.icon,p.skipFade,p.clipped),i=i||p.text||p.icon)}for(const f in l){const p=l[f];if(!this.opacities[f]){const g=new Em(p,a,!1,!1);g.isHidden()||(this.opacities[f]=g,i=i||p.text.placed||p.icon.placed)}}for(const f in u)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=u[f]);for(const f in d)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=d[f]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const i=new Set;for(const a of n){const l=a.getBucket(e);l&&a.latestFeatureIndex&&e.fqid===l.layerIds[0]&&(this.updateBucketOpacities(l,i,a.collisionBoxArray),l.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,a.tileID),l.updateZOffset()))}}updateBucketOpacities(e,n,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const a=e.layers[0].layout,l=!!e.layers[0].dynamicFilter(),u=new Em(null,0,!1,!1,!0),d=a.get("text-allow-overlap"),f=a.get("icon-allow-overlap"),p=a.get("text-variable-anchor"),g="map"===a.get("text-rotation-alignment"),_="map"===a.get("text-pitch-alignment"),x=new Em(null,0,d&&(f||!e.hasIconData()||a.get("icon-optional")),f&&(d||!e.hasTextData()||a.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);const v=(E,C,T)=>{for(let D=0;D<C/4;D++)E.opacityVertexArray.emplaceBack(T)};let b=0;for(let E=0;E<e.symbolInstances.length;E++){const C=e.symbolInstances.get(E),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:D,crossTileID:A,numIconVertices:P}=C,I=n.has(A);let R=this.opacities[A];I?R=u:R||(R=x,this.opacities[A]=R),n.add(A);const k=T>0||D>0,L=P>0,N=this.placedOrientations[A],z=N===Hn.vertical,j=N===Hn.horizontal||N===Hn.horizontalOnly;if(!k&&!L||R.isHidden()||b++,k){const B=fT(R.text);v(e.text,T,z?T0:B),v(e.text,D,j?T0:B);const H=R.text.isHidden(),{leftJustifiedTextSymbolIndex:V,centerJustifiedTextSymbolIndex:Z,rightJustifiedTextSymbolIndex:Q,verticalPlacedTextSymbolIndex:te}=C,W=e.text.placedSymbolArray,X=H||z?1:0;V>=0&&(W.get(V).hidden=X),Z>=0&&(W.get(Z).hidden=X),Q>=0&&(W.get(Q).hidden=X),te>=0&&(W.get(te).hidden=H||j?1:0);const re=this.variableOffsets[A];re&&this.markUsedJustification(e,re.anchor,C,N);const oe=this.placedOrientations[A];oe&&(this.markUsedJustification(e,"left",C,oe),this.markUsedOrientation(e,oe,C))}if(L){const B=fT(R.icon),{placedIconSymbolIndex:H,verticalPlacedIconSymbolIndex:V}=C,Z=e.icon.placedSymbolArray,Q=R.icon.isHidden()?1:0;H>=0&&(v(e.icon,P,z?T0:B),Z.get(H).hidden=Q),V>=0&&(v(e.icon,C.numVerticalIconVertices,j?T0:B),Z.get(V).hidden=Q)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const B=e.collisionArrays[E];if(B){let H=new ee(0,0),V=!0;if(B.textBox||B.verticalTextBox){if(p){const Q=this.variableOffsets[A];Q?(H=O1(Q.anchor,Q.width,Q.height,Q.textOffset,Q.textScale),g&&H._rotate(_?this.transform.angle:-this.transform.angle)):V=!1}l&&(V=!R.clipped),B.textBox&&M0(e.textCollisionBox.collisionVertexArray,R.text.placed,!V||z,H.x,H.y),B.verticalTextBox&&M0(e.textCollisionBox.collisionVertexArray,R.text.placed,!V||j,H.x,H.y)}const Z=V&&!(j||!B.verticalIconBox);B.iconBox&&M0(e.iconCollisionBox.collisionVertexArray,R.icon.placed,Z,C.hasIconTextFit?H.x:0,C.hasIconTextFit?H.y:0),B.verticalIconBox&&M0(e.iconCollisionBox.collisionVertexArray,R.icon.placed,!Z,C.hasIconTextFit?H.x:0,C.hasIconTextFit?H.y:0)}}}if(e.fullyClipped=0===b,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const E=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=E.invProjMatrix,e.placementViewportMatrix=E.viewportMatrix,e.collisionCircleArray=E.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const i=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function M0(t,e,n,i,a){t.emplaceBack(e?1:0,n?1:0,i||0,a||0),t.emplaceBack(e?1:0,n?1:0,i||0,a||0),t.emplaceBack(e?1:0,n?1:0,i||0,a||0),t.emplaceBack(e?1:0,n?1:0,i||0,a||0)}const ZI=Math.pow(2,25),WI=Math.pow(2,24),XI=Math.pow(2,17),YI=Math.pow(2,16),JI=Math.pow(2,9),hT=Math.pow(2,8),dT=Math.pow(2,1);function fT(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*ZI+e*WI+n*XI+e*YI+n*JI+e*hT+n*dT+e}const T0=0;class pT{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,n,i,a,l){const u=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(u,a,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,l())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,u.sort((d,f)=>d.sortKey-f.sortKey));this._currentPartIndex<u.length;){const d=u[this._currentPartIndex];if(n.placeLayerBucketPart(d,this._seenCrossTileIDs,i,0===d.symbolInstanceStart),this._currentPartIndex++,l())return!0}return!1}}class KI{constructor(e,n,i,a,l,u,d,f,p){this.placement=new qI(e,l,u,d,f,p),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=a,this._done=!1}isDone(){return this._done}continuePlacement(e,n,i,a){const l=Fe.now(),u=()=>{const d=Fe.now()-l;return!this._forceFullPlacement&&d>2};for(;this._currentPlacementIndex>=0;){const d=n[e[this._currentPlacementIndex]],f=this.placement.collisionIndex.transform.zoom;if("symbol"===d.type&&(!d.minzoom||d.minzoom<=f)&&(!d.maxzoom||d.maxzoom>f)){const p=d,g=p.layout.get("symbol-z-elevate"),_=this._inProgressLayer=this._inProgressLayer||new pT(p),x=Pi(d.source,d.scope);if(_.continuePlacement(g?a[x]:i[x],this.placement,this._showCollisionBoxes,d,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const mT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class C0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,i]=new Uint8Array(e,0,2);if(219!==n)throw new Error("Data does not appear to be in a KDBush format.");const a=i>>4;if(1!==a)throw new Error(`Got v${a} data when expected v1.`);const l=mT[15&i];if(!l)throw new Error("Unrecognized array type.");const[u]=new Uint16Array(e,2,1),[d]=new Uint32Array(e,4,1);return new C0(d,u,l,e)}constructor(e,n=64,i=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=mT.indexOf(this.ArrayType),u=2*e*this.ArrayType.BYTES_PER_ELEMENT,d=e*this.IndexArrayType.BYTES_PER_ELEMENT,f=(8-d%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+d+f,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+u+d+f),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+d+f,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=n,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return L1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:u,nodeSize:d}=this,f=[0,l.length-1,0],p=[];for(;f.length;){const g=f.pop()||0,_=f.pop()||0,x=f.pop()||0;if(_-x<=d){for(let C=x;C<=_;C++){const T=u[2*C],D=u[2*C+1];T>=e&&T<=i&&D>=n&&D<=a&&p.push(l[C])}continue}const v=x+_>>1,b=u[2*v],E=u[2*v+1];b>=e&&b<=i&&E>=n&&E<=a&&p.push(l[v]),(0===g?e<=b:n<=E)&&(f.push(x),f.push(v-1),f.push(1-g)),(0===g?i>=b:a>=E)&&(f.push(v+1),f.push(_),f.push(1-g))}return p}within(e,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:l,nodeSize:u}=this,d=[0,a.length-1,0],f=[],p=i*i;for(;d.length;){const g=d.pop()||0,_=d.pop()||0,x=d.pop()||0;if(_-x<=u){for(let C=x;C<=_;C++)I0(l[2*C],l[2*C+1],e,n)<=p&&f.push(a[C]);continue}const v=x+_>>1,b=l[2*v],E=l[2*v+1];I0(b,E,e,n)<=p&&f.push(a[v]),(0===g?e-i<=b:n-i<=E)&&(d.push(x),d.push(v-1),d.push(1-g)),(0===g?e+i>=b:n+i>=E)&&(d.push(v+1),d.push(_),d.push(1-g))}return f}}function L1(t,e,n,i,a,l){if(a-i<=n)return;const u=i+a>>1;D0(t,e,u,i,a,l),L1(t,e,n,i,u-1,1-l),L1(t,e,n,u+1,a,1-l)}function D0(t,e,n,i,a,l){for(;a>i;){if(a-i>600){const p=a-i+1,g=n-i+1,_=Math.log(p),x=.5*Math.exp(2*_/3),v=.5*Math.sqrt(_*x*(p-x)/p)*(g-p/2<0?-1:1);D0(t,e,n,Math.max(i,Math.floor(n-g*x/p+v)),Math.min(a,Math.floor(n+(p-g)*x/p+v)),l)}const u=e[2*n+l];let d=i,f=a;for(ah(t,e,i,n),e[2*a+l]>u&&ah(t,e,i,a);d<f;){for(ah(t,e,d,f),d++,f--;e[2*d+l]<u;)d++;for(;e[2*f+l]>u;)f--}e[2*i+l]===u?ah(t,e,i,f):(f++,ah(t,e,f,a)),f<=n&&(i=f+1),n<=f&&(a=f-1)}}function ah(t,e,n,i){S0(t,n,i),S0(e,2*n,2*i),S0(e,2*n+1,2*i+1)}function S0(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function I0(t,e,n,i){const a=t-n,l=e-i;return a*a+l*l}const F1=512/le/2;class QI{constructor(e,n,i){this.tileID=e,this.bucketInstanceId=i,this.index=new C0(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const a=e.canonical.x*le,l=e.canonical.y*le;for(let u=0;u<n.length;u++){const{key:d,crossTileID:f,tileAnchorX:p,tileAnchorY:g}=n.get(u),_=Math.floor((a+p)*F1),x=Math.floor((l+g)*F1);this.index.add(_,x),this.keys.push(d),this.crossTileIDs.push(f)}this.index.finish()}findMatches(e,n,i){const a=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),l=F1/Math.pow(2,n.canonical.z-this.tileID.canonical.z),u=n.canonical.x*le,d=n.canonical.y*le;for(let f=0;f<e.length;f++){const p=e.get(f);if(p.crossTileID)continue;const{key:g,tileAnchorX:_,tileAnchorY:x}=p,v=Math.floor((u+_)*l),b=Math.floor((d+x)*l),E=this.index.range(v-a,b-a,v+a,b+a);for(const C of E){const T=this.crossTileIDs[C];if(this.keys[C]===g&&!i.has(T)){i.add(T),p.crossTileID=T;break}}}}}class N1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class eA{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(0!==n)for(const i in this.indexes){const a=this.indexes[i],l={};for(const u in a){const d=a[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),l[d.tileID.key]=d}this.indexes[i]=l}this.lng=e}addBucket(e,n,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let l=0;l<n.symbolInstances.length;l++)n.symbolInstances.get(l).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const a=this.usedCrossTileIDs[e.overscaledZ];for(const l in this.indexes){const u=this.indexes[l];if(Number(l)>e.overscaledZ)for(const d in u){const f=u[d];f.tileID.isChildOf(e)&&f.findMatches(n.symbolInstances,e,a)}else{const d=u[e.scaledTo(Number(l)).key];d&&d.findMatches(n.symbolInstances,e,a)}}for(let l=0;l<n.symbolInstances.length;l++){const u=n.symbolInstances.get(l);u.crossTileID||(u.crossTileID=i.generate(),a.add(u.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new QI(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const i of n.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let n=!1;for(const i in this.indexes){const a=this.indexes[i];for(const l in a)e[a[l].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,a[l]),delete a[l],n=!0)}return n}}class Br{constructor(){this.layerIndexes={},this.crossTileIDs=new N1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,i,a){let l=this.layerIndexes[e.fqid];void 0===l&&(l=this.layerIndexes[e.fqid]=new eA);let u=!1;const d={};"globe"!==a.name&&l.handleWrapJump(i);for(const f of n){const p=f.getBucket(e);p&&e.fqid===p.layerIds[0]&&(p.bucketInstanceId||(p.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(f.tileID,p,this.crossTileIDs)&&(u=!0),d[p.bucketInstanceId]=!0)}return l.removeStaleBuckets(d)&&(u=!0),u}pruneUnusedLayers(e){const n={};e.forEach(i=>{n[i]=!0});for(const i in this.layerIndexes)n[i]||delete this.layerIndexes[i]}}var au="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\n{return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn)\n{return pow(srgbIn,vec3(2.2));}vec3 linearProduct(vec3 srgbIn,vec3 k)\n{return srgbIn*pow(k,vec3(1./2.2));}\n#if __VERSION__ >=300\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define _HANDLE_WIREFRAME_DEPTH\n#endif\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\n_HANDLE_WIREFRAME_DEPTH;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",z1="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",gT="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",tA="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",A0="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",P0="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",_T="#ifdef RENDER_SHADOWS\n#if defined(NATIVE) && __VERSION__ >=300\n#define TEXTURE_GATHER\n#endif\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const B1=[];Mm(au,B1);const Qd={"_prelude_fog.vertex.glsl":tA,"_prelude_terrain.vertex.glsl":gT,"_prelude_shadow.vertex.glsl":P0,"_prelude_fog.fragment.glsl":A0,"_prelude_shadow.fragment.glsl":_T,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE"},R0={};hn("",gT),hn(A0,tA),hn(_T,P0);const V1=hn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),O0=au;var j1={background:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;varying vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:hn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:hn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:hn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#if __VERSION__ >=300\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:hn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nvarying highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:hn('#include "_prelude_shadow.fragment.glsl"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 u_ground_shadow_factor;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\ngl_FragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;attribute vec2 a_pos;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:hn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\ngl_FragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\ngl_FragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nattribute highp vec4 a_pos_end;attribute highp float a_angular_offset_factor;attribute highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:hn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture(u_image,coord).r/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec2 u_colorization_scale;uniform highp vec4 u_colorization_mix;highp vec4 colormap (highp float value) {highp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;highp vec2 coords=vec2(scaled_value,0.5);return texture2D(u_color_ramp,coords);}\n#endif\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);vec4 color;\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);color=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;if (color.a > 0.0) {color.rgb/=color.a;}\n#else\nif (color0.a > 0.0) {color0.rgb/=color0.a;}if (color1.a > 0.0) {color1.rgb/=color1.a;}color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_ground(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;attribute vec2 a_texture_pos;\n#endif\nvarying vec2 v_pos0;varying vec2 v_pos1;void main() {vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),symbolIcon:hn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nvarying float v_fade_opacity;varying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture2D(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nattribute vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\nvarying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:hn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:hn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture2D(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:hn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:hn('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',z1),skyboxGradient:hn('#include "_prelude_fog.fragment.glsl"\nvarying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',z1),skyboxCapture:hn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:hn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\ngl_FragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\n#else\ngl_FragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);gl_FragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\ngl_FragColor=vec4(c*t,t);\n#endif\n}',"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;varying highp vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\nconst float M_PI=3.141592653589793;\n#define saturate(_x) clamp(_x,0.,1.)\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(M_PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/M_PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\ngl_FragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nattribute vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\nvarying vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\nvoid main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:hn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}","attribute vec3 a_pos_3f;uniform mat4 u_matrix;varying highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:hn("varying highp vec2 v_uv;varying mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;gl_FragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;varying highp vec2 v_uv;varying mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Mm(t,e){const n=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const a=i.split(" ");for(const l of a)e.includes(l)||e.push(l)}}function hn(t,e){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let a=e.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);a&&(a=a.filter((p,g)=>a.indexOf(p)===g));const l={},u=[],d=[];t=t.replace(n,(p,g)=>(d.push(g),"")),e=e.replace(n,(p,g)=>(u.push(g),""));let f=[...B1];Mm(t,f),Mm(e,f);for(const p of[...u,...d])Qd[p]||console.error(`Undefined include: ${p}`),R0[p]||(R0[p]=[],Mm(Qd[p],R0[p])),f=[...f,...R0[p]];return{fragmentSource:t=t.replace(i,(p,g,_,x,v)=>(l[v]=!0,"define"===g?`\n#ifndef HAS_UNIFORM_u_${v}\nvarying ${_} ${x} ${v};\n#else\nuniform ${_} ${x} u_${v};\n#endif\n`:"initialize"===g?`\n#ifdef HAS_UNIFORM_u_${v}\n    ${_} ${x} ${v} = u_${v};\n#endif\n`:"define-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\n    varying ${_} ${x} ${v};\n#endif\n`:"initialize-attribute"===g?"":void 0)),vertexSource:e=e.replace(i,(p,g,_,x,v)=>{const b="float"===x?"vec2":x,E=v.match(/color/)?"color":b;return"define-attribute-vertex-shader-only"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\nattribute ${_} ${x} a_${v};\n#endif\n`:l[v]?"define"===g?`\n#ifndef HAS_UNIFORM_u_${v}\nuniform lowp float u_${v}_t;\nattribute ${_} ${b} a_${v};\nvarying ${_} ${x} ${v};\n#else\nuniform ${_} ${x} u_${v};\n#endif\n`:"initialize"===g?"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${v}\n    ${v} = a_${v};\n#else\n    ${_} ${x} ${v} = u_${v};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${v}\n    ${v} = unpack_mix_${E}(a_${v}, u_${v}_t);\n#else\n    ${_} ${x} ${v} = u_${v};\n#endif\n`:"define-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\n    attribute ${_} ${x} a_${v};\n    varying ${_} ${x} ${v};\n#endif\n`:"initialize-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\n    ${v} = a_${v};\n#endif\n`:void 0:"define"===g?`\n#ifndef HAS_UNIFORM_u_${v}\nuniform lowp float u_${v}_t;\nattribute ${_} ${b} a_${v};\n#else\nuniform ${_} ${x} u_${v};\n#endif\n`:"define-instanced"===g?"mat4"===E?`\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_${v}0;\nattribute vec4 a_${v}1;\nattribute vec4 a_${v}2;\nattribute vec4 a_${v}3;\n#else\nuniform ${_} ${x} u_${v};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nattribute ${_} ${b} a_${v};\n#else\nuniform ${_} ${x} u_${v};\n#endif\n`:"initialize-attribute-custom"===g?`\n#ifdef HAS_ATTRIBUTE_a_${v}\n    ${_} ${x} ${v} = a_${v};\n#endif\n`:"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${v}\n    ${_} ${x} ${v} = a_${v};\n#else\n    ${_} ${x} ${v} = u_${v};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${v}\n    ${_} ${x} ${v} = unpack_mix_${E}(a_${v}, u_${v}_t);\n#else\n    ${_} ${x} ${v} = u_${v};\n#endif\n`}),staticAttributes:a,usedDefines:f,vertexIncludes:u,fragmentIncludes:d}}class yT{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,n,i,a,l,u,d,f){this.context=e;let p=this.boundPaintVertexBuffers.length!==a.length;for(let _=0;!p&&_<a.length;_++)this.boundPaintVertexBuffers[_]!==a[_]&&(p=!0);let g=this.boundDynamicVertexBuffers.length!==d.length;for(let _=0;!g&&_<d.length;_++)this.boundDynamicVertexBuffers[_]!==d[_]&&(g=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==i||p||g||this.boundIndexBuffer!==l||this.boundVertexOffset!==u)this.freshBind(n,i,a,l,u,d,f);else{e.bindVertexArrayOES.set(this.vao);for(const _ of d)_&&(_.bind(),f&&_.instanceCount&&_.setVertexAttribDivisor(e.gl,n,f));l&&l.dynamicDraw&&l.bind()}}freshBind(e,n,i,a,l,u,d){const f=e.numAttributes,p=this.context,g=p.gl;this.vao&&this.destroy(),this.vao=p.gl.createVertexArray(),p.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=a,this.boundVertexOffset=l,this.boundDynamicVertexBuffers=u,n.enableAttributes(g,e),n.bind(),n.setVertexAttribPointers(g,e,l);for(const _ of i)_.enableAttributes(g,e),_.bind(),_.setVertexAttribPointers(g,e,l);for(const _ of u)_&&(_.enableAttributes(g,e),_.bind(),_.setVertexAttribPointers(g,e,l),d&&_.instanceCount&&_.setVertexAttribDivisor(g,e,d));a&&a.bind(),p.currentNumAttributes=f}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function nA(t,e){const n=Math.pow(2,e.canonical.z),i=e.canonical.y;return[new Gt(0,i/n).toLngLat().lat,new Gt(0,(i+1)/n).toLngLat().lat]}function rA(t,e,n,i,a,l,u){const d=t.context,f=d.gl,p=n.hillshadeFBO;if(!p)return;t.prepareDrawTile();const g=t.isTileAffectedByFog(e),_=t.getOrCreateProgram("hillshade",{overrideFog:g});d.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,p.colorAttachment.get());const x=((C,T,D,A)=>{const P=D.paint.get("hillshade-shadow-color"),I=D.paint.get("hillshade-highlight-color"),R=D.paint.get("hillshade-accent-color"),k=D.paint.get("hillshade-emissive-strength");let L=Et(D.paint.get("hillshade-illumination-direction"));if("viewport"===D.paint.get("hillshade-illumination-anchor"))L-=C.transform.angle;else if(C.style&&C.style.enable3dLights()&&C.style.directionalLight){const z=C.style.directionalLight.properties.get("direction");L=Et(Ye(z.x,z.y,z.z)[1])}const N=!C.options.moving;return{u_matrix:A||C.transform.calculateProjMatrix(T.tileID.toUnwrapped(),N),u_image:0,u_latrange:nA(0,T.tileID),u_light:[D.paint.get("hillshade-exaggeration"),L],u_shadow:P,u_highlight:I,u_emissive_strength:k,u_accent:R}})(t,n,i,t.terrain?e.projMatrix:null);t.uploadCommonUniforms(d,_,e.toUnwrapped());const{tileBoundsBuffer:v,tileBoundsIndexBuffer:b,tileBoundsSegments:E}=t.getTileBoundsBuffers(n);_.draw(t,f.TRIANGLES,a,l,u,Ft.disabled,x,i.id,v,b,E)}function xT(t,e,n){if(!e.needsDEMTextureUpload)return;const i=t.context,a=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(n.stride);const l=n.getPixels();e.demTexture?e.demTexture.update(l,{premultiply:!1}):e.demTexture=new kr(i,l,t.terrainUseFloatDEM()?a.R32F:a.RGBA,{premultiply:!1}),e.needsDEMTextureUpload=!1}function iA(t,e,n){const i=t.context,a=i.gl;if(!e.dem)return;const l=e.dem;if(i.activeTexture.set(a.TEXTURE1),xT(t,e,l),!e.demTexture)return;e.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);const u=l.dim;i.activeTexture.set(a.TEXTURE0);let d=e.hillshadeFBO;if(!d){const x=new kr(i,{width:u,height:u,data:null},a.RGBA);x.bind(a.LINEAR,a.CLAMP_TO_EDGE),d=e.hillshadeFBO=i.createFramebuffer(u,u,!0,"renderbuffer"),d.colorAttachment.set(x.texture)}i.bindFramebuffer.set(d.framebuffer),i.viewport.set([0,0,u,u]);const{tileBoundsBuffer:f,tileBoundsIndexBuffer:p,tileBoundsSegments:g}=t.getMercatorTileBoundsBuffers(),_=[];t.terrainUseFloatDEM()&&_.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:_}).draw(t,a.TRIANGLES,pt.disabled,St.disabled,Jt.unblended,Ft.disabled,((x,v)=>{const b=v.stride,E=ne.create();return ne.ortho(E,0,le,-le,0,0,1),ne.translate(E,E,[0,-le,0]),{u_matrix:E,u_image:1,u_dimension:[b,b],u_zoom:x.overscaledZ,u_unpack:v.unpackVector}})(e.tileID,l),n.id,f,p,g),e.needsHillshadePrepare=!1}const U1=t=>({u_matrix:new wt(t),u_image0:new Lt(t),u_skirt_height:new ve(t),u_ground_shadow_factor:new st(t)}),oA=(t,e,n)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:n}),$1=(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:a,u_merc_center:l,u_image0:0,u_frustum_tl:u,u_frustum_tr:d,u_frustum_br:f,u_frustum_bl:p,u_globe_pos:g,u_globe_radius:_,u_viewport:x,u_grid_matrix:b?Float32Array.from(b):new Float32Array(9),u_skirt_height:v}),ef=(t,e)=>{if(e>0&&t.terrain&&K("Cutoff is currently disabled on terrain"),e<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=t.transform,i=Math.max(Math.abs(n._zoom-(t.minCutoffZoom-1)),1),a=n.isLODDisabled(!1)?Ya(60,45,n.pitch):Ya(30,15,n.pitch),l=n._farZ-n._nearZ,u=e*n.height,d=((1-(f=a))*(.75*n.cameraToCenterDistance)+f*(n._farZ+u))*i;var f;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(d-n._nearZ)/l,(d-u-n._nearZ)/l]}}};function vT(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const Tm=new class{constructor(){this.operations={}}newMorphing(t,e,n,i,a){if(t in this.operations){const l=this.operations[t];l.to.tileID.key!==n.tileID.key&&(l.queued=n)}else this.operations[t]={startTime:i,phase:0,duration:a,from:e,to:n,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const n=this.operations[e];for(n.phase=(t-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},bT={0:null,1:"TERRAIN_VERTEX_MORPHING"};function wT(t,e,n){if(0===e)return 0;const i=e<1&&514===n?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*i}function sA(t,e){const n=1<<t.z;return!e&&(0===t.x||t.x===n-1)||0===t.y||t.y===n-1}const H1=t=>({u_matrix:t});function ET(t,e,n,i,a){if(a>0){const l=Fe.now(),u=(l-t.timeAdded)/a,d=e?(l-e.timeAdded)/a:-1,f=n.getSource(),p=i.coveringZoomLevel({tileSize:f.tileSize,roundZoom:f.roundZoom}),g=!e||Math.abs(e.tileID.overscaledZ-p)>Math.abs(t.tileID.overscaledZ-p),_=g&&t.refreshedUponExpiration?1:We(g?u:1-d,0,1);return t.refreshedUponExpiration&&u>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-_}:{opacity:_,mix:0}}return{opacity:1,mix:0}}class aA extends fs{constructor(e){const n={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new dm(Yd(),null),a=S1("mock-dem",n,i,e.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,n){e.state="loaded",n(null)}}class lA extends fs{constructor(e){const n=S1("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new dm(Yd(),null),e.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,n,i){if(e.freezeTileCoverage)return;this.transform=e;const a=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((l,u)=>{if(l[u.key]="",!this._tiles[u.key]){const d=new ds(u,this._source.tileSize*u.overscaleFactor(),e.tileZoom);d.state="loaded",this._tiles[u.key]=d}return l},{});for(const l in this._tiles)l in a||(this.freeFBO(l),this._tiles[l].unloadVectorData(),delete this._tiles[l])}freeFBO(e){const n=this.proxyCachedFBO[e];if(void 0!==n){const i=Object.values(n);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class MT extends Zt{constructor(e,n,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=n,this.projMatrix=i}}class cA extends Ql{constructor(e,n){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,a,l]=function(f){const p=new Eo,g=new Rr,_=131;p.reserve(17161),g.reserve(33800);const x=le/128,v=le+x/2,b=v+x;for(let C=-x;C<b;C+=x)for(let T=-x;T<b;T+=x){const D=T<0||T>v||C<0||C>v?24575:0,A=We(Math.round(T),0,le),P=We(Math.round(C),0,le);p.emplaceBack(A+D,P)}const E=(C,T)=>{const D=T*_+C;g.emplaceBack(D+1,D,D+_),g.emplaceBack(D+_,D+_+1,D+1)};for(let C=1;C<129;C++)for(let T=1;T<129;T++)E(T,C);return[0,129].forEach(C=>{for(let T=0;T<130;T++)E(T,C),E(C,T)}),[p,g,32768]}(),u=e.context;this.gridBuffer=u.createVertexBuffer(i,Gl.members),this.gridIndexBuffer=u.createIndexBuffer(a),this.gridSegments=bn.simpleSegment(0,0,i.length,a.length),this.gridNoSkirtSegments=bn.simpleSegment(0,0,i.length,l),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new lA(n.map),this.orthoMatrix=ne.create(),ne.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,le,0,le,0,1);const d=u.gl;this._overlapStencilMode=new St({func:d.GEQUAL,mask:255},0,255,d.KEEP,d.KEEP,d.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new aA(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,n,i){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const a=e.terrain.properties,l=0===e.terrain.drapeRenderMode,u=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=Fe.now();const d=e.terrain&&e.terrain.scope,f=a.get("source"),p=l?this._mockSourceCache:e.getSourceCache(f,d);if(!p)return void K(`Couldn't find terrain source "${f}".`);if(this.sourceCache=p,this._exaggeration=u?this.calculateExaggeration(n):a.get("exaggeration"),!n.projection.requiresDraping&&u&&0===this._exaggeration)return void this._disable();this.enabled=!0;const g=()=>{this.sourceCache.used&&K(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const _=this.getScaledDemTileSize();this.sourceCache.update(n,_,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(e){const n=this._previousCameraAltitude,i=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=i;const a=null!=n?i-n:Number.MAX_VALUE;if(Math.abs(a)<2)return this._exaggeration;const l=e.zoom,u=this._style.terrain;if(!this._previousUpdateTimestamp)return u.getExaggeration(l);let d=l-this._previousZoom;const f=this._previousUpdateTimestamp;let p=l;null!=this._evaluationZoom&&(p=this._evaluationZoom,Math.abs(l-p)>.5&&(d=.5*(l-p+d)),d*a<0&&(p+=d)),this._evaluationZoom=p;const g=u.getExaggeration(p),_=g===u.getExaggeration(Math.max(0,p-.1));if(_&&Math.abs(g-this._exaggeration)<.01)return g;let x=Math.min(.1,.00375*(this._updateTimestamp-f));return(_||g<.1||Math.abs(d)<1e-4)&&(x=Math.min(.2,4*x)),ut(this._exaggeration,g,x)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(Gt.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const a=this.proxyCoords=n.getIds().map(f=>{const p=n.getTileByID(f).tileID;return p.projMatrix=i.calculateProjMatrix(p.toUnwrapped()),p});!function(f,p){const g=p.transform.pointCoordinate(p.transform.getCameraPoint()),_=new ee(g.x,g.y);f.sort((x,v)=>{if(v.overscaledZ-x.overscaledZ)return v.overscaledZ-x.overscaledZ;const b=new ee(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),E=new ee(v.canonical.x+(1<<v.canonical.z)*v.wrap,v.canonical.y),C=_.mult(1<<x.canonical.z);return C.x-=.5,C.y-=.5,C.distSqr(b)-C.distSqr(E)})}(a,this.painter);const l=this.proxyToSource||{};this.proxyToSource={},a.forEach(f=>{this.proxyToSource[f.key]={}}),this.terrainTileForTile={};const u=this._style._mergedSourceCaches;for(const f in u){const p=u[f];if(!p.used||(p!==this.sourceCache&&this.resetTileLookupCache(p.id),this._setupProxiedCoordsForOrtho(p,e[f],l),p.usedForTerrain))continue;const g=e[f];p.getSource().reparseOverscaled&&this._assignTerrainTiles(g)}this.proxiedCoords[n.id]=a.map(f=>new MT(f,f.key,this.orthoMatrix)),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(l),this.renderingToTexture=!1;const d={};this._visibleDemTiles=[];for(const f of this.proxyCoords){const p=this.terrainTileForTile[f.key];if(!p)continue;const g=p.tileID.key;g in d||(this._visibleDemTiles.push(p),d[g]=g)}}_assignTerrainTiles(e){this._initializing||e.forEach(n=>{if(this.terrainTileForTile[n.key])return;const i=this._findTileCoveringTileID(n,this.sourceCache);i&&(this.terrainTileForTile[n.key]=i)})}_prepareDEMTextures(){const e=this.painter.context,n=e.gl;for(const i in this.terrainTileForTile){const a=this.terrainTileForTile[i],l=a.dem;!l||a.demTexture&&!a.needsDEMTextureUpload||(e.activeTexture.set(n.TEXTURE1),xT(this.painter,a,l))}}_prepareDemTileUniforms(e,n,i,a){if(!n||null==n.demTexture)return!1;const l=e.tileID.canonical,u=Math.pow(2,n.tileID.canonical.z-l.z),d=a||"";return i[`u_dem_tl${d}`]=[l.x*u%1,l.y*u%1],i[`u_dem_scale${d}`]=u,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,n=e.gl;if(!this._emptyDepthBufferTexture){const i=new ur({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new kr(e,i,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const n=this._visibleDemTiles.reduce((i,a)=>{if(!a.dem)return i;const l=a.dem.tree.minimums[0];return l>0&&e++,i+l},0);return e?n/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,n=e.gl;e.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),[a,l]=(()=>{if(this.painter.terrainUseFloatDEM()){const d=new Dp({width:1,height:1},new Float32Array([i]));return[n.R32F,d]}{const d=new ur({width:1,height:1},new Uint8Array(na.pack(i,this.sourceCache.getSource().encoding)));return[n.RGBA,d]}})();this._emptyDEMTextureDirty=!1;let u=this._emptyDEMTexture;return u?u.update(l,{premultiply:!1}):u=this._emptyDEMTexture=new kr(e,l,a,{premultiply:!1}),u}setupElevationDraw(e,n,i){const a=this.painter.context,l=a.gl,u=(d=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:na.getUnpackVector(d),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var d;u.u_exaggeration=this.exaggeration();let f=null,p=null,g=1;if(i&&i.morphing&&this._useVertexMorphing){const v=i.morphing.srcDemTile,b=i.morphing.dstDemTile;g=i.morphing.phase,v&&b&&(this._prepareDemTileUniforms(e,v,u,"_prev")&&(p=v),this._prepareDemTileUniforms(e,b,u)&&(f=b))}const _=v=>v&&v.demTexture&&this.painter.terrainUseFloatDEM()?l.LINEAR:l.NEAREST,x=v=>{u.u_dem_size=1===v.size[0]?1:v.size[0]-2};if(p&&f)a.activeTexture.set(l.TEXTURE2),f.demTexture.bind(_(f),l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE4),p.demTexture.bind(_(p),l.CLAMP_TO_EDGE),f.demTexture&&x(f.demTexture),u.u_dem_lerp=g;else{f=this.terrainTileForTile[e.tileID.key],a.activeTexture.set(l.TEXTURE2);const v=this._prepareDemTileUniforms(e,f,u)?f.demTexture:this.emptyDEMTexture;v.bind(_(f),l.CLAMP_TO_EDGE),x(v)}if(a.activeTexture.set(l.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),this._depthFBO&&(u.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),u.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&f){const v=(1<<f.tileID.canonical.z)*vn(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;u.u_meter_to_dem=v}if(i&&i.labelPlaneMatrixInv&&(u.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(a,u),"globe"===this.painter.transform.projection.name){const v=this.globeUniformValues(this.painter.transform,e.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(a,v)}}globeUniformValues(e,n,i){const a=e.projection;return{u_tile_tl_up:a.upVector(n,0,0),u_tile_tr_up:a.upVector(n,le,0),u_tile_br_up:a.upVector(n,le,le),u_tile_bl_up:a.upVector(n,0,le),u_tile_up_scale:i?Vx(1):a.upVectorScale(n,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const n=this.painter,i=this.painter.context;0!==e.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(a,l,u,d,f){if("globe"===a.transform.projection.name)!function(p,g,_,x,v){const b=p.context,E=b.gl;let C,T;const D=p.transform,A=sS(p,b,D),P=(H,V)=>{if(T===V)return;const Z=[bT[V],"PROJECTION_GLOBE_VIEW"];A&&Z.push("CUSTOM_ANTIALIASING");const Q=p.isTileAffectedByFog(H);C=p.getOrCreateProgram("globeRaster",{defines:Z,overrideFog:Q}),T=V},I=p.colorModeForRenderPass(),R=new pt(E.LEQUAL,pt.ReadWrite,p.depthRangeFor3D);Tm.update(v);const k=function(H){const V=H.pixelsPerMeter,Z=V/vn(1,H.center.lat),Q=ne.identity(new Float64Array(16));return ne.translate(Q,Q,[H.point.x,H.point.y,0]),ne.scale(Q,Q,[Z,Z,V]),Float32Array.from(Q)}(D),L=[Li(D.center.lng),Gi(D.center.lat)],N=p.globeSharedBuffers,z=[D.width*Fe.devicePixelRatio,D.height*Fe.devicePixelRatio],j=Float32Array.from(D.globeMatrix),B={useDenormalizedUpVectorScale:!0};{const H=p.transform,V=wT(H.zoom,g.exaggeration(),g.sourceCache._source.tileSize);T=-1;const Z=E.TRIANGLES;for(const Q of x){const te=_.getTile(Q),W=St.disabled,X=g.prevTerrainTileForTile[Q.key],re=g.terrainTileForTile[Q.key];vT(X,re)&&Tm.newMorphing(Q.key,X,re,v,250),b.activeTexture.set(E.TEXTURE0),te.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);const oe=Tm.getMorphValuesForProxy(Q.key),ce=oe?1:0;oe&&Ac(B,{morphing:{srcDemTile:oe.from,dstDemTile:oe.to,phase:Ec(oe.phase)}});const de=yp(Q.canonical),ge=aS(de.getCenter().lat),ae=$2(Q.canonical,de,ge,H.worldSize/H._pixelsPerMercatorPixel),ue=as(uo(Q.canonical)),Se=$1(H.projMatrix,j,k,ue,ki(H.zoom),L,H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.globeCenterInViewSpace,H.globeRadius,z,V,ae);if(P(Q,ce),C&&(g.setupElevationDraw(te,C,B),p.uploadCommonUniforms(b,C,Q.toUnwrapped()),N)){const[Ne,ze,Ve]=N.getGridBuffers(ge,0!==V);C.draw(p,Z,R,W,I,Ft.backCCW,Se,"globe_raster",Ne,ze,Ve)}}}if(N&&(p.renderDefaultNorthPole||p.renderDefaultSouthPole)){const H=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];A&&H.push("CUSTOM_ANTIALIASING"),C=p.getOrCreateProgram("globeRaster",{defines:H});for(const V of x){const{x:Z,y:Q,z:te}=V.canonical,W=0===Q,X=Q===(1<<te)-1,[re,oe,ce,de]=N.getPoleBuffers(te,!1);if(de&&(W||X)){const ge=_.getTile(V);b.activeTexture.set(E.TEXTURE0),ge.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);let ae=oS(te,Z,D);const ue=as(uo(V.canonical)),Se=(Ne,ze)=>Ne.draw(p,E.TRIANGLES,R,St.disabled,I,Ft.disabled,$1(D.projMatrix,ae,ae,ue,0,L,D.frustumCorners.TL,D.frustumCorners.TR,D.frustumCorners.BR,D.frustumCorners.BL,D.globeCenterInViewSpace,D.globeRadius,z,0),"globe_pole_raster",ze,ce,de);g.setupElevationDraw(ge,C,B),p.uploadCommonUniforms(b,C,V.toUnwrapped()),W&&p.renderDefaultNorthPole&&Se(C,re),X&&p.renderDefaultSouthPole&&(ae=ne.scale(ne.create(),ae,[1,-1,1]),Se(C,oe))}}}}(a,l,u,d,f);else{const p=a.context,g=p.gl;let _,x;const v=a.shadowRenderer,b=ef(a,a.longestCutoffRange),E=I=>{if(x===I)return;const R=[];R.push(bT[I]),b.shouldRenderCutoff&&R.push("RENDER_CUTOFF"),_=a.getOrCreateProgram("terrainRaster",{defines:R}),x=I},C=a.colorModeForRenderPass(),T=new pt(g.LEQUAL,pt.ReadWrite,a.depthRangeFor3D);Tm.update(f);const D=a.transform,A=wT(D.zoom,l.exaggeration(),l.sourceCache._source.tileSize);let P=[0,0,0];if(v){const I=a.style.directionalLight,R=a.style.ambientLight;I&&R&&(P=sb(I,R))}{x=-1;const I=g.TRIANGLES,[R,k]=[l.gridIndexBuffer,l.gridSegments];for(const L of d){const N=u.getTile(L),z=St.disabled,j=l.prevTerrainTileForTile[L.key],B=l.terrainTileForTile[L.key];vT(j,B)&&Tm.newMorphing(L.key,j,B,f,250),p.activeTexture.set(g.TEXTURE0),N.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const H=Tm.getMorphValuesForProxy(L.key),V=H?1:0;let Z;H&&(Z={morphing:{srcDemTile:H.from,dstDemTile:H.to,phase:Ec(H.phase)}});const Q=oA(L.projMatrix,sA(L.canonical,D.renderWorldCopies)?A/10:A,P);if(E(V),!_)continue;l.setupElevationDraw(N,_,Z);const te=L.toUnwrapped();v&&v.setupShadows(te,_),a.uploadCommonUniforms(p,_,te,null,b),_.draw(a,I,T,z,C,Ft.backCCW,Q,"terrain_raster",l.gridBuffer,R,k)}}}}(n,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,a=this.proxySourceCache,l=this.proxiedCoords[a.id],u=this._drapedRenderBatches.shift(),d=n.style.order,f=[];let p=0;for(const g of l){const _=a.getTileByID(g.proxyTileKey),x=a.proxyCachedFBO[g.key]?a.proxyCachedFBO[g.key][e]:void 0,v=void 0!==x?a.renderCache[x]:this.pool[p++],b=void 0!==x;if(_.texture=v.tex,b&&!v.dirty){f.push(_.tileID);continue}let E;i.bindFramebuffer.set(v.fb.framebuffer),this.renderedToTile=!1,v.dirty&&(i.clear({color:At.transparent,stencil:0}),v.dirty=!1);for(let C=u.start;C<=u.end;++C){const T=n.style._mergedLayers[d[C]];if(T.isHidden(n.transform.zoom))continue;const D=n.style.getLayerSourceCache(T),A=D?this.proxyToSource[g.key][D.id]:[g];if(!A)continue;const P=A;i.viewport.set([0,0,v.fb.width,v.fb.height]),E!==(D?D.id:null)&&(this._setupStencil(v,A,T,D),E=D?D.id:null),n.renderLayer(n,D,T,P)}if(0===this._drapedRenderBatches.length)for(const C of this._pendingGroundEffectLayers){const T=n.style._mergedLayers[d[C]];if(T.isHidden(n.transform.zoom))continue;const D=n.style.getLayerSourceCache(T),A=D?this.proxyToSource[g.key][D.id]:[g];if(!A)continue;const P=A;i.viewport.set([0,0,v.fb.width,v.fb.height]),E!==(D?D.id:null)&&(this._setupStencil(v,A,T,D),E=D?D.id:null),n.renderLayer(n,D,T,P)}this.renderedToTile?(v.dirty=!0,f.push(_.tileID)):b||--p,5===p&&(p=0,this.renderToBackBuffer(f))}return this.renderToBackBuffer(f),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),u.end+1}postRender(){}isLayerOrderingCorrect(e){const n=e.order.length;let i=-1,a=n;for(let l=0;l<n;++l)this._style.isLayerDraped(e._mergedLayers[e.order[l]])?i=Math.max(i,l):a=Math.min(a,l);return a>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{e=Math.min(e,n.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,n,i){if(!this._visibleDemTiles)return null;const a=this._visibleDemTiles.filter(l=>l.dem).map(l=>{const u=l.tileID,d=1<<u.overscaledZ,{x:f,y:p}=u.canonical,g=f/d,_=(f+1)/d,x=p/d,v=(p+1)/d;return{minx:g,miny:x,maxx:_,maxy:v,t:l.dem.tree.raycastRoot(g,x,_,v,e,n,i),tile:l}});a.sort((l,u)=>(null!==l.t?l.t:Number.MAX_VALUE)-(null!==u.t?u.t:Number.MAX_VALUE));for(const l of a){if(null==l.t)return null;const u=l.tile.dem.tree.raycast(l.minx,l.miny,l.maxx,l.maxy,e,n,i);if(null!=u)return u}return null}_createFBO(){const e=this.painter.context,n=e.gl,i=this.drapeBufferSize;e.activeTexture.set(n.TEXTURE0);const a=new kr(e,{width:i[0],height:i[1],data:null},n.RGBA);a.bind(n.LINEAR,n.CLAMP_TO_EDGE);const l=e.createFramebuffer(i[0],i[1],!0,null);return l.colorAttachment.set(a.texture),l.depthAttachment=new nM(e,l.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,l.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):l.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:l,tex:a,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const n=this._style._mergedLayers[e],i=n.isHidden(this.painter.transform.zoom);return"custom"===n.type?!i&&n.shouldRedrape():!i&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let e=!1;for(const i of this._style.getSources())if(i instanceof pm){e=!0;break}if(!e)return;const n={};for(let i=0;i<this._style.order.length;++i){const a=this._style._mergedLayers[this._style.order[i]],l=this._style.getLayerSourceCache(a);if(l&&!n[l.id]&&!a.isHidden(this.painter.transform.zoom)&&"line"===a.type&&a.widthExpression()instanceof jl){n[l.id]=!0;for(const u of this.proxyCoords){const d=this.proxyToSource[u.key][l.id];if(d)for(const f of d)this._clearRenderCacheForTile(l.id,f)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof su){e=!0;break}if(!e)return;const n={};for(let i=0;i<this._style.order.length;++i){const a=this._style._mergedLayers[this._style.order[i]],l=this._style.getLayerSourceCache(a);if(!l||n[l.id]||a.isHidden(this.painter.transform.zoom)||"raster"!==a.type)continue;const u=a.paint.get("raster-fade-duration");for(const d of this.proxyCoords){const f=this.proxyToSource[d.key][l.id];if(f)for(const p of f){const g=ET(l.getTile(p),l.findLoadedParent(p,0),l,this.painter.transform,u);(1!==g.opacity||0!==g.mix)&&this._clearRenderCacheForTile(l.id,p)}}}}_setupDrapedRenderBatches(){const e=this._style.order,n=e.length;if(0===n)return;const i=[];this._pendingGroundEffectLayers=[];let a,l=0,u=this._style._mergedLayers[e[l]];for(;!this._style.isLayerDraped(u)&&u.isHidden(this.painter.transform.zoom)&&++l<n;)u=this._style._mergedLayers[e[l]];for(;l<n;++l){const d=this._style._mergedLayers[e[l]];d.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(d)?void 0===a&&(a=l):("fill-extrusion"===d.type&&this._pendingGroundEffectLayers.push(l),void 0!==a&&(i.push({start:a,end:l-1}),a=void 0)))}if(void 0!==a&&i.push({start:a,end:l-1}),0!==i.length){const d=i[i.length-1];this._pendingGroundEffectLayers.every(p=>p>d.end)||K("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(e){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const u=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let d=0;d<u.length;++d){const f=Object.values(u[d]);n.renderCachePool.push(...f)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,a=this._tilesDirty;for(let u=i.length-1;u>=0;u--){const d=i[u];if(n.getTileByID(d.key),void 0!==n.proxyCachedFBO[d.key]){const f=e[d.key],p=this.proxyToSource[d.key];let g=0;for(const _ in p){const x=p[_],v=f[_];if(!v||v.length!==x.length||x.some((b,E)=>b!==v[E]||a[_]&&a[_].hasOwnProperty(b.key))){g=-1;break}++g}for(const _ in n.proxyCachedFBO[d.key])n.renderCache[n.proxyCachedFBO[d.key][_]].dirty=g<0||g!==Object.values(f).length}}const l=[...this._drapedRenderBatches];l.sort((u,d)=>d.end-d.start-(u.end-u.start));for(const u of l)for(const d of i){if(n.proxyCachedFBO[d.key])continue;let f=n.renderCachePool.pop();void 0===f&&n.renderCache.length<50&&(f=n.renderCache.length,n.renderCache.push(this._createFBO())),void 0!==f&&(n.proxyCachedFBO[d.key]={},n.proxyCachedFBO[d.key][u.start]=f,n.renderCache[f].dirty=!0)}this._tilesDirty={}}_setupStencil(e,n,i,a){if(!a||!this._sourceTilesOverlap[a.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const l=this.painter.context,u=l.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let d;if(i.isTileClipped())d=n.length,this._overlapStencilMode.test={func:u.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);d=1,this._overlapStencilMode.test={func:u.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+d>255&&(l.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=d,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):St.disabled}_renderTileClippingMasks(e,n){const i=this.painter,a=this.painter.context,l=a.gl;i._tileClippingMaskIDs={},a.setColorMode(Jt.disabled),a.setDepthMode(pt.disabled);const u=i.getOrCreateProgram("clippingMask");for(const d of e){const f=i._tileClippingMaskIDs[d.key]=--n;u.draw(i,l.TRIANGLES,pt.disabled,new St({func:l.ALWAYS,mask:0},f,255,l.KEEP,l.KEEP,l.REPLACE),Jt.disabled,Ft.disabled,H1(d.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){const n=this.painter.transform;if(e.x<0||e.x>n.width||e.y<0||e.y>n.height)return null;const i=[e.x,e.y,1,1];xn.transformMat4(i,i,n.pixelMatrixInverse),xn.scale(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const a=n._camera.position,l=vn(1,n.center.lat),u=[a[0],a[1],a[2]/l,0],d=G.subtract([],i.slice(0,3),u);G.normalize(d,d);const f=this.raycast(u,d,this._exaggeration);return null!==f&&f?(G.scaleAndAdd(u,u,d,f),u[3]=u[2],u[2]*=l,u):null}drawDepth(){const e=this.painter,n=e.context,i=this.proxySourceCache,a=Math.ceil(e.width),l=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===a&&this._depthFBO.height===l||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const u=n.gl,d=n.createFramebuffer(a,l,!0,"renderbuffer");n.activeTexture.set(u.TEXTURE0);const f=new kr(n,{width:a,height:l,data:null},u.RGBA);f.bind(u.NEAREST,u.CLAMP_TO_EDGE),d.colorAttachment.set(f.texture);const p=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,a,l);d.depthAttachment.set(p),this._depthFBO=d,this._depthTexture=f}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,a,l]),function(u,d,f,p){if("globe"===u.transform.projection.name)return;const g=u.context,_=g.gl;g.clear({depth:1});const x=u.getOrCreateProgram("terrainDepth"),v=new pt(_.LESS,pt.ReadWrite,u.depthRangeFor3D);for(const b of p){const E=f.getTile(b),C=oA(b.projMatrix,0,[0,0,0]);d.setupElevationDraw(E,x),x.draw(u,_.TRIANGLES,v,St.disabled,Jt.unblended,Ft.backCCW,C,"terrain_depth",d.gridBuffer,d.gridIndexBuffer,d.gridNoSkirtSegments)}}(e,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,n,i){if(e.getSource()instanceof bl)return this._setupProxiedCoordsForImageSource(e,n,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const a=this.proxiedCoords[e.id]=[],l=this.proxyCoords;for(let d=0;d<l.length;d++){const f=l[d],p=this._findTileCoveringTileID(f,e);if(p){const g=this._createProxiedId(f,p,i[f.key]&&i[f.key][e.id]);a.push(g),this.proxyToSource[f.key][e.id]=[g]}}let u=!1;for(let d=0;d<n.length;d++){const f=e.getTile(n[d]);if(!f||!f.hasData())continue;const p=this._findTileCoveringTileID(f.tileID,this.proxySourceCache);if(p&&p.tileID.canonical.z!==f.tileID.canonical.z){const g=this.proxyToSource[p.tileID.key][e.id],_=this._createProxiedId(p.tileID,f,i[p.tileID.key]&&i[p.tileID.key][e.id]);g?g.splice(g.length-1,0,_):this.proxyToSource[p.tileID.key][e.id]=[_],a.push(_),u=!0}}this._sourceTilesOverlap[e.id]=u}_setupProxiedCoordsForImageSource(e,n,i){if(!e.getSource().loaded())return;const a=this.proxiedCoords[e.id]=[],l=this.proxyCoords,u=e.getSource(),d=u.tileID;if(!d)return;const f=new ee(d.x,d.y)._div(1<<d.z),p=u.coordinates.map(Gt.fromLngLat).reduce((_,x)=>(_.min.x=Math.min(_.min.x,x.x-f.x),_.min.y=Math.min(_.min.y,x.y-f.y),_.max.x=Math.max(_.max.x,x.x-f.x),_.max.y=Math.max(_.max.y,x.y-f.y),_),{min:new ee(Number.MAX_VALUE,Number.MAX_VALUE),max:new ee(-Number.MAX_VALUE,-Number.MAX_VALUE)}),g=(_,x)=>{const v=_.wrap+_.canonical.x/(1<<_.canonical.z),b=_.canonical.y/(1<<_.canonical.z),E=le/(1<<_.canonical.z),C=x.wrap+x.canonical.x/(1<<x.canonical.z),T=x.canonical.y/(1<<x.canonical.z);return v+E<C+p.min.x||v>C+p.max.x||b+E<T+p.min.y||b>T+p.max.y};for(let _=0;_<l.length;_++){const x=l[_];for(let v=0;v<n.length;v++){const b=e.getTile(n[v]);if(!b||!b.hasData()||g(x,b.tileID))continue;const E=this._createProxiedId(x,b,i[x.key]&&i[x.key][e.id]),C=this.proxyToSource[x.key][e.id];C?C.push(E):this.proxyToSource[x.key][e.id]=[E],a.push(E)}}}_createProxiedId(e,n,i){let a=this.orthoMatrix;if(i){const l=i.find(u=>u.key===n.tileID.key);if(l)return l}if(n.tileID.key!==e.key){const l=e.canonical.z-n.tileID.canonical.z;let u,d,f;a=ne.create();const p=n.tileID.wrap-e.wrap<<e.overscaledZ;l>0?(u=le>>l,d=u*((n.tileID.canonical.x<<l)-e.canonical.x+p),f=u*((n.tileID.canonical.y<<l)-e.canonical.y)):(u=le<<-l,d=le*(n.tileID.canonical.x-(e.canonical.x+p<<-l)),f=le*(n.tileID.canonical.y-(e.canonical.y<<-l))),ne.ortho(a,0,u,0,u,0,1),ne.translate(a,a,[d,f,0])}return new MT(n.tileID,e.key,a)}_findTileCoveringTileID(e,n){let i=n.getTile(e);if(i&&i.hasData())return i;const a=this._findCoveringTileCache[n.id],l=a[e.key];if(i=l?n.getTileByID(l):null,i&&i.hasData()||null===l)return i;let u=i?i.tileID:e,d=u.overscaledZ;const f=n.getSource().minzoom,p=[];if(!l){const _=n.getSource().maxzoom;if(e.canonical.z>=_){const x=e.canonical.z-_;n.getSource().reparseOverscaled?(d=Math.max(e.canonical.z+2,n.transform.tileZoom),u=new Zt(d,e.wrap,_,e.canonical.x>>x,e.canonical.y>>x)):0!==x&&(d=_,u=new Zt(d,e.wrap,_,e.canonical.x>>x,e.canonical.y>>x))}u.key!==e.key&&(p.push(u.key),i=n.getTile(u))}const g=_=>{p.forEach(x=>{a[x]=_}),p.length=0};for(d-=1;d>=f&&(!i||!i.hasData());d--){i&&g(i.tileID.key);const _=u.calculateScaledKey(d);if(i=n.getTileByID(_),i&&i.hasData())break;const x=a[_];if(null===x)break;void 0===x?p.push(_):i=n.getTileByID(x)}return g(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,n){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[n.key]=!0}}function uA(t,e,n){const i=function(d,f,p){const g=G.dot(f,d),_=G.dot(p,[.2126,.7152,.0722]),x=(b,E,C)=>(1-C)*b+C*E,v=x(1-.3*Math.min(_,1),1,Math.min(g+1,1));return x(.92,1,Math.asin(We(f[2],-1,1))/Math.PI+.5)*v}(t,[0,0,1],e),a=[0,0,0];G.scale(a,n.slice(0,3),i);const l=[0,0,0];G.scale(l,e.slice(0,3),t[2]);const u=[0,0,0];return G.add(u,a,l),Fn(u)}const hA=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dA=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class tf{static cacheKey(e,n,i,a){let l=`${n}${a?a.cacheKey:""}`;for(const u of i)e.usedDefines.includes(u)&&(l+=`/${u}`);return l}constructor(e,n,i,a,l,u){const d=e.gl;this.program=d.createProgram(),this.configuration=a,this.name=n,this.fixedDefines=[...u];const f=function(T){const D=[];for(let A=0;A<T.length;A++){if(null===T[A])continue;const P=T[A].split(" ");D.push(P.pop())}return D}(i.staticAttributes),p=a?a.getBinderAttributes():[],g=f.concat(p);let _=a?a.defines():[];_=_.concat(u.map(T=>`#define ${T}`));const x="#version 300 es\n";let v=x+_.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",O0,V1.fragmentSource).join("\n");for(const T of i.fragmentIncludes)v+=`\n${Qd[T]}`;v+=`\n${i.fragmentSource}`;let b=x+_.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",O0,V1.vertexSource).join("\n");for(const T of i.vertexIncludes)b+=`\n${Qd[T]}`;b+=`\n${i.vertexSource}`;const E=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);d.shaderSource(E,v),d.compileShader(E),d.attachShader(this.program,E);const C=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())this.failedToCreate=!0;else{d.shaderSource(C,b),d.compileShader(C),d.attachShader(this.program,C),this.attributes={},this.numAttributes=g.length;for(let T=0;T<this.numAttributes;T++)if(g[T]){const D=g[T].startsWith("a_")?g[T]:`a_${g[T]}`;d.bindAttribLocation(this.program,T,D),this.attributes[D]=T}d.linkProgram(this.program),d.deleteShader(C),d.deleteShader(E),this.fixedUniforms=l(e),this.binderUniforms=a?a.getUniforms(e):[],u.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new Lt(T=e),u_dem_prev:new Lt(T),u_dem_unpack:new rs(T),u_dem_tl:new Ut(T),u_dem_scale:new ve(T),u_dem_tl_prev:new Ut(T),u_dem_scale_prev:new ve(T),u_dem_size:new ve(T),u_dem_lerp:new ve(T),u_exaggeration:new ve(T),u_depth:new Lt(T),u_depth_size_inv:new Ut(T),u_meter_to_dem:new ve(T),u_label_plane_matrix_inv:new wt(T)}),u.includes("GLOBE")&&(this.globeUniforms=(T=>({u_tile_tl_up:new st(T),u_tile_tr_up:new st(T),u_tile_br_up:new st(T),u_tile_bl_up:new st(T),u_tile_up_scale:new ve(T)}))(e)),u.includes("FOG")&&(this.fogUniforms=(T=>({u_fog_matrix:new wt(T),u_fog_range:new Ut(T),u_fog_color:new rs(T),u_fog_horizon_blend:new ve(T),u_fog_vertical_limit:new Ut(T),u_fog_temporal_offset:new ve(T),u_frustum_tl:new st(T),u_frustum_tr:new st(T),u_frustum_br:new st(T),u_frustum_bl:new st(T),u_globe_pos:new st(T),u_globe_radius:new ve(T),u_globe_transition:new ve(T),u_is_globe:new Lt(T),u_viewport:new Ut(T)}))(e)),u.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(T=>({u_cutoff_params:new rs(T)}))(e)),u.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(T=>({u_lighting_ambient_color:new st(T),u_lighting_directional_dir:new st(T),u_lighting_directional_color:new st(T),u_ground_radiance:new st(T)}))(e)),u.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(T=>({u_light_matrix_0:new wt(T),u_light_matrix_1:new wt(T),u_fade_range:new Ut(T),u_shadow_normal_offset:new st(T),u_shadow_intensity:new ve(T),u_shadow_texel_size:new ve(T),u_shadow_map_resolution:new ve(T),u_shadow_direction:new st(T),u_shadow_bias:new st(T),u_shadowmap_0:new Lt(T),u_shadowmap_1:new Lt(T)}))(e))}var T}setTerrainUniformValues(e,n){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a]&&i[a].set(this.program,a,n[a])}}setGlobeUniformValues(e,n){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a]&&i[a].set(this.program,a,n[a])}}setFogUniformValues(e,n){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setCutoffUniformValues(e,n){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setLightsUniformValues(e,n){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setShadowUniformValues(e,n){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;e.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}_drawDebugWireframe(e,n,i,a,l,u,d,f,p,g){const _=e.options.wireframe;if(!1===_.terrain&&!1===_.layers2D&&!1===_.layers3D)return;const x=e.context;if(!(()=>!(!_.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!_.layers2D||e._terrain&&e._terrain.renderingToTexture||!hA.includes(this.name))||!(!_.layers3D||!dA.includes(this.name)))())return;const v=x.gl,b=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,l,x);if(!b)return;const E=[...this.fixedDefines];E.push("DEBUG_WIREFRAME");const C=e.getOrCreateProgram(this.name,{config:this.configuration,defines:E});x.program.set(C.program);const T=(P,I,R)=>{if(I[P]&&R[P])for(const k in I[P])R[P][k]&&R[P][k].set(R.program,k,I[P][k].current)};p&&p.setUniforms(C.program,x,C.binderUniforms,d,{zoom:f}),T("fixedUniforms",this,C),T("terrainUniforms",this,C),T("globeUniforms",this,C),T("fogUniforms",this,C),T("lightsUniforms",this,C),T("shadowUniforms",this,C),b.bind(),x.setColorMode(new Jt([v.ONE,v.ONE_MINUS_SRC_ALPHA,v.ZERO,v.ONE],At.transparent,[!0,!0,!0,!1])),x.setDepthMode(new pt(n.func===v.LESS?v.LEQUAL:n.func,pt.ReadOnly,n.range)),x.setStencilMode(St.disabled);const D=3*u.primitiveLength*2,A=3*u.primitiveOffset*2*2;g&&g>1?v.drawElementsInstanced(v.LINES,D,v.UNSIGNED_SHORT,A,g):v.drawElements(v.LINES,D,v.UNSIGNED_SHORT,A),l.bind(),x.program.set(this.program),x.setDepthMode(n),x.setStencilMode(i),x.setColorMode(a)}draw(e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C){const T=e.context,D=T.gl;if(this.failedToCreate)return;T.program.set(this.program),T.setDepthMode(i),T.setStencilMode(a),T.setColorMode(l),T.setCullFace(u);for(const I of Object.keys(this.fixedUniforms))this.fixedUniforms[I].set(this.program,I,d[I]);b&&b.setUniforms(this.program,T,this.binderUniforms,x,{zoom:v});const A={[D.LINES]:2,[D.TRIANGLES]:3,[D.LINE_STRIP]:1}[n],P=C&&C>0?1:void 0;for(const I of _.get()){const R=I.vaos||(I.vaos={});(R[f]||(R[f]=new yT)).bind(T,this,p,b?b.getPaintVertexBuffers():[],g,I.vertexOffset,E||[],P),C&&C>1?D.drawElementsInstanced(n,I.primitiveLength*A,D.UNSIGNED_SHORT,I.primitiveOffset*A*2,C):D.drawElements(n,I.primitiveLength*A,D.UNSIGNED_SHORT,I.primitiveOffset*A*2),n===D.TRIANGLES&&this._drawDebugWireframe(e,i,a,l,g,I,x,v,b,C)}}}function G1(t,e){const n=Math.pow(2,e.tileID.overscaledZ),i=e.tileSize*Math.pow(2,t.transform.tileZoom)/n,a=i*(e.tileID.canonical.x+e.tileID.wrap*n),l=i*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture.size,u_tile_units_to_pixels:1/th(e,1,t.transform.tileZoom),u_pixel_coord_upper:[a>>16,l>>16],u_pixel_coord_lower:[65535&a,65535&l]}}const TT=ne.create(),q1=(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b)=>{const E=e.style.light,C=E.properties.get("position"),T=[C.x,C.y,C.z],D=To.create();"viewport"===E.properties.get("anchor")&&(To.fromRotation(D,-e.transform.angle),G.transformMat3(T,T,D));const A=E.properties.get("color"),P=e.transform,I={u_matrix:t,u_lightpos:T,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:TT,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:l,u_flood_light_color:_,u_vertical_scale:x,u_flood_light_intensity:v,u_ground_shadow_factor:b};return"globe"===P.projection.name&&(I.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],I.u_zoom_transition=f,I.u_inv_rot_matrix=g,I.u_merc_center=p,I.u_up_dir=P.projection.upVector(new Qs(0,0,0),p[0]*le,p[1]*le),I.u_height_lift=d),I},CT=(t,e,n)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:n}),DT=(t,e,n,i,a,l,u,d,f,p,g,_,x,v)=>{const b=q1(t,e,n,i,a,l,u,f,p,g,_,x,v,1,[0,0,0]),E={u_height_factor:-Math.pow(2,u.overscaledZ)/d.tileSize/8};return qe(b,G1(e,d),E)},ST=(t,e)=>({u_matrix:t,u_emissive_strength:e}),IT=(t,e,n,i)=>qe(ST(t,e),G1(n,i)),TR=(t,e,n)=>({u_matrix:t,u_world:n,u_emissive_strength:e}),CR=(t,e,n,i,a)=>qe(IT(t,e,n,i),{u_world:a}),fA=(t,e,n,i)=>{const a=le/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.getCameraToCenterDistance(i),u_extrude_scale:[e.pixelsToGLUnits[0]/a,e.pixelsToGLUnits[1]/a]}},AT=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),pA=ne.create(),mA=(t,e,n,i,a,l,u)=>{const d=t.transform,f="globe"===d.projection.name,p=f?rS(d.zoom,e.canonical)*d._pixelsPerMercatorPixel:th(n,1,l),g={u_matrix:e.projMatrix,u_extrude_scale:p,u_intensity:u,u_inv_rot_matrix:pA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(f){g.u_inv_rot_matrix=i,g.u_merc_center=a,g.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],g.u_zoom_transition=ki(d.zoom);const _=a[0]*le,x=a[1]*le;g.u_up_dir=d.projection.upVector(new Qs(0,0,0),_,x)}return g},PT=(t,e,n,i,a,l,u,d,f,p,g)=>{return{u_matrix:t,u_normalize_matrix:e,u_globe_matrix:n,u_tl_parent:i,u_scale_parent:a,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(_=u.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Cm(u.paint.get("raster-hue-rotate")),u_perspective_transform:d,u_colorization_mix:p,u_colorization_scale:gA(g),u_color_ramp:f};var _,x};function Cm(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}function gA([t,e]){if(t===e)return[t,e];const n=(e+t)/2,i=(e-t)/2*256/255;return[-(t=n-i)/((e=n+i)-t),1/(e-t)]}const k0=ne.create(),RT=(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C)=>{const T=a.transform,D={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:T.getCameraToCenterDistance(E),u_rotate_symbol:+n,u_aspect_ratio:T.width/T.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:l,u_label_plane_matrix:u,u_coord_matrix:d,u_is_text:+f,u_pitch_with_map:+i,u_texsize:p,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:k0,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:k0,u_up_vector:[0,-1,0],u_icon_transition:C||0};return"globe"===E.name&&(D.u_tile_id=[g.canonical.x,g.canonical.y,1<<g.canonical.z],D.u_zoom_transition=_,D.u_inv_rot_matrix=v,D.u_merc_center=x,D.u_camera_forward=T._camera.forward(),D.u_ecef_origin=function(A,P){const I=[0,0,0],R=as(uo(P.canonical));return G.transformMat4(I,I,R),G.transformMat4(I,I,A),I}(T.globeMatrix,g.toUnwrapped()),D.u_tile_matrix=Float32Array.from(T.globeMatrix),D.u_up_vector=b),D},_A=(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C)=>qe(RT(t,e,n,i,a,l,u,d,f,p,_,x,v,b,E,C),{u_gamma_scale:i?a.transform.getCameraToCenterDistance(C)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:Fe.devicePixelRatio,u_is_halo:+g,undefined:void 0}),yA=(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E)=>qe(_A(t,e,n,i,a,l,u,d,!0,f,!0,g,_,x,v,b,E),{u_texsize_icon:p,u_texture_icon:1}),DR=(t,e,n,i)=>({u_matrix:t,u_emissive_strength:e,u_opacity:n,u_color:i}),dc=(t,e,n,i,a,l,u)=>qe(function(d,f,p,g){const _=p.imageManager.getPattern(d.toString(),f),{width:x,height:v}=p.imageManager.getPixelSize(f),b=Math.pow(2,g.tileID.overscaledZ),E=g.tileSize*Math.pow(2,p.transform.tileZoom)/b,C=E*(g.tileID.canonical.x+g.tileID.wrap*b),T=E*g.tileID.canonical.y;return{u_image:0,u_pattern_tl:_.tl,u_pattern_br:_.br,u_texsize:[x,v],u_pattern_size:_.displaySize,u_tile_units_to_pixels:1/th(g,1,p.transform.tileZoom),u_pixel_coord_upper:[C>>16,T>>16],u_pixel_coord_lower:[65535&C,65535&T]}}(a,l,i,u),{u_matrix:t,u_emissive_strength:e,u_opacity:n}),ps={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Z1=(t,e,n,i,a,l,u,d,f,p,g,_=[0,0,0])=>{const x=i.style.light,v=x.properties.get("position"),b=[-v.x,-v.y,v.z],E=To.create();"viewport"===x.properties.get("anchor")&&(To.fromRotation(E,-i.transform.angle),G.transformMat3(b,b,E));const C="MASK"===p.alphaMode,T=x.properties.get("color"),D=g.paint.get("model-ambient-occlusion-intensity"),A=g.paint.get("model-color").constantOr(At.white),P=g.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:e,u_normal_matrix:n,u_lightpos:b,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_camera_pos:_,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+C,u_alphaCutoff:p.alphaCutoff,u_baseColorFactor:[l.r,l.g,l.b,l.a],u_emissiveFactor:[u[0],u[1],u[2],1],u_metallicFactor:d,u_roughnessFactor:f,u_baseColorTexture:ps.BaseColor,u_metallicRoughnessTexture:ps.MetallicRoughness,u_normalTexture:ps.Normal,u_occlusionTexture:ps.Occlusion,u_emissionTexture:ps.Emission,u_color_mix:[A.r,A.g,A.b,P],u_aoIntensity:D}},OT=new Float32Array(16),Dm=(t,e=OT,n=OT)=>({u_matrix:t,u_instance:e,u_node_matrix:n}),kT={fillExtrusion:t=>({u_matrix:new wt(t),u_lightpos:new st(t),u_lightintensity:new ve(t),u_lightcolor:new st(t),u_vertical_gradient:new ve(t),u_opacity:new ve(t),u_edge_radius:new ve(t),u_ao:new Ut(t),u_tile_id:new st(t),u_zoom_transition:new ve(t),u_inv_rot_matrix:new wt(t),u_merc_center:new Ut(t),u_up_dir:new st(t),u_height_lift:new ve(t),u_flood_light_color:new st(t),u_vertical_scale:new ve(t),u_flood_light_intensity:new ve(t),u_ground_shadow_factor:new st(t)}),fillExtrusionDepth:t=>({u_matrix:new wt(t),u_edge_radius:new ve(t),u_vertical_scale:new ve(t)}),fillExtrusionPattern:t=>({u_matrix:new wt(t),u_lightpos:new st(t),u_lightintensity:new ve(t),u_lightcolor:new st(t),u_vertical_gradient:new ve(t),u_height_factor:new ve(t),u_edge_radius:new ve(t),u_ao:new Ut(t),u_tile_id:new st(t),u_zoom_transition:new ve(t),u_inv_rot_matrix:new wt(t),u_merc_center:new Ut(t),u_up_dir:new st(t),u_height_lift:new ve(t),u_image:new Lt(t),u_texsize:new Ut(t),u_pixel_coord_upper:new Ut(t),u_pixel_coord_lower:new Ut(t),u_tile_units_to_pixels:new ve(t),u_opacity:new ve(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new wt(t),u_opacity:new ve(t),u_ao_pass:new ve(t),u_meter_to_tile:new ve(t),u_ao:new Ut(t),u_flood_light_intensity:new ve(t),u_flood_light_color:new st(t),u_attenuation:new ve(t),u_edge_radius:new ve(t),u_fb:new Lt(t),u_fb_size:new ve(t)}),fill:t=>({u_matrix:new wt(t),u_emissive_strength:new ve(t)}),fillPattern:t=>({u_matrix:new wt(t),u_emissive_strength:new ve(t),u_image:new Lt(t),u_texsize:new Ut(t),u_pixel_coord_upper:new Ut(t),u_pixel_coord_lower:new Ut(t),u_tile_units_to_pixels:new ve(t)}),fillOutline:t=>({u_matrix:new wt(t),u_emissive_strength:new ve(t),u_world:new Ut(t)}),fillOutlinePattern:t=>({u_matrix:new wt(t),u_emissive_strength:new ve(t),u_world:new Ut(t),u_image:new Lt(t),u_texsize:new Ut(t),u_pixel_coord_upper:new Ut(t),u_pixel_coord_lower:new Ut(t),u_tile_units_to_pixels:new ve(t)}),circle:t=>({u_camera_to_center_distance:new ve(t),u_extrude_scale:new Vc(t),u_device_pixel_ratio:new ve(t),u_matrix:new wt(t),u_inv_rot_matrix:new wt(t),u_merc_center:new Ut(t),u_tile_id:new st(t),u_zoom_transition:new ve(t),u_up_dir:new st(t),u_emissive_strength:new ve(t)}),collisionBox:t=>({u_matrix:new wt(t),u_camera_to_center_distance:new ve(t),u_extrude_scale:new Ut(t)}),collisionCircle:t=>({u_matrix:new wt(t),u_inv_matrix:new wt(t),u_camera_to_center_distance:new ve(t),u_viewport_size:new Ut(t)}),debug:t=>({u_color:new ii(t),u_matrix:new wt(t),u_overlay:new Lt(t),u_overlay_scale:new ve(t)}),clippingMask:t=>({u_matrix:new wt(t)}),heatmap:t=>({u_extrude_scale:new ve(t),u_intensity:new ve(t),u_matrix:new wt(t),u_inv_rot_matrix:new wt(t),u_merc_center:new Ut(t),u_tile_id:new st(t),u_zoom_transition:new ve(t),u_up_dir:new st(t)}),heatmapTexture:t=>({u_image:new Lt(t),u_color_ramp:new Lt(t),u_opacity:new ve(t)}),hillshade:t=>({u_matrix:new wt(t),u_image:new Lt(t),u_latrange:new Ut(t),u_light:new Ut(t),u_shadow:new ii(t),u_highlight:new ii(t),u_emissive_strength:new ve(t),u_accent:new ii(t)}),hillshadePrepare:t=>({u_matrix:new wt(t),u_image:new Lt(t),u_dimension:new Ut(t),u_zoom:new ve(t),u_unpack:new rs(t)}),line:t=>({u_matrix:new wt(t),u_pixels_to_tile_units:new Vc(t),u_device_pixel_ratio:new ve(t),u_units_to_pixels:new Ut(t),u_dash_image:new Lt(t),u_gradient_image:new Lt(t),u_image_height:new ve(t),u_texsize:new Ut(t),u_tile_units_to_pixels:new ve(t),u_alpha_discard_threshold:new ve(t),u_trim_offset:new Ut(t),u_emissive_strength:new ve(t)}),linePattern:t=>({u_matrix:new wt(t),u_texsize:new Ut(t),u_pixels_to_tile_units:new Vc(t),u_device_pixel_ratio:new ve(t),u_image:new Lt(t),u_units_to_pixels:new Ut(t),u_tile_units_to_pixels:new ve(t),u_alpha_discard_threshold:new ve(t)}),raster:t=>({u_matrix:new wt(t),u_normalize_matrix:new wt(t),u_globe_matrix:new wt(t),u_tl_parent:new Ut(t),u_scale_parent:new ve(t),u_fade_t:new ve(t),u_opacity:new ve(t),u_image0:new Lt(t),u_image1:new Lt(t),u_brightness_low:new ve(t),u_brightness_high:new ve(t),u_saturation_factor:new ve(t),u_contrast_factor:new ve(t),u_spin_weights:new st(t),u_perspective_transform:new Ut(t),u_colorization_mix:new rs(t),u_colorization_scale:new Ut(t),u_color_ramp:new Lt(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new Lt(t),u_is_size_feature_constant:new Lt(t),u_size_t:new ve(t),u_size:new ve(t),u_camera_to_center_distance:new ve(t),u_rotate_symbol:new Lt(t),u_aspect_ratio:new ve(t),u_fade_change:new ve(t),u_matrix:new wt(t),u_label_plane_matrix:new wt(t),u_coord_matrix:new wt(t),u_is_text:new Lt(t),u_pitch_with_map:new Lt(t),u_texsize:new Ut(t),u_tile_id:new st(t),u_zoom_transition:new ve(t),u_inv_rot_matrix:new wt(t),u_merc_center:new Ut(t),u_camera_forward:new st(t),u_tile_matrix:new wt(t),u_up_vector:new st(t),u_ecef_origin:new st(t),u_texture:new Lt(t),u_icon_transition:new ve(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new Lt(t),u_is_size_feature_constant:new Lt(t),u_size_t:new ve(t),u_size:new ve(t),u_camera_to_center_distance:new ve(t),u_rotate_symbol:new Lt(t),u_aspect_ratio:new ve(t),u_fade_change:new ve(t),u_matrix:new wt(t),u_label_plane_matrix:new wt(t),u_coord_matrix:new wt(t),u_is_text:new Lt(t),u_pitch_with_map:new Lt(t),u_texsize:new Ut(t),u_texture:new Lt(t),u_gamma_scale:new ve(t),u_device_pixel_ratio:new ve(t),u_tile_id:new st(t),u_zoom_transition:new ve(t),u_inv_rot_matrix:new wt(t),u_merc_center:new Ut(t),u_camera_forward:new st(t),u_tile_matrix:new wt(t),u_up_vector:new st(t),u_ecef_origin:new st(t),u_is_halo:new Lt(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new Lt(t),u_is_size_feature_constant:new Lt(t),u_size_t:new ve(t),u_size:new ve(t),u_camera_to_center_distance:new ve(t),u_rotate_symbol:new Lt(t),u_aspect_ratio:new ve(t),u_fade_change:new ve(t),u_matrix:new wt(t),u_label_plane_matrix:new wt(t),u_coord_matrix:new wt(t),u_is_text:new Lt(t),u_pitch_with_map:new Lt(t),u_texsize:new Ut(t),u_texsize_icon:new Ut(t),u_texture:new Lt(t),u_texture_icon:new Lt(t),u_gamma_scale:new ve(t),u_device_pixel_ratio:new ve(t),u_is_halo:new Lt(t)}),background:t=>({u_matrix:new wt(t),u_emissive_strength:new ve(t),u_opacity:new ve(t),u_color:new ii(t)}),backgroundPattern:t=>({u_matrix:new wt(t),u_emissive_strength:new ve(t),u_opacity:new ve(t),u_image:new Lt(t),u_pattern_tl:new Ut(t),u_pattern_br:new Ut(t),u_texsize:new Ut(t),u_pattern_size:new Ut(t),u_pixel_coord_upper:new Ut(t),u_pixel_coord_lower:new Ut(t),u_tile_units_to_pixels:new ve(t)}),terrainRaster:U1,terrainDepth:U1,skybox:t=>({u_matrix:new wt(t),u_sun_direction:new st(t),u_cubemap:new Lt(t),u_opacity:new ve(t),u_temporal_offset:new ve(t)}),skyboxGradient:t=>({u_matrix:new wt(t),u_color_ramp:new Lt(t),u_center_direction:new st(t),u_radius:new ve(t),u_opacity:new ve(t),u_temporal_offset:new ve(t)}),skyboxCapture:t=>({u_matrix_3f:new op(t),u_sun_direction:new st(t),u_sun_intensity:new ve(t),u_color_tint_r:new rs(t),u_color_tint_m:new rs(t),u_luminance:new ve(t)}),globeRaster:t=>({u_proj_matrix:new wt(t),u_globe_matrix:new wt(t),u_normalize_matrix:new wt(t),u_merc_matrix:new wt(t),u_zoom_transition:new ve(t),u_merc_center:new Ut(t),u_image0:new Lt(t),u_grid_matrix:new op(t),u_skirt_height:new ve(t),u_frustum_tl:new st(t),u_frustum_tr:new st(t),u_frustum_br:new st(t),u_frustum_bl:new st(t),u_globe_pos:new st(t),u_globe_radius:new ve(t),u_viewport:new Ut(t)}),globeAtmosphere:t=>({u_frustum_tl:new st(t),u_frustum_tr:new st(t),u_frustum_br:new st(t),u_frustum_bl:new st(t),u_horizon:new ve(t),u_transition:new ve(t),u_fadeout_range:new ve(t),u_color:new rs(t),u_high_color:new rs(t),u_space_color:new rs(t),u_temporal_offset:new ve(t),u_horizon_angle:new ve(t)}),model:t=>({u_matrix:new wt(t),u_lighting_matrix:new wt(t),u_normal_matrix:new wt(t),u_lightpos:new st(t),u_lightintensity:new ve(t),u_lightcolor:new st(t),u_camera_pos:new st(t),u_opacity:new ve(t),u_baseColorFactor:new rs(t),u_emissiveFactor:new rs(t),u_metallicFactor:new ve(t),u_roughnessFactor:new ve(t),u_baseTextureIsAlpha:new Lt(t),u_alphaMask:new Lt(t),u_alphaCutoff:new ve(t),u_baseColorTexture:new Lt(t),u_metallicRoughnessTexture:new Lt(t),u_normalTexture:new Lt(t),u_occlusionTexture:new Lt(t),u_emissionTexture:new Lt(t),u_color_mix:new rs(t),u_aoIntensity:new ve(t)}),modelDepth:t=>({u_matrix:new wt(t),u_instance:new wt(t),u_node_matrix:new wt(t)}),groundShadow:t=>({u_matrix:new wt(t),u_ground_shadow_factor:new st(t)}),stars:t=>({u_matrix:new wt(t),u_up:new st(t),u_right:new st(t),u_intensity_multiplier:new ve(t)})};let L0;function W1(t,e,n,i,a,l,u){const d=t.context,f=d.gl,p=t.transform,g=t.getOrCreateProgram("collisionBox"),_=[];let x=0,v=0;for(let P=0;P<i.length;P++){const I=i[P],R=e.getTile(I),k=R.getBucket(n);if(!k)continue;const L=$I(I,k,p);let N=L;0===a[0]&&0===a[1]||(N=t.translatePosMatrix(L,R,a,l));const z=u?k.textCollisionBox:k.iconCollisionBox,j=k.collisionCircleArray;if(j.length>0){const B=ne.create(),H=N;ne.mul(B,k.placementInvProjMatrix,p.glCoordMatrix),ne.mul(B,B,k.placementViewportMatrix),_.push({circleArray:j,circleOffset:v,transform:H,invTransform:B,projection:k.getProjection()}),x+=j.length/4,v=x}z&&(t.terrain&&t.terrain.setupElevationDraw(R,g),g.draw(t,f.LINES,pt.disabled,St.disabled,t.colorModeForRenderPass(),Ft.disabled,fA(N,p,R,k.getProjection()),n.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,null,p.zoom,null,[z.collisionVertexBuffer,z.collisionVertexBufferExt]))}if(!u||!_.length)return;const b=t.getOrCreateProgram("collisionCircle"),E=new Zh;E.resize(4*x),E._trim();let C=0;for(const P of _)for(let I=0;I<P.circleArray.length/4;I++){const R=4*I,k=P.circleArray[R+0],L=P.circleArray[R+1],N=P.circleArray[R+2],z=P.circleArray[R+3];E.emplace(C++,k,L,N,z,0),E.emplace(C++,k,L,N,z,1),E.emplace(C++,k,L,N,z,2),E.emplace(C++,k,L,N,z,3)}(!L0||L0.length<2*x)&&(L0=function(P){const I=2*P,R=new Rr;R.resize(I),R._trim();for(let k=0;k<I;k++){const L=6*k;R.uint16[L+0]=4*k+0,R.uint16[L+1]=4*k+1,R.uint16[L+2]=4*k+2,R.uint16[L+3]=4*k+2,R.uint16[L+4]=4*k+3,R.uint16[L+5]=4*k+0}return R}(x));const T=d.createIndexBuffer(L0,!0),D=d.createVertexBuffer(E,DS.members,!0);for(const P of _){const I={u_matrix:P.transform,u_inv_matrix:P.invTransform,u_camera_to_center_distance:(A=p).getCameraToCenterDistance(P.projection),u_viewport_size:[A.width,A.height]};b.draw(t,f.TRIANGLES,pt.disabled,St.disabled,t.colorModeForRenderPass(),Ft.disabled,I,n.id,D,T,bn.simpleSegment(0,2*P.circleOffset,P.circleArray.length,P.circleArray.length/2),null,p.zoom)}var A;D.destroy(),T.destroy()}const Sm=ne.create();function xA({width:t,height:e,anchor:n,textOffset:i,textScale:a},l){const{horizontalAlign:u,verticalAlign:d}=B_(n),f=-(u-.5)*t,p=-(d-.5)*e,g=Up(n,i);return new ee((f/a+g[0])*l,(p/a+g[1])*l)}function vA(t,e,n,i,a,l,u,d,f,p,g){const _=t.text.placedSymbolArray,x=t.text.dynamicLayoutVertexArray,v=t.icon.dynamicLayoutVertexArray,b={},E=t.getProjection(),C=E0(d,E,l),T=l.elevation,D=E.upVectorScale(d.canonical,l.center.lat,l.worldSize).metersToTile;x.clear();for(let A=0;A<_.length;A++){const P=_.get(A),{tileAnchorX:I,tileAnchorY:R,numGlyphs:k}=P,L=P.hidden||!P.crossTileID||t.allowVerticalPlacement&&!P.placedOrientation?null:i[P.crossTileID];if(L){let N=0,z=0,j=0;if(T){const re=T?T.getAtTileOffset(d,I,R):0,[oe,ce,de]=E.upVector(d.canonical,I,R);N=re*oe*D,z=re*ce*D,j=re*de*D}let[B,H,V,Z]=ia(P.projectedAnchorX+N,P.projectedAnchorY+z,P.projectedAnchorZ+j,n?C:u);const Q=cM(l.getCameraToCenterDistance(E),Z);let te=a.evaluateSizeForFeature(t.textSizeData,p,P)*Q/pi;n&&(te*=t.tilePixelRatio/f);const W=xA(L,te);n?(({x:B,y:H,z:V}=E.projectTilePoint(I+W.x,R+W.y,d.canonical)),[B,H,V]=ia(B+N,H+z,V+j,u)):(e&&W._rotate(-l.angle),B+=W.x,H+=W.y,V=0);const X=t.allowVerticalPlacement&&P.placedOrientation===Hn.vertical?Math.PI/2:0;for(let re=0;re<k;re++)Pd(x,B,H,V,X);g&&P.associatedIconIndex>=0&&(b[P.associatedIconIndex]={x:B,y:H,z:V,angle:X})}else nh(k,x)}if(g){v.clear();const A=t.icon.placedSymbolArray;for(let P=0;P<A.length;P++){const I=A.get(P),{numGlyphs:R}=I,k=b[P];if(I.hidden||!k)nh(R,v);else{const{x:L,y:N,z,angle:j}=k;for(let B=0;B<R;B++)Pd(v,L,N,z,j)}}t.icon.dynamicLayoutVertexBuffer.updateData(v)}t.text.dynamicLayoutVertexBuffer.updateData(x)}function LT(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function FT(t,e,n,i,a,l,u,d,f,p,g,_){const x=t.context,v=x.gl,b=t.transform,E="map"===d,C="map"===f,T=E&&"point"!==n.layout.get("symbol-placement"),D=E&&!C&&!T,A=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let P=!1;const I=t.depthModeForSublayer(0,pt.ReadOnly),R=[Li(b.center.lng),Gi(b.center.lat)],k=n.layout.get("text-variable-anchor"),L="globe"===b.projection.name,N=[],z=[0,-1,0];let j=z;!L&&!b.mercatorFromTransition||E||(j=function(B){const H=B._camera.getWorldToCamera(B.worldSize,1),V=ne.multiply([],H,B.globeMatrix);ne.invert(V,V);const Z=[0,0,0],Q=[0,1,0,0];return xn.transformMat4(Q,Q,V),Z[0]=Q[0],Z[1]=Q[1],Z[2]=Q[2],G.normalize(Z,Z),Z}(b));for(const B of i){const H=e.getTile(B),V=H.getBucket(n);if(!V||"mercator"===V.projection.name&&L)continue;const Z=a?V.text:V.icon;if(!Z||V.fullyClipped||!Z.segments.get().length)continue;const Q=Z.programConfigurations.get(n.id),te=a||V.sdfIcons,W=a?V.textSizeData:V.iconSizeData,X=C||0!==b.pitch,re=ec(W,b.zoom);let oe,ce,de,ge,ae=[0,0],ue=null;if(a)ce=H.glyphAtlasTexture,de=v.LINEAR,oe=H.glyphAtlasTexture.size,V.iconsInText&&(ae=H.imageAtlasTexture.size,ue=H.imageAtlasTexture,ge=X||t.options.rotating||t.options.zooming||"composite"===W.kind||"camera"===W.kind?v.LINEAR:v.NEAREST);else{const Kn=1!==n.layout.get("icon-size").constantOr(0)||V.iconsNeedLinear;ce=H.imageAtlasTexture,de=te||t.options.rotating||t.options.zooming||Kn||X?v.LINEAR:v.NEAREST,oe=H.imageAtlasTexture.size}const Se="globe"===V.projection.name,Ne=Se?j:z,ze=Se?ki(b.zoom):0,Ve=E0(B,V.getProjection(),b),Ke=b.calculatePixelsToTileUnitsMatrix(H),ht=Hd(Ve,H.tileID.canonical,C,E,b,V.getProjection(),Ke),Ot=t.terrain&&C&&T?ne.invert(ne.create(),ht):Sm,Xt=Yv(Ve,H.tileID.canonical,C,E,b,V.getProjection(),Ke),Tt=k&&V.hasTextData(),vt=V.hasIconTextFit()&&Tt&&V.hasIconData();if(T){const Kn=b.elevation,qn=Kn?Kn.getAtTileOffsetFunc(B,b.center.lat,b.worldSize,V.getProjection()):null,Tn=c0(Ve,H.tileID.canonical,C,E,b,V.getProjection(),Ke);aI(V,Ve,t,a,Tn,Xt,C,p,qn,B)}const ct=T||a&&k||vt,it=t.translatePosMatrix(Ve,H,l,u),Nt=ct?Sm:ht,Kt=t.translatePosMatrix(Xt,H,l,u,!0),Rt=V.getProjection().createInversionMatrix(b,B.canonical),Sn=n.paint.get("icon-image-cross-fade").constantOr(0),or=[];t.terrainRenderModeElevated()&&C&&or.push("PITCH_WITH_MAP_TERRAIN"),Se&&(or.push("PROJECTION_GLOBE_VIEW"),ct&&or.push("PROJECTED_POS_ON_VIEWPORT")),Sn>0&&or.push("ICON_TRANSITION"),Z.zOffsetVertexBuffer&&or.push("Z_OFFSET");const Gn=te&&0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let kn;kn=te?V.iconsInText?yA(W.kind,re,D,C,t,it,Nt,Kt,oe,ae,B,ze,R,Rt,Ne,V.getProjection()):_A(W.kind,re,D,C,t,it,Nt,Kt,a,oe,!0,B,ze,R,Rt,Ne,V.getProjection()):RT(W.kind,re,D,C,t,it,Nt,Kt,a,oe,B,ze,R,Rt,Ne,V.getProjection(),Sn);const Vr={program:t.getOrCreateProgram(LT(te,a,V),{config:Q,defines:or}),buffers:Z,uniformValues:kn,atlasTexture:ce,atlasTextureIcon:ue,atlasInterpolation:de,atlasInterpolationIcon:ge,isSDF:te,hasHalo:Gn,tile:H,labelPlaneMatrixInv:Ot};if(A&&V.canOverlap){P=!0;const Kn=Z.segments.get();for(const qn of Kn)N.push({segments:new bn([qn]),sortKey:qn.sortKey,state:Vr})}else N.push({segments:Z.segments,sortKey:0,state:Vr})}P&&N.sort((B,H)=>B.sortKey-H.sortKey);for(const B of N){const H=B.state;if(t.terrain&&t.terrain.setupElevationDraw(H.tile,H.program,{useDepthForOcclusion:b.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:H.labelPlaneMatrixInv}),x.activeTexture.set(v.TEXTURE0),H.atlasTexture.bind(H.atlasInterpolation,v.CLAMP_TO_EDGE),H.atlasTextureIcon&&(x.activeTexture.set(v.TEXTURE1),H.atlasTextureIcon&&H.atlasTextureIcon.bind(H.atlasInterpolationIcon,v.CLAMP_TO_EDGE)),t.uploadCommonLightUniforms(t.context,H.program),H.hasHalo){const V=H.uniformValues;V.u_is_halo=1,X1(H.buffers,B.segments,n,t,H.program,I,g,_,V,2),V.u_is_halo=0}else{if(H.isSDF){const V=H.uniformValues;H.hasHalo&&(V.u_is_halo=1,X1(H.buffers,B.segments,n,t,H.program,I,g,_,V,1)),V.u_is_halo=0}X1(H.buffers,B.segments,n,t,H.program,I,g,_,H.uniformValues,1)}}}function X1(t,e,n,i,a,l,u,d,f,p){const g=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];a.draw(i,i.context.gl.TRIANGLES,l,u,d,Ft.disabled,f,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),g,p)}function Y1(t,e,n,i,a,l,u){const d=t.context.gl,f=n.paint.get("fill-pattern"),p=f&&f.constantOr(1);let g,_,x,v,b;u?(_=p&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",g=d.LINES):(_=p?"fillPattern":"fill",g=d.TRIANGLES);for(const E of i){const C=e.getTile(E);if(p&&!C.patternsLoaded())continue;const T=C.getBucket(n);if(!T)continue;t.prepareDrawTile();const D=T.programConfigurations.get(n.id),A=t.isTileAffectedByFog(E),P=t.getOrCreateProgram(_,{config:D,overrideFog:A});p&&(t.context.activeTexture.set(d.TEXTURE0),C.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),D.updatePaintBuffers());const I=f.constantOr(null);if(I&&C.imageAtlas){const L=C.imageAtlas.patternPositions[I.toString()];L&&D.setConstantPatternPositions(L)}const R=t.translatePosMatrix(E.projMatrix,C,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),k=n.paint.get("fill-emissive-strength");if(u){v=T.indexBuffer2,b=T.segments2;const L=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];x="fillOutlinePattern"===_&&p?CR(R,k,t,C,L):TR(R,k,L)}else v=T.indexBuffer,b=T.segments,x=p?IT(R,k,t,C):ST(R,k);t.uploadCommonUniforms(t.context,P,E.toUnwrapped()),P.draw(t,g,a,t.stencilModeForClipping(E),l,Ft.disabled,x,n.id,T.layoutVertexBuffer,v,b,n.paint,t.transform.zoom,D,void 0)}}function ms(t,e,n,i,a,l,u,d){const f=t.context,p=f.gl,g=t.transform,_=n.paint.get("fill-extrusion-pattern"),x=_.constantOr(1),v=n.paint.get("fill-extrusion-opacity"),b=t.style.enable3dLights(),E=n.paint.get(b&&!x?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),C=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),E],T=n.layout.get("fill-extrusion-edge-radius"),D=T>0&&!n.paint.get("fill-extrusion-rounded-roof"),A=D?0:T,P="globe"===g.projection.name?a1():0,I="globe"===g.projection.name,R=I?ki(g.zoom):0,k=[Li(g.center.lng),Gi(g.center.lat)],L=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=n.paint.get("fill-extrusion-flood-light-intensity"),z=n.paint.get("fill-extrusion-vertical-scale"),j=ef(t,n.paint.get("fill-extrusion-cutoff-fade-range")),B=[];let H;I&&B.push("PROJECTION_GLOBE_VIEW"),C[0]>0&&B.push("FAUX_AO"),D&&B.push("ZERO_ROOF_RADIUS"),d&&B.push("HAS_CENTROID"),N>0&&B.push("FLOOD_LIGHT"),j.shouldRenderCutoff&&B.push("RENDER_CUTOFF");const V="shadow"===t.renderPass,Z=t.shadowRenderer,Q=V&&!!Z;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let te=[0,0,0];if(Z){const X=t.style.directionalLight,re=t.style.ambientLight;X&&re&&(te=sb(X,re)),H=B.concat(["SHADOWS_SINGLE_CASCADE"])}const W=Q?"fillExtrusionDepth":x?"fillExtrusionPattern":"fillExtrusion";for(const X of i){const re=e.getTile(X),oe=re.getBucket(n);if(!oe||oe.projection.name!==g.projection.name)continue;let ce=!1;Z&&(ce=0===Z.getMaxCascadeForTile(X.toUnwrapped()));const de=t.isTileAffectedByFog(X),ge=oe.programConfigurations.get(n.id),ae=t.getOrCreateProgram(W,{config:ge,defines:ce?H:B,overrideFog:de});if(t.terrain){const Ve=t.terrain;t.style.terrainSetForDrapingOnly(),Ve.setupElevationDraw(re,ae,{useMeterToDem:!0})}if(!oe.centroidVertexBuffer){const Ve=ae.attributes.a_centroid_pos;void 0!==Ve&&p.vertexAttrib2f(Ve,0,0)}!V&&Z&&Z.setupShadows(re.tileID.toUnwrapped(),ae,"vector-tile",re.tileID.overscaledZ),x&&(t.context.activeTexture.set(p.TEXTURE0),re.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),ge.updatePaintBuffers());const ue=_.constantOr(null);if(ue&&re.imageAtlas){const Ve=re.imageAtlas.patternPositions[ue.toString()];Ve&&ge.setConstantPatternPositions(Ve)}const Se=n.paint.get("fill-extrusion-vertical-gradient");let Ne;if(V&&Z){if(BT(re.tileID,oe,t))continue;const Ve=Z.calculateShadowPassMatrixFromTile(re.tileID.toUnwrapped());Ne=CT(Ve,A,z)}else{const Ve=t.translatePosMatrix(X.projMatrix,re,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Ke=g.projection.createInversionMatrix(g,X.canonical);Ne=x?DT(Ve,t,Se,v,C,A,X,re,P,R,k,Ke,L,z):q1(Ve,t,Se,v,C,A,X,P,R,k,Ke,L,z,N,te)}t.uploadCommonUniforms(f,ae,X.toUnwrapped(),null,j);const ze=[];(t.terrain||d)&&ze.push(oe.centroidVertexBuffer),I&&ze.push(oe.layoutVertexExtBuffer),ae.draw(t,f.gl.TRIANGLES,a,l,u,Ft.backCCW,Ne,n.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,n.paint,t.transform.zoom,ge,ze)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function nf(t,e,n,i,a,l,u,d,f,p,g,_,x,v,b,E,C,T,D){const A=t.context,P=A.gl,I=t.transform,R=t.transform.zoom,k=[],L=ef(t,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===p?(k.push("CLEAR_SUBPASS"),D&&(k.push("CLEAR_FROM_TEXTURE"),A.activeTexture.set(P.TEXTURE0),D.bind(P.LINEAR,P.CLAMP_TO_EDGE))):"sdf"===p&&k.push("SDF_SUBPASS"),C&&k.push("HAS_CENTROID"),L.shouldRenderCutoff&&k.push("RENDER_CUTOFF");const N=n.layout.get("fill-extrusion-edge-radius"),z=(j,B,H,V,Z)=>{const Q=B.programConfigurations.get(n.id),te=t.isTileAffectedByFog(j),W=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Q,defines:k,overrideFog:te}),X={u_matrix:V,u_opacity:g,u_ao_pass:f?1:0,u_meter_to_tile:Z,u_ao:[_,x*Z],u_flood_light_intensity:v,u_flood_light_color:b,u_attenuation:E,u_edge_radius:R>=17?0:N*Z,u_fb:0,u_fb_size:D?D.size[0]:0},re=[];C&&re.push(B.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(A,W,j.toUnwrapped(),null,L),W.draw(t,A.gl.TRIANGLES,a,l,u,d,X,n.id,B.vertexBuffer,B.indexBuffer,H,n.paint,R,Q,re)};for(const j of i){const B=e.getTile(j),H=B.getBucket(n);if(!H||H.projection.name!==I.projection.name||!H.groundEffect||H.groundEffect&&!H.groundEffect.hasData())continue;const V=H.groundEffect,Z=1/H.tileToMeter;{const Q=t.translatePosMatrix(j.projMatrix,B,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),te=V.getDefaultSegment();z(j,V,te,Q,Z)}if(T)for(let Q=0;Q<4;Q++){const te=Bx[Q](j),W=e.getTile(te);if(!W)continue;const X=W.getBucket(n);if(!X||X.projection.name!==I.projection.name||!X.groundEffect||X.groundEffect&&!X.groundEffect.hasData())continue;const re=X.groundEffect;let oe,ce;0===Q?(oe=[-le,0,0],ce=1):1===Q?(oe=[le,0,0],ce=0):2===Q?(oe=[0,-le,0],ce=3):(oe=[0,le,0],ce=2);const de=re.regionSegments[ce];if(!de)continue;const ge=new Float32Array(16);ne.translate(ge,j.projMatrix,oe),z(j,re,de,t.translatePosMatrix(ge,B,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Z)}}}function bA(t,e,n,i,a,l,u){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const d=l?l.findDEMTileFor(n):null;if(!(d&&d.dem||u))return;const f=T=>{const D=e.getSource().minzoom,A=I=>{const R=e.getTileByID(I);if(R&&R.hasData())return R.getBucket(a)},P=[0,-1,1];for(const I of P){if(T.overscaledZ+I<D)continue;const R=A(T.calculateScaledKey(T.overscaledZ+I));if(R)return R}},p=[0,0,0],g=(T,D)=>(p[0]=Math.min(T.min.y,D.min.y),p[1]=Math.max(T.max.y,D.max.y),p[2]=le-D.min.x>T.max.x?D.min.x-le:T.max.x,p),_=(T,D)=>(p[0]=Math.min(T.min.x,D.min.x),p[1]=Math.max(T.max.x,D.max.x),p[2]=le-D.min.y>T.max.y?D.min.y-le:T.max.y,p),x=[(T,D)=>g(T,D),(T,D)=>g(D,T),(T,D)=>_(T,D),(T,D)=>_(D,T)],v=(T,D,A,P,I,R,k)=>{if(!l)return 0;const L=[[R?A:T,R?T:A,0],[R?A:D,R?D:A,0]],N=k<0?le+k:k,z=[R?N:(T+D)/2,R?(T+D)/2:N,0];return 0===A&&k<0||0!==A&&k>0?l.getForTilePoints(I,[z],!0,P):L.push(z),l.getForTilePoints(n,L,!0,d),Math.max(L[0][2],L[1][2],z[2])/l.exaggeration()};for(let T=0;T<4;T++){const D=i.borderFeatureIndices[T];if(0===D.length)continue;const A=Bx[T](n),P=f(A);if(!(P&&P instanceof Wd)||i.borderDoneWithNeighborZ[T]===P.canonical.z)continue;0===P.centroidVertexArray.length&&P.createCentroidsBuffer();const I=l?l.findDEMTileFor(A):null;if(!(I&&I.dem||u))continue;const R=(T<2?1:5)-T,k=P.borderDoneWithNeighborZ[R]!==i.canonical.z,L=P.borderFeatureIndices[R];let N=0;if(i.canonical.z!==P.canonical.z){for(const z of D)i.showCentroid(i.featuresOnBorder[z]);if(k)for(const z of L)P.showCentroid(P.featuresOnBorder[z]);i.borderDoneWithNeighborZ[T]=P.canonical.z,P.borderDoneWithNeighborZ[R]=i.canonical.z}for(const z of D){const j=i.featuresOnBorder[z],B=i.centroidData[j.centroidDataIndex],H=j.borders[T];let V;for(;N<L.length;){V=P.featuresOnBorder[L[N]];const Z=V.borders[R];if(Z[1]>H[0]+3||Z[0]>H[0]-3)break;P.showCentroid(V),N++}if(V&&N<L.length){const Z=N;let Q=0;for(;!(V.borders[R][0]>H[1]-3)&&(Q++,++N!==L.length);)V=P.featuresOnBorder[L[N]];if(V=P.featuresOnBorder[L[Z]],Q>1){const X=V.borders[R];Math.abs(H[0]-X[0])<3&&Math.abs(H[1]-X[1])<3&&(Q=1,N=Z+1)}else if(0===Q){i.showCentroid(j);continue}const te=P.centroidData[V.centroidDataIndex];u&&1===Q&&(((E=B).flags|(C=te).flags)&Ra?(E.flags|=Ra,C.flags|=Ra):(E.flags&=2147483647,C.flags&=2147483647));let W=new ee(0,0);if(Q>1)N=Z;else if(I&&I.dem&&!(j.intersectsCount()>1||V.intersectsCount()>1)){const X=x[T](B,te),re=T%2?le-1:0;b=v(X[0],Math.min(le-1,X[1]),re,I,A,T<2,X[2]),W=new ee(Math.ceil(7*(b+450)),0)}B.centroidXY=te.centroidXY=W,i.writeCentroidToBuffer(B),P.writeCentroidToBuffer(te)}else i.showCentroid(j)}i.borderDoneWithNeighborZ[T]=P.canonical.z,P.borderDoneWithNeighborZ[R]=i.canonical.z}var b,E,C;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(t)}const NT=[1,0,0],zT=[0,1,0],J1=[0,0,1];function BT(t,e,n){const i=n.transform,a=n.shadowRenderer;if(!a)return!0;const l=t.toUnwrapped(),u=i.tileSize*a._cascades[n.currentShadowCascade].scale;let d=e.maxHeight;if(i.elevation){const E=i.elevation.getMinMaxForTile(t);E&&(d+=E.max)}const f=[...a.shadowDirection];f[2]=-f[2];const p=a.computeSimplifiedTileShadowVolume(l,d,u,f);if(!p)return!1;const g=[NT,zT,J1,f,[f[0],0,f[2]],[0,f[1],f[2]]],_="globe"===i.projection.name,x=i.scaleZoom(u),v=fl.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,x,!_),b=a.getCurrentCascadeFrustum();return 0===v.intersectsPrecise(p.vertices,p.planes,g)||0===b.intersectsPrecise(p.vertices,p.planes,g)}const wA=new At(1,0,0,1),VT=new At(0,1,0,1),jT=new At(0,0,1,1),EA=new At(1,0,1,1),MA=new At(0,1,1,1);function K1(t,e,n){const i=t.context,a=t.transform,l=i.gl,u="globe"===a.projection.name,d=u?["PROJECTION_GLOBE_VIEW"]:[];let f=n.projMatrix;if(u&&ki(a.zoom)>0){const z=Hu(u_(n.canonical,a));f=ne.multiply(new Float32Array(16),a.globeMatrix,z),ne.multiply(f,a.projMatrix,f)}const p=t.getOrCreateProgram("debug",{defines:d}),g=e.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(g,p);const _=pt.disabled,x=St.disabled,v=t.colorModeForRenderPass(),b="$debug";i.activeTexture.set(l.TEXTURE0),t.emptyTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),u?g._makeGlobeTileDebugBuffers(t.context,a):g._makeDebugTileBoundsBuffers(t.context,a.projection);const E=g._tileDebugBuffer||t.debugBuffer,C=g._tileDebugIndexBuffer||t.debugIndexBuffer,T=g._tileDebugSegments||t.debugSegments;p.draw(t,l.LINE_STRIP,_,x,v,Ft.disabled,AT(f,At.red),b,E,C,T,null,null,null,[g._globeTileDebugBorderBuffer]);const D=g.latestRawTileData,A=Math.floor((D&&D.byteLength||0)/1024),P=e.getTile(n).tileSize,I=512/Math.min(P,512)*(n.overscaledZ/a.zoom)*.5;let R=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(R+=` => ${n.overscaledZ}`),R+=` ${A}kb`,function(z,j){z.initDebugOverlayCanvas();const B=z.debugOverlayCanvas,H=z.context.gl,V=z.debugOverlayCanvas.getContext("2d");V.clearRect(0,0,B.width,B.height),V.shadowColor="white",V.shadowBlur=2,V.lineWidth=1.5,V.strokeStyle="white",V.textBaseline="top",V.font="bold 36px Open Sans, sans-serif",V.fillText(j,5,5),V.strokeText(j,5,5),z.debugOverlayTexture.update(B),z.debugOverlayTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE)}(t,R);const k=g._tileDebugTextBuffer||t.debugBuffer,L=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,N=g._tileDebugTextSegments||t.debugSegments;p.draw(t,l.TRIANGLES,_,x,Jt.alphaBlended,Ft.disabled,AT(f,At.transparent,I),b,k,L,N,null,null,null,[g._globeTileDebugTextBuffer])}function F0(t,e,n,i){rf(t,0,e+n/2,t.transform.width,n,i)}function Q1(t,e,n,i){rf(t,e-n/2,0,n,t.transform.height,i)}function rf(t,e,n,i,a,l){const u=t.context,d=u.gl;d.enable(d.SCISSOR_TEST),d.scissor(e*Fe.devicePixelRatio,n*Fe.devicePixelRatio,i*Fe.devicePixelRatio,a*Fe.devicePixelRatio),u.clear({color:l}),d.disable(d.SCISSOR_TEST)}const eb=sn([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:TA}=eb;function lu(t,e,n,i){t.emplaceBack(e,n,i)}class UT{constructor(e){this.vertexArray=new wa,this.indices=new Rr,lu(this.vertexArray,-1,-1,1),lu(this.vertexArray,1,-1,1),lu(this.vertexArray,-1,1,1),lu(this.vertexArray,1,1,1),lu(this.vertexArray,-1,-1,-1),lu(this.vertexArray,1,-1,-1),lu(this.vertexArray,-1,1,-1),lu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,TA),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=bn.simpleSegment(0,0,36,12)}}function sf(t,e,n,i,a,l){const u=t.context.gl,d=e.paint.get("sky-atmosphere-color"),f=e.paint.get("sky-atmosphere-halo-color"),p=e.paint.get("sky-atmosphere-sun-intensity"),g={u_matrix_3f:To.fromMat4(To.create(),i),u_sun_direction:a,u_sun_intensity:p,u_color_tint_r:[(b=d).r,b.g,b.b,b.a],u_color_tint_m:[(E=f).r,E.g,E.b,E.a],u_luminance:5e-5};var b,E;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+l,e.skyboxTexture,0),n.draw(t,u.TRIANGLES,pt.disabled,St.disabled,Jt.unblended,Ft.frontCW,g,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}const $T=sn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class tb{constructor(e){const n=new Ys;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const i=new Rr;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(n,$T.members),this.indexBuffer=e.createIndexBuffer(i),this.segments=bn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const HT=sn([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class CA{constructor(){this.colorModeAlphaBlendedWriteRGB=new Jt([1,771,1,771],At.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Jt([1,0,1,0],At.transparent,[!1,!1,!1,!0])}update(e){const n=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new tb(n);const i=100,a=200,l=function(g){const _=Cw(30),x=[];for(let v=0;v<16e3;++v){const b=2*Math.PI*_(),E=Math.acos(1-2*_())-.5*Math.PI;x.push(G.fromValues(Math.cos(E)*Math.cos(b),Math.cos(E)*Math.sin(b),Math.sin(E)))}return x}(),u=Cw(300),d=new Ou,f=new Rr;let p=0;for(let g=0;g<l.length;++g){const _=G.scale([],l[g],200),x=Math.max(0,1+.01*i*(1*u()-.5)),v=Math.max(0,1+.01*a*(1*u()-.5));d.emplaceBack(_[0],_[1],_[2],-1,-1,x,v),d.emplaceBack(_[0],_[1],_[2],1,-1,x,v),d.emplaceBack(_[0],_[1],_[2],1,1,x,v),d.emplaceBack(_[0],_[1],_[2],-1,1,x,v),f.emplaceBack(p+0,p+1,p+2),f.emplaceBack(p+0,p+2,p+3),p+=4}this.starsVx=n.createVertexBuffer(d,HT.members),this.starsIdx=n.createIndexBuffer(f),this.starsSegments=bn.simpleSegment(0,0,d.length,f.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,n){const i=e.context,a=i.gl,l=e.transform,u=new pt(a.LEQUAL,pt.ReadOnly,[0,1]),d=ki(l.zoom),f=n.properties.get("color").toArray01(),p=n.properties.get("high-color").toArray01(),g=n.properties.get("space-color").toArray01PremultipliedAlpha(),_=5e-4,x=We((n.properties.get("horizon-blend")-0)/1*.2495+_,5e-4,.25),v=sS(e,i,l)&&x===_?l.worldSize/(2*Math.PI*1.025)-1:l.globeRadius,b=e.frameCounter/1e3%1,E=G.length(l.globeCenterInViewSpace),C=Math.sqrt(Math.pow(E,2)-Math.pow(v,2)),T=Math.acos(C/E),D=A=>{const P="globe"===l.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];A&&P.push("ALPHA_PASS");const I=e.getOrCreateProgram("globeAtmosphere",{defines:P}),R={u_frustum_tl:l.frustumCorners.TL,u_frustum_tr:l.frustumCorners.TR,u_frustum_br:l.frustumCorners.BR,u_frustum_bl:l.frustumCorners.BL,u_horizon:l.frustumCorners.horizon,u_transition:d,u_fadeout_range:x,u_color:f,u_high_color:p,u_space_color:g,u_temporal_offset:b,u_horizon_angle:T};e.uploadCommonUniforms(i,I);const k=this.atmosphereBuffer;k&&I.draw(e,a.TRIANGLES,u,St.disabled,A?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ft.backCW,R,A?"atmosphere_glow_alpha":"atmosphere_glow",k.vertexBuffer,k.indexBuffer,k.segments)};D(!1),D(!0)}drawStars(e,n){const i=We(n.properties.get("star-intensity"),0,1);if(0===i)return;const a=e.context,l=a.gl,u=e.transform,d=e.getOrCreateProgram("stars"),f=Oi.identity([]);Oi.rotateX(f,f,-u._pitch),Oi.rotateZ(f,f,-u.angle),Oi.rotateX(f,f,Et(u._center.lat)),Oi.rotateY(f,f,-Et(u._center.lng));const p=ne.fromQuat(new Float32Array(16),f),g=ne.multiply([],u.starsProjMatrix,p),_=To.fromMat4([],p),x=To.invert([],_),v=[0,1,0];G.transformMat3(v,v,x),G.scale(v,v,.15);const b=[1,0,0];G.transformMat3(b,b,x),G.scale(b,b,.15);const E=(T=v,D=b,A=i,{u_matrix:Float32Array.from(g),u_up:T,u_right:D,u_intensity_multiplier:A});var T,D,A;e.uploadCommonUniforms(a,d),this.starsVx&&this.starsIdx&&d.draw(e,l.TRIANGLES,pt.disabled,St.disabled,this.colorModeAlphaBlendedWriteRGB,Ft.disabled,E,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function nb(t,e){const n=[...t],i=e.cameraWorldSizeForFog/e.worldSize,a=ne.identity([]);return ne.scale(a,a,[i,i,1]),ne.multiply(n,a,n),ne.multiply(n,e.worldToFogMatrix,n),n}function N0(t,e,n,i){const a=n.material,l=i.context,{baseColorTexture:u,metallicRoughnessTexture:d}=a.pbrMetallicRoughness,{normalTexture:f,occlusionTexture:p,emissionTexture:g}=a;function _(x,v,b){if(x&&(t.push(v),l.activeTexture.set(l.gl.TEXTURE0+b),x.gfxTexture)){const{minFilter:E,magFilter:C,wrapS:T,wrapT:D}=x.sampler;x.gfxTexture.bindExtraParam(E,C,T,D)}}_(u,"HAS_TEXTURE_u_baseColorTexture",ps.BaseColor),_(d,"HAS_TEXTURE_u_metallicRoughnessTexture",ps.MetallicRoughness),_(f,"HAS_TEXTURE_u_normalTexture",ps.Normal),_(p,"HAS_TEXTURE_u_occlusionTexture",ps.Occlusion),_(g,"HAS_TEXTURE_u_emissionTexture",ps.Emission),n.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(n.texcoordBuffer)),n.colorBuffer&&(t.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(n.colorBuffer)),n.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(n.normalBuffer)),n.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(n.pbrBuffer)),"OPAQUE"!==a.alphaMode&&"MASK"!==a.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function z0(t,e,n,i,a,l){const u=n.paint.get("model-opacity"),d=e.context,f=new pt(e.context.gl.LEQUAL,pt.ReadWrite,e.depthRangeFor3D),p=e.transform,g=t.mesh,_=g.material,x=_.pbrMetallicRoughness,v=e.style.fog;let b;b="pixels"===e.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:ne.multiply([],i.zScaleMatrix,t.nodeModelMatrix),ne.multiply(b,i.negCameraPosMatrix,b);const E=ne.invert([],b);ne.transpose(E,E);const C=Z1(new Float32Array(t.worldViewProjection),new Float32Array(b),new Float32Array(E),e,u,x.baseColorFactor,_.emissiveFactor,x.metallicFactor,x.roughnessFactor,_,n),T={defines:[]},D=[];N0(T.defines,D,g,e);const A=e.shadowRenderer;A&&(A.useNormalOffset=!1);let P=null;if(v){const k=nb(t.nodeModelMatrix,e.transform);if(P=new Float32Array(k),"globe"!==p.projection.name){const L=g.aabb.min,N=g.aabb.max,[z,j]=v.getOpacityForBounds(k,L[0],L[1],N[0],N[1]);T.overrideFog=z>=ru||j>=ru}}const I=ef(e,n.paint.get("model-cutoff-fade-range"));I.shouldRenderCutoff&&T.defines.push("RENDER_CUTOFF");const R=e.getOrCreateProgram("model",T);e.uploadCommonUniforms(d,R,null,P,I),"shadow"!==e.renderPass&&A&&A.setupShadowsFromMatrix(t.nodeModelMatrix,R),R.draw(e,d.gl.TRIANGLES,f,a,l,g.material.doubleSided?Ft.disabled:Ft.backCCW,C,n.id,g.vertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,void 0,D)}function rb(t,e,n,i,a,l,u){let d;d="globe"===t.projection.name?u0(n,t):[...n],ne.multiply(d,d,e.matrix);const f=ne.multiply([],i,d);if(e.meshes)for(const p of e.meshes){if("BLEND"!==p.material.alphaMode){u.push({mesh:p,depth:0,modelIndex:a,worldViewProjection:f,nodeModelMatrix:d});continue}const g=G.transformMat4([],p.centroid,f);g[2]>0&&l.push({mesh:p,depth:g[2],modelIndex:a,worldViewProjection:f,nodeModelMatrix:d})}if(e.children)for(const p of e.children)rb(t,p,n,i,a,l,u)}function B0(t,e,n,i){const a=n.shadowRenderer;if(!a)return;const l=a.getShadowPassDepthMode(),u=a.getShadowPassColorMode(),d=a.calculateShadowPassMatrixFromMatrix(e),f=Dm(d);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,l,St.disabled,u,Ft.backCCW,f,i.id,t.vertexBuffer,t.indexBuffer,t.segments,i.paint,n.transform.zoom,void 0,void 0)}function DA(t,e,n){const i=e.updateZoomBasedPaintProperties(),a=function(l,u,d){let f,p,g,_=l.terrain?l.terrain.exaggeration():0;if(l.terrain&&_>0){const x=l.terrain,v=x.findDEMTileFor(d);v&&v.dem?f=Da.create(x,d,v):_=0}if(0===_&&(u.terrainElevationMin=0,u.terrainElevationMax=0),_===u.validForExaggeration&&(0===_||f&&f._demTile&&f._demTile.tileID===u.validForDEMTile.id&&f._dem._timestamp===u.validForDEMTile.timestamp))return!1;for(const x in u.instancesPerModel){const v=u.instancesPerModel[x];for(let b=0;b<v.instancedDataArray.length;++b){const E=(f?_*f.getElevationAt(0|v.instancedDataArray.float32[16*b],0|v.instancedDataArray.float32[16*b+1],!0,!0):0)+v.instancesEvaluatedElevation[b];v.instancedDataArray.float32[16*b+6]=E,p=p?Math.min(u.terrainElevationMin,E):E,g=g?Math.max(u.terrainElevationMax,E):E}}return u.terrainElevationMin=p||0,u.terrainElevationMax=g||0,u.validForExaggeration=_,u.validForDEMTile=f&&f._demTile?{id:f._demTile.tileID,timestamp:f._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,e,n);(i||a)&&(e.uploaded=!1,e.upload(t.context))}const za={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new $n([0,0,0],[le,le,0])};function SA(t,e){const n=1<<t.canonical.z,i=e.getFreeCameraOptions().position,a=e.elevation,l=t.canonical.x/n,u=(t.canonical.x+1)/n,d=t.canonical.y/n,f=(t.canonical.y+1)/n;let p=e._centerAltitude;if(a){const v=a.getMinMaxForTile(t);v&&v.max>p&&(p=v.max)}const g=We(i.x,l,u)-i.x,_=We(i.y,d,f)-i.y,x=vn(p,e.center.lat)-i.z;return e._zoomFromMercatorZ(Math.sqrt(g*g+_*_+x*x))}function Do(t,e,n,i,a,l,u){const d=t.context,f="shadow"===t.renderPass,p=t.shadowRenderer,g=f&&p?p.getShadowPassDepthMode():new pt(d.gl.LEQUAL,pt.ReadWrite,t.depthRangeFor3D),_=t.isTileAffectedByFog(l);if(n.meshes)for(const x of n.meshes){const v=["MODEL_POSITION_ON_GPU"],b=[];let E,C,T;i.instancedDataArray.length>20&&v.push("INSTANCED_ARRAYS");const D=ef(t,e.paint.get("model-cutoff-fade-range"));if(D.shouldRenderCutoff&&v.push("RENDER_CUTOFF"),f&&p)E=t.getOrCreateProgram("modelDepth",{defines:v}),C=Dm(u.shadowTileMatrix,u.shadowTileMatrix,Float32Array.from(n.matrix)),T=p.getShadowPassColorMode();else{N0(v,b,x,t),E=t.getOrCreateProgram("model",{defines:v,overrideFog:_});const P=x.material,I=P.pbrMetallicRoughness,R=e.paint.get("model-opacity");C=Z1(l.projMatrix,Float32Array.from(n.matrix),new Float32Array(16),t,R,I.baseColorFactor,P.emissiveFactor,I.metallicFactor,I.roughnessFactor,P,e,a),p&&(u.shadowUniformsInitialized?E.setShadowUniformValues(d,p.getShadowUniformValues()):(p.setupShadows(l.toUnwrapped(),E,"model-tile",l.overscaledZ),u.shadowUniformsInitialized=!0)),T=D.shouldRenderCutoff||R<1||"OPAQUE"!==P.alphaMode?Jt.alphaBlended:Jt.unblended}t.uploadCommonUniforms(d,E,l.toUnwrapped(),null,D);const A=x.material.doubleSided?Ft.disabled:Ft.backCCW;if(i.instancedDataArray.length>20)b.push(i.instancedDataBuffer),E.draw(t,d.gl.TRIANGLES,g,St.disabled,T,A,C,e.id,x.vertexBuffer,x.indexBuffer,x.segments,e.paint,t.transform.zoom,void 0,b,i.instancedDataArray.length);else{const P=f?"u_instance":"u_normal_matrix";for(let I=0;I<i.instancedDataArray.length;++I)C[P]=new Float32Array(i.instancedDataArray.arrayBuffer,64*I,16),E.draw(t,d.gl.TRIANGLES,g,St.disabled,T,A,C,e.id,x.vertexBuffer,x.indexBuffer,x.segments,e.paint,t.transform.zoom,void 0,b)}}if(n.children)for(const x of n.children)Do(t,e,x,i,a,l,u)}const af=[1,-1,1];function IA(t,e,n,i){if(!n.modelManager)return!0;const a=n.modelManager;if(!n.shadowRenderer)return!0;const l=n.shadowRenderer,u=e.aabb;let d=!0,f=t.maxHeight;if(0===f){let g=0;for(const _ in t.instancesPerModel){const x=a.getModel(_,i);x?g=Math.max(g,Math.max(Math.max(x.aabb.max[0],x.aabb.max[1]),x.aabb.max[2])):d=!1}f=t.maxScale*g*1.41+t.maxVerticalOffset,d&&(t.maxHeight=f)}u.max[2]=f,u.min[2]+=t.terrainElevationMin,u.max[2]+=t.terrainElevationMax,G.transformMat4(u.min,u.min,e.tileMatrix),G.transformMat4(u.max,u.max,e.tileMatrix);const p=u.intersects(l.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===p),0===p}class AA{}class SR{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,n,i){{const _=this._storage.get(n.id);if(_)return _.lastUsedFrameIdx=e,_.buf}const a=i.gl,l=a.getBufferParameter(a.ELEMENT_ARRAY_BUFFER,a.BUFFER_SIZE),u=new ArrayBuffer(l),d=new Int16Array(u);a.getBufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Int16Array(u));const f=new ba;for(let _=0;_<l/2;_+=3){const x=d[_],v=d[_+1],b=d[_+2];f.emplaceBack(x,v),f.emplaceBack(v,b),f.emplaceBack(b,x)}const p=i.bindVertexArrayOES.current,g=new AA;return g.buf=new fo(i,f),g.lastUsedFrameIdx=e,this._storage.set(n.id,g),i.bindVertexArrayOES.set(p),g.buf}update(e){for(const[n,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(n))}destroy(){for(const[e,n]of this._storage)n.buf.destroy(),this._storage.delete(e)}}const PA={symbol:function(t,e,n,i,a){if("translucent"!==t.renderPass)return;const l=St.disabled,u=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(d,f,p,g,_,x,v){const b=f.transform,E="map"===_,C="map"===x;for(const T of d){const D=g.getTile(T),A=D.getBucket(p);if(!A||!A.text||!A.text.segments.get().length)continue;const P=ec(A.textSizeData,b.zoom),I=E0(T,A.getProjection(),b),R=b.calculatePixelsToTileUnitsMatrix(D),k=Hd(I,D.tileID.canonical,C,E,b,A.getProjection(),R),L=A.hasIconTextFit()&&A.hasIconData();if(P){const N=Math.pow(2,b.zoom-D.tileID.overscaledZ);vA(A,E,C,v,pR,b,k,T,N,P,L)}}}(i,t,n,e,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),a),0!==n.paint.get("icon-opacity").constantOr(1)&&FT(t,e,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),l,u),0!==n.paint.get("text-opacity").constantOr(1)&&FT(t,e,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),l,u),e.map.showCollisionBoxes&&(W1(t,e,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),W1(t,e,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,e,n,i){if("translucent"!==t.renderPass)return;const a=n.paint.get("circle-opacity"),l=n.paint.get("circle-stroke-width"),u=n.paint.get("circle-stroke-opacity"),d=void 0!==n.layout.get("circle-sort-key").constantOr(1),f=n.paint.get("circle-emissive-strength");if(0===a.constantOr(1)&&(0===l.constantOr(1)||0===u.constantOr(1)))return;const p=t.context,g=p.gl,_=t.transform,x=t.depthModeForSublayer(0,pt.ReadOnly),v=St.disabled,b=t.colorModeForDrapableLayerRenderPass(f),E="globe"===_.projection.name,C=[Li(_.center.lng),Gi(_.center.lat)],T=[];for(let A=0;A<i.length;A++){const P=i[A],I=e.getTile(P),R=I.getBucket(n);if(!R||R.projection.name!==_.projection.name)continue;const k=R.programConfigurations.get(n.id),L=Cp(n),N=t.isTileAffectedByFog(P);E&&L.push("PROJECTION_GLOBE_VIEW");const z=t.getOrCreateProgram("circle",{config:k,defines:L,overrideFog:N}),j=R.layoutVertexBuffer,B=R.globeExtVertexBuffer,H=R.indexBuffer,V=_.projection.createInversionMatrix(_,P.canonical),Z={programConfiguration:k,program:z,layoutVertexBuffer:j,globeExtVertexBuffer:B,indexBuffer:H,uniformValues:rv(t,P,I,V,C,n),tile:I};if(d){const Q=R.segments.get();for(const te of Q)T.push({segments:new bn([te]),sortKey:te.sortKey,state:Z})}else T.push({segments:R.segments,sortKey:0,state:Z})}d&&T.sort((A,P)=>A.sortKey-P.sortKey);const D={useDepthForOcclusion:_.depthOcclusionForSymbolsAndCircles};for(const A of T){const{programConfiguration:P,program:I,layoutVertexBuffer:R,globeExtVertexBuffer:k,indexBuffer:L,uniformValues:N,tile:z}=A.state,j=A.segments;t.terrain&&t.terrain.setupElevationDraw(z,I,D),t.uploadCommonUniforms(p,I,z.tileID.toUnwrapped()),I.draw(t,g.TRIANGLES,x,v,b,Ft.disabled,N,n.id,R,L,j,n.paint,_.zoom,P,[k])}},heatmap:function(t,e,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const a=t.context,l=a.gl,u=St.disabled,d=new Jt([l.ONE,l.ONE,l.ONE,l.ONE],At.transparent,[!0,!0,!0,!0]);(function(v,b,E,C){const T=v.gl,D=b.width*C,A=b.height*C;v.activeTexture.set(T.TEXTURE1),v.viewport.set([0,0,D,A]);let P=E.heatmapFbo;if(!P||P&&(P.width!==D||P.height!==A)){P&&P.destroy();const I=T.createTexture();T.bindTexture(T.TEXTURE_2D,I),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR),P=E.heatmapFbo=v.createFramebuffer(D,A,!0,null),function(R,k,L,N,z,j){const B=R.gl;B.texImage2D(B.TEXTURE_2D,0,R.extRenderToTextureHalfFloat?B.RGBA16F:B.RGBA,z,j,0,B.RGBA,R.extRenderToTextureHalfFloat?B.HALF_FLOAT:B.UNSIGNED_BYTE,null),N.colorAttachment.set(L)}(v,0,I,P,D,A)}else T.bindTexture(T.TEXTURE_2D,P.colorAttachment.get()),v.bindFramebuffer.set(P.framebuffer)})(a,t,n,"globe"===t.transform.projection.name?.5:.25),a.clear({color:At.transparent});const f=t.transform,p="globe"===f.projection.name,g=p?["PROJECTION_GLOBE_VIEW"]:[],_=p?Ft.frontCCW:Ft.disabled,x=[Li(f.center.lng),Gi(f.center.lat)];for(let v=0;v<i.length;v++){const b=i[v];if(e.hasRenderableParent(b))continue;const E=e.getTile(b),C=E.getBucket(n);if(!C||C.projection.name!==f.projection.name)continue;const T=t.isTileAffectedByFog(b),D=C.programConfigurations.get(n.id),A=t.getOrCreateProgram("heatmap",{config:D,defines:g,overrideFog:T}),{zoom:P}=t.transform;t.terrain&&t.terrain.setupElevationDraw(E,A),t.uploadCommonUniforms(a,A,b.toUnwrapped());const I=f.projection.createInversionMatrix(f,b.canonical);A.draw(t,l.TRIANGLES,pt.disabled,u,d,_,mA(t,b,E,I,x,P,n.paint.get("heatmap-intensity")),n.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,n.paint,t.transform.zoom,D,p?[C.globeExtVertexBuffer]:null)}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(a,l){const u=a.context,d=u.gl,f=l.heatmapFbo;if(!f)return;u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.colorAttachment.get()),u.activeTexture.set(d.TEXTURE1);let p=l.colorRampTexture;p||(p=l.colorRampTexture=new kr(u,l.colorRamp,d.RGBA)),p.bind(d.LINEAR,d.CLAMP_TO_EDGE),a.getOrCreateProgram("heatmapTexture").draw(a,d.TRIANGLES,pt.disabled,St.disabled,a.colorModeForRenderPass(),Ft.disabled,{u_image:0,u_color_ramp:1,u_opacity:l.paint.get("heatmap-opacity")},l.id,a.viewportBuffer,a.quadTriangleIndexBuffer,a.viewportSegments,l.paint,a.transform.zoom)}(t,n))},line:function(t,e,n,i){if("translucent"!==t.renderPass)return;const a=n.paint.get("line-opacity"),l=n.paint.get("line-width");if(0===a.constantOr(1)||0===l.constantOr(1))return;const u=n.paint.get("line-emissive-strength"),d=t.depthModeForSublayer(0,pt.ReadOnly),f=t.colorModeForDrapableLayerRenderPass(u),p=t.terrain&&t.terrain.renderingToTexture?1:Fe.devicePixelRatio,g=n.paint.get("line-dasharray"),_=g.constantOr(1),x=n.layout.get("line-cap"),v=n.paint.get("line-pattern"),b=v.constantOr(1),E=n.paint.get("line-pattern").constantOr(1),C=1!==n.paint.get("line-opacity").constantOr(1);let T=!E&&C;const D=n.paint.get("line-gradient"),A=b?"linePattern":"line",P=t.context,I=P.gl,R=h1(n);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(T=!1);for(const k of i){const L=e.getTile(k);if(b&&!L.patternsLoaded())continue;const N=L.getBucket(n);if(!N)continue;t.prepareDrawTile();const z=N.programConfigurations.get(n.id),j=t.isTileAffectedByFog(k),B=t.getOrCreateProgram(A,{config:z,defines:R,overrideFog:j}),H=v.constantOr(null);if(H&&L.imageAtlas){const oe=L.imageAtlas.patternPositions[H.toString()];oe&&z.setConstantPatternPositions(oe)}const V=g.constantOr(null),Z=x.constantOr(null);if(!b&&V&&Z&&L.lineAtlas){const oe=L.lineAtlas.getDash(V,Z);oe&&z.setConstantPatternPositions(oe)}let[Q,te]=n.paint.get("line-trim-offset");("round"===Z||"square"===Z)&&Q!==te&&(0===Q&&(Q-=1),1===te&&(te+=1));const W=t.terrain?k.projMatrix:null,X=b?c1(t,L,n,W,p):_I(t,L,n,W,N.lineClipsArray.length,p,[Q,te]);if(D){const oe=N.gradients[n.id];let ce=oe.texture;if(n.gradientVersion!==oe.version){let de=256;if(n.stepInterpolant){const ge=e.getSource().maxzoom,ae=k.canonical.z===ge?Math.ceil(1<<t.transform.maxZoom-k.canonical.z):1;de=We(On(N.maxLineLength/le*1024*ae),256,P.maxTextureSize)}oe.gradient=ml({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:de,image:oe.gradient||void 0,clips:N.lineClipsArray}),oe.texture?oe.texture.update(oe.gradient):oe.texture=new kr(P,oe.gradient,I.RGBA),oe.version=n.gradientVersion,ce=oe.texture}P.activeTexture.set(I.TEXTURE1),ce.bind(n.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE)}_&&(P.activeTexture.set(I.TEXTURE0),L.lineAtlasTexture.bind(I.LINEAR,I.REPEAT),z.updatePaintBuffers()),b&&(P.activeTexture.set(I.TEXTURE0),L.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),z.updatePaintBuffers()),t.uploadCommonUniforms(P,B,k.toUnwrapped());const re=oe=>{B.draw(t,I.TRIANGLES,d,oe,f,Ft.disabled,X,n.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,n.paint,t.transform.zoom,z,[N.layoutVertexBuffer2])};if(T){const oe=t.stencilModeForClipping(k).ref;0===oe&&t.terrain&&P.clear({stencil:0});const ce={func:I.EQUAL,mask:255};X.u_alpha_discard_threshold=.8,re(new St(ce,oe,255,I.KEEP,I.KEEP,I.INVERT)),X.u_alpha_discard_threshold=0,re(new St(ce,oe,255,I.KEEP,I.KEEP,I.KEEP))}else re(t.stencilModeForClipping(k))}T&&(t.resetStencilClippingMasks(),t.terrain&&P.clear({stencil:0}))},fill:function(t,e,n,i){const a=n.paint.get("fill-color"),l=n.paint.get("fill-opacity");if(0===l.constantOr(1))return;const u=n.paint.get("fill-emissive-strength"),d=t.colorModeForDrapableLayerRenderPass(u),f=n.paint.get("fill-pattern"),p=t.opaquePassEnabledForLayer()&&!f.constantOr(1)&&1===a.constantOr(At.transparent).a&&1===l.constantOr(0)?"opaque":"translucent";if(t.renderPass===p){const g=t.depthModeForSublayer(1,"opaque"===t.renderPass?pt.ReadWrite:pt.ReadOnly);Y1(t,e,n,i,g,d,!1)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const g=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,pt.ReadOnly);Y1(t,e,n,i,g,d,!0)}},"fill-extrusion":function(t,e,n,i){const a=n.paint.get("fill-extrusion-opacity"),l=t.context,u=l.gl,d=t.terrain,f=d&&d.renderingToTexture,p=n.paint.get("fill-extrusion-cutoff-fade-range");if(0===a)return;const g=t.conflationActive&&t.layerUsedInConflation(n,e.getSource());if(g&&function(_,x,v,b){for(const E of b){const C=x.getTile(E).getBucket(v);C&&(C.updateReplacement(E,_.replacementSource),C.uploadCentroid(_.context))}}(t,e,n,i),d||g)for(const _ of i){const x=e.getTile(_).getBucket(n);x&&bA(t.context,e,_,x,n,d,g)}if("shadow"===t.renderPass&&t.shadowRenderer){const _=t.shadowRenderer;if(d&&a<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof jl)return;const x=_.getShadowPassDepthMode(),v=_.getShadowPassColorMode();ms(t,e,n,i,x,St.disabled,v,g)}else if("translucent"===t.renderPass){const _=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!f){const x=new pt(t.context.gl.LEQUAL,pt.ReadWrite,t.depthRangeFor3D);0===p&&1===a&&_?ms(t,e,n,i,x,St.disabled,Jt.unblended,g):(ms(t,e,n,i,x,St.disabled,Jt.disabled,g),ms(t,e,n,i,x,t.stencilModeFor3D(),t.colorModeForRenderPass(),g),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&_&&(!d&&"globe"!==t.transform.projection.name||f)){const x=n.paint.get("fill-extrusion-opacity"),v=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),b=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),E=n.paint.get("fill-extrusion-flood-light-intensity"),C=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),T=v>0&&b>0,D=E>0,A=(I,R,k)=>(1-k)*I+k*R,P=I=>{const R=t.depthModeForSublayer(1,pt.ReadOnly,u.LEQUAL,!0),k=n.paint.get(I?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),L=A(.1,3,k),N=t._showOverdrawInspector;if(!N){const z=new St({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),j=new Jt([u.ONE,u.ONE,u.ONE,u.ONE],At.transparent,[!1,!1,!1,!0],u.MIN);nf(t,e,n,i,R,z,j,Ft.disabled,I,"sdf",x,v,b,E,C,L,g,!1)}{const z=N?St.disabled:new St({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),j=N?t.colorModeForRenderPass():new Jt([u.ONE_MINUS_DST_ALPHA,u.DST_ALPHA,u.ONE,u.ONE],At.transparent,[!0,!0,!0,!0]);nf(t,e,n,i,R,z,j,Ft.disabled,I,"color",x,v,b,E,C,L,g,!1)}};if(f){const I=(R,k,L)=>{const N=t.depthModeForSublayer(1,pt.ReadOnly,u.LEQUAL,!1),z=n.paint.get(R?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),j=A(.1,3,z);{const B=new Jt([u.ONE,u.ONE,u.ONE,u.ONE],At.transparent,[!1,!1,!1,!0]);nf(t,e,n,i,N,St.disabled,B,Ft.disabled,R,"clear",x,v,b,E,C,j,g,k)}{const B=new St({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),H=new Jt([u.ONE,u.ONE,u.ONE,u.ONE],At.transparent,[!1,!1,!1,!0],u.MIN);nf(t,e,n,i,N,B,H,Ft.disabled,R,"sdf",x,v,b,E,C,j,g,k)}{const B=R?u.ZERO:u.ONE_MINUS_DST_ALPHA,H=new St({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),V=new Jt([B,u.DST_ALPHA,u.ONE_MINUS_DST_ALPHA,u.ZERO],At.transparent,[!0,!0,!0,!0]);nf(t,e,n,i,N,H,V,Ft.disabled,R,"color",x,v,b,E,C,j,g,k)}{const B=new Jt([u.ONE,u.ONE,u.ONE,R?u.ZERO:u.ONE],At.transparent,[!1,!1,!1,!0],R?u.FUNC_ADD:u.MAX);nf(t,e,n,i,N,St.disabled,B,Ft.disabled,R,"clear",x,v,b,E,C,j,g,k,L)}};if(T||D){let R;if(t.prepareDrawTile(),d){const k=d.drapeBufferSize[0],L=d.drapeBufferSize[1];R=d.framebufferCopyTexture,R&&(!R||R.size[0]===k&&R.size[1]===L)||(R&&R.destroy(),R=d.framebufferCopyTexture=new kr(l,new ur({width:k,height:L}),u.RGBA)),R.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,k,L,0)}T&&I(!0,!1,R),D&&I(!1,!0,R)}}else T&&P(!0),D&&P(!1)}}},hillshade:function(t,e,n,i){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const a=t.context,l=t.terrain&&t.terrain.renderingToTexture,[u,d]="translucent"!==t.renderPass||l?[{},i]:t.stencilConfigForOverlap(i);for(const f of d){const p=e.getTile(f);if(p.needsHillshadePrepare&&"offscreen"===t.renderPass)iA(t,p,n);else if("translucent"===t.renderPass){const g=t.depthModeForSublayer(0,pt.ReadOnly),_=n.paint.get("hillshade-emissive-strength"),x=t.colorModeForDrapableLayerRenderPass(_),v=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(f):u[f.overscaledZ];rA(t,f,p,n,g,v,x)}}a.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,e,n,i,a,l){if("translucent"!==t.renderPass||0===n.paint.get("raster-opacity"))return;const u=t.context,d=u.gl,f=e.getSource(),p=function(A,P,I){const R=[];let k,L;if(A.paint.get("raster-color")){R.push("RASTER_COLOR"),k=A.paint.get("raster-color-mix"),L=A.paint.get("raster-color-range"),P.activeTexture.set(I.TEXTURE2);let N=A.colorRampTexture;N||(N=A.colorRampTexture=new kr(P,A.colorRamp,I.RGBA)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE)}return{mix:k,range:L,defines:R}}(n,u,d),g=p.defines;let _=!1;if(f instanceof bl&&!i.length){if("globe"!==t.transform.projection.name)return;if(f.onNorthPole)_=!0,g.push("PROJECTION_GLOBE_VIEW");else{if(!f.onSouthPole)return;_=!0,g.push("PROJECTION_GLOBE_VIEW")}}const x=t.colorModeForDrapableLayerRenderPass(),v=t.terrain&&t.terrain.renderingToTexture,b=!t.options.moving,E="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;if(_){const A=e.getSource();if(!(A instanceof bl))return;const P=A.texture;if(!P)return;const I=t.globeSharedBuffers;if(!I)return;const R=new pt(d.LEQUAL,pt.ReadWrite,t.depthRangeFor3D),k=Float32Array.from(t.transform.projMatrix);let L=oS(0,0,t.transform);const N=Float32Array.from(as(uo(new Qs(0,0,0)))),z={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),P.bind(E,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),P.bind(E,d.CLAMP_TO_EDGE),P.useMipmap&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const[j,B,H,V]=I.getPoleBuffers(0,!0);let Z;A.onNorthPole?(Z=j,t.renderDefaultNorthPole=!1):(L=ne.scale(ne.create(),L,[1,-1,1]),Z=B,t.renderDefaultSouthPole=!1);const Q=PT(k,N,L,[0,0],1,z,n,A.perspectiveTransform||[0,0],2,p.mix||[0,0,0,0],p.range||[0,0]),te=t.getOrCreateProgram("raster",{defines:p.defines});return t.uploadCommonUniforms(u,te,null),void te.draw(t,d.TRIANGLES,R,St.disabled,x,Ft.disabled,Q,n.id,Z,H,V)}if(!i.length)return;const[C,T]=f instanceof bl||v?[{},i]:t.stencilConfigForOverlap(i),D=T[T.length-1].overscaledZ;for(const A of T){const P=v?pt.disabled:t.depthModeForSublayer(A.overscaledZ-D,1===n.paint.get("raster-opacity")?pt.ReadWrite:pt.ReadOnly,d.LESS),I=A.toUnwrapped(),R=e.getTile(A);if(v&&(!R||!R.hasData())||!R.texture)continue;const k=v?A.projMatrix:t.transform.calculateProjMatrix(I,b),L=t.terrain&&v?t.terrain.stencilModeForRTTOverlap(A):C[A.overscaledZ],N=l?0:n.paint.get("raster-fade-duration");R.registerFadeDuration(N);const z=e.findLoadedParent(A,0),j=ET(R,z,e,t.transform,N);let B,H;t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),R.texture.bind(E,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),z?(z.texture.bind(E,d.CLAMP_TO_EDGE),B=Math.pow(2,z.tileID.overscaledZ-R.tileID.overscaledZ),H=[R.tileID.canonical.x*B%1,R.tileID.canonical.y*B%1]):R.texture.bind(E,d.CLAMP_TO_EDGE),R.texture.useMipmap&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const V=f instanceof bl?f.perspectiveTransform:[0,0],Z=new Float32Array(16),Q=PT(k,Z,Z,H||[0,0],B||1,j,n,V,2,p.mix||[0,0,0,0],p.range||[0,0]),te=t.isTileAffectedByFog(A),W=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:te});if(t.uploadCommonUniforms(u,W,I),f instanceof bl)f.boundsBuffer&&f.boundsSegments&&W.draw(t,d.TRIANGLES,P,St.disabled,x,Ft.disabled,Q,n.id,f.boundsBuffer,t.quadTriangleIndexBuffer,f.boundsSegments);else{const{tileBoundsBuffer:X,tileBoundsIndexBuffer:re,tileBoundsSegments:oe}=t.getTileBoundsBuffers(R);W.draw(t,d.TRIANGLES,P,L,x,Ft.disabled,Q,n.id,X,re,oe)}}t.resetStencilClippingMasks()},background:function(t,e,n,i){const a=n.paint.get("background-color"),l=n.paint.get("background-opacity"),u=n.paint.get("background-emissive-strength");if(0===l)return;const d=t.context,f=d.gl,p=t.transform,g=p.tileSize,_=n.paint.get("background-pattern");if(t.isPatternMissing(_,n.scope))return;const x=!_&&1===a.a&&1===l&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==x)return;const v=St.disabled,b=t.depthModeForSublayer(0,"opaque"===x?pt.ReadWrite:pt.ReadOnly),E=t.colorModeForDrapableLayerRenderPass(u),C=_?"backgroundPattern":"background";let T,D=i;D||(T=t.getBackgroundTiles(),D=Object.values(T).map(A=>A.tileID)),_&&(d.activeTexture.set(f.TEXTURE0),t.imageManager.bind(t.context,n.scope));for(const A of D){const P=t.isTileAffectedByFog(A),I=t.getOrCreateProgram(C,{overrideFog:P}),R=A.toUnwrapped(),k=i?A.projMatrix:t.transform.calculateProjMatrix(R);t.prepareDrawTile();const L=e?e.getTile(A):T?T[A.key]:new ds(A,g,p.zoom,t),N=_?dc(k,u,l,t,_,n.scope,{tileID:A,tileSize:g}):DR(k,u,l,a);t.uploadCommonUniforms(d,I,R);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:j,tileBoundsSegments:B}=t.getTileBoundsBuffers(L);I.draw(t,f.TRIANGLES,b,v,E,Ft.disabled,N,n.id,z,j,B)}},sky:function(t,e,n){const i=t._atmosphere?ki(t.transform.zoom):1,a=n.paint.get("sky-opacity")*i;if(0===a)return;const l=t.context,u=n.paint.get("sky-type"),d=new pt(l.gl.LEQUAL,pt.ReadOnly,[0,1]),f=t.frameCounter/1e3%1;"atmosphere"===u?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(p,g,_,x){const v=p.context,b=v.gl;let E=g.skyboxFbo;if(!E){E=g.skyboxFbo=v.createFramebuffer(32,32,!0,null),g.skyboxGeometry=new UT(v),g.skyboxTexture=v.gl.createTexture(),b.bindTexture(b.TEXTURE_CUBE_MAP,g.skyboxTexture),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR);for(let A=0;A<6;++A)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+A,0,b.RGBA,32,32,0,b.RGBA,b.UNSIGNED_BYTE,null)}v.bindFramebuffer.set(E.framebuffer),v.viewport.set([0,0,32,32]);const C=g.getCenter(p,!0),T=p.getOrCreateProgram("skyboxCapture"),D=new Float64Array(16);ne.identity(D),ne.rotateY(D,D,.5*-Math.PI),sf(p,g,T,D,C,0),ne.identity(D),ne.rotateY(D,D,.5*Math.PI),sf(p,g,T,D,C,1),ne.identity(D),ne.rotateX(D,D,.5*-Math.PI),sf(p,g,T,D,C,2),ne.identity(D),ne.rotateX(D,D,.5*Math.PI),sf(p,g,T,D,C,3),ne.identity(D),sf(p,g,T,D,C,4),ne.identity(D),ne.rotateY(D,D,Math.PI),sf(p,g,T,D,C,5),v.viewport.set([0,0,p.width,p.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(p,g,_,x,v){const b=p.context,E=b.gl,C=p.transform,T=p.getOrCreateProgram("skybox");b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_CUBE_MAP,g.skyboxTexture);const D={u_matrix:C.skyboxMatrix,u_sun_direction:g.getCenter(p,!1),u_cubemap:0,u_opacity:x,u_temporal_offset:v};p.uploadCommonUniforms(b,T),T.draw(p,E.TRIANGLES,_,St.disabled,p.colorModeForRenderPass(),Ft.backCW,D,"skybox",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(t,n,d,a,f):"gradient"===u&&"sky"===t.renderPass&&function(p,g,_,x,v){const b=p.context,E=b.gl,C=p.transform,T=p.getOrCreateProgram("skyboxGradient");g.skyboxGeometry||(g.skyboxGeometry=new UT(b)),b.activeTexture.set(E.TEXTURE0);let D=g.colorRampTexture;D||(D=g.colorRampTexture=new kr(b,g.colorRamp,E.RGBA)),D.bind(E.LINEAR,E.CLAMP_TO_EDGE);const A=(k=x,L=v,{u_matrix:C.skyboxMatrix,u_color_ramp:0,u_center_direction:g.getCenter(p,!1),u_radius:Et(g.paint.get("sky-gradient-radius")),u_opacity:k,u_temporal_offset:L});var k,L;p.uploadCommonUniforms(b,T),T.draw(p,E.TRIANGLES,_,St.disabled,p.colorModeForRenderPass(),Ft.backCW,A,"skyboxGradient",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(t,n,d,a,f)},debug:function(t,e,n){for(let i=0;i<n.length;i++)K1(t,e,n[i])},custom:function(t,e,n,i){const a=t.context,l=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&n.isLayerDraped(e)){if("offscreen"===t.renderPass){const u=l.prerender;if(u){if(t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const d=t.transform.pointMerc;u.call(l,a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),ki(t.transform.zoom),[d.x,d.y],t.transform.pixelsPerMeterRatio)}else u.call(l,a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const d=l.renderToTile;if(d){const f=i[0].canonical,p=new Gt(f.x+i[0].wrap*(1<<f.z),f.y,f.z);a.setDepthMode(pt.disabled),a.setStencilMode(St.disabled),a.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),d.call(l,a.gl,p),a.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),a.setStencilMode(St.disabled);const u="3d"===l.renderingMode?new pt(t.context.gl.LEQUAL,pt.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,pt.ReadOnly);if(a.setDepthMode(u),"globe"===t.transform.projection.name){const d=t.transform.pointMerc;l.render(a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),ki(t.transform.zoom),[d.x,d.y],t.transform.pixelsPerMeterRatio)}else l.render(a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState(),a.bindFramebuffer.set(null)}}else K("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,e,n,i){if("opaque"===t.renderPass)return;const a=n.paint.get("model-opacity");if(0===a)return;const l=n.paint.get("model-cast-shadows");if("shadow"===t.renderPass&&(!l||t.terrain&&a<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof jl))return;const u=t.shadowRenderer,d=n.paint.get("model-receive-shadows");u&&(u.useNormalOffset=!0,d||(u.enabled=!1));const f=()=>{u&&(u.useNormalOffset=!0,d||(u.enabled=!0))},p=e.getSource();if("light-beam"===t.renderPass&&"batched-model"!==p.type)return;if("vector"===p.type||"geojson"===p.type)return function(T,D,A,P){const I=T.transform;if("mercator"!==I.projection.name)return void K(`Drawing 3D models for ${I.projection.name} projection is not yet implemented`);const R=I.getFreeCameraOptions().position;if(!T.modelManager)return;const k=T.modelManager,L=T.shadowRenderer;if(!A._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const N=A._unevaluatedLayout._values["model-id"],z={...A.layout.get("model-id").parameters};for(const j of P){const B=D.getTile(j).getBucket(A);if(!B||B.projection.name!==I.projection.name)continue;const H=SA(j,I);z.zoom=H;const V=N.possiblyEvaluate(z);if(DA(T,B,j),za.shadowUniformsInitialized=!1,za.useSingleShadowCascade=!!L&&0===L.getMaxCascadeForTile(j.toUnwrapped()),"shadow"===T.renderPass&&L){if(1===T.currentShadowCascade&&B.isInsideFirstShadowMapFrustum)continue;const te=I.calculatePosMatrix(j.toUnwrapped(),I.worldSize);if(za.tileMatrix.set(te),za.shadowTileMatrix=Float32Array.from(L.calculateShadowPassMatrixFromMatrix(te)),za.aabb.min.fill(0),za.aabb.max[0]=za.aabb.max[1]=le,za.aabb.max[2]=0,IA(B,za,T,A.scope))continue}const Z=1<<j.canonical.z,Q=[((R.x-j.wrap)*Z-j.canonical.x)*le,(R.y*Z-j.canonical.y)*le,R.z*Z*le];for(let te in B.instancesPerModel){const W=B.instancesPerModel[te];W.features.length>0&&(te=V.evaluate(W.features[0].feature,{}));const X=k.getModel(te,A.scope);if(X&&X.uploaded)for(const re of X.nodes)Do(T,A,re,W,Q,j,za)}}}(t,e,n,i),void f();if(!p.loaded())return;if("batched-model"===p.type)return function(T,D,A,P){const I=T.context,R=T.transform,k=T.style.fog,L=T.shadowRenderer;if("mercator"!==R.projection.name)return void K(`Drawing 3D landmark models for ${R.projection.name} projection is not yet implemented`);const N=T.transform.getFreeCameraOptions().position,z=G.scale([],[N.x,N.y,N.z],T.transform.worldSize);G.negate(z,z);const j=ne.identity([]),B=Ta(R.center.lat,R.zoom),H=ne.fromScaling([],[1,1,1/B]);ne.translate(j,j,z);const V=A.paint.get("model-opacity"),Z=new pt(I.gl.LEQUAL,pt.ReadWrite,T.depthRangeFor3D),Q=new pt(I.gl.LEQUAL,pt.ReadOnly,T.depthRangeFor3D),te=function(W,X){for(const re of P){const oe=D.getTile(re).getBucket(A);if(!oe||!oe.uploaded)continue;let ce=!1;L&&(ce=0===L.getMaxCascadeForTile(re.toUnwrapped()));const de=R.calculatePosMatrix(re.toUnwrapped(),R.worldSize),ge=oe.modelTraits;for(const ae of oe.getNodesInfo()){if(ae.hiddenByReplacement||!ae.node.meshes)continue;const ue=ae.node,Se="light-beam"===T.renderPass,Ne=[...de],ze=ae.evaluatedScale;let Ve=0;T.terrain&&ue.elevation&&(Ve=ue.elevation*T.terrain.exaggeration()),ne.translate(Ne,Ne,[(ue.anchor?ue.anchor[0]:0)*(ze[0]-1),(ue.anchor?ue.anchor[1]:0)*(ze[1]-1),Ve]),ze!==pM&&ne.scale(Ne,Ne,ze),ne.multiply(Ne,Ne,ue.matrix);const Ke=ne.multiply([],H,Ne);ne.multiply(Ke,j,Ke);const ht=ne.invert([],Ke);ne.transpose(ht,ht),ne.scale(ht,ht,af);const Ot=ne.multiply([],R.projMatrix,Ne);for(let Xt=0;Xt<ue.meshes.length;++Xt){const Tt=ue.meshes[Xt],vt=Xt===ue.lightMeshIndex;if(vt){if(!Se&&!T.terrain&&T.shadowRenderer){T.currentLayer<T.firstLightBeamLayer&&(T.firstLightBeamLayer=T.currentLayer);continue}}else if(Se)continue;const ct={defines:[]},it=[];N0(ct.defines,it,Tt,T),4&ge||ct.defines.push("DIFFUSE_SHADED"),ce&&ct.defines.push("SHADOWS_SINGLE_CASCADE");const Nt="shadow"===T.renderPass;if(Nt){B0(Tt,Ne,T,A);continue}let Kt=null;if(k){const kn=nb(Ne,T.transform);if(Kt=new Float32Array(kn),"globe"!==R.projection.name){const Vr=Tt.aabb.min,Kn=Tt.aabb.max,[qn,Tn]=k.getOpacityForBounds(kn,Vr[0],Vr[1],Kn[0],Kn[1]);ct.overrideFog=qn>=ru||Tn>=ru}}const Rt=T.getOrCreateProgram("model",ct);!Nt&&L&&(L.useNormalOffset=!!Tt.normalBuffer,L.setupShadowsFromMatrix(Ne,Rt,L.useNormalOffset)),T.uploadCommonUniforms(I,Rt,re.toUnwrapped(),Kt);const Sn=Tt.material,or=Sn.pbrMetallicRoughness;or.metallicFactor=.9,or.roughnessFactor=.5;const Gn=Z1(new Float32Array(Ot),new Float32Array(Ke),new Float32Array(ht),T,V,or.baseColorFactor,Sn.emissiveFactor,or.metallicFactor,or.roughnessFactor,Sn,A);Rt.draw(T,I.gl.TRIANGLES,X&&!vt?Z:Q,St.disabled,W?vt||V<1||ae.hasTranslucentParts?Jt.alphaBlended:Jt.unblended:Jt.disabled,Ft.backCCW,Gn,A.id,Tt.vertexBuffer,Tt.indexBuffer,Tt.segments,A.paint,T.transform.zoom,void 0,it)}}}};(function(W,X,re,oe){const ce=W.terrain?W.terrain.exaggeration():0,de=W.transform.zoom;for(const ge of oe){const ae=X.getTile(ge).getBucket(re);ae&&(W.conflationActive&&ae.updateReplacement(ge,W.replacementSource),ae.evaluateScale(W,re),W.terrain&&ce>0&&ae.elevationUpdate(W.terrain,ce,ge,re.source),ae.needsReEvaluation(W,de,re)&&ae.evaluate(re))}})(T,D,A,P),1===V?te(!0,!0):(te(!1,!0),te(!0,!1))}(t,e,n,i),void f();const g=p.getModels(),_=[],x=t.transform.getFreeCameraOptions().position,v=G.scale([],[x.x,x.y,x.z],t.transform.worldSize);G.negate(v,v);const b=[],E=[];let C=0;for(const T of g){const D=n.paint.get("model-rotation").constantOr(null),A=n.paint.get("model-scale").constantOr(null),P=n.paint.get("model-translation").constantOr(null);T.computeModelMatrix(t,D,A,P,!0,!0,!1);const I=ne.identity([]),R=Ta(T.position.lat,t.transform.zoom),k=ne.fromScaling([],[1,1,1/R]);ne.translate(I,I,v),_.push({zScaleMatrix:k,negCameraPosMatrix:I});for(const L of T.nodes)rb(t.transform,L,T.matrix,t.transform.projMatrix,C,b,E);C++}if(b.sort((T,D)=>D.depth-T.depth),"shadow"!==t.renderPass){if(1===a)for(const T of E)z0(T,t,n,_[T.modelIndex],St.disabled,t.colorModeForRenderPass());else{for(const T of E)z0(T,t,n,_[T.modelIndex],St.disabled,Jt.disabled);for(const T of E)z0(T,t,n,_[T.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const T of b)z0(T,t,n,_[T.modelIndex],St.disabled,t.colorModeForRenderPass());f()}else{for(const T of E)B0(T.mesh,T.nodeModelMatrix,t,n);for(const T of b)B0(T.mesh,T.nodeModelMatrix,t,n);f()}}},ib={modelUpload:function(t,e,n){const i=e.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(t.modelManager&&t.modelManager.upload(t,n));if("batched-model"===i.type)return;const a=i.getModels();for(const l of a)l.upload(t.context)}};class ob{constructor(e,n){this.context=new s0(e),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=fs.maxUnderzooming+fs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new dI,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Im(this),this._wireframeDebugCache=new SR,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,n){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cA(this,e));const a=this._terrain;this.transform.elevation=i?a:null,a.update(e,this.transform,n),this.transform.elevation&&!a.enabled&&(this.transform.elevation=null)}_updateFog(e){const n=e.fog;if(!n||"globe"===this.transform.projection.name||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,a]=n.getFovAdjustedRange(this.transform._fov);if(i>a)return void(this.transform.fogCullDistSq=null);const l=i+.78*(a-i);this.transform.fogCullDistSq=l*l}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,n){if(this.width=e*Fe.devicePixelRatio,this.height=n*Fe.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const i of this.style.order)this.style._mergedLayers[i].resize()}setup(){const e=this.context,n=new Eo;n.emplaceBack(0,0),n.emplaceBack(le,0),n.emplaceBack(0,le),n.emplaceBack(le,le),this.tileExtentBuffer=e.createVertexBuffer(n,Gl.members),this.tileExtentSegments=bn.simpleSegment(0,0,4,2);const i=new Eo;i.emplaceBack(0,0),i.emplaceBack(le,0),i.emplaceBack(0,le),i.emplaceBack(le,le),this.debugBuffer=e.createVertexBuffer(i,Gl.members),this.debugSegments=bn.simpleSegment(0,0,4,5);const a=new Eo;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(-1,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,Gl.members),this.viewportSegments=bn.simpleSegment(0,0,4,2);const l=new Ru;l.emplaceBack(0,0,0,0),l.emplaceBack(le,0,le,0),l.emplaceBack(0,le,0,le),l.emplaceBack(le,le,le,le),this.mercatorBoundsBuffer=e.createVertexBuffer(l,Jp.members),this.mercatorBoundsSegments=bn.simpleSegment(0,0,4,2);const u=new Rr;u.emplaceBack(0,1,2),u.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(u);const d=new qg;for(const p of[0,1,3,2,0])d.emplaceBack(p);this.debugIndexBuffer=e.createIndexBuffer(d),this.emptyTexture=new kr(e,new ur({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=ne.create();const f=this.context.gl;this.stencilClearMode=new St({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO),this.loadTimeStamps.push(ie.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,pt.disabled,this.stencilClearMode,Jt.disabled,Ft.disabled,H1(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,n,i){if(!n||this.currentStencilSource===n.id||!e.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let d=!1;for(const f of i)if(void 0===this._tileClippingMaskIDs[f.key]){d=!0;break}if(!d)return}this.currentStencilSource=n.id;const a=this.context,l=a.gl;this.nextStencilID+i.length>256&&this.clearStencil(),a.setColorMode(Jt.disabled),a.setDepthMode(pt.disabled);const u=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const d of i){const f=n.getTile(d),p=this._tileClippingMaskIDs[d.key]=this.nextStencilID++,{tileBoundsBuffer:g,tileBoundsIndexBuffer:_,tileBoundsSegments:x}=this.getTileBoundsBuffers(f);u.draw(this,l.TRIANGLES,pt.disabled,new St({func:l.ALWAYS,mask:0},p,255,l.KEEP,l.KEEP,l.REPLACE),Jt.disabled,Ft.disabled,H1(d.projMatrix),"$clipping",g,_,x)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new St({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const n=this.context.gl;return new St({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,i=e.sort((u,d)=>d.overscaledZ-u.overscaledZ),a=i[i.length-1].overscaledZ,l=i[0].overscaledZ-a+1;if(l>1){this.currentStencilSource=void 0,this.nextStencilID+l>256&&this.clearStencil();const u={};for(let d=0;d<l;d++)u[d+a]=new St({func:n.GEQUAL,mask:255},d+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=l,[u,i]}return[{[a]:St.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Jt([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new At(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Jt.unblended:Jt.alphaBlended}colorModeForDrapableLayerRenderPass(e){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Jt([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new At(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,n,i,a=!1){if(!this.opaquePassEnabledForLayer()&&!a)return pt.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new pt(i||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=n;const i=this.style._mergedLayers,a=this.style.order,l=a.map(I=>i[I]),u=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(Fe.now()),this.imageManager.beginFrame();let d=0,f=!1;for(const I in u){const R=u[I];R.used&&(R.prepare(this.context),R.getSource().usedInConflation&&++d)}const p={},g={},_={},x={},v={};for(const I in u){const R=u[I];p[I]=R.getVisibleCoordinates(),g[I]=p[I].slice().reverse(),_[I]=R.getVisibleCoordinates(!0).reverse(),x[I]=R.getShadowCasterCoordinates(),v[I]=R.sortCoordinatesByDistance(p[I])}const b=I=>{const R=this.style.getLayerSourceCache(I);return R&&R.used?R.getSource():null};if(d){const I=[];for(const R of l)this.layerUsedInConflation(R,b(R))&&I.push(R);if(I&&I.length>1){const R=[];for(const k of I){const L=this.style.getLayerSourceCache(k);L&&L.used&&L.getSource().usedInConflation&&R.push({layer:k.fqid,cache:L})}this.replacementSource.setSources(R),f=!0}}f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const I of l){const R=I.cutoffRange();if(this.longestCutoffRange=Math.max(R,this.longestCutoffRange),R>0){const k=b(I);k&&(this.minCutoffZoom=Math.max(k.minzoom,this.minCutoffZoom)),I.minzoom&&(this.minCutoffZoom=Math.max(I.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let I=0;I<l.length;I++)if(l[I].is3D()){this.opaquePassCutoff=I;break}const E=this.style&&this.style.fog;E?(this._fogVisible=0!==E.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=E.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_),this.opaquePassCutoff=0);const C=this._shadowRenderer;if(C){C.updateShadowParameters(this.transform,this.style.directionalLight);for(const I in u)for(const R of p[I]){let k={min:0,max:0};this.terrain&&(k=this.terrain.getMinMaxForTile(R)||k),C.addShadowReceiver(R.toUnwrapped(),k.min,k.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new q2(this.context));for(const I of l){if(I.isHidden(this.transform.zoom))continue;const R=e.getLayerSourceCache(I);this.uploadLayer(this,I,R)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new CA),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Ic.has(this.context.gl))return;this.renderPass="offscreen";for(const I of l){const R=e.getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const k=R?g[R.id]:void 0;("custom"===I.type||"raster"===I.type||I.isSky()||k&&k.length)&&this.renderLayer(this,R,I,k)}this.depthRangeFor3D=[0,1-(l.length+2)*this.numSublayers*this.depthEpsilon];const T=this.terrain;T&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&T.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,x)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const D="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),A=(()=>{if(n.showOverdrawInspector)return At.black;if(this.style.fog&&this.transform.projection.supportsFog&&!D){const I=this.style.fog.properties.get("color").toArray01();return new At(...I)}if(this.style.fog&&this.transform.projection.supportsFog&&D){const I=this.style.fog.properties.get("space-color").toArray01();return new At(...I)}return At.transparent})();if(this.context.clear({color:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&D&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const I=l[this.currentLayer],R=e.getLayerSourceCache(I);if(I.isSky())continue;const k=R?(I.is3D()?v:g)[R.id]:void 0;this._renderTileClippingMasks(I,R,k),this.renderLayer(this,R,I,k)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&D&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||ki(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const I=l[this.currentLayer],R=e.getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,R,I,R?g[R.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let P=0;for(C&&(P=C.getShadowCastingLayerCount());this.currentLayer<a.length;){const I=l[this.currentLayer],R=e.getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(T&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=T.renderBatch(this.currentLayer);continue}let k;if(R&&(k=("symbol"===I.type?_:I.is3D()?v:g)[R.id]),this._renderTileClippingMasks(I,R,R?p[R.id]:void 0),this.renderLayer(this,R,I,k),!T&&C&&P>0&&I.hasShadowPass()&&0==--P&&(C.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const L=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=L;this.currentLayer++){const N=l[this.currentLayer];if(!N.hasLightBeamPass())continue;const z=e.getLayerSourceCache(N);this.renderLayer(this,z,N,z?g[z.id]:void 0)}this.currentLayer=L,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;l.forEach(R=>{const k=e.getLayerSourceCache(R);k&&!R.isHidden(this.transform.zoom)&&k.getVisibleCoordinates().length&&(!I||I.getSource().maxzoom<k.getSource().maxzoom)&&(I=k)}),I&&this.options.showTileBoundaries&&PA.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const R=I.transform.padding;F0(I,I.transform.height-(R.top||0),3,wA),F0(I,R.bottom||0,3,VT),Q1(I,R.left||0,3,jT),Q1(I,I.transform.width-(R.right||0),3,EA);const k=I.transform.centerPoint;var L,N,z,j;rf(L=I,(N=k.x)-1,(z=I.transform.height-k.y)-10,2,20,j=MA),rf(L,N-10,z-1,20,2,j)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(ie.performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}uploadLayer(e,n,i){this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&"custom"===n.type)&&ib[`${n.type}Upload`]&&ib[`${n.type}Upload`](e,i,n.scope),this.gpuTimingEnd()}renderLayer(e,n,i,a){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||a&&a.length)&&(this.id=i.id,this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&"custom"===i.type)&&PA[i.type](e,n,i,a,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,i=this.context.gl;let a=this.gpuTimers[e.id];a||(a=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),a.calls++,i.beginQuery(n.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,n=this.context.gl,i=n.createQuery();this.deferredRenderGpuTimeQueries.push(i),n.beginQuery(e.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const n={};for(const i in e){const a=e[i],l=this.context.extTimerQuery,u=l.getQueryParameter(a.query,this.context.gl.QUERY_RESULT)/1e6;l.deleteQueryEXT(a.query),n[i]=u}return n}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.extTimerQuery,i=this.context.gl;let a=0;for(const l of e)a+=n.getQueryParameter(l,i.QUERY_RESULT)/1e6,n.deleteQueryEXT(l);return a}translatePosMatrix(e,n,i,a,l){if(!i[0]&&!i[1])return e;const u=l?"map"===a?this.transform.angle:0:"viewport"===a?-this.transform.angle:0;if(u){const p=Math.sin(u),g=Math.cos(u);i=[i[0]*g-i[1]*p,i[0]*p+i[1]*g]}const d=[l?i[0]:th(n,i[0],this.transform.zoom),l?i[1]:th(n,i[1],this.transform.zoom),0],f=new Float32Array(16);return ne.translate(f,e,d),f}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e,n){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),n)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,n,i){const a=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,l=this.terrain&&0===this.terrain.exaggeration(),u=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(u.push("LIGHTING_3D_MODE"),u.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):a||u.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||u.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?u.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):u.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(u.push("TERRAIN"),this.terrainUseFloatDEM()&&u.push("TERRAIN_DEM_FLOAT_FORMAT"),l&&u.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&u.push("GLOBE"),!this._fogVisible||a||void 0!==n&&!n||u.push("FOG","FOG_DITHERING"),a&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}getOrCreateProgram(e,n){this.cache=this.cache||{};const i=n&&n.defines||[],a=n&&n.config,l=this.currentGlobalDefines(e,n&&n.overrideFog,n&&n.overrideRtt).concat(i),u=tf.cacheKey(j1[e],e,l,a);return this.cache[u]||(this.cache[u]=new tf(this.context,e,j1[e],a,kT[e],l)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=ie.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new kr(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,n){if(this.style.enable3dLights()){const i=this.style.directionalLight,a=this.style.ambientLight;if(i&&a){const l=((u,d)=>{const f=u.properties.get("direction"),p=u.properties.get("color").toArray01(),g=u.properties.get("intensity"),_=d.properties.get("color").toArray01(),x=d.properties.get("intensity"),v=[f.x,f.y,f.z],b=yr(_,x),E=yr(p,g);return{u_lighting_ambient_color:b,u_lighting_directional_dir:v,u_lighting_directional_color:E,u_ground_radiance:uA(v,E,b)}})(i,a);n.setLightsUniformValues(e,l)}}}uploadCommonUniforms(e,n,i,a,l){if(this.uploadCommonLightUniforms(e,n),this.terrain&&this.terrain.renderingToTexture)return;const u=this.style.fog;if(u){const d=u.getOpacity(this.transform.pitch),f=((p,g,_,x,v,b,E,C,T,D,A,P)=>{const I=p.transform,R=g.properties.get("color").toArray01();R[3]=x;const k=p.frameCounter/1e3%1,[L,N]=g.properties.get("vertical-range");return{u_fog_matrix:_?I.calculateFogTileMatrix(_):P||p.identityMat,u_fog_range:g.getFovAdjustedRange(I._fov),u_fog_color:R,u_fog_horizon_blend:g.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(L,N),N],u_fog_temporal_offset:k,u_frustum_tl:v,u_frustum_tr:b,u_frustum_br:E,u_frustum_bl:C,u_globe_pos:T,u_globe_radius:D,u_viewport:A,u_globe_transition:ki(I.zoom),u_is_globe:+("globe"===I.projection.name)}})(this,u,i,d,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*Fe.devicePixelRatio,this.transform.height*Fe.devicePixelRatio],a);n.setFogUniformValues(e,f)}l&&n.setCutoffUniformValues(e,l.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,n=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const a of i)n[a.key]=e[a.key]||new ds(a,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,n){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!n||"batched-model"!==n.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let n=this._cachedTileFogOpacities[e.key];return n||(this._cachedTileFogOpacities[e.key]=n=this.style.fog.getOpacityForTile(e)),n[0]>=ru||n[1]>=ru}}const lf=2048;class IR{constructor(e,n){this.aabb=e,this.lastCascade=n}}class AR{add(e,n){const i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],n.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],n.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],n.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],n.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],n.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],n.max[2])):this.receivers[e.key]=new IR(n,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,n,i){const a=$n.fromPoints(e.points);let l=0;for(const u in this.receivers){const d=this.receivers[u];if(!d||!a.intersectsAabb(d.aabb))continue;d.aabb.min=a.closestPoint(d.aabb.min),d.aabb.max=a.closestPoint(d.aabb.max);const f=d.aabb.getCorners();for(let p=0;p<i.length;p++){let g=!0;for(const _ of f){const x=[_[0]*n,_[1]*n,_[2]];if(G.transformMat4(x,x,i[p].matrix),x[0]<-1||x[0]>1||x[1]<-1||x[1]>1){g=!1;break}}if(d.lastCascade=p,l=Math.max(l,p),g)break}}return l+1}}class Im{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new AR,this._depthMode=new pt(e.context.gl.LEQUAL,pt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,n){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const a=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||a<=0||(this._shadowLayerCount=i.style.order.reduce((v,b)=>{const E=i.style._mergedLayers[b];return v+(E.hasShadowPass()&&!E.isHidden(e.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const l=i.context,u=lf,d=lf;if(0===this._cascades.length)for(let v=0;v<2;++v){const b=i._shadowMapDebug,E=l.gl,C=l.createFramebuffer(u,d,b,"texture"),T=new kr(l,{width:u,height:d,data:null},E.DEPTH_COMPONENT);if(C.depthAttachment.set(T.texture),b){const D=new kr(l,{width:u,height:d,data:null},E.RGBA);C.colorAttachment.set(D.texture)}this._cascades.push({framebuffer:C,texture:T,matrix:[],far:0,boundingSphereRadius:0,frustum:new fl,scale:0})}this.shadowDirection=j0(n);let f=0;if(e.elevation){const v=e.elevation,b=[1e4,-1e4];v.visibleDemTiles.filter(E=>E.dem).forEach(E=>{const C=E.dem.tree;b[0]=Math.min(b[0],C.minimums[0]),b[1]=Math.max(b[1],C.maximums[0])}),1e4!==b[0]&&(f=(b[1]-b[0])*v.exaggeration())}const p=1.5*e.cameraToCenterDistance,g=3*p,_=new Float64Array(16);for(let v=0;v<2;++v){const b=this._cascades[v];let E=e.height/50,C=1;0===v?C=p:(E=p,C=g);const[T,D]=GT(e,this.shadowDirection,E,C,lf,f);b.scale=e.scale,b.matrix=T,b.boundingSphereRadius=D,ne.invert(_,b.matrix),b.frustum=fl.fromInvProjectionMatrix(_,1,0,!0),b.far=C}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=a,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=lf,this._uniformValues.u_shadowmap_0=ps.ShadowMap0,this._uniformValues.u_shadowmap_1=ps.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const x=i.transform.elevation;for(const v of this._groundShadowTiles){let b={min:0,max:0};if(x){const E=x.getMinMaxForTile(v);E&&(b=E)}this.addShadowReceiver(v.toUnwrapped(),b.min,b.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,n){if(!this._enabled)return;const i=this.painter,a=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),a.viewport.set([0,0,lf,lf]);for(let l=0;l<this._numCascadesToRender;++l){i.currentShadowCascade=l,a.bindFramebuffer.set(this._cascades[l].framebuffer.framebuffer),a.clear({color:At.white,depth:1});for(const u of e.order){const d=e._mergedLayers[u];if(!d.hasShadowPass()||d.isHidden(i.transform.zoom))continue;const f=e.getLayerSourceCache(d),p=f?n[f.id]:void 0;("model"===d.type||p&&p.length)&&i.renderLayer(i,f,d,p)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,n=e.style,i=e.context,a=n.directionalLight,l=n.ambientLight;if(!a||!l)return;const u=[],d=ef(e,e.longestCutoffRange);d.shouldRenderCutoff&&u.push("RENDER_CUTOFF");const f=sb(a,l),p=new pt(i.gl.LEQUAL,pt.ReadOnly,e.depthRangeFor3D);for(const g of this._groundShadowTiles){const _=g.toUnwrapped(),x=e.isTileAffectedByFog(g),v=e.getOrCreateProgram("groundShadow",{defines:u,overrideFog:x});this.setupShadows(_,v),e.uploadCommonUniforms(i,v,_,null,d);const b={u_matrix:e.transform.calculateProjMatrix(_),u_ground_shadow_factor:f};v.draw(e,i.gl.TRIANGLES,p,St.disabled,Jt.multiply,Ft.disabled,b,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Jt.unblended:Jt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const n=this.painter.transform,i=n.calculatePosMatrix(e,n.worldSize);return ne.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(e){return ne.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,n,i,a=0){if(!this._enabled)return;const l=this.painter.transform,u=this.painter.context,d=u.gl,f=this._uniformValues,p=new Float64Array(16),g=l.calculatePosMatrix(e,l.worldSize);for(let _=0;_<2;_++)ne.multiply(p,this._cascades[_].matrix,g),f[0===_?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),u.activeTexture.set(d.TEXTURE0+ps.ShadowMap0+_),this._cascades[_].texture.bind(d.NEAREST,d.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const _=Zu(e.canonical),x=2/l.tileSize*le/lf,v=x*this._cascades[0].boundingSphereRadius,b=x*this._cascades[1].boundingSphereRadius,E=("vector-tile"===i?1:3)/Math.pow(2,a-e.canonical.z-(1-l.zoom+Math.floor(l.zoom)));f.u_shadow_normal_offset=[_,v*E,b*E],f.u_shadow_bias=[6e-5,.0012,.012]}else f.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(u,f)}setupShadowsFromMatrix(e,n,i=!1){if(!this._enabled)return;const a=this.painter.context,l=a.gl,u=this._uniformValues,d=new Float64Array(16);for(let f=0;f<2;f++)ne.multiply(d,this._cascades[f].matrix,e),u[0===f?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(d),a.activeTexture.set(l.TEXTURE0+ps.ShadowMap0+f),this._cascades[f].texture.bind(l.NEAREST,l.CLAMP_TO_EDGE);this.useNormalOffset=i,i?(u.u_shadow_normal_offset=[1,5,5],u.u_shadow_bias=[6e-5,.0012,.012]):u.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(a,u)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,n,i,a){if(a[2]>=0)return{};const l=function(f,p,g){const _=g/(1<<f.canonical.z);return new $n([f.canonical.x*_+f.wrap*g,f.canonical.y*_+f.wrap*g,0],[(f.canonical.x+1)*_+f.wrap*g,(f.canonical.y+1)*_+f.wrap*g,p])}(e,n,i).getCorners(),u=n/-a[2];a[0]<0?(G.add(l[0],l[0],[a[0]*u,0,0]),G.add(l[3],l[3],[a[0]*u,0,0])):a[0]>0&&(G.add(l[1],l[1],[a[0]*u,0,0]),G.add(l[2],l[2],[a[0]*u,0,0])),a[1]<0?(G.add(l[0],l[0],[0,a[1]*u,0]),G.add(l[1],l[1],[0,a[1]*u,0])):a[1]>0&&(G.add(l[2],l[2],[0,a[1]*u,0]),G.add(l[3],l[3],[0,a[1]*u,0]));const d={};return d.vertices=l,d.planes=[V0(l[1],l[0],l[4]),V0(l[2],l[1],l[5]),V0(l[3],l[2],l[6]),V0(l[0],l[3],l[7])],d}addShadowReceiver(e,n,i){this._receivers.add(e,$n.fromTileIdAndHeight(e,n,i))}getMaxCascadeForTile(e){const n=this._receivers.get(e);return n&&n.lastCascade?n.lastCascade:0}}function V0(t,e,n){const i=G.sub([],n,e),a=G.sub([],t,e),l=G.cross([],i,a),u=G.length(l);return 0===u?[0,0,1,0]:(G.scale(l,l,1/u),[l[0],l[1],l[2],-G.dot(l,e)])}function j0(t){const e=t.properties.get("direction"),n=Ye(e.x,e.y,e.z);n[2]=We(n[2],0,75);const i=$e([n[0],n[1],n[2]]);return G.fromValues(i.x,i.y,i.z)}function sb(t,e){const n=t.properties.get("color"),i=t.properties.get("intensity"),a=t.properties.get("direction"),l=[a.x,a.y,a.z],u=e.properties.get("color"),d=e.properties.get("intensity"),f=Math.max(G.dot([0,0,1],l),0),p=[0,0,0];G.scale(p,u.toArray01Linear().slice(0,3),d);const g=[0,0,0];return G.scale(g,n.toArray01Linear().slice(0,3),f*i),Fn([p[0]>0?p[0]/(p[0]+g[0]):0,p[1]>0?p[1]/(p[1]+g[1]):0,p[2]>0?p[2]/(p[2]+g[2]):0])}function GT(t,e,n,i,a,l){const u=t.zoom,d=t.scale,f=t.worldSize,p=1/f,g=t.aspect,_=Math.sqrt(1+g*g)*Math.tan(.5*t.fovX),x=_*_,v=i-n,b=i+n;let E,C;x>v/b?(E=i,C=i*_):(E=.5*b*(1+x),C=.5*Math.sqrt(v*v+2*(i*i+n*n)*x+b*b*x*x));const T=t.projection.pixelsPerMeter(t.center.lat,f),D=t._camera.getCameraToWorldMercator(),A=[0,0,-E*p];G.transformMat4(A,A,D);let P=C*p;const I=t._edgeInsets;if(!(0===I.left&&0===I.top&&0===I.right&&0===I.bottom||I.left===I.right&&I.top===I.bottom)){const oe=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?T:1),ce=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,n,i);ce[8]=2*-t.centerOffset.x/t.width,ce[9]=2*t.centerOffset.y/t.height;const de=new Float64Array(16);ne.mul(de,ce,oe);const ge=new Float64Array(16);ne.invert(ge,de);const ae=fl.fromInvProjectionMatrix(ge,f,u,!0);for(const ue of ae.points){const Se=((R=ue)[0]/=d,R[1]/=d,R[2]=vn(R[2],t._center.lat),R);P=Math.max(P,G.len(G.subtract([],A,Se)))}}var R;P*=a/(a-1);const k=Math.acos(e[2]),L=Math.atan2(-e[0],-e[1]),N=new jd;N.position=A,N.setPitchBearing(k,L);const z=N.getWorldToCamera(f,T),j=P*f,B=Math.min(t._mercatorZfromZoom(17)*f*-2,-2*j),H=N.getCameraToClipOrthographic(-j,j,-j,j,B,(j+l*T)/e[2]),V=new Float64Array(16);ne.multiply(V,H,z);const Z=G.fromValues(Math.floor(1e6*A[0])/1e6*f,Math.floor(1e6*A[1])/1e6*f,0),Q=.5*a,te=[0,0,0];G.transformMat4(te,Z,V),G.scale(te,te,Q);const W=[Math.floor(te[0]),Math.floor(te[1]),Math.floor(te[2])],X=[0,0,0];G.sub(X,te,W),G.scale(X,X,-1/Q);const re=new Float64Array(16);return ne.identity(re),ne.translate(re,re,X),ne.multiply(V,re,V),[V,j]}class RA extends wr{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,n){return C1(this.requestManager.transformRequest(n,fe.Model).url).then(i=>{if(!i)return;const a=rT(i),l=new t1(e,void 0,void 0,a);return l.computeBoundsAndApplyParent(),l}).catch(i=>{this.fire(new pe(new Error(`Could not load model ${e} from ${n}: ${i.message}`)))})}load(e,n){this.models[n]||(this.models[n]={});const i=Object.keys(e);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+i.length;const a=[];for(const l of i)a.push(this.loadModel(l,e[l]));Promise.allSettled(a).then(l=>{for(let u=0;u<l.length;u++){const{status:d,value:f}=l[u];"fulfilled"===d&&f&&(this.models[n][i[u]]=f)}this.numModelsLoading[n]-=i.length,this.fire(new Me("data",{dataType:"style"}))}).catch(l=>{this.fire(new pe(new Error(`Could not load models: ${l.message}`)))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,n){return!!this.getModel(e,n)}getModel(e,n){return this.models[n]||(this.models[n]={}),this.models[n][e]}addModel(e,n,i){this.models[i]||(this.models[i]={}),this.hasModel(e,i)&&this.removeModel(e,i),this.load({[e]:this.requestManager.normalizeModelURL(n)},i)}addModels(e,n){const i={};for(const a in e)i[a]=this.requestManager.normalizeModelURL(e[a]);this.load(i,n)}removeModel(e,n){this.models[n]||(this.models[n]={});const i=this.models[n][e];delete this.models[n][e],i.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,n){this.models[n]||(this.models[n]={});for(const i in this.models[n])this.models[n][i].upload(e.context)}}const Am=(t,e)=>Pg(t,e&&e.filter(n=>"source.canvas"!==n.identifier)),OA=Ro(ln,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),ab=Ro(ln,["setCenter","setZoom","setBearing","setPitch"]),lb={version:8,layers:[],sources:{}},qT={duration:300,delay:0},U0=new Set(["fill","line","background","hillshade","raster"]);class Ns extends wr{constructor(e,n={}){super(),this.map=e,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=qe({},qT),this._buildingIndex=new zI(this),this.crossTileSymbolIndex=new Br,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new Jw,this.dispatcher=n.dispatcher?n.dispatcher:new dm(Yd(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new TI,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new Ku(e._requestManager,n.localFontFamily?2:n.localIdeographFontFamily?1:0,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new RA(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",Te());const i=this;this._rtlTextPluginCallback=Ns.registerForPluginStateChange(a=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:a.pluginStatus,pluginURL:a.pluginURL},(l,u)=>{if($i(l),u&&u.every(d=>d))for(const d in i._sourceCaches){const f=i._sourceCaches[d],p=f.getSource().type;"vector"!==p&&"geojson"!==p||f.reload()}})}),this.on("data",a=>{if("source"!==a.dataType||"metadata"!==a.sourceDataType)return;const l=this.getOwnSource(a.sourceId);if(l&&l.vectorLayerIds)for(const u in this._layers){const d=this._layers[u];d.source===l.id&&this._validateLayer(d)}})}loadURL(e,n={}){this.fire(new Me("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!dn(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken),this.resolvedImports.add(e);const a=this.importsCache.get(e);if(a)return this._load(a,i);const l=this.map._requestManager.transformRequest(e,fe.Style);this._request=Ae(l,(u,d)=>{if(this._request=null,u)this.fire(new pe(u));else if(d)return this.importsCache.set(e,d),this._load(d,i)})}loadJSON(e,n={}){this.fire(new Me("dataloading",{dataType:"style"})),this._request=Fe.frame(()=>{this._request=null,this._load(e,!1!==n.validate)})}loadEmpty(){this.fire(new Me("dataloading",{dataType:"style"})),this._load(lb,!1)}_loadImports(e,n){if(this.importDepth>=4)return K("Style doesn't support nesting deeper than 5"),this._reloadImports();const i=[];for(const a of e){const l=this._createFragmentStyle(a),u=new Promise(f=>l.on("style.import.load",f));if(i.push(u),this.resolvedImports.has(a.url)){l.loadEmpty();continue}const d=a.data||this.importsCache.get(a.url);d?l.loadJSON(d,{validate:n}):a.url?l.loadURL(a.url,{validate:n}):l.loadEmpty(),this.fragments.push({style:l,id:a.id,config:a.config})}Promise.all(i).then(()=>this._reloadImports())}_createFragmentStyle(e){const n=this.scope?Pi(e.id,this.scope):e.id,i=new Ns(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return i.setEventedParent(this.map,{style:i}),i.setConfig(e.config),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Me("data",{dataType:"style"})),this.fire(new Me(e?"style.load":"style.import.load"))}_load(e,n){const i=e.schema;if(this.isRootStyle()&&(e.fragment||i&&!1!==e.fragment)){const u=qe({},lb,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(u,n)}if(this.updateSchema(i),n&&Am(this,zo(e)))return;this._loaded=!0,this.stylesheet=U(e);for(const u in e.sources)this.addSource(u,e.sources[u],{validate:!1});this._changes.changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const a=VI(this.stylesheet.layers);if(this._order=a.map(u=>u.id),this.stylesheet.light&&K("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const u=this.stylesheet.lights[0];this.light=new VM(u.properties,u.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new VM(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const u of a){const d=g0(u,this.options);d.setScope(this.scope),d.isConfigDependent&&this._configDependentLayers.add(d.fqid),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize();const f=this.getOwnLayerSourceCache(d),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();f&&d.canCastShadows()&&p&&(f.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const l=this.stylesheet.terrain;if(l&&!this.terrainSetForDrapingOnly()&&this._createTerrain(l,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new Me("data",{dataType:"style"})),e.imports)this._loadImports(e.imports,n);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const u=this.isRootStyle();this._shouldPrecompile=u,this.fire(new Me(u?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,n,i,a,l,u,d,f;this.forEachFragmentStyle(p=>{if(p.stylesheet){if(null!=p.light&&(e=p.light),p.stylesheet.lights)for(const g of p.stylesheet.lights)"ambient"===g.type&&null!=p.ambientLight&&(n=p.ambientLight),"directional"===g.type&&null!=p.directionalLight&&(i=p.directionalLight);(p.stylesheet.terrain||p.stylesheet.projection&&"globe"===p.stylesheet.projection.name)&&null!=p.terrain&&(!a||a&&0===a.drapeRenderMode||1===p.terrain.drapeRenderMode)&&(a=p.terrain),p.stylesheet.fog&&null!=p.fog&&(l=p.fog),null!=p.stylesheet.camera&&(f=p.stylesheet.camera),null!=p.stylesheet.projection&&(u=p.stylesheet.projection),null!=p.stylesheet.transition&&(d=p.stylesheet.transition)}}),this.light=e,this.ambientLight=n,this.directionalLight=i,this.terrain=a,this.fog=l,this.camera=f||{"camera-projection":"perspective"},this.projection=u||{name:"mercator"},this.transition=qe({},qT,d),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const n=i=>{for(const a of i.fragments)n(a.style);e(i)};n(this)}mergeTerrain(){let e;this.forEachFragmentStyle(n=>{null!=n.terrain&&(!e||e&&0===e.drapeRenderMode||1===n.terrain.drapeRenderMode)&&(e=n.terrain)}),this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(n=>{null!=n.stylesheet.projection&&(e=n.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const e={},n={},i={};this.forEachFragmentStyle(a=>{for(const l in a._sourceCaches){const u=Pi(l,a.scope);e[u]=a._sourceCaches[l]}for(const l in a._otherSourceCaches){const u=Pi(l,a.scope);n[u]=a._otherSourceCaches[l]}for(const l in a._symbolSourceCaches){const u=Pi(l,a.scope);i[u]=a._symbolSourceCaches[l]}}),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=i}mergeLayers(){const e={},n=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(l=>{for(const u of l._order){const d=l._layers[u];if("slot"===d.type){const f=Fg(u);if(e[f])continue;e[f]=[]}d.slot&&e[d.slot]?e[d.slot].push(d):n.push(d)}}),this._mergedOrder=[];const a=(l=[])=>{for(const u of l)if("slot"===u.type){const d=Fg(u.id);e[d]&&a(e[d])}else{const d=Pi(u.id,u.scope);this._mergedOrder.push(d),i[d]=u,u.is3D()&&(this._has3DLayers=!0),"circle"===u.type&&(this._hasCircleLayers=!0),"symbol"===u.type&&(this._hasSymbolLayers=!0)}};a(n),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=qe({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(n,i,a){let l,u,d;const f=Fe.devicePixelRatio>1?"@2x":"";let p=Ae(i.transformRequest(i.normalizeSpriteURL(n,f,".json"),fe.SpriteJSON),(x,v)=>{p=null,d||(d=x,l=v,_())}),g=Ct(i.transformRequest(i.normalizeSpriteURL(n,f,".png"),fe.SpriteImage),(x,v)=>{g=null,d||(d=x,u=v,_())});function _(){if(d)a(d);else if(l&&u){const x=Fe.getImageData(u),v={};for(const b in l){const{width:E,height:C,x:T,y:D,sdf:A,pixelRatio:P,stretchX:I,stretchY:R,content:k}=l[b],L=new ur({width:E,height:C});ur.copy(x,L,{x:T,y:D},{x:0,y:0},{width:E,height:C}),v[b]={data:L,pixelRatio:P,sdf:A,stretchX:I,stretchY:R,content:k}}a(null,v)}}return{cancel(){p&&(p.cancel(),p=null),g&&(g.cancel(),g=null)}}}(e,this.map._requestManager,(n,i)=>{if(this._spriteRequest=null,n)this.fire(new pe(n));else if(i)for(const a in i)this.imageManager.addImage(a,this.scope,i[a]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Me("data",{dataType:"style"}))})}_validateLayer(e){const n=this.getOwnSource(e.source);if(!n)return;const i=e.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new pe(new Error(`Source layer "${i}" does not exist on source "${n.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,n)=>{const i=this.fragments[n];return i&&i.style&&(e.data=i.style.serialize()),e})}_serializeSources(){const e={};for(const n in this._sourceCaches){const i=this._sourceCaches[n].getSource();e[i.id]||(e[i.id]=i.serialize())}return e}_serializeLayers(e){const n=[];for(const i of e){const a=this._layers[i];a&&"custom"!==a.type&&n.push(a.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):U0.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const n=this.getOwnLayer(e);if(n)return n;this.fire(new pe(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const n=this.getOwnSource(e);if(n)return n;this.fire(new pe(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const n=this.calculateLightsBrightness();e.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const i=this._changes.changed;if(this._changes.changed){const l=this._changes.getLayerUpdatesByScope();for(const u in l){const{updatedIds:d,removedIds:f}=l[u];(d||f)&&this._updateWorkerLayers(u,d,f)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const a={};for(const l in this._mergedSourceCaches){const u=this._mergedSourceCaches[l];a[l]=u.used,u.used=!1}for(const l of this._mergedOrder){const u=this._mergedLayers[l];if(u.recalculate(e,this._availableImages),!u.isHidden(e.zoom)){const d=this.getOwnLayerSourceCache(u);d&&(d.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let d=u.minzoom||0;d<(u.maxzoom||25.5);d++){const f=this.map.painter;if(f){const p=u.getProgramIds();if(!p)continue;for(const g of p){const _=u.getDefaultProgramParams(g,e.zoom);_&&(f.style=this,this.fog&&(f._fogVisible=!0,_.overrideFog=!0,f.getOrCreateProgram(g,_)),f._fogVisible=!1,_.overrideFog=!1,f.getOrCreateProgram(g,_),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(_.overrideRtt=!0,f.getOrCreateProgram(g,_)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const l in a){const u=this._mergedSourceCaches[l];a[l]!==u.used&&u.getSource().fire(new Me("data",{sourceDataType:"visibility",dataType:"source",sourceId:u.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new Me("data",{dataType:"style"}));for(const{style:l}of this.fragments)l.update(e)}_updateTilesForChangedImages(){const e=Array.from(this._changes.changedImages.keys());if(e.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changes.changedImages.clear()}}_updateWorkerLayers(e,n,i){const a=this.getFragmentStyle(e);this.dispatcher.broadcast("updateLayers",{layers:n?a._serializeLayers(n):[],scope:e,removedIds:i||[],options:a.options})}setState(e){if(this._checkLoaded(),Am(this,zo(e)))return!1;(e=U(e)).layers=VI(e.layers);const n=function(a,l){if(!a)return[{command:ln.setStyle,args:[l]}];let u=[];try{if(!en(a.version,l.version))return[{command:ln.setStyle,args:[l]}];en(a.center,l.center)||u.push({command:ln.setCenter,args:[l.center]}),en(a.zoom,l.zoom)||u.push({command:ln.setZoom,args:[l.zoom]}),en(a.bearing,l.bearing)||u.push({command:ln.setBearing,args:[l.bearing]}),en(a.pitch,l.pitch)||u.push({command:ln.setPitch,args:[l.pitch]}),en(a.sprite,l.sprite)||u.push({command:ln.setSprite,args:[l.sprite]}),en(a.glyphs,l.glyphs)||u.push({command:ln.setGlyphs,args:[l.glyphs]}),en(a.transition,l.transition)||u.push({command:ln.setTransition,args:[l.transition]}),en(a.light,l.light)||u.push({command:ln.setLight,args:[l.light]}),en(a.fog,l.fog)||u.push({command:ln.setFog,args:[l.fog]}),en(a.projection,l.projection)||u.push({command:ln.setProjection,args:[l.projection]}),en(a.lights,l.lights)||u.push({command:ln.setLights,args:[l.lights]}),en(a.camera,l.camera)||u.push({command:ln.setCamera,args:[l.camera]});const d={},f=[];!function(_,x,v,b){let E;for(E in x=x||{},_=_||{})_.hasOwnProperty(E)&&(x.hasOwnProperty(E)||lT(E,v,b));for(E in x){if(!x.hasOwnProperty(E))continue;const C=x[E];_.hasOwnProperty(E)?en(_[E],C)||("geojson"===_[E].type&&"geojson"===C.type&&vm(_,x,E)?v.push({command:ln.setGeoJSONSourceData,args:[E,C.data]}):jI(E,x,v,b)):I1(E,x,v)}}(a.sources,l.sources,f,d);const p=[];a.layers&&a.layers.forEach(_=>{_.source&&d[_.source]?u.push({command:ln.removeLayer,args:[_.id]}):p.push(_)});let g=a.terrain;g&&d[g.source]&&(u.push({command:ln.setTerrain,args:[void 0]}),g=void 0),u=u.concat(f),en(g,l.terrain)||u.push({command:ln.setTerrain,args:[l.terrain]}),function(_,x,v){x=x||[];const b=(_=_||[]).map(bm),E=x.map(bm),C=_.reduce(w0,{}),T=x.reduce(w0,{}),D=b.slice(),A=Object.create(null);let P,I,R,k,L,N,z;for(P=0,I=0;P<b.length;P++)R=b[P],T.hasOwnProperty(R)?I++:(v.push({command:ln.removeLayer,args:[R]}),D.splice(D.indexOf(R,I),1));for(P=0,I=0;P<E.length;P++)R=E[E.length-1-P],D[D.length-1-P]!==R&&(C.hasOwnProperty(R)?(v.push({command:ln.removeLayer,args:[R]}),D.splice(D.lastIndexOf(R,D.length-I),1)):I++,N=D[D.length-P],v.push({command:ln.addLayer,args:[T[R],N]}),D.splice(D.length-P,0,R),A[R]=!0);for(P=0;P<E.length;P++)if(R=E[P],k=C[R],L=T[R],!A[R]&&!en(k,L))if(en(k.source,L.source)&&en(k["source-layer"],L["source-layer"])&&en(k.type,L.type)){for(z in b0(k.layout,L.layout,v,R,null,ln.setLayoutProperty),b0(k.paint,L.paint,v,R,null,ln.setPaintProperty),en(k.slot,L.slot)||v.push({command:ln.setSlot,args:[R,L.slot]}),en(k.filter,L.filter)||v.push({command:ln.setFilter,args:[R,L.filter]}),en(k.minzoom,L.minzoom)&&en(k.maxzoom,L.maxzoom)||v.push({command:ln.setLayerZoomRange,args:[R,L.minzoom,L.maxzoom]}),k)k.hasOwnProperty(z)&&"layout"!==z&&"paint"!==z&&"filter"!==z&&"metadata"!==z&&"minzoom"!==z&&"maxzoom"!==z&&"slot"!==z&&(0===z.indexOf("paint.")?b0(k[z],L[z],v,R,z.slice(6),ln.setPaintProperty):en(k[z],L[z])||v.push({command:ln.setLayerProperty,args:[R,z,L[z]]}));for(z in L)L.hasOwnProperty(z)&&!k.hasOwnProperty(z)&&"layout"!==z&&"paint"!==z&&"filter"!==z&&"metadata"!==z&&"minzoom"!==z&&"maxzoom"!==z&&"slot"!==z&&(0===z.indexOf("paint.")?b0(k[z],L[z],v,R,z.slice(6),ln.setPaintProperty):en(k[z],L[z])||v.push({command:ln.setLayerProperty,args:[R,z,L[z]]}))}else v.push({command:ln.removeLayer,args:[R]}),N=D[D.lastIndexOf(R)+1],v.push({command:ln.addLayer,args:[L,N]})}(p,l.layers,u),function(_=[],x=[],v){x=x||[];const b=(_=_||[]).map(bm),E=x.map(bm),C=_.reduce(w0,{}),T=x.reduce(w0,{}),D=b.slice();let A,P,I,R;for(A=0,P=0;A<b.length;A++)I=b[A],T.hasOwnProperty(I)?P++:(v.push({command:ln.removeImport,args:[I]}),D.splice(D.indexOf(I,P),1));for(A=0,P=0;A<E.length;A++)I=E[E.length-1-A],D[D.length-1-A]!==I&&(C.hasOwnProperty(I)?(v.push({command:ln.removeImport,args:[I]}),D.splice(D.lastIndexOf(I,D.length-P),1)):P++,R=D[D.length-A],v.push({command:ln.addImport,args:[T[I],R]}),D.splice(D.length-A,0,I));for(const k of x){const L=C[k.id];if(!L||en(L,k))continue;en(L.config,k.config)||v.push({command:ln.setImportConfig,args:[k.id,k.config]}),en(L.url,k.url)||v.push({command:ln.setImportUrl,args:[k.id,k.url]});const N=k.data;en(L&&L.data,N)||v.push({command:ln.setImportData,args:[k.id,N]})}}(a.imports,l.imports,u)}catch(d){console.warn("Unable to compute style diff:",d),u=[{command:ln.setStyle,args:[l]}]}return u}(this.serialize(),e).filter(a=>!(a.command in ab));if(0===n.length)return!1;const i=n.filter(a=>!(a.command in OA));if(i.length>0)throw new Error(`Unimplemented: ${i.map(a=>a.command).join(", ")}.`);return n.forEach(a=>{this[a.command].apply(this,a.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,n){return this.getImage(e)?this.fire(new pe(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,n),this._afterImageUpdated(e),this)}updateImage(e,n){this.imageManager.updateImage(e,this.scope,n)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new pe(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(e),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Me("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,n,i={}){return this._checkLoaded(),this._validate(As,`models.${e}`,n,null,i)||(this.modelManager.addModel(e,n,this.scope),this._changes.changed=!0),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new pe(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,n,i={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(qw,`sources.${e}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const a=S1(e,n,this.dispatcher,this);a.scope=this.scope,a.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a.id),source:a.serialize(),sourceId:a.id}));const l=u=>{const d=(u?"symbol:":"other:")+a.id,f=Pi(d,this.scope),p=this._sourceCaches[d]=new fs(f,a,u);(u?this._symbolSourceCaches:this._otherSourceCaches)[a.id]=p,p.onAdd(this.map)};l(!1),"vector"!==n.type&&"geojson"!==n.type||l(!0),a.onAdd&&a.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(e){this._checkLoaded();const n=this.getOwnSource(e);if(!n)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new pe(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new pe(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const i=this.getOwnSourceCaches(e);for(const a of i){const l=Fg(a.id);delete this._sourceCaches[l],delete this._changes.updatedSourceCaches[a.id],a.fire(new Me("data",{sourceDataType:"metadata",dataType:"source",sourceId:a.getSource().id})),a.setEventedParent(null),a.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(e,n){this._checkLoaded(),this.getOwnSource(e).setData(n),this._changes.changed=!0}getOwnSource(e){const n=this.getOwnSourceCache(e);return n&&n.getSource()}getOwnSources(){const e=[];for(const n in this._otherSourceCaches){const i=this.getOwnSourceCache(n);i&&e.push(i.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const a of e){if(this._validate(Dr,"lights",a))return;switch(a.type){case"ambient":if(this.ambientLight){const l=this.ambientLight;l.set(a),l.updateTransitions(n)}else this.ambientLight=new iu(a,II,this.scope,this.options);break;case"directional":if(this.directionalLight){const l=this.directionalLight;l.set(a),l.updateTransitions(n)}else this.directionalLight=new iu(a,AI,this.scope,this.options)}}const i=new tr(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,n=this.ambientLight;if(!e||!n)return;const i=_=>.2126*(_[0]<=.03928?_[0]/12.92:Math.pow((_[0]+.055)/1.055,2.4))+.7152*(_[1]<=.03928?_[1]/12.92:Math.pow((_[1]+.055)/1.055,2.4))+.0722*(_[2]<=.03928?_[2]/12.92:Math.pow((_[2]+.055)/1.055,2.4)),a=e.properties.get("color").toArray01(),l=e.properties.get("intensity"),u=e.properties.get("direction"),d=1-Ye(u.x,u.y,u.z)[2]/90,f=i(a)*l*d,p=n.properties.get("color").toArray01(),g=n.properties.get("intensity");return(f+i(p)*g)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;const n=this.fragments.find(({id:i})=>i===e);if(!n)throw new Error(`Style import not found: ${e}`);return n.style}setConfigProperty(e,n,i){const a=Vl(i);if("success"!==a.result)return void Am(this,a.value);const l=a.value.expression,u=this.getFragmentStyle(e);u.options.set(n,l),u.updateConfigDependencies()}setConfig(e,n){if(this.options.clear(),e){for(const i in e){const a=Vl(e[i]);"success"===a.result&&this.options.set(i,a.value.expression)}this.updateSchema(n)}}updateSchema(e){if(e)for(const n in e){if(this.options.has(n))continue;const i=Vl(e[n].default);"success"===i.result&&this.options.set(n,i.value.expression)}}updateConfigDependencies(){for(const e of this._configDependentLayers){const n=this.getLayer(e);n&&(n.possiblyEvaluateVisibility(),this._updateLayer(n))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(e,n,i={}){this._checkLoaded();const a=e.id;if(this._layers[a])return void this.fire(new pe(new Error(`Layer with id "${a}" already exists on this map`)));let l;if("custom"===e.type){if(Am(this,function(g){const _=[],x=g.id;return void 0===x&&_.push({message:`layers.${x}: missing required property "id"`}),void 0===g.render&&_.push({message:`layers.${x}: missing required method "render"`}),g.renderingMode&&"2d"!==g.renderingMode&&"3d"!==g.renderingMode&&_.push({message:`layers.${x}: property "renderingMode" must be either "2d" or "3d"`}),_}(e)))return;l=g0(e,this.options)}else{if("object"==typeof e.source&&(this.addSource(a,e.source),e=qe(e=U(e),{source:a})),this._validate(Qo,`layers.${a}`,e,{arrayIndex:-1},i))return;l=g0(e,this.options),this._validateLayer(l),l.setEventedParent(this,{layer:{id:a}}),this._serializedLayers[l.id]=l.serialize()}l.isConfigDependent&&this._configDependentLayers.add(l.fqid),l.setScope(this.scope);const u=n?this._order.indexOf(n):this._order.length;if(n&&-1===u)return void this.fire(new pe(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(u,0,a),this._layerOrderChanged=!0,this._layers[a]=l;const d=this.getOwnLayerSourceCache(l),f=!!this.directionalLight&&this.directionalLight.shadowsEnabled();d&&l.canCastShadows()&&f&&(d.castsShadows=!0);const p=this._changes.getRemovedLayer(l);if(p&&l.source&&d&&"custom"!==l.type){this._changes.discardLayerRemoval(l);const g=Pi(l.source,l.scope);p.type!==l.type?this._changes.updatedSourceCaches[g]="clear":(this._changes.updatedSourceCaches[g]="reload",d.pause())}this._updateLayer(l),l.onAdd&&l.onAdd(this.map),l.scope=this.scope,this.mergeLayers()}moveLayer(e,n){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(e)||e===n)return;const i=this._order.indexOf(e);this._order.splice(i,1);const a=n?this._order.indexOf(n):this._order.length;n&&-1===a?this.fire(new pe(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(a,0,e),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(e){this._checkLoaded();const n=this._checkLayer(e);if(!n)return;n.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const a=this.getOwnLayerSourceCache(n);if(a&&a.castsShadows){let l=!1;for(const u in this._layers)if(this._layers[u].source===n.source&&this._layers[u].canCastShadows()){l=!0;break}a.castsShadows=l}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const n in this._layers)if(this._layers[n].type===e)return!0;return!1}setLayerZoomRange(e,n,i){this._checkLoaded();const a=this._checkLayer(e);a&&(a.minzoom===n&&a.maxzoom===i||(null!=n&&(a.minzoom=n),null!=i&&(a.maxzoom=i),this._updateLayer(a)))}setSlot(e,n){this._checkLoaded();const i=this._checkLayer(e);i&&i.slot!==n&&(i.slot=n,this._updateLayer(i))}setFilter(e,n,i={}){this._checkLoaded();const a=this._checkLayer(e);if(a&&!en(a.filter,n))return null==n?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(Qy,`layers.${a.id}.filter`,n,{layerType:a.type},i)||(a.filter=U(n),this._updateLayer(a)))}getFilter(e){const n=this._checkLayer(e);if(n)return U(n.filter)}setLayoutProperty(e,n,i,a={}){this._checkLoaded();const l=this._checkLayer(e);l&&(en(l.getLayoutProperty(n),i)||(l.setLayoutProperty(n,i,a),l.isConfigDependent&&this._configDependentLayers.add(l.fqid),this._updateLayer(l)))}getLayoutProperty(e,n){const i=this._checkLayer(e);if(i)return i.getLayoutProperty(n)}setPaintProperty(e,n,i,a={}){this._checkLoaded();const l=this._checkLayer(e);if(!l||en(l.getPaintProperty(n),i))return;const u=l.setPaintProperty(n,i,a);l.isConfigDependent&&this._configDependentLayers.add(l.fqid),u&&this._updateLayer(l),this._changes.changed=!0,this._changes.updatedPaintProps.add(l.fqid)}getPaintProperty(e,n){const i=this._checkLayer(e);if(i)return i.getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const i=e.source,a=e.sourceLayer,l=this._checkSource(i);if(!l)return;const u=l.type;if("geojson"===u&&a)return void this.fire(new pe(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===u&&!a)return void this.fire(new pe(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new pe(new Error("The feature id parameter must be provided.")));const d=this.getOwnSourceCaches(i);for(const f of d)f.setFeatureState(a,e.id,n)}removeFeatureState(e,n){this._checkLoaded();const i=e.source,a=this._checkSource(i);if(!a)return;const l=a.type,u="vector"===l?e.sourceLayer:void 0;if("vector"===l&&!u)return void this.fire(new pe(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new pe(new Error("A feature id is required to remove its specific state property.")));const d=this.getOwnSourceCaches(i);for(const f of d)f.removeFeatureState(u,e.id,n)}getFeatureState(e){this._checkLoaded();const n=e.source,i=e.sourceLayer,a=this._checkSource(n);if(a){if("vector"!==a.type||i)return void 0===e.id&&this.fire(new pe(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(i,e.id);this.fire(new pe(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=qe({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return qe({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),n=e&&this.terrain&&this.terrain.scope===this.scope?e:void 0;return Ie({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},i=>void 0!==i)}_updateLayer(e){this._changes.updateLayer(e);const n=this.getLayerSourceCache(e),i=Pi(e.source,e.scope);e.source&&!this._changes.updatedSourceCaches[i]&&n&&"raster"!==n.getSource().type&&(this._changes.updatedSourceCaches[i]="reload",n.pause()),this._changes.changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const n=d=>"fill-extrusion"===this._mergedLayers[d].type,i=this.order,a={},l=[];for(let d=i.length-1;d>=0;d--){const f=i[d];if(n(f)){a[f]=d;for(const p of e){const g=p[f];if(g)for(const _ of g)l.push(_)}}}l.sort((d,f)=>f.intersectionZ-d.intersectionZ);const u=[];for(let d=i.length-1;d>=0;d--){const f=i[d];if(n(f))for(let p=l.length-1;p>=0;p--){const g=l[p].feature;if(a[g.layer.id]<d)break;u.push(g),l.pop()}else for(const p of e){const g=p[f];if(g)for(const _ of g)u.push(_.feature)}}return u}queryRenderedFeatures(e,n,i){n&&n.filter&&this._validate(Qy,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;const a={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new pe(new Error("parameters.layers must be an Array."))),[];for(const p of n.layers){const g=this._mergedLayers[p];if(!g)return this.fire(new pe(new Error(`The layer '${p}' does not exist in the map's style and cannot be queried for features.`))),[];a[g.source]=!0}}const l=[],u=n.serializedLayers||{},d=n&&n.layers?n.layers.some(p=>{const g=this.getLayer(p);return g&&g.is3D()}):this.has3DLayers(),f=ou.createFromScreenPoints(e,i);for(const p in this._mergedSourceCaches){const g=this._mergedSourceCaches[p].getSource();if(!g||g.scope!==n.scope)continue;const _=this._mergedSourceCaches[p].getSource().id;n.layers&&!a[_]||l.push(oT(this._mergedSourceCaches[p],this._mergedLayers,u,f,n,i,d,!!this.map._showQueryGeometry))}return this.placement&&l.push(function(p,g,_,x,v,b,E){const C={},T=b.queryRenderedSymbols(x),D=[];for(const A of Object.keys(T).map(Number))D.push(E[A]);D.sort(sT);for(const A of D){const P=A.featureIndex.lookupSymbolFeatures(T[A.bucketInstanceId],g,A.bucketIndex,A.sourceLayerIndex,v.filter,v.layers,v.availableImages,p);for(const I in P){const R=C[I]=C[I]||[],k=P[I];k.sort((L,N)=>{const z=A.featureSortOrder;if(z){const j=z.indexOf(L.featureIndex);return z.indexOf(N.featureIndex)-j}return N.featureIndex-L.featureIndex});for(const L of k)R.push(L)}}for(const A in C)C[A].forEach(P=>{const I=P.feature,R=_(p[A]);if(!R)return;const k=R.getFeatureState(I.layer["source-layer"],I.id);I.source=I.layer.source,I.layer["source-layer"]&&(I.sourceLayer=I.layer["source-layer"]),I.state=k});return C}(this._mergedLayers,u,this.getLayerSourceCache.bind(this),f.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)}querySourceFeatures(e,n){n&&n.filter&&this._validate(Qy,"querySourceFeatures.filter",n.filter,null,n);const i=this.getOwnSourceCaches(e);let a=[];for(const l of i)a=a.concat(xm(l,n));return a}addSourceType(e,n,i){return Ns.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(Ns.setSourceType(e,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:n.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,n,i={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const d in e)if(!en(e[d],a[d])){l=!0;break}if(!l)return;const u=this._getTransitionParameters();this.light.setLight(e,n,i),this.light.updateTransitions(u)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,n=1){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let i=e;if(1===n){if("object"==typeof i.source){const a="terrain-dem-src";this.addSource(a,i.source),i=U(i),i=qe(i,{source:a})}if(this._validate(Ky,"terrain",i))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode){if(!i)return;this._createTerrain(i,n),this.fire(new Me("data",{dataType:"style"}))}else{const a=this.terrain,l=a.get();for(const u of Object.keys(J.terrain))!i.hasOwnProperty(u)&&J.terrain[u].default&&(i[u]=J.terrain[u].default);for(const u in e)if(!en(e[u],l[u])){a.set(e),this.stylesheet.terrain=e;const d=this._getTransitionParameters({duration:0});a.updateTransitions(d),this.fire(new Me("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const n=this.fog=new HM(e,this.map.transform);this.stylesheet.fog=n.get();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!en(n.get(),e)){n.set(e),this.stylesheet.fog=n.get();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:Fe.now(),transition:qe(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],n=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?e.push(i):n.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...n)}_createTerrain(e,n){const i=this.terrain=new SI(e,n);i.setScope(this.scope),this.stylesheet.terrain=e,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const a=this._getTransitionParameters({duration:0});i.updateTransitions(a)}_force3DLayerUpdate(){for(const e in this._layers){const n=this._layers[e];"fill-extrusion"===n.type&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const n=this._layers[e];"symbol"===n.type&&this._updateLayer(n)}}_validate(e,n,i,a,l={}){if(l&&!1===l.validate)return!1;const u=qe({},this.serialize());return Am(this,e.call(zo,qe({key:n,style:u,value:i,styleSpec:J},a)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Pu.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const n=this.getSourceCaches(e);for(const i of n)i.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const n=this.getSourceCaches(e);for(const i of n)i.resume(),i.reload()}updateSources(e){let n;this.directionalLight&&(n=j0(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,n)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const n=this._sourceCaches[e];n.resume(),n.reload()}}_updatePlacement(e,n,i,a,l=!1){let u=!1,d=!1;const f={},p={};for(const g of this._mergedOrder){const _=this._mergedLayers[g];if("symbol"!==_.type)continue;const x=Pi(_.source,_.scope);let v=f[x];if(!v){const E=this.getLayerSourceCache(_);if(!E)continue;const C=E.getRenderableIds(!0).map(T=>E.getTileByID(T));p[x]=C.slice(),v=f[x]=C.sort((T,D)=>D.tileID.overscaledZ-T.tileID.overscaledZ||(T.tileID.isLessThan(D.tileID)?-1:1))}const b=this.crossTileSymbolIndex.addLayer(_,v,e.center.lng,e.projection);u=u||b}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),l=l||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new Me("neworder")),(l||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Fe.now(),e.zoom))&&(this.pauseablePlacement=new KI(e,this._mergedOrder,l,n,i,a,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,f,p),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Fe.now()),d=!0),u&&this.pauseablePlacement.placement.setStale()),d||u)for(const g of this._mergedOrder){const _=this._mergedLayers[g];"symbol"===_.type&&this.placement.updateLayerOpacities(_,f[Pi(_.source,_.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Fe.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==n.findIndex(({id:a})=>a===e.id)?this.fire(new pe(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(n.push(e),this._loadImports([e],!0),this)}setImportUrl(e,n){this._checkLoaded();const i=this.stylesheet.imports||[],a=this.getImportIndex(e);if(-1===a)return this;i[a].url=n;const l=this.fragments[a];l.style=this._createFragmentStyle({id:e,url:n});const u=new Promise(d=>l.style.on("style.import.load",d));return l.style.loadURL(n),u.then(()=>this._reloadImports()),this}setImportData(e,n){this._checkLoaded();const i=this.getImportIndex(e),a=this.stylesheet.imports||[];return-1===i?this:n?(this.fragments[i].style.setState(n),this._reloadImports(),this):(delete a[i].data,this.setImportUrl(e,a[i].url))}setImportConfig(e,n){this._checkLoaded();const i=this.getImportIndex(e),a=this.stylesheet.imports||[];if(-1===i)return this;n?a[i].config=n:delete a[i].config;const l=this.fragments[i],u=l.style.stylesheet&&l.style.stylesheet.schema;return l.config=n,l.style.setConfig(n,u),l.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(e);return-1===i||(n.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(e){const n=(this.stylesheet.imports||[]).findIndex(i=>i.id===e);return-1===n&&this.fire(new pe(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),n}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const n in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[n];i&&e.push(i.getSource())}return e}getSource(e,n){const i=this.getSourceCache(e,n);return i&&i.getSource()}getLayerSource(e){const n=this.getLayerSourceCache(e);return n&&n.getSource()}getSourceCache(e,n){const i=Pi(e,n);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(e){const n=Pi(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){const n=[];return this._mergedOtherSourceCaches[e]&&n.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&n.push(this._mergedSymbolSourceCaches[e]),n}updateSourceCaches(){for(const e in this._changes.updatedSourceCaches){const n=this._changes.updatedSourceCaches[e];"reload"===n?this.reloadSource(e):"clear"===n&&this.clearSource(e)}}updateLayers(e){for(const n of this._changes.updatedPaintProps){const i=this.getLayer(n);i&&i.updateTransitions(e)}}getImages(e,n,i){this.imageManager.getImages(n.icons,n.scope,i),this._updateTilesForChangedImages();const a=l=>{l&&l.setDependencies(n.tileID.key,n.type,n.icons)};a(this._otherSourceCaches[n.source]),a(this._symbolSourceCaches[n.source])}getGlyphs(e,n,i){this.glyphManager.getGlyphs(n.stacks,n.scope,i)}getResource(e,n,i){return Pe(n,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const n=[];return this._otherSourceCaches[e]&&n.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&n.push(this._symbolSourceCaches[e]),n}_isSourceCacheLoaded(e){const n=this.getOwnSourceCaches(e);return 0===n.length?(this.fire(new pe(new Error(`There is no source with ID '${e}'`))),!1):n.every(i=>i.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function kA(t,e){let n=!1,i=null;const a=()=>{i=null,n&&(t(),i=setTimeout(a,e),n=!1)};return()=>(n=!0,i||a(),i)}Ns.getSourceType=function(t){return Kd[t]},Ns.setSourceType=function(t,e){Kd[t]=e},Ns.registerForPluginStateChange=function(t){return t({pluginStatus:es,pluginURL:zc}),Pu.on("pluginStateChange",t),t};class ZT{constructor(e){this._hashName=e&&encodeURIComponent(e),ui(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kA(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,ie.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),ie.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const n=WT(e);if(this._hashName){const i=this._hashName;let a=!1;const l=ie.location.hash.slice(1).split("&").map(u=>{const d=u.split("=")[0];return d===i?(a=!0,`${d}=${n}`):u}).filter(u=>u);return a||l.push(`${i}=${n}`),`#${l.join("&")}`}return`#${n}`}_getCurrentHash(){const e=ie.location.hash.replace("#","");if(this._hashName){let n;return e.split("&").map(i=>i.split("=")).forEach(i=>{i[0]===this._hashName&&(n=i)}),(n&&n[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(i=>isNaN(i))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(n[3]||0):e.getBearing();return e.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:i,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=ie.location.href.replace(/(#.+)?$/,this.getHashString());ie.history.replaceState(ie.history.state,null,e)}}function WT(t,e){const n=t.getCenter(),i=Math.round(100*t.getZoom())/100,a=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,a),u=Math.round(n.lng*l)/l,d=Math.round(n.lat*l)/l,f=t.getBearing(),p=t.getPitch();let g=e?`/${u}/${d}/${i}`:`${i}/${d}/${u}`;return(f||p)&&(g+="/"+Math.round(10*f)/10),p&&(g+=`/${Math.round(p)}`),g}const Pm={linearity:.3,easing:Mc(0,0,.3,1)},cf=qe({deceleration:2500,maxSpeed:1400},Pm),LA=qe({deceleration:20,maxSpeed:1400},Pm),XT=qe({deceleration:1e3,maxSpeed:360},Pm),cb=qe({deceleration:1e3,maxSpeed:90},Pm);class PR{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Fe.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=Fe.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new ee(0,0),pinchAround:void 0,around:void 0};for(const{settings:l}of this._inertiaBuffer)n.zoom+=l.zoomDelta||0,n.bearing+=l.bearingDelta||0,n.pitch+=l.pitchDelta||0,l.panDelta&&n.pan._add(l.panDelta),l.around&&(n.around=l.around),l.pinchAround&&(n.pinchAround=l.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(n.pan.mag()){const l=ub(n.pan.mag(),i,qe({},cf,e||{}));a.offset=n.pan.mult(l.amount/n.pan.mag()),a.center=this._map.transform.center,$0(a,l)}if(n.zoom){const l=ub(n.zoom,i,LA);a.zoom=this._map.transform.zoom+l.amount,$0(a,l)}if(n.bearing){const l=ub(n.bearing,i,XT);a.bearing=this._map.transform.bearing+We(l.amount,-179,179),$0(a,l)}if(n.pitch){const l=ub(n.pitch,i,cb);a.pitch=this._map.transform.pitch+l.amount,$0(a,l)}if(a.zoom||a.bearing){const l=void 0===n.pinchAround?n.around:n.pinchAround;a.around=l?this._map.unproject(l):this._map.getCenter()}return this.clear(),a.noMoveStart=!0,a}}function $0(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function ub(t,e,n){const{maxSpeed:i,linearity:a,deceleration:l}=n,u=We(t*a/(e/1e3),-i,i),d=Math.abs(u)/(l*a);return{easing:n.easing,duration:1e3*d,amount:u*(d/2)}}class zs extends Me{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i,a={}){const l=Sf(n.getCanvasContainer(),i);super(e,qe({point:l,lngLat:n.unproject(l),originalEvent:i},a)),this._defaultPrevented=!1,this.target=n}}class H0 extends Me{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){const a="touchend"===e?i.changedTouches:i.touches,l=ar(n.getCanvasContainer(),a),u=l.map(f=>n.unproject(f)),d=l.reduce((f,p,g,_)=>f.add(p.div(_.length)),new ee(0,0));super(e,{points:l,point:d,lngLats:u,lngLat:n.unproject(d),originalEvent:i}),this._defaultPrevented=!1}}class FA extends Me{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class YT{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new FA(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new zs(e.type,this._map,e))}mouseup(e){this._map.fire(new zs(e.type,this._map,e))}preclick(e){const n=qe({},e);n.type="preclick",this._map.fire(new zs(n.type,this._map,n))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(e),this._map.fire(new zs(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new zs(e.type,this._map,e))}mouseover(e){this._map.fire(new zs(e.type,this._map,e))}mouseout(e){this._map.fire(new zs(e.type,this._map,e))}touchstart(e){return this._firePreventable(new H0(e.type,this._map,e))}touchmove(e){this._map.fire(new H0(e.type,this._map,e))}touchend(e){this._map.fire(new H0(e.type,this._map,e))}touchcancel(e){this._map.fire(new H0(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class JT{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new zs(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new zs(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class NA{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&0===e.button&&(er(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const i=n,a=this._startPos,l=this._lastPos;if(!a||!l||l.equals(i)||!this._box&&i.dist(a)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=Cn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const u=Math.min(a.x,i.x),d=Math.max(a.x,i.x),f=Math.min(a.y,i.y),p=Math.max(a.y,i.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${u}px,${f}px)`,this._box.style.width=d-u+"px",this._box.style.height=p-f+"px")})}mouseupWindow(e,n){if(!this._active)return;const i=this._startPos,a=n;if(i&&0===e.button){if(this.reset(),Df(),i.x!==a.x||i.y!==a.y)return this._map.fire(new Me("boxzoomend",{originalEvent:e})),{cameraAnimation:l=>l.fitScreenCoordinates(i,a,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Cf(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new Me(e,{originalEvent:n}))}}function G0(t,e){const n={};for(let i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}class KT{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(a){const l=new ee(0,0);for(const u of a)l._add(u);return l.div(a.length)}(n),this.touches=G0(i,n)))}touchmove(e,n,i){if(this.aborted||!this.centroid)return;const a=G0(i,n);for(const l in this.touches){const u=a[l];(!u||u.dist(this.touches[l])>30)&&(this.aborted=!0)}}touchend(e,n,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}class hb{constructor(e){this.singleTap=new KT(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,n,i){this.singleTap.touchstart(e,n,i)}touchmove(e,n,i){this.singleTap.touchmove(e,n,i)}touchend(e,n,i){const a=this.singleTap.touchend(e,n,i);if(a){const l=e.timeStamp-this.lastTime<500,u=!this.lastTap||this.lastTap.dist(a)<30;if(l&&u||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}class zA{constructor(){this._zoomIn=new hb({numTouches:1,numTaps:2}),this._zoomOut=new hb({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,i){this._zoomIn.touchstart(e,n,i),this._zoomOut.touchstart(e,n,i)}touchmove(e,n,i){this._zoomIn.touchmove(e,n,i),this._zoomOut.touchmove(e,n,i)}touchend(e,n,i){const a=this._zoomIn.touchend(e,n,i),l=this._zoomOut.touchend(e,n,i);return a?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:u.getZoom()+1,around:u.unproject(a)},{originalEvent:e})}):l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:u.getZoom()-1,around:u.unproject(l)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const QT={0:1,2:2};class db{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,n){return!1}_move(e,n){return{}}mousedown(e,n){if(this._lastPoint)return;const i=qt(e);this._correctButton(e,i)&&(this._lastPoint=n,this._eventButton=i)}mousemoveWindow(e,n){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(a,l){const u=QT[l];return void 0===a.buttons||(a.buttons&u)!==u}(e,this._eventButton))this.reset();else if(this._moved||!(n.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(i,n)}mouseupWindow(e){this._lastPoint&&qt(e)===this._eventButton&&(this._moved&&Df(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eC extends db{mousedown(e,n){super.mousedown(e,n),this._lastPoint&&(this._active=!0)}_correctButton(e,n){return 0===n&&!e.ctrlKey}_move(e,n){return{around:n,panDelta:n.sub(e)}}}class fb extends db{_correctButton(e,n){return 0===n&&e.ctrlKey||2===n}_move(e,n){const i=.8*(n.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class pb extends db{_correctButton(e,n){return 0===n&&e.ctrlKey||2===n}_move(e,n){const i=-.5*(n.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class tC{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),ui(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new ee(0,0)}touchstart(e,n,i){return this._calculateTransform(e,n,i)}touchmove(e,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!gt())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,n,i)}}touchend(e,n,i){this._calculateTransform(e,n,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,i){i.length>0&&(this._active=!0);const a=G0(i,n),l=new ee(0,0),u=new ee(0,0);let d=0;for(const p in a){const g=a[p],_=this._touches[p];_&&(l._add(g),u._add(g.sub(_)),d++,a[p]=g)}if(this._touches=a,d<this._minTouches||!u.mag())return;const f=u.div(d);return this._sum._add(f),this._sum.mag()<this._clickTolerance?void 0:{around:l.div(d),panDelta:f}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Cn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class mb{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,n,i){return{}}touchstart(e,n,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,i){const a=this._firstTwoTouches;if(!a)return;e.preventDefault();const[l,u]=a,d=q0(i,n,l),f=q0(i,n,u);if(!d||!f)return;const p=this._aroundCenter?null:d.add(f).div(2);return this._move([d,f],p,e)}touchend(e,n,i){if(!this._firstTwoTouches)return;const[a,l]=this._firstTwoTouches,u=q0(i,n,a),d=q0(i,n,l);u&&d||(this._active&&Df(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function q0(t,e,n){for(let i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function BA(t,e){return Math.log(t/e)/Math.LN2}class nC extends mb{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(BA(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:BA(this._distance,i),pinchAround:n}}}function VA(t,e){return 180*t.angleWith(e)/Math.PI}class RR extends mb{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:VA(this._vector,i),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const a=VA(e,i);return Math.abs(a)<n}}function rC(t){return Math.abs(t.y)>Math.abs(t.x)}class OR extends mb{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,rC(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,i){const a=this._lastPoints;if(!a)return;const l=e[0].sub(a[0]),u=e[1].sub(a[1]);return this._map._cooperativeGestures&&!gt()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(l,u,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+u.y)/2*-.5})}gestureBeginsVertically(e,n,i){if(void 0!==this._valid)return this._valid;const a=e.mag()>=2,l=n.mag()>=2;if(!a&&!l)return;if(!a||!l)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const u=e.y>0==n.y>0;return rC(e)&&rC(n)&&u}}const kR={panStep:100,bearingStep:15,pitchStep:10};class LR{constructor(){const e=kR;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,i=0,a=0,l=0,u=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),l=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),l=1);break;case 38:e.shiftKey?a=1:(e.preventDefault(),u=-1);break;case 40:e.shiftKey?a=-1:(e.preventDefault(),u=1);break;default:return}return this._rotationDisabled&&(i=0,a=0),{cameraAnimation:d=>{const f=d.getZoom();d.easeTo({duration:300,easeId:"keyboardHandler",easing:FR,zoom:n?Math.round(f)+n*(e.shiftKey?2:1):f,bearing:d.getBearing()+i*this._bearingStep,pitch:d.getPitch()+a*this._pitchStep,offset:[-l*this._panStep,-u*this._panStep],center:d.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function FR(t){return t*(2-t)}const jA=4.000244140625;class NR{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,ui(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||gt()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===ie.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=Fe.now(),a=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%jA==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":a>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(a*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Sf(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const p="wheel"===this._type&&Math.abs(this._delta)>jA?this._wheelZoomRate:this._defaultZoomRate;let g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&0!==g&&(g=1/g);const _=n(),x=Math.pow(2,_),v="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):x;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(v*g))),"wheel"===this._type&&(this._startZoom=_,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),a=this._startZoom,l=this._easing;let u,d=!1;if("wheel"===this._type&&a&&l){const p=Math.min((Fe.now()-this._lastWheelEventTime)/200,1);u=ut(a,i,l(p)),p<1?this._frameId||(this._frameId=!0):d=!0}else u=i,d=!0;this._active=!0,d&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let f=u-n();return f*this._lastDelta<0&&(f=0),{noInertia:!0,needsRenderFrame:!d,zoomDelta:f,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=Un;if(this._prevEase){const i=this._prevEase,a=(Fe.now()-i.start)/i.duration,l=i.easing(a+.01)-i.easing(a),u=.27/Math.sqrt(l*l+1e-4)*.01;n=Mc(u,Math.sqrt(.0729-u*u),.25,1)}return this._prevEase={start:Fe.now(),duration:e,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Cn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(ie.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class gb{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _b{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,n){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iC{constructor(){this._tap=new hb({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,n,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=n[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,n,i))}touchmove(e,n,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const a=n[0],l=a.y-this._swipePoint.y;return this._swipePoint=a,e.preventDefault(),this._active=!0,{zoomDelta:l/128}}}else this._tap.touchmove(e,n,i)}touchend(e,n,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,n,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class UA{constructor(e,n,i){this._el=e,this._mousePan=n,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fc{constructor(e,n,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $A{constructor(e,n,i,a){this._el=e,this._touchZoom=n,this._touchRotate=i,this._tapDragZoom=a,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const yb=t=>t.zoom||t.drag||t.pitch||t.rotate;class zR extends Me{}class HA{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,n){const i=G.sub([],n,e);this.radius=G.length(i[2]<0?G.div([],i,this.constants):[i[0],i[1],0])}projectRay(e){G.div(e,e,this.constants),G.normalize(e,e),G.mul(e,e,this.constants);const n=G.scale([],e,this.radius);if(n[2]>0){const i=G.scale([],[0,0,1],G.dot(n,[0,0,1])),a=G.scale([],G.normalize([],[n[0],n[1],0]),this.radius),l=G.add([],n,G.scale([],G.sub([],G.add([],a,i),n),2));n[0]=l[0],n[1]=l[1]}return n}}function lh(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class GA{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new PR(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new HA,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),ui(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[ie.document,"mousemove",{capture:!0}],[ie.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[ie,"blur",void 0]];for(const[a,l,u]of this._listeners)a.addEventListener(l,a===ie.document?this.handleWindowEvent:this.handleEvent,u)}destroy(){for(const[e,n,i]of this._listeners)e.removeEventListener(n,e===ie.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const n=this._map,i=n.getCanvasContainer();this._add("mapEvent",new YT(n,e));const a=n.boxZoom=new NA(n,e);this._add("boxZoom",a);const l=new zA,u=new _b;n.doubleClickZoom=new gb(u,l),this._add("tapZoom",l),this._add("clickZoom",u);const d=new iC;this._add("tapDragZoom",d);const f=n.touchPitch=new OR(n);this._add("touchPitch",f);const p=new fb(e),g=new pb(e);n.dragRotate=new fc(e,p,g),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",g,["mouseRotate"]);const _=new eC(e),x=new tC(n,e);n.dragPan=new UA(i,_,x),this._add("mousePan",_),this._add("touchPan",x,["touchZoom","touchRotate"]);const v=new RR,b=new nC;n.touchZoomRotate=new $A(i,b,v,d),this._add("touchRotate",v,["touchPan","touchZoom"]),this._add("touchZoom",b,["touchPan","touchRotate"]),this._add("blockableMapEvent",new JT(n));const E=n.scrollZoom=new NR(n,this);this._add("scrollZoom",E,["mousePan"]);const C=n.keyboard=new LR;this._add("keyboard",C);for(const T of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[T]&&n[T].enable(e[T])}_add(e,n,i){this._handlers.push({handlerName:e,handler:n,allowed:i}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yb(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,n,i){for(const a in e)if(a!==i&&(!n||n.indexOf(a)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const n=[];for(const i of e)this._el.contains(i.target)&&n.push(i);return n}handleEvent(e,n){this._updatingCamera=!0;const i="renderFrame"===e.type,a=i?void 0:e,l={needsRenderFrame:!1},u={},d={},f=e.touches?this._getMapTouches(e.touches):void 0,p=f?ar(this._el,f):i?void 0:Sf(this._el,e);for(const{handlerName:x,handler:v,allowed:b}of this._handlers){if(!v.isEnabled())continue;let E;this._blockedByActive(d,b,x)?v.reset():v[n||e.type]&&(E=v[n||e.type](e,p,f),this.mergeHandlerResult(l,u,E,x,a),E&&E.needsRenderFrame&&this._triggerRenderFrame()),(E||v.isActive())&&(d[x]=v)}const g={};for(const x in this._previousActiveHandlers)d[x]||(g[x]=a);this._previousActiveHandlers=d,(Object.keys(g).length||lh(l))&&(this._changes.push([l,u,g]),this._triggerRenderFrame()),(Object.keys(d).length||lh(l))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:_}=l;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))}mergeHandlerResult(e,n,i,a,l){if(!i)return;qe(e,i);const u={handlerName:a,originalEvent:i.originalEvent||l};void 0!==i.zoomDelta&&(n.zoom=u),void 0!==i.panDelta&&(n.drag=u),void 0!==i.pitchDelta&&(n.pitch=u),void 0!==i.bearingDelta&&(n.rotate=u)}_applyChanges(){const e={},n={},i={};for(const[a,l,u]of this._changes)a.panDelta&&(e.panDelta=(e.panDelta||new ee(0,0))._add(a.panDelta)),a.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(e.around=a.around),void 0!==a.aroundCoord&&(e.aroundCoord=a.aroundCoord),void 0!==a.pinchAround&&(e.pinchAround=a.pinchAround),a.noInertia&&(e.noInertia=a.noInertia),qe(n,l),qe(i,u);this._updateMapTransform(e,n,i),this._changes=[]}_updateMapTransform(e,n,i){const a=this._map,l=a.transform,u=D=>[D.x,D.y,D.z];if((D=>{const A=this._eventsInProgress.drag;return A&&!this._handlersById[A.handlerName].isActive()})()&&!lh(e)){const D=l.zoom;l.cameraElevationReference="sea",null!=this._originalZoom&&l._orthographicProjectionAtLowPitch&&"globe"!==l.projection.name&&0===l.pitch?(l.cameraElevationReference="ground",l.zoom=this._originalZoom):(l.recenterOnTerrain(),l.cameraElevationReference="ground"),D!==l.zoom&&this._map._update(!0)}if(l._isCameraConstrained&&a._stop(!0),!lh(e))return void this._fireEvents(n,i,!0);let{panDelta:d,zoomDelta:f,bearingDelta:p,pitchDelta:g,around:_,aroundCoord:x,pinchAround:v}=e;l._isCameraConstrained&&(f>0&&(f=0),l._isCameraConstrained=!1),void 0!==v&&(_=v),(f||(D=>n[D]&&!this._eventsInProgress[D])("drag"))&&_&&(this._dragOrigin=u(l.pointCoordinate3D(_)),this._originalZoom=l.zoom,this._trackingEllipsoid.setup(l._camera.position,this._dragOrigin)),l.cameraElevationReference="sea",a._stop(!0),_=_||a.transform.centerPoint,p&&(l.bearing+=p),g&&(l.pitch+=g),l._updateCameraState();const b=[0,0,0];if(d)if("mercator"===l.projection.name){const D=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(_).dir),A=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(_.sub(d)).dir);b[0]=A[0]-D[0],b[1]=A[1]-D[1]}else{const D=l.pointCoordinate(_);if("globe"===l.projection.name){d=d.rotate(-l.angle);const A=l._pixelsPerMercatorPixel/l.worldSize;b[0]=-d.x*Zx(zr(D.y))*A,b[1]=-d.y*Zx(l.center.lat)*A}else{const A=l.pointCoordinate(_.sub(d));D&&A&&(b[0]=A.x-D.x,b[1]=A.y-D.y)}}const E=l.zoom,C=[0,0,0];if(f){const D=u(x||l.pointCoordinate3D(_)),A={dir:G.normalize([],G.sub([],D,l._camera.position))};if(A.dir[2]<0){const P=l.zoomDeltaToMovement(D,f);G.scale(C,A.dir,P)}}const T=G.add(b,b,C);l._translateCameraConstrained(T),f&&Math.abs(l.zoom-E)>1e-4&&l.recenterOnTerrain(),l.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,i,!0)}_fireEvents(e,n,i){const a=yb(this._eventsInProgress),l=yb(e),u={};for(const g in e){const{originalEvent:_}=e[g];this._eventsInProgress[g]||(u[`${g}start`]=_),this._eventsInProgress[g]=e[g]}!a&&l&&this._fireEvent("movestart",l.originalEvent);for(const g in u)this._fireEvent(g,u[g]);l&&this._fireEvent("move",l.originalEvent);for(const g in e){const{originalEvent:_}=e[g];this._fireEvent(g,_)}const d={};let f;for(const g in this._eventsInProgress){const{handlerName:_,originalEvent:x}=this._eventsInProgress[g];this._handlersById[_].isActive()||(delete this._eventsInProgress[g],f=n[_]||x,d[`${g}end`]=f)}for(const g in d)this._fireEvent(g,d[g]);const p=yb(this._eventsInProgress);if(i&&(a||l)&&!p){this._updatingCamera=!0;const g=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),_=x=>0!==x&&-this._bearingSnap<x&&x<this._bearingSnap;g?(_(g.bearing||this._map.getBearing())&&(g.bearing=0),this._map.easeTo(g,{originalEvent:f})):(this._map.fire(new Me("moveend",{originalEvent:f})),_(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new Me(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new zR("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const xb="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qA extends wr{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,ui(["_renderFrameCallback"],this)}getCenter(){return new _t(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,i){return e=ee.convert(e).mult(-1),this.panTo(this.transform.center,qe({offset:e},n),i)}panTo(e,n,i){return this.easeTo(qe({center:e},n),i)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,i){return this.easeTo(qe({zoom:e},n),i)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,i){return this.easeTo(qe({bearing:e},n),i)}resetNorth(e,n){return this.rotateTo(0,qe({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(qe({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=Rs.convert(e);const i=n&&n.bearing||0,a=n&&n.pitch||0,l=e.getNorthWest(),u=e.getSouthEast();return this._cameraForBounds(this.transform,l,u,i,a,n)}_extendCameraOptions(e){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=qe({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const i=e.padding;e.padding={top:i,bottom:i,right:i,left:i}}return e.padding=qe(n,e.padding),e}_minimumAABBFrustumDistance(e,n){const i=n.max[0]-n.min[0],a=n.max[1]-n.min[1];return i/a>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):a/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,n,i,a,l,u){const d=e.clone(),f=this._extendCameraOptions(u);d.bearing=a,d.pitch=l;const p=_t.convert(n),g=_t.convert(i),_=.5*(p.lat+g.lat),x=.5*(p.lng+g.lng),v=Vo(_,x),b=G.normalize([],v),E=G.normalize([],G.cross([],b,[0,1,0])),C=G.cross([],E,b),T=[E[0],E[1],E[2],0,C[0],C[1],C[2],0,b[0],b[1],b[2],0,0,0,0,1],D=[v,Vo(p.lat,p.lng),Vo(g.lat,p.lng),Vo(g.lat,g.lng),Vo(p.lat,g.lng),Vo(_,p.lng),Vo(_,g.lng),Vo(p.lat,x),Vo(g.lat,x)];let A=$n.fromPoints(D.map(X=>[G.dot(E,X),G.dot(C,X),G.dot(b,X)]));const P=G.transformMat4([],A.center,T);0===G.squaredLength(P)&&G.set(P,0,0,1),G.normalize(P,P),G.scale(P,P,lo),d.center=function([X,re,oe]){const ce=Math.hypot(X,re,oe),de=Math.atan2(X,oe),ge=.5*Math.PI-Math.acos(-re/ce);return new _t(ei(de),ei(ge))}(P);const I=d.getWorldToCameraMatrix(),R=ne.invert(new Float64Array(16),I);A=$n.applyTransform(A,ne.multiply([],I,T)),G.transformMat4(P,P,I);const k=.5*(A.max[2]-A.min[2]),L=this._minimumAABBFrustumDistance(d,A),N=G.scale([],[0,0,1],k),z=G.add(N,P,N),j=L+(0===d.pitch?0:G.distance(P,z)),B=d.globeCenterInViewSpace,H=G.sub([],P,[B[0],B[1],B[2]]);G.normalize(H,H),G.scale(H,H,j);const V=G.add([],P,H);G.transformMat4(V,V,R);const Z=Gu/lo,Q=G.length(V),te=vn(Math.max(Q*Z-Gu,Number.EPSILON),0),W=Math.min(d.zoomFromMercatorZAdjusted(te),f.maxZoom);return W>.5*(gp+Hc)?(d.setProjection({name:"mercator"}),d.zoom=W,this._cameraForBounds(d,n,i,a,l,u)):{center:d.center,zoom:W,bearing:a,pitch:l}}queryTerrainElevation(e,n){const i=this.transform.elevation;return i?(n=qe({},{exaggerated:!0},n),i.getAtPoint(Gt.fromLngLat(e),null,n.exaggerated)):null}_cameraForBounds(e,n,i,a,l,u){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,n,i,a,l,u);const d=e.clone(),f=this._extendCameraOptions(u),p=d.padding;d.bearing=a,d.pitch=l;const g=_t.convert(n),_=_t.convert(i),x=new _t(g.lng,_.lat),v=new _t(_.lng,g.lat),b=d.project(g),E=d.project(_),C=this.queryTerrainElevation(g),T=this.queryTerrainElevation(_),D=this.queryTerrainElevation(x),A=this.queryTerrainElevation(v),P=[[b.x,b.y,Math.min(C||0,T||0,D||0,A||0)],[E.x,E.y,Math.max(C||0,T||0,D||0,A||0)]];let I=$n.fromPoints(P);const R=d.getWorldToCameraMatrix(),k=ne.invert(new Float64Array(16),R);I=$n.applyTransform(I,R);const L=G.sub([],I.max,I.min),N=p.left||0,z=p.right||0,j=p.bottom||0,B=p.top||0,{left:H,right:V,top:Z,bottom:Q}=f.padding,te=.5*(N+z),W=.5*(B+j),X=Math.min(d.scaleZoom(d.scale*Math.min((d.width-(N+z+H+V))/L[0],(d.height-(j+B+Q+Z))/L[1])),f.maxZoom),re=d.scale/d.zoomScale(X);I=new $n([I.min[0]-(H+te)*re,I.min[1]-(Q+W)*re,I.min[2]],[I.max[0]+(V+te)*re,I.max[1]+(Z+W)*re,I.max[2]]);const oe=.5*L[2],ce=this._minimumAABBFrustumDistance(d,I),de=[0,0,1,0];xn.transformMat4(de,de,R),xn.normalize(de,de);const ge=G.scale([],de,ce+oe),ae=G.add([],I.center,ge),ue=("number"==typeof f.offset.x&&"number"==typeof f.offset.y?new ee(f.offset.x,f.offset.y):ee.convert(f.offset)).rotate(-Et(a));I.center[0]-=ue.x*re,I.center[1]+=ue.y*re,G.transformMat4(I.center,I.center,k),G.transformMat4(ae,ae,k);const Se=[I.center[0],I.center[1],ae[2]*d.pixelsPerMeter];G.scale(Se,Se,1/d.worldSize);const Ne=ls(Se[0]),ze=zr(Se[1]),Ve=Math.min(d._zoomFromMercatorZ(Se[2]),f.maxZoom),Ke=new _t(Ne,ze);return d.mercatorFromTransition&&Ve<.5*(gp+Hc)?(d.setProjection({name:"globe"}),d.zoom=Ve,this._cameraForBounds(d,n,i,a,l,u)):{center:Ke,zoom:Ve,bearing:a,pitch:l}}fitBounds(e,n,i){const a=this.cameraForBounds(e,n);return this._fitInternal(a,n,i)}fitScreenCoordinates(e,n,i,a,l){const u=ee.convert(e),d=ee.convert(n),f=new ee(Math.min(u.x,d.x),Math.min(u.y,d.y)),p=new ee(Math.max(u.x,d.x),Math.max(u.y,d.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(u,d))return this;const g=this.transform.pointLocation3D(f),_=this.transform.pointLocation3D(p),x=this.transform.pointLocation3D(new ee(f.x,p.y)),v=this.transform.pointLocation3D(new ee(p.x,f.y)),b=[Math.min(g.lng,_.lng,x.lng,v.lng),Math.min(g.lat,_.lat,x.lat,v.lat)],E=[Math.max(g.lng,_.lng,x.lng,v.lng),Math.max(g.lat,_.lat,x.lat,v.lat)],C=a&&a.pitch?a.pitch:this.getPitch(),T=this._cameraForBounds(this.transform,b,E,i,C,a);return this._fitInternal(T,a,l)}_fitInternal(e,n,i){return e?(delete(n=qe(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(e,n){this.stop();const i=e.preloadOnly?this.transform.clone():this.transform;let a=!1,l=!1,u=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(a=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=_t.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(l=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(u=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),e.preloadOnly?(this._preloadTiles(i),this):(this.fire(new Me("movestart",n)).fire(new Me("move",n)),a&&this.fire(new Me("zoomstart",n)).fire(new Me("zoom",n)).fire(new Me("zoomend",n)),l&&this.fire(new Me("rotatestart",n)).fire(new Me("rotate",n)).fire(new Me("rotateend",n)),u&&this.fire(new Me("pitchstart",n)).fire(new Me("pitch",n)).fire(new Me("pitchend",n)),this.fire(new Me("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||K(xb),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,n){const i=this.transform;if(!i.projection.supportsFreeCamera)return K(xb),this;this.stop();const a=i.zoom,l=i.pitch,u=i.bearing;i.setFreeCameraOptions(e);const d=a!==i.zoom,f=l!==i.pitch,p=u!==i.bearing;return this.fire(new Me("movestart",n)).fire(new Me("move",n)),d&&this.fire(new Me("zoomstart",n)).fire(new Me("zoom",n)).fire(new Me("zoomend",n)),p&&this.fire(new Me("rotatestart",n)).fire(new Me("rotate",n)).fire(new Me("rotateend",n)),f&&this.fire(new Me("pitchstart",n)).fire(new Me("pitch",n)).fire(new Me("pitchend",n)),this.fire(new Me("moveend",n)),this}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=qe({offset:[0,0],duration:500,easing:Un},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const i=this.transform,a=this.getZoom(),l=this.getBearing(),u=this.getPitch(),d=this.getPadding(),f="zoom"in e?+e.zoom:a,p="bearing"in e?this._normalizeBearing(e.bearing,l):l,g="pitch"in e?+e.pitch:u,_="padding"in e?e.padding:i.padding,x=ee.convert(e.offset);let v,b,E;if("globe"===i.projection.name){const N=Gt.fromLngLat(i.center),z=x.rotate(-i.angle);N.x+=z.x/i.worldSize,N.y+=z.y/i.worldSize;const j=N.toLngLat(),B=_t.convert(e.center||j);this._normalizeCenter(B),v=i.centerPoint.add(z),b=new ee(N.x,N.y).mult(i.worldSize),E=new ee(Li(B.lng),Gi(B.lat)).mult(i.worldSize).sub(b)}else{v=i.centerPoint.add(x);const N=i.pointLocation(v),z=_t.convert(e.center||N);this._normalizeCenter(z),b=i.project(N),E=i.project(z).sub(b)}const C=i.zoomScale(f-a);let T,D;e.around&&(T=_t.convert(e.around),D=i.locationPoint(T));const A=this._zooming||f!==a,P=this._rotating||l!==p,I=this._pitching||g!==u,R=!i.isPaddingEqual(_),k=N=>z=>{if(A&&(N.zoom=ut(a,f,z)),P&&(N.bearing=ut(l,p,z)),I&&(N.pitch=ut(u,g,z)),R&&(N.interpolatePadding(d,_,z),v=N.centerPoint.add(x)),T)N.setLocationAtPoint(T,D);else{const j=N.zoomScale(N.zoom-a),B=f>a?Math.min(2,C):Math.max(.5,C),H=Math.pow(B,1-z),V=N.unproject(b.add(E.mult(z*H)).mult(j));N.setLocationAtPoint(N.renderWorldCopies?V.wrap():V,v)}return e.preloadOnly||this._fireMoveEvents(n),N};if(e.preloadOnly){const N=this._emulate(k,e.duration,i);return this._preloadTiles(N),this}const L={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=A,this._rotating=P,this._pitching=I,this._padding=R,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,L),this._ease(k(i),N=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(n,N)},e),this}_prepareEase(e,n,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||i.moving||this.fire(new Me("movestart",e)),this._zooming&&!i.zooming&&this.fire(new Me("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new Me("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new Me("pitchstart",e))}_fireMoveEvents(e){this.fire(new Me("move",e)),this._zooming&&this.fire(new Me("zoom",e)),this._rotating&&this.fire(new Me("rotate",e)),this._pitching&&this.fire(new Me("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,a=this._rotating,l=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new Me("zoomend",e)),a&&this.fire(new Me("rotateend",e)),l&&this.fire(new Me("pitchend",e)),this.fire(new Me("moveend",e))}flyTo(e,n){if(this._prefersReducedMotion(e)){const X=Ro(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(X,n)}this.stop(),e=qe({offset:[0,0],speed:1.2,curve:1.42,easing:Un},e);const i=this.transform,a=this.getZoom(),l=this.getBearing(),u=this.getPitch(),d=this.getPadding(),f="zoom"in e?We(+e.zoom,i.minZoom,i.maxZoom):a,p="bearing"in e?this._normalizeBearing(e.bearing,l):l,g="pitch"in e?+e.pitch:u,_="padding"in e?e.padding:i.padding,x=i.zoomScale(f-a),v=ee.convert(e.offset);let b=i.centerPoint.add(v);const E=i.pointLocation(b),C=_t.convert(e.center||E);this._normalizeCenter(C);const T=i.project(E),D=i.project(C).sub(T);let A=e.curve;const P=Math.max(i.width,i.height),I=P/x,R=D.mag();if("minZoom"in e){const X=We(Math.min(e.minZoom,a,f),i.minZoom,i.maxZoom),re=P/i.zoomScale(X-a);A=Math.sqrt(re/R*2)}const k=A*A;function L(X){const re=(I*I-P*P+(X?-1:1)*k*k*R*R)/(2*(X?I:P)*k*R);return Math.log(Math.sqrt(re*re+1)-re)}function N(X){return(Math.exp(X)-Math.exp(-X))/2}function z(X){return(Math.exp(X)+Math.exp(-X))/2}const j=L(0);let B=function(X){return z(j)/z(j+A*X)},H=function(X){return P*((z(j)*(N(re=j+A*X)/z(re))-N(j))/k)/R;var re},V=(L(1)-j)/A;if(Math.abs(R)<1e-6||!isFinite(V)){if(Math.abs(P-I)<1e-6)return this.easeTo(e,n);const X=I<P?-1:1;V=Math.abs(Math.log(I/P))/A,H=function(){return 0},B=function(re){return Math.exp(X*A*re)}}e.duration="duration"in e?+e.duration:1e3*V/("screenSpeed"in e?+e.screenSpeed/A:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const Z=l!==p,Q=g!==u,te=!i.isPaddingEqual(_),W=X=>re=>{const oe=re*V,ce=1/B(oe);X.zoom=1===re?f:a+X.scaleZoom(ce),Z&&(X.bearing=ut(l,p,re)),Q&&(X.pitch=ut(u,g,re)),te&&(X.interpolatePadding(d,_,re),b=X.centerPoint.add(v));const de=1===re?C:X.unproject(T.add(D.mult(H(oe))).mult(ce));return X.setLocationAtPoint(X.renderWorldCopies?de.wrap():de,b),X._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(n),X};if(e.preloadOnly){const X=this._emulate(W,e.duration,i);return this._preloadTiles(X),this}return this._zooming=!0,this._rotating=Z,this._pitching=Q,this._padding=te,this._prepareEase(n,!1),this._ease(W(i),()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const i=this._onEaseEnd;this._onEaseEnd=void 0,i.call(this,n)}if(!e){const i=this.handlers;i&&i.stop(!1)}return this}_ease(e,n,i){!1===i.animate||0===i.duration?(e(1),n()):(this._easeStart=Fe.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((Fe.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=Ja(e,-180,180);const i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e}_normalizeCenter(e){const n=this.transform;if(!n.renderWorldCopies||n.maxBounds)return;const i=e.lng-n.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&Fe.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,n,i){const a=Math.ceil(15*n/1e3),l=[],u=e(i.clone());for(let d=0;d<=a;d++){const f=u(d/a);l.push(f.clone())}return l}}class ZA{constructor(e={}){this.options=e,ui(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const n=this.options&&this.options.compact;return this._map=e,this._container=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Cn("button","mapboxgl-ctrl-attrib-button",this._container),Cn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Cn("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===n&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const i=this._map._getUIString(`AttributionControl.${n}`);e.setAttribute("aria-label",i),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||kt.ACCESS_TOKEN}];if(e){const i=n.reduce((a,l,u)=>(l.value&&(a+=`${l.key}=${l.value}${u<n.length-1?"&":""}`),a),"?");e.href=`${kt.FEEDBACK_URL}/${i}#${WT(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const a=this._map.style.stylesheet;this.styleOwner=a.owner,this.styleId=a.id}const n=this._map.style._mergedSourceCaches;for(const a in n){const l=n[a];if(l.used){const u=l.getSource();u.attribution&&e.indexOf(u.attribution)<0&&e.push(u.attribution)}}e.sort((a,l)=>a.length-l.length),e=e.filter((a,l)=>{for(let u=l+1;u<e.length;u++)if(e[u].indexOf(a)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class oC{constructor(){ui(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=Cn("div","mapboxgl-ctrl");const n=Cn("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const n in e){const i=e[n].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const n=e[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class uf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,i=n?this._queue.concat(n):this._queue;for(const a of i)if(a.id===e)return void(a.cancelled=!0)}run(e=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const i of n)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Rm(t,e,n){if(t=new _t(t.lng,t.lat),e){const i=new _t(t.lng-360,t.lat),a=new _t(t.lng+360,t.lat),l=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),u=n.locationPoint(t).distSqr(e),d=e.x<0||e.y<0||e.x>n.width||e.y>n.height;n.locationPoint(i).distSqr(e)<u&&(d||Math.abs(i.lng-n.center.lng)<l)?t=i:n.locationPoint(a).distSqr(e)<u&&(d||Math.abs(a.lng-n.center.lng)<l)&&(t=a)}for(;Math.abs(t.lng-n.center.lng)>180;){const i=n.locationPoint(t);if(i.x>=0&&i.y>=0&&i.x<=n.width&&i.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const vb={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class bb extends wr{constructor(e,n){if(super(),(e instanceof ie.HTMLElement||n)&&(e=qe({element:e},n)),ui(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=ee.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Cn("div");const l=41,u=27,d=da("svg",{display:"block",height:l*this._scale+"px",width:u*this._scale+"px",viewBox:`0 0 ${u} ${l}`},this._element),f=da("radialGradient",{id:"shadowGradient"},da("defs",{},d));da("stop",{offset:"10%","stop-opacity":.4},f),da("stop",{offset:"100%","stop-opacity":.05},f),da("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d),da("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),da("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),da("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),this._offset=ee.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()});const i=this._element.classList;for(const l in vb)i.remove(`mapboxgl-marker-anchor-${l}`);i.add(`mapboxgl-marker-anchor-${this._anchor}`);const a=e&&e.className?e.className.trim().split(/\s+/):[];i.add(...a),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=_t.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const a=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[a,-1*(24.6+a)],"bottom-right":[-a,-1*(24.6+a)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const n=e.code,i=e.charCode||e.keyCode;"Space"!==n&&"Enter"!==n&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const n=e.originalEvent.target,i=this._element;this._popup&&(n===i||i.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,n=this._pos;if(!e||!n)return!1;const i=e.unproject(n),a=e.getFreeCameraOptions();if(!a.position)return!1;const l=a.position.toLngLat();return l.distanceTo(i)<.9*l.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const n=this._pos;if(!n||n.x<0||n.x>e.transform.width||n.y<0||n.y>e.transform.height)return void this._clearFadeTimer();const i=e.unproject(n);let a;e._showingGlobe()&&p_(e.transform,this._lngLat)?a=0:(a=1-e._queryFogOpacity(i),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(a*=this._occludedOpacity)),this._element.style.opacity=`${a}`,this._element.style.pointerEvents=a>0?"auto":"none",this._popup&&this._popup._setOpacity(a),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${vb[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${n.x}px,${n.y}px)\n        `}_calculateXYTransform(){const e=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!e||"map"!==i)return"";if(!n._showingGlobe()){const f=n.getPitch();return f?`rotateX(${f}deg)`:""}const a=ei(G2(n.transform,this._lngLat)),l=e.sub(H2(n.transform)),u=Math.abs(l.x)+Math.abs(l.y);if(0===u)return"";const d=a/u;return`rotateX(${-l.y*d}deg) rotateY(${l.x*d}deg)`}_calculateZTransform(){const e=this._pos,n=this._map;if(!n||!e)return"";let i=0;const a=this.getRotationAlignment();if("map"===a)if(n._showingGlobe()){const l=n.project(new _t(this._lngLat.lng,this._lngLat.lat+.001)),u=n.project(new _t(this._lngLat.lng,this._lngLat.lat-.001)).sub(l);i=ei(Math.atan2(u.y,u.x))-90}else i=-n.getBearing();else if("horizon"===a){const l=Ya(4,6,n.getZoom()),u=H2(n.transform);u.y+=l*n.transform.height;const d=e.sub(u),f=ei(Math.atan2(d.y,d.x));i=(f>90?f-270:f+90)*(1-l)}return i+=this._rotation,i?`rotateZ(${i}deg)`:""}_update(e){ie.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Rm(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===e?this._updateFrameId=ie.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=ee.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const n=this._map;if(!n)return;const i=this._pointerdownPos,a=this._positionDelta;if(i&&a){if(!this._isDragging){const l=this._clickTolerance||n._clickTolerance;if(e.point.dist(i)<l)return;this._isDragging=!0}this._pos=e.point.sub(a),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Me("dragstart"))),this.fire(new Me("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Me("dragend")),this._state="inactive"}_addDragHandler(e){const n=this._map,i=this._pos;n&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const n=this._map;return n&&(e?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const WA={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},XA=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sC(t=new ee(0,0),e="bottom"){if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(e){case"top":return new ee(0,t);case"top-left":return new ee(n,n);case"top-right":return new ee(-n,n);case"bottom":return new ee(0,-t);case"bottom-left":return new ee(n,-n);case"bottom-right":return new ee(-n,-n);case"left":return new ee(t,0);case"right":return new ee(-t,0)}return new ee(0,0)}return t instanceof ee||Array.isArray(t)?ee.convert(t):ee.convert(t[e]||[0,0])}class YA{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const n=Ec((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,n,i){this._start=this.getValue(n),this._end=e,this._startTime=n,this._endTime=n+i}}const wb={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},JA={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},KA={showCompass:!0,showZoom:!0,visualizePitch:!1};class QA{constructor(e,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new fb({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new pb({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),ui(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,n){this.mouseRotate.mousedown(e,n),this.mousePitch&&this.mousePitch.mousedown(e,n),er()}move(e,n){const i=this.map,a=this.mouseRotate.mousemoveWindow(e,n),l=a&&a.bearingDelta;if(l&&i.setBearing(i.getBearing()+l),this.mousePitch){const u=this.mousePitch.mousemoveWindow(e,n),d=u&&u.pitchDelta;d&&i.setPitch(i.getPitch()+d)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Cf(),ie.removeEventListener("mousemove",this.mousemove),ie.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(qe({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),Sf(this.element,e)),ie.addEventListener("mousemove",this.mousemove),ie.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,Sf(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=ar(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=ar(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const e3={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},t3={maxWidth:100,unit:"metric"},n3={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Z0={version:la,supported:uw,setRTLTextPlugin:function(t,e,n=!1){if(es===nx||es===rx||es===Oe)throw new Error("setRTLTextPlugin cannot be called multiple times.");zc=Fe.resolveURL(t),es=nx,Dn=e,Og(),n||kg()},getRTLTextPluginStatus:Xs,Map:class extends qA{constructor(t){if(Cy.mark(Mf.create),null!=(t=qe({},JA,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&function(e){const n=e.navigator?e.navigator.userAgent:null;return!!function(i){if(null==mt){const a=i.navigator?i.navigator.userAgent:null;mt=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return mt}(e)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(ie)&&(t.antialias=!1,K("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new e1(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new uf,this._domRenderTaskQueue=new uf,this._controls=[],this._markers=[],this._popups=[],this._mapId=Ar(),this._locale=qe({},wb,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new YA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new rt(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=ie.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container.toString()}' not found.`)}else{if(!(t.container instanceof ie.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&K("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),ui(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==ie&&(this._fullscreenchangeEvent="onfullscreenchange"in ie.document?"fullscreenchange":"webkitfullscreenchange",ie.addEventListener("online",this._onWindowOnline,!1),ie.addEventListener("resize",this._onWindowResize,!1),ie.addEventListener("orientationchange",this._onWindowResize,!1),ie.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),ie.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new GA(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||kt.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new ZT("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const e=t.bounds;e&&(this.resize(),this.fitBounds(e,qe({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new ZA({customAttribution:t.customAttribution})),this._logoControl=new oC,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new Me(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new Me(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(t,e){if(void 0===e&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new pe(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const i=this._controlPositions[e];return-1!==e.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new pe(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(t);return e>-1&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const e=!this._moving;return e&&this.fire(new Me("movestart",t)).fire(new Me("move",t)),this.fire(new Me("resize",t)),e&&this.fire(new Me("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(Rs.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new Me("zoomstart")).fire(new Me("zoom")).fire(new Me("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new Me("zoomstart")).fire(new Me("zoom")).fire(new Me("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new Me("pitchstart")).fire(new Me("pitch")).fire(new Me("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new Me("pitchstart")).fire(new Me("pitch")).fire(new Me("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?ie.navigator.language:Array.isArray(t)?0===t.length?void 0:t.map(e=>"auto"===e?ie.navigator.language:e):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.clearSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,e=t.projection.name;let n;"globe"===e&&t.zoom>=Hc?(t.setMercatorFromTransition(),n=!0):"mercator"===e&&t.zoom<Hc&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(t){let e;return e="globe"===t.name&&this.transform.zoom>=Hc?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(_t.convert(t))}unproject(t){return this.transform.pointLocation3D(ee.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let i=!1;const a=u=>{const d=e.filter(p=>this.getLayer(p)),f=d.length?this.queryRenderedFeatures(u.point,{layers:d}):[];f.length?i||(i=!0,n.call(this,new zs(t,this,u.originalEvent,{features:f}))):i=!1},l=()=>{i=!1};return{layers:new Set(e),listener:n,delegates:{mousemove:a,mouseout:l}}}if("mouseleave"===t||"mouseout"===t){let i=!1;const a=u=>{const d=e.filter(f=>this.getLayer(f));(d.length?this.queryRenderedFeatures(u.point,{layers:d}):[]).length?i=!0:i&&(i=!1,n.call(this,new zs(t,this,u.originalEvent)))},l=u=>{i&&(i=!1,n.call(this,new zs(t,this,u.originalEvent)))};return{layers:new Set(e),listener:n,delegates:{mousemove:a,mouseout:l}}}{const i=a=>{const l=e.filter(d=>this.getLayer(d)),u=l.length?this.queryRenderedFeatures(a.point,{layers:l}):[];u.length&&(a.features=u,n.call(this,a),delete a.features)};return{layers:new Set(e),listener:n,delegates:{[t]:i}}}}on(t,e,n){if(void 0===n)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e)for(const a of e)if(!this._isValidId(a))return this;const i=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i);for(const a in i.delegates)this.on(a,i.delegates[a]);return this}once(t,e,n){if(void 0===n)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e)for(const a of e)if(!this._isValidId(a))return this;const i=this._createDelegatedListener(t,e,n);for(const a in i.delegates)this.once(a,i.delegates[a]);return this}off(t,e,n){if(void 0===n)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(const l of e)if(!this._isValidId(l))return this;const i=(l,u)=>{if(l.size!==u.size)return!1;for(const d of l)if(!u.has(d))return!1;return!0},a=this._delegatedListeners?this._delegatedListeners[t]:void 0;return a&&(l=>{for(let u=0;u<l.length;u++){const d=l[u];if(d.listener===n&&i(d.layers,e)){for(const f in d.delegates)this.off(f,d.delegates[f]);return l.splice(u,1),this}}})(a),this}queryRenderedFeatures(t,e){if(!this.style)return[];if(void 0!==e||void 0===t||t instanceof ee||Array.isArray(t)||(e=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(e=e||{}).layers&&Array.isArray(e.layers))for(const n of e.layers)if(!this._isValidId(n))return[];return this.style.queryRenderedFeatures(t,e,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(t){const{name:e}=this.transform.projection;return"globe"!==e&&"mercator"!==e&&K(`${e} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(ee.convert(t))}setStyle(t,e){return!1!==(e=qe({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new Ns(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,e){if("string"==typeof t){const n=this._requestManager.normalizeStyleURL(t),i=this._requestManager.transformRequest(n,fe.Style);Ae(i,(a,l)=>{a?this.fire(new pe(a)):l&&this._updateDiff(l,e)})}else"object"==typeof t&&this._updateDiff(t,e)}_updateDiff(t,e){try{this.style.setState(t)&&this._update(!0)}catch(n){K(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(K("There is no style added to the map."),!1)}_isValidId(t){return!(e=t,e.indexOf("\x1f")>=0&&(this.fire(new pe(new Error(`IDs can't contain special symbols: "${t}".`))),1));var e}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const n=t[e]._tiles;for(const i in n){const a=n[i];if("loaded"!==a.state&&"errored"!==a.state)return!1}}return!0}addSourceType(t,e,n){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(t,e,{pixelRatio:n=1,sdf:i=!1,stretchX:a,stretchY:l,content:u}={}){if(this._lazyInitEmptyStyle(),e instanceof ie.HTMLImageElement||ie.ImageBitmap&&e instanceof ie.ImageBitmap){const{width:d,height:f,data:p}=Fe.getImageData(e);this.style.addImage(t,{data:new ur({width:d,height:f},p),pixelRatio:n,stretchX:a,stretchY:l,content:u,sdf:i,version:0})}else if(void 0===e.width||void 0===e.height)this.fire(new pe(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:d,height:f}=e,p=e;this.style.addImage(t,{data:new ur({width:d,height:f},new Uint8Array(p.data)),pixelRatio:n,stretchX:a,stretchY:l,content:u,sdf:i,version:0,userImage:p}),p.onAdd&&p.onAdd(this,t)}}updateImage(t,e){this._lazyInitEmptyStyle();const n=this.style.getImage(t);if(!n)return void this.fire(new pe(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=e instanceof ie.HTMLImageElement||ie.ImageBitmap&&e instanceof ie.ImageBitmap?Fe.getImageData(e):e,{width:a,height:l}=i;void 0!==a&&void 0!==l?a===n.data.width&&l===n.data.height?(n.data.replace(i.data,!(e instanceof ie.HTMLImageElement||ie.ImageBitmap&&e instanceof ie.ImageBitmap)),this.style.updateImage(t,n)):this.fire(new pe(new Error(`The width and height of the updated image (${a}, ${l})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new pe(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new pe(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){Ct(this._requestManager.transformRequest(t,fe.Image),(n,i)=>{e(n,i instanceof ie.HTMLImageElement?Fe.getImageData(i):i)})}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new pe(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,n){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,n),this._update(!0)):this}setFilter(t,e,n={}){return this._isValidId(t)?(this.style.setFilter(t,e,n),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,n,i={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,n,i),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,n,i={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,n,i),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}setConfigProperty(t,e,n){return this.style.setConfigProperty(t,e,n),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(_t.convert(t),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let n,i,a,l=this._container;for(;l&&(!i||!a);){const u=ie.getComputedStyle(l).transform;u&&"none"!==u&&(n=u.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(i=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(a=n[3])),l=l.parentElement}this._containerWidth=i?Math.abs(t/i):t,this._containerHeight=a?Math.abs(e/a):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==ie.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&K("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=Cn("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=Cn("div","mapboxgl-canvas-container",t);this._canvas=Cn("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Cn("div","mapboxgl-control-container",t),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{i[a]=Cn("div",`mapboxgl-ctrl-${a}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){const n=Fe.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const t=qe({},uw.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",t);e?(lw(e,!0),this.painter=new ob(e,this.transform),this.on("data",n=>{"source"===n.dataType&&this.painter.setTileLoadedFlag(!0)}),ws.testSupport(e)):this.fire(new pe(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Me("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new Me("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(t){let e;this.fire(new Me("renderstart"));const n=this.painter.context.extTimerQuery,i=Fe.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(e=a.createQuery(),a.beginQuery(n.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],ie.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],ie.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,p=this.transform.pitch,g=Fe.now(),_=new tr(f,{now:g,fadeDuration:l,pitch:p,transition:this.style.transition});this.style.update(_)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let u=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),u=this._updateAverageElevation(i),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):u=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Me("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Me("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),e){const f=Fe.now()-i;a.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const p=a.getQueryParameter(e,a.QUERY_RESULT)/1e6;a.deleteQuery(e),this.fire(new Me("gpu-timing-frame",{cpuTime:f,gpuTime:p})),ie.performance.mark("frame-gpu",{startTime:i,detail:{gpuTime:p}})},50)}if(this.listens("gpu-timing-layer")){const f=this.painter.collectGpuTimers();setTimeout(()=>{const p=this.painter.queryGpuTimers(f);this.fire(new Me("gpu-timing-layer",{layerTimes:p}))},50)}if(this.listens("gpu-timing-deferred-render")){const f=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const p=this.painter.queryGpuTimeDeferredRender(f);this.fire(new Me("gpu-timing-deferred-render",{gpuTime:p}))},50)}const d=this._sourcesDirty||this._styleDirty||this._placementDirty||u;if(d||this._repaint)this.triggerRepaint();else{const f=!this.isMoving()&&this.loaded();if(f&&(u=this._updateAverageElevation(i,!0)),u)this.triggerRepaint();else if(this._triggerFrame(!1),f&&(this.fire(new Me("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const p=this._calculateSpeedIndex();this.fire(new Me("speedindexcompleted",{speedIndex:p})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,Cy.mark(Mf.fullLoad),this._performanceMetricsCollection&&oD(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const n=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const a=this.transform.averageElevation;let l=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(l)?l=0:this._averageElevationLastSampledAt=t;const u=Math.abs(a-l);if(u>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(l),n(l);this._averageElevation.easeTo(l,t,300)}else if(u>1e-4)return this._averageElevation.jumpTo(l),n(l)}return!!this._averageElevation.isEasing(t)&&n(this._averageElevation.getValue(t))}_authenticate(){aw(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===mn||401===t.status)){const e=this.painter.context.gl;lw(e,!1),this._logoControl instanceof oC&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new pe(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ZP(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function a(l){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,l,0);const u=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,u),u}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(a(t),e.canvasCopies.map(a),e.timeStamps)}_canvasPixelComparison(t,e,n){let i=n[1]-n[0];const a=t.length/4;for(let l=0;l<e.length;l++){const u=e[l];let d=0;for(let f=0;f<u.length;f+=4)u[f]===t[f]&&u[f+1]===t[f+1]&&u[f+2]===t[f+2]&&u[f+3]===t[f+3]&&(d+=1);i+=(n[l+2]-n[l+1])*(1-d/a)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==ie&&(ie.removeEventListener("resize",this._onWindowResize,!1),ie.removeEventListener("orientationchange",this._onWindowResize,!1),ie.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),ie.removeEventListener("online",this._onWindowOnline,!1),ie.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ic.delete(this.painter.context.gl),this._removed=!0,this.fire(new Me("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=Fe.frame(e=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(e)}))}_preloadTiles(t){return vu(this.style?Object.values(this.style._sourceCaches):[],(e,n)=>e._preloadTiles(t,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===ie.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(t,e){eo=t,_o=e}get version(){return la}},NavigationControl:class{constructor(t){this.options=qe({},KA,t),this._container=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(ui(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),Cn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),Cn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(ui(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:e}):n.resetNorth({},{originalEvent:e}))}),this._compassIcon=Cn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),n=e===t.getMaxZoom(),i=e===t.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new QA(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const n=Cn("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",n),t.firstElementChild&&t.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends wr{constructor(t){super(),this.options=qe({geolocation:ie.navigator.geolocation},e3,t),ui(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kA(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,t(n)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==ie.navigator.permissions?ie.navigator.permissions.query({name:"geolocation"}).then(n=>e("denied"!==n.state)).catch(()=>e()):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return!!e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new Me("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Me("geolocate",t)),this._finish()}}_updateCamera(t){const e=new _t(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,i=qe({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(n),i,{geolocateSource:!0})}_updateMarker(t){if(t){const e=new _t(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,e=vn(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Me("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Cn("button","mapboxgl-ctrl-geolocate",this._container),Cn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){K("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Cn("div","mapboxgl-user-location"),this._dotElement.appendChild(Cn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Cn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new bb({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Cn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bb({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Me("trackuserlocationend")))})}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return K("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Me("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Me("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Me("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{ie.addEventListener("ondeviceorientationabsolute"in ie?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==ie.DeviceMotionEvent&&"function"==typeof ie.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),ie.removeEventListener("deviceorientation",this._onDeviceOrientation),ie.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ZA,ScaleControl:class{constructor(t){this.options=qe({},t3,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),ui(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,n=e._containerHeight/2,i=e._containerWidth/2-t/2,a=e.unproject([i,n]),l=e.unproject([i+t,n]),u=a.distanceTo(l);if("imperial"===this.options.unit){const d=3.2808*u;d>5280?this._setScale(t,d/5280,"mile"):this._setScale(t,d,"foot")}else"nautical"===this.options.unit?this._setScale(t,u/1852,"nautical-mile"):u>=1e3?this._setScale(t,u/1e3,"kilometer"):this._setScale(t,u,"meter")}_setScale(t,e,n){this._map._requestDomTask(()=>{const i=function(l){const u=Math.pow(10,`${Math.floor(l)}`.length-1);let d=l/u;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(f){const p=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*p)/p}(d),u*d}(e),a=i/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):`${i}&nbsp;${n3[n]}`,this._container.style.width=t*a+"px"})}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof ie.HTMLElement?this._container=t.container:K("Full screen control 'container' must be a DOM element.")),ui(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in ie.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in ie.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=Cn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",K("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,ie.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!ie.document.fullscreenEnabled&&!ie.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=Cn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Cn("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),ie.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(ie.document.fullscreenElement||ie.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?ie.document.exitFullscreen?ie.document.exitFullscreen():ie.document.webkitCancelFullScreen&&ie.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends wr{constructor(t){super(),this.options=qe(Object.create(WA),t),ui(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new Me("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new Me("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=_t.convert(t),this._pos=null,this._trackPointer=!1,this._update();const e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(ie.document.createTextNode(t))}setHTML(t){const e=ie.document.createDocumentFragment(),n=ie.document.createElement("body");let i;for(n.innerHTML=t;i=n.firstChild,i;)e.appendChild(i);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=Cn("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const n=this._closeButton=Cn("button","mapboxgl-popup-close-button",e);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,n=this._container,i=this._pos;if(!e||!n||!i)return"bottom";const a=n.offsetWidth,l=n.offsetHeight,u=i.x<a/2,d=i.x>e.transform.width-a/2;if(i.y+t<l)return u?"top-left":d?"top-right":"top";if(i.y>e.transform.height-l){if(u)return"bottom-left";if(d)return"bottom-right"}return u?"left":d?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){const e=this._map,n=this._content;if(!e||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=Cn("div","mapboxgl-popup",e.getContainer()),this._tip=Cn("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Rm(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){const a=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),l=sC(this.options.offset),u=this._anchor=this._getAnchor(l.y),d=sC(this.options.offset,u),f=a.add(d).round();e._requestDomTask(()=>{this._container&&u&&(this._container.style.transform=`${vb[u]} translate(${f.x}px,${f.y}px)`)})}if(!this._marker&&e._showingGlobe()){const a=p_(e.transform,this._lngLat)?0:1;this._setOpacity(a)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(XA);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:bb,Style:Ns,LngLat:_t,LngLatBounds:Rs,Point:ee,MercatorCoordinate:Gt,FreeCameraOptions:aM,Evented:wr,config:kt,prewarm:function(){Yd().acquire(y0)},clearPrewarmedResources:function(){const t=mm;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(y0),mm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return kt.ACCESS_TOKEN},set accessToken(t){kt.ACCESS_TOKEN=t},get baseApiUrl(){return kt.API_URL},set baseApiUrl(t){kt.API_URL=t},get workerCount(){return ih.workerCount},set workerCount(t){ih.workerCount=t},get maxParallelImageRequests(){return kt.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){kt.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){!function(e){if(!Eh())return;const n=ie.caches.delete(Nn);e&&n.catch(e).then(()=>e())}(t)},workerUrl:"",workerClass:null,get dracoUrl(){return YM()},set dracoUrl(t){x0=Fe.resolveURL(t),b1||(b1=new dm(Yd(),new wr)),b1.broadcast("setDracoUrl",x0)},setNow:Fe.setNow,restoreNow:Fe.restoreNow};Xe.A=x1,Xe.D=na,Xe.E=le,Xe.F=Dv,Xe.K=C0,Xe.O=Zt,Xe.P=ee,Xe.T=uI,Xe.V=Lp,Xe.a=D_,Xe.b=dE,Xe.c=g0,Xe.d=class extends wr{constructor(t,e,n,i,a,l){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=a||XM,this.loading={},this.loaded={},this.deduped=new rh(t.scheduler),this.isSpriteLoaded=i,this.scheduler=t.scheduler,this.brightness=l}loadTile(t,e){const n=t.uid,i=t&&t.request,a=i&&i.collectResourceTiming,l=this.loading[n]=new OI(t);l.abort=this.loadVectorData(t,(u,d)=>{const f=!this.loading[n];if(delete this.loading[n],f||u||!d)return l.status="done",f||(this.loaded[n]=l),e(u);const p=d.rawData,g={};d.expires&&(g.expires=d.expires),d.cacheControl&&(g.cacheControl=d.cacheControl),l.vectorTile=d.vectorTile||new kp(new hr(p));const _=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,(x,v)=>{if(x||!v)return e(x);const b={};if(a){const E=cw(i);E.length>0&&(b.resourceTiming=JSON.parse(JSON.stringify(E)))}e(null,qe({rawTileData:p.slice(0)},v,g,b))})};this.isSpriteLoaded?_():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):_()}),this.loaded=this.loaded||{},this.loaded[n]=l})}reloadTile(t,e){const n=this.loaded,i=t.uid,a=this;if(n&&n[i]){const l=n[i];l.showCollisionBoxes=t.showCollisionBoxes,l.projection=t.projection,l.brightness=t.brightness,l.tileTransform=Qc(t.tileID.canonical,t.projection),l.extraShadowCaster=t.extraShadowCaster;const u=(d,f)=>{const p=l.reloadCallback;p&&(delete l.reloadCallback,l.parse(l.vectorTile,a.layerIndex,this.availableImages,a.actor,p)),e(d,f)};"parsing"===l.status?l.reloadCallback=u:"done"===l.status&&(l.vectorTile?l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,u):u())}}abortTile(t,e){const n=t.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()}},Xe.e=Vl,Xe.f=cw,Xe.g=Zo,Xe.h=Ae,Xe.i=ke,Xe.j=function(t,e){const n=rT(t);for(const i of n){for(const a of i.meshes)MR(a);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(iT(i.lights,e)))}return n},Xe.k=tr,Xe.l=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==T1){const n=new Uint32Array(t,0,7),[,,i,a,l,u]=n;e=n.byteLength+a+l+u+l,(i!==t.byteLength||e>=t.byteLength)&&K("Invalid b3dm header information.")}return eT(t,e)},Xe.m=Wp,Xe.n=ts,Xe.o=Me,Xe.p=wc,Xe.q=function(t){Wo(),Oo&&Oo.then(e=>{e.keys().then(n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])})})},Xe.r=aT,Xe.s=Z0,Xe.t=Zu,Xe.v=Mi,Xe.w=ie}),wf(0,function(Xe){function ie(Ie){if("number"==typeof Ie||"boolean"==typeof Ie||"string"==typeof Ie||null==Ie)return JSON.stringify(Ie);if(Array.isArray(Ie)){let q="[";for(const K of Ie)q+=`${ie(K)},`;return`${q}]`}let U="{";for(const q of Object.keys(Ie).sort())U+=`${q}:${ie(Ie[q])},`;return`${U}}`}function la(Ie){let U="";for(const q of Xe.r)U+=`/${ie(Ie[q])}`;return U}class Ha{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U,q){this._layerConfigs={},this._layers={},this.update(U,[],q)}update(U,q,K){this._options=K;for(const Ee of U){this._layerConfigs[Ee.id]=Ee;const $e=this._layers[Ee.id]=Xe.c(Ee,this._options);$e.setScope(this.scope),$e.compileFilter(),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id]}for(const Ee of q)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const xe=function(Ee,$e){const Ye={};for(let tt=0;tt<Ee.length;tt++){const mt=$e&&$e[Ee[tt].id]||la(Ee[tt]);$e&&($e[Ee[tt].id]=mt);let gt=Ye[mt];gt||(gt=Ye[mt]=[]),gt.push(Ee[tt])}const we=[];for(const tt in Ye)we.push(Ye[tt]);return we}(Xe.v(this._layerConfigs),this.keyCache);for(const Ee of xe){const $e=Ee.map(In=>this._layers[In.id]),Ye=$e[0];if("none"===Ye.visibility)continue;const we=Ye.source||"";let tt=this.familiesBySource[we];tt||(tt=this.familiesBySource[we]={});const mt=Ye.sourceLayer||"_geojsonTileLayer";let gt=tt[mt];gt||(gt=tt[mt]=[]),gt.push($e)}}}class kt{loadTile(U,q){const{uid:K,encoding:xe,rawImageData:Ee,padding:$e}=U,Ye=Xe.w.ImageBitmap&&Ee instanceof Xe.w.ImageBitmap?this.getImageData(Ee,$e):Ee;q(null,new Xe.D(K,Ye,xe,U.convertToFloat,$e<1))}getImageData(U,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const K=this.offscreenCanvasContext.getImageData(-q,-q,U.width+2*q,U.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),K}}function ws(Ie,U){if(0!==Ie.length){ca(Ie[0],U);for(var q=1;q<Ie.length;q++)ca(Ie[q],!U)}}function ca(Ie,U){for(var q=0,K=0,xe=0,Ee=Ie.length,$e=Ee-1;xe<Ee;$e=xe++){var Ye=(Ie[xe][0]-Ie[$e][0])*(Ie[$e][1]+Ie[xe][1]),we=q+Ye;K+=Math.abs(q)>=Math.abs(Ye)?q-we+Ye:Ye-we+q,q=we}q+K>=0!=!!U&&Ie.reverse()}var kl=Xe.g(function Ie(U,q){var K,xe=U&&U.type;if("FeatureCollection"===xe)for(K=0;K<U.features.length;K++)Ie(U.features[K],q);else if("GeometryCollection"===xe)for(K=0;K<U.geometries.length;K++)Ie(U.geometries[K],q);else if("Feature"===xe)Ie(U.geometry,q);else if("Polygon"===xe)ws(U.coordinates,q);else if("MultiPolygon"===xe)for(K=0;K<U.coordinates.length;K++)ws(U.coordinates[K],q);return U});const _u=Xe.V.prototype.toGeoJSON;var bc={exports:{}},Zm=Xe.p,Ef=Xe.a.VectorTileFeature,Zo=Ga;function Ga(Ie,U){this.options=U||{},this.features=Ie,this.length=Ie.length}function qa(Ie,U){this.id="number"==typeof Ie.id?Ie.id:void 0,this.type=Ie.type,this.rawGeometry=1===Ie.type?[Ie.geometry]:Ie.geometry,this.properties=Ie.tags,this.extent=U||4096}Ga.prototype.feature=function(Ie){return new qa(this.features[Ie],this.options.extent)},qa.prototype.loadGeometry=function(){var Ie=this.rawGeometry;this.geometry=[];for(var U=0;U<Ie.length;U++){for(var q=Ie[U],K=[],xe=0;xe<q.length;xe++)K.push(new Zm(q[xe][0],q[xe][1]));this.geometry.push(K)}return this.geometry},qa.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ie=this.geometry,U=1/0,q=-1/0,K=1/0,xe=-1/0,Ee=0;Ee<Ie.length;Ee++)for(var $e=Ie[Ee],Ye=0;Ye<$e.length;Ye++){var we=$e[Ye];U=Math.min(U,we.x),q=Math.max(q,we.x),K=Math.min(K,we.y),xe=Math.max(xe,we.y)}return[U,K,q,xe]},qa.prototype.toGeoJSON=Ef.prototype.toGeoJSON;var Wm=Xe.b,wc=Zo;function Za(Ie){var U=new Wm;return function(q,K){for(var xe in q.layers)K.writeMessage(3,ee,q.layers[xe])}(Ie,U),U.finish()}function ee(Ie,U){var q;U.writeVarintField(15,Ie.version||1),U.writeStringField(1,Ie.name||""),U.writeVarintField(5,Ie.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<Ie.length;q++)K.feature=Ie.feature(q),U.writeMessage(2,en,K);var xe=K.keys;for(q=0;q<xe.length;q++)U.writeStringField(3,xe[q]);var Ee=K.values;for(q=0;q<Ee.length;q++)U.writeMessage(4,Ty,Ee[q])}function en(Ie,U){var q=Ie.feature;void 0!==q.id&&U.writeVarintField(1,q.id),U.writeMessage(2,yu,Ie),U.writeVarintField(3,q.type),U.writeMessage(4,ei,q)}function yu(Ie,U){var q=Ie.feature,K=Ie.keys,xe=Ie.values,Ee=Ie.keycache,$e=Ie.valuecache;for(var Ye in q.properties){var we=q.properties[Ye],tt=Ee[Ye];if(null!==we){void 0===tt&&(K.push(Ye),Ee[Ye]=tt=K.length-1),U.writeVarint(tt);var mt=typeof we;"string"!==mt&&"boolean"!==mt&&"number"!==mt&&(we=JSON.stringify(we));var gt=mt+":"+we,In=$e[gt];void 0===In&&(xe.push(we),$e[gt]=In=xe.length-1),U.writeVarint(In)}}}function Wa(Ie,U){return(U<<3)+(7&Ie)}function Et(Ie){return Ie<<1^Ie>>31}function ei(Ie,U){for(var q=Ie.loadGeometry(),K=Ie.type,xe=0,Ee=0,$e=q.length,Ye=0;Ye<$e;Ye++){var we=q[Ye],tt=1;1===K&&(tt=we.length),U.writeVarint(Wa(1,tt));for(var mt=3===K?we.length-1:we.length,gt=0;gt<mt;gt++){1===gt&&1!==K&&U.writeVarint(Wa(2,mt-1));var In=we[gt].x-xe,_r=we[gt].y-Ee;U.writeVarint(Et(In)),U.writeVarint(Et(_r)),xe+=In,Ee+=_r}3===K&&U.writeVarint(Wa(7,1))}}function Ty(Ie,U){var q=typeof Ie;"string"===q?U.writeStringField(1,Ie):"boolean"===q?U.writeBooleanField(7,Ie):"number"===q&&(Ie%1!=0?U.writeDoubleField(3,Ie):Ie<0?U.writeSVarintField(6,Ie):U.writeVarintField(5,Ie))}bc.exports=Za,bc.exports.fromVectorTileJs=Za,bc.exports.fromGeojsonVt=function(Ie,U){U=U||{};var q={};for(var K in Ie)q[K]=new wc(Ie[K].features,U),q[K].name=K,q[K].version=U.version,q[K].extent=U.extent;return Za({layers:q})},bc.exports.GeoJSONWrapper=wc;var Ec=Xe.g(bc.exports);const Xa={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ie=>Ie},xu=Math.fround||(Mc=new Float32Array(1),Ie=>(Mc[0]=+Ie,Mc[0]));var Mc;const Un=3,We=5,Ya=6;class Ja{constructor(U){this.options=Object.assign(Object.create(Xa),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:q,minZoom:K,maxZoom:xe}=this.options;q&&console.time("total time");const Ee=`prepare ${U.length} points`;q&&console.time(Ee),this.points=U;const $e=[];for(let we=0;we<U.length;we++){const tt=U[we];if(!tt.geometry)continue;const[mt,gt]=tt.geometry.coordinates,In=xu(qe(mt)),_r=xu(Ro(gt));$e.push(In,_r,1/0,we,-1,1),this.options.reduce&&$e.push(0)}let Ye=this.trees[xe+1]=this._createTree($e);q&&console.timeEnd(Ee);for(let we=xe;we>=K;we--){const tt=+Date.now();Ye=this.trees[we]=this._createTree(this._cluster(Ye,we)),q&&console.log("z%d: %d clusters in %dms",we,Ye.numItems,+Date.now()-tt)}return q&&console.timeEnd("total time"),this}getClusters(U,q){let K=((U[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,U[1]));let Ee=180===U[2]?180:((U[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)K=-180,Ee=180;else if(K>Ee){const gt=this.getClusters([K,xe,180,$e],q),In=this.getClusters([-180,xe,Ee,$e],q);return gt.concat(In)}const Ye=this.trees[this._limitZoom(q)],we=Ye.range(qe(K),Ro($e),qe(Ee),Ro(xe)),tt=Ye.data,mt=[];for(const gt of we){const In=this.stride*gt;mt.push(tt[In+We]>1?vu(tt,In,this.clusterProps):this.points[tt[In+Un]])}return mt}getChildren(U){const q=this._getOriginId(U),K=this._getOriginZoom(U),xe="No cluster with the specified id.",Ee=this.trees[K];if(!Ee)throw new Error(xe);const $e=Ee.data;if(q*this.stride>=$e.length)throw new Error(xe);const Ye=this.options.radius/(this.options.extent*Math.pow(2,K-1)),we=Ee.within($e[q*this.stride],$e[q*this.stride+1],Ye),tt=[];for(const mt of we){const gt=mt*this.stride;$e[gt+4]===U&&tt.push($e[gt+We]>1?vu($e,gt,this.clusterProps):this.points[$e[gt+Un]])}if(0===tt.length)throw new Error(xe);return tt}getLeaves(U,q,K){const xe=[];return this._appendLeaves(xe,U,q=q||10,K=K||0,0),xe}getTile(U,q,K){const xe=this.trees[this._limitZoom(U)],Ee=Math.pow(2,U),{extent:$e,radius:Ye}=this.options,we=Ye/$e,tt=(K-we)/Ee,mt=(K+1+we)/Ee,gt={features:[]};return this._addTileFeatures(xe.range((q-we)/Ee,tt,(q+1+we)/Ee,mt),xe.data,q,K,Ee,gt),0===q&&this._addTileFeatures(xe.range(1-we/Ee,tt,1,mt),xe.data,Ee,K,Ee,gt),q===Ee-1&&this._addTileFeatures(xe.range(0,tt,we/Ee,mt),xe.data,-1,K,Ee,gt),gt.features.length?gt:null}getClusterExpansionZoom(U){let q=this._getOriginZoom(U)-1;for(;q<=this.options.maxZoom;){const K=this.getChildren(U);if(q++,1!==K.length)break;U=K[0].properties.cluster_id}return q}_appendLeaves(U,q,K,xe,Ee){const $e=this.getChildren(q);for(const Ye of $e){const we=Ye.properties;if(we&&we.cluster?Ee+we.point_count<=xe?Ee+=we.point_count:Ee=this._appendLeaves(U,we.cluster_id,K,xe,Ee):Ee<xe?Ee++:U.push(Ye),U.length===K)break}return Ee}_createTree(U){const q=new Xe.K(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<U.length;K+=this.stride)q.add(U[K],U[K+1]);return q.finish(),q.data=U,q}_addTileFeatures(U,q,K,xe,Ee,$e){for(const Ye of U){const we=Ye*this.stride,tt=q[we+We]>1;let mt,gt,In;if(tt)mt=Mi(q,we,this.clusterProps),gt=q[we],In=q[we+1];else{const yr=this.points[q[we+Un]];mt=yr.properties;const[Fn,Nn]=yr.geometry.coordinates;gt=qe(Fn),In=Ro(Nn)}const _r={type:1,geometry:[[Math.round(this.options.extent*(gt*Ee-K)),Math.round(this.options.extent*(In*Ee-xe))]],tags:mt};let xi;xi=tt||this.options.generateId?q[we+Un]:this.points[q[we+Un]].id,void 0!==xi&&(_r.id=xi),$e.features.push(_r)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,q){const{radius:K,extent:xe,reduce:Ee,minPoints:$e}=this.options,Ye=K/(xe*Math.pow(2,q)),we=U.data,tt=[],mt=this.stride;for(let gt=0;gt<we.length;gt+=mt){if(we[gt+2]<=q)continue;we[gt+2]=q;const In=we[gt],_r=we[gt+1],xi=U.within(we[gt],we[gt+1],Ye),yr=we[gt+We];let Fn=yr;for(const Nn of xi){const eo=Nn*mt;we[eo+2]>q&&(Fn+=we[eo+We])}if(Fn>yr&&Fn>=$e){let Nn,eo=In*yr,_o=_r*yr,Oo=-1;const ua=((gt/mt|0)<<5)+(q+1)+this.points.length;for(const Eh of xi){const Wo=Eh*mt;if(we[Wo+2]<=q)continue;we[Wo+2]=q;const Ll=we[Wo+We];eo+=we[Wo]*Ll,_o+=we[Wo+1]*Ll,we[Wo+4]=ua,Ee&&(Nn||(Nn=this._map(we,gt,!0),Oo=this.clusterProps.length,this.clusterProps.push(Nn)),Ee(Nn,this._map(we,Wo)))}we[gt+4]=ua,tt.push(eo/Fn,_o/Fn,1/0,ua,-1,Fn),Ee&&tt.push(Oo)}else{for(let Nn=0;Nn<mt;Nn++)tt.push(we[gt+Nn]);if(Fn>1)for(const Nn of xi){const eo=Nn*mt;if(!(we[eo+2]<=q)){we[eo+2]=q;for(let _o=0;_o<mt;_o++)tt.push(we[eo+_o])}}}}return tt}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,q,K){if(U[q+We]>1){const $e=this.clusterProps[U[q+Ya]];return K?Object.assign({},$e):$e}const xe=this.points[U[q+Un]].properties,Ee=this.options.map(xe);return K&&Ee===xe?Object.assign({},Ee):Ee}}function vu(Ie,U,q){return{type:"Feature",id:Ie[U+Un],properties:Mi(Ie,U,q),geometry:{type:"Point",coordinates:[(K=Ie[U],360*(K-.5)),ci(Ie[U+1])]}};var K}function Mi(Ie,U,q){const K=Ie[U+We],xe=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,Ee=Ie[U+Ya],$e=-1===Ee?{}:Object.assign({},q[Ee]);return Object.assign($e,{cluster:!0,cluster_id:Ie[U+Un],point_count:K,point_count_abbreviated:xe})}function qe(Ie){return Ie/360+.5}function Ro(Ie){const U=Math.sin(Ie*Math.PI/180),q=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return q<0?0:q>1?1:q}function ci(Ie){const U=(180-360*Ie)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}var Ar={exports:{}};Ar.exports=function(){function Ie(fe,ye,Te,Pe){for(var Ae,ke=Pe,Be=Te-ye>>1,Re=Te-ye,Ze=fe[ye],Le=fe[ye+1],Ct=fe[Te],mn=fe[Te+1],rt=ye+3;rt<Te;rt+=3){var dn=U(fe[rt],fe[rt+1],Ze,Le,Ct,mn);if(dn>ke)Ae=rt,ke=dn;else if(dn===ke){var fn=Math.abs(rt-Be);fn<Re&&(Ae=rt,Re=fn)}}ke>Pe&&(Ae-ye>3&&Ie(fe,ye,Ae,Pe),fe[Ae+2]=ke,Te-Ae>3&&Ie(fe,Ae,Te,Pe))}function U(fe,ye,Te,Pe,Ae,ke){var Be=Ae-Te,Re=ke-Pe;if(0!==Be||0!==Re){var Ze=((fe-Te)*Be+(ye-Pe)*Re)/(Be*Be+Re*Re);Ze>1?(Te=Ae,Pe=ke):Ze>0&&(Te+=Be*Ze,Pe+=Re*Ze)}return(Be=fe-Te)*Be+(Re=ye-Pe)*Re}function q(fe,ye,Te,Pe){var Ae={id:void 0===fe?null:fe,type:ye,geometry:Te,tags:Pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ke){var Be=ke.geometry,Re=ke.type;if("Point"===Re||"MultiPoint"===Re||"LineString"===Re)K(ke,Be);else if("Polygon"===Re||"MultiLineString"===Re)for(var Ze=0;Ze<Be.length;Ze++)K(ke,Be[Ze]);else if("MultiPolygon"===Re)for(Ze=0;Ze<Be.length;Ze++)for(var Le=0;Le<Be[Ze].length;Le++)K(ke,Be[Ze][Le])}(Ae),Ae}function K(fe,ye){for(var Te=0;Te<ye.length;Te+=3)fe.minX=Math.min(fe.minX,ye[Te]),fe.minY=Math.min(fe.minY,ye[Te+1]),fe.maxX=Math.max(fe.maxX,ye[Te]),fe.maxY=Math.max(fe.maxY,ye[Te+1])}function xe(fe,ye,Te,Pe){if(ye.geometry){var Ae=ye.geometry.coordinates,ke=ye.geometry.type,Be=Math.pow(Te.tolerance/((1<<Te.maxZoom)*Te.extent),2),Re=[],Ze=ye.id;if(Te.promoteId?Ze=ye.properties[Te.promoteId]:Te.generateId&&(Ze=Pe||0),"Point"===ke)Ee(Ae,Re);else if("MultiPoint"===ke)for(var Le=0;Le<Ae.length;Le++)Ee(Ae[Le],Re);else if("LineString"===ke)$e(Ae,Re,Be,!1);else if("MultiLineString"===ke){if(Te.lineMetrics){for(Le=0;Le<Ae.length;Le++)$e(Ae[Le],Re=[],Be,!1),fe.push(q(Ze,"LineString",Re,ye.properties));return}Ye(Ae,Re,Be,!1)}else if("Polygon"===ke)Ye(Ae,Re,Be,!0);else{if("MultiPolygon"!==ke){if("GeometryCollection"===ke){for(Le=0;Le<ye.geometry.geometries.length;Le++)xe(fe,{id:Ze,geometry:ye.geometry.geometries[Le],properties:ye.properties},Te,Pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Le=0;Le<Ae.length;Le++){var Ct=[];Ye(Ae[Le],Ct,Be,!0),Re.push(Ct)}}fe.push(q(Ze,ke,Re,ye.properties))}}function Ee(fe,ye){ye.push(we(fe[0])),ye.push(tt(fe[1])),ye.push(0)}function $e(fe,ye,Te,Pe){for(var Ae,ke,Be=0,Re=0;Re<fe.length;Re++){var Ze=we(fe[Re][0]),Le=tt(fe[Re][1]);ye.push(Ze),ye.push(Le),ye.push(0),Re>0&&(Be+=Pe?(Ae*Le-Ze*ke)/2:Math.sqrt(Math.pow(Ze-Ae,2)+Math.pow(Le-ke,2))),Ae=Ze,ke=Le}var Ct=ye.length-3;ye[2]=1,Ie(ye,0,Ct,Te),ye[Ct+2]=1,ye.size=Math.abs(Be),ye.start=0,ye.end=ye.size}function Ye(fe,ye,Te,Pe){for(var Ae=0;Ae<fe.length;Ae++){var ke=[];$e(fe[Ae],ke,Te,Pe),ye.push(ke)}}function we(fe){return fe/360+.5}function tt(fe){var ye=Math.sin(fe*Math.PI/180),Te=.5-.25*Math.log((1+ye)/(1-ye))/Math.PI;return Te<0?0:Te>1?1:Te}function mt(fe,ye,Te,Pe,Ae,ke,Be,Re){if(Pe/=ye,ke>=(Te/=ye)&&Be<Pe)return fe;if(Be<Te||ke>=Pe)return null;for(var Ze=[],Le=0;Le<fe.length;Le++){var Ct=fe[Le],mn=Ct.geometry,rt=Ct.type,dn=0===Ae?Ct.minX:Ct.minY,fn=0===Ae?Ct.maxX:Ct.maxY;if(dn>=Te&&fn<Pe)Ze.push(Ct);else if(!(fn<Te||dn>=Pe)){var Cr=[];if("Point"===rt||"MultiPoint"===rt)gt(mn,Cr,Te,Pe,Ae);else if("LineString"===rt)In(mn,Cr,Te,Pe,Ae,!1,Re.lineMetrics);else if("MultiLineString"===rt)xi(mn,Cr,Te,Pe,Ae,!1);else if("Polygon"===rt)xi(mn,Cr,Te,Pe,Ae,!0);else if("MultiPolygon"===rt)for(var Gr=0;Gr<mn.length;Gr++){var to=[];xi(mn[Gr],to,Te,Pe,Ae,!0),to.length&&Cr.push(to)}if(Cr.length){if(Re.lineMetrics&&"LineString"===rt){for(Gr=0;Gr<Cr.length;Gr++)Ze.push(q(Ct.id,rt,Cr[Gr],Ct.tags));continue}"LineString"!==rt&&"MultiLineString"!==rt||(1===Cr.length?(rt="LineString",Cr=Cr[0]):rt="MultiLineString"),"Point"!==rt&&"MultiPoint"!==rt||(rt=3===Cr.length?"Point":"MultiPoint"),Ze.push(q(Ct.id,rt,Cr,Ct.tags))}}}return Ze.length?Ze:null}function gt(fe,ye,Te,Pe,Ae){for(var ke=0;ke<fe.length;ke+=3){var Be=fe[ke+Ae];Be>=Te&&Be<=Pe&&(ye.push(fe[ke]),ye.push(fe[ke+1]),ye.push(fe[ke+2]))}}function In(fe,ye,Te,Pe,Ae,ke,Be){for(var Re,Ze,Le=_r(fe),Ct=0===Ae?Fn:Nn,mn=fe.start,rt=0;rt<fe.length-3;rt+=3){var dn=fe[rt],fn=fe[rt+1],Cr=fe[rt+2],Gr=fe[rt+3],to=fe[rt+4],Hs=0===Ae?dn:fn,ti=0===Ae?Gr:to,ko=!1;Be&&(Re=Math.sqrt(Math.pow(dn-Gr,2)+Math.pow(fn-to,2))),Hs<Te?ti>Te&&(Ze=Ct(Le,dn,fn,Gr,to,Te),Be&&(Le.start=mn+Re*Ze)):Hs>Pe?ti<Pe&&(Ze=Ct(Le,dn,fn,Gr,to,Pe),Be&&(Le.start=mn+Re*Ze)):yr(Le,dn,fn,Cr),ti<Te&&Hs>=Te&&(Ze=Ct(Le,dn,fn,Gr,to,Te),ko=!0),ti>Pe&&Hs<=Pe&&(Ze=Ct(Le,dn,fn,Gr,to,Pe),ko=!0),!ke&&ko&&(Be&&(Le.end=mn+Re*Ze),ye.push(Le),Le=_r(fe)),Be&&(mn+=Re)}var no=fe.length-3;dn=fe[no],fn=fe[no+1],Cr=fe[no+2],(Hs=0===Ae?dn:fn)>=Te&&Hs<=Pe&&yr(Le,dn,fn,Cr),no=Le.length-3,ke&&no>=3&&(Le[no]!==Le[0]||Le[no+1]!==Le[1])&&yr(Le,Le[0],Le[1],Le[2]),Le.length&&ye.push(Le)}function _r(fe){var ye=[];return ye.size=fe.size,ye.start=fe.start,ye.end=fe.end,ye}function xi(fe,ye,Te,Pe,Ae,ke){for(var Be=0;Be<fe.length;Be++)In(fe[Be],ye,Te,Pe,Ae,ke,!1)}function yr(fe,ye,Te,Pe){fe.push(ye),fe.push(Te),fe.push(Pe)}function Fn(fe,ye,Te,Pe,Ae,ke){var Be=(ke-ye)/(Pe-ye);return fe.push(ke),fe.push(Te+(Ae-Te)*Be),fe.push(1),Be}function Nn(fe,ye,Te,Pe,Ae,ke){var Be=(ke-Te)/(Ae-Te);return fe.push(ye+(Pe-ye)*Be),fe.push(ke),fe.push(1),Be}function eo(fe,ye){for(var Te=[],Pe=0;Pe<fe.length;Pe++){var Ae,ke=fe[Pe],Be=ke.type;if("Point"===Be||"MultiPoint"===Be||"LineString"===Be)Ae=_o(ke.geometry,ye);else if("MultiLineString"===Be||"Polygon"===Be){Ae=[];for(var Re=0;Re<ke.geometry.length;Re++)Ae.push(_o(ke.geometry[Re],ye))}else if("MultiPolygon"===Be)for(Ae=[],Re=0;Re<ke.geometry.length;Re++){for(var Ze=[],Le=0;Le<ke.geometry[Re].length;Le++)Ze.push(_o(ke.geometry[Re][Le],ye));Ae.push(Ze)}Te.push(q(ke.id,Be,Ae,ke.tags))}return Te}function _o(fe,ye){var Te=[];Te.size=fe.size,void 0!==fe.start&&(Te.start=fe.start,Te.end=fe.end);for(var Pe=0;Pe<fe.length;Pe+=3)Te.push(fe[Pe]+ye,fe[Pe+1],fe[Pe+2]);return Te}function Oo(fe,ye){if(fe.transformed)return fe;var Te,Pe,Ae,ke=1<<fe.z,Be=fe.x,Re=fe.y;for(Te=0;Te<fe.features.length;Te++){var Ze=fe.features[Te],Le=Ze.geometry,Ct=Ze.type;if(Ze.geometry=[],1===Ct)for(Pe=0;Pe<Le.length;Pe+=2)Ze.geometry.push(ua(Le[Pe],Le[Pe+1],ye,ke,Be,Re));else for(Pe=0;Pe<Le.length;Pe++){var mn=[];for(Ae=0;Ae<Le[Pe].length;Ae+=2)mn.push(ua(Le[Pe][Ae],Le[Pe][Ae+1],ye,ke,Be,Re));Ze.geometry.push(mn)}}return fe.transformed=!0,fe}function ua(fe,ye,Te,Pe,Ae,ke){return[Math.round(Te*(fe*Pe-Ae)),Math.round(Te*(ye*Pe-ke))]}function Eh(fe,ye,Te,Pe,Ae){for(var ke=ye===Ae.maxZoom?0:Ae.tolerance/((1<<ye)*Ae.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Te,y:Pe,z:ye,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Re=0;Re<fe.length;Re++){Be.numFeatures++,Wo(Be,fe[Re],ke,Ae);var Ze=fe[Re].minX,Le=fe[Re].minY,Ct=fe[Re].maxX,mn=fe[Re].maxY;Ze<Be.minX&&(Be.minX=Ze),Le<Be.minY&&(Be.minY=Le),Ct>Be.maxX&&(Be.maxX=Ct),mn>Be.maxY&&(Be.maxY=mn)}return Be}function Wo(fe,ye,Te,Pe){var Ae=ye.geometry,ke=ye.type,Be=[];if("Point"===ke||"MultiPoint"===ke)for(var Re=0;Re<Ae.length;Re+=3)Be.push(Ae[Re]),Be.push(Ae[Re+1]),fe.numPoints++,fe.numSimplified++;else if("LineString"===ke)Ll(Be,Ae,fe,Te,!1,!1);else if("MultiLineString"===ke||"Polygon"===ke)for(Re=0;Re<Ae.length;Re++)Ll(Be,Ae[Re],fe,Te,"Polygon"===ke,0===Re);else if("MultiPolygon"===ke)for(var Ze=0;Ze<Ae.length;Ze++){var Le=Ae[Ze];for(Re=0;Re<Le.length;Re++)Ll(Be,Le[Re],fe,Te,!0,0===Re)}if(Be.length){var Ct=ye.tags||null;if("LineString"===ke&&Pe.lineMetrics){for(var mn in Ct={},ye.tags)Ct[mn]=ye.tags[mn];Ct.mapbox_clip_start=Ae.start/Ae.size,Ct.mapbox_clip_end=Ae.end/Ae.size}var rt={geometry:Be,type:"Polygon"===ke||"MultiPolygon"===ke?3:"LineString"===ke||"MultiLineString"===ke?2:1,tags:Ct};null!==ye.id&&(rt.id=ye.id),fe.features.push(rt)}}function Ll(fe,ye,Te,Pe,Ae,ke){var Be=Pe*Pe;if(Pe>0&&ye.size<(Ae?Be:Pe))Te.numPoints+=ye.length/3;else{for(var Re=[],Ze=0;Ze<ye.length;Ze+=3)(0===Pe||ye[Ze+2]>Be)&&(Te.numSimplified++,Re.push(ye[Ze]),Re.push(ye[Ze+1])),Te.numPoints++;Ae&&function(Le,Ct){for(var mn=0,rt=0,dn=Le.length,fn=dn-2;rt<dn;fn=rt,rt+=2)mn+=(Le[rt]-Le[fn])*(Le[rt+1]+Le[fn+1]);if(mn>0===Ct)for(rt=0,dn=Le.length;rt<dn/2;rt+=2){var Cr=Le[rt],Gr=Le[rt+1];Le[rt]=Le[dn-2-rt],Le[rt+1]=Le[dn-1-rt],Le[dn-2-rt]=Cr,Le[dn-1-rt]=Gr}}(Re,ke),fe.push(Re)}}function Cc(fe,ye){var Te=(ye=this.options=function(Ae,ke){for(var Be in ke)Ae[Be]=ke[Be];return Ae}(Object.create(this.options),ye)).debug;if(Te&&console.time("preprocess data"),ye.maxZoom<0||ye.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ye.promoteId&&ye.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ae,ke,Be,Re,Ze,Le,Pe=function(Ae,ke){var Be=[];if("FeatureCollection"===Ae.type)for(var Re=0;Re<Ae.features.length;Re++)xe(Be,Ae.features[Re],ke,Re);else xe(Be,"Feature"===Ae.type?Ae:{geometry:Ae},ke);return Be}(fe,ye);this.tiles={},this.tileCoords=[],Te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ye.indexMaxZoom,ye.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ae=Pe,ke=ye,Be=ke.buffer/ke.extent,Re=Ae,Ze=mt(Ae,1,-1-Be,Be,0,-1,2,ke),Le=mt(Ae,1,1-Be,2+Be,0,-1,2,ke),(Ze||Le)&&(Re=mt(Ae,1,-Be,1+Be,0,-1,2,ke)||[],Ze&&(Re=eo(Ze,1).concat(Re)),Le&&(Re=Re.concat(eo(Le,-1)))),Pe=Re).length&&this.splitTile(Pe,0,0,0),Te&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Mh(fe,ye,Te){return 32*((1<<fe)*Te+ye)+fe}return Cc.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Cc.prototype.splitTile=function(fe,ye,Te,Pe,Ae,ke,Be){for(var Re=[fe,ye,Te,Pe],Ze=this.options,Le=Ze.debug;Re.length;){Pe=Re.pop(),Te=Re.pop(),ye=Re.pop(),fe=Re.pop();var Ct=1<<ye,mn=Mh(ye,Te,Pe),rt=this.tiles[mn];if(!rt&&(Le>1&&console.time("creation"),rt=this.tiles[mn]=Eh(fe,ye,Te,Pe,Ze),this.tileCoords.push({z:ye,x:Te,y:Pe}),Le)){Le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ye,Te,Pe,rt.numFeatures,rt.numPoints,rt.numSimplified),console.timeEnd("creation"));var dn="z"+ye;this.stats[dn]=(this.stats[dn]||0)+1,this.total++}if(rt.source=fe,Ae){if(ye===Ze.maxZoom||ye===Ae)continue;var fn=1<<Ae-ye;if(Te!==Math.floor(ke/fn)||Pe!==Math.floor(Be/fn))continue}else if(ye===Ze.indexMaxZoom||rt.numPoints<=Ze.indexMaxPoints)continue;if(rt.source=null,0!==fe.length){Le>1&&console.time("clipping");var Cr,Gr,to,Hs,ti,ko,no=.5*Ze.buffer/Ze.extent,Xo=.5-no,Dc=.5+no,ni=1+no;Cr=Gr=to=Hs=null,ti=mt(fe,Ct,Te-no,Te+Dc,0,rt.minX,rt.maxX,Ze),ko=mt(fe,Ct,Te+Xo,Te+ni,0,rt.minX,rt.maxX,Ze),fe=null,ti&&(Cr=mt(ti,Ct,Pe-no,Pe+Dc,1,rt.minY,rt.maxY,Ze),Gr=mt(ti,Ct,Pe+Xo,Pe+ni,1,rt.minY,rt.maxY,Ze),ti=null),ko&&(to=mt(ko,Ct,Pe-no,Pe+Dc,1,rt.minY,rt.maxY,Ze),Hs=mt(ko,Ct,Pe+Xo,Pe+ni,1,rt.minY,rt.maxY,Ze),ko=null),Le>1&&console.timeEnd("clipping"),Re.push(Cr||[],ye+1,2*Te,2*Pe),Re.push(Gr||[],ye+1,2*Te,2*Pe+1),Re.push(to||[],ye+1,2*Te+1,2*Pe),Re.push(Hs||[],ye+1,2*Te+1,2*Pe+1)}}},Cc.prototype.getTile=function(fe,ye,Te){var Pe=this.options,Ae=Pe.extent,ke=Pe.debug;if(fe<0||fe>24)return null;var Be=1<<fe,Re=Mh(fe,ye=(ye%Be+Be)%Be,Te);if(this.tiles[Re])return Oo(this.tiles[Re],Ae);ke>1&&console.log("drilling down to z%d-%d-%d",fe,ye,Te);for(var Ze,Le=fe,Ct=ye,mn=Te;!Ze&&Le>0;)Le--,Ct=Math.floor(Ct/2),mn=Math.floor(mn/2),Ze=this.tiles[Mh(Le,Ct,mn)];return Ze&&Ze.source?(ke>1&&console.log("found parent tile z%d-%d-%d",Le,Ct,mn),ke>1&&console.time("drilling down"),this.splitTile(Ze.source,Le,Ct,mn,fe,ye,Te),ke>1&&console.timeEnd("drilling down"),this.tiles[Re]?Oo(this.tiles[Re],Ae):null):null},function(fe,ye){return new Cc(fe,ye)}}();var Xm=Xe.g(Ar.exports);function On(Ie,U){const q=Ie.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const K=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!K)return U(null,null);const xe=new class{constructor($e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Xe.E,this.length=$e.length,this._features=$e}feature($e){return new class{constructor(Ye){this._feature=Ye,this.extent=Xe.E,this.type=Ye.type,this.properties=Ye.tags,"id"in Ye&&!isNaN(Ye.id)&&(this.id=parseInt(Ye.id,10))}loadGeometry(){if(1===this._feature.type){const Ye=[];for(const we of this._feature.geometry)Ye.push([new Xe.P(we[0],we[1])]);return Ye}{const Ye=[];for(const we of this._feature.geometry){const tt=[];for(const mt of we)tt.push(new Xe.P(mt[0],mt[1]));Ye.push(tt)}return Ye}}toGeoJSON(Ye,we,tt){return _u.call(this,Ye,we,tt)}}(this._features[$e])}}(K.features);let Ee=Ec(xe);0===Ee.byteOffset&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),U(null,{vectorTile:xe,rawData:Ee.buffer})}class bh extends Xe.d{constructor(U,q,K,xe,Ee,$e){super(U,q,K,xe,On,$e),Ee&&(this.loadGeoJSON=Ee)}loadData(U,q){const K=U&&U.request,xe=K&&K.collectResourceTiming;this.loadGeoJSON(U,(Ee,$e)=>{if(Ee||!$e)return q(Ee);if("object"!=typeof $e)return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{kl($e,!0);try{if(U.filter){const we=Xe.e(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===we.result)throw new Error(we.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));$e={type:"FeatureCollection",features:$e.features.filter(mt=>we.value.evaluate({zoom:0},mt))}}this._geoJSONIndex=U.cluster?new Ja(function({superclusterOptions:we,clusterProperties:tt}){if(!tt||!we)return we;const mt={},gt={},In={accumulated:null,zoom:0},_r={properties:null},xi=Object.keys(tt);for(const yr of xi){const[Fn,Nn]=tt[yr],eo=Xe.e(Nn),_o=Xe.e("string"==typeof Fn?[Fn,["accumulated"],["get",yr]]:Fn);mt[yr]=eo.value,gt[yr]=_o.value}return we.map=yr=>{_r.properties=yr;const Fn={};for(const Nn of xi)Fn[Nn]=mt[Nn].evaluate(In,_r);return Fn},we.reduce=(yr,Fn)=>{_r.properties=Fn;for(const Nn of xi)In.accumulated=yr[Nn],yr[Nn]=gt[Nn].evaluate(In,_r)},we}(U)).load($e.features):Xm($e,U.geojsonVtOptions)}catch(we){return q(we)}this.loaded={};const Ye={};if(xe){const we=Xe.f(K);we&&(Ye.resourceTiming={},Ye.resourceTiming[U.source]=JSON.parse(JSON.stringify(we)))}q(null,Ye)}})}reloadTile(U,q){const K=this.loaded;return K&&K[U.uid]?super.reloadTile(U,q):this.loadTile(U,q)}loadGeoJSON(U,q){if(U.request)Xe.h(U.request,q);else{if("string"!=typeof U.data)return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(U.data))}catch{return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(K){q(K)}}getClusterChildren(U,q){try{q(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(K){q(K)}}getClusterLeaves(U,q){try{q(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(K){q(K)}}}class ui{constructor(U,q){this.tileID=new Xe.O(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=U.projection,this.brightness=q}parse(U,q,K,xe){this.status="parsing";const Ee=new Xe.O(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),$e={},Ye=q.familiesBySource[K.source],we=new Xe.F(Ee,K.promoteId);return we.bucketLayerIDs=[],Xe.l(U).then(tt=>{if(!tt)return xe(new Error("Could not parse tile"));const mt=Xe.j(tt,1/Xe.t(K.tileID.canonical)),gt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("MAPBOX_mesh_features"),In=new Xe.k(this.zoom,{brightness:this.brightness});for(const _r in Ye)for(const xi of Ye[_r]){const yr=xi[0],Fn=tt.json.extensionsUsed;yr.recalculate(In,[]);const Nn=new Xe.T(mt,Ee,Fn&&Fn.includes("MAPBOX_mesh_features"),this.brightness);gt||(Nn.needsUpload=!0),$e[yr.fqid]=Nn,Nn.evaluate(yr)}this.status="done",xe(null,{buckets:$e,featureIndex:we})}).catch(tt=>xe(new Error(tt.message)))}}class Tc{constructor(U,q,K,xe,Ee,$e){this.actor=U,this.layerIndex=q,this.brightness=$e,this.loading={},this.loaded={}}loadTile(U,q){const K=U.uid,xe=this.loading[K]=new ui(U,this.brightness);Xe.i(U.request,(Ee,$e)=>{const Ye=!this.loading[K];return delete this.loading[K],Ye||Ee?(xe.status="done",Ye||(this.loaded[K]=xe),q(Ee)):$e&&0!==$e.byteLength?void xe.parse($e,this.layerIndex,U,(we,tt)=>{xe.status="done",this.loaded=this.loaded||{},this.loaded[K]=xe,we||!tt?q(we):q(null,tt)}):(xe.status="done",this.loaded[K]=xe,q())})}reloadTile(U,q){const K=this.loaded,xe=U.uid;if(K&&K[xe]){const Ee=K[xe];Ee.projection=U.projection,Ee.brightness=U.brightness;const $e=(Ye,we)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(U,q)),q(Ye,we)};"parsing"===Ee.status?Ee.reloadCallback=$e:"done"===Ee.status&&this.loadTile(U,q)}}abortTile(U,q){const K=U.uid;this.loading[K]&&delete this.loading[K],q()}removeTile(U,q){const K=this.loaded,xe=U.uid;K&&K[xe]&&delete K[xe],q()}}class wh{constructor(U){this.self=U,this.actor=new Xe.A(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=Xe.m({name:"mercator"}),this.workerSourceTypes={vector:Xe.d,geojson:bh,"batched-model":Tc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,K)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=K},this.self.registerRTLTextPlugin=q=>{if(Xe.n.isParsed())throw new Error("RTL text plugin already registered.");Xe.n.applyArabicShaping=q.applyArabicShaping,Xe.n.processBidirectionalText=q.processBidirectionalText,Xe.n.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(U,q,K){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],K()}checkIfReady(U,q,K){K()}setReferrer(U,q){this.referrer=q}spriteLoaded(U,{scope:q,isLoaded:K}){if(this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),this.isSpriteLoaded[U][q]=K,this.workerSources[U]&&this.workerSources[U][q])for(const xe in this.workerSources[U][q]){const Ee=this.workerSources[U][q][xe];for(const $e in Ee)Ee[$e]instanceof Xe.d&&(Ee[$e].isSpriteLoaded=K,Ee[$e].fire(new Xe.o("isSpriteLoaded")))}}setImages(U,{scope:q,images:K},xe){if(this.availableImages[U]||(this.availableImages[U]={}),this.availableImages[U][q]=K,this.workerSources[U]&&this.workerSources[U][q]){for(const Ee in this.workerSources[U][q]){const $e=this.workerSources[U][q][Ee];for(const Ye in $e)$e[Ye].availableImages=K}xe()}else xe()}setProjection(U,q){this.projections[U]=Xe.m(q)}setBrightness(U,q,K){this.brightness=q,K()}setLayers(U,q,K){this.getLayerIndex(U,q.scope).replace(q.layers,q.options),K()}updateLayers(U,q,K){this.getLayerIndex(U,q.scope).update(q.layers,q.removedIds,q.options),K()}loadTile(U,q,K){q.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,q.type,q.source,q.scope).loadTile(q,K)}loadDEMTile(U,q,K){this.getDEMWorkerSource(U,q.source,q.scope).loadTile(q,K)}reloadTile(U,q,K){q.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,q.type,q.source,q.scope).reloadTile(q,K)}abortTile(U,q,K){this.getWorkerSource(U,q.type,q.source,q.scope).abortTile(q,K)}removeTile(U,q,K){this.getWorkerSource(U,q.type,q.source,q.scope).removeTile(q,K)}removeSource(U,q,K){if(!(this.workerSources[U]&&this.workerSources[U][q.scope]&&this.workerSources[U][q.scope][q.type]&&this.workerSources[U][q.scope][q.type][q.source]))return;const xe=this.workerSources[U][q.scope][q.type][q.source];delete this.workerSources[U][q.scope][q.type][q.source],void 0!==xe.removeSource?xe.removeSource(q,K):K()}loadWorkerSource(U,q,K){try{this.self.importScripts(q.url),K()}catch(xe){K(xe.toString())}}syncRTLPluginState(U,q,K){try{Xe.n.setState(q);const xe=Xe.n.getPluginURL();if(Xe.n.isLoaded()&&!Xe.n.isParsed()&&null!=xe){this.self.importScripts(xe);const Ee=Xe.n.isParsed();K(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xe}`),Ee)}}catch(xe){K(xe.toString())}}setDracoUrl(U,q){this.dracoUrl=q}getAvailableImages(U,q){this.availableImages[U]||(this.availableImages[U]={});let K=this.availableImages[U][q];return K||(K=[]),K}getLayerIndex(U,q){this.layerIndexes[U]||(this.layerIndexes[U]={});let K=this.layerIndexes[U][q];return K||(K=this.layerIndexes[U][q]=new Ha,K.scope=q),K}getWorkerSource(U,q,K,xe){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][xe]||(this.workerSources[U][xe]={}),this.workerSources[U][xe][q]||(this.workerSources[U][xe][q]={}),this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),this.workerSources[U][xe][q][K]||(this.workerSources[U][xe][q][K]=new this.workerSourceTypes[q]({send:($e,Ye,we,tt,mt,gt)=>{this.actor.send($e,Ye,we,U,mt,gt)},scheduler:this.actor.scheduler},this.getLayerIndex(U,xe),this.getAvailableImages(U,xe),this.isSpriteLoaded[U][xe],void 0,this.brightness)),this.workerSources[U][xe][q][K]}getDEMWorkerSource(U,q,K){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][K]||(this.demWorkerSources[U][K]={}),this.demWorkerSources[U][K][q]||(this.demWorkerSources[U][K][q]=new kt),this.demWorkerSources[U][K][q]}enforceCacheSizeLimit(U,q){Xe.q(q)}getWorkerPerformanceMetrics(U,q,K){K(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new wh(self)),wh}),wf(0,function(Xe){return Xe.s}),sr}()}},Ey=>{Ey(Ey.s=575)}]);