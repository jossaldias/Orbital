(self.webpackChunkOrbital=self.webpackChunkOrbital||[]).push([[179],{575:(wv,xh,gu)=>{"use strict";function sr(r){return"function"==typeof r}function wf(r){const s=r(c=>{Error.call(c),c.stack=(new Error).stack});return s.prototype=Object.create(Error.prototype),s.prototype.constructor=s,s}const Ev=wf(r=>function(s){r(this),this.message=s?`${s.length} errors occurred during unsubscription:\n${s.map((c,h)=>`${h+1}) ${c.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=s});function Xt(r,o){if(r){const s=r.indexOf(o);0<=s&&r.splice(s,1)}}class it{constructor(o){this.initialTeardown=o,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let o;if(!this.closed){this.closed=!0;const{_parentage:s}=this;if(s)if(this._parentage=null,Array.isArray(s))for(const m of s)m.remove(this);else s.remove(this);const{initialTeardown:c}=this;if(sr(c))try{c()}catch(m){o=m instanceof Ev?m.errors:[m]}const{_finalizers:h}=this;if(h){this._finalizers=null;for(const m of h)try{ke(m)}catch(y){o=o??[],y instanceof Ev?o=[...o,...y.errors]:o.push(y)}}if(o)throw new Ev(o)}}add(o){var s;if(o&&o!==this)if(this.closed)ke(o);else{if(o instanceof it){if(o.closed||o._hasParent(this))return;o._addParent(this)}(this._finalizers=null!==(s=this._finalizers)&&void 0!==s?s:[]).push(o)}}_hasParent(o){const{_parentage:s}=this;return s===o||Array.isArray(s)&&s.includes(o)}_addParent(o){const{_parentage:s}=this;this._parentage=Array.isArray(s)?(s.push(o),s):s?[s,o]:o}_removeParent(o){const{_parentage:s}=this;s===o?this._parentage=null:Array.isArray(s)&&Xt(s,o)}remove(o){const{_finalizers:s}=this;s&&Xt(s,o),o instanceof it&&o._removeParent(this)}}it.EMPTY=(()=>{const r=new it;return r.closed=!0,r})();const la=it.EMPTY;function Ha(r){return r instanceof it||r&&"closed"in r&&sr(r.remove)&&sr(r.add)&&sr(r.unsubscribe)}function ke(r){sr(r)?r():r.unsubscribe()}const ws={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ca={setTimeout(r,o,...s){const{delegate:c}=ca;return c?.setTimeout?c.setTimeout(r,o,...s):setTimeout(r,o,...s)},clearTimeout(r){const{delegate:o}=ca;return(o?.clearTimeout||clearTimeout)(r)},delegate:void 0};function kl(r){ca.setTimeout(()=>{const{onUnhandledError:o}=ws;if(!o)throw r;o(r)})}function _u(){}const xc=Zo("C",void 0,void 0);function Zo(r,o,s){return{kind:r,value:o,error:s}}let Ga=null;function qa(r){if(ws.useDeprecatedSynchronousErrorHandling){const o=!Ga;if(o&&(Ga={errorThrown:!1,error:null}),r(),o){const{errorThrown:s,error:c}=Ga;if(Ga=null,s)throw c}}else r()}class bc extends it{constructor(o){super(),this.isStopped=!1,o?(this.destination=o,Ha(o)&&o.add(this)):this.destination=Mv}static create(o,s,c){return new yu(o,s,c)}next(o){this.isStopped?ti(function Ef(r){return Zo("N",r,void 0)}(o),this):this._next(o)}error(o){this.isStopped?ti(function Zm(r){return Zo("E",void 0,r)}(o),this):(this.isStopped=!0,this._error(o))}complete(){this.isStopped?ti(xc,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(o){this.destination.next(o)}_error(o){try{this.destination.error(o)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Za=Function.prototype.bind;function tt(r,o){return Za.call(r,o)}class tn{constructor(o){this.partialObserver=o}next(o){const{partialObserver:s}=this;if(s.next)try{s.next(o)}catch(c){Wa(c)}}error(o){const{partialObserver:s}=this;if(s.error)try{s.error(o)}catch(c){Wa(c)}else Wa(o)}complete(){const{partialObserver:o}=this;if(o.complete)try{o.complete()}catch(s){Wa(s)}}}class yu extends bc{constructor(o,s,c){let h;if(super(),sr(o)||!o)h={next:o??void 0,error:s??void 0,complete:c??void 0};else{let m;this&&ws.useDeprecatedNextContext?(m=Object.create(o),m.unsubscribe=()=>this.unsubscribe(),h={next:o.next&&tt(o.next,m),error:o.error&&tt(o.error,m),complete:o.complete&&tt(o.complete,m)}):h=o}this.destination=new tn(h)}}function Wa(r){ws.useDeprecatedSynchronousErrorHandling?function Wm(r){ws.useDeprecatedSynchronousErrorHandling&&Ga&&(Ga.errorThrown=!0,Ga.error=r)}(r):kl(r)}function ti(r,o){const{onStoppedNotification:s}=ws;s&&ca.setTimeout(()=>s(r,o))}const Mv={closed:!0,next:_u,error:function Ee(r){throw r},complete:_u},wc="function"==typeof Symbol&&Symbol.observable||"@@observable";function Xa(r){return r}function Ec(r){return 0===r.length?Xa:1===r.length?r[0]:function(s){return r.reduce((c,h)=>h(c),s)}}let Un=(()=>{class r{constructor(s){s&&(this._subscribe=s)}lift(s){const c=new r;return c.source=this,c.operator=s,c}subscribe(s,c,h){const m=function Ja(r){return r&&r instanceof bc||function Ya(r){return r&&sr(r.next)&&sr(r.error)&&sr(r.complete)}(r)&&Ha(r)}(s)?s:new yu(s,c,h);return qa(()=>{const{operator:y,source:w}=this;m.add(y?y.call(m,w):w?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(s){try{return this._subscribe(s)}catch(c){s.error(c)}}forEach(s,c){return new(c=Wt(c))((h,m)=>{const y=new yu({next:w=>{try{s(w)}catch(M){m(M),y.unsubscribe()}},error:m,complete:h});this.subscribe(y)})}_subscribe(s){var c;return null===(c=this.source)||void 0===c?void 0:c.subscribe(s)}[wc](){return this}pipe(...s){return Ec(s)(this)}toPromise(s){return new(s=Wt(s))((c,h)=>{let m;this.subscribe(y=>m=y,y=>h(y),()=>c(m))})}}return r.create=o=>new r(o),r})();function Wt(r){var o;return null!==(o=r??ws.Promise)&&void 0!==o?o:Promise}const xu=wf(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let vi=(()=>{class r extends Un{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(s){const c=new qt(this,this);return c.operator=s,c}_throwIfClosed(){if(this.closed)throw new xu}next(s){qa(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const c of this.currentObservers)c.next(s)}})}error(s){qa(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=s;const{observers:c}=this;for(;c.length;)c.shift().error(s)}})}complete(){qa(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:s}=this;for(;s.length;)s.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var s;return(null===(s=this.observers)||void 0===s?void 0:s.length)>0}_trySubscribe(s){return this._throwIfClosed(),super._trySubscribe(s)}_subscribe(s){return this._throwIfClosed(),this._checkFinalizedStatuses(s),this._innerSubscribe(s)}_innerSubscribe(s){const{hasError:c,isStopped:h,observers:m}=this;return c||h?la:(this.currentObservers=null,m.push(s),new it(()=>{this.currentObservers=null,Xt(m,s)}))}_checkFinalizedStatuses(s){const{hasError:c,thrownError:h,isStopped:m}=this;c?s.error(h):m&&s.complete()}asObservable(){const s=new Un;return s.source=this,s}}return r.create=(o,s)=>new qt(o,s),r})();class qt extends vi{constructor(o,s){super(),this.destination=o,this.source=s}next(o){var s,c;null===(c=null===(s=this.destination)||void 0===s?void 0:s.next)||void 0===c||c.call(s,o)}error(o){var s,c;null===(c=null===(s=this.destination)||void 0===s?void 0:s.error)||void 0===c||c.call(s,o)}complete(){var o,s;null===(s=null===(o=this.destination)||void 0===o?void 0:o.complete)||void 0===s||s.call(o)}_subscribe(o){var s,c;return null!==(c=null===(s=this.source)||void 0===s?void 0:s.subscribe(o))&&void 0!==c?c:la}}function Ro(r){return sr(r?.lift)}function ci(r){return o=>{if(Ro(o))return o.lift(function(s){try{return r(s,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ar(r,o,s,c,h){return new Xm(r,o,s,c,h)}class Xm extends bc{constructor(o,s,c,h,m,y){super(o),this.onFinalize=m,this.shouldUnsubscribe=y,this._next=s?function(w){try{s(w)}catch(M){o.error(M)}}:super._next,this._error=h?function(w){try{h(w)}catch(M){o.error(M)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(w){o.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var o;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:s}=this;super.unsubscribe(),!s&&(null===(o=this.onFinalize)||void 0===o||o.call(this))}}}function On(r,o){return ci((s,c)=>{let h=0;s.subscribe(Ar(c,m=>{c.next(r.call(o,m,h++))}))})}function Fn(r){return this instanceof Fn?(this.v=r,this):new Fn(r)}function go(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,o=r[Symbol.asyncIterator];return o?o.call(r):(r=function ge(r){var o="function"==typeof Symbol&&Symbol.iterator,s=o&&r[o],c=0;if(s)return s.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&c>=r.length&&(r=void 0),{value:r&&r[c++],done:!r}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s);function c(m){s[m]=r[m]&&function(y){return new Promise(function(w,M){!function h(m,y,w,M){Promise.resolve(M).then(function(S){m({value:S,done:w})},y)}(w,M,(y=r[m](y)).done,y.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const At=r=>r&&"number"==typeof r.length&&"function"!=typeof r;function kt(r){return sr(r?.then)}function Bt(r){return sr(r[wc])}function Rt(r){return Symbol.asyncIterator&&sr(r?.[Symbol.asyncIterator])}function Zt(r){return new TypeError(`You provided ${null!==r&&"object"==typeof r?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Te=function Lt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function mn(r){return sr(r?.[Te])}function re(r){return function Nn(r,o,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h,c=s.apply(r,o||[]),m=[];return h={},y("next"),y("throw"),y("return"),h[Symbol.asyncIterator]=function(){return this},h;function y($){c[$]&&(h[$]=function(Y){return new Promise(function(st,ht){m.push([$,Y,st,ht])>1||w($,Y)})})}function w($,Y){try{!function M($){$.value instanceof Fn?Promise.resolve($.value.v).then(S,O):F(m[0][2],$)}(c[$](Y))}catch(st){F(m[0][3],st)}}function S($){w("next",$)}function O($){w("throw",$)}function F($,Y){$(Y),m.shift(),m.length&&w(m[0][0],m[0][1])}}(this,arguments,function*(){const s=r.getReader();try{for(;;){const{value:c,done:h}=yield Fn(s.read());if(h)return yield Fn(void 0);yield yield Fn(c)}}finally{s.releaseLock()}})}function dn(r){return sr(r?.getReader)}function fn(r){if(r instanceof Un)return r;if(null!=r){if(Bt(r))return function Tr(r){return new Un(o=>{const s=r[wc]();if(sr(s.subscribe))return s.subscribe(o);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(r);if(At(r))return function Gr(r){return new Un(o=>{for(let s=0;s<r.length&&!o.closed;s++)o.next(r[s]);o.complete()})}(r);if(kt(r))return function eo(r){return new Un(o=>{r.then(s=>{o.closed||(o.next(s),o.complete())},s=>o.error(s)).then(null,kl)})}(r);if(Rt(r))return ei(r);if(mn(r))return function Hs(r){return new Un(o=>{for(const s of r)if(o.next(s),o.closed)return;o.complete()})}(r);if(dn(r))return function ko(r){return ei(re(r))}(r)}throw Zt(r)}function ei(r){return new Un(o=>{(function no(r,o){var s,c,h,m;return function Yt(r,o,s,c){return new(s||(s=Promise))(function(m,y){function w(O){try{S(c.next(O))}catch(F){y(F)}}function M(O){try{S(c.throw(O))}catch(F){y(F)}}function S(O){O.done?m(O.value):function h(m){return m instanceof s?m:new s(function(y){y(m)})}(O.value).then(w,M)}S((c=c.apply(r,o||[])).next())})}(this,void 0,void 0,function*(){try{for(s=go(r);!(c=yield s.next()).done;)if(o.next(c.value),o.closed)return}catch(y){h={error:y}}finally{try{c&&!c.done&&(m=s.return)&&(yield m.call(s))}finally{if(h)throw h.error}}o.complete()})})(r,o).catch(s=>o.error(s))})}function Xo(r,o,s,c=0,h=!1){const m=o.schedule(function(){s(),h?r.add(this.schedule(null,c)):this.unsubscribe()},c);if(r.add(m),!h)return m}function ni(r,o,s=1/0){return sr(o)?ni((c,h)=>On((m,y)=>o(c,m,h,y))(fn(r(c,h))),s):("number"==typeof o&&(s=o),ci((c,h)=>function Tc(r,o,s,c,h,m,y,w){const M=[];let S=0,O=0,F=!1;const $=()=>{F&&!M.length&&!S&&o.complete()},Y=ht=>S<c?st(ht):M.push(ht),st=ht=>{m&&o.next(ht),S++;let _t=!1;fn(s(ht,O++)).subscribe(Ar(o,bt=>{h?.(bt),m?Y(bt):o.next(bt)},()=>{_t=!0},void 0,()=>{if(_t)try{for(S--;M.length&&S<c;){const bt=M.shift();y?Xo(o,y,()=>st(bt)):st(bt)}$()}catch(bt){o.error(bt)}}))};return r.subscribe(Ar(o,Y,()=>{F=!0,$()})),()=>{w?.()}}(c,h,r,s)))}function Dc(r=1/0){return ni(Xa,r)}const ha=new Un(r=>r.complete());function Ym(r){return r[r.length-1]}function lw(r){return sr(Ym(r))?r.pop():void 0}function Sc(r){return function o2(r){return r&&sr(r.schedule)}(Ym(r))?r.pop():void 0}function Mf(r,o=0){return ci((s,c)=>{s.subscribe(Ar(c,h=>Xo(c,r,()=>c.next(h),o),()=>Xo(c,r,()=>c.complete(),o),h=>Xo(c,r,()=>c.error(h),o)))})}function Cv(r,o=0){return ci((s,c)=>{c.add(r.schedule(()=>s.subscribe(c),o))})}function Jm(r,o){if(!r)throw new Error("Iterable cannot be null");return new Un(s=>{Xo(s,o,()=>{const c=r[Symbol.asyncIterator]();Xo(s,o,()=>{c.next().then(h=>{h.done?s.complete():s.next(h.value)})},0,!0)})})}function hi(r,o){return o?function Km(r,o){if(null!=r){if(Bt(r))return function s2(r,o){return fn(r).pipe(Cv(o),Mf(o))}(r,o);if(At(r))return function uw(r,o){return new Un(s=>{let c=0;return o.schedule(function(){c===r.length?s.complete():(s.next(r[c++]),s.closed||this.schedule())})})}(r,o);if(kt(r))return function a2(r,o){return fn(r).pipe(Cv(o),Mf(o))}(r,o);if(Rt(r))return Jm(r,o);if(mn(r))return function hw(r,o){return new Un(s=>{let c;return Xo(s,o,()=>{c=r[Te](),Xo(s,o,()=>{let h,m;try{({value:h,done:m}=c.next())}catch(y){return void s.error(y)}m?s.complete():s.next(h)},0,!0)}),()=>sr(c?.return)&&c.return()})}(r,o);if(dn(r))return function Tv(r,o){return Jm(re(r),o)}(r,o)}throw Zt(r)}(r,o):fn(r)}class Ui extends vi{constructor(o){super(),this._value=o}get value(){return this.getValue()}_subscribe(o){const s=super._subscribe(o);return!s.closed&&o.next(this._value),s}getValue(){const{hasError:o,thrownError:s,_value:c}=this;if(o)throw s;return this._throwIfClosed(),c}next(o){super.next(this._value=o)}}function Ft(...r){return hi(r,Sc(r))}function Tn(r={}){const{connector:o=(()=>new vi),resetOnError:s=!0,resetOnComplete:c=!0,resetOnRefCountZero:h=!0}=r;return m=>{let y,w,M,S=0,O=!1,F=!1;const $=()=>{w?.unsubscribe(),w=void 0},Y=()=>{$(),y=M=void 0,O=F=!1},st=()=>{const ht=y;Y(),ht?.unsubscribe()};return ci((ht,_t)=>{S++,!F&&!O&&$();const bt=M=M??o();_t.add(()=>{S--,0===S&&!F&&!O&&(w=da(st,h))}),bt.subscribe(_t),!y&&S>0&&(y=new yu({next:mt=>bt.next(mt),error:mt=>{F=!0,$(),w=da(Y,s,mt),bt.error(mt)},complete:()=>{O=!0,$(),w=da(Y,c),bt.complete()}}),fn(ht).subscribe(y))})(m)}}function da(r,o,...s){if(!0===o)return void r();if(!1===o)return;const c=new yu({next:()=>{c.unsubscribe(),r()}});return fn(o(...s)).subscribe(c)}function ro(r,o){return ci((s,c)=>{let h=null,m=0,y=!1;const w=()=>y&&!h&&c.complete();s.subscribe(Ar(c,M=>{h?.unsubscribe();let S=0;const O=m++;fn(r(M,O)).subscribe(h=Ar(c,F=>c.next(o?o(M,F,O,S++):F),()=>{h=null,w()}))},()=>{y=!0,w()}))})}function dw(r,o){return r===o}function tr(r){for(let o in r)if(r[o]===tr)return o;throw Error("Could not find renamed property on target object.")}function Tf(r,o){for(const s in o)o.hasOwnProperty(s)&&!r.hasOwnProperty(s)&&(r[s]=o[s])}function di(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(di).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const s=o.indexOf("\n");return-1===s?o:o.substring(0,s)}function Df(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const Sf=tr({__forward_ref__:tr});function ar(r){return r.__forward_ref__=ar,r.toString=function(){return di(this())},r}function qe(r){return tg(r)?r():r}function tg(r){return"function"==typeof r&&r.hasOwnProperty(Sf)&&r.__forward_ref__===ar}function eg(r){return r&&!!r.\u0275providers}class pt extends Error{constructor(o,s){super(function wr(r,o){return`NG0${Math.abs(r)}${o?": "+o:""}`}(o,s)),this.code=o}}function J(r){return"string"==typeof r?r:null==r?"":String(r)}function fa(r,o){throw new pt(-201,!1)}function _o(r,o){null==r&&function be(r,o,s,c){throw new Error(`ASSERTION ERROR: ${r}`+(null==c?"":` [Expected=> ${s} ${c} ${o} <=Actual]`))}(o,r,null,"!=")}function Ie(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Yo(r){return{providers:r.providers||[],imports:r.imports||[]}}function If(r){return ag(r,io)||ag(r,cg)}function ag(r,o){return r.hasOwnProperty(o)?r[o]:null}function Th(r){return r&&(r.hasOwnProperty(Ae)||r.hasOwnProperty(Sv))?r[Ae]:null}const io=tr({\u0275prov:tr}),Ae=tr({\u0275inj:tr}),cg=tr({ngInjectableDef:tr}),Sv=tr({ngInjectorDef:tr});var He=function(r){return r[r.Default=0]="Default",r[r.Host=1]="Host",r[r.Self=2]="Self",r[r.SkipSelf=4]="SkipSelf",r[r.Optional=8]="Optional",r}(He||{});let Jo;function Ci(r){const o=Jo;return Jo=r,o}function ri(r,o,s){const c=If(r);return c&&"root"==c.providedIn?void 0===c.value?c.value=c.factory():c.value:s&He.Optional?null:void 0!==o?o:void fa(di(r))}const vr=globalThis;class ae{constructor(o,s){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=Ie({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Ko={},Ih="__NG_DI_FLAG__",Rf="ngTempTokenPath",u2=/\n/gm,Ah="__source";let Ph;function Nl(r){const o=Ph;return Ph=r,o}function dg(r,o=He.Default){if(void 0===Ph)throw new pt(-203,!1);return null===Ph?ri(r,void 0,o):Ph.get(r,o&He.Optional?null:void 0,o)}function ye(r,o=He.Default){return(function Iv(){return Jo}()||dg)(qe(r),o)}function le(r,o=He.Default){return ye(r,fg(o))}function fg(r){return typeof r>"u"||"number"==typeof r?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function pg(r){const o=[];for(let s=0;s<r.length;s++){const c=qe(r[s]);if(Array.isArray(c)){if(0===c.length)throw new pt(900,!1);let h,m=He.Default;for(let y=0;y<c.length;y++){const w=c[y],M=Pv(w);"number"==typeof M?-1===M?h=w.token:m|=M:h=w}o.push(ye(h,m))}else o.push(ye(c))}return o}function kf(r,o){return r[Ih]=o,r.prototype[Ih]=o,r}function Pv(r){return r[Ih]}function Ka(r){return{toString:r}.toString()}var Lf=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(Lf||{}),Lo=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(Lo||{});const qs={},zn=[],Oh=tr({\u0275cmp:tr}),mg=tr({\u0275dir:tr}),Ff=tr({\u0275pipe:tr}),lt=tr({\u0275mod:tr}),Qa=tr({\u0275fac:tr}),Eu=tr({__NG_ELEMENT_ID__:tr}),gg=tr({__NG_ENV_ID__:tr});function Rv(r,o,s){let c=r.length;for(;;){const h=r.indexOf(o,s);if(-1===h)return h;if(0===h||r.charCodeAt(h-1)<=32){const m=o.length;if(h+m===c||r.charCodeAt(h+m)<=32)return h}s=h+1}}function kh(r,o,s){let c=0;for(;c<s.length;){const h=s[c];if("number"==typeof h){if(0!==h)break;c++;const m=s[c++],y=s[c++],w=s[c++];r.setAttribute(o,y,w,m)}else{const m=h,y=s[++c];_g(m)?r.setProperty(o,m,y):r.setAttribute(o,m,y),c++}}return c}function tl(r){return 3===r||4===r||6===r}function _g(r){return 64===r.charCodeAt(0)}function ga(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let s=-1;for(let c=0;c<o.length;c++){const h=o[c];"number"==typeof h?s=h:0===s||Nf(r,s,h,null,-1===s||2===s?o[++c]:null)}}return r}function Nf(r,o,s,c,h){let m=0,y=r.length;if(-1===o)y=-1;else for(;m<r.length;){const w=r[m++];if("number"==typeof w){if(w===o){y=-1;break}if(w>o){y=m-1;break}}}for(;m<r.length;){const w=r[m];if("number"==typeof w)break;if(w===s){if(null===c)return void(null!==h&&(r[m+1]=h));if(c===r[m+1])return void(r[m+2]=h)}m++,null!==c&&m++,null!==h&&m++}-1!==y&&(r.splice(y,0,o),m=y+1),r.splice(m++,0,s),null!==c&&r.splice(m++,0,c),null!==h&&r.splice(m++,0,h)}const Mu="ng-template";function Ov(r,o,s){let c=0,h=!0;for(;c<r.length;){let m=r[c++];if("string"==typeof m&&h){const y=r[c++];if(s&&"class"===m&&-1!==Rv(y.toLowerCase(),o,0))return!0}else{if(1===m){for(;c<r.length&&"string"==typeof(m=r[c++]);)if(m.toLowerCase()===o)return!0;return!1}"number"==typeof m&&(h=!1)}}return!1}function yw(r){return 4===r.type&&r.value!==Mu}function vw(r,o,s){return o===(4!==r.type||s?r.value:Mu)}function xw(r,o,s){let c=4;const h=r.attrs||[],m=function f2(r){for(let o=0;o<r.length;o++)if(tl(r[o]))return o;return r.length}(h);let y=!1;for(let w=0;w<o.length;w++){const M=o[w];if("number"!=typeof M){if(!y)if(4&c){if(c=2|1&c,""!==M&&!vw(r,M,s)||""===M&&1===o.length){if(Ms(c))return!1;y=!0}}else{const S=8&c?M:o[++w];if(8&c&&null!==r.attrs){if(!Ov(r.attrs,S,s)){if(Ms(c))return!1;y=!0}continue}const F=h2(8&c?"class":M,h,yw(r),s);if(-1===F){if(Ms(c))return!1;y=!0;continue}if(""!==S){let $;$=F>m?"":h[F+1].toLowerCase();const Y=8&c?$:null;if(Y&&-1!==Rv(Y,S,0)||2&c&&S!==$){if(Ms(c))return!1;y=!0}}}}else{if(!y&&!Ms(c)&&!Ms(M))return!1;if(y&&Ms(M))continue;y=!1,c=M|1&c}}return Ms(c)||y}function Ms(r){return 0==(1&r)}function h2(r,o,s,c){if(null===o)return-1;let h=0;if(c||!s){let m=!1;for(;h<o.length;){const y=o[h];if(y===r)return h;if(3===y||6===y)m=!0;else{if(1===y||2===y){let w=o[++h];for(;"string"==typeof w;)w=o[++h];continue}if(4===y)break;if(0===y){h+=4;continue}}h+=m?1:2}return-1}return function ww(r,o){let s=r.indexOf(4);if(s>-1)for(s++;s<r.length;){const c=r[s];if("number"==typeof c)return-1;if(c===o)return s;s++}return-1}(o,r)}function bw(r,o,s=!1){for(let c=0;c<o.length;c++)if(xw(r,o[c],s))return!0;return!1}function zf(r,o){return r?":not("+o.trim()+")":o}function m2(r){let o=r[0],s=1,c=2,h="",m=!1;for(;s<r.length;){let y=r[s];if("string"==typeof y)if(2&c){const w=r[++s];h+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&c?h+="."+y:4&c&&(h+=" "+y);else""!==h&&!Ms(y)&&(o+=zf(m,h),h=""),c=y,m=m||!Ms(c);s++}return""!==h&&(o+=zf(m,h)),o}function Ac(r){return Ka(()=>{const o=xg(r),s={...o,decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===Lf.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&r.dependencies||null,getStandaloneInjector:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||Lo.Emulated,styles:r.styles||zn,_:null,schemas:r.schemas||null,tView:null,id:""};bg(s);const c=r.dependencies;return s.directiveDefs=ue(c,!1),s.pipeDefs=ue(c,!0),s.id=function wg(r){let o=0;const s=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,r.consts,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery].join("|");for(const h of s)o=Math.imul(31,o)+h.charCodeAt(0)<<0;return o+=2147483648,"c"+o}(s),s})}function Bf(r){return An(r)||Di(r)}function Fv(r){return null!==r}function Fo(r){return Ka(()=>({type:r.type,bootstrap:r.bootstrap||zn,declarations:r.declarations||zn,imports:r.imports||zn,exports:r.exports||zn,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function vg(r,o){if(null==r)return qs;const s={};for(const c in r)if(r.hasOwnProperty(c)){let h=r[c],m=h;Array.isArray(h)&&(m=h[1],h=h[0]),s[h]=c,o&&(o[h]=m)}return s}function je(r){return Ka(()=>{const o=xg(r);return bg(o),o})}function An(r){return r[Oh]||null}function Di(r){return r[mg]||null}function vo(r){return r[Ff]||null}function xo(r,o){const s=r[lt]||null;if(!s&&!0===o)throw new Error(`Type ${di(r)} does not have '\u0275mod' property.`);return s}function xg(r){const o={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:o,inputTransforms:null,inputConfig:r.inputs||qs,exportAs:r.exportAs||null,standalone:!0===r.standalone,signals:!0===r.signals,selectors:r.selectors||zn,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:vg(r.inputs,o),outputs:vg(r.outputs)}}function bg(r){r.features?.forEach(o=>o(r))}function ue(r,o){if(!r)return null;const s=o?vo:Bf;return()=>("function"==typeof r?r():r).map(c=>s(c)).filter(Fv)}const Wr=0,oe=1,rn=2,lr=3,Zs=4,Vf=5,bo=6,Lh=7,Xr=8,el=9,Rc=10,We=11,Fh=12,Nv=13,Nh=14,Pr=15,zl=16,Cu=17,Cs=18,Tu=19,_a=20,nl=21,rl=22,Du=23,zh=24,_n=25,jf=1,Cw=2,Ts=7,Oc=9,Si=11;function oo(r){return Array.isArray(r)&&"object"==typeof r[jf]}function No(r){return Array.isArray(r)&&!0===r[jf]}function Mg(r){return 0!=(4&r.flags)}function kc(r){return r.componentOffset>-1}function Bl(r){return 1==(1&r.flags)}function ya(r){return!!r.template}function zv(r){return 0!=(512&r[rn])}function il(r,o){return r.hasOwnProperty(Qa)?r[Qa]:null}let so=null,Dg=!1;function Ds(r){const o=so;return so=r,o}const Pw={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function $f(r){if(!Uh(r)||r.dirty){if(!r.producerMustRecompute(r)&&!qf(r))return void(r.dirty=!1);r.producerRecomputeValue(r),r.dirty=!1}}function jl(r){r.dirty=!0,function Vl(r){if(void 0===r.liveConsumerNode)return;const o=Dg;Dg=!0;try{for(const s of r.liveConsumerNode)s.dirty||jl(s)}finally{Dg=o}}(r),r.consumerMarkedDirty?.(r)}function Gf(r){return r&&(r.nextProducerIndex=0),Ds(r)}function jh(r,o){if(Ds(o),r&&void 0!==r.producerNode&&void 0!==r.producerIndexOfThis&&void 0!==r.producerLastReadVersion){if(Uh(r))for(let s=r.nextProducerIndex;s<r.producerNode.length;s++)Zf(r.producerNode[s],r.producerIndexOfThis[s]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}function qf(r){Ws(r);for(let o=0;o<r.producerNode.length;o++){const s=r.producerNode[o],c=r.producerLastReadVersion[o];if(c!==s.version||($f(s),c!==s.version))return!0}return!1}function Ss(r){if(Ws(r),Uh(r))for(let o=0;o<r.producerNode.length;o++)Zf(r.producerNode[o],r.producerIndexOfThis[o]);r.producerNode.length=r.producerLastReadVersion.length=r.producerIndexOfThis.length=0,r.liveConsumerNode&&(r.liveConsumerNode.length=r.liveConsumerIndexOfThis.length=0)}function Zf(r,o){if(function Uv(r){r.liveConsumerNode??=[],r.liveConsumerIndexOfThis??=[]}(r),Ws(r),1===r.liveConsumerNode.length)for(let c=0;c<r.producerNode.length;c++)Zf(r.producerNode[c],r.producerIndexOfThis[c]);const s=r.liveConsumerNode.length-1;if(r.liveConsumerNode[o]=r.liveConsumerNode[s],r.liveConsumerIndexOfThis[o]=r.liveConsumerIndexOfThis[s],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,o<r.liveConsumerNode.length){const c=r.liveConsumerIndexOfThis[o],h=r.liveConsumerNode[o];Ws(h),h.producerIndexOfThis[c]=o}}function Uh(r){return r.consumerIsAlwaysLive||(r?.liveConsumerNode?.length??0)>0}function Ws(r){r.producerNode??=[],r.producerIndexOfThis??=[],r.producerLastReadVersion??=[]}let Lw=null;const Su=()=>{},$w=(()=>({...Pw,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:r=>{r.schedule(r.ref)},hasRun:!1,cleanupFn:Su}))();class I2{constructor(o,s,c){this.previousValue=o,this.currentValue=s,this.firstChange=c}isFirstChange(){return this.firstChange}}function Is(){return Zv}function Zv(r){return r.type.prototype.ngOnChanges&&(r.setInput=Gw),Hw}function Hw(){const r=Xv(this),o=r?.current;if(o){const s=r.previous;if(s===qs)r.previous=o;else for(let c in o)s[c]=o[c];r.current=null,this.ngOnChanges(o)}}function Gw(r,o,s,c){const h=this.declaredInputs[s],m=Xv(r)||function Ii(r,o){return r[Wv]=o}(r,{previous:qs,current:null}),y=m.current||(m.current={}),w=m.previous,M=w[h];y[h]=new I2(M&&M.currentValue,o,w===qs),r[c]=o}Is.ngInherit=!0;const Wv="__ngSimpleChanges__";function Xv(r){return r[Wv]||null}const zo=function(r,o,s){};function Dr(r){for(;Array.isArray(r);)r=r[Wr];return r}function Ag(r,o){return Dr(o[r])}function Qo(r,o){return Dr(o[r.index])}function Xw(r,o){return r.data[o]}function As(r,o){const s=o[r];return oo(s)?s:s[Wr]}function Bo(r,o){return null==o?null:r[o]}function xa(r){r[Cu]=0}function Gh(r){1024&r[rn]||(r[rn]|=1024,Gt(r,1))}function Yf(r){1024&r[rn]&&(r[rn]&=-1025,Gt(r,-1))}function Gt(r,o){let s=r[lr];if(null===s)return;s[Vf]+=o;let c=s;for(s=s[lr];null!==s&&(1===o&&1===c[Vf]||-1===o&&0===c[Vf]);)s[Vf]+=o,c=s,s=s[lr]}const ze={lFrame:Xn(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Rg(){return ze.bindingsEnabled}function Ot(){return ze.lFrame.lView}function Dn(){return ze.lFrame.tView}function $i(){let r=Og();for(;null!==r&&64===r.type;)r=r.parent;return r}function Og(){return ze.lFrame.currentTNode}function Xs(r,o){const s=ze.lFrame;s.currentTNode=r,s.isParent=o}function kg(){return ze.lFrame.isParent}function qh(){return ze.lFrame.bindingIndex++}function te(r,o){const s=ze.lFrame;s.bindingIndex=s.bindingRootIndex=r,nr(o)}function nr(r){ze.lFrame.currentDirectiveIndex=r}function Ng(r){ze.lFrame.currentQueryIndex=r}function Ps(r){const o=r[oe];return 2===o.type?o.declTNode:1===o.type?r[bo]:null}function Kw(r,o,s){if(s&He.SkipSelf){let h=o,m=r;for(;!(h=h.parent,null!==h||s&He.Host||(h=Ps(m),null===h||(m=m[Nh],10&h.type))););if(null===h)return!1;o=h,r=m}const c=ze.lFrame=Qf();return c.currentTNode=o,c.lView=r,!0}function s0(r){const o=Qf(),s=r[oe];ze.lFrame=o,o.currentTNode=s.firstChild,o.lView=r,o.tView=s,o.contextLView=r,o.bindingIndex=s.bindingStartIndex,o.inI18n=!1}function Qf(){const r=ze.lFrame,o=null===r?null:r.child;return null===o?Xn(r):o}function Xn(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function sn(){const r=ze.lFrame;return ze.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const a0=sn;function wo(){const r=sn();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function ao(){return ze.lFrame.selectedIndex}function Ul(r){ze.lFrame.selectedIndex=r}let Ug=!0;function ba(){return Ug}function sl(r){Ug=r}function Zh(r,o){for(let s=o.directiveStart,c=o.directiveEnd;s<c;s++){const m=r.data[s].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:M,ngAfterViewChecked:S,ngOnDestroy:O}=m;y&&(r.contentHooks??=[]).push(-s,y),w&&((r.contentHooks??=[]).push(s,w),(r.contentCheckHooks??=[]).push(s,w)),M&&(r.viewHooks??=[]).push(-s,M),S&&((r.viewHooks??=[]).push(s,S),(r.viewCheckHooks??=[]).push(s,S)),null!=O&&(r.destroyHooks??=[]).push(s,O)}}function Wh(r,o,s){Hg(r,o,3,s)}function wa(r,o,s,c){(3&r[rn])===s&&Hg(r,o,s,c)}function Rr(r,o){let s=r[rn];(3&s)===o&&(s&=8191,s+=1,r[rn]=s)}function Hg(r,o,s,c){const m=c??-1,y=o.length-1;let w=0;for(let M=void 0!==c?65535&r[Cu]:0;M<y;M++)if("number"==typeof o[M+1]){if(w=o[M],null!=c&&w>=c)break}else o[M]<0&&(r[Cu]+=65536),(w<m||-1==m)&&(tp(r,s,o,M),r[Cu]=(4294901760&r[Cu])+M+2),M++}function Gg(r,o){zo(4,r,o);const s=Ds(null);try{o.call(r)}finally{Ds(s),zo(5,r,o)}}function tp(r,o,s,c){const h=s[c]<0,m=s[c+1],w=r[h?-s[c]:s[c]];h?r[rn]>>13<r[Cu]>>16&&(3&r[rn])===o&&(r[rn]+=8192,Gg(w,m)):Gg(w,m)}const Ys=-1;class Ou{constructor(o,s,c){this.factory=o,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=c}}function Wg(r){return r!==Ys}function Xh(r){return 32767&r}function Yh(r,o){let s=function eE(r){return r>>16}(r),c=o;for(;s>0;)c=c[Nh],s--;return c}let Xg=!0;function ep(r){const o=Xg;return Xg=r,o}const h0=255,d0=5;let N2=0;const al={};function np(r,o){const s=nE(r,o);if(-1!==s)return s;const c=o[oe];c.firstCreatePass&&(r.injectorIndex=o.length,f0(c.data,r),f0(o,null),f0(c.blueprint,null));const h=Lu(r,o),m=r.injectorIndex;if(Wg(h)){const y=Xh(h),w=Yh(h,o),M=w[oe].data;for(let S=0;S<8;S++)o[m+S]=w[y+S]|M[y+S]}return o[m+8]=h,m}function f0(r,o){r.push(0,0,0,0,0,0,0,0,o)}function nE(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function Lu(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let s=0,c=null,h=o;for(;null!==h;){if(c=iE(h),null===c)return Ys;if(s++,h=h[Nh],-1!==c.injectorIndex)return c.injectorIndex|s<<16}return Ys}function Yg(r,o,s){!function bn(r,o,s){let c;"string"==typeof s?c=s.charCodeAt(0)||0:s.hasOwnProperty(Eu)&&(c=s[Eu]),null==c&&(c=s[Eu]=N2++);const h=c&h0;o.data[r+(h>>d0)]|=1<<h}(r,o,s)}function p0(r,o,s){if(s&He.Optional||void 0!==r)return r;fa()}function m0(r,o,s,c){if(s&He.Optional&&void 0===c&&(c=null),!(s&(He.Self|He.Host))){const h=r[el],m=Ci(void 0);try{return h?h.get(o,c,s&He.Optional):ri(o,c,s&He.Optional)}finally{Ci(m)}}return p0(c,0,s)}function rE(r,o,s,c=He.Default,h){if(null!==r){if(2048&o[rn]&&!(c&He.Self)){const y=function we(r,o,s,c,h){let m=r,y=o;for(;null!==m&&null!==y&&2048&y[rn]&&!(512&y[rn]);){const w=Jg(m,y,s,c|He.Self,al);if(w!==al)return w;let M=m.parent;if(!M){const S=y[_a];if(S){const O=S.get(s,al,c);if(O!==al)return O}M=iE(y),y=y[Nh]}m=M}return h}(r,o,s,c,al);if(y!==al)return y}const m=Jg(r,o,s,c,al);if(m!==al)return m}return m0(o,s,c,h)}function Jg(r,o,s,c,h){const m=function Kg(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(Eu)?r[Eu]:void 0;return"number"==typeof o?o>=0?o&h0:rs:o}(s);if("function"==typeof m){if(!Kw(o,r,c))return c&He.Host?p0(h,0,c):m0(o,s,c,h);try{let y;if(y=m(c),null!=y||c&He.Optional)return y;fa()}finally{a0()}}else if("number"==typeof m){let y=null,w=nE(r,o),M=Ys,S=c&He.Host?o[Pr][bo]:null;for((-1===w||c&He.SkipSelf)&&(M=-1===w?Lu(r,o):o[w+8],M!==Ys&&Le(c,!1)?(y=o[oe],w=Xh(M),o=Yh(M,o)):w=-1);-1!==w;){const O=o[oe];if(ll(m,w,O.data)){const F=rp(w,o,s,y,c,S);if(F!==al)return F}M=o[w+8],M!==Ys&&Le(c,o[oe].data[w+8]===S)&&ll(m,w,o)?(y=O,w=Xh(M),o=Yh(M,o)):w=-1}}return h}function rp(r,o,s,c,h,m){const y=o[oe],w=y.data[r+8],O=function ip(r,o,s,c,h){const m=r.providerIndexes,y=o.data,w=1048575&m,M=r.directiveStart,O=m>>20,$=h?w+O:r.directiveEnd;for(let Y=c?w:w+O;Y<$;Y++){const st=y[Y];if(Y<M&&s===st||Y>=M&&st.type===s)return Y}if(h){const Y=y[M];if(Y&&ya(Y)&&Y.type===s)return M}return null}(w,y,s,null==c?kc(w)&&Xg:c!=y&&0!=(3&w.type),h&He.Host&&m===w);return null!==O?$l(o,y,O,w):al}function $l(r,o,s,c){let h=r[s];const m=o.data;if(function c0(r){return r instanceof Ou}(h)){const y=h;y.resolving&&function bu(r,o){const s=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new pt(-200,`Circular dependency in DI detected for ${r}${s}`)}(function Dt(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():J(r)}(m[s]));const w=ep(y.canSeeViewProviders);y.resolving=!0;const S=y.injectImpl?Ci(y.injectImpl):null;Kw(r,c,He.Default);try{h=r[s]=y.factory(void 0,m,r,c),o.firstCreatePass&&s>=c.directiveStart&&function $g(r,o,s){const{ngOnChanges:c,ngOnInit:h,ngDoCheck:m}=o.type.prototype;if(c){const y=Zv(o);(s.preOrderHooks??=[]).push(r,y),(s.preOrderCheckHooks??=[]).push(r,y)}h&&(s.preOrderHooks??=[]).push(0-r,h),m&&((s.preOrderHooks??=[]).push(r,m),(s.preOrderCheckHooks??=[]).push(r,m))}(s,m[s],o)}finally{null!==S&&Ci(S),ep(w),y.resolving=!1,a0()}}return h}function ll(r,o,s){return!!(s[o+(r>>d0)]&1<<r)}function Le(r,o){return!(r&He.Self||r&He.Host&&o)}class se{constructor(o,s){this._tNode=o,this._lView=s}get(o,s,c){return rE(this._tNode,this._lView,o,fg(c),s)}}function rs(){return new se($i(),Ot())}function ii(r){return Ka(()=>{const o=r.prototype.constructor,s=o[Qa]||g0(o),c=Object.prototype;let h=Object.getPrototypeOf(r.prototype).constructor;for(;h&&h!==c;){const m=h[Qa]||g0(h);if(m&&m!==s)return m;h=Object.getPrototypeOf(h)}return m=>new m})}function g0(r){return tg(r)?()=>{const o=g0(qe(r));return o&&o()}:il(r)}function iE(r){const o=r[oe],s=o.type;return 2===s?o.declTNode:1===s?r[bo]:null}const Bc="__parameters__";function is(r,o,s){return Ka(()=>{const c=function jc(r){return function(...s){if(r){const c=r(...s);for(const h in c)this[h]=c[h]}}}(o);function h(...m){if(this instanceof h)return c.apply(this,m),this;const y=new h(...m);return w.annotation=y,w;function w(M,S,O){const F=M.hasOwnProperty(Bc)?M[Bc]:Object.defineProperty(M,Bc,{value:[]})[Bc];for(;F.length<=O;)F.push(null);return(F[O]=F[O]||[]).push(y),M}}return s&&(h.prototype=Object.create(s.prototype)),h.prototype.ngMetadataName=r,h.annotationCls=h,h})}function Pn(r,o){r.forEach(s=>Array.isArray(s)?Pn(s,o):o(s))}function Qg(r,o,s){o>=r.length?r.push(s):r.splice(o,0,s)}function Ea(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function oi(r,o,s){let c=zu(r,o);return c>=0?r[1|c]=s:(c=~c,function cr(r,o,s,c){let h=r.length;if(h==o)r.push(s,c);else if(1===h)r.push(c,r[0]),r[0]=s;else{for(h--,r.push(r[h-1],r[h]);h>o;)r[h]=r[h-2],h--;r[o]=s,r[o+1]=c}}(r,c,o,s)),c}function t_(r,o){const s=zu(r,o);if(s>=0)return r[1|s]}function zu(r,o){return function wn(r,o,s){let c=0,h=r.length>>s;for(;h!==c;){const m=c+(h-c>>1),y=r[m<<s];if(o===y)return m<<s;y>o?h=m:c=m+1}return~(h<<s)}(r,o,1)}const ap=kf(is("Optional"),8),lp=kf(is("SkipSelf"),4);function dp(r){return 128==(128&r.flags)}var Hl=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(Hl||{});const fp=new Map;let Ma=0;const $e="__ngContext__";function Hi(r,o){oo(o)?(r[$e]=o[Tu],function DE(r){fp.set(r[Tu],r)}(o)):r[$e]=o}let Pe;function pp(r,o){return Pe(r,o)}function id(r){const o=r[lr];return No(o)?o[lr]:o}function A0(r){return R0(r[Fh])}function P0(r){return R0(r[Zs])}function R0(r){for(;null!==r&&!No(r);)r=r[Zs];return r}function Uu(r,o,s,c,h){if(null!=c){let m,y=!1;No(c)?m=c:oo(c)&&(y=!0,c=c[Wr]);const w=Dr(c);0===r&&null!==s?null==h?NE(o,s,w):G(o,s,w,h||null,!0):1===r&&null!==s?G(o,s,w,h||null,!0):2===r?function ld(r,o,s){const c=$u(r,o);c&&function dl(r,o,s,c){r.removeChild(o,s,c)}(r,c,o,s)}(o,w,y):3===r&&o.destroyNode(w),null!=m&&function $n(r,o,s,c,h){const m=s[Ts];m!==Dr(s)&&Uu(o,r,c,m,h);for(let w=Si;w<s.length;w++){const M=s[w];ud(M[oe],M,r,o,c,m)}}(o,r,m,s,h)}}function od(r,o,s){return r.createElement(o,s)}function Mo(r,o){const s=r[Oc],c=s.indexOf(o);Yf(o),s.splice(c,1)}function a_(r,o){if(r.length<=Si)return;const s=Si+o,c=r[s];if(c){const h=c[zl];null!==h&&h!==r&&Mo(h,c),o>0&&(r[s-1][Zs]=c[Zs]);const m=Ea(r,Si+o);!function vn(r,o){ud(r,o,o[We],2,null,null),o[Wr]=null,o[bo]=null}(c[oe],c);const y=m[Cs];null!==y&&y.detachView(m[oe]),c[lr]=null,c[Zs]=null,c[rn]&=-129}return c}function nt(r,o){if(!(256&o[rn])){const s=o[We];o[Du]&&Ss(o[Du]),o[zh]&&Ss(o[zh]),s.destroyNode&&ud(r,o,s,3,null,null),function sd(r){let o=r[Fh];if(!o)return L0(r[oe],r);for(;o;){let s=null;if(oo(o))s=o[Fh];else{const c=o[Si];c&&(s=c)}if(!s){for(;o&&!o[Zs]&&o!==r;)oo(o)&&L0(o[oe],o),o=o[lr];null===o&&(o=r),oo(o)&&L0(o[oe],o),s=o&&o[Zs]}o=s}}(o)}}function L0(r,o){if(!(256&o[rn])){o[rn]&=-129,o[rn]|=256,function eS(r,o){let s;if(null!=r&&null!=(s=r.destroyHooks))for(let c=0;c<s.length;c+=2){const h=o[s[c]];if(!(h instanceof Ou)){const m=s[c+1];if(Array.isArray(m))for(let y=0;y<m.length;y+=2){const w=h[m[y]],M=m[y+1];zo(4,w,M);try{M.call(w)}finally{zo(5,w,M)}}else{zo(4,h,m);try{m.call(h)}finally{zo(5,h,m)}}}}}(r,o),function Oi(r,o){const s=r.cleanup,c=o[Lh];if(null!==s)for(let m=0;m<s.length-1;m+=2)if("string"==typeof s[m]){const y=s[m+3];y>=0?c[y]():c[-y].unsubscribe(),m+=2}else s[m].call(c[s[m+1]]);null!==c&&(o[Lh]=null);const h=o[nl];if(null!==h){o[nl]=null;for(let m=0;m<h.length;m++)(0,h[m])()}}(r,o),1===o[oe].type&&o[We].destroy();const s=o[zl];if(null!==s&&No(o[lr])){s!==o[lr]&&Mo(s,o);const c=o[Cs];null!==c&&c.detachView(r)}!function C0(r){fp.delete(r[Tu])}(o)}}function F0(r,o,s){return function FE(r,o,s){let c=o;for(;null!==c&&40&c.type;)c=(o=c).parent;if(null===c)return s[Wr];{const{componentOffset:h}=c;if(h>-1){const{encapsulation:m}=r.data[c.directiveStart+h];if(m===Lo.None||m===Lo.Emulated)return null}return Qo(c,s)}}(r,o.parent,s)}function G(r,o,s,c,h){r.insertBefore(o,s,c,h)}function NE(r,o,s){r.appendChild(o,s)}function N0(r,o,s,c,h){null!==c?G(r,o,s,c,h):NE(r,o,s)}function $u(r,o){return r.parentNode(o)}let Qs,j0,BE=function z0(r,o,s){return 40&r.type?Qo(r,s):null};function Ze(r,o,s,c){const h=F0(r,c,o),m=o[We],w=function Gl(r,o,s){return BE(r,o,s)}(c.parent||o[bo],c,o);if(null!=h)if(Array.isArray(s))for(let M=0;M<s.length;M++)N0(m,h,s[M],w,!1);else N0(m,h,s,w,!1);void 0!==Qs&&Qs(m,c,o,s,h)}function ql(r,o){if(null!==o){const s=o.type;if(3&s)return Qo(o,r);if(4&s)return ad(-1,r[o.index]);if(8&s){const c=o.child;if(null!==c)return ql(r,c);{const h=r[o.index];return No(h)?ad(-1,h):Dr(h)}}if(32&s)return pp(o,r)()||Dr(r[o.index]);{const c=B0(r,o);return null!==c?Array.isArray(c)?c[0]:ql(id(r[Pr]),c):ql(r,o.next)}}return null}function B0(r,o){return null!==o?r[Pr][bo].projection[o.projection]:null}function ad(r,o){const s=Si+r+1;if(s<o.length){const c=o[s],h=c[oe].firstChild;if(null!==h)return ql(c,h)}return o[Ts]}function c_(r,o,s,c,h,m,y){for(;null!=s;){const w=c[s.index],M=s.type;if(y&&0===o&&(w&&Hi(Dr(w),c),s.flags|=2),32!=(32&s.flags))if(8&M)c_(r,o,s.child,c,h,m,!1),Uu(o,r,h,w,m);else if(32&M){const S=pp(s,c);let O;for(;O=S();)Uu(o,r,h,O,m);Uu(o,r,h,w,m)}else 16&M?fl(r,o,c,s,h,m):Uu(o,r,h,w,m);s=y?s.projectionNext:s.next}}function ud(r,o,s,c,h,m){c_(s,c,r.firstChild,o,h,m,!1)}function fl(r,o,s,c,h,m){const y=s[Pr],M=y[bo].projection[c.projection];if(Array.isArray(M))for(let S=0;S<M.length;S++)Uu(o,r,h,M[S],m);else{let S=M;const O=y[lr];dp(c)&&(S.flags|=128),c_(r,o,S,O,h,m,!0)}}function lo(r,o,s){""===s?r.removeAttribute(o,"class"):r.setAttribute(o,"class",s)}function jE(r,o,s){const{mergedAttrs:c,classes:h,styles:m}=s;null!==c&&kh(r,o,c),null!==h&&lo(r,o,h),null!==m&&function $c(r,o,s){r.setAttribute(o,"style",s)}(r,o,m)}class d_{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const wp=new ae("ENVIRONMENT_INITIALIZER"),Y0=new ae("INJECTOR",-1),QE=new ae("INJECTOR_DEF_TYPES");class Ep{get(o,s=Ko){if(s===Ko){const c=new Error(`NullInjectorError: No provider for ${di(o)}!`);throw c.name="NullInjectorError",c}return s}}function K0(...r){return{\u0275providers:Q0(0,r),\u0275fromNgModule:!0}}function Q0(r,...o){const s=[],c=new Set;let h;const m=y=>{s.push(y)};return Pn(o,y=>{const w=y;Ta(w,m,[],c)&&(h||=[],h.push(w))}),void 0!==h&&tx(h,m),s}function tx(r,o){for(let s=0;s<r.length;s++){const{ngModule:c,providers:h}=r[s];ex(h,m=>{o(m,c)})}}function Ta(r,o,s,c){if(!(r=qe(r)))return!1;let h=null,m=Th(r);const y=!m&&An(r);if(m||y){if(y&&!y.standalone)return!1;h=r}else{const M=r.ngModule;if(m=Th(M),!m)return!1;h=M}const w=c.has(h);if(y){if(w)return!1;if(c.add(h),y.dependencies){const M="function"==typeof y.dependencies?y.dependencies():y.dependencies;for(const S of M)Ta(S,o,s,c)}}else{if(!m)return!1;{if(null!=m.imports&&!w){let S;c.add(h);try{Pn(m.imports,O=>{Ta(O,o,s,c)&&(S||=[],S.push(O))})}finally{}void 0!==S&&tx(S,o)}if(!w){const S=il(h)||(()=>new h);o({provide:h,useFactory:S,deps:zn},h),o({provide:QE,useValue:h,multi:!0},h),o({provide:wp,useValue:()=>ye(h),multi:!0},h)}const M=m.providers;if(null!=M&&!w){const S=r;ex(M,O=>{o(O,S)})}}}return h!==r&&void 0!==r.providers}function ex(r,o){for(let s of r)eg(s)&&(s=s.\u0275providers),Array.isArray(s)?ex(s,o):o(s)}const pd=tr({provide:String,useValue:tr});function Mp(r){return null!==r&&"object"==typeof r&&pd in r}function qc(r){return"function"==typeof r}const nx=new ae("Set Injector scope."),y_={},uS={};let rx;function Tp(){return void 0===rx&&(rx=new Ep),rx}class cs{}class md extends cs{get destroyed(){return this._destroyed}constructor(o,s,c,h){super(),this.parent=s,this.source=c,this.scopes=h,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ur(o,y=>this.processProvider(y)),this.records.set(Y0,Xu(void 0,this)),h.has("environment")&&this.records.set(cs,Xu(void 0,this));const m=this.records.get(nx);null!=m&&"string"==typeof m.value&&this.scopes.add(m.value),this.injectorDefTypes=new Set(this.get(QE.multi,zn,He.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const s of this._ngOnDestroyHooks)s.ngOnDestroy();const o=this._onDestroyHooks;this._onDestroyHooks=[];for(const s of o)s()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(o){return this.assertNotDestroyed(),this._onDestroyHooks.push(o),()=>this.removeOnDestroy(o)}runInContext(o){this.assertNotDestroyed();const s=Nl(this),c=Ci(void 0);try{return o()}finally{Nl(s),Ci(c)}}get(o,s=Ko,c=He.Default){if(this.assertNotDestroyed(),o.hasOwnProperty(gg))return o[gg](this);c=fg(c);const m=Nl(this),y=Ci(void 0);try{if(!(c&He.SkipSelf)){let M=this.records.get(o);if(void 0===M){const S=function Xl(r){return"function"==typeof r||"object"==typeof r&&r instanceof ae}(o)&&If(o);M=S&&this.injectableDefInScope(S)?Xu(v_(o),y_):null,this.records.set(o,M)}if(null!=M)return this.hydrate(o,M)}return(c&He.Self?Tp():this.parent).get(o,s=c&He.Optional&&s===Ko?null:s)}catch(w){if("NullInjectorError"===w.name){if((w[Rf]=w[Rf]||[]).unshift(di(o)),m)throw w;return function gw(r,o,s,c){const h=r[Rf];throw o[Ah]&&h.unshift(o[Ah]),r.message=function _w(r,o,s,c=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let h=di(o);if(Array.isArray(o))h=o.map(di).join(" -> ");else if("object"==typeof o){let m=[];for(let y in o)if(o.hasOwnProperty(y)){let w=o[y];m.push(y+":"+("string"==typeof w?JSON.stringify(w):di(w)))}h=`{${m.join(", ")}}`}return`${s}${c?"("+c+")":""}[${h}]: ${r.replace(u2,"\n  ")}`}("\n"+r.message,h,s,c),r.ngTokenPath=h,r[Rf]=null,r}(w,o,"R3InjectorError",this.source)}throw w}finally{Ci(y),Nl(m)}}resolveInjectorInitializers(){const o=Nl(this),s=Ci(void 0);try{const h=this.get(wp.multi,zn,He.Self);for(const m of h)m()}finally{Nl(o),Ci(s)}}toString(){const o=[],s=this.records;for(const c of s.keys())o.push(di(c));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new pt(205,!1)}processProvider(o){let s=qc(o=qe(o))?o:qe(o&&o.provide);const c=function dS(r){return Mp(r)?Xu(void 0,r.useValue):Xu(ix(r),y_)}(o);if(qc(o)||!0!==o.multi)this.records.get(s);else{let h=this.records.get(s);h||(h=Xu(void 0,y_,!0),h.factory=()=>pg(h.multi),this.records.set(s,h)),s=o,h.multi.push(o)}this.records.set(s,c)}hydrate(o,s){return s.value===y_&&(s.value=uS,s.value=s.factory()),"object"==typeof s.value&&s.value&&function ox(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(s.value)&&this._ngOnDestroyHooks.add(s.value),s.value}injectableDefInScope(o){if(!o.providedIn)return!1;const s=qe(o.providedIn);return"string"==typeof s?"any"===s||this.scopes.has(s):this.injectorDefTypes.has(s)}removeOnDestroy(o){const s=this._onDestroyHooks.indexOf(o);-1!==s&&this._onDestroyHooks.splice(s,1)}}function v_(r){const o=If(r),s=null!==o?o.factory:il(r);if(null!==s)return s;if(r instanceof ae)throw new pt(204,!1);if(r instanceof Function)return function hS(r){const o=r.length;if(o>0)throw function ed(r,o){const s=[];for(let c=0;c<r;c++)s.push(o);return s}(o,"?"),new pt(204,!1);const s=function lg(r){return r&&(r[io]||r[cg])||null}(r);return null!==s?()=>s.factory(r):()=>new r}(r);throw new pt(204,!1)}function ix(r,o,s){let c;if(qc(r)){const h=qe(r);return il(h)||v_(h)}if(Mp(r))c=()=>qe(r.useValue);else if(function Cp(r){return!(!r||!r.useFactory)}(r))c=()=>r.useFactory(...pg(r.deps||[]));else if(function Wu(r){return!(!r||!r.useExisting)}(r))c=()=>ye(qe(r.useExisting));else{const h=qe(r&&(r.useClass||r.provide));if(!function eM(r){return!!r.deps}(r))return il(h)||v_(h);c=()=>new h(...pg(r.deps))}return c}function Xu(r,o,s=!1){return{factory:r,value:o,multi:s?[]:void 0}}function ur(r,o){for(const s of r)Array.isArray(s)?ur(s,o):s&&eg(s)?ur(s.\u0275providers,o):o(s)}const Dp=new ae("AppId",{providedIn:"root",factory:()=>fS}),fS="ng",nM=new ae("Platform Initializer"),ml=new ae("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),rM=new ae("CSP nonce",{providedIn:"root",factory:()=>function uo(){if(void 0!==j0)return j0;if(typeof document<"u")return document;throw new pt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Pp=(r,o,s)=>null;function w_(r,o,s=!1){return Pp(r,o,s)}class mS{}class aM{}class _S{resolveComponentFactory(o){throw function gS(r){const o=Error(`No component factory found for ${di(r)}.`);return o.ngComponent=r,o}(o)}}let T_=(()=>{class r{static#t=this.NULL=new _S}return r})();function D_(){return xd($i(),Ot())}function xd(r,o){return new us(Qo(r,o))}let us=(()=>{class r{constructor(s){this.nativeElement=s}static#t=this.__NG_ELEMENT_ID__=D_}return r})();class cM{}let Jl=(()=>{class r{constructor(){this.destroyNode=null}static#t=this.__NG_ELEMENT_ID__=()=>function yS(){const r=Ot(),s=As($i().index,r);return(oo(s)?s:r)[We]}()}return r})(),uM=(()=>{class r{static#t=this.\u0275prov=Ie({token:r,providedIn:"root",factory:()=>null})}return r})();class wd{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const vS=new wd("16.2.12"),mx={};function _x(r,o=null,s=null,c){const h=gl(r,o,s,c);return h.resolveInjectorInitializers(),h}function gl(r,o=null,s=null,c,h=new Set){const m=[s||zn,K0(r)];return c=c||("object"==typeof r?void 0:di(r)),new md(m,o||Tp(),c||null,h)}let qi=(()=>{class r{static#t=this.THROW_IF_NOT_FOUND=Ko;static#e=this.NULL=new Ep;static create(s,c){if(Array.isArray(s))return _x({name:""},c,s,"");{const h=s.name??"";return _x({name:h},s.parent,s.providers,h)}}static#n=this.\u0275prov=Ie({token:r,providedIn:"any",factory:()=>ye(Y0)});static#r=this.__NG_ELEMENT_ID__=-1}return r})();function vx(r){return r.ngOriginalError}class Kl{constructor(){this._console=console}handleError(o){const s=this._findOriginalError(o);this._console.error("ERROR",o),s&&this._console.error("ORIGINAL ERROR",s)}_findOriginalError(o){let s=o&&vx(o);for(;s&&vx(s);)s=vx(s);return s||null}}function bx(r){return o=>{setTimeout(r,void 0,o)}}const si=class wS extends vi{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,s,c){let h=o,m=s||(()=>null),y=c;if(o&&"object"==typeof o){const M=o;h=M.next?.bind(M),m=M.error?.bind(M),y=M.complete?.bind(M)}this.__isAsync&&(m=bx(m),h&&(h=bx(h)),y&&(y=bx(y)));const w=super.subscribe({next:h,error:m,complete:y});return o instanceof it&&o.add(w),w}};function Np(...r){}class hr{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:c=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new si(!1),this.onMicrotaskEmpty=new si(!1),this.onStable=new si(!1),this.onError=new si(!1),typeof Zone>"u")throw new pt(908,!1);Zone.assertZonePatched();const h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!c&&s,h.shouldCoalesceRunChangeDetection=c,h.lastRequestAnimationFrameId=-1,h.nativeRequestAnimationFrame=function Ed(){const r="function"==typeof vr.requestAnimationFrame;let o=vr[r?"requestAnimationFrame":"setTimeout"],s=vr[r?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&o&&s){const c=o[Zone.__symbol__("OriginalDelegate")];c&&(o=c);const h=s[Zone.__symbol__("OriginalDelegate")];h&&(s=h)}return{nativeRequestAnimationFrame:o,nativeCancelAnimationFrame:s}}().nativeRequestAnimationFrame,function pM(r){const o=()=>{!function CS(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(vr,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,A_(r),r.isCheckStableRunning=!0,I_(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),A_(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,c,h,m,y,w)=>{if(function Wc(r){return!(!Array.isArray(r)||1!==r.length)&&!0===r[0].data?.__ignore_ng_zone__}(w))return s.invokeTask(h,m,y,w);try{return wx(r),s.invokeTask(h,m,y,w)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||r.shouldCoalesceRunChangeDetection)&&o(),Ex(r)}},onInvoke:(s,c,h,m,y,w,M)=>{try{return wx(r),s.invoke(h,m,y,w,M)}finally{r.shouldCoalesceRunChangeDetection&&o(),Ex(r)}},onHasTask:(s,c,h,m)=>{s.hasTask(h,m),c===h&&("microTask"==m.change?(r._hasPendingMicrotasks=m.microTask,A_(r),I_(r)):"macroTask"==m.change&&(r.hasPendingMacrotasks=m.macroTask))},onHandleError:(s,c,h,m)=>(s.handleError(h,m),r.runOutsideAngular(()=>r.onError.emit(m)),!1)})}(h)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!hr.isInAngularZone())throw new pt(909,!1)}static assertNotInAngularZone(){if(hr.isInAngularZone())throw new pt(909,!1)}run(o,s,c){return this._inner.run(o,s,c)}runTask(o,s,c,h){const m=this._inner,y=m.scheduleEventTask("NgZoneEvent: "+h,o,MS,Np,Np);try{return m.runTask(y,s,c)}finally{m.cancelTask(y)}}runGuarded(o,s,c){return this._inner.runGuarded(o,s,c)}runOutsideAngular(o){return this._outer.run(o)}}const MS={};function I_(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function A_(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function wx(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function Ex(r){r._nesting--,I_(r)}class mM{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new si,this.onMicrotaskEmpty=new si,this.onStable=new si,this.onError=new si}run(o,s,c){return o.apply(s,c)}runGuarded(o,s,c){return o.apply(s,c)}runOutsideAngular(o){return o()}runTask(o,s,c,h){return o.apply(s,c)}}const Mx=new ae("",{providedIn:"root",factory:Cx});function Cx(){const r=le(hr);let o=!0;return function Qm(...r){const o=Sc(r),s=function cw(r,o){return"number"==typeof Ym(r)?r.pop():o}(r,1/0),c=r;return c.length?1===c.length?fn(c[0]):Dc(s)(hi(c,o)):ha}(new Un(h=>{o=r.isStable&&!r.hasPendingMacrotasks&&!r.hasPendingMicrotasks,r.runOutsideAngular(()=>{h.next(o),h.complete()})}),new Un(h=>{let m;r.runOutsideAngular(()=>{m=r.onStable.subscribe(()=>{hr.assertNotInAngularZone(),queueMicrotask(()=>{!o&&!r.hasPendingMacrotasks&&!r.hasPendingMicrotasks&&(o=!0,h.next(!0))})})});const y=r.onUnstable.subscribe(()=>{hr.assertInAngularZone(),o&&(o=!1,r.runOutsideAngular(()=>{h.next(!1)}))});return()=>{m.unsubscribe(),y.unsubscribe()}}).pipe(Tn()))}function Ql(r){return r instanceof Function?r():r}let Sx=(()=>{class r{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#t=this.\u0275prov=Ie({token:r,providedIn:"root",factory:()=>new r})}return r})();function zp(r){for(;r;){r[rn]|=64;const o=id(r);if(zv(r)&&!o)return r;r=o}return null}const bM=new ae("",{providedIn:"root",factory:()=>!1});let O_=null;function k_(r,o){return r[o]??Ix()}function CM(r,o){const s=Ix();s.producerNode?.length&&(r[o]=O_,s.lView=r,O_=TM())}const SS={...Pw,consumerIsAlwaysLive:!0,consumerMarkedDirty:r=>{zp(r.lView)},lView:null};function TM(){return Object.create(SS)}function Ix(){return O_??=TM(),O_}const Ye={};function L_(r,o,s,c){if(!c)if(3==(3&o[rn])){const m=r.preOrderCheckHooks;null!==m&&Wh(o,m,s)}else{const m=r.preOrderHooks;null!==m&&wa(o,m,0,s)}Ul(s)}function jt(r,o=He.Default){const s=Ot();return null===s?ye(r,o):rE($i(),s,qe(r),o)}function Xc(r,o,s,c,h,m,y,w,M,S,O){const F=o.blueprint.slice();return F[Wr]=h,F[rn]=140|c,(null!==S||r&&2048&r[rn])&&(F[rn]|=2048),xa(F),F[lr]=F[Nh]=r,F[Xr]=s,F[Rc]=y||r&&r[Rc],F[We]=w||r&&r[We],F[el]=M||r&&r[el]||null,F[bo]=m,F[Tu]=function TE(){return Ma++}(),F[rl]=O,F[_a]=S,F[Pr]=2==o.type?r[Pr]:F,F}function Sa(r,o,s,c,h){let m=r.data[o];if(null===m)m=function Vp(r,o,s,c,h){const m=Og(),y=kg(),M=r.data[o]=function RM(r,o,s,c,h,m){let y=o?o.injectorIndex:-1,w=0;return function Au(){return null!==ze.skipHydrationRootTNode}()&&(w|=128),{type:s,index:c,insertBeforeIndex:null,injectorIndex:y,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:w,providerIndexes:0,value:h,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?m:m&&m.parent,s,o,c,h);return null===r.firstChild&&(r.firstChild=M),null!==m&&(y?null==m.child&&null!==M.parent&&(m.child=M):null===m.next&&(m.next=M,M.prev=m)),M}(r,o,s,c,h),function Jf(){return ze.lFrame.inI18n}()&&(m.flags|=32);else if(64&m.type){m.type=s,m.value=c,m.attrs=h;const y=function Pu(){const r=ze.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();m.injectorIndex=null===y?-1:y.injectorIndex}return Xs(m,!0),m}function Yc(r,o,s,c){if(0===s)return-1;const h=o.length;for(let m=0;m<s;m++)o.push(c),r.blueprint.push(c),r.data.push(null);return h}function SM(r,o,s,c,h){const m=k_(o,Du),y=ao(),w=2&c;try{Ul(-1),w&&o.length>_n&&L_(r,o,_n,!1),zo(w?2:0,h);const S=w?m:null,O=Gf(S);try{null!==S&&(S.dirty=!1),s(c,h)}finally{jh(S,O)}}finally{w&&null===o[Du]&&CM(o,Du),Ul(y),zo(w?3:1,h)}}function F_(r,o,s){if(Mg(o)){const c=Ds(null);try{const m=o.directiveEnd;for(let y=o.directiveStart;y<m;y++){const w=r.data[y];w.contentQueries&&w.contentQueries(1,s[y],y)}}finally{Ds(c)}}}function Px(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=z_(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):o}function z_(r,o,s,c,h,m,y,w,M,S,O){const F=_n+c,$=F+h,Y=function B_(r,o){const s=[];for(let c=0;c<o;c++)s.push(c<r?null:Ye);return s}(F,$),st="function"==typeof S?S():S;return Y[oe]={type:r,blueprint:Y,template:s,queries:null,viewQuery:w,declTNode:o,data:Y.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:$,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:M,consts:st,incompleteFirstPass:!1,ssrId:O}}let Rx=r=>null;function Ox(r,o,s,c){for(let h in r)if(r.hasOwnProperty(h)){s=null===s?{}:s;const m=r[h];null===c?OM(s,o,h,m):c.hasOwnProperty(h)&&OM(s,o,c[h],m)}return s}function OM(r,o,s,c){r.hasOwnProperty(s)?r[s].push(o,c):r[s]=[o,c]}function Ku(r,o,s,c,h,m){for(let S=0;S<c.length;S++)Yg(np(s,o),r,c[S].type);!function Cd(r,o,s){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+s,r.providerIndexes=o}(s,r.data.length,c.length);for(let S=0;S<c.length;S++){const O=c[S];O.providersResolver&&O.providersResolver(O)}let y=!1,w=!1,M=Yc(r,o,c.length,null);for(let S=0;S<c.length;S++){const O=c[S];s.mergedAttrs=ga(s.mergedAttrs,O.hostAttrs),Td(r,s,o,M,O),OS(M,O,h),null!==O.contentQueries&&(s.flags|=4),(null!==O.hostBindings||null!==O.hostAttrs||0!==O.hostVars)&&(s.flags|=64);const F=O.type.prototype;!y&&(F.ngOnChanges||F.ngOnInit||F.ngDoCheck)&&((r.preOrderHooks??=[]).push(s.index),y=!0),!w&&(F.ngOnChanges||F.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(s.index),w=!0),M++}!function AS(r,o,s){const h=o.directiveEnd,m=r.data,y=o.attrs,w=[];let M=null,S=null;for(let O=o.directiveStart;O<h;O++){const F=m[O],$=s?s.get(F):null,st=$?$.outputs:null;M=Ox(F.inputs,O,M,$?$.inputs:null),S=Ox(F.outputs,O,S,st);const ht=null===M||null===y||yw(o)?null:LS(M,O,y);w.push(ht)}null!==M&&(M.hasOwnProperty("class")&&(o.flags|=8),M.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=w,o.inputs=M,o.outputs=S}(r,s,m)}function kx(r,o,s){const c=s.directiveStart,h=s.directiveEnd,m=s.index,y=function Kf(){return ze.lFrame.currentDirectiveIndex}();try{Ul(m);for(let w=c;w<h;w++){const M=r.data[w],S=o[w];nr(w),(null!==M.hostBindings||0!==M.hostVars||null!==M.hostAttrs)&&j_(M,S)}}finally{Ul(-1),nr(y)}}function j_(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function Lx(r,o,s){o.componentOffset=s,(r.components??=[]).push(o.index)}function OS(r,o,s){if(s){if(o.exportAs)for(let c=0;c<o.exportAs.length;c++)s[o.exportAs[c]]=r;ya(o)&&(s[""]=r)}}function Td(r,o,s,c,h){r.data[c]=h;const m=h.factory||(h.factory=il(h.type)),y=new Ou(m,ya(h),jt);r.blueprint[c]=y,s[c]=y,function Jc(r,o,s,c,h){const m=h.hostBindings;if(m){let y=r.hostBindingOpCodes;null===y&&(y=r.hostBindingOpCodes=[]);const w=~o.index;(function FM(r){let o=r.length;for(;o>0;){const s=r[--o];if("number"==typeof s&&s<0)return s}return 0})(y)!=w&&y.push(w),y.push(s,c,m)}}(r,o,c,Yc(r,s,h.hostVars,Ye),h)}function kS(r,o,s,c,h,m){const y=m[o];if(null!==y)for(let w=0;w<y.length;)$_(c,s,y[w++],y[w++],y[w++])}function $_(r,o,s,c,h){const m=Ds(null);try{const y=r.inputTransforms;null!==y&&y.hasOwnProperty(c)&&(h=y[c].call(o,h)),null!==r.setInput?r.setInput(o,h,s,c):o[c]=h}finally{Ds(m)}}function LS(r,o,s){let c=null,h=0;for(;h<s.length;){const m=s[h];if(0!==m)if(5!==m){if("number"==typeof m)break;if(r.hasOwnProperty(m)){null===c&&(c=[]);const y=r[m];for(let w=0;w<y.length;w+=2)if(y[w]===o){c.push(m,y[w+1],s[h+1]);break}}h+=2}else h+=2;else h+=4}return c}function nc(r,o){const s=r.contentQueries;if(null!==s)for(let c=0;c<s.length;c+=2){const m=s[c+1];if(-1!==m){const y=r.data[m];Ng(s[c]),y.contentQueries(2,o[m],m)}}}function $p(r,o){return r[Fh]?r[Nv][Zs]=o:r[Fh]=o,r[Nv]=o,o}function H_(r,o,s){Ng(0);const c=Ds(null);try{o(r,s)}finally{Ds(c)}}function Kc(r,o){const s=r[el],c=s?s.get(Kl,null):null;c&&c.handleError(o)}function q_(r,o,s,c,h){for(let m=0;m<s.length;){const y=s[m++],w=s[m++];$_(r.data[y],o[y],c,w,h)}}function zM(r,o){const s=As(o,r),c=s[oe];!function FS(r,o){for(let s=o.length;s<r.blueprint.length;s++)o.push(r.blueprint[s])}(c,s);const h=s[Wr];null!==h&&null===s[rl]&&(s[rl]=w_(h,s[el])),vl(c,s,s[Xr])}function vl(r,o,s){s0(o);try{const c=r.viewQuery;null!==c&&H_(1,c,s);const h=r.template;null!==h&&SM(r,o,h,1,s),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&nc(r,o),r.staticViewQueries&&H_(2,r.viewQuery,s);const m=r.components;null!==m&&function NS(r,o){for(let s=0;s<o.length;s++)zM(r,o[s])}(o,m)}catch(c){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),c}finally{o[rn]&=-5,wo()}}let Sd=(()=>{class r{constructor(){this.all=new Set,this.queue=new Map}create(s,c,h){const m=typeof Zone>"u"?null:Zone.current,y=function Uw(r,o,s){const c=Object.create($w);s&&(c.consumerAllowSignalWrites=!0),c.fn=r,c.schedule=o;const h=y=>{c.cleanupFn=y};return c.ref={notify:()=>jl(c),run:()=>{if(c.dirty=!1,c.hasRun&&!qf(c))return;c.hasRun=!0;const y=Gf(c);try{c.cleanupFn(),c.cleanupFn=Su,c.fn(h)}finally{jh(c,y)}},cleanup:()=>c.cleanupFn()},c.ref}(s,S=>{this.all.has(S)&&this.queue.set(S,m)},h);let w;this.all.add(y),y.notify();const M=()=>{y.cleanup(),w?.(),this.all.delete(y),this.queue.delete(y)};return w=c?.onDestroy(M),{destroy:M}}flush(){if(0!==this.queue.size)for(const[s,c]of this.queue)this.queue.delete(s),c?c.run(()=>s.run()):s.run()}get isQueueEmpty(){return 0===this.queue.size}static#t=this.\u0275prov=Ie({token:r,providedIn:"root",factory:()=>new r})}return r})();function Qc(r,o,s){let c=s?r.styles:null,h=s?r.classes:null,m=0;if(null!==o)for(let y=0;y<o.length;y++){const w=o[y];"number"==typeof w?m=w:1==m?h=Df(h,w):2==m&&(c=Df(c,w+": "+o[++y]+";"))}s?r.styles=c:r.stylesWithoutHost=c,s?r.classes=h:r.classesWithoutHost=h}function rc(r,o,s,c,h=!1){for(;null!==s;){const m=o[s.index];null!==m&&c.push(Dr(m)),No(m)&&Gp(m,c);const y=s.type;if(8&y)rc(r,o,s.child,c);else if(32&y){const w=pp(s,o);let M;for(;M=w();)c.push(M)}else if(16&y){const w=B0(o,s);if(Array.isArray(w))c.push(...w);else{const M=id(o[Pr]);rc(M[oe],M,w,c,!0)}}s=h?s.projectionNext:s.next}return c}function Gp(r,o){for(let s=Si;s<r.length;s++){const c=r[s],h=c[oe].firstChild;null!==h&&rc(c[oe],c,h,o)}r[Ts]!==r[Wr]&&o.push(r[Ts])}function Z_(r,o,s,c=!0){const h=o[Rc],m=h.rendererFactory,y=h.afterRenderEventManager;m.begin?.(),y?.begin();try{qp(r,o,r.template,s)}catch(M){throw c&&Kc(o,M),M}finally{m.end?.(),h.effectManager?.flush(),y?.end()}}function qp(r,o,s,c){const h=o[rn];if(256!=(256&h)){o[Rc].effectManager?.flush(),s0(o);try{xa(o),function o0(r){return ze.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==s&&SM(r,o,s,2,c);const y=3==(3&h);if(y){const S=r.preOrderCheckHooks;null!==S&&Wh(o,S,null)}else{const S=r.preOrderHooks;null!==S&&wa(o,S,0,null),Rr(o,0)}if(function VM(r){for(let o=A0(r);null!==o;o=P0(o)){if(!o[Cw])continue;const s=o[Oc];for(let c=0;c<s.length;c++){Gh(s[c])}}}(o),BM(o,2),null!==r.contentQueries&&nc(r,o),y){const S=r.contentCheckHooks;null!==S&&Wh(o,S)}else{const S=r.contentHooks;null!==S&&wa(o,S,1),Rr(o,1)}!function DM(r,o){const s=r.hostBindingOpCodes;if(null===s)return;const c=k_(o,zh);try{for(let h=0;h<s.length;h++){const m=s[h];if(m<0)Ul(~m);else{const y=m,w=s[++h],M=s[++h];te(w,y),c.dirty=!1;const S=Gf(c);try{M(2,o[y])}finally{jh(c,S)}}}}finally{null===o[zh]&&CM(o,zh),Ul(-1)}}(r,o);const w=r.components;null!==w&&Bx(o,w,0);const M=r.viewQuery;if(null!==M&&H_(2,M,c),y){const S=r.viewCheckHooks;null!==S&&Wh(o,S)}else{const S=r.viewHooks;null!==S&&wa(o,S,2),Rr(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),o[rn]&=-73,Yf(o)}finally{wo()}}}function BM(r,o){for(let s=A0(r);null!==s;s=P0(s))for(let c=Si;c<s.length;c++)UM(s[c],o)}function jM(r,o,s){UM(As(o,r),s)}function UM(r,o){if(!function Pg(r){return 128==(128&r[rn])}(r))return;const s=r[oe],c=r[rn];if(80&c&&0===o||1024&c||2===o)qp(s,r,s.template,r[Xr]);else if(r[Vf]>0){BM(r,1);const h=s.components;null!==h&&Bx(r,h,1)}}function Bx(r,o,s){for(let c=0;c<o.length;c++)jM(r,o[c],s)}class Zp{get rootNodes(){const o=this._lView,s=o[oe];return rc(s,o,s.firstChild,[])}constructor(o,s){this._lView=o,this._cdRefInjectingView=s,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Xr]}set context(o){this._lView[Xr]=o}get destroyed(){return 256==(256&this._lView[rn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[lr];if(No(o)){const s=o[8],c=s?s.indexOf(this):-1;c>-1&&(a_(o,c),Ea(s,c))}this._attachedToViewContainer=!1}nt(this._lView[oe],this._lView)}onDestroy(o){!function Qv(r,o){if(256==(256&r[rn]))throw new pt(911,!1);null===r[nl]&&(r[nl]=[]),r[nl].push(o)}(this._lView,o)}markForCheck(){zp(this._cdRefInjectingView||this._lView)}detach(){this._lView[rn]&=-129}reattach(){this._lView[rn]|=128}detectChanges(){Z_(this._lView[oe],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new pt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function K2(r,o){ud(r,o,o[We],2,null,null)}(this._lView[oe],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new pt(902,!1);this._appRef=o}}class $M extends Zp{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Z_(o[oe],o,o[Xr],!1)}checkNoChanges(){}get context(){return null}}class HM extends T_{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const s=An(o);return new Ad(s,this.ngModule)}}function Wp(r){const o=[];for(let s in r)r.hasOwnProperty(s)&&o.push({propName:r[s],templateName:s});return o}class Vx{constructor(o,s){this.injector=o,this.parentInjector=s}get(o,s,c){c=fg(c);const h=this.injector.get(o,mx,c);return h!==mx||s===mx?h:this.parentInjector.get(o,s,c)}}class Ad extends aM{get inputs(){const o=this.componentDef,s=o.inputTransforms,c=Wp(o.inputs);if(null!==s)for(const h of c)s.hasOwnProperty(h.propName)&&(h.transform=s[h.propName]);return c}get outputs(){return Wp(this.componentDef.outputs)}constructor(o,s){super(),this.componentDef=o,this.ngModule=s,this.componentType=o.type,this.selector=function Ew(r){return r.map(m2).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!s}create(o,s,c,h){let m=(h=h||this.ngModule)instanceof cs?h:h?.injector;m&&null!==this.componentDef.getStandaloneInjector&&(m=this.componentDef.getStandaloneInjector(m)||m);const y=m?new Vx(o,m):o,w=y.get(cM,null);if(null===w)throw new pt(407,!1);const F={rendererFactory:w,sanitizer:y.get(uM,null),effectManager:y.get(Sd,null),afterRenderEventManager:y.get(Sx,null)},$=w.createRenderer(null,this.componentDef),Y=this.componentDef.selectors[0][0]||"div",st=c?function IM(r,o,s,c){const m=c.get(bM,!1)||s===Lo.ShadowDom,y=r.selectRootElement(o,m);return function IS(r){Rx(r)}(y),y}($,c,this.componentDef.encapsulation,y):od($,Y,function zS(r){const o=r.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(Y)),bt=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let mt=null;null!==st&&(mt=w_(st,y,!0));const Ut=z_(0,null,null,1,0,null,null,null,null,null,null),Qt=Xc(null,Ut,null,bt,null,null,F,$,y,null,mt);let de,fe;s0(Qt);try{const en=this.componentDef;let Ln,Bn=null;en.findHostDirectiveDefs?(Ln=[],Bn=new Map,en.findHostDirectiveDefs(en,Ln,Bn),Ln.push(en)):Ln=[en];const Jr=function BS(r,o){const s=r[oe],c=_n;return r[c]=o,Sa(s,c,2,"#host",null)}(Qt,st),pr=function VS(r,o,s,c,h,m,y){const w=h[oe];!function X_(r,o,s,c){for(const h of r)o.mergedAttrs=ga(o.mergedAttrs,h.hostAttrs);null!==o.mergedAttrs&&(Qc(o,o.mergedAttrs,!0),null!==s&&jE(c,s,o))}(c,r,o,y);let M=null;null!==o&&(M=w_(o,h[el]));const S=m.rendererFactory.createRenderer(o,s);let O=16;s.signals?O=4096:s.onPush&&(O=64);const F=Xc(h,Px(s),null,O,h[r.index],r,m,S,null,null,M);return w.firstCreatePass&&Lx(w,r,c.length-1),$p(h,F),h[r.index]=F}(Jr,st,en,Ln,Qt,F,$);fe=Xw(Ut,_n),st&&function J_(r,o,s,c){if(c)kh(r,s,["ng-version",vS.full]);else{const{attrs:h,classes:m}=function kv(r){const o=[],s=[];let c=1,h=2;for(;c<r.length;){let m=r[c];if("string"==typeof m)2===h?""!==m&&o.push(m,r[++c]):8===h&&s.push(m);else{if(!Ms(h))break;h=m}c++}return{attrs:o,classes:s}}(o.selectors[0]);h&&kh(r,s,h),m&&m.length>0&&lo(r,s,m.join(" "))}}($,en,st,c),void 0!==s&&function K_(r,o,s){const c=r.projection=[];for(let h=0;h<o.length;h++){const m=s[h];c.push(null!=m?Array.from(m):null)}}(fe,this.ngContentSelectors,s),de=function Y_(r,o,s,c,h,m){const y=$i(),w=h[oe],M=Qo(y,h);Ku(w,h,y,s,null,c);for(let O=0;O<s.length;O++)Hi($l(h,w,y.directiveStart+O,y),h);kx(w,h,y),M&&Hi(M,h);const S=$l(h,w,y.directiveStart+y.componentOffset,y);if(r[Xr]=h[Xr]=S,null!==m)for(const O of m)O(S,o);return F_(w,y,r),S}(pr,en,Ln,Bn,Qt,[Pd]),vl(Ut,Qt,null)}finally{wo()}return new W_(this.componentType,de,xd(fe,Qt),Qt,fe)}}class W_ extends mS{constructor(o,s,c,h,m){super(),this.location=c,this._rootLView=h,this._tNode=m,this.previousInputValues=null,this.instance=s,this.hostView=this.changeDetectorRef=new $M(h),this.componentType=o}setInput(o,s){const c=this._tNode.inputs;let h;if(null!==c&&(h=c[o])){if(this.previousInputValues??=new Map,this.previousInputValues.has(o)&&Object.is(this.previousInputValues.get(o),s))return;const m=this._rootLView;q_(m[oe],m,h,o,s),this.previousInputValues.set(o,s),zp(As(this._tNode.index,m))}}get injector(){return new se(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function Pd(){const r=$i();Zh(Ot()[oe],r)}function Jn(r){let o=function GM(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),s=!0;const c=[r];for(;o;){let h;if(ya(r))h=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new pt(903,!1);h=o.\u0275dir}if(h){if(s){c.push(h);const y=r;y.inputs=Qu(r.inputs),y.inputTransforms=Qu(r.inputTransforms),y.declaredInputs=Qu(r.declaredInputs),y.outputs=Qu(r.outputs);const w=h.hostBindings;w&&US(r,w);const M=h.viewQuery,S=h.contentQueries;if(M&&Xp(r,M),S&&jS(r,S),Tf(r.inputs,h.inputs),Tf(r.declaredInputs,h.declaredInputs),Tf(r.outputs,h.outputs),null!==h.inputTransforms&&(null===y.inputTransforms&&(y.inputTransforms={}),Tf(y.inputTransforms,h.inputTransforms)),ya(h)&&h.data.animation){const O=r.data;O.animation=(O.animation||[]).concat(h.data.animation)}}const m=h.features;if(m)for(let y=0;y<m.length;y++){const w=m[y];w&&w.ngInherit&&w(r),w===Jn&&(s=!1)}}o=Object.getPrototypeOf(o)}!function jx(r){let o=0,s=null;for(let c=r.length-1;c>=0;c--){const h=r[c];h.hostVars=o+=h.hostVars,h.hostAttrs=ga(h.hostAttrs,s=ga(s,h.hostAttrs))}}(c)}function Qu(r){return r===qs?{}:r===zn?[]:r}function Xp(r,o){const s=r.viewQuery;r.viewQuery=s?(c,h)=>{o(c,h),s(c,h)}:o}function jS(r,o){const s=r.contentQueries;r.contentQueries=s?(c,h,m)=>{o(c,h,m),s(c,h,m)}:o}function US(r,o){const s=r.hostBindings;r.hostBindings=s?(c,h)=>{o(c,h),s(c,h)}:o}function ho(r,o,s){return!Object.is(r[o],s)&&(r[o]=s,!0)}function jd(r,o,s){const c=Ot();return ho(c,qh(),o)&&function hs(r,o,s,c,h,m,y,w){const M=Qo(o,s);let O,S=o.inputs;!w&&null!=S&&(O=S[c])?(q_(r,s,O,c,h),kc(o)&&function jp(r,o){const s=As(o,r);16&s[rn]||(s[rn]|=64)}(s,o.index)):3&o.type&&(c=function kM(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(c),h=null!=y?y(h,o.value||"",c):h,m.setProperty(M,c,h))}(Dn(),function rr(){const r=ze.lFrame;return Xw(r.tView,r.selectedIndex)}(),c,r,o,c[We],s,!1),jd}function ay(r,o,s,c,h){const y=h?"class":"style";q_(r,s,o.inputs[y],y,c)}function jo(r,o,s,c){const h=Ot(),m=Dn(),y=_n+r,w=h[We],M=m.firstCreatePass?function cC(r,o,s,c,h,m){const y=o.consts,M=Sa(o,r,2,c,Bo(y,h));return function Fs(r,o,s,c){if(Rg()){const h=null===c?null:{"":-1},m=function U_(r,o){const s=r.directiveRegistry;let c=null,h=null;if(s)for(let m=0;m<s.length;m++){const y=s[m];if(bw(o,y.selectors,!1))if(c||(c=[]),ya(y))if(null!==y.findHostDirectiveDefs){const w=[];h=h||new Map,y.findHostDirectiveDefs(y,w,h),c.unshift(...w,y),Lx(r,o,w.length)}else c.unshift(y),Lx(r,o,0);else h=h||new Map,y.findHostDirectiveDefs?.(y,c,h),c.push(y)}return null===c?null:[c,h]}(r,s);let y,w;null===m?y=w=null:[y,w]=m,null!==y&&Ku(r,o,s,y,h,w),h&&function RS(r,o,s){if(o){const c=r.localNames=[];for(let h=0;h<o.length;h+=2){const m=s[o[h+1]];if(null==m)throw new pt(-301,!1);c.push(o[h],m)}}}(s,c,h)}s.mergedAttrs=ga(s.mergedAttrs,s.attrs)}(o,s,M,Bo(y,m)),null!==M.attrs&&Qc(M,M.attrs,!1),null!==M.mergedAttrs&&Qc(M,M.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,M),M}(y,m,h,o,s,c):m.data[y],S=Xx(m,h,M,w,o,r);h[y]=S;const O=Bl(M);return Xs(M,!0),jE(w,S,M),32!=(32&M.flags)&&ba()&&Ze(m,h,S,M),0===function t0(){return ze.lFrame.elementDepthCount}()&&Hi(S,h),function P2(){ze.lFrame.elementDepthCount++}(),O&&(function N_(r,o,s){Rg()&&(function V_(r,o,s,c){const h=s.directiveStart,m=s.directiveEnd;kc(s)&&function Fx(r,o,s){const c=Qo(o,r),h=Px(s);let y=16;s.signals?y=4096:s.onPush&&(y=64);const w=$p(r,Xc(r,h,null,y,c,o,null,r[Rc].rendererFactory.createRenderer(c,s),null,null,null));r[o.index]=w}(o,s,r.data[h+s.componentOffset]),r.firstCreatePass||np(s,o),Hi(c,o);const y=s.initialInputs;for(let w=h;w<m;w++){const M=r.data[w],S=$l(o,r,w,s);Hi(S,o),null!==y&&kS(0,w-h,S,M,0,y),ya(M)&&(As(s.index,o)[Xr]=$l(o,r,w,s))}}(r,o,s,Qo(s,o)),64==(64&s.flags)&&kx(r,o,s))}(m,h,M),F_(m,M,h)),null!==c&&function Ax(r,o,s=Qo){const c=o.localNames;if(null!==c){let h=o.index+1;for(let m=0;m<c.length;m+=2){const y=c[m+1],w=-1===y?s(o,r):r[y];r[h++]=w}}}(h,M),jo}function fo(){let r=$i();kg()?function es(){ze.lFrame.isParent=!1}():(r=r.parent,Xs(r,!1));const o=r;(function Jw(r){return ze.skipHydrationRootTNode===r})(o)&&function n0(){ze.skipHydrationRootTNode=null}(),function R2(){ze.lFrame.elementDepthCount--}();const s=Dn();return s.firstCreatePass&&(Zh(s,r),Mg(r)&&s.queries.elementEnd(r)),null!=o.classesWithoutHost&&function Zg(r){return 0!=(8&r.flags)}(o)&&ay(s,o,Ot(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function u0(r){return 0!=(16&r.flags)}(o)&&ay(s,o,Ot(),o.stylesWithoutHost,!1),fo}function Ud(r,o,s,c){return jo(r,o,s,c),fo(),Ud}let Xx=(r,o,s,c,h,m)=>(sl(!0),od(c,h,function jg(){return ze.lFrame.currentNamespace}()));function Gd(r){return!!r&&"function"==typeof r.then}function Jx(r){return!!r&&"function"==typeof r.subscribe}function Uo(r,o,s,c){const h=Ot(),m=Dn(),y=$i();return function rm(r,o,s,c,h,m,y){const w=Bl(c),S=r.firstCreatePass&&function NM(r){return r.cleanup||(r.cleanup=[])}(r),O=o[Xr],F=function G_(r){return r[Lh]||(r[Lh]=[])}(o);let $=!0;if(3&c.type||y){const ht=Qo(c,o),_t=y?y(ht):ht,bt=F.length,mt=y?Qt=>y(Dr(Qt[c.index])):c.index;let Ut=null;if(!y&&w&&(Ut=function hC(r,o,s,c){const h=r.cleanup;if(null!=h)for(let m=0;m<h.length-1;m+=2){const y=h[m];if(y===s&&h[m+1]===c){const w=o[Lh],M=h[m+2];return w.length>M?w[M]:null}"string"==typeof y&&(m+=2)}return null}(r,o,h,c.index)),null!==Ut)(Ut.__ngLastListenerFn__||Ut).__ngNextListenerFn__=m,Ut.__ngLastListenerFn__=m,$=!1;else{m=Qx(c,o,O,m,!1);const Qt=s.listen(_t,h,m);F.push(m,Qt),S&&S.push(h,mt,bt,bt+1)}}else m=Qx(c,o,O,m,!1);const Y=c.outputs;let st;if($&&null!==Y&&(st=Y[h])){const ht=st.length;if(ht)for(let _t=0;_t<ht;_t+=2){const de=o[st[_t]][st[_t+1]].subscribe(m),fe=F.length;F.push(m,de),S&&S.push(h,c.index,fe,-(fe+1))}}}(m,h,h[We],y,r,o,c),Uo}function nh(r,o,s,c){try{return zo(6,o,s),!1!==s(c)}catch(h){return Kc(r,h),!1}finally{zo(7,o,s)}}function Qx(r,o,s,c,h){return function m(y){if(y===Function)return c;zp(r.componentOffset>-1?As(r.index,o):o);let M=nh(o,s,c,y),S=m.__ngNextListenerFn__;for(;S;)M=nh(o,s,S,y)&&M,S=S.__ngNextListenerFn__;return h&&!1===M&&y.preventDefault(),M}}function am(r,o){return r<<17|o<<2}function sc(r){return r>>17&32767}function n1(r){return 2|r}function ac(r){return(131068&r)>>2}function lc(r,o){return-131069&r|o<<2}function hy(r){return 1|r}function vC(r,o,s,c,h){const m=r[s+1],y=null===o;let w=c?sc(m):ac(m),M=!1;for(;0!==w&&(!1===M||y);){const O=r[w+1];dI(r[w],o)&&(M=!0,r[w+1]=c?hy(O):n1(O)),w=c?sc(O):ac(O)}M&&(r[s+1]=c?n1(m):hy(m))}function dI(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&zu(r,o)>=0}function eu(r,o){return function La(r,o,s,c){const h=Ot(),m=Dn(),y=function ns(r){const o=ze.lFrame,s=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,s}(2);m.firstUpdatePass&&function Wd(r,o,s,c){const h=r.data;if(null===h[s+1]){const m=h[ao()],y=function o1(r,o){return o>=r.expandoStartIndex}(r,s);(function l1(r,o){return 0!=(r.flags&(o?8:16))})(m,c)&&null===o&&!y&&(o=!1),o=function IC(r,o,s,c){const h=function Pi(r){const o=ze.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let m=c?o.residualClasses:o.residualStyles;if(null===h)0===(c?o.classBindings:o.styleBindings)&&(s=Xd(s=fy(null,r,o,s,c),o.attrs,c),m=null);else{const y=o.directiveStylingLast;if(-1===y||r[y]!==h)if(s=fy(h,r,o,s,c),null===m){let M=function mI(r,o,s){const c=s?o.classBindings:o.styleBindings;if(0!==ac(c))return r[sc(c)]}(r,o,c);void 0!==M&&Array.isArray(M)&&(M=fy(null,r,o,M[1],c),M=Xd(M,o.attrs,c),function AC(r,o,s,c){r[sc(s?o.classBindings:o.styleBindings)]=c}(r,o,c,M))}else m=function s1(r,o,s){let c;const h=o.directiveEnd;for(let m=1+o.directiveStylingLast;m<h;m++)c=Xd(c,r[m].hostAttrs,s);return Xd(c,o.attrs,s)}(r,o,c)}return void 0!==m&&(c?o.residualClasses=m:o.residualStyles=m),s}(h,m,o,c),function lm(r,o,s,c,h,m){let y=m?o.classBindings:o.styleBindings,w=sc(y),M=ac(y);r[c]=s;let O,S=!1;if(Array.isArray(s)?(O=s[1],(null===O||zu(s,O)>0)&&(S=!0)):O=s,h)if(0!==M){const $=sc(r[w+1]);r[c+1]=am($,w),0!==$&&(r[$+1]=lc(r[$+1],c)),r[w+1]=function lI(r,o){return 131071&r|o<<17}(r[w+1],c)}else r[c+1]=am(w,0),0!==w&&(r[w+1]=lc(r[w+1],c)),w=c;else r[c+1]=am(M,0),0===w?w=c:r[M+1]=lc(r[M+1],c),M=c;S&&(r[c+1]=n1(r[c+1])),vC(r,O,c,!0),vC(r,O,c,!1),function hI(r,o,s,c,h){const m=h?r.residualClasses:r.residualStyles;null!=m&&"string"==typeof o&&zu(m,o)>=0&&(s[c+1]=hy(s[c+1]))}(o,O,r,c,m),y=am(w,M),m?o.classBindings=y:o.styleBindings=y}(h,m,o,s,y,c)}}(m,r,y,c),o!==Ye&&ho(h,y,o)&&function OC(r,o,s,c,h,m,y,w){if(!(3&o.type))return;const M=r.data,S=M[w+1],O=function yC(r){return 1==(1&r)}(S)?kC(M,o,s,h,ac(S),y):void 0;cc(O)||(cc(m)||function _C(r){return 2==(2&r)}(S)&&(m=kC(M,null,s,h,w,y)),function gp(r,o,s,c,h){if(o)h?r.addClass(s,c):r.removeClass(s,c);else{let m=-1===c.indexOf("-")?void 0:Hl.DashCase;null==h?r.removeStyle(s,c,m):("string"==typeof h&&h.endsWith("!important")&&(h=h.slice(0,-10),m|=Hl.Important),r.setStyle(s,c,h,m))}}(c,y,Ag(ao(),s),h,m))}(m,m.data[ao()],h,h[We],r,h[y+1]=function um(r,o){return null==r||""===r||("string"==typeof o?r+=o:"object"==typeof r&&(r=di(function as(r){return r instanceof d_?r.changingThisBreaksApplicationSecurity:r}(r)))),r}(o,s),c,y)}(r,o,null,!0),eu}function fy(r,o,s,c,h){let m=null;const y=s.directiveEnd;let w=s.directiveStylingLast;for(-1===w?w=s.directiveStart:w++;w<y&&(m=o[w],c=Xd(c,m.hostAttrs,h),m!==r);)w++;return null!==r&&(s.directiveStylingLast=w),c}function Xd(r,o,s){const c=s?1:2;let h=-1;if(null!==o)for(let m=0;m<o.length;m++){const y=o[m];"number"==typeof y?h=y:h===c&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),oi(r,y,!!s||o[++m]))}return void 0===r?null:r}function kC(r,o,s,c,h,m){const y=null===o;let w;for(;h>0;){const M=r[h],S=Array.isArray(M),O=S?M[1]:M,F=null===O;let $=s[h+1];$===Ye&&($=F?zn:void 0);let Y=F?t_($,c):O===c?$:void 0;if(S&&!cc(Y)&&(Y=t_(M,c)),cc(Y)&&(w=Y,y))return w;const st=r[h+1];h=y?sc(st):ac(st)}if(null!==o){let M=m?o.residualClasses:o.residualStyles;null!=M&&(w=t_(M,c))}return w}function cc(r){return void 0!==r}function nu(r,o=""){const s=Ot(),c=Dn(),h=r+_n,m=c.firstCreatePass?Sa(c,h,1,o,null):c.data[h],y=LC(c,s,m,o,r);s[h]=y,ba()&&Ze(c,s,y,m),Xs(m,!1)}let LC=(r,o,s,c,h)=>(sl(!0),function mp(r,o){return r.createText(o)}(o[We],c));function c1(r){return py("",r,""),c1}function py(r,o,s){const c=Ot(),h=function Od(r,o,s,c){return ho(r,qh(),s)?o+J(s)+c:Ye}(c,r,o,s);return h!==Ye&&function yl(r,o,s){const c=Ag(o,r);!function O0(r,o,s){r.setValue(o,s)}(r[We],c,s)}(c,ao(),h),py}const rh="en-US";let _y=rh;function Ty(r,o,s,c,h){if(r=qe(r),Array.isArray(r))for(let m=0;m<r.length;m++)Ty(r[m],o,s,c,h);else{const m=Dn(),y=Ot(),w=$i();let M=qc(r)?r:qe(r.provide);const S=ix(r),O=1048575&w.providerIndexes,F=w.directiveStart,$=w.providerIndexes>>20;if(qc(r)||!r.multi){const Y=new Ou(S,h,jt),st=Sy(M,o,h?O:O+$,F);-1===st?(Yg(np(w,y),m,M),ah(m,r,o.length),o.push(M),w.directiveStart++,w.directiveEnd++,h&&(w.providerIndexes+=1048576),s.push(Y),y.push(Y)):(s[st]=Y,y[st]=Y)}else{const Y=Sy(M,o,O+$,F),st=Sy(M,o,O,O+$),_t=st>=0&&s[st];if(h&&!_t||!h&&!(Y>=0&&s[Y])){Yg(np(w,y),m,M);const bt=function tA(r,o,s,c,h){const m=new Ou(r,s,jt);return m.multi=[],m.index=o,m.componentProviders=0,Dy(m,h,c&&!s),m}(h?QI:F1,s.length,h,c,S);!h&&_t&&(s[st].providerFactory=bt),ah(m,r,o.length,0),o.push(M),w.directiveStart++,w.directiveEnd++,h&&(w.providerIndexes+=1048576),s.push(bt),y.push(bt)}else ah(m,r,Y>-1?Y:st,Dy(s[h?st:Y],S,!h&&c));!h&&c&&_t&&s[st].componentProviders++}}}function ah(r,o,s,c){const h=qc(o),m=function tM(r){return!!r.useClass}(o);if(h||m){const M=(m?qe(o.useClass):o).prototype.ngOnDestroy;if(M){const S=r.destroyHooks||(r.destroyHooks=[]);if(!h&&o.multi){const O=S.indexOf(s);-1===O?S.push(s,[c,M]):S[O+1].push(c,M)}else S.push(s,M)}}}function Dy(r,o,s){return s&&r.componentProviders++,r.multi.push(o)-1}function Sy(r,o,s,c){for(let h=s;h<c;h++)if(o[h]===r)return h;return-1}function F1(r,o,s,c){return N1(this.multi,[])}function QI(r,o,s,c){const h=this.multi;let m;if(this.providerFactory){const y=this.providerFactory.componentProviders,w=$l(s,s[oe],this.providerFactory.index,c);m=w.slice(0,y),N1(h,m);for(let M=y;M<w.length;M++)m.push(w[M])}else m=[],N1(h,m);return m}function N1(r,o){for(let s=0;s<r.length;s++)o.push((0,r[s])());return o}function Br(r,o=[]){return s=>{s.providersResolver=(c,h)=>function L1(r,o,s){const c=Dn();if(c.firstCreatePass){const h=ya(r);Ty(s,c.data,c.blueprint,h,!0),Ty(o,c.data,c.blueprint,h,!1)}}(c,h?h(r):r,o)}}class au{}class z1{}class Iy extends au{constructor(o,s,c){super(),this._parent=s,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new HM(this);const h=xo(o);this._bootstrapComponents=Ql(h.bootstrap),this._r3Injector=gl(o,s,[{provide:au,useValue:this},{provide:T_,useValue:this.componentFactoryResolver},...c],di(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class Ay extends z1{constructor(o){super(),this.moduleType=o}create(o){return new Iy(this.moduleType,o,[])}}class B1 extends au{constructor(o){super(),this.componentFactoryResolver=new HM(this),this.instance=null;const s=new md([...o.providers,{provide:au,useValue:this},{provide:T_,useValue:this.componentFactoryResolver}],o.parent||Tp(),o.debugName,new Set(["environment"]));this.injector=s,o.runEnvironmentInitializers&&s.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function Qd(r,o,s=null){return new B1({providers:r,parent:o,debugName:s,runEnvironmentInitializers:!0}).injector}let Py=(()=>{class r{constructor(s){this._injector=s,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(s){if(!s.standalone)return null;if(!this.cachedInjectors.has(s)){const c=Q0(0,s.type),h=c.length>0?Qd([c],this._injector,`Standalone[${s.type.name}]`):null;this.cachedInjectors.set(s,h)}return this.cachedInjectors.get(s)}ngOnDestroy(){try{for(const s of this.cachedInjectors.values())null!==s&&s.destroy()}finally{this.cachedInjectors.clear()}}static#t=this.\u0275prov=Ie({token:r,providedIn:"environment",factory:()=>new r(ye(cs))})}return r})();function V1(r){r.getStandaloneInjector=o=>o.get(Py).getOrCreateStandaloneInjector(r)}function yA(r,o,s,c=!0){const h=o[oe];if(function Q2(r,o,s,c){const h=Si+c,m=s.length;c>0&&(s[h-1][Zs]=o),c<m-Si?(o[Zs]=s[h],Qg(s,Si+c,o)):(s.push(o),o[Zs]=null),o[lr]=s;const y=o[zl];null!==y&&s!==y&&function tS(r,o){const s=r[Oc];o[Pr]!==o[lr][lr][Pr]&&(r[Cw]=!0),null===s?r[Oc]=[o]:s.push(o)}(y,o);const w=o[Cs];null!==w&&w.insertView(r),o[rn]|=128}(h,o,r,s),c){const m=ad(s,r),y=o[We],w=$u(y,r[Ts]);null!==w&&function J2(r,o,s,c,h,m){c[Wr]=h,c[bo]=o,ud(r,c,s,1,h,m)}(h,r[bo],y,o,w,m)}}Symbol;let ms=(()=>{class r{static#t=this.__NG_ELEMENT_ID__=nf}return r})();function nf(){return function VT(r,o){let s;const c=o[r.index];return No(c)?s=c:(s=function Dd(r,o,s,c){return[r,!0,!1,o,null,0,c,s,null,null,null]}(c,o,null,r),o[r.index]=s,$p(o,s)),jT(s,o,r,c),new zT(s,r,o)}($i(),Ot())}const bA=ms,zT=class extends bA{constructor(o,s,c){super(),this._lContainer=o,this._hostTNode=s,this._hostLView=c}get element(){return xd(this._hostTNode,this._hostLView)}get injector(){return new se(this._hostTNode,this._hostLView)}get parentInjector(){const o=Lu(this._hostTNode,this._hostLView);if(Wg(o)){const s=Yh(o,this._hostLView),c=Xh(o);return new se(s[oe].data[c+8],s)}return new se(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const s=BT(this._lContainer);return null!==s&&s[o]||null}get length(){return this._lContainer.length-Si}createEmbeddedView(o,s,c){let h,m;"number"==typeof c?h=c:null!=c&&(h=c.index,m=c.injector);const w=o.createEmbeddedViewImpl(s||{},m,null);return this.insertImpl(w,h,false),w}createComponent(o,s,c,h,m){const y=o&&!function td(r){return"function"==typeof r}(o);let w;if(y)w=s;else{const ht=s||{};w=ht.index,c=ht.injector,h=ht.projectableNodes,m=ht.environmentInjector||ht.ngModuleRef}const M=y?o:new Ad(An(o)),S=c||this.parentInjector;if(!m&&null==M.ngModule){const _t=(y?S:this.parentInjector).get(cs,null);_t&&(m=_t)}An(M.componentType??{});const Y=M.create(S,h,null,m);return this.insertImpl(Y.hostView,w,false),Y}insert(o,s){return this.insertImpl(o,s,!1)}insertImpl(o,s,c){const h=o._lView;if(function A2(r){return No(r[lr])}(h)){const M=this.indexOf(o);if(-1!==M)this.detach(M);else{const S=h[lr],O=new zT(S,S[bo],S[lr]);O.detach(O.indexOf(o))}}const y=this._adjustIndex(s),w=this._lContainer;return yA(w,h,y,!c),o.attachToViewContainerRef(),Qg(J1(w),y,o),o}move(o,s){return this.insert(o,s)}indexOf(o){const s=BT(this._lContainer);return null!==s?s.indexOf(o):-1}remove(o){const s=this._adjustIndex(o,-1),c=a_(this._lContainer,s);c&&(Ea(J1(this._lContainer),s),nt(c[oe],c))}detach(o){const s=this._adjustIndex(o,-1),c=a_(this._lContainer,s);return c&&null!=Ea(J1(this._lContainer),s)?new Zp(c):null}_adjustIndex(o,s=0){return o??this.length+s}};function BT(r){return r[8]}function J1(r){return r[8]||(r[8]=[])}let jT=function UT(r,o,s,c){if(r[Ts])return;let h;h=8&s.type?Dr(c):function wA(r,o){const s=r[We],c=s.createComment(""),h=Qo(o,r);return G(s,$u(s,h),c,function zE(r,o){return r.nextSibling(o)}(s,h),!1),c}(o,s),r[Ts]=h};const gb=new ae("Application Initializer");let _b=(()=>{class r{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((s,c)=>{this.resolve=s,this.reject=c}),this.appInits=le(gb,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const s=[];for(const h of this.appInits){const m=h();if(Gd(m))s.push(m);else if(Jx(m)){const y=new Promise((w,M)=>{m.subscribe({complete:w,error:M})});s.push(y)}}const c=()=>{this.done=!0,this.resolve()};Promise.all(s).then(()=>{c()}).catch(h=>{this.reject(h)}),0===s.length&&c(),this.initialized=!0}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),oD=(()=>{class r{log(s){console.log(s)}warn(s){console.warn(s)}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();const dc=new ae("LocaleId",{providedIn:"root",factory:()=>le(dc,He.Optional|He.SkipSelf)||function UA(){return typeof $localize<"u"&&$localize.locale||rh}()});let lh=(()=>{class r{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ui(!1)}add(){this.hasPendingTasks.next(!0);const s=this.taskId++;return this.pendingTasks.add(s),s}remove(s){this.pendingTasks.delete(s),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();class GA{constructor(o,s){this.ngModuleFactory=o,this.componentFactories=s}}let vb=(()=>{class r{compileModuleSync(s){return new Ay(s)}compileModuleAsync(s){return Promise.resolve(this.compileModuleSync(s))}compileModuleAndAllComponentsSync(s){const c=this.compileModuleSync(s),m=Ql(xo(s).declarations).reduce((y,w)=>{const M=An(w);return M&&y.push(new Ad(M)),y},[]);return new GA(c,m)}compileModuleAndAllComponentsAsync(s){return Promise.resolve(this.compileModuleAndAllComponentsSync(s))}clearCache(){}clearCacheFor(s){}getModuleId(s){}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const v=new ae(""),x=new ae("");let C,b=(()=>{class r{constructor(s,c,h){this._ngZone=s,this.registry=c,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,C||(function T(r){C=r}(h),h.addToWindow(c)),this._watchAngularEvents(),s.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{hr.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let s=this._callbacks.pop();clearTimeout(s.timeoutId),s.doneCb(this._didWork)}this._didWork=!1});else{let s=this.getPendingTasks();this._callbacks=this._callbacks.filter(c=>!c.updateCb||!c.updateCb(s)||(clearTimeout(c.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(s=>({source:s.source,creationLocation:s.creationLocation,data:s.data})):[]}addCallback(s,c,h){let m=-1;c&&c>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==m),s(this._didWork,this.getPendingTasks())},c)),this._callbacks.push({doneCb:s,timeoutId:m,updateCb:h})}whenStable(s,c,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(s,c,h),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(s){this.registry.registerApplication(s,this)}unregisterApplication(s){this.registry.unregisterApplication(s)}findProviders(s,c,h){return[]}static#t=this.\u0275fac=function(c){return new(c||r)(ye(hr),ye(E),ye(x))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})(),E=(()=>{class r{constructor(){this._applications=new Map}registerApplication(s,c){this._applications.set(s,c)}unregisterApplication(s){this._applications.delete(s)}unregisterAllApplications(){this._applications.clear()}getTestability(s){return this._applications.get(s)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(s,c=!0){return C?.findTestabilityInTree(this,s,c)??null}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})(),D=null;const A=new ae("AllowMultipleToken"),P=new ae("PlatformDestroyListeners"),I=new ae("appBootstrapListener");class z{constructor(o,s){this.name=o,this.token=s}}function Z(r,o,s=[]){const c=`Platform: ${o}`,h=new ae(c);return(m=[])=>{let y=X();if(!y||y.injector.get(A,!1)){const w=[...s,...m,{provide:h,useValue:!0}];r?r(w):function j(r){if(D&&!D.get(A,!1))throw new pt(400,!1);(function L(){!function Fw(r){Lw=r}(()=>{throw new pt(600,!1)})})(),D=r;const o=r.get(rt);(function H(r){r.get(nM,null)?.forEach(s=>s())})(r)}(function et(r=[],o){return qi.create({name:o,providers:[{provide:nx,useValue:"platform"},{provide:P,useValue:new Set([()=>D=null])},...r]})}(w,c))}return function Q(r){const o=X();if(!o)throw new pt(401,!1);return o}()}}function X(){return D?.get(rt)??null}let rt=(()=>{class r{constructor(s){this._injector=s,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(s,c){const h=function ct(r="zone.js",o){return"noop"===r?new mM:"zone.js"===r?new hr(o):r}(c?.ngZone,function ot(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}({eventCoalescing:c?.ngZoneEventCoalescing,runCoalescing:c?.ngZoneRunCoalescing}));return h.run(()=>{const m=function yT(r,o,s){return new Iy(r,o,s)}(s.moduleType,this.injector,function he(r){return[{provide:hr,useFactory:r},{provide:wp,multi:!0,useFactory:()=>{const o=le(Vt,{optional:!0});return()=>o.initialize()}},{provide:Nt,useFactory:zt},{provide:Mx,useFactory:Cx}]}(()=>h)),y=m.injector.get(Kl,null);return h.runOutsideAngular(()=>{const w=h.onError.subscribe({next:M=>{y.handleError(M)}});m.onDestroy(()=>{ut(this._modules,m),w.unsubscribe()})}),function dt(r,o,s){try{const c=s();return Gd(c)?c.catch(h=>{throw o.runOutsideAngular(()=>r.handleError(h)),h}):c}catch(c){throw o.runOutsideAngular(()=>r.handleError(c)),c}}(y,h,()=>{const w=m.injector.get(_b);return w.runInitializers(),w.donePromise.then(()=>(function ih(r){_o(r,"Expected localeId to be defined"),"string"==typeof r&&(_y=r.toLowerCase().replace(/_/g,"-"))}(m.injector.get(dc,rh)||rh),this._moduleDoBootstrap(m),m))})})}bootstrapModule(s,c=[]){const h=gt({},c);return function R(r,o,s){const c=new Ay(s);return Promise.resolve(c)}(0,0,s).then(m=>this.bootstrapModuleFactory(m,h))}_moduleDoBootstrap(s){const c=s.injector.get(at);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(h=>c.bootstrap(h));else{if(!s.instance.ngDoBootstrap)throw new pt(-403,!1);s.instance.ngDoBootstrap(c)}this._modules.push(s)}onDestroy(s){this._destroyListeners.push(s)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new pt(404,!1);this._modules.slice().forEach(c=>c.destroy()),this._destroyListeners.forEach(c=>c());const s=this._injector.get(P,null);s&&(s.forEach(c=>c()),s.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#t=this.\u0275fac=function(c){return new(c||r)(ye(qi))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();function gt(r,o){return Array.isArray(o)?o.reduce(gt,r):{...r,...o}}let at=(()=>{class r{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=le(Nt),this.zoneIsStable=le(Mx),this.componentTypes=[],this.components=[],this.isStable=le(lh).hasPendingTasks.pipe(ro(s=>s?Ft(!1):this.zoneIsStable),function Cf(r,o=Xa){return r=r??dw,ci((s,c)=>{let h,m=!0;s.subscribe(Ar(c,y=>{const w=o(y);(m||!r(h,w))&&(m=!1,h=w,c.next(y))}))})}(),Tn()),this._injector=le(cs)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(s,c){const h=s instanceof aM;if(!this._injector.get(_b).done)throw!h&&function Pc(r){const o=An(r)||Di(r)||vo(r);return null!==o&&o.standalone}(s),new pt(405,!1);let y;y=h?s:this._injector.get(T_).resolveComponentFactory(s),this.componentTypes.push(y.componentType);const w=function N(r){return r.isBoundToModule}(y)?void 0:this._injector.get(au),S=y.create(qi.NULL,[],c||y.selector,w),O=S.location.nativeElement,F=S.injector.get(v,null);return F?.registerApplication(O),S.onDestroy(()=>{this.detachView(S.hostView),ut(this.components,S),F?.unregisterApplication(O)}),this._loadComponent(S),S}tick(){if(this._runningTick)throw new pt(101,!1);try{this._runningTick=!0;for(let s of this._views)s.detectChanges()}catch(s){this.internalErrorHandler(s)}finally{this._runningTick=!1}}attachView(s){const c=s;this._views.push(c),c.attachToAppRef(this)}detachView(s){const c=s;ut(this._views,c),c.detachFromAppRef()}_loadComponent(s){this.attachView(s.hostView),this.tick(),this.components.push(s);const c=this._injector.get(I,[]);c.push(...this._bootstrapListeners),c.forEach(h=>h(s))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(s=>s()),this._views.slice().forEach(s=>s.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(s){return this._destroyListeners.push(s),()=>ut(this._destroyListeners,s)}destroy(){if(this._destroyed)throw new pt(406,!1);const s=this._injector;s.destroy&&!s.destroyed&&s.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function ut(r,o){const s=r.indexOf(o);s>-1&&r.splice(s,1)}const Nt=new ae("",{providedIn:"root",factory:()=>le(Kl).handleError.bind(void 0)});function zt(){const r=le(hr),o=le(Kl);return s=>r.runOutsideAngular(()=>o.handleError(s))}let Vt=(()=>{class r{constructor(){this.zone=le(hr),this.applicationRef=le(at)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();let Ne=(()=>{class r{static#t=this.__NG_ELEMENT_ID__=Ke}return r})();function Ke(r){return function Re(r,o,s){if(kc(r)&&!s){const c=As(r.index,o);return new Zp(c,c)}return 47&r.type?new Zp(o[Pr],o):null}($i(),Ot(),16==(16&r))}const OF=Z(null,"core",[]);let kF=(()=>{class r{constructor(s){}static#t=this.\u0275fac=function(c){return new(c||r)(ye(at))};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({})}return r})();let aP=null;function hf(){return aP}class WF{}const Va=new ae("DocumentToken");let lP=(()=>{class r{historyGo(s){throw new Error("Not implemented")}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:function(){return le(YF)},providedIn:"platform"})}return r})();const XF=new ae("Location Initialized");let YF=(()=>{class r extends lP{constructor(){super(),this._doc=le(Va),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return hf().getBaseHref(this._doc)}onPopState(s){const c=hf().getGlobalEventTarget(this._doc,"window");return c.addEventListener("popstate",s,!1),()=>c.removeEventListener("popstate",s)}onHashChange(s){const c=hf().getGlobalEventTarget(this._doc,"window");return c.addEventListener("hashchange",s,!1),()=>c.removeEventListener("hashchange",s)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(s){this._location.pathname=s}pushState(s,c,h){this._history.pushState(s,c,h)}replaceState(s,c,h){this._history.replaceState(s,c,h)}forward(){this._history.forward()}back(){this._history.back()}historyGo(s=0){this._history.go(s)}getState(){return this._history.state}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:function(){return new r},providedIn:"platform"})}return r})();function cP(r,o){if(0==r.length)return o;if(0==o.length)return r;let s=0;return r.endsWith("/")&&s++,o.startsWith("/")&&s++,2==s?r+o.substring(1):1==s?r+o:r+"/"+o}function qO(r){const o=r.match(/#|\?|$/),s=o&&o.index||r.length;return r.slice(0,s-("/"===r[s-1]?1:0))+r.slice(s)}function dh(r){return r&&"?"!==r[0]?"?"+r:r}let km=(()=>{class r{historyGo(s){throw new Error("Not implemented")}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:function(){return le(WO)},providedIn:"root"})}return r})();const ZO=new ae("appBaseHref");let WO=(()=>{class r extends km{constructor(s,c){super(),this._platformLocation=s,this._removeListenerFns=[],this._baseHref=c??this._platformLocation.getBaseHrefFromDOM()??le(Va).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(s){this._removeListenerFns.push(this._platformLocation.onPopState(s),this._platformLocation.onHashChange(s))}getBaseHref(){return this._baseHref}prepareExternalUrl(s){return cP(this._baseHref,s)}path(s=!1){const c=this._platformLocation.pathname+dh(this._platformLocation.search),h=this._platformLocation.hash;return h&&s?`${c}${h}`:c}pushState(s,c,h,m){const y=this.prepareExternalUrl(h+dh(m));this._platformLocation.pushState(s,c,y)}replaceState(s,c,h,m){const y=this.prepareExternalUrl(h+dh(m));this._platformLocation.replaceState(s,c,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(s=0){this._platformLocation.historyGo?.(s)}static#t=this.\u0275fac=function(c){return new(c||r)(ye(lP),ye(ZO,8))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),JF=(()=>{class r extends km{constructor(s,c){super(),this._platformLocation=s,this._baseHref="",this._removeListenerFns=[],null!=c&&(this._baseHref=c)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(s){this._removeListenerFns.push(this._platformLocation.onPopState(s),this._platformLocation.onHashChange(s))}getBaseHref(){return this._baseHref}path(s=!1){let c=this._platformLocation.hash;return null==c&&(c="#"),c.length>0?c.substring(1):c}prepareExternalUrl(s){const c=cP(this._baseHref,s);return c.length>0?"#"+c:c}pushState(s,c,h,m){let y=this.prepareExternalUrl(h+dh(m));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(s,c,y)}replaceState(s,c,h,m){let y=this.prepareExternalUrl(h+dh(m));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(s,c,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(s=0){this._platformLocation.historyGo?.(s)}static#t=this.\u0275fac=function(c){return new(c||r)(ye(lP),ye(ZO,8))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})(),uP=(()=>{class r{constructor(s){this._subject=new si,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=s;const c=this._locationStrategy.getBaseHref();this._basePath=function tN(r){if(new RegExp("^(https?:)?//").test(r)){const[,s]=r.split(/\/\/[^\/]+/);return s}return r}(qO(XO(c))),this._locationStrategy.onPopState(h=>{this._subject.emit({url:this.path(!0),pop:!0,state:h.state,type:h.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(s=!1){return this.normalize(this._locationStrategy.path(s))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(s,c=""){return this.path()==this.normalize(s+dh(c))}normalize(s){return r.stripTrailingSlash(function QF(r,o){if(!r||!o.startsWith(r))return o;const s=o.substring(r.length);return""===s||["/",";","?","#"].includes(s[0])?s:o}(this._basePath,XO(s)))}prepareExternalUrl(s){return s&&"/"!==s[0]&&(s="/"+s),this._locationStrategy.prepareExternalUrl(s)}go(s,c="",h=null){this._locationStrategy.pushState(h,"",s,c),this._notifyUrlChangeListeners(this.prepareExternalUrl(s+dh(c)),h)}replaceState(s,c="",h=null){this._locationStrategy.replaceState(h,"",s,c),this._notifyUrlChangeListeners(this.prepareExternalUrl(s+dh(c)),h)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(s=0){this._locationStrategy.historyGo?.(s)}onUrlChange(s){return this._urlChangeListeners.push(s),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(c=>{this._notifyUrlChangeListeners(c.url,c.state)})),()=>{const c=this._urlChangeListeners.indexOf(s);this._urlChangeListeners.splice(c,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(s="",c){this._urlChangeListeners.forEach(h=>h(s,c))}subscribe(s,c,h){return this._subject.subscribe({next:s,error:c,complete:h})}static#t=this.normalizeQueryParams=dh;static#e=this.joinWithSlash=cP;static#n=this.stripTrailingSlash=qO;static#r=this.\u0275fac=function(c){return new(c||r)(ye(km))};static#i=this.\u0275prov=Ie({token:r,factory:function(){return function KF(){return new uP(ye(km))}()},providedIn:"root"})}return r})();function XO(r){return r.replace(/\/index.html$/,"")}function ik(r,o){o=encodeURIComponent(o);for(const s of r.split(";")){const c=s.indexOf("="),[h,m]=-1==c?[s,""]:[s.slice(0,c),s.slice(c+1)];if(h.trim()===o)return decodeURIComponent(m)}return null}let pz=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({})}return r})();function dk(r){return"server"===r}let yz=(()=>{class r{static#t=this.\u0275prov=Ie({token:r,providedIn:"root",factory:()=>new vz(ye(Va),window)})}return r})();class vz{constructor(o,s){this.document=o,this.window=s,this.offset=()=>[0,0]}setOffset(o){this.offset=Array.isArray(o)?()=>o:o}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(o){this.supportsScrolling()&&this.window.scrollTo(o[0],o[1])}scrollToAnchor(o){if(!this.supportsScrolling())return;const s=function xz(r,o){const s=r.getElementById(o)||r.getElementsByName(o)[0];if(s)return s;if("function"==typeof r.createTreeWalker&&r.body&&"function"==typeof r.body.attachShadow){const c=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT);let h=c.currentNode;for(;h;){const m=h.shadowRoot;if(m){const y=m.getElementById(o)||m.querySelector(`[name="${o}"]`);if(y)return y}h=c.nextNode()}}return null}(this.document,o);s&&(this.scrollToElement(s),s.focus())}setHistoryScrollRestoration(o){this.supportsScrolling()&&(this.window.history.scrollRestoration=o)}scrollToElement(o){const s=o.getBoundingClientRect(),c=s.left+this.window.pageXOffset,h=s.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(c-m[0],h-m[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class fk{}class $z extends WF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class DP extends $z{static makeCurrent(){!function ZF(r){aP||(aP=r)}(new DP)}onAndCancel(o,s,c){return o.addEventListener(s,c),()=>{o.removeEventListener(s,c)}}dispatchEvent(o,s){o.dispatchEvent(s)}remove(o){o.parentNode&&o.parentNode.removeChild(o)}createElement(o,s){return(s=s||this.getDefaultDocument()).createElement(o)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(o){return o.nodeType===Node.ELEMENT_NODE}isShadowRoot(o){return o instanceof DocumentFragment}getGlobalEventTarget(o,s){return"window"===s?window:"document"===s?o:"body"===s?o.body:null}getBaseHref(o){const s=function Hz(){return Ab=Ab||document.querySelector("base"),Ab?Ab.getAttribute("href"):null}();return null==s?null:function Gz(r){ED=ED||document.createElement("a"),ED.setAttribute("href",r);const o=ED.pathname;return"/"===o.charAt(0)?o:`/${o}`}(s)}resetBaseElement(){Ab=null}getUserAgent(){return window.navigator.userAgent}getCookie(o){return ik(document.cookie,o)}}let ED,Ab=null,Zz=(()=>{class r{build(){return new XMLHttpRequest}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();const SP=new ae("EventManagerPlugins");let yk=(()=>{class r{constructor(s,c){this._zone=c,this._eventNameToPlugin=new Map,s.forEach(h=>{h.manager=this}),this._plugins=s.slice().reverse()}addEventListener(s,c,h){return this._findPluginFor(c).addEventListener(s,c,h)}getZone(){return this._zone}_findPluginFor(s){let c=this._eventNameToPlugin.get(s);if(c)return c;if(c=this._plugins.find(m=>m.supports(s)),!c)throw new pt(5101,!1);return this._eventNameToPlugin.set(s,c),c}static#t=this.\u0275fac=function(c){return new(c||r)(ye(SP),ye(hr))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();class vk{constructor(o){this._doc=o}}const IP="ng-app-id";let xk=(()=>{class r{constructor(s,c,h,m={}){this.doc=s,this.appId=c,this.nonce=h,this.platformId=m,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=dk(m),this.resetHostNodes()}addStyles(s){for(const c of s)1===this.changeUsageCount(c,1)&&this.onStyleAdded(c)}removeStyles(s){for(const c of s)this.changeUsageCount(c,-1)<=0&&this.onStyleRemoved(c)}ngOnDestroy(){const s=this.styleNodesInDOM;s&&(s.forEach(c=>c.remove()),s.clear());for(const c of this.getAllStyles())this.onStyleRemoved(c);this.resetHostNodes()}addHost(s){this.hostNodes.add(s);for(const c of this.getAllStyles())this.addStyleToHost(s,c)}removeHost(s){this.hostNodes.delete(s)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(s){for(const c of this.hostNodes)this.addStyleToHost(c,s)}onStyleRemoved(s){const c=this.styleRef;c.get(s)?.elements?.forEach(h=>h.remove()),c.delete(s)}collectServerRenderedStyles(){const s=this.doc.head?.querySelectorAll(`style[${IP}="${this.appId}"]`);if(s?.length){const c=new Map;return s.forEach(h=>{null!=h.textContent&&c.set(h.textContent,h)}),c}return null}changeUsageCount(s,c){const h=this.styleRef;if(h.has(s)){const m=h.get(s);return m.usage+=c,m.usage}return h.set(s,{usage:c,elements:[]}),c}getStyleElement(s,c){const h=this.styleNodesInDOM,m=h?.get(c);if(m?.parentNode===s)return h.delete(c),m.removeAttribute(IP),m;{const y=this.doc.createElement("style");return this.nonce&&y.setAttribute("nonce",this.nonce),y.textContent=c,this.platformIsServer&&y.setAttribute(IP,this.appId),y}}addStyleToHost(s,c){const h=this.getStyleElement(s,c);s.appendChild(h);const m=this.styleRef,y=m.get(c)?.elements;y?y.push(h):m.set(c,{elements:[h],usage:1})}resetHostNodes(){const s=this.hostNodes;s.clear(),s.add(this.doc.head)}static#t=this.\u0275fac=function(c){return new(c||r)(ye(Va),ye(Dp),ye(rM,8),ye(ml))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();const AP={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},PP=/%COMP%/g,Jz=new ae("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function wk(r,o){return o.map(s=>s.replace(PP,r))}let Ek=(()=>{class r{constructor(s,c,h,m,y,w,M,S=null){this.eventManager=s,this.sharedStylesHost=c,this.appId=h,this.removeStylesOnCompDestroy=m,this.doc=y,this.platformId=w,this.ngZone=M,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=dk(w),this.defaultRenderer=new RP(s,y,M,this.platformIsServer)}createRenderer(s,c){if(!s||!c)return this.defaultRenderer;this.platformIsServer&&c.encapsulation===Lo.ShadowDom&&(c={...c,encapsulation:Lo.Emulated});const h=this.getOrCreateRenderer(s,c);return h instanceof Ck?h.applyToHost(s):h instanceof OP&&h.applyStyles(),h}getOrCreateRenderer(s,c){const h=this.rendererByCompId;let m=h.get(c.id);if(!m){const y=this.doc,w=this.ngZone,M=this.eventManager,S=this.sharedStylesHost,O=this.removeStylesOnCompDestroy,F=this.platformIsServer;switch(c.encapsulation){case Lo.Emulated:m=new Ck(M,S,c,this.appId,O,y,w,F);break;case Lo.ShadowDom:return new eB(M,S,s,c,y,w,this.nonce,F);default:m=new OP(M,S,c,O,y,w,F)}h.set(c.id,m)}return m}ngOnDestroy(){this.rendererByCompId.clear()}static#t=this.\u0275fac=function(c){return new(c||r)(ye(yk),ye(xk),ye(Dp),ye(Jz),ye(Va),ye(ml),ye(hr),ye(rM))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();class RP{constructor(o,s,c,h){this.eventManager=o,this.doc=s,this.ngZone=c,this.platformIsServer=h,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(o,s){return s?this.doc.createElementNS(AP[s]||s,o):this.doc.createElement(o)}createComment(o){return this.doc.createComment(o)}createText(o){return this.doc.createTextNode(o)}appendChild(o,s){(Mk(o)?o.content:o).appendChild(s)}insertBefore(o,s,c){o&&(Mk(o)?o.content:o).insertBefore(s,c)}removeChild(o,s){o&&o.removeChild(s)}selectRootElement(o,s){let c="string"==typeof o?this.doc.querySelector(o):o;if(!c)throw new pt(-5104,!1);return s||(c.textContent=""),c}parentNode(o){return o.parentNode}nextSibling(o){return o.nextSibling}setAttribute(o,s,c,h){if(h){s=h+":"+s;const m=AP[h];m?o.setAttributeNS(m,s,c):o.setAttribute(s,c)}else o.setAttribute(s,c)}removeAttribute(o,s,c){if(c){const h=AP[c];h?o.removeAttributeNS(h,s):o.removeAttribute(`${c}:${s}`)}else o.removeAttribute(s)}addClass(o,s){o.classList.add(s)}removeClass(o,s){o.classList.remove(s)}setStyle(o,s,c,h){h&(Hl.DashCase|Hl.Important)?o.style.setProperty(s,c,h&Hl.Important?"important":""):o.style[s]=c}removeStyle(o,s,c){c&Hl.DashCase?o.style.removeProperty(s):o.style[s]=""}setProperty(o,s,c){o[s]=c}setValue(o,s){o.nodeValue=s}listen(o,s,c){if("string"==typeof o&&!(o=hf().getGlobalEventTarget(this.doc,o)))throw new Error(`Unsupported event target ${o} for event ${s}`);return this.eventManager.addEventListener(o,s,this.decoratePreventDefault(c))}decoratePreventDefault(o){return s=>{if("__ngUnwrap__"===s)return o;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>o(s)):o(s))&&s.preventDefault()}}}function Mk(r){return"TEMPLATE"===r.tagName&&void 0!==r.content}class eB extends RP{constructor(o,s,c,h,m,y,w,M){super(o,m,y,M),this.sharedStylesHost=s,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=wk(h.id,h.styles);for(const O of S){const F=document.createElement("style");w&&F.setAttribute("nonce",w),F.textContent=O,this.shadowRoot.appendChild(F)}}nodeOrShadowRoot(o){return o===this.hostEl?this.shadowRoot:o}appendChild(o,s){return super.appendChild(this.nodeOrShadowRoot(o),s)}insertBefore(o,s,c){return super.insertBefore(this.nodeOrShadowRoot(o),s,c)}removeChild(o,s){return super.removeChild(this.nodeOrShadowRoot(o),s)}parentNode(o){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(o)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class OP extends RP{constructor(o,s,c,h,m,y,w,M){super(o,m,y,w),this.sharedStylesHost=s,this.removeStylesOnCompDestroy=h,this.styles=M?wk(M,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Ck extends OP{constructor(o,s,c,h,m,y,w,M){const S=h+"-"+c.id;super(o,s,c,m,y,w,M,S),this.contentAttr=function Kz(r){return"_ngcontent-%COMP%".replace(PP,r)}(S),this.hostAttr=function Qz(r){return"_nghost-%COMP%".replace(PP,r)}(S)}applyToHost(o){this.applyStyles(),this.setAttribute(o,this.hostAttr,"")}createElement(o,s){const c=super.createElement(o,s);return super.setAttribute(c,this.contentAttr,""),c}}let nB=(()=>{class r extends vk{constructor(s){super(s)}supports(s){return!0}addEventListener(s,c,h){return s.addEventListener(c,h,!1),()=>this.removeEventListener(s,c,h)}removeEventListener(s,c,h){return s.removeEventListener(c,h)}static#t=this.\u0275fac=function(c){return new(c||r)(ye(Va))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();const Tk=["alt","control","meta","shift"],rB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},iB={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey};let oB=(()=>{class r extends vk{constructor(s){super(s)}supports(s){return null!=r.parseEventName(s)}addEventListener(s,c,h){const m=r.parseEventName(c),y=r.eventCallback(m.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>hf().onAndCancel(s,m.domEventName,y))}static parseEventName(s){const c=s.toLowerCase().split("."),h=c.shift();if(0===c.length||"keydown"!==h&&"keyup"!==h)return null;const m=r._normalizeKey(c.pop());let y="",w=c.indexOf("code");if(w>-1&&(c.splice(w,1),y="code."),Tk.forEach(S=>{const O=c.indexOf(S);O>-1&&(c.splice(O,1),y+=S+".")}),y+=m,0!=c.length||0===m.length)return null;const M={};return M.domEventName=h,M.fullKey=y,M}static matchEventFullKeyCode(s,c){let h=rB[s.key]||s.key,m="";return c.indexOf("code.")>-1&&(h=s.code,m="code."),!(null==h||!h)&&(h=h.toLowerCase()," "===h?h="space":"."===h&&(h="dot"),Tk.forEach(y=>{y!==h&&(0,iB[y])(s)&&(m+=y+".")}),m+=h,m===c)}static eventCallback(s,c,h){return m=>{r.matchEventFullKeyCode(m,s)&&h.runGuarded(()=>c(m))}}static _normalizeKey(s){return"esc"===s?"escape":s}static#t=this.\u0275fac=function(c){return new(c||r)(ye(Va))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();const cB=Z(OF,"browser",[{provide:ml,useValue:"browser"},{provide:nM,useValue:function sB(){DP.makeCurrent()},multi:!0},{provide:Va,useFactory:function lB(){return function U0(r){j0=r}(document),document},deps:[]}]),uB=new ae(""),Ik=[{provide:x,useClass:class qz{addToWindow(o){vr.getAngularTestability=(c,h=!0)=>{const m=o.findTestabilityInTree(c,h);if(null==m)throw new pt(5103,!1);return m},vr.getAllAngularTestabilities=()=>o.getAllTestabilities(),vr.getAllAngularRootElements=()=>o.getAllRootElements(),vr.frameworkStabilizers||(vr.frameworkStabilizers=[]),vr.frameworkStabilizers.push(c=>{const h=vr.getAllAngularTestabilities();let m=h.length,y=!1;const w=function(M){y=y||M,m--,0==m&&c(y)};h.forEach(M=>{M.whenStable(w)})})}findTestabilityInTree(o,s,c){return null==s?null:o.getTestability(s)??(c?hf().isShadowRoot(s)?this.findTestabilityInTree(o,s.host,!0):this.findTestabilityInTree(o,s.parentElement,!0):null)}},deps:[]},{provide:v,useClass:b,deps:[hr,E,x]},{provide:b,useClass:b,deps:[hr,E,x]}],Ak=[{provide:nx,useValue:"root"},{provide:Kl,useFactory:function aB(){return new Kl},deps:[]},{provide:SP,useClass:nB,multi:!0,deps:[Va,hr,ml]},{provide:SP,useClass:oB,multi:!0,deps:[Va]},Ek,xk,yk,{provide:cM,useExisting:Ek},{provide:fk,useClass:Zz,deps:[]},[]];let hB=(()=>{class r{constructor(s){}static withServerTransition(s){return{ngModule:r,providers:[{provide:Dp,useValue:s.appId}]}}static#t=this.\u0275fac=function(c){return new(c||r)(ye(uB,12))};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({providers:[...Ak,...Ik],imports:[pz,kF]})}return r})(),Pk=(()=>{class r{constructor(s){this._doc=s}getTitle(){return this._doc.title}setTitle(s){this._doc.title=s||""}static#t=this.\u0275fac=function(c){return new(c||r)(ye(Va))};static#e=this.\u0275prov=Ie({token:r,factory:function(c){let h=null;return h=c?new c:function fB(){return new Pk(ye(Va))}(),h},providedIn:"root"})}return r})();function nv(r,o){return sr(o)?ni(r,o,1):ni(r,1)}function mh(r,o){return ci((s,c)=>{let h=0;s.subscribe(Ar(c,m=>r.call(o,m,h++)&&c.next(m)))})}function Pb(r){return ci((o,s)=>{try{o.subscribe(s)}finally{s.add(r)}})}typeof window<"u"&&window;class MD{}class CD{}class hu{constructor(o){this.normalizedNames=new Map,this.lazyUpdate=null,o?"string"==typeof o?this.lazyInit=()=>{this.headers=new Map,o.split("\n").forEach(s=>{const c=s.indexOf(":");if(c>0){const h=s.slice(0,c),m=h.toLowerCase(),y=s.slice(c+1).trim();this.maybeSetNormalizedName(h,m),this.headers.has(m)?this.headers.get(m).push(y):this.headers.set(m,[y])}})}:typeof Headers<"u"&&o instanceof Headers?(this.headers=new Map,o.forEach((s,c)=>{this.setHeaderEntries(c,s)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(o).forEach(([s,c])=>{this.setHeaderEntries(s,c)})}:this.headers=new Map}has(o){return this.init(),this.headers.has(o.toLowerCase())}get(o){this.init();const s=this.headers.get(o.toLowerCase());return s&&s.length>0?s[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(o){return this.init(),this.headers.get(o.toLowerCase())||null}append(o,s){return this.clone({name:o,value:s,op:"a"})}set(o,s){return this.clone({name:o,value:s,op:"s"})}delete(o,s){return this.clone({name:o,value:s,op:"d"})}maybeSetNormalizedName(o,s){this.normalizedNames.has(s)||this.normalizedNames.set(s,o)}init(){this.lazyInit&&(this.lazyInit instanceof hu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(o=>this.applyUpdate(o)),this.lazyUpdate=null))}copyFrom(o){o.init(),Array.from(o.headers.keys()).forEach(s=>{this.headers.set(s,o.headers.get(s)),this.normalizedNames.set(s,o.normalizedNames.get(s))})}clone(o){const s=new hu;return s.lazyInit=this.lazyInit&&this.lazyInit instanceof hu?this.lazyInit:this,s.lazyUpdate=(this.lazyUpdate||[]).concat([o]),s}applyUpdate(o){const s=o.name.toLowerCase();switch(o.op){case"a":case"s":let c=o.value;if("string"==typeof c&&(c=[c]),0===c.length)return;this.maybeSetNormalizedName(o.name,s);const h=("a"===o.op?this.headers.get(s):void 0)||[];h.push(...c),this.headers.set(s,h);break;case"d":const m=o.value;if(m){let y=this.headers.get(s);if(!y)return;y=y.filter(w=>-1===m.indexOf(w)),0===y.length?(this.headers.delete(s),this.normalizedNames.delete(s)):this.headers.set(s,y)}else this.headers.delete(s),this.normalizedNames.delete(s)}}setHeaderEntries(o,s){const c=(Array.isArray(s)?s:[s]).map(m=>m.toString()),h=o.toLowerCase();this.headers.set(h,c),this.maybeSetNormalizedName(o,h)}forEach(o){this.init(),Array.from(this.normalizedNames.keys()).forEach(s=>o(this.normalizedNames.get(s),this.headers.get(s)))}}class yB{encodeKey(o){return Lk(o)}encodeValue(o){return Lk(o)}decodeKey(o){return decodeURIComponent(o)}decodeValue(o){return decodeURIComponent(o)}}const xB=/%(\d[a-f0-9])/gi,bB={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Lk(r){return encodeURIComponent(r).replace(xB,(o,s)=>bB[s]??o)}function TD(r){return`${r}`}class ff{constructor(o={}){if(this.updates=null,this.cloneFrom=null,this.encoder=o.encoder||new yB,o.fromString){if(o.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function vB(r,o){const s=new Map;return r.length>0&&r.replace(/^\?/,"").split("&").forEach(h=>{const m=h.indexOf("="),[y,w]=-1==m?[o.decodeKey(h),""]:[o.decodeKey(h.slice(0,m)),o.decodeValue(h.slice(m+1))],M=s.get(y)||[];M.push(w),s.set(y,M)}),s}(o.fromString,this.encoder)}else o.fromObject?(this.map=new Map,Object.keys(o.fromObject).forEach(s=>{const c=o.fromObject[s],h=Array.isArray(c)?c.map(TD):[TD(c)];this.map.set(s,h)})):this.map=null}has(o){return this.init(),this.map.has(o)}get(o){this.init();const s=this.map.get(o);return s?s[0]:null}getAll(o){return this.init(),this.map.get(o)||null}keys(){return this.init(),Array.from(this.map.keys())}append(o,s){return this.clone({param:o,value:s,op:"a"})}appendAll(o){const s=[];return Object.keys(o).forEach(c=>{const h=o[c];Array.isArray(h)?h.forEach(m=>{s.push({param:c,value:m,op:"a"})}):s.push({param:c,value:h,op:"a"})}),this.clone(s)}set(o,s){return this.clone({param:o,value:s,op:"s"})}delete(o,s){return this.clone({param:o,value:s,op:"d"})}toString(){return this.init(),this.keys().map(o=>{const s=this.encoder.encodeKey(o);return this.map.get(o).map(c=>s+"="+this.encoder.encodeValue(c)).join("&")}).filter(o=>""!==o).join("&")}clone(o){const s=new ff({encoder:this.encoder});return s.cloneFrom=this.cloneFrom||this,s.updates=(this.updates||[]).concat(o),s}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(o=>this.map.set(o,this.cloneFrom.map.get(o))),this.updates.forEach(o=>{switch(o.op){case"a":case"s":const s=("a"===o.op?this.map.get(o.param):void 0)||[];s.push(TD(o.value)),this.map.set(o.param,s);break;case"d":if(void 0===o.value){this.map.delete(o.param);break}{let c=this.map.get(o.param)||[];const h=c.indexOf(TD(o.value));-1!==h&&c.splice(h,1),c.length>0?this.map.set(o.param,c):this.map.delete(o.param)}}}),this.cloneFrom=this.updates=null)}}class wB{constructor(){this.map=new Map}set(o,s){return this.map.set(o,s),this}get(o){return this.map.has(o)||this.map.set(o,o.defaultValue()),this.map.get(o)}delete(o){return this.map.delete(o),this}has(o){return this.map.has(o)}keys(){return this.map.keys()}}function Fk(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer}function Nk(r){return typeof Blob<"u"&&r instanceof Blob}function zk(r){return typeof FormData<"u"&&r instanceof FormData}class Rb{constructor(o,s,c,h){let m;if(this.url=s,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=o.toUpperCase(),function EB(r){switch(r){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||h?(this.body=void 0!==c?c:null,m=h):m=c,m&&(this.reportProgress=!!m.reportProgress,this.withCredentials=!!m.withCredentials,m.responseType&&(this.responseType=m.responseType),m.headers&&(this.headers=m.headers),m.context&&(this.context=m.context),m.params&&(this.params=m.params)),this.headers||(this.headers=new hu),this.context||(this.context=new wB),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=s;else{const w=s.indexOf("?");this.urlWithParams=s+(-1===w?"?":w<s.length-1?"&":"")+y}}else this.params=new ff,this.urlWithParams=s}serializeBody(){return null===this.body?null:Fk(this.body)||Nk(this.body)||zk(this.body)||function MB(r){return typeof URLSearchParams<"u"&&r instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof ff?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||zk(this.body)?null:Nk(this.body)?this.body.type||null:Fk(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ff?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(o={}){const s=o.method||this.method,c=o.url||this.url,h=o.responseType||this.responseType,m=void 0!==o.body?o.body:this.body,y=void 0!==o.withCredentials?o.withCredentials:this.withCredentials,w=void 0!==o.reportProgress?o.reportProgress:this.reportProgress;let M=o.headers||this.headers,S=o.params||this.params;const O=o.context??this.context;return void 0!==o.setHeaders&&(M=Object.keys(o.setHeaders).reduce((F,$)=>F.set($,o.setHeaders[$]),M)),o.setParams&&(S=Object.keys(o.setParams).reduce((F,$)=>F.set($,o.setParams[$]),S)),new Rb(s,c,m,{params:S,headers:M,context:O,reportProgress:w,responseType:h,withCredentials:y})}}var rv=function(r){return r[r.Sent=0]="Sent",r[r.UploadProgress=1]="UploadProgress",r[r.ResponseHeader=2]="ResponseHeader",r[r.DownloadProgress=3]="DownloadProgress",r[r.Response=4]="Response",r[r.User=5]="User",r}(rv||{});class LP{constructor(o,s=200,c="OK"){this.headers=o.headers||new hu,this.status=void 0!==o.status?o.status:s,this.statusText=o.statusText||c,this.url=o.url||null,this.ok=this.status>=200&&this.status<300}}class FP extends LP{constructor(o={}){super(o),this.type=rv.ResponseHeader}clone(o={}){return new FP({headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class iv extends LP{constructor(o={}){super(o),this.type=rv.Response,this.body=void 0!==o.body?o.body:null}clone(o={}){return new iv({body:void 0!==o.body?o.body:this.body,headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class Bk extends LP{constructor(o){super(o,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${o.url||"(unknown url)"}`:`Http failure response for ${o.url||"(unknown url)"}: ${o.status} ${o.statusText}`,this.error=o.error||null}}function NP(r,o){return{body:o,headers:r.headers,context:r.context,observe:r.observe,params:r.params,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials}}let Vk=(()=>{class r{constructor(s){this.handler=s}request(s,c,h={}){let m;if(s instanceof Rb)m=s;else{let M,S;M=h.headers instanceof hu?h.headers:new hu(h.headers),h.params&&(S=h.params instanceof ff?h.params:new ff({fromObject:h.params})),m=new Rb(s,c,void 0!==h.body?h.body:null,{headers:M,context:h.context,params:S,reportProgress:h.reportProgress,responseType:h.responseType||"json",withCredentials:h.withCredentials})}const y=Ft(m).pipe(nv(M=>this.handler.handle(M)));if(s instanceof Rb||"events"===h.observe)return y;const w=y.pipe(mh(M=>M instanceof iv));switch(h.observe||"body"){case"body":switch(m.responseType){case"arraybuffer":return w.pipe(On(M=>{if(null!==M.body&&!(M.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return M.body}));case"blob":return w.pipe(On(M=>{if(null!==M.body&&!(M.body instanceof Blob))throw new Error("Response is not a Blob.");return M.body}));case"text":return w.pipe(On(M=>{if(null!==M.body&&"string"!=typeof M.body)throw new Error("Response is not a string.");return M.body}));default:return w.pipe(On(M=>M.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${h.observe}}`)}}delete(s,c={}){return this.request("DELETE",s,c)}get(s,c={}){return this.request("GET",s,c)}head(s,c={}){return this.request("HEAD",s,c)}jsonp(s,c){return this.request("JSONP",s,{params:(new ff).append(c,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(s,c={}){return this.request("OPTIONS",s,c)}patch(s,c,h={}){return this.request("PATCH",s,NP(h,c))}post(s,c,h={}){return this.request("POST",s,NP(h,c))}put(s,c,h={}){return this.request("PUT",s,NP(h,c))}static#t=this.\u0275fac=function(c){return new(c||r)(ye(MD))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();function $k(r,o){return o(r)}function TB(r,o){return(s,c)=>o.intercept(s,{handle:h=>r(h,c)})}const SB=new ae(""),Ob=new ae(""),Hk=new ae("");function IB(){let r=null;return(o,s)=>{null===r&&(r=(le(SB,{optional:!0})??[]).reduceRight(TB,$k));const c=le(lh),h=c.add();return r(o,s).pipe(Pb(()=>c.remove(h)))}}let Gk=(()=>{class r extends MD{constructor(s,c){super(),this.backend=s,this.injector=c,this.chain=null,this.pendingTasks=le(lh)}handle(s){if(null===this.chain){const h=Array.from(new Set([...this.injector.get(Ob),...this.injector.get(Hk,[])]));this.chain=h.reduceRight((m,y)=>function DB(r,o,s){return(c,h)=>s.runInContext(()=>o(c,m=>r(m,h)))}(m,y,this.injector),$k)}const c=this.pendingTasks.add();return this.chain(s,h=>this.backend.handle(h)).pipe(Pb(()=>this.pendingTasks.remove(c)))}static#t=this.\u0275fac=function(c){return new(c||r)(ye(CD),ye(cs))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();const OB=/^\)\]\}',?\n/;let Zk=(()=>{class r{constructor(s){this.xhrFactory=s}handle(s){if("JSONP"===s.method)throw new pt(-2800,!1);const c=this.xhrFactory;return(c.\u0275loadImpl?hi(c.\u0275loadImpl()):Ft(null)).pipe(ro(()=>new Un(m=>{const y=c.build();if(y.open(s.method,s.urlWithParams),s.withCredentials&&(y.withCredentials=!0),s.headers.forEach((ht,_t)=>y.setRequestHeader(ht,_t.join(","))),s.headers.has("Accept")||y.setRequestHeader("Accept","application/json, text/plain, */*"),!s.headers.has("Content-Type")){const ht=s.detectContentTypeHeader();null!==ht&&y.setRequestHeader("Content-Type",ht)}if(s.responseType){const ht=s.responseType.toLowerCase();y.responseType="json"!==ht?ht:"text"}const w=s.serializeBody();let M=null;const S=()=>{if(null!==M)return M;const ht=y.statusText||"OK",_t=new hu(y.getAllResponseHeaders()),bt=function kB(r){return"responseURL"in r&&r.responseURL?r.responseURL:/^X-Request-URL:/m.test(r.getAllResponseHeaders())?r.getResponseHeader("X-Request-URL"):null}(y)||s.url;return M=new FP({headers:_t,status:y.status,statusText:ht,url:bt}),M},O=()=>{let{headers:ht,status:_t,statusText:bt,url:mt}=S(),Ut=null;204!==_t&&(Ut=typeof y.response>"u"?y.responseText:y.response),0===_t&&(_t=Ut?200:0);let Qt=_t>=200&&_t<300;if("json"===s.responseType&&"string"==typeof Ut){const de=Ut;Ut=Ut.replace(OB,"");try{Ut=""!==Ut?JSON.parse(Ut):null}catch(fe){Ut=de,Qt&&(Qt=!1,Ut={error:fe,text:Ut})}}Qt?(m.next(new iv({body:Ut,headers:ht,status:_t,statusText:bt,url:mt||void 0})),m.complete()):m.error(new Bk({error:Ut,headers:ht,status:_t,statusText:bt,url:mt||void 0}))},F=ht=>{const{url:_t}=S(),bt=new Bk({error:ht,status:y.status||0,statusText:y.statusText||"Unknown Error",url:_t||void 0});m.error(bt)};let $=!1;const Y=ht=>{$||(m.next(S()),$=!0);let _t={type:rv.DownloadProgress,loaded:ht.loaded};ht.lengthComputable&&(_t.total=ht.total),"text"===s.responseType&&y.responseText&&(_t.partialText=y.responseText),m.next(_t)},st=ht=>{let _t={type:rv.UploadProgress,loaded:ht.loaded};ht.lengthComputable&&(_t.total=ht.total),m.next(_t)};return y.addEventListener("load",O),y.addEventListener("error",F),y.addEventListener("timeout",F),y.addEventListener("abort",F),s.reportProgress&&(y.addEventListener("progress",Y),null!==w&&y.upload&&y.upload.addEventListener("progress",st)),y.send(w),m.next({type:rv.Sent}),()=>{y.removeEventListener("error",F),y.removeEventListener("abort",F),y.removeEventListener("load",O),y.removeEventListener("timeout",F),s.reportProgress&&(y.removeEventListener("progress",Y),null!==w&&y.upload&&y.upload.removeEventListener("progress",st)),y.readyState!==y.DONE&&y.abort()}})))}static#t=this.\u0275fac=function(c){return new(c||r)(ye(fk))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();const zP=new ae("XSRF_ENABLED"),Wk=new ae("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Xk=new ae("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class Yk{}let NB=(()=>{class r{constructor(s,c,h){this.doc=s,this.platform=c,this.cookieName=h,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const s=this.doc.cookie||"";return s!==this.lastCookieString&&(this.parseCount++,this.lastToken=ik(s,this.cookieName),this.lastCookieString=s),this.lastToken}static#t=this.\u0275fac=function(c){return new(c||r)(ye(Va),ye(ml),ye(Wk))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();function zB(r,o){const s=r.url.toLowerCase();if(!le(zP)||"GET"===r.method||"HEAD"===r.method||s.startsWith("http://")||s.startsWith("https://"))return o(r);const c=le(Yk).getToken(),h=le(Xk);return null!=c&&!r.headers.has(h)&&(r=r.clone({headers:r.headers.set(h,c)})),o(r)}var pf=function(r){return r[r.Interceptors=0]="Interceptors",r[r.LegacyInterceptors=1]="LegacyInterceptors",r[r.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",r[r.NoXsrfProtection=3]="NoXsrfProtection",r[r.JsonpSupport=4]="JsonpSupport",r[r.RequestsMadeViaParent=5]="RequestsMadeViaParent",r[r.Fetch=6]="Fetch",r}(pf||{});function BB(...r){const o=[Vk,Zk,Gk,{provide:MD,useExisting:Gk},{provide:CD,useExisting:Zk},{provide:Ob,useValue:zB,multi:!0},{provide:zP,useValue:!0},{provide:Yk,useClass:NB}];for(const s of r)o.push(...s.\u0275providers);return function J0(r){return{\u0275providers:r}}(o)}const Jk=new ae("LEGACY_INTERCEPTOR_FN");function VB(){return function Lm(r,o){return{\u0275kind:r,\u0275providers:o}}(pf.LegacyInterceptors,[{provide:Jk,useFactory:IB},{provide:Ob,useExisting:Jk,multi:!0}])}let jB=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({providers:[BB(VB())]})}return r})();const{isArray:ZB}=Array,{getPrototypeOf:WB,prototype:XB,keys:YB}=Object;function Kk(r){if(1===r.length){const o=r[0];if(ZB(o))return{args:o,keys:null};if(function JB(r){return r&&"object"==typeof r&&WB(r)===XB}(o)){const s=YB(o);return{args:s.map(c=>o[c]),keys:s}}}return{args:r,keys:null}}const{isArray:KB}=Array;function Qk(r){return On(o=>function QB(r,o){return KB(o)?r(...o):r(o)}(r,o))}function tL(r,o){return r.reduce((s,c,h)=>(s[c]=o[h],s),{})}let eL=(()=>{class r{constructor(s,c){this._renderer=s,this._elementRef=c,this.onChange=h=>{},this.onTouched=()=>{}}setProperty(s,c){this._renderer.setProperty(this._elementRef.nativeElement,s,c)}registerOnTouched(s){this.onTouched=s}registerOnChange(s){this.onChange=s}setDisabledState(s){this.setProperty("disabled",s)}static#t=this.\u0275fac=function(c){return new(c||r)(jt(Jl),jt(us))};static#e=this.\u0275dir=je({type:r})}return r})(),Fm=(()=>{class r extends eL{static#t=this.\u0275fac=function(){let s;return function(h){return(s||(s=ii(r)))(h||r)}}();static#e=this.\u0275dir=je({type:r,features:[Jn]})}return r})();const du=new ae("NgValueAccessor"),n4={provide:du,useExisting:ar(()=>BP),multi:!0},i4=new ae("CompositionEventMode");let BP=(()=>{class r extends eL{constructor(s,c,h){super(s,c),this._compositionMode=h,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function r4(){const r=hf()?hf().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}())}writeValue(s){this.setProperty("value",s??"")}_handleInput(s){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(s)}_compositionStart(){this._composing=!0}_compositionEnd(s){this._composing=!1,this._compositionMode&&this.onChange(s)}static#t=this.\u0275fac=function(c){return new(c||r)(jt(Jl),jt(us),jt(i4,8))};static#e=this.\u0275dir=je({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(c,h){1&c&&Uo("input",function(y){return h._handleInput(y.target.value)})("blur",function(){return h.onTouched()})("compositionstart",function(){return h._compositionStart()})("compositionend",function(y){return h._compositionEnd(y.target.value)})},features:[Br([n4]),Jn]})}return r})();const gs=new ae("NgValidators"),gf=new ae("NgAsyncValidators");function dL(r){return null!=r}function fL(r){return Gd(r)?hi(r):r}function pL(r){let o={};return r.forEach(s=>{o=null!=s?{...o,...s}:o}),0===Object.keys(o).length?null:o}function mL(r,o){return o.map(s=>s(r))}function gL(r){return r.map(o=>function s4(r){return!r.validate}(o)?o:s=>o.validate(s))}function VP(r){return null!=r?function _L(r){if(!r)return null;const o=r.filter(dL);return 0==o.length?null:function(s){return pL(mL(s,o))}}(gL(r)):null}function jP(r){return null!=r?function yL(r){if(!r)return null;const o=r.filter(dL);return 0==o.length?null:function(s){return function t4(...r){const o=lw(r),{args:s,keys:c}=Kk(r),h=new Un(m=>{const{length:y}=s;if(!y)return void m.complete();const w=new Array(y);let M=y,S=y;for(let O=0;O<y;O++){let F=!1;fn(s[O]).subscribe(Ar(m,$=>{F||(F=!0,S--),w[O]=$},()=>M--,void 0,()=>{(!M||!F)&&(S||m.next(c?tL(c,w):w),m.complete())}))}});return o?h.pipe(Qk(o)):h}(mL(s,o).map(fL)).pipe(On(pL))}}(gL(r)):null}function vL(r,o){return null===r?[o]:Array.isArray(r)?[...r,o]:[r,o]}function UP(r){return r?Array.isArray(r)?r:[r]:[]}function ID(r,o){return Array.isArray(r)?r.includes(o):r===o}function wL(r,o){const s=UP(o);return UP(r).forEach(h=>{ID(s,h)||s.push(h)}),s}function EL(r,o){return UP(o).filter(s=>!ID(r,s))}class ML{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(o){this._rawValidators=o||[],this._composedValidatorFn=VP(this._rawValidators)}_setAsyncValidators(o){this._rawAsyncValidators=o||[],this._composedAsyncValidatorFn=jP(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(o){this._onDestroyCallbacks.push(o)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(o=>o()),this._onDestroyCallbacks=[]}reset(o=void 0){this.control&&this.control.reset(o)}hasError(o,s){return!!this.control&&this.control.hasError(o,s)}getError(o,s){return this.control?this.control.getError(o,s):null}}class js extends ML{get formDirective(){return null}get path(){return null}}class _f extends ML{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class CL{constructor(o){this._cd=o}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let TL=(()=>{class r extends CL{constructor(s){super(s)}static#t=this.\u0275fac=function(c){return new(c||r)(jt(_f,2))};static#e=this.\u0275dir=je({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(c,h){2&c&&eu("ng-untouched",h.isUntouched)("ng-touched",h.isTouched)("ng-pristine",h.isPristine)("ng-dirty",h.isDirty)("ng-valid",h.isValid)("ng-invalid",h.isInvalid)("ng-pending",h.isPending)},features:[Jn]})}return r})();const kb="VALID",PD="INVALID",ov="PENDING",Lb="DISABLED";function RD(r){return null!=r&&!Array.isArray(r)&&"object"==typeof r}class AL{constructor(o,s){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(o),this._assignAsyncValidators(s)}get validator(){return this._composedValidatorFn}set validator(o){this._rawValidators=this._composedValidatorFn=o}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(o){this._rawAsyncValidators=this._composedAsyncValidatorFn=o}get parent(){return this._parent}get valid(){return this.status===kb}get invalid(){return this.status===PD}get pending(){return this.status==ov}get disabled(){return this.status===Lb}get enabled(){return this.status!==Lb}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(o){this._assignValidators(o)}setAsyncValidators(o){this._assignAsyncValidators(o)}addValidators(o){this.setValidators(wL(o,this._rawValidators))}addAsyncValidators(o){this.setAsyncValidators(wL(o,this._rawAsyncValidators))}removeValidators(o){this.setValidators(EL(o,this._rawValidators))}removeAsyncValidators(o){this.setAsyncValidators(EL(o,this._rawAsyncValidators))}hasValidator(o){return ID(this._rawValidators,o)}hasAsyncValidator(o){return ID(this._rawAsyncValidators,o)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(o={}){this.touched=!0,this._parent&&!o.onlySelf&&this._parent.markAsTouched(o)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(o=>o.markAllAsTouched())}markAsUntouched(o={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(s=>{s.markAsUntouched({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}markAsDirty(o={}){this.pristine=!1,this._parent&&!o.onlySelf&&this._parent.markAsDirty(o)}markAsPristine(o={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(s=>{s.markAsPristine({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}markAsPending(o={}){this.status=ov,!1!==o.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!o.onlySelf&&this._parent.markAsPending(o)}disable(o={}){const s=this._parentMarkedDirty(o.onlySelf);this.status=Lb,this.errors=null,this._forEachChild(c=>{c.disable({...o,onlySelf:!0})}),this._updateValue(),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...o,skipPristineCheck:s}),this._onDisabledChange.forEach(c=>c(!0))}enable(o={}){const s=this._parentMarkedDirty(o.onlySelf);this.status=kb,this._forEachChild(c=>{c.enable({...o,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent}),this._updateAncestors({...o,skipPristineCheck:s}),this._onDisabledChange.forEach(c=>c(!1))}_updateAncestors(o){this._parent&&!o.onlySelf&&(this._parent.updateValueAndValidity(o),o.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(o){this._parent=o}getRawValue(){return this.value}updateValueAndValidity(o={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===kb||this.status===ov)&&this._runAsyncValidator(o.emitEvent)),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!o.onlySelf&&this._parent.updateValueAndValidity(o)}_updateTreeValidity(o={emitEvent:!0}){this._forEachChild(s=>s._updateTreeValidity(o)),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Lb:kb}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(o){if(this.asyncValidator){this.status=ov,this._hasOwnPendingAsyncValidator=!0;const s=fL(this.asyncValidator(this));this._asyncValidationSubscription=s.subscribe(c=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(c,{emitEvent:o})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(o,s={}){this.errors=o,this._updateControlsErrors(!1!==s.emitEvent)}get(o){let s=o;return null==s||(Array.isArray(s)||(s=s.split(".")),0===s.length)?null:s.reduce((c,h)=>c&&c._find(h),this)}getError(o,s){const c=s?this.get(s):this;return c&&c.errors?c.errors[o]:null}hasError(o,s){return!!this.getError(o,s)}get root(){let o=this;for(;o._parent;)o=o._parent;return o}_updateControlsErrors(o){this.status=this._calculateStatus(),o&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(o)}_initObservables(){this.valueChanges=new si,this.statusChanges=new si}_calculateStatus(){return this._allControlsDisabled()?Lb:this.errors?PD:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ov)?ov:this._anyControlsHaveStatus(PD)?PD:kb}_anyControlsHaveStatus(o){return this._anyControls(s=>s.status===o)}_anyControlsDirty(){return this._anyControls(o=>o.dirty)}_anyControlsTouched(){return this._anyControls(o=>o.touched)}_updatePristine(o={}){this.pristine=!this._anyControlsDirty(),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}_updateTouched(o={}){this.touched=this._anyControlsTouched(),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}_registerOnCollectionChange(o){this._onCollectionChange=o}_setUpdateStrategy(o){RD(o)&&null!=o.updateOn&&(this._updateOn=o.updateOn)}_parentMarkedDirty(o){return!o&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(o){return null}_assignValidators(o){this._rawValidators=Array.isArray(o)?o.slice():o,this._composedValidatorFn=function h4(r){return Array.isArray(r)?VP(r):r||null}(this._rawValidators)}_assignAsyncValidators(o){this._rawAsyncValidators=Array.isArray(o)?o.slice():o,this._composedAsyncValidatorFn=function d4(r){return Array.isArray(r)?jP(r):r||null}(this._rawAsyncValidators)}}const sv=new ae("CallSetDisabledState",{providedIn:"root",factory:()=>OD}),OD="always";function Fb(r,o,s=OD){(function WP(r,o){const s=function xL(r){return r._rawValidators}(r);null!==o.validator?r.setValidators(vL(s,o.validator)):"function"==typeof s&&r.setValidators([s]);const c=function bL(r){return r._rawAsyncValidators}(r);null!==o.asyncValidator?r.setAsyncValidators(vL(c,o.asyncValidator)):"function"==typeof c&&r.setAsyncValidators([c]);const h=()=>r.updateValueAndValidity();FD(o._rawValidators,h),FD(o._rawAsyncValidators,h)})(r,o),o.valueAccessor.writeValue(r.value),(r.disabled||"always"===s)&&o.valueAccessor.setDisabledState?.(r.disabled),function m4(r,o){o.valueAccessor.registerOnChange(s=>{r._pendingValue=s,r._pendingChange=!0,r._pendingDirty=!0,"change"===r.updateOn&&PL(r,o)})}(r,o),function _4(r,o){const s=(c,h)=>{o.valueAccessor.writeValue(c),h&&o.viewToModelUpdate(c)};r.registerOnChange(s),o._registerOnDestroy(()=>{r._unregisterOnChange(s)})}(r,o),function g4(r,o){o.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,"blur"===r.updateOn&&r._pendingChange&&PL(r,o),"submit"!==r.updateOn&&r.markAsTouched()})}(r,o),function p4(r,o){if(o.valueAccessor.setDisabledState){const s=c=>{o.valueAccessor.setDisabledState(c)};r.registerOnDisabledChange(s),o._registerOnDestroy(()=>{r._unregisterOnDisabledChange(s)})}}(r,o)}function FD(r,o){r.forEach(s=>{s.registerOnValidatorChange&&s.registerOnValidatorChange(o)})}function PL(r,o){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),o.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function kL(r,o){const s=r.indexOf(o);s>-1&&r.splice(s,1)}function LL(r){return"object"==typeof r&&null!==r&&2===Object.keys(r).length&&"value"in r&&"disabled"in r}const FL=class extends AL{constructor(o=null,s,c){super(function GP(r){return(RD(r)?r.validators:r)||null}(s),function qP(r,o){return(RD(o)?o.asyncValidators:r)||null}(c,s)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(o),this._setUpdateStrategy(s),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),RD(s)&&(s.nonNullable||s.initialValueIsDefault)&&(this.defaultValue=LL(o)?o.value:o)}setValue(o,s={}){this.value=this._pendingValue=o,this._onChange.length&&!1!==s.emitModelToViewChange&&this._onChange.forEach(c=>c(this.value,!1!==s.emitViewToModelChange)),this.updateValueAndValidity(s)}patchValue(o,s={}){this.setValue(o,s)}reset(o=this.defaultValue,s={}){this._applyFormState(o),this.markAsPristine(s),this.markAsUntouched(s),this.setValue(this.value,s),this._pendingChange=!1}_updateValue(){}_anyControls(o){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(o){this._onChange.push(o)}_unregisterOnChange(o){kL(this._onChange,o)}registerOnDisabledChange(o){this._onDisabledChange.push(o)}_unregisterOnDisabledChange(o){kL(this._onDisabledChange,o)}_forEachChild(o){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(o){LL(o)?(this.value=this._pendingValue=o.value,o.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=o}},C4={provide:_f,useExisting:ar(()=>QP)},BL=(()=>Promise.resolve())();let QP=(()=>{class r extends _f{constructor(s,c,h,m,y,w){super(),this._changeDetectorRef=y,this.callSetDisabledState=w,this.control=new FL,this._registered=!1,this.name="",this.update=new si,this._parent=s,this._setValidators(c),this._setAsyncValidators(h),this.valueAccessor=function JP(r,o){if(!o)return null;let s,c,h;return Array.isArray(o),o.forEach(m=>{m.constructor===BP?s=m:function x4(r){return Object.getPrototypeOf(r.constructor)===Fm}(m)?c=m:h=m}),h||c||s||null}(0,m)}ngOnChanges(s){if(this._checkForErrors(),!this._registered||"name"in s){if(this._registered&&(this._checkName(),this.formDirective)){const c=s.name.previousValue;this.formDirective.removeControl({name:c,path:this._getPath(c)})}this._setUpControl()}"isDisabled"in s&&this._updateDisabled(s),function YP(r,o){if(!r.hasOwnProperty("model"))return!1;const s=r.model;return!!s.isFirstChange()||!Object.is(o,s.currentValue)}(s,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(s){this.viewModel=s,this.update.emit(s)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Fb(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(s){BL.then(()=>{this.control.setValue(s,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(s){const c=s.isDisabled.currentValue,h=0!==c&&function tv(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}(c);BL.then(()=>{h&&!this.control.disabled?this.control.disable():!h&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(s){return this._parent?function kD(r,o){return[...o.path,r]}(s,this._parent):[s]}static#t=this.\u0275fac=function(c){return new(c||r)(jt(js,9),jt(gs,10),jt(gf,10),jt(du,10),jt(Ne,8),jt(sv,8))};static#e=this.\u0275dir=je({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Br([C4]),Jn,Is]})}return r})(),jL=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({})}return r})();const F4={provide:du,useExisting:ar(()=>zD),multi:!0};function WL(r,o){return null==r?`${o}`:(o&&"object"==typeof o&&(o="Object"),`${r}: ${o}`.slice(0,50))}let zD=(()=>{class r extends Fm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(s){this._compareWith=s}writeValue(s){this.value=s;const h=WL(this._getOptionId(s),s);this.setProperty("value",h)}registerOnChange(s){this.onChange=c=>{this.value=this._getOptionValue(c),s(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(s){for(const c of this._optionMap.keys())if(this._compareWith(this._optionMap.get(c),s))return c;return null}_getOptionValue(s){const c=function N4(r){return r.split(":")[0]}(s);return this._optionMap.has(c)?this._optionMap.get(c):s}static#t=this.\u0275fac=function(){let s;return function(h){return(s||(s=ii(r)))(h||r)}}();static#e=this.\u0275dir=je({type:r,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(c,h){1&c&&Uo("change",function(y){return h.onChange(y.target.value)})("blur",function(){return h.onTouched()})},inputs:{compareWith:"compareWith"},features:[Br([F4]),Jn]})}return r})(),XL=(()=>{class r{constructor(s,c,h){this._element=s,this._renderer=c,this._select=h,this._select&&(this.id=this._select._registerOption())}set ngValue(s){null!=this._select&&(this._select._optionMap.set(this.id,s),this._setElementValue(WL(this.id,s)),this._select.writeValue(this._select.value))}set value(s){this._setElementValue(s),this._select&&this._select.writeValue(this._select.value)}_setElementValue(s){this._renderer.setProperty(this._element.nativeElement,"value",s)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#t=this.\u0275fac=function(c){return new(c||r)(jt(us),jt(Jl),jt(zD,9))};static#e=this.\u0275dir=je({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return r})();const z4={provide:du,useExisting:ar(()=>rR),multi:!0};function YL(r,o){return null==r?`${o}`:("string"==typeof o&&(o=`'${o}'`),o&&"object"==typeof o&&(o="Object"),`${r}: ${o}`.slice(0,50))}let rR=(()=>{class r extends Fm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(s){this._compareWith=s}writeValue(s){let c;if(this.value=s,Array.isArray(s)){const h=s.map(m=>this._getOptionId(m));c=(m,y)=>{m._setSelected(h.indexOf(y.toString())>-1)}}else c=(h,m)=>{h._setSelected(!1)};this._optionMap.forEach(c)}registerOnChange(s){this.onChange=c=>{const h=[],m=c.selectedOptions;if(void 0!==m){const y=m;for(let w=0;w<y.length;w++){const S=this._getOptionValue(y[w].value);h.push(S)}}else{const y=c.options;for(let w=0;w<y.length;w++){const M=y[w];if(M.selected){const S=this._getOptionValue(M.value);h.push(S)}}}this.value=h,s(h)}}_registerOption(s){const c=(this._idCounter++).toString();return this._optionMap.set(c,s),c}_getOptionId(s){for(const c of this._optionMap.keys())if(this._compareWith(this._optionMap.get(c)._value,s))return c;return null}_getOptionValue(s){const c=function B4(r){return r.split(":")[0]}(s);return this._optionMap.has(c)?this._optionMap.get(c)._value:s}static#t=this.\u0275fac=function(){let s;return function(h){return(s||(s=ii(r)))(h||r)}}();static#e=this.\u0275dir=je({type:r,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(c,h){1&c&&Uo("change",function(y){return h.onChange(y.target)})("blur",function(){return h.onTouched()})},inputs:{compareWith:"compareWith"},features:[Br([z4]),Jn]})}return r})(),JL=(()=>{class r{constructor(s,c,h){this._element=s,this._renderer=c,this._select=h,this._select&&(this.id=this._select._registerOption(this))}set ngValue(s){null!=this._select&&(this._value=s,this._setElementValue(YL(this.id,s)),this._select.writeValue(this._select.value))}set value(s){this._select?(this._value=s,this._setElementValue(YL(this.id,s)),this._select.writeValue(this._select.value)):this._setElementValue(s)}_setElementValue(s){this._renderer.setProperty(this._element.nativeElement,"value",s)}_setSelected(s){this._renderer.setProperty(this._element.nativeElement,"selected",s)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#t=this.\u0275fac=function(c){return new(c||r)(jt(us),jt(Jl),jt(rR,9))};static#e=this.\u0275dir=je({type:r,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return r})(),W4=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({imports:[jL]})}return r})(),Y4=(()=>{class r{static withConfig(s){return{ngModule:r,providers:[{provide:sv,useValue:s.callSetDisabledState??OD}]}}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({imports:[W4]})}return r})();function oR(...r){const o=Sc(r),s=lw(r),{args:c,keys:h}=Kk(r);if(0===c.length)return hi([],o);const m=new Un(function K4(r,o,s=Xa){return c=>{a3(o,()=>{const{length:h}=r,m=new Array(h);let y=h,w=h;for(let M=0;M<h;M++)a3(o,()=>{const S=hi(r[M],o);let O=!1;S.subscribe(Ar(c,F=>{m[M]=F,O||(O=!0,w--),w||c.next(s(m.slice()))},()=>{--y||c.complete()}))},c)},c)}}(c,o,h?y=>tL(h,y):Xa));return s?m.pipe(Qk(s)):m}function a3(r,o,s){r?Xo(s,r,o):o()}const BD=wf(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function sR(...r){return function Q4(){return Dc(1)}()(hi(r,Sc(r)))}function l3(r){return new Un(o=>{fn(r()).subscribe(o)})}function zb(r,o){const s=sr(r)?r:()=>r,c=h=>h.error(s());return new Un(o?h=>o.schedule(c,0,h):c)}function aR(){return ci((r,o)=>{let s=null;r._refCount++;const c=Ar(o,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount)return void(s=null);const h=r._connection,m=s;s=null,h&&(!m||h===m)&&h.unsubscribe(),o.unsubscribe()});r.subscribe(c),c.closed||(s=r.connect())})}class c3 extends Un{constructor(o,s){super(),this.source=o,this.subjectFactory=s,this._subject=null,this._refCount=0,this._connection=null,Ro(o)&&(this.lift=o.lift)}_subscribe(o){return this.getSubject().subscribe(o)}getSubject(){const o=this._subject;return(!o||o.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:o}=this;this._subject=this._connection=null,o?.unsubscribe()}connect(){let o=this._connection;if(!o){o=this._connection=new it;const s=this.getSubject();o.add(this.source.subscribe(Ar(s,void 0,()=>{this._teardown(),s.complete()},c=>{this._teardown(),s.error(c)},()=>this._teardown()))),o.closed&&(this._connection=null,o=it.EMPTY)}return o}refCount(){return aR()(this)}}function av(r){return r<=0?()=>ha:ci((o,s)=>{let c=0;o.subscribe(Ar(s,h=>{++c<=r&&(s.next(h),r<=c&&s.complete())}))})}function VD(r){return ci((o,s)=>{let c=!1;o.subscribe(Ar(s,h=>{c=!0,s.next(h)},()=>{c||s.next(r),s.complete()}))})}function u3(r=e5){return ci((o,s)=>{let c=!1;o.subscribe(Ar(s,h=>{c=!0,s.next(h)},()=>c?s.complete():s.error(r())))})}function e5(){return new BD}function zm(r,o){const s=arguments.length>=2;return c=>c.pipe(r?mh((h,m)=>r(h,m,c)):Xa,av(1),s?VD(o):u3(()=>new BD))}function _s(r,o,s){const c=sr(r)||o||s?{next:r,error:o,complete:s}:r;return c?ci((h,m)=>{var y;null===(y=c.subscribe)||void 0===y||y.call(c);let w=!0;h.subscribe(Ar(m,M=>{var S;null===(S=c.next)||void 0===S||S.call(c,M),m.next(M)},()=>{var M;w=!1,null===(M=c.complete)||void 0===M||M.call(c),m.complete()},M=>{var S;w=!1,null===(S=c.error)||void 0===S||S.call(c,M),m.error(M)},()=>{var M,S;w&&(null===(M=c.unsubscribe)||void 0===M||M.call(c)),null===(S=c.finalize)||void 0===S||S.call(c)}))}):Xa}function Bm(r){return ci((o,s)=>{let m,c=null,h=!1;c=o.subscribe(Ar(s,void 0,void 0,y=>{m=fn(r(y,Bm(r)(o))),c?(c.unsubscribe(),c=null,m.subscribe(s)):h=!0})),h&&(c.unsubscribe(),c=null,m.subscribe(s))})}function lR(r){return r<=0?()=>ha:ci((o,s)=>{let c=[];o.subscribe(Ar(s,h=>{c.push(h),r<c.length&&c.shift()},()=>{for(const h of c)s.next(h);s.complete()},void 0,()=>{c=null}))})}const pn="primary",Bb=Symbol("RouteTitle");class a5{constructor(o){this.params=o||{}}has(o){return Object.prototype.hasOwnProperty.call(this.params,o)}get(o){if(this.has(o)){const s=this.params[o];return Array.isArray(s)?s[0]:s}return null}getAll(o){if(this.has(o)){const s=this.params[o];return Array.isArray(s)?s:[s]}return[]}get keys(){return Object.keys(this.params)}}function lv(r){return new a5(r)}function l5(r,o,s){const c=s.path.split("/");if(c.length>r.length||"full"===s.pathMatch&&(o.hasChildren()||c.length<r.length))return null;const h={};for(let m=0;m<c.length;m++){const y=c[m],w=r[m];if(y.startsWith(":"))h[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:r.slice(0,c.length),posParams:h}}function fu(r,o){const s=r?Object.keys(r):void 0,c=o?Object.keys(o):void 0;if(!s||!c||s.length!=c.length)return!1;let h;for(let m=0;m<s.length;m++)if(h=s[m],!h3(r[h],o[h]))return!1;return!0}function h3(r,o){if(Array.isArray(r)&&Array.isArray(o)){if(r.length!==o.length)return!1;const s=[...r].sort(),c=[...o].sort();return s.every((h,m)=>c[m]===h)}return r===o}function d3(r){return r.length>0?r[r.length-1]:null}function yf(r){return function J4(r){return!!r&&(r instanceof Un||sr(r.lift)&&sr(r.subscribe))}(r)?r:Gd(r)?hi(Promise.resolve(r)):Ft(r)}const u5={exact:function m3(r,o,s){if(!Vm(r.segments,o.segments)||!jD(r.segments,o.segments,s)||r.numberOfChildren!==o.numberOfChildren)return!1;for(const c in o.children)if(!r.children[c]||!m3(r.children[c],o.children[c],s))return!1;return!0},subset:g3},f3={exact:function h5(r,o){return fu(r,o)},subset:function d5(r,o){return Object.keys(o).length<=Object.keys(r).length&&Object.keys(o).every(s=>h3(r[s],o[s]))},ignored:()=>!0};function p3(r,o,s){return u5[s.paths](r.root,o.root,s.matrixParams)&&f3[s.queryParams](r.queryParams,o.queryParams)&&!("exact"===s.fragment&&r.fragment!==o.fragment)}function g3(r,o,s){return _3(r,o,o.segments,s)}function _3(r,o,s,c){if(r.segments.length>s.length){const h=r.segments.slice(0,s.length);return!(!Vm(h,s)||o.hasChildren()||!jD(h,s,c))}if(r.segments.length===s.length){if(!Vm(r.segments,s)||!jD(r.segments,s,c))return!1;for(const h in o.children)if(!r.children[h]||!g3(r.children[h],o.children[h],c))return!1;return!0}{const h=s.slice(0,r.segments.length),m=s.slice(r.segments.length);return!!(Vm(r.segments,h)&&jD(r.segments,h,c)&&r.children[pn])&&_3(r.children[pn],o,m,c)}}function jD(r,o,s){return o.every((c,h)=>f3[s](r[h].parameters,c.parameters))}class cv{constructor(o=new Cr([],{}),s={},c=null){this.root=o,this.queryParams=s,this.fragment=c}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=lv(this.queryParams)),this._queryParamMap}toString(){return m5.serialize(this)}}class Cr{constructor(o,s){this.segments=o,this.children=s,this.parent=null,Object.values(s).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return UD(this)}}class Vb{constructor(o,s){this.path=o,this.parameters=s}get parameterMap(){return this._parameterMap||(this._parameterMap=lv(this.parameters)),this._parameterMap}toString(){return x3(this)}}function Vm(r,o){return r.length===o.length&&r.every((s,c)=>s.path===o[c].path)}let jb=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:function(){return new cR},providedIn:"root"})}return r})();class cR{parse(o){const s=new T5(o);return new cv(s.parseRootSegment(),s.parseQueryParams(),s.parseFragment())}serialize(o){const s=`/${Ub(o.root,!0)}`,c=function y5(r){const o=Object.keys(r).map(s=>{const c=r[s];return Array.isArray(c)?c.map(h=>`${$D(s)}=${$D(h)}`).join("&"):`${$D(s)}=${$D(c)}`}).filter(s=>!!s);return o.length?`?${o.join("&")}`:""}(o.queryParams);return`${s}${c}${"string"==typeof o.fragment?`#${function g5(r){return encodeURI(r)}(o.fragment)}`:""}`}}const m5=new cR;function UD(r){return r.segments.map(o=>x3(o)).join("/")}function Ub(r,o){if(!r.hasChildren())return UD(r);if(o){const s=r.children[pn]?Ub(r.children[pn],!1):"",c=[];return Object.entries(r.children).forEach(([h,m])=>{h!==pn&&c.push(`${h}:${Ub(m,!1)}`)}),c.length>0?`${s}(${c.join("//")})`:s}{const s=function p5(r,o){let s=[];return Object.entries(r.children).forEach(([c,h])=>{c===pn&&(s=s.concat(o(h,c)))}),Object.entries(r.children).forEach(([c,h])=>{c!==pn&&(s=s.concat(o(h,c)))}),s}(r,(c,h)=>h===pn?[Ub(r.children[pn],!1)]:[`${h}:${Ub(c,!1)}`]);return 1===Object.keys(r.children).length&&null!=r.children[pn]?`${UD(r)}/${s[0]}`:`${UD(r)}/(${s.join("//")})`}}function y3(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function $D(r){return y3(r).replace(/%3B/gi,";")}function uR(r){return y3(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function HD(r){return decodeURIComponent(r)}function v3(r){return HD(r.replace(/\+/g,"%20"))}function x3(r){return`${uR(r.path)}${function _5(r){return Object.keys(r).map(o=>`;${uR(o)}=${uR(r[o])}`).join("")}(r.parameters)}`}const v5=/^[^\/()?;#]+/;function hR(r){const o=r.match(v5);return o?o[0]:""}const x5=/^[^\/()?;=#]+/,w5=/^[^=?&#]+/,M5=/^[^&#]+/;class T5{constructor(o){this.url=o,this.remaining=o}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Cr([],{}):new Cr([],this.parseChildren())}parseQueryParams(){const o={};if(this.consumeOptional("?"))do{this.parseQueryParam(o)}while(this.consumeOptional("&"));return o}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const o=[];for(this.peekStartsWith("(")||o.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),o.push(this.parseSegment());let s={};this.peekStartsWith("/(")&&(this.capture("/"),s=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(o.length>0||Object.keys(s).length>0)&&(c[pn]=new Cr(o,s)),c}parseSegment(){const o=hR(this.remaining);if(""===o&&this.peekStartsWith(";"))throw new pt(4009,!1);return this.capture(o),new Vb(HD(o),this.parseMatrixParams())}parseMatrixParams(){const o={};for(;this.consumeOptional(";");)this.parseParam(o);return o}parseParam(o){const s=function b5(r){const o=r.match(x5);return o?o[0]:""}(this.remaining);if(!s)return;this.capture(s);let c="";if(this.consumeOptional("=")){const h=hR(this.remaining);h&&(c=h,this.capture(c))}o[HD(s)]=HD(c)}parseQueryParam(o){const s=function E5(r){const o=r.match(w5);return o?o[0]:""}(this.remaining);if(!s)return;this.capture(s);let c="";if(this.consumeOptional("=")){const y=function C5(r){const o=r.match(M5);return o?o[0]:""}(this.remaining);y&&(c=y,this.capture(c))}const h=v3(s),m=v3(c);if(o.hasOwnProperty(h)){let y=o[h];Array.isArray(y)||(y=[y],o[h]=y),y.push(m)}else o[h]=m}parseParens(o){const s={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const c=hR(this.remaining),h=this.remaining[c.length];if("/"!==h&&")"!==h&&";"!==h)throw new pt(4010,!1);let m;c.indexOf(":")>-1?(m=c.slice(0,c.indexOf(":")),this.capture(m),this.capture(":")):o&&(m=pn);const y=this.parseChildren();s[m]=1===Object.keys(y).length?y[pn]:new Cr([],y),this.consumeOptional("//")}return s}peekStartsWith(o){return this.remaining.startsWith(o)}consumeOptional(o){return!!this.peekStartsWith(o)&&(this.remaining=this.remaining.substring(o.length),!0)}capture(o){if(!this.consumeOptional(o))throw new pt(4011,!1)}}function b3(r){return r.segments.length>0?new Cr([],{[pn]:r}):r}function w3(r){const o={};for(const c of Object.keys(r.children)){const m=w3(r.children[c]);if(c===pn&&0===m.segments.length&&m.hasChildren())for(const[y,w]of Object.entries(m.children))o[y]=w;else(m.segments.length>0||m.hasChildren())&&(o[c]=m)}return function D5(r){if(1===r.numberOfChildren&&r.children[pn]){const o=r.children[pn];return new Cr(r.segments.concat(o.segments),o.children)}return r}(new Cr(r.segments,o))}function jm(r){return r instanceof cv}function E3(r){let o;const h=b3(function s(m){const y={};for(const M of m.children){const S=s(M);y[M.outlet]=S}const w=new Cr(m.url,y);return m===r&&(o=w),w}(r.root));return o??h}function M3(r,o,s,c){let h=r;for(;h.parent;)h=h.parent;if(0===o.length)return dR(h,h,h,s,c);const m=function I5(r){if("string"==typeof r[0]&&1===r.length&&"/"===r[0])return new T3(!0,0,r);let o=0,s=!1;const c=r.reduce((h,m,y)=>{if("object"==typeof m&&null!=m){if(m.outlets){const w={};return Object.entries(m.outlets).forEach(([M,S])=>{w[M]="string"==typeof S?S.split("/"):S}),[...h,{outlets:w}]}if(m.segmentPath)return[...h,m.segmentPath]}return"string"!=typeof m?[...h,m]:0===y?(m.split("/").forEach((w,M)=>{0==M&&"."===w||(0==M&&""===w?s=!0:".."===w?o++:""!=w&&h.push(w))}),h):[...h,m]},[]);return new T3(s,o,c)}(o);if(m.toRoot())return dR(h,h,new Cr([],{}),s,c);const y=function A5(r,o,s){if(r.isAbsolute)return new qD(o,!0,0);if(!s)return new qD(o,!1,NaN);if(null===s.parent)return new qD(s,!0,0);const c=GD(r.commands[0])?0:1;return function P5(r,o,s){let c=r,h=o,m=s;for(;m>h;){if(m-=h,c=c.parent,!c)throw new pt(4005,!1);h=c.segments.length}return new qD(c,!1,h-m)}(s,s.segments.length-1+c,r.numberOfDoubleDots)}(m,h,r),w=y.processChildren?Hb(y.segmentGroup,y.index,m.commands):D3(y.segmentGroup,y.index,m.commands);return dR(h,y.segmentGroup,w,s,c)}function GD(r){return"object"==typeof r&&null!=r&&!r.outlets&&!r.segmentPath}function $b(r){return"object"==typeof r&&null!=r&&r.outlets}function dR(r,o,s,c,h){let y,m={};c&&Object.entries(c).forEach(([M,S])=>{m[M]=Array.isArray(S)?S.map(O=>`${O}`):`${S}`}),y=r===o?s:C3(r,o,s);const w=b3(w3(y));return new cv(w,m,h)}function C3(r,o,s){const c={};return Object.entries(r.children).forEach(([h,m])=>{c[h]=m===o?s:C3(m,o,s)}),new Cr(r.segments,c)}class T3{constructor(o,s,c){if(this.isAbsolute=o,this.numberOfDoubleDots=s,this.commands=c,o&&c.length>0&&GD(c[0]))throw new pt(4003,!1);const h=c.find($b);if(h&&h!==d3(c))throw new pt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class qD{constructor(o,s,c){this.segmentGroup=o,this.processChildren=s,this.index=c}}function D3(r,o,s){if(r||(r=new Cr([],{})),0===r.segments.length&&r.hasChildren())return Hb(r,o,s);const c=function O5(r,o,s){let c=0,h=o;const m={match:!1,pathIndex:0,commandIndex:0};for(;h<r.segments.length;){if(c>=s.length)return m;const y=r.segments[h],w=s[c];if($b(w))break;const M=`${w}`,S=c<s.length-1?s[c+1]:null;if(h>0&&void 0===M)break;if(M&&S&&"object"==typeof S&&void 0===S.outlets){if(!I3(M,S,y))return m;c+=2}else{if(!I3(M,{},y))return m;c++}h++}return{match:!0,pathIndex:h,commandIndex:c}}(r,o,s),h=s.slice(c.commandIndex);if(c.match&&c.pathIndex<r.segments.length){const m=new Cr(r.segments.slice(0,c.pathIndex),{});return m.children[pn]=new Cr(r.segments.slice(c.pathIndex),r.children),Hb(m,0,h)}return c.match&&0===h.length?new Cr(r.segments,{}):c.match&&!r.hasChildren()?fR(r,o,s):c.match?Hb(r,0,h):fR(r,o,s)}function Hb(r,o,s){if(0===s.length)return new Cr(r.segments,{});{const c=function R5(r){return $b(r[0])?r[0].outlets:{[pn]:r}}(s),h={};if(Object.keys(c).some(m=>m!==pn)&&r.children[pn]&&1===r.numberOfChildren&&0===r.children[pn].segments.length){const m=Hb(r.children[pn],o,s);return new Cr(r.segments,m.children)}return Object.entries(c).forEach(([m,y])=>{"string"==typeof y&&(y=[y]),null!==y&&(h[m]=D3(r.children[m],o,y))}),Object.entries(r.children).forEach(([m,y])=>{void 0===c[m]&&(h[m]=y)}),new Cr(r.segments,h)}}function fR(r,o,s){const c=r.segments.slice(0,o);let h=0;for(;h<s.length;){const m=s[h];if($b(m)){const M=k5(m.outlets);return new Cr(c,M)}if(0===h&&GD(s[0])){c.push(new Vb(r.segments[o].path,S3(s[0]))),h++;continue}const y=$b(m)?m.outlets[pn]:`${m}`,w=h<s.length-1?s[h+1]:null;y&&w&&GD(w)?(c.push(new Vb(y,S3(w))),h+=2):(c.push(new Vb(y,{})),h++)}return new Cr(c,{})}function k5(r){const o={};return Object.entries(r).forEach(([s,c])=>{"string"==typeof c&&(c=[c]),null!==c&&(o[s]=fR(new Cr([],{}),0,c))}),o}function S3(r){const o={};return Object.entries(r).forEach(([s,c])=>o[s]=`${c}`),o}function I3(r,o,s){return r==s.path&&fu(o,s.parameters)}const Gb="imperative";class pu{constructor(o,s){this.id=o,this.url=s}}class ZD extends pu{constructor(o,s,c="imperative",h=null){super(o,s),this.type=0,this.navigationTrigger=c,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class vf extends pu{constructor(o,s,c){super(o,s),this.urlAfterRedirects=c,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class qb extends pu{constructor(o,s,c,h){super(o,s),this.reason=c,this.code=h,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class uv extends pu{constructor(o,s,c,h){super(o,s),this.reason=c,this.code=h,this.type=16}}class WD extends pu{constructor(o,s,c,h){super(o,s),this.error=c,this.target=h,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class A3 extends pu{constructor(o,s,c,h){super(o,s),this.urlAfterRedirects=c,this.state=h,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class L5 extends pu{constructor(o,s,c,h){super(o,s),this.urlAfterRedirects=c,this.state=h,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class F5 extends pu{constructor(o,s,c,h,m){super(o,s),this.urlAfterRedirects=c,this.state=h,this.shouldActivate=m,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class N5 extends pu{constructor(o,s,c,h){super(o,s),this.urlAfterRedirects=c,this.state=h,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class z5 extends pu{constructor(o,s,c,h){super(o,s),this.urlAfterRedirects=c,this.state=h,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class B5{constructor(o){this.route=o,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class V5{constructor(o){this.route=o,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class j5{constructor(o){this.snapshot=o,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class U5{constructor(o){this.snapshot=o,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $5{constructor(o){this.snapshot=o,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class H5{constructor(o){this.snapshot=o,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class P3{constructor(o,s,c){this.routerEvent=o,this.position=s,this.anchor=c,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class pR{}class mR{constructor(o){this.url=o}}class G5{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Zb,this.attachRef=null}}let Zb=(()=>{class r{constructor(){this.contexts=new Map}onChildOutletCreated(s,c){const h=this.getOrCreateContext(s);h.outlet=c,this.contexts.set(s,h)}onChildOutletDestroyed(s){const c=this.getContext(s);c&&(c.outlet=null,c.attachRef=null)}onOutletDeactivated(){const s=this.contexts;return this.contexts=new Map,s}onOutletReAttached(s){this.contexts=s}getOrCreateContext(s){let c=this.getContext(s);return c||(c=new G5,this.contexts.set(s,c)),c}getContext(s){return this.contexts.get(s)||null}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();class R3{constructor(o){this._root=o}get root(){return this._root.value}parent(o){const s=this.pathFromRoot(o);return s.length>1?s[s.length-2]:null}children(o){const s=gR(o,this._root);return s?s.children.map(c=>c.value):[]}firstChild(o){const s=gR(o,this._root);return s&&s.children.length>0?s.children[0].value:null}siblings(o){const s=_R(o,this._root);return s.length<2?[]:s[s.length-2].children.map(h=>h.value).filter(h=>h!==o)}pathFromRoot(o){return _R(o,this._root).map(s=>s.value)}}function gR(r,o){if(r===o.value)return o;for(const s of o.children){const c=gR(r,s);if(c)return c}return null}function _R(r,o){if(r===o.value)return[o];for(const s of o.children){const c=_R(r,s);if(c.length)return c.unshift(o),c}return[]}class gh{constructor(o,s){this.value=o,this.children=s}toString(){return`TreeNode(${this.value})`}}function hv(r){const o={};return r&&r.children.forEach(s=>o[s.value.outlet]=s),o}class O3 extends R3{constructor(o,s){super(o),this.snapshot=s,yR(this,o)}toString(){return this.snapshot.toString()}}function k3(r,o){const s=function q5(r,o){const y=new XD([],{},{},"",{},pn,o,null,{});return new F3("",new gh(y,[]))}(0,o),c=new Ui([new Vb("",{})]),h=new Ui({}),m=new Ui({}),y=new Ui({}),w=new Ui(""),M=new dv(c,h,y,w,m,pn,o,s.root);return M.snapshot=s.root,new O3(new gh(M,[]),s)}class dv{constructor(o,s,c,h,m,y,w,M){this.urlSubject=o,this.paramsSubject=s,this.queryParamsSubject=c,this.fragmentSubject=h,this.dataSubject=m,this.outlet=y,this.component=w,this._futureSnapshot=M,this.title=this.dataSubject?.pipe(On(S=>S[Bb]))??Ft(void 0),this.url=o,this.params=s,this.queryParams=c,this.fragment=h,this.data=m}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(On(o=>lv(o)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(On(o=>lv(o)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function L3(r,o="emptyOnly"){const s=r.pathFromRoot;let c=0;if("always"!==o)for(c=s.length-1;c>=1;){const h=s[c],m=s[c-1];if(h.routeConfig&&""===h.routeConfig.path)c--;else{if(m.component)break;c--}}return function Z5(r){return r.reduce((o,s)=>({params:{...o.params,...s.params},data:{...o.data,...s.data},resolve:{...s.data,...o.resolve,...s.routeConfig?.data,...s._resolvedData}}),{params:{},data:{},resolve:{}})}(s.slice(c))}class XD{get title(){return this.data?.[Bb]}constructor(o,s,c,h,m,y,w,M,S){this.url=o,this.params=s,this.queryParams=c,this.fragment=h,this.data=m,this.outlet=y,this.component=w,this.routeConfig=M,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=lv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=lv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(c=>c.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class F3 extends R3{constructor(o,s){super(s),this.url=o,yR(this,s)}toString(){return N3(this._root)}}function yR(r,o){o.value._routerState=r,o.children.forEach(s=>yR(r,s))}function N3(r){const o=r.children.length>0?` { ${r.children.map(N3).join(", ")} } `:"";return`${r.value}${o}`}function vR(r){if(r.snapshot){const o=r.snapshot,s=r._futureSnapshot;r.snapshot=s,fu(o.queryParams,s.queryParams)||r.queryParamsSubject.next(s.queryParams),o.fragment!==s.fragment&&r.fragmentSubject.next(s.fragment),fu(o.params,s.params)||r.paramsSubject.next(s.params),function c5(r,o){if(r.length!==o.length)return!1;for(let s=0;s<r.length;++s)if(!fu(r[s],o[s]))return!1;return!0}(o.url,s.url)||r.urlSubject.next(s.url),fu(o.data,s.data)||r.dataSubject.next(s.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function xR(r,o){const s=fu(r.params,o.params)&&function f5(r,o){return Vm(r,o)&&r.every((s,c)=>fu(s.parameters,o[c].parameters))}(r.url,o.url);return s&&!(!r.parent!=!o.parent)&&(!r.parent||xR(r.parent,o.parent))}let z3=(()=>{class r{constructor(){this.activated=null,this._activatedRoute=null,this.name=pn,this.activateEvents=new si,this.deactivateEvents=new si,this.attachEvents=new si,this.detachEvents=new si,this.parentContexts=le(Zb),this.location=le(ms),this.changeDetector=le(Ne),this.environmentInjector=le(cs),this.inputBinder=le(YD,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(s){if(s.name){const{firstChange:c,previousValue:h}=s.name;if(c)return;this.isTrackedInParentContexts(h)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(h)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(s){return this.parentContexts.getContext(s)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const s=this.parentContexts.getContext(this.name);s?.route&&(s.attachRef?this.attach(s.attachRef,s.route):this.activateWith(s.route,s.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new pt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new pt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new pt(4012,!1);this.location.detach();const s=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(s.instance),s}attach(s,c){this.activated=s,this._activatedRoute=c,this.location.insert(s.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(s.instance)}deactivate(){if(this.activated){const s=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(s)}}activateWith(s,c){if(this.isActivated)throw new pt(4013,!1);this._activatedRoute=s;const h=this.location,y=s.snapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,M=new W5(s,w,h.injector);this.activated=h.createComponent(y,{index:h.length,injector:M,environmentInjector:c??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275dir=je({type:r,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Is]})}return r})();class W5{constructor(o,s,c){this.route=o,this.childContexts=s,this.parent=c}get(o,s){return o===dv?this.route:o===Zb?this.childContexts:this.parent.get(o,s)}}const YD=new ae("");let B3=(()=>{class r{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(s){this.unsubscribeFromRouteData(s),this.subscribeToRouteData(s)}unsubscribeFromRouteData(s){this.outletDataSubscriptions.get(s)?.unsubscribe(),this.outletDataSubscriptions.delete(s)}subscribeToRouteData(s){const{activatedRoute:c}=s,h=oR([c.queryParams,c.params,c.data]).pipe(ro(([m,y,w],M)=>(w={...m,...y,...w},0===M?Ft(w):Promise.resolve(w)))).subscribe(m=>{if(!s.isActivated||!s.activatedComponentRef||s.activatedRoute!==c||null===c.component)return void this.unsubscribeFromRouteData(s);const y=function qF(r){const o=An(r);if(!o)return null;const s=new Ad(o);return{get selector(){return s.selector},get type(){return s.componentType},get inputs(){return s.inputs},get outputs(){return s.outputs},get ngContentSelectors(){return s.ngContentSelectors},get isStandalone(){return o.standalone},get isSignal(){return o.signals}}}(c.component);if(y)for(const{templateName:w}of y.inputs)s.activatedComponentRef.setInput(w,m[w]);else this.unsubscribeFromRouteData(s)});this.outletDataSubscriptions.set(s,h)}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();function Wb(r,o,s){if(s&&r.shouldReuseRoute(o.value,s.value.snapshot)){const c=s.value;c._futureSnapshot=o.value;const h=function Y5(r,o,s){return o.children.map(c=>{for(const h of s.children)if(r.shouldReuseRoute(c.value,h.value.snapshot))return Wb(r,c,h);return Wb(r,c)})}(r,o,s);return new gh(c,h)}{if(r.shouldAttach(o.value)){const m=r.retrieve(o.value);if(null!==m){const y=m.route;return y.value._futureSnapshot=o.value,y.children=o.children.map(w=>Wb(r,w)),y}}const c=function J5(r){return new dv(new Ui(r.url),new Ui(r.params),new Ui(r.queryParams),new Ui(r.fragment),new Ui(r.data),r.outlet,r.component,r)}(o.value),h=o.children.map(m=>Wb(r,m));return new gh(c,h)}}const bR="ngNavigationCancelingError";function V3(r,o){const{redirectTo:s,navigationBehaviorOptions:c}=jm(o)?{redirectTo:o,navigationBehaviorOptions:void 0}:o,h=j3(!1,0,o);return h.url=s,h.navigationBehaviorOptions=c,h}function j3(r,o,s){const c=new Error("NavigationCancelingError: "+(r||""));return c[bR]=!0,c.cancellationCode=o,s&&(c.url=s),c}function U3(r){return r&&r[bR]}let $3=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275cmp=Ac({type:r,selectors:[["ng-component"]],standalone:!0,features:[V1],decls:1,vars:0,template:function(c,h){1&c&&Ud(0,"router-outlet")},dependencies:[z3],encapsulation:2})}return r})();function wR(r){const o=r.children&&r.children.map(wR),s=o?{...r,children:o}:{...r};return!s.component&&!s.loadComponent&&(o||s.loadChildren)&&s.outlet&&s.outlet!==pn&&(s.component=$3),s}function mc(r){return r.outlet||pn}function Xb(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let o=r.parent;o;o=o.parent){const s=o.routeConfig;if(s?._loadedInjector)return s._loadedInjector;if(s?._injector)return s._injector}return null}class oV{constructor(o,s,c,h,m){this.routeReuseStrategy=o,this.futureState=s,this.currState=c,this.forwardEvent=h,this.inputBindingEnabled=m}activate(o){const s=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(s,c,o),vR(this.futureState.root),this.activateChildRoutes(s,c,o)}deactivateChildRoutes(o,s,c){const h=hv(s);o.children.forEach(m=>{const y=m.value.outlet;this.deactivateRoutes(m,h[y],c),delete h[y]}),Object.values(h).forEach(m=>{this.deactivateRouteAndItsChildren(m,c)})}deactivateRoutes(o,s,c){const h=o.value,m=s?s.value:null;if(h===m)if(h.component){const y=c.getContext(h.outlet);y&&this.deactivateChildRoutes(o,s,y.children)}else this.deactivateChildRoutes(o,s,c);else m&&this.deactivateRouteAndItsChildren(s,c)}deactivateRouteAndItsChildren(o,s){o.value.component&&this.routeReuseStrategy.shouldDetach(o.value.snapshot)?this.detachAndStoreRouteSubtree(o,s):this.deactivateRouteAndOutlet(o,s)}detachAndStoreRouteSubtree(o,s){const c=s.getContext(o.value.outlet),h=c&&o.value.component?c.children:s,m=hv(o);for(const y of Object.keys(m))this.deactivateRouteAndItsChildren(m[y],h);if(c&&c.outlet){const y=c.outlet.detach(),w=c.children.onOutletDeactivated();this.routeReuseStrategy.store(o.value.snapshot,{componentRef:y,route:o,contexts:w})}}deactivateRouteAndOutlet(o,s){const c=s.getContext(o.value.outlet),h=c&&o.value.component?c.children:s,m=hv(o);for(const y of Object.keys(m))this.deactivateRouteAndItsChildren(m[y],h);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(o,s,c){const h=hv(s);o.children.forEach(m=>{this.activateRoutes(m,h[m.value.outlet],c),this.forwardEvent(new H5(m.value.snapshot))}),o.children.length&&this.forwardEvent(new U5(o.value.snapshot))}activateRoutes(o,s,c){const h=o.value,m=s?s.value:null;if(vR(h),h===m)if(h.component){const y=c.getOrCreateContext(h.outlet);this.activateChildRoutes(o,s,y.children)}else this.activateChildRoutes(o,s,c);else if(h.component){const y=c.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){const w=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),vR(w.route.value),this.activateChildRoutes(o,null,y.children)}else{const w=Xb(h.snapshot);y.attachRef=null,y.route=h,y.injector=w,y.outlet&&y.outlet.activateWith(h,y.injector),this.activateChildRoutes(o,null,y.children)}}else this.activateChildRoutes(o,null,c)}}class H3{constructor(o){this.path=o,this.route=this.path[this.path.length-1]}}class JD{constructor(o,s){this.component=o,this.route=s}}function sV(r,o,s){const c=r._root;return Yb(c,o?o._root:null,s,[c.value])}function fv(r,o){const s=Symbol(),c=o.get(r,s);return c===s?"function"!=typeof r||function sg(r){return null!==If(r)}(r)?o.get(r):r:c}function Yb(r,o,s,c,h={canDeactivateChecks:[],canActivateChecks:[]}){const m=hv(o);return r.children.forEach(y=>{(function lV(r,o,s,c,h={canDeactivateChecks:[],canActivateChecks:[]}){const m=r.value,y=o?o.value:null,w=s?s.getContext(r.value.outlet):null;if(y&&m.routeConfig===y.routeConfig){const M=function cV(r,o,s){if("function"==typeof s)return s(r,o);switch(s){case"pathParamsChange":return!Vm(r.url,o.url);case"pathParamsOrQueryParamsChange":return!Vm(r.url,o.url)||!fu(r.queryParams,o.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!xR(r,o)||!fu(r.queryParams,o.queryParams);default:return!xR(r,o)}}(y,m,m.routeConfig.runGuardsAndResolvers);M?h.canActivateChecks.push(new H3(c)):(m.data=y.data,m._resolvedData=y._resolvedData),Yb(r,o,m.component?w?w.children:null:s,c,h),M&&w&&w.outlet&&w.outlet.isActivated&&h.canDeactivateChecks.push(new JD(w.outlet.component,y))}else y&&Jb(o,w,h),h.canActivateChecks.push(new H3(c)),Yb(r,null,m.component?w?w.children:null:s,c,h)})(y,m[y.value.outlet],s,c.concat([y.value]),h),delete m[y.value.outlet]}),Object.entries(m).forEach(([y,w])=>Jb(w,s.getContext(y),h)),h}function Jb(r,o,s){const c=hv(r),h=r.value;Object.entries(c).forEach(([m,y])=>{Jb(y,h.component?o?o.children.getContext(m):null:o,s)}),s.canDeactivateChecks.push(new JD(h.component&&o&&o.outlet&&o.outlet.isActivated?o.outlet.component:null,h))}function Kb(r){return"function"==typeof r}function G3(r){return r instanceof BD||"EmptyError"===r?.name}const KD=Symbol("INITIAL_VALUE");function pv(){return ro(r=>oR(r.map(o=>o.pipe(av(1),function t5(...r){const o=Sc(r);return ci((s,c)=>{(o?sR(r,s,o):sR(r,s)).subscribe(c)})}(KD)))).pipe(On(o=>{for(const s of o)if(!0!==s){if(s===KD)return KD;if(!1===s||s instanceof cv)return s}return!0}),mh(o=>o!==KD),av(1)))}function q3(r){return function vu(...r){return Ec(r)}(_s(o=>{if(jm(o))throw V3(0,o)}),On(o=>!0===o))}class QD{constructor(o){this.segmentGroup=o||null}}class Z3{constructor(o){this.urlTree=o}}function mv(r){return zb(new QD(r))}function W3(r){return zb(new Z3(r))}class IV{constructor(o,s){this.urlSerializer=o,this.urlTree=s}noMatchError(o){return new pt(4002,!1)}lineralizeSegments(o,s){let c=[],h=s.root;for(;;){if(c=c.concat(h.segments),0===h.numberOfChildren)return Ft(c);if(h.numberOfChildren>1||!h.children[pn])return zb(new pt(4e3,!1));h=h.children[pn]}}applyRedirectCommands(o,s,c){return this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),o,c)}applyRedirectCreateUrlTree(o,s,c,h){const m=this.createSegmentGroup(o,s.root,c,h);return new cv(m,this.createQueryParams(s.queryParams,this.urlTree.queryParams),s.fragment)}createQueryParams(o,s){const c={};return Object.entries(o).forEach(([h,m])=>{if("string"==typeof m&&m.startsWith(":")){const w=m.substring(1);c[h]=s[w]}else c[h]=m}),c}createSegmentGroup(o,s,c,h){const m=this.createSegments(o,s.segments,c,h);let y={};return Object.entries(s.children).forEach(([w,M])=>{y[w]=this.createSegmentGroup(o,M,c,h)}),new Cr(m,y)}createSegments(o,s,c,h){return s.map(m=>m.path.startsWith(":")?this.findPosParam(o,m,h):this.findOrReturn(m,c))}findPosParam(o,s,c){const h=c[s.path.substring(1)];if(!h)throw new pt(4001,!1);return h}findOrReturn(o,s){let c=0;for(const h of s){if(h.path===o.path)return s.splice(c),h;c++}return o}}const ER={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function AV(r,o,s,c,h){const m=MR(r,o,s);return m.matched?(c=function Q5(r,o){return r.providers&&!r._injector&&(r._injector=Qd(r.providers,o,`Route: ${r.path}`)),r._injector??o}(o,c),function TV(r,o,s,c){const h=o.canMatch;return h&&0!==h.length?Ft(h.map(y=>{const w=fv(y,r);return yf(function mV(r){return r&&Kb(r.canMatch)}(w)?w.canMatch(o,s):r.runInContext(()=>w(o,s)))})).pipe(pv(),q3()):Ft(!0)}(c,o,s).pipe(On(y=>!0===y?m:{...ER}))):Ft(m)}function MR(r,o,s){if(""===o.path)return"full"===o.pathMatch&&(r.hasChildren()||s.length>0)?{...ER}:{matched:!0,consumedSegments:[],remainingSegments:s,parameters:{},positionalParamSegments:{}};const h=(o.matcher||l5)(s,r,o);if(!h)return{...ER};const m={};Object.entries(h.posParams??{}).forEach(([w,M])=>{m[w]=M.path});const y=h.consumed.length>0?{...m,...h.consumed[h.consumed.length-1].parameters}:m;return{matched:!0,consumedSegments:h.consumed,remainingSegments:s.slice(h.consumed.length),parameters:y,positionalParamSegments:h.posParams??{}}}function X3(r,o,s,c){return s.length>0&&function OV(r,o,s){return s.some(c=>t2(r,o,c)&&mc(c)!==pn)}(r,s,c)?{segmentGroup:new Cr(o,RV(c,new Cr(s,r.children))),slicedSegments:[]}:0===s.length&&function kV(r,o,s){return s.some(c=>t2(r,o,c))}(r,s,c)?{segmentGroup:new Cr(r.segments,PV(r,0,s,c,r.children)),slicedSegments:s}:{segmentGroup:new Cr(r.segments,r.children),slicedSegments:s}}function PV(r,o,s,c,h){const m={};for(const y of c)if(t2(r,s,y)&&!h[mc(y)]){const w=new Cr([],{});m[mc(y)]=w}return{...h,...m}}function RV(r,o){const s={};s[pn]=o;for(const c of r)if(""===c.path&&mc(c)!==pn){const h=new Cr([],{});s[mc(c)]=h}return s}function t2(r,o,s){return(!(r.hasChildren()||o.length>0)||"full"!==s.pathMatch)&&""===s.path}class zV{constructor(o,s,c,h,m,y,w){this.injector=o,this.configLoader=s,this.rootComponentType=c,this.config=h,this.urlTree=m,this.paramsInheritanceStrategy=y,this.urlSerializer=w,this.allowRedirects=!0,this.applyRedirects=new IV(this.urlSerializer,this.urlTree)}noMatchError(o){return new pt(4002,!1)}recognize(){const o=X3(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,o,pn).pipe(Bm(s=>{if(s instanceof Z3)return this.allowRedirects=!1,this.urlTree=s.urlTree,this.match(s.urlTree);throw s instanceof QD?this.noMatchError(s):s}),On(s=>{const c=new XD([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},pn,this.rootComponentType,null,{}),h=new gh(c,s),m=new F3("",h),y=function S5(r,o,s=null,c=null){return M3(E3(r),o,s,c)}(c,[],this.urlTree.queryParams,this.urlTree.fragment);return y.queryParams=this.urlTree.queryParams,m.url=this.urlSerializer.serialize(y),this.inheritParamsAndData(m._root),{state:m,tree:y}}))}match(o){return this.processSegmentGroup(this.injector,this.config,o.root,pn).pipe(Bm(c=>{throw c instanceof QD?this.noMatchError(c):c}))}inheritParamsAndData(o){const s=o.value,c=L3(s,this.paramsInheritanceStrategy);s.params=Object.freeze(c.params),s.data=Object.freeze(c.data),o.children.forEach(h=>this.inheritParamsAndData(h))}processSegmentGroup(o,s,c,h){return 0===c.segments.length&&c.hasChildren()?this.processChildren(o,s,c):this.processSegment(o,s,c,c.segments,h,!0)}processChildren(o,s,c){const h=[];for(const m of Object.keys(c.children))"primary"===m?h.unshift(m):h.push(m);return hi(h).pipe(nv(m=>{const y=c.children[m],w=function rV(r,o){const s=r.filter(c=>mc(c)===o);return s.push(...r.filter(c=>mc(c)!==o)),s}(s,m);return this.processSegmentGroup(o,w,y,m)}),function r5(r,o){return ci(function n5(r,o,s,c,h){return(m,y)=>{let w=s,M=o,S=0;m.subscribe(Ar(y,O=>{const F=S++;M=w?r(M,O,F):(w=!0,O),c&&y.next(M)},h&&(()=>{w&&y.next(M),y.complete()})))}}(r,o,arguments.length>=2,!0))}((m,y)=>(m.push(...y),m)),VD(null),function i5(r,o){const s=arguments.length>=2;return c=>c.pipe(r?mh((h,m)=>r(h,m,c)):Xa,lR(1),s?VD(o):u3(()=>new BD))}(),ni(m=>{if(null===m)return mv(c);const y=Y3(m);return function BV(r){r.sort((o,s)=>o.value.outlet===pn?-1:s.value.outlet===pn?1:o.value.outlet.localeCompare(s.value.outlet))}(y),Ft(y)}))}processSegment(o,s,c,h,m,y){return hi(s).pipe(nv(w=>this.processSegmentAgainstRoute(w._injector??o,s,w,c,h,m,y).pipe(Bm(M=>{if(M instanceof QD)return Ft(null);throw M}))),zm(w=>!!w),Bm(w=>{if(G3(w))return function FV(r,o,s){return 0===o.length&&!r.children[s]}(c,h,m)?Ft([]):mv(c);throw w}))}processSegmentAgainstRoute(o,s,c,h,m,y,w){return function LV(r,o,s,c){return!!(mc(r)===c||c!==pn&&t2(o,s,r))&&("**"===r.path||MR(o,r,s).matched)}(c,h,m,y)?void 0===c.redirectTo?this.matchSegmentAgainstRoute(o,h,c,m,y,w):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(o,h,s,c,m,y):mv(h):mv(h)}expandSegmentAgainstRouteUsingRedirect(o,s,c,h,m,y){return"**"===h.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(o,c,h,y):this.expandRegularSegmentAgainstRouteUsingRedirect(o,s,c,h,m,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(o,s,c,h){const m=this.applyRedirects.applyRedirectCommands([],c.redirectTo,{});return c.redirectTo.startsWith("/")?W3(m):this.applyRedirects.lineralizeSegments(c,m).pipe(ni(y=>{const w=new Cr(y,{});return this.processSegment(o,s,w,y,h,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(o,s,c,h,m,y){const{matched:w,consumedSegments:M,remainingSegments:S,positionalParamSegments:O}=MR(s,h,m);if(!w)return mv(s);const F=this.applyRedirects.applyRedirectCommands(M,h.redirectTo,O);return h.redirectTo.startsWith("/")?W3(F):this.applyRedirects.lineralizeSegments(h,F).pipe(ni($=>this.processSegment(o,c,s,$.concat(S),y,!1)))}matchSegmentAgainstRoute(o,s,c,h,m,y){let w;if("**"===c.path){const M=h.length>0?d3(h).parameters:{};w=Ft({snapshot:new XD(h,M,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,J3(c),mc(c),c.component??c._loadedComponent??null,c,K3(c)),consumedSegments:[],remainingSegments:[]}),s.children={}}else w=AV(s,c,h,o).pipe(On(({matched:M,consumedSegments:S,remainingSegments:O,parameters:F})=>M?{snapshot:new XD(S,F,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,J3(c),mc(c),c.component??c._loadedComponent??null,c,K3(c)),consumedSegments:S,remainingSegments:O}:null));return w.pipe(ro(M=>null===M?mv(s):this.getChildConfig(o=c._injector??o,c,h).pipe(ro(({routes:S})=>{const O=c._loadedInjector??o,{snapshot:F,consumedSegments:$,remainingSegments:Y}=M,{segmentGroup:st,slicedSegments:ht}=X3(s,$,Y,S);if(0===ht.length&&st.hasChildren())return this.processChildren(O,S,st).pipe(On(bt=>null===bt?null:[new gh(F,bt)]));if(0===S.length&&0===ht.length)return Ft([new gh(F,[])]);const _t=mc(c)===m;return this.processSegment(O,S,st,ht,_t?pn:m,!0).pipe(On(bt=>[new gh(F,bt)]))}))))}getChildConfig(o,s,c){return s.children?Ft({routes:s.children,injector:o}):s.loadChildren?void 0!==s._loadedRoutes?Ft({routes:s._loadedRoutes,injector:s._loadedInjector}):function CV(r,o,s,c){const h=o.canLoad;return void 0===h||0===h.length?Ft(!0):Ft(h.map(y=>{const w=fv(y,r);return yf(function hV(r){return r&&Kb(r.canLoad)}(w)?w.canLoad(o,s):r.runInContext(()=>w(o,s)))})).pipe(pv(),q3())}(o,s,c).pipe(ni(h=>h?this.configLoader.loadChildren(o,s).pipe(_s(m=>{s._loadedRoutes=m.routes,s._loadedInjector=m.injector})):function SV(r){return zb(j3(!1,3))}())):Ft({routes:[],injector:o})}}function VV(r){const o=r.value.routeConfig;return o&&""===o.path}function Y3(r){const o=[],s=new Set;for(const c of r){if(!VV(c)){o.push(c);continue}const h=o.find(m=>c.value.routeConfig===m.value.routeConfig);void 0!==h?(h.children.push(...c.children),s.add(h)):o.push(c)}for(const c of s){const h=Y3(c.children);o.push(new gh(c.value,h))}return o.filter(c=>!s.has(c))}function J3(r){return r.data||{}}function K3(r){return r.resolve||{}}function Q3(r){return"string"==typeof r.title||null===r.title}function CR(r){return ro(o=>{const s=r(o);return s?hi(s).pipe(On(()=>o)):Ft(o)})}const gv=new ae("ROUTES");let TR=(()=>{class r{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=le(vb)}loadComponent(s){if(this.componentLoaders.get(s))return this.componentLoaders.get(s);if(s._loadedComponent)return Ft(s._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(s);const c=yf(s.loadComponent()).pipe(On(tF),_s(m=>{this.onLoadEndListener&&this.onLoadEndListener(s),s._loadedComponent=m}),Pb(()=>{this.componentLoaders.delete(s)})),h=new c3(c,()=>new vi).pipe(aR());return this.componentLoaders.set(s,h),h}loadChildren(s,c){if(this.childrenLoaders.get(c))return this.childrenLoaders.get(c);if(c._loadedRoutes)return Ft({routes:c._loadedRoutes,injector:c._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(c);const m=function ZV(r,o,s,c){return yf(r.loadChildren()).pipe(On(tF),ni(h=>h instanceof z1||Array.isArray(h)?Ft(h):hi(o.compileModuleAsync(h))),On(h=>{c&&c(r);let m,y,w=!1;return Array.isArray(h)?(y=h,!0):(m=h.create(s).injector,y=m.get(gv,[],{optional:!0,self:!0}).flat()),{routes:y.map(wR),injector:m}}))}(c,this.compiler,s,this.onLoadEndListener).pipe(Pb(()=>{this.childrenLoaders.delete(c)})),y=new c3(m,()=>new vi).pipe(aR());return this.childrenLoaders.set(c,y),y}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function tF(r){return function WV(r){return r&&"object"==typeof r&&"default"in r}(r)?r.default:r}let e2=(()=>{class r{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new vi,this.transitionAbortSubject=new vi,this.configLoader=le(TR),this.environmentInjector=le(cs),this.urlSerializer=le(jb),this.rootContexts=le(Zb),this.inputBindingEnabled=null!==le(YD,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Ft(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=h=>this.events.next(new V5(h)),this.configLoader.onLoadStartListener=h=>this.events.next(new B5(h))}complete(){this.transitions?.complete()}handleNavigationRequest(s){const c=++this.navigationId;this.transitions?.next({...this.transitions.value,...s,id:c})}setupNavigations(s,c,h){return this.transitions=new Ui({id:0,currentUrlTree:c,currentRawUrl:c,currentBrowserUrl:c,extractedUrl:s.urlHandlingStrategy.extract(c),urlAfterRedirects:s.urlHandlingStrategy.extract(c),rawUrl:c,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Gb,restoredState:null,currentSnapshot:h.snapshot,targetSnapshot:null,currentRouterState:h,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(mh(m=>0!==m.id),On(m=>({...m,extractedUrl:s.urlHandlingStrategy.extract(m.rawUrl)})),ro(m=>{this.currentTransition=m;let y=!1,w=!1;return Ft(m).pipe(_s(M=>{this.currentNavigation={id:M.id,initialUrl:M.rawUrl,extractedUrl:M.extractedUrl,trigger:M.source,extras:M.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),ro(M=>{const S=M.currentBrowserUrl.toString(),O=!s.navigated||M.extractedUrl.toString()!==S||S!==M.currentUrlTree.toString();if(!O&&"reload"!==(M.extras.onSameUrlNavigation??s.onSameUrlNavigation)){const $="";return this.events.next(new uv(M.id,this.urlSerializer.serialize(M.rawUrl),$,0)),M.resolve(null),ha}if(s.urlHandlingStrategy.shouldProcessUrl(M.rawUrl))return Ft(M).pipe(ro($=>{const Y=this.transitions?.getValue();return this.events.next(new ZD($.id,this.urlSerializer.serialize($.extractedUrl),$.source,$.restoredState)),Y!==this.transitions?.getValue()?ha:Promise.resolve($)}),function jV(r,o,s,c,h,m){return ni(y=>function NV(r,o,s,c,h,m,y="emptyOnly"){return new zV(r,o,s,c,h,y,m).recognize()}(r,o,s,c,y.extractedUrl,h,m).pipe(On(({state:w,tree:M})=>({...y,targetSnapshot:w,urlAfterRedirects:M}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,s.config,this.urlSerializer,s.paramsInheritanceStrategy),_s($=>{m.targetSnapshot=$.targetSnapshot,m.urlAfterRedirects=$.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:$.urlAfterRedirects};const Y=new A3($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(Y)}));if(O&&s.urlHandlingStrategy.shouldProcessUrl(M.currentRawUrl)){const{id:$,extractedUrl:Y,source:st,restoredState:ht,extras:_t}=M,bt=new ZD($,this.urlSerializer.serialize(Y),st,ht);this.events.next(bt);const mt=k3(0,this.rootComponentType).snapshot;return this.currentTransition=m={...M,targetSnapshot:mt,urlAfterRedirects:Y,extras:{..._t,skipLocationChange:!1,replaceUrl:!1}},Ft(m)}{const $="";return this.events.next(new uv(M.id,this.urlSerializer.serialize(M.extractedUrl),$,1)),M.resolve(null),ha}}),_s(M=>{const S=new L5(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot);this.events.next(S)}),On(M=>(this.currentTransition=m={...M,guards:sV(M.targetSnapshot,M.currentSnapshot,this.rootContexts)},m)),function _V(r,o){return ni(s=>{const{targetSnapshot:c,currentSnapshot:h,guards:{canActivateChecks:m,canDeactivateChecks:y}}=s;return 0===y.length&&0===m.length?Ft({...s,guardsResult:!0}):function yV(r,o,s,c){return hi(r).pipe(ni(h=>function MV(r,o,s,c,h){const m=o&&o.routeConfig?o.routeConfig.canDeactivate:null;return m&&0!==m.length?Ft(m.map(w=>{const M=Xb(o)??h,S=fv(w,M);return yf(function pV(r){return r&&Kb(r.canDeactivate)}(S)?S.canDeactivate(r,o,s,c):M.runInContext(()=>S(r,o,s,c))).pipe(zm())})).pipe(pv()):Ft(!0)}(h.component,h.route,s,o,c)),zm(h=>!0!==h,!0))}(y,c,h,r).pipe(ni(w=>w&&function uV(r){return"boolean"==typeof r}(w)?function vV(r,o,s,c){return hi(o).pipe(nv(h=>sR(function bV(r,o){return null!==r&&o&&o(new j5(r)),Ft(!0)}(h.route.parent,c),function xV(r,o){return null!==r&&o&&o(new $5(r)),Ft(!0)}(h.route,c),function EV(r,o,s){const c=o[o.length-1],m=o.slice(0,o.length-1).reverse().map(y=>function aV(r){const o=r.routeConfig?r.routeConfig.canActivateChild:null;return o&&0!==o.length?{node:r,guards:o}:null}(y)).filter(y=>null!==y).map(y=>l3(()=>Ft(y.guards.map(M=>{const S=Xb(y.node)??s,O=fv(M,S);return yf(function fV(r){return r&&Kb(r.canActivateChild)}(O)?O.canActivateChild(c,r):S.runInContext(()=>O(c,r))).pipe(zm())})).pipe(pv())));return Ft(m).pipe(pv())}(r,h.path,s),function wV(r,o,s){const c=o.routeConfig?o.routeConfig.canActivate:null;if(!c||0===c.length)return Ft(!0);const h=c.map(m=>l3(()=>{const y=Xb(o)??s,w=fv(m,y);return yf(function dV(r){return r&&Kb(r.canActivate)}(w)?w.canActivate(o,r):y.runInContext(()=>w(o,r))).pipe(zm())}));return Ft(h).pipe(pv())}(r,h.route,s))),zm(h=>!0!==h,!0))}(c,m,r,o):Ft(w)),On(w=>({...s,guardsResult:w})))})}(this.environmentInjector,M=>this.events.next(M)),_s(M=>{if(m.guardsResult=M.guardsResult,jm(M.guardsResult))throw V3(0,M.guardsResult);const S=new F5(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot,!!M.guardsResult);this.events.next(S)}),mh(M=>!!M.guardsResult||(this.cancelNavigationTransition(M,"",3),!1)),CR(M=>{if(M.guards.canActivateChecks.length)return Ft(M).pipe(_s(S=>{const O=new N5(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(O)}),ro(S=>{let O=!1;return Ft(S).pipe(function UV(r,o){return ni(s=>{const{targetSnapshot:c,guards:{canActivateChecks:h}}=s;if(!h.length)return Ft(s);let m=0;return hi(h).pipe(nv(y=>function $V(r,o,s,c){const h=r.routeConfig,m=r._resolve;return void 0!==h?.title&&!Q3(h)&&(m[Bb]=h.title),function HV(r,o,s,c){const h=function GV(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}(r);if(0===h.length)return Ft({});const m={};return hi(h).pipe(ni(y=>function qV(r,o,s,c){const h=Xb(o)??c,m=fv(r,h);return yf(m.resolve?m.resolve(o,s):h.runInContext(()=>m(o,s)))}(r[y],o,s,c).pipe(zm(),_s(w=>{m[y]=w}))),lR(1),function o5(r){return On(()=>r)}(m),Bm(y=>G3(y)?ha:zb(y)))}(m,r,o,c).pipe(On(y=>(r._resolvedData=y,r.data=L3(r,s).resolve,h&&Q3(h)&&(r.data[Bb]=h.title),null)))}(y.route,c,r,o)),_s(()=>m++),lR(1),ni(y=>m===h.length?Ft(s):ha))})}(s.paramsInheritanceStrategy,this.environmentInjector),_s({next:()=>O=!0,complete:()=>{O||this.cancelNavigationTransition(S,"",2)}}))}),_s(S=>{const O=new z5(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(O)}))}),CR(M=>{const S=O=>{const F=[];O.routeConfig?.loadComponent&&!O.routeConfig._loadedComponent&&F.push(this.configLoader.loadComponent(O.routeConfig).pipe(_s($=>{O.component=$}),On(()=>{})));for(const $ of O.children)F.push(...S($));return F};return oR(S(M.targetSnapshot.root)).pipe(VD(),av(1))}),CR(()=>this.afterPreactivation()),On(M=>{const S=function X5(r,o,s){const c=Wb(r,o._root,s?s._root:void 0);return new O3(c,o)}(s.routeReuseStrategy,M.targetSnapshot,M.currentRouterState);return this.currentTransition=m={...M,targetRouterState:S},m}),_s(()=>{this.events.next(new pR)}),((r,o,s,c)=>On(h=>(new oV(o,h.targetRouterState,h.currentRouterState,s,c).activate(r),h)))(this.rootContexts,s.routeReuseStrategy,M=>this.events.next(M),this.inputBindingEnabled),av(1),_s({next:M=>{y=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new vf(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects))),s.titleStrategy?.updateTitle(M.targetRouterState.snapshot),M.resolve(!0)},complete:()=>{y=!0}}),function s5(r){return ci((o,s)=>{fn(r).subscribe(Ar(s,()=>s.complete(),_u)),!s.closed&&o.subscribe(s)})}(this.transitionAbortSubject.pipe(_s(M=>{throw M}))),Pb(()=>{y||w||this.cancelNavigationTransition(m,"",1),this.currentNavigation?.id===m.id&&(this.currentNavigation=null)}),Bm(M=>{if(w=!0,U3(M))this.events.next(new qb(m.id,this.urlSerializer.serialize(m.extractedUrl),M.message,M.cancellationCode)),function K5(r){return U3(r)&&jm(r.url)}(M)?this.events.next(new mR(M.url)):m.resolve(!1);else{this.events.next(new WD(m.id,this.urlSerializer.serialize(m.extractedUrl),M,m.targetSnapshot??void 0));try{m.resolve(s.errorHandler(M))}catch(S){m.reject(S)}}return ha}))}))}cancelNavigationTransition(s,c,h){const m=new qb(s.id,this.urlSerializer.serialize(s.extractedUrl),c,h);this.events.next(m),s.resolve(!1)}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function eF(r){return r!==Gb}let nF=(()=>{class r{buildTitle(s){let c,h=s.root;for(;void 0!==h;)c=this.getResolvedTitleForRoute(h)??c,h=h.children.find(m=>m.outlet===pn);return c}getResolvedTitleForRoute(s){return s.data[Bb]}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:function(){return le(XV)},providedIn:"root"})}return r})(),XV=(()=>{class r extends nF{constructor(s){super(),this.title=s}updateTitle(s){const c=this.buildTitle(s);void 0!==c&&this.title.setTitle(c)}static#t=this.\u0275fac=function(c){return new(c||r)(ye(Pk))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),YV=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:function(){return le(KV)},providedIn:"root"})}return r})();class JV{shouldDetach(o){return!1}store(o,s){}shouldAttach(o){return!1}retrieve(o){return null}shouldReuseRoute(o,s){return o.routeConfig===s.routeConfig}}let KV=(()=>{class r extends JV{static#t=this.\u0275fac=function(){let s;return function(h){return(s||(s=ii(r)))(h||r)}}();static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const n2=new ae("",{providedIn:"root",factory:()=>({})});let QV=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:function(){return le(tj)},providedIn:"root"})}return r})(),tj=(()=>{class r{shouldProcessUrl(s){return!0}extract(s){return s}merge(s,c){return s}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Qb=function(r){return r[r.COMPLETE=0]="COMPLETE",r[r.FAILED=1]="FAILED",r[r.REDIRECTING=2]="REDIRECTING",r}(Qb||{});function rF(r,o){r.events.pipe(mh(s=>s instanceof vf||s instanceof qb||s instanceof WD||s instanceof uv),On(s=>s instanceof vf||s instanceof uv?Qb.COMPLETE:s instanceof qb&&(0===s.code||1===s.code)?Qb.REDIRECTING:Qb.FAILED),mh(s=>s!==Qb.REDIRECTING),av(1)).subscribe(()=>{o()})}function ej(r){throw r}function nj(r,o,s){return o.parse("/")}const rj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ij={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Dl=(()=>{class r{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=le(oD),this.isNgZoneEnabled=!1,this._events=new vi,this.options=le(n2,{optional:!0})||{},this.pendingTasks=le(lh),this.errorHandler=this.options.errorHandler||ej,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||nj,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=le(QV),this.routeReuseStrategy=le(YV),this.titleStrategy=le(nF),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=le(gv,{optional:!0})?.flat()??[],this.navigationTransitions=le(e2),this.urlSerializer=le(jb),this.location=le(uP),this.componentInputBindingEnabled=!!le(YD,{optional:!0}),this.eventsSubscription=new it,this.isNgZoneEnabled=le(hr)instanceof hr&&hr.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new cv,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=k3(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(s=>{this.lastSuccessfulId=s.id,this.currentPageId=this.browserPageId},s=>{this.console.warn(`Unhandled Navigation Error: ${s}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const s=this.navigationTransitions.events.subscribe(c=>{try{const{currentTransition:h}=this.navigationTransitions;if(null===h)return void(iF(c)&&this._events.next(c));if(c instanceof ZD)eF(h.source)&&(this.browserUrlTree=h.extractedUrl);else if(c instanceof uv)this.rawUrlTree=h.rawUrl;else if(c instanceof A3){if("eager"===this.urlUpdateStrategy){if(!h.extras.skipLocationChange){const m=this.urlHandlingStrategy.merge(h.urlAfterRedirects,h.rawUrl);this.setBrowserUrl(m,h)}this.browserUrlTree=h.urlAfterRedirects}}else if(c instanceof pR)this.currentUrlTree=h.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(h.urlAfterRedirects,h.rawUrl),this.routerState=h.targetRouterState,"deferred"===this.urlUpdateStrategy&&(h.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,h),this.browserUrlTree=h.urlAfterRedirects);else if(c instanceof qb)0!==c.code&&1!==c.code&&(this.navigated=!0),(3===c.code||2===c.code)&&this.restoreHistory(h);else if(c instanceof mR){const m=this.urlHandlingStrategy.merge(c.url,h.currentRawUrl),y={skipLocationChange:h.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||eF(h.source)};this.scheduleNavigation(m,Gb,null,y,{resolve:h.resolve,reject:h.reject,promise:h.promise})}c instanceof WD&&this.restoreHistory(h,!0),c instanceof vf&&(this.navigated=!0),iF(c)&&this._events.next(c)}catch(h){this.navigationTransitions.transitionAbortSubject.next(h)}});this.eventsSubscription.add(s)}resetRootComponentType(s){this.routerState.root.component=s,this.navigationTransitions.rootComponentType=s}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const s=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Gb,s)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(s=>{const c="popstate"===s.type?"popstate":"hashchange";"popstate"===c&&setTimeout(()=>{this.navigateToSyncWithBrowser(s.url,c,s.state)},0)}))}navigateToSyncWithBrowser(s,c,h){const m={replaceUrl:!0},y=h?.navigationId?h:null;if(h){const M={...h};delete M.navigationId,delete M.\u0275routerPageId,0!==Object.keys(M).length&&(m.state=M)}const w=this.parseUrl(s);this.scheduleNavigation(w,c,y,m)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(s){this.config=s.map(wR),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(s,c={}){const{relativeTo:h,queryParams:m,fragment:y,queryParamsHandling:w,preserveFragment:M}=c,S=M?this.currentUrlTree.fragment:y;let F,O=null;switch(w){case"merge":O={...this.currentUrlTree.queryParams,...m};break;case"preserve":O=this.currentUrlTree.queryParams;break;default:O=m||null}null!==O&&(O=this.removeEmptyProps(O));try{F=E3(h?h.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof s[0]||!s[0].startsWith("/"))&&(s=[]),F=this.currentUrlTree.root}return M3(F,s,O,S??null)}navigateByUrl(s,c={skipLocationChange:!1}){const h=jm(s)?s:this.parseUrl(s),m=this.urlHandlingStrategy.merge(h,this.rawUrlTree);return this.scheduleNavigation(m,Gb,null,c)}navigate(s,c={skipLocationChange:!1}){return function oj(r){for(let o=0;o<r.length;o++)if(null==r[o])throw new pt(4008,!1)}(s),this.navigateByUrl(this.createUrlTree(s,c),c)}serializeUrl(s){return this.urlSerializer.serialize(s)}parseUrl(s){let c;try{c=this.urlSerializer.parse(s)}catch(h){c=this.malformedUriErrorHandler(h,this.urlSerializer,s)}return c}isActive(s,c){let h;if(h=!0===c?{...rj}:!1===c?{...ij}:c,jm(s))return p3(this.currentUrlTree,s,h);const m=this.parseUrl(s);return p3(this.currentUrlTree,m,h)}removeEmptyProps(s){return Object.keys(s).reduce((c,h)=>{const m=s[h];return null!=m&&(c[h]=m),c},{})}scheduleNavigation(s,c,h,m,y){if(this.disposed)return Promise.resolve(!1);let w,M,S;y?(w=y.resolve,M=y.reject,S=y.promise):S=new Promise((F,$)=>{w=F,M=$});const O=this.pendingTasks.add();return rF(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(O))}),this.navigationTransitions.handleNavigationRequest({source:c,restoredState:h,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:s,extras:m,resolve:w,reject:M,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(F=>Promise.reject(F))}setBrowserUrl(s,c){const h=this.urlSerializer.serialize(s);if(this.location.isCurrentPathEqualTo(h)||c.extras.replaceUrl){const y={...c.extras.state,...this.generateNgRouterState(c.id,this.browserPageId)};this.location.replaceState(h,"",y)}else{const m={...c.extras.state,...this.generateNgRouterState(c.id,this.browserPageId+1)};this.location.go(h,"",m)}}restoreHistory(s,c=!1){if("computed"===this.canceledNavigationResolution){const m=this.currentPageId-this.browserPageId;0!==m?this.location.historyGo(m):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===m&&(this.resetState(s),this.browserUrlTree=s.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(c&&this.resetState(s),this.resetUrlToCurrentUrlTree())}resetState(s){this.routerState=s.currentRouterState,this.currentUrlTree=s.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,s.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(s,c){return"computed"===this.canceledNavigationResolution?{navigationId:s,\u0275routerPageId:c}:{navigationId:s}}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function iF(r){return!(r instanceof pR||r instanceof mR)}class oF{}let lj=(()=>{class r{constructor(s,c,h,m,y){this.router=s,this.injector=h,this.preloadingStrategy=m,this.loader=y}setUpPreloading(){this.subscription=this.router.events.pipe(mh(s=>s instanceof vf),nv(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(s,c){const h=[];for(const m of c){m.providers&&!m._injector&&(m._injector=Qd(m.providers,s,`Route: ${m.path}`));const y=m._injector??s,w=m._loadedInjector??y;(m.loadChildren&&!m._loadedRoutes&&void 0===m.canLoad||m.loadComponent&&!m._loadedComponent)&&h.push(this.preloadConfig(y,m)),(m.children||m._loadedRoutes)&&h.push(this.processRoutes(w,m.children??m._loadedRoutes))}return hi(h).pipe(Dc())}preloadConfig(s,c){return this.preloadingStrategy.preload(c,()=>{let h;h=c.loadChildren&&void 0===c.canLoad?this.loader.loadChildren(s,c):Ft(null);const m=h.pipe(ni(y=>null===y?Ft(void 0):(c._loadedRoutes=y.routes,c._loadedInjector=y.injector,this.processRoutes(y.injector??s,y.routes))));return c.loadComponent&&!c._loadedComponent?hi([m,this.loader.loadComponent(c)]).pipe(Dc()):m})}static#t=this.\u0275fac=function(c){return new(c||r)(ye(Dl),ye(vb),ye(cs),ye(oF),ye(TR))};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const SR=new ae("");let sF=(()=>{class r{constructor(s,c,h,m,y={}){this.urlSerializer=s,this.transitions=c,this.viewportScroller=h,this.zone=m,this.options=y,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},y.scrollPositionRestoration=y.scrollPositionRestoration||"disabled",y.anchorScrolling=y.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(s=>{s instanceof ZD?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=s.navigationTrigger,this.restoredId=s.restoredState?s.restoredState.navigationId:0):s instanceof vf?(this.lastId=s.id,this.scheduleScrollEvent(s,this.urlSerializer.parse(s.urlAfterRedirects).fragment)):s instanceof uv&&0===s.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(s,this.urlSerializer.parse(s.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(s=>{s instanceof P3&&(s.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(s.position):s.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(s.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(s,c){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new P3(s,"popstate"===this.lastSource?this.store[this.restoredId]:null,c))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#t=this.\u0275fac=function(c){!function Hn(){throw new Error("invalid")}()};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac})}return r})();function _h(r,o){return{\u0275kind:r,\u0275providers:o}}function lF(){const r=le(qi);return o=>{const s=r.get(at);if(o!==s.components[0])return;const c=r.get(Dl),h=r.get(cF);1===r.get(IR)&&c.initialNavigation(),r.get(uF,null,He.Optional)?.setUpPreloading(),r.get(SR,null,He.Optional)?.init(),c.resetRootComponentType(s.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}const cF=new ae("",{factory:()=>new vi}),IR=new ae("",{providedIn:"root",factory:()=>1}),uF=new ae("");function dj(r){return _h(0,[{provide:uF,useExisting:lj},{provide:oF,useExisting:r}])}const hF=new ae("ROUTER_FORROOT_GUARD"),pj=[uP,{provide:jb,useClass:cR},Dl,Zb,{provide:dv,useFactory:function aF(r){return r.routerState.root},deps:[Dl]},TR,[]];function mj(){return new z("Router",Dl)}let dF=(()=>{class r{constructor(s){}static forRoot(s,c){return{ngModule:r,providers:[pj,[],{provide:gv,multi:!0,useValue:s},{provide:hF,useFactory:vj,deps:[[Dl,new ap,new lp]]},{provide:n2,useValue:c||{}},c?.useHash?{provide:km,useClass:JF}:{provide:km,useClass:WO},{provide:SR,useFactory:()=>{const r=le(yz),o=le(hr),s=le(n2),c=le(e2),h=le(jb);return s.scrollOffset&&r.setOffset(s.scrollOffset),new sF(h,c,r,o,s)}},c?.preloadingStrategy?dj(c.preloadingStrategy).\u0275providers:[],{provide:z,multi:!0,useFactory:mj},c?.initialNavigation?xj(c):[],c?.bindToComponentInputs?_h(8,[B3,{provide:YD,useExisting:B3}]).\u0275providers:[],[{provide:fF,useFactory:lF},{provide:I,multi:!0,useExisting:fF}]]}}static forChild(s){return{ngModule:r,providers:[{provide:gv,multi:!0,useValue:s}]}}static#t=this.\u0275fac=function(c){return new(c||r)(ye(hF,8))};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({})}return r})();function vj(r){return"guarded"}function xj(r){return["disabled"===r.initialNavigation?_h(3,[{provide:gb,multi:!0,useFactory:()=>{const o=le(Dl);return()=>{o.setUpLocationChangeListener()}}},{provide:IR,useValue:2}]).\u0275providers:[],"enabledBlocking"===r.initialNavigation?_h(2,[{provide:IR,useValue:0},{provide:gb,multi:!0,deps:[qi],useFactory:o=>{const s=o.get(XF,Promise.resolve());return()=>s.then(()=>new Promise(c=>{const h=o.get(Dl),m=o.get(cF);rF(h,()=>{c(!0)}),o.get(e2).afterPreactivation=()=>(c(!0),m.closed?Ft(void 0):m),h.initialNavigation()}))}}]).\u0275providers:[]]}const fF=new ae("");var wj=gu(574),tw=gu.n(wj),Io=Math.PI,Yr=2*Io,Um=Io/180,pF=180/Io,sa=6378.135,mu=60/Math.sqrt(sa*sa*sa/398600.8),r2=sa*mu/60,_F=1/mu,xf=.001082616,bf=-253881e-11/xf,_v=2/3;function bF(r,o,s,c,h,m){var y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return 367*r-Math.floor(7*(r+Math.floor((o+9)/12))*.25)+Math.floor(275*o/9)+s+1721013.5+((y/6e4+m/60+h)/60+c)/24}function AR(r,o,s,c,h,m,y){if(r instanceof Date){var w=r;return bF(w.getUTCFullYear(),w.getUTCMonth()+1,w.getUTCDate(),w.getUTCHours(),w.getUTCMinutes(),w.getUTCSeconds(),w.getUTCMilliseconds())}return bF(r,o,s,c,h,m,y)}function wF(r,o){var Ve,Qe,Nr,Zn,Kr,Sr,Vn,mr,li,Qn,Wn,gr,jn,Mn,Hr,Qr,xr,Ir,s=r.e3,c=r.ee2,h=r.peo,m=r.pgho,y=r.pho,w=r.pinco,M=r.plo,S=r.se2,O=r.se3,F=r.sgh2,$=r.sgh3,Y=r.sgh4,st=r.sh2,ht=r.sh3,_t=r.si2,bt=r.si3,mt=r.sl2,Ut=r.sl3,Qt=r.sl4,de=r.t,fe=r.xgh2,en=r.xgh3,Ln=r.xgh4,Bn=r.xh2,Jr=r.xh3,pr=r.xi2,Rn=r.xi3,wi=r.xl2,Ur=r.xl3,mi=r.xl4,En=r.zmol,Ei=r.zmos,$r=o.init,Fr=o.opsmode,zi=o.ep,gi=o.inclp,cn=o.nodep,Ao=o.argpp,Bi=o.mp;Ir=Ei+119459e-10*de,"y"===$r&&(Ir=Ei),xr=Ir+.0335*Math.sin(Ir);var ys=S*(Vn=.5*(Mn=Math.sin(xr))*Mn-.25)+O*(mr=-.5*Mn*Math.cos(xr)),vs=_t*Vn+bt*mr,Yi=mt*Vn+Ut*mr+Qt*Mn,ji=F*Vn+$*mr+Y*Mn,Ji=st*Vn+ht*mr;return Ir=En+.00015835218*de,"y"===$r&&(Ir=En),xr=Ir+.1098*Math.sin(Ir),li=ys+(c*(Vn=.5*(Mn=Math.sin(xr))*Mn-.25)+s*(mr=-.5*Mn*Math.cos(xr))),gr=vs+(pr*Vn+Rn*mr),jn=Yi+(wi*Vn+Ur*mr+mi*Mn),Qn=ji+(fe*Vn+en*mr+Ln*Mn),Wn=Ji+(Bn*Vn+Jr*mr),"n"===$r&&(jn-=M,Qn-=m,Wn-=y,gi+=gr-=w,zi+=li-=h,Zn=Math.sin(gi),Nr=Math.cos(gi),gi>=.2?(Ao+=Qn-=Nr*(Wn/=Zn),cn+=Wn,Bi+=jn):(Ve=Zn*(Sr=Math.sin(cn)),Qe=Zn*(Kr=Math.cos(cn)),Ve+=Wn*Kr+gr*Nr*Sr,Qe+=-Wn*Sr+gr*Nr*Kr,(cn%=Yr)<0&&"a"===Fr&&(cn+=Yr),Hr=Bi+Ao+Nr*cn,Hr+=jn+Qn-gr*cn*Zn,Qr=cn,(cn=Math.atan2(Ve,Qe))<0&&"a"===Fr&&(cn+=Yr),Math.abs(Qr-cn)>Io&&(cn<Qr?cn+=Yr:cn-=Yr),Ao=Hr-(Bi+=jn)-Nr*cn)),{ep:zi,inclp:gi,nodep:cn,argpp:Ao,mp:Bi}}function EF(r){var o=(r-2451545)/36525,s=-62e-7*o*o*o+.093104*o*o+3164400184.812866*o+67310.54841;return(s=s*Um/240%Yr)<0&&(s+=Yr),s}function MF(){return(arguments.length<=0?void 0:arguments[0])instanceof Date||arguments.length>1?EF(AR.apply(void 0,arguments)):EF.apply(void 0,arguments)}function CF(r,o){var s,c,h,m,y,M,S,O,F,$,Y,st,_t,bt,mt,Ut,Qt,de,fe,en,Ln,Bn,Jr,pr,Rn;r.t=o,r.error=0;var Ur=r.mo+r.mdot*r.t,mi=r.argpo+r.argpdot*r.t;O=mi,fe=Ur;var Ei=r.t*r.t;if(Ln=r.nodeo+r.nodedot*r.t+r.nodecf*Ei,mt=1-r.cc1*r.t,Ut=r.bstar*r.cc4*r.t,Qt=r.t2cof*Ei,1!==r.isimp){M=r.omgcof*r.t;var $r=1+r.eta*Math.cos(Ur);fe=Ur+(bt=M+r.xmcof*($r*$r*$r-r.delmo)),O=mi-bt,mt=mt-r.d2*Ei-r.d3*(Y=Ei*r.t)-r.d4*(st=Y*r.t),Ut+=r.bstar*r.cc5*(Math.sin(fe)-r.sinmao),Qt=Qt+r.t3cof*Y+st*(r.t4cof+r.t*r.t5cof)}en=r.no;var Fr=r.ecco;if(de=r.inclo,"d"===r.method){var gi=function Tj(r){var Wi,Vn,mr,li,Qn,Wn,gr,jn,o=r.irez,s=r.d2201,c=r.d2211,h=r.d3210,m=r.d3222,y=r.d4410,w=r.d4422,M=r.d5220,S=r.d5232,O=r.d5421,F=r.d5433,Y=r.del1,st=r.del2,ht=r.del3,Qt=r.argpo,de=r.argpdot,fe=r.t,Bn=r.xfact,Jr=r.xlamo,pr=r.no,Rn=r.atime,wi=r.em,Ur=r.argpm,mi=r.inclm,En=r.xli,Ei=r.mm,$r=r.xni,Fr=r.nodem,zi=r.nm,gi=.13130908,cn=2.8843198,Ao=.37448087,Bi=5.7686396,Ve=.95240898,Qe=1.8014998,Nr=1.050833,Zn=4.4108898,Mn=0,Hr=0,Qr=(r.gsto+.0043752690880113*r.tc)%Yr;if(wi+=r.dedt*fe,mi+=r.didt*fe,Ur+=r.domdt*fe,Fr+=r.dnodt*fe,Ei+=r.dmdt*fe,0!==o){(0===Rn||fe*Rn<=0||Math.abs(fe)<Math.abs(Rn))&&(Rn=0,$r=pr,En=Jr),Wi=fe>0?720:-720;for(var xr=381;381===xr;)2!==o?(gr=Y*Math.sin(En-gi)+st*Math.sin(2*(En-cn))+ht*Math.sin(3*(En-Ao)),Qn=$r+Bn,Wn=Y*Math.cos(En-gi)+2*st*Math.cos(2*(En-cn))+3*ht*Math.cos(3*(En-Ao)),Wn*=Qn):(mr=(jn=Qt+de*Rn)+jn,Vn=En+En,gr=s*Math.sin(mr+En-Bi)+c*Math.sin(En-Bi)+h*Math.sin(jn+En-Ve)+m*Math.sin(-jn+En-Ve)+y*Math.sin(mr+Vn-Qe)+w*Math.sin(Vn-Qe)+M*Math.sin(jn+En-Nr)+S*Math.sin(-jn+En-Nr)+O*Math.sin(jn+Vn-Zn)+F*Math.sin(-jn+Vn-Zn),Qn=$r+Bn,Wn=s*Math.cos(mr+En-Bi)+c*Math.cos(En-Bi)+h*Math.cos(jn+En-Ve)+m*Math.cos(-jn+En-Ve)+M*Math.cos(jn+En-Nr)+S*Math.cos(-jn+En-Nr)+2*(y*Math.cos(mr+Vn-Qe)+w*Math.cos(Vn-Qe)+O*Math.cos(jn+Vn-Zn)+F*Math.cos(-jn+Vn-Zn)),Wn*=Qn),Math.abs(fe-Rn)>=720?xr=381:(Hr=fe-Rn,xr=0),381===xr&&(En+=Qn*Wi+259200*gr,$r+=gr*Wi+259200*Wn,Rn+=Wi);zi=$r+gr*Hr+Wn*Hr*Hr*.5,li=En+Qn*Hr+gr*Hr*Hr*.5,1!==o?(Ei=li-2*Fr+2*Qr,Mn=zi-pr):(Ei=li-Fr-Ur+Qr,Mn=zi-pr),zi=pr+Mn}return{atime:Rn,em:wi,argpm:Ur,inclm:mi,xli:En,mm:Ei,xni:$r,nodem:Fr,dndt:Mn,nm:zi}}({irez:r.irez,d2201:r.d2201,d2211:r.d2211,d3210:r.d3210,d3222:r.d3222,d4410:r.d4410,d4422:r.d4422,d5220:r.d5220,d5232:r.d5232,d5421:r.d5421,d5433:r.d5433,dedt:r.dedt,del1:r.del1,del2:r.del2,del3:r.del3,didt:r.didt,dmdt:r.dmdt,dnodt:r.dnodt,domdt:r.domdt,argpo:r.argpo,argpdot:r.argpdot,t:r.t,tc:r.t,gsto:r.gsto,xfact:r.xfact,xlamo:r.xlamo,no:r.no,atime:r.atime,em:Fr,argpm:O,inclm:de,xli:r.xli,mm:fe,xni:r.xni,nodem:Ln,nm:en});Fr=gi.em,O=gi.argpm,de=gi.inclm,fe=gi.mm,Ln=gi.nodem,en=gi.nm}if(en<=0)return r.error=2,[!1,!1];var cn=Math.pow(mu/en,_v)*mt*mt;if(en=mu/Math.pow(cn,1.5),(Fr-=Ut)>=1||Fr<-.001)return r.error=1,[!1,!1];Fr<1e-6&&(Fr=1e-6),Jr=(fe+=r.no*Qt)+O+Ln;var Ve=Fr;if(Bn=de,F=O%=Yr,Rn=Ln%=Yr,pr=fe=((Jr%=Yr)-O-Ln)%Yr,m=Math.sin(de),h=Math.cos(de),"d"===r.method){var Nr=wF(r,{inclo:r.inclo,init:"n",ep:Ve,inclp:Bn,nodep:Rn,argpp:F,mp:pr,opsmode:r.operationmode});if(Rn=Nr.nodep,F=Nr.argpp,pr=Nr.mp,(Bn=Nr.inclp)<0&&(Bn=-Bn,Rn+=Io,F-=Io),(Ve=Nr.ep)<0||Ve>1)return r.error=3,[!1,!1]}"d"===r.method&&(m=Math.sin(Bn),h=Math.cos(Bn),r.aycof=-.5*bf*m,r.xlcof=Math.abs(h+1)>15e-13?-.25*bf*m*(3+5*h)/(1+h):-.25*bf*m*(3+5*h)/15e-13);var Zn=Ve*Math.cos(F);bt=1/(cn*(1-Ve*Ve));var Kr=Ve*Math.sin(F)+bt*r.aycof,Go=(pr+F+Rn+bt*r.xlcof*Zn-Rn)%Yr;S=Go,_t=9999.9;for(var _i=1;Math.abs(_t)>=1e-12&&_i<=10;)c=Math.sin(S),_t=(Go-Kr*(s=Math.cos(S))+Zn*c-S)/(_t=1-s*Zn-c*Kr),Math.abs(_t)>=.95&&(_t=_t>0?.95:-.95),S+=_t,_i+=1;var Wi=Zn*s+Kr*c,Vn=Zn*c-Kr*s,mr=Zn*Zn+Kr*Kr,li=cn*(1-mr);if(li<0)return r.error=4,[!1,!1];var Qn=cn*(1-Wi),Wn=Math.sqrt(cn)*Vn/Qn,gr=Math.sqrt(li)/Qn,jn=Math.sqrt(1-mr),Mn=cn/Qn*(c-Kr-Zn*(bt=Vn/(1+jn))),Hr=cn/Qn*(s-Zn+Kr*bt);$=Math.atan2(Mn,Hr);var Qr=(Hr+Hr)*Mn,xr=1-2*Mn*Mn,Ir=.5*xf*(bt=1/li),Xi=Ir*bt;"d"===r.method&&(r.con41=3*(y=h*h)-1,r.x1mth2=1-y,r.x7thm1=7*y-1);var Vi=Qn*(1-1.5*Xi*jn*r.con41)+.5*Ir*r.x1mth2*xr;if(Vi<1)return r.error=6,{position:!1,velocity:!1};$-=.25*Xi*r.x7thm1*Qr;var Po=Rn+1.5*Xi*h*Qr,po=Bn+1.5*Xi*h*m*xr,ys=Wn-en*Ir*r.x1mth2*Qr/mu,vs=gr+en*Ir*(r.x1mth2*xr+1.5*r.con41)/mu,Yi=Math.sin($),ji=Math.cos($),Ji=Math.sin(Po),Ua=Math.cos(Po),Us=Math.sin(po),yi=Math.cos(po),Ki=-Ji*yi,gc=Ua*yi,aa=Ki*Yi+Ua*ji,Qi=gc*Yi+Ji*ji,yh=Us*Yi;return{position:{x:Vi*aa*sa,y:Vi*Qi*sa,z:Vi*yh*sa},velocity:{x:(ys*aa+vs*(Ki*ji-Ua*Yi))*r2,y:(ys*Qi+vs*(gc*ji-Ji*Yi))*r2,z:(ys*yh+vs*(Us*ji))*r2}}}function PR(r,o){(null==o||o>r.length)&&(o=r.length);for(var s=0,c=new Array(o);s<o;s++)c[s]=r[s];return c}function TF(r){return r*pF}let SF=(()=>{class r{constructor(){this.coordinatesSubject=new vi,this.satelliteNameSubject=new vi,this.satelliteJsonSubject=new vi,this.tleLine1="1 41866U 16071A   23359.22757810 -.00000237  00000+0  00000+0 0  9995",this.tleLine2="2 41866   0.0654 247.0651 0001352  56.0167 157.1108  1.00271540 26037",this.satelliteName="Unnamed Satellite",this.satelliteJson="",this.updateSatelliteData()}get coordinates$(){return this.coordinatesSubject.asObservable()}get satelliteName$(){return this.satelliteNameSubject.asObservable()}get satelliteJson$(){return this.satelliteJsonSubject.asObservable()}updateSatelliteData(){this.intervalId=setInterval(()=>{const s=new Date,c=function Sj(r,o){var h,c=1440/(2*Io),m={error:0};m.satnum=r.substring(2,7),m.epochyr=parseInt(r.substring(18,20),10),m.epochdays=parseFloat(r.substring(20,32)),m.ndot=parseFloat(r.substring(33,43)),m.nddot=parseFloat(".".concat(parseInt(r.substring(44,50),10),"E").concat(r.substring(50,52))),m.bstar=parseFloat("".concat(r.substring(53,54),".").concat(parseInt(r.substring(54,59),10),"E").concat(r.substring(59,61))),m.inclo=parseFloat(o.substring(8,16)),m.nodeo=parseFloat(o.substring(17,25)),m.ecco=parseFloat(".".concat(o.substring(26,33))),m.argpo=parseFloat(o.substring(34,42)),m.mo=parseFloat(o.substring(43,51)),m.no=parseFloat(o.substring(52,63)),m.no/=c,m.inclo*=Um,m.nodeo*=Um,m.argpo*=Um,m.mo*=Um;var y=function xF(r,o){for(var s=[31,r%4==0?29:28,31,30,31,30,31,31,30,31,30,31],c=Math.floor(o),h=1,m=0;c>m+s[h-1]&&h<12;)m+=s[h-1],h+=1;var y=h,w=c-m,M=24*(o-c),S=Math.floor(M);M=60*(M-S);var O=Math.floor(M);return{mon:y,day:w,hr:S,minute:O,sec:60*(M-O)}}(h=m.epochyr<57?m.epochyr+2e3:m.epochyr+1900,m.epochdays);return m.jdsatepoch=AR(h,y.mon,y.day,y.hr,y.minute,y.sec),function Dj(r,o){var $,Y,st,_t,bt,mt,Ut,Qt,de,fe,en,Jr,Rn,wi,Ur,mi,En,Ei,$r,Fr,zi,gi,cn,Ao,Bi,Ve,Qe,Nr,Zn,Kr,Sr,Go,_i,Wi,Vn,mr,Qn,Wn,gr,jn,Mn,Hr,Qr,xr,Ir,Xi,Vi,Po,po,ys,vs,s=o.opsmode,c=o.satn,h=o.epoch,m=o.xbstar,y=o.xecco,w=o.xargpo,M=o.xinclo,S=o.xmo,O=o.xno,F=o.xnodeo;r.isimp=0,r.method="n",r.aycof=0,r.con41=0,r.cc1=0,r.cc4=0,r.cc5=0,r.d2=0,r.d3=0,r.d4=0,r.delmo=0,r.eta=0,r.argpdot=0,r.omgcof=0,r.sinmao=0,r.t=0,r.t2cof=0,r.t3cof=0,r.t4cof=0,r.t5cof=0,r.x1mth2=0,r.x7thm1=0,r.mdot=0,r.nodedot=0,r.xlcof=0,r.xmcof=0,r.nodecf=0,r.irez=0,r.d2201=0,r.d2211=0,r.d3210=0,r.d3222=0,r.d4410=0,r.d4422=0,r.d5220=0,r.d5232=0,r.d5421=0,r.d5433=0,r.dedt=0,r.del1=0,r.del2=0,r.del3=0,r.didt=0,r.dmdt=0,r.dnodt=0,r.domdt=0,r.e3=0,r.ee2=0,r.peo=0,r.pgho=0,r.pho=0,r.pinco=0,r.plo=0,r.se2=0,r.se3=0,r.sgh2=0,r.sgh3=0,r.sgh4=0,r.sh2=0,r.sh3=0,r.si2=0,r.si3=0,r.sl2=0,r.sl3=0,r.sl4=0,r.gsto=0,r.xfact=0,r.xgh2=0,r.xgh3=0,r.xgh4=0,r.xh2=0,r.xh3=0,r.xi2=0,r.xi3=0,r.xl2=0,r.xl3=0,r.xl4=0,r.xlamo=0,r.zmol=0,r.zmos=0,r.atime=0,r.xli=0,r.xni=0,r.bstar=m,r.ecco=y,r.argpo=w,r.inclo=M,r.mo=S,r.no=O,r.nodeo=F,r.operationmode=s;var ji=78/sa+1,Ji=42/sa,Ua=Ji*Ji*Ji*Ji;r.init="y",r.t=0;var yi=function Cj(r){var o=r.ecco,s=r.epoch,c=r.inclo,h=r.opsmode,m=r.no,y=o*o,w=1-y,M=Math.sqrt(w),S=Math.cos(c),O=S*S,F=Math.pow(mu/m,_v),$=.75*xf*(3*O-1)/(M*w),Y=$/(F*F),st=F*(1-Y*Y-Y*(1/3+134*Y*Y/81));m/=1+(Y=$/(st*st));var Ln,ht=Math.pow(mu/m,_v),_t=Math.sin(c),bt=ht*w,mt=1-5*O,Ut=-mt-O-O,Qt=1/ht,de=bt*bt,fe=ht*(1-o);if("a"===h){var Bn=s-7305,Jr=Math.floor(Bn+1e-8),Rn=.017202791694070362;(Ln=(1.7321343856509375+Rn*Jr+(Rn+Yr)*(Bn-Jr)+Bn*Bn*5075514194322695e-30)%Yr)<0&&(Ln+=Yr)}else Ln=MF(s+2433281.5);return{no:m,method:"n",ainv:Qt,ao:ht,con41:Ut,con42:mt,cosio:S,cosio2:O,eccsq:y,omeosq:w,posq:de,rp:fe,rteosq:M,sinio:_t,gsto:Ln}}({satn:c,ecco:r.ecco,epoch:h,inclo:r.inclo,no:r.no,method:r.method,opsmode:r.operationmode}),Ki=yi.ao,gc=yi.con42,aa=yi.cosio,Qi=yi.cosio2,yh=yi.eccsq,Sl=yi.omeosq,_c=yi.posq,Il=yi.rp,Al=yi.rteosq,qo=yi.sinio;if(r.no=yi.no,r.con41=yi.con41,r.gsto=yi.gsto,r.a=Math.pow(r.no*_F,-2/3),r.alta=r.a*(1+r.ecco)-1,r.altp=r.a*(1-r.ecco)-1,r.error=0,Sl>=0||r.no>=0){if(r.isimp=0,Il<220/sa+1&&(r.isimp=1),cn=ji,En=Ua,(wi=(Il-1)*sa)<156){cn=wi-78,wi<98&&(cn=20);var $s=(120-cn)/sa;En=$s*$s*$s*$s,cn=cn/sa+1}Ur=1/_c,r.eta=Ki*r.ecco*(Mn=1/(Ki-cn)),en=r.eta*r.eta,fe=r.ecco*r.eta,mi=Math.abs(1-en),mt=(bt=En*Math.pow(Mn,4))/Math.pow(mi,3.5),r.cc1=r.bstar*(mt*r.no*(Ki*(1+1.5*en+fe*(4+en))+.375*xf*Mn/mi*r.con41*(8+3*en*(8+en)))),_t=0,r.ecco>1e-4&&(_t=-2*bt*Mn*bf*r.no*qo/r.ecco),r.x1mth2=1-Qi,r.cc4=2*r.no*mt*Ki*Sl*(r.eta*(2+.5*en)+r.ecco*(.5+2*en)-xf*Mn/(Ki*mi)*(-3*r.con41*(1-2*fe+en*(1.5-.5*fe))+.75*r.x1mth2*(2*en-fe*(1+en))*Math.cos(2*r.argpo))),r.cc5=2*mt*Ki*Sl*(1+2.75*(en+fe)+fe*en),jn=7.762359375e-7*Ur*Ur*r.no,r.mdot=r.no+.5*(Wn=1.5*xf*Ur*r.no)*Al*r.con41+.0625*(gr=.5*Wn*xf*Ur)*Al*(13-78*Qi+137*(Ut=Qi*Qi)),r.argpdot=-.5*Wn*gc+.0625*gr*(7-114*Qi+395*Ut)+jn*(3-36*Qi+49*Ut),r.nodedot=(Qr=-Wn*aa)+(.5*gr*(4-19*Qi)+2*jn*(3-7*Qi))*aa,Hr=r.argpdot+r.nodedot,r.omgcof=r.bstar*_t*Math.cos(r.argpo),r.xmcof=0,r.ecco>1e-4&&(r.xmcof=-_v*bt*r.bstar/fe),r.nodecf=3.5*Sl*Qr*r.cc1,r.t2cof=1.5*r.cc1,r.xlcof=Math.abs(aa+1)>15e-13?-.25*bf*qo*(3+5*aa)/(1+aa):-.25*bf*qo*(3+5*aa)/15e-13,r.aycof=-.5*bf*qo;var Pl=1+r.eta*Math.cos(r.mo);if(r.delmo=Pl*Pl*Pl,r.sinmao=Math.sin(r.mo),r.x7thm1=7*Qi-1,2*Io/r.no>=225){r.method="d",r.isimp=1,Jr=r.inclo;var ne=function Ej(r){var M,S,O,F,$,Y,st,ht,_t,bt,mt,Ut,Qt,de,fe,en,Ln,Bn,Jr,pr,Rn,wi,Ur,mi,En,Ei,$r,Fr,zi,gi,cn,Ao,Bi,Ve,Qe,Nr,Zn,Kr,Sr,Go,_i,Wi,Vn,mr,li,Qn,Wn,gr,jn,Mn,Hr,Qr,xr,Ir,Xi,Vi,Po,po,ys,vs,Yi,ji,Ji,o=r.epoch,c=r.argpp,h=r.tc,m=r.inclp,y=r.nodep,Sl=r.np,_c=r.ep,Il=Math.sin(y),Al=Math.cos(y),qo=Math.sin(c),$s=Math.cos(c),Pl=Math.sin(m),yc=Math.cos(m),ne=_c*_c,Rl=1-ne,$a=Math.sqrt(Rl),vh=o+18261.5+h/1440,vc=(4.523602-.00092422029*vh)%Yr,mo=Math.sin(vc),Ol=Math.cos(vc),vv=.91375164-.03568096*Ol,xv=Math.sqrt(1-vv*vv),xs=.089683511*mo/xv,bs=Math.sqrt(1-xs*xs),Mi=5.8351514+.001944368*vh,Hm=.39785416*mo/xv;Hm=Math.atan2(Hm,bs*Ol+.91744867*xs*mo),Hm+=Mi-vc;var OR=Math.cos(Hm),kR=Math.sin(Hm);pr=.1945905,Rn=-.98088458,mi=.91744867,En=.39785416,wi=Al,Ur=Il,mt=29864797e-13;for(var LR=1/Sl,rw=0;rw<2;)Xi=-6*(M=pr*wi+Rn*mi*Ur)*($=-Pl*(st=-pr*Ur+Rn*mi*wi)+yc*(ht=Rn*En))+ne*(-24*(Ut=M*$s+(S=yc*st+Pl*ht)*qo)*(Bn=$*$s)-6*(de=-M*qo+S*$s)*(en=$*qo)),Vi=-6*(M*(Y=-Pl*(_t=Rn*Ur+pr*mi*wi)+yc*(bt=pr*En))+(O=-Rn*wi+pr*mi*Ur)*$)+ne*(-24*((Qt=O*$s+(F=yc*_t+Pl*bt)*qo)*Bn+Ut*(Jr=Y*$s))+-6*(de*(Ln=Y*qo)+(fe=-O*qo+F*$s)*en)),Po=-6*O*Y+ne*(-24*Qt*Jr-6*fe*Ln),po=6*S*$+ne*(24*Ut*en-6*de*Bn),ys=6*(F*$+S*Y)+ne*(24*(Qt*en+Ut*Ln)-6*(fe*Bn+de*Jr)),vs=6*F*Y+ne*(24*Qt*Ln-6*fe*Jr),Qr=(Qr=3*(M*M+S*S)+(Yi=12*Ut*Ut-3*de*de)*ne)+Qr+Rl*Yi,xr=(xr=6*(M*O+S*F)+(ji=24*Ut*Qt-6*de*fe)*ne)+xr+Rl*ji,Ir=(Ir=3*(O*O+F*F)+(Ji=12*Qt*Qt-3*fe*fe)*ne)+Ir+Rl*Ji,Qn=-.5*(Wn=mt*LR)/$a,li=-15*_c*(gr=Wn*$a),jn=Ut*de+Qt*fe,Mn=Qt*de+Ut*fe,Hr=Qt*fe-Ut*de,1===(rw+=1)&&(Ei=li,$r=Qn,Fr=Wn,zi=gr,gi=jn,cn=Mn,Ao=Hr,Bi=Qr,Ve=xr,Qe=Ir,Nr=Xi,Zn=Vi,Kr=Po,Sr=po,Go=ys,_i=vs,Wi=Yi,Vn=ji,mr=Ji,pr=OR,Rn=kR,mi=vv,En=xv,wi=bs*Al+xs*Il,Ur=Il*bs-Al*xs,mt=4.7968065e-7);return{snodm:Il,cnodm:Al,sinim:Pl,cosim:yc,sinomm:qo,cosomm:$s,day:vh,e3:2*li*Hr,ee2:2*li*Mn,em:_c,emsq:ne,gam:Mi,peo:0,pgho:0,pho:0,pinco:0,plo:0,rtemsq:$a,se2:2*Ei*cn,se3:2*Ei*Ao,sgh2:2*zi*Vn,sgh3:2*zi*(mr-Wi),sgh4:-18*zi*.01675,sh2:-2*$r*Go,sh3:-2*$r*(_i-Sr),si2:2*$r*Zn,si3:2*$r*(Kr-Nr),sl2:-2*Fr*Ve,sl3:-2*Fr*(Qe-Bi),sl4:-2*Fr*(-21-9*ne)*.01675,s1:li,s2:Qn,s3:Wn,s4:gr,s5:jn,s6:Mn,s7:Hr,ss1:Ei,ss2:$r,ss3:Fr,ss4:zi,ss5:gi,ss6:cn,ss7:Ao,sz1:Bi,sz2:Ve,sz3:Qe,sz11:Nr,sz12:Zn,sz13:Kr,sz21:Sr,sz22:Go,sz23:_i,sz31:Wi,sz32:Vn,sz33:mr,xgh2:2*gr*ji,xgh3:2*gr*(Ji-Yi),xgh4:-18*gr*.0549,xh2:-2*Qn*ys,xh3:-2*Qn*(vs-po),xi2:2*Qn*Vi,xi3:2*Qn*(Po-Xi),xl2:-2*Wn*xr,xl3:-2*Wn*(Ir-Qr),xl4:-2*Wn*(-21-9*ne)*.0549,nm:Sl,z1:Qr,z2:xr,z3:Ir,z11:Xi,z12:Vi,z13:Po,z21:po,z22:ys,z23:vs,z31:Yi,z32:ji,z33:Ji,zmol:(.2299715*vh-Mi+4.7199672)%Yr,zmos:(6.2565837+.017201977*vh)%Yr}}({epoch:h,ep:r.ecco,argpp:r.argpo,tc:0,inclp:r.inclo,nodep:r.nodeo,np:r.no,e3:r.e3,ee2:r.ee2,peo:r.peo,pgho:r.pgho,pho:r.pho,pinco:r.pinco,plo:r.plo,se2:r.se2,se3:r.se3,sgh2:r.sgh2,sgh3:r.sgh3,sgh4:r.sgh4,sh2:r.sh2,sh3:r.sh3,si2:r.si2,si3:r.si3,sl2:r.sl2,sl3:r.sl3,sl4:r.sl4,xgh2:r.xgh2,xgh3:r.xgh3,xgh4:r.xgh4,xh2:r.xh2,xh3:r.xh3,xi2:r.xi2,xi3:r.xi3,xl2:r.xl2,xl3:r.xl3,xl4:r.xl4,zmol:r.zmol,zmos:r.zmos});r.e3=ne.e3,r.ee2=ne.ee2,r.peo=ne.peo,r.pgho=ne.pgho,r.pho=ne.pho,r.pinco=ne.pinco,r.plo=ne.plo,r.se2=ne.se2,r.se3=ne.se3,r.sgh2=ne.sgh2,r.sgh3=ne.sgh3,r.sgh4=ne.sgh4,r.sh2=ne.sh2,r.sh3=ne.sh3,r.si2=ne.si2,r.si3=ne.si3,r.sl2=ne.sl2,r.sl3=ne.sl3,r.sl4=ne.sl4,Y=ne.sinim,$=ne.cosim,Qt=ne.em,de=ne.emsq,Ei=ne.s1,$r=ne.s2,Fr=ne.s3,zi=ne.s4,gi=ne.s5,Ao=ne.ss1,Bi=ne.ss2,Ve=ne.ss3,Qe=ne.ss4,Nr=ne.ss5,Zn=ne.sz1,Kr=ne.sz3,Sr=ne.sz11,Go=ne.sz13,_i=ne.sz21,Wi=ne.sz23,Vn=ne.sz31,mr=ne.sz33,r.xgh2=ne.xgh2,r.xgh3=ne.xgh3,r.xgh4=ne.xgh4,r.xh2=ne.xh2,r.xh3=ne.xh3,r.xi2=ne.xi2,r.xi3=ne.xi3,r.xl2=ne.xl2,r.xl3=ne.xl3,r.xl4=ne.xl4,r.zmol=ne.zmol,r.zmos=ne.zmos,Rn=ne.nm,xr=ne.z1,Ir=ne.z3,Xi=ne.z11,Vi=ne.z13,Po=ne.z21,po=ne.z23,ys=ne.z31,vs=ne.z33;var $a=wF(r,{inclo:Jr,init:r.init,ep:r.ecco,inclp:r.inclo,nodep:r.nodeo,argpp:r.argpo,mp:r.mo,opsmode:r.operationmode});r.ecco=$a.ep,r.inclo=$a.inclp,r.nodeo=$a.nodep,r.argpo=$a.argpp,r.mo=$a.mp;var br=function Mj(r){var xr,Ir,Xi,Us,Qi,yc,Rl,$a,$m,br,yv,ew,nw,vh,vc,mo,Ol,xs,bs,Mi,o=r.cosim,s=r.argpo,h=r.s2,M=r.sinim,O=r.ss2,fe=r.t,Bn=r.mo,Jr=r.mdot,pr=r.no,Rn=r.nodeo,wi=r.nodedot,Ur=r.xpidot,Ao=r.ecco,Bi=r.eccsq,Ve=r.emsq,Qe=r.em,Nr=r.argpm,Zn=r.inclm,Kr=r.mm,Sr=r.nm,Go=r.nodem,_i=r.irez,Wi=r.atime,Vn=r.d2201,mr=r.d2211,li=r.d3210,Qn=r.d3222,Wn=r.d4410,gr=r.d4422,jn=r.d5220,Mn=r.d5232,Hr=r.d5421,Qr=r.d5433,Vi=r.dnodt,Po=r.domdt,po=r.del1,ys=r.del2,vs=r.del3,Yi=r.xfact,ji=r.xlamo,Ji=r.xli,Ua=r.xni,iw=.0043752690880113,Gm=.00015835218,qm=119459e-10;_i=0,Sr<.0052359877&&Sr>.0034906585&&(_i=1),Sr>=.00826&&Sr<=.00924&&Qe>=.5&&(_i=2);var bv=-qm*O*(r.sz21+r.sz23);(Zn<.052359877||Zn>Io-.052359877)&&(bv=0),0!==M&&(bv/=M);var ow=-Gm*h*(r.z21+r.z23);(Zn<.052359877||Zn>Io-.052359877)&&(ow=0),Po=r.ss4*qm*(r.sz31+r.sz33-6)-o*bv+r.s4*Gm*(r.z31+r.z33-6),Vi=bv,0!==M&&(Po-=o/M*ow,Vi+=ow/M);var sw=(r.gsto+r.tc*iw)%Yr;if(Qe+=(xr=r.ss1*qm*r.ss5+r.s1*Gm*r.s5)*fe,Zn+=(Ir=O*qm*(r.sz11+r.sz13)+h*Gm*(r.z11+r.z13))*fe,Nr+=Po*fe,Go+=Vi*fe,Kr+=(Xi=-qm*r.ss3*(r.sz1+r.sz3-14-6*Ve)-Gm*r.s3*(r.z1+r.z3-14-6*Ve))*fe,0!==_i){if(xs=Math.pow(Sr/mu,_v),2===_i){var HR=Qe,GR=Ve;Mi=(Qe=Ao)*(Ve=Bi),Qe<=.65?(yc=3.616-13.247*Qe+16.29*Ve,Rl=117.39*Qe-19.302-228.419*Ve+156.591*Mi,$a=109.7927*Qe-18.9068-214.6334*Ve+146.5816*Mi,$m=242.694*Qe-41.122-471.094*Ve+313.953*Mi,br=841.88*Qe-146.407-1629.014*Ve+1083.435*Mi,yv=3017.977*Qe-532.114-5740.032*Ve+3708.276*Mi):(yc=331.819*Qe-72.099-508.738*Ve+266.724*Mi,Rl=1582.851*Qe-346.844-2415.925*Ve+1246.113*Mi,$a=1554.908*Qe-342.585-2366.899*Ve+1215.972*Mi,$m=4758.686*Qe-1052.797-7193.992*Ve+3651.957*Mi,br=16178.11*Qe-3581.69-24462.77*Ve+12422.52*Mi,yv=Qe>.715?29936.92*Qe-5149.66-54087.36*Ve+31324.56*Mi:1464.74-4664.75*Qe+3763.64*Ve),Qe<.7?(vh=4988.61*Qe-919.2277-9064.77*Ve+5542.21*Mi,ew=4568.6173*Qe-822.71072-8491.4146*Ve+5337.524*Mi,nw=4690.25*Qe-853.666-8624.77*Ve+5341.4*Mi):(vh=161616.52*Qe-37995.78-229838.2*Ve+109377.94*Mi,ew=218913.95*Qe-51752.104-309468.16*Ve+146349.42*Mi,nw=170470.89*Qe-40023.88-242699.48*Ve+115605.82*Mi),Vn=(mo=17891679e-13*(Ol=Sr*Sr*3*(xs*xs)))*(Us=.75*(1+2*o+(bs=o*o)))*(-.306-.44*(Qe-.64)),mr=mo*(1.5*(vc=M*M))*yc,li=(mo=3.7393792e-7*(Ol*=xs))*(1.875*M*(1-2*o-3*bs))*Rl,Qn=mo*(-1.875*M*(1+2*o-3*bs))*$a,Wn=(mo=2*(Ol*=xs)*7.3636953e-9)*(35*vc*Us)*$m,gr=mo*(39.375*vc*vc)*br,jn=(mo=1.1428639e-7*(Ol*=xs))*(9.84375*M*(vc*(1-2*o-5*bs)+.33333333*(4*o-2+6*bs)))*yv,Mn=mo*(M*(4.92187512*vc*(-2-4*o+10*bs)+6.56250012*(1+2*o-3*bs)))*nw,Hr=(mo=2*Ol*2.1765803e-9)*(29.53125*M*(2-8*o+bs*(8*o-12+10*bs)))*ew,Qr=mo*(29.53125*M*(-2-8*o+bs*(12+8*o-10*bs)))*vh,ji=(Bn+Rn+Rn-(sw+sw))%Yr,Yi=Jr+Xi+2*(wi+Vi-iw)-pr,Qe=HR,Ve=GR}1===_i&&(Qi=1+o,ys=2*(po=3*Sr*Sr*xs*xs)*(Us=.75*(1+o)*(1+o))*(1+Ve*(.8125*Ve-2.5))*17891679e-13,vs=3*po*(Qi*=1.875*Qi*Qi)*(1+Ve*(6.60937*Ve-6))*2.2123015e-7*xs,po=po*(.9375*M*M*(1+3*o)-.75*(1+o))*(Rl=1+2*Ve)*21460748e-13*xs,ji=(Bn+Rn+s-sw)%Yr,Yi=Jr+Ur+Xi+Po+Vi-(pr+iw)),Ji=ji,Ua=pr,Wi=0,Sr=pr+0}return{em:Qe,argpm:Nr,inclm:Zn,mm:Kr,nm:Sr,nodem:Go,irez:_i,atime:Wi,d2201:Vn,d2211:mr,d3210:li,d3222:Qn,d4410:Wn,d4422:gr,d5220:jn,d5232:Mn,d5421:Hr,d5433:Qr,dedt:xr,didt:Ir,dmdt:Xi,dndt:0,dnodt:Vi,domdt:Po,del1:po,del2:ys,del3:vs,xfact:Yi,xlamo:ji,xli:Ji,xni:Ua}}({cosim:$,emsq:de,argpo:r.argpo,s1:Ei,s2:$r,s3:Fr,s4:zi,s5:gi,sinim:Y,ss1:Ao,ss2:Bi,ss3:Ve,ss4:Qe,ss5:Nr,sz1:Zn,sz3:Kr,sz11:Sr,sz13:Go,sz21:_i,sz23:Wi,sz31:Vn,sz33:mr,t:r.t,tc:0,gsto:r.gsto,mo:r.mo,mdot:r.mdot,no:r.no,nodeo:r.nodeo,nodedot:r.nodedot,xpidot:Hr,z1:xr,z3:Ir,z11:Xi,z13:Vi,z21:Po,z23:po,z31:ys,z33:vs,ecco:r.ecco,eccsq:yh,em:Qt,argpm:0,inclm:Jr,mm:0,nm:Rn,nodem:0,irez:r.irez,atime:r.atime,d2201:r.d2201,d2211:r.d2211,d3210:r.d3210,d3222:r.d3222,d4410:r.d4410,d4422:r.d4422,d5220:r.d5220,d5232:r.d5232,d5421:r.d5421,d5433:r.d5433,dedt:r.dedt,didt:r.didt,dmdt:r.dmdt,dnodt:r.dnodt,domdt:r.domdt,del1:r.del1,del2:r.del2,del3:r.del3,xfact:r.xfact,xlamo:r.xlamo,xli:r.xli,xni:r.xni});r.irez=br.irez,r.atime=br.atime,r.d2201=br.d2201,r.d2211=br.d2211,r.d3210=br.d3210,r.d3222=br.d3222,r.d4410=br.d4410,r.d4422=br.d4422,r.d5220=br.d5220,r.d5232=br.d5232,r.d5421=br.d5421,r.d5433=br.d5433,r.dedt=br.dedt,r.didt=br.didt,r.dmdt=br.dmdt,r.dnodt=br.dnodt,r.domdt=br.domdt,r.del1=br.del1,r.del2=br.del2,r.del3=br.del3,r.xfact=br.xfact,r.xlamo=br.xlamo,r.xli=br.xli,r.xni=br.xni}1!==r.isimp&&(r.d2=4*Ki*Mn*(st=r.cc1*r.cc1),r.d3=(17*Ki+cn)*(Qn=r.d2*Mn*r.cc1/3),r.d4=.5*Qn*Ki*Mn*(221*Ki+31*cn)*r.cc1,r.t3cof=r.d2+2*st,r.t4cof=.25*(3*r.d3+r.cc1*(12*r.d2+10*st)),r.t5cof=.2*(3*r.d4+12*r.cc1*r.d3+6*r.d2*r.d2+15*st*(2*r.d2+st)))}CF(r,0),r.init="n"}(m,{opsmode:"i",satn:m.satnum,epoch:m.jdsatepoch-2433281.5,xbstar:m.bstar,xecco:m.ecco,xargpo:m.argpo,xinclo:m.inclo,xmo:m.mo,xno:m.no,xnodeo:m.nodeo}),m}(this.tleLine1,this.tleLine2),m=function kj(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];var c=o[0],h=Array.prototype.slice.call(o,1);return CF(c,1440*(AR.apply(void 0,function Ij(r){return function Aj(r){if(Array.isArray(r))return PR(r)}(r)||function Pj(r){if(typeof Symbol<"u"&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function Rj(r,o){if(r){if("string"==typeof r)return PR(r,o);var s=Object.prototype.toString.call(r).slice(8,-1);if("Object"===s&&r.constructor&&(s=r.constructor.name),"Map"===s||"Set"===s)return Array.from(r);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return PR(r,o)}}(r)||function Oj(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(h))-c.jdsatepoch))}(c,s).position,w=function zj(r,o){for(var s=6378.137,h=Math.sqrt(r.x*r.x+r.y*r.y),m=(s-6356.7523142)/s,y=2*m-m*m,w=Math.atan2(r.y,r.x)-o;w<-Io;)w+=Yr;for(;w>Io;)w-=Yr;for(var F,S=0,O=Math.atan2(r.z,Math.sqrt(r.x*r.x+r.y*r.y));S<20;)F=1/Math.sqrt(1-y*(Math.sin(O)*Math.sin(O))),O=Math.atan2(r.z+s*F*y*Math.sin(O),h),S+=1;return{longitude:w,latitude:O,height:h/Math.cos(O)-s*F}}(m,MF(s)),M=function Lj(r){if(r<-Io/2||r>Io/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return TF(r)}(w.latitude),S=function Fj(r){if(r<-Io||r>Io)throw new RangeError("Longitude radians must be in range [-pi; pi].");return TF(r)}(w.longitude);this.coordinatesSubject.next({latitude:M,longitude:S,altitude:w.height})},100)}updateTLE(s,c,h){clearInterval(this.intervalId),this.tleLine1=s,this.tleLine2=c,this.updateSatelliteData(),this.updateSatelliteName(h)}updateSatelliteName(s){this.satelliteName=s,console.log("Nuevo nombre del sat\xe9lite:",this.satelliteName),this.satelliteNameSubject.next(this.satelliteName)}updateJson(s){console.log("Nuevo JSON del sat\xe9lite:",s),this.satelliteJson=s,this.satelliteJsonSubject.next(this.satelliteJson),console.log("Satellite JSON:",this.satelliteJson)}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275prov=Ie({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function IF(r,o,s,c,h,m,y){try{var w=r[m](y),M=w.value}catch(S){return void s(S)}w.done?o(M):Promise.resolve(M).then(c,h)}let AF=(()=>{class r{constructor(s,c){this.http=s,this.satelliteService=c,this.selectedSatellite="",this.satelliteInfo="",this.satelliteName="",this.satelliteJson=""}getSatelliteInfo(){var s=this;return function jj(r){return function(){var o=this,s=arguments;return new Promise(function(c,h){var m=r.apply(o,s);function y(M){IF(m,c,h,y,w,"next",M)}function w(M){IF(m,c,h,y,w,"throw",M)}y(void 0)})}}(function*(){if(s.selectedSatellite)try{const c=yield s.http.get(`https://us-central1-orbital-trackr.cloudfunctions.net/app/satellite/${s.selectedSatellite}`,{responseType:"text"}).toPromise();if(void 0!==c){s.satelliteInfo=c;const m=c.split(/\r?\n/).filter(y=>y.trim().length>0);if(m.length>=3){s.satelliteName=m[0].trim();const y=m[1].trim(),w=m[2].trim();s.satelliteService.updateTLE(y,w,s.satelliteName),s.satelliteService.updateSatelliteName(s.satelliteName)}else console.error("La respuesta del servidor no tiene el formato esperado")}else console.error("La respuesta del servidor est\xe1 vac\xeda");const h=yield s.http.get(`https://us-central1-orbital-trackr.cloudfunctions.net/app/info/${s.selectedSatellite}`).toPromise();void 0!==h&&h.length>0?s.satelliteService.updateJson(h[0]):console.error("La respuesta del servidor est\xe1 vac\xeda")}catch(c){console.error("Hubo un error al obtener la informaci\xf3n del sat\xe9lite:",c)}else console.error("Por favor, selecciona un sat\xe9lite")})()}static#t=this.\u0275fac=function(c){return new(c||r)(jt(Vk),jt(SF))};static#e=this.\u0275cmp=Ac({type:r,selectors:[["app-satellite-info"]],decls:13,vars:2,consts:[["id","satelliteSelector",3,"ngModel","ngModelChange"],["value","","disabled","","selected","","hidden",""],["value","SSOT"],["value","EROS C3"],["value","EROS B"],[3,"click"],["id","tleInfo"]],template:function(c,h){1&c&&(jo(0,"select",0),Uo("ngModelChange",function(y){return h.selectedSatellite=y}),jo(1,"option",1),nu(2,"Selecciona un sat\xe9lite"),fo(),jo(3,"option",2),nu(4,"SSOT"),fo(),jo(5,"option",3),nu(6,"EROS C3"),fo(),jo(7,"option",4),nu(8,"EROS B"),fo()(),jo(9,"button",5),Uo("click",function(){return h.getSatelliteInfo()}),nu(10,"Obtener TLE"),fo(),jo(11,"div",6),nu(12),fo()),2&c&&(jd("ngModel",h.selectedSatellite),function Co(r){L_(Dn(),Ot(),ao()+r,!1)}(12),c1(h.satelliteInfo))},dependencies:[XL,JL,zD,TL,QP]})}return r})(),PF=(()=>{class r{constructor(s){this.satelliteService=s,this.mapInitialized=!1,this.satelliteJson=""}ngOnInit(){this.satelliteSubscription=this.satelliteService.coordinates$.subscribe(s=>{this.satelliteCoordinates=s,this.updateMarkerPosition(),this.initializeMap()}),this.satelliteService.satelliteName$.subscribe(s=>{this.satelliteName=s,this.mapInitialized&&this.addOrUpdateMarker()}),this.satelliteService.satelliteJson$.subscribe(s=>{this.satelliteJson=s,this.mapInitialized&&this.addOrUpdateMarker()})}ngOnDestroy(){this.satelliteSubscription&&this.satelliteSubscription.unsubscribe()}ngAfterViewInit(){this.initializeMap()}initializeMap(){this.mapInitialized||(tw().accessToken="pk.eyJ1Ijoic2hpemExOTkxIiwiYSI6ImNscWZ5eGo0ZTE0NGUya3F3eDA5bzh6bXoifQ.ru0c29-QaQzDC_AefTP9tA",this.satelliteSubscription=this.satelliteService.coordinates$.subscribe(s=>{this.satelliteCoordinates=s,this.satelliteCoordinates&&!this.map&&(this.map=new(tw().Map)({container:"map",style:"mapbox://styles/shiza1991/clqrjzve800ld01pd59dg9y7s",center:[s.longitude,s.latitude],zoom:2}),this.map.addControl(new(tw().NavigationControl)),this.map.on("load",()=>{this.mapInitialized=!0,this.addOrUpdateMarker()}))}))}updateMarkerPosition(){if(this.mapInitialized&&this.map&&this.satelliteCoordinates){this.addOrUpdateMarker();const{latitude:s,longitude:c}=this.satelliteCoordinates;this.map.flyTo({center:[c,s],essential:!1}),this.addOrUpdateMarker()}}addOrUpdateMarker(){if(!(this.map&&this.satelliteCoordinates&&this.satelliteName&&this.satelliteJson))return;const{latitude:s,longitude:c}=this.satelliteCoordinates,h=document.createElement("div");if(h.className="custom-marker",h.style.backgroundImage="url('../../assets/img/fasat.png')",h.style.width="150px",h.style.height="150px",h.style.backgroundSize="contain",h.style.backgroundPosition="center center",h.style.backgroundRepeat="no-repeat",h.style.cursor="pointer",this.marker){this.marker.setLngLat([c,s]);const m=this.marker.getElement().querySelector("#satelliteNameLabel");m&&(m.innerHTML=this.satelliteName);const y=`\n\n        <h2>${this.satelliteJson.OBJECT_NAME}</h2>  \n        <table style="font-size: 6px; border-collapse: collapse; padding:0px">\n        <tr>\n            <td><strong>OBJECT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.OBJECT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ECCENTRICITY:</strong></td>\n            <td><pre>${this.satelliteJson.ECCENTRICITY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>INCLINATION:</strong></td>\n            <td><pre>${this.satelliteJson.INCLINATION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>RA_OF_ASC_NODE:</strong></td>\n            <td><pre>${this.satelliteJson.RA_OF_ASC_NODE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ARG_OF_PERICENTER:</strong></td>\n            <td><pre>${this.satelliteJson.ARG_OF_PERICENTER}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_ANOMALY:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_ANOMALY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPHEMERIS_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.EPHEMERIS_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>CLASSIFICATION_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.CLASSIFICATION_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>NORAD_CAT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.NORAD_CAT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ELEMENT_SET_NO:</strong></td>\n            <td><pre>${this.satelliteJson.ELEMENT_SET_NO}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>REV_AT_EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.REV_AT_EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>BSTAR:</strong></td>\n            <td><pre>${this.satelliteJson.BSTAR}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DOT}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DDOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DDOT}</pre></td>\n        </tr>\n        </table>`,w=this.marker.getPopup();w&&w.setHTML(y)}else{this.marker=new(tw().Marker)(h).setLngLat([c,s]).addTo(this.map),this.map.flyTo({center:[c,s],essential:!0}),this.addOrUpdateMarker();const m=document.createElement("div");m.id="satelliteNameLabel",m.innerHTML=this.satelliteJson.OBJECT_NAME,m.style.color="#ffffff",m.style.fontSize="10px",m.style.height="25px",m.style.textAlign="center",m.style.backgroundColor="#000000",m.style.padding="5px",m.style.borderRadius="5px",m.style.width="70px",m.style.display="flex",m.style.justifyContent="center",m.style.alignItems="center",this.marker.getElement().appendChild(m);const y=new(tw().Popup)({closeButton:!1}).setHTML(`\n\n        <h6>${this.satelliteJson.OBJECT_NAME}</h6>  \n        <table>\n        <tr>\n            <td><strong>OBJECT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.OBJECT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ECCENTRICITY:</strong></td>\n            <td><pre>${this.satelliteJson.ECCENTRICITY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>INCLINATION:</strong></td>\n            <td><pre>${this.satelliteJson.INCLINATION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>RA_OF_ASC_NODE:</strong></td>\n            <td><pre>${this.satelliteJson.RA_OF_ASC_NODE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ARG_OF_PERICENTER:</strong></td>\n            <td><pre>${this.satelliteJson.ARG_OF_PERICENTER}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_ANOMALY:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_ANOMALY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPHEMERIS_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.EPHEMERIS_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>CLASSIFICATION_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.CLASSIFICATION_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>NORAD_CAT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.NORAD_CAT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ELEMENT_SET_NO:</strong></td>\n            <td><pre>${this.satelliteJson.ELEMENT_SET_NO}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>REV_AT_EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.REV_AT_EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>BSTAR:</strong></td>\n            <td><pre>${this.satelliteJson.BSTAR}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DOT}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DDOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DDOT}</pre></td>\n        </tr>\n        </table>\n        `);this.marker.setPopup(y),this.marker.getElement().addEventListener("click",()=>{this.marker?.getPopup&&this.marker.getPopup().remove()})}}static#t=this.\u0275fac=function(c){return new(c||r)(jt(SF))};static#e=this.\u0275cmp=Ac({type:r,selectors:[["app-satellite-map"]],decls:2,vars:0,consts:[["id","map",1,"map-container"]],template:function(c,h){1&c&&Ud(0,"app-satellite-info")(1,"div",0)},dependencies:[AF],styles:[".map-container[_ngcontent-%COMP%]{margin-top:3%;margin-left:5%;height:600px;width:90%;align-items:center}.mapboxgl-map[_ngcontent-%COMP%]{font:9px/15px Helvetica Neue,Arial,Helvetica,sans-serif}@media (max-width: 768px){.map-container[_ngcontent-%COMP%]{height:600px;overflow:hidden}}"]})}return r})();const Uj=[{path:"satellite",component:PF},{path:"satelliteInfo",component:AF}];let $j=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275mod=Fo({type:r});static#n=this.\u0275inj=Yo({imports:[dF.forRoot(Uj),dF]})}return r})(),Hj=(()=>{class r{constructor(){this.title="Orbital"}static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275cmp=Ac({type:r,selectors:[["app-root"]],decls:2,vars:0,consts:[[1,"app-container"]],template:function(c,h){1&c&&(jo(0,"div",0),Ud(1,"app-satellite-map"),fo())},dependencies:[PF],styles:[".app-container[_ngcontent-%COMP%]{margin-top:5%;justify-content:center;align-items:center;height:100vh;text-align:center}"]})}return r})(),Gj=(()=>{class r{static#t=this.\u0275fac=function(c){return new(c||r)};static#e=this.\u0275mod=Fo({type:r,bootstrap:[Hj]});static#n=this.\u0275inj=Yo({imports:[hB,$j,jB,Y4]})}return r})();cB().bootstrapModule(Gj).catch(r=>console.error(r))},574:function(wv){wv.exports=function(){"use strict";var xh,gu,sr;function wf(Xt,it){if(xh)if(gu){var la="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+xh+")(sharedChunk); ("+gu+")(sharedChunk); self.onerror = null;",Ha={};xh(Ha),sr=it(Ha),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(sr.workerUrl=window.URL.createObjectURL(new Blob([la],{type:"text/javascript"})))}else gu=it;else xh=it}return wf(0,function(Xt){var it=typeof self<"u"?self:{},la="3.0.1";let Ha;const ke={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ha){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ha=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch{Ha=e}}return Ha},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ke.API_URL)return null;try{const e=new URL(ke.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},ws={supported:!1,testSupport:function(e){!_u&&kl&&(xc?Zm(e):ca=e)}};let ca,kl,_u=!1,xc=!1;function Zm(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,kl),e.isContextLost())return;ws.supported=!0}catch{}e.deleteTexture(t),_u=!0}it.document&&(kl=it.document.createElement("img"),kl.onload=function(){ca&&Zm(ca),ca=null,xc=!0},kl.onerror=function(){_u=!0,ca=null},kl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ef="01";function Zo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ga=qa;function qa(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}qa.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var a=this.sampleCurveX(n)-e;if(Math.abs(a)<t)return n;var l=this.sampleCurveDerivativeX(n);if(Math.abs(l)<1e-6)break;n-=a/l}var u=0,d=1;for(n=e,i=0;i<20&&(a=this.sampleCurveX(n),!(Math.abs(a-e)<t));i++)e>a?u=n:d=n,n=.5*(d-u)+u;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Wm=Zo(Ga),bc=Za;function Za(e,t){this.x=e,this.y=t}Za.prototype={clone:function(){return new Za(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),a=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Za.convert=function(e){return e instanceof Za?e:Array.isArray(e)?new Za(e[0],e[1]):e};var tt=Zo(bc);function tn(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!tn(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!tn(e[n],t[n]))return!1;return!0}return e===t}const yu=Math.PI/180,Wa=180/Math.PI;function Ee(e){return e*yu}function ti(e){return e*Wa}const Mv=[[0,0],[1,0],[1,1],[0,1]];function wc(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Xa(e){let t=1/0,n=1/0,i=-1/0,a=-1/0;for(const l of e)t=Math.min(t,l.x),n=Math.min(n,l.y),i=Math.max(i,l.x),a=Math.max(a,l.y);return{min:new tt(t,n),max:new tt(i,a)}}function vu(e,t,n=0,i=!0){const a=new tt(n,n),l=e.sub(a),u=t.add(a),d=[l,new tt(u.x,l.y),u,new tt(l.x,u.y)];return i&&d.push(l.clone()),d}function Ec(e,t,n,i){const a=new Wm(e,t,n,i);return function(l){return a.solve(l)}}const Un=Ec(.25,.1,.25,1);function Wt(e,t,n){return Math.min(n,Math.max(t,e))}function Ya(e,t,n){return(n=Wt((n-e)/(t-e),0,1))*n*(3-2*n)}function Ja(e,t,n){const i=n-t,a=((e-t)%i+i)%i+t;return a===t?n:a}function xu(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const a=new Array(e.length);let l=null;e.forEach((u,d)=>{t(u,(f,p)=>{f&&(l=f),a[d]=p,0==--i&&n(l,a)})})}function vi(e){const t=[];for(const n in e)t.push(e[n]);return t}function qt(e,...t){for(const n of t)for(const i in n)e[i]=n[i];return e}function Ro(e,t){const n={};for(let i=0;i<t.length;i++){const a=t[i];a in e&&(n[a]=e[a])}return n}let ci=1;function Ar(){return ci++}function Xm(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function On(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function bh(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function ui(e,t){e.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function Mc(e,t){return-1!==e.indexOf(t,e.length-t.length)}function wh(e,t,n){const i={};for(const a in e)i[a]=t.call(n||this,e[a],a,e);return i}function It(e,t,n){const i={};for(const a in e)t.call(n||this,e[a],a,e)&&(i[a]=e[a]);return i}function U(e){return Array.isArray(e)?e.map(U):"object"==typeof e&&e?wh(e,U):e}const q={};function K(e){q[e]||(typeof console<"u"&&console.warn(e),q[e]=!0)}function vt(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Et(e){let t=0;for(let n,i,a=0,l=e.length,u=l-1;a<l;u=a++)n=e[a],i=e[u],t+=(i.x-n.x)*(n.y+i.y);return t}function $t([e,t,n]){const i=Ee(t+90),a=Ee(n);return{x:e*Math.cos(i)*Math.sin(a),y:e*Math.sin(i)*Math.sin(a),z:e*Math.cos(a),azimuthal:t,polar:n}}function Yt(e,t,n){const i=Math.sqrt(e*e+t*t+n*n),a=i>0?Math.acos(n/i)*Wa:0;let l=0!==e||0!==t?Math.atan2(-t,-e)*Wa+90:0;return l<0&&(l+=360),[i,l,a]}function wt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ee(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,i,a,l)=>{const u=a||l;return t[i]=!u||u.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let me=null;function ge(){return!!it.document.fullscreenElement||!!it.document.webkitFullscreenElement}function In(e){try{const t=it[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function _r(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function xi(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function yr(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function Fn(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const Nn="mapbox-tiles";let Oo,ua,to=500,go=50;function Eh(){try{return it.caches}catch{}}function Wo(){Eh()&&!Oo&&(Oo=it.caches.open(Nn))}function Ll(e){const t=e.indexOf("?");if(t<0)return e;const i=function(a){const l=a.indexOf("?");return l>0?a.slice(l+1).split("&"):[]}(e).filter(a=>{const l=a.split("=");return"language"===l[0]||"worldview"===l[0]});return i.length?`${e.slice(0,t)}?${i.join("&")}`:e.slice(0,t)}let Cc=1/0;function Mh(e){Cc++,Cc>go&&(e.getActor().send("enforceCacheSizeLimit",to),Cc=0)}const ft={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(ft);class yt extends Error{constructor(t,n,i){401===n&&fn(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=n,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ct=wt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===it.location.protocol?it.parent:it).location.href,Pt=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Ct())&&!/^\w+:/.test(n))){if(it.fetch&&it.Request&&it.AbortController&&it.Request.prototype.hasOwnProperty("signal"))return function(i,a){const l=new it.AbortController,u=new it.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Ct(),referrerPolicy:i.referrerPolicy,signal:l.signal});let d=!1,f=!1;const p=(g=u.url).indexOf("sku=")>0&&fn(g);var g;"json"===i.type&&u.headers.set("Accept","application/json");const _=(x,b,E)=>{if(f)return;if(x&&"SecurityError"!==x.message&&K(x.toString()),b&&E)return v(b);const T=Date.now();it.fetch(u).then(C=>{if(C.ok){const D=p?C.clone():null;return v(C,D,T)}return a(new yt(C.statusText,C.status,i.url))}).catch(C=>{"AbortError"!==C.name&&a(new Error(`${C.message} ${i.url}`))})},v=(x,b,E)=>{("arrayBuffer"===i.type?x.arrayBuffer():"json"===i.type?x.json():x.text()).then(T=>{f||(b&&E&&function(C,D,A){if(Wo(),!Oo)return;const P={status:D.status,statusText:D.statusText,headers:new it.Headers};D.headers.forEach((k,L)=>P.headers.set(L,k));const I=ee(D.headers.get("Cache-Control")||"");if(I["no-store"])return;I["max-age"]&&P.headers.set("Expires",new Date(A+1e3*I["max-age"]).toUTCString());const R=P.headers.get("Expires");R&&(new Date(R).getTime()-A<42e4||function(k,L){if(void 0===ua)try{new Response(new ReadableStream),ua=!0}catch{ua=!1}ua?L(k.body):k.blob().then(L)}(D,k=>{const L=new it.Response(k,P);Wo(),Oo&&Oo.then(N=>N.put(Ll(C.url),L)).catch(N=>K(N.message))}))}(u,b,E),d=!0,a(null,T,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(T=>{f||a(new Error(T.message))})};return p?function(x,b){if(Wo(),!Oo)return b(null);const E=Ll(x.url);Oo.then(T=>{T.match(E).then(C=>{const D=function(A){if(!A)return!1;const P=new Date(A.headers.get("Expires")||0),I=ee(A.headers.get("Cache-Control")||"");return P>Date.now()&&!I["no-cache"]}(C);T.delete(E),D&&T.put(E,C.clone()),b(null,C,D)}).catch(b)}).catch(b)}(u,_):_(null,null),{cancel:()=>{f=!0,d||l.abort()}}}(e,t);if(wt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(i,a){const l=new it.XMLHttpRequest;l.open(i.method||"GET",i.url,!0),"arrayBuffer"===i.type&&(l.responseType="arraybuffer");for(const u in i.headers)l.setRequestHeader(u,i.headers[u]);return"json"===i.type&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials="include"===i.credentials,l.onerror=()=>{a(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||0===l.status)&&null!==l.response){let u=l.response;if("json"===i.type)try{u=JSON.parse(l.response)}catch(d){return a(d)}a(null,u,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else a(new yt(l.statusText,l.status,i.url))},l.send(i.body),{cancel:()=>l.abort()}}(e,t)},At=function(e,t){return Pt(qt(e,{type:"json"}),t)},kt=function(e,t){return Pt(qt(e,{type:"arrayBuffer"}),t)};function Bt(e){const t=it.document.createElement("a");return t.href=e,t.protocol===it.document.location.protocol&&t.host===it.document.location.host}const Rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Zt,Lt;Zt=[],Lt=0;const Te=function(e,t){if(ws.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Lt>=ke.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Zt.push(l),l}Lt++;let n=!1;const i=()=>{if(!n)for(n=!0,Lt--;Zt.length&&Lt<ke.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Zt.shift(),{requestParameters:u,callback:d,cancelled:f}=l;f||(l.cancel=Te(u,d).cancel)}},a=kt(e,(l,u,d,f)=>{i(),l?t(l):u&&(it.createImageBitmap?function(p,g){const _=new it.Blob([new Uint8Array(p)],{type:"image/png"});it.createImageBitmap(_).then(v=>{g(null,v)}).catch(v=>{g(new Error(`Could not load image because of ${v.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(u,(p,g)=>t(p,g,d,f)):function(p,g){const _=new it.Image,v=it.URL;_.onload=()=>{g(null,_),v.revokeObjectURL(_.src),_.onload=null,it.requestAnimationFrame(()=>{_.src=Rt})},_.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const x=new it.Blob([new Uint8Array(p)],{type:"image/png"});_.src=p.byteLength?v.createObjectURL(x):Rt}(u,(p,g)=>t(p,g,d,f)))});return{cancel:()=>{a.cancel(),i()}}},mn="NO_ACCESS_TOKEN";class re{constructor(t,n,i){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let i=0;i<10;i++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ef,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!dn(t))return t;const i=ei(t);return i.params.push(`sdk=js-${la}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!dn(t))return t;const i=ei(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeModelURL(t,n){if(!dn(t))return t;const i=ei(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeSourceURL(t,n,i,a){if(!dn(t))return t;const l=ei(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),i&&l.params.push(`language=${i}`),a&&l.params.push(`worldview=${a}`),this._makeAPIURL(l,this._customAccessToken||n)}normalizeSpriteURL(t,n,i,a){const l=ei(t);return dn(t)?(l.path=`/styles/v1${l.path}/sprite${n}${i}`,this._makeAPIURL(l,this._customAccessToken||a)):(l.path+=`${n}${i}`,ko(l))}normalizeTileURL(t,n,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!dn(t))return t;const a=ei(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||i&&"raster"!==a.authority&&512===i?"@2x":""}${ws.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${ke.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${ke.TILE_URL_VERSION}${a.path}`);const l=this._customAccessToken||function(u){for(const d of u){const f=d.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(a.params)||ke.ACCESS_TOKEN;return ke.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,l)}canonicalizeTileURL(t,n){const i=ei(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${ke.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${ke.TILE_URL_VERSION}/`,"")}`;let l=i.params;return n&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(a+=`?${l.join("&")}`),a}canonicalizeTileset(t,n){const i=!!n&&dn(n),a=[];for(const l of t.tiles||[])fn(l)?a.push(this.canonicalizeTileURL(l,i)):a.push(l);return a}_makeAPIURL(t,n){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=ei(ke.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,"http"===t.protocol){const l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if("/"!==a.path&&(t.path=`${a.path}${t.path}`),!ke.REQUIRE_ACCESS_TOKEN)return ko(t);if(n=n||ke.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===n[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(l=>-1===l.indexOf("access_token")),t.params.push(`access_token=${n||""}`),ko(t)}}function dn(e){return 0===e.indexOf("mapbox:")}function fn(e){return ke.API_URL_REGEX.test(e)}function Tr(e){return ke.API_CDN_URL_REGEX.test(e)}function Gr(e){return ke.API_STYLE_REGEX.test(e)&&!eo(e)}function eo(e){return ke.API_SPRITE_REGEX.test(e)}const Hs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ei(e){const t=e.match(Hs);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ko(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const no="mapbox.eventData";function Xo(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(it.atob(t[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Tc{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=Xo(ke.ACCESS_TOKEN);let i="";return i=n&&n.u?it.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(a,l)=>String.fromCharCode(+("0x"+l)))):ke.ACCESS_TOKEN||"",t?`${no}.${t}:${i}`:`${no}:${i}`}fetchEventData(){const t=In("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const a=it.localStorage.getItem(n);a&&(this.eventData=JSON.parse(a));const l=it.localStorage.getItem(i);l&&(this.anonId=l)}catch{K("Unable to read from LocalStorage")}}saveEventData(){const t=In("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{it.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&it.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{K("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,i,a){if(!ke.EVENTS_URL)return;const l=ei(ke.EVENTS_URL);l.params.push(`access_token=${a||ke.ACCESS_TOKEN||""}`);const u={event:this.type,created:new Date(t).toISOString()},d=n?qt(u,n):u,f={url:ko(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([d])};var g;this.pendingRequest=(g=p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(a)},Pt(qt(f,{method:"POST"}),g))}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const ni=new class extends Tc{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){ke.EVENTS_URL&&ke.ACCESS_TOKEN&&Array.isArray(e)&&e.some(n=>dn(n)||fn(n))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Xo(ke.ACCESS_TOKEN),n=t?t.u:ke.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;bh(this.anonId)||(this.anonId=Xm(),i=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const l=new Date(this.eventData.lastSuccess),u=new Date(a),d=(a-this.eventData.lastSuccess)/864e5;i=i||d>=1||d<-1||l.getDate()!==u.getDate()}else i=!0;i?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:la,skuId:Ef,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)},e):this.processRequests()}},Dc=ni.postTurnstileEvent.bind(ni),ha=new class extends Tc{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,i){this.skuToken=t,this.errorCb=i,ke.EVENTS_URL&&(n||ke.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(mn)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),bh(this.anonId)||(this.anonId=Xm()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:la,skuId:Ef,skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):t&&(this.success[t]=!0)},e))}},qR=ha.postMapLoadEvent.bind(ha),aw=new class extends Tc{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){ke.EVENTS_URL&&(e||ke.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:n}=this.queue.shift(),i=function(a){const l=it.performance.getEntriesByType("resource"),u=it.performance.getEntriesByType("mark"),d=function(v){const x={};if(v)for(const b in v)if("other"!==b)for(const E of v[b]){const T=`${b}ResolveRangeMin`,C=`${b}ResolveRangeMax`,D=`${b}RequestCount`,A=`${b}RequestCachedCount`;x[T]=Math.min(x[T]||1/0,E.startTime),x[C]=Math.max(x[C]||-1/0,E.responseEnd);const P=I=>{void 0===x[I]&&(x[I]=0),++x[I]};void 0!==E.transferSize&&0===E.transferSize&&P(A),P(D)}return x}(function(v,x){const b={};if(v)for(const E of v){const T=x(E);void 0===b[T]&&(b[T]=[]),b[T].push(E)}return b}(l,s2)),f=it.devicePixelRatio,p=it.navigator.connection||it.navigator.mozConnection||it.navigator.webkitConnection,g={counters:[],metadata:[],attributes:[]},_=(v,x,b)=>{null!=b&&v.push({name:x,value:b.toString()})};for(const v in d)_(g.counters,v,d[v]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(_(g.counters,"interactionRangeMin",a.interactionRange[0]),_(g.counters,"interactionRangeMax",a.interactionRange[1])),u)for(const v of Object.keys(Mf)){const x=Mf[v],b=u.find(E=>E.name===x);b&&_(g.counters,x,b.startTime)}return _(g.counters,"visibilityHidden",a.visibilityHidden),_(g.attributes,"style",function(v){if(v)for(const x of v){const b=x.name.split("?")[0];if(Gr(b)){const E=b.split("/").slice(-2);if(2===E.length)return`mapbox://styles/${E[0]}/${E[1]}`}}}(l)),_(g.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),_(g.attributes,"fogEnabled",a.fogEnabled?"true":"false"),_(g.attributes,"projection",a.projection),_(g.attributes,"zoom",a.zoom),_(g.metadata,"devicePixelRatio",f),_(g.metadata,"connectionEffectiveType",p?p.effectiveType:void 0),_(g.metadata,"navigatorUserAgent",it.navigator.userAgent),_(g.metadata,"screenWidth",it.screen.width),_(g.metadata,"screenHeight",it.screen.height),_(g.metadata,"windowWidth",it.innerWidth),_(g.metadata,"windowHeight",it.innerHeight),_(g.metadata,"mapWidth",a.width/f),_(g.metadata,"mapHeight",a.height/f),_(g.metadata,"webglRenderer",a.renderer),_(g.metadata,"webglVendor",a.vendor),_(g.metadata,"sdkVersion",la),_(g.metadata,"sdkIdentifier","mapbox-gl-js"),g}(n);for(const a of i.metadata);for(const a of i.counters);for(const a of i.attributes);this.postEvent(t,i,()=>{},e)}},o2=aw.postPerformanceEvent.bind(aw),Ym=new class extends Tc{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,i){if(!ke.API_URL||!ke.SESSION_PATH)return;const a=ei(ke.API_URL+ke.SESSION_PATH);a.params.push(`sku=${t||""}`),a.params.push(`access_token=${i||ke.ACCESS_TOKEN||""}`);const l={url:ko(a),headers:{"Content-Type":"text/plain"}};var d;this.pendingRequest=(d=u=>{this.pendingRequest=null,n(u),this.saveEventData(),this.processRequests(i)},Pt(qt(l,{method:"GET"}),d))}getSessionAPI(e,t,n,i){this.skuToken=t,this.errorCb=i,ke.SESSION_PATH&&ke.API_URL&&(n||ke.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(mn)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):t&&(this.success[t]=!0)},e)}},lw=Ym.getSessionAPI.bind(Ym),Sc=new Set;function cw(e,t){t?Sc.add(e):Sc.delete(e)}const Mf={create:"create",load:"load",fullLoad:"fullLoad"},Cv={mark(e){it.performance.mark(e)},measure(e,t,n){it.performance.measure(e,t,n)}};function s2(e){const t=e.name.split("?")[0];return Tr(t)&&t.includes("mapbox-gl.js")?"javascript":Tr(t)&&t.includes("mapbox-gl.css")?"css":ke.API_FONTS_REGEX.test(t)?"fontRange":eo(t)?"sprite":Gr(t)?"style":ke.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const a2=it.performance;function uw(e){const t=e?e.url.toString():void 0;return a2.getEntriesByName(t)}var hw=Jm;function Jm(e){return t=e,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var i,a,l=new Blob([""],{type:"text/javascript"}),u=URL.createObjectURL(l);try{a=new Worker(u),i=!0}catch{i=!1}return a&&a.terminate(),URL.revokeObjectURL(u),i}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var i=document.createElement("canvas");i.width=i.height=1;var a=i.getContext("2d");if(!a)return!1;var l=a.getImageData(0,0,1,1);return l&&l.width===i.width}()||(void 0===Tv[n=t&&t.failIfMajorPerformanceCaveat]&&(Tv[n]=function(i){var a,u,d,f,l=(u=i,d=document.createElement("canvas"),(f=Object.create(Jm.webGLContextAttributes)).failIfMajorPerformanceCaveat=u,d.getContext("webgl",f)||d.getContext("experimental-webgl",f));if(!l)return!1;try{a=l.createShader(l.VERTEX_SHADER)}catch{return!1}return!(!a||l.isContextLost())&&(l.shaderSource(a,"void main() {}"),l.compileShader(a),!0===l.getShaderParameter(a,l.COMPILE_STATUS))}(n)),!Tv[n]||document.documentMode));var t,n}var Tv={};let Km,hi,Qm,Ui;Jm.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ft={now:()=>void 0!==Qm?Qm:it.performance.now(),setNow(e){Qm=e},restoreNow(){Qm=void 0},frame(e){const t=it.requestAnimationFrame(e);return{cancel:()=>it.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:n,height:i}=e;Ui||(Ui=it.document.createElement("canvas"));const a=Ui.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(n>Ui.width||i>Ui.height)&&(Ui.width=n,Ui.height=i),a.clearRect(-t,-t,n+2*t,i+2*t),a.drawImage(e,0,0,n,i),a.getImageData(-t,-t,n+2*t,i+2*t)},resolveURL:e=>(Km||(Km=it.document.createElement("a")),Km.href=e,Km.href),get devicePixelRatio(){return it.devicePixelRatio},get prefersReducedMotion(){return!!it.matchMedia&&(null==hi&&(hi=it.matchMedia("(prefers-reduced-motion: reduce)")),hi.matches)}};function Tn(e,t,n){const i=it.document.createElement(e);return void 0!==t&&(i.className=t),n&&n.appendChild(i),i}function da(e,t,n){const i=it.document.createElementNS("http://www.w3.org/2000/svg",e);for(const a of Object.keys(t))i.setAttributeNS(null,a,t[a]);return n&&n.appendChild(i),i}const ro=it.document&&it.document.documentElement.style,Cf=ro&&void 0!==ro.userSelect?"userSelect":"WebkitUserSelect";let dw;function tr(){ro&&Cf&&(dw=ro[Cf],ro[Cf]="none")}function Tf(){ro&&Cf&&(ro[Cf]=dw)}function di(e){e.preventDefault(),e.stopPropagation(),it.removeEventListener("click",di,!0)}function Df(){it.addEventListener("click",di,!0),it.setTimeout(()=>{it.removeEventListener("click",di,!0)},0)}function Sf(e,t){const n=e.getBoundingClientRect();return tg(e,n,t)}function ar(e,t){const n=e.getBoundingClientRect(),i=[];for(let a=0;a<t.length;a++)i.push(tg(e,n,t[a]));return i}function qe(e){return void 0!==it.InstallTrigger&&2===e.button&&e.ctrlKey&&it.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function tg(e,t,n){const i=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new tt((n.clientX-t.left)*i,(n.clientY-t.top)*i)}function eg(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function fw(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class Mt{constructor(t,n={}){qt(this,n),this.type=t}}class pt extends Mt{constructor(t,n={}){super("error",qt({error:t},n))}}class wr{on(t,n){return this._listeners=this._listeners||{},eg(t,n,this._listeners),this}off(t,n){return fw(t,n,this._listeners),fw(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},eg(t,n,this._oneTimeListeners),this):new Promise(i=>this.once(t,i))}fire(t,n){"string"==typeof t&&(t=new Mt(t,n||{}));const i=t.type;if(this.listens(i)){t.target=this;const a=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const d of a)d.call(this,t);const l=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const d of l)fw(i,d,this._oneTimeListeners),d.call(this,t);const u=this._eventedParent;u&&(qt(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof pt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var J=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Dt{constructor(t,n,i,a){this.message=(t?`${t}: `:"")+i,a&&(this.identifier=a),null!=n&&n.__line__&&(this.line=n.__line__)}}class bu extends Dt{}function Ic(e,...t){for(const n of t)for(const i in n)e[i]=n[i];return e}function qr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function fa(e){if(Array.isArray(e))return e.map(fa);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=fa(e[n]);return t}return qr(e)}class Es extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var Fl=Es;class Dv{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[i,a]of n)this.bindings[i]=a}concat(t){return new Dv(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var ZR=Dv;const Gs={kind:"null"},Ht={kind:"number"},nn={kind:"string"},un={kind:"boolean"},pa={kind:"color"},Ch={kind:"object"},on={kind:"value"},ng={kind:"collator"},rg={kind:"formatted"},_o={kind:"resolvedImage"};function be(e,t){return{kind:"array",itemType:e,N:t}}function Zr(e){if("array"===e.kind){const t=Zr(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const WR=[Gs,Ht,nn,un,pa,rg,Ch,be(on),_o];function ig(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ig(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const n of WR)if(!ig(n,t))return null}return`Expected ${Zr(e)} but found ${Zr(t)} instead.`}function Ie(e,t){return t.some(n=>n.kind===e.kind)}function og(e,t){return t.some(n=>"null"===n?null===e:"array"===n?Array.isArray(e):"object"===n?e&&!Array.isArray(e)&&"object"==typeof e:n===typeof e)}var Yo,If={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function sg(e){return(e=Math.round(e))<0?0:e>255?255:e}function ag(e){return sg("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function lg(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Th(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{Yo={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in If)return If[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var i=n.indexOf("("),a=n.indexOf(")");if(-1!==i&&a+1===n.length){var l=n.substr(0,i),u=n.substr(i+1,a-(i+1)).split(","),d=1;switch(l){case"rgba":if(4!==u.length)return null;d=lg(u.pop());case"rgb":return 3!==u.length?null:[ag(u[0]),ag(u[1]),ag(u[2]),d];case"hsla":if(4!==u.length)return null;d=lg(u.pop());case"hsl":if(3!==u.length)return null;var f=(parseFloat(u[0])%360+360)%360/360,p=lg(u[1]),g=lg(u[2]),_=g<=.5?g*(p+1):g+p-g*p,v=2*g-_;return[sg(255*Th(v,_,f+1/3)),sg(255*Th(v,_,f)),sg(255*Th(v,_,f-1/3)),d];default:return null}}return null}}catch{}class io{constructor(t,n,i,a=1){this.r=t,this.g=n,this.b=i,this.a=a}static parse(t){if(!t)return;if(t instanceof io)return t;if("string"!=typeof t)return;const n=Yo(t);return n?new io(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,i,a]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(i)},${a})`}toArray(){const{r:t,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[255*t/a,255*n/a,255*i/a,a]}toArray01(){const{r:t,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[t/a,n/a,i/a,a]}toArray01Scaled(t){const{r:n,g:i,b:a,a:l}=this;return 0===l?[0,0,0]:[n/l*t,i/l*t,a/l*t]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:i,a}=this;return[t,n,i,a]}toArray01Linear(){const{r:t,g:n,b:i,a}=this;return 0===a?[0,0,0,0]:[Math.pow(t/a,2.2),Math.pow(n/a,2.2),Math.pow(i/a,2.2),a]}}io.black=new io(0,0,0,1),io.white=new io(1,1,1,1),io.transparent=new io(0,0,0,0),io.red=new io(1,0,0,1),io.blue=new io(0,0,1,1);var Ae=io;class cg{constructor(t,n,i){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Sv{constructor(t,n,i,a,l){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=i,this.fontStack=a,this.textColor=l}}class He{constructor(t){this.sections=t}static fromString(t){return new He([new Sv(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length)}static factory(t){return t instanceof He?t:He.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.namePrimary]);continue}t.push(n.text);const i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}return t}}class Jo{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,n){return t?new Jo({namePrimary:t,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Iv(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ci(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Ae||e instanceof cg||e instanceof He||e instanceof Jo)return!0;if(Array.isArray(e)){for(const t of e)if(!Ci(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Ci(e[t]))return!1;return!0}return!1}function ri(e){if(null===e)return Gs;if("string"==typeof e)return nn;if("boolean"==typeof e)return un;if("number"==typeof e)return Ht;if(e instanceof Ae)return pa;if(e instanceof cg)return ng;if(e instanceof He)return rg;if(e instanceof Jo)return _o;if(Array.isArray(e)){const t=e.length;let n;for(const i of e){const a=ri(i);if(n){if(n===a)continue;n=on;break}n=a}return be(n||on,t)}return Ch}function ug(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ae||e instanceof He||e instanceof Jo?e.toString():JSON.stringify(e)}class vr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(2!==t.length)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ci(t[1]))return n.error("invalid value");const i=t[1];let a=ri(i);const l=n.expectedType;return"array"!==a.kind||0!==a.N||!l||"array"!==l.kind||"number"==typeof l.N&&0!==l.N||(a=l),new vr(a,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ae?["rgba"].concat(this.value.toArray()):this.value instanceof He?this.value.serialize():this.value}}var hg=vr,Ti=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const ae={string:nn,number:Ht,boolean:un,object:Ch};class Af{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let i,a=1;const l=t[0];if("array"===l){let d,f;if(t.length>2){const p=t[1];if("string"!=typeof p||!(p in ae)||"object"===p)return n.error('The item type argument of "array" must be one of string, number, boolean',1);d=ae[p],a++}else d=on;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);f=t[2],a++}i=be(d,f)}else i=ae[l];const u=[];for(;a<t.length;a++){const d=n.parse(t[a],a,on);if(!d)return null;u.push(d)}return new Af(i,u)}evaluate(t){for(let n=0;n<this.args.length;n++){const i=this.args[n].evaluate(t);if(!ig(this.type,ri(i)))return i;if(n===this.args.length-1)throw new Ti(`Expected value to be of type ${Zr(this.type)}, but found ${Zr(ri(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){n.push(i.kind);const a=t.N;("number"==typeof a||this.args.length>1)&&n.push(a)}}return n.concat(this.args.map(i=>i.serialize()))}}var ma=Af;class Dh{constructor(t){this.type=rg,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return n.error("First argument must be an image or text section.");const a=[];let l=!1;for(let u=1;u<=t.length-1;++u){const d=t[u];if(l&&"object"==typeof d&&!Array.isArray(d)){l=!1;let f=null;if(d["font-scale"]&&(f=n.parse(d["font-scale"],1,Ht),!f))return null;let p=null;if(d["text-font"]&&(p=n.parse(d["text-font"],1,be(nn)),!p))return null;let g=null;if(d["text-color"]&&(g=n.parse(d["text-color"],1,pa),!g))return null;const _=a[a.length-1];_.scale=f,_.font=p,_.textColor=g}else{const f=n.parse(t[u],1,on);if(!f)return null;const p=f.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:f,scale:null,font:null,textColor:null})}}return new Dh(a)}evaluate(t){return new He(this.sections.map(n=>{const i=n.content.evaluate(t);return ri(i)===_o?new Sv("",i,null,null,null):new Sv(ug(i),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t}}class wu{constructor(t,n){this.type=_o,this.inputPrimary=t,this.inputSecondary=n}static parse(t,n){if(t.length<2)return n.error("Expected two or more arguments.");const i=n.parse(t[1],1,nn);if(!i)return n.error("No image name provided.");if(2===t.length)return new wu(i);const a=n.parse(t[2],1,nn);return a?new wu(i,a):n.error("Secondary image variant is not a string.")}evaluate(t){const n=Jo.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&t.availableImages&&(n.available=t.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function gn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Av={"to-boolean":un,"to-color":pa,"to-number":Ht,"to-string":nn};class pw{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const i=t[0],a=[];let l=Gs;if("to-array"===i){if(!Array.isArray(t[1]))return null;const u=t[1].length;if(n.expectedType){if("array"!==n.expectedType.kind)return n.error(`Expected ${n.expectedType.kind} but found array.`);l=be(n.expectedType.itemType,u)}else{if(!(u>0&&Ci(t[1][0])))return null;l=be(ri(t[1][0]),u)}for(let d=0;d<u;d++){const f=t[1][d];let p;if("array"===gn(f))p=n.parse(f,void 0,l.itemType);else{const g=gn(f);if(g!==l.itemType.kind)return n.error(`Expected ${l.itemType.kind} but found ${g}.`);p=n.registry.literal.parse(["literal",void 0===f?null:f],n)}if(!p)return null;a.push(p)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return n.error("Expected one argument.");l=Av[i];for(let u=1;u<t.length;u++){const d=n.parse(t[u],u,on);if(!d)return null;a.push(d)}}return new pw(l,a)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let n,i;for(const a of this.args){if(n=a.evaluate(t),i=null,n instanceof Ae)return n;if("string"==typeof n){const l=t.parseColor(n);if(l)return l}else if(Array.isArray(n)&&(i=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Iv(n[0],n[1],n[2],n[3]),!i))return new Ae(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ti(i||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const i of this.args){if(n=i.evaluate(t),null===n)return 0;const a=Number(n);if(!isNaN(a))return a}throw new Ti(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?He.fromString(ug(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Jo.fromString(ug(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map(n=>n.evaluate(t)):ug(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Dh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new wu(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Sh=pw;const XR=["Unknown","Point","LineString","Polygon"];var l2=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?XR[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ae.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Pf{constructor(t,n,i,a){this.name=t,this.type=n,this._evaluate=i,this.args=a}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const i=t[0],a=Pf.definitions[i];if(!a)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(a)?a[0]:a.type,u=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,d=u.filter(([p])=>!Array.isArray(p)||p.length===t.length-1);let f=null;for(const[p,g]of d){f=new vo(n.registry,n.path,null,n.scope,void 0,n.options);const _=[];let v=!1;for(let x=1;x<t.length;x++){const b=t[x],E=Array.isArray(p)?p[x-1]:p.type,T=f.parse(b,1+_.length,E);if(!T){v=!0;break}_.push(T)}if(!v)if(Array.isArray(p)&&p.length!==_.length)f.error(`Expected ${p.length} arguments, but found ${_.length} instead.`);else{for(let x=0;x<_.length;x++){const b=Array.isArray(p)?p[x]:p.type,E=_[x];f.concat(x+1).checkSubtype(b,E.type)}if(0===f.errors.length)return new Pf(i,l,g,_)}}if(1===d.length)n.errors.push(...f.errors);else{const p=(d.length?d:u).map(([_])=>{return v=_,Array.isArray(v)?`(${v.map(Zr).join(", ")})`:`(${Zr(v.type)}...)`;var v}).join(" | "),g=[];for(let _=1;_<t.length;_++){const v=n.parse(t[_],1+g.length);if(!v)return null;g.push(Zr(v.type))}n.error(`Expected arguments of type ${p}, but found (${g.join(", ")}) instead.`)}return null}static register(t,n){Pf.definitions=n;for(const i in n)t[i]=Pf}}var Ko=Pf;class Ih{constructor(t,n,i){this.type=ng,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(2!==t.length)return n.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return n.error("Collator options argument must be an object.");const a=n.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,un);if(!a)return null;const l=n.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,un);if(!l)return null;let u=null;return i.locale&&(u=n.parse(i.locale,1,nn),!u)?null:new Ih(a,l,u)}evaluate(t){return new cg(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var Rf={exports:{}};Rf.exports=function(){function e(i,a,l,u,d){for(;u>l;){if(u-l>600){var f=u-l+1,p=a-l+1,g=Math.log(f),_=.5*Math.exp(2*g/3),v=.5*Math.sqrt(g*_*(f-_)/f)*(p-f/2<0?-1:1);e(i,a,Math.max(l,Math.floor(a-p*_/f+v)),Math.min(u,Math.floor(a+(f-p)*_/f+v)),d)}var x=i[a],b=l,E=u;for(t(i,l,a),d(i[u],x)>0&&t(i,l,u);b<E;){for(t(i,b,E),b++,E--;d(i[b],x)<0;)b++;for(;d(i[E],x)>0;)E--}0===d(i[l],x)?t(i,l,E):t(i,++E,u),E<=a&&(l=E+1),a<=E&&(u=E-1)}}function t(i,a,l){var u=i[a];i[a]=i[l],i[l]=u}function n(i,a){return i<a?-1:i>a?1:0}return function(i,a,l,u,d){e(i,a,l||0,u||i.length-1,d||n)}}();var c2=Zo(Rf.exports);function u2(e){let t=0;for(let n,i,a=0,l=e.length,u=l-1;a<l;u=a++)n=e[a],i=e[u],t+=(i.x-n.x)*(n.y+i.y);return t}function Of(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ah(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ph(e,t,n){const i=e[0]-t[0],a=e[1]-t[1],l=e[0]-n[0],u=e[1]-n[1];return i*u-l*a==0&&i*l<=0&&a*u<=0}function Rh(e,t,n=!1){let i=!1;for(let d=0,f=t.length;d<f;d++){const p=t[d];for(let g=0,_=p.length,v=_-1;g<_;v=g++){const x=p[v],b=p[g];if(Ph(e,x,b))return n;(l=x)[1]>(a=e)[1]!=(u=b)[1]>a[1]&&a[0]<(u[0]-l[0])*(a[1]-l[1])/(u[1]-l[1])+l[0]&&(i=!i)}}var a,l,u;return i}function Nl(e,t,n,i){const a=i[0]-n[0],l=i[1]-n[1],u=(e[0]-n[0])*l-a*(e[1]-n[1]),d=(t[0]-n[0])*l-a*(t[1]-n[1]);return u>0&&d<0||u<0&&d>0}function dg(e,t,n,i){return(a=[i[0]-n[0],i[1]-n[1]])[0]*(l=[t[0]-e[0],t[1]-e[1]])[1]-a[1]*l[0]!=0&&!(!Nl(e,t,n,i)||!Nl(n,i,e,t));var a,l}const ye=8192;function mw(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,a=Math.pow(2,t.z);return[Math.round(n*a*ye),Math.round(i*a*ye)]}function le(e,t){for(let n=0;n<t.length;n++)if(Rh(e,t[n]))return!0;return!1}function fg(e,t,n){for(const i of n)for(let a=0,l=i.length,u=l-1;a<l;u=a++)if(dg(e,t,i[u],i[a]))return!0;return!1}function pg(e,t){for(let n=0;n<e.length;++n)if(!Rh(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(fg(e[n],e[n+1],t))return!1;return!0}function kf(e,t){for(let n=0;n<t.length;n++)if(pg(e,t[n]))return!0;return!1}function Pv(e,t,n){const i=[];for(let a=0;a<e.length;a++){const l=[];for(let u=0;u<e[a].length;u++){const d=mw(e[a][u],n);Of(t,d),l.push(d)}i.push(l)}return i}function gw(e,t,n){const i=[];for(let a=0;a<e.length;a++){const l=Pv(e[a],t,n);i.push(l)}return i}function _w(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const a=.5*i;let l=e[0]-n[0]>a?-i:n[0]-e[0]>a?i:0;0===l&&(l=e[0]-n[2]>a?-i:n[2]-e[0]>a?i:0),e[0]+=l}Of(t,e)}function Ka(e,t,n,i){const a=Math.pow(2,i.z)*ye,l=[i.x*ye,i.y*ye],u=[];if(!e)return u;for(const d of e)for(const f of d){const p=[f.x+l[0],f.y+l[1]];_w(p,t,n,a),u.push(p)}return u}function Lf(e,t,n,i){const a=Math.pow(2,i.z)*ye,l=[i.x*ye,i.y*ye],u=[];if(!e)return u;for(const f of e){const p=[];for(const g of f){const _=[g.x+l[0],g.y+l[1]];Of(t,_),p.push(_)}u.push(p)}if(t[2]-t[0]<=a/2){(d=t)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(const f of u)for(const p of f)_w(p,t,n,a)}var d;return u}class Lo{constructor(t,n){this.type=un,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ci(t[1])){const i=t[1];if("FeatureCollection"===i.type)for(let a=0;a<i.features.length;++a){const l=i.features[a].geometry.type;if("Polygon"===l||"MultiPolygon"===l)return new Lo(i,i.features[a].geometry)}else if("Feature"===i.type){const a=i.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new Lo(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new Lo(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(n,i){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],u=n.canonicalID();if(!u)return!1;if("Polygon"===i.type){const d=Pv(i.coordinates,l,u),f=Ka(n.geometry(),a,l,u);if(!Ah(a,l))return!1;for(const p of f)if(!Rh(p,d))return!1}if("MultiPolygon"===i.type){const d=gw(i.coordinates,l,u),f=Ka(n.geometry(),a,l,u);if(!Ah(a,l))return!1;for(const p of f)if(!le(p,d))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(n,i){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],u=n.canonicalID();if(!u)return!1;if("Polygon"===i.type){const d=Pv(i.coordinates,l,u),f=Lf(n.geometry(),a,l,u);if(!Ah(a,l))return!1;for(const p of f)if(!pg(p,d))return!1}if("MultiPolygon"===i.type){const d=gw(i.coordinates,l,u),f=Lf(n.geometry(),a,l,u);if(!Ah(a,l))return!1;for(const p of f)if(!kf(p,d))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var qs=Lo,zn={exports:{}};zn.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,n=t*(2-t),i=Math.PI/180,a=function(p,g){if(void 0===p)throw new Error("No latitude given.");if(g&&!e[g])throw new Error("Unknown unit "+g+". Use one of: "+Object.keys(e).join(", "));var _=6378.137*i*(g?e[g]:1),v=Math.cos(p*i),x=1/(1-n*(1-v*v)),b=Math.sqrt(x);this.kx=_*b*v,this.ky=_*b*x*(1-n)},l={units:{configurable:!0}};function u(p,g){return p[0]===g[0]&&p[1]===g[1]}function d(p,g,_){var v=f(g[0]-p[0]);return[p[0]+v*_,p[1]+(g[1]-p[1])*_]}function f(p){for(;p<-180;)p+=360;for(;p>180;)p-=360;return p}return a.fromTile=function(p,g,_){var v=Math.PI*(1-2*(p+.5)/Math.pow(2,g)),x=Math.atan(.5*(Math.exp(v)-Math.exp(-v)))/i;return new a(x,_)},l.units.get=function(){return e},a.prototype.distance=function(p,g){var _=f(p[0]-g[0])*this.kx,v=(p[1]-g[1])*this.ky;return Math.sqrt(_*_+v*v)},a.prototype.bearing=function(p,g){var _=f(g[0]-p[0])*this.kx;return Math.atan2(_,(g[1]-p[1])*this.ky)/i},a.prototype.destination=function(p,g,_){var v=_*i;return this.offset(p,Math.sin(v)*g,Math.cos(v)*g)},a.prototype.offset=function(p,g,_){return[p[0]+g/this.kx,p[1]+_/this.ky]},a.prototype.lineDistance=function(p){for(var g=0,_=0;_<p.length-1;_++)g+=this.distance(p[_],p[_+1]);return g},a.prototype.area=function(p){for(var g=0,_=0;_<p.length;_++)for(var v=p[_],x=0,b=v.length,E=b-1;x<b;E=x++)g+=f(v[x][0]-v[E][0])*(v[x][1]+v[E][1])*(_?-1:1);return Math.abs(g)/2*this.kx*this.ky},a.prototype.along=function(p,g){var _=0;if(g<=0)return p[0];for(var v=0;v<p.length-1;v++){var x=p[v],b=p[v+1],E=this.distance(x,b);if((_+=E)>g)return d(x,b,(g-(_-E))/E)}return p[p.length-1]},a.prototype.pointToSegmentDistance=function(p,g,_){var v=g[0],x=g[1],b=f(_[0]-v)*this.kx,E=(_[1]-x)*this.ky,T=0;return 0===b&&0===E||((T=(f(p[0]-v)*this.kx*b+(p[1]-x)*this.ky*E)/(b*b+E*E))>1?(v=_[0],x=_[1]):T>0&&(v+=b/this.kx*T,x+=E/this.ky*T)),b=f(p[0]-v)*this.kx,E=(p[1]-x)*this.ky,Math.sqrt(b*b+E*E)},a.prototype.pointOnLine=function(p,g){for(var _,v,x,b,E=1/0,T=0;T<p.length-1;T++){var C=p[T][0],D=p[T][1],A=f(p[T+1][0]-C)*this.kx,P=(p[T+1][1]-D)*this.ky,I=0;0===A&&0===P||((I=(f(g[0]-C)*this.kx*A+(g[1]-D)*this.ky*P)/(A*A+P*P))>1?(C=p[T+1][0],D=p[T+1][1]):I>0&&(C+=A/this.kx*I,D+=P/this.ky*I));var R=(A=f(g[0]-C)*this.kx)*A+(P=(g[1]-D)*this.ky)*P;R<E&&(E=R,_=C,v=D,x=T,b=I)}return{point:[_,v],index:x,t:Math.max(0,Math.min(1,b))}},a.prototype.lineSlice=function(p,g,_){var v=this.pointOnLine(_,p),x=this.pointOnLine(_,g);if(v.index>x.index||v.index===x.index&&v.t>x.t){var b=v;v=x,x=b}var E=[v.point],T=v.index+1,C=x.index;!u(_[T],E[0])&&T<=C&&E.push(_[T]);for(var D=T+1;D<=C;D++)E.push(_[D]);return u(_[C],x.point)||E.push(x.point),E},a.prototype.lineSliceAlong=function(p,g,_){for(var v=0,x=[],b=0;b<_.length-1;b++){var E=_[b],T=_[b+1],C=this.distance(E,T);if((v+=C)>p&&0===x.length&&x.push(d(E,T,(p-(v-C))/C)),v>=g)return x.push(d(E,T,(g-(v-C))/C)),x;v>p&&x.push(T)}return x},a.prototype.bufferPoint=function(p,g){var _=g/this.ky,v=g/this.kx;return[p[0]-v,p[1]-_,p[0]+v,p[1]+_]},a.prototype.bufferBBox=function(p,g){var _=g/this.ky,v=g/this.kx;return[p[0]-v,p[1]-_,p[2]+v,p[3]+_]},a.prototype.insideBBox=function(p,g){return f(p[0]-g[0])>=0&&f(p[0]-g[2])<=0&&p[1]>=g[1]&&p[1]<=g[3]},Object.defineProperties(a,l),a}();var Oh=Zo(zn.exports),mg={exports:{}};mg.exports=function(){var e=function(n,i){if(void 0===n&&(n=[]),void 0===i&&(i=t),this.data=n,this.length=this.data.length,this.compare=i,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function t(n,i){return n<i?-1:n>i?1:0}return e.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var n=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),n}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(n){for(var i=this.data,a=this.compare,l=i[n];n>0;){var u=n-1>>1,d=i[u];if(a(l,d)>=0)break;i[n]=d,n=u}i[n]=l},e.prototype._down=function(n){for(var i=this.data,a=this.compare,l=this.length>>1,u=i[n];n<l;){var d=1+(n<<1),f=i[d],p=d+1;if(p<this.length&&a(i[p],f)<0&&(d=p,f=i[p]),a(f,u)>=0)break;i[n]=f,n=d}i[n]=u},e}();var Ff=Zo(mg.exports),lt=8192;function Qa(e,t){return t.dist-e.dist}const Eu=100,gg=50;function Rv(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function kh(e){return e[1]-e[0]+1}function tl(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function _g(e,t){if(e[0]>e[1])return[null,null];const n=kh(e);if(t){if(2===n)return[e,null];const i=Math.floor(n/2);return[[e[0],e[0]+i],[e[0]+i,e[1]]]}{if(1===n)return[e,null];const i=Math.floor(n/2)-1;return[[e[0],e[0]+i],[e[0]+i+1,e[1]]]}}function ga(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!tl(t,e.length))return n;for(let i=t[0];i<=t[1];++i)Of(n,e[i]);return n}function Nf(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let i=0;i<e[n].length;++i)Of(t,e[n][i]);return t}function Mu(e,t,n){if(Rv(e)||Rv(t))return NaN;let i=0,a=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(a=e[1]-t[3]),e[3]<t[1]&&(a=t[1]-e[3]),n.distance([0,0],[i,a])}function Ov(e,t){const n=Math.pow(2,t.z);return[(a=(e.x/lt+t.x)/n,360*a-180),(i=(e.y/lt+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,a}function yw(e,t){const n=[];for(let i=0;i<e.length;++i)n.push(Ov(e[i],t));return n}function vw(e,t,n){const i=n.pointOnLine(t,e).point;return n.distance(e,i)}function xw(e,t,n,i,a){const l=n.slice(i[0],i[1]+1);let u=1/0;for(let d=t[0];d<=t[1];++d)if(0===(u=Math.min(u,vw(e[d],l,a))))return 0;return u}function Ms(e,t,n,i,a){const l=Math.min(a.pointToSegmentDistance(e,n,i),a.pointToSegmentDistance(t,n,i)),u=Math.min(a.pointToSegmentDistance(n,e,t),a.pointToSegmentDistance(i,e,t));return Math.min(l,u)}function h2(e,t,n,i,a){if(!tl(t,e.length)||!tl(i,n.length))return NaN;let l=1/0;for(let u=t[0];u<t[1];++u)for(let d=i[0];d<i[1];++d){if(dg(e[u],e[u+1],n[d],n[d+1]))return 0;l=Math.min(l,Ms(e[u],e[u+1],n[d],n[d+1],a))}return l}function bw(e,t,n,i,a){if(!tl(t,e.length)||!tl(i,n.length))return NaN;let l=1/0;for(let u=t[0];u<=t[1];++u)for(let d=i[0];d<=i[1];++d)if(0===(l=Math.min(l,a.distance(e[u],n[d]))))return l;return l}function d2(e,t,n){if(Rh(e,t,!0))return 0;let i=1/0;for(const a of t){const l=a.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[l-1]&&0===(i=Math.min(i,n.pointToSegmentDistance(e,a[l-1],a[0])))||0===(i=Math.min(i,vw(e,a,n))))return i}return i}function f2(e,t,n,i){if(!tl(t,e.length))return NaN;for(let l=t[0];l<=t[1];++l)if(Rh(e[l],n,!0))return 0;let a=1/0;for(let l=t[0];l<t[1];++l)for(const u of n)for(let d=0,f=u.length,p=f-1;d<f;p=d++){if(dg(e[l],e[l+1],u[p],u[d]))return 0;a=Math.min(a,Ms(e[l],e[l+1],u[p],u[d],i))}return a}function ww(e,t){for(const n of e)for(let i=0;i<=n.length-1;++i)if(Rh(n[i],t,!0))return!0;return!1}function p2(e,t,n,i=1/0){const a=Nf(e),l=Nf(t);if(i!==1/0&&Mu(a,l,n)>=i)return i;if(Ah(a,l)){if(ww(e,t))return 0}else if(ww(t,e))return 0;let u=i;for(const d of e)for(let f=0,p=d.length,g=p-1;f<p;g=f++)for(const _ of t)for(let v=0,x=_.length,b=x-1;v<x;b=v++){if(dg(d[g],d[f],_[b],_[v]))return 0;u=Math.min(u,Ms(d[g],d[f],_[b],_[v],n))}return u}function zf(e,t,n,i,a,l,u){if(null===l||null===u)return;const d=Mu(ga(i,l),ga(a,u),n);d<t&&e.push({dist:d,range1:l,range2:u})}function m2(e,t,n,i,a=1/0){let l=Math.min(i.distance(e[0],n[0][0]),a);if(0===l)return l;const u=new Ff([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Qa),d=t?gg:Eu,f=Nf(n);for(;u.length;){const p=u.pop();if(p.dist>=l)continue;const g=p.range1;if(kh(g)<=d){if(!tl(g,e.length))return NaN;if(t){const _=f2(e,g,n,i);if(0===(l=Math.min(l,_)))return l}else for(let _=g[0];_<=g[1];++_){const v=d2(e[_],n,i);if(0===(l=Math.min(l,v)))return l}}else{const _=_g(g,t);if(null!==_[0]){const v=Mu(ga(e,_[0]),f,i);v<l&&u.push({dist:v,range1:_[0],range2:[0,0]})}if(null!==_[1]){const v=Mu(ga(e,_[1]),f,i);v<l&&u.push({dist:v,range1:_[1],range2:[0,0]})}}}return l}function Ew(e,t,n,i,a,l=1/0){let u=Math.min(l,a.distance(e[0],n[0]));if(0===u)return u;const d=new Ff([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],Qa),f=t?gg:Eu,p=i?gg:Eu;for(;d.length;){const g=d.pop();if(g.dist>=u)continue;const _=g.range1,v=g.range2;if(kh(_)<=f&&kh(v)<=p){if(!tl(_,e.length)||!tl(v,n.length))return NaN;if(t&&i?u=Math.min(u,h2(e,_,n,v,a)):t||i?t&&!i?u=Math.min(u,xw(n,v,e,_,a)):!t&&i&&(u=Math.min(u,xw(e,_,n,v,a))):u=Math.min(u,bw(e,_,n,v,a)),0===u)return u}else{const x=_g(_,t),b=_g(v,i);zf(d,u,a,e,n,x[0],b[0]),zf(d,u,a,e,n,x[0],b[1]),zf(d,u,a,e,n,x[1],b[0]),zf(d,u,a,e,n,x[1],b[1])}}return u}function kv(e,t,n,i,a=1/0){let l=a;const u=ga(e,[0,e.length-1]);for(const d of n)if(!(l!==1/0&&Mu(u,ga(d,[0,d.length-1]),i)>=l)&&(l=Math.min(l,Ew(e,t,d,!0,i,l)),0===l))return l;return l}function Ac(e,t,n,i,a=1/0){let l=a;const u=ga(e,[0,e.length-1]);for(const d of n){if(l!==1/0&&Mu(u,Nf(d),i)>=l)continue;const f=m2(e,t,d,i,l);if(isNaN(f))return f;if(0===(l=Math.min(l,f)))return l}return l}function Lv(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class Bf{constructor(t,n){this.type=Ht,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Ci(t[1])){const i=t[1];if("FeatureCollection"===i.type){for(let a=0;a<i.features.length;++a)if(Lv(i.features[a].geometry.type))return new Bf(i,i.features[a].geometry)}else if("Feature"===i.type){if(Lv(i.geometry.type))return new Bf(i,i.geometry)}else if(Lv(i.type))return new Bf(i,i)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const n=t.geometry(),i=t.canonicalID();if(null!=n&&null!=i){if("Point"===t.geometryType())return function(a,l,u){const d=[];for(const p of a)for(const g of p)d.push(Ov(g,l));const f=new Oh(d[0][1],"meters");return"Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type?Ew(d,!1,"Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,f):"MultiLineString"===u.type?kv(d,!1,u.coordinates,f):"Polygon"===u.type||"MultiPolygon"===u.type?Ac(d,!1,"Polygon"===u.type?[u.coordinates]:u.coordinates,f):null}(n,i,this.geometries);if("LineString"===t.geometryType())return function(a,l,u){const d=[];for(const p of a){const g=[];for(const _ of p)g.push(Ov(_,l));d.push(g)}const f=new Oh(d[0][0][1],"meters");if("Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type)return kv("Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,d,f);if("MultiLineString"===u.type){let p=1/0;for(let g=0;g<u.coordinates.length;g++){const _=kv(u.coordinates[g],!0,d,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}if("Polygon"===u.type||"MultiPolygon"===u.type){let p=1/0;for(let g=0;g<d.length;g++){const _=Ac(d[g],!0,"Polygon"===u.type?[u.coordinates]:u.coordinates,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}return null}(n,i,this.geometries);if("Polygon"===t.geometryType())return function(a,l,u){const d=[];for(const p of function(g,_){const v=g.length;if(v<=1)return[g];const x=[];let b,E;for(let T=0;T<v;T++){const C=u2(g[T]);0!==C&&(g[T].area=Math.abs(C),void 0===E&&(E=C<0),E===C<0?(b&&x.push(b),b=[g[T]]):b.push(g[T]))}return b&&x.push(b),x}(a)){const g=[];for(let _=0;_<p.length;++_)g.push(yw(p[_],l));d.push(g)}const f=new Oh(d[0][0][0][1],"meters");if("Point"===u.type||"MultiPoint"===u.type||"LineString"===u.type)return Ac("Point"===u.type?[u.coordinates]:u.coordinates,"LineString"===u.type,d,f);if("MultiLineString"===u.type){let p=1/0;for(let g=0;g<u.coordinates.length;g++){const _=Ac(u.coordinates[g],!0,d,f,p);if(isNaN(_))return _;if(0===(p=Math.min(p,_)))return p}return p}return"Polygon"===u.type||"MultiPolygon"===u.type?function(p,g,_){let v=1/0;for(const x of p)for(const b of g){const E=p2(x,b,_,v);if(isNaN(E))return E;if(0===(v=Math.min(v,E)))return v}return v}("Polygon"===u.type?[u.coordinates]:u.coordinates,d,f):null}(n,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Fv=Bf;function Fo(e){if(e instanceof Ko&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof qs||e instanceof Fv)return!1;let t=!0;return e.eachChild(n=>{t&&!Fo(n)&&(t=!1)}),t}function yg(e){if(e instanceof Ko&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(n=>{t&&!yg(n)&&(t=!1)}),t}function vg(e){if(e instanceof Ko&&"config"===e.name)return!1;let t=!0;return e.eachChild(n=>{t&&!vg(n)&&(t=!1)}),t}function je(e,t){if(e instanceof Ko&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(i=>{n&&!je(i,t)&&(n=!1)}),n}class yo{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");const i=t[1];return n.scope.has(i)?new yo(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var An=yo;class Di{constructor(t,n=[],i,a=new ZR,l=[],u){this.registry=t,this.path=n,this.key=n.map(d=>`[${d}]`).join(""),this.scope=a,this.errors=l,this.expectedType=i,this.options=u}parse(t,n,i,a,l={}){return n||i?this.concat(n,i,a)._parse(t,l):this._parse(t,l)}_parse(t,n){function i(a,l,u){return"assert"===u?new ma(l,[a]):"coerce"===u?new Sh(l,[a]):a}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a="string"==typeof t[0]?this.registry[t[0]]:void 0;if(a){let l=a.parse(t,this);if(!l)return null;if(this.expectedType){const u=this.expectedType,d=l.type;if("string"!==u.kind&&"number"!==u.kind&&"boolean"!==u.kind&&"object"!==u.kind&&"array"!==u.kind||"value"!==d.kind)if("color"!==u.kind&&"formatted"!==u.kind&&"resolvedImage"!==u.kind||"value"!==d.kind&&"string"!==d.kind){if(this.checkSubtype(u,d))return null}else l=i(l,u,n.typeAnnotation||"coerce");else l=i(l,u,n.typeAnnotation||"assert")}if(!(l instanceof hg)&&"resolvedImage"!==l.type.kind&&Pc(l)){const u=new l2(this.options);try{l=new hg(l.type,l.evaluate(u))}catch(d){return this.error(d.message),null}}return l}return Sh.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,i){const a="number"==typeof t?this.path.concat(t):this.path,l=i?this.scope.concat(i):this.scope;return new Di(this.registry,a,n||null,l,this.errors,this.options)}error(t,...n){const i=`${this.key}${n.map(a=>`[${a}]`).join("")}`;this.errors.push(new Fl(i,t))}checkSubtype(t,n){const i=ig(t,n);return i&&this.error(i),i}}var vo=Di;function Pc(e){if(e instanceof An)return Pc(e.boundExpression);if(e instanceof Ko&&"error"===e.name||e instanceof Ko&&"config"===e.name||e instanceof Ih||e instanceof qs||e instanceof Fv)return!1;const t=e instanceof Sh||e instanceof ma;let n=!0;return e.eachChild(i=>{n=t?n&&Pc(i):n&&i instanceof hg}),!!n&&Fo(e)&&je(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function xo(e,t){const n=e.length-1;let i,a,l=0,u=n,d=0;for(;l<=u;)if(d=Math.floor((l+u)/2),i=e[d],a=e[d+1],i<=t){if(d===n||t<a)return d;l=d+1}else{if(!(i>t))throw new Ti("Input is not a number.");u=d-1}return 0}class xg{constructor(t,n,i){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[a,l]of i)this.labels.push(a),this.outputs.push(l)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const i=n.parse(t[1],1,Ht);if(!i)return null;const a=[];let l=null;n.expectedType&&"value"!==n.expectedType.kind&&(l=n.expectedType);for(let u=1;u<t.length;u+=2){const d=1===u?-1/0:t[u],f=t[u+1],p=u,g=u+1;if("number"!=typeof d)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(a.length&&a[a.length-1][0]>=d)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',p);const _=n.parse(f,g,l);if(!_)return null;l=l||_.type,a.push([d,_])}return new xg(l,i,a)}evaluate(t){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(t);const a=this.input.evaluate(t);if(a<=n[0])return i[0].evaluate(t);const l=n.length;return a>=n[l-1]?i[l-1].evaluate(t):i[xo(n,a)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var bg=xg;function ue(e,t,n){return e*(1-n)+t*n}function Mw(e,t,n){return e.map((i,a)=>ue(i,t[a],n))}var wg=Object.freeze({__proto__:null,array:Mw,color:function(e,t,n){return new Ae(ue(e.r,t.r,n),ue(e.g,t.g,n),ue(e.b,t.b,n),ue(e.a,t.a,n))},number:ue});const rn=4/29,lr=6/29,Zs=3*lr*lr,Vf=lr*lr*lr,bo=Math.PI/180,Lh=180/Math.PI;function Xr(e){return e>Vf?Math.pow(e,1/3):e/Zs+rn}function el(e){return e>lr?e*e*e:Zs*(e-rn)}function Rc(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function We(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Fh(e){const t=We(e.r),n=We(e.g),i=We(e.b),a=Xr((.4124564*t+.3575761*n+.1804375*i)/.95047),l=Xr((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*l-16,a:500*(a-l),b:200*(l-Xr((.0193339*t+.119192*n+.9503041*i)/1.08883)),alpha:e.a}}function Nv(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*el(t),n=.95047*el(n),i=1.08883*el(i),new Ae(Rc(3.2404542*n-1.5371385*t-.4985314*i),Rc(-.969266*n+1.8760108*t+.041556*i),Rc(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function Nh(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const Pr={forward:Fh,reverse:Nv,interpolate:function(e,t,n){return{l:ue(e.l,t.l,n),a:ue(e.a,t.a,n),b:ue(e.b,t.b,n),alpha:ue(e.alpha,t.alpha,n)}}},zl={forward:function(e){const{l:t,a:n,b:i}=Fh(e),a=Math.atan2(i,n)*Lh;return{h:a<0?a+360:a,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*bo,n=e.c;return Nv({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:Nh(e.h,t.h,n),c:ue(e.c,t.c,n),l:ue(e.l,t.l,n),alpha:ue(e.alpha,t.alpha,n)}}};var Cu=Object.freeze({__proto__:null,hcl:zl,lab:Pr});class Cs{constructor(t,n,i,a,l){this.type=t,this.operator=n,this.interpolation=i,this.input=a,this.labels=[],this.outputs=[];for(const[u,d]of l)this.labels.push(u),this.outputs.push(d)}static interpolationFactor(t,n,i,a){let l=0;if("exponential"===t.name)l=Tu(n,t.base,i,a);else if("linear"===t.name)l=Tu(n,1,i,a);else if("cubic-bezier"===t.name){const u=t.controlPoints;l=new Wm(u[0],u[1],u[2],u[3]).solve(Tu(n,1,i,a))}return l}static parse(t,n){let[i,a,l,...u]=t;if(!Array.isArray(a)||0===a.length)return n.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){const p=a[1];if("number"!=typeof p)return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:p}}else{if("cubic-bezier"!==a[0])return n.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const p=a.slice(1);if(4!==p.length||p.some(g=>"number"!=typeof g||g<0||g>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:p}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(l=n.parse(l,2,Ht),!l)return null;const d=[];let f=null;"interpolate-hcl"===i||"interpolate-lab"===i?f=pa:n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(let p=0;p<u.length;p+=2){const g=u[p],_=u[p+1],v=p+3,x=p+4;if("number"!=typeof g)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(d.length&&d[d.length-1][0]>=g)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',v);const b=n.parse(_,x,f);if(!b)return null;f=f||b.type,d.push([g,b])}return"number"===f.kind||"color"===f.kind||"array"===f.kind&&"number"===f.itemType.kind&&"number"==typeof f.N?new Cs(f,i,a,l,d):n.error(`Type ${Zr(f)} is not interpolatable.`)}evaluate(t){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(t);const a=this.input.evaluate(t);if(a<=n[0])return i[0].evaluate(t);const l=n.length;if(a>=n[l-1])return i[l-1].evaluate(t);const u=xo(n,a),d=Cs.interpolationFactor(this.interpolation,a,n[u],n[u+1]),f=i[u].evaluate(t),p=i[u+1].evaluate(t);return"interpolate"===this.operator?wg[this.type.kind.toLowerCase()](f,p,d):"interpolate-hcl"===this.operator?zl.reverse(zl.interpolate(zl.forward(f),zl.forward(p),d)):Pr.reverse(Pr.interpolate(Pr.forward(f),Pr.forward(p),d))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let i=0;i<this.labels.length;i++)n.push(this.labels[i],this.outputs[i].serialize());return n}}function Tu(e,t,n,i){const a=i-n,l=e-n;return 0===a?0:1===t?l/a:(Math.pow(t,l)-1)/(Math.pow(t,a)-1)}var _a=Cs;class nl{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let i=null;const a=n.expectedType;a&&"value"!==a.kind&&(i=a);const l=[];for(const d of t.slice(1)){const f=n.parse(d,1+l.length,i,void 0,{typeAnnotation:"omit"});if(!f)return null;i=i||f.type,l.push(f)}const u=a&&l.some(d=>ig(a,d.type));return new nl(u?on:i,l)}evaluate(t){let n,i=null,a=0;for(const l of this.args){if(a++,i=l.evaluate(t),i&&i instanceof Jo&&!i.available&&(n||(n=i),i=null,a===this.args.length))return n;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var rl=nl;class Du{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let l=1;l<t.length-1;l+=2){const u=t[l];if("string"!=typeof u)return n.error(`Expected string, but found ${typeof u} instead.`,l);if(/[^a-zA-Z0-9_]/.test(u))return n.error("Variable names must contain only alphanumeric characters or '_'.",l);const d=n.parse(t[l+1],l+1);if(!d)return null;i.push([u,d])}const a=n.parse(t[t.length-1],t.length-1,n.expectedType,i);return a?new Du(i,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,i]of this.bindings)t.push(n,i.serialize());return t.push(this.result.serialize()),t}}var zh=Du;class _n{constructor(t,n,i){this.type=t,this.index=n,this.input=i}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=n.parse(t[1],1,Ht),a=n.parse(t[2],2,be(n.expectedType||on));return i&&a?new _n(a.type.itemType,i,a):null}evaluate(t){const n=this.index.evaluate(t),i=this.input.evaluate(t);if(n<0)throw new Ti(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new Ti(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new Ti(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var YR=_n;class jf{constructor(t,n){this.type=un,this.needle=t,this.haystack=n}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=n.parse(t[1],1,on),a=n.parse(t[2],2,on);return i&&a?Ie(i.type,[un,nn,Ht,Gs,on])?new jf(i,a):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zr(i.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!og(n,["boolean","string","number","null"]))throw new Ti(`Expected first argument to be of type boolean, string, number or null, but found ${Zr(ri(n))} instead.`);if(!og(i,["string","array"]))throw new Ti(`Expected second argument to be of type array or string, but found ${Zr(ri(i))} instead.`);return i.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Cw=jf;class Ts{constructor(t,n,i){this.type=Ht,this.needle=t,this.haystack=n,this.fromIndex=i}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=n.parse(t[1],1,on),a=n.parse(t[2],2,on);if(!i||!a)return null;if(!Ie(i.type,[un,nn,Ht,Gs,on]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zr(i.type)} instead`);if(4===t.length){const l=n.parse(t[3],3,Ht);return l?new Ts(i,a,l):null}return new Ts(i,a)}evaluate(t){const n=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!og(n,["boolean","string","number","null"]))throw new Ti(`Expected first argument to be of type boolean, string, number or null, but found ${Zr(ri(n))} instead.`);if(!og(i,["string","array"]))throw new Ti(`Expected second argument to be of type array or string, but found ${Zr(ri(i))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(t);return i.indexOf(n,a)}return i.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Eg=Ts;class Oc{constructor(t,n,i,a,l,u){this.inputType=t,this.type=n,this.input=i,this.cases=a,this.outputs=l,this.otherwise=u}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let i,a;n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);const l={},u=[];for(let p=2;p<t.length-1;p+=2){let g=t[p];const _=t[p+1];Array.isArray(g)||(g=[g]);const v=n.concat(p);if(0===g.length)return v.error("Expected at least one branch label.");for(const b of g){if("number"!=typeof b&&"string"!=typeof b)return v.error("Branch labels must be numbers or strings.");if("number"==typeof b&&Math.abs(b)>Number.MAX_SAFE_INTEGER)return v.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof b&&Math.floor(b)!==b)return v.error("Numeric branch labels must be integer values.");if(i){if(v.checkSubtype(i,ri(b)))return null}else i=ri(b);if(void 0!==l[String(b)])return v.error("Branch labels must be unique.");l[String(b)]=u.length}const x=n.parse(_,p,a);if(!x)return null;a=a||x.type,u.push(x)}const d=n.parse(t[1],1,on);if(!d)return null;const f=n.parse(t[t.length-1],t.length-1,a);return f?"value"!==d.type.kind&&n.concat(1).checkSubtype(i,d.type)?null:new Oc(i,a,d,l,u,f):null}evaluate(t){const n=this.input.evaluate(t);return(ri(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],a={};for(const u of n){const d=a[this.cases[u]];void 0===d?(a[this.cases[u]]=i.length,i.push([this.cases[u],[u]])):i[d][1].push(u)}const l=u=>"number"===this.inputType.kind?Number(u):u;for(const[u,d]of i)t.push(1===d.length?l(d[0]):d.map(l)),t.push(this.outputs[u].serialize());return t.push(this.otherwise.serialize()),t}}var Uf=Oc;class Si{constructor(t,n,i){this.type=t,this.branches=n,this.otherwise=i}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);const a=[];for(let u=1;u<t.length-1;u+=2){const d=n.parse(t[u],u,un);if(!d)return null;const f=n.parse(t[u+1],u+1,i);if(!f)return null;a.push([d,f]),i=i||f.type}const l=n.parse(t[t.length-1],t.length-1,i);return l?new Si(i,a,l):null}evaluate(t){for(const[n,i]of this.branches)if(n.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,i]of this.branches)t(n),t(i);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var JR=Si;class oo{constructor(t,n,i,a){this.type=t,this.input=n,this.beginIndex=i,this.endIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=n.parse(t[1],1,on),a=n.parse(t[2],2,Ht);if(!i||!a)return null;if(!Ie(i.type,[be(on),nn,on]))return n.error(`Expected first argument to be of type array or string, but found ${Zr(i.type)} instead`);if(4===t.length){const l=n.parse(t[3],3,Ht);return l?new oo(i.type,i,a,l):null}return new oo(i.type,i,a)}evaluate(t){const n=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!og(n,["string","array"]))throw new Ti(`Expected first argument to be of type array or string, but found ${Zr(ri(n))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(t);return n.slice(i,a)}return n.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var No=oo;function Mg(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function kc(e,t,n,i){return 0===i.compare(t,n)}function Bl(e,t,n){const i="=="!==e&&"!="!==e;return class RF{constructor(l,u,d){this.type=un,this.lhs=l,this.rhs=u,this.collator=d,this.hasUntypedArgument="value"===l.type.kind||"value"===u.type.kind}static parse(l,u){if(3!==l.length&&4!==l.length)return u.error("Expected two or three arguments.");const d=l[0];let f=u.parse(l[1],1,on);if(!f)return null;if(!Mg(d,f.type))return u.concat(1).error(`"${d}" comparisons are not supported for type '${Zr(f.type)}'.`);let p=u.parse(l[2],2,on);if(!p)return null;if(!Mg(d,p.type))return u.concat(2).error(`"${d}" comparisons are not supported for type '${Zr(p.type)}'.`);if(f.type.kind!==p.type.kind&&"value"!==f.type.kind&&"value"!==p.type.kind)return u.error(`Cannot compare types '${Zr(f.type)}' and '${Zr(p.type)}'.`);i&&("value"===f.type.kind&&"value"!==p.type.kind?f=new ma(p.type,[f]):"value"!==f.type.kind&&"value"===p.type.kind&&(p=new ma(f.type,[p])));let g=null;if(4===l.length){if("string"!==f.type.kind&&"string"!==p.type.kind&&"value"!==f.type.kind&&"value"!==p.type.kind)return u.error("Cannot use collator to compare non-string types.");if(g=u.parse(l[3],3,ng),!g)return null}return new RF(f,p,g)}evaluate(l){const u=this.lhs.evaluate(l),d=this.rhs.evaluate(l);if(i&&this.hasUntypedArgument){const f=ri(u),p=ri(d);if(f.kind!==p.kind||"string"!==f.kind&&"number"!==f.kind)throw new Ti(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${f.kind}, ${p.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const f=ri(u),p=ri(d);if("string"!==f.kind||"string"!==p.kind)return t(l,u,d)}return this.collator?n(l,u,d,this.collator.evaluate(l)):t(l,u,d)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[e];return this.eachChild(u=>{l.push(u.serialize())}),l}}}const ya=Bl("==",function(e,t,n){return t===n},kc),zv=Bl("!=",function(e,t,n){return t!==n},function(e,t,n,i){return!kc(0,t,n,i)}),g2=Bl("<",function(e,t,n){return t<n},function(e,t,n,i){return i.compare(t,n)<0}),_2=Bl(">",function(e,t,n){return t>n},function(e,t,n,i){return i.compare(t,n)>0}),KR=Bl("<=",function(e,t,n){return t<=n},function(e,t,n,i){return i.compare(t,n)<=0}),y2=Bl(">=",function(e,t,n){return t>=n},function(e,t,n,i){return i.compare(t,n)>=0});class Bv{constructor(t,n,i,a,l,u){this.type=nn,this.number=t,this.locale=n,this.currency=i,this.unit=a,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(t,n){if(3!==t.length)return n.error("Expected two arguments.");const i=n.parse(t[1],1,Ht);if(!i)return null;const a=t[2];if("object"!=typeof a||Array.isArray(a))return n.error("NumberFormat options argument must be an object.");let l=null;if(a.locale&&(l=n.parse(a.locale,1,nn),!l))return null;let u=null;if(a.currency&&(u=n.parse(a.currency,1,nn),!u))return null;let d=null;if(a.unit&&(d=n.parse(a.unit,1,nn),!d))return null;let f=null;if(a["min-fraction-digits"]&&(f=n.parse(a["min-fraction-digits"],1,Ht),!f))return null;let p=null;return a["max-fraction-digits"]&&(p=n.parse(a["max-fraction-digits"],1,Ht),!p)?null:new Bv(i,l,u,d,f,p)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Tw{constructor(t){this.type=Ht,this.input=t}static parse(t,n){if(2!==t.length)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=n.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?n.error(`Expected argument of type string or array, but found ${Zr(i.type)} instead.`):new Tw(i):null}evaluate(t){const n=this.input.evaluate(t);if("string"==typeof n||Array.isArray(n))return n.length;throw new Ti(`Expected value to be of type string or array, but found ${Zr(ri(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}function Dw(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const v2={"==":ya,"!=":zv,">":_2,"<":g2,">=":y2,"<=":KR,array:ma,at:YR,boolean:ma,case:JR,coalesce:rl,collator:Ih,format:Dh,image:wu,in:Cw,"index-of":Eg,interpolate:_a,"interpolate-hcl":_a,"interpolate-lab":_a,length:Tw,let:zh,literal:hg,match:Uf,number:ma,"number-format":Bv,object:ma,slice:No,step:bg,string:ma,"to-boolean":Sh,"to-color":Sh,"to-number":Sh,"to-string":Sh,var:An,within:qs,distance:Fv};function x2(e,[t,n,i,a]){t=t.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const l=a?a.evaluate(e):1,u=Iv(t,n,i,l);if(u)throw new Ti(u);return new Ae(t/255*l,n/255*l,i/255*l,l)}function b2(e,[t,n,i,a]){t=t.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const l=a?a.evaluate(e):1,u=(g=n,_=i,v=l,"number"==typeof(p=t)&&p>=0&&p<=360?"number"==typeof g&&g>=0&&g<=100&&"number"==typeof _&&_>=0&&_<=100?void 0===v||"number"==typeof v&&v>=0&&v<=1?null:`Invalid hsla value [${[p,g,_,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof v?[p,g,_,v]:[p,g,_]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof v?[p,g,_,v]:[p,g,_]).join(", ")}]: 'h' must be between 0 and 360.`);var p,g,_,v;if(u)throw new Ti(u);const d=`hsla(${t}, ${n}%, ${i}%, ${l})`,f=Ae.parse(d);if(!f)throw new Ti(`Failed to parse HSLA color: ${d}`);return f}function w2(e,t){return e in t}function Sw(e,t){const n=t[e];return void 0===n?null:n}function E2(e,t,n){n.length&&(t+=`\x1f${n}`);const i=e.getConfig(t);return i?i.evaluate(e):null}function Bh(e){return{type:e}}Ko.register(v2,{error:[{kind:"error"},[nn],(e,[t])=>{throw new Ti(t.evaluate(e))}],typeof:[nn,[on],(e,[t])=>Zr(ri(t.evaluate(e)))],"to-rgba":[be(Ht,4),[pa],(e,[t])=>t.evaluate(e).toArray()],rgb:[pa,[Ht,Ht,Ht],x2],rgba:[pa,[Ht,Ht,Ht,Ht],x2],hsl:[pa,[Ht,Ht,Ht],b2],hsla:[pa,[Ht,Ht,Ht,Ht],b2],has:{type:un,overloads:[[[nn],(e,[t])=>w2(t.evaluate(e),e.properties())],[[nn,Ch],(e,[t,n])=>w2(t.evaluate(e),n.evaluate(e))]]},get:{type:on,overloads:[[[nn],(e,[t])=>Sw(t.evaluate(e),e.properties())],[[nn,Ch],(e,[t,n])=>Sw(t.evaluate(e),n.evaluate(e))]]},config:{type:on,overloads:[[[nn],(e,[t])=>E2(e,t.evaluate(e),"")],[[nn,nn],(e,[t,n])=>E2(e,t.evaluate(e),n.evaluate(e))]]},"feature-state":[on,[nn],(e,[t])=>Sw(t.evaluate(e),e.featureState||{})],properties:[Ch,[],e=>e.properties()],"geometry-type":[nn,[],e=>e.geometryType()],id:[on,[],e=>e.id()],zoom:[Ht,[],e=>e.globals.zoom],pitch:[Ht,[],e=>e.globals.pitch||0],"distance-from-center":[Ht,[],e=>e.distanceFromCenter()],"measure-light":[Ht,[nn],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[Ht,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ht,[],e=>e.globals.lineProgress||0],"raster-value":[Ht,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[Ht,[],e=>e.globals.skyRadialProgress||0],accumulated:[on,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Ht,Bh(Ht),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[Ht,Bh(Ht),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:Ht,overloads:[[[Ht,Ht],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[Ht],(e,[t])=>-t.evaluate(e)]]},"/":[Ht,[Ht,Ht],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[Ht,[Ht,Ht],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[Ht,[Ht],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ht,[Ht],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ht,[Ht],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ht,[Ht],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ht,[Ht],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ht,[Ht],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ht,[Ht],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ht,[Ht],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ht,[Ht],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ht,[Ht],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ht,Bh(Ht),(e,t)=>Math.min(...t.map(n=>n.evaluate(e)))],max:[Ht,Bh(Ht),(e,t)=>Math.max(...t.map(n=>n.evaluate(e)))],abs:[Ht,[Ht],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ht,[Ht],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ht,[Ht],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ht,[Ht],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[un,[nn,on],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[un,[on],(e,[t])=>e.id()===t.value],"filter-type-==":[un,[nn],(e,[t])=>e.geometryType()===t.value],"filter-<":[un,[nn,on],(e,[t,n])=>{const i=e.properties()[t.value],a=n.value;return typeof i==typeof a&&i<a}],"filter-id-<":[un,[on],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<i}],"filter->":[un,[nn,on],(e,[t,n])=>{const i=e.properties()[t.value],a=n.value;return typeof i==typeof a&&i>a}],"filter-id->":[un,[on],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>i}],"filter-<=":[un,[nn,on],(e,[t,n])=>{const i=e.properties()[t.value],a=n.value;return typeof i==typeof a&&i<=a}],"filter-id-<=":[un,[on],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<=i}],"filter->=":[un,[nn,on],(e,[t,n])=>{const i=e.properties()[t.value],a=n.value;return typeof i==typeof a&&i>=a}],"filter-id->=":[un,[on],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>=i}],"filter-has":[un,[on],(e,[t])=>t.value in e.properties()],"filter-has-id":[un,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[un,[be(nn)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[un,[be(on)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[un,[nn,be(on)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[un,[nn,be(on)],(e,[t,n])=>function(i,a,l,u){for(;l<=u;){const d=l+u>>1;if(a[d]===i)return!0;a[d]>i?u=d-1:l=d+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:un,overloads:[[[un,un],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Bh(un),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:un,overloads:[[[un,un],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Bh(un),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[un,[un],(e,[t])=>!t.evaluate(e)],"is-supported-script":[un,[nn],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[nn,[nn],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[nn,[nn],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[nn,Bh(on),(e,t)=>t.map(n=>ug(n.evaluate(e))).join("")],"resolved-locale":[nn,[ng],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[Ht,[Ht,Ht,on],(e,t)=>{const[n,i,a]=t.map(u=>u.evaluate(e));if(n>i||n===i)return n;let l;if("string"==typeof a)l=function(u){let d=0;if(0===u.length)return d;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d&=d;return d}(a);else{if("number"!=typeof a)throw new Ti(`Invalid seed input: ${a}`);l=a}return n+Dw(l)()*(i-n)}]});var Cg=v2;function M2(e){return{result:"success",value:e}}function Vh(e){return{result:"error",value:e}}function Vv(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Lc(e){return"data-driven"===e["property-type"]}function C2(e){return Vv(e.expression,"measure-light")}function Iw(e){return Vv(e.expression,"zoom")}function Aw(e){return!!e.expression&&e.expression.interpolated}function il(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Fc(e){return e}function T2(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],a=i||!(i||void 0!==e.property),l=e.type||(Aw(t)?"exponential":"interval");if(n&&((e=Ic({},e)).stops&&(e.stops=e.stops.map(p=>[p[0],Ae.parse(p[1])])),e.default=Ae.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Cu[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let u,d,f;if("exponential"===l)u=Ds;else if("interval"===l)u=Dg;else if("categorical"===l){u=so,d=Object.create(null);for(const p of e.stops)d[p[0]]=p[1];f=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error(`Unknown function type "${l}"`);u=Pw}if(i){const p={},g=[];for(let x=0;x<e.stops.length;x++){const b=e.stops[x],E=b[0].zoom;void 0===p[E]&&(p[E]={zoom:E,type:e.type,property:e.property,default:e.default,stops:[]},g.push(E)),p[E].stops.push([b[0].value,b[1]])}const _=[];for(const x of g)_.push([p[x].zoom,T2(p[x],t)]);const v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:_a.interpolationFactor.bind(void 0,v),zoomStops:_.map(x=>x[0]),evaluate:({zoom:x},b)=>Ds({stops:_,base:e.base},t,x).evaluate(x,b)}}if(a){const p="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:p,interpolationFactor:_a.interpolationFactor.bind(void 0,p),zoomStops:e.stops.map(g=>g[0]),evaluate:({zoom:g})=>u(e,t,g,d,f)}}return{kind:"source",evaluate(p,g){const _=g&&g.properties?g.properties[e.property]:void 0;return void 0===_?Tg(e.default,t.default):u(e,t,_,d,f)}}}function Tg(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function so(e,t,n,i,a){return Tg(typeof n===a?i[n]:void 0,e.default,t.default)}function Dg(e,t,n){if("number"!==gn(n))return Tg(e.default,t.default);const i=e.stops.length;if(1===i||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const a=xo(e.stops.map(l=>l[0]),n);return e.stops[a][1]}function Ds(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==gn(n))return Tg(e.default,t.default);const a=e.stops.length;if(1===a||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[a-1][0])return e.stops[a-1][1];const l=xo(e.stops.map(g=>g[0]),n),u=function(g,_,v,x){const b=x-v,E=g-v;return 0===b?0:1===_?E/b:(Math.pow(_,E)-1)/(Math.pow(_,b)-1)}(n,i,e.stops[l][0],e.stops[l+1][0]),d=e.stops[l][1],f=e.stops[l+1][1];let p=wg[t.type]||Fc;if(e.colorSpace&&"rgb"!==e.colorSpace){const g=Cu[e.colorSpace];p=(_,v)=>g.reverse(g.interpolate(g.forward(_),g.forward(v),u))}return"function"==typeof d.evaluate?{evaluate(...g){const _=d.evaluate.apply(void 0,g),v=f.evaluate.apply(void 0,g);if(void 0!==_&&void 0!==v)return p(_,v,u)}}:p(d,f,u)}function Pw(e,t,n){return"color"===t.type?n=Ae.parse(n):"formatted"===t.type?n=He.fromString(n.toString()):"resolvedImage"===t.type?n=Jo.fromString(n.toString()):gn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),Tg(n,e.default,t.default)}class Sg{constructor(t,n,i){var a;this.expression=t,this._warningHistory={},this._evaluator=new l2(i),this._defaultValue=n?"color"===(a=n).type&&(il(a.default)||Array.isArray(a.default))?new Ae(0,0,0,0):"color"===a.type?Ae.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(t,n,i,a,l,u,d,f){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=i,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=u,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=f||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,i,a,l,u,d,f){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=i||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=u||null,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=f||null;try{const p=this.expression.evaluate(this._evaluator);if(null==p||"number"==typeof p&&p!=p)return this._defaultValue;if(this._enumValues&&!(p in this._enumValues))throw new Ti(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(p)} instead.`);return p}catch(p){return this._warningHistory[p.message]||(this._warningHistory[p.message]=!0,typeof console<"u"&&console.warn(p.message)),this._defaultValue}}}function $f(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Cg}function Vl(e,t,n){const i=new vo(Cg,[],t?function(l){const u={color:pa,string:nn,number:Ht,enum:nn,boolean:un,formatted:rg,resolvedImage:_o};return"array"===l.type?be(u[l.value]||on,l.length):u[l.type]}(t):void 0,void 0,void 0,n),a=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return a?M2(new Sg(a,t,n)):Vh(i.errors)}class Hf{constructor(t,n,i){this.kind=t,this._styleExpression=n,this.isLightConstant=i,this.isStateDependent="constant"!==t&&!yg(n.expression),this.isConfigDependent=!vg(n.expression)}evaluateWithoutErrorHandling(t,n,i,a,l,u){return this._styleExpression.evaluateWithoutErrorHandling(t,n,i,a,l,u)}evaluate(t,n,i,a,l,u){return this._styleExpression.evaluate(t,n,i,a,l,u)}}class jl{constructor(t,n,i,a,l){this.kind=t,this.zoomStops=i,this._styleExpression=n,this.isStateDependent="camera"!==t&&!yg(n.expression),this.isLightConstant=l,this.isConfigDependent=!vg(n.expression),this.interpolationType=a}evaluateWithoutErrorHandling(t,n,i,a,l,u){return this._styleExpression.evaluateWithoutErrorHandling(t,n,i,a,l,u)}evaluate(t,n,i,a,l,u){return this._styleExpression.evaluate(t,n,i,a,l,u)}interpolationFactor(t,n,i){return this.interpolationType?_a.interpolationFactor(this.interpolationType,t,n,i):0}}function Gf(e,t,n){if("error"===(e=Vl(e,t,n)).result)return e;const i=e.value.expression,a=Fo(i);if(!a&&!Lc(t))return Vh([new Fl("","data expressions not supported")]);const l=je(i,["zoom","pitch","distance-from-center"]);if(!l&&!Iw(t))return Vh([new Fl("","zoom expressions not supported")]);const u=je(i,["measure-light"]);if(!u&&!C2(t))return Vh([new Fl("","measure-light expression not supported")]);const d=t.expression&&t.expression.relaxZoomRestriction,f=qf(i);return f||l||d?f instanceof Fl?Vh([f]):f instanceof _a&&!Aw(t)?Vh([new Fl("",'"interpolate" expressions cannot be used with this property')]):M2(f?new jl(a?"camera":"composite",e.value,f.labels,f instanceof _a?f.interpolation:void 0,u):new Hf(a?"constant":"source",e.value,u)):Vh([new Fl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class jh{constructor(t,n){this._parameters=t,this._specification=n,Ic(this,T2(this._parameters,this._specification))}static deserialize(t){return new jh(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function qf(e){let t=null;if(e instanceof zh)t=qf(e.result);else if(e instanceof rl){for(const n of e.args)if(t=qf(n),t)break}else(e instanceof bg||e instanceof _a)&&e.input instanceof Ko&&"zoom"===e.input.name&&(t=e);return t instanceof Fl||e.eachChild(n=>{const i=qf(n);i instanceof Fl?t=i:t&&i&&t!==i&&(t=new Fl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ss(e){const t=e.key,n=e.value,i=e.valueSpec||{},a=e.objectElementValidators||{},l=e.style,u=e.styleSpec;let d=[];const f=gn(n);if("object"!==f)return[new Dt(t,n,`object expected, ${f} found`)];for(const p in n){const g=p.split(".")[0];let _;a[g]?_=a[g]:i[g]?_=Ii:a["*"]?_=a["*"]:i["*"]&&(_=Ii),_?d=d.concat(_({key:(t&&`${t}.`)+p,value:n[p],valueSpec:i[g]||i["*"],style:l,styleSpec:u,object:n,objectKey:p},n)):d.push(new bu(t,n[p],`unknown property "${p}"`))}for(const p in i)a[p]||i[p].required&&void 0===i[p].default&&void 0===n[p]&&d.push(new Dt(t,n,`missing required property "${p}"`));return d}function jv(e){const t=e.value,n=e.valueSpec,i=e.style,a=e.styleSpec,l=e.key,u=e.arrayElementValidator||Ii;if("array"!==gn(t))return[new Dt(l,t,`array expected, ${gn(t)} found`)];if(n.length&&t.length!==n.length)return[new Dt(l,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Dt(l,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let d={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};a.$version<7&&(d.function=n.function),"object"===gn(n.value)&&(d=n.value);let f=[];for(let p=0;p<t.length;p++)f=f.concat(u({array:t,arrayIndex:p,value:t[p],valueSpec:d,style:i,styleSpec:a,key:`${l}[${p}]`},!0));return f}function Zf(e){const t=e.key,n=e.value,i=e.valueSpec;let a=gn(n);if("number"===a&&n!=n&&(a="NaN"),"number"!==a)return[new Dt(t,n,`number expected, ${a} found`)];if("minimum"in i){let l=i.minimum;if("array"===gn(i.minimum)&&(l=i.minimum[e.arrayIndex]),n<l)return[new Dt(t,n,`${n} is less than the minimum value ${l}`)]}if("maximum"in i){let l=i.maximum;if("array"===gn(i.maximum)&&(l=i.maximum[e.arrayIndex]),n>l)return[new Dt(t,n,`${n} is greater than the maximum value ${l}`)]}return[]}function Uh(e){const t=e.valueSpec,n=qr(e.value.type);let i,a,l,u={};const d="categorical"!==n&&void 0===e.value.property,f=!d,p="array"===gn(e.value.stops)&&"array"===gn(e.value.stops[0])&&"object"===gn(e.value.stops[0][0]),g=Ss({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(x){if("identity"===n)return[new Dt(x.key,x.value,'identity function may not have a "stops" property')];let b=[];const E=x.value;return b=b.concat(jv({key:x.key,value:E,valueSpec:x.valueSpec,style:x.style,styleSpec:x.styleSpec,arrayElementValidator:_})),"array"===gn(E)&&0===E.length&&b.push(new Dt(x.key,E,"array must have at least one stop")),b},default:function(x){return Ii({key:x.key,value:x.value,valueSpec:t,style:x.style,styleSpec:x.styleSpec})}}});return"identity"===n&&d&&g.push(new Dt(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||g.push(new Dt(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!Aw(e.valueSpec)&&g.push(new Dt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(f&&!Lc(e.valueSpec)?g.push(new Dt(e.key,e.value,"property functions not supported")):d&&!Iw(e.valueSpec)&&g.push(new Dt(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!p||void 0!==e.value.property||g.push(new Dt(e.key,e.value,'"property" property is required')),g;function _(x){let b=[];const E=x.value,T=x.key;if("array"!==gn(E))return[new Dt(T,E,`array expected, ${gn(E)} found`)];if(2!==E.length)return[new Dt(T,E,`array length 2 expected, length ${E.length} found`)];if(p){if("object"!==gn(E[0]))return[new Dt(T,E,`object expected, ${gn(E[0])} found`)];if(void 0===E[0].zoom)return[new Dt(T,E,"object stop key must have zoom")];if(void 0===E[0].value)return[new Dt(T,E,"object stop key must have value")];const C=qr(E[0].zoom);if("number"!=typeof C)return[new Dt(T,E[0].zoom,"stop zoom values must be numbers")];if(l&&l>C)return[new Dt(T,E[0].zoom,"stop zoom values must appear in ascending order")];C!==l&&(l=C,a=void 0,u={}),b=b.concat(Ss({key:`${T}[0]`,value:E[0],valueSpec:{zoom:{}},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{zoom:Zf,value:v}}))}else b=b.concat(v({key:`${T}[0]`,value:E[0],valueSpec:{},style:x.style,styleSpec:x.styleSpec},E));return $f(fa(E[1]))?b.concat([new Dt(`${T}[1]`,E[1],"expressions are not allowed in function stops.")]):b.concat(Ii({key:`${T}[1]`,value:E[1],valueSpec:t,style:x.style,styleSpec:x.styleSpec}))}function v(x,b){const E=gn(x.value),T=qr(x.value),C=null!==x.value?x.value:b;if(i){if(E!==i)return[new Dt(x.key,C,`${E} stop domain type must match previous stop domain type ${i}`)]}else i=E;if("number"!==E&&"string"!==E&&"boolean"!==E&&"number"!=typeof T&&"string"!=typeof T&&"boolean"!=typeof T)return[new Dt(x.key,C,"stop domain value must be a number, string, or boolean")];if("number"!==E&&"categorical"!==n){let D=`number expected, ${E} found`;return Lc(t)&&void 0===n&&(D+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Dt(x.key,C,D)]}return"categorical"!==n||"number"!==E||"number"==typeof T&&isFinite(T)&&Math.floor(T)===T?"categorical"!==n&&"number"===E&&"number"==typeof T&&"number"==typeof a&&void 0!==a&&T<a?[new Dt(x.key,C,"stop domain values must appear in ascending order")]:(a=T,"categorical"===n&&T in u?[new Dt(x.key,C,"stop domain values must be unique")]:(u[T]=!0,[])):[new Dt(x.key,C,`integer expected, found ${String(T)}`)]}}function Ws(e){const t=("property"===e.expressionContext?Gf:Vl)(fa(e.value),e.valueSpec);if("error"===t.result)return t.value.map(i=>new Dt(`${e.key}${i.key}`,e.value,i.message));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Dt(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!yg(n))return[new Dt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Uv(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!je(n,["zoom","feature-state"]))return[new Dt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Fo(n))return[new Dt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Uv(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const a of t.valueSpec.expression.parameters)n.delete(a);if(0===n.size)return[];const i=[];return e instanceof Ko&&n.has(e.name)?[new Dt(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(a=>{i.push(...Uv(a,t))}),i)}function $v(e){const t=e.key,n=e.value,i=e.valueSpec,a=[];return Array.isArray(i.values)?-1===i.values.indexOf(qr(n))&&a.push(new Dt(t,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(qr(n))&&a.push(new Dt(t,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),a}function Rw(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Rw(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Hv(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Rw(e)||(e=$h(e));const n=e;let i=!0;try{i=function(p){if(!Wf(p))return p;let g=fa(p);return kw(g),g=Ow(g),g}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const a=J[`filter_${t}`],l=Vl(i,a);let u=null;if("error"===l.result)throw new Error(l.value.map(p=>`${p.key}: ${p.message}`).join(", "));u=(p,g,_)=>l.value.evaluate(p,g,{},_);let d=null,f=null;if(i!==n){const p=Vl(n,a);if("error"===p.result)throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));d=(g,_,v,x,b)=>p.value.evaluate(g,_,{},v,void 0,void 0,x,b),f=!Fo(p.value.expression)}return{filter:u,dynamicFilter:d||void 0,needGeometry:Fw(i),needFeature:!!f}}function Ow(e){if(!Array.isArray(e))return e;const t=function(n){if(Lw.has(n[0]))for(let i=1;i<n.length;i++)if(Wf(n[i]))return!0;return n}(e);return!0===t?t:t.map(n=>Ow(n))}function kw(e){let t=!1;const n=[];if("case"===e[0]){for(let i=1;i<e.length-1;i+=2)t=t||Wf(e[i]),n.push(e[i+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||Wf(e[1]);for(let i=2;i<e.length-1;i+=2)n.push(e[i+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||Wf(e[1]);for(let i=1;i<e.length-1;i+=2)n.push(e[i+1])}t&&(e.length=0,e.push("any",...n));for(let i=1;i<e.length;i++)kw(e[i])}function Wf(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<e.length;n++)if(Wf(e[n]))return!0;return!1}const Lw=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gv(e,t){return e<t?-1:e>t?1:0}function Fw(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Fw(e[t]))return!0;return!1}function $h(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Nw(e[1],e[2],"=="):"!="===t?Xf(Nw(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Nw(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map($h))):"all"===t?["all"].concat(e.slice(1).map($h)):"none"===t?["all"].concat(e.slice(1).map($h).map(Xf)):"in"===t?D2(e[1],e.slice(2)):"!in"===t?Xf(D2(e[1],e.slice(2))):"has"===t?zw(e[1]):"!has"!==t||Xf(zw(e[1]));var n}function Nw(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function D2(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Gv)]]:["filter-in-small",e,["literal",t]]}}function zw(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Xf(e){return["!",e]}function Ig(e){return Rw(fa(e.value))?Ws(Ic({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):Bw(e)}function Bw(e){const t=e.value,n=e.key;if("array"!==gn(t))return[new Dt(n,t,`array expected, ${gn(t)} found`)];const i=e.styleSpec;let a,l=[];if(t.length<1)return[new Dt(n,t,"filter array must have at least 1 element")];switch(l=l.concat($v({key:`${n}[0]`,value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),qr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===qr(t[1])&&l.push(new Dt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&l.push(new Dt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(a=gn(t[1]),"string"!==a&&l.push(new Dt(`${n}[1]`,t[1],`string expected, ${a} found`)));for(let u=2;u<t.length;u++)a=gn(t[u]),"$type"===qr(t[1])?l=l.concat($v({key:`${n}[${u}]`,value:t[u],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&l.push(new Dt(`${n}[${u}]`,t[u],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let u=1;u<t.length;u++)l=l.concat(Bw({key:`${n}[${u}]`,value:t[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":a=gn(t[1]),2!==t.length?l.push(new Dt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==a&&l.push(new Dt(`${n}[1]`,t[1],`string expected, ${a} found`))}return l}function Vw(e,t){const n=e.key,i=e.style,a=e.layer,l=e.styleSpec,u=e.value,d=e.objectKey,f=l[`${t}_${e.layerType}`];if(!f)return[];const p=d.match(/^(.*)-transition$/);if("paint"===t&&p&&f[p[1]]&&f[p[1]].transition)return Ii({key:n,value:u,valueSpec:l.transition,style:i,styleSpec:l});const g=e.valueSpec||f[d];if(!g)return[new bu(n,u,`unknown property "${d}"`)];let _;if("string"===gn(u)&&Lc(g)&&!g.tokens&&(_=/^{([^}]+)}$/.exec(u))){const x=`\`{ "type": "identity", "property": ${_?JSON.stringify(_[1]):'"_"'} }\``;return[new Dt(n,u,`"${d}" does not support interpolation syntax\nUse an identity property function instead: ${x}.`)]}const v=[];if("symbol"===e.layerType)"text-field"!==d||!i||i.glyphs||i.imports||v.push(new Dt(n,u,'use of "text-field" requires a style "glyphs" property')),"text-font"===d&&il(fa(u))&&"identity"===qr(u.type)&&v.push(new Dt(n,u,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&Lc(g)&&(C2(g)||Iw(g))){const x=Gf(fa(u),g),b=x.value.expression||x.value._styleExpression.expression;b&&!je(b,["measure-light"])&&v.push(new Dt(n,u,`${d} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`))}return v.concat(Ii({key:e.key,value:u,valueSpec:g,style:i,styleSpec:l,expressionContext:"property",propertyType:t,propertyKey:d}))}function jw(e){return Vw(e,"paint")}function qv(e){return Vw(e,"layout")}function Uw(e){let t=[];const n=e.value,i=e.key,a=e.style,l=e.styleSpec;n.type||n.ref||t.push(new Dt(i,n,'either "type" or "ref" is required'));let u=qr(n.type);const d=qr(n.ref);if(n.id){const f=qr(n.id);for(let p=0;p<e.arrayIndex;p++){const g=a.layers[p];qr(g.id)===f&&t.push(new Dt(i,n.id,`duplicate layer id "${n.id}", previously used at line ${g.id.__line__}`))}}if("ref"in n){let f;["type","source","source-layer","filter","layout"].forEach(p=>{p in n&&t.push(new Dt(i,n[p],`"${p}" is prohibited for ref layers`))}),a.layers.forEach(p=>{qr(p.id)===d&&(f=p)}),f?f.ref?t.push(new Dt(i,n.ref,"ref cannot reference another ref layer")):u=qr(f.type):"string"==typeof d&&t.push(new Dt(i,n.ref,`ref layer "${d}" not found`))}else if("background"!==u&&"sky"!==u&&"slot"!==u)if(n.source){const f=a.sources&&a.sources[n.source],p=f&&qr(f.type);f?"vector"===p&&"raster"===u?t.push(new Dt(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===p&&"raster"!==u?t.push(new Dt(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==p||n["source-layer"]?"raster-dem"===p&&"hillshade"!==u?t.push(new Dt(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==u||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===p&&f.lineMetrics||t.push(new Dt(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Dt(i,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Dt(i,n.source,`source "${n.source}" not found`))}else t.push(new Dt(i,n,'missing required property "source"'));return t=t.concat(Ss({key:i,value:n,valueSpec:l.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ii({key:`${i}.type`,value:n.type,valueSpec:l.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:f=>Ig(Ic({layerType:u},f)),layout:f=>Ss({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>qv(Ic({layerType:u},p))}}),paint:f=>Ss({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>jw(Ic({layerType:u,layer:n},p))}})}})),t}function Su(e){const t=e.value,n=e.key,i=gn(t);return"string"!==i?[new Dt(n,t,`string expected, ${i} found`)]:[]}const $w={promoteId:function({key:e,value:t}){if("string"===gn(t))return Su({key:e,value:t});{const n=[];for(const i in t)n.push(...Su({key:`${e}.${i}`,value:t[i]}));return n}}};function S2(e){const t=e.value,n=e.key,i=e.styleSpec,a=e.style;if(!t.type)return[new Dt(n,t,'"type" is required')];const l=qr(t.type);let u;switch(l){case"vector":case"raster":case"raster-dem":return u=Ss({key:n,value:t,valueSpec:i[`source_${l.replace("-","_")}`],style:e.style,styleSpec:i,objectElementValidators:$w}),u;case"geojson":if(u=Ss({key:n,value:t,valueSpec:i.source_geojson,style:a,styleSpec:i,objectElementValidators:$w}),t.cluster)for(const d in t.clusterProperties){const[f,p]=t.clusterProperties[d],g="string"==typeof f?[f,["accumulated"],["get",d]]:f;u.push(...Ws({key:`${n}.${d}.map`,value:p,expressionContext:"cluster-map"})),u.push(...Ws({key:`${n}.${d}.reduce`,value:g,expressionContext:"cluster-reduce"}))}return u;case"video":return Ss({key:n,value:t,valueSpec:i.source_video,style:a,styleSpec:i});case"image":return Ss({key:n,value:t,valueSpec:i.source_image,style:a,styleSpec:i});case"canvas":return[new Dt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $v({key:`${n}.type`,value:t.type,valueSpec:{values:I2(i)},style:a,styleSpec:i})}}function I2(e){return e.source.reduce((t,n)=>{const i=e[n];return"enum"===i.type.type&&(t=t.concat(Object.keys(i.type.values))),t},[])}function Is(e){const t=e.value;let n=[];if(!t)return n;const i=gn(t);return"string"!==i?(n=n.concat([new Dt(e.key,t,`string expected, "${i}" found`)]),n):(function(a){const l=-1===a.indexOf("://");try{return new URL(a,l?"http://example.com":void 0),!0}catch{return!1}}(t)||(n=n.concat([new Dt(e.key,t,`invalid url "${t}"`)])),n)}function Zv(e){const t=e.value,n=e.styleSpec,i=n.light,a=e.style;let l=[];const u=gn(t);if(void 0===t)return l;if("object"!==u)return l=l.concat([new Dt("light",t,`object expected, ${u} found`)]),l;for(const d in t){const f=d.match(/^(.*)-transition$/);l=l.concat(f&&i[f[1]]&&i[f[1]].transition?Ii({key:d,value:t[d],valueSpec:n.transition,style:a,styleSpec:n}):i[d]?Ii({key:d,value:t[d],valueSpec:i[d],style:a,styleSpec:n}):[new Dt(d,t[d],`unknown property "${d}"`)])}return l}function Hw(e){const t=e.value;let n=[];if(!t)return n;const i=gn(t);if("object"!==i)return n=n.concat([new Dt("light-3d",t,`object expected, ${i} found`)]),n;const a=e.styleSpec,l=a["light-3d"],u=e.key,d=e.style,f=e.style.lights;for(const _ of["type","id"])if(!(_ in t))return n=n.concat([new Dt("light-3d",t,`missing property ${_} on light`)]),n;if(t.type&&f)for(let _=0;_<e.arrayIndex;_++){const v=qr(t.type),x=f[_];qr(x.type)===v&&n.push(new Dt(u,t.id,`duplicate light type "${t.type}", previously defined at line ${x.id.__line__}`))}const p=`properties_light_${t.type}`;if(!(p in a))return n=n.concat([new Dt("light-3d",t,`Invalid light type ${t.type}`)]),n;const g=a[p];for(const _ in t)if("properties"===_){const v=t[_],x=gn(v);if("object"!==x)return n=n.concat([new Dt("properties",v,`object expected, ${x} found`)]),n;for(const b in v)n=n.concat(g[b]?Ii({key:b,value:v[b],valueSpec:g[b],style:d,styleSpec:a}):[new bu(e.key,v[b],`unknown property "${b}"`)])}else{const v=_.match(/^(.*)-transition$/);n=n.concat(v&&l[v[1]]&&l[v[1]].transition?Ii({key:_,value:t[_],valueSpec:a.transition,style:d,styleSpec:a}):l[_]?Ii({key:_,value:t[_],valueSpec:l[_],style:d,styleSpec:a}):[new bu(_,t[_],`unknown property "${_}"`)])}return n}function Gw(e){const t=e.value,n=e.key,i=e.style,a=e.styleSpec,l=a.terrain;let u=[];const d=gn(t);if(void 0===t)return u;if("object"!==d)return u=u.concat([new Dt("terrain",t,`object expected, ${d} found`)]),u;for(const f in t){const p=f.match(/^(.*)-transition$/);u=u.concat(p&&l[p[1]]&&l[p[1]].transition?Ii({key:f,value:t[f],valueSpec:a.transition,style:i,styleSpec:a}):l[f]?Ii({key:f,value:t[f],valueSpec:l[f],style:i,styleSpec:a}):[new bu(f,t[f],`unknown property "${f}"`)])}if(t.source){const f=i.sources&&i.sources[t.source],p=f&&qr(f.type);f?"raster-dem"!==p&&u.push(new Dt(n,t.source,`terrain cannot be used with a source of type ${String(p)}, it only be used with a "raster-dem" source type`)):u.push(new Dt(n,t.source,`source "${t.source}" not found`))}else u.push(new Dt(n,t,'terrain is missing required property "source"'));return u}function Wv(e){const t=e.value,n=e.style,i=e.styleSpec,a=i.fog;let l=[];const u=gn(t);if(void 0===t)return l;if("object"!==u)return l=l.concat([new Dt("fog",t,`object expected, ${u} found`)]),l;for(const d in t){const f=d.match(/^(.*)-transition$/);l=l.concat(f&&a[f[1]]&&a[f[1]].transition?Ii({key:d,value:t[d],valueSpec:i.transition,style:n,styleSpec:i}):a[d]?Ii({key:d,value:t[d],valueSpec:a[d],style:n,styleSpec:i}):[new bu(d,t[d],`unknown property "${d}"`)])}return l}const Xv={"*":()=>[],array:jv,boolean:function(e){const t=e.value,n=e.key,i=gn(t);return"boolean"!==i?[new Dt(n,t,`boolean expected, ${i} found`)]:[]},number:Zf,color:function(e){const t=e.key,n=e.value,i=gn(n);return"string"!==i?[new Dt(t,n,`color expected, ${i} found`)]:null===Yo(n)?[new Dt(t,n,`color expected, "${n}" found`)]:[]},enum:$v,filter:Ig,function:Uh,layer:Uw,object:Ss,source:S2,model:Is,light:Zv,"light-3d":Hw,terrain:Gw,fog:Wv,string:Su,formatted:function(e){return 0===Su(e).length?[]:Ws(e)},resolvedImage:function(e){return 0===Su(e).length?[]:Ws(e)},projection:function(e){const t=e.value,n=e.styleSpec,i=n.projection,a=e.style;let l=[];const u=gn(t);if("object"===u)for(const d in t)l=l.concat(Ii({key:d,value:t[d],valueSpec:i[d],style:a,styleSpec:n}));else"string"!==u&&(l=l.concat([new Dt("projection",t,`object or string expected, ${u} found`)]));return l},import:function(e){const{value:t,styleSpec:n}=e,{data:i,...a}=t;Object.defineProperty(a,"__line__",{value:t.__line__,enumerable:!1});let l=Ss(Ic({},e,{value:a,valueSpec:n.import}));return""===qr(a.id)&&l.push(new Dt(`${e.key}.id`,a,"import id can't be an empty string")),i&&(l=l.concat(qw(i,n,{key:`${e.key}.data`}))),l}};function Ii(e,t=!1){const n=e.value,i=e.valueSpec,a=e.styleSpec;if(i.expression&&il(qr(n)))return Uh(e);if(i.expression&&$f(fa(n)))return Ws(e);if(i.type&&Xv[i.type]){const l=Xv[i.type](e);return!0===t&&l.length>0&&"array"===gn(e.value)?Ws(e):l}return Ss(Ic({},e,{valueSpec:i.type?a[i.type]:i}))}function Yv(e){const t=e.value,n=e.key,i=Su(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new Dt(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new Dt(n,t,'"glyphs" url must include a "{range}" token'))),i}function qw(e,t=J,n={}){return Ii({key:n.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Yv,"*":()=>[]}})}function zo(e,t=J){return va(qw(e,t))}const Zw=e=>va(S2(e)),Ww=e=>va(Zv(e)),Dr=e=>va(Hw(e)),Jv=e=>va(Gw(e)),Ag=e=>va(Wv(e)),Qo=e=>va(Uw(e)),Kv=e=>va(Ig(e)),Xw=e=>va(jw(e)),Hh=e=>va(qv(e)),As=e=>va(Is(e));function va(e){return e.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function Pg(e,t){let n=!1;if(t&&t.length)for(const i of t)i instanceof bu?K(i.message):(e.fire(new pt(new Error(i.message))),n=!0);return n}var A2=xa,Bo=3;function xa(e,t,n){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var a=new Int32Array(this.arrayBuffer);e=a[0],this.d=(t=a[1])+2*(n=a[2]);for(var l=0;l<this.d*this.d;l++){var u=a[Bo+l],d=a[Bo+l+1];i.push(u===d?null:a.subarray(u,d))}var f=a[Bo+i.length+1];this.keys=a.subarray(a[Bo+i.length],f),this.bboxes=a.subarray(f),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var p=0;p<this.d*this.d;p++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var g=n/t*e;this.min=-g,this.max=e+g}xa.prototype.insert=function(e,t,n,i,a){this._forEachCell(t,n,i,a,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a)},xa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xa.prototype._insertCell=function(e,t,n,i,a,l){this.cells[a].push(l)},xa.prototype.query=function(e,t,n,i,a){var l=this.min,u=this.max;if(e<=l&&t<=l&&u<=n&&u<=i&&!a)return Array.prototype.slice.call(this.keys);var d=[];return this._forEachCell(e,t,n,i,this._queryCell,d,{},a),d},xa.prototype._queryCell=function(e,t,n,i,a,l,u,d){var f=this.cells[a];if(null!==f)for(var p=this.keys,g=this.bboxes,_=0;_<f.length;_++){var v=f[_];if(void 0===u[v]){var x=4*v;(d?d(g[x+0],g[x+1],g[x+2],g[x+3]):e<=g[x+2]&&t<=g[x+3]&&n>=g[x+0]&&i>=g[x+1])?(u[v]=!0,l.push(p[v])):u[v]=!1}}},xa.prototype._forEachCell=function(e,t,n,i,a,l,u,d){for(var f=this._convertToCellCoord(e),p=this._convertToCellCoord(t),g=this._convertToCellCoord(n),_=this._convertToCellCoord(i),v=f;v<=g;v++)for(var x=p;x<=_;x++){var b=this.d*x+v;if((!d||d(this._convertFromCellCoord(v),this._convertFromCellCoord(x),this._convertFromCellCoord(v+1),this._convertFromCellCoord(x+1)))&&a.call(this,e,t,n,i,b,l,u,d))return}},xa.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},xa.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},xa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Bo+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var a=new Int32Array(t+n+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var l=t,u=0;u<e.length;u++){var d=e[u];a[Bo+u]=l,a.set(d,l),l+=d.length}return a[Bo+e.length]=l,a.set(this.keys,l),a[Bo+e.length+1]=l+=this.keys.length,a.set(this.bboxes,l),l+=this.bboxes.length,a.buffer};var Gh=Zo(A2);const Yf={};function Gt(e,t,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Yf[t]={klass:e,omit:n.omit||[]}}Gt(Object,"Object"),Gh.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},Gh.deserialize=function(e){return new Gh(e.buffer)},Object.defineProperty(Gh,"name",{value:"Grid"}),Gt(Gh,"Grid"),Gt(Ae,"Color"),Gt(Error,"Error"),Gt(yt,"AJAXError"),Gt(Jo,"ResolvedImage"),Gt(jh,"StylePropertyFunction"),Gt(Sg,"StyleExpression",{omit:["_evaluator"]}),Gt(jl,"ZoomDependentExpression"),Gt(Hf,"ZoomConstantExpression"),Gt(Ko,"CompoundExpression",{omit:["_evaluate"]});for(const e in Cg)Yf[Cg[e]._classRegistryKey]||Gt(Cg[e],`Expression${e}`);function Qv(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Yw(e){return it.ImageBitmap&&e instanceof it.ImageBitmap}function ze(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Qv(e)||Yw(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.add(n.buffer),n}if(e instanceof it.ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const i of e)n.push(ze(i,t));return n}if(e instanceof Map){const n={$name:"Map"};for(const[i,a]of e.entries())n[i]=ze(a);return n}if("object"==typeof e){const n=e.constructor,i=n._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);const a=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const l in e)e.hasOwnProperty(l)&&(Yf[i].omit.indexOf(l)>=0||(a[l]=ze(e[l],t)));e instanceof Error&&(a.message=e.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(a.$name=i),a}throw new Error("can't serialize object of type "+typeof e)}function Iu(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Qv(e)||Yw(e)||ArrayBuffer.isView(e)||e instanceof it.ImageData)return e;if(Array.isArray(e))return e.map(Iu);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const a=new Map;for(const l of Object.keys(e))"$name"!==l&&a.set(l,Iu(e[l]));return a}const{klass:n}=Yf[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const a of Object.keys(e))"$name"!==a&&(i[a]=Iu(e[a]));return i}throw new Error("can't deserialize object of type "+typeof e)}const Jt={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function t0(e){for(const t of e)if(Rg(t.charCodeAt(0)))return!0;return!1}function P2(e){for(const t of e)if(!R2(t.charCodeAt(0)))return!1;return!0}function R2(e){return!(Jt.Arabic(e)||Jt["Arabic Supplement"](e)||Jt["Arabic Extended-A"](e)||Jt["Arabic Presentation Forms-A"](e)||Jt["Arabic Presentation Forms-B"](e))}function Rg(e){return!(746!==e&&747!==e&&(e<4352||!(Jt["Bopomofo Extended"](e)||Jt.Bopomofo(e)||Jt["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Jt["CJK Compatibility Ideographs"](e)||Jt["CJK Compatibility"](e)||Jt["CJK Radicals Supplement"](e)||Jt["CJK Strokes"](e)||!(!Jt["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Jt["CJK Unified Ideographs Extension A"](e)||Jt["CJK Unified Ideographs"](e)||Jt["Enclosed CJK Letters and Months"](e)||Jt["Hangul Compatibility Jamo"](e)||Jt["Hangul Jamo Extended-A"](e)||Jt["Hangul Jamo Extended-B"](e)||Jt["Hangul Jamo"](e)||Jt["Hangul Syllables"](e)||Jt.Hiragana(e)||Jt["Ideographic Description Characters"](e)||Jt.Kanbun(e)||Jt["Kangxi Radicals"](e)||Jt["Katakana Phonetic Extensions"](e)||Jt.Katakana(e)&&12540!==e||!(!Jt["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Jt["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Jt["Unified Canadian Aboriginal Syllabics"](e)||Jt["Unified Canadian Aboriginal Syllabics Extended"](e)||Jt["Vertical Forms"](e)||Jt["Yijing Hexagram Symbols"](e)||Jt["Yi Syllables"](e)||Jt["Yi Radicals"](e))))}function Au(e){return!(Rg(e)||(t=e,Jt["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Jt["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Jt["Letterlike Symbols"](t)||Jt["Number Forms"](t)||Jt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Jt["Control Pictures"](t)&&9251!==t||Jt["Optical Character Recognition"](t)||Jt["Enclosed Alphanumerics"](t)||Jt["Geometric Shapes"](t)||Jt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Jt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Jt["CJK Symbols and Punctuation"](t)||Jt.Katakana(t)||Jt["Private Use Area"](t)||Jt["CJK Compatibility Forms"](t)||Jt["Small Form Variants"](t)||Jt["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function Jw(e){return e>=1424&&e<=2303||Jt["Arabic Presentation Forms-A"](e)||Jt["Arabic Presentation Forms-B"](e)}function O2(e,t){return!(!t&&Jw(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Jt.Khmer(e))}function k2(e){for(const t of e)if(Jw(t.charCodeAt(0)))return!0;return!1}const e0="deferred",n0="loading",Ot="loaded";let Dn=null,ts="unavailable",Nc=null;const $i=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(ts="error"),Dn&&Dn(e)};function Og(){Pu.fire(new Mt("pluginStateChange",{pluginStatus:ts,pluginURL:Nc}))}const Pu=new wr,Xs=function(){return ts},kg=function(){if(ts!==e0||!Nc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ts=n0,Og(),Nc&&kt({url:Nc},e=>{e?$i(e):(ts=Ot,Og())})},es={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ts===Ot||null!=es.applyArabicShaping,isLoading:()=>ts===n0,setState(e){ts=e.pluginStatus,Nc=e.pluginURL},isParsed:()=>null!=es.applyArabicShaping&&null!=es.processBidirectionalText&&null!=es.processStyledBidirectionalText,getPluginURL:()=>Nc};class er{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(n,i){for(const a of n)if(!O2(a.charCodeAt(0),i))return!1;return!0}(t,es.isLoaded())}}class r0{constructor(t,n,i){this.property=t,this.value=n,this.expression=function(a,l,u){if(il(a))return new jh(a,l);if($f(a)||Array.isArray(a)&&a.length>0){const d=Gf(a,l,u);if("error"===d.result)throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=a;return"string"==typeof a&&"color"===l.type&&(d=Ae.parse(a)),{kind:"constant",isConfigDependent:!1,evaluate:()=>d}}}(void 0===n?t.specification.default:n,t.specification,i)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,n,i){return this.property.possiblyEvaluate(this,t,n,i)}}class Lg{constructor(t,n){this.property=t,this.value=new r0(t,void 0,n)}transitioned(t,n){return new ol(this.property,this.value,n,qt({},t.transition,this.transition),t.now)}untransitioned(){return new ol(this.property,this.value,null,{},0)}}class Ai{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=n,this.isConfigDependent=!1}getValue(t){return U(this._values[t].value.value)}setValue(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new Lg(this._values[t].property,this._options)),this._values[t].value=new r0(this._values[t].property,null===n?void 0:U(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,n){n&&(this._options=n);const i=this._properties.properties;if(t)for(const a in t){const l=t[a];if(Mc(a,"-transition")){const u=a.slice(0,-11);i[u]&&this.setTransition(u,l)}else i[a]&&this.setValue(a,l)}}getTransition(t){return U(this._values[t].transition)}setTransition(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new Lg(this._values[t].property)),this._values[t].transition=U(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const i=this.getValue(n);void 0!==i&&(t[n]=i);const a=this.getTransition(n);void 0!==a&&(t[`${n}-transition`]=a)}return t}transitioned(t,n){const i=new o0(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].transitioned(t,n._values[a]);return i}untransitioned(){const t=new o0(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class ol{constructor(t,n,i,a,l){const u=a.delay||0,d=a.duration||0;l=l||0,this.property=t,this.value=n,this.begin=l+u,this.end=this.begin+d,t.specification.transition&&(a.delay||a.duration)&&(this.prior=i)}possiblyEvaluate(t,n,i){const a=t.now||0,l=this.value.possiblyEvaluate(t,n,i),u=this.prior;if(u){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return u.possiblyEvaluate(t,n,i);{const d=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(u.possiblyEvaluate(t,n,i),l,wc(d))}}return l}}class o0{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,i){const a=new Jf(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(t,n,i);return a}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class qh{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=n,this.isConfigDependent=!1}getValue(t){return U(this._values[t].value)}setValue(t,n){this._values[t]=new r0(this._values[t].property,null===n?void 0:U(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const n of Object.keys(this._values)){const i=this.getValue(n);void 0!==i&&(t[n]=i)}return t}possiblyEvaluate(t,n,i){const a=new Jf(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(t,n,i);return a}}class ns{constructor(t,n,i){this.property=t,this.value=n,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,n,i,a){return this.property.evaluate(this.value,this.parameters,t,n,i,a)}}class Jf{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Tt{constructor(t){this.specification=t}possiblyEvaluate(t,n){return t.expression.evaluate(n)}interpolate(t,n,i){const a=wg[this.specification.type];return a?a(t,n,i):t}}class te{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,i,a){return new ns(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(n,null,{},i,a)}:t.expression,n)}interpolate(t,n,i){if("constant"!==t.value.kind||"constant"!==n.value.kind)return t;if(void 0===t.value.value||void 0===n.value.value)return new ns(this,{kind:"constant",value:void 0},t.parameters);const a=wg[this.specification.type];return a?new ns(this,{kind:"constant",value:a(t.value.value,n.value.value,i)},t.parameters):t}evaluate(t,n,i,a,l,u){return"constant"===t.kind?t.value:t.evaluate(n,i,a,l,u)}}class Kf{constructor(t){this.specification=t}possiblyEvaluate(t,n,i,a){return!!t.expression.evaluate(n,null,{},i,a)}interpolate(){return!1}}class nr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new er(0,{});for(const i in t){const a=t[i];a.specification.overridable&&this.overridableProperties.push(i);const l=this.defaultPropertyValues[i]=new r0(a,void 0),u=this.defaultTransitionablePropertyValues[i]=new Lg(a);this.defaultTransitioningPropertyValues[i]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate(n)}}}function Pi(e,t){return t?`${e}\x1f${t}`:e}function Fg(e){const t=e.indexOf("\x1f");return t>=0?e.slice(0,t):e}Gt(te,"DataDrivenProperty"),Gt(Tt,"DataConstantProperty"),Gt(Kf,"ColorRampProperty");const Ng="-transition";class Ps extends wr{constructor(t,n,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=i,t.slot&&(this.slot=t.slot),n.layout&&(this._unevaluatedLayout=new qh(n.layout,i),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Ai(n.paint,i);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Jf(n.paint)}}setScope(t){this.scope=t,this.fqid=Pi(this.id,t)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,i={}){if(null!=n&&this._validate(Hh,`layers.${this.id}.layout.${t}`,t,n,i))return;if("custom"===this.type&&"visibility"===t)return void(this.visibility=n);const a=this._unevaluatedLayout;a._properties.properties[t]&&(a.setValue(t,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return Mc(t,Ng)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,i={}){if(null!=n&&this._validate(Xw,`layers.${this.id}.paint.${t}`,t,n,i))return!1;const a=this._transitionablePaint,l=a._properties.properties;if(Mc(t,Ng)){const v=t.slice(0,-11);return l[v]&&a.setTransition(v,n||void 0),!1}if(!l[t])return!1;const u=a._values[t],d=u.value.isDataDriven(),f=u.value;a.setValue(t,n),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const p=a._values[t].value,g=p.isDataDriven(),_=Mc(t,"pattern")||"line-dasharray"===t;return g||d||_||this._handleOverridablePaintPropertyUpdate(t,f,p)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,n){return null}_handleOverridablePaintPropertyUpdate(t,n,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){return It({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,n)=>!(void 0===t||"layout"===n&&!Object.keys(t).length||"paint"===n&&!Object.keys(t).length))}_validate(t,n,i,a,l={}){return(!l||!1!==l.validate)&&Pg(this,t.call(zo,{key:n,layerType:this.type,objectKey:i,value:a,styleSpec:J,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof ns&&Lc(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Hv(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class Kw{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id)}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this.updatedPaintProps.delete(t.fqid)}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const s0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qf{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function sn(e,t=1){let n=0,i=0;return{members:e.map(a=>{const l=s0[a.type].BYTES_PER_ELEMENT,u=n=a0(n,Math.max(t,l)),d=a.components||1;return i=Math.max(i,l),n+=l*d,{name:a.name,type:a.type,components:d,offset:u}}),size:a0(n,Math.max(i,t)),alignment:t}}function a0(e,t){return Math.ceil(e/t)*t}class wo extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,n)}emplace(t,n,i){const a=2*t;return this.int16[a+0]=n,this.int16[a+1]=i,t}}wo.prototype.bytesPerElement=4,Gt(wo,"StructArrayLayout2i4");class zg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,n,i)}emplace(t,n,i,a){const l=3*t;return this.int16[l+0]=n,this.int16[l+1]=i,this.int16[l+2]=a,t}}zg.prototype.bytesPerElement=6,Gt(zg,"StructArrayLayout3i6");class Ru extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,n,i,a)}emplace(t,n,i,a,l){const u=4*t;return this.int16[u+0]=n,this.int16[u+1]=i,this.int16[u+2]=a,this.int16[u+3]=l,t}}Ru.prototype.bytesPerElement=8,Gt(Ru,"StructArrayLayout4i8");class ao extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,i,a,l)}emplace(t,n,i,a,l,u){const d=5*t;return this.int16[d+0]=n,this.int16[d+1]=i,this.int16[d+2]=a,this.int16[d+3]=l,this.int16[d+4]=u,t}}ao.prototype.bytesPerElement=10,Gt(ao,"StructArrayLayout5i10");class Ul extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,i,a,l,u,d)}emplace(t,n,i,a,l,u,d,f){const p=6*t,g=12*t,_=3*t;return this.int16[p+0]=n,this.int16[p+1]=i,this.uint8[g+4]=a,this.uint8[g+5]=l,this.uint8[g+6]=u,this.uint8[g+7]=d,this.float32[_+2]=f,t}}Ul.prototype.bytesPerElement=12,Gt(Ul,"StructArrayLayout2i4ub1f12");class rr extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,n,i,a)}emplace(t,n,i,a,l){const u=4*t;return this.float32[u+0]=n,this.float32[u+1]=i,this.float32[u+2]=a,this.float32[u+3]=l,t}}rr.prototype.bytesPerElement=16,Gt(rr,"StructArrayLayout4f16");class zc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,i,a,l)}emplace(t,n,i,a,l,u){const d=6*t,f=3*t;return this.uint16[d+0]=n,this.uint16[d+1]=i,this.uint16[d+2]=a,this.uint16[d+3]=l,this.float32[f+2]=u,t}}zc.prototype.bytesPerElement=12,Gt(zc,"StructArrayLayout4ui1f12");class Bg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,n,i,a)}emplace(t,n,i,a,l){const u=4*t;return this.uint16[u+0]=n,this.uint16[u+1]=i,this.uint16[u+2]=a,this.uint16[u+3]=l,t}}Bg.prototype.bytesPerElement=8,Gt(Bg,"StructArrayLayout4ui8");class Vg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,i,a,l,u)}emplace(t,n,i,a,l,u,d){const f=6*t;return this.int16[f+0]=n,this.int16[f+1]=i,this.int16[f+2]=a,this.int16[f+3]=l,this.int16[f+4]=u,this.int16[f+5]=d,t}}Vg.prototype.bytesPerElement=12,Gt(Vg,"StructArrayLayout6i12");class l0 extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d,f,p,g,_,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,i,a,l,u,d,f,p,g,_,v)}emplace(t,n,i,a,l,u,d,f,p,g,_,v,x){const b=12*t;return this.int16[b+0]=n,this.int16[b+1]=i,this.int16[b+2]=a,this.int16[b+3]=l,this.uint16[b+4]=u,this.uint16[b+5]=d,this.uint16[b+6]=f,this.uint16[b+7]=p,this.int16[b+8]=g,this.int16[b+9]=_,this.int16[b+10]=v,this.int16[b+11]=x,t}}l0.prototype.bytesPerElement=24,Gt(l0,"StructArrayLayout4i4ui4i24");class jg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,i,a,l,u)}emplace(t,n,i,a,l,u,d){const f=10*t,p=5*t;return this.int16[f+0]=n,this.int16[f+1]=i,this.int16[f+2]=a,this.float32[p+2]=l,this.float32[p+3]=u,this.float32[p+4]=d,t}}jg.prototype.bytesPerElement=20,Gt(jg,"StructArrayLayout3i3f20");class Ug extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Ug.prototype.bytesPerElement=4,Gt(Ug,"StructArrayLayout1ul4");class ba extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,n)}emplace(t,n,i){const a=2*t;return this.uint16[a+0]=n,this.uint16[a+1]=i,t}}ba.prototype.bytesPerElement=4,Gt(ba,"StructArrayLayout2ui4");class sl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d,f,p,g,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,i,a,l,u,d,f,p,g,_,v,x)}emplace(t,n,i,a,l,u,d,f,p,g,_,v,x,b){const E=20*t,T=10*t;return this.int16[E+0]=n,this.int16[E+1]=i,this.int16[E+2]=a,this.int16[E+3]=l,this.int16[E+4]=u,this.float32[T+3]=d,this.float32[T+4]=f,this.float32[T+5]=p,this.float32[T+6]=g,this.int16[E+14]=_,this.uint32[T+8]=v,this.uint16[E+18]=x,this.uint16[E+19]=b,t}}sl.prototype.bytesPerElement=40,Gt(sl,"StructArrayLayout5i4f1i1ul2ui40");class $g extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,i,a,l,u,d)}emplace(t,n,i,a,l,u,d,f){const p=8*t;return this.int16[p+0]=n,this.int16[p+1]=i,this.int16[p+2]=a,this.int16[p+4]=l,this.int16[p+5]=u,this.int16[p+6]=d,this.int16[p+7]=f,t}}$g.prototype.bytesPerElement=16,Gt($g,"StructArrayLayout3i2i2i16");class Zh extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,i,a,l)}emplace(t,n,i,a,l,u){const d=4*t,f=8*t;return this.float32[d+0]=n,this.float32[d+1]=i,this.float32[d+2]=a,this.int16[f+6]=l,this.int16[f+7]=u,t}}Zh.prototype.bytesPerElement=16,Gt(Zh,"StructArrayLayout2f1f2i16");class Wh extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,n,i,a)}emplace(t,n,i,a,l){const u=12*t,d=3*t;return this.uint8[u+0]=n,this.uint8[u+1]=i,this.float32[d+1]=a,this.float32[d+2]=l,t}}Wh.prototype.bytesPerElement=12,Gt(Wh,"StructArrayLayout2ub2f12");class wa extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,n,i)}emplace(t,n,i,a){const l=3*t;return this.float32[l+0]=n,this.float32[l+1]=i,this.float32[l+2]=a,t}}wa.prototype.bytesPerElement=12,Gt(wa,"StructArrayLayout3f12");class Rr extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,n,i)}emplace(t,n,i,a){const l=3*t;return this.uint16[l+0]=n,this.uint16[l+1]=i,this.uint16[l+2]=a,t}}Rr.prototype.bytesPerElement=6,Gt(Rr,"StructArrayLayout3ui6");class Hg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D,A,P,I){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D,A,P,I)}emplace(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D,A,P,I,R){const k=30*t,L=15*t,N=60*t;return this.int16[k+0]=n,this.int16[k+1]=i,this.int16[k+2]=a,this.float32[L+2]=l,this.float32[L+3]=u,this.uint16[k+8]=d,this.uint16[k+9]=f,this.uint32[L+5]=p,this.uint32[L+6]=g,this.uint32[L+7]=_,this.uint16[k+16]=v,this.uint16[k+17]=x,this.uint16[k+18]=b,this.float32[L+10]=E,this.float32[L+11]=T,this.uint8[N+48]=C,this.uint8[N+49]=D,this.uint8[N+50]=A,this.uint32[L+13]=P,this.int16[k+28]=I,this.uint8[N+58]=R,t}}Hg.prototype.bytesPerElement=60,Gt(Hg,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D,A,P,I,R,k,L,N,z,j,B,H,V,Z,Q){const et=this.length;return this.resize(et+1),this.emplace(et,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D,A,P,I,R,k,L,N,z,j,B,H,V,Z,Q)}emplace(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D,A,P,I,R,k,L,N,z,j,B,H,V,Z,Q,et){const W=20*t,X=40*t,rt=80*t;return this.float32[W+0]=n,this.float32[W+1]=i,this.int16[X+4]=a,this.int16[X+5]=l,this.int16[X+6]=u,this.int16[X+7]=d,this.int16[X+8]=f,this.int16[X+9]=p,this.int16[X+10]=g,this.int16[X+11]=_,this.int16[X+12]=v,this.uint16[X+13]=x,this.uint16[X+14]=b,this.uint16[X+15]=E,this.uint16[X+16]=T,this.uint16[X+17]=C,this.uint16[X+18]=D,this.uint16[X+19]=A,this.uint16[X+20]=P,this.uint16[X+21]=I,this.uint16[X+22]=R,this.uint16[X+23]=k,this.uint16[X+24]=L,this.uint16[X+25]=N,this.uint16[X+26]=z,this.uint16[X+27]=j,this.uint32[W+14]=B,this.float32[W+15]=H,this.float32[W+16]=V,this.float32[W+17]=Z,this.float32[W+18]=Q,this.uint8[rt+76]=et,t}}Gg.prototype.bytesPerElement=80,Gt(Gg,"StructArrayLayout2f9i15ui1ul4f1ub80");class tp extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}tp.prototype.bytesPerElement=4,Gt(tp,"StructArrayLayout1f4");class Ys extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,i,a,l)}emplace(t,n,i,a,l,u){const d=5*t;return this.float32[d+0]=n,this.float32[d+1]=i,this.float32[d+2]=a,this.float32[d+3]=l,this.float32[d+4]=u,t}}Ys.prototype.bytesPerElement=20,Gt(Ys,"StructArrayLayout5f20");class Ou extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,i,a,l,u,d)}emplace(t,n,i,a,l,u,d,f){const p=7*t;return this.float32[p+0]=n,this.float32[p+1]=i,this.float32[p+2]=a,this.float32[p+3]=l,this.float32[p+4]=u,this.float32[p+5]=d,this.float32[p+6]=f,t}}Ou.prototype.bytesPerElement=28,Gt(Ou,"StructArrayLayout7f28");class c0 extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,n,i,a)}emplace(t,n,i,a,l){const u=6*t;return this.uint32[3*t+0]=n,this.uint16[u+2]=i,this.uint16[u+3]=a,this.uint16[u+4]=l,t}}c0.prototype.bytesPerElement=12,Gt(c0,"StructArrayLayout1ul3ui12");class qg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}qg.prototype.bytesPerElement=2,Gt(qg,"StructArrayLayout1ui2");class ku extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,n)}emplace(t,n,i){const a=2*t;return this.float32[a+0]=n,this.float32[a+1]=i,t}}ku.prototype.bytesPerElement=8,Gt(ku,"StructArrayLayout2f8");class Qw extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T)}emplace(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C){const D=16*t;return this.float32[D+0]=n,this.float32[D+1]=i,this.float32[D+2]=a,this.float32[D+3]=l,this.float32[D+4]=u,this.float32[D+5]=d,this.float32[D+6]=f,this.float32[D+7]=p,this.float32[D+8]=g,this.float32[D+9]=_,this.float32[D+10]=v,this.float32[D+11]=x,this.float32[D+12]=b,this.float32[D+13]=E,this.float32[D+14]=T,this.float32[D+15]=C,t}}Qw.prototype.bytesPerElement=64,Gt(Qw,"StructArrayLayout16f64");class Zg extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,i,a,l,u,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,i,a,l,u,d)}emplace(t,n,i,a,l,u,d,f){const p=10*t,g=5*t;return this.uint16[p+0]=n,this.uint16[p+1]=i,this.uint16[p+2]=a,this.uint16[p+3]=l,this.float32[g+2]=u,this.float32[g+3]=d,this.float32[g+4]=f,t}}Zg.prototype.bytesPerElement=20,Gt(Zg,"StructArrayLayout4ui3f20");class u0 extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint8[1*t+0]=n,t}}u0.prototype.bytesPerElement=1,Gt(u0,"StructArrayLayout1ub1");class L2 extends Qf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}L2.prototype.size=40;class tE extends sl{get(t){return new L2(this,t)}}Gt(tE,"CollisionBoxArray");class Wg extends Qf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Wg.prototype.size=60;class Xh extends Hg{get(t){return new Wg(this,t)}}Gt(Xh,"PlacedSymbolArray");class eE extends Qf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}eE.prototype.size=80;class Yh extends Gg{get(t){return new eE(this,t)}}Gt(Yh,"SymbolInstanceArray");class Xg extends tp{getoffsetX(t){return this.float32[1*t+0]}}Gt(Xg,"GlyphOffsetArray");class ep extends wo{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Gt(ep,"SymbolLineVertexArray");class F2 extends Qf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}F2.prototype.size=12;class h0 extends c0{get(t){return new F2(this,t)}}Gt(h0,"FeatureIndexArray");class d0 extends ba{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Gt(d0,"FillExtrusionCentroidArray");const N2=sn([{name:"a_pos",components:2,type:"Int16"}],4),al=sn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class bn{constructor(t=[]){this.segments=t}_prepareSegment(t,n,i,a){let l=this.segments[this.segments.length-1];return t>bn.MAX_VERTEX_ARRAY_LENGTH&&K(`Max vertices per segment is ${bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!l||l.vertexLength+t>bn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:n,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==a&&(l.sortKey=a),this.segments.push(l)),l}prepareSegment(t,n,i,a){return this._prepareSegment(t,n.length,i.length,a)}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,i,a){return new bn([{vertexOffset:t,primitiveOffset:n,vertexLength:i,primitiveLength:a,vaos:{},sortKey:0}])}}function np(e,t){return 256*(e=Wt(Math.floor(e),0,255))+Wt(Math.floor(t),0,255)}bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt(bn,"SegmentVector");const f0=sn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),nE=sn([{name:"a_dash",components:4,type:"Uint16"}]);var Lu={exports:{}},z2={exports:function(t,n){var i,a,l,u,d,f,p,g;for(a=t.length-(i=3&t.length),l=n,d=3432918353,f=461845907,g=0;g<a;)p=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24,++g,l=27492+(65535&(u=5*(65535&(l=(l^=p=(65535&(p=(p=(65535&p)*d+(((p>>>16)*d&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(p=0,i){case 3:p^=(255&t.charCodeAt(g+2))<<16;case 2:p^=(255&t.charCodeAt(g+1))<<8;case 1:l^=p=(65535&(p=(p=(65535&(p^=255&t.charCodeAt(g)))*d+(((p>>>16)*d&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295}return l^=t.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}}.exports,p0={exports:{}};p0.exports=function(t,n){for(var i,a=t.length,l=n^a,u=0;a>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24))+((1540483477*(i>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++u;switch(a){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&t.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var m0=z2,rE=p0.exports;Lu.exports=m0,Lu.exports.murmur3=m0,Lu.exports.murmur2=rE;var Jg=Zo(Lu.exports);class rp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,n,i,a){this.ids.push(ip(t)),this.positions.push(n,i,a)}eachPosition(t,n){const i=ip(t);let a=0,l=this.ids.length-1;for(;a<l;){const u=a+l>>1;this.ids[u]>=i?l=u:a=u+1}for(;this.ids[a]===i;)n(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(t,n){const i=new Float64Array(t.ids),a=new Uint32Array(t.positions);return $l(i,a,0,i.length-1),n&&(n.add(i.buffer),n.add(a.buffer)),{ids:i,positions:a}}static deserialize(t){const n=new rp;let i;n.ids=t.ids,n.positions=t.positions;for(const a of n.ids)a!==i&&n.uniqueIds.push(a),i=a;return n.indexed=!0,n}}function ip(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Jg(String(e))}function $l(e,t,n,i){for(;n<i;){const a=e[n+i>>1];let l=n-1,u=i+1;for(;;){do{l++}while(e[l]<a);do{u--}while(e[u]>a);if(l>=u)break;Kg(e,l,u),Kg(t,3*l,3*u),Kg(t,3*l+1,3*u+1),Kg(t,3*l+2,3*u+2)}u-n<i-u?($l(e,t,n,u),n=u+1):($l(e,t,u+1,i),i=u)}}function Kg(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}Gt(rp,"FeaturePositionMap");class ll{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,n),this.initialized=!0),!!this.location}}class Le extends ll{constructor(t){super(t),this.current=0}set(t,n,i){this.fetchUniformLocation(t,n)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class xt extends ll{constructor(t){super(t),this.current=0}set(t,n,i){this.fetchUniformLocation(t,n)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ue extends ll{constructor(t){super(t),this.current=[0,0]}set(t,n,i){this.fetchUniformLocation(t,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class se extends ll{constructor(t){super(t),this.current=[0,0,0]}set(t,n,i){this.fetchUniformLocation(t,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class rs extends ll{constructor(t){super(t),this.current=[0,0,0,0]}set(t,n,i){this.fetchUniformLocation(t,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class ii extends ll{constructor(t){super(t),this.current=Ae.transparent}set(t,n,i){this.fetchUniformLocation(t,n)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const g0=new Float32Array(16);class we extends ll{constructor(t){super(t),this.current=g0}set(t,n,i){if(this.fetchUniformLocation(t,n)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let a=1;a<16;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const iE=new Float32Array(9);class op extends ll{constructor(t){super(t),this.current=iE}set(t,n,i){if(this.fetchUniformLocation(t,n))for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}const Jh=new Float32Array(4);class Bc extends ll{constructor(t){super(t),this.current=Jh}set(t,n,i){if(this.fetchUniformLocation(t,n))for(let a=0;a<4;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Vc(e){return[np(255*e.r,255*e.g),np(255*e.b,255*e.a)]}class Kh{constructor(t,n,i){this.value=t,this.uniformNames=n.map(a=>`u_${a}`),this.type=i}setUniform(t,n,i,a,l){n.set(t,l,a.constantOr(this.value))}getBinding(t,n){return"color"===this.type?new ii(t):new xt(t)}}class jc{constructor(t,n){this.uniformNames=n.map(i=>`u_${i}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,n,i,a,l){const u="u_pattern"===l||"u_dash"===l?this.pattern:"u_pixel_ratio"===l?this.pixelRatio:null;u&&n.set(t,l,u)}getBinding(t,n){return"u_pattern"===n||"u_dash"===n?new rs(t):new xt(t)}}class is{constructor(t,n,i,a){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=n.map(l=>({name:`a_${l}`,type:"Float32",components:"color"===i?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(t,n,i,a,l,u,d){const f=this.paintVertexArray.length,p=this.expression.evaluate(new er(0,{brightness:u}),n,{},l,a,d);this.paintVertexArray.resize(t),this._setPaintValue(f,t,p)}updatePaintArray(t,n,i,a,l,u,d){const f=this.expression.evaluate({zoom:0,brightness:d},i,a,void 0,l);this._setPaintValue(t,n,f)}_setPaintValue(t,n,i){if("color"===this.type){const a=Vc(i);for(let l=t;l<n;l++)this.paintVertexArray.emplace(l,a[0],a[1])}else{for(let a=t;a<n;a++)this.paintVertexArray.emplace(a,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cl{constructor(t,n,i,a,l,u){this.expression=t,this.uniformNames=n.map(d=>`u_${d}_t`),this.type=i,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:"color"===i?4:2,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,i,a,l,u,d){const f=this.expression.evaluate(new er(this.zoom,{brightness:u}),n,{},l,a,d),p=this.expression.evaluate(new er(this.zoom+1,{brightness:u}),n,{},l,a,d),g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(g,t,f,p)}updatePaintArray(t,n,i,a,l,u,d){const f=this.expression.evaluate({zoom:this.zoom,brightness:d},i,a,void 0,l),p=this.expression.evaluate({zoom:this.zoom+1,brightness:d},i,a,void 0,l);this._setPaintValue(t,n,f,p)}_setPaintValue(t,n,i,a){if("color"===this.type){const l=Vc(i),u=Vc(a);for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,l[0],l[1],u[0],u[1])}else{for(let l=t;l<n;l++)this.paintVertexArray.emplace(l,i,a);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n,i,a,l){const u=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,d=Wt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);n.set(t,l,d)}getBinding(t,n){return new xt(t)}}class Uc{constructor(t,n,i,a,l){this.expression=t,this.layerId=l,this.paintVertexAttributes=("array"===i?nE:f0).members;for(let u=0;u<n.length;++u);this.paintVertexArray=new a}populatePaintArray(t,n,i){const a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(a,t,n.patterns&&n.patterns[this.layerId],i)}updatePaintArray(t,n,i,a,l,u,d){this._setPaintValues(t,n,i.patterns&&i.patterns[this.layerId],u)}_setPaintValues(t,n,i,a){if(!a||!i)return;const l=a[i];if(!l)return;const{tl:u,br:d,pixelRatio:f}=l;for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1],d[0],d[1],f)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qh{constructor(t,n,i=(()=>!0)){this.binders={},this._buffers=[];const a=[];for(const l in t.paint._values){const u=t.paint.get(l);if(!i(l)||!(u instanceof ns&&Lc(u.property.specification)))continue;const d=tO(l,t.type),f=u.value,p=u.property.specification.type,g=!!u.property.useIntegerZoom,_="line-dasharray"===l||l.endsWith("pattern"),v="line-dasharray"===l&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==f.kind||v)if("source"===f.kind||v||_){const x=Nu(l,p,"source");this.binders[l]=_?new Uc(f,d,p,x,t.id):new is(f,d,p,x),a.push(`/a_${l}`)}else{const x=Nu(l,p,"composite");this.binders[l]=new cl(f,d,p,g,n,x),a.push(`/z_${l}`)}else this.binders[l]=_?new jc(f.value,d):new Kh(f.value,d,p),a.push(`/u_${l}`)}this.cacheKey=a.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof is||n instanceof cl?n.maxValue:0}populatePaintArrays(t,n,i,a,l,u,d){for(const f in this.binders){const p=this.binders[f];(p instanceof is||p instanceof cl||p instanceof Uc)&&p.populatePaintArray(t,n,i,a,l,u,d)}}setConstantPatternPositions(t){for(const n in this.binders){const i=this.binders[n];i instanceof jc&&i.setConstantPatternPositions(t)}}updatePaintArrays(t,n,i,a,l,u,d,f){let p=!1;const g=Object.keys(t),_=0!==g.length,v=_?g:n.uniqueIds;for(const x in this.binders){const b=this.binders[x];if((b instanceof is||b instanceof cl||b instanceof Uc)&&(!0===b.expression.isStateDependent||!1===b.expression.isLightConstant)){const E=l.paint.get(x);b.expression=E.value;for(const T of v){const C=t[T.toString()];n.eachPosition(T,(D,A,P)=>{const I=a.feature(D);b.updatePaintArray(A,P,I,C,u,d,f)})}if(!_)for(const T of i.uniqueIds){const C=t[T.toString()];i.eachPosition(T,(D,A,P)=>{const I=a.feature(D);b.updatePaintArray(A,P,I,C,u,d,f)})}p=!0}}return p}defines(){const t=[];for(const n in this.binders){const i=this.binders[n];(i instanceof Kh||i instanceof jc)&&t.push(...i.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof is||i instanceof cl||i instanceof Uc)for(let a=0;a<i.paintVertexAttributes.length;a++)t.push(i.paintVertexAttributes[a].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof Kh||i instanceof jc||i instanceof cl)for(const a of i.uniformNames)t.push(a)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const n=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Kh||a instanceof jc||a instanceof cl)for(const l of a.uniformNames)n.push({name:l,property:i,binding:a.getBinding(t,l)})}return n}setUniforms(t,n,i,a,l){for(const{name:u,property:d,binding:f}of i)this.binders[d].setUniform(t,f,l,a.get(d),u)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const n=this.binders[t];(n instanceof is||n instanceof cl||n instanceof Uc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const n in this.binders){const i=this.binders[n];(i instanceof is||i instanceof cl||i instanceof Uc)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof is||n instanceof cl||n instanceof Uc)&&n.destroy()}}}class Fu{constructor(t,n,i=(()=>!0)){this.programConfigurations={};for(const a of t)this.programConfigurations[a.id]=new Qh(a,n,i);this.needsUpload=!1,this._featureMap=new rp,this._featureMapWithoutIds=new rp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,n,i,a,l,u,d,f){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(t,n,a,l,u,d,f);void 0!==n.id?this._featureMap.add(n.id,i,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,i,a,l,u){for(const d of i)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,n,d,a,l,u||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const QR={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function tO(e,t){return QR[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const eO={"line-pattern":{source:zc,composite:zc},"fill-pattern":{source:zc,composite:zc},"fill-extrusion-pattern":{source:zc,composite:zc},"line-dasharray":{source:Bg,composite:Bg}},nO={color:{source:ku,composite:rr},number:{source:tp,composite:ku}};function Nu(e,t,n){const i=eO[e];return i&&i[n]||nO[t][n]}Gt(Kh,"ConstantBinder"),Gt(jc,"PatternConstantBinder"),Gt(is,"SourceExpressionBinder"),Gt(Uc,"PatternCompositeBinder"),Gt(cl,"CompositeExpressionBinder"),Gt(Qh,"ProgramConfiguration",{omit:["_buffers"]}),Gt(Fu,"ProgramConfigurationSet");class Rs{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof _e?new _e(t.lng,t.lat):_e.convert(t),this}setSouthWest(t){return this._sw=t instanceof _e?new _e(t.lng,t.lat):_e.convert(t),this}extend(t){const n=this._sw,i=this._ne;let a,l;if(t instanceof _e)a=t,l=t;else{if(!(t instanceof Rs))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Rs.convert(t)):this.extend(_e.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(_e.convert(t)):this;if(a=t._sw,l=t._ne,!a||!l)return this}return n||i?(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),i.lng=Math.max(l.lng,i.lng),i.lat=Math.max(l.lat,i.lat)):(this._sw=new _e(a.lng,a.lat),this._ne=new _e(l.lng,l.lat)),this}getCenter(){return new _e((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _e(this.getWest(),this.getNorth())}getSouthEast(){return new _e(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:i}=_e.convert(t);let a=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&a}static convert(t){return!t||t instanceof Rs?t:new Rs(t)}}var fi={},yn={};Object.defineProperty(yn,"__esModule",{value:!0}),yn.setMatrixArrayType=function(e){yn.ARRAY_TYPE=td=e},yn.toRadian=function(e){return e*Js},yn.equals=function(e,t){return Math.abs(e-t)<=oE*Math.max(1,Math.abs(e),Math.abs(t))},yn.RANDOM=yn.ARRAY_TYPE=yn.EPSILON=void 0;var oE=1e-6;yn.EPSILON=oE;var td=typeof Float32Array<"u"?Float32Array:Array;yn.ARRAY_TYPE=td;var B2=Math.random;yn.RANDOM=B2;var Js=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Pn={};function Qg(e){return(Qg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.create=function(){var e=new Ea.ARRAY_TYPE(4);return Ea.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},Pn.clone=function(e){var t=new Ea.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Pn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Pn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},Pn.fromValues=function(e,t,n,i){var a=new Ea.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=i,a},Pn.set=function(e,t,n,i,a){return e[0]=t,e[1]=n,e[2]=i,e[3]=a,e},Pn.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},Pn.invert=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=n*l-a*i;return u?(e[0]=l*(u=1/u),e[1]=-i*u,e[2]=-a*u,e[3]=n*u,e):null},Pn.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},Pn.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},Pn.multiply=sE,Pn.rotate=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=Math.sin(n),f=Math.cos(n);return e[0]=i*f+l*d,e[1]=a*f+u*d,e[2]=i*-d+l*f,e[3]=a*-d+u*f,e},Pn.scale=function(e,t,n){var i=t[1],a=t[2],l=t[3],u=n[0],d=n[1];return e[0]=t[0]*u,e[1]=i*u,e[2]=a*d,e[3]=l*d,e},Pn.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e},Pn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},Pn.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Pn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},Pn.LDU=function(e,t,n,i){return e[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-e[2]*n[1],[e,t,n]},Pn.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Pn.subtract=V2,Pn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Pn.equals=function(e,t){var n=e[0],i=e[1],a=e[2],l=e[3],u=t[0],d=t[1],f=t[2],p=t[3];return Math.abs(n-u)<=Ea.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-d)<=Ea.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-f)<=Ea.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=Ea.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},Pn.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},Pn.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},Pn.sub=Pn.mul=void 0;var Ea=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Qg(e)&&"function"!=typeof e)return{default:e};var n=ed(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}(yn);function ed(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(ed=function(i){return i?n:t})(e)}function sE(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=n[0],f=n[1],p=n[2],g=n[3];return e[0]=i*d+l*f,e[1]=a*d+u*f,e[2]=i*p+l*g,e[3]=a*p+u*g,e}function V2(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}Pn.mul=sE,Pn.sub=V2;var cr={};function aE(e){return(aE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(cr,"__esModule",{value:!0}),cr.create=function(){var e=new oi.ARRAY_TYPE(6);return oi.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},cr.clone=function(e){var t=new oi.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},cr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},cr.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},cr.fromValues=function(e,t,n,i,a,l){var u=new oi.ARRAY_TYPE(6);return u[0]=e,u[1]=t,u[2]=n,u[3]=i,u[4]=a,u[5]=l,u},cr.set=function(e,t,n,i,a,l,u){return e[0]=t,e[1]=n,e[2]=i,e[3]=a,e[4]=l,e[5]=u,e},cr.invert=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=n*l-i*a;return f?(e[0]=l*(f=1/f),e[1]=-i*f,e[2]=-a*f,e[3]=n*f,e[4]=(a*d-l*u)*f,e[5]=(i*u-n*d)*f,e):null},cr.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},cr.multiply=zu,cr.rotate=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=t[4],f=t[5],p=Math.sin(n),g=Math.cos(n);return e[0]=i*g+l*p,e[1]=a*g+u*p,e[2]=i*-p+l*g,e[3]=a*-p+u*g,e[4]=d,e[5]=f,e},cr.scale=function(e,t,n){var i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=n[0],p=n[1];return e[0]=t[0]*f,e[1]=i*f,e[2]=a*p,e[3]=l*p,e[4]=u,e[5]=d,e},cr.translate=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=t[4],f=t[5],p=n[0],g=n[1];return e[0]=i,e[1]=a,e[2]=l,e[3]=u,e[4]=i*p+l*g+d,e[5]=a*p+u*g+f,e},cr.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e},cr.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},cr.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},cr.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},cr.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},cr.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},cr.subtract=j2,cr.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},cr.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e},cr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},cr.equals=function(e,t){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=t[0],p=t[1],g=t[2],_=t[3],v=t[4],x=t[5];return Math.abs(n-f)<=oi.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-p)<=oi.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-g)<=oi.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-_)<=oi.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-v)<=oi.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(d-x)<=oi.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))},cr.sub=cr.mul=void 0;var oi=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==aE(e)&&"function"!=typeof e)return{default:e};var n=t_(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}(yn);function t_(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(t_=function(i){return i?n:t})(e)}function zu(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=t[4],f=t[5],p=n[0],g=n[1],_=n[2],v=n[3],x=n[4],b=n[5];return e[0]=i*p+l*g,e[1]=a*p+u*g,e[2]=i*_+l*v,e[3]=a*_+u*v,e[4]=i*x+l*b+d,e[5]=a*x+u*b+f,e}function j2(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}cr.mul=zu,cr.sub=j2;var wn={};function _0(e){return(_0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(wn,"__esModule",{value:!0}),wn.create=function(){var e=new Os.ARRAY_TYPE(9);return Os.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},wn.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},wn.clone=function(e){var t=new Os.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},wn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},wn.fromValues=function(e,t,n,i,a,l,u,d,f){var p=new Os.ARRAY_TYPE(9);return p[0]=e,p[1]=t,p[2]=n,p[3]=i,p[4]=a,p[5]=l,p[6]=u,p[7]=d,p[8]=f,p},wn.set=function(e,t,n,i,a,l,u,d,f,p){return e[0]=t,e[1]=n,e[2]=i,e[3]=a,e[4]=l,e[5]=u,e[6]=d,e[7]=f,e[8]=p,e},wn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},wn.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},wn.invert=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=g*u-d*p,v=-g*l+d*f,x=p*l-u*f,b=n*_+i*v+a*x;return b?(e[0]=_*(b=1/b),e[1]=(-g*i+a*p)*b,e[2]=(d*i-a*u)*b,e[3]=v*b,e[4]=(g*n-a*f)*b,e[5]=(-d*n+a*l)*b,e[6]=x*b,e[7]=(-p*n+i*f)*b,e[8]=(u*n-i*l)*b,e):null},wn.adjoint=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8];return e[0]=u*g-d*p,e[1]=a*p-i*g,e[2]=i*d-a*u,e[3]=d*f-l*g,e[4]=n*g-a*f,e[5]=a*l-n*d,e[6]=l*p-u*f,e[7]=i*f-n*p,e[8]=n*u-i*l,e},wn.determinant=function(e){var t=e[3],n=e[4],i=e[5],a=e[6],l=e[7],u=e[8];return e[0]*(u*n-i*l)+e[1]*(-u*t+i*a)+e[2]*(l*t-n*a)},wn.multiply=cE,wn.translate=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=n[0],x=n[1];return e[0]=i,e[1]=a,e[2]=l,e[3]=u,e[4]=d,e[5]=f,e[6]=v*i+x*u+p,e[7]=v*a+x*d+g,e[8]=v*l+x*f+_,e},wn.rotate=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=Math.sin(n),x=Math.cos(n);return e[0]=x*i+v*u,e[1]=x*a+v*d,e[2]=x*l+v*f,e[3]=x*u-v*i,e[4]=x*d-v*a,e[5]=x*f-v*l,e[6]=p,e[7]=g,e[8]=_,e},wn.scale=function(e,t,n){var i=n[0],a=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},wn.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},wn.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},wn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},wn.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},wn.fromQuat=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=n+n,d=i+i,f=a+a,p=n*u,g=i*u,_=i*d,v=a*u,x=a*d,b=a*f,E=l*u,T=l*d,C=l*f;return e[0]=1-_-b,e[3]=g-C,e[6]=v+T,e[1]=g+C,e[4]=1-p-b,e[7]=x-E,e[2]=v-T,e[5]=x+E,e[8]=1-p-_,e},wn.normalFromMat4=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=t[9],v=t[10],x=t[11],b=t[12],E=t[13],T=t[14],C=t[15],D=n*d-i*u,A=n*f-a*u,P=n*p-l*u,I=i*f-a*d,R=i*p-l*d,k=a*p-l*f,L=g*E-_*b,N=g*T-v*b,z=g*C-x*b,j=_*T-v*E,B=_*C-x*E,H=v*C-x*T,V=D*H-A*B+P*j+I*z-R*N+k*L;return V?(e[0]=(d*H-f*B+p*j)*(V=1/V),e[1]=(f*z-u*H-p*N)*V,e[2]=(u*B-d*z+p*L)*V,e[3]=(a*B-i*H-l*j)*V,e[4]=(n*H-a*z+l*N)*V,e[5]=(i*z-n*B-l*L)*V,e[6]=(E*k-T*R+C*I)*V,e[7]=(T*P-b*k-C*A)*V,e[8]=(b*R-E*P+C*D)*V,e):null},wn.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},wn.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},wn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},wn.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},wn.subtract=uE,wn.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},wn.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e},wn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},wn.equals=function(e,t){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=t[0],v=t[1],x=t[2],b=t[3],E=t[4],T=t[5],C=t[6],D=t[7],A=t[8];return Math.abs(n-_)<=Os.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-v)<=Os.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(a-x)<=Os.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-b)<=Os.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-E)<=Os.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-T)<=Os.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(f-C)<=Os.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(p-D)<=Os.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(g-A)<=Os.EPSILON*Math.max(1,Math.abs(g),Math.abs(A))},wn.sub=wn.mul=void 0;var Os=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==_0(e)&&"function"!=typeof e)return{default:e};var n=lE(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}(yn);function lE(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(lE=function(i){return i?n:t})(e)}function cE(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=n[0],x=n[1],b=n[2],E=n[3],T=n[4],C=n[5],D=n[6],A=n[7],P=n[8];return e[0]=v*i+x*u+b*p,e[1]=v*a+x*d+b*g,e[2]=v*l+x*f+b*_,e[3]=E*i+T*u+C*p,e[4]=E*a+T*d+C*g,e[5]=E*l+T*f+C*_,e[6]=D*i+A*u+P*p,e[7]=D*a+A*d+P*g,e[8]=D*l+A*f+P*_,e}function uE(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}wn.mul=cE,wn.sub=uE;var De={};function sp(e){return(sp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(De,"__esModule",{value:!0}),De.create=function(){var e=new ir.ARRAY_TYPE(16);return ir.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},De.clone=function(e){var t=new ir.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},De.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},De.fromValues=function(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E){var T=new ir.ARRAY_TYPE(16);return T[0]=e,T[1]=t,T[2]=n,T[3]=i,T[4]=a,T[5]=l,T[6]=u,T[7]=d,T[8]=f,T[9]=p,T[10]=g,T[11]=_,T[12]=v,T[13]=x,T[14]=b,T[15]=E,T},De.set=function(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T){return e[0]=t,e[1]=n,e[2]=i,e[3]=a,e[4]=l,e[5]=u,e[6]=d,e[7]=f,e[8]=p,e[9]=g,e[10]=_,e[11]=v,e[12]=x,e[13]=b,e[14]=E,e[15]=T,e},De.identity=ap,De.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],a=t[3],l=t[6],u=t[7],d=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=l,e[11]=t[14],e[12]=a,e[13]=u,e[14]=d}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},De.invert=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=t[9],v=t[10],x=t[11],b=t[12],E=t[13],T=t[14],C=t[15],D=n*d-i*u,A=n*f-a*u,P=n*p-l*u,I=i*f-a*d,R=i*p-l*d,k=a*p-l*f,L=g*E-_*b,N=g*T-v*b,z=g*C-x*b,j=_*T-v*E,B=_*C-x*E,H=v*C-x*T,V=D*H-A*B+P*j+I*z-R*N+k*L;return V?(e[0]=(d*H-f*B+p*j)*(V=1/V),e[1]=(a*B-i*H-l*j)*V,e[2]=(E*k-T*R+C*I)*V,e[3]=(v*R-_*k-x*I)*V,e[4]=(f*z-u*H-p*N)*V,e[5]=(n*H-a*z+l*N)*V,e[6]=(T*P-b*k-C*A)*V,e[7]=(g*k-v*P+x*A)*V,e[8]=(u*B-d*z+p*L)*V,e[9]=(i*z-n*B-l*L)*V,e[10]=(b*R-E*P+C*D)*V,e[11]=(_*P-g*R-x*D)*V,e[12]=(d*N-u*j-f*L)*V,e[13]=(n*j-i*N+a*L)*V,e[14]=(E*A-b*I-T*D)*V,e[15]=(g*I-_*A+v*D)*V,e):null},De.adjoint=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=t[9],v=t[10],x=t[11],b=t[12],E=t[13],T=t[14],C=t[15];return e[0]=d*(v*C-x*T)-_*(f*C-p*T)+E*(f*x-p*v),e[1]=-(i*(v*C-x*T)-_*(a*C-l*T)+E*(a*x-l*v)),e[2]=i*(f*C-p*T)-d*(a*C-l*T)+E*(a*p-l*f),e[3]=-(i*(f*x-p*v)-d*(a*x-l*v)+_*(a*p-l*f)),e[4]=-(u*(v*C-x*T)-g*(f*C-p*T)+b*(f*x-p*v)),e[5]=n*(v*C-x*T)-g*(a*C-l*T)+b*(a*x-l*v),e[6]=-(n*(f*C-p*T)-u*(a*C-l*T)+b*(a*p-l*f)),e[7]=n*(f*x-p*v)-u*(a*x-l*v)+g*(a*p-l*f),e[8]=u*(_*C-x*E)-g*(d*C-p*E)+b*(d*x-p*_),e[9]=-(n*(_*C-x*E)-g*(i*C-l*E)+b*(i*x-l*_)),e[10]=n*(d*C-p*E)-u*(i*C-l*E)+b*(i*p-l*d),e[11]=-(n*(d*x-p*_)-u*(i*x-l*_)+g*(i*p-l*d)),e[12]=-(u*(_*T-v*E)-g*(d*T-f*E)+b*(d*v-f*_)),e[13]=n*(_*T-v*E)-g*(i*T-a*E)+b*(i*v-a*_),e[14]=-(n*(d*T-f*E)-u*(i*T-a*E)+b*(i*f-a*d)),e[15]=n*(d*v-f*_)-u*(i*v-a*_)+g*(i*f-a*d),e},De.determinant=function(e){var t=e[0],n=e[1],i=e[2],a=e[3],l=e[4],u=e[5],d=e[6],f=e[7],p=e[8],g=e[9],_=e[10],v=e[11],x=e[12],b=e[13],E=e[14],T=e[15];return(t*u-n*l)*(_*T-v*E)-(t*d-i*l)*(g*T-v*b)+(t*f-a*l)*(g*E-_*b)+(n*d-i*u)*(p*T-v*x)-(n*f-a*u)*(p*E-_*x)+(i*f-a*d)*(p*b-g*x)},De.multiply=dE,De.translate=function(e,t,n){var i,a,l,u,d,f,p,g,_,v,x,b,E=n[0],T=n[1],C=n[2];return t===e?(e[12]=t[0]*E+t[4]*T+t[8]*C+t[12],e[13]=t[1]*E+t[5]*T+t[9]*C+t[13],e[14]=t[2]*E+t[6]*T+t[10]*C+t[14],e[15]=t[3]*E+t[7]*T+t[11]*C+t[15]):(a=t[1],l=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=t[9],x=t[10],b=t[11],e[0]=i=t[0],e[1]=a,e[2]=l,e[3]=u,e[4]=d,e[5]=f,e[6]=p,e[7]=g,e[8]=_,e[9]=v,e[10]=x,e[11]=b,e[12]=i*E+d*T+_*C+t[12],e[13]=a*E+f*T+v*C+t[13],e[14]=l*E+p*T+x*C+t[14],e[15]=u*E+g*T+b*C+t[15]),e},De.scale=function(e,t,n){var i=n[0],a=n[1],l=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*l,e[9]=t[9]*l,e[10]=t[10]*l,e[11]=t[11]*l,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},De.rotate=function(e,t,n,i){var a,l,u,d,f,p,g,_,v,x,b,E,T,C,D,A,P,I,R,k,L,N,z,j,B=i[0],H=i[1],V=i[2],Z=Math.hypot(B,H,V);return Z<ir.EPSILON?null:(B*=Z=1/Z,H*=Z,V*=Z,a=Math.sin(n),l=Math.cos(n),f=t[1],p=t[2],g=t[3],v=t[5],x=t[6],b=t[7],T=t[9],C=t[10],D=t[11],R=B*H*(u=1-l)-V*a,k=H*H*u+l,L=V*H*u+B*a,N=B*V*u+H*a,z=H*V*u-B*a,j=V*V*u+l,e[0]=(d=t[0])*(A=B*B*u+l)+(_=t[4])*(P=H*B*u+V*a)+(E=t[8])*(I=V*B*u-H*a),e[1]=f*A+v*P+T*I,e[2]=p*A+x*P+C*I,e[3]=g*A+b*P+D*I,e[4]=d*R+_*k+E*L,e[5]=f*R+v*k+T*L,e[6]=p*R+x*k+C*L,e[7]=g*R+b*k+D*L,e[8]=d*N+_*z+E*j,e[9]=f*N+v*z+T*j,e[10]=p*N+x*z+C*j,e[11]=g*N+b*z+D*j,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},De.rotateX=function(e,t,n){var i=Math.sin(n),a=Math.cos(n),l=t[4],u=t[5],d=t[6],f=t[7],p=t[8],g=t[9],_=t[10],v=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=l*a+p*i,e[5]=u*a+g*i,e[6]=d*a+_*i,e[7]=f*a+v*i,e[8]=p*a-l*i,e[9]=g*a-u*i,e[10]=_*a-d*i,e[11]=v*a-f*i,e},De.rotateY=function(e,t,n){var i=Math.sin(n),a=Math.cos(n),l=t[0],u=t[1],d=t[2],f=t[3],p=t[8],g=t[9],_=t[10],v=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=l*a-p*i,e[1]=u*a-g*i,e[2]=d*a-_*i,e[3]=f*a-v*i,e[8]=l*i+p*a,e[9]=u*i+g*a,e[10]=d*i+_*a,e[11]=f*i+v*a,e},De.rotateZ=function(e,t,n){var i=Math.sin(n),a=Math.cos(n),l=t[0],u=t[1],d=t[2],f=t[3],p=t[4],g=t[5],_=t[6],v=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=l*a+p*i,e[1]=u*a+g*i,e[2]=d*a+_*i,e[3]=f*a+v*i,e[4]=p*a-l*i,e[5]=g*a-u*i,e[6]=_*a-d*i,e[7]=v*a-f*i,e},De.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},De.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},De.fromRotation=function(e,t,n){var i,a,l,u=n[0],d=n[1],f=n[2],p=Math.hypot(u,d,f);return p<ir.EPSILON?null:(u*=p=1/p,d*=p,f*=p,i=Math.sin(t),a=Math.cos(t),e[0]=u*u*(l=1-a)+a,e[1]=d*u*l+f*i,e[2]=f*u*l-d*i,e[3]=0,e[4]=u*d*l-f*i,e[5]=d*d*l+a,e[6]=f*d*l+u*i,e[7]=0,e[8]=u*f*l+d*i,e[9]=d*f*l-u*i,e[10]=f*f*l+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},De.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},De.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},De.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},De.fromRotationTranslation=lp,De.fromQuat2=function(e,t){var n=new ir.ARRAY_TYPE(3),i=-t[0],a=-t[1],l=-t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=i*i+a*a+l*l+u*u;return _>0?(n[0]=2*(d*u+g*i+f*l-p*a)/_,n[1]=2*(f*u+g*a+p*i-d*l)/_,n[2]=2*(p*u+g*l+d*a-f*i)/_):(n[0]=2*(d*u+g*i+f*l-p*a),n[1]=2*(f*u+g*a+p*i-d*l),n[2]=2*(p*u+g*l+d*a-f*i)),lp(e,t,n),e},De.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},De.getScaling=fE,De.getRotation=function(e,t){var n=new ir.ARRAY_TYPE(3);fE(n,t);var i=1/n[0],a=1/n[1],l=1/n[2],u=t[0]*i,d=t[1]*a,f=t[2]*l,p=t[4]*i,g=t[5]*a,_=t[6]*l,v=t[8]*i,x=t[9]*a,b=t[10]*l,E=u+g+b,T=0;return E>0?(T=2*Math.sqrt(E+1),e[3]=.25*T,e[0]=(_-x)/T,e[1]=(v-f)/T,e[2]=(d-p)/T):u>g&&u>b?(T=2*Math.sqrt(1+u-g-b),e[3]=(_-x)/T,e[0]=.25*T,e[1]=(d+p)/T,e[2]=(v+f)/T):g>b?(T=2*Math.sqrt(1+g-u-b),e[3]=(v-f)/T,e[0]=(d+p)/T,e[1]=.25*T,e[2]=(_+x)/T):(T=2*Math.sqrt(1+b-u-g),e[3]=(d-p)/T,e[0]=(v+f)/T,e[1]=(_+x)/T,e[2]=.25*T),e},De.fromRotationTranslationScale=function(e,t,n,i){var a=t[0],l=t[1],u=t[2],d=t[3],f=a+a,p=l+l,g=u+u,_=a*f,v=a*p,x=a*g,b=l*p,E=l*g,T=u*g,C=d*f,D=d*p,A=d*g,P=i[0],I=i[1],R=i[2];return e[0]=(1-(b+T))*P,e[1]=(v+A)*P,e[2]=(x-D)*P,e[3]=0,e[4]=(v-A)*I,e[5]=(1-(_+T))*I,e[6]=(E+C)*I,e[7]=0,e[8]=(x+D)*R,e[9]=(E-C)*R,e[10]=(1-(_+b))*R,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},De.fromRotationTranslationScaleOrigin=function(e,t,n,i,a){var l=t[0],u=t[1],d=t[2],f=t[3],p=l+l,g=u+u,_=d+d,v=l*p,x=l*g,b=l*_,E=u*g,T=u*_,C=d*_,D=f*p,A=f*g,P=f*_,I=i[0],R=i[1],k=i[2],L=a[0],N=a[1],z=a[2],j=(1-(E+C))*I,B=(x+P)*I,H=(b-A)*I,V=(x-P)*R,Z=(1-(v+C))*R,Q=(T+D)*R,et=(b+A)*k,W=(T-D)*k,X=(1-(v+E))*k;return e[0]=j,e[1]=B,e[2]=H,e[3]=0,e[4]=V,e[5]=Z,e[6]=Q,e[7]=0,e[8]=et,e[9]=W,e[10]=X,e[11]=0,e[12]=n[0]+L-(j*L+V*N+et*z),e[13]=n[1]+N-(B*L+Z*N+W*z),e[14]=n[2]+z-(H*L+Q*N+X*z),e[15]=1,e},De.fromQuat=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=n+n,d=i+i,f=a+a,p=n*u,g=i*u,_=i*d,v=a*u,x=a*d,b=a*f,E=l*u,T=l*d,C=l*f;return e[0]=1-_-b,e[1]=g+C,e[2]=v-T,e[3]=0,e[4]=g-C,e[5]=1-p-b,e[6]=x+E,e[7]=0,e[8]=v+T,e[9]=x-E,e[10]=1-p-_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},De.frustum=function(e,t,n,i,a,l,u){var d=1/(n-t),f=1/(a-i),p=1/(l-u);return e[0]=2*l*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*l*f,e[6]=0,e[7]=0,e[8]=(n+t)*d,e[9]=(a+i)*f,e[10]=(u+l)*p,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*l*2*p,e[15]=0,e},De.perspectiveNO=y0,De.perspectiveZO=function(e,t,n,i,a){var l,u=1/Math.tan(t/2);return e[0]=u/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(e[10]=a*(l=1/(i-a)),e[14]=a*i*l):(e[10]=-1,e[14]=-i),e},De.perspectiveFromFieldOfView=function(e,t,n,i){var a=Math.tan(t.upDegrees*Math.PI/180),l=Math.tan(t.downDegrees*Math.PI/180),u=Math.tan(t.leftDegrees*Math.PI/180),d=Math.tan(t.rightDegrees*Math.PI/180),f=2/(u+d),p=2/(a+l);return e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=-(u-d)*f*.5,e[9]=(a-l)*p*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e},De.orthoNO=e_,De.orthoZO=function(e,t,n,i,a,l,u){var d=1/(t-n),f=1/(i-a),p=1/(l-u);return e[0]=-2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=p,e[11]=0,e[12]=(t+n)*d,e[13]=(a+i)*f,e[14]=l*p,e[15]=1,e},De.lookAt=function(e,t,n,i){var a,l,u,d,f,p,g,_,v,x,b=t[0],E=t[1],T=t[2],C=i[0],D=i[1],A=i[2],P=n[0],I=n[1],R=n[2];return Math.abs(b-P)<ir.EPSILON&&Math.abs(E-I)<ir.EPSILON&&Math.abs(T-R)<ir.EPSILON?ap(e):(g=b-P,_=E-I,v=T-R,a=D*(v*=x=1/Math.hypot(g,_,v))-A*(_*=x),l=A*(g*=x)-C*v,u=C*_-D*g,(x=Math.hypot(a,l,u))?(a*=x=1/x,l*=x,u*=x):(a=0,l=0,u=0),d=_*u-v*l,f=v*a-g*u,p=g*l-_*a,(x=Math.hypot(d,f,p))?(d*=x=1/x,f*=x,p*=x):(d=0,f=0,p=0),e[0]=a,e[1]=d,e[2]=g,e[3]=0,e[4]=l,e[5]=f,e[6]=_,e[7]=0,e[8]=u,e[9]=p,e[10]=v,e[11]=0,e[12]=-(a*b+l*E+u*T),e[13]=-(d*b+f*E+p*T),e[14]=-(g*b+_*E+v*T),e[15]=1,e)},De.targetTo=function(e,t,n,i){var a=t[0],l=t[1],u=t[2],d=i[0],f=i[1],p=i[2],g=a-n[0],_=l-n[1],v=u-n[2],x=g*g+_*_+v*v;x>0&&(g*=x=1/Math.sqrt(x),_*=x,v*=x);var b=f*v-p*_,E=p*g-d*v,T=d*_-f*g;return(x=b*b+E*E+T*T)>0&&(b*=x=1/Math.sqrt(x),E*=x,T*=x),e[0]=b,e[1]=E,e[2]=T,e[3]=0,e[4]=_*T-v*E,e[5]=v*b-g*T,e[6]=g*E-_*b,e[7]=0,e[8]=g,e[9]=_,e[10]=v,e[11]=0,e[12]=a,e[13]=l,e[14]=u,e[15]=1,e},De.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},De.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},De.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},De.subtract=cp,De.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},De.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e},De.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},De.equals=function(e,t){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=e[9],v=e[10],x=e[11],b=e[12],E=e[13],T=e[14],C=e[15],D=t[0],A=t[1],P=t[2],I=t[3],R=t[4],k=t[5],L=t[6],N=t[7],z=t[8],j=t[9],B=t[10],H=t[11],V=t[12],Z=t[13],Q=t[14],et=t[15];return Math.abs(n-D)<=ir.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(i-A)<=ir.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(a-P)<=ir.EPSILON*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(l-I)<=ir.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(u-R)<=ir.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-k)<=ir.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(f-L)<=ir.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(p-N)<=ir.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(g-z)<=ir.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(_-j)<=ir.EPSILON*Math.max(1,Math.abs(_),Math.abs(j))&&Math.abs(v-B)<=ir.EPSILON*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(x-H)<=ir.EPSILON*Math.max(1,Math.abs(x),Math.abs(H))&&Math.abs(b-V)<=ir.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(E-Z)<=ir.EPSILON*Math.max(1,Math.abs(E),Math.abs(Z))&&Math.abs(T-Q)<=ir.EPSILON*Math.max(1,Math.abs(T),Math.abs(Q))&&Math.abs(C-et)<=ir.EPSILON*Math.max(1,Math.abs(C),Math.abs(et))},De.sub=De.mul=De.ortho=De.perspective=void 0;var ir=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==sp(e)&&"function"!=typeof e)return{default:e};var n=hE(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}(yn);function hE(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(hE=function(i){return i?n:t})(e)}function ap(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dE(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=t[8],v=t[9],x=t[10],b=t[11],E=t[12],T=t[13],C=t[14],D=t[15],A=n[0],P=n[1],I=n[2],R=n[3];return e[0]=A*i+P*d+I*_+R*E,e[1]=A*a+P*f+I*v+R*T,e[2]=A*l+P*p+I*x+R*C,e[3]=A*u+P*g+I*b+R*D,e[4]=(A=n[4])*i+(P=n[5])*d+(I=n[6])*_+(R=n[7])*E,e[5]=A*a+P*f+I*v+R*T,e[6]=A*l+P*p+I*x+R*C,e[7]=A*u+P*g+I*b+R*D,e[8]=(A=n[8])*i+(P=n[9])*d+(I=n[10])*_+(R=n[11])*E,e[9]=A*a+P*f+I*v+R*T,e[10]=A*l+P*p+I*x+R*C,e[11]=A*u+P*g+I*b+R*D,e[12]=(A=n[12])*i+(P=n[13])*d+(I=n[14])*_+(R=n[15])*E,e[13]=A*a+P*f+I*v+R*T,e[14]=A*l+P*p+I*x+R*C,e[15]=A*u+P*g+I*b+R*D,e}function lp(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=i+i,f=a+a,p=l+l,g=i*d,_=i*f,v=i*p,x=a*f,b=a*p,E=l*p,T=u*d,C=u*f,D=u*p;return e[0]=1-(x+E),e[1]=_+D,e[2]=v-C,e[3]=0,e[4]=_-D,e[5]=1-(g+E),e[6]=b+T,e[7]=0,e[8]=v+C,e[9]=b-T,e[10]=1-(g+x),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function fE(e,t){var n=t[4],i=t[5],a=t[6],l=t[8],u=t[9],d=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,i,a),e[2]=Math.hypot(l,u,d),e}function y0(e,t,n,i,a){var l,u=1/Math.tan(t/2);return e[0]=u/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(e[10]=(a+i)*(l=1/(i-a)),e[14]=2*a*i*l):(e[10]=-1,e[14]=-2*i),e}function e_(e,t,n,i,a,l,u){var d=1/(t-n),f=1/(i-a),p=1/(l-u);return e[0]=-2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*p,e[11]=0,e[12]=(t+n)*d,e[13]=(a+i)*f,e[14]=(u+l)*p,e[15]=1,e}function cp(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}De.perspective=y0,De.ortho=e_,De.mul=dE,De.sub=cp;var ve={},Me={};function v0(e){return(v0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Me,"__esModule",{value:!0}),Me.create=pE,Me.clone=function(e){var t=new os.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Me.length=U2,Me.fromValues=function(e,t,n){var i=new os.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=n,i},Me.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Me.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},Me.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},Me.subtract=x0,Me.multiply=mE,Me.divide=$2,Me.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Me.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Me.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},Me.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},Me.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Me.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},Me.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e},Me.distance=gE,Me.squaredDistance=_E,Me.squaredLength=yE,Me.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Me.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Me.normalize=function(e,t){var n=t[0],i=t[1],a=t[2],l=n*n+i*i+a*a;return l>0&&(l=1/Math.sqrt(l)),e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e},Me.dot=up,Me.cross=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=n[0],d=n[1],f=n[2];return e[0]=a*f-l*d,e[1]=l*u-i*f,e[2]=i*d-a*u,e},Me.lerp=function(e,t,n,i){var a=t[0],l=t[1],u=t[2];return e[0]=a+i*(n[0]-a),e[1]=l+i*(n[1]-l),e[2]=u+i*(n[2]-u),e},Me.hermite=function(e,t,n,i,a,l){var u=l*l,d=u*(2*l-3)+1,f=u*(l-2)+l,p=u*(l-1),g=u*(3-2*l);return e[0]=t[0]*d+n[0]*f+i[0]*p+a[0]*g,e[1]=t[1]*d+n[1]*f+i[1]*p+a[1]*g,e[2]=t[2]*d+n[2]*f+i[2]*p+a[2]*g,e},Me.bezier=function(e,t,n,i,a,l){var u=1-l,d=u*u,f=l*l,p=d*u,g=3*l*d,_=3*f*u,v=f*l;return e[0]=t[0]*p+n[0]*g+i[0]*_+a[0]*v,e[1]=t[1]*p+n[1]*g+i[1]*_+a[1]*v,e[2]=t[2]*p+n[2]*g+i[2]*_+a[2]*v,e},Me.random=function(e,t){t=t||1;var n=2*os.RANDOM()*Math.PI,i=2*os.RANDOM()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=i*t,e},Me.transformMat4=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=n[3]*i+n[7]*a+n[11]*l+n[15];return e[0]=(n[0]*i+n[4]*a+n[8]*l+n[12])/(u=u||1),e[1]=(n[1]*i+n[5]*a+n[9]*l+n[13])/u,e[2]=(n[2]*i+n[6]*a+n[10]*l+n[14])/u,e},Me.transformMat3=function(e,t,n){var i=t[0],a=t[1],l=t[2];return e[0]=i*n[0]+a*n[3]+l*n[6],e[1]=i*n[1]+a*n[4]+l*n[7],e[2]=i*n[2]+a*n[5]+l*n[8],e},Me.transformQuat=function(e,t,n){var i=n[0],a=n[1],l=n[2],u=t[0],d=t[1],f=t[2],p=a*f-l*d,g=l*u-i*f,_=i*d-a*u,v=a*_-l*g,x=l*p-i*_,b=i*g-a*p,E=2*n[3];return g*=E,_*=E,x*=2,b*=2,e[0]=u+(p*=E)+(v*=2),e[1]=d+g+x,e[2]=f+_+b,e},Me.rotateX=function(e,t,n,i){var a=[],l=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],l[0]=a[0],l[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),l[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),e[0]=l[0]+n[0],e[1]=l[1]+n[1],e[2]=l[2]+n[2],e},Me.rotateY=function(e,t,n,i){var a=[],l=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],l[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),l[1]=a[1],l[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),e[0]=l[0]+n[0],e[1]=l[1]+n[1],e[2]=l[2]+n[2],e},Me.rotateZ=function(e,t,n,i){var a=[],l=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],l[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),l[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),l[2]=a[2],e[0]=l[0]+n[0],e[1]=l[1]+n[1],e[2]=l[2]+n[2],e},Me.angle=function(e,t){var n=e[0],i=e[1],a=e[2],l=t[0],u=t[1],d=t[2],f=Math.sqrt(n*n+i*i+a*a)*Math.sqrt(l*l+u*u+d*d),p=f&&up(e,t)/f;return Math.acos(Math.min(Math.max(p,-1),1))},Me.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Me.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Me.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Me.equals=function(e,t){var n=e[0],i=e[1],a=e[2],l=t[0],u=t[1],d=t[2];return Math.abs(n-l)<=os.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-u)<=os.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-d)<=os.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},Me.forEach=Me.sqrLen=Me.len=Me.sqrDist=Me.dist=Me.div=Me.mul=Me.sub=void 0;var os=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==v0(e)&&"function"!=typeof e)return{default:e};var n=nd(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}(yn);function nd(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(nd=function(i){return i?n:t})(e)}function pE(){var e=new os.ARRAY_TYPE(3);return os.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function U2(e){return Math.hypot(e[0],e[1],e[2])}function x0(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function mE(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function $2(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function gE(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function _E(e,t){var n=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2];return n*n+i*i+a*a}function yE(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function up(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Me.sub=x0,Me.mul=mE,Me.div=$2,Me.dist=gE,Me.sqrDist=_E,Me.len=U2,Me.sqrLen=yE;var ul,H2=(ul=pE(),function(e,t,n,i,a,l){var u,d;for(t||(t=3),n||(n=0),d=i?Math.min(i*t+n,e.length):e.length,u=n;u<d;u+=t)ul[0]=e[u],ul[1]=e[u+1],ul[2]=e[u+2],a(ul,ul,l),e[u]=ul[0],e[u+1]=ul[1],e[u+2]=ul[2];return e});Me.forEach=H2;var Be={};function vE(e){return(vE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Be,"__esModule",{value:!0}),Be.create=xE,Be.clone=function(e){var t=new ks.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Be.fromValues=function(e,t,n,i){var a=new ks.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=i,a},Be.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Be.set=function(e,t,n,i,a){return e[0]=t,e[1]=n,e[2]=i,e[3]=a,e},Be.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Be.subtract=bE,Be.multiply=n_,Be.divide=q2,Be.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Be.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Be.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},Be.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},Be.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Be.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},Be.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},Be.distance=Z2,Be.squaredDistance=r_,Be.length=W2,Be.squaredLength=X2,Be.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Be.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Be.normalize=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=n*n+i*i+a*a+l*l;return u>0&&(u=1/Math.sqrt(u)),e[0]=n*u,e[1]=i*u,e[2]=a*u,e[3]=l*u,e},Be.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Be.cross=function(e,t,n,i){var a=n[0]*i[1]-n[1]*i[0],l=n[0]*i[2]-n[2]*i[0],u=n[0]*i[3]-n[3]*i[0],d=n[1]*i[2]-n[2]*i[1],f=n[1]*i[3]-n[3]*i[1],p=n[2]*i[3]-n[3]*i[2],g=t[0],_=t[1],v=t[2],x=t[3];return e[0]=_*p-v*f+x*d,e[1]=-g*p+v*u-x*l,e[2]=g*f-_*u+x*a,e[3]=-g*d+_*l-v*a,e},Be.lerp=function(e,t,n,i){var a=t[0],l=t[1],u=t[2],d=t[3];return e[0]=a+i*(n[0]-a),e[1]=l+i*(n[1]-l),e[2]=u+i*(n[2]-u),e[3]=d+i*(n[3]-d),e},Be.random=function(e,t){var n,i,a,l,u,d;t=t||1;do{u=(n=2*ks.RANDOM()-1)*n+(i=2*ks.RANDOM()-1)*i}while(u>=1);do{d=(a=2*ks.RANDOM()-1)*a+(l=2*ks.RANDOM()-1)*l}while(d>=1);var f=Math.sqrt((1-u)/d);return e[0]=t*n,e[1]=t*i,e[2]=t*a*f,e[3]=t*l*f,e},Be.transformMat4=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3];return e[0]=n[0]*i+n[4]*a+n[8]*l+n[12]*u,e[1]=n[1]*i+n[5]*a+n[9]*l+n[13]*u,e[2]=n[2]*i+n[6]*a+n[10]*l+n[14]*u,e[3]=n[3]*i+n[7]*a+n[11]*l+n[15]*u,e},Be.transformQuat=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=n[0],d=n[1],f=n[2],p=n[3],g=p*i+d*l-f*a,_=p*a+f*i-u*l,v=p*l+u*a-d*i,x=-u*i-d*a-f*l;return e[0]=g*p+x*-u+_*-f-v*-d,e[1]=_*p+x*-d+v*-u-g*-f,e[2]=v*p+x*-f+g*-d-_*-u,e[3]=t[3],e},Be.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Be.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Be.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Be.equals=function(e,t){var n=e[0],i=e[1],a=e[2],l=e[3],u=t[0],d=t[1],f=t[2],p=t[3];return Math.abs(n-u)<=ks.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-d)<=ks.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-f)<=ks.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=ks.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},Be.forEach=Be.sqrLen=Be.len=Be.sqrDist=Be.dist=Be.div=Be.mul=Be.sub=void 0;var ks=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==vE(e)&&"function"!=typeof e)return{default:e};var n=G2(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}(yn);function G2(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(G2=function(i){return i?n:t})(e)}function xE(){var e=new ks.ARRAY_TYPE(4);return ks.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function bE(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function n_(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function q2(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Z2(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function r_(e,t){var n=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2],l=t[3]-e[3];return n*n+i*i+a*a+l*l}function W2(e){return Math.hypot(e[0],e[1],e[2],e[3])}function X2(e){var t=e[0],n=e[1],i=e[2],a=e[3];return t*t+n*n+i*i+a*a}Be.sub=bE,Be.mul=n_,Be.div=q2,Be.dist=Z2,Be.sqrDist=r_,Be.len=W2,Be.sqrLen=X2;var rO=function(){var e=xE();return function(t,n,i,a,l,u){var d,f;for(n||(n=4),i||(i=0),f=a?Math.min(a*n+i,t.length):t.length,d=i;d<f;d+=n)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],e[3]=t[d+3],l(e,e,u),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2],t[d+3]=e[3];return t}}();function wE(e){return(wE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Be.forEach=rO,Object.defineProperty(ve,"__esModule",{value:!0}),ve.create=i_,ve.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},ve.setAxisAngle=Bu,ve.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>rd.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},ve.getAngle=function(e,t){var n=ME(e,t);return Math.acos(2*n*n-1)},ve.multiply=w0,ve.rotateX=function(e,t,n){n*=.5;var i=t[0],a=t[1],l=t[2],u=t[3],d=Math.sin(n),f=Math.cos(n);return e[0]=i*f+u*d,e[1]=a*f+l*d,e[2]=l*f-a*d,e[3]=u*f-i*d,e},ve.rotateY=function(e,t,n){n*=.5;var i=t[0],a=t[1],l=t[2],u=t[3],d=Math.sin(n),f=Math.cos(n);return e[0]=i*f-l*d,e[1]=a*f+u*d,e[2]=l*f+i*d,e[3]=u*f-a*d,e},ve.rotateZ=function(e,t,n){n*=.5;var i=t[0],a=t[1],l=t[2],u=t[3],d=Math.sin(n),f=Math.cos(n);return e[0]=i*f+a*d,e[1]=a*f-i*d,e[2]=l*f+u*d,e[3]=u*f-l*d,e},ve.calculateW=function(e,t){var n=t[0],i=t[1],a=t[2];return e[0]=n,e[1]=i,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-a*a)),e},ve.exp=E0,ve.ln=dp,ve.pow=function(e,t,n){return dp(e,t),EE(e,e,n),E0(e,e),e},ve.slerp=Vu,ve.random=function(e){var t=rd.RANDOM(),n=rd.RANDOM(),i=rd.RANDOM(),a=Math.sqrt(1-t),l=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=l*Math.sin(2*Math.PI*i),e[3]=l*Math.cos(2*Math.PI*i),e},ve.invert=function(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=n*n+i*i+a*a+l*l,d=u?1/u:0;return e[0]=-n*d,e[1]=-i*d,e[2]=-a*d,e[3]=l*d,e},ve.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},ve.fromMat3=Hl,ve.fromEuler=function(e,t,n,i){var a=.5*Math.PI/180;t*=a,n*=a,i*=a;var l=Math.sin(t),u=Math.cos(t),d=Math.sin(n),f=Math.cos(n),p=Math.sin(i),g=Math.cos(i);return e[0]=l*f*g-u*d*p,e[1]=u*d*g+l*f*p,e[2]=u*f*p-l*d*g,e[3]=u*f*g+l*d*p,e},ve.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ve.setAxes=ve.sqlerp=ve.rotationTo=ve.equals=ve.exactEquals=ve.normalize=ve.sqrLen=ve.squaredLength=ve.len=ve.length=ve.lerp=ve.dot=ve.scale=ve.mul=ve.add=ve.set=ve.copy=ve.fromValues=ve.clone=void 0;var rd=hp(yn),Y2=hp(wn),Ks=hp(Me),Eo=hp(Be);function b0(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b0=function(i){return i?n:t})(e)}function hp(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==wE(e)&&"function"!=typeof e)return{default:e};var n=b0(t);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}function i_(){var e=new rd.ARRAY_TYPE(4);return rd.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Bu(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function w0(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=n[0],f=n[1],p=n[2],g=n[3];return e[0]=i*g+u*d+a*p-l*f,e[1]=a*g+u*f+l*d-i*p,e[2]=l*g+u*p+i*f-a*d,e[3]=u*g-i*d-a*f-l*p,e}function E0(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=Math.sqrt(n*n+i*i+a*a),d=Math.exp(l),f=u>0?d*Math.sin(u)/u:0;return e[0]=n*f,e[1]=i*f,e[2]=a*f,e[3]=d*Math.cos(u),e}function dp(e,t){var n=t[0],i=t[1],a=t[2],l=t[3],u=Math.sqrt(n*n+i*i+a*a),d=u>0?Math.atan2(u,l)/u:0;return e[0]=n*d,e[1]=i*d,e[2]=a*d,e[3]=.5*Math.log(n*n+i*i+a*a+l*l),e}function Vu(e,t,n,i){var a,l,u,d,f,p=t[0],g=t[1],_=t[2],v=t[3],x=n[0],b=n[1],E=n[2],T=n[3];return(l=p*x+g*b+_*E+v*T)<0&&(l=-l,x=-x,b=-b,E=-E,T=-T),1-l>rd.EPSILON?(a=Math.acos(l),u=Math.sin(a),d=Math.sin((1-i)*a)/u,f=Math.sin(i*a)/u):(d=1-i,f=i),e[0]=d*p+f*x,e[1]=d*g+f*b,e[2]=d*_+f*E,e[3]=d*v+f*T,e}function Hl(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var l=(a+1)%3,u=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*l+l]-t[3*u+u]+1),e[a]=.5*n,e[3]=(t[3*l+u]-t[3*u+l])*(n=.5/n),e[l]=(t[3*l+a]+t[3*a+l])*n,e[u]=(t[3*u+a]+t[3*a+u])*n}return e}ve.clone=Eo.clone,ve.fromValues=Eo.fromValues,ve.copy=Eo.copy,ve.set=Eo.set,ve.add=Eo.add,ve.mul=w0;var EE=Eo.scale;ve.scale=EE;var ME=Eo.dot;ve.dot=ME,ve.lerp=Eo.lerp;var CE=Eo.length;ve.length=CE,ve.len=CE;var M0=Eo.squaredLength;ve.squaredLength=M0,ve.sqrLen=M0;var fp=Eo.normalize;ve.normalize=fp,ve.exactEquals=Eo.exactEquals,ve.equals=Eo.equals;var Ma,TE,DE,SE=(Ma=Ks.create(),TE=Ks.fromValues(1,0,0),DE=Ks.fromValues(0,1,0),function(e,t,n){var i=Ks.dot(t,n);return i<-.999999?(Ks.cross(Ma,TE,t),Ks.len(Ma)<1e-6&&Ks.cross(Ma,DE,t),Ks.normalize(Ma,Ma),Bu(e,Ma,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Ks.cross(Ma,t,n),e[0]=Ma[0],e[1]=Ma[1],e[2]=Ma[2],e[3]=1+i,fp(e,e))});ve.rotationTo=SE;var C0,T0,ss=(C0=i_(),T0=i_(),function(e,t,n,i,a,l){return Vu(C0,t,a,l),Vu(T0,n,i,l),Vu(e,C0,T0,2*l*(1-l)),e});ve.sqlerp=ss;var Ls,IE=(Ls=Y2.create(),function(e,t,n,i){return Ls[0]=n[0],Ls[3]=n[1],Ls[6]=n[2],Ls[1]=i[0],Ls[4]=i[1],Ls[7]=i[2],Ls[2]=-t[0],Ls[5]=-t[1],Ls[8]=-t[2],fp(e,Hl(e,Ls))});ve.setAxes=IE;var $e={};function Hi(e){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty($e,"__esModule",{value:!0}),$e.create=function(){var e=new Ri.ARRAY_TYPE(8);return Ri.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},$e.clone=function(e){var t=new Ri.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},$e.fromValues=function(e,t,n,i,a,l,u,d){var f=new Ri.ARRAY_TYPE(8);return f[0]=e,f[1]=t,f[2]=n,f[3]=i,f[4]=a,f[5]=l,f[6]=u,f[7]=d,f},$e.fromRotationTranslationValues=function(e,t,n,i,a,l,u){var d=new Ri.ARRAY_TYPE(8);d[0]=e,d[1]=t,d[2]=n,d[3]=i;var f=.5*a,p=.5*l,g=.5*u;return d[4]=f*i+p*n-g*t,d[5]=p*i+g*e-f*n,d[6]=g*i+f*t-p*e,d[7]=-f*e-p*t-g*n,d},$e.fromRotationTranslation=PE,$e.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},$e.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},$e.fromMat4=function(e,t){var n=hl.create();D0.getRotation(n,t);var i=new Ri.ARRAY_TYPE(3);return D0.getTranslation(i,t),PE(e,n,i),e},$e.copy=S0,$e.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},$e.set=function(e,t,n,i,a,l,u,d,f){return e[0]=t,e[1]=n,e[2]=i,e[3]=a,e[4]=l,e[5]=u,e[6]=d,e[7]=f,e},$e.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},$e.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},$e.getTranslation=function(e,t){var n=t[4],i=t[5],a=t[6],l=t[7],u=-t[0],d=-t[1],f=-t[2],p=t[3];return e[0]=2*(n*p+l*u+i*f-a*d),e[1]=2*(i*p+l*d+a*u-n*f),e[2]=2*(a*p+l*f+n*d-i*u),e},$e.translate=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=.5*n[0],f=.5*n[1],p=.5*n[2],g=t[4],_=t[5],v=t[6],x=t[7];return e[0]=i,e[1]=a,e[2]=l,e[3]=u,e[4]=u*d+a*p-l*f+g,e[5]=u*f+l*d-i*p+_,e[6]=u*p+i*f-a*d+v,e[7]=-i*d-a*f-l*p+x,e},$e.rotateX=function(e,t,n){var i=-t[0],a=-t[1],l=-t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=d*u+g*i+f*l-p*a,v=f*u+g*a+p*i-d*l,x=p*u+g*l+d*a-f*i,b=g*u-d*i-f*a-p*l;return hl.rotateX(e,t,n),e[4]=_*(u=e[3])+b*(i=e[0])+v*(l=e[2])-x*(a=e[1]),e[5]=v*u+b*a+x*i-_*l,e[6]=x*u+b*l+_*a-v*i,e[7]=b*u-_*i-v*a-x*l,e},$e.rotateY=function(e,t,n){var i=-t[0],a=-t[1],l=-t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=d*u+g*i+f*l-p*a,v=f*u+g*a+p*i-d*l,x=p*u+g*l+d*a-f*i,b=g*u-d*i-f*a-p*l;return hl.rotateY(e,t,n),e[4]=_*(u=e[3])+b*(i=e[0])+v*(l=e[2])-x*(a=e[1]),e[5]=v*u+b*a+x*i-_*l,e[6]=x*u+b*l+_*a-v*i,e[7]=b*u-_*i-v*a-x*l,e},$e.rotateZ=function(e,t,n){var i=-t[0],a=-t[1],l=-t[2],u=t[3],d=t[4],f=t[5],p=t[6],g=t[7],_=d*u+g*i+f*l-p*a,v=f*u+g*a+p*i-d*l,x=p*u+g*l+d*a-f*i,b=g*u-d*i-f*a-p*l;return hl.rotateZ(e,t,n),e[4]=_*(u=e[3])+b*(i=e[0])+v*(l=e[2])-x*(a=e[1]),e[5]=v*u+b*a+x*i-_*l,e[6]=x*u+b*l+_*a-v*i,e[7]=b*u-_*i-v*a-x*l,e},$e.rotateByQuatAppend=function(e,t,n){var i=n[0],a=n[1],l=n[2],u=n[3],d=t[0],f=t[1],p=t[2],g=t[3];return e[0]=d*u+g*i+f*l-p*a,e[1]=f*u+g*a+p*i-d*l,e[2]=p*u+g*l+d*a-f*i,e[3]=g*u-d*i-f*a-p*l,e[4]=(d=t[4])*u+(g=t[7])*i+(f=t[5])*l-(p=t[6])*a,e[5]=f*u+g*a+p*i-d*l,e[6]=p*u+g*l+d*a-f*i,e[7]=g*u-d*i-f*a-p*l,e},$e.rotateByQuatPrepend=function(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=n[0],f=n[1],p=n[2],g=n[3];return e[0]=i*g+u*d+a*p-l*f,e[1]=a*g+u*f+l*d-i*p,e[2]=l*g+u*p+i*f-a*d,e[3]=u*g-i*d-a*f-l*p,e[4]=i*(g=n[7])+u*(d=n[4])+a*(p=n[6])-l*(f=n[5]),e[5]=a*g+u*f+l*d-i*p,e[6]=l*g+u*p+i*f-a*d,e[7]=u*g-i*d-a*f-l*p,e},$e.rotateAroundAxis=function(e,t,n,i){if(Math.abs(i)<Ri.EPSILON)return S0(e,t);var a=Math.hypot(n[0],n[1],n[2]);i*=.5;var l=Math.sin(i),u=l*n[0]/a,d=l*n[1]/a,f=l*n[2]/a,p=Math.cos(i),g=t[0],_=t[1],v=t[2],x=t[3];e[0]=g*p+x*u+_*f-v*d,e[1]=_*p+x*d+v*u-g*f,e[2]=v*p+x*f+g*d-_*u,e[3]=x*p-g*u-_*d-v*f;var b=t[4],E=t[5],T=t[6],C=t[7];return e[4]=b*p+C*u+E*f-T*d,e[5]=E*p+C*d+T*u-b*f,e[6]=T*p+C*f+b*d-E*u,e[7]=C*p-b*u-E*d-T*f,e},$e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},$e.multiply=RE,$e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},$e.lerp=function(e,t,n,i){var a=1-i;return I0(t,n)<0&&(i=-i),e[0]=t[0]*a+n[0]*i,e[1]=t[1]*a+n[1]*i,e[2]=t[2]*a+n[2]*i,e[3]=t[3]*a+n[3]*i,e[4]=t[4]*a+n[4]*i,e[5]=t[5]*a+n[5]*i,e[6]=t[6]*a+n[6]*i,e[7]=t[7]*a+n[7]*i,e},$e.invert=function(e,t){var n=s_(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},$e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},$e.normalize=function(e,t){var n=s_(t);if(n>0){n=Math.sqrt(n);var i=t[0]/n,a=t[1]/n,l=t[2]/n,u=t[3]/n,d=t[4],f=t[5],p=t[6],g=t[7],_=i*d+a*f+l*p+u*g;e[0]=i,e[1]=a,e[2]=l,e[3]=u,e[4]=(d-i*_)/n,e[5]=(f-a*_)/n,e[6]=(p-l*_)/n,e[7]=(g-u*_)/n}return e},$e.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},$e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},$e.equals=function(e,t){var n=e[0],i=e[1],a=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=t[0],_=t[1],v=t[2],x=t[3],b=t[4],E=t[5],T=t[6],C=t[7];return Math.abs(n-g)<=Ri.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-_)<=Ri.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(a-v)<=Ri.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-x)<=Ri.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(u-b)<=Ri.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-E)<=Ri.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(f-T)<=Ri.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(p-C)<=Ri.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))},$e.sqrLen=$e.squaredLength=$e.len=$e.length=$e.dot=$e.mul=$e.setReal=$e.getReal=void 0;var Ri=o_(yn),hl=o_(ve),D0=o_(De);function AE(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(AE=function(i){return i?n:t})(e)}function o_(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Hi(e)&&"function"!=typeof e)return{default:e};var n=AE(t);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}function PE(e,t,n){var i=.5*n[0],a=.5*n[1],l=.5*n[2],u=t[0],d=t[1],f=t[2],p=t[3];return e[0]=u,e[1]=d,e[2]=f,e[3]=p,e[4]=i*p+a*f-l*d,e[5]=a*p+l*u-i*f,e[6]=l*p+i*d-a*u,e[7]=-i*u-a*d-l*f,e}function S0(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function RE(e,t,n){var i=t[0],a=t[1],l=t[2],u=t[3],d=n[4],f=n[5],p=n[6],g=n[7],_=t[4],v=t[5],x=t[6],b=t[7],E=n[0],T=n[1],C=n[2],D=n[3];return e[0]=i*D+u*E+a*C-l*T,e[1]=a*D+u*T+l*E-i*C,e[2]=l*D+u*C+i*T-a*E,e[3]=u*D-i*E-a*T-l*C,e[4]=i*g+u*d+a*p-l*f+_*D+b*E+v*C-x*T,e[5]=a*g+u*f+l*d-i*p+v*D+b*T+x*E-_*C,e[6]=l*g+u*p+i*f-a*d+x*D+b*C+_*T-v*E,e[7]=u*g-i*d-a*f-l*p+b*D-_*E-v*T-x*C,e}$e.getReal=hl.copy,$e.setReal=hl.copy,$e.mul=RE;var I0=hl.dot;$e.dot=I0;var OE=hl.length;$e.length=OE,$e.len=OE;var s_=hl.squaredLength;$e.squaredLength=s_,$e.sqrLen=s_;var Pe={};function pp(e){return(pp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.create=kE,Pe.clone=function(e){var t=new ju.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},Pe.fromValues=function(e,t){var n=new ju.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},Pe.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},Pe.set=function(e,t,n){return e[0]=t,e[1]=n,e},Pe.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},Pe.subtract=LE,Pe.multiply=A0,Pe.divide=P0,Pe.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},Pe.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},Pe.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},Pe.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},Pe.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},Pe.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},Pe.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e},Pe.distance=R0,Pe.squaredDistance=Uu,Pe.length=mp,Pe.squaredLength=O0,Pe.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},Pe.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},Pe.normalize=function(e,t){var n=t[0],i=t[1],a=n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e},Pe.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},Pe.cross=function(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e},Pe.lerp=function(e,t,n,i){var a=t[0],l=t[1];return e[0]=a+i*(n[0]-a),e[1]=l+i*(n[1]-l),e},Pe.random=function(e,t){t=t||1;var n=2*ju.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},Pe.transformMat2=function(e,t,n){var i=t[0],a=t[1];return e[0]=n[0]*i+n[2]*a,e[1]=n[1]*i+n[3]*a,e},Pe.transformMat2d=function(e,t,n){var i=t[0],a=t[1];return e[0]=n[0]*i+n[2]*a+n[4],e[1]=n[1]*i+n[3]*a+n[5],e},Pe.transformMat3=function(e,t,n){var i=t[0],a=t[1];return e[0]=n[0]*i+n[3]*a+n[6],e[1]=n[1]*i+n[4]*a+n[7],e},Pe.transformMat4=function(e,t,n){var i=t[0],a=t[1];return e[0]=n[0]*i+n[4]*a+n[12],e[1]=n[1]*i+n[5]*a+n[13],e},Pe.rotate=function(e,t,n,i){var a=t[0]-n[0],l=t[1]-n[1],u=Math.sin(i),d=Math.cos(i);return e[0]=a*d-l*u+n[0],e[1]=a*u+l*d+n[1],e},Pe.angle=function(e,t){var n=e[0],i=e[1],a=t[0],l=t[1],u=Math.sqrt(n*n+i*i)*Math.sqrt(a*a+l*l);return Math.acos(Math.min(Math.max(u&&(n*a+i*l)/u,-1),1))},Pe.zero=function(e){return e[0]=0,e[1]=0,e},Pe.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},Pe.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Pe.equals=function(e,t){var n=e[0],i=e[1],a=t[0],l=t[1];return Math.abs(n-a)<=ju.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-l)<=ju.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))},Pe.forEach=Pe.sqrLen=Pe.sqrDist=Pe.dist=Pe.div=Pe.mul=Pe.sub=Pe.len=void 0;var ju=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==pp(e)&&"function"!=typeof e)return{default:e};var n=id(void 0);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}(yn);function id(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(id=function(i){return i?n:t})(e)}function kE(){var e=new ju.ARRAY_TYPE(2);return ju.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function LE(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function A0(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function P0(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function R0(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function Uu(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function mp(e){return Math.hypot(e[0],e[1])}function O0(e){var t=e[0],n=e[1];return t*t+n*n}Pe.len=mp,Pe.sub=LE,Pe.mul=A0,Pe.div=P0,Pe.dist=R0,Pe.sqrDist=Uu,Pe.sqrLen=O0;var k0=function(){var e=kE();return function(t,n,i,a,l,u){var d,f;for(n||(n=2),i||(i=0),f=a?Math.min(a*n+i,t.length):t.length,d=i;d<f;d+=n)e[0]=t[d],e[1]=t[d+1],l(e,e,u),t[d]=e[0],t[d+1]=e[1];return t}}();function od(e){return(od="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}Pe.forEach=k0,Object.defineProperty(fi,"__esModule",{value:!0});var vn=fi.vec4=G=fi.vec3=fi.vec2=fi.quat2=Oi=fi.quat=nt=fi.mat4=Mo=fi.mat3=fi.mat2d=sd=fi.mat2=fi.glMatrix=void 0,J2=dl(yn);fi.glMatrix=J2;var K2=dl(Pn),sd=fi.mat2=K2,Q2=dl(cr);fi.mat2d=Q2;var tS=dl(wn),Mo=fi.mat3=tS,a_=dl(De),nt=fi.mat4=a_,L0=dl(ve),Oi=fi.quat=L0,eS=dl($e);fi.quat2=eS;var F0=dl(Pe);fi.vec2=F0;var FE=dl(Me),G=fi.vec3=FE,NE=dl(Be);function N0(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(N0=function(i){return i?n:t})(e)}function dl(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==od(e)&&"function"!=typeof e)return{default:e};var n=N0(t);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var u=a?Object.getOwnPropertyDescriptor(e,l):null;u&&(u.get||u.set)?Object.defineProperty(i,l,u):i[l]=e[l]}return i.default=e,n&&n.set(e,i),i}vn=fi.vec4=NE;const iO=sn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$u}=iO,zE=sn([{name:"a_pos_3",components:3,type:"Int16"}]);var Gl=sn([{name:"a_pos",type:"Int16",components:2}]),z0={};!function(n){function i(l,u,d){var f=a(256*l,256*(u=Math.pow(2,d)-u-1),d),p=a(256*(l+1),256*(u+1),d);return f[0]+","+f[1]+","+p[0]+","+p[1]}function a(l,u,d){var f=2*Math.PI*6378137/256/Math.pow(2,d);return[l*f-2*Math.PI*6378137/2,u*f-2*Math.PI*6378137/2]}n.getURL=function(l,u,d,f,p,g){return g=g||{},l+"?"+["bbox="+i(d,f,p),"format="+(g.format||"image/png"),"service="+(g.service||"WMS"),"version="+(g.version||"1.1.1"),"request="+(g.request||"GetMap"),"srs="+(g.srs||"EPSG:3857"),"width="+(g.width||256),"height="+(g.height||256),"layers="+u].join("&")},n.getTileBBox=i,n.getMercCoords=a,Object.defineProperty(n,"__esModule",{value:!0})}(z0);var BE=z0;class Qs{constructor(t,n,i){this.z=t,this.x=n,this.y=i,this.key=ql(0,t,t,n,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n){const i=BE.getTileBBox(this.x,this.y,this.z),a=function(l,u,d){let f,p="";for(let g=l;g>0;g--)f=1<<g-1,p+=(u&f?1:0)+(d&f?2:0);return p}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class l_{constructor(t,n){this.wrap=t,this.canonical=n,this.key=ql(t,n.z,n.z,n.x,n.y)}}class Ze{constructor(t,n,i,a,l){this.overscaledZ=t,this.wrap=n,this.canonical=new Qs(i,+a,+l),this.key=0===n&&t===i?this.canonical.key:ql(n,t,i,a,l)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const n=this.canonical.z-t;return t>this.canonical.z?new Ze(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ze(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n=!0){if(this.overscaledZ===t&&n)return this.key;if(t>this.canonical.z)return ql(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return ql(this.wrap*+n,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Ze(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,i=2*this.canonical.x,a=2*this.canonical.y;return[new Ze(n,this.wrap,n,i,a),new Ze(n,this.wrap,n,i+1,a),new Ze(n,this.wrap,n,i,a+1),new Ze(n,this.wrap,n,i+1,a+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ze(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ze(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new l_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ql(e,t,n,i,a){const l=1<<Math.min(n,22);let u=l*(a%l)+i%l;return e&&n<22&&(u+=l*l*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*u+n)+(t-n)}const B0=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new Ze(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new Ze(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new Ze(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Ze(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];Gt(Qs,"CanonicalTileID"),Gt(Ze,"OverscaledTileID",{omit:["projMatrix"]});class ad{constructor(t,n){this.pos=t,this.dir=n}intersectsPlane(t,n,i){const a=G.dot(n,this.dir);if(Math.abs(a)<1e-6)return!1;const l=((t[0]-this.pos[0])*n[0]+(t[1]-this.pos[1])*n[1]+(t[2]-this.pos[2])*n[2])/a;return i[0]=this.pos[0]+this.dir[0]*l,i[1]=this.pos[1]+this.dir[1]*l,i[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(t,n,i){if(G.equals(this.pos,t)||0===n)return i[0]=i[1]=i[2]=0,!1;const[a,l,u]=this.dir,d=this.pos[0]-t[0],f=this.pos[1]-t[1],p=this.pos[2]-t[2],g=a*a+l*l+u*u,_=2*(d*a+f*l+p*u),v=_*_-4*g*(d*d+f*f+p*p-n*n);if(v<0){const x=Math.max(-_/2,0),b=d+a*x,E=f+l*x,T=p+u*x,C=Math.hypot(b,E,T);return i[0]=b*n/C,i[1]=E*n/C,i[2]=T*n/C,!1}{const x=(-_-Math.sqrt(v))/(2*g);if(x<0){const b=Math.hypot(d,f,p);return i[0]=d*n/b,i[1]=f*n/b,i[2]=p*n/b,!1}return i[0]=d+a*x,i[1]=f+l*x,i[2]=p+u*x,!0}}}class ld{constructor(t,n,i,a,l){this.TL=t,this.TR=n,this.BR=i,this.BL=a,this.horizon=l}static fromInvProjectionMatrix(t,n,i){const a=[-1,1,1],l=[1,1,1],u=[1,-1,1],d=[-1,-1,1],f=G.transformMat4(a,a,t),p=G.transformMat4(l,l,t),g=G.transformMat4(u,u,t),_=G.transformMat4(d,d,t);return new ld(f,p,g,_,n/i)}}function cd(e,t,n){let i=1/0,a=-1/0;const l=[];for(const u of e){G.sub(l,u,t);const d=G.dot(l,n);i=Math.min(i,d),a=Math.max(a,d)}return[i,a]}function c_(e,t){let n=!0;for(let i=0;i<e.planes.length;i++){const a=e.planes[i];let l=0;for(let u=0;u<t.length;u++)l+=G.dot(a,t[u])+a[3]>=0;if(0===l)return 0;l!==t.length&&(n=!1)}return n?2:1}function ud(e,t){for(const n of e.projections){const i=cd(t,e.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function VE(e,t){let n=0;const i=[0,0,0,0];for(let a=0;a<e.length;a++)i[0]=e[a][0],i[1]=e[a][1],i[2]=e[a][2],i[3]=1,vn.dot(i,t)>=0&&n++;return n}class fl{constructor(t,n){this.points=t||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=$n.fromPoints(this.points),this.projections=[],this.frustumEdges=[G.sub([],this.points[2],this.points[3]),G.sub([],this.points[0],this.points[3]),G.sub([],this.points[4],this.points[0]),G.sub([],this.points[5],this.points[1]),G.sub([],this.points[6],this.points[2]),G.sub([],this.points[7],this.points[3])];for(const i of this.frustumEdges){const a=[0,-i[2],i[1]],l=[i[2],0,-i[0]];this.projections.push({axis:a,projection:cd(this.points,this.points[0],a)}),this.projections.push({axis:l,projection:cd(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(t,n,i,a){const l=Math.pow(2,i),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(p=>{const g=vn.transformMat4([],p,t),_=1/g[3]/n*l;return vn.mul(g,g,[_,_,a?1/g[3]:_,_])}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(p=>{const g=G.sub([],u[p[0]],u[p[1]]),_=G.sub([],u[p[2]],u[p[1]]),v=G.normalize([],G.cross([],g,_)),x=-G.dot(v,u[p[1]]);return v.concat(x)}),f=[];for(let p=0;p<u.length;p++)f.push([u[p][0],u[p][1],u[p][2]]);return new fl(f,d)}intersectsPrecise(t,n,i){for(let a=0;a<n.length;a++)if(!VE(t,n[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!VE(t,this.planes[a]))return 0;for(const a of i)for(const l of this.frustumEdges){const u=G.cross([],a,l),d=G.length(u);if(0===d)continue;G.scale(u,u,1/d);const f=cd(this.points,this.points[0],u),p=cd(t,this.points[0],u);if(f[0]>p[1]||p[0]>f[1])return 0}return 1}}class $n{static fromPoints(t){const n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const a of t)G.min(n,n,a),G.max(i,i,a);return new $n(n,i)}static fromTileIdAndHeight(t,n,i){const a=1<<t.canonical.z,l=t.canonical.x,u=t.canonical.y;return new $n([l/a,u/a,n],[(l+1)/a,(u+1)/a,i])}static applyTransform(t,n){const i=t.getCorners();for(let a=0;a<i.length;++a)G.transformMat4(i[a],i[a],n);return $n.fromPoints(i)}static projectAabbCorners(t,n){const i=t.getCorners();for(let a=0;a<i.length;++a)G.transformMat4(i[a],i[a],n);return i}constructor(t,n){this.min=t,this.max=n,this.center=G.scale([],G.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],i=G.clone(this.min),a=G.clone(this.max);for(let l=0;l<n.length;l++)i[l]=n[l]?this.min[l]:this.center[l],a[l]=n[l]?this.center[l]:this.max[l];return a[2]=this.max[2],new $n(i,a)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,n=this.max;return[[t[0],t[1],t[2]],[n[0],t[1],t[2]],[n[0],n[1],t[2]],[t[0],n[1],t[2]],[t[0],t[1],n[2]],[n[0],t[1],n[2]],[n[0],n[1],n[2]],[t[0],n[1],n[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?c_(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?c_(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,n){return n||this.intersects(t)?ud(t,this.getCorners()):0}intersectsPreciseFlat(t,n){return n||this.intersectsFlat(t)?ud(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let n=0;n<3;++n)if(this.min[n]>t.max[n]||t.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],t.min[n]),this.max[n]=Math.max(this.max[n],t.max[n])}encapsulatePoint(t){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],t[n]),this.max[n]=Math.max(this.max[n],t[n])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Gt($n,"Aabb");const gp=5,$c=6,lo=lt/Math.PI/2,jE=16383,_p=[64,32,16],co=-lo,ta=lo,nS=[new $n([co,co,co],[ta,ta,ta]),new $n([co,co,co],[0,0,ta]),new $n([0,co,co],[ta,0,ta]),new $n([co,0,co],[0,ta,ta]),new $n([0,0,co],[ta,ta,ta])];function V0(e){return e*lo/Gu}function UE(e,t,n,i=!0){const a=G.scale([],e._camera.position,e.worldSize),l=[t,n,1,1];vn.transformMat4(l,l,e.pixelMatrixInverse),vn.scale(l,l,1/l[3]);const u=G.sub([],l,a),d=G.normalize([],u),f=e.globeMatrix,p=[f[12],f[13],f[14]],g=G.sub([],p,a),_=G.length(g),v=G.normalize([],g),x=e.worldSize/(2*Math.PI),b=G.dot(v,d),E=Math.asin(x/_);if(E<Math.acos(b)){if(!i)return null;const j=[],B=[];G.scale(j,d,_/b),G.normalize(B,G.sub(B,j,g)),G.normalize(d,G.add(d,g,G.scale(d,B,Math.tan(E)*_)))}const T=[];new ad(a,d).closestPointOnSphere(p,x,T);const C=G.normalize([],_r(f,0)),D=G.normalize([],_r(f,1)),A=G.normalize([],_r(f,2)),P=G.dot(C,T),I=G.dot(D,T),R=G.dot(A,T),k=ti(Math.asin(-I/x));let L=ti(Math.atan2(P,R));L=e.center.lng+function(j,B){const H=(B-j+180)%360-180;return H<-180?H+360:H}(e.center.lng,L);const N=Li(L),z=Wt(Gi(k),0,1);return new Ge(N,z)}class j0{constructor(t,n,i){this.a=G.sub([],t,i),this.b=G.sub([],n,i),this.center=i;const a=G.normalize([],this.a),l=G.normalize([],this.b);this.angle=Math.acos(G.dot(a,l))}}function U0(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(i,a,l,u){const d=Math.sin(l);return i*(Math.sin((1-u)*l)/d)+a*(Math.sin(u*l)/d)}(e.a[t],e.b[t],e.angle,Wt(n,0,1))+e.center[t]}function uo(e){if(e.z<=1)return nS[e.z+2*e.y+e.x];const t=d_(yp(e));return $n.fromPoints(t)}function ea(e,t,n){return G.scale(e,e,1-n),G.scaleAndAdd(e,e,t,n)}function u_(e,t){const n=ki(t.zoom);if(0===n)return uo(e);const i=yp(e),a=d_(i),l=Li(i.getWest())*t.worldSize,u=Li(i.getEast())*t.worldSize,d=Gi(i.getNorth())*t.worldSize,f=Gi(i.getSouth())*t.worldSize,p=[l,d,0],g=[u,d,0],_=[l,f,0],v=[u,f,0],x=nt.invert([],t.globeMatrix);return G.transformMat4(p,p,x),G.transformMat4(g,g,x),G.transformMat4(_,_,x),G.transformMat4(v,v,x),a[0]=ea(a[0],_,n),a[1]=ea(a[1],v,n),a[2]=ea(a[2],g,n),a[3]=ea(a[3],p,n),$n.fromPoints(a)}function $0(e,t,n){for(const i of e)G.transformMat4(i,i,t),G.scale(i,i,n)}function h_(e,t,n,i){const a=t/e.worldSize,l=e.globeMatrix;if(n.z<=1){const N=uo(n).getCorners();return $0(N,l,a),$n.fromPoints(N)}const u=yp(n,i),d=d_(u);$0(d,l,a);const f=Number.MAX_VALUE,p=[-f,-f,-f],g=[f,f,f];if(u.contains(e.center)){for(const j of d)G.min(g,g,j),G.max(p,p,j);p[2]=0;const N=e.point,z=[N.x*a,N.y*a,0];return G.min(g,g,z),G.max(p,p,z),new $n(g,p)}const _=[l[12]*a,l[13]*a,l[14]*a],v=u.getCenter(),x=Wt(e.center.lat,-Er,Er),b=Wt(v.lat,-Er,Er),E=Li(e.center.lng),T=Gi(x);let C=E-Li(v.lng);const D=T-Gi(b);C>.5?C-=1:C<-.5&&(C+=1);let A=0;if(Math.abs(C)>Math.abs(D))A=C>=0?1:3;else{A=D>=0?0:2;const N=[l[4]*a,l[5]*a,l[6]*a],z=-Math.sin(Ee(D>=0?u.getSouth():u.getNorth()))*lo;G.scaleAndAdd(_,_,N,z)}const P=d[A],I=d[(A+1)%4],R=new j0(P,I,_),k=[U0(R,0)||P[0],U0(R,1)||P[1],U0(R,2)||P[2]],L=ki(e.zoom);if(L>0){const N=function({x:j,y:B,z:H},V,Z,Q,et){const W=1/(1<<H);let X=j*W,rt=X+W,ot=B*W,ct=ot+W,dt=0;const gt=(X+rt)/2-Q;return gt>.5?dt=-1:gt<-.5&&(dt=1),X=((X+dt)*V-(Q*=V))*Z+Q,rt=((rt+dt)*V-Q)*Z+Q,ot=(ot*V-(et*=V))*Z+et,ct=(ct*V-et)*Z+et,[[X,ct,0],[rt,ct,0],[rt,ot,0],[X,ot,0]]}(n,t,e._pixelsPerMercatorPixel,E,T);for(let j=0;j<d.length;j++)ea(d[j],N[j],L);const z=G.add([],N[A],N[(A+1)%4]);G.scale(z,z,.5),ea(k,z,L)}for(const N of d)G.min(g,g,N),G.max(p,p,N);return g[2]=Math.min(P[2],I[2]),G.min(g,g,k),G.max(p,p,k),new $n(g,p)}function yp({x:e,y:t,z:n},i=!1){const a=1/(1<<n),l=new _e(ls(e*a),t===(1<<n)-1&&i?-90:zr((t+1)*a)),u=new _e(ls((e+1)*a),0===t&&i?90:zr(t*a));return new Rs(l,u)}function d_(e){const t=Ee(e.getNorth()),n=Ee(e.getSouth()),i=Math.cos(t),a=Math.cos(n),l=Math.sin(t),u=Math.sin(n),d=e.getWest(),f=e.getEast();return[hd(a,u,d),hd(a,u,f),hd(i,l,f),hd(i,l,d)]}function hd(e,t,n,i=lo){return n=Ee(n),[e*Math.sin(n)*i,-t*i,e*Math.cos(n)*i]}function Vo(e,t,n){return hd(Math.cos(Ee(e)),Math.sin(Ee(e)),t,n)}function vp(e,t,n,i){const a=1<<n.z,l=(e/lt+n.x)/a;return Vo(zr((t/lt+n.y)/a),ls(l),i)}function f_({min:e,max:t}){return jE/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const $E=new Float64Array(16);function as(e){const t=f_(e),n=nt.fromScaling($E,[t,t,t]);return nt.translate(n,n,G.negate([],e.min))}function Hu(e){const t=nt.fromTranslation($E,e.min),n=1/f_(e);return nt.scale(t,t,[n,n,n])}function H0(e){const t=lt/(2*Math.PI);return e/(2*Math.PI)/t}function rS(e,t){return lt/(512*Math.pow(2,e))*f_(uo(t))}function iS(e,t,n,i,a){const l=H0(n),u=[e,t,-n/(2*Math.PI)],d=nt.identity(new Float64Array(16));return nt.translate(d,d,u),nt.scale(d,d,[l,l,l]),nt.rotateX(d,d,Ee(-a)),nt.rotateY(d,d,Ee(-i)),d}function ki(e){return Ya(gp,$c,e)}function oS(e,t,n){const i=nt.identity(new Float64Array(16)),a=(t/(1<<e)-.5)*Math.PI*2;return nt.rotateY(i,n.globeMatrix,a),Float32Array.from(i)}function sS(e,t,n){const i=ki(n.zoom),a=e.style.map._antialias,l=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===i&&!a&&!l}function HE(e,t,n,i){const a=t.getNorth(),l=t.getSouth(),u=t.getWest(),d=t.getEast(),f=1<<e.z,p=d-u,g=a-l,_=p/64,v=-g/_p[n],x=[0,_,0,v,0,0,a,u,0];if(e.z>0){const b=180/i;Mo.multiply(x,x,[b/p+1,0,0,0,b/g+1,0,-.5*b/_,.5*b/v,1])}return x[2]=f,x[5]=e.x,x[8]=e.y,x}function aS(e){const t=Er-5;e=Wt(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(Ee(e))),3);return Math.round(n*(_p.length-1))}function GE(e){const t=[0,0,0],n=nt.identity(new Float64Array(16));return nt.multiply(n,e.pixelMatrix,e.globeMatrix),G.transformMat4(t,t,n),new tt(t[0],t[1])}function qE(e,t){const n=Vo(t.lat,t.lng),i=function(l){const u=Vo(l._center.lat,l._center.lng),d=G.fromValues(0,1,0);let f=G.cross([],d,u);const p=nt.fromRotation([],-l.angle,u);f=G.transformMat4(f,f,p),nt.fromRotation(p,-l._pitch,f);const g=G.normalize([],u);return G.scale(g,g,V0(l.cameraToCenterDistance/l.pixelsPerMeter)),G.transformMat4(g,g,p),G.add([],u,g)}(e),a=G.subtract([],i,n);return G.angle(a,n)}function p_(e,t){return qE(e,t)>Math.PI/2*1.01}const m_=Ee(85),Wl=Math.cos(m_),xp=Math.sin(m_);class ZE{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,n){const i=new wo,a=new Rr,l=[],u=t+1+2,d=n[0]+1,f=n[0]+1+(1+n.length),p=(g,_,v)=>{let x=g===u-1?g-2:0===g?g:g-1;return x+=v?24575:0,[x,_]};for(let g=0;g<u;++g)i.emplaceBack(...p(g,0,!0));for(let g=0;g<d;++g)for(let _=0;_<u;++_)i.emplaceBack(...p(_,g,(0===_||_===u-1)&&!0));for(let g=0;g<n.length;++g){const _=n[g];for(let v=0;v<u;++v)i.emplaceBack(...p(v,_,!0))}for(let g=0;g<n.length;++g){const _=a.length,v=n[g]+1+2,x=new Rr;for(let T=0;T<v-1;T++){const C=T===v-2,D=C?u*(f-n.length+g-T):u;for(let A=0;A<u-1;A++){const P=T*u+A;0===T||C||0===A||A===u-2?(x.emplaceBack(P+1,P,P+D),x.emplaceBack(P+D,P+D+1,P+1)):(a.emplaceBack(P+1,P,P+D),a.emplaceBack(P+D,P+D+1,P+1))}}const b=bn.simpleSegment(0,_,i.length,a.length-_);for(let T=0;T<x.uint16.length;T+=3)a.emplaceBack(x.uint16[T],x.uint16[T+1],x.uint16[T+2]);const E=bn.simpleSegment(0,_,i.length,a.length-_);l.push({withoutSkirts:b,withSkirts:E})}return{vertices:i,indices:a,segments:l}}_createGrid(t){const n=this._fillGridMeshWithLods(64,_p);this._gridSegments=n.segments,this._gridBuffer=t.createVertexBuffer(n.vertices,Gl.members),this._gridIndexBuffer=t.createIndexBuffer(n.indices,!0)}_createPoles(t){const n=new Rr;for(let d=0;d<=64;d++)n.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=t.createIndexBuffer(n,!0);const i=new Ys,a=new Ys,l=new Ys,u=new Ys;this._poleSegments=[];for(let d=0,f=0;d<gp;d++){const p=360/(1<<d);i.emplaceBack(0,-lo,0,.5,0),a.emplaceBack(0,-lo,0,.5,1),l.emplaceBack(0,-lo,0,.5,.5),u.emplaceBack(0,-lo,0,.5,.5);for(let g=0;g<=64;g++){let _=g/64,v=0;const x=ue(0,p,_),[b,E,T]=hd(Wl,xp,x,lo);i.emplaceBack(b,E,T,_,v),a.emplaceBack(b,E,T,_,1-v);const C=Ee(x);_=.5+.5*Math.sin(C),v=.5+.5*Math.cos(C),l.emplaceBack(b,E,T,_,v),u.emplaceBack(b,E,T,_,1-v)}this._poleSegments.push(bn.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,$u,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,$u,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,$u,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,$u,!1)}getGridBuffers(t,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}const Gu=6371008.8,g_=2*Math.PI*Gu;class qu{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qu(Ja(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,i=this.lat*n,a=t.lat*n,l=Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos((t.lng-this.lng)*n);return Gu*Math.acos(Math.min(l,1))}toBounds(t=0){const n=360*t/40075017,i=n/Math.cos(Math.PI/180*this.lat);return new Rs(new qu(this.lng-i,this.lat-n),new qu(this.lng+i,this.lat+n))}toEcef(t){const n=V0(t);return Vo(this.lat,this.lng,lo+n)}static convert(t){if(t instanceof qu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new qu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new qu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var _e=qu;const oO=0,G0=25.5;function dd(e){return g_*Math.cos(e*Math.PI/180)}function Li(e){return(180+e)/360}function Gi(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function xn(e,t){return e/dd(t)}function ls(e){return 360*e-180}function zr(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function WE(e,t){return e*dd(zr(t))}const Er=85.051129;function q0(e){return Math.cos(Ee(Wt(e,-Er,Er)))}function Ca(e,t){const n=Wt(t,oO,G0),i=Math.pow(2,n);return q0(e)*g_/(512*i)}function Z0(e){return 1/Math.cos(e*Math.PI/180)}function Zu(e,t=0){const n=Math.exp(Math.PI*(1-(e.y+t/lt)/(1<<e.z)*2));return 80150034*n/(n*n+1)/lt/(1<<e.z)}class Ge{constructor(t,n,i=0){this.x=+t,this.y=+n,this.z=+i}static fromLngLat(t,n=0){const i=_e.convert(t);return new Ge(Li(i.lng),Gi(i.lat),xn(n,i.lat))}toLngLat(){return new _e(ls(this.x),zr(this.y))}toAltitude(){return WE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/g_*Z0(zr(this.y))}}function Hc(e,t,n,i,a,l,u,d,f){const p=(t+i)/2,g=(n+a)/2,_=new tt(p,g);d(_),function(v,x,b,E,T,C){const D=b-T,A=E-C;return Math.abs((E-x)*D-(b-v)*A)/Math.hypot(D,A)}(_.x,_.y,l.x,l.y,u.x,u.y)>=f?(Hc(e,t,n,p,g,l,_,d,f),Hc(e,p,g,i,a,_,u,d,f)):e.push(u)}function XE(e,t,n){let i=e[0],a=i.x,l=i.y;t(i);const u=[i];for(let d=1;d<e.length;d++){const f=e[d],{x:p,y:g}=f;t(f),Hc(u,a,l,p,g,i,f,t,n),a=p,l=g,i=f}return u}function W0(e,t,n,i){if(i(t,n)){const a=t.add(n)._mult(.5);W0(e,t,a,i),W0(e,a,n,i)}else e.push(n)}function YE(e,t){let n=e[0];const i=[n];for(let a=1;a<e.length;a++){const l=e[a];W0(i,n,l,t),n=l}return i}const __=Math.pow(2,14)-1,JE=-__-1;function lS(e,t){const n=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=Wt(n,JE,__),e.y=Wt(i,JE,__),(n<e.x||n>e.x+1||i<e.y||i>e.y+1)&&K("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function pl(e,t,n){const i=e.loadGeometry(),a=e.extent,l=lt/a;if(t&&n&&n.projection.isReprojectedInTileSpace){const u=1<<t.z,{scale:d,x:f,y:p,projection:g}=n,_=v=>{const x=ls((t.x+v.x/a)/u),b=zr((t.y+v.y/a)/u),E=g.project(x,b);v.x=(E.x*d-f)*a,v.y=(E.y*d-p)*a};for(let v=0;v<i.length;v++)if(1!==e.type)i[v]=XE(i[v],_,1);else{const x=[];for(const b of i[v])b.x<0||b.x>=a||b.y<0||b.y>=a||(_(b),x.push(b));i[v]=x}}for(const u of i)for(const d of u)lS(d,l);return i}function Gc(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?pl(e):[]}}function bp(e,t,n,i,a){e.emplaceBack(2*t+(i+1)/2,2*n+(a+1)/2)}function X0(e,t,n){e.emplaceBack(t.x,t.y,t.z,16384*n[0],16384*n[1],16384*n[2])}class KE{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new wo,this.indexArray=new Rr,this.segments=new bn,this.programConfigurations=new Fu(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,i,a){const l=this.layers[0],u=[];let d=null;"circle"===l.type&&(d=l.layout.get("circle-sort-key"));for(const{feature:p,id:g,index:_,sourceLayerIndex:v}of t){const x=this.layers[0]._featureFilter.needGeometry,b=Gc(p,x);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),b,i))continue;const E=d?d.evaluate(b,{},i):void 0,T={id:g,properties:p.properties,type:p.type,sourceLayerIndex:v,index:_,geometry:x?b.geometry:pl(p,i,a),patterns:{},sortKey:E};u.push(T)}d&&u.sort((p,g)=>p.sortKey-g.sortKey);let f=null;"globe"===a.projection.name&&(this.globeExtVertexArray=new Vg,f=a.projection);for(const p of u){const{geometry:g,index:_,sourceLayerIndex:v}=p,x=t[_].feature;this.addFeature(p,g,_,n.availableImages,i,f,n.brightness),n.featureIndex.insert(x,g,_,v,this.index)}}update(t,n,i,a,l){const u=0!==Object.keys(t).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,u?this.stateDependentLayers:this.layers,i,a,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,N2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,al.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,n,i,a,l,u,d){for(const f of n)for(const p of f){const g=p.x,_=p.y;if(g<0||g>=lt||_<0||_>=lt)continue;if(u){const b=u.projectTilePoint(g,_,l),E=u.upVector(l,g,_),T=this.globeExtVertexArray;X0(T,b,E),X0(T,b,E),X0(T,b,E),X0(T,b,E)}const v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),x=v.vertexLength;bp(this.layoutVertexArray,g,_,-1,-1),bp(this.layoutVertexArray,g,_,1,-1),bp(this.layoutVertexArray,g,_,1,1),bp(this.layoutVertexArray,g,_,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+2,x+3),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},a,l,d)}}function fd(e,t){for(let n=0;n<e.length;n++)if(Ta(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Ta(e,t[n]))return!0;return!!Ep(e,t)}function wp(e,t,n){return!!Ta(e,t)||!!K0(t,e,n)}function Y0(e,t){if(1===e.length)return tx(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let a=0;a<i.length;a++)if(Ta(e,i[a]))return!0}for(let n=0;n<e.length;n++)if(tx(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Ep(e,t[n]))return!0;return!1}function QE(e,t,n){if(e.length>1){if(Ep(e,t))return!0;for(let i=0;i<t.length;i++)if(K0(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(K0(e[i],t,n))return!0;return!1}function Ep(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],a=e[n+1];for(let l=0;l<t.length-1;l++)if(J0(i,a,t[l],t[l+1]))return!0}return!1}function J0(e,t,n,i){return vt(e,n,i)!==vt(t,n,i)&&vt(e,t,n)!==vt(e,t,i)}function K0(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let a=1;a<t.length;a++)if(Q0(e,t[a-1],t[a])<i)return!0;return!1}function Q0(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const a=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(a<0?t:a>1?n:n.sub(t)._mult(a)._add(t))}function tx(e,t){let n,i,a,l=!1;for(let u=0;u<e.length;u++){n=e[u];for(let d=0,f=n.length-1;d<n.length;f=d++)i=n[d],a=n[f],i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(l=!l)}return l}function Ta(e,t){let n=!1;for(let i=0,a=e.length-1;i<e.length;a=i++){const l=e[i],u=e[a];l.y>t.y!=u.y>t.y&&t.x<(u.x-l.x)*(t.y-l.y)/(u.y-l.y)+l.x&&(n=!n)}return n}function cS(e,t,n,i,a){for(const u of e)if(t<=u.x&&n<=u.y&&i>=u.x&&a>=u.y)return!0;const l=[new tt(t,n),new tt(t,a),new tt(i,a),new tt(i,n)];if(e.length>2)for(const u of l)if(Ta(e,u))return!0;for(let u=0;u<e.length-1;u++)if(ex(e[u],e[u+1],l))return!0;return!1}function ex(e,t,n){const i=n[0],a=n[2];if(e.x<i.x&&t.x<i.x||e.x>a.x&&t.x>a.x||e.y<i.y&&t.y<i.y||e.y>a.y&&t.y>a.y)return!1;const l=vt(e,t,n[0]);return l!==vt(e,t,n[1])||l!==vt(e,t,n[2])||l!==vt(e,t,n[3])}function pd(e,t,n,i,a,l){let u=t.y-e.y,d=e.x-t.x;if(l=l||0){const f=u*u+d*d;if(0===f)return!0;const p=Math.sqrt(f);u/=p,d/=p}return!((n.x-e.x)*u+(n.y-e.y)*d-l<0||(i.x-e.x)*u+(i.y-e.y)*d-l<0||(a.x-e.x)*u+(a.y-e.y)*d-l<0)}function Mp(e,t,n,i,a,l,u){return!(pd(e,t,i,a,l,u)||pd(t,n,i,a,l,u)||pd(n,e,i,a,l,u)||pd(i,a,e,t,n,u)||pd(a,l,e,t,n,u)||pd(l,i,e,t,n,u))}function Wu(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Cp(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function qc(e,t,n,i,a){if(!t[0]&&!t[1])return e;const l=tt.convert(t)._mult(a);"viewport"===n&&l._rotate(-i);const u=[];for(let d=0;d<e.length;d++)u.push(e[d].sub(l));return u}function tM(e,t,n,i){const a=tt.convert(e)._mult(i);return"viewport"===t&&a._rotate(-n),a}Gt(KE,"CircleBucket",{omit:["layers"]});const nx=new nr({"circle-sort-key":new te(J.layout_circle["circle-sort-key"]),visibility:new Tt(J.layout_circle.visibility)});var y_={paint:new nr({"circle-radius":new te(J.paint_circle["circle-radius"]),"circle-color":new te(J.paint_circle["circle-color"]),"circle-blur":new te(J.paint_circle["circle-blur"]),"circle-opacity":new te(J.paint_circle["circle-opacity"]),"circle-translate":new Tt(J.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(J.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(J.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(J.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new te(J.paint_circle["circle-stroke-width"]),"circle-stroke-color":new te(J.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new te(J.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt(J.paint_circle["circle-emissive-strength"])}),layout:nx};const uS=nt.create(),rx=(e,t,n,i,a,l)=>{const u=e.transform,d="globe"===u.projection.name;let f;if("map"===l.paint.get("circle-pitch-alignment"))if(d){const g=rS(u.zoom,t.canonical)*u._pixelsPerMercatorPixel;f=Float32Array.from([g,0,0,g])}else f=u.calculatePixelsToTileUnitsMatrix(n);else f=new Float32Array([u.pixelsToGLUnits[0],0,0,u.pixelsToGLUnits[1]]);const p={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(u.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ft.devicePixelRatio,u_extrude_scale:f,u_inv_rot_matrix:uS,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(d){p.u_inv_rot_matrix=i,p.u_merc_center=a,p.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],p.u_zoom_transition=ki(u.zoom);const g=a[0]*lt,_=a[1]*lt;p.u_up_dir=u.projection.upVector(new Qs(0,0,0),g,_)}return p},Tp=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function cs(e,t,n,i,a,l,u,d,f){if(l&&e.queryGeometry.isAboveHorizon)return!1;l&&(f*=e.pixelToTileUnitsFactor);const p=e.tileID.canonical,g=n.projection.upVectorScale(p,n.center.lat,n.worldSize).metersToTile;for(const _ of t)for(const v of _){const x=v.add(d),b=a&&n.elevation?n.elevation.exaggeration()*a.getElevationAt(x.x,x.y,!0):0,E=n.projection.projectTilePoint(x.x,x.y,p);if(b>0){const A=n.projection.upVector(p,x.x,x.y);E.x+=A[0]*g*b,E.y+=A[1]*g*b,E.z+=A[2]*g*b}const T=l?x:md(E.x,E.y,E.z,i),C=l?e.tilespaceRays.map(A=>dS(A,b)):e.queryGeometry.screenGeometry,D=vn.transformMat4([],[E.x,E.y,E.z,1],i);if(!u&&l?f*=D[3]/n.cameraToCenterDistance:u&&!l&&(f*=n.cameraToCenterDistance/D[3]),l){const A=zr((v.y/lt+p.y)/(1<<p.z));f/=n.projection.pixelsPerMeter(A,1)/xn(1,A)}if(wp(C,T,f))return!0}return!1}function md(e,t,n,i){const a=vn.transformMat4([],[e,t,n,1],i);return new tt(a[0]/a[3],a[1]/a[3])}const v_=G.fromValues(0,0,0),hS=G.fromValues(0,0,1);function dS(e,t){const n=G.create();return v_[2]=t,e.intersectsPlane(v_,hS,n),new tt(n[0],n[1])}class ix extends KE{}function Xu(e,{width:t,height:n},i,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==t*n*i)throw new RangeError("mismatched image size")}else a=new Uint8Array(t*n*i);return e.width=t,e.height=n,e.data=a,e}function eM(e,t,n){const{width:i,height:a}=t;i===e.width&&a===e.height||(ox(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,a)},n),e.width=i,e.height=a,e.data=t.data)}function ox(e,t,n,i,a,l){if(0===a.width||0===a.height)return t;if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const u=e.data,d=t.data;for(let f=0;f<a.height;f++){const p=((n.y+f)*e.width+n.x)*l,g=((i.y+f)*t.width+i.x)*l;for(let _=0;_<a.width*l;_++)d[g+_]=u[p+_]}return t}Gt(ix,"HeatmapBucket",{omit:["layers"]});class Xl{constructor(t,n){Xu(this,t,1,n)}resize(t){eM(this,new Xl(t),1)}clone(){return new Xl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,i,a,l){ox(t,n,i,a,l,1)}}class ur{constructor(t,n){Xu(this,t,4,n)}resize(t){eM(this,new ur(t),4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ur({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,i,a,l){ox(t,n,i,a,l,4)}}class Dp{constructor(t,n){this.width=t.width,this.height=t.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Gt(Xl,"AlphaImage"),Gt(ur,"RGBAImage");const fS=new nr({visibility:new Tt(J.layout_heatmap.visibility)});var nM={paint:new nr({"heatmap-radius":new te(J.paint_heatmap["heatmap-radius"]),"heatmap-weight":new te(J.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(J.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Kf(J.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(J.paint_heatmap["heatmap-opacity"])}),layout:fS};function ml(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,a=e.image||new ur({width:n,height:i}),l=(u,d,f)=>{t[e.evaluationKey]=f;const p=e.expression.evaluate(t);p&&(a.data[u+d+0]=Math.floor(255*p.r/p.a),a.data[u+d+1]=Math.floor(255*p.g/p.a),a.data[u+d+2]=Math.floor(255*p.b/p.a),a.data[u+d+3]=Math.floor(255*p.a))};if(e.clips)for(let u=0,d=0;u<i;++u,d+=4*n)for(let f=0,p=0;f<n;f++,p+=4){const g=f/(n-1),{start:_,end:v}=e.clips[u];l(d,p,_*(1-g)+v*g)}else for(let u=0,d=0;u<n;u++,d+=4)l(0,d,u/(n-1));return a}const sO=new nr({visibility:new Tt(J.layout_hillshade.visibility)});var aO={paint:new nr({"hillshade-illumination-direction":new Tt(J.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(J.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(J.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(J.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(J.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(J.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt(J.paint_hillshade["hillshade-emissive-strength"])}),layout:sO};const rM=sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:pS}=rM;var iM={exports:{}};function sx(e,t,n){n=n||2;var i,a,l,u,d,f,p,g=t&&t.length,_=g?t[0]*n:e.length,v=Sp(e,0,_,n,!0),x=[];if(!v||v.next===v.prev)return x;if(g&&(v=function(E,T,C,D){var A,P,I,R=[];for(A=0,P=T.length;A<P;A++)(I=Sp(E,T[A]*D,A<P-1?T[A+1]*D:E.length,D,!1))===I.next&&(I.steiner=!0),R.push(ux(I));for(R.sort(Ip),A=0;A<R.length;A++)C=x_(R[A],C);return C}(e,t,v,n)),e.length>80*n){i=l=e[0],a=u=e[1];for(var b=n;b<_;b+=n)(d=e[b])<i&&(i=d),(f=e[b+1])<a&&(a=f),d>l&&(l=d),f>u&&(u=f);p=0!==(p=Math.max(l-i,u-a))?32767/p:0}return Ju(v,x,n,i,a,p,0),x}function Sp(e,t,n,i,a){var l,u;if(a===sM(e,t,n,i)>0)for(l=t;l<n;l+=i)u=hx(l,e[l],e[l+1],u);else for(l=n-i;l>=t;l-=i)u=hx(l,e[l],e[l+1],u);return u&&Zc(u,u.next)&&(Op(u),u=u.next),u}function Yu(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Zc(i,i.next)&&0!==Or(i.prev,i,i.next))i=i.next;else{if(Op(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function Ju(e,t,n,i,a,l,u){if(e){!u&&l&&function(g,_,v,x){var b=g;do{0===b.z&&(b.z=Ap(b.x,b.y,_,v,x)),b.prevZ=b.prev,b.nextZ=b.next,b=b.next}while(b!==g);b.prevZ.nextZ=null,b.prevZ=null,function(E){var T,C,D,A,P,I,R,k,L=1;do{for(C=E,E=null,P=null,I=0;C;){for(I++,D=C,R=0,T=0;T<L&&(R++,D=D.nextZ);T++);for(k=L;R>0||k>0&&D;)0!==R&&(0===k||!D||C.z<=D.z)?(A=C,C=C.nextZ,R--):(A=D,D=D.nextZ,k--),P?P.nextZ=A:E=A,A.prevZ=P,P=A;C=D}P.nextZ=null,L*=2}while(I>1)}(b)}(e,i,a,l);for(var d,f,p=e;e.prev!==e.next;)if(d=e.prev,f=e.next,l?gd(e,i,a,l):ax(e))t.push(d.i/n|0),t.push(e.i/n|0),t.push(f.i/n|0),Op(e),e=f.next,p=f.next;else if((e=f)===p){u?1===u?Ju(e=lx(Yu(e),t,n),t,n,i,a,l,2):2===u&&cx(e,t,n,i,a,l):Ju(Yu(e),t,n,i,a,l,1);break}}}function ax(e){var t=e.prev,n=e,i=e.next;if(Or(t,n,i)>=0)return!1;for(var a=t.x,l=n.x,u=i.x,d=t.y,f=n.y,p=i.y,g=a<l?a<u?a:u:l<u?l:u,_=d<f?d<p?d:p:f<p?f:p,v=a>l?a>u?a:u:l>u?l:u,x=d>f?d>p?d:p:f>p?f:p,b=i.next;b!==t;){if(b.x>=g&&b.x<=v&&b.y>=_&&b.y<=x&&Yl(a,d,l,f,u,p,b.x,b.y)&&Or(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function gd(e,t,n,i){var a=e.prev,l=e,u=e.next;if(Or(a,l,u)>=0)return!1;for(var d=a.x,f=l.x,p=u.x,g=a.y,_=l.y,v=u.y,x=d<f?d<p?d:p:f<p?f:p,b=g<_?g<v?g:v:_<v?_:v,E=d>f?d>p?d:p:f>p?f:p,T=g>_?g>v?g:v:_>v?_:v,C=Ap(x,b,t,n,i),D=Ap(E,T,t,n,i),A=e.prevZ,P=e.nextZ;A&&A.z>=C&&P&&P.z<=D;){if(A.x>=x&&A.x<=E&&A.y>=b&&A.y<=T&&A!==a&&A!==u&&Yl(d,g,f,_,p,v,A.x,A.y)&&Or(A.prev,A,A.next)>=0||(A=A.prevZ,P.x>=x&&P.x<=E&&P.y>=b&&P.y<=T&&P!==a&&P!==u&&Yl(d,g,f,_,p,v,P.x,P.y)&&Or(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;A&&A.z>=C;){if(A.x>=x&&A.x<=E&&A.y>=b&&A.y<=T&&A!==a&&A!==u&&Yl(d,g,f,_,p,v,A.x,A.y)&&Or(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;P&&P.z<=D;){if(P.x>=x&&P.x<=E&&P.y>=b&&P.y<=T&&P!==a&&P!==u&&Yl(d,g,f,_,p,v,P.x,P.y)&&Or(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function lx(e,t,n){var i=e;do{var a=i.prev,l=i.next.next;!Zc(a,l)&&oM(a,i,i.next,l)&&Rp(a,l)&&Rp(l,a)&&(t.push(a.i/n|0),t.push(i.i/n|0),t.push(l.i/n|0),Op(i),Op(i.next),i=e=l),i=i.next}while(i!==e);return Yu(i)}function cx(e,t,n,i,a,l){var u=e;do{for(var d=u.next.next;d!==u.prev;){if(u.i!==d.i&&lO(u,d)){var f=w_(u,d);return u=Yu(u,u.next),f=Yu(f,f.next),Ju(u,t,n,i,a,l,0),void Ju(f,t,n,i,a,l,0)}d=d.next}u=u.next}while(u!==e)}function Ip(e,t){return e.x-t.x}function x_(e,t){var n=function(a,l){var u,d=l,f=a.x,p=a.y,g=-1/0;do{if(p<=d.y&&p>=d.next.y&&d.next.y!==d.y){var _=d.x+(p-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(_<=f&&_>g&&(g=_,u=d.x<d.next.x?d:d.next,_===f))return u}d=d.next}while(d!==l);if(!u)return null;var v,x=u,b=u.x,E=u.y,T=1/0;d=u;do{f>=d.x&&d.x>=b&&f!==d.x&&Yl(p<E?f:g,p,b,E,p<E?g:f,p,d.x,d.y)&&(v=Math.abs(p-d.y)/(f-d.x),Rp(d,a)&&(v<T||v===T&&(d.x>u.x||d.x===u.x&&_d(u,d)))&&(u=d,T=v)),d=d.next}while(d!==x);return u}(e,t);if(!n)return t;var i=w_(n,e);return Yu(i,i.next),Yu(n,n.next)}function _d(e,t){return Or(e.prev,e,t.prev)<0&&Or(t.next,e,e.next)<0}function Ap(e,t,n,i,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ux(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Yl(e,t,n,i,a,l,u,d){return(a-u)*(t-d)>=(e-u)*(l-d)&&(e-u)*(i-d)>=(n-u)*(t-d)&&(n-u)*(l-d)>=(a-u)*(i-d)}function lO(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(n,i){var a=n;do{if(a.i!==n.i&&a.next.i!==n.i&&a.i!==i.i&&a.next.i!==i.i&&oM(a,a.next,n,i))return!0;a=a.next}while(a!==n);return!1}(e,t)&&(Rp(e,t)&&Rp(t,e)&&function(n,i){var a=n,l=!1,u=(n.x+i.x)/2,d=(n.y+i.y)/2;do{a.y>d!=a.next.y>d&&a.next.y!==a.y&&u<(a.next.x-a.x)*(d-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next}while(a!==n);return l}(e,t)&&(Or(e.prev,e,t.prev)||Or(e,t.prev,t))||Zc(e,t)&&Or(e.prev,e,e.next)>0&&Or(t.prev,t,t.next)>0)}function Or(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Zc(e,t){return e.x===t.x&&e.y===t.y}function oM(e,t,n,i){var a=b_(Or(e,t,n)),l=b_(Or(e,t,i)),u=b_(Or(n,i,e)),d=b_(Or(n,i,t));return a!==l&&u!==d||!(0!==a||!Pp(e,n,t))||!(0!==l||!Pp(e,i,t))||!(0!==u||!Pp(n,e,i))||!(0!==d||!Pp(n,t,i))}function Pp(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function b_(e){return e>0?1:e<0?-1:0}function Rp(e,t){return Or(e.prev,e,e.next)<0?Or(e,t,e.next)>=0&&Or(e,e.prev,t)>=0:Or(e,t,e.prev)<0||Or(e,e.next,t)<0}function w_(e,t){var n=new dx(e.i,e.x,e.y),i=new dx(t.i,t.x,t.y),a=e.next,l=t.prev;return e.next=t,t.prev=e,n.next=a,a.prev=n,i.next=n,n.prev=i,l.next=i,i.prev=l,i}function hx(e,t,n,i){var a=new dx(e,t,n);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function Op(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function dx(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sM(e,t,n,i){for(var a=0,l=t,u=n-i;l<n;l+=i)a+=(e[u]-e[l])*(e[l+1]+e[u+1]),u=l;return a}iM.exports=sx,iM.exports.default=sx,sx.deviation=function(e,t,n,i){var a=t&&t.length,l=Math.abs(sM(e,0,a?t[0]*n:e.length,n));if(a)for(var u=0,d=t.length;u<d;u++)l-=Math.abs(sM(e,t[u]*n,u<d-1?t[u+1]*n:e.length,n));var f=0;for(u=0;u<i.length;u+=3){var p=i[u]*n,g=i[u+1]*n,_=i[u+2]*n;f+=Math.abs((e[p]-e[_])*(e[g+1]-e[p+1])-(e[p]-e[g])*(e[_+1]-e[p+1]))}return 0===l&&0===f?0:Math.abs((f-l)/l)},sx.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,a=0;a<e.length;a++){for(var l=0;l<e[a].length;l++)for(var u=0;u<t;u++)n.vertices.push(e[a][l][u]);a>0&&n.holes.push(i+=e[a-1].length)}return n};var E_=Zo(iM.exports);function yd(e,t){const n=e.length;if(n<=1)return[e];const i=[];let a,l;for(let u=0;u<n;u++){const d=Et(e[u]);0!==d&&(e[u].area=Math.abs(d),void 0===l&&(l=d<0),l===d<0?(a&&i.push(a),a=[e[u]]):a.push(e[u]))}if(a&&i.push(a),t>1)for(let u=0;u<i.length;u++)i[u].length<=t||(c2(i[u],t,1,i[u].length-1,fx),i[u]=i[u].slice(0,t));return i}function fx(e,t){return t.area-e.area}function px(e,t,n){const i=n.patternDependencies;let a=!1;for(const l of t){const u=l.paint.get(`${e}-pattern`);u.isConstant()||(a=!0);const d=u.constantOr(null);d&&(a=!0,i[d]=!0)}return a}function M_(e,t,n,i,a){const l=a.patternDependencies;for(const u of t){const d=u.paint.get(`${e}-pattern`).value;if("constant"!==d.kind){let f=d.evaluate({zoom:i},n,{},a.availableImages);f=f&&f.name?f.name:f,l[f]=!0,n.patterns[u.id]=f}}return n}class vd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new wo,this.indexArray=new Rr,this.indexArray2=new ba,this.programConfigurations=new Fu(t.layers,t.zoom),this.segments=new bn,this.segments2=new bn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=t.projection}populate(t,n,i,a){this.hasPattern=px("fill",this.layers,n);const l=this.layers[0].layout.get("fill-sort-key"),u=[];for(const{feature:d,id:f,index:p,sourceLayerIndex:g}of t){const _=this.layers[0]._featureFilter.needGeometry,v=Gc(d,_);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),v,i))continue;const x=l?l.evaluate(v,{},i,n.availableImages):void 0,b={id:f,properties:d.properties,type:d.type,sourceLayerIndex:g,index:p,geometry:_?v.geometry:pl(d,i,a),patterns:{},sortKey:x};u.push(b)}l&&u.sort((d,f)=>d.sortKey-f.sortKey);for(const d of u){const{geometry:f,index:p,sourceLayerIndex:g}=d;if(this.hasPattern){const _=M_("fill",this.layers,d,this.zoom,n);this.patternFeatures.push(_)}else this.addFeature(d,f,p,i,{},n.availableImages,n.brightness);n.featureIndex.insert(t[p].feature,f,p,g,this.index)}}update(t,n,i,a,l){const u=0!==Object.keys(t).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,u?this.stateDependentLayers:this.layers,i,a,l)}addFeatures(t,n,i,a,l,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,i,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pS),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,i,a,l,u=[],d){for(const f of yd(n,500)){let p=0;for(const E of f)p+=E.length;const g=this.segments.prepareSegment(p,this.layoutVertexArray,this.indexArray),_=g.vertexLength,v=[],x=[];for(const E of f){if(0===E.length)continue;E!==f[0]&&x.push(v.length/2);const T=this.segments2.prepareSegment(E.length,this.layoutVertexArray,this.indexArray2),C=T.vertexLength;this.layoutVertexArray.emplaceBack(E[0].x,E[0].y),this.indexArray2.emplaceBack(C+E.length-1,C),v.push(E[0].x),v.push(E[0].y);for(let D=1;D<E.length;D++)this.layoutVertexArray.emplaceBack(E[D].x,E[D].y),this.indexArray2.emplaceBack(C+D-1,C+D),v.push(E[D].x),v.push(E[D].y);T.vertexLength+=E.length,T.primitiveLength+=E.length}const b=E_(v,x);for(let E=0;E<b.length;E+=3)this.indexArray.emplaceBack(_+b[E],_+b[E+1],_+b[E+2]);g.vertexLength+=p,g.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,l,u,a,d)}}Gt(vd,"FillBucket",{omit:["layers","patternFeatures"]});const C_=new nr({"fill-sort-key":new te(J.layout_fill["fill-sort-key"]),visibility:new Tt(J.layout_fill.visibility)});var mS={paint:new nr({"fill-antialias":new Tt(J.paint_fill["fill-antialias"]),"fill-opacity":new te(J.paint_fill["fill-opacity"]),"fill-color":new te(J.paint_fill["fill-color"]),"fill-outline-color":new te(J.paint_fill["fill-outline-color"]),"fill-translate":new Tt(J.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(J.paint_fill["fill-translate-anchor"]),"fill-pattern":new te(J.paint_fill["fill-pattern"]),"fill-emissive-strength":new Tt(J.paint_fill["fill-emissive-strength"])}),layout:C_};const aM=sn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),gS=sn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),lM=sn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),cO=sn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),_S=sn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:T_}=aM;var D_={},xd=bc,us=bd;function bd(e,t,n,i,a){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=a,e.readFields(cM,this,t)}function cM(e,t,n){1==e?t.id=n.readVarint():2==e?function(i,a){for(var l=i.readVarint()+i.pos;i.pos<l;){var u=a._keys[i.readVarint()],d=a._values[i.readVarint()];a.properties[u]=d}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function Jl(e){for(var t,n,i=0,a=0,l=e.length,u=l-1;a<l;u=a++)i+=((n=e[u]).x-(t=e[a]).x)*(t.y+n.y);return i}bd.types=["Unknown","Point","LineString","Polygon"],bd.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,a=0,l=0,u=0,d=[];e.pos<n;){if(a<=0){var f=e.readVarint();i=7&f,a=f>>3}if(a--,1===i||2===i)l+=e.readSVarint(),u+=e.readSVarint(),1===i&&(t&&d.push(t),t=[]),t.push(new xd(l,u));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&d.push(t),d},bd.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,a=0,l=0,u=1/0,d=-1/0,f=1/0,p=-1/0;e.pos<t;){if(i<=0){var g=e.readVarint();n=7&g,i=g>>3}if(i--,1===n||2===n)(a+=e.readSVarint())<u&&(u=a),a>d&&(d=a),(l+=e.readSVarint())<f&&(f=l),l>p&&(p=l);else if(7!==n)throw new Error("unknown command "+n)}return[u,f,d,p]},bd.prototype.toGeoJSON=function(e,t,n){var i,a,l=this.extent*Math.pow(2,n),u=this.extent*e,d=this.extent*t,f=this.loadGeometry(),p=bd.types[this.type];function g(x){for(var b=0;b<x.length;b++){var E=x[b];x[b]=[360*(E.x+u)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(E.y+d)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var _=[];for(i=0;i<f.length;i++)_[i]=f[i][0];g(f=_);break;case 2:for(i=0;i<f.length;i++)g(f[i]);break;case 3:for(f=function(x){var b=x.length;if(b<=1)return[x];for(var E,T,C=[],D=0;D<b;D++){var A=Jl(x[D]);0!==A&&(void 0===T&&(T=A<0),T===A<0?(E&&C.push(E),E=[x[D]]):E.push(x[D]))}return E&&C.push(E),C}(f),i=0;i<f.length;i++)for(a=0;a<f[i].length;a++)g(f[i][a])}1===f.length?f=f[0]:p="Multi"+p;var v={type:"Feature",geometry:{type:p,coordinates:f},properties:this.properties};return"id"in this&&(v.id=this.id),v};var yS=us,uM=wd;function wd(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(vS,this,t),this.length=this._features.length}function vS(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(i){for(var a=null,l=i.readVarint()+i.pos;i.pos<l;){var u=i.readVarint()>>3;a=1===u?i.readString():2===u?i.readFloat():3===u?i.readDouble():4===u?i.readVarint64():5===u?i.readVarint():6===u?i.readSVarint():7===u?i.readBoolean():null}return a}(n))}wd.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new yS(this._pbf,t,this.extent,this._keys,this._values)};var mx=uM;function uO(e,t,n){if(3===e){var i=new mx(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}var kp=D_.VectorTile=function(e,t){this.layers=e.readFields(uO,{},t)},Lp=D_.VectorTileFeature=us;function S_(e,t,n,i){const a=[],l=0===i?(u,d,f,p,g,_)=>{u.push(new tt(_,f+(_-d)/(p-d)*(g-f)))}:(u,d,f,p,g,_)=>{u.push(new tt(d+(_-f)/(g-f)*(p-d),_))};for(const u of e){const d=[];for(const f of u){if(f.length<=2)continue;const p=[];for(let v=0;v<f.length-1;v++){const x=f[v].x,b=f[v].y,E=f[v+1].x,T=f[v+1].y,C=0===i?x:b,D=0===i?E:T;C<t?D>t&&l(p,x,b,E,T,t):C>n?D<n&&l(p,x,b,E,T,n):p.push(f[v]),D<t&&C>=t&&l(p,x,b,E,T,t),D>n&&C<=n&&l(p,x,b,E,T,n)}let g=f[f.length-1];const _=0===i?g.x:g.y;_>=t&&_<=n&&p.push(g),p.length&&(g=p[p.length-1],p[0].x===g.x&&p[0].y===g.y||p.push(p[0]),d.push(p))}d.length&&a.push(d)}return a}D_.VectorTileLayer=uM;class hM{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const i=t[n];this._stringToNumber[i]=n,this._numberToString[n]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var dM={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(e,t,n,i,a){var l,u,d=8*a-i-1,f=(1<<d)-1,p=f>>1,g=-7,_=n?a-1:0,v=n?-1:1,x=e[t+_];for(_+=v,l=x&(1<<-g)-1,x>>=-g,g+=d;g>0;l=256*l+e[t+_],_+=v,g-=8);for(u=l&(1<<-g)-1,l>>=-g,g+=i;g>0;u=256*u+e[t+_],_+=v,g-=8);if(0===l)l=1-p;else{if(l===f)return u?NaN:1/0*(x?-1:1);u+=Math.pow(2,i),l-=p}return(x?-1:1)*u*Math.pow(2,l-i)},write:function(e,t,n,i,a,l){var u,d,f,p=8*l-a-1,g=(1<<p)-1,_=g>>1,v=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,x=i?0:l-1,b=i?1:-1,E=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(d=isNaN(t)?1:0,u=g):(u=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-u))<1&&(u--,f*=2),(t+=u+_>=1?v/f:v*Math.pow(2,1-_))*f>=2&&(u++,f/=2),u+_>=g?(d=0,u=g):u+_>=1?(d=(t*f-1)*Math.pow(2,a),u+=_):(d=t*Math.pow(2,_-1)*Math.pow(2,a),u=0));a>=8;e[n+x]=255&d,x+=b,d/=256,a-=8);for(u=u<<a|d,p+=a;p>0;e[n+x]=255&u,x+=b,u/=256,p-=8);e[n+x-b]|=128*E}},fM=Yn,Fp=dM;function Yn(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Yn.Varint=0,Yn.Fixed64=1,Yn.Bytes=2,Yn.Fixed32=5;var gx=4294967296,xS=1/gx,_x=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gl(e){return e.type===Yn.Bytes?e.readVarint()+e.pos:e.pos+1}function yx(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var a=n.pos-1;a>=e;a--)n.buf[a+i]=n.buf[a]}function hO(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function vx(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function Kl(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function xx(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function bS(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function dO(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function wS(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function bx(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function si(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Np(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Ed(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function ES(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Yn.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),a=i>>3,l=this.pos;this.type=7&i,e(a,t,this),this.pos===l&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Np(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=ES(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Np(this.buf,this.pos)+Np(this.buf,this.pos+4)*gx;return this.pos+=8,e},readSFixed64:function(){var e=Np(this.buf,this.pos)+ES(this.buf,this.pos+4)*gx;return this.pos+=8,e},readFloat:function(){var e=Fp.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Fp.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(a,l,u){var d,f,p=u.buf;if(d=(112&(f=p[u.pos++]))>>4,f<128||(d|=(127&(f=p[u.pos++]))<<3,f<128)||(d|=(127&(f=p[u.pos++]))<<10,f<128)||(d|=(127&(f=p[u.pos++]))<<17,f<128)||(d|=(127&(f=p[u.pos++]))<<24,f<128)||(d|=(1&(f=p[u.pos++]))<<31,f<128))return function qi(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}(a,d,l);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&_x?_x.decode(this.buf.subarray(t,e)):function(n,i,a){for(var l="",u=i;u<a;){var d,f,p,g=n[u],_=null,v=g>239?4:g>223?3:g>191?2:1;if(u+v>a)break;1===v?g<128&&(_=g):2===v?128==(192&(d=n[u+1]))&&(_=(31&g)<<6|63&d)<=127&&(_=null):3===v?(f=n[u+2],128==(192&(d=n[u+1]))&&128==(192&f)&&((_=(15&g)<<12|(63&d)<<6|63&f)<=2047||_>=55296&&_<=57343)&&(_=null)):4===v&&(f=n[u+2],p=n[u+3],128==(192&(d=n[u+1]))&&128==(192&f)&&128==(192&p)&&((_=(15&g)<<18|(63&d)<<12|(63&f)<<6|63&p)<=65535||_>=1114112)&&(_=null)),null===_?(_=65533,v=1):_>65535&&(_-=65536,l+=String.fromCharCode(_>>>10&1023|55296),_=56320|1023&_),l+=String.fromCharCode(_),u+=v}return l}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Yn.Bytes)return e.push(this.readVarint(t));var n=gl(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Yn.Bytes)return e.push(this.readSVarint());var t=gl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Yn.Bytes)return e.push(this.readBoolean());var t=gl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Yn.Bytes)return e.push(this.readFloat());var t=gl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Yn.Bytes)return e.push(this.readDouble());var t=gl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Yn.Bytes)return e.push(this.readFixed32());var t=gl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Yn.Bytes)return e.push(this.readSFixed32());var t=gl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Yn.Bytes)return e.push(this.readFixed64());var t=gl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Yn.Bytes)return e.push(this.readSFixed64());var t=gl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Yn.Varint)for(;this.buf[this.pos++]>127;);else if(t===Yn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Yn.Fixed32)this.pos+=4;else{if(t!==Yn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Ed(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Ed(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Ed(this.buf,-1&e,this.pos),Ed(this.buf,Math.floor(e*xS),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Ed(this.buf,-1&e,this.pos),Ed(this.buf,Math.floor(e*xS),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,n){var i,a,l,d;if(t>=0?(i=t%4294967296|0,a=t/4294967296|0):(a=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,a=a+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),l=i,(d=n).buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,d.buf[d.pos]=127&(l>>>=7),function(l,u){var d=(7&l)<<4;u.buf[u.pos++]|=d|((l>>>=3)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l)))))}(a,n)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(i,a,l){for(var u,d,f=0;f<a.length;f++){if((u=a.charCodeAt(f))>55295&&u<57344){if(!d){u>56319||f+1===a.length?(i[l++]=239,i[l++]=191,i[l++]=189):d=u;continue}if(u<56320){i[l++]=239,i[l++]=191,i[l++]=189,d=u;continue}u=d-55296<<10|u-56320|65536,d=null}else d&&(i[l++]=239,i[l++]=191,i[l++]=189,d=null);u<128?i[l++]=u:(u<2048?i[l++]=u>>6|192:(u<65536?i[l++]=u>>12|224:(i[l++]=u>>18|240,i[l++]=u>>12&63|128),i[l++]=u>>6&63|128),i[l++]=63&u|128)}return l}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&yx(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),Fp.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Fp.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&yx(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,Yn.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,hO,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,vx,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,bS,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Kl,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,xx,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,dO,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,wS,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,bx,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,si,t)},writeBytesField:function(e,t){this.writeTag(e,Yn.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Yn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Yn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Yn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Yn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Yn.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Yn.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Yn.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Yn.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Yn.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var hr=Zo(fM);const MS=["tile","layer","source","sourceLayer","state"];class I_{constructor(t,n,i,a,l){this.type="Feature",this._vectorTileFeature=t,this._z=n,this._x=i,this._y=a,this.properties=t.properties,this.id=l}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const n of MS)void 0!==this[n]&&(t[n]=this[n]);return t}}class CS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,i){const a=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][a]=this.stateChanges[t][a]||{},qt(this.stateChanges[t][a],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const l in this.state[t])l!==a&&(this.deletedStates[t][l]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][a]){this.deletedStates[t][a]={};for(const l in this.state[t][a])i[l]||(this.deletedStates[t][a][l]=null)}else for(const l in i)this.deletedStates[t]&&this.deletedStates[t][a]&&null===this.deletedStates[t][a][l]&&delete this.deletedStates[t][a][l]}removeFeatureState(t,n,i){if(null===this.deletedStates[t])return;const a=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==n)null!==this.deletedStates[t][a]&&(this.deletedStates[t][a]=this.deletedStates[t][a]||{},this.deletedStates[t][a][i]=null);else if(void 0!==n)if(this.stateChanges[t]&&this.stateChanges[t][a])for(i in this.deletedStates[t][a]={},this.stateChanges[t][a])this.deletedStates[t][a][i]=null;else this.deletedStates[t][a]=null;else this.deletedStates[t]=null}getState(t,n){const i=String(n),a=qt({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const l=this.deletedStates[t][n];if(null===l)return{};for(const u in l)delete a[u]}return a}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const i={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const l={};for(const u in this.stateChanges[a])this.state[a][u]||(this.state[a][u]={}),qt(this.state[a][u],this.stateChanges[a][u]),l[u]=this.state[a][u];i[a]=l}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const l={};if(null===this.deletedStates[a])for(const u in this.state[a])l[u]={},this.state[a][u]={};else for(const u in this.deletedStates[a]){if(null===this.deletedStates[a][u])this.state[a][u]={};else if(this.state[a][u])for(const d of Object.keys(this.deletedStates[a][u]))delete this.state[a][u][d];l[u]=this.state[a][u]}i[a]=i[a]||{},qt(i[a],l)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const a in t)t[a].setFeatureState(i,n)}}class pM{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,n){const i=this.toIdx(t,n);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,n){return this.leaves[this.toIdx(t,n)]}toIdx(t,n){return n*this.size+t}}function A_(e,t,n,i){let a=0,l=Number.MAX_VALUE;for(let u=0;u<3;u++)if(Math.abs(i[u])<1e-15){if(n[u]<e[u]||n[u]>t[u])return null}else{const d=1/i[u];let f=(e[u]-n[u])*d,p=(t[u]-n[u])*d;if(f>p){const g=f;f=p,p=g}if(f>a&&(a=f),p<l&&(l=p),a>l)return null}return a}function wx(e,t,n,i,a,l,u,d,f,p,g){const _=i-e,v=a-t,x=l-n,b=u-e,E=d-t,T=f-n,C=g[1]*T-g[2]*E,D=g[2]*b-g[0]*T,A=g[0]*E-g[1]*b,P=_*C+v*D+x*A;if(Math.abs(P)<1e-15)return null;const I=1/P,R=p[0]-e,k=p[1]-t,L=p[2]-n,N=(R*C+k*D+L*A)*I;if(N<0||N>1)return null;const z=k*x-L*v,j=L*_-R*x,B=R*v-k*_,H=(g[0]*z+g[1]*j+g[2]*B)*I;return H<0||N+H>1?null:(b*z+E*j+T*B)*I}function Ex(e,t,n){return(e-t)/(n-t)}function mM(e,t,n,i,a,l,u,d,f){const p=1<<n,g=l-i,_=u-a,v=(e+1)/p*g+i,x=(t+0)/p*_+a,b=(t+1)/p*_+a;d[0]=(e+0)/p*g+i,d[1]=x,f[0]=v,f[1]=b}class Mx{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(l){const u=Math.ceil(Math.log2(l.dim/8)),d=[];let f=Math.ceil(Math.pow(2,u));const p=1/f,g=(x,b,E,T,C)=>{const D=T?1:0,A=(x+1)*E-D,P=b*E,I=(b+1)*E-D;C[0]=x*E,C[1]=P,C[2]=A,C[3]=I};let _=new pM(f);const v=[];for(let x=0;x<f*f;x++){g(x%f,Math.floor(x/f),p,!1,v);const b=Wc(v[0],v[1],l),E=Wc(v[2],v[1],l),T=Wc(v[2],v[3],l),C=Wc(v[0],v[3],l);_.minimums.push(Math.min(b,E,T,C)),_.maximums.push(Math.max(b,E,T,C)),_.leaves.push(1)}for(d.push(_),f/=2;f>=1;f/=2){const x=d[d.length-1];_=new pM(f);for(let b=0;b<f*f;b++){g(b%f,Math.floor(b/f),2,!0,v);const E=x.getElevation(v[0],v[1]),T=x.getElevation(v[2],v[1]),C=x.getElevation(v[2],v[3]),D=x.getElevation(v[0],v[3]),A=x.isLeaf(v[0],v[1]),P=x.isLeaf(v[2],v[1]),I=x.isLeaf(v[2],v[3]),R=x.isLeaf(v[0],v[3]),k=Math.min(E.min,T.min,C.min,D.min),L=Math.max(E.max,T.max,C.max,D.max),N=A&&P&&I&&R;_.maximums.push(L),_.minimums.push(k),_.leaves.push(L-k<=5&&N?1:0)}d.push(_)}return d}(this.dem),i=n.length-1,a=n[i];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(n,0,0,i,0)}raycastRoot(t,n,i,a,l,u,d=1){return A_([t,n,-100],[i,a,this.maximums[0]*d],l,u)}raycast(t,n,i,a,l,u,d=1){if(!this.nodeCount)return null;const f=this.raycastRoot(t,n,i,a,l,u,d);if(null==f)return null;const p=[],g=[],_=[],v=[],x=[{idx:0,t:f,nodex:0,nodey:0,depth:0}];for(;x.length>0;){const{idx:b,t:E,nodex:T,nodey:C,depth:D}=x.pop();if(this.leaves[b]){mM(T,C,D,t,n,i,a,_,v);const P=1<<D,I=(T+0)/P,R=(T+1)/P,k=(C+0)/P,L=(C+1)/P,N=Wc(I,k,this.dem)*d,z=Wc(R,k,this.dem)*d,j=Wc(R,L,this.dem)*d,B=Wc(I,L,this.dem)*d,H=wx(_[0],_[1],N,v[0],_[1],z,v[0],v[1],j,l,u),V=wx(v[0],v[1],j,_[0],v[1],B,_[0],_[1],N,l,u),Z=Math.min(null!==H?H:Number.MAX_VALUE,null!==V?V:Number.MAX_VALUE);if(Z!==Number.MAX_VALUE)return Z;{const Q=G.scaleAndAdd([],l,u,E);if(Cx(N,z,B,j,Ex(Q[0],_[0],v[0]),Ex(Q[1],_[1],v[1]))>=Q[2])return E}continue}let A=0;for(let P=0;P<this._siblingOffset.length;P++){mM((T<<1)+this._siblingOffset[P][0],(C<<1)+this._siblingOffset[P][1],D+1,t,n,i,a,_,v),_[2]=-100,v[2]=this.maximums[this.childOffsets[b]+P]*d;const I=A_(_,v,l,u);if(null!=I){const R=I;p[P]=R;let k=!1;for(let L=0;L<A&&!k;L++)R>=p[g[L]]&&(g.splice(L,0,P),k=!0);k||(g[A]=P),A++}}for(let P=0;P<A;P++){const I=g[P];x.push({idx:this.childOffsets[b]+I,t:p[I],nodex:(T<<1)+this._siblingOffset[I][0],nodey:(C<<1)+this._siblingOffset[I][1],depth:D+1})}}return null}_addNode(t,n,i){return this.minimums.push(t),this.maximums.push(n),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,n,i,a,l){if(1===t[a].isLeaf(n,i))return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const u=a-1,d=t[u];let f=0,p=0;for(let g=0;g<this._siblingOffset.length;g++){const _=2*n+this._siblingOffset[g][0],v=2*i+this._siblingOffset[g][1],x=d.getElevation(_,v),b=d.isLeaf(_,v),E=this._addNode(x.min,x.max,b);b&&(f|=1<<g),p||(p=E)}for(let g=0;g<this._siblingOffset.length;g++)f&1<<g||this._construct(t,2*n+this._siblingOffset[g][0],2*i+this._siblingOffset[g][1],u,p+g)}}function Cx(e,t,n,i,a,l){return ue(ue(e,n,l),ue(t,i,l),a)}function Wc(e,t,n){const i=n.dim,a=Wt(e*i-.5,0,i-1),l=Wt(t*i-.5,0,i-1),u=Math.floor(a),d=Math.floor(l),f=Math.min(u+1,i-1),p=Math.min(d+1,i-1);return Cx(n.get(u,d),n.get(f,d),n.get(u,p),n.get(f,p),a-u,l-d)}const gM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function Tx(e,t,n){return(256*e*256+256*t+n)/10-1e4}function P_(e,t,n){return 256*e+t+n/256-32768}class na{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,n,i,a,l=!1){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return K(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const u=this.dim=n.height-2,d=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=i||"mapbox",this.borderReady=l,this._modifiedForSources={},!l){for(let f=0;f<u;f++)d[this._idx(-1,f)]=d[this._idx(0,f)],d[this._idx(u,f)]=d[this._idx(u-1,f)],d[this._idx(f,-1)]=d[this._idx(f,0)],d[this._idx(f,u)]=d[this._idx(f,u-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(u,-1)]=d[this._idx(u-1,0)],d[this._idx(-1,u)]=d[this._idx(0,u-1)],d[this._idx(u,u)]=d[this._idx(u-1,u-1)]}if(a){const f=new Float32Array(n.data.buffer),p="terrarium"===this.encoding?P_:Tx;for(let g=0;g<d.length;++g){const _=4*g;f[g]=p(this.pixels[_],this.pixels[_+1],this.pixels[_+2])}this.encoding="float"}this._timestamp=Ft.now()}_buildQuadTree(){this._tree=new Mx(this)}get(t,n,i=!1){i&&(t=Wt(t,-1,this.dim),n=Wt(n,-1,this.dim));const a=this._idx(t,n);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[a];const l=4*a;return("terrarium"===this.encoding?P_:Tx)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}set(t,n,i){const a=this._idx(t,n);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const f=this.floatView[a];return this.floatView[a]=i,i-f}const l=4*a,u=("terrarium"===this.encoding?P_:Tx)(this.pixels[l],this.pixels[l+1],this.pixels[l+2]),d=na.pack(i,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[l]=d[0],this.pixels[l+1]=d[1],this.pixels[l+2]=d[2],i-u}static getUnpackVector(t){return gM[t]}get unpackVector(){return gM[this.encoding]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}static pack(t,n){const i=[0,0,0,0],a=na.getUnpackVector(n);let l=Math.floor((t+a[3])/a[2]);return i[2]=l%256,l=Math.floor(l/256),i[1]=l%256,l=Math.floor(l/256),i[0]=l,i}getPixels(){return"float"===this.encoding?new Dp({width:this.stride,height:this.stride},this.pixels):new ur({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,n,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let a=n*this.dim,l=n*this.dim+this.dim,u=i*this.dim,d=i*this.dim+this.dim;switch(n){case-1:a=l-1;break;case 1:l=a+1}switch(i){case-1:u=d-1;break;case 1:d=u+1}const f=-n*this.dim,p=-i*this.dim;for(let g=u;g<d;g++)for(let _=a;_<l;_++){const v=4*this._idx(_,g),x=4*this._idx(_+f,g+p);this.pixels[v+0]=t.pixels[x+0],this.pixels[v+1]=t.pixels[x+1],this.pixels[v+2]=t.pixels[x+2],this.pixels[v+3]=t.pixels[x+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Gt(na,"DEMData"),Gt(Mx,"DemMinMaxQuadTree",{omit:["dem"]});class Ql{isDataAvailableAtPoint(t){const n=this._source();if(this.isUsingMockSource()||!n||t.y<0||t.y>1)return!1;const i=n.getSource().maxzoom,a=1<<i,l=Math.floor(t.x),u=Math.floor((t.x-l)*a),d=Math.floor(t.y*a),f=this.findDEMTileFor(new Ze(i,l,i,u,d));return!(!f||!f.dem)}getAtPointOrZero(t,n=0){return this.getAtPoint(t,n)||0}getAtPoint(t,n,i=!0){if(this.isUsingMockSource())return null;null==n&&(n=null);const a=this._source();if(!a||t.y<0||t.y>1)return n;const l=a.getSource().maxzoom,u=1<<l,d=Math.floor(t.x),f=t.x-d,p=new Ze(l,d,l,Math.floor(f*u),Math.floor(t.y*u)),g=this.findDEMTileFor(p);if(!g||!g.dem)return n;const _=g.dem,v=1<<g.tileID.canonical.z,x=(f*v-g.tileID.canonical.x)*_.dim,b=(t.y*v-g.tileID.canonical.y)*_.dim,E=Math.floor(x),T=Math.floor(b);return(i?this.exaggeration():1)*ue(ue(_.get(E,T),_.get(E,T+1),b-T),ue(_.get(E+1,T),_.get(E+1,T+1),b-T),x-E)}getAtTileOffset(t,n,i){const a=1<<t.canonical.z;return this.getAtPointOrZero(new Ge(t.wrap+(t.canonical.x+n/lt)/a,(t.canonical.y+i/lt)/a))}getAtTileOffsetFunc(t,n,i,a){return l=>{const u=this.getAtTileOffset(t,l.x,l.y),d=a.upVector(t.canonical,l.x,l.y),f=a.upVectorScale(t.canonical,n,i).metersToTile;return G.scale(d,d,u*f),d}}getForTilePoints(t,n,i,a){if(this.isUsingMockSource())return!1;const l=Da.create(this,t,a);return!!l&&(n.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(t);if(!n||!n.dem)return null;const i=n.dem.tree,a=n.tileID,l=1<<t.canonical.z-a.canonical.z;let u=t.canonical.x/l-a.canonical.x,d=t.canonical.y/l-a.canonical.y,f=0;for(let p=0;p<t.canonical.z-a.canonical.z&&!i.leaves[f];p++){u*=2,d*=2;const g=2*Math.floor(d)+Math.floor(u);f=i.childOffsets[f]+g,u%=1,d%=1}return{min:this.exaggeration()*i.minimums[f],max:this.exaggeration()*i.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,n,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}class Da{constructor(t,n,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=i}static create(t,n,i){const a=i||t.findDEMTileFor(n);if(!a||!a.dem)return;const l=a.dem,u=a.tileID,d=1<<n.canonical.z-u.canonical.z;return new Da(a,l.dim/lt/d,[(n.canonical.x/d-u.canonical.x)*l.dim,(n.canonical.y/d-u.canonical.y)*l.dim])}tileCoordToPixel(t,n){const i=n*this._scale+this._offset[1],a=Math.floor(t*this._scale+this._offset[0]),l=Math.floor(i);return new tt(a,l)}getElevationAt(t,n,i,a){const l=t*this._scale+this._offset[0],u=n*this._scale+this._offset[1],d=Math.floor(l),f=Math.floor(u),p=this._dem;return a=!!a,i?ue(ue(p.get(d,f,a),p.get(d,f+1,a),u-f),ue(p.get(d+1,f,a),p.get(d+1,f+1,a),u-f),l-d):p.get(d,f,a)}getElevationAtPixel(t,n,i){return this._dem.get(t,n,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*xn(1,t)*this._dem.stride}}class Dx{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Gh(lt,16,0),this.featureIndexArray=new h0,this.promoteId=n}insert(t,n,i,a,l,u=0){const d=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,a,l,u);const f=this.grid;for(let p=0;p<n.length;p++){const g=n[p],_=[1/0,1/0,-1/0,-1/0];for(let v=0;v<g.length;v++){const x=g[v];_[0]=Math.min(_[0],x.x),_[1]=Math.min(_[1],x.y),_[2]=Math.max(_[2],x.x),_[3]=Math.max(_[3],x.y)}_[0]<lt&&_[1]<lt&&_[2]>=0&&_[3]>=0&&f.insert(d,_[0],_[1],_[2],_[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new kp(new hr(this.rawTileData)).layers,this.sourceLayerCoder=new hM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,n,i,a){this.loadVTLayers();const l=t.params||{},u=Hv(l.filter),d=t.tileResult,f=t.transform,p=d.bufferedTilespaceBounds,g=this.grid.query(p.min.x,p.min.y,p.max.x,p.max.y,(b,E,T,C)=>cS(d.bufferedTilespaceGeometry,b,E,T,C));g.sort(yM);let _=null;f.elevation&&g.length>0&&(_=Da.create(f.elevation,this.tileID));const v={};let x;for(let b=0;b<g.length;b++){const E=g[b];if(E===x)continue;x=E;const T=this.featureIndexArray.get(E);let C=null;this.loadMatchingFeature(v,T,u,l.layers,l.availableImages,n,i,a,(D,A,P,I=0)=>(C||(C=pl(D,this.tileID.canonical,t.tileTransform)),A.queryIntersectsFeature(d,D,P,C,this.z,t.transform,t.pixelPosMatrix,_,I)))}return v}loadMatchingFeature(t,n,i,a,l,u,d,f,p){const{featureIndex:g,bucketIndex:_,sourceLayerIndex:v,layoutVertexArrayOffset:x}=n,b=this.bucketLayerIDs[_];if(a&&!function(D,A){for(let P=0;P<D.length;P++)if(A.indexOf(D[P])>=0)return!0;return!1}(a,b))return;const E=this.sourceLayerCoder.decode(v),T=this.vtLayers[E].feature(g);if(i.needGeometry){const D=Gc(T,!0);if(!i.filter(new er(this.tileID.overscaledZ),D,this.tileID.canonical))return}else if(!i.filter(new er(this.tileID.overscaledZ),T))return;const C=this.getId(T,E);for(let D=0;D<b.length;D++){const A=b[D];if(a&&a.indexOf(A)<0)continue;const P=u[A];if(!P)continue;let I={};void 0!==C&&f&&(I=f.getState(P.sourceLayer||"_geojsonTileLayer",C));const R=qt({},d[A]);R.paint=_M(R.paint,P.paint,T,I,l),R.layout=_M(R.layout,P.layout,T,I,l);const k=!p||p(T,P,I,x);if(!k)continue;const L=new I_(T,this.z,this.x,this.y,C);L.layer=R;let N=t[A];void 0===N&&(N=t[A]=[]),N.push({featureIndex:g,feature:L,intersectionZ:k})}}lookupSymbolFeatures(t,n,i,a,l,u,d,f){const p={};this.loadVTLayers();const g=Hv(l);for(const _ of t)this.loadMatchingFeature(p,{bucketIndex:i,sourceLayerIndex:a,featureIndex:_,layoutVertexArrayOffset:0},g,u,d,f,n);return p}loadFeature(t){const{featureIndex:n,sourceLayerIndex:i}=t;this.loadVTLayers();const a=this.sourceLayerCoder.decode(i),l=this.vtFeatures[a];if(l[n])return l[n];const u=this.vtLayers[a].feature(n);return l[n]=u,u}hasLayer(t){for(const n of this.bucketLayerIDs)for(const i of n)if(t===i)return!0;return!1}getId(t,n){let i=t.id;if(this.promoteId){const a="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=a&&(i=t.properties[a]),"boolean"==typeof i&&(i=Number(i))}return i}}function _M(e,t,n,i,a){return wh(e,(l,u)=>{const d=t instanceof Jf?t.get(u):null;return d&&d.evaluate?d.evaluate(n,i,a):d})}function yM(e,t){return t-e}Gt(Dx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const vM=sn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sx=sn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),zp=sn([{name:"a_projected_pos",components:4,type:"Float32"}],4);sn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const R_=sn([{name:"a_z_offset",components:1,type:"Float32"}],4),xM=sn([{name:"a_texb",components:2,type:"Uint16"}]),bM=sn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),TS=sn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);sn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wM=sn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),DS=sn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);sn([{name:"triangle",components:3,type:"Uint16"}]),sn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),sn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),sn([{type:"Float32",name:"offsetX"}]),sn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var pi=24;const ra=128;function EM(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new er(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:i,interpolationType:a}=n;let l=0;for(;l<i.length&&i[l]<=e;)l++;l=Math.max(0,l-1);let u=l;for(;u<i.length&&i[u]<e+1;)u++;u=Math.min(i.length-1,u);const d=i[l],f=i[u];return"composite"===n.kind?{kind:"composite",minZoom:d,maxZoom:f,interpolationType:a}:{kind:"camera",minZoom:d,maxZoom:f,minSize:n.evaluate(new er(d)),maxSize:n.evaluate(new er(f)),interpolationType:a}}}function Bp(e,{uSize:t,uSizeT:n},{lowerSize:i,upperSize:a}){return"source"===e.kind?i/ra:"composite"===e.kind?ue(i/ra,a/ra,n):t}function tc(e,t){let n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:a,minZoom:l,maxZoom:u}=e,d=a?Wt(_a.interpolationFactor(a,t,l,u),0,1):0;"camera"===e.kind?i=ue(e.minSize,e.maxSize,d):n=d}return{uSizeT:n,uSize:i}}var fO=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ra,evaluateSizeForFeature:Bp,evaluateSizeForZoom:tc,getSizeData:EM});function MM(e,t,n){return e.sections.forEach(i=>{i.text=function(a,l,u){const d=l.layout.get("text-transform").evaluate(u,{});return"uppercase"===d?a=a.toLocaleUpperCase():"lowercase"===d&&(a=a.toLocaleLowerCase()),es.applyArabicShaping&&(a=es.applyArabicShaping(a)),a}(i.text,t,n)}),e}const Md={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function pO(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function O_(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const k_=3;function CM(e,t,n){t.glyphs=[],1===e&&n.readMessage(SS,t)}function SS(e,t,n){if(3===e){const{id:i,bitmap:a,width:l,height:u,left:d,top:f,advance:p}=n.readMessage(TM,{});t.glyphs.push({id:i,bitmap:new Xl({width:l+2*k_,height:u+2*k_},a),metrics:{width:l,height:u,left:d,top:f,advance:p}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function TM(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const Ix=k_;function Ye(e){let t=0,n=0;for(const u of e)t+=u.w*u.h,n=Math.max(n,u.w);e.sort((u,d)=>d.h-u.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let a=0,l=0;for(const u of e)for(let d=i.length-1;d>=0;d--){const f=i[d];if(!(u.w>f.w||u.h>f.h)){if(u.x=f.x,u.y=f.y,l=Math.max(l,u.y+u.h),a=Math.max(a,u.x+u.w),u.w===f.w&&u.h===f.h){const p=i.pop();d<i.length&&(i[d]=p)}else u.h===f.h?(f.x+=u.w,f.w-=u.w):u.w===f.w?(f.y+=u.h,f.h-=u.h):(i.push({x:f.x+u.w,y:f.y,w:f.w-u.w,h:u.h}),f.y+=u.h,f.h-=u.h);break}}return{w:a,h:l,fill:t/(a*l)||0}}const Co=1;class L_{constructor(t,{pixelRatio:n,version:i,stretchX:a,stretchY:l,content:u}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=a,this.stretchY=l,this.content=u,this.version=i}get tl(){return[this.paddedRect.x+Co,this.paddedRect.y+Co]}get br(){return[this.paddedRect.x+this.paddedRect.w-Co,this.paddedRect.y+this.paddedRect.h-Co]}get displaySize(){return[(this.paddedRect.w-2*Co)/this.pixelRatio,(this.paddedRect.h-2*Co)/this.pixelRatio]}}class jt{constructor(t,n){const i={},a={};this.haveRenderCallbacks=[];const l=[];this.addImages(t,i,l),this.addImages(n,a,l);const{w:u,h:d}=Ye(l),f=new ur({width:u||1,height:d||1});for(const p in t){const g=t[p],_=i[p].paddedRect;ur.copy(g.data,f,{x:0,y:0},{x:_.x+Co,y:_.y+Co},g.data)}for(const p in n){const g=n[p],_=a[p].paddedRect,v=_.x+Co,x=_.y+Co,b=g.data.width,E=g.data.height;ur.copy(g.data,f,{x:0,y:0},{x:v,y:x},g.data),ur.copy(g.data,f,{x:0,y:E-1},{x:v,y:x-1},{width:b,height:1}),ur.copy(g.data,f,{x:0,y:0},{x:v,y:x+E},{width:b,height:1}),ur.copy(g.data,f,{x:b-1,y:0},{x:v-1,y:x},{width:1,height:E}),ur.copy(g.data,f,{x:0,y:0},{x:v+b,y:x},{width:1,height:E})}this.image=f,this.iconPositions=i,this.patternPositions=a}addImages(t,n,i){for(const a in t){const l=t[a],u={x:0,y:0,w:l.data.width+2*Co,h:l.data.height+2*Co};i.push(u),n[a]=new L_(u,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(t,n,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a,i)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const a in t.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[a],t.getImage(a,i),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a,i),n)}patchUpdatedImage(t,n,i){if(!t||!n||t.version===n.version)return;t.version=n.version;const[a,l]=t.tl;i.update(n.data,void 0,{x:a,y:l})}}Gt(L_,"ImagePosition"),Gt(jt,"ImageAtlas");const Hn={horizontal:1,vertical:2,horizontalOnly:3},DM=-17;class Xc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const i=new Xc;return i.scale=t||1,i.fontStack=n,i}static forImage(t){const n=new Xc;return n.imageName=t,n}}class Sa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const i=new Sa;for(let a=0;a<t.sections.length;a++){const l=t.sections[a];l.image?i.addImageSection(l):i.addTextSection(l,n)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(n,i){let a="";for(let l=0;l<n.length;l++){const u=n.charCodeAt(l+1)||null,d=n.charCodeAt(l-1)||null;a+=!i&&(u&&Au(u)&&!Md[n[l+1]]||d&&Au(d)&&!Md[n[l-1]])||!Md[n[l]]?n[l]:Md[n[l]]}return a}(this.text,t)}trim(){let t=0;for(let i=0;i<this.text.length&&Yc[this.text.charCodeAt(i)];i++)t++;let n=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&Yc[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const i=new Sa;return i.text=this.text.substring(t,n),i.sectionIndex=this.sectionIndex.slice(t,n),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Xc.forText(t.scale,t.fontStack||n));const i=this.sections.length-1;for(let a=0;a<t.text.length;++a)this.sectionIndex.push(i)}addImageSection(t){const n=t.image?t.image.namePrimary:"";if(0===n.length)return void K("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(Xc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):K("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vp(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b){const E=Sa.fromFeature(e,a);_===Hn.vertical&&E.verticalizePunctuation(v);let T=[];const C=function(R,k,L,N,z,j){if(!R)return[];const B=[],H=function(et,W,X,rt,ot,ct){let dt=0;for(let gt=0;gt<et.length();gt++){const at=et.getSection(gt);dt+=F_(et.getCodePoint(gt),at,rt,ot,W,ct)}return dt/Math.max(1,Math.ceil(dt/X))}(R,k,L,N,z,j),V=R.text.indexOf("\u200b")>=0;let Z=0;for(let et=0;et<R.length();et++){const W=R.getSection(et),X=R.getCodePoint(et);if(Yc[X]||(Z+=F_(X,W,N,z,k,j)),et<R.length()-1){const rt=!((Q=X)<11904||!(Jt["Bopomofo Extended"](Q)||Jt.Bopomofo(Q)||Jt["CJK Compatibility Forms"](Q)||Jt["CJK Compatibility Ideographs"](Q)||Jt["CJK Compatibility"](Q)||Jt["CJK Radicals Supplement"](Q)||Jt["CJK Strokes"](Q)||Jt["CJK Symbols and Punctuation"](Q)||Jt["CJK Unified Ideographs Extension A"](Q)||Jt["CJK Unified Ideographs"](Q)||Jt["Enclosed CJK Letters and Months"](Q)||Jt["Halfwidth and Fullwidth Forms"](Q)||Jt.Hiragana(Q)||Jt["Ideographic Description Characters"](Q)||Jt["Kangxi Radicals"](Q)||Jt["Katakana Phonetic Extensions"](Q)||Jt.Katakana(Q)||Jt["Vertical Forms"](Q)||Jt["Yi Radicals"](Q)||Jt["Yi Syllables"](Q)));(SM[X]||rt||W.imageName)&&B.push(Px(et+1,Z,H,B,Ax(X,R.getCodePoint(et+1),rt&&V),!1))}}var Q;return z_(Px(R.length(),Z,H,B,0,!0))}(E,p,l,t,i,x),{processBidirectionalText:D,processStyledBidirectionalText:A}=es;if(D&&1===E.sections.length){const R=D(E.toString(),C);for(const k of R){const L=new Sa;L.text=k,L.sections=E.sections;for(let N=0;N<k.length;N++)L.sectionIndex.push(0);T.push(L)}}else if(A){const R=A(E.text,E.sectionIndex,C);for(const k of R){const L=new Sa;L.text=k[0],L.sectionIndex=k[1],L.sections=E.sections,T.push(L)}}else T=function(R,k){const L=[],N=R.text;let z=0;for(const j of k)L.push(R.substring(z,j)),z=j;return z<N.length&&L.push(R.substring(z,N.length)),L}(E,C);const P=[],I={positionedLines:P,text:E.toString(),top:g[1],bottom:g[1],left:g[0],right:g[0],writingMode:_,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(R,k,L,N,z,j,B,H,V,Z,Q,et){let W=0,X=0,rt=0;const ot="right"===H?1:"left"===H?0:.5;let ct=!1;for(const Nt of z){const zt=Nt.getSections();for(const Vt of zt){if(Vt.imageName)continue;const Kt=k[Vt.fontStack];if(Kt&&(ct=void 0!==Kt.ascender&&void 0!==Kt.descender,!ct))break}if(!ct)break}let dt=0;for(const Nt of z){Nt.trim();const zt=Nt.getMaxScale(),Vt=(zt-1)*pi,Kt={positionedGlyphs:[],lineOffset:0};R.positionedLines[dt]=Kt;const he=Kt.positionedGlyphs;let Oe=0;if(!Nt.length()){X+=j,++dt;continue}let Xe=0,Ce=0;for(let ce=0;ce<Nt.length();ce++){const ie=Nt.getSection(ce),Ne=Nt.getSectionIndex(ce),Ke=Nt.getCodePoint(ce);let Re=ie.scale,Sn=null,or=null,Gn=null,kn=pi,Vr=0;const Kn=!(V===Hn.horizontal||!Q&&!Rg(Ke)||Q&&(Yc[Ke]||(gt=Ke,Jt.Arabic(gt)||Jt["Arabic Supplement"](gt)||Jt["Arabic Extended-A"](gt)||Jt["Arabic Presentation Forms-A"](gt)||Jt["Arabic Presentation Forms-B"](gt))));if(ie.imageName){const qn=N[ie.imageName];if(!qn)continue;Gn=ie.imageName,R.iconsInText=R.iconsInText||!0,or=qn.paddedRect;const Cn=qn.displaySize;Re=Re*pi/et,Sn={width:Cn[0],height:Cn[1],left:Co,top:-Ix,advance:Kn?Cn[1]:Cn[0],localGlyph:!1},Vr=ct?-Sn.height*Re:DM+zt*pi-Cn[1]*Re,kn=Sn.advance;const So=(Kn?Cn[0]:Cn[1])*Re-pi*zt;So>0&&So>Oe&&(Oe=So)}else{const qn=L[ie.fontStack];if(!qn)continue;qn[Ke]&&(or=qn[Ke]);const Cn=k[ie.fontStack];if(!Cn)continue;const So=Cn.glyphs[Ke];if(!So)continue;if(Sn=So.metrics,kn=8203!==Ke?pi:0,ct){const Ba=void 0!==Cn.ascender?Math.abs(Cn.ascender):0,$o=void 0!==Cn.descender?Math.abs(Cn.descender):0,wl=(Ba+$o)*Re;Xe<wl&&(Xe=wl,Ce=(Ba-$o)/2*Re),Vr=-Ba*Re}else Vr=DM+(zt-Re)*pi}Kn?(R.verticalizable=!0,he.push({glyph:Ke,imageName:Gn,x:W,y:X+Vr,vertical:Kn,scale:Re,localGlyph:Sn.localGlyph,fontStack:ie.fontStack,sectionIndex:Ne,metrics:Sn,rect:or}),W+=kn*Re+Z):(he.push({glyph:Ke,imageName:Gn,x:W,y:X+Vr,vertical:Kn,scale:Re,localGlyph:Sn.localGlyph,fontStack:ie.fontStack,sectionIndex:Ne,metrics:Sn,rect:or}),W+=Sn.advance*Re+Z)}0!==he.length&&(rt=Math.max(W-Z,rt),ct?IM(he,ot,Oe,Ce,j*zt/2):IM(he,ot,Oe,0,j/2)),W=0;const xe=j*zt+Oe;Kt.lineOffset=Math.max(Oe,Vt),X+=xe,++dt}var gt;const at=X,{horizontalAlign:ut,verticalAlign:St}=B_(B);(function(Nt,zt,Vt,Kt,he,Oe){const Xe=(zt-Vt)*he,Ce=-Oe*Kt;for(const xe of Nt)for(const ce of xe.positionedGlyphs)ce.x+=Xe,ce.y+=Ce})(R.positionedLines,ot,ut,St,rt,at),R.top+=-St*at,R.bottom=R.top+at,R.left+=-ut*rt,R.right=R.left+rt,R.hasBaseline=ct}(I,t,n,i,T,u,d,f,_,p,v,b),!function(R){for(const k of R)if(0!==k.positionedGlyphs.length)return!1;return!0}(P)&&I}const Yc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},SM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function F_(e,t,n,i,a,l){if(t.imageName){const u=i[t.imageName];return u?u.displaySize[0]*t.scale*pi/l+a:0}{const u=n[t.fontStack],d=u&&u.glyphs[e];return d?d.metrics.advance*t.scale+a:0}}function N_(e,t,n,i){const a=Math.pow(e-t,2);return i?e<t?a/2:2*a:a+Math.abs(n)*n}function Ax(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Px(e,t,n,i,a,l){let u=null,d=N_(t,n,a,l);for(const f of i){const p=N_(t-f.x,n,a,l)+f.badness;p<=d&&(u=f,d=p)}return{index:e,x:t,priorBreak:u,badness:d}}function z_(e){return e?z_(e.priorBreak).concat(e.index):[]}function B_(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function IM(e,t,n,i,a){if(!(t||n||i||a))return;const l=e.length-1,u=e[l],d=(u.x+u.metrics.advance*u.scale)*t;for(let f=0;f<=l;f++)e[f].x-=d,e[f].y+=n+i+a}function IS(e,t,n,i){const{horizontalAlign:a,verticalAlign:l}=B_(i),u=n[0]-e.displaySize[0]*a,d=n[1]-e.displaySize[1]*l;return{imagePrimary:e,imageSecondary:t,top:d,bottom:d+e.displaySize[1],left:u,right:u+e.displaySize[0]}}function Rx(e,t,n,i,a,l){const u=e.imagePrimary;let d;if(u.content){const T=u.content,C=u.pixelRatio||1;d=[T[0]/C,T[1]/C,u.displaySize[0]-T[2]/C,u.displaySize[1]-T[3]/C]}const f=t.left*l,p=t.right*l;let g,_,v,x;"width"===n||"both"===n?(x=a[0]+f-i[3],_=a[0]+p+i[1]):(x=a[0]+(f+p-u.displaySize[0])/2,_=x+u.displaySize[0]);const b=t.top*l,E=t.bottom*l;return"height"===n||"both"===n?(g=a[1]+b-i[0],v=a[1]+E+i[2]):(g=a[1]+(b+E-u.displaySize[1])/2,v=g+u.displaySize[1]),{imagePrimary:u,imageSecondary:void 0,top:g,right:_,bottom:v,left:x,collisionPadding:d}}class ec extends tt{constructor(t,n,i,a,l){super(t,n),this.angle=a,this.z=i,void 0!==l&&(this.segment=l)}clone(){return new ec(this.x,this.y,this.z,this.angle,this.segment)}}function AM(e,t,n,i,a){if(void 0===t.segment)return!0;let l=t,u=t.segment+1,d=0;for(;d>-n/2;){if(u--,u<0)return!1;d-=e[u].dist(l),l=e[u]}d+=e[u].dist(e[u+1]),u++;const f=[];let p=0;for(;d<n/2;){const g=e[u],_=e[u+1];if(!_)return!1;let v=e[u-1].angleTo(g)-g.angleTo(_);for(v=Math.abs((v+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:d,angleDelta:v}),p+=v;d-f[0].distance>i;)p-=f.shift().angleDelta;if(p>a)return!1;u++,d+=g.dist(_)}return!0}function PM(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function RM(e,t,n){return e?.6*t*n:0}function Ox(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function OM(e,t,n,i,a,l){const u=RM(n,a,l),d=Ox(n,i)*l;let f=0;const p=PM(e)/2;for(let g=0;g<e.length-1;g++){const _=e[g],v=e[g+1],x=_.dist(v);if(f+x>p){const b=(p-f)/x,E=ue(_.x,v.x,b),T=ue(_.y,v.y,b),C=new ec(E,T,0,v.angleTo(_),g);return!u||AM(e,C,d,u,t)?C:void 0}f+=x}}function AS(e,t,n,i,a,l,u,d,f){const p=RM(i,l,u),g=Ox(i,a),_=g*u,v=0===e[0].x||e[0].x===f||0===e[0].y||e[0].y===f;return t-_<t/4&&(t=_+t/4),kM(e,v?t/2*d%t:(g/2+2*l)*u*d%t,t,p,n,_,v,!1,f)}function kM(e,t,n,i,a,l,u,d,f){const p=l/2,g=PM(e);let _=0,v=t-n,x=[];for(let b=0;b<e.length-1;b++){const E=e[b],T=e[b+1],C=E.dist(T),D=T.angleTo(E);for(;v+n<_+C;){v+=n;const A=(v-_)/C,P=ue(E.x,T.x,A),I=ue(E.y,T.y,A);if(P>=0&&P<f&&I>=0&&I<f&&v-p>=0&&v+p<=g){const R=new ec(P,I,0,D,b);i&&!AM(e,R,l,i,a)||x.push(R)}}_+=C}return d||x.length||u||(x=kM(e,_/2,n,i,a,l,u,!0,f)),x}function hs(e,t,n,i,a){const l=[];for(let u=0;u<e.length;u++){const d=e[u];let f;for(let p=0;p<d.length-1;p++){let g=d[p],_=d[p+1];g.x<t&&_.x<t||(g.x<t?g=new tt(t,g.y+(t-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x<t&&(_=new tt(t,g.y+(t-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y<n&&_.y<n||(g.y<n?g=new tt(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round():_.y<n&&(_=new tt(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round()),g.x>=i&&_.x>=i||(g.x>=i?g=new tt(i,g.y+(i-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x>=i&&(_=new tt(i,g.y+(i-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y>=a&&_.y>=a||(g.y>=a?g=new tt(g.x+(a-g.y)/(_.y-g.y)*(_.x-g.x),a)._round():_.y>=a&&(_=new tt(g.x+(a-g.y)/(_.y-g.y)*(_.x-g.x),a)._round()),f&&g.equals(f[f.length-1])||(f=[g],l.push(f)),f.push(_)))))}}return l}Gt(ec,"Anchor");const jp=1e20;function LM(e,t,n,i,a,l,u,d,f){for(let p=t;p<t+i;p++)PS(e,n*l+p,l,a,u,d,f);for(let p=n;p<n+a;p++)PS(e,p*l+t,1,i,u,d,f)}function PS(e,t,n,i,a,l,u){l[0]=0,u[0]=-jp,u[1]=jp,a[0]=e[t];for(let d=1,f=0,p=0;d<i;d++){a[d]=e[t+d*n];const g=d*d;do{const _=l[f];p=(a[d]-a[_]+g-_*_)/(d-_)/2}while(p<=u[f]&&--f>-1);f++,l[f]=d,u[f]=p,u[f+1]=jp}for(let d=0,f=0;d<i;d++){for(;u[f+1]<d;)f++;const p=l[f],g=d-p;e[t+d*n]=a[p]+g*g}}const Fs=2;class Ku{constructor(t,n,i){this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,n){this.urls[n]=t}getGlyphs(t,n,i){const a=[],l=this.urls[n]||ke.GLYPHS_URL;for(const u in t)for(const d of t[u])a.push({stack:u,id:d});xu(a,({stack:u,id:d},f)=>{let p=this.entries[u];p||(p=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=p.glyphs[d];if(void 0!==g)return void f(null,{stack:u,id:d,glyph:g});if(g=this._tinySDF(p,u,d),g)return p.glyphs[d]=g,void f(null,{stack:u,id:d,glyph:g});const _=Math.floor(d/256);if(256*_>65535)return void f(new Error("glyphs > 65535 not supported"));if(p.ranges[_])return void f(null,{stack:u,id:d,glyph:g});let v=p.requests[_];v||(v=p.requests[_]=[],Ku.loadGlyphRange(u,_,l,this.requestManager,(x,b)=>{if(b){p.ascender=b.ascender,p.descender=b.descender;for(const E in b.glyphs)this._doesCharSupportLocalGlyph(+E)||(p.glyphs[+E]=b.glyphs[+E]);p.ranges[_]=!0}for(const E of v)E(x,b);delete p.requests[_]})),v.push((x,b)=>{x?f(x):b&&f(null,{stack:u,id:d,glyph:b.glyphs[d]||null})})},(u,d)=>{if(u)i(u);else if(d){const f={};for(const{stack:p,id:g,glyph:_}of d)void 0===f[p]&&(f[p]={}),void 0===f[p].glyphs&&(f[p].glyphs={}),f[p].glyphs[g]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},f[p].ascender=this.entries[p].ascender,f[p].descender=this.entries[p].descender;i(null,f)}})}_doesCharSupportLocalGlyph(t){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(Jt["CJK Unified Ideographs"](t)||Jt["Hangul Syllables"](t)||Jt.Hiragana(t)||Jt.Katakana(t)||Jt["CJK Symbols and Punctuation"](t)||Jt["CJK Unified Ideographs Extension A"](t)||Jt["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,n,i){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(i))return;let l=t.tinySDF;if(!l){let E="400";/bold/i.test(n)?E="900":/medium/i.test(n)?E="500":/light/i.test(n)&&(E="200"),l=t.tinySDF=new Ku.TinySDF({fontFamily:a,fontWeight:E,fontSize:24*Fs,buffer:3*Fs,radius:8*Fs}),l.fontWeight=E}if(this.localGlyphs[l.fontWeight][i])return this.localGlyphs[l.fontWeight][i];const u=String.fromCodePoint(i),{data:d,width:f,height:p,glyphWidth:g,glyphHeight:_,glyphLeft:v,glyphTop:x,glyphAdvance:b}=l.draw(u);return this.localGlyphs[l.fontWeight][i]={id:i,bitmap:new Xl({width:f,height:p},d),metrics:{width:g/Fs,height:_/Fs,left:v/Fs,top:x/Fs-27,advance:b/Fs,localGlyph:!0}}}}Ku.loadGlyphRange=function(e,t,n,i,a){const l=256*t,u=l+255,d=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${l}-${u}`),ft.Glyphs);kt(d,(f,p)=>{if(f)a(f);else if(p){const g={},_=new hr(p).readFields(CM,{});for(const v of _.glyphs)g[v.id]=v;a(null,{glyphs:g,ascender:_.ascender,descender:_.descender})}})},Ku.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:u="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;const d=this.size=e+4*t,f=this._createCanvas(d),p=this.ctx=f.getContext("2d",{willReadFrequently:!0});p.font=`${u} ${l} ${e}px ${a}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(e),u=Math.ceil(n),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),f=Math.min(this.size-this.buffer,u+Math.ceil(i)),p=d+2*this.buffer,g=f+2*this.buffer,_=Math.max(p*g,0),v=new Uint8ClampedArray(_),x={data:v,width:p,height:g,glyphWidth:d,glyphHeight:f,glyphTop:u,glyphLeft:0,glyphAdvance:t};if(0===d||0===f)return x;const{ctx:b,buffer:E,gridInner:T,gridOuter:C}=this;b.clearRect(E,E,d,f),b.fillText(e,E,E+u);const D=b.getImageData(E,E,d,f);C.fill(jp,0,_),T.fill(0,0,_);for(let A=0;A<f;A++)for(let P=0;P<d;P++){const I=D.data[4*(A*d+P)+3]/255;if(0===I)continue;const R=(A+E)*p+P+E;if(1===I)C[R]=0,T[R]=jp;else{const k=.5-I;C[R]=k>0?k*k:0,T[R]=k<0?k*k:0}}LM(C,0,0,p,g,p,this.f,this.v,this.z),LM(T,E,E,d,f,p,this.f,this.v,this.z);for(let A=0;A<_;A++){const P=Math.sqrt(C[A])-Math.sqrt(T[A]);v[A]=Math.round(255-255*(P/this.radius+this.cutoff))}return x}};const Jc=Co;function FM(e,t,n,i){const a=[],l=e.imagePrimary,u=l.pixelRatio,d=l.paddedRect.w-2*Jc,f=l.paddedRect.h-2*Jc,p=e.right-e.left,g=e.bottom-e.top,_=l.stretchX||[[0,d]],v=l.stretchY||[[0,f]],x=(j,B)=>j+B[1]-B[0],b=_.reduce(x,0),E=v.reduce(x,0),T=d-b,C=f-E;let D=0,A=b,P=0,I=E,R=0,k=T,L=0,N=C;if(l.content&&i){const j=l.content;D=V_(_,0,j[0]),P=V_(v,0,j[1]),A=V_(_,j[0],j[2]),I=V_(v,j[1],j[3]),R=j[0]-D,L=j[1]-P,k=j[2]-j[0]-A,N=j[3]-j[1]-I}const z=(j,B,H,V)=>{const Z=j_(j.stretch-D,A,p,e.left),Q=U_(j.fixed-R,k,j.stretch,b),et=j_(B.stretch-P,I,g,e.top),W=U_(B.fixed-L,N,B.stretch,E),X=j_(H.stretch-D,A,p,e.left),rt=U_(H.fixed-R,k,H.stretch,b),ot=j_(V.stretch-P,I,g,e.top),ct=U_(V.fixed-L,N,V.stretch,E),dt=new tt(Z,et),gt=new tt(X,et),at=new tt(X,ot),ut=new tt(Z,ot),St=new tt(Q/u,W/u),Nt=new tt(rt/u,ct/u),zt=t*Math.PI/180;if(zt){const Ce=Math.sin(zt),xe=Math.cos(zt),ce=[xe,-Ce,Ce,xe];dt._matMult(ce),gt._matMult(ce),ut._matMult(ce),at._matMult(ce)}const Vt=j.stretch+j.fixed,Kt=H.stretch+H.fixed,he=B.stretch+B.fixed,Oe=V.stretch+V.fixed,Xe=e.imageSecondary;return{tl:dt,tr:gt,bl:ut,br:at,texPrimary:{x:l.paddedRect.x+Jc+Vt,y:l.paddedRect.y+Jc+he,w:Kt-Vt,h:Oe-he},texSecondary:Xe?{x:Xe.paddedRect.x+Jc+Vt,y:Xe.paddedRect.y+Jc+he,w:Kt-Vt,h:Oe-he}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:St,pixelOffsetBR:Nt,minFontScaleX:k/u/p,minFontScaleY:N/u/g,isSDF:n}};if(i&&(l.stretchX||l.stretchY)){const j=kx(_,T,b),B=kx(v,C,E);for(let H=0;H<j.length-1;H++){const V=j[H],Z=j[H+1];for(let Q=0;Q<B.length-1;Q++)a.push(z(V,B[Q],Z,B[Q+1]))}}else a.push(z({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:d+1},{fixed:0,stretch:f+1}));return a}function V_(e,t,n){let i=0;for(const a of e)i+=Math.max(t,Math.min(n,a[1]))-Math.max(t,Math.min(n,a[0]));return i}function kx(e,t,n){const i=[{fixed:-Jc,stretch:0}];for(const[a,l]of e){const u=i[i.length-1];i.push({fixed:a-u.stretch,stretch:u.stretch}),i.push({fixed:a-u.stretch,stretch:u.stretch+(l-a)})}return i.push({fixed:t+Jc,stretch:n}),i}function j_(e,t,n,i){return e/t*n+i}function U_(e,t,n,i){return e-t*n/i}function Lx(e,t,n,i){const a=t+e.positionedLines[i].lineOffset;return 0===i?n+a/2:n+(a+(t+e.positionedLines[i-1].lineOffset))/2}function RS(e,t=1,n=!1){let i=1/0,a=1/0,l=-1/0,u=-1/0;const d=e[0];for(let x=0;x<d.length;x++){const b=d[x];(!x||b.x<i)&&(i=b.x),(!x||b.y<a)&&(a=b.y),(!x||b.x>l)&&(l=b.x),(!x||b.y>u)&&(u=b.y)}const f=Math.min(l-i,u-a);let p=f/2;const g=new Ff([],OS);if(0===f)return new tt(i,a);for(let x=i;x<l;x+=f)for(let b=a;b<u;b+=f)g.push(new Cd(x+p,b+p,p,e));let _=function(x){let b=0,E=0,T=0;const C=x[0];for(let D=0,A=C.length,P=A-1;D<A;P=D++){const I=C[D],R=C[P],k=I.x*R.y-R.x*I.y;E+=(I.x+R.x)*k,T+=(I.y+R.y)*k,b+=3*k}return new Cd(E/b,T/b,0,x)}(e),v=g.length;for(;g.length;){const x=g.pop();(x.d>_.d||!_.d)&&(_=x,n&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,v)),x.max-_.d<=t||(p=x.h/2,g.push(new Cd(x.p.x-p,x.p.y-p,p,e)),g.push(new Cd(x.p.x+p,x.p.y-p,p,e)),g.push(new Cd(x.p.x-p,x.p.y+p,p,e)),g.push(new Cd(x.p.x+p,x.p.y+p,p,e)),v+=4)}return n&&(console.log(`num probes: ${v}`),console.log(`best distance: ${_.d}`)),_.p}function OS(e,t){return t.max-e.max}class Cd{constructor(t,n,i,a){this.p=new tt(t,n),this.h=i,this.d=function(l,u){let d=!1,f=1/0;for(let p=0;p<u.length;p++){const g=u[p];for(let _=0,v=g.length,x=v-1;_<v;x=_++){const b=g[_],E=g[x];b.y>l.y!=E.y>l.y&&l.x<(E.x-b.x)*(l.y-b.y)/(E.y-b.y)+b.x&&(d=!d),f=Math.min(f,Q0(l,b,E))}}return(d?1:-1)*Math.sqrt(f)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const Td=7,Fx=Number.POSITIVE_INFINITY,_l=Math.sqrt(2);function Up(e,[t,n]){let i=0,a=0;if(n===Fx){t<0&&(t=0);const l=t/_l;switch(e){case"top-right":case"top-left":a=l-Td;break;case"bottom-right":case"bottom-left":a=-l+Td;break;case"bottom":a=-t+Td;break;case"top":a=t-Td}switch(e){case"top-right":case"bottom-right":i=-l;break;case"top-left":case"bottom-left":i=l;break;case"left":i=t;break;case"right":i=-t}}else{switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":a=n-Td;break;case"bottom-right":case"bottom-left":case"bottom":a=-n+Td}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}}return[i,a]}function kS(e,t,n,i,a,l,u,d,f,p,g){e.createArrays(),e.tilePixelRatio=lt/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const _=e.layers[0].layout,v=e.layers[0]._unevaluatedLayout._values,x={};if("composite"===e.textSizeData.kind){const{minZoom:C,maxZoom:D}=e.textSizeData;x.compositeTextSizes=[v["text-size"].possiblyEvaluate(new er(C),d),v["text-size"].possiblyEvaluate(new er(D),d)]}if("composite"===e.iconSizeData.kind){const{minZoom:C,maxZoom:D}=e.iconSizeData;x.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new er(C),d),v["icon-size"].possiblyEvaluate(new er(D),d)]}x.layoutTextSize=v["text-size"].possiblyEvaluate(new er(f+1),d),x.layoutIconSize=v["icon-size"].possiblyEvaluate(new er(f+1),d),x.textMaxSize=v["text-size"].possiblyEvaluate(new er(18),d);const b="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement"),E=_.get("text-size");let T=!1;for(const C of e.features)if(C.icon&&C.icon.nameSecondary){T=!0;break}for(const C of e.features){const D=_.get("text-font").evaluate(C,{},d).join(","),A=E.evaluate(C,{},d),P=x.layoutTextSize.evaluate(C,{},d),I=(x.layoutIconSize.evaluate(C,{},d),{horizontal:{},vertical:void 0}),R=C.text;let k,L=[0,0];if(R){const j=R.toString(),B=_.get("text-letter-spacing").evaluate(C,{},d)*pi,H=_.get("text-line-height").evaluate(C,{},d)*pi,V=P2(j)?B:0,Z=_.get("text-anchor").evaluate(C,{},d),Q=_.get("text-variable-anchor");if(!Q){const ot=_.get("text-radial-offset").evaluate(C,{},d);L=ot?Up(Z,[ot*pi,Fx]):_.get("text-offset").evaluate(C,{},d).map(ct=>ct*pi)}let et=b?"center":_.get("text-justify").evaluate(C,{},d);const W="point"===_.get("symbol-placement"),X=W?_.get("text-max-width").evaluate(C,{},d)*pi:1/0,rt=ot=>{e.allowVerticalPlacement&&t0(j)&&(I.vertical=Vp(R,t,n,a,D,X,H,Z,ot,V,L,Hn.vertical,!0,P,A))};if(!b&&Q){const ot="auto"===et?Q.map(dt=>$_(dt)):[et];let ct=!1;for(let dt=0;dt<ot.length;dt++){const gt=ot[dt];if(!I.horizontal[gt])if(ct)I.horizontal[gt]=I.horizontal[0];else{const at=Vp(R,t,n,a,D,X,H,"center",gt,V,L,Hn.horizontal,!1,P,A);at&&(I.horizontal[gt]=at,ct=1===at.positionedLines.length)}}rt("left")}else{if("auto"===et&&(et=$_(Z)),W||_.get("text-writing-mode").indexOf("horizontal")>=0||!t0(j)){const ot=Vp(R,t,n,a,D,X,H,Z,et,V,L,Hn.horizontal,!1,P,A);ot&&(I.horizontal[et]=ot)}rt(W?"left":et)}}let N=!1;if(C.icon&&C.icon.namePrimary){const j=i[C.icon.namePrimary];j&&(k=IS(a[C.icon.namePrimary],C.icon.nameSecondary?a[C.icon.nameSecondary]:void 0,_.get("icon-offset").evaluate(C,{},d),_.get("icon-anchor").evaluate(C,{},d)),N=j.sdf,void 0===e.sdfIcons?e.sdfIcons=j.sdf:e.sdfIcons!==j.sdf&&K("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==e.pixelRatio||0!==_.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const z=H_(I.horizontal)||I.vertical;e.iconsInText||(e.iconsInText=!!z&&z.iconsInText),(z||k)&&LS(e,C,I,k,i,x,P,0,L,N,u,d,p,g,T)}l&&e.generateCollisionDebugBuffers(f,e.collisionBoxArray)}function $_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function LS(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b){let E=l.textMaxSize.evaluate(t,{},_);void 0===E&&(E=u);const T=e.layers[0].layout,C=T.get("icon-offset").evaluate(t,{},_),D=H_(n.horizontal)||n.vertical,A="globe"===v.name,P=pi,I=u/P,R=e.tilePixelRatio*E/P,k=(Z=e.overscaling,e.zoom>18&&Z>2&&(Z>>=1),Math.max(lt/(512*Z),1)*T.get("symbol-spacing")),L=T.get("text-padding")*e.tilePixelRatio,N=T.get("icon-padding")*e.tilePixelRatio,z=Ee(T.get("text-max-angle")),j="map"===T.get("text-rotation-alignment")&&"point"!==T.get("symbol-placement"),B="map"===T.get("icon-rotation-alignment")&&"point"!==T.get("symbol-placement"),H=T.get("symbol-placement"),V=k/2;var Z;const Q=T.get("icon-text-fit").evaluate(t,{},_),et=T.get("icon-text-fit-padding").evaluate(t,{},_),W="none"!==Q;let X;!1===e.hasAnyIconTextFit&&W&&(e.hasAnyIconTextFit=!0),i&&W&&(e.allowVerticalPlacement&&n.vertical&&(X=Rx(i,n.vertical,Q,et,C,I)),D&&(i=Rx(i,D,Q,et,C,I)));const rt=(ot,ct,dt)=>{if(ct.x<0||ct.x>=lt||ct.y<0||ct.y>=lt)return;let gt=null;if(A){const{x:at,y:ut,z:St}=v.projectTilePoint(ct.x,ct.y,dt);gt={anchor:new ec(at,ut,St,0,void 0),up:v.upVector(dt,ct.x,ct.y)}}!function(at,ut,St,Nt,zt,Vt,Kt,he,Oe,Xe,Ce,xe,ce,ie,Ne,Ke,Re,Sn,or,Gn,kn,Vr,Kn,qn,Cn,So,Ba){const $o=at.addToLineVertexArray(ut,Nt);let wl,ch,uh,Zy,Wy,Xy,Om,rP=0,iP=0,oP=0,Eb=0,Mb=-1,Cb=-1;const El={};let lD=Jg("");const cu=St?St.anchor:ut,Yy="none"!==Oe.layout.get("icon-text-fit").evaluate(kn,{},Cn);let Jy=0,Tb=0;if(void 0===Oe._unevaluatedLayout.getValue("text-radial-offset")?[Jy,Tb]=Oe.layout.get("text-offset").evaluate(kn,{},Cn).map(Bs=>Bs*pi):(Jy=Oe.layout.get("text-radial-offset").evaluate(kn,{},Cn)*pi,Tb=Fx),at.allowVerticalPlacement&&zt.vertical){const Bs=zt.vertical;if(Ne)Xy=G_(Bs),he&&(Om=G_(he));else{const Ho=Oe.layout.get("text-rotate").evaluate(kn,{},Cn)+90;uh=Nx(Xe,cu,ut,Ce,xe,ce,Bs,ie,Ho,Ke),he&&(Zy=Nx(Xe,cu,ut,Ce,xe,ce,he,Sn,Ho))}}if(Vt){const Bs=Oe.layout.get("icon-rotate").evaluate(kn,{},Cn),Ho=FM(Vt,Bs,Kn,Yy),Ml=he?FM(he,Bs,Kn,Yy):void 0;ch=Nx(Xe,cu,ut,Ce,xe,ce,Vt,Sn,Bs),rP=4*Ho.length;const cD=at.iconSizeData;let hh=null;"source"===cD.kind?(hh=[ra*Oe.layout.get("icon-size").evaluate(kn,{},Cn)],hh[0]>nc&&K(`${at.layerIds[0]}: Value for "icon-size" is >= ${Dd}. Reduce your "icon-size".`)):"composite"===cD.kind&&(hh=[ra*Vr.compositeIconSizes[0].evaluate(kn,{},Cn),ra*Vr.compositeIconSizes[1].evaluate(kn,{},Cn)],(hh[0]>nc||hh[1]>nc)&&K(`${at.layerIds[0]}: Value for "icon-size" is >= ${Dd}. Reduce your "icon-size".`)),at.addSymbols(at.icon,Ho,hh,Gn,or,kn,!1,St,ut,$o.lineStartIndex,$o.lineLength,-1,qn,Cn,So,Ba),Mb=at.icon.placedSymbolArray.length-1,Ml&&(iP=4*Ml.length,at.addSymbols(at.icon,Ml,hh,Gn,or,kn,Hn.vertical,St,ut,$o.lineStartIndex,$o.lineLength,-1,qn,Cn,So,Ba),Cb=at.icon.placedSymbolArray.length-1)}for(const Bs in zt.horizontal){const Ho=zt.horizontal[Bs];wl||(lD=Jg(Ho.text),Ne?Wy=G_(Ho):wl=Nx(Xe,cu,ut,Ce,xe,ce,Ho,ie,Oe.layout.get("text-rotate").evaluate(kn,{},Cn),Ke));const Ml=1===Ho.positionedLines.length;if(oP+=$p(at,St,ut,Ho,Kt,Oe,Ne,kn,Ke,$o,zt.vertical?Hn.horizontal:Hn.horizontalOnly,Ml?Object.keys(zt.horizontal):[Bs],El,Mb,Vr,qn,Cn,So),Ml)break}zt.vertical&&(Eb+=$p(at,St,ut,zt.vertical,Kt,Oe,Ne,kn,Ke,$o,Hn.vertical,["vertical"],El,Cb,Vr,qn,Cn,So));let uu=-1;const Ky=(Bs,Ho)=>Bs?Math.max(Bs,Ho):Ho;uu=Ky(Wy,uu),uu=Ky(Xy,uu),uu=Ky(Om,uu);const Qy=uu>-1?1:0;at.glyphOffsetArray.length>=Xp.MAX_GLYPHS&&K("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==kn.sortKey&&at.addToSortKeyRanges(at.symbolInstances.length,kn.sortKey),at.symbolInstances.emplaceBack(ut.x,ut.y,cu.x,cu.y,cu.z,El.right>=0?El.right:-1,El.center>=0?El.center:-1,El.left>=0?El.left:-1,El.vertical>=0?El.vertical:-1,Mb,Cb,lD,void 0!==wl?wl:at.collisionBoxArray.length,void 0!==wl?wl+1:at.collisionBoxArray.length,void 0!==uh?uh:at.collisionBoxArray.length,void 0!==uh?uh+1:at.collisionBoxArray.length,void 0!==ch?ch:at.collisionBoxArray.length,void 0!==ch?ch+1:at.collisionBoxArray.length,Zy||at.collisionBoxArray.length,Zy?Zy+1:at.collisionBoxArray.length,Ce,oP,Eb,rP,iP,Qy,0,Jy,Tb,uu,0,Yy?1:0)}(e,ct,gt,ot,n,i,a,X,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,L,j,f,0,N,B,C,t,l,p,g,_,x,b)};if("line"===H)for(const ot of hs(t.geometry,0,0,lt,lt)){const ct=AS(ot,k,z,n.vertical||D,i,P,R,e.overscaling,lt);for(const dt of ct)D&&NM(e,D.text,V,dt)||rt(ot,dt,_)}else if("line-center"===H){for(const ot of t.geometry)if(ot.length>1){const ct=OM(ot,z,n.vertical||D,i,P,R);ct&&rt(ot,ct,_)}}else if("Polygon"===t.type)for(const ot of yd(t.geometry,0)){const ct=RS(ot,16);rt(ot[0],new ec(ct.x,ct.y,0,0,void 0),_)}else if("LineString"===t.type)for(const ot of t.geometry)rt(ot,new ec(ot[0].x,ot[0].y,0,0,void 0),_);else if("Point"===t.type)for(const ot of t.geometry)for(const ct of ot)rt([ct],new ec(ct.x,ct.y,0,0,void 0),_)}const Dd=255,nc=Dd*ra;function $p(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C){const D=function(I,R,k,L,N,z,j,B){const H=[];if(0===R.positionedLines.length)return H;const V=L.layout.get("text-rotate").evaluate(z,{})*Math.PI/180,Z=function(rt){const ot=rt[0],ct=rt[1],dt=ot*ct;return dt>0?[ot,-ct]:dt<0?[-ot,ct]:0===ot?[ct,ot]:[ct,-ot]}(k);let Q=Math.abs(R.top-R.bottom);for(const rt of R.positionedLines)Q-=rt.lineOffset;const et=R.positionedLines.length,W=Q/et;let X=R.top-k[1];for(let rt=0;rt<et;++rt){const ot=R.positionedLines[rt];X=Lx(R,W,X,rt);for(const ct of ot.positionedGlyphs){if(!ct.rect)continue;const dt=ct.rect||{};let gt=Ix+1,at=!0,ut=1,St=0;if(ct.imageName){const Gn=j[ct.imageName];if(!Gn)continue;if(Gn.sdf){K("SDF images are not supported in formatted text and will be ignored.");continue}at=!1,ut=Gn.pixelRatio,gt=Co/ut}const Nt=(N||B)&&ct.vertical,zt=ct.metrics.advance*ct.scale/2,Vt=ct.metrics,Kt=ct.rect;if(null===Kt)continue;B&&R.verticalizable&&(St=ct.imageName?zt-ct.metrics.width*ct.scale/2:0);const he=N?[ct.x+zt,ct.y]:[0,0];let Oe=[0,0],Xe=[0,0],Ce=!1;N||(Nt?(Xe=[ct.x+zt+Z[0],ct.y+Z[1]-St],Ce=!0):Oe=[ct.x+zt+k[0],ct.y+k[1]-St]);const xe=Kt.w*ct.scale/(ut*(ct.localGlyph?Fs:1)),ce=Kt.h*ct.scale/(ut*(ct.localGlyph?Fs:1));let ie,Ne,Ke,Re;if(Nt){const Gn=ct.y-X,kn=new tt(-zt,zt-Gn),Vr=-Math.PI/2,Kn=new tt(...Xe);ie=new tt(-zt+Oe[0],Oe[1]),ie._rotateAround(Vr,kn)._add(Kn),ie.x+=-Gn+zt,ie.y-=(Vt.left-gt)*ct.scale;const qn=ct.imageName?Vt.advance*ct.scale:pi*ct.scale,Cn=String.fromCodePoint(ct.glyph);pO(Cn)?ie.x+=(1-gt)*ct.scale:O_(Cn)?ie.x+=qn-Vt.height*ct.scale+(-gt-1)*ct.scale:ie.x+=ct.imageName||Vt.width+2*gt===Kt.w&&Vt.height+2*gt===Kt.h?(qn-ce)/2:(qn-(Vt.height+2*gt)*ct.scale)/2,Ne=new tt(ie.x,ie.y-xe),Ke=new tt(ie.x+ce,ie.y),Re=new tt(ie.x+ce,ie.y-xe)}else{const Gn=(Vt.left-gt)*ct.scale-zt+Oe[0],kn=(-Vt.top-gt)*ct.scale+Oe[1],Vr=Gn+xe,Kn=kn+ce;ie=new tt(Gn,kn),Ne=new tt(Vr,kn),Ke=new tt(Gn,Kn),Re=new tt(Vr,Kn)}if(V){let Gn;Gn=N?new tt(0,0):Ce?new tt(Z[0],Z[1]):new tt(k[0],k[1]),ie._rotateAround(V,Gn),Ne._rotateAround(V,Gn),Ke._rotateAround(V,Gn),Re._rotateAround(V,Gn)}const Sn=new tt(0,0),or=new tt(0,0);H.push({tl:ie,tr:Ne,bl:Ke,br:Re,texPrimary:dt,texSecondary:void 0,writingMode:R.writingMode,glyphOffset:he,sectionIndex:ct.sectionIndex,isSDF:at,pixelOffsetTL:Sn,pixelOffsetBR:or,minFontScaleX:0,minFontScaleY:0})}}return H}(0,i,f,l,u,d,a,e.allowVerticalPlacement),A=e.textSizeData;let P=null;"source"===A.kind?(P=[ra*l.layout.get("text-size").evaluate(d,{},T)],P[0]>nc&&K(`${e.layerIds[0]}: Value for "text-size" is >= ${Dd}. Reduce your "text-size".`)):"composite"===A.kind&&(P=[ra*b.compositeTextSizes[0].evaluate(d,{},T),ra*b.compositeTextSizes[1].evaluate(d,{},T)],(P[0]>nc||P[1]>nc)&&K(`${e.layerIds[0]}: Value for "text-size" is >= ${Dd}. Reduce your "text-size".`)),e.addSymbols(e.text,D,P,f,u,d,g,t,n,p.lineStartIndex,p.lineLength,x,E,T,C,!1);for(const I of _)v[I]=e.text.placedSymbolArray.length-1;return 4*D.length}function H_(e){for(const t in e)return e[t];return null}function Nx(e,t,n,i,a,l,u,d,f,p){let g=u.top,_=u.bottom,v=u.left,x=u.right;const b=u.collisionPadding;if(b&&(v-=b[0],g-=b[1],x+=b[2],_+=b[3]),f){const E=new tt(v,g),T=new tt(x,g),C=new tt(v,_),D=new tt(x,_),A=Ee(f);let P=new tt(0,0);p&&(P=new tt(p[0],p[1])),E._rotateAround(A,P),T._rotateAround(A,P),C._rotateAround(A,P),D._rotateAround(A,P),v=Math.min(E.x,T.x,C.x,D.x),x=Math.max(E.x,T.x,C.x,D.x),g=Math.min(E.y,T.y,C.y,D.y),_=Math.max(E.y,T.y,C.y,D.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,v,g,x,_,d,i,a,l),e.length-1}function G_(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function NM(e,t,n,i){const a=e.compareText;if(t in a){const l=a[t];for(let u=l.length-1;u>=0;u--)if(i.dist(l[u])<n)return!0}else a[t]=[];return a[t].push(i),!1}function zx(e,t){const n=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,a=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),l=Math.sin(n)*a/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),u=Math.sin(e._pitch)*l+a;return Math.min(1.01*u,a*(1/e._horizonShift))}function Kc(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),i=e.x*n,a=(e.x+1)*n,l=e.y*n,u=(e.y+1)*n,d=ls(i),f=ls(a),p=zr(l),g=zr(u),_=t.project(d,p),v=t.project(f,p),x=t.project(f,g),b=t.project(d,g);let E=Math.min(_.x,v.x,x.x,b.x),T=Math.min(_.y,v.y,x.y,b.y),C=Math.max(_.x,v.x,x.x,b.x),D=Math.max(_.y,v.y,x.y,b.y);const A=n/16;function P(R,k,L,N,z,j){const B=(L+z)/2,H=(N+j)/2,V=t.project(ls(B),zr(H)),Z=Math.max(0,E-V.x,T-V.y,V.x-C,V.y-D);E=Math.min(E,V.x),C=Math.max(C,V.x),T=Math.min(T,V.y),D=Math.max(D,V.y),Z>A&&(P(R,V,L,N,B,H),P(V,k,B,H,z,j))}P(_,v,i,l,a,l),P(v,x,a,l,a,u),P(x,b,a,u,i,u),P(b,_,i,u,i,l),E-=A,T-=A,C+=A,D+=A;const I=1/Math.max(C-E,D-T);return{scale:I,x:E*I,y:T*I,x2:C*I,y2:D*I,projection:t}}function q_(e,t,n,i,a,l,u,d,f){if("globe"===f.name)return h_(e,t,new Qs(n,i,a),!1);const p=Kc({z:n,x:i,y:a},f);return new $n([(l+p.x/p.scale)*t,t*(p.y/p.scale),u],[(l+p.x2/p.scale)*t,t*(p.y2/p.scale),d])}function yl(e,{x:t,y:n},i=0){return new tt(((t-i)*e.scale-e.x)*lt,(n*e.scale-e.y)*lt)}function zM(e,t,n=0){return G.fromValues(((t.x-n)*e.scale-e.x)*lt,(t.y*e.scale-e.y)*lt,WE(t.z,t.y))}const FS=nt.identity(new Float32Array(16));class vl{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,n){return{x:0,y:0,z:0}}unproject(t,n){return new _e(0,0)}projectTilePoint(t,n,i){return{x:t,y:n,z:0}}locationPoint(t,n,i=!0){return t._coordinatePoint(t.locationCoordinate(n),i)}pixelsPerMeter(t,n){return xn(1,t)*n}pixelSpaceConversion(t,n,i){return 1}farthestPixelDistance(t){return zx(t,t.pixelsPerMeter)}pointCoordinate(t,n,i,a){const l=t.horizonLineFromTop(!1),u=new tt(n,Math.max(l,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(u,a))}pointCoordinate3D(t,n,i){const a=new tt(n,i);if(t.elevation)return t.elevation.pointCoordinate(a);{const l=this.pointCoordinate(t,a.x,a.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(t,n){if(t.elevation)return!this.pointCoordinate3D(t,n.x,n.y);const i=t.horizonLineFromTop();return n.y<i}createInversionMatrix(t,n){return FS}createTileMatrix(t,n,i){let a,l,u;const d=i.canonical,f=nt.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const p=Kc(d,this);a=1,l=p.x+i.wrap*p.scale,u=p.y,nt.scale(f,f,[a/p.scale,a/p.scale,t.pixelsPerMeter/n])}else a=n/t.zoomScale(d.z),l=(d.x+Math.pow(2,d.z)*i.wrap)*a,u=d.y*a;return nt.translate(f,f,[l,u,0]),nt.scale(f,f,[a/lt,a/lt,1]),f}upVector(t,n,i){return[0,0,1]}upVectorScale(t,n,i){return{metersToTile:1}}}class NS extends vl{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[n,i]=this.parallels=t.parallels||[29.5,45.5],a=Math.sin(Ee(n));this.n=(a+Math.sin(Ee(i)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(t,n){const{n:i,c:a,r0:l}=this,u=Ee(t-this.center[0]),d=Ee(n),f=Math.sqrt(a-2*i*Math.sin(d))/i;return{x:f*Math.sin(u*i),y:f*Math.cos(u*i)-l,z:0}}unproject(t,n){const{n:i,c:a,r0:l}=this,u=l+n;let d=Math.atan2(t,Math.abs(u))*Math.sign(u);u*i<0&&(d-=Math.PI*Math.sign(t)*Math.sign(u));const f=Ee(this.center[0])*i;d=Ja(d,-Math.PI-f,Math.PI-f);const p=Wt(ti(d/i)+this.center[0],-180,180),g=Math.asin(Wt((a-(t*t+u*u)*i*i)/(2*i),-1,1)),_=Wt(ti(g),-Er,Er);return new _e(p,_)}}const Sd=1.340264,Hp=-.081106,Qc=893e-6,rc=.003796,Gp=Math.sqrt(3)/2;class Z_ extends vl{project(t,n){n=n/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(Gp*Math.sin(n)),a=i*i,l=a*a*a;return{x:.5*(t*Math.cos(i)/(Gp*(Sd+3*Hp*a+l*(7*Qc+9*rc*a)))/Math.PI+.5),y:1-.5*(i*(Sd+Hp*a+l*(Qc+rc*a))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,a=i*i,l=a*a*a;for(let g,_,v,x=0;x<12&&(_=i*(Sd+Hp*a+l*(Qc+rc*a))-n,v=Sd+3*Hp*a+l*(7*Qc+9*rc*a),g=_/v,i=Wt(i-g,-Math.PI/3,Math.PI/3),a=i*i,l=a*a*a,!(Math.abs(g)<1e-12));++x);const u=Gp*t*(Sd+3*Hp*a+l*(7*Qc+9*rc*a))/Math.cos(i),d=Math.asin(Math.sin(i)/Gp),f=Wt(180*u/Math.PI,-180,180),p=Wt(180*d/Math.PI,-Er,Er);return new _e(f,p)}}class mO extends vl{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){return{x:.5+t/360,y:.5-n/360,z:0}}unproject(t,n){const i=360*(t-.5),a=Wt(360*(.5-n),-Er,Er);return new _e(i,a)}}const Id=Math.PI/2;function qp(e){return Math.tan((Id+e)/2)}class BM extends vl{constructor(t){super(t),this.center=t.center||[0,30];const[n,i]=this.parallels=t.parallels||[30,30];let a=Ee(n),l=Ee(i);this.southernCenter=a+l<0,this.southernCenter&&(a=-a,l=-l);const u=Math.cos(a),d=qp(a);this.n=a===l?Math.sin(a):Math.log(u/Math.cos(l))/Math.log(qp(l)/d),this.f=u*Math.pow(qp(a),this.n)/this.n}project(t,n){n=Ee(n),this.southernCenter&&(n=-n),t=Ee(t-this.center[0]);const i=1e-6,{n:a,f:l}=this;l>0?n<-Id+i&&(n=-Id+i):n>Id-i&&(n=Id-i);const u=l/Math.pow(qp(n),a);let d=u*Math.sin(a*t),f=l-u*Math.cos(a*t);return d=.5*(d/Math.PI+.5),f=.5*(f/Math.PI+.5),{x:d,y:this.southernCenter?f:1-f,z:0}}unproject(t,n){t=(2*t-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:i,f:a}=this,l=a-n,u=Math.sign(l),d=Math.sign(i)*Math.sqrt(t*t+l*l);let f=Math.atan2(t,Math.abs(l))*u;l*i<0&&(f-=Math.PI*Math.sign(t)*u);const p=Wt(ti(f/i)+this.center[0],-180,180),g=Wt(ti(2*Math.atan(Math.pow(a/d,1/i))-Id),-Er,Er);return new _e(p,this.southernCenter?-g:g)}}class VM extends vl{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,n){return{x:Li(t),y:Gi(n),z:0}}unproject(t,n){const i=ls(t),a=zr(n);return new _e(i,a)}}const jM=Ee(Er);class UM extends vl{project(t,n){const i=(n=Ee(n))*n,a=i*i;return{x:.5*((t=Ee(t))*(.8707-.131979*i+a*(a*(.003971*i-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+i*(.015085+a*(.028874*i-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,a=25,l=0,u=i*i;do{u=i*i;const p=u*u;l=(i*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))-n)/(1.007226+u*(.045255+p*(.259866*u-.311325-.005916*11*p))),i=Wt(i-l,-jM,jM)}while(Math.abs(l)>1e-6&&--a>0);u=i*i;const d=Wt(ti(t/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),f=ti(i);return new _e(d,f)}}const Bx=Ee(Er);class Zp extends vl{project(t,n){n=Ee(n),t=Ee(t);const i=Math.cos(n),a=2/Math.PI,l=Math.acos(i*Math.cos(t/2)),u=Math.sin(l)/l,d=.5*(t*a+2*i*Math.sin(t/2)/u)||0,f=.5*(n+Math.sin(n)/u)||0;return{x:.5*(d/Math.PI+.5),y:1-.5*(f/Math.PI+1),z:0}}unproject(t,n){let i=t=(2*t-.5)*Math.PI,a=n=(2*(1-n)-1)*Math.PI,l=25;const u=1e-6;let d=0,f=0;do{const p=Math.cos(a),g=Math.sin(a),_=2*g*p,v=g*g,x=p*p,b=Math.cos(i/2),E=Math.sin(i/2),T=2*b*E,C=E*E,D=1-x*b*b,A=D?1/D:0,P=D?Math.acos(p*b)*Math.sqrt(1/D):0,I=.5*(2*P*p*E+2*i/Math.PI)-t,R=.5*(P*g+a)-n,k=.5*A*(x*C+P*p*b*v)+1/Math.PI,L=A*(T*_/4-P*g*E),N=.125*A*(_*E-P*g*x*T),z=.5*A*(v*b+P*C*p)+.5,j=L*N-z*k;d=(R*L-I*z)/j,f=(I*N-R*k)/j,i=Wt(i-d,-Math.PI,Math.PI),a=Wt(a-f,-Bx,Bx)}while((Math.abs(d)>u||Math.abs(f)>u)&&--l>0);return new _e(ti(i),ti(a))}}class $M extends vl{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ee(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){const{scale:i,cosPhi:a}=this;return{x:Ee(t)*a*i+.5,y:-Math.sin(Ee(n))/a*i+.5,z:0}}unproject(t,n){const{scale:i,cosPhi:a}=this,l=-(n-.5)/i,u=Wt(ti((t-.5)/i)/a,-180,180),d=Math.asin(Wt(l*a,-1,1)),f=Wt(ti(d),-Er,Er);return new _e(u,f)}}class HM extends VM{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,n,i){const a=vp(t,n,i),l=as(uo(i));return G.transformMat4(a,a,l),{x:a[0],y:a[1],z:a[2]}}locationPoint(t,n){const i=Vo(n.lat,n.lng),a=G.normalize([],i),l=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(n),t._centerAltitude):t._centerAltitude,u=xn(1,0)*lt*l;G.scaleAndAdd(i,i,a,u);const d=nt.identity(new Float64Array(16));return nt.multiply(d,t.pixelMatrix,t.globeMatrix),G.transformMat4(i,i,d),new tt(i[0],i[1])}pixelsPerMeter(t,n){return xn(1,0)*n}pixelSpaceConversion(t,n,i){const a=xn(1,t)*n,l=ue(xn(1,45)*n,a,i);return this.pixelsPerMeter(t,n)/l}createTileMatrix(t,n,i){const a=Hu(uo(i.canonical));return nt.multiply(new Float64Array(16),t.globeMatrix,a)}createInversionMatrix(t,n){const{center:i}=t,a=as(uo(n));return nt.rotateY(a,a,Ee(i.lng)),nt.rotateX(a,a,Ee(i.lat)),nt.scale(a,a,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(t,n,i,a){return UE(t,n,i,!0)||new Ge(0,0)}pointCoordinate3D(t,n,i){const a=this.pointCoordinate(t,n,i,0);return[a.x,a.y,a.z]}isPointAboveHorizon(t,n){return!UE(t,n.x,n.y,!1)}farthestPixelDistance(t){const n=function(a,l){const u=a.cameraToCenterDistance,d=a._centerAltitude*l,f=a._camera,p=a._camera.forward(),g=G.add([],G.scale([],p,-u),[0,0,d]),_=a.worldSize/(2*Math.PI),v=[0,0,-_],x=a.width/a.height,b=Math.tan(a.fovAboveCenter),E=G.scale([],f.up(),b),T=G.scale([],f.right(),b*x),C=G.normalize([],G.add([],G.add([],p,E),T)),D=[];let A;if(new ad(g,C).closestPointOnSphere(v,_,D)){const P=G.add([],D,v),I=G.sub([],P,g);A=Math.cos(a.fovAboveCenter)*G.length(I)}else{const P=G.sub([],g,v),I=G.sub([],v,g);G.normalize(I,I);const R=G.length(P)-_;A=Math.sqrt(R*(R+2*_));const k=Math.acos(A/(_+R))-Math.acos(G.dot(p,I));A*=Math.cos(k)}return 1.01*A}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),i=ki(t.zoom);if(i>0){const a=zx(t,xn(1,t.center.lat)*t.worldSize),l=t.worldSize/(2*Math.PI),u=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ue(n,a+l*(1-Math.cos(u)),Math.pow(i,10))}return n}upVector(t,n,i){return vp(n,i,t,1)}upVectorScale(t){return{metersToTile:V0(f_(uo(t)))}}}function Wp(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new VM(e);case"equirectangular":return new mO(e);case"naturalEarth":return new UM(e);case"equalEarth":return new Z_(e);case"winkelTripel":return new Zp(e);case"albers":return n?new $M(e):new NS(e);case"lambertConformalConic":return n?new $M(e):new BM(e);case"globe":return new HM(e)}throw new Error(`Invalid projection name: ${e.name}`)}const zS=new nr({"symbol-placement":new Tt(J.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(J.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(J.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new te(J.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(J.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt(J.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Tt(J.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt(J.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(J.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(J.layout_symbol["icon-rotation-alignment"]),"icon-size":new te(J.layout_symbol["icon-size"]),"icon-text-fit":new te(J.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new te(J.layout_symbol["icon-text-fit-padding"]),"icon-image":new te(J.layout_symbol["icon-image"]),"icon-rotate":new te(J.layout_symbol["icon-rotate"]),"icon-padding":new Tt(J.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(J.layout_symbol["icon-keep-upright"]),"icon-offset":new te(J.layout_symbol["icon-offset"]),"icon-anchor":new te(J.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(J.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(J.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(J.layout_symbol["text-rotation-alignment"]),"text-field":new te(J.layout_symbol["text-field"]),"text-font":new te(J.layout_symbol["text-font"]),"text-size":new te(J.layout_symbol["text-size"]),"text-max-width":new te(J.layout_symbol["text-max-width"]),"text-line-height":new te(J.layout_symbol["text-line-height"]),"text-letter-spacing":new te(J.layout_symbol["text-letter-spacing"]),"text-justify":new te(J.layout_symbol["text-justify"]),"text-radial-offset":new te(J.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(J.layout_symbol["text-variable-anchor"]),"text-anchor":new te(J.layout_symbol["text-anchor"]),"text-max-angle":new Tt(J.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(J.layout_symbol["text-writing-mode"]),"text-rotate":new te(J.layout_symbol["text-rotate"]),"text-padding":new Tt(J.layout_symbol["text-padding"]),"text-keep-upright":new Tt(J.layout_symbol["text-keep-upright"]),"text-transform":new te(J.layout_symbol["text-transform"]),"text-offset":new te(J.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(J.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt(J.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(J.layout_symbol["text-optional"]),visibility:new Tt(J.layout_symbol.visibility)});var Vx={paint:new nr({"icon-opacity":new te(J.paint_symbol["icon-opacity"]),"icon-emissive-strength":new te(J.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new te(J.paint_symbol["text-emissive-strength"]),"icon-color":new te(J.paint_symbol["icon-color"]),"icon-halo-color":new te(J.paint_symbol["icon-halo-color"]),"icon-halo-width":new te(J.paint_symbol["icon-halo-width"]),"icon-halo-blur":new te(J.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(J.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(J.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new te(J.paint_symbol["icon-image-cross-fade"]),"text-opacity":new te(J.paint_symbol["text-opacity"]),"text-color":new te(J.paint_symbol["text-color"],{runtimeType:pa,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new te(J.paint_symbol["text-halo-color"]),"text-halo-width":new te(J.paint_symbol["text-halo-width"]),"text-halo-blur":new te(J.paint_symbol["text-halo-blur"]),"text-translate":new Tt(J.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(J.paint_symbol["text-translate-anchor"])}),layout:zS};class Ad{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Gs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt(Ad,"FormatSectionOverride",{omit:["defaultValue"]});class W_ extends Ps{constructor(t,n){super(t,Vx,n)}recalculate(t,n){super.recalculate(t,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const a=[];for(const l of i)a.indexOf(l)<0&&a.push(l);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,n,i,a){const l=this.layout.get(t).evaluate(n,{},i,a),u=this._unevaluatedLayout._values[t];return u.isDataDriven()||$f(u.value)||!l?l:(d=n.properties,l.replace(/{([^{}]+)}/g,(p,g)=>g in d?String(d[g]):""));var d}createBucket(t){return new Xp(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Vx.paint.overridableProperties){if(!W_.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),i=new Ad(n),a=new Sg(i,n.property.specification);let l=null;l="constant"===n.value.kind||"source"===n.value.kind?new Hf("source",a):new jl("composite",a,n.value.zoomStops,n.value._interpolationType),this.paint._values[t]=new ns(n.property,l,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&W_.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const i=t.get("text-field"),a=Vx.paint.properties[n];let l=!1;const u=d=>{for(const f of d)if(a.overrides&&a.overrides.hasOverride(f))return void(l=!0)};if("constant"===i.value.kind&&i.value.value instanceof He)u(i.value.value.sections);else if("source"===i.value.kind){const d=p=>{l||(p instanceof hg&&ri(p.value)===rg?u(p.value.sections):p instanceof Dh?u(p.sections):p.eachChild(d))},f=i.value;f._styleExpression&&d(f._styleExpression.expression)}return l}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),n=0!==this.paint.get("text-opacity").constantOr(1),i=[];return t&&i.push("symbolIcon"),n&&i.push("symbolSDF"),i}getDefaultProgramParams(t,n){return{config:new Qh(this,n),overrideFog:!1}}}const BS=Lp.types,VS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function X_(e,t,n,i,a,l,u,d,f,p,g,_,v){const x=d?Math.min(nc,Math.round(d[0])):0,b=d?Math.min(nc,Math.round(d[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*a),l,u,(x<<1)+(f?1:0),b,16*p,16*g,256*_,256*v)}function Y_(e,t,n){e.emplaceBack(t,n)}function J_(e,t,n,i,a,l,u){e.emplaceBack(t,n,i,a,l,u)}function K_(e,t,n,i,a){const l=5*t+2;e.float32[l+0]=n,e.float32[l+1]=i,e.float32[l+2]=a}function Pd(e,t,n,i,a){e.emplaceBack(t,n,i,a),e.emplaceBack(t,n,i,a),e.emplaceBack(t,n,i,a),e.emplaceBack(t,n,i,a)}function GM(e){for(const t of e.sections)if(k2(t.text))return!0;return!1}class Jn{constructor(t){this.layoutVertexArray=new l0,this.indexArray=new Rr,this.programConfigurations=t,this.segments=new bn,this.dynamicLayoutVertexArray=new rr,this.opacityVertexArray=new Ug,this.placedSymbolArray=new Xh,this.iconTransitioningVertexArray=new ba,this.globeExtVertexArray=new jg,this.zOffsetVertexArray=new tp}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,n,i,a,l){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vM.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,zp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,VS,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,xM.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Sx.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,R_.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||a)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Gt(Jn,"SymbolBuffers");class jx{constructor(t,n,i){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new i,this.segments=new bn,this.collisionVertexArray=new Wh,this.collisionVertexArrayExt=new wa}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,bM.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,TS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gt(jx,"CollisionBuffers");class Qu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=nt.identity([]),this.placementViewportMatrix=nt.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=EM(this.zoom,n["text-size"]),this.iconSizeData=EM(this.zoom,n["icon-size"]);const i=this.layers[0].layout,a=i.get("symbol-sort-key"),l=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==l&&void 0!==a.constantOr(1),this.sortFeaturesByY=("viewport-y"===l||"auto"===l&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(u=>Hn[u]),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new Jn(new Fu(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Jn(new Fu(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Xg,this.lineVertexArray=new ep,this.symbolInstances=new Yh}calculateGlyphDependencies(t,n,i,a,l){for(let u=0;u<t.length;u++){const d=t.codePointAt(u);if(void 0===d)break;if(n[d]=!0,a&&l&&d<=65535){const f=Md[t.charAt(u)];f&&(n[f.charCodeAt(0)]=!0)}}}populate(t,n,i,a){const l=this.layers[0],u=l.layout,d="globe"===this.projection.name,f=u.get("text-font"),p=u.get("text-field"),g=u.get("icon-image"),_=("constant"!==p.value.kind||p.value.value instanceof He&&!p.value.value.isEmpty()||p.value.value.toString().length>0)&&("constant"!==f.value.kind||f.value.value.length>0),v="constant"!==g.value.kind||!!g.value.value||Object.keys(g.parameters).length>0,x=u.get("symbol-sort-key");if(this.features=[],!_&&!v)return;const b=n.iconDependencies,E=n.glyphDependencies,T=n.availableImages,C=new er(this.zoom);for(const{feature:D,id:A,index:P,sourceLayerIndex:I}of t){const R=l._featureFilter.needGeometry,k=Gc(D,R);if(!l._featureFilter.filter(C,k,i))continue;if(R||(k.geometry=pl(D,i,a)),d&&1!==D.type&&i.z<=5){const j=k.geometry,B=.98078528056,H=(V,Z)=>{const Q=vp(V.x,V.y,i,1),et=vp(Z.x,Z.y,i,1);return G.dot(Q,et)<B};for(let V=0;V<j.length;V++)j[V]=YE(j[V],H)}let L,N;if(_){const j=l.getValueAndResolveTokens("text-field",k,i,T),B=He.factory(j);GM(B)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Xs()||this.hasRTLText&&es.isParsed())&&(L=MM(B,l,k))}if(v){const j=l.getValueAndResolveTokens("icon-image",k,i,T);N=j instanceof Jo?j:Jo.fromString(j)}if(!L&&!N)continue;const z=this.sortFeaturesByKey?x.evaluate(k,{},i):void 0;if(this.features.push({id:A,text:L,icon:N,index:P,sourceLayerIndex:I,geometry:k.geometry,properties:D.properties,type:BS[D.type],sortKey:z}),N&&(b[N.namePrimary]=!0,N.nameSecondary&&(b[N.nameSecondary]=!0)),L){const j=f.evaluate(k,{},i).join(","),B="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Hn.vertical)>=0;for(const H of L.sections)if(H.image)b[H.image.namePrimary]=!0;else{const V=t0(L.toString()),Z=H.fontStack||j,Q=E[Z]=E[Z]||{};this.calculateGlyphDependencies(H.text,Q,B,this.allowVerticalPlacement,V)}}}"line"===u.get("symbol-placement")&&(this.features=function(D){const A={},P={},I=[];let R=0;function k(j){I.push(D[j]),R++}function L(j,B,H){const V=P[j];return delete P[j],P[B]=V,I[V].geometry[0].pop(),I[V].geometry[0]=I[V].geometry[0].concat(H[0]),V}function N(j,B,H){const V=A[B];return delete A[B],A[j]=V,I[V].geometry[0].shift(),I[V].geometry[0]=H[0].concat(I[V].geometry[0]),V}function z(j,B,H){const V=H?B[0][B[0].length-1]:B[0][0];return`${j}:${V.x}:${V.y}`}for(let j=0;j<D.length;j++){const B=D[j],H=B.geometry,V=B.text?B.text.toString():null;if(!V){k(j);continue}const Z=z(V,H),Q=z(V,H,!0);if(Z in P&&Q in A&&P[Z]!==A[Q]){const et=N(Z,Q,H),W=L(Z,Q,I[et].geometry);delete A[Z],delete P[Q],P[z(V,I[W].geometry,!0)]=W,I[et].geometry=null}else Z in P?L(Z,Q,H):Q in A?N(Z,Q,H):(k(j),A[Z]=R-1,P[Q]=R-1)}return I.filter(j=>j.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((D,A)=>D.sortKey-A.sortKey)}update(t,n,i,a,l){const u=0!==Object.keys(t).length;if(u&&!this.stateDependentLayers.length)return;const d=u?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,n,d,i,a,l),this.icon.programConfigurations.updatePaintArrays(t,n,d,i,a,l)}updateZOffset(){const t=(l,u,d)=>{i+=u,i>l.length&&l.resize(i);for(let f=-u;f<0;f++)l.emplace(f+i,d)},n=(l,u,d)=>{a+=u,a>l.length&&l.resize(a);for(let f=-u;f<0;f++)l.emplace(f+a,d)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,a=0;for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l),{numHorizontalGlyphVertices:d,numVerticalGlyphVertices:f,numIconVertices:p}=u,g=u.zOffset,_=p>0;if((d>0||f>0)&&(t(this.text.zOffsetVertexArray,d,g),t(this.text.zOffsetVertexArray,f,g)),_){const{placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:x}=u;v>=0&&n(this.icon.zOffsetVertexArray,p,g),x>=0&&n(this.icon.zOffsetVertexArray,u.numVerticalIconVertices,g)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Wp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const i=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:a,y:l}of n)this.lineVertexArray.emplaceBack(a,l);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T){const C=t.indexArray,D=t.layoutVertexArray,A=t.globeExtVertexArray,P=t.segments.prepareSegment(4*n.length,D,C,this.canOverlap?u.sortKey:void 0),I=this.glyphOffsetArray.length,R=P.vertexLength,k=this.allowVerticalPlacement&&d===Hn.vertical?Math.PI/2:0,L=u.text&&u.text.sections;for(let z=0;z<n.length;z++){const{tl:j,tr:B,bl:H,br:V,texPrimary:Z,texSecondary:Q,pixelOffsetTL:et,pixelOffsetBR:W,minFontScaleX:X,minFontScaleY:rt,glyphOffset:ot,isSDF:ct,sectionIndex:dt}=n[z],gt=P.vertexLength,at=ot[1];if(X_(D,p.x,p.y,j.x,at+j.y,Z.x,Z.y,i,ct,et.x,et.y,X,rt),X_(D,p.x,p.y,B.x,at+B.y,Z.x+Z.w,Z.y,i,ct,W.x,et.y,X,rt),X_(D,p.x,p.y,H.x,at+H.y,Z.x,Z.y+Z.h,i,ct,et.x,W.y,X,rt),X_(D,p.x,p.y,V.x,at+V.y,Z.x+Z.w,Z.y+Z.h,i,ct,W.x,W.y,X,rt),f){const{x:ut,y:St,z:Nt}=f.anchor,[zt,Vt,Kt]=f.up;J_(A,ut,St,Nt,zt,Vt,Kt),J_(A,ut,St,Nt,zt,Vt,Kt),J_(A,ut,St,Nt,zt,Vt,Kt),J_(A,ut,St,Nt,zt,Vt,Kt),Pd(t.dynamicLayoutVertexArray,ut,St,Nt,k)}else Pd(t.dynamicLayoutVertexArray,p.x,p.y,p.z,k);if(T){const ut=Q||Z;Y_(t.iconTransitioningVertexArray,ut.x,ut.y),Y_(t.iconTransitioningVertexArray,ut.x+ut.w,ut.y),Y_(t.iconTransitioningVertexArray,ut.x,ut.y+ut.h),Y_(t.iconTransitioningVertexArray,ut.x+ut.w,ut.y+ut.h)}C.emplaceBack(gt,gt+1,gt+2),C.emplaceBack(gt+1,gt+2,gt+3),P.vertexLength+=4,P.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),z!==n.length-1&&dt===n[z+1].sectionIndex||t.programConfigurations.populatePaintArrays(D.length,u,u.index,{},x,b,E,L&&L[dt])}const N=f?f.anchor:p;t.placedSymbolArray.emplaceBack(N.x,N.y,N.z,p.x,p.y,I,this.glyphOffsetArray.length-I,R,g,_,p.segment,i?i[0]:0,i?i[1]:0,a[0],a[1],d,0,!1,0,v,0)}_commitLayoutVertex(t,n,i,a,l,u,d){t.emplaceBack(n,i,a,l,u,Math.round(d.x),Math.round(d.y))}_addCollisionDebugVertices(t,n,i,a,l,u,d){const f=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),p=f.vertexLength,g=d.tileAnchorX,_=d.tileAnchorY;for(let x=0;x<4;x++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(n,-t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(n,t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(n,t.padding,t.padding),i.collisionVertexArrayExt.emplaceBack(n,-t.padding,t.padding),this._commitLayoutVertex(i.layoutVertexArray,a,l,u,g,_,new tt(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,a,l,u,g,_,new tt(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,a,l,u,g,_,new tt(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,a,l,u,g,_,new tt(t.x1,t.y2)),f.vertexLength+=4;const v=i.indexArray;v.emplaceBack(p,p+1),v.emplaceBack(p+1,p+2),v.emplaceBack(p+2,p+3),v.emplaceBack(p+3,p),f.primitiveLength+=4}_addTextDebugCollisionBoxes(t,n,i,a,l,u){for(let d=a;d<l;d++){const f=i.get(d),p=this.getSymbolInstanceTextSize(t,u,n,d);this._addCollisionDebugVertices(f,p,this.textCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}_addIconDebugCollisionBoxes(t,n,i,a,l,u){for(let d=a;d<l;d++){const f=i.get(d),p=this.getSymbolInstanceIconSize(t,n,u.placedIconSymbolIndex);this._addCollisionDebugVertices(f,p,this.iconCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}generateCollisionDebugBuffers(t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jx($g,wM.members,ba),this.iconCollisionBox=new jx($g,wM.members,ba);const i=tc(this.iconSizeData,t),a=tc(this.textSizeData,t);for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(a,t,n,u.textBoxStartIndex,u.textBoxEndIndex,u),this._addTextDebugCollisionBoxes(a,t,n,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._addIconDebugCollisionBoxes(i,t,n,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._addIconDebugCollisionBoxes(i,t,n,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}}getSymbolInstanceTextSize(t,n,i,a){const l=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:a),u=Bp(this.textSizeData,t,l)/pi;return this.tilePixelRatio*u}getSymbolInstanceIconSize(t,n,i){const a=this.icon.placedSymbolArray.get(i),l=Bp(this.iconSizeData,t,a);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(t,n,i){t.emplaceBack(n,-i,-i),t.emplaceBack(n,i,-i),t.emplaceBack(n,i,i),t.emplaceBack(n,-i,i)}_updateTextDebugCollisionBoxes(t,n,i,a,l,u){for(let d=a;d<l;d++){const f=i.get(d),p=this.getSymbolInstanceTextSize(t,u,n,d);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,p,f.padding)}}_updateIconDebugCollisionBoxes(t,n,i,a,l,u){for(let d=a;d<l;d++){const f=i.get(d),p=this.getSymbolInstanceIconSize(t,n,u);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,p,f.padding)}}updateCollisionDebugBuffers(t,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=tc(this.iconSizeData,t),a=tc(this.textSizeData,t);for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(a,t,n,u.textBoxStartIndex,u.textBoxEndIndex,u),this._updateTextDebugCollisionBoxes(a,t,n,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._updateIconDebugCollisionBoxes(i,t,n,u.iconBoxStartIndex,u.iconBoxEndIndex,u.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(i,t,n,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,n,i,a,l,u,d,f,p){const g={};if(n<i){const{x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P,featureIndex:I}=t.get(n);g.textBox={x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P},g.textFeatureIndex=I}if(a<l){const{x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P,featureIndex:I}=t.get(a);g.verticalTextBox={x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P},g.verticalTextFeatureIndex=I}if(u<d){const{x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P,featureIndex:I}=t.get(u);g.iconBox={x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P},g.iconFeatureIndex=I}if(f<p){const{x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P,featureIndex:I}=t.get(f);g.verticalIconBox={x1:_,y1:v,x2:x,y2:b,padding:E,projectedAnchorX:T,projectedAnchorY:C,projectedAnchorZ:D,tileAnchorX:A,tileAnchorY:P},g.verticalIconFeatureIndex=I}return g}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const i=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,n){const i=t.placedSymbolArray.get(n),a=i.vertexStartIndex+4*i.numGlyphs;for(let l=i.vertexStartIndex;l<a;l+=4)t.indexArray.emplaceBack(l,l+1,l+2),t.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(t),i=Math.cos(t),a=[],l=[],u=[];for(let d=0;d<this.symbolInstances.length;++d){u.push(d);const f=this.symbolInstances.get(d);a.push(0|Math.round(n*f.tileAnchorX+i*f.tileAnchorY)),l.push(f.featureIndex)}return u.sort((d,f)=>a[d]-a[f]||l[f]-l[d]),u}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,n){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===n?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const i=this.symbolInstances.get(n);this.featureSortOrder.push(i.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:u,verticalPlacedTextSymbolIndex:d,placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:p}=i;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),l>=0&&l!==a&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&this.addIndicesForPlacedSymbol(this.icon,f),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Gt(Qu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Qu.MAX_GLYPHS=65535,Qu.addDynamicAttributes=Pd;var Xp=Qu;const jS=sn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:US}=jS,$S=sn([{name:"a_packed",components:4,type:"Float32"}]),{members:HS}=$S,GS=Lp.types,qS=Math.cos(Math.PI/180*37.5);class Yp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Ul,this.layoutVertexArray2=new rr,this.indexArray=new Rr,this.programConfigurations=new Fu(t.layers,t.zoom),this.segments=new bn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,i,a){this.hasPattern=px("line",this.layers,n);const l=this.layers[0].layout.get("line-sort-key"),u=[];for(const{feature:g,id:_,index:v,sourceLayerIndex:x}of t){const b=this.layers[0]._featureFilter.needGeometry,E=Gc(g,b);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),E,i))continue;const T=l?l.evaluate(E,{},i):void 0,C={id:_,properties:g.properties,type:g.type,sourceLayerIndex:x,index:v,geometry:b?E.geometry:pl(g,i,a),patterns:{},sortKey:T};u.push(C)}l&&u.sort((g,_)=>g.sortKey-_.sortKey);const{lineAtlas:d,featureIndex:f}=n,p=this.addConstantDashes(d);for(const g of u){const{geometry:_,index:v,sourceLayerIndex:x}=g;if(p&&this.addFeatureDashes(g,d),this.hasPattern){const b=M_("line",this.layers,g,this.zoom,n);this.patternFeatures.push(b)}else this.addFeature(g,_,v,i,d.positions,n.availableImages,n.brightness);f.insert(t[v].feature,_,v,x,this.index)}}addConstantDashes(t){let n=!1;for(const i of this.layers){const a=i.paint.get("line-dasharray").value,l=i.layout.get("line-cap").value;if("constant"!==a.kind||"constant"!==l.kind)n=!0;else{const u=l.value,d=a.value;if(!d)continue;t.addDash(d,u)}}return n}addFeatureDashes(t,n){const i=this.zoom;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,u=a.layout.get("line-cap").value;if("constant"===l.kind&&"constant"===u.kind)continue;let d,f;if("constant"===l.kind){if(d=l.value,!d)continue}else d=l.evaluate({zoom:i},t);f="constant"===u.kind?u.value:u.evaluate({zoom:i},t),n.addDash(d,f),t.patterns[a.id]=n.getKey(d,f)}}update(t,n,i,a,l){const u=0!==Object.keys(t).length;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,u?this.stateDependentLayers:this.layers,i,a,l)}addFeatures(t,n,i,a,l,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,i,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,HS)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,US),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,i,a,l,u,d){const f=this.layers[0].layout,p=f.get("line-join").evaluate(t,{}),g=f.get("line-cap").evaluate(t,{}),_=f.get("line-miter-limit"),v=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const x of n)this.addLine(x,t,p,g,_,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,l,u,a,d)}addLine(t,n,i,a,l,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let C=0;C<t.length-1;C++)this.totalDistance+=t[C].dist(t[C+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const d="Polygon"===GS[n.type];let f=t.length;for(;f>=2&&t[f-1].equals(t[f-2]);)f--;let p=0;for(;p<f-1&&t[p].equals(t[p+1]);)p++;if(f<(d?3:2))return;"bevel"===i&&(l=1.05);const g=this.overscaling<=16?15*lt/(512*this.overscaling):0,_=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray);let v,x,b,E,T;this.e1=this.e2=-1,d&&(v=t[f-2],T=t[p].sub(v)._unit()._perp());for(let C=p;C<f;C++){if(b=C===f-1?d?t[p+1]:void 0:t[C+1],b&&t[C].equals(b))continue;T&&(E=T),v&&(x=v),v=t[C],T=b?b.sub(v)._unit()._perp():E,E=E||T;let D=E.add(T);0===D.x&&0===D.y||D._unit();const A=E.x*T.x+E.y*T.y,P=D.x*T.x+D.y*T.y,I=0!==P?1/P:1/0,R=2*Math.sqrt(2-2*P),k=P<qS&&x&&b,L=E.x*T.y-E.y*T.x>0;if(k&&C>p){const j=v.dist(x);if(j>2*g){const B=v.sub(v.sub(x)._mult(g/j)._round());this.updateDistance(x,B),this.addCurrentVertex(B,E,0,0,_),x=B}}const N=x&&b;let z=N?i:d?"butt":a;if(N&&"round"===z&&(I<u?z="miter":I<=2&&(z="fakeround")),"miter"===z&&I>l&&(z="bevel"),"bevel"===z&&(I>2&&(z="flipbevel"),I<l&&(z="miter")),x&&this.updateDistance(x,v),"miter"===z)D._mult(I),this.addCurrentVertex(v,D,0,0,_);else if("flipbevel"===z){if(I>100)D=T.mult(-1);else{const j=I*E.add(T).mag()/E.sub(T).mag();D._perp()._mult(j*(L?-1:1))}this.addCurrentVertex(v,D,0,0,_),this.addCurrentVertex(v,D.mult(-1),0,0,_)}else if("bevel"===z||"fakeround"===z){const j=-Math.sqrt(I*I-1),B=L?j:0,H=L?0:j;if(x&&this.addCurrentVertex(v,E,B,H,_),"fakeround"===z){const V=Math.round(180*R/Math.PI/20);for(let Z=1;Z<V;Z++){let Q=Z/V;if(.5!==Q){const W=Q-.5;Q+=Q*W*(Q-1)*((1.0904+A*(A*(3.55645-1.43519*A)-3.2452))*W*W+(.848013+A*(.215638*A-1.06021)))}const et=T.sub(E)._mult(Q)._add(E)._unit()._mult(L?-1:1);this.addHalfVertex(v,et.x,et.y,!1,L,0,_)}}b&&this.addCurrentVertex(v,T,-B,-H,_)}else if("butt"===z)this.addCurrentVertex(v,D,0,0,_);else if("square"===z){const j=x?1:-1;x||this.addCurrentVertex(v,D,j,j,_),this.addCurrentVertex(v,D,0,0,_),x&&this.addCurrentVertex(v,D,j,j,_)}else"round"===z&&(x&&(this.addCurrentVertex(v,E,0,0,_),this.addCurrentVertex(v,E,1,1,_,!0)),b&&(this.addCurrentVertex(v,T,-1,-1,_,!0),this.addCurrentVertex(v,T,0,0,_)));if(k&&C<f-1){const j=v.dist(b);if(j>2*g){const B=v.add(b.sub(v)._mult(g/j)._round());this.updateDistance(v,B),this.addCurrentVertex(B,T,0,0,_),v=B}}}}addCurrentVertex(t,n,i,a,l,u=!1){const d=n.y*a-n.x,f=-n.y-n.x*a;this.addHalfVertex(t,n.x+n.y*i,n.y-n.x*i,u,!1,i,l),this.addHalfVertex(t,d,f,u,!0,-a,l)}addHalfVertex({x:t,y:n},i,a,l,u,d,f){this.layoutVertexArray.emplaceBack((t<<1)+(l?1:0),(n<<1)+(u?1:0),Math.round(63*i)+128,Math.round(63*a)+128,1+(0===d?0:d<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const p=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,p),f.primitiveLength++),u?this.e2=p:this.e1=p}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}Gt(Yp,"LineBucket",{omit:["layers","patternFeatures"]});class kr{constructor(t,n,i,a){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(n,a)}update(t,n,i){const{width:a,height:l}=t,{context:u}=this,{gl:d}=u,{HTMLImageElement:f,HTMLCanvasElement:p,HTMLVideoElement:g,ImageData:_,ImageBitmap:v}=it;if(d.bindTexture(d.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA&&(!n||!1!==n.premultiply)),i||this.size&&this.size[0]===a&&this.size[1]===l){const{x,y:b}=i||{x:0,y:0};if(t instanceof f||t instanceof p||t instanceof g||t instanceof _||v&&t instanceof v)d.texSubImage2D(d.TEXTURE_2D,0,x,b,d.RGBA,d.UNSIGNED_BYTE,t);else{let E=this.format,T=d.UNSIGNED_BYTE;this.format===d.R32F&&(E=d.RED,T=d.FLOAT),d.texSubImage2D(d.TEXTURE_2D,0,x,b,a,l,E,T,t.data)}}else if(this.size=[a,l],t instanceof f||t instanceof p||t instanceof g||t instanceof _||v&&t instanceof v){let x=this.format;this.format===d.R8&&(x=d.RED),d.texImage2D(d.TEXTURE_2D,0,this.format,x,d.UNSIGNED_BYTE,t)}else{let x=this.format,b=this.format,E=d.UNSIGNED_BYTE;this.format===d.DEPTH_COMPONENT&&(x=d.DEPTH_COMPONENT16,E=d.UNSIGNED_SHORT),this.format===d.R32F&&(E=d.FLOAT,b=d.RED),d.texImage2D(d.TEXTURE_2D,0,x,a,l,0,b,E,t.data)}this.useMipmap=!(!n||!n.useMipmap),this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(t,n){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?t===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(t,n,i,a){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),n!==this.magFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,n),this.magFilter=n),t!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?t===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),this.wrapS=i),a!==this.wrapT&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Q_{constructor(t,n){this.context=t,this.texture=n}bind(t,n){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),n!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,n),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapS=n)}}const ic=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,n=0,i=0,a=0,l=0,u=0,d=0;for(1&t?a=l=u=32:n=i=d=32;(t>>=1)>1;){const p=n+a>>1,g=i+l>>1;1&t?(a=n,l=i,n=u,i=d):(n=a,i=l,a=u,l=d),u=p,d=g}const f=4*e;ic[f+0]=n,ic[f+1]=i,ic[f+2]=a,ic[f+3]=l}const oc=new Uint16Array(2178),Pa=new Uint8Array(1089),ty=new Uint16Array(1089);function qM(e){return 0===e?-.03125:32===e?.03125:0}var Jp=sn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ZM={type:2,extent:lt,loadGeometry:()=>[[new tt(0,0),new tt(lt+1,0),new tt(lt+1,lt+1),new tt(0,lt+1),new tt(0,0)]]};class ds{constructor(t,n,i,a,l){this.tileID=t,this.uid=Ar(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=l,a&&a.style&&(this._lastUpdatedBrightness=a.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<Ft.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Kc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(a,l){const u={};if(!l)return u;for(const d of a){const f=d.layerIds.map(p=>l.getLayer(p)).filter(Boolean);if(0!==f.length){d.layers=f,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(p=>f.filter(g=>g.id===p)[0]));for(const p of f)u[p.fqid]=d}}return u}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const l=this.buckets[a];if(l instanceof Xp){if(this.hasSymbolBuckets=!0,!i)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const l=this.buckets[a];if(l instanceof Xp&&l.hasRTLText){this.hasRTLText=!0,es.isLoading()||es.isLoaded()||"deferred"!==Xs()||kg();break}}this.queryPadding=0;for(const a in this.buckets){const l=this.buckets[a],u=n.style.getOwnLayer(a);if(!u)continue;const d=u.queryRadius(l);this.queryPadding=Math.max(this.queryPadding,d)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new tE}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const i in this.buckets){const a=this.buckets[i];a.uploadPending()&&a.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kr(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kr(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new kr(t,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,n,i){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,i),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const a=n.style.getBrightness();(this._lastUpdatedBrightness||a)&&(this._lastUpdatedBrightness&&a&&Math.abs(this._lastUpdatedBrightness-a)<.001||(this._lastUpdatedBrightness=a,this.updateBuckets(void 0,n)))}queryRenderedFeatures(t,n,i,a,l,u,d,f){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:d,transform:u,params:l,tileTransform:this.tileTransform},t,n,i):{}}querySourceFeatures(t,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const a=i.loadVTLayers(),l=n?n.sourceLayer:"",u=a._geojsonTileLayer||a[l];if(!u)return;const d=Hv(n&&n.filter),{z:f,x:p,y:g}=this.tileID.canonical,_={z:f,x:p,y:g};for(let v=0;v<u.length;v++){const x=u.feature(v);if(d.needGeometry){const T=Gc(x,!0);if(!d.filter(new er(this.tileID.overscaledZ),T,this.tileID.canonical))continue}else if(!d.filter(new er(this.tileID.overscaledZ),x))continue;const b=i.getId(x,l),E=new I_(x,f,p,g,b);E.tile=_,t.push(E)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const i=ee(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const i=Date.now();let a=!1;if(this.expirationTime>i)a=!1;else if(n)if(this.expirationTime<n)a=!0;else{const l=this.expirationTime-n;l?this.expirationTime=i+Math.max(l,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&n&&this.updateBuckets(t,n)}updateBuckets(t,n){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),a=n.style.listImages(),l=n.style.getBrightness();for(const u in this.buckets){if(!n.style.hasLayer(u))continue;const d=this.buckets[u],f=d.layers[0].sourceLayer||"_geojsonTileLayer",p=i[f];let g={};if(t&&(g=t[f],!p||!g||0===Object.keys(g).length))continue;if(d.update(g,p,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},l),d instanceof Yp||d instanceof vd){const v=n.style.getOwnSourceCache(d.layers[0].source);n._terrain&&n._terrain.enabled&&v&&d.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(v.id,this.tileID)}const _=n&&n.style&&n.style.getOwnLayer(u);_&&(this.queryPadding=Math.max(this.queryPadding,_.queryRadius(d)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ft.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Ft.now()+t}setTexture(t,n){const i=n.context,a=i.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new kr(i,t,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(t,n){const i={};for(const a of n)i[a]=!0;this.dependencies[t]=i}hasDependency(t,n){for(const i of t){const a=this.dependencies[i];if(a)for(const l of n)if(a[l])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const i=pl(ZM,this.tileID.canonical,this.tileTransform)[0],a=new wo,l=new qg;for(let u=0;u<i.length;u++){const{x:d,y:f}=i[u];a.emplaceBack(d,f),l.emplaceBack(u)}l.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,Gl.members),this._tileDebugSegments=bn.simpleSegment(0,0,a.length,l.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const i=pl(ZM,this.tileID.canonical,this.tileTransform)[0];let a,l;if(this.isRaster){const u=function(d,f){const p=Kc(d,f),g=Math.pow(2,d.z);for(let T=0;T<33;T++)for(let C=0;C<33;C++){const D=ls((d.x+(C+qM(C))/32)/g),A=zr((d.y+(T+qM(T))/32)/g),P=f.project(D,A),I=33*T+C;oc[2*I+0]=Math.round((P.x*p.scale-p.x)*lt),oc[2*I+1]=Math.round((P.y*p.scale-p.y)*lt)}Pa.fill(0),ty.fill(0);for(let T=2045;T>=0;T--){const C=4*T,D=ic[C+0],A=ic[C+1],P=ic[C+2],I=ic[C+3],R=D+P>>1,k=A+I>>1,L=R+k-A,N=k+D-R,z=33*A+D,j=33*I+P,B=33*k+R,H=Math.hypot((oc[2*z+0]+oc[2*j+0])/2-oc[2*B+0],(oc[2*z+1]+oc[2*j+1])/2-oc[2*B+1])>=16;Pa[B]=Pa[B]||(H?1:0),T<1022&&(Pa[B]=Pa[B]||Pa[33*(A+N>>1)+(D+L>>1)]||Pa[33*(I+N>>1)+(P+L>>1)])}const _=new Ru,v=new Rr;let x=0;function b(T,C){const D=33*C+T;return 0===ty[D]&&(_.emplaceBack(oc[2*D+0],oc[2*D+1],T*lt/32,C*lt/32),ty[D]=++x),ty[D]-1}function E(T,C,D,A,P,I){const R=T+D>>1,k=C+A>>1;if(Math.abs(T-P)+Math.abs(C-I)>1&&Pa[33*k+R])E(P,I,T,C,R,k),E(D,A,P,I,R,k);else{const L=b(T,C),N=b(D,A),z=b(P,I);v.emplaceBack(L,N,z)}}return E(0,0,32,32,32,0),E(32,32,0,0,0,32),{vertices:_,indices:v}}(this.tileID.canonical,n);a=u.vertices,l=u.indices}else{a=new Ru,l=new Rr;for(const{x:d,y:f}of i)a.emplaceBack(d,f,0,0);const u=E_(a.int16,void 0,4);for(let d=0;d<u.length;d+=3)l.emplaceBack(u[d],u[d+1],u[d+2])}this._tileBoundsBuffer=t.createVertexBuffer(a,Jp.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(l),this._tileBoundsSegments=bn.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugBuffers(t,n){const i=n.projection;if(!i||"globe"!==i.name||n.freezeTileCoverage)return;const a=this.tileID.canonical,l=as(u_(a,n)),u=ki(n.zoom);let d;u>0&&(d=nt.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,a,n,l,d,u),this._makeGlobeTileDebugTextBuffer(t,a,n,l,d,u)}_globePoint(t,n,i,a,l,u,d){let f=vp(t,n,i);if(u){const p=1<<i.z,g=Li(a.center.lng),_=Gi(a.center.lat),v=(i.x+.5)/p-g;let x=0;v>.5?x=-1:v<-.5&&(x=1);let b=(t/lt+i.x)/p+x,E=(n/lt+i.y)/p;b=(b-g)*a._pixelsPerMercatorPixel+g,E=(E-_)*a._pixelsPerMercatorPixel+_;const T=[b*a.worldSize,E*a.worldSize,0];G.transformMat4(T,T,u),f=ea(f,T,d)}return G.transformMat4(f,f,l)}_makeGlobeTileDebugBorderBuffer(t,n,i,a,l,u){const d=new wo,f=new qg,p=new zg,g=(v,x,b,E,T)=>{const C=(b-v)/(T-1),D=(E-x)/(T-1),A=d.length;for(let P=0;P<T;P++){const I=v+P*C,R=x+P*D;d.emplaceBack(I,R);const k=this._globePoint(I,R,n,i,a,l,u);p.emplaceBack(k[0],k[1],k[2]),f.emplaceBack(A+P)}},_=lt;g(0,0,_,0,16),g(_,0,_,_,16),g(_,_,0,_,16),g(0,_,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(d,Gl.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(p,zE.members),this._tileDebugSegments=bn.simpleSegment(0,0,d.length,f.length)}_makeGlobeTileDebugTextBuffer(t,n,i,a,l,u){const d=lt/4,f=new wo,p=new Rr,g=new zg,_=25;p.reserve(32),f.reserve(_),g.reserve(_);const v=(x,b)=>_*x+b;for(let x=0;x<_;x++){const b=x*d;for(let E=0;E<_;E++){const T=E*d;f.emplaceBack(T,b);const C=this._globePoint(T,b,n,i,a,l,u);g.emplaceBack(C[0],C[1],C[2])}}for(let x=0;x<4;x++)for(let b=0;b<4;b++){const E=v(x,b),T=v(x,b+1),C=v(x+1,b),D=v(x+1,b+1);p.emplaceBack(E,T,C),p.emplaceBack(C,T,D)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(p),this._tileDebugTextBuffer=t.createVertexBuffer(f,Gl.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(g,zE.members),this._tileDebugTextSegments=bn.simpleSegment(0,0,_,32)}}class Kp{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,i){const a=t.wrapped().key;void 0===this.data[a]&&(this.data[a]=[]);const l={value:n,timeout:void 0};if(void 0!==i&&(l.timeout=setTimeout(()=>{this.remove(t,l)},i)),this.data[a].push(l),this.order.push(a),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const i=t.wrapped().key,a=void 0===n?0:this.data[i].indexOf(n),l=this.data[i][a];return this.data[i].splice(a,1),l.timeout&&clearTimeout(l.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(l.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const i in this.data)for(const a of this.data[i])t(a.value)||n.push(a);for(const i of n)this.remove(i.value.tileID,i)}}let ho=(()=>{class e{constructor(n,i,a,l){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++,this.context=n;const u=n.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||l||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=e.uniqueIdxCounter,e.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return e.uniqueIdxCounter=0,e})();const th={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ey{constructor(t,n,i,a,l,u){this.length=n.length,this.attributes=i,this.itemSize=n.bytesPerElement,this.dynamicDraw=a,this.instanceCount=u,this.context=t;const d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||l||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let i=0;i<this.attributes.length;i++){const a=n.attributes[this.attributes[i].name];void 0!==a&&t.enableVertexAttribArray(a)}}setVertexAttribPointers(t,n,i){for(let a=0;a<this.attributes.length;a++){const l=this.attributes[a],u=n.attributes[l.name];void 0!==u&&t.vertexAttribPointer(u,l.components,t[th[l.type]],!1,this.itemSize,l.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(t,n,i){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];void 0!==l&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(l,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class an{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xl extends an{getDefault(){return Ae.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Rd extends an{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Od extends an{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class kd extends an{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ld extends an{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Fd extends an{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Nd extends an{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class zd extends an{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Bd extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Vd extends an{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class WM extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class XM extends an{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class YM extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class JM extends an{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class KM extends an{getDefault(){return Ae.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class QM extends an{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class tC extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class eC extends an{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class nC extends an{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Ux=class extends an{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class ZS extends an{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class gO extends an{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _O extends an{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class WS extends an{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class XS extends an{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class yO extends an{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class YS extends an{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class vO extends an{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class JS extends an{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class KS extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class QS extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Qp extends an{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class tm extends Qp{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ny extends Qp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ry extends Qp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class rC extends ny{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class em{constructor(t,n,i,a,l){this.context=t,this.width=n,this.height=i;const u=this.framebuffer=t.gl.createFramebuffer();a&&(this.colorAttachment=new tm(t,u)),l&&(this.depthAttachmentType=l,this.depthAttachment="renderbuffer"===l?new ny(t,u):new ry(t,u))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class pe{constructor(t,n,i){this.func=t,this.mask=n,this.range=i}}pe.ReadOnly=!1,pe.ReadWrite=!0,pe.disabled=new pe(519,pe.ReadOnly,[0,1]);class Se{constructor(t,n,i,a,l,u){this.test=t,this.ref=n,this.mask=i,this.fail=a,this.depthFail=l,this.pass=u}}Se.disabled=new Se({func:519,mask:0},0,0,7680,7680,7680);class Je{constructor(t,n,i,a){this.blendFunction=t,this.blendColor=n,this.mask=i,this.blendEquation=a}}Je.Replace=[1,0,1,0],Je.disabled=new Je(Je.Replace,Ae.transparent,[!1,!1,!1,!1]),Je.unblended=new Je(Je.Replace,Ae.transparent,[!0,!0,!0,!0]),Je.alphaBlended=new Je([1,771,1,771],Ae.transparent,[!0,!0,!0,!0]),Je.multiply=new Je([774,0,774,0],Ae.transparent,[!0,!0,!0,!0]);class Fe{constructor(t,n,i){this.enable=t,this.mode=n,this.frontFace=i}}Fe.disabled=new Fe(!1,1029,2305),Fe.backCCW=new Fe(!0,1029,2305),Fe.backCW=new Fe(!0,1029,2304),Fe.frontCW=new Fe(!0,1028,2304),Fe.frontCCW=new Fe(!0,1028,2305);class oy{constructor(t){this.gl=t,this.clearColor=new xl(this),this.clearDepth=new Rd(this),this.clearStencil=new Od(this),this.colorMask=new kd(this),this.depthMask=new Ld(this),this.stencilMask=new Fd(this),this.stencilFunc=new Nd(this),this.stencilOp=new zd(this),this.stencilTest=new Bd(this),this.depthRange=new Vd(this),this.depthTest=new WM(this),this.depthFunc=new XM(this),this.blend=new YM(this),this.blendFunc=new JM(this),this.blendColor=new KM(this),this.blendEquation=new QM(this),this.cullFace=new tC(this),this.cullFaceSide=new eC(this),this.frontFace=new nC(this),this.program=new Ux(this),this.activeTexture=new ZS(this),this.viewport=new gO(this),this.bindFramebuffer=new _O(this),this.bindRenderbuffer=new WS(this),this.bindTexture=new XS(this),this.bindVertexBuffer=new yO(this),this.bindElementBuffer=new YS(this),this.bindVertexArrayOES=new vO(this),this.pixelStoreUnpack=new JS(this),this.pixelStoreUnpackPremultiplyAlpha=new KS(this),this.pixelStoreUnpackFlipY=new QS(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,i){return new ho(this,t,n,i)}createVertexBuffer(t,n,i,a,l){return new ey(this,t,n,i,a,l)}createRenderbuffer(t,n,i){const a=this.gl,l=a.createRenderbuffer();return this.bindRenderbuffer.set(l),a.renderbufferStorage(a.RENDERBUFFER,t,n,i),this.bindRenderbuffer.set(null),l}createFramebuffer(t,n,i,a){return new em(this,t,n,i,a)}clear({color:t,depth:n,stencil:i,colorMask:a}){const l=this.gl;let u=0;t&&(u|=l.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(a||[!0,!0,!0,!0])),void 0!==n&&(u|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(u|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),l.clear(u)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){tn(t.blendFunction,Je.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class fs extends wr{constructor(t,n,i){super(),this.id=t,this._onlySymbols=i,n.on("data",a=>{"source"===a.dataType&&"metadata"===a.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===a.dataType&&"content"===a.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Kp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new CS,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if("errored"!==n.state&&("loaded"!==n.state||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const i=this._tiles[n];i.upload(t),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return vi(this._tiles).map(t=>t.tileID).sort(tI).map(t=>t.key)}getRenderableIds(t,n){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,t,n)&&i.push(this._tiles[a]);return t?i.sort((a,l)=>{const u=a.tileID,d=l.tileID,f=new tt(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),p=new tt(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-d.overscaledZ||p.y-f.y||p.x-f.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(tI).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(i||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=n),this._loadTile(i,this._tileLoaded.bind(this,i,t,n)))}_tileLoaded(t,n,i,a){if(a)if(t.state="errored",404!==a.status)this._source.fire(new pt(a,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const l=this.map.painter.terrain;this.update(this.transform,l.getScaledDemTileSize(),!0),l.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=Ft.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Mt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let a=0;a<n.length;a++){const l=n[a];if(t.neighboringTiles&&t.neighboringTiles[l]){const u=this.getTileByID(l);i(t,u),i(u,t)}}function i(a,l){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let u=l.tileID.canonical.x-a.tileID.canonical.x;const d=l.tileID.canonical.y-a.tileID.canonical.y,f=Math.pow(2,a.tileID.canonical.z),p=l.tileID.key;0===u&&0===d||Math.abs(d)>1||(Math.abs(u)>1&&(1===Math.abs(u+f)?u+=f:1===Math.abs(u-f)&&(u-=f)),l.dem&&a.dem&&(a.dem.backfillBorder(l.dem,u,d),a.neighboringTiles&&a.neighboringTiles[p]&&(a.neighboringTiles[p].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,i,a){for(const l in this._tiles){let u=this._tiles[l];if(a[l]||!u.hasData()||u.tileID.overscaledZ<=n||u.tileID.overscaledZ>i)continue;let d=u.tileID;for(;u&&u.tileID.overscaledZ>n+1;){const p=u.tileID.scaledTo(u.tileID.overscaledZ-1);u=this._tiles[p.key],u&&u.hasData()&&(d=p)}let f=d;for(;f.overscaledZ>n;)if(f=f.scaledTo(f.overscaledZ-1),t[f.key]){a[d.key]=d;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=n?i:null}for(let i=t.overscaledZ-1;i>=n;i--){const a=t.scaledTo(i),l=this._getLoadedTile(a);if(l)return l}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const i=Math.ceil(t.width/n)+1,a=Math.ceil(t.height/n)+1,l=Math.floor(i*a*5),u="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,l):l,d="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(t){const n=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,n){const i={};for(const a in this._tiles){const l=this._tiles[a];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+n),i[l.tileID.key]=l}this._tiles=i;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(t,n,i,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let l;if(this.updateCacheSize(t,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new Ze(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(l=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(f=>this._source.hasTile(f)))):l=[],l.length>0&&this.castsShadows&&a&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!qx(this._source.type)){const f=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),p=Math.min(f,this._source.maxzoom),g=t.extendTileCoverForShadows(l,a,p);for(const _ of g)this._shadowCasterTiles[_.key]=!0,l.push(_)}const u=this._updateRetainedTiles(l);if(qx(this._source.type)&&0!==l.length){const f={},p={},g=Object.keys(u);for(const v of g){const x=u[v],b=this._tiles[v];if(!b||b.fadeEndTime&&b.fadeEndTime<=Ft.now())continue;const E=this.findLoadedParent(x,Math.max(x.overscaledZ-fs.maxOverzooming,this._source.minzoom));E&&(this._addTile(E.tileID),f[E.tileID.key]=E.tileID),p[v]=x}const _=l[l.length-1].overscaledZ;for(const v in this._tiles){const x=this._tiles[v];if(u[v]||!x.hasData())continue;let b=x.tileID;for(;b.overscaledZ>_;){b=b.scaledTo(b.overscaledZ-1);const E=this._tiles[b.key];if(E&&E.hasData()&&p[b.key]){u[v]=x.tileID;break}}}for(const v in f)u[v]||(this._coveredTiles[v]=!0,u[v]=f[v])}for(const f in u)this._tiles[f].clearFadeHold();const d=function(f,p){const g=[];for(const _ in f)_ in p||g.push(_);return g}(this._tiles,u);for(const f of d){const p=this._tiles[f];p.hasSymbolBuckets&&!p.holdingForFade()?p.setHoldDuration(this.map._fadeDuration):p.hasSymbolBuckets&&!p.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(0===t.length)return n;const i={},a=t.reduce((p,g)=>Math.min(p,g.overscaledZ),1/0),l=t[0].overscaledZ,u=Math.max(l-fs.maxOverzooming,this._source.minzoom),d=Math.max(l+fs.maxUnderzooming,this._source.minzoom),f={};for(const p of t){const g=this._addTile(p);n[p.key]=p,g.hasData()||a<this._source.maxzoom&&(f[p.key]=p)}this._retainLoadedChildren(f,a,d,n);for(const p of t){let g=this._tiles[p.key];if(g.hasData())continue;if(p.canonical.z>=this._source.maxzoom){const v=p.children(this._source.maxzoom)[0],x=this.getTile(v);if(x&&x.hasData()){n[v.key]=v;continue}}else{const v=p.children(this._source.maxzoom);if(n[v[0].key]&&n[v[1].key]&&n[v[2].key]&&n[v[3].key])continue}let _=g.wasRequested();for(let v=p.overscaledZ-1;v>=u;--v){const x=p.scaledTo(v);if(i[x.key]||(i[x.key]=!0,g=this.getTile(x),!g&&_&&(g=this._addTile(x)),g&&(n[x.key]=x,_=g.wasRequested(),g.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let i,a=this._tiles[t].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){i=this._loadedParentTiles[a.key];break}n.push(a.key);const l=a.scaledTo(a.overscaledZ-1);if(i=this._getLoadedTile(l),i)break;a=l}for(const l of n)this._loadedParentTiles[l]=i}}_addTile(t){let n=this._tiles[t.key];if(n)return!0!==n.isExtraShadowCaster||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const i=!!n;if(!i){const a=this.map?this.map.painter:null;n=new ds(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,i||this._source.fire(new Mt("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=n.getExpiryTimeout();i&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},i))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,i){const a=[],l=this.transform;if(!l)return a;const u="globe"===l.projection.name,d=Li(l.center.lng);for(const f in this._tiles){const p=this._tiles[f];if(i&&p.clearQueryDebugViz(),p.holdingForFade())continue;let g;if(u){const _=p.tileID.canonical;if(0===_.z){const v=[Math.abs(Wt(d,...nm(_,-1))-d),Math.abs(Wt(d,...nm(_,1))-d)];g=[0,2*v.indexOf(Math.min(...v))-1]}else{const v=[Math.abs(Wt(d,...nm(_,-1))-d),Math.abs(Wt(d,...nm(_,0))-d),Math.abs(Wt(d,...nm(_,1))-d)];g=[v.indexOf(Math.min(...v))-1]}}else g=[0];for(const _ of g){const v=t.containsTile(p,l,n,_);v&&a.push(v)}}return a}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const i=this.getRenderableIds(t,n).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}sortCoordinatesByDistance(t){const n=t.slice(),i=this.transform._camera.position,a=this.transform._camera.forward(),l={};for(const u of n){const d=1/(1<<u.canonical.z);l[u.key]=((u.canonical.x+.5)*d+u.wrap-i[0])*a[0]+((u.canonical.y+.5)*d-i[1])*a[1]-i[2]*a[2]}return n.sort((u,d)=>l[u.key]-l[d.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(qx(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=Ft.now())return!0}return!1}setFeatureState(t,n,i){this._state.updateState(t=t||"_geojsonTileLayer",n,i)}removeFeatureState(t,n,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,i)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,i){const a=this._tiles[t];a&&a.setDependencies(n,i)}reloadTilesForDependencies(t,n){for(const i in this._tiles)this._tiles[i].hasDependency(t,n)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const d=()=>{this._sourceLoaded&&(this._source.off("data",d),this._preloadTiles(t,n))};return void this._source.on("data",d)}const i=new Map,a=Array.isArray(t)?t:[t],l=this.map.painter.terrain,u=this.usedForTerrain&&l?l.getScaledDemTileSize():this._source.tileSize;for(const d of a){const f=d.coveringTiles({tileSize:u,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const p of f)i.set(p.key,p);this.usedForTerrain&&d.updateElevation(!1)}xu(Array.from(i.values()),(d,f)=>{const p=new ds(d,this._source.tileSize*d.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(p,g=>{"raster-dem"===this._source.type&&p.dem&&this._backfillDEM(p),f(g,p)})},n)}}function tI(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function qx(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function nm(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}fs.maxOverzooming=10,fs.maxUnderzooming=3;const Zx=sn([{name:"a_pos_3f",components:3,type:"Float32"}]),eI=sn([{name:"a_color_3f",components:3,type:"Float32"}]),iC=sn([{name:"a_color_4f",components:4,type:"Float32"}]),nI=sn([{name:"a_uv_2f",components:2,type:"Float32"}]),rI=sn([{name:"a_normal_3f",components:3,type:"Float32"}]),iI=sn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),oC=sn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class sy{constructor(t=0,n=0,i=0,a=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0||isNaN(a)||a<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=i,this.right=a}interpolate(t,n,i){return null!=n.top&&null!=t.top&&(this.top=ue(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=ue(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=ue(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=ue(t.right,n.right,i)),this}getCenter(t,n){const i=Wt((this.left+t-this.right)/2,0,t),a=Wt((this.top+n-this.bottom)/2,0,n);return new tt(i,a)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new sy(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function sC(e,t){const n=_r(e,3);nt.fromQuat(e,t),xi(e,3,n)}function Wx(e,t){const n=Oi.identity([]);return Oi.rotateZ(n,n,-t),Oi.rotateX(n,n,-e),n}function aC(e,t){const n=[e[0],e[1],0],i=[t[0],t[1],0];if(G.length(n)>=1e-15){const u=G.normalize([],n);G.scale(i,u,G.dot(i,u)),t[0]=i[0],t[1]=i[1]}const a=G.cross([],t,e);if(G.len(a)<1e-15)return null;const l=Math.atan2(-a[1],a[0]);return Wx(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),l)}class lC{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof Ge?t:new Ge(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=Ja(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const i=this.position,a=this._elevation?this._elevation.getAtPointOrZero(Ge.fromLngLat(t)):0,l=Ge.fromLngLat(t,a),u=[l.x-i.x,l.y-i.y,l.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=aC(u,n)}setPitchBearing(t,n){this.orientation=Wx(Ee(t),Ee(-n))}}class jd{constructor(t,n){this._transform=nt.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new Ge(t[0],t[1],t[2])}get position(){const t=_r(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&xi(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||Oi.identity([]),t&&sC(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=Wx(t,n),sC(this._transform,this._orientation)}forward(){const t=_r(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=_r(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=_r(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const i=new Float64Array(16);return nt.invert(i,this.getWorldToCamera(t,n)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,i){const a=this.position;G.scale(a,a,-t);const l=new Float64Array(16);return nt.fromScaling(l,[i,i,i]),nt.translate(l,l,a),l[10]*=n,l}getWorldToCamera(t,n){const i=new Float64Array(16),a=new Float64Array(4),l=this.position;return Oi.conjugate(a,this._orientation),G.scale(l,l,-t),nt.fromQuat(i,a),nt.translate(i,i,l),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(t,n,i,a){const l=new Float64Array(16);return nt.perspective(l,t,n,i,a),l}getCameraToClipOrthographic(t,n,i,a,l,u){const d=new Float64Array(16);return nt.ortho(d,t,n,i,a,l,u),d}getDistanceToElevation(t,n=!1){const i=0===t?0:xn(t,n?zr(this.position[1]):this.position[1]),a=this.forward();return(i-this.position[2])/a[2]}clone(){return new jd([...this.position],[...this.orientation])}}function ay(e,t){const n=jo(e.projection,e.zoom,e.width,e.height),i=function(l,u,d,f,p){const g=new _e(d.lng-180*fo,d.lat),_=new _e(d.lng+180*fo,d.lat),v=l.project(g.lng,g.lat),x=l.project(_.lng,_.lat),b=-Math.atan2(x.y-v.y,x.x-v.x),E=Ge.fromLngLat(d);E.y=Wt(E.y,-1+fo,1-fo);const T=E.toLngLat(),C=l.project(T.lng,T.lat),D=Ge.fromLngLat(T);D.x+=fo;const A=D.toLngLat(),P=l.project(A.lng,A.lat),I=Xx(P.x-C.x,P.y-C.y,b),R=Ge.fromLngLat(T);R.y+=fo;const k=R.toLngLat(),L=l.project(k.lng,k.lat),N=Xx(L.x-C.x,L.y-C.y,b),z=Math.abs(I.x)/Math.abs(N.y),j=nt.identity([]);nt.rotateZ(j,j,-b*(1-(p?0:f)));const B=nt.identity([]);return nt.scale(B,B,[1,1-(1-z)*f,1]),B[4]=-N.x/N.y*f,nt.rotateZ(B,B,b),nt.multiply(B,j,B),B}(e.projection,0,e.center,n,t),a=cC(e);return nt.scale(i,i,[a,a,1]),i}function cC(e){const t=e.projection,n=jo(e.projection,e.zoom,e.width,e.height),i=Ud(t,e.center),a=Ud(t,_e.convert(t.center));return Math.pow(2,i*n+(1-n)*a)}function jo(e,t,n,i,a=1/0){const l=e.range;if(!l)return 0;const u=Math.min(a,Math.max(n,i)),d=Math.log(u/1024)/Math.LN2;return Ya(l[0]+d,l[1]+d,t)}const fo=1/4e4;function Ud(e,t){const n=Wt(t.lat,-Er,Er),i=new _e(t.lng-180*fo,n),a=new _e(t.lng+180*fo,n),l=e.project(i.lng,n),u=e.project(a.lng,n),d=Ge.fromLngLat(i),f=Ge.fromLngLat(a),p=u.x-l.x,g=u.y-l.y,_=f.x-d.x,v=f.y-d.y,x=Math.sqrt((_*_+v*v)/(p*p+g*g));return Math.log(x)/Math.LN2}function Xx(e,t,n){const i=Math.cos(n),a=Math.sin(n);return{x:e*i-t*a,y:e*a+t*i}}function eh(e,t,n){return t*(lt/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}const $d={unknown:0,flipRequired:1,flipNotRequired:2},oI=Math.tan(85*Math.PI/180);function Hd(e,t,n,i,a,l,u){const d=nt.create();if(n)if("globe"===l.name){const f=function(p,g){const{x:_,y:v}=p.point,x=iS(_,v,p.worldSize/p._pixelsPerMercatorPixel,0,0);return nt.multiply(x,x,Hu(uo(g)))}(a,t);nt.multiply(d,d,f)}else{const f=sd.invert([],u);d[0]=f[0],d[1]=f[1],d[4]=f[2],d[5]=f[3],i||nt.rotateZ(d,d,a.angle)}else nt.multiply(d,a.labelPlaneMatrix,e);return d}function ly(e,t,n,i,a,l,u){const d=Hd(e,t,n,i,a,l,u);return"globe"===l.name&&n||(d[2]=d[6]=d[10]=d[14]=0),d}function Yx(e,t,n,i,a,l,u){if(n){if("globe"===l.name){const d=Hd(e,t,n,i,a,l,u);return nt.invert(d,d),nt.multiply(d,e,d),d}{const d=nt.clone(e),f=nt.identity([]);return f[0]=u[0],f[1]=u[1],f[4]=u[2],f[5]=u[3],nt.multiply(d,d,f),i||nt.rotateZ(d,d,-a.angle),d}}return a.glCoordMatrix}function ia(e,t,n,i){const a=[e,t,n,1];n?vn.transformMat4(a,a,i):Qx(a,a,i);const l=a[3];return a[0]/=l,a[1]/=l,a[2]/=l,a}function uC(e,t){return Math.min(.5+e/t*.5,1.5)}function sI(e,t){const n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function aI(e,t,n,i,a,l,u,d,f,p){const g=n.transform,_=i?e.textSizeData:e.iconSizeData,v=tc(_,n.transform.zoom),x="globe"===g.projection.name,b=[256/n.width*2+1,256/n.height*2+1],E=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;E.clear();let T=null;x&&(T=i?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const C=e.lineVertexArray,D=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,A=n.transform.width/n.transform.height;let P,I=!1;for(let R=0;R<D.length;R++){const k=D.get(R),{numGlyphs:L,writingMode:N}=k;if(N!==Hn.vertical||I||P===Hn.horizontal||(I=!0),P=N,(k.hidden||N===Hn.vertical)&&!I){nh(L,E);continue}I=!1;const z=new tt(k.tileAnchorX,k.tileAnchorY);let{x:j,y:B,z:H}=g.projection.projectTilePoint(z.x,z.y,p.canonical);if(f){const[dt,gt,at]=f(z);j+=dt,B+=gt,H+=at}const V=[j,B,H,1];if(vn.transformMat4(V,V,t),!sI(V,b)){nh(L,E);continue}const Z=V[3],Q=uC(n.transform.getCameraToCenterDistance(g.projection),Z),et=Bp(_,v,k),W=u?et/Q:et*Q,X=ia(j,B,H,a);if(X[3]<=0){nh(L,E);continue}let rt={};const ot=u?null:f,ct=Uo(k,W,!1,d,t,a,l,e.glyphOffsetArray,C,E,T,X,z,rt,A,ot,g.projection,p,u);I=ct.useVertical,ot&&ct.needsFlipping&&(rt={}),(ct.notEnoughRoom||I||ct.needsFlipping&&Uo(k,W,!0,d,t,a,l,e.glyphOffsetArray,C,E,T,X,z,rt,A,ot,g.projection,p,u).notEnoughRoom)&&nh(L,E)}i?(e.text.dynamicLayoutVertexBuffer.updateData(E),T&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(T)):(e.icon.dynamicLayoutVertexBuffer.updateData(E),T&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(T))}function Gd(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E){const{lineStartIndex:T,glyphStartIndex:C,segment:D}=d,A=C+d.numGlyphs,P=T+d.lineLength,I=t.getoffsetX(C),R=t.getoffsetX(A-1),k=rm(e*I,n,i,a,l,u,D,T,P,f,p,g,_,v,!0,x,b,E);if(!k)return null;const L=rm(e*R,n,i,a,l,u,D,T,P,f,p,g,_,v,!0,x,b,E);return L?{first:k,last:L}:null}function Jx(e,t,n,i){return e===Hn.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:e===Hn.vertical?i>0?{needsFlipping:!0}:null:t!==$d.unknown&&(0===(a=n)||Math.abs(i/a)>oI)?t===$d.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null;var a}function Uo(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D){const A=t/24,P=e.lineOffsetX*A,I=e.lineOffsetY*A,{lineStartIndex:R,glyphStartIndex:k,numGlyphs:L,segment:N,writingMode:z,flipState:j}=e,B=R+e.lineLength,H=V=>{if(g){const[W,X,rt]=V.up,ot=p.length;K_(g,ot+0,W,X,rt),K_(g,ot+1,W,X,rt),K_(g,ot+2,W,X,rt),K_(g,ot+3,W,X,rt)}const[Z,Q,et]=V.point;Pd(p,Z,Q,et,V.angle)};if(L>1){const V=Gd(A,d,P,I,n,_,v,e,f,l,x,E,!1,T,C,D);if(!V)return{notEnoughRoom:!0};if(i&&!n){let[Z,Q,et]=V.first.point,[W,X,rt]=V.last.point;[Z,Q]=ia(Z,Q,et,u),[W,X]=ia(W,X,rt,u);const ot=Jx(z,j,(W-Z)*b,X-Q);if(e.flipState=ot&&ot.needsFlipping?$d.flipRequired:$d.flipNotRequired,ot)return ot}H(V.first);for(let Z=k+1;Z<k+L-1;Z++){const Q=rm(A*d.getoffsetX(Z),P,I,n,_,v,N,R,B,f,l,x,E,!1,!1,T,C,D);if(!Q)return p.length-=4*(Z-k),{notEnoughRoom:!0};H(Q)}H(V.last)}else{if(i&&!n){const Z=ia(v.x,v.y,0,a),Q=R+N+1,et=new tt(f.getx(Q),f.gety(Q)),W=ia(et.x,et.y,0,a),X=W[3]>0?W:hC(v,et,Z,1,a,void 0,T,C.canonical),rt=Jx(z,j,(X[0]-Z[0])*b,X[1]-Z[1]);if(e.flipState=rt&&rt.needsFlipping?$d.flipRequired:$d.flipNotRequired,rt)return rt}const V=rm(A*d.getoffsetX(k),P,I,n,_,v,N,R,B,f,l,x,E,!1,!1,T,C,D);if(!V)return{notEnoughRoom:!0};H(V)}return{}}function Kx(e,t,n,i,a){const{x:l,y:u,z:d}=i.projectTilePoint(e.x,e.y,t);if(!a)return ia(l,u,d,n);const[f,p,g]=a(e);return ia(l+f,u+p,d+g,n)}function hC(e,t,n,i,a,l,u,d){const f=Kx(e.sub(t)._unit()._add(e),d,a,u,l);return G.sub(f,n,f),G.normalize(f,f),G.scaleAndAdd(f,n,f,i)}function rm(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C){const D=i?e-t:e+t;let A=D>0?1:-1,P=0;i&&(A*=-1,P=Math.PI),A<0&&(P+=Math.PI);let I=d+u+(A>0?0:1)|0,R=a,k=a,L=0,N=0;const z=Math.abs(D),j=[],B=[];let H=l,V=H;const Z=()=>hC(V,H,k,z-L+1,g,v,E,T.canonical);for(;L+N<=z;){if(I+=A,I<d||I>=f)return null;if(k=R,V=H,j.push(k),x&&B.push(V),H=new tt(p.getx(I),p.gety(I)),R=_[I],!R){const gt=Kx(H,T.canonical,g,E,v);R=gt[3]>0?_[I]=gt:Z()}L+=N,N=G.distance(k,R)}b&&v&&(_[I]&&(R=Z(),N=G.distance(k,R)),_[I]=R);const Q=(z-L)/N,et=H.sub(V)._mult(Q)._add(V),W=G.sub([],R,k),X=G.scaleAndAdd([],k,W,Q);let rt=[0,0,1],ot=W[0],ct=W[1];if(C&&(rt=E.upVector(T.canonical,et.x,et.y),0!==rt[0]||0!==rt[1]||1!==rt[2])){const gt=[rt[2],0,-rt[0]],at=G.cross([],rt,gt);G.normalize(gt,gt),G.normalize(at,at),ot=G.dot(W,gt),ct=G.dot(W,at)}if(n){const gt=G.cross([],rt,W);G.normalize(gt,gt),G.scaleAndAdd(X,X,gt,n*A)}const dt=P+Math.atan2(ct,ot);return j.push(X),x&&B.push(et),{point:X,angle:dt,path:j,tilePath:B,up:rt}}function nh(e,t){const n=t.length,i=n+4*e;t.resize(i),t.float32.fill(-1/0,4*n,4*i)}function Qx(e,t,n){const i=t[0],a=t[1];return e[0]=n[0]*i+n[4]*a+n[12],e[1]=n[1]*i+n[5]*a+n[13],e[3]=n[3]*i+n[7]*a+n[15],e}const dC=(e,t,n)=>(1-n)*e+n*t,fC=e=>e*e*e*e*e;class t1{constructor(t,n,i,a,l,u,d){this.tileSize=512,this._renderWorldCopies=void 0===l||l,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=i??0,this._maxPitch=a??60,this.setProjection(u),this.setMaxBounds(d),this.width=0,this.height=0,this._center=new _e(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new sy,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new jd,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new t1(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,n=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(t||i)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return Ro(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=Wp(this.projectionOptions);const i=!tn(n,this.getProjection());return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Wp({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return xn(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new tt(this.width,this.height)}get bearing(){return Ja(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=sd.create(),sd.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=Wt(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=Ee(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let a=0,l=0;for(let u=0;u<n.length;u++){const d=new tt(n[u][0]*this.width,i+n[u][1]*(this.height-i)),f=t.pointCoordinate(d);if(!f)continue;const p=1/Math.hypot(f[0]-this._camera.position[0],f[1]-this._camera.position[1]);a+=f[3]*p,l+=p}return 0===l?NaN:a/l}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*n,a=this._mercatorZfromZoom(t),l=this._mercatorZfromZoom(this._maxZoom),u=Math.max(a-i,l);this._setZoom(this._zoomFromMercatorZ(u))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let i;i=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const a=G.length(G.sub([],this._camera.position,i));return Wt(this._zoomFromMercatorZ(a),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!Oi.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const i=[t.position.x,t.position.y,t.position.z];G.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new lC;return n.position=new Ge(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!Oi.length(t))return!1;Oi.normalize(t,t);const n=G.transformQuat([],[0,0,-1],t),i=G.transformQuat([],[0,-1,0],t);if(i[2]<0)return!1;const a=aC(n,i);return!!a&&(this._camera.orientation=a,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,a=this.cameraToCenterDistance;t[2]=Wt(t[2],a/i,a/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,i){this._unmodified=!1,this._edgeInsets.interpolate(t,n,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new l_(0,t)];if(this.renderWorldCopies){const i=this.pointCoordinate(new tt(0,0)),a=this.pointCoordinate(new tt(this.width,0)),l=this.pointCoordinate(new tt(this.width,this.height)),u=this.pointCoordinate(new tt(0,this.height)),d=Math.floor(Math.min(i.x,a.x,l.x,u.x)),f=Math.floor(Math.max(i.x,a.x,l.x,u.x)),p=1;for(let g=d-p;g<=f+p;g++)0!==g&&n.push(new l_(g,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,n,i){let a=[];if(0===n[0]&&0===n[1])return a;for(const u of t){const d=u.canonical,f=u.overscaledZ,p=u.wrap,g=1<<d.z,_=d.x+1<g,v=d.x>0,x=d.y+1<g,b=d.y>0,E=u.wrap-(v?0:1),T=u.wrap+(_?0:1),C=v?d.x-1:g-1,D=_?d.x+1:0;n[0]<0?(a.push(new Ze(f,T,d.z,D,d.y)),n[1]<0&&x&&(a.push(new Ze(f,p,d.z,d.x,d.y+1)),a.push(new Ze(f,T,d.z,D,d.y+1))),n[1]>0&&b&&(a.push(new Ze(f,p,d.z,d.x,d.y-1)),a.push(new Ze(f,T,d.z,D,d.y-1)))):n[0]>0?(a.push(new Ze(f,E,d.z,C,d.y)),n[1]<0&&x&&(a.push(new Ze(f,p,d.z,d.x,d.y+1)),a.push(new Ze(f,E,d.z,C,d.y+1))),n[1]>0&&b&&(a.push(new Ze(f,p,d.z,d.x,d.y-1)),a.push(new Ze(f,E,d.z,C,d.y-1)))):n[1]<0&&x?a.push(new Ze(f,p,d.z,d.x,d.y+1)):b&&a.push(new Ze(f,p,d.z,d.x,d.y-1))}if(a.length>1){a.sort((f,p)=>f.overscaledZ-p.overscaledZ||f.wrap-p.wrap||f.canonical.z-p.canonical.z||f.canonical.x-p.canonical.x||f.canonical.y-p.canonical.y);let u=0,d=0;for(;d<a.length;)a[d].equals(a[u])?++d:a[++u]=a[d++];a.length=u+1}const l=[];for(const u of a)a.some(d=>u.isChildOf(d))||l.push(u);return a=l.filter(u=>!t.some(d=>!!(u.overscaledZ<i&&d.isChildOf(u))||u.equals(d)||u.isChildOf(d))),a}coveringTiles(t){let n=this.coveringZoomLevel(t);const i=n,a=this.elevation&&this.elevation.exaggeration(),l=a&&!t.isTerrainDEM,u="mercator"===this.projection.name;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const d=this.locationCoordinate(this.center),f=this.center.lat,p=1<<n,g=[p*d.x,p*d.y,0],_="globe"===this.projection.name,v=!_,x=fl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,v),b=_?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),E=p*xn(1,this.center.lat),T=this._camera.position[2]/xn(1,this.center.lat),C=[p*b.x,p*b.y,T*(v?1:E)],D=_||a,A=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),P=this.isLODDisabled(!0)?n:0,I=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,R=t.isTerrainDEM?-I:this._elevation?this._elevation.getMinElevationBelowMSL():0,k=this.projection.isReprojectedInTileSpace?cC(this):1,L=W=>{const rt=new Ge(W.x+25e-6,W.y,W.z),ot=new Ge(W.x,W.y+25e-6,W.z),ct=W.toLngLat(),dt=rt.toLngLat(),gt=ot.toLngLat(),at=this.locationCoordinate(ct),ut=this.locationCoordinate(dt),St=this.locationCoordinate(gt),Nt=Math.hypot(ut.x-at.x,ut.y-at.y),zt=Math.hypot(St.x-at.x,St.y-at.y);return Math.sqrt(Nt*zt)*k/25e-6},N=W=>{const X=I,rt=R;return{aabb:q_(this,p,0,0,0,W,rt,X,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:X,wrap:W,fullyVisible:!1}},z=[];let j=[];const B=n,H=t.reparseOverscaled?i:n,V=W=>W*W,Z=V((T-this._centerAltitude)*E),Q=W=>{if(!this._elevation||!W.tileID||!u)return;const X=this._elevation.getMinMaxForTile(W.tileID),rt=W.aabb;X?(rt.min[2]=X.min,rt.max[2]=X.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(W.shouldSplit=et(W),W.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},et=W=>{if(W.zoom<P)return!0;if(W.zoom===B)return!1;if(null!=W.shouldSplit)return W.shouldSplit;const X=W.aabb.distanceX(C),rt=W.aabb.distanceY(C);let ot=Z,ct=1;if(_){ot=V(W.aabb.distanceZ(C));const at=Math.pow(2,W.zoom),ut=zr((W.y+1)/at),St=zr(W.y/at),Nt=Math.min(Math.max(f,ut),St),zt=dd(Nt)/dd(f);if(ct=Nt===f?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zt/this._mercatorScaleRatio),this.zoom<=gp&&W.zoom===B-1&&zt>=.9)return!0}else if(l&&(ot=V(W.aabb.distanceZ(C)*E)),this.projection.isReprojectedInTileSpace&&i<=5){const at=Math.pow(2,W.zoom),ut=L(new Ge((W.x+.5)/at,(W.y+.5)/at));ct=ut>.85?1:ut}const dt=X*X+rt*rt+ot;return dt<V((1<<B-W.zoom)*A*ct*((at,ut)=>{if(ut*V(.707)<at)return 1;const St=Math.sqrt(ut/at);return St/(1.4144271570014144+(Math.pow(1.1,St-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ot,Z),dt))};if(this.renderWorldCopies)for(let W=1;W<=3;W++)z.push(N(-W)),z.push(N(W));for(z.push(N(0));z.length>0;){const W=z.pop(),X=W.x,rt=W.y;let ot=W.fullyVisible;const ct=()=>"globe"===this.projection.name&&(0===W.y||W.y===(1<<W.zoom)-1);if(!ot){let dt=D?W.aabb.intersects(x):W.aabb.intersectsFlat(x);if(0===dt&&ct()){const gt=new Qs(W.zoom,X,rt);dt=h_(this,p,gt,!0).intersects(x)}if(0===dt)continue;ot=2===dt}if(W.zoom!==B&&et(W))for(let dt=0;dt<4;dt++){const gt=(X<<1)+dt%2,at=(rt<<1)+(dt>>1),ut={aabb:u?W.aabb.quadrant(dt):q_(this,p,W.zoom+1,gt,at,W.wrap,W.minZ,W.maxZ,this.projection),zoom:W.zoom+1,x:gt,y:at,wrap:W.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:W.minZ,maxZ:W.maxZ};l&&!_&&(ut.tileID=new Ze(W.zoom+1===B?H:W.zoom+1,W.wrap,W.zoom+1,gt,at),Q(ut)),z.push(ut)}else{const dt=W.zoom===B?H:W.zoom;if(t.minzoom&&t.minzoom>dt)continue;if(!ot){let St=D?W.aabb.intersectsPrecise(x):W.aabb.intersectsPreciseFlat(x);if(0===St&&ct()){const Nt=new Qs(W.zoom,X,rt);St=h_(this,p,Nt,!0).intersectsPrecise(x)}if(0===St)continue}const gt=g[0]-(.5+X+(W.wrap<<W.zoom))*(1<<n-W.zoom),at=g[1]-.5-rt,ut=W.tileID?W.tileID:new Ze(dt,W.wrap,W.zoom,X,rt);j.push({tileID:ut,distanceSq:gt*gt+at*at})}}if(this.fogCullDistSq){const W=this.fogCullDistSq,X=this.horizonLineFromTop();j=j.filter(rt=>{const ot=[0,0,0,1],ct=[lt,lt,0,1],dt=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());vn.transformMat4(ot,ot,dt),vn.transformMat4(ct,ct,dt);const gt=function(St,Nt,zt){let Vt=0;for(let Kt=0;Kt<2;++Kt)St[Kt]>0&&(Vt+=(St[Kt]-0)*(St[Kt]-0)),Nt[Kt]<0&&(Vt+=(0-Nt[Kt])*(0-Nt[Kt]));return Vt}(vn.min([],ot,ct),vn.max([],ot,ct));if(0===gt)return!0;let at=!1;const ut=this._elevation;if(ut&&gt>W&&0!==X){const St=this.calculateProjMatrix(rt.tileID.toUnwrapped());let Nt;t.isTerrainDEM||(Nt=ut.getMinMaxForTile(rt.tileID)),Nt||(Nt={min:R,max:I});const zt=function(Kt){const he=Math.round((Kt+45+360)%360/90)%4;return Mv[he]}(this.rotation),Vt=[zt[0]*lt,zt[1]*lt,Nt.max];G.transformMat4(Vt,Vt,St),at=(1-Vt[1])*this.height*.5<X}return gt<W||at})}return j.sort((W,X)=>W.distanceSq-X.distanceSq).map(W=>W.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=Wt(t.lat,-Er,Er),i=this.projection.project(t.lng,n);return new tt(i.x*this.worldSize,i.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/xn(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let i,a;const l=this.centerPoint;if("globe"===this.projection.name){const d=this.worldSize;i=(n.x-l.x)/d,a=(n.y-l.y)/d}else{const d=this.pointCoordinate(n),f=this.pointCoordinate(l);i=d.x-f.x,a=d.y-f.y}const u=this.locationCoordinate(t);this.setLocation(new Ge(u.x-i,u.y-a))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,n){const i=n?xn(n,t.lat):void 0,a=this.projection.project(t.lng,t.lat);return new Ge(a.x,a.y,i)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const i=n??this._centerAltitude,a=[t.x,t.y,0,1],l=[t.x,t.y,1,1];vn.transformMat4(a,a,this.pixelMatrixInverse),vn.transformMat4(l,l,this.pixelMatrixInverse);const u=l[3];vn.scale(a,a,1/a[3]),vn.scale(l,l,1/u);const d=a[2],f=l[2];return{p0:a,p1:l,t:d===f?0:(i-d)/(f-d)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return vn.transformMat4(n,n,this.pixelMatrixInverse),vn.transformMat4(i,i,this.pixelMatrixInverse),vn.scale(n,n,1/n[3]),vn.scale(i,i,1/i[3]),n[2]=xn(n[2],this._center.lat)*this.worldSize,i[2]=xn(i[2],this._center.lat)*this.worldSize,vn.scale(n,n,1/this.worldSize),vn.scale(i,i,1/this.worldSize),new ad([n[0],n[1],n[2]],G.normalize([],G.sub([],i,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:i,t:a}=t,l=xn(n[2],this._center.lat),u=xn(i[2],this._center.lat);return new Ge(ue(n[0],i[0],a)/this.worldSize,ue(n[1],i[1],a)/this.worldSize,ue(l,u,a))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new Ge(n[0],n[1],n[2]);let i=0,a=this.horizonLineFromTop();if(t.y>a)return this.pointCoordinate(t);const l=.02*a,u=t.clone();for(let d=0;d<10&&a-i>l;d++){u.y=ue(i,a,.66);const f=this.projection.pointCoordinate3D(this,u.x,u.y);f?(a=u.y,n=f):i=u.y}return n?new Ge(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=$c)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,a=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return vn.transformMat4(a,a,this.pixelMatrix),a[3]>0?new tt(a[0]/a[3],a[1]/a[3]):new tt(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,l=this.pointLocation3D(new tt(n,t)),u=this.pointLocation3D(new tt(a,t)),d=this.pointLocation3D(new tt(a,i)),f=this.pointLocation3D(new tt(n,i));let p=Math.min(l.lng,u.lng,d.lng,f.lng),g=Math.max(l.lng,u.lng,d.lng,f.lng),_=Math.min(l.lat,u.lat,d.lat,f.lat),v=Math.max(l.lat,u.lat,d.lat,f.lat);const x=Math.pow(2,-this.zoom)/16*270,b="globe"===this.projection.name?1:4,E=(T,C,D,A,P)=>{const I=(T+D)/2,R=(C+A)/2,k=new tt(I,R),{lng:L,lat:N}=this.pointLocation3D(k),z=Math.max(0,p-L,_-N,L-g,N-v);p=Math.min(p,L),g=Math.max(g,L),_=Math.min(_,N),v=Math.max(v,N),(P<b||z>x)&&(E(T,C,I,R,P+1),E(I,R,D,A,P+1))};if(E(n,t,a,t,1),E(a,t,a,i,1),E(a,i,n,i,1),E(n,i,n,t,1),"globe"===this.projection.name){const[T,C]=function(D){const A=nt.identity(new Float64Array(16));nt.multiply(A,D.pixelMatrix,D.globeMatrix);const P=[0,co,0],I=[0,ta,0];return G.transformMat4(P,P,A),G.transformMat4(I,I,A),[P[0]>0&&P[0]<=D.width&&P[1]>0&&P[1]<=D.height&&!p_(D,new _e(D.center.lat,90)),I[0]>0&&I[0]<=D.width&&I[1]>0&&I[1]<=D.height&&!p_(D,new _e(D.center.lat,-90))]}(this);T?(v=90,g=180,p=-180):C&&(_=-90,g=180,p=-180)}return new Rs(new _e(p,_),new _e(g,v))}_getBoundsRectangular(t,n){const{top:i,left:a}=this._edgeInsets,l=this.height-this._edgeInsets.bottom,u=this.width-this._edgeInsets.right,d=new tt(a,i),f=new tt(u,i),p=new tt(u,l),g=new tt(a,l);let _=this.pointCoordinate(d,t),v=this.pointCoordinate(f,t);const x=this.pointCoordinate(p,n),b=this.pointCoordinate(g,n),E=(T,C)=>(C.y-T.y)/(C.x-T.x);return _.y>1&&v.y>=0?_=new Ge((1-b.y)/E(b,_)+b.x,1):_.y<0&&v.y<=1&&(_=new Ge(-b.y/E(b,_)+b.x,0)),v.y>1&&_.y>=0?v=new Ge((1-x.y)/E(x,v)+x.x,1):v.y<0&&_.y<=1&&(v=new Ge(-x.y/E(x,v)+x.x,0)),(new Rs).extend(this.coordinateLocation(_)).extend(this.coordinateLocation(v)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(x))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((i,a)=>{if(a.dem){const l=a.dem.tree;i.min=Math.min(i.min,l.minimums[0]),i.max=Math.max(i.max,l.maximums[0])}return i},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-Er,this.maxLat=Er,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Li(this.minLng)*this.tileSize,this.worldMaxX=Li(this.maxLng)*this.tileSize,this.worldMinY=Gi(this.maxLat)*this.tileSize,this.worldMaxY=Gi(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,i=this._distanceTileDataCache;if(i[n])return i[n];const a=t.canonical,l=1/this.height,u=this.cameraWorldSize,d=u/this.zoomScale(a.z),f=(a.x+Math.pow(2,a.z)*t.wrap)*d,p=a.y*d,g=this.point;g.x*=u/this.worldSize,g.y*=u/this.worldSize;const _=this.angle,v=Math.sin(-_),x=-Math.cos(-_);return i[n]={bearing:[v,x],center:[(g.x-f)*l,(g.y-p)*l],scale:d/lt*l},i[n]}calculateFogTileMatrix(t){const n=t.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const a=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return nt.multiply(a,this.worldToFogMatrix,a),i[n]=new Float32Array(a),i[n]}calculateProjMatrix(t,n=!1){const i=t.key,a=n?this._alignedProjMatrixCache:this._projMatrixCache;if(a[i])return a[i];const l=this.calculatePosMatrix(t,this.worldSize);return nt.multiply(l,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.alignedProjMatrix:this.projMatrix,l),a[i]=new Float32Array(l),a[i]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];const a=function(l,u){const{scale:d}=l.tileTransform,f=d*lt/(l.tileSize*Math.pow(2,u.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return sd.scale(new Float32Array(4),u.inverseAdjustmentMatrix,[f,f])}(t,this);return i[n]=a,i[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,n=nt.fromScaling([],[t,t,t]);return nt.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const n=xn(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),a=this._camera.forward(),l=xn(1,this._center.lat);i[2]/=l,a[2]/=l,G.normalize(a,a);const u=t.raycast(i,a,t.exaggeration());if(u){const d=G.scaleAndAdd([],i,a,u),f=new Ge(d[0],d[1],xn(d[2],zr(d[1]))),p=(f.z+G.length([f.x-i[0],f.y-i[1],f.z-i[2]*l]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(p),this._centerAltitude=f.toAltitude(),this._center=this.coordinateLocation(f),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,i=xn(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(i),l=n.getAtPointOrZero(new Ge(...a)),u=this.pixelsPerMeter/this.worldSize*l,d=this._minimumHeightOverTerrain(),f=a[2]-u;if(f<=d)if(f<0||t){const p=this.locationCoordinate(this._center,this._centerAltitude),g=[a[0],a[1],p.z-a[2]],_=G.length(g);g[2]-=(d-f)/this._pixelsPerMercatorPixel;const v=G.length(g);if(0===v)return;G.scale(g,g,_/v*this._pixelsPerMercatorPixel),this._camera.position=[a[0],a[1],p.z*this._pixelsPerMercatorPixel-g[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const v=this.center;return v.lat=Wt(v.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(v.lng=Wt(v.lng,this.minLng,this.maxLng)),this.center=v,void(this._constraining=!1)}const n=this._unmodified,{x:i,y:a}=this.point;let l=0,u=i,d=a;const f=this.width/2,p=this.height/2,g=this.worldMinY*this.scale,_=this.worldMaxY*this.scale;if(a-p<g&&(d=g+p),a+p>_&&(d=_-p),_-g<this.height&&(l=Math.max(l,this.height/(_-g)),d=(_+g)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const v=this.worldMinX*this.scale,x=this.worldMaxX*this.scale,b=this.worldSize/2-(v+x)/2;u=(i+b+this.worldSize)%this.worldSize-b,u-f<v&&(u=v+f),u+f>x&&(u=x-f),x-v<this.width&&(l=Math.max(l,this.width/(x-v)),u=(x+v)/2)}u===i&&d===a||(this.center=this.unproject(new tt(u,d))),l&&(this.zoom+=this.scaleZoom(l)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n="globe"===this.projection.name,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=xn(1,this.center.lat)/xn(1,45));const a=jo(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const l="meters"===this.projection.zAxisUnit?i:1,u=this._camera.getWorldToCamera(this.worldSize,l);let d;const f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(f[8]=2*-t.x/this.width,f[9]=2*t.y/this.height,this.isOrthographic){let N=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),z=N*this.aspect,j=-z,B=-N;z-=t.x,j-=t.x,N+=t.y,B+=t.y,d=this._camera.getCameraToClipOrthographic(j,z,B,N,this._nearZ,this._farZ),((H,V,Z,Q)=>{for(let et=0;et<16;et++)H[et]=dC(V[et],Z[et],Q)})(d,d,f,fC(this.pitch>=15?1:this.pitch/15))}else d=f;const p=nt.mul([],f,u);let g=nt.mul([],d,u);if(this.projection.isReprojectedInTileSpace){const N=this.locationCoordinate(this.center),z=nt.identity([]);nt.translate(z,z,[N.x*this.worldSize,N.y*this.worldSize,0]),nt.multiply(z,z,ay(this)),nt.translate(z,z,[-N.x*this.worldSize,-N.y*this.worldSize,0]),nt.multiply(g,g,z),nt.multiply(p,p,z),this.inverseAdjustmentMatrix=function(j){const B=ay(j,!0);return sd.invert([],[B[0],B[1],B[4],B[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=nt.scale([],g,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=g,this.invProjMatrix=nt.invert(new Float64Array(16),this.projMatrix);const _=nt.invert([],d);this.frustumCorners=ld.fromInvProjectionMatrix(_,this.horizonLineFromTop(),this.height),this.cameraFrustum=fl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const v=new Float32Array(16);nt.identity(v),nt.scale(v,v,[1,-1,1]),nt.rotateX(v,v,this._pitch),nt.rotateZ(v,v,this.angle);const x=nt.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=nt.clone(x);const b=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;x[8]=2*-t.x/this.width,x[9]=2*(t.y+b)/this.height,this.skyboxMatrix=nt.multiply(v,x,v);const E=this.point,T=E.x,C=E.y,D=this.width%2/2,A=this.height%2/2,P=Math.cos(this.angle),I=Math.sin(this.angle),R=T-Math.round(T)+P*D+I*A,k=C-Math.round(C)+P*A+I*D,L=new Float64Array(g);if(nt.translate(L,L,[R>.5?R-1:R,k>.5?k-1:k,0]),this.alignedProjMatrix=L,g=nt.create(),nt.scale(g,g,[this.width/2,-this.height/2,1]),nt.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=nt.create(),nt.scale(g,g,[1,-1,1]),nt.translate(g,g,[-1,-1,0]),nt.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=nt.multiply(new Float64Array(16),this.labelPlaneMatrix,p),this._calcFogMatrices(),this._distanceTileDataCache={},g=nt.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=g,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(z){const{x:j,y:B}=z.point,{lng:H,lat:V}=z._center;return iS(j,B,z.worldSize,H,V)}(this);const N=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=G.transformMat4(N,N,u),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=g;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,a=1/this.height/this._pixelsPerMercatorPixel,l=[t,t,n];G.scale(l,l,a),G.scale(i,i,-1),G.multiply(i,i,l);const u=nt.create();nt.translate(u,u,i),nt.scale(u,u,l),this.mercatorFogMatrix=u,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,a)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),a=this.point,l=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[a.x/this.worldSize-i[0]*l,a.y/this.worldSize-i[1]*l,t/this.worldSize*this._centerAltitude-i[2]*l]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],a=t[2];let l=1;this.projection.wrap&&(this.center=this.center.wrap()),a>0&&(l=Math.min((n-i)/a,1)),this._camera.position=G.scaleAndAdd([],this._camera.position,t,l),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:a}=this._camera.getPitchBearing(),l=xn(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,u=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Ee(this._maxPitch)),d=Math.max((t[2]-l)/Math.cos(i),u),f=this._zoomFromMercatorZ(d);G.scaleAndAdd(t,t,n,d),this._pitch=Wt(i,Ee(this.minPitch),Ee(this.maxPitch)),this.angle=Ja(a,-Math.PI,Math.PI),this._setZoom(Wt(f,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Ge(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,i=$c,a=0,l=1/0;for(;i-n>1e-6&&i>n;){const u=n+.5*(i-n),d=this.tileSize*Math.pow(2,u),f=this.getCameraToCenterDistance(this.projection,u,d),p=this.scaleZoom(f/(t*this.tileSize)),g=Math.abs(u-p);g<l&&(l=g,a=u),u<p?n=u:i=u}return a}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(K("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const i=Math.min(t.x,n.x),a=Math.max(t.x,n.x),l=Math.min(t.y,n.y),u=Math.max(t.y,n.y);if(l<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const d=[new tt(i,l),new tt(a,u),new tt(i,u),new tt(a,l)],f=this.renderWorldCopies?-3:0,p=this.renderWorldCopies?4:1;for(const g of d){const _=this.pointRayIntersection(g);if(_.t<0)return!0;const v=this.rayIntersectionCoordinate(_);if(v.x<f||v.y<0||v.x>p||v.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+ti(this.fovAboveCenter)>88||this.anyCornerOffEdge(new tt(0,0),new tt(this.width,this.height))}zoomDeltaToMovement(t,n){const i=G.length(G.sub([],this._camera.position,t)),a=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(a)}getCameraPoint(){if("globe"===this.projection.name){const t=function([n,i,a],l){const u=[n,i,a,1];vn.transformMat4(u,u,l);const d=u[3]=Math.max(u[3],1e-6);return u[0]/=d,u[1]/=d,u[2]/=d,u}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new tt(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new tt(0,t))}}getCameraToCenterDistance(t,n=this.zoom,i=this.worldSize){const a=jo(t,n,this.width,this.height,1024),l=t.pixelSpaceConversion(this.center.lat,i,a);let u=.5/Math.tan(.5*this._fov)*this.height*l;return this.isOrthographic&&(u=dC(1,u,fC(this.pitch>=15?1:this.pitch/15))),u}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&nt.multiply(t,t,this.globeMatrix),t}getFrustum(t){return fl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}function pC(e,t,n){nt.identity(e),nt.rotateZ(e,e,Ee(t[2])),nt.rotateX(e,e,Ee(t[0])),nt.rotateY(e,e,Ee(t[1])),nt.scale(e,e,n),nt.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function im(e,t,n,i,a,l,u,d){const f=[n[0]-t[0],n[1]-t[1],0],p=[i[0]-t[0],i[1]-t[1],0];if(G.length(f)<1e-12||G.length(p)<1e-12)return Oi.identity(e);const g=G.cross([],f,p);G.normalize(g,g),G.subtract(p,i,t),f[2]=(l-a)*d,p[2]=(u-a)*d;const _=f;return G.cross(_,f,p),G.normalize(_,_),Oi.rotationTo(e,g,_)}function cy(e,t,n=!1){const i=ki(t.zoom),a=function(l,u,d){const f=u.worldSize,p=[l[12],l[13],l[14]],g=zr(p[1]/f),_=ls(p[0]/f),v=nt.identity([]),x=xn(1,g)*f,b=xn(1,0)*f*Ca(g,u.zoom),E=1/H0(f);let T=b*E;if(d){const P=jo(u.projection,u.zoom,u.width,u.height,1024);T=E*u.projection.pixelSpaceConversion(u.center.lat,f,P)}const C=Vo(g,_);G.add(C,C,G.scale([],G.normalize([],C),x*T*p[2]));const D=function(P){const I=[P[0],P[1],P[2]];let R=[0,1,0];const k=G.cross([],R,I);return G.cross(R,I,k),0===G.squaredLength(R)&&(R=[0,1,0],G.cross(k,I,R)),G.normalize(k,k),G.normalize(R,R),G.normalize(I,I),[k[0],k[1],k[2],0,R[0],R[1],R[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],1]}(C);nt.scale(v,v,[T,T,T*x]),nt.translate(v,v,[-p[0],-p[1],-p[2]]);const A=nt.multiply([],u.globeMatrix,D);return nt.multiply(A,A,v),nt.multiply(A,A,l),A}(e,t,n);return i>0?function(u,d,f){const p=(b,E,T)=>{const C=G.length(b),D=G.length(E),A=ea(b,E,T);return G.scale(A,A,1/G.length(A)*ue(C,D,T))},g=p([u[0],u[1],u[2]],[d[0],d[1],d[2]],f),_=p([u[4],u[5],u[6]],[d[4],d[5],d[6]],f),v=p([u[8],u[9],u[10]],[d[8],d[9],d[10]],f),x=ea([u[12],u[13],u[14]],[d[12],d[13],d[14]],f);return[g[0],g[1],g[2],0,_[0],_[1],_[2],0,v[0],v[1],v[2],0,x[0],x[1],x[2],1]}(a,function(u,d){const f=d.worldSize,p=xn(1,0)*f*Ca(d.center.lat,d.zoom)/H0(f),g=xn(1,d.center.lat)*f,_=nt.identity([]);return nt.rotateY(_,_,Ee(d.center.lng)),nt.rotateX(_,_,Ee(d.center.lat)),nt.translate(_,_,[0,0,lo]),nt.scale(_,_,[p,p,p*g]),nt.translate(_,_,[d.point.x-.5*f,d.point.y-.5*f,0]),nt.multiply(_,_,u),nt.multiply(_,d.globeMatrix,_)}(e,t),i):a}const mC=[1,1,1];class e1{constructor(t,n,i,a){this.id=t,this.position=null!=n?new _e(n[0],n[1]):new _e(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new $n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,n){if(nt.multiply(t.matrix,n,t.matrix),t.meshes)for(const i of t.meshes){const a=$n.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(const i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){const t=nt.identity([]);for(const n of this.nodes)this._applyTransformations(n,t)}_positionModelOnTerrain(t,n){const i=t.elevation;if(!i)return 0;const a=$n.projectAabbCorners(this.aabb,this.matrix),l=xn(1,this.position.lat)*t.worldSize,u=function(C,D){const A=[0,0,1],P=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const I of P){const R=C[I.corners[0]],k=C[I.corners[1]],L=C[I.corners[2]],N=[k[0]-R[0],k[1]-R[1],D*(k[2]-R[2])],z=G.cross(N,N,[L[0]-R[0],L[1]-R[1],D*(L[2]-R[2])]);G.normalize(z,z),I.dotProductWithUp=G.dot(z,A)}return P.sort((I,R)=>I.dotProductWithUp-R.dotProductWithUp),P[0].corners}(a,l),d=a[u[0]],f=a[u[1]],p=a[u[2]],g=a[u[3]],_=i.getAtPointOrZero(new Ge(d[0]/t.worldSize,d[1]/t.worldSize),0),v=i.getAtPointOrZero(new Ge(f[0]/t.worldSize,f[1]/t.worldSize),0),x=i.getAtPointOrZero(new Ge(p[0]/t.worldSize,p[1]/t.worldSize),0),b=i.getAtPointOrZero(new Ge(g[0]/t.worldSize,g[1]/t.worldSize),0),E=(_+b)/2,T=(v+x)/2;return E>T?v<x?im(n,f,g,d,v,b,_,l):im(n,p,d,g,x,_,b,l):_<b?im(n,d,f,p,_,v,x,l):im(n,g,p,f,b,x,v,l),Math.max(E,T)}computeModelMatrix(t,n,i,a,l,u,d=!1){const f=t.transform,p=f.zoom,g=f.project(this.position),_=Ca(this.position.lat,p),v=1/_;nt.identity(this.matrix),nt.translate(this.matrix,this.matrix,[g.x+a[0]*v,g.y+a[1]*v,a[2]]);let x=1,b=1;const E=f.worldSize;if(d){if("mercator"===f.projection.name){let A=0;f.elevation&&(A=f.elevation.getAtPointOrZero(new Ge(g.x/E,g.y/E),0));const P=vn.transformMat4([],[g.x,g.y,A,1],f.projMatrix)[3]/f.cameraToCenterDistance;x=P,b=P*Ca(f.center.lat,p)}else if("globe"===f.projection.name){const A=cy(this.matrix,f),P=nt.multiply([],f.projMatrix,A),I=[0,0,0,1];vn.transformMat4(I,I,P);const R=I[3]/f.cameraToCenterDistance,k=ki(p),L=f.projection.pixelsPerMeter(this.position.lat,E)*Ca(this.position.lat,p),N=f.projection.pixelsPerMeter(f.center.lat,E)*Ca(f.center.lat,p);x=R/ue(L,q0(f.center.lat),k),b=R*_/L,x*=N,b*=N}}else x=v;nt.scale(this.matrix,this.matrix,[x,x,b]);const T=[...this.matrix],C=this.orientation,D=[];if(pC(D,[C[0]+n[0],C[1]+n[1],C[2]+n[2]],i),nt.multiply(this.matrix,T,D),l&&f.elevation){let A=0;const P=[];if(u&&f.elevation){A=this._positionModelOnTerrain(f,P);const I=nt.fromQuat([],P),R=nt.multiply([],I,D);nt.multiply(this.matrix,T,R)}else A=f.elevation.getAtPointOrZero(new Ge(g.x/E,g.y/E),0);0!==A&&(this.matrix[14]+=A)}}upload(t){if(!this.uploaded){for(const n of this.nodes)uy(n,t);for(const n of this.nodes)om(n);this.uploaded=!0}}destroy(){for(const t of this.nodes)sm(t)}}function qd(e,t,n=!1){e.uploaded||(e.gfxTexture=new kr(t,e.image,n?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function gC(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,Zx.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,rI.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,nI.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?eI:iC).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,oC.members,!0)),e.segments=bn.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const i=e.material;i.pbrMetallicRoughness.baseColorTexture&&qd(i.pbrMetallicRoughness.baseColorTexture,t),i.pbrMetallicRoughness.metallicRoughnessTexture&&qd(i.pbrMetallicRoughness.metallicRoughnessTexture,t),i.normalTexture&&qd(i.normalTexture,t),i.occlusionTexture&&qd(i.occlusionTexture,t,n),i.emissionTexture&&qd(i.emissionTexture,t)}function uy(e,t,n){if(e.meshes)for(const i of e.meshes)gC(i,t,n);if(e.children)for(const i of e.children)uy(i,t,n)}function om(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)om(t)}function sm(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)sm(n)}class am{constructor(t,n){this.feature=t,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class sc{constructor(){this.instancedDataArray=new Qw,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class _C{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,n,i,a){this.tileToMeter=Zu(i);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:u,id:d,index:f,sourceLayerIndex:p}of t){const g=Gc(u,l);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),g,i))continue;const _={id:d,sourceLayerIndex:p,index:f,geometry:l?g.geometry:pl(u,i,a),properties:u.properties,type:u.type,patterns:{}},v=this.addFeature(_,_.geometry,g);v&&n.featureIndex.insert(u,_.geometry,f,p,this.index,this.instancesPerModel[v].instancedDataArray.length)}this.lookup=null}update(t,n,i,a){for(const l in this.instancesPerModel){const u=this.instancesPerModel[l];for(const d in t)u.idToFeaturesIndex.hasOwnProperty(d)&&this.evaluate(u.features[u.idToFeaturesIndex[d]],t[d],u,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];for(const a of i.features){const l=this.layers[0],u=a.feature,d=this.canonical,f=l.paint.get("model-rotation").evaluate(u,{},d),p=l.paint.get("model-scale").evaluate(u,{},d),g=l.paint.get("model-translation").evaluate(u,{},d);G.exactEquals(a.rotation,f)&&G.exactEquals(a.scale,p)&&G.exactEquals(a.translation,g)||(this.evaluate(a,a.featureStates,i,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const n in this.instancesPerModel){const i=this.instancesPerModel[n];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=t.createVertexBuffer(i.instancedDataArray,iI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];0!==n.instancedDataArray.length&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(t,n,i){const a=this.layers[0],l=a.layout.get("model-id").evaluate(i,{},this.canonical);if(!l)return K(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),l;this.instancesPerModel[l]||(this.instancesPerModel[l]=new sc);const u=this.instancesPerModel[l],d=u.instancedDataArray,f=new am(i,d.length);for(const p of n)for(const g of p){if(g.x<0||g.x>=lt||g.y<0||g.y>=lt)continue;const _=(this.lookupDim-1)/lt,v=this.lookupDim*(g.y*_|0)+g.x*_|0;if(this.lookup){if(0!==this.lookup[v])continue;this.lookup[v]=1}this.instanceCount++;const x=d.length;d.resize(x+1),u.instancesEvaluatedElevation.push(0),d.float32[16*x]=g.x,d.float32[16*x+1]=g.y}return f.instancedDataCount=u.instancedDataArray.length-f.instancedDataOffset,f.instancedDataCount>0&&(t.id&&(u.idToFeaturesIndex[t.id]=u.features.length),u.features.push(f),this.evaluate(f,{},u,!1)),l}evaluate(t,n,i,a){const l=this.layers[0],u=t.feature,d=this.canonical,f=t.rotation=l.paint.get("model-rotation").evaluate(u,n,d),p=t.scale=l.paint.get("model-scale").evaluate(u,n,d),g=t.translation=l.paint.get("model-translation").evaluate(u,n,d),_=l.paint.get("model-color").evaluate(u,n,d);_.a=l.paint.get("model-color-mix-intensity").evaluate(u,n,d);const v=[];this.maxVerticalOffset<g[2]&&(this.maxVerticalOffset=g[2]),this.maxScale=Math.max(Math.max(this.maxScale,p[0]),Math.max(p[1],p[2])),pC(v,f,p);const x=Math.round(100*_.a)+_.b/1.05;for(let b=0;b<t.instancedDataCount;++b){const E=t.instancedDataOffset+b,T=16*E,C=i.instancedDataArray.float32;let D=0;a&&(D=C[T+6]-i.instancesEvaluatedElevation[E]);const A=0|C[T+1];C[T]=(0|C[T])+_.r/1.05,C[T+1]=A+_.g/1.05,C[T+2]=x,C[T+3]=1/(d.z>10?this.tileToMeter:Zu(d,A)),C[T+4]=g[0],C[T+5]=g[1],C[T+6]=g[2]+D,C[T+7]=v[0],C[T+8]=v[1],C[T+9]=v[2],C[T+10]=v[4],C[T+11]=v[5],C[T+12]=v[6],C[T+13]=v[8],C[T+14]=v[9],C[T+15]=v[10],i.instancesEvaluatedElevation[E]=g[2]}}}Gt(_C,"ModelBucket",{omit:["layers"]}),Gt(sc,"PerModelAttributes"),Gt(am,"ModelFeature");const lI=new nr({visibility:new Tt(J.layout_model.visibility),"model-id":new te(J.layout_model["model-id"])});var n1={paint:new nr({"model-opacity":new Tt(J.paint_model["model-opacity"]),"model-rotation":new te(J.paint_model["model-rotation"]),"model-scale":new te(J.paint_model["model-scale"]),"model-translation":new te(J.paint_model["model-translation"]),"model-color":new te(J.paint_model["model-color"]),"model-color-mix-intensity":new te(J.paint_model["model-color-mix-intensity"]),"model-type":new Tt(J.paint_model["model-type"]),"model-cast-shadows":new Tt(J.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt(J.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt(J.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new te(J.paint_model["model-emissive-strength"]),"model-roughness":new te(J.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new te(J.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt(J.paint_model["model-cutoff-fade-range"])}),layout:lI};const ac=new Float32Array(262144),lc=new Uint8Array(262144);function yC(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,yC(n));return t}const hy=["","wall","door","roof","window","lamp","logo"];class cI{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:yC(t)}}}}class uI{constructor(t,n,i,a){this.nodes=t,this.id=n,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const i of n){const a=i.node;this.uploaded?this.updatePbrBuffer(a):uy(a,t,!0)}for(const i of n)om(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let n=!1;if(!t.meshes)return n;for(const i of t.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),n=!0);return n}needsReEvaluation(t,n,i){const a=t.transform.projectionOptions,l=t.style.getBrightness(),u=this.brightness!==l;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||lm(i.paint.get("model-color").value,u)||lm(i.paint.get("model-color-mix-intensity").value,u)||lm(i.paint.get("model-roughness").value,u)||lm(i.paint.get("model-emissive-strength").value,u)||lm(i.paint.get("model-height-based-emissive-strength-multiplier").value,u))&&(this.projection=a,this.brightness=l,!0)}evaluateScale(t,n){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const i=this.getNodesInfo(),a=this.id.canonical;for(const l of i){const u=l.feature;l.evaluatedScale=n.paint.get("model-scale").evaluate(u,{},a)}}evaluate(t){const n=this.getNodesInfo();for(const i of n){if(!i.node.meshes)continue;const a=i.feature,l=i.node.meshes&&i.node.meshes[0].featureData,u=i.evaluatedColor[2],d=i.evaluatedRMEA[2],f=this.id.canonical;if(i.hasTranslucentParts=!1,l){for(let p=0;p<hy.length;p++){const g=hy[p];g.length&&(a.properties.part=g);const _=t.paint.get("model-color").evaluate(a,{},f),v=t.paint.get("model-color-mix-intensity").evaluate(a,{},f);i.evaluatedColor[p]=[_.r,_.g,_.b,v],i.evaluatedRMEA[p][0]=t.paint.get("model-roughness").evaluate(a,{},f),i.evaluatedRMEA[p][2]=t.paint.get("model-emissive-strength").evaluate(a,{},f),i.evaluatedRMEA[p][3]=_.a,i.emissionHeightBasedParams[p]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},f),!i.hasTranslucentParts&&_.a<1&&(i.hasTranslucentParts=!0)}delete a.properties.part,vC(i,u!==i.evaluatedColor[2]||d!==i.evaluatedRMEA[2])}i.evaluatedScale=t.paint.get("model-scale").evaluate(a,{},f),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,n,i,a){const l=t.findDEMTileFor(i);if(l&&(l.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const u=Da.create(t,i,l);if(!u)return;4&this.modelTraits&&this.updateDEM(t,u,i,a);for(const d of this.getNodesInfo()){const f=d.node;if(!f.footprint||!f.footprint.vertices||!f.footprint.vertices.length)continue;const p=f.footprint.vertices;let g=u.getElevationAt(p[0].x,p[0].y,!0,!0);for(let _=1;_<p.length;_++)g=Math.min(g,u.getElevationAt(p[_].x,p[_].y,!0,!0));f.elevation=g}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=n}}updateDEM(t,n,i,a){let l=n._dem._modifiedForSources[a];if(void 0===l&&(n._dem._modifiedForSources[a]=[],l=n._dem._modifiedForSources[a]),l.includes(i.canonical))return;const u=n._dem.dim;l.push(i.canonical);let d=!1;for(const f of this.getNodesInfo()){const p=f.node;if(!p.footprint||!p.footprint.grid)continue;const g=p.footprint.grid,_=n.tileCoordToPixel(g.min.x,g.min.y),v=n.tileCoordToPixel(g.max.x,g.max.y),x=Math.min(Math.min(u-v.y,_.x),Math.min(_.y,u-v.x));if(x<0)continue;const b=Wt(x,2,5);let E=Math.max(0,_.x-b),T=Math.max(0,_.y-b),C=Math.min(v.x+b,u-1),D=Math.min(v.y+b,u-1);for(let R=T;R<=D;++R)for(let k=E;k<=C;++k)lc[R*u+k]=255;let A=0,P=0;for(let R=0;R<g.cellsY;++R)for(let k=0;k<g.cellsX;++k){if(!g.cells[R*g.cellsX+k])continue;const L=n.tileCoordToPixel(g.min.x+k/g.xScale,g.min.y+R/g.yScale),N=n.tileCoordToPixel(g.min.x+(k+1)/g.xScale,g.min.y+(R+1)/g.yScale);for(let z=L.y;z<=Math.min(N.y+1,u-1);++z)for(let j=L.x;j<=Math.min(N.x+1,u-1);++j)255===lc[z*u+j]&&(lc[z*u+j]=0,A+=n.getElevationAtPixel(j,z),P++)}const I=A/P;E=Math.max(1,_.x-b),T=Math.max(1,_.y-b),C=Math.min(v.x+b,u-2),D=Math.min(v.y+b,u-2),d=!0;for(let R=T;R<=D;++R)for(let k=E;k<=C;++k)0===lc[R*u+k]&&(ac[R*u+k]=n._dem.set(k,R,I));for(let R=1;R<b;++R){E=Math.max(1,_.x-R),T=Math.max(1,_.y-R),C=Math.min(v.x+R,u-2),D=Math.min(v.y+R,u-2);for(let k=T;k<=D;++k)for(let L=E;L<=C;++L){const N=k*u+L;if(255===lc[N]){let z=0,j=0,B=-1,H=-1;for(let V=-1;V<=1;++V)for(let Z=-1;Z<=1;++Z){const Q=(k+V)*u+L+Z;if(lc[Q]>=R)continue;const et=ac[Q],W=Math.abs(et);W>j&&(z=et,j=W,B=Z,H=V)}if(j>.1){const V=1-(R+.5*Math.abs(B*H))/b;let Z=n._dem.get(L,k)+z*V;const Q=n._dem.get(L+B,k+H),et=n._dem.get(L-B,k-H,!0);(Z-Q)*(Z-et)>0&&(Z=(Q+et)/2),ac[N]=n._dem.set(L,k,Z),lc[N]=R}}}}}d&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Ft.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new cI(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)sm(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const n of t)om(n.node),sm(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const i=n.getReplacementRegionsForTile(t.toUnwrapped()),a=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const u=a[l].node;a[l].hiddenByReplacement=!!u.footprint&&!i.find(d=>d.footprint===u.footprint)}}getHeightAtTileCoord(t,n){const i=this.getNodesInfo(),a=[];for(let l=0;l<this.nodesInfo.length;l++){const u=i[l],d=u.node.meshes[0];if(t<d.aabb.min[0]||n<d.aabb.min[1]||t>d.aabb.max[0]||n>d.aabb.max[1])continue;const f=(t-d.aabb.min[0])/(d.aabb.max[0]-d.aabb.min[0])*64|0,p=64*Math.min(63,(n-d.aabb.min[1])/(d.aabb.max[1]-d.aabb.min[1])*64|0)+Math.min(63,f);if(!(d.heightmap[p]<0&&u.node.footprint))return u.hiddenByReplacement?void 0:{height:d.heightmap[p],maxHeight:u.feature.properties.height,hidden:!1,verticalScale:u.evaluatedScale[2]};if(u.node.footprint.grid.query(new tt(t,n),new tt(t,n),a),a.length>0)return{height:void 0,maxHeight:u.feature.properties.height,hidden:u.hiddenByReplacement,verticalScale:u.evaluatedScale[2]}}}}function lm(e,t){return!e.isLightConstant&&t}function hI(e,t,n,i,a,l,u,d){let f=(61440&t|(61440&t)>>4)>>8,p=(3840&t|(3840&t)>>4)>>4,g=240&t|(240&t)>>4;n[3]>0&&(f=ue(f,255*n[0],n[3]),p=ue(p,255*n[1],n[3]),g=ue(g,255*n[2],n[3]));const _=f<<8|p,v=g<<8|Math.floor(255*i[3]),x=function(R){const k=Wt(R,0,2);return Math.min(Math.round(.5*k*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],b=Wt(a[0],0,1),E=Wt(a[1],0,1),T=Wt(a[2],0,1),C=Wt(a[3],0,1);let D,A,P,I;if(b!==E&&u!==l&&E!==b){const R=u-l;A=1/(R*(E-b)),P=-(l+R*b)/(R*(E-b));const k=Wt(a[4],-1,1);I=Math.pow(10,k),D=255*T<<8|255*C}else D=65535,A=0,P=1,I=1;if(e.emplaceBack(_,v,x,D,A,P,I),d){const R=d.length;d.clear();for(let k=0;k<R;k++)d.emplaceBack(_,v,x,D,A,P,I)}}function vC(e,t){const n=e.node;let i=0;for(const a of n.meshes){if(n.lights&&n.lightMeshIndex===i||!a.featureData)continue;a.featureArray=new Zg,a.featureArray.reserve(a.featureData.length);let l=t;for(const u of a.featureData){let d;const f=65535&u,p=(15&f)<8?15&f:0,g=u>>16&65535,_=e.evaluatedRMEA[p],v=e.evaluatedColor[p],x=e.emissionHeightBasedParams[p];if(l&&2===p&&n.lights&&(d=new Zg,d.resize(10*n.lights.length)),hI(a.featureArray,g,v,_,x,a.aabb.min[2],a.aabb.max[2],d),d&&l){l=!1;const b=n.meshes[n.lightMeshIndex];b.featureArray=d,b.featureArray._trim()}}a.featureArray._trim(),i++}}Gt(uI,"Tiled3dModelBucket",{omit:["layers"]}),Gt(cI,"Tiled3dModelFeature");class dI{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const n=bC(new tt(0,0),new tt(lt,lt),t),i=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!xC(n,a))continue;const l=wC(a.min,a.max,t);i.push({min:l.min,max:l.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return i}setSources(t){this._setSources(t.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const i=[];for(const a of n.cache.getVisibleCoordinates()){const l=n.cache.getTile(a).buckets[n.layer];if(l)for(const u of l.getNodesInfo()){const d=u.node;d.footprint&&i.push({footprint:d.footprint,id:a.toUnwrapped()})}}return i}})))}_addSource(t){const n=t.getFootprints();if(0!==n.length){for(const i of n){if(!i.footprint)continue;const a=bC(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,i)=>n.priority-i.priority||ai(n.min,i.min)||ai(n.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let n=0,i=0;for(;!t&&n!==this._activeRegions.length;){const a=this._activeRegions[n],l=this._prevRegions[i];t=a.priority!==l.priority||!r1(a,l),++n,++i}}if(t){++this._updateTime;const n=i=>{const a=this._activeRegions;if(i>=a.length)return i;const l=a[i].priority;for(;i<a.length&&a[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,a=n(i);for(;i!==a;){let l=i;const u=i;for(;l!==a;){const d=this._activeRegions[l];d.hiddenByOverlap=!1;for(let f=0;f<u;f++){const p=this._activeRegions[f];if(!p.hiddenByOverlap&&xC(d,p)&&(d.hiddenByOverlap=i1(d.footprint,d.tileId,p.footprint,p.tileId),d.hiddenByOverlap))break}++l}i=a,a=n(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=t.length-1;n>=0;n--)this._addSource(t[n]);this._computeReplacement()}}function ai(e,t){return e.x-t.x||e.y-t.y}function r1(e,t){return 0===ai(e.min,t.min)&&0===ai(e.max,t.max)}function xC(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function bC(e,t,n){const i=1/lt,a=1/(1<<n.canonical.z),l=(t.x*i+n.canonical.x)*a+n.wrap,u=(t.y*i+n.canonical.y)*a;return{min:new tt((e.x*i+n.canonical.x)*a+n.wrap,(e.y*i+n.canonical.y)*a),max:new tt(l,u)}}function wC(e,t,n){const i=1<<n.canonical.z,a=((t.x-n.wrap)*i-n.canonical.x)*lt,l=(t.y*i-n.canonical.y)*lt;return{min:new tt(((e.x-n.wrap)*i-n.canonical.x)*lt,(e.y*i-n.canonical.y)*lt),max:new tt(a,l)}}function EC(e,t,n,i,a,l,u){const d=e.indices,f=e.vertices,p=[];for(let g=i;g<i+a;g+=3){const _=t[n[g+0]+l],v=t[n[g+1]+l],x=t[n[g+2]+l],b=Math.min(_.x,v.x,x.x),E=Math.max(_.x,v.x,x.x),T=Math.min(_.y,v.y,x.y),C=Math.max(_.y,v.y,x.y);p.length=0,e.grid.query(new tt(b,T),new tt(E,C),p);for(let D=0;D<p.length;D++){const A=p[D];if(Mp(f[d[3*A+0]],f[d[3*A+1]],f[d[3*A+2]],_,v,x,u))return!0}}return!1}function i1(e,t,n,i){if(!e||!n)return!1;let a=e.vertices;if(!t.canonical.equals(i.canonical)||t.wrap!==i.wrap){if(n.vertices.length<e.vertices.length)return i1(n,i,e,t);const l=t.canonical,u=i.canonical,d=Math.pow(2,u.z-l.z);a=e.vertices.map(f=>new tt(f.x*l.x*lt*d-u.x*lt,f.y*l.y*lt*d-u.y*lt))}return EC(n,a,e.indices,0,e.indices.length,0,0)}const MC=Lp.types,Zd=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],fI=["fill-extrusion-flood-light-ground-radius"],pI=Math.pow(2,13),CC=Math.pow(2,15)-1,TC=new tt(0,1),Ra=2147483648;function dy(e,t,n,i,a,l,u,d){e.emplaceBack((t<<1)+u,(n<<1)+l,(Math.floor(i*pI)<<1)+a,Math.round(d))}function cm(e,t,n,i,a,l){e.emplaceBack(t.x,t.y,(n.x<<1)+i,(n.y<<1)+a,l)}function eu(e,t,n){e.emplaceBack(t.x,t.y,t.z,16384*n[0],16384*n[1],16384*n[2])}class Oa{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class DC{constructor(){this.centroidXY=new tt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new tt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new tt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new tt(this.max.x-this.min.x,this.max.y-this.min.y)}}class SC{constructor(){this.acc=new tt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,n){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=n.x,t.min.y=t.max.y=n.y)}appendEdge(t,n,i){this.accCount++,this.acc._add(n);let a=!!this.borders;n.x<t.min.x?(t.min.x=n.x,a=!0):n.x>t.max.x&&(t.max.x=n.x,a=!0),n.y<t.min.y?(t.min.y=n.y,a=!0):n.y>t.max.y&&(t.max.y=n.y,a=!0),((0===n.x||n.x===lt)&&n.x===i.x)!=((0===n.y||n.y===lt)&&n.y===i.y)&&this.processBorderOverlap(n,i),a&&this.checkBorderIntersection(n,i)}checkBorderIntersection(t,n){n.x<0!=t.x<0&&this.addBorderIntersection(0,ue(n.y,t.y,(0-n.x)/(t.x-n.x))),n.x>lt!=t.x>lt&&this.addBorderIntersection(1,ue(n.y,t.y,(lt-n.x)/(t.x-n.x))),n.y<0!=t.y<0&&this.addBorderIntersection(2,ue(n.x,t.x,(0-n.y)/(t.y-n.y))),n.y>lt!=t.y>lt&&this.addBorderIntersection(3,ue(n.x,t.x,(lt-n.y)/(t.y-n.y)))}addBorderIntersection(t,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];n<i[0]&&(i[0]=n),n>i[1]&&(i[1]=n)}processBorderOverlap(t,n){if(t.x===n.x){if(t.y===n.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,n.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,n.x),this.addBorderIntersection(i,t.x)}}centroid(){return 0===this.accCount?new tt(0,0):new tt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,n)=>t+ +(n[0]!==Number.MAX_VALUE),0):0}}function ka(e,t){const n=e.add(t)._unit(),i=Wt(e.x*n.x+e.y*n.y,-1,1);var a,l,u;return a=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(a)))/4*CC*((l=e).x*(u=t).y-l.y*u.x<0?-1:1)}const La=[e=>e.x<0,e=>e.x>lt,e=>e.y<0,e=>e.y>lt];function Fa(e,t,n,i){const a=[4];if(0===i)return a;n._mult(i);const l=e.sub(n),u=t.sub(n),d=[e,t,l,u];for(let f=0;f<4;f++)for(const p of d)if(La[f](p)){a.push(f);break}return a}class o1{constructor(t){this.vertexArray=new ao,this.indexArray=new Rr,this.programConfigurations=new Fu(t.layers,t.zoom,n=>fI.includes(n)),this._segments=new bn,this.hiddenByLandmarkVertexArray=new u0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new bn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,n,i,a=!1){const l=t.length;if(l>2){let u=Math.max(0,this._segments.get().length-1);const d=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[u].length);let f;u!==this._segments.get().length-1&&(u++,this._segmentToGroundQuads[u]=[],this._segmentToRegionTriCounts[u]=[0,0,0,0,0]);{const p=t[0],g=t[1];f=ka(p.sub(t[l-1])._perp()._unit(),g.sub(p)._perp()._unit())}for(let p=0;p<l;p++){const g=p===l-1?0:p+1,_=t[p],v=t[g],x=t[g===l-1?0:g+1],b=v.sub(_)._perp()._unit(),E=ka(b,x.sub(v)._perp()._unit()),T=f,C=E;if(s1(_,v,n)||a&&fy(_,n)&&fy(v,n)){f=E;continue}const D=d.vertexLength;cm(this.vertexArray,_,v,1,1,T),cm(this.vertexArray,_,v,1,0,T),cm(this.vertexArray,_,v,0,1,C),cm(this.vertexArray,_,v,0,0,C),d.vertexLength+=4;const A=Fa(_,v,b,i);for(const P of A)this._segmentToGroundQuads[u].push({id:D,region:P}),this._segmentToRegionTriCounts[u][P]+=2,d.primitiveLength+=2;f=E}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),n=t.length;for(let i=0;i<n;i++)this._segmentToGroundQuads[i].sort((a,l)=>a.region-l.region);for(let i=0;i<n;i++){const a=this._segmentToGroundQuads[i],l=t[i],u=this._segmentToRegionTriCounts[i];u.reduce((f,p)=>f+p,0);let d=0;for(let f=0;f<=4;f++){const p=u[f];if(0!==p){let g=this.regionSegments[f];g||(g=this.regionSegments[f]=new bn);const _={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+d,vertexLength:l.vertexLength,primitiveLength:p};g.get().push(_)}d+=p}for(let f=0;f<a.length;f++){const p=a[f].id;this.indexArray.emplaceBack(p,p+1,p+3),this.indexArray.emplaceBack(p,p+3,p+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,n,i,a,l,u){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,n,i,a,l,u)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,gS.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,n,i,a,l,u){this.hasData()&&this.programConfigurations.updatePaintArrays(t,n,i,a,l,u)}updateHiddenByLandmark(t){if(!this.hasData())return;const n=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const i=t.flags&Ra?1:0;for(let a=t.groundVertexArrayOffset;a<n;++a)this.hiddenByLandmarkVertexArray.emplace(a,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,cO.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const n=this.regionSegments[t];n&&n.destroy()}}}}class Wd{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Rr,this.footprintVertices=new wo,this.footprintSegments=[],this.layoutVertexArray=new Ru,this.centroidVertexArray=new d0,this.indexArray=new Rr,this.programConfigurations=new Fu(t.layers,t.zoom,n=>Zd.includes(n)),this.segments=new bn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new o1(t),this.maxHeight=0,this.partLookup={}}populate(t,n,i,a){this.features=[],this.hasPattern=px("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Zu(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:l,id:u,index:d,sourceLayerIndex:f}of t){const p=this.layers[0]._featureFilter.needGeometry,g=Gc(l,p);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),g,i))continue;const _={id:u,sourceLayerIndex:f,index:d,geometry:p?g.geometry:pl(l,i,a),properties:l.properties,type:l.type,patterns:{}},v=this.layoutVertexArray.length;this.hasPattern?this.features.push(M_("fill-extrusion",this.layers,_,this.zoom,n)):this.addFeature(_,_.geometry,d,i,{},n.availableImages,a,n.brightness),n.featureIndex.insert(l,_.geometry,d,f,this.index,v)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(t,n,i,a,l,u){for(const d of this.features){const{geometry:f}=d;this.addFeature(d,f,d.index,n,i,a,l,u)}this.sortBorders()}update(t,n,i,a,l){const u=0!==Object.keys(t).length;if(u&&!this.stateDependentLayers.length)return;const d=u?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,n,d,i,a,l),this.groundEffect.update(t,n,d,i,a,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,T_),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,_S.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,lM.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,i,a,l,u,d,f){const p=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,g=[new tt(0,0),new tt(lt,lt)],_=d.projection,v="globe"===_.name,x="Polygon"===MC[t.type],b=new SC;b.centroidDataIndex=this.centroidData.length;const E=new DC,T=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},a)<=0,C=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},a);E.height=C,E.vertexArrayOffset=this.layoutVertexArray.length,E.groundVertexArrayOffset=this.groundEffect.vertexArray.length,v&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vg);const D=yd(n,500);for(let L=D.length-1;L>=0;L--){const N=D[L];(0===N.length||(A=N[0]).every(z=>z.x<=0)||A.every(z=>z.x>=lt)||A.every(z=>z.y<=0)||A.every(z=>z.y>=lt))&&D.splice(L,1)}var A;let P;if(v)P=RC(D,g,a);else{P=[];for(const L of D)P.push({polygon:L,bounds:g})}const I=x?this.edgeRadius:0,R=I>0&&this.zoom<17,k=(L,N)=>{if(0===L.length)return!1;const z=L[L.length-1];return N.x===z.x&&N.y===z.y};for(const{polygon:L,bounds:N}of P){let z=0,j=0;for(const V of L)x&&!V[0].equals(V[V.length-1])&&V.push(V[0]),j+=x?V.length-1:V.length;const B=this.segments.prepareSegment((x?5:4)*j,this.layoutVertexArray,this.indexArray);E.footprintSegIdx<0&&(E.footprintSegIdx=this.footprintSegments.length);const H=new Oa;if(H.vertexOffset=this.footprintVertices.length,H.indexOffset=3*this.footprintIndices.length,H.ringIndices=[],x){const V=[],Z=[];z=B.vertexLength;for(let et=0;et<L.length;et++){const W=L[et];W.length&&0!==et&&Z.push(V.length/2);const X=[];let rt,ot;rt=W[1].sub(W[0])._perp()._unit(),H.ringIndices.push(W.length-1);for(let ct=1;ct<W.length;ct++){const dt=W[ct],gt=W[ct===W.length-1?1:ct+1],at=dt.clone();if(I){ot=gt.sub(dt)._perp()._unit();const ut=rt.add(ot)._unit(),St=I*Math.min(4,1/(rt.x*ut.x+rt.y*ut.y));at.x+=St*ut.x,at.y+=St*ut.y,at.x=Math.round(at.x),at.y=Math.round(at.y),rt=ot}!T||0!==I&&!R||k(X,at)||X.push(at),dy(this.layoutVertexArray,at.x,at.y,0,0,1,1,0),B.vertexLength++,this.footprintVertices.emplaceBack(dt.x,dt.y),V.push(dt.x,dt.y),v&&eu(this.layoutVertexExtArray,_.projectTilePoint(at.x,at.y,a),_.upVector(a,at.x,at.y))}T&&(0===I||R)&&(0!==X.length&&k(X,X[0])&&X.pop(),this.groundEffect.addData(X,N,p))}const Q=E_(V,Z);for(let et=0;et<Q.length;et+=3)this.footprintIndices.emplaceBack(H.vertexOffset+Q[et+0],H.vertexOffset+Q[et+1],H.vertexOffset+Q[et+2]),this.indexArray.emplaceBack(z+Q[et],z+Q[et+2],z+Q[et+1]),B.primitiveLength++;H.indexCount+=Q.length,H.vertexCount+=this.footprintVertices.length-H.vertexOffset}for(let V=0;V<L.length;V++){const Z=L[V];b.startRing(E,Z[0]);let Q=Z.length>4&&Xd(Z[Z.length-2],Z[0],Z[1]),et=I?mI(Z[Z.length-2],Z[0],Z[1],I):0;const W=[];let X,rt,ot;rt=Z[1].sub(Z[0])._perp()._unit();let ct=!0;for(let dt=1,gt=0;dt<Z.length;dt++){let at=Z[dt-1],ut=Z[dt];const St=Z[dt===Z.length-1?1:dt+1];if(b.appendEdge(E,ut,at),s1(ut,at,N)){I&&(rt=St.sub(ut)._perp()._unit(),ct=!ct);continue}const Nt=ut.sub(at)._perp(),zt=Nt.x/(Math.abs(Nt.x)+Math.abs(Nt.y)),Vt=Nt.y>0?1:0,Kt=at.dist(ut);if(gt+Kt>32768&&(gt=0),I){ot=St.sub(ut)._perp()._unit();let Ce=AC(at,ut,St,IC(rt,ot),I);isNaN(Ce)&&(Ce=0);const xe=ut.sub(at)._unit();at=at.add(xe.mult(et))._round(),ut=ut.add(xe.mult(-Ce))._round(),et=Ce,rt=ot,T&&this.zoom>=17&&(k(W,at)||W.push(at),k(W,ut)||W.push(ut))}const he=B.vertexLength,Oe=Z.length>4&&Xd(at,ut,St);let Xe=PC(gt,Q,ct);if(dy(this.layoutVertexArray,at.x,at.y,zt,Vt,0,0,Xe),dy(this.layoutVertexArray,at.x,at.y,zt,Vt,0,1,Xe),gt+=Kt,Xe=PC(gt,Oe,!ct),Q=Oe,dy(this.layoutVertexArray,ut.x,ut.y,zt,Vt,0,0,Xe),dy(this.layoutVertexArray,ut.x,ut.y,zt,Vt,0,1,Xe),B.vertexLength+=4,this.indexArray.emplaceBack(he+0,he+1,he+2),this.indexArray.emplaceBack(he+1,he+3,he+2),B.primitiveLength+=2,I){const Ce=z+(1===dt?Z.length-2:dt-2),xe=1===dt?z:Ce+1;if(this.indexArray.emplaceBack(he+1,Ce,he+3),this.indexArray.emplaceBack(Ce,xe,he+3),B.primitiveLength+=2,void 0===X&&(X=he),!s1(St,Z[dt],N)){const ce=dt===Z.length-1?X:B.vertexLength;this.indexArray.emplaceBack(he+2,he+3,ce),this.indexArray.emplaceBack(he+3,ce+1,ce),this.indexArray.emplaceBack(he+3,xe,ce+1),B.primitiveLength+=3}ct=!ct}if(v){const Ce=this.layoutVertexExtArray,xe=_.projectTilePoint(at.x,at.y,a),ce=_.projectTilePoint(ut.x,ut.y,a),ie=_.upVector(a,at.x,at.y),Ne=_.upVector(a,ut.x,ut.y);eu(Ce,xe,ie),eu(Ce,xe,ie),eu(Ce,ce,Ne),eu(Ce,ce,Ne)}}x&&(z+=Z.length-1),T&&I&&this.zoom>=17&&(0!==W.length&&k(W,W[0])&&W.pop(),this.groundEffect.addData(W,N,p,I>0))}this.footprintSegments.push(H),++E.footprintSegLen}if(E.vertexCount=this.layoutVertexArray.length-E.vertexArrayOffset,E.groundVertexCount=this.groundEffect.vertexArray.length-E.groundVertexArrayOffset,0!==E.vertexCount){if(E.centroidXY=b.borders?TC:this.encodeCentroid(b,E),this.centroidData.push(E),b.borders){this.featuresOnBorder.push(b);const L=this.featuresOnBorder.length-1;for(let N=0;N<b.borders.length;N++)b.borders[N][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[N].push(L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,l,u,a,f),this.groundEffect.addPaintPropertiesData(t,i,l,u,a,f),this.maxHeight=Math.max(this.maxHeight,C)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((n,i)=>this.featuresOnBorder[n].borders[t][0]-this.featuresOnBorder[i].borders[t][0])}encodeCentroid(t,n){const i=t.centroid(),a=n.span(),l=Math.min(7,Math.round(a.x*this.tileToMeter/10)),u=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new tt(Wt(i.x,1,lt-1)<<3|l,Wt(i.y,1,lt-1)<<3|u)}showCentroid(t){const n=this.centroidData[t.centroidDataIndex];n.flags&=Ra,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const n=t.vertexArrayOffset,i=t.vertexCount+t.vertexArrayOffset,a=t.flags&Ra?TC:t.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==a.y||l!==a.x){for(let u=n;u<i;++u)this.centroidVertexArray.emplace(u,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const i=n.getReplacementRegionsForTile(t.toUnwrapped());if(function(l,u){if(l.length!==u.length)return!1;for(let d=0;d<l.length;d++)if(l[d].sourceId!==u[d].sourceId||!r1(l[d],u[d]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const l of this.centroidData)l.flags&=2147483647;const a=[];for(const l of this.activeReplacements){const u=Math.pow(2,l.footprintTileId.canonical.z-t.canonical.z);for(const d of this.centroidData)if(!(d.flags&Ra||l.min.x>d.max.x||d.min.x>l.max.x||l.min.y>d.max.y||d.min.y>l.max.y))for(let f=0;f<d.footprintSegLen;f++){const p=this.footprintSegments[d.footprintSegIdx+f];if(a.length=0,gI(this.footprintVertices,p.vertexOffset,p.vertexCount,l.footprintTileId.canonical,t.canonical,a),EC(l.footprint,a,this.footprintIndices.uint16,p.indexOffset,p.indexCount,-p.vertexOffset,-u)){d.flags|=Ra;break}}}for(const l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,n,i){let a=!1;for(let l=0;l<i.footprintSegLen;l++){const u=this.footprintSegments[i.footprintSegIdx+l];let d=0;for(const f of u.ringIndices){for(let p=d,g=f+d-1;p<f+d;g=p++){const _=this.footprintVertices.int16[2*(p+u.vertexOffset)+0],v=this.footprintVertices.int16[2*(p+u.vertexOffset)+1],x=this.footprintVertices.int16[2*(g+u.vertexOffset)+1];v>n!=x>n&&t<(this.footprintVertices.int16[2*(g+u.vertexOffset)+0]-_)*(n-v)/(x-v)+_&&(a=!a)}d=f}}return a}getHeightAtTileCoord(t,n){let i=Number.NEGATIVE_INFINITY,a=!0;const l=4*(t+lt)*lt+(n+lt);if(this.partLookup.hasOwnProperty(l)){const u=this.partLookup[l];return u?{height:u.height,hidden:!!(u.flags&Ra)}:void 0}for(const u of this.centroidData)t>u.max.x||u.min.x>t||n>u.max.y||u.min.y>n||this.footprintContainsPoint(t,n,u)&&u&&u.height>i&&(i=u.height,this.partLookup[l]=u,a=!!(u.flags&Ra));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:a};this.partLookup[l]=void 0}}function IC(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function mI(e,t,n,i){const a=t.sub(e)._perp()._unit(),l=n.sub(t)._perp()._unit();return AC(e,t,n,IC(a,l),i)}function AC(e,t,n,i,a){const l=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(n)/3,a*l/i)}function s1(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function fy(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function Xd(e,t,n){if(e.x<0||e.x>=lt||t.x<0||t.x>=lt||n.x<0||n.x>=lt)return!1;const i=n.sub(t),a=i.perp(),l=e.sub(t);return(i.x*l.x+i.y*l.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(l.x*l.x+l.y*l.y))>-.866&&a.x*l.x+a.y*l.y<0}function PC(e,t,n){const i=t?2|e:-3&e;return n?1|i:-2&i}function a1(){const e=Math.PI/32,t=Math.tan(e),n=Gu;return n*Math.sqrt(1+2*t*t)-n}function RC(e,t,n){const i=1<<n.z,a=ls(n.x/i),l=ls((n.x+1)/i),u=zr(n.y/i),d=zr((n.y+1)/i);return function(f,p,g,_,v=0,x){const b=[];if(!f.length||!g||!_)return b;const E=(R,k)=>{for(const L of R)b.push({polygon:L,bounds:k})},T=Math.ceil(Math.log2(g)),C=Math.ceil(Math.log2(_)),D=T-C,A=[];for(let R=0;R<Math.abs(D);R++)A.push(D>0?0:1);for(let R=0;R<Math.min(T,C);R++)A.push(0),A.push(1);let P=f;if(P=S_(P,p[0].y-v,p[1].y+v,1),P=S_(P,p[0].x-v,p[1].x+v,0),!P.length)return b;const I=[];for(A.length?I.push({polygons:P,bounds:p,depth:0}):E(P,p);I.length;){const R=I.pop(),k=R.depth,L=A[k],N=R.bounds[0],z=R.bounds[1],j=0===L?N.x:N.y,B=0===L?z.x:z.y,H=x?x(L,j,B):.5*(j+B),V=S_(R.polygons,j-v,H+v,L),Z=S_(R.polygons,H-v,B+v,L);if(V.length){const Q=[N,new tt(0===L?H:z.x,1===L?H:z.y)];A.length>k+1?I.push({polygons:V,bounds:Q,depth:k+1}):E(V,Q)}if(Z.length){const Q=[new tt(0===L?H:N.x,1===L?H:N.y),z];A.length>k+1?I.push({polygons:Z,bounds:Q,depth:k+1}):E(Z,Q)}}return b}(e,t,Math.ceil((l-a)/11.25),Math.ceil((u-d)/11.25),1,(f,p,g)=>{if(0===f)return.5*(p+g);{const _=zr((n.y+p/lt)/i);return(Gi(.5*(zr((n.y+g/lt)/i)+_))*i-n.y)*lt}})}function gI(e,t,n,i,a,l){const u=Math.pow(2,i.z-a.z);for(let d=0;d<n;d++){let f=e.int16[2*(d+t)+0],p=e.int16[2*(d+t)+1];f=(f+a.x*lt)*u-i.x*lt,p=(p+a.y*lt)*u-i.y*lt,l.push(new tt(f,p))}}Gt(Wd,"FillExtrusionBucket",{omit:["layers","features"]}),Gt(DC,"PartData"),Gt(Oa,"FootprintSegment"),Gt(SC,"BorderCentroidData"),Gt(o1,"GroundEffect");const OC=new nr({visibility:new Tt(J["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt(J["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var kC={paint:new nr({"fill-extrusion-opacity":new Tt(J["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new te(J["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(J["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(J["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new te(J["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new te(J["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new te(J["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Tt(J["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new te(J["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new te(J["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt(J["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt(J["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt(J["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:OC};class cc extends tt{constructor(t,n,i){super(t,n),this.z=i}}function um(e,t){return e.x*t.x+e.y*t.y}function l1(e,t){if(1===e.length){let n=0;const i=t[n++];let a;for(;!a||i.equals(a);)if(a=t[n++],!a)return 1/0;for(;n<t.length;n++){const l=t[n],u=e[0],d=a.sub(i),f=l.sub(i),p=u.sub(i),g=um(d,d),_=um(d,f),v=um(f,f),x=um(p,d),b=um(p,f),E=g*v-_*_,T=(v*x-_*b)/E,C=(g*b-_*x)/E,D=i.z*(1-T-C)+a.z*T+l.z*C;if(isFinite(D))return D}return 1/0}{let n=1/0;for(const i of t)n=Math.min(n,i.z);return n}}function nu(e,t,n,i,a,l,u,d){const f=u*a.getElevationAt(e,t,!0,!0),p=0!==l[0],g=p?0===l[1]?u*(l[0]/7-450):u*function(_,v,x){const b=Math.floor(v[0]/8),E=Math.floor(v[1]/8),T=10*(v[0]-8*b),C=10*(v[1]-8*E),D=_.getElevationAt(b,E,!0,!0),A=_.getMeterToDEM(x),P=Math.floor(.5*(T*A-1)),I=Math.floor(.5*(C*A-1)),R=_.tileCoordToPixel(b,E),k=2*P+1,L=2*I+1,N=(W=k,X=L,[(Z=_).getElevationAtPixel(Q=R.x-P,et=R.y-I,!0),Z.getElevationAtPixel(Q+X,et,!0),Z.getElevationAtPixel(Q,et+X,!0),Z.getElevationAtPixel(Q+W,et+X,!0)]),z=Math.abs(N[0]-N[1]),j=Math.abs(N[2]-N[3]),B=Math.abs(N[0]-N[2])+Math.abs(N[1]-N[3]),H=Math.min(.25,.5*A*(z+j)/k),V=Math.min(.25,.5*A*B/L);var Z,Q,et,W,X;return D+Math.max(H*T,V*C)}(a,l,d):f;return{base:f+(0===n)?-1:n,top:p?Math.max(g+i,f+n+2):f+i}}const LC=new nr({"line-cap":new te(J.layout_line["line-cap"]),"line-join":new te(J.layout_line["line-join"]),"line-miter-limit":new Tt(J.layout_line["line-miter-limit"]),"line-round-limit":new Tt(J.layout_line["line-round-limit"]),"line-sort-key":new te(J.layout_line["line-sort-key"]),visibility:new Tt(J.layout_line.visibility)});var FC={paint:new nr({"line-opacity":new te(J.paint_line["line-opacity"]),"line-color":new te(J.paint_line["line-color"]),"line-translate":new Tt(J.paint_line["line-translate"]),"line-translate-anchor":new Tt(J.paint_line["line-translate-anchor"]),"line-width":new te(J.paint_line["line-width"]),"line-gap-width":new te(J.paint_line["line-gap-width"]),"line-offset":new te(J.paint_line["line-offset"]),"line-blur":new te(J.paint_line["line-blur"]),"line-dasharray":new te(J.paint_line["line-dasharray"]),"line-pattern":new te(J.paint_line["line-pattern"]),"line-gradient":new Kf(J.paint_line["line-gradient"]),"line-trim-offset":new Tt(J.paint_line["line-trim-offset"]),"line-emissive-strength":new Tt(J.paint_line["line-emissive-strength"]),"line-border-width":new te(J.paint_line["line-border-width"]),"line-border-color":new te(J.paint_line["line-border-color"])}),layout:LC};const _I=(e,t,n,i,a,l,u)=>{const d=e.transform,f=d.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:u1(e,t,n,i),u_pixels_to_tile_units:f,u_device_pixel_ratio:l,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:d1(n)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:py(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:u,u_emissive_strength:n.paint.get("line-emissive-strength")}},c1=(e,t,n,i,a)=>{const l=e.transform;return{u_matrix:u1(e,t,n,i),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:l.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:py(t,l),u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function py(e,t){return 1/eh(e,1,t.tileZoom)}function u1(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const h1=e=>{const t=[];d1(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function d1(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const f1=new class extends te{possiblyEvaluate(e,t){return t=new er(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=qt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}(FC.paint.properties["line-width"].specification);function p1(e,t){return t>0?t+2*e:e}f1.useIntegerZoom=!0;const NC=new nr({visibility:new Tt(J.layout_background.visibility)});var zC={paint:new nr({"background-color":new Tt(J.paint_background["background-color"]),"background-pattern":new Tt(J.paint_background["background-pattern"]),"background-opacity":new Tt(J.paint_background["background-opacity"]),"background-emissive-strength":new Tt(J.paint_background["background-emissive-strength"])}),layout:NC};const BC=new nr({visibility:new Tt(J.layout_raster.visibility)});var yI={paint:new nr({"raster-opacity":new Tt(J.paint_raster["raster-opacity"]),"raster-color":new Kf(J.paint_raster["raster-color"]),"raster-color-mix":new Tt(J.paint_raster["raster-color-mix"]),"raster-color-range":new Tt(J.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt(J.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(J.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(J.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(J.paint_raster["raster-saturation"]),"raster-contrast":new Tt(J.paint_raster["raster-contrast"]),"raster-resampling":new Tt(J.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(J.paint_raster["raster-fade-duration"])}),layout:BC};function VC(e,t,n,i,a,l,u,d){const f=[e,n,a,t,i,l,1,1,1],p=[u,d,1],g=Mo.adjoint([],f),[_,v,x]=G.transformMat3(p,p,Mo.transpose(g,g));return Mo.multiply(f,[_,0,0,0,v,0,0,0,x],f)}class bl extends wr{constructor(t,n,i,a){super(),this.id=t,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=n,this._dirty=!1}load(t,n){if(this._loaded=n||!1,this.fire(new Mt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Te(this.map._requestManager.transformRequest(this.url,ft.Image),(i,a)=>{if(this._imageRequest=null,this._loaded=!0,i)this.fire(new pt(i));else if(a){const{HTMLImageElement:l}=it;this.image=a instanceof l?Ft.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Q_(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Mt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Q_||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=t[0][1],i=t[0][1];for(const l of t)l[1]>i&&(i=l[1]),l[1]<n&&(n=l[1]);const a=(i+n)/2;if(a>Er?this.onNorthPole=!0:a<-Er&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=t.map(Ge.fromLngLat);this.tileID=function(u){let d=1/0,f=1/0,p=-1/0,g=-1/0;for(const b of u)d=Math.min(d,b.x),f=Math.min(f,b.y),p=Math.max(p,b.x),g=Math.max(g,b.y);const _=Math.max(p-d,g-f),v=Math.max(0,Math.floor(-Math.log(_)/Math.LN2)),x=Math.pow(2,v);return new Qs(v,Math.floor((d+p)/2*x),Math.floor((f+g)/2*x))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Mt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const f in this.tiles){const p=this.tiles[f];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}if(this._boundsArray)return;const n=Kc(this.tileID,this.map.transform.projection),[i,a,l,u]=this.coordinates.map(f=>{const p=n.projection.project(f[0],f[1]);return yl(n,p)._round()});this.perspectiveTransform=function(f,p,g,_,v,x,b,E,T,C){const D=VC(0,0,f,0,0,p,f,p),A=VC(g,_,v,x,b,E,T,C);return Mo.multiply(A,Mo.adjoint(D,D),A),[A[6]/A[8]*f/lt,A[7]/A[8]*p/lt]}(this.width,this.height,i.x,i.y,a.x,a.y,u.x,u.y,l.x,l.y);const d=this._boundsArray=new Ru;d.emplaceBack(i.x,i.y,0,0),d.emplaceBack(a.x,a.y,lt,0),d.emplaceBack(u.x,u.y,0,lt),d.emplaceBack(l.x,l.y,lt,lt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(d,Jp.members),this.boundsSegments=bn.simpleSegment(0,0,4,2)}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const n=this.map.painter.context,i=n.gl;!this._dirty||this.texture instanceof Q_||(this.texture?this.texture.update(this.image):(this.texture=new kr(n,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(n)}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class vI extends Ps{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const xI=new nr({visibility:new Tt(J.layout_sky.visibility)});var bI={paint:new nr({"sky-type":new Tt(J.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt(J.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt(J.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt(J.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt(J.paint_sky["sky-gradient-radius"]),"sky-gradient":new Kf(J.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt(J.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt(J.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt(J.paint_sky["sky-opacity"])}),layout:xI};function m1(e,t,n){const i=[0,0,1],a=Oi.identity([]);return Oi.rotateY(a,a,n?-Ee(e)+Math.PI:Ee(e)),Oi.rotateX(a,a,-Ee(t)),G.transformQuat(i,i,a),G.normalize(i,i)}var wI={paint:new nr({})};const EI={circle:class extends Ps{constructor(e,t){super(e,y_,t)}createBucket(e){return new KE(e)}queryRadius(e){const t=e;return Wu("circle-radius",this,t)+Wu("circle-stroke-width",this,t)+Cp(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,a,l,u,d){const f=tM(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,e.pixelToTileUnitsFactor),p=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return cs(e,i,l,u,d,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),f,p)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const n=Tp(this);return{config:new Qh(this,t),defines:n,overrideFog:!1}}},heatmap:class extends Ps{createBucket(e){return new ix(e)}constructor(e,t){super(e,nM,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ml({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Wu("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,a,l,u,d){const f=this.paint.get("heatmap-radius").evaluate(t,n);return cs(e,i,l,u,d,!0,!0,new tt(0,0),f)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new Qh(this,t),overrideFog:!1}:{}}},hillshade:class extends Ps{constructor(e,t){super(e,aO,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends Ps{constructor(e,t){super(e,mS,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t){return{config:new Qh(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new vd(e)}queryRadius(){return Cp(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,a,l){return!e.queryGeometry.isAboveHorizon&&Y0(qc(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Ps{constructor(e,t){super(e,kC,t)}createBucket(e){return new Wd(e)}queryRadius(){return Cp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,i,a,l,u,d,f){const p=tM(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,e.pixelToTileUnitsFactor),g=this.paint.get("fill-extrusion-height").evaluate(t,n),_=this.paint.get("fill-extrusion-base").evaluate(t,n),v=[0,0],x=d&&l.elevation,b=l.elevation?l.elevation.exaggeration():1,E=e.tile.getBucket(this);if(x&&E instanceof Wd){const P=E.centroidVertexArray,I=f+1;I<P.length&&(v[0]=P.geta_centroid_pos0(I),v[1]=P.geta_centroid_pos1(I))}if(0===v[0]&&1===v[1])return!1;"globe"===l.projection.name&&(i=RC([i],[new tt(0,0),new tt(lt,lt)],e.tileID.canonical).map(P=>P.polygon).flat());const T=x?d:null,[C,D]=(I=i,R=_,k=g,L=p,N=u,z=T,j=v,B=b,H=l.center.lat,"globe"===(P=l).projection.name?function(Z,Q,et,W,X,rt,ot,ct,dt,gt,at){const ut=[],St=[],Nt=Z.projection.upVectorScale(at,Z.center.lat,Z.worldSize).metersToTile,zt=[0,0,0,1],Vt=[0,0,0,1],Kt=(Oe,Xe,Ce,xe)=>{Oe[0]=Xe,Oe[1]=Ce,Oe[2]=xe,Oe[3]=1},he=a1();et>0&&(et+=he),W+=he;for(const Oe of Q){const Xe=[],Ce=[];for(const xe of Oe){const ce=xe.x+X.x,ie=xe.y+X.y,Ne=Z.projection.projectTilePoint(ce,ie,at),Ke=Z.projection.upVector(at,xe.x,xe.y);let Re=et,Sn=W;if(ot){const or=nu(ce,ie,et,W,ot,ct,dt,gt);Re+=or.base,Sn+=or.top}0!==et?Kt(zt,Ne.x+Ke[0]*Nt*Re,Ne.y+Ke[1]*Nt*Re,Ne.z+Ke[2]*Nt*Re):Kt(zt,Ne.x,Ne.y,Ne.z),Kt(Vt,Ne.x+Ke[0]*Nt*Sn,Ne.y+Ke[1]*Nt*Sn,Ne.z+Ke[2]*Nt*Sn),G.transformMat4(zt,zt,rt),G.transformMat4(Vt,Vt,rt),Xe.push(new cc(zt[0],zt[1],zt[2])),Ce.push(new cc(Vt[0],Vt[1],Vt[2]))}ut.push(Xe),St.push(Ce)}return[ut,St]}(P,I,R,k,L,N,z,j,B,H,e.tileID.canonical):z?function(Z,Q,et,W,X,rt,ot,ct,dt){const gt=[],at=[],ut=[0,0,0,1];for(const St of Z){const Nt=[],zt=[];for(const Vt of St){const Kt=Vt.x+W.x,he=Vt.y+W.y,Oe=nu(Kt,he,Q,et,rt,ot,ct,dt);ut[0]=Kt,ut[1]=he,ut[2]=Oe.base,ut[3]=1,vn.transformMat4(ut,ut,X),ut[3]=Math.max(ut[3],1e-5);const Xe=new cc(ut[0]/ut[3],ut[1]/ut[3],ut[2]/ut[3]);ut[0]=Kt,ut[1]=he,ut[2]=Oe.top,ut[3]=1,vn.transformMat4(ut,ut,X),ut[3]=Math.max(ut[3],1e-5);const Ce=new cc(ut[0]/ut[3],ut[1]/ut[3],ut[2]/ut[3]);Nt.push(Xe),zt.push(Ce)}gt.push(Nt),at.push(zt)}return[gt,at]}(I,R,k,L,N,z,j,B,H):function(Z,Q,et,W,X){const rt=[],ot=[],ct=X[8]*Q,dt=X[9]*Q,gt=X[10]*Q,at=X[11]*Q,ut=X[8]*et,St=X[9]*et,Nt=X[10]*et,zt=X[11]*et;for(const Vt of Z){const Kt=[],he=[];for(const Oe of Vt){const Xe=Oe.x+W.x,Ce=Oe.y+W.y,xe=X[0]*Xe+X[4]*Ce+X[12],ce=X[1]*Xe+X[5]*Ce+X[13],ie=X[2]*Xe+X[6]*Ce+X[14],Ne=X[3]*Xe+X[7]*Ce+X[15],Ke=xe+ct,Re=ce+dt,Sn=ie+gt,or=Math.max(Ne+at,1e-5),Gn=xe+ut,kn=ce+St,Vr=ie+Nt,Kn=Math.max(Ne+zt,1e-5);Kt.push(new cc(Ke/or,Re/or,Sn/or)),he.push(new cc(Gn/Kn,kn/Kn,Vr/Kn))}rt.push(Kt),ot.push(he)}return[rt,ot]}(I,R,k,L,N)),A=e.queryGeometry;var P,I,R,k,L,N,z,j,B,H;return function(P,I,R){let k=1/0;Y0(R,I)&&(k=l1(R,I[0]));for(let L=0;L<I.length;L++){const N=I[L],z=P[L];for(let j=0;j<N.length-1;j++){const B=N[j],H=[B,N[j+1],z[j+1],z[j],B];fd(R,H)&&(k=Math.min(k,l1(R,H)))}}return k!==1/0&&k}(C,D,A.isPointQuery()?A.screenBounds:A.screenGeometry)}},line:class extends Ps{constructor(e,t){super(e,FC,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof bg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=f1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Yp(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const n=h1(this);return{config:new Qh(this,t),defines:n,overrideFog:!1}}queryRadius(e){const t=e,n=p1(Wu("line-width",this,t),Wu("line-gap-width",this,t)),i=Wu("line-offset",this,t);return n/2+Math.abs(i)+Cp(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,a,l){if(e.queryGeometry.isAboveHorizon)return!1;const u=qc(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,e.pixelToTileUnitsFactor),d=e.pixelToTileUnitsFactor/2*p1(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),f=this.paint.get("line-offset").evaluate(t,n);return f&&(i=function(p,g){const _=[],v=new tt(0,0);for(let x=0;x<p.length;x++){const b=p[x],E=[];for(let T=0;T<b.length;T++){const C=b[T],D=b[T+1],A=0===T?v:C.sub(b[T-1])._unit()._perp(),P=T===b.length-1?v:D.sub(C)._unit()._perp(),I=A._add(P)._unit();I._mult(1/(I.x*P.x+I.y*P.y)),E.push(I._mult(g)._add(C))}_.push(E)}return _}(i,f*e.pixelToTileUnitsFactor)),function(p,g,_){for(let v=0;v<g.length;v++){const x=g[v];if(p.length>=3)for(let b=0;b<x.length;b++)if(Ta(p,x[b]))return!0;if(QE(p,x,_))return!0}return!1}(u,i,d)}isTileClipped(){return!0}},symbol:W_,background:class extends Ps{constructor(e,t){super(e,zC,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends Ps{constructor(e,t){super(e,yI,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof bl&&(e._source.onNorthPole||e._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=ml({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends Ps{constructor(e,t){super(e,bI,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ml({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),a=!i,l=e.style.light,u=l.properties.get("position");return a&&"viewport"===l.properties.get("anchor")&&K("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?m1(u.azimuthal,90-u.polar,t):m1(i[0],90-i[1],t)}const n=this.paint.get("sky-gradient-center");return m1(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends Ps{constructor(e,t){super(e,wI)}},model:class extends Ps{constructor(e,t){super(e,n1,t)}createBucket(e){return new _C(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof jl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function my(e,t){return"custom"===e.type?new vI(e):new EI[e.type](e,t)}function MI(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class CI extends wr{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new ur({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:i,callback:a}of this.requestors)this._notify(i,n,a);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images[n][t]}addImage(t,n,i){this._validate(t,i)&&(this.images[n][t]=i)}_validate(t,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new pt(new Error(`Image "${t}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new pt(new Error(`Image "${t}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new pt(new Error(`Image "${t}" has invalid "content" value`))),i=!1),i}_validateStretch(t,n){if(!t)return!0;let i=0;for(const a of t){if(a[0]<i||a[1]<a[0]||n<a[1])return!1;i=a[1]}return!0}_validateContent(t,n){return!(t&&(4!==t.length||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n,i){i.version=this.images[n][t].version+1,this.images[n][t]=i,this.updatedImages[n][t]=!0}removeImage(t,n){const i=this.images[n][t];delete this.images[n][t],delete this.patterns[n][t],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,n,i){let a=!0;const l=!!this.loaded[n];if(!l)for(const u of t)this.images[n][u]||(a=!1);l||a?this._notify(t,n,i):this.requestors.push({ids:t,scope:n,callback:i})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,n,i){const a={};for(const l of t){this.images[n][l]||this.fire(new Mt("styleimagemissing",{id:l}));const u=this.images[n][l];u?a[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,hasRenderCallback:!(!u.userImage||!u.userImage.render)}:K(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,a)}getPixelSize(t){const{width:n,height:i}=this.atlasImage[t];return{width:n,height:i}}getPattern(t,n){const i=this.patterns[n][t],a=this.getImage(t,n);if(!a)return null;if(i&&i.position.version===a.version)return i.position;if(i)i.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},u=new L_(l,a);this.patterns[n][t]={bin:l,position:u}}return this._updatePatternAtlas(n),this.patterns[n][t].position}bind(t,n){const i=t.gl;let a=this.atlasTexture[n];a?this.dirty&&(a.update(this.atlasImage[n]),this.dirty=!1):(a=new kr(t,this.atlasImage[n],i.RGBA),this.atlasTexture[n]=a),a.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const n=[];for(const u in this.patterns[t])n.push(this.patterns[t][u].bin);const{w:i,h:a}=Ye(n),l=this.atlasImage[t];l.resize({width:i||1,height:a||1});for(const u in this.patterns[t]){const{bin:d}=this.patterns[t][u],f=d.x+1,p=d.y+1,g=this.images[t][u].data,_=g.width,v=g.height;ur.copy(g,l,{x:0,y:0},{x:f,y:p},{width:_,height:v}),ur.copy(g,l,{x:0,y:v-1},{x:f,y:p-1},{width:_,height:1}),ur.copy(g,l,{x:0,y:0},{x:f,y:p+v},{width:_,height:1}),ur.copy(g,l,{x:_-1,y:0},{x:f-1,y:p},{width:1,height:v}),ur.copy(g,l,{x:0,y:0},{x:f+_,y:p},{width:1,height:v})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,n){for(const i of t){if(this.callbackDispatchedThisFrame[n][i])continue;this.callbackDispatchedThisFrame[n][i]=!0;const a=this.images[n][i];MI(a)&&this.updateImage(i,n,a)}}}const TI=new nr({anchor:new Tt(J.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return $t(e.expression.evaluate(t))}interpolate(e,t,n){return{x:ue(e.x,t.x,n),y:ue(e.y,t.y,n),z:ue(e.z,t.z,n),azimuthal:ue(e.azimuthal,t.azimuthal,n),polar:ue(e.polar,t.polar,n)}}}(J.light.position),color:new Tt(J.light.color),intensity:new Tt(J.light.intensity)});class jC extends wr{constructor(t,n="flat"){super(),this._transitionable=new Ai(TI),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,i={}){this._validate(Ww,t,i)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,i){return(!i||!1!==i.validate)&&Pg(this,t.call(zo,qt({value:n,style:{glyphs:!0,sprite:!0},styleSpec:J})))}}const DI=new nr({source:new Tt(J.terrain.source),exaggeration:new Tt(J.terrain.exaggeration)});let SI=class extends wr{constructor(e,t){super(),this._transitionable=new Ai(DI),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}setScope(e){this.scope=e}get(){return this._transitionable.serialize()}set(e){this._transitionable.setTransitionOrValue(e)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new er(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof jl}};const UC=45,$C=65,ru=.05;function hm(e,t,n,i){const a=Ya(UC,$C,n),[l,u]=g1(e,i);let d=1-Math.min(1,Math.exp((t-l)/(u-l)*-6));return d*=d*d,d=Math.min(1,1.00747*d),d*a*e.alpha}function g1(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function _1(e,t,n,i,a){const l=G.transformMat4([],[t,n,i],a.mercatorFogMatrix);return hm(e,G.length(l),a.pitch,a._fov)}function y1(e,t,n,i,a,l,u){const d=[[n,i,0],[a,i,0],[a,l,0],[n,l,0]];let f=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(const g of d){const _=G.transformMat4([],g,t),v=G.length(_);f=Math.min(f,v),p=Math.max(p,v)}return[hm(e,f,u.pitch,u._fov),hm(e,p,u.pitch,u._fov)]}const HC=new nr({range:new Tt(J.fog.range),color:new Tt(J.fog.color),"high-color":new Tt(J.fog["high-color"]),"space-color":new Tt(J.fog["space-color"]),"horizon-blend":new Tt(J.fog["horizon-blend"]),"star-intensity":new Tt(J.fog["star-intensity"]),"vertical-range":new Tt(J.fog["vertical-range"])});class GC extends wr{constructor(t,n){super(),this._transitionable=new Ai(HC),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){const t=this._transform,n="globe"===t.projection.name,i=ki(t.zoom),a=this.properties.get("range"),l=[.5,3];return{range:n?[ue(l[0],a[0],i),ue(l[1],a[1],i)]:a,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n={}){if(this._validate(Ag,t,n))return;const i=qt({},t);for(const a of Object.keys(J.fog))void 0===i[a]&&(i[a]=J.fog[a].default);this._transitionable.setTransitionOrValue(i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:Ya(UC,$C,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(i,a,l){const u=Ge.fromLngLat(a),d=l.elevation?l.elevation.getAtPointOrZero(u):0;return _1(i,u.x,u.y,d,l)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return y1(this.state,n,0,0,lt,lt,this._transform)}getOpacityForBounds(t,n,i,a,l){return this._transform.projection.supportsFog?y1(this.state,t,n,i,a,l,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?g1(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const i of n){const a=t.points[i];let l;if(a[2]>=0)l=a;else{const u=t.points[i-4];l=Mw(u,a,u[2]/(u[2]-a[2]))}if(_1(this.state,l[0],l[1],0,this._transform)>=ru)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,i){return(!i||!1!==i.validate)&&Pg(this,t.call(zo,qt({value:n,style:{glyphs:!0,sprite:!0},styleSpec:J})))}}class qC{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZC{constructor(){this.tasks={},this.taskQueue=[],ui(["process"],this),this.invoker=new qC(this.process),this.nextId=0}add(t,n){const i=this.nextId++,a=function({type:l,isSymbolTile:u,zoom:d}){return d=d||0,"message"===l?0:"maybePrepare"!==l||u?"parseTile"!==l||u?"parseTile"===l&&u?300-d:"maybePrepare"===l&&u?400-d:500:200-d:100-d}(n);if(0===a){wt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:t,metadata:n,priority:a,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){wt();try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let t=null,n=1/0;for(let a=0;a<this.taskQueue.length;a++){const l=this.tasks[this.taskQueue[a]];l.priority<n&&(n=l.priority,t=a)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class v1{constructor(t,n,i){this.target=t,this.parent=n,this.mapId=i,this.callbacks={},this.cancelCallbacks={},ui(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ZC}send(t,n,i,a,l=!1,u){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=u,this.callbacks[d]=i);const f=new Set;return this.target.postMessage({id:d,type:t,hasCallback:!!i,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:ze(n,f)},f),{cancel:()=>{i&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(t){const n=t.data,i=n.id;if(i&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(n.mustQueue||wt()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,n),a&&a.metadata||{type:"message"})}else this.processTask(i,n)}processTask(t,n){if("<response>"===n.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(n.error?i(Iu(n.error)):i(null,Iu(n.data)))}else{const i=new Set,a=n.hasCallback?(u,d)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:u?ze(u):null,data:ze(d,i)},i)}:u=>{},l=Iu(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,l,a);else if(this.parent.getWorkerSource){const u=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,u[0],l.source,l.scope)[u[1]](l,a)}else a(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let dm=(()=>{class e{constructor(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Ar();const a=this.workerPool.acquire(this.id);for(let l=0;l<a.length;l++){const u=new e.Actor(a[l],i,this.id);u.name=`Worker ${l}`,this.actors.push(u)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,i,a){xu(this.actors,(l,u)=>{l.send(n,i,u)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return e.Actor=v1,e})();class iu extends wr{constructor(t,n,i,a){super(),this.scope=i,this._options=t,this.properties=new Jf(n),this._transitionable=new Ai(n,new Map(a)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const II=new nr({color:new Tt(J.properties_light_ambient.color),intensity:new Tt(J.properties_light_ambient.intensity)}),AI=new nr({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([n,i]){const a=$t([1,n,i]);return{x:a.x,y:a.y,z:a.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:ue(e.x,t.x,n),y:ue(e.y,t.y,n),z:ue(e.z,t.z,n)}}}(J.properties_light_directional.direction),color:new Tt(J.properties_light_directional.color),intensity:new Tt(J.properties_light_directional.intensity),"cast-shadows":new Tt(J.properties_light_directional["cast-shadows"]),"shadow-intensity":new Tt(J.properties_light_directional["shadow-intensity"])});class ou{constructor(t,n,i,a){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,a)}static createFromScreenPoints(t,n){let i,a;if(t instanceof tt||"number"==typeof t[0]){const l=tt.convert(t);i=[l],a=n.isPointAboveHorizon(l)}else{const l=tt.convert(t[0]),u=tt.convert(t[1]);i=[l,u],a=vu(l,u).every(d=>n.isPointAboveHorizon(d))}return new ou(i,n.getCameraPoint(),a,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return vu(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new tt(1,1)):this.screenBounds[1],a=vu(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?a.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?a[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(a[3]=this.cameraPoint)),function(l,u){const d=[];for(let f=0;f<l.length;f++){const p=Ja(f-1,-1,l.length-1),g=Ja(f+1,-1,l.length-1),_=l[f],v=l[g],x=l[p].sub(_).unit(),b=v.sub(_).unit(),E=b.angleWithSep(x.x,x.y),T=x.add(b).unit().mult(-1*u/Math.sin(E/2));d.push(_.add(T))}return d}(a,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new tt(1,1)):this.screenBounds[1],a=vu(n,i,t),l=this.cameraPoint.clone();switch(3*((l.y>n.y)+(l.y>i.y))+((l.x>n.x)+(l.x>i.x))){case 0:a[0]=l,a[4]=l.clone();break;case 1:a.splice(1,0,l);break;case 2:a[1]=l;break;case 3:a.splice(4,0,l);break;case 5:a.splice(2,0,l);break;case 6:a[3]=l;break;case 7:a.splice(3,0,l);break;case 8:a[2]=l}return a}containsTile(t,n,i,a=0){const l=t.queryPadding/n._pixelsPerMercatorPixel+1,u=i?this._bufferedCameraMercator(l,n):this._bufferedScreenMercator(l,n);let d=t.tileID.wrap+(u.unwrapped?a:0);const f=u.polygon.map(T=>yl(t.tileTransform,T,d));if(!cS(f,0,0,lt,lt))return;d=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?a:0);const p=this.screenGeometryMercator.polygon.map(T=>zM(t.tileTransform,T,d)),g=p.map(T=>new tt(T[0],T[1])),_=n.getFreeCameraOptions().position||new Ge(0,0,0),v=zM(t.tileTransform,_,d),x=p.map(T=>{const C=G.sub(T,T,v);return G.normalize(C,C),new ad(v,C)}),b=eh(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:g,tilespaceRays:x,bufferedTilespaceGeometry:f,bufferedTilespaceBounds:(E=Xa(f),E.min.x=Wt(E.min.x,0,lt),E.min.y=Wt(E.min.y,0,lt),E.max.x=Wt(E.max.x,0,lt),E.max.y=Wt(E.max.y,0,lt),E),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:b};var E}_bufferedScreenMercator(t,n){const i=PI(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let a;return a="globe"===n.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(l=>n.pointCoordinate3D(l)),unwrapped:!0},this._screenRaycastCache[i]=a,a}}_bufferedCameraMercator(t,n){const i=PI(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let a;return a="globe"===n.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(l=>n.pointCoordinate3D(l)),unwrapped:!0},this._cameraRaycastCache[i]=a,a}}_projectAndResample(t,n){const i=function(l,u){const d=nt.multiply([],u.pixelMatrix,u.globeMatrix),f=[0,-lo,0,1],p=[0,lo,0,1],g=[0,0,0,1];vn.transformMat4(f,f,d),vn.transformMat4(p,p,d),vn.transformMat4(g,g,d);const _=new tt(f[0]/f[3],f[1]/f[3]),v=new tt(p[0]/p[3],p[1]/p[3]),x=Ta(l,_)&&f[3]<g[3],b=Ta(l,v)&&p[3]<g[3];if(!x&&!b)return null;const E=function(k,L,N){for(let z=1;z<k.length;z++){const j=Fi(L.pointCoordinate3D(k[z-1]).x),B=Fi(L.pointCoordinate3D(k[z]).x);if(N<0){if(j<B)return{idx:z,t:-j/(B-1-j)}}else if(B<j)return{idx:z,t:(1-j)/(B+1-j)}}return null}(l,u,x?-1:1);if(!E)return null;const{idx:T,t:C}=E;let D=T>1?WC(l.slice(0,T),u):[],A=T<l.length?WC(l.slice(T),u):[];D=D.map(k=>new tt(Fi(k.x),k.y)),A=A.map(k=>new tt(Fi(k.x),k.y));const P=[...D];0===P.length&&P.push(A[A.length-1]);const I=ue(P[P.length-1].y,(0===A.length?D[0]:A[0]).y,C);let R;return R=x?[new tt(0,I),new tt(0,0),new tt(1,0),new tt(1,I)]:[new tt(1,I),new tt(1,1),new tt(0,1),new tt(0,I)],P.push(...R),0===A.length?P.push(D[0]):P.push(...A),{polygon:P.map(k=>new Ge(k.x,k.y)),unwrapped:!1}}(t,n);if(i)return i;const a=function(l,u){let d=!1,f=-1/0,p=0;for(let _=0;_<l.length-1;_++)l[_].x>f&&(f=l[_].x,p=_);for(let _=0;_<l.length-1;_++){const v=(p+_)%(l.length-1),x=l[v],b=l[v+1];Math.abs(x.x-b.x)>.5&&(x.x<b.x?(x.x+=1,0===v&&(l[l.length-1].x+=1)):(b.x+=1,v+1===l.length-1&&(l[0].x+=1)),d=!0)}const g=Li(u.center.lng);return d&&g<Math.abs(g-1)&&l.forEach(_=>{_.x-=1}),{polygon:l,unwrapped:d}}(WC(t,n).map(l=>new tt(Fi(l.x),l.y)),n);return{polygon:a.polygon.map(l=>new Ge(l.x,l.y)),unwrapped:a.unwrapped}}}function WC(e,t){return XE(e,n=>{const i=t.pointCoordinate3D(n);n.x=i.x,n.y=i.y},1/256)}function Fi(e){return e<0?1+e%1:e%1}function PI(e){return 100*e|0}function gy(e,t,n,i,a){const l=function(u,d){if(u)return a(u);if(d){e.url&&d.tiles&&e.tiles&&delete e.tiles;const f=Ro(qt(d,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(f.vectorLayers=d.vector_layers,f.vectorLayerIds=f.vectorLayers.map(p=>p.id)),f.tiles=t.canonicalizeTileset(f,e.url),a(null,f)}};return e.url?At(t.transformRequest(t.normalizeSourceURL(e.url,null,n,i),ft.Source),l):Ft.frame(()=>l(null,e))}class fm{constructor(t,n,i){this.bounds=Rs.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),i=Math.floor(Li(this.bounds.getWest())*n),a=Math.floor(Gi(this.bounds.getNorth())*n),l=Math.ceil(Li(this.bounds.getEast())*n),u=Math.ceil(Gi(this.bounds.getSouth())*n);return t.x>=i&&t.x<l&&t.y>=a&&t.y<u}}class RI{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.image=new Xl({width:t,height:n}),this.positions={},this.uploaded=!1}getDash(t,n){const i=this.getKey(t,n);return this.positions[i]}trim(){const t=this.width,n=this.height=On(this.nextRow);this.image.resize({width:t,height:n})}getKey(t,n){return t.join(",")+n}getDashRanges(t,n,i){const a=[];let l=t.length%2==1?-t[t.length-1]*i:0,u=t[0]*i,d=!0;a.push({left:l,right:u,isDash:d,zeroLength:0===t[0]});let f=t[0];for(let p=1;p<t.length;p++){d=!d;const g=t[p];l=f*i,f+=g,u=f*i,a.push({left:l,right:u,isDash:d,zeroLength:0===g})}return a}addRoundDash(t,n,i){const a=n/2;for(let l=-i;l<=i;l++){const u=this.width*(this.nextRow+i+l);let d=0,f=t[d];for(let p=0;p<this.width;p++){p/f.right>1&&(f=t[++d]);const g=Math.abs(p-f.left),_=Math.abs(p-f.right),v=Math.min(g,_);let x;const b=l/i*(a+1);if(f.isDash){const E=a-Math.abs(b);x=Math.sqrt(v*v+E*E)}else x=a-Math.sqrt(v*v+b*b);this.image.data[u+p]=Math.max(0,Math.min(255,x+128))}}}addRegularDash(t,n){for(let f=t.length-1;f>=0;--f){const p=t[f],g=t[f+1];p.zeroLength?t.splice(f,1):g&&g.isDash===p.isDash&&(g.left=p.left,t.splice(f,1))}const i=t[0],a=t[t.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);const l=this.width*this.nextRow;let u=0,d=t[u];for(let f=0;f<this.width;f++){f/d.right>1&&(d=t[++u]);const p=Math.abs(f-d.left),g=Math.abs(f-d.right),_=Math.min(p,g);this.image.data[l+f]=Math.max(0,Math.min(255,(d.isDash?_:-_)+n+128))}}addDash(t,n){const i=this.getKey(t,n);if(this.positions[i])return this.positions[i];const a="round"===n,l=a?7:0,u=2*l+1;if(this.nextRow+u>this.height)return K("LineAtlas out of space"),null;0===t.length&&t.push(1);let d=0;for(let g=0;g<t.length;g++)t[g]<0&&(K("Negative value is found in line dasharray, replacing values with 0"),t[g]=0),d+=t[g];if(0!==d){const g=this.width/d,_=this.getDashRanges(t,this.width,g);a?this.addRoundDash(_,g,l):this.addRegularDash(_,"square"===n?.5*g:0)}const f=this.nextRow+l;this.nextRow+=u;const p={tl:[f,l],br:[d,0]};return this.positions[i]=p,p}}Gt(RI,"LineAtlas");const Mr=1*Fs;class XC{constructor(t){const n={},i=[];for(const d in t){const f=t[d],p=n[d]={};for(const g in f.glyphs){const _=f.glyphs[+g];if(!_||0===_.bitmap.width||0===_.bitmap.height)continue;const v=_.metrics.localGlyph?Mr:1,x={x:0,y:0,w:_.bitmap.width+2*v,h:_.bitmap.height+2*v};i.push(x),p[g]=x}}const{w:a,h:l}=Ye(i),u=new Xl({width:a||1,height:l||1});for(const d in t){const f=t[d];for(const p in f.glyphs){const g=f.glyphs[+p];if(!g||0===g.bitmap.width||0===g.bitmap.height)continue;const _=n[d][p],v=g.metrics.localGlyph?Mr:1;Xl.copy(g.bitmap,u,{x:0,y:0},{x:_.x+v,y:_.y+v},g.bitmap)}}this.image=u,this.positions=n}}Gt(XC,"GlyphAtlas");class OI{constructor(t){this.tileID=new Ze(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Kc(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,n,i,a,l){this.status="parsing",this.data=t,this.collisionBoxArray=new tE;const u=new hM(Object.keys(t.layers).sort()),d=new Dx(this.tileID,this.promoteId);d.bucketLayerIDs=[];const f={},p=new RI(256,256),g={featureIndex:d,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:p,availableImages:i,brightness:this.brightness},_=n.familiesBySource[this.source];for(const D in _){const A=t.layers[D];if(!A)continue;let P=!1,I=!1,R=!1;for(const N of _[D])"symbol"===N[0].type?P=!0:I=!0,N[0].is3D()&&"model"!==N[0].type&&(R=!0);if(this.extraShadowCaster&&!R||!0===this.isSymbolTile&&!P||!1===this.isSymbolTile&&!I)continue;1===A.version&&K(`Vector tile source "${this.source}" layer "${D}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const k=u.encode(D),L=[];for(let N=0;N<A.length;N++){const z=A.feature(N),j=d.getId(z,D);L.push({feature:z,id:j,index:N,sourceLayerIndex:k})}for(const N of _[D]){const z=N[0];(!this.extraShadowCaster||z.is3D()&&"model"!==z.type)&&(void 0!==this.isSymbolTile&&"symbol"===z.type!==this.isSymbolTile||z.minzoom&&this.zoom<Math.floor(z.minzoom)||z.maxzoom&&this.zoom>=z.maxzoom||"none"!==z.visibility&&(x1(N,this.zoom,g.brightness,i),(f[z.id]=z.createBucket({index:d.bucketLayerIDs.length,layers:N,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:k,sourceID:this.source,projection:this.projection.spec})).populate(L,g,this.tileID.canonical,this.tileTransform),d.bucketLayerIDs.push(N.map(j=>j.id))))}}let v,x,b,E;p.trim();const T={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},C=()=>{if(v)return l(v);if(this.extraShadowCaster)this.status="done",l(null,{buckets:vi(f).filter(D=>!D.isEmpty()),featureIndex:d,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:g.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(x&&b&&E){const D=new XC(x),A=new jt(b,E);for(const P in f){const I=f[P];I instanceof Xp?(x1(I.layers,this.zoom,g.brightness,i),kS(I,x,D.positions,b,A.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):I.hasPattern&&(I instanceof Yp||I instanceof vd||I instanceof Wd)&&(x1(I.layers,this.zoom,g.brightness,i),I.addFeatures(g,this.tileID.canonical,A.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",l(null,{buckets:vi(f).filter(P=>!P.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:D.image,lineAtlas:p,imageAtlas:A,brightness:g.brightness})}};if(!this.extraShadowCaster){const D=wh(g.glyphDependencies,I=>Object.keys(I).map(Number));Object.keys(D).length?a.send("getGlyphs",{uid:this.uid,stacks:D,scope:this.scope},(I,R)=>{v||(v=I,x=R,C())},void 0,!1,T):x={};const A=Object.keys(g.iconDependencies);A.length?a.send("getImages",{icons:A,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(I,R)=>{v||(v=I,b=R,C())},void 0,!1,T):b={};const P=Object.keys(g.patternDependencies);P.length?a.send("getImages",{icons:P,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(I,R)=>{v||(v=I,E=R,C())},void 0,!1,T):E={}}C()}}function x1(e,t,n,i){const a=new er(t,{brightness:n});for(const l of e)l.recalculate(a,i)}class rh{constructor(t){this.entries={},this.scheduler=t}request(t,n,i,a){const l=this.entries[t]=this.entries[t]||{callbacks:[]};if(l.result){const[u,d]=l.result;return this.scheduler?this.scheduler.add(()=>{a(u,d)},n):a(u,d),()=>{}}return l.callbacks.push(a),l.cancel||(l.cancel=i((u,d)=>{l.result=[u,d];for(const f of l.callbacks)this.scheduler?this.scheduler.add(()=>{f(u,d)},n):f(u,d);setTimeout(()=>delete this.entries[t],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(u=>u!==a),l.callbacks.length||(l.cancel(),delete this.entries[t]))}}}function YC(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},a=>{const l=kt(e.request,(u,d,f,p)=>{u?a(u):d&&a(null,{vectorTile:n?void 0:new kp(new hr(d)),rawData:d,cacheControl:f,expires:p})});return()=>{l.cancel(),a()}},t)}class pm extends wr{constructor(t,n,i,a){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,qt(this,Ro(n,["url","scheme","tileSize","promoteId"])),this._options=qt({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a),this._tileWorkers={},this._deduped=new rh}load(t){this._loaded=!1,this.fire(new Mt("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=gy(this._options,this.map._requestManager,n,i,(a,l)=>{this._tileJSONRequest=null,this._loaded=!0,a?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),i&&2!==i.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new pt(a))):l&&(qt(this,l),l.bounds&&(this.tileBounds=new fm(l.bounds,this.minzoom,this.maxzoom)),Dc(l.tiles,this.map._requestManager._customAccessToken),this.fire(new Mt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Mt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(a)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=Pi(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return qt({},this._options)}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(i,ft.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:Ft.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(a.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",a,l.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",a,l.bind(this),void 0,!0);else{const u=YC.call({deduped:this._deduped},a,(d,f)=>{d||!f?l.call(this,d):(a.data={cacheControl:f.cacheControl,expires:f.expires,rawData:f.rawData.slice(0)},t.actor&&t.actor.send("loadTile",a,l.bind(this),void 0,!0))},!0);t.request={cancel:u}}function l(u,d){return delete t.request,t.aborted?n(null):u&&404!==u.status?n(u):(d&&d.resourceTiming&&(t.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&d&&t.setExpiryData(d),t.loadVectorData(d,this.map.painter),Mh(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class su extends wr{constructor(t,n,i,a){super(),this.id=t,this.dispatcher=i,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=qt({type:"raster"},n),qt(this,Ro(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new Mt("dataloading",{dataType:"source"})),this._tileJSONRequest=gy(this._options,this.map._requestManager,null,null,(n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new pt(n)):i&&(qt(this,i),i.bounds&&(this.tileBounds=new fm(i.bounds,this.minzoom,this.maxzoom)),Dc(i.tiles),this.fire(new Mt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Mt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=Pi(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return qt({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const i=Ft.devicePixelRatio>=2,a=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=Te(this.map._requestManager.transformRequest(a,ft.Tile),(l,u,d,f)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):l?(t.state="errored",n(l)):u?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:d,expires:f}),t.setTexture(u,this.map.painter),t.state="loaded",Mh(this.dispatcher),void n(null)):n(null)))}static loadTileData(t,n,i){t.setTexture(n,i)}static unloadTileData(t,n){t.texture&&n.saveTileTexture(t.texture)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let To;function xO(){return null!=qy.workerClass?new qy.workerClass:new it.Worker(qy.workerUrl)}const _y="mapboxgl_preloaded_worker_pool";class ih{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ih.workerCount;)this.workers.push(new xO);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_y]}numActive(){return Object.keys(this.active).length}}let mm;function Yd(){return mm||(mm=new ih),mm}ih.workerCount=2;let gm,yy,oa,b1=null;function JC(){return wt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:yy||ke.DRACO_URL}const w1=5123,oh=5126,E1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[w1]:Uint16Array,5125:Uint32Array,[oh]:Float32Array},kI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[w1]:"DT_UINT16",5125:"DT_UINT32",[oh]:"DT_FLOAT32"},M1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function _m(e,t,n){const i=n.json.bufferViews.length,a=n.buffers.length;t.bufferView=i,n.json.bufferViews[i]={buffer:a,byteLength:e.byteLength},n.buffers[a]=e}const vy="KHR_draco_mesh_compression";function KC(e,t){const n=e.extensions&&e.extensions[vy];if(!n)return;const i=new oa.Decoder,a=tT(t,n.bufferView),l=new oa.Mesh;if(!i.DecodeArrayToMesh(a,a.byteLength,l))throw new Error("Failed to decode Draco mesh");const u=t.json.accessors[e.indices],d=E1[u.componentType],f=u.count*d.BYTES_PER_ELEMENT,p=oa._malloc(f);d===Uint16Array?i.GetTrianglesUInt16Array(l,f,p):i.GetTrianglesUInt32Array(l,f,p),_m(oa.memory.buffer.slice(p,p+f),u,t),oa._free(p);for(const g of Object.keys(n.attributes)){const _=i.GetAttributeByUniqueId(l,n.attributes[g]),v=t.json.accessors[e.attributes[g]],x=kI[v.componentType],b=v.count*M1[v.type]*E1[v.componentType].BYTES_PER_ELEMENT,E=oa._malloc(b);i.GetAttributeDataArrayForAllPoints(l,_,oa[x],b,E),_m(oa.memory.buffer.slice(E,E+b),v,t),oa._free(E)}i.destroy(),l.destroy(),delete e.extensions[vy]}const C1=1179937895,QC=new TextDecoder("utf8");function Jd(e,t){return new URL(e,t).href}function ym(e,t,n,i){return fetch(Jd(e.uri,i)).then(a=>a.arrayBuffer()).then(a=>{t.buffers[n]=a})}function tT(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function LI(e,t,n,i){if(e.uri){const a=Jd(e.uri,i);return fetch(a).then(l=>l.blob()).then(l=>it.createImageBitmap(l)).then(l=>{t.images[n]=l})}if(void 0!==e.bufferView){const a=tT(t,e.bufferView),l=new it.Blob([a],{type:e.mimeType});return it.createImageBitmap(l).then(u=>{t.images[n]=u})}}function eT(e,t=0,n){const i={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===C1){const p=new Uint32Array(e,t);let g=2;const _=(p[g++]>>2)-3,v=p[g++]>>2;if(g++,i.json=JSON.parse(QC.decode(p.subarray(g,g+v))),g+=v,g<_){const x=p[g++];g++;const b=t+(g<<2);i.buffers[0]=e.slice(b,b+x)}}else i.json=JSON.parse(QC.decode(new Uint8Array(e,t)));const{buffers:a,images:l,meshes:u,extensionsUsed:d}=i.json;let f=Promise.resolve();if(a){const p=[];for(let g=0;g<a.length;g++){const _=a[g];_.uri?p.push(ym(_,i,g,n)):i.buffers[g]||(i.buffers[g]=null)}f=Promise.all(p)}return f.then(()=>{const p=[],g=d&&d.includes(vy);if(g&&p.push(function(){if(!oa)return gm||(gm=function(_){let v,x=null;function b(){v=new Uint8Array(x.buffer)}function E(){throw new Error("Unexpected Draco error.")}const T={a:{a:E,d:function(C,D,A){return v.copyWithin(C,D,D+A)},c:function(C){const D=v.length,A=Math.max(C>>>0,Math.ceil(1.2*D)),P=Math.ceil((A-D)/65536);try{return x.grow(P),b(),!0}catch{return!1}},b:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(_,T):_.then(C=>C.arrayBuffer()).then(C=>WebAssembly.instantiate(C,T))).then(C=>{const{Rb:D,Qb:A,P,T:I,X:R,Ja:k,La:L,Qa:N,Va:z,Wa:j,eb:B,jb:H,f:V,e:Z,yb:Q,zb:et,Ab:W,Bb:X,Db:rt,Gb:ot}=C.instance.exports;x=Z;const ct=(()=>{let dt=0,gt=0,at=0,ut=0;return St=>{at&&(D(ut),D(dt),gt+=at,at=dt=0),dt||(gt+=128,dt=A(gt));const Nt=St.length+7&-8;let zt=dt;Nt>=gt&&(at=Nt,zt=ut=A(Nt));for(let Vt=0;Vt<St.length;Vt++)v[zt+Vt]=St[Vt];return zt}})();return b(),V(),{memory:Z,_free:D,_malloc:A,Mesh:class{constructor(){this.ptr=P()}destroy(){I(this.ptr)}},Decoder:class{constructor(){this.ptr=k()}destroy(){H(this.ptr)}DecodeArrayToMesh(dt,gt,at){const ut=ct(dt),St=L(this.ptr,ut,gt,at.ptr);return!!R(St)}GetAttributeByUniqueId(dt,gt){return{ptr:N(this.ptr,dt.ptr,gt)}}GetTrianglesUInt16Array(dt,gt,at){z(this.ptr,dt.ptr,gt,at)}GetTrianglesUInt32Array(dt,gt,at){j(this.ptr,dt.ptr,gt,at)}GetAttributeDataArrayForAllPoints(dt,gt,at,ut,St){B(this.ptr,dt.ptr,gt.ptr,at,ut,St)}},DT_INT8:Q(),DT_UINT8:et(),DT_INT16:W(),DT_UINT16:X(),DT_UINT32:rt(),DT_FLOAT32:ot()}})}(fetch(JC())),gm.then(_=>{oa=_,gm=void 0}))}()),l)for(let _=0;_<l.length;_++)p.push(LI(l[_],i,_,n));return(p.length?Promise.all(p):Promise.resolve()).then(()=>{if(g&&u)for(const{primitives:_}of u)for(const v of _)KC(v,i);return i})})}function T1(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>eT(t,0,e))}class D1{constructor(t,n,i){if(this.triangleCount=n.length/3,this.min=new tt(0,0),this.max=new tt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===i)return;const a=t.map(g=>g.x),l=t.map(g=>g.y);this.min=new tt(Math.min(...a),Math.min(...l)),this.max=new tt(Math.max(...a),Math.max(...l));const u=this.max.sub(this.min);u.x=Math.max(u.x,1),u.y=Math.max(u.y,1);const d=Math.max(u.x,u.y)/i;this.cellsX=Math.max(1,Math.ceil(u.x/d)),this.cellsY=Math.max(1,Math.ceil(u.y/d)),this.xScale=1/d,this.yScale=1/d;const f=[];for(let g=0;g<this.triangleCount;g++){const _=t[n[3*g+0]].sub(this.min),v=t[n[3*g+1]].sub(this.min),x=t[n[3*g+2]].sub(this.min),b=uc(Math.floor(Math.min(_.x,v.x,x.x)),this.xScale,this.cellsX),E=uc(Math.floor(Math.max(_.x,v.x,x.x)),this.xScale,this.cellsX),T=uc(Math.floor(Math.min(_.y,v.y,x.y)),this.yScale,this.cellsY),C=uc(Math.floor(Math.max(_.y,v.y,x.y)),this.yScale,this.cellsY),D=new tt(0,0),A=new tt(0,0),P=new tt(0,0),I=new tt(0,0);for(let R=T;R<=C;++R){D.y=A.y=R*d,P.y=I.y=(R+1)*d;for(let k=b;k<=E;++k)D.x=P.x=k*d,A.x=I.x=(k+1)*d,(Mp(_,v,x,D,A,I)||Mp(_,v,x,D,I,P))&&f.push({cellIdx:R*this.cellsX+k,triIdx:g})}}if(0===f.length)return;f.sort((g,_)=>g.cellIdx-_.cellIdx||g.triIdx-_.triIdx);let p=0;for(;p<f.length;){const g=f[p].cellIdx,_={start:this.payload.length,len:0};for(;p<f.length&&f[p].cellIdx===g;)++_.len,this.payload.push(f[p++].triIdx);this.cells[g]=_}}query(t,n,i){if(0===this.triangleCount||0===this.cells.length||t.x>this.max.x||this.min.x>n.x||t.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let f=0;f<this.lookup.length;f++)this.lookup[f]=0;const a=uc(t.x-this.min.x,this.xScale,this.cellsX),l=uc(n.x-this.min.x,this.xScale,this.cellsX),u=uc(t.y-this.min.y,this.yScale,this.cellsY),d=uc(n.y-this.min.y,this.yScale,this.cellsY);for(let f=u;f<=d;f++)for(let p=a;p<=l;p++){const g=this.cells[f*this.cellsX+p];if(g)for(let _=0;_<g.len;_++){const v=this.payload[g.start+_],x=Math.floor(v/8),b=1<<v%8;if(!(this.lookup[x]&b)&&(this.lookup[x]|=b,i.push(v),i.length===this.triangleCount))return}}}}function uc(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}function sh(e,t){const n=e.json.bufferViews[t.bufferView];return new E1[t.componentType](e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*M1[t.type])}function nT(e,t,n){const i=e.indices,a=e.attributes,l={};l.indexArray=new Rr;const u=t.json.accessors[i],d=u.count/3;l.indexArray.reserve(d);const f=sh(t,u);for(let v=0;v<d;v++)l.indexArray.emplaceBack(f[3*v],f[3*v+1],f[3*v+2]);l.indexArray._trim(),l.vertexArray=new wa;const p=t.json.accessors[a.POSITION];l.vertexArray.reserve(p.count);const g=sh(t,p);for(let v=0;v<p.count;v++)l.vertexArray.emplaceBack(g[3*v],g[3*v+1],g[3*v+2]);if(l.vertexArray._trim(),l.aabb=new $n(p.min,p.max),l.centroid=function(v,x){const b=[0,0,0],E=v.length;if(E>0){for(let T=0;T<E;T++){const C=3*v[T];b[0]+=x[C],b[1]+=x[C+1],b[2]+=x[C+2]}b[0]/=E,b[1]/=E,b[2]/=E}return b}(f,g),void 0!==a.COLOR_0){const v=t.json.accessors[a.COLOR_0],x=M1[v.type];if(v.componentType===oh){l.colorArray=3===x?new wa:new rr,l.colorArray.reserve(v.count);const b=sh(t,v);if(3===x)for(let E=0;E<v.count;E++)l.colorArray.emplaceBack(b[3*E],b[3*E+1],b[3*E+2]);else for(let E=0;E<v.count;E++)l.colorArray.emplaceBack(b[4*E],b[4*E+1],b[4*E+2],b[4*E+3]);l.colorArray._trim()}else if(v.componentType===w1&&4===x){l.colorArray=new rr,l.colorArray.resize(v.count);const b=sh(t,v),E=1/65535,T=l.colorArray.float32;for(let C=0;C<4*b.length;++C)T[C]=b[C]*E}else K(`glTF color buffer parsing for accessor ${JSON.stringify(v)} is not supported`)}if(void 0!==a.NORMAL){l.normalArray=new wa;const v=t.json.accessors[a.NORMAL];l.normalArray.reserve(v.count);const x=sh(t,v);for(let b=0;b<v.count;b++)l.normalArray.emplaceBack(x[3*b],x[3*b+1],x[3*b+2]);l.normalArray._trim()}if(void 0!==a.TEXCOORD_0&&n.length>0){l.texcoordArray=new ku;const v=t.json.accessors[a.TEXCOORD_0];l.texcoordArray.reserve(v.count);const x=sh(t,v);for(let b=0;b<v.count;b++)l.texcoordArray.emplaceBack(x[2*b],x[2*b+1]);l.texcoordArray._trim()}const _=e.material;return l.material=function(v,x){const{emissiveFactor:b=[0,0,0],alphaMode:E="OPAQUE",alphaCutoff:T=.5,normalTexture:C,occlusionTexture:D,emissiveTexture:A,doubleSided:P}=v,{baseColorFactor:I=[1,1,1,1],metallicFactor:R=1,roughnessFactor:k=1,baseColorTexture:L,metallicRoughnessTexture:N}=v.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Ae(...I),metallicFactor:R,roughnessFactor:k,baseColorTexture:L?x[L.index]:void 0,metallicRoughnessTexture:N?x[N.index]:void 0},doubleSided:P,emissiveFactor:b,alphaMode:E,alphaCutoff:T,normalTexture:C?x[C.index]:void 0,occlusionTexture:D?x[D.index]:void 0,emissionTexture:A?x[A.index]:void 0,defined:void 0===v.defined}}(void 0!==_?t.json.materials[_]:{defined:!1},n),void 0!==a._FEATURE_RGBA4444&&(l.featureData=new Uint32Array(sh(t,t.json.accessors[a._FEATURE_RGBA4444]).buffer)),l}function rT(e,t,n){const{matrix:i,rotation:a,translation:l,scale:u,mesh:d,extras:f,children:p}=e,g={};if(g.matrix=i||nt.fromRotationTranslationScale([],a||[0,0,0,1],l||[0,0,0],u||[1,1,1]),void 0!==d){g.meshes=n[d];const _=g.anchor=[0,0];for(const v of g.meshes){const{min:x,max:b}=v.aabb;_[0]+=x[0]+b[0],_[1]+=x[1]+b[1]}_[0]=Math.floor(_[0]/g.meshes.length/2),_[1]=Math.floor(_[1]/g.meshes.length/2)}if(f&&(f.id&&(g.id=f.id),f.lights&&(g.lights=function(_){if(!_.length)return[];const v=function(C){const D=atob(C),A=new Uint8Array(D.length);for(let P=0;P<D.length;P++)A[P]=D.codePointAt(P);return A}(_),x=[],b=v.length/24,E=new Uint16Array(v.buffer),T=new Float32Array(v.buffer);for(let C=0;C<b;C++){const D=E[2*C*6]/30,A=E[2*C*6+1]/30,P=E[2*C*6+10]/100,I=T[6*C+1],R=T[6*C+2],k=T[6*C+3],L=T[6*C+4],N=k-I,z=L-R,j=Math.hypot(N,z);x.push({pos:[I+.5*N,R+.5*z,A],normal:[z/j,-N/j,0],width:j,height:D,depth:P,points:[I,R,k,L]})}return x}(f.lights))),p){const _=[];for(const v of p)_.push(rT(t.json.nodes[v],t,n));g.children=_}return g}function FI(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,n]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let u=1;u<e.vertices.length;++u){const d=e.vertices[u];t.x=Math.min(t.x,d.x),t.y=Math.min(t.y,d.y),n.x=Math.max(n.x,d.x),n.y=Math.max(n.y,d.y)}const i=Math.ceil(Math.max(n.x-t.x,n.y-t.y)/256),a=Math.max(8,i),l=new D1(e.vertices,e.indices,a);return{vertices:e.vertices,indices:e.indices,grid:l,min:t,max:n}}function bO(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const i=[];for(const u of n){if(!Array.isArray(u)||2!==u.length)continue;const d=u[0],f=u[1];"number"==typeof d&&"number"==typeof f&&i.push(new tt(d,f))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let a=0;for(let u=0;u<i.length;u++){const d=i[u],f=i[(u+1)%i.length],p=i[(u+2)%i.length];a+=(d.x-f.x)*(p.y-f.y)-(p.x-f.x)*(d.y-f.y)}a>0&&i.reverse();const l=E_(i.flatMap(u=>[u.x,u.y]),[]);return 0===l.length?null:{vertices:i,indices:l}}function wO(e){const t=[],n=[];let i=0;for(const a of e){i=t.length;const l=a.vertexArray.float32,u=a.indexArray.uint16;for(let d=0;d<a.vertexArray.length;d++)t.push(new tt(l[3*d+0],l[3*d+1]));for(let d=0;d<3*a.indexArray.length;d++)n.push(u[d]+i)}if(n.length%3!=0)return null;for(let a=0;a<n.length;a+=3){const l=t[n[a+0]],u=t[n[a+1]],d=t[n[a+2]];(l.x-u.x)*(d.y-u.y)-(d.x-u.x)*(l.y-u.y)>0&&([n[a+1],n[a+2]]=[n[a+2],n[a+1]])}return{vertices:t,indices:n}}function iT(e){const n=function(f,p){const g=[];for(const _ of f.json.meshes){const v=[];for(const x of _.primitives)v.push(nT(x,f,p));g.push(v)}return g}(e,function(f,p){const g=[],_=it.WebGL2RenderingContext;if(f.json.textures)for(const v of f.json.textures){const x={magFilter:_.LINEAR,minFilter:_.NEAREST,wrapS:_.REPEAT,wrapT:_.REPEAT};void 0!==v.sampler&&Object.assign(x,f.json.samplers[v.sampler]),g.push({image:p[v.source],sampler:x,uploaded:!1})}return g}(e,e.images)),{scenes:i,scene:a,nodes:l}=e.json,u=i?i[a||0].nodes:l,d=[];for(const f of u)d.push(rT(l[f],e,n));return function(f,p,g){const _={},v=new Set;for(let x=0;x<f.length;x++){const b=g[p[x]];if(!b.extras)continue;const E=b.extras["mapbox:footprint:version"],T=b.extras["mapbox:footprint:id"];(E||T)&&v.add(x),"1.0.0"===E&&T&&(_[T]=x)}for(let x=0;x<f.length;x++){if(v.has(x))continue;const b=f[x],E=g[p[x]];if(!E.extras)continue;let T=null;b.id in _&&(T=wO(f[_[b.id]].meshes)),T||(T=bO(E)),T&&(b.footprint=FI(T))}if(v.size>0){const x=Array.from(v.values()).sort((b,E)=>b-E);for(let b=x.length-1;b>=0;b--)f.splice(x[b],1)}}(d,u,e.json.nodes),d}function EO(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,i=e.aabb.min[1]-1,a=64/(e.aabb.max[0]-n+2),l=64/(e.aabb.max[1]-i+2);for(let u=0;u<t.length;u+=3){const d=t[u+2],f=(t[u+0]-n)*a|0,p=(t[u+1]-i)*l|0;d>e.heightmap[64*p+f]&&(e.heightmap[64*p+f]=d)}}function oT(e,t){const n={};n.indexArray=new Rr,n.indexArray.reserve(4*e.length),n.vertexArray=new wa,n.vertexArray.reserve(10*e.length),n.colorArray=new rr,n.vertexArray.reserve(10*e.length);let i=0;for(const u of e){const d=Math.min(10,Math.max(4,1.3*u.height))*t,f=[-u.normal[1],u.normal[0],0],p=Math.min(.29,.1*u.width/u.depth),g=u.width-2*u.depth*t*(p+.01),_=G.scaleAndAdd([],u.pos,f,g/2),v=G.scaleAndAdd([],u.pos,f,-g/2),x=[_[0],_[1],_[2]+u.height],b=[v[0],v[1],v[2]+u.height],E=G.scaleAndAdd([],u.normal,f,p);G.scale(E,E,d);const T=G.scaleAndAdd([],u.normal,f,-p);G.scale(T,T,d),G.add(E,_,E),G.add(T,v,T),_[2]+=.1,v[2]+=.1,n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(x[0],x[1],x[2]),n.vertexArray.emplaceBack(b[0],b[1],b[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]);const C=g/d/2;n.colorArray.emplaceBack(-C-p,-1,C,.8),n.colorArray.emplaceBack(C+p,-1,C,.8),n.colorArray.emplaceBack(-C,0,C,1.3),n.colorArray.emplaceBack(C,0,C,1.3),n.colorArray.emplaceBack(C+p,-.8,C,.7),n.colorArray.emplaceBack(C+p,-.8,C,.7),n.colorArray.emplaceBack(0,0,C,1.3),n.colorArray.emplaceBack(0,0,C,1.3),n.colorArray.emplaceBack(C+p,-1.2,C,.8),n.colorArray.emplaceBack(C+p,-1.2,C,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}const a={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=Ae.white,a.pbrMetallicRoughness=l,n.material=a,n.aabb=new $n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Gt(D1,"TriangleGridIndex");const Kd={vector:pm,raster:su,"raster-dem":class extends su{constructor(e,t,n,i){super(e,t,n,i),this.type="raster-dem",this.maxzoom=22,this._options=qt({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);e.request=Te(this.map._requestManager.transformRequest(n,ft.Tile),function(l,u,d,f){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(l)e.state="errored",t(l);else if(u){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:d,expires:f});const g=it.ImageBitmap&&u instanceof it.ImageBitmap&&(null==To&&(To=it.OffscreenCanvas&&new it.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof it.createImageBitmap),To),_=1-(u.width-((p=u.width)<=1?1:Math.pow(2,Math.floor(Math.log(p)/Math.LN2))))/2;_<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const v=g?u:Ft.getImageData(u,_),x={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:v,encoding:this.encoding,padding:_,convertToFloat:i};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",x,a.bind(this),void 0,!0))}var p}.bind(this));const i=this.map?.painter?.terrainUseFloatDEM();function a(l,u){l&&(e.state="errored",t(l)),u&&(e.dem=u,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",t(null))}}_getNeighboringTiles(e){const t=e.canonical,n=Math.pow(2,t.z),i=(t.x-1+n)%n,a=0===t.x?e.wrap-1:e.wrap,l=(t.x+1+n)%n,u=t.x+1===n?e.wrap+1:e.wrap,d={};return d[new Ze(e.overscaledZ,a,t.z,i,t.y).key]={backfilled:!1},d[new Ze(e.overscaledZ,u,t.z,l,t.y).key]={backfilled:!1},t.y>0&&(d[new Ze(e.overscaledZ,a,t.z,i,t.y-1).key]={backfilled:!1},d[new Ze(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},d[new Ze(e.overscaledZ,u,t.z,l,t.y-1).key]={backfilled:!1}),t.y+1<n&&(d[new Ze(e.overscaledZ,a,t.z,i,t.y+1).key]={backfilled:!1},d[new Ze(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},d[new Ze(e.overscaledZ,u,t.z,l,t.y+1).key]={backfilled:!1}),d}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.hillshadeFBO&&(e.hillshadeFBO.destroy(),delete e.hillshadeFBO),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends wr{constructor(e,t,n,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=t.data,this._options=qt({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const a=lt/this.tileSize;this.workerOptions=qt({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*a,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*a,extent:lt,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:lt,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*a,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Mt("dataloading",{dataType:"source"})),this._loaded=!1;const e=qt({},this.workerOptions);e.scope=this.scope;const t=this._data;"string"==typeof t?(e.request=this.map._requestManager.transformRequest(Ft.resolveURL(t),ft.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(n,i)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new pt(n));else{const a={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(a.resourceTiming=i.resourceTiming[this.id]),this.fire(new Mt("data",a)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const i={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:Ft.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(n,i,(a,l)=>(delete e.request,e.unloadVectorData(),e.aborted?t(null):a?t(a):(e.loadVectorData(l,this.map.painter,"reloadTile"===n),t(null))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return qt({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends bl{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,ft.Source).url);!function(t,n){const i=it.document.createElement("video");i.muted=!0,i.onloadstart=function(){n(null,i)};for(let a=0;a<t.length;a++){const l=it.document.createElement("source");Bt(t[a])||(i.crossOrigin="Anonymous"),l.src=t[a],i.appendChild(l)}}(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new pt(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new pt(new Dt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new kr(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:bl,model:class extends wr{constructor(e,t,n,i){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const n=this._options.models[t],i=T1(this.map._requestManager.transformRequest(n.uri,ft.Model).url).then(a=>{if(!a)return;const l=iT(a),u=new e1(t,n.position,n.orientation,l);u.computeBoundsAndApplyParent(),this.models.push(u)}).catch(a=>{this.fire(new pt(new Error(`Could not load model ${t} from ${n.uri}: ${a.message}`)))});e.push(i)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Mt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new pt(new Error(`Could not load models: ${t.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends wr{constructor(e,t,n,i){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Mt("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=gy(this._options,this.map._requestManager,t,n,(i,a)=>{this._tileJSONRequest=null,this._loaded=!0,i?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new pt(i))):a&&(qt(this,a),a.bounds&&(this.tileBounds=new fm(a.bounds,this.minzoom,this.maxzoom)),Dc(a.tiles,this.map._requestManager._customAccessToken),this.fire(new Mt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Mt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,ft.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=t;else{if(e.buckets){const l=Object.values(e.buckets);for(const u of l)u.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",i,a.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,a.bind(this),void 0,!0);function a(l,u){return e.aborted?t(null):l&&404!==l.status?t(l):(u&&(u.resourceTiming&&(e.resourceTiming=u.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(u),e.buckets={...e.buckets,...u.buckets}),e.state="loaded",void t(null))}}serialize(){return qt({},this._options)}},canvas:class extends bl{constructor(e,t,n,i){super(e,t,n,i),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(a=>!Array.isArray(a)||2!==a.length||a.some(l=>"number"!=typeof l))||this.fire(new pt(new Dt(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new pt(new Dt(`sources.${e}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new pt(new Dt(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof it.HTMLCanvasElement||this.fire(new pt(new Dt(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new pt(new Dt(`sources.${e}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof it.HTMLCanvasElement?this.options.canvas:it.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new pt(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof Q_||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new kr(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends wr{constructor(e,t,n,i){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new pt(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new pt(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fm(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),qt(this,Ro(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Ro(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Mt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Mt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Mt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:i}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:n,y:i,z:a}=e.tileID.canonical,l=new it.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:a},{signal:l.signal})).then(function(u){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===u?(e.state="errored",t(null)):null===u?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):(d=u)instanceof it.ImageData||d instanceof it.HTMLCanvasElement||d instanceof it.ImageBitmap||d instanceof it.HTMLImageElement?(this.loadTileData(e,u),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var d}.bind(this)).catch(u=>{20!==u.code&&(e.state="errored",t(u))}),e.request.cancel=()=>l.abort()}loadTileData(e,t){su.loadTileData(e,t,this._map.painter)}unloadTileData(e){su.unloadTileData(e,this._map.painter)}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:n,y:i,z:a}=e.tileID.canonical;this._implementation.unloadTile({x:n,y:i,z:a})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const e=Pi(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Mt("data",{dataType:"source",sourceDataType:"content"}))}}},S1=function(e,t,n,i){const a=new Kd[t.type](e,t,n,i);if(a.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${a.id}`);return ui(["load","abort","unload","serialize","prepare"],a),a};function NI(e,t){const n=nt.identity([]);return nt.scale(n,n,[.5*e.width,.5*-e.height,1]),nt.translate(n,n,[1,-1,0]),nt.multiply(n,n,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(n)}function sT(e,t,n,i,a,l,u,d=!1){const f=e.tilesIn(i,u,d);f.sort(aT);const p=[];for(const _ of f)p.push({wrappedTileID:_.tile.tileID.wrapped().key,queryResults:_.tile.queryRenderedFeatures(t,n,e._state,_,a,l,NI(e.transform,_.tile.tileID),d)});const g=function(_){const v={},x={};for(const b of _){const E=b.queryResults,T=b.wrappedTileID,C=x[T]=x[T]||{};for(const D in E){const A=E[D],P=C[D]=C[D]||{},I=v[D]=v[D]||[];for(const R of A)P[R.featureIndex]||(P[R.featureIndex]=!0,I.push(R))}}return v}(p);for(const _ in g)g[_].forEach(v=>{const x=v.feature,b=x.layer;b&&"background"!==b.type&&"sky"!==b.type&&"slot"!==b.type&&(x.source=b.source,b["source-layer"]&&(x.sourceLayer=b["source-layer"]),x.state=void 0!==x.id?e.getFeatureState(b["source-layer"],x.id):{})});return g}function vm(e,t){const n=e.getRenderableIds().map(l=>e.getTileByID(l)),i=[],a={};for(let l=0;l<n.length;l++){const u=n[l],d=u.tileID.canonical.key;a[d]||(a[d]=!0,u.querySourceFeatures(i,t))}return i}function aT(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class zI{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(const t in this.style._mergedLayers){const n=this.style._mergedLayers[t];if("fill-extrusion"===n.type)this.layers.push(n);else if("model"===n.type){const i=this.style.getLayerSource(n);i&&"batched-model"===i.type&&this.layers.push(n)}}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(let a=0;a<this.layers.length;++a){const l=this.layers[a],u=this.style.getLayerSourceCache(l);let d=1;"fill-extrusion"===l.type&&(d=l.paint.get("fill-extrusion-opacity")>0?l.paint.get("fill-extrusion-vertical-scale"):0);let f=u?u.getTile(n):null;if(!f&&u&&n.canonical.z>u.getSource().minzoom){let p=n.scaledTo(Math.min(u.getSource().maxzoom,n.overscaledZ-1));for(;p.overscaledZ>=u.getSource().minzoom&&(f=u.getTile(p),!f&&0!==p.overscaledZ);)p=p.scaledTo(p.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:f?f.getBucket(l):null,tileID:f?f.tileID:n,verticalScale:d})}t.hasAnyZOffset=!1;let i=!1;for(let a=0;a<t.symbolInstances.length;a++){const l=t.symbolInstances.get(a),u=l.zOffset,d=this._getHeightAtTileOffset(n,l.tileAnchorX,l.tileAnchorY);l.zOffset=-1!==d?d:u,i||u===l.zOffset||(i=!0),t.hasAnyZOffset||0===l.zOffset||(t.hasAnyZOffset=!0)}i&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,i,a){let l=n,u=i;if(t.canonical.z!==a.canonical.z){const d=a.canonical,f=1/(1<<t.canonical.z-d.z);l=(n+t.canonical.x*lt)*f-d.x*lt|0,u=(i+t.canonical.y*lt)*f-d.y*lt|0}return{tileX:l,tileY:u}}_getHeightAtTileOffset(t,n,i){let a;for(let l=0;l<this.layers.length;++l){if("fill-extrusion"!==this.layers[l].type)continue;const{bucket:u,tileID:d,verticalScale:f}=this.currentBuildingBuckets[l];if(!u)continue;const{tileX:p,tileY:g}=this._mapCoordToOverlappingTile(t,n,i,d),_=u.getHeightAtTileCoord(p,g);if(_&&void 0!==_.height){if(!_.hidden)return _.height*f;a=_.height}}for(let l=0;l<this.layers.length;++l){if("model"!==this.layers[l].type)continue;const{bucket:u,tileID:d}=this.currentBuildingBuckets[l];if(!u)continue;const{tileX:f,tileY:p}=this._mapCoordToOverlappingTile(t,n,i,d),g=u.getHeightAtTileCoord(f,p);if(g&&!g.hidden)return void 0===g.height&&void 0!==a?Math.min(g.maxHeight,a)*g.verticalScale:(g.height||0)*g.verticalScale}return-1}}var lT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function BI(e,t){const n={};for(const i in e)"ref"!==i&&(n[i]=e[i]);return lT.forEach(i=>{i in t&&(n[i]=t[i])}),n}function VI(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=BI(e[n],t[e[n].ref]));return e}const ln={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function I1(e,t,n){n.push({command:ln.addSource,args:[e,t[e]]})}function cT(e,t,n){t.push({command:ln.removeSource,args:[e]}),n[e]=!0}function jI(e,t,n,i){cT(e,n,i),I1(e,t,n)}function xm(e,t,n){let i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!tn(e[n][i],t[n][i]))return!1;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!tn(e[n][i],t[n][i]))return!1;return!0}function xy(e,t,n,i,a,l){let u;for(u in t=t||{},e=e||{})e.hasOwnProperty(u)&&(tn(e[u],t[u])||n.push({command:l,args:[i,u,t[u],a]}));for(u in t)t.hasOwnProperty(u)&&!e.hasOwnProperty(u)&&(tn(e[u],t[u])||n.push({command:l,args:[i,u,t[u],a]}))}function bm(e){return e.id}function by(e,t){return e[t.id]=t,e}class uT{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=Wt(t,0,1);let n=1,i=this._distances[n];const a=t*this.paddedLength+this.padding;for(;i<a&&n<this._distances.length;)i=this._distances[++n];const l=n-1,u=this._distances[l],d=i-u,f=d>0?(a-u)/d:0;return this.points[l].mult(1-f).add(this.points[n].mult(f))}}class hT{constructor(t,n,i){const a=this.boxCells=[],l=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(n/i);for(let u=0;u<this.xCellCount*this.yCellCount;u++)a.push([]),l.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,i,a,l){this._forEachCell(n,i,a,l,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(l)}insertCircle(t,n,i,a){this._forEachCell(n-a,i-a,n+a,i+a,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(i),this.circles.push(a)}_insertBoxCell(t,n,i,a,l,u){this.boxCells[l].push(u)}_insertCircleCell(t,n,i,a,l,u){this.circleCells[l].push(u)}_query(t,n,i,a,l,u){if(i<0||t>this.width||a<0||n>this.height)return!l&&[];const d=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(l)return!0;for(let f=0;f<this.boxKeys.length;f++)d.push({key:this.boxKeys[f],x1:this.bboxes[4*f],y1:this.bboxes[4*f+1],x2:this.bboxes[4*f+2],y2:this.bboxes[4*f+3]});for(let f=0;f<this.circleKeys.length;f++){const p=this.circles[3*f],g=this.circles[3*f+1],_=this.circles[3*f+2];d.push({key:this.circleKeys[f],x1:p-_,y1:g-_,x2:p+_,y2:g+_})}return u?d.filter(u):d}return this._forEachCell(t,n,i,a,this._queryCell,d,{hitTest:l,seenUids:{box:{},circle:{}}},u),l?d.length>0:d}_queryCircle(t,n,i,a,l){const u=t-i,d=t+i,f=n-i,p=n+i;if(d<0||u>this.width||p<0||f>this.height)return!a&&[];const g=[];return this._forEachCell(u,f,d,p,this._queryCellCircle,g,{hitTest:a,circle:{x:t,y:n,radius:i},seenUids:{box:{},circle:{}}},l),a?g.length>0:g}query(t,n,i,a,l){return this._query(t,n,i,a,!1,l)}hitTest(t,n,i,a,l){return this._query(t,n,i,a,!0,l)}hitTestCircle(t,n,i,a){return this._queryCircle(t,n,i,!0,a)}_queryCell(t,n,i,a,l,u,d,f){const p=d.seenUids,g=this.boxCells[l];if(null!==g){const v=this.bboxes;for(const x of g)if(!p.box[x]){p.box[x]=!0;const b=4*x;if(t<=v[b+2]&&n<=v[b+3]&&i>=v[b+0]&&a>=v[b+1]&&(!f||f(this.boxKeys[x]))){if(d.hitTest)return u.push(!0),!0;u.push({key:this.boxKeys[x],x1:v[b],y1:v[b+1],x2:v[b+2],y2:v[b+3]})}}}const _=this.circleCells[l];if(null!==_){const v=this.circles;for(const x of _)if(!p.circle[x]){p.circle[x]=!0;const b=3*x;if(this._circleAndRectCollide(v[b],v[b+1],v[b+2],t,n,i,a)&&(!f||f(this.circleKeys[x]))){if(d.hitTest)return u.push(!0),!0;{const E=v[b],T=v[b+1],C=v[b+2];u.push({key:this.circleKeys[x],x1:E-C,y1:T-C,x2:E+C,y2:T+C})}}}}}_queryCellCircle(t,n,i,a,l,u,d,f){const p=d.circle,g=d.seenUids,_=this.boxCells[l];if(null!==_){const x=this.bboxes;for(const b of _)if(!g.box[b]){g.box[b]=!0;const E=4*b;if(this._circleAndRectCollide(p.x,p.y,p.radius,x[E+0],x[E+1],x[E+2],x[E+3])&&(!f||f(this.boxKeys[b])))return u.push(!0),!0}}const v=this.circleCells[l];if(null!==v){const x=this.circles;for(const b of v)if(!g.circle[b]){g.circle[b]=!0;const E=3*b;if(this._circlesCollide(x[E],x[E+1],x[E+2],p.x,p.y,p.radius)&&(!f||f(this.circleKeys[b])))return u.push(!0),!0}}}_forEachCell(t,n,i,a,l,u,d,f){const p=this._convertToXCellCoord(t),g=this._convertToYCellCoord(n),_=this._convertToXCellCoord(i),v=this._convertToYCellCoord(a);for(let x=p;x<=_;x++)for(let b=g;b<=v;b++)if(l.call(this,t,n,i,a,this.xCellCount*b+x,u,d,f))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,i,a,l,u){const d=a-t,f=l-n,p=i+u;return p*p>d*d+f*f}_circleAndRectCollide(t,n,i,a,l,u,d){const f=(u-a)/2,p=Math.abs(t-(a+f));if(p>f+i)return!1;const g=(d-l)/2,_=Math.abs(n-(l+g));if(_>g+i)return!1;if(p<=f||_<=g)return!0;const v=p-f,x=_-g;return v*v+x*x<=i*i}}const Na=100;class UI{constructor(t,n,i=new hT(t.width+200,t.height+200,25),a=new hT(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Na,this.screenBottomBoundary=t.height+Na,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,i,a,l,u,d,f){let p=i.projectedAnchorX,g=i.projectedAnchorY,_=i.projectedAnchorZ;const v=i.elevation,x=i.tileID,b=t.getProjection();if(v&&x){const[R,k,L]=b.upVector(x.canonical,i.tileAnchorX,i.tileAnchorY),N=b.upVectorScale(x.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;p+=R*v*N,g+=k*v*N,_+=L*v*N}const E=this.projectAndGetPerspectiveRatio(d,p,g,_,i.tileID,"globe"===b.name||!!v||this.transform.pitch>0,b),T=u*E.perspectiveRatio,C=(i.x1*n+a.x-i.padding)*T+E.point.x,D=(i.y1*n+a.y-i.padding)*T+E.point.y,A=(i.x2*n+a.x+i.padding)*T+E.point.x,P=(i.y2*n+a.y+i.padding)*T+E.point.y,I=E.perspectiveRatio<=.55||E.occluded;return!this.isInsideGrid(C,D,A,P)||!l&&this.grid.hitTest(C,D,A,P,f)||I?{box:[],offscreen:!1,occluded:E.occluded}:{box:[C,D,A,P],offscreen:this.isOffscreen(C,D,A,P),occluded:!1}}placeCollisionCircles(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E){const T=[],C=this.transform.elevation,D=t.getProjection(),A=C?C.getAtTileOffsetFunc(E,this.transform.center.lat,this.transform.worldSize,D):null,P=new tt(i.tileAnchorX,i.tileAnchorY);let{x:I,y:R,z:k}=D.projectTilePoint(P.x,P.y,E.canonical);if(A){const[et,W,X]=A(P);I+=et,R+=W,k+=X}const L="globe"===D.name,N=this.projectAndGetPerspectiveRatio(d,I,R,k,E,L||!!C||this.transform.pitch>0,D),{perspectiveRatio:z}=N,j=(_?u/z:u*z)/pi,B=ia(I,R,k,f),H=N.signedDistanceFromCamera>0?Gd(j,l,i.lineOffsetX*j,i.lineOffsetY*j,!1,B,P,i,a,f,{},C&&!_?A:null,_&&!!C,D,E,_):null;let V=!1,Z=!1,Q=!0;if(H&&!N.occluded){const et=.5*x*z+b,W=new tt(-100,-100),X=new tt(this.screenRightBoundary,this.screenBottomBoundary),rt=new uT,{first:ot,last:ct}=H,dt=ot.path.length;let gt=[];for(let St=dt-1;St>=1;St--)gt.push(ot.path[St]);for(let St=1;St<ct.path.length;St++)gt.push(ct.path[St]);const at=2.5*et;p&&(gt=gt.map(([St,Nt,zt],Vt)=>(A&&!L&&(zt=A(Vt<dt-1?ot.tilePath[dt-1-Vt]:ct.tilePath[Vt-dt+2])[2]),ia(St,Nt,zt,p))),gt.some(St=>St[3]<=0)&&(gt=[]));let ut=[];if(gt.length>0){let St=1/0,Nt=-1/0,zt=1/0,Vt=-1/0;for(const Kt of gt)St=Math.min(St,Kt[0]),zt=Math.min(zt,Kt[1]),Nt=Math.max(Nt,Kt[0]),Vt=Math.max(Vt,Kt[1]);Nt>=W.x&&St<=X.x&&Vt>=W.y&&zt<=X.y&&(ut=[gt.map(Kt=>new tt(Kt[0],Kt[1]))],(St<W.x||Nt>X.x||zt<W.y||Vt>X.y)&&(ut=hs(ut,W.x,W.y,X.x,X.y)))}for(const St of ut){rt.reset(St,.25*et);let Nt=0;Nt=rt.length<=.5*et?1:Math.ceil(rt.paddedLength/at)+1;for(let zt=0;zt<Nt;zt++){const Vt=zt/Math.max(Nt-1,1),Kt=rt.lerp(Vt),he=Kt.x+Na,Oe=Kt.y+Na;T.push(he,Oe,et,0);const Xe=he-et,Ce=Oe-et,xe=he+et,ce=Oe+et;if(Q=Q&&this.isOffscreen(Xe,Ce,xe,ce),Z=Z||this.isInsideGrid(Xe,Ce,xe,ce),!n&&this.grid.hitTestCircle(he,Oe,et,v)&&(V=!0,!g))return{circles:[],offscreen:!1,collisionDetected:V,occluded:!1}}}}return{circles:!g&&V||!Z?[]:T,offscreen:Q,collisionDetected:V,occluded:N.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,a=1/0,l=-1/0,u=-1/0;for(const g of t){const _=new tt(g.x+Na,g.y+Na);i=Math.min(i,_.x),a=Math.min(a,_.y),l=Math.max(l,_.x),u=Math.max(u,_.y),n.push(_)}const d=this.grid.query(i,a,l,u).concat(this.ignoredGrid.query(i,a,l,u)),f={},p={};for(const g of d){const _=g.key;void 0===f[_.bucketInstanceId]&&(f[_.bucketInstanceId]={}),f[_.bucketInstanceId][_.featureIndex]||fd(n,[new tt(g.x1,g.y1),new tt(g.x2,g.y1),new tt(g.x2,g.y2),new tt(g.x1,g.y2)])&&(f[_.bucketInstanceId][_.featureIndex]=!0,void 0===p[_.bucketInstanceId]&&(p[_.bucketInstanceId]=[]),p[_.bucketInstanceId].push(_.featureIndex))}return p}insertCollisionBox(t,n,i,a,l){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:a,collisionGroupID:l},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,i,a,l){const u=n?this.ignoredGrid:this.grid,d={bucketInstanceId:i,featureIndex:a,collisionGroupID:l};for(let f=0;f<t.length;f+=4)u.insertCircle(d,t[f],t[f+1],t[f+2])}projectAndGetPerspectiveRatio(t,n,i,a,l,u,d){const f=[n,i,a,1];let p=!1;a||this.transform.pitch>0?(vn.transformMat4(f,f,t),this.fogState&&l&&"globe"!==d.name&&(p=function(v,x,b,E,T,C){const D=C.calculateFogTileMatrix(T),A=[x,b,E];return G.transformMat4(A,A,D),hm(v,G.length(A),C.pitch,C._fov)}(this.fogState,n,i,a,l.toUnwrapped(),this.transform)>.9)):Qx(f,f,t);const g=f[3];return{point:new tt((f[0]/g+1)/2*this.transform.width+Na,(-f[1]/g+1)/2*this.transform.height+Na),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(d)/g*.5,1.5),signedDistanceFromCamera:g,occluded:u&&f[2]>g||p}}isOffscreen(t,n,i,a){return i<Na||t>=this.screenRightBoundary||a<Na||n>this.screenBottomBoundary}isInsideGrid(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=nt.identity([]);return nt.translate(t,t,[-100,-100,0]),t}}function wm(e,t,n){const i=t.createTileMatrix(e,e.worldSize,n.toUnwrapped());return nt.multiply(new Float32Array(16),e.projMatrix,i)}function $I(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const i=n.clone();return i.setProjection(t.projection),wm(i,t.getProjection(),e)}function wy(e,t,n){return t.name===n.projection.name?e.projMatrix:wm(n,t,e)}class A1{constructor(t,n,i,a){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):a&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Em{constructor(t,n,i,a,l,u=!1){this.text=new A1(t?t.text:null,n,i,l),this.icon=new A1(t?t.icon:null,n,a,l),this.clipped=u}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class P1{constructor(t,n,i,a=!1){this.text=t,this.icon=n,this.skipFade=i,this.clipped=a}}class HI{constructor(){this.invProjMatrix=nt.create(),this.viewportMatrix=nt.create(),this.circles=[]}}class R1{constructor(t,n,i,a,l){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=i,this.bucketIndex=a,this.tileID=l}}class GI{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:i=>i.collisionGroupID===n}}return this.collisionGroups[t]}}function O1(e,t,n,i,a){const{horizontalAlign:l,verticalAlign:u}=B_(e),d=-(l-.5)*t,f=-(u-.5)*n,p=Up(e,i);return new tt(d+p[0]*a,f+p[1]*a)}function k1(e,t,n,i,a){const l=new tt(e,t);return n&&l._rotate(i?a:-a),l}class qI{constructor(t,n,i,a,l,u){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new UI(this.transform,l),this.buildingIndex=u,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new GI(i),this.collisionCircleArrays={},this.prevPlacement=a,a&&(a.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,i,a){const l=i.getBucket(n),u=i.latestFeatureIndex;if(!l||!u||n.fqid!==l.layerIds[0])return;const d=l.layers[0].layout,f=i.collisionBoxArray,p=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),g=i.tileSize/lt,_=i.tileID.toUnwrapped();this.transform.setProjection(l.projection);const v=(x=i.tileID,b=l.getProjection(),E=this.transform,b.name===this.projection?E.calculateProjMatrix(x.toUnwrapped()):wm(E,b,x));var x,b,E;const T="map"===d.get("text-pitch-alignment"),C="map"===d.get("text-rotation-alignment");n.compileFilter();const D=n.dynamicFilter(),A=n.dynamicFilterNeedsFeature(),P=this.transform.calculatePixelsToTileUnitsMatrix(i),I=ly(v,i.tileID.canonical,T,C,this.transform,l.getProjection(),P);let R=null;if(T){const N=Yx(v,i.tileID.canonical,T,C,this.transform,l.getProjection(),P);R=nt.multiply([],this.transform.labelPlaneMatrix,N)}let k=null;D&&i.latestFeatureIndex&&(k={unwrappedTileID:_,dynamicFilter:D,dynamicFilterNeedsFeature:A,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[l.bucketInstanceId]=new R1(l.bucketInstanceId,u,l.sourceLayerIndex,l.index,i.tileID);const L={bucket:l,layout:d,posMatrix:v,textLabelPlaneMatrix:I,labelToScreenMatrix:R,clippingData:k,scale:p,textPixelRatio:g,holdingForFade:i.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:tc(l.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:tc(l.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(l.sourceID)};if(a)for(const N of l.sortKeyRanges){const{sortKey:z,symbolInstanceStart:j,symbolInstanceEnd:B}=N;t.push({sortKey:z,symbolInstanceStart:j,symbolInstanceEnd:B,parameters:L})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:l.symbolInstances.length,parameters:L})}attemptAnchorPlacement(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D){const{textOffset0:A,textOffset1:P,crossTileID:I}=v,R=[A,P],k=O1(t,i,a,R,l),L=this.collisionIndex.placeCollisionBox(b,l,n,k1(k.x,k.y,u,d,this.transform.angle),_,f,p,g.predicate);if(T){const N=b.getSymbolInstanceIconSize(D,this.transform.zoom,v.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(b,N,T,k1(k.x,k.y,u,d,this.transform.angle),_,f,p,g.predicate).box.length)return}if(L.box.length>0){let N;return this.prevPlacement&&this.prevPlacement.variableOffsets[I]&&this.prevPlacement.placements[I]&&this.prevPlacement.placements[I].text&&(N=this.prevPlacement.variableOffsets[I].anchor),this.variableOffsets[I]={textOffset:R,width:i,height:a,anchor:t,textScale:l,prevAnchor:N},this.markUsedJustification(b,t,v,E),b.allowVerticalPlacement&&(this.markUsedOrientation(b,E,v),this.placedOrientations[I]=E),{shift:k,placedGlyphBoxes:L}}}placeLayerBucketPart(t,n,i,a){const{bucket:l,layout:u,posMatrix:d,textLabelPlaneMatrix:f,labelToScreenMatrix:p,clippingData:g,textPixelRatio:_,holdingForFade:v,collisionBoxArray:x,partiallyEvaluatedTextSize:b,partiallyEvaluatedIconSize:E,collisionGroup:T}=t.parameters,C=u.get("text-optional"),D=u.get("icon-optional"),A=u.get("text-allow-overlap"),P=u.get("icon-allow-overlap"),I="map"===u.get("text-rotation-alignment"),R="map"===u.get("text-pitch-alignment"),k="viewport-y"===u.get("symbol-z-order"),L=u.get("symbol-z-elevate");this.transform.setProjection(l.projection);let N=A&&(P||!l.hasIconData()||D),z=P&&(A||!l.hasTextData()||C);!l.collisionArrays&&x&&l.deserializeCollisionBoxes(x),i&&a&&l.updateCollisionDebugBuffers(this.transform.zoom,x);const j=(B,H,V)=>{const{crossTileID:Z,numVerticalGlyphVertices:Q}=B;if(g){const xe={zoom:this.transform.zoom,pitch:this.transform.pitch};let ce=null;if(g.dynamicFilterNeedsFeature){const ie=this.retainedQueryData[l.bucketInstanceId];ce=g.featureIndex.loadFeature({featureIndex:B.featureIndex,bucketIndex:ie.bucketIndex,sourceLayerIndex:ie.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,g.dynamicFilter)(xe,ce,this.retainedQueryData[l.bucketInstanceId].tileID.canonical,new tt(B.tileAnchorX,B.tileAnchorY),this.transform.calculateDistanceTileData(g.unwrappedTileID)))return this.placements[Z]=new P1(!1,!1,!1,!0),void n.add(Z)}if(n.has(Z))return;if(v)return void(this.placements[Z]=new P1(!1,!1,!1));let et=!1,W=!1,X=!0,rt=!1,ot=!1,ct=null,dt={box:null,offscreen:null,occluded:null},gt={box:null,offscreen:null,occluded:null},at=null,ut=null,St=null,Nt=0,zt=0,Vt=0;V.textFeatureIndex?Nt=V.textFeatureIndex:B.useRuntimeCollisionCircles&&(Nt=B.featureIndex),V.verticalTextFeatureIndex&&(zt=V.verticalTextFeatureIndex);const Kt=xe=>{xe.tileID=this.retainedQueryData[l.bucketInstanceId].tileID;const ce=this.transform.elevation;xe.elevation=B.zOffset+(ce?ce.getAtTileOffset(xe.tileID,xe.tileAnchorX,xe.tileAnchorY):0)},he=V.textBox;if(he){Kt(he);const xe=ie=>{let Ne=Hn.horizontal;if(l.allowVerticalPlacement&&!ie&&this.prevPlacement){const Ke=this.prevPlacement.placedOrientations[Z];Ke&&(this.placedOrientations[Z]=Ke,Ne=Ke,this.markUsedOrientation(l,Ne,B))}return Ne},ce=(ie,Ne)=>{if(l.allowVerticalPlacement&&Q>0&&V.verticalTextBox){for(const Ke of l.writingModes)if(Ke===Hn.vertical?(dt=Ne(),gt=dt):dt=ie(),dt&&dt.box&&dt.box.length)break}else dt=ie()};if(u.get("text-variable-anchor")){let ie=u.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z]){const Re=this.prevPlacement.variableOffsets[Z];ie.indexOf(Re.anchor)>0&&(ie=ie.filter(Sn=>Sn!==Re.anchor),ie.unshift(Re.anchor))}const Ne=(Re,Sn,or)=>{const Gn=l.getSymbolInstanceTextSize(b,B,this.transform.zoom,H),kn=(Re.x2-Re.x1)*Gn+2*Re.padding,Vr=(Re.y2-Re.y1)*Gn+2*Re.padding,Kn=B.hasIconTextFit&&!P?Sn:null;Kn&&Kt(Kn);let qn={box:[],offscreen:!1,occluded:!1};const Cn=A?2*ie.length:ie.length;for(let So=0;So<Cn;++So){const Ba=this.attemptAnchorPlacement(ie[So%ie.length],Re,kn,Vr,Gn,I,R,_,d,T,So>=ie.length,B,H,l,or,Kn,b,E);if(Ba&&(qn=Ba.placedGlyphBoxes,qn&&qn.box&&qn.box.length)){et=!0,ct=Ba.shift;break}}return qn};ce(()=>Ne(he,V.iconBox,Hn.horizontal),()=>{const Re=V.verticalTextBox;return Re&&Kt(Re),l.allowVerticalPlacement&&!(dt&&dt.box&&dt.box.length)&&Q>0&&Re?Ne(Re,V.verticalIconBox,Hn.vertical):{box:null,offscreen:null,occluded:null}}),dt&&(et=dt.box,X=dt.offscreen,rt=dt.occluded);const Ke=xe(!(!dt||!dt.box));if(!et&&this.prevPlacement){const Re=this.prevPlacement.variableOffsets[Z];Re&&(this.variableOffsets[Z]=Re,this.markUsedJustification(l,Re.anchor,B,Ke))}}else{const ie=(Ne,Ke)=>{const Re=l.getSymbolInstanceTextSize(b,B,this.transform.zoom,H),Sn=this.collisionIndex.placeCollisionBox(l,Re,Ne,new tt(0,0),A,_,d,T.predicate);return Sn&&Sn.box&&Sn.box.length&&(this.markUsedOrientation(l,Ke,B),this.placedOrientations[Z]=Ke),Sn};ce(()=>ie(he,Hn.horizontal),()=>{const Ne=V.verticalTextBox;return l.allowVerticalPlacement&&Q>0&&Ne?(Kt(Ne),ie(Ne,Hn.vertical)):{box:null,offscreen:null,occluded:null}}),xe(!!(dt&&dt.box&&dt.box.length))}}if(at=dt,et=at&&at.box&&at.box.length>0,X=at&&at.offscreen,rt=at&&at.occluded,B.useRuntimeCollisionCircles){const xe=l.text.placedSymbolArray.get(B.centerJustifiedTextSymbolIndex>=0?B.centerJustifiedTextSymbolIndex:B.verticalPlacedTextSymbolIndex),ce=Bp(l.textSizeData,b,xe),ie=u.get("text-padding");ut=this.collisionIndex.placeCollisionCircles(l,A,xe,l.lineVertexArray,l.glyphOffsetArray,ce,d,f,p,i,R,T.predicate,B.collisionCircleDiameter*ce/pi,ie,this.retainedQueryData[l.bucketInstanceId].tileID),et=A||ut.circles.length>0&&!ut.collisionDetected,X=X&&ut.offscreen,rt=ut.occluded}if(V.iconFeatureIndex&&(Vt=V.iconFeatureIndex),V.iconBox){const xe=ce=>{Kt(ce);const ie=B.hasIconTextFit&&ct?k1(ct.x,ct.y,I,R,this.transform.angle):new tt(0,0),Ne=l.getSymbolInstanceIconSize(E,this.transform.zoom,B.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(l,Ne,ce,ie,P,_,d,T.predicate)};gt&&gt.box&&gt.box.length&&V.verticalIconBox?(St=xe(V.verticalIconBox),W=St.box.length>0):(St=xe(V.iconBox),W=St.box.length>0),X=X&&St.offscreen,ot=St.occluded}const Oe=C||0===B.numHorizontalGlyphVertices&&0===Q,Xe=D||0===B.numIconVertices;if(Oe||Xe?Xe?Oe||(W=W&&et):et=W&&et:W=et=W&&et,et&&at&&at.box&&this.collisionIndex.insertCollisionBox(at.box,u.get("text-ignore-placement"),l.bucketInstanceId,gt&&gt.box&&zt?zt:Nt,T.ID),W&&St&&this.collisionIndex.insertCollisionBox(St.box,u.get("icon-ignore-placement"),l.bucketInstanceId,Vt,T.ID),ut&&(et&&this.collisionIndex.insertCollisionCircles(ut.circles,u.get("text-ignore-placement"),l.bucketInstanceId,Nt,T.ID),i)){const xe=l.bucketInstanceId;let ce=this.collisionCircleArrays[xe];void 0===ce&&(ce=this.collisionCircleArrays[xe]=new HI);for(let ie=0;ie<ut.circles.length;ie+=4)ce.circles.push(ut.circles[ie+0]),ce.circles.push(ut.circles[ie+1]),ce.circles.push(ut.circles[ie+2]),ce.circles.push(ut.collisionDetected?1:0)}const Ce="globe"!==l.projection.name;N=N&&(Ce||!rt),z=z&&(Ce||!ot),this.placements[Z]=new P1(et||N,W||z,X||l.justReloaded),n.add(Z)};if(L&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,this.retainedQueryData[l.bucketInstanceId].tileID),l.updateZOffset()),k){const B=l.getSortedSymbolIndexes(this.transform.angle);for(let H=B.length-1;H>=0;--H){const V=B[H];j(l.symbolInstances.get(V),V,l.collisionArrays[V])}l.hasAnyZOffset&&K(`${l.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(l.hasAnyZOffset){const B=l.getSortedIndexesByZOffset();for(let H=0;H<B.length;++H){const V=B[H];j(l.symbolInstances.get(V),V,l.collisionArrays[V])}}else for(let B=t.symbolInstanceStart;B<t.symbolInstanceEnd;B++)j(l.symbolInstances.get(B),B,l.collisionArrays[B]);if(i&&l.bucketInstanceId in this.collisionCircleArrays){const B=this.collisionCircleArrays[l.bucketInstanceId];nt.invert(B.invProjMatrix,d),B.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}markUsedJustification(t,n,i,a){const{leftJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,rightJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:f,crossTileID:p}=i,g=$_(n),_=a===Hn.vertical?f:"left"===g?l:"center"===g?u:"right"===g?d:-1;l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=_>=0&&l!==_?0:p),u>=0&&(t.text.placedSymbolArray.get(u).crossTileID=_>=0&&u!==_?0:p),d>=0&&(t.text.placedSymbolArray.get(d).crossTileID=_>=0&&d!==_?0:p),f>=0&&(t.text.placedSymbolArray.get(f).crossTileID=_>=0&&f!==_?0:p)}markUsedOrientation(t,n,i){const a=n===Hn.horizontal||n===Hn.horizontalOnly?n:0,l=n===Hn.vertical?n:0,{leftJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,rightJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:p}=i,g=t.text.placedSymbolArray;u>=0&&(g.get(u).placedOrientation=a),d>=0&&(g.get(d).placedOrientation=a),f>=0&&(g.get(f).placedOrientation=a),p>=0&&(g.get(p).placedOrientation=l)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let i=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const a=n?n.symbolFadeChange(t):1,l=n?n.opacities:{},u=n?n.variableOffsets:{},d=n?n.placedOrientations:{};for(const f in this.placements){const p=this.placements[f],g=l[f];g?(this.opacities[f]=new Em(g,a,p.text,p.icon,null,p.clipped),i=i||p.text!==g.text.placed||p.icon!==g.icon.placed):(this.opacities[f]=new Em(null,a,p.text,p.icon,p.skipFade,p.clipped),i=i||p.text||p.icon)}for(const f in l){const p=l[f];if(!this.opacities[f]){const g=new Em(p,a,!1,!1);g.isHidden()||(this.opacities[f]=g,i=i||p.text.placed||p.icon.placed)}}for(const f in u)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=u[f]);for(const f in d)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=d[f]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const i=new Set;for(const a of n){const l=a.getBucket(t);l&&a.latestFeatureIndex&&t.fqid===l.layerIds[0]&&(this.updateBucketOpacities(l,i,a.collisionBoxArray),l.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,a.tileID),l.updateZOffset()))}}updateBucketOpacities(t,n,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const a=t.layers[0].layout,l=!!t.layers[0].dynamicFilter(),u=new Em(null,0,!1,!1,!0),d=a.get("text-allow-overlap"),f=a.get("icon-allow-overlap"),p=a.get("text-variable-anchor"),g="map"===a.get("text-rotation-alignment"),_="map"===a.get("text-pitch-alignment"),v=new Em(null,0,d&&(f||!t.hasIconData()||a.get("icon-optional")),f&&(d||!t.hasTextData()||a.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const x=(E,T,C)=>{for(let D=0;D<T/4;D++)E.opacityVertexArray.emplaceBack(C)};let b=0;for(let E=0;E<t.symbolInstances.length;E++){const T=t.symbolInstances.get(E),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:D,crossTileID:A,numIconVertices:P}=T,I=n.has(A);let R=this.opacities[A];I?R=u:R||(R=v,this.opacities[A]=R),n.add(A);const k=C>0||D>0,L=P>0,N=this.placedOrientations[A],z=N===Hn.vertical,j=N===Hn.horizontal||N===Hn.horizontalOnly;if(!k&&!L||R.isHidden()||b++,k){const B=pT(R.text);x(t.text,C,z?My:B),x(t.text,D,j?My:B);const H=R.text.isHidden(),{leftJustifiedTextSymbolIndex:V,centerJustifiedTextSymbolIndex:Z,rightJustifiedTextSymbolIndex:Q,verticalPlacedTextSymbolIndex:et}=T,W=t.text.placedSymbolArray,X=H||z?1:0;V>=0&&(W.get(V).hidden=X),Z>=0&&(W.get(Z).hidden=X),Q>=0&&(W.get(Q).hidden=X),et>=0&&(W.get(et).hidden=H||j?1:0);const rt=this.variableOffsets[A];rt&&this.markUsedJustification(t,rt.anchor,T,N);const ot=this.placedOrientations[A];ot&&(this.markUsedJustification(t,"left",T,ot),this.markUsedOrientation(t,ot,T))}if(L){const B=pT(R.icon),{placedIconSymbolIndex:H,verticalPlacedIconSymbolIndex:V}=T,Z=t.icon.placedSymbolArray,Q=R.icon.isHidden()?1:0;H>=0&&(x(t.icon,P,z?My:B),Z.get(H).hidden=Q),V>=0&&(x(t.icon,T.numVerticalIconVertices,j?My:B),Z.get(V).hidden=Q)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const B=t.collisionArrays[E];if(B){let H=new tt(0,0),V=!0;if(B.textBox||B.verticalTextBox){if(p){const Q=this.variableOffsets[A];Q?(H=O1(Q.anchor,Q.width,Q.height,Q.textOffset,Q.textScale),g&&H._rotate(_?this.transform.angle:-this.transform.angle)):V=!1}l&&(V=!R.clipped),B.textBox&&Ey(t.textCollisionBox.collisionVertexArray,R.text.placed,!V||z,H.x,H.y),B.verticalTextBox&&Ey(t.textCollisionBox.collisionVertexArray,R.text.placed,!V||j,H.x,H.y)}const Z=V&&!(j||!B.verticalIconBox);B.iconBox&&Ey(t.iconCollisionBox.collisionVertexArray,R.icon.placed,Z,T.hasIconTextFit?H.x:0,T.hasIconTextFit?H.y:0),B.verticalIconBox&&Ey(t.iconCollisionBox.collisionVertexArray,R.icon.placed,!Z,T.hasIconTextFit?H.x:0,T.hasIconTextFit?H.y:0)}}}if(t.fullyClipped=0===b,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const E=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=E.invProjMatrix,t.placementViewportMatrix=E.viewportMatrix,t.collisionCircleArray=E.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const i=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function Ey(e,t,n,i,a){e.emplaceBack(t?1:0,n?1:0,i||0,a||0),e.emplaceBack(t?1:0,n?1:0,i||0,a||0),e.emplaceBack(t?1:0,n?1:0,i||0,a||0),e.emplaceBack(t?1:0,n?1:0,i||0,a||0)}const ZI=Math.pow(2,25),WI=Math.pow(2,24),XI=Math.pow(2,17),YI=Math.pow(2,16),JI=Math.pow(2,9),dT=Math.pow(2,8),fT=Math.pow(2,1);function pT(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*ZI+t*WI+n*XI+t*YI+n*JI+t*dT+n*fT+t}const My=0;class mT{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,i,a,l){const u=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(u,a,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,l())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,u.sort((d,f)=>d.sortKey-f.sortKey));this._currentPartIndex<u.length;){const d=u[this._currentPartIndex];if(n.placeLayerBucketPart(d,this._seenCrossTileIDs,i,0===d.symbolInstanceStart),this._currentPartIndex++,l())return!0}return!1}}class KI{constructor(t,n,i,a,l,u,d,f,p){this.placement=new qI(t,l,u,d,f,p),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=a,this._done=!1}isDone(){return this._done}continuePlacement(t,n,i,a){const l=Ft.now(),u=()=>{const d=Ft.now()-l;return!this._forceFullPlacement&&d>2};for(;this._currentPlacementIndex>=0;){const d=n[t[this._currentPlacementIndex]],f=this.placement.collisionIndex.transform.zoom;if("symbol"===d.type&&(!d.minzoom||d.minzoom<=f)&&(!d.maxzoom||d.maxzoom>f)){const p=d,g=p.layout.get("symbol-z-elevate"),_=this._inProgressLayer=this._inProgressLayer||new mT(p),v=Pi(d.source,d.scope);if(_.continuePlacement(g?a[v]:i[v],this.placement,this._showCollisionBoxes,d,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const gT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cy{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,i]=new Uint8Array(t,0,2);if(219!==n)throw new Error("Data does not appear to be in a KDBush format.");const a=i>>4;if(1!==a)throw new Error(`Got v${a} data when expected v1.`);const l=gT[15&i];if(!l)throw new Error("Unrecognized array type.");const[u]=new Uint16Array(t,2,1),[d]=new Uint32Array(t,4,1);return new Cy(d,u,l,t)}constructor(t,n=64,i=Float64Array,a){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const l=gT.indexOf(this.ArrayType),u=2*t*this.ArrayType.BYTES_PER_ELEMENT,d=t*this.IndexArrayType.BYTES_PER_ELEMENT,f=(8-d%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+d+f,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+u+d+f),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+d+f,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=n,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return L1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:u,nodeSize:d}=this,f=[0,l.length-1,0],p=[];for(;f.length;){const g=f.pop()||0,_=f.pop()||0,v=f.pop()||0;if(_-v<=d){for(let T=v;T<=_;T++){const C=u[2*T],D=u[2*T+1];C>=t&&C<=i&&D>=n&&D<=a&&p.push(l[T])}continue}const x=v+_>>1,b=u[2*x],E=u[2*x+1];b>=t&&b<=i&&E>=n&&E<=a&&p.push(l[x]),(0===g?t<=b:n<=E)&&(f.push(v),f.push(x-1),f.push(1-g)),(0===g?i>=b:a>=E)&&(f.push(x+1),f.push(_),f.push(1-g))}return p}within(t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:l,nodeSize:u}=this,d=[0,a.length-1,0],f=[],p=i*i;for(;d.length;){const g=d.pop()||0,_=d.pop()||0,v=d.pop()||0;if(_-v<=u){for(let T=v;T<=_;T++)Sy(l[2*T],l[2*T+1],t,n)<=p&&f.push(a[T]);continue}const x=v+_>>1,b=l[2*x],E=l[2*x+1];Sy(b,E,t,n)<=p&&f.push(a[x]),(0===g?t-i<=b:n-i<=E)&&(d.push(v),d.push(x-1),d.push(1-g)),(0===g?t+i>=b:n+i>=E)&&(d.push(x+1),d.push(_),d.push(1-g))}return f}}function L1(e,t,n,i,a,l){if(a-i<=n)return;const u=i+a>>1;Ty(e,t,u,i,a,l),L1(e,t,n,i,u-1,1-l),L1(e,t,n,u+1,a,1-l)}function Ty(e,t,n,i,a,l){for(;a>i;){if(a-i>600){const p=a-i+1,g=n-i+1,_=Math.log(p),v=.5*Math.exp(2*_/3),x=.5*Math.sqrt(_*v*(p-v)/p)*(g-p/2<0?-1:1);Ty(e,t,n,Math.max(i,Math.floor(n-g*v/p+x)),Math.min(a,Math.floor(n+(p-g)*v/p+x)),l)}const u=t[2*n+l];let d=i,f=a;for(ah(e,t,i,n),t[2*a+l]>u&&ah(e,t,i,a);d<f;){for(ah(e,t,d,f),d++,f--;t[2*d+l]<u;)d++;for(;t[2*f+l]>u;)f--}t[2*i+l]===u?ah(e,t,i,f):(f++,ah(e,t,f,a)),f<=n&&(i=f+1),n<=f&&(a=f-1)}}function ah(e,t,n,i){Dy(e,n,i),Dy(t,2*n,2*i),Dy(t,2*n+1,2*i+1)}function Dy(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Sy(e,t,n,i){const a=e-n,l=t-i;return a*a+l*l}const F1=512/lt/2;class QI{constructor(t,n,i){this.tileID=t,this.bucketInstanceId=i,this.index=new Cy(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const a=t.canonical.x*lt,l=t.canonical.y*lt;for(let u=0;u<n.length;u++){const{key:d,crossTileID:f,tileAnchorX:p,tileAnchorY:g}=n.get(u),_=Math.floor((a+p)*F1),v=Math.floor((l+g)*F1);this.index.add(_,v),this.keys.push(d),this.crossTileIDs.push(f)}this.index.finish()}findMatches(t,n,i){const a=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),l=F1/Math.pow(2,n.canonical.z-this.tileID.canonical.z),u=n.canonical.x*lt,d=n.canonical.y*lt;for(let f=0;f<t.length;f++){const p=t.get(f);if(p.crossTileID)continue;const{key:g,tileAnchorX:_,tileAnchorY:v}=p,x=Math.floor((u+_)*l),b=Math.floor((d+v)*l),E=this.index.range(x-a,b-a,x+a,b+a);for(const T of E){const C=this.crossTileIDs[T];if(this.keys[T]===g&&!i.has(C)){i.add(C),p.crossTileID=C;break}}}}}class N1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class tA{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(0!==n)for(const i in this.indexes){const a=this.indexes[i],l={};for(const u in a){const d=a[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),l[d.tileID.key]=d}this.indexes[i]=l}this.lng=t}addBucket(t,n,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let l=0;l<n.symbolInstances.length;l++)n.symbolInstances.get(l).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const a=this.usedCrossTileIDs[t.overscaledZ];for(const l in this.indexes){const u=this.indexes[l];if(Number(l)>t.overscaledZ)for(const d in u){const f=u[d];f.tileID.isChildOf(t)&&f.findMatches(n.symbolInstances,t,a)}else{const d=u[t.scaledTo(Number(l)).key];d&&d.findMatches(n.symbolInstances,t,a)}}for(let l=0;l<n.symbolInstances.length;l++){const u=n.symbolInstances.get(l);u.crossTileID||(u.crossTileID=i.generate(),a.add(u.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new QI(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const i of n.crossTileIDs)this.usedCrossTileIDs[t].delete(i)}removeStaleBuckets(t){let n=!1;for(const i in this.indexes){const a=this.indexes[i];for(const l in a)t[a[l].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,a[l]),delete a[l],n=!0)}return n}}class Br{constructor(){this.layerIndexes={},this.crossTileIDs=new N1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,i,a){let l=this.layerIndexes[t.fqid];void 0===l&&(l=this.layerIndexes[t.fqid]=new tA);let u=!1;const d={};"globe"!==a.name&&l.handleWrapJump(i);for(const f of n){const p=f.getBucket(t);p&&t.fqid===p.layerIds[0]&&(p.bucketInstanceId||(p.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(f.tileID,p,this.crossTileIDs)&&(u=!0),d[p.bucketInstanceId]=!0)}return l.removeStaleBuckets(d)&&(u=!0),u}pruneUnusedLayers(t){const n={};t.forEach(i=>{n[i]=!0});for(const i in this.layerIndexes)n[i]||delete this.layerIndexes[i]}}var au="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\n{return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn)\n{return pow(srgbIn,vec3(2.2));}vec3 linearProduct(vec3 srgbIn,vec3 k)\n{return srgbIn*pow(k,vec3(1./2.2));}\n#if __VERSION__ >=300\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define _HANDLE_WIREFRAME_DEPTH\n#endif\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\n_HANDLE_WIREFRAME_DEPTH;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",z1="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_T="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",eA="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Iy="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Ay="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",yT="#ifdef RENDER_SHADOWS\n#if defined(NATIVE) && __VERSION__ >=300\n#define TEXTURE_GATHER\n#endif\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const B1=[];Mm(au,B1);const Qd={"_prelude_fog.vertex.glsl":eA,"_prelude_terrain.vertex.glsl":_T,"_prelude_shadow.vertex.glsl":Ay,"_prelude_fog.fragment.glsl":Iy,"_prelude_shadow.fragment.glsl":yT,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE"},Py={};hn("",_T),hn(Iy,eA),hn(yT,Ay);const V1=hn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ry=au;var j1={background:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;varying vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:hn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:hn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:hn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#if __VERSION__ >=300\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:hn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nvarying highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:hn('#include "_prelude_shadow.fragment.glsl"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 u_ground_shadow_factor;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\ngl_FragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;attribute vec2 a_pos;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:hn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\ngl_FragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\ngl_FragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nattribute highp vec4 a_pos_end;attribute highp float a_angular_offset_factor;attribute highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:hn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture(u_image,coord).r/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec2 u_colorization_scale;uniform highp vec4 u_colorization_mix;highp vec4 colormap (highp float value) {highp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;highp vec2 coords=vec2(scaled_value,0.5);return texture2D(u_color_ramp,coords);}\n#endif\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);vec4 color;\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);color=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;if (color.a > 0.0) {color.rgb/=color.a;}\n#else\nif (color0.a > 0.0) {color0.rgb/=color0.a;}if (color1.a > 0.0) {color1.rgb/=color1.a;}color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_ground(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;attribute vec2 a_texture_pos;\n#endif\nvarying vec2 v_pos0;varying vec2 v_pos1;void main() {vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),symbolIcon:hn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nvarying float v_fade_opacity;varying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture2D(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nattribute vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\nvarying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:hn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:hn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture2D(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:hn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:hn('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',z1),skyboxGradient:hn('#include "_prelude_fog.fragment.glsl"\nvarying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',z1),skyboxCapture:hn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:hn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\ngl_FragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\n#else\ngl_FragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);gl_FragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\ngl_FragColor=vec4(c*t,t);\n#endif\n}',"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:hn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;varying highp vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\nconst float M_PI=3.141592653589793;\n#define saturate(_x) clamp(_x,0.,1.)\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(M_PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/M_PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\ngl_FragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nattribute vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\nvarying vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\nvoid main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:hn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}","attribute vec3 a_pos_3f;uniform mat4 u_matrix;varying highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:hn("varying highp vec2 v_uv;varying mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;gl_FragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;varying highp vec2 v_uv;varying mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Mm(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let i of n)if(i=i.trim(),"#"===i[0]&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const a=i.split(" ");for(const l of a)t.includes(l)||t.push(l)}}function hn(e,t){const n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let a=t.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);a&&(a=a.filter((p,g)=>a.indexOf(p)===g));const l={},u=[],d=[];e=e.replace(n,(p,g)=>(d.push(g),"")),t=t.replace(n,(p,g)=>(u.push(g),""));let f=[...B1];Mm(e,f),Mm(t,f);for(const p of[...u,...d])Qd[p]||console.error(`Undefined include: ${p}`),Py[p]||(Py[p]=[],Mm(Qd[p],Py[p])),f=[...f,...Py[p]];return{fragmentSource:e=e.replace(i,(p,g,_,v,x)=>(l[x]=!0,"define"===g?`\n#ifndef HAS_UNIFORM_u_${x}\nvarying ${_} ${v} ${x};\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:"initialize"===g?`\n#ifdef HAS_UNIFORM_u_${x}\n    ${_} ${v} ${x} = u_${x};\n#endif\n`:"define-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\n    varying ${_} ${v} ${x};\n#endif\n`:"initialize-attribute"===g?"":void 0)),vertexSource:t=t.replace(i,(p,g,_,v,x)=>{const b="float"===v?"vec2":v,E=x.match(/color/)?"color":b;return"define-attribute-vertex-shader-only"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\nattribute ${_} ${v} a_${x};\n#endif\n`:l[x]?"define"===g?`\n#ifndef HAS_UNIFORM_u_${x}\nuniform lowp float u_${x}_t;\nattribute ${_} ${b} a_${x};\nvarying ${_} ${v} ${x};\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:"initialize"===g?"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${x}\n    ${x} = a_${x};\n#else\n    ${_} ${v} ${x} = u_${x};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${x}\n    ${x} = unpack_mix_${E}(a_${x}, u_${x}_t);\n#else\n    ${_} ${v} ${x} = u_${x};\n#endif\n`:"define-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\n    attribute ${_} ${v} a_${x};\n    varying ${_} ${v} ${x};\n#endif\n`:"initialize-attribute"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\n    ${x} = a_${x};\n#endif\n`:void 0:"define"===g?`\n#ifndef HAS_UNIFORM_u_${x}\nuniform lowp float u_${x}_t;\nattribute ${_} ${b} a_${x};\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:"define-instanced"===g?"mat4"===E?`\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_${x}0;\nattribute vec4 a_${x}1;\nattribute vec4 a_${x}2;\nattribute vec4 a_${x}3;\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nattribute ${_} ${b} a_${x};\n#else\nuniform ${_} ${v} u_${x};\n#endif\n`:"initialize-attribute-custom"===g?`\n#ifdef HAS_ATTRIBUTE_a_${x}\n    ${_} ${v} ${x} = a_${x};\n#endif\n`:"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${x}\n    ${_} ${v} ${x} = a_${x};\n#else\n    ${_} ${v} ${x} = u_${x};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${x}\n    ${_} ${v} ${x} = unpack_mix_${E}(a_${x}, u_${x}_t);\n#else\n    ${_} ${v} ${x} = u_${x};\n#endif\n`}),staticAttributes:a,usedDefines:f,vertexIncludes:u,fragmentIncludes:d}}class vT{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,i,a,l,u,d,f){this.context=t;let p=this.boundPaintVertexBuffers.length!==a.length;for(let _=0;!p&&_<a.length;_++)this.boundPaintVertexBuffers[_]!==a[_]&&(p=!0);let g=this.boundDynamicVertexBuffers.length!==d.length;for(let _=0;!g&&_<d.length;_++)this.boundDynamicVertexBuffers[_]!==d[_]&&(g=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==i||p||g||this.boundIndexBuffer!==l||this.boundVertexOffset!==u)this.freshBind(n,i,a,l,u,d,f);else{t.bindVertexArrayOES.set(this.vao);for(const _ of d)_&&(_.bind(),f&&_.instanceCount&&_.setVertexAttribDivisor(t.gl,n,f));l&&l.dynamicDraw&&l.bind()}}freshBind(t,n,i,a,l,u,d){const f=t.numAttributes,p=this.context,g=p.gl;this.vao&&this.destroy(),this.vao=p.gl.createVertexArray(),p.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=a,this.boundVertexOffset=l,this.boundDynamicVertexBuffers=u,n.enableAttributes(g,t),n.bind(),n.setVertexAttribPointers(g,t,l);for(const _ of i)_.enableAttributes(g,t),_.bind(),_.setVertexAttribPointers(g,t,l);for(const _ of u)_&&(_.enableAttributes(g,t),_.bind(),_.setVertexAttribPointers(g,t,l),d&&_.instanceCount&&_.setVertexAttribDivisor(g,t,d));a&&a.bind(),p.currentNumAttributes=f}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function nA(e,t){const n=Math.pow(2,t.canonical.z),i=t.canonical.y;return[new Ge(0,i/n).toLngLat().lat,new Ge(0,(i+1)/n).toLngLat().lat]}function rA(e,t,n,i,a,l,u){const d=e.context,f=d.gl,p=n.hillshadeFBO;if(!p)return;e.prepareDrawTile();const g=e.isTileAffectedByFog(t),_=e.getOrCreateProgram("hillshade",{overrideFog:g});d.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,p.colorAttachment.get());const v=((T,C,D,A)=>{const P=D.paint.get("hillshade-shadow-color"),I=D.paint.get("hillshade-highlight-color"),R=D.paint.get("hillshade-accent-color"),k=D.paint.get("hillshade-emissive-strength");let L=Ee(D.paint.get("hillshade-illumination-direction"));if("viewport"===D.paint.get("hillshade-illumination-anchor"))L-=T.transform.angle;else if(T.style&&T.style.enable3dLights()&&T.style.directionalLight){const z=T.style.directionalLight.properties.get("direction");L=Ee(Yt(z.x,z.y,z.z)[1])}const N=!T.options.moving;return{u_matrix:A||T.transform.calculateProjMatrix(C.tileID.toUnwrapped(),N),u_image:0,u_latrange:nA(0,C.tileID),u_light:[D.paint.get("hillshade-exaggeration"),L],u_shadow:P,u_highlight:I,u_emissive_strength:k,u_accent:R}})(e,n,i,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(d,_,t.toUnwrapped());const{tileBoundsBuffer:x,tileBoundsIndexBuffer:b,tileBoundsSegments:E}=e.getTileBoundsBuffers(n);_.draw(e,f.TRIANGLES,a,l,u,Fe.disabled,v,i.id,x,b,E)}function xT(e,t,n){if(!t.needsDEMTextureUpload)return;const i=e.context,a=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(n.stride);const l=n.getPixels();t.demTexture?t.demTexture.update(l,{premultiply:!1}):t.demTexture=new kr(i,l,e.terrainUseFloatDEM()?a.R32F:a.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function iA(e,t,n){const i=e.context,a=i.gl;if(!t.dem)return;const l=t.dem;if(i.activeTexture.set(a.TEXTURE1),xT(e,t,l),!t.demTexture)return;t.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);const u=l.dim;i.activeTexture.set(a.TEXTURE0);let d=t.hillshadeFBO;if(!d){const v=new kr(i,{width:u,height:u,data:null},a.RGBA);v.bind(a.LINEAR,a.CLAMP_TO_EDGE),d=t.hillshadeFBO=i.createFramebuffer(u,u,!0,"renderbuffer"),d.colorAttachment.set(v.texture)}i.bindFramebuffer.set(d.framebuffer),i.viewport.set([0,0,u,u]);const{tileBoundsBuffer:f,tileBoundsIndexBuffer:p,tileBoundsSegments:g}=e.getMercatorTileBoundsBuffers(),_=[];e.terrainUseFloatDEM()&&_.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:_}).draw(e,a.TRIANGLES,pe.disabled,Se.disabled,Je.unblended,Fe.disabled,((v,x)=>{const b=x.stride,E=nt.create();return nt.ortho(E,0,lt,-lt,0,0,1),nt.translate(E,E,[0,-lt,0]),{u_matrix:E,u_image:1,u_dimension:[b,b],u_zoom:v.overscaledZ,u_unpack:x.unpackVector}})(t.tileID,l),n.id,f,p,g),t.needsHillshadePrepare=!1}const U1=e=>({u_matrix:new we(e),u_image0:new Le(e),u_skirt_height:new xt(e),u_ground_shadow_factor:new se(e)}),oA=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),$1=(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:a,u_merc_center:l,u_image0:0,u_frustum_tl:u,u_frustum_tr:d,u_frustum_br:f,u_frustum_bl:p,u_globe_pos:g,u_globe_radius:_,u_viewport:v,u_grid_matrix:b?Float32Array.from(b):new Float32Array(9),u_skirt_height:x}),tf=(e,t)=>{if(t>0&&e.terrain&&K("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=e.transform,i=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),a=n.isLODDisabled(!1)?Ya(60,45,n.pitch):Ya(30,15,n.pitch),l=n._farZ-n._nearZ,u=t*n.height,d=((1-(f=a))*(.75*n.cameraToCenterDistance)+f*(n._farZ+u))*i;var f;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(d-n._nearZ)/l,(d-u-n._nearZ)/l]}}};function bT(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const Cm=new class{constructor(){this.operations={}}newMorphing(e,t,n,i,a){if(e in this.operations){const l=this.operations[e];l.to.tileID.key!==n.tileID.key&&(l.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:a,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},wT={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ET(e,t,n){if(0===t)return 0;const i=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*i}function sA(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const H1=e=>({u_matrix:e});function MT(e,t,n,i,a){if(a>0){const l=Ft.now(),u=(l-e.timeAdded)/a,d=t?(l-t.timeAdded)/a:-1,f=n.getSource(),p=i.coveringZoomLevel({tileSize:f.tileSize,roundZoom:f.roundZoom}),g=!t||Math.abs(t.tileID.overscaledZ-p)>Math.abs(e.tileID.overscaledZ-p),_=g&&e.refreshedUponExpiration?1:Wt(g?u:1-d,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-_}:{opacity:_,mix:0}}return{opacity:1,mix:0}}class aA extends fs{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},i=new dm(Yd(),null),a=S1("mock-dem",n,i,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class lA extends fs{constructor(t){const n=S1("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new dm(Yd(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,i){if(t.freezeTileCoverage)return;this.transform=t;const a=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((l,u)=>{if(l[u.key]="",!this._tiles[u.key]){const d=new ds(u,this._source.tileSize*u.overscaleFactor(),t.tileZoom);d.state="loaded",this._tiles[u.key]=d}return l},{});for(const l in this._tiles)l in a||(this.freeFBO(l),this._tiles[l].unloadVectorData(),delete this._tiles[l])}freeFBO(t){const n=this.proxyCachedFBO[t];if(void 0!==n){const i=Object.values(n);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class CT extends Ze{constructor(t,n,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=i}}class cA extends Ql{constructor(t,n){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,a,l]=function(f){const p=new wo,g=new Rr,_=131;p.reserve(17161),g.reserve(33800);const v=lt/128,x=lt+v/2,b=x+v;for(let T=-v;T<b;T+=v)for(let C=-v;C<b;C+=v){const D=C<0||C>x||T<0||T>x?24575:0,A=Wt(Math.round(C),0,lt),P=Wt(Math.round(T),0,lt);p.emplaceBack(A+D,P)}const E=(T,C)=>{const D=C*_+T;g.emplaceBack(D+1,D,D+_),g.emplaceBack(D+_,D+_+1,D+1)};for(let T=1;T<129;T++)for(let C=1;C<129;C++)E(C,T);return[0,129].forEach(T=>{for(let C=0;C<130;C++)E(C,T),E(T,C)}),[p,g,32768]}(),u=t.context;this.gridBuffer=u.createVertexBuffer(i,Gl.members),this.gridIndexBuffer=u.createIndexBuffer(a),this.gridSegments=bn.simpleSegment(0,0,i.length,a.length),this.gridNoSkirtSegments=bn.simpleSegment(0,0,i.length,l),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new lA(n.map),this.orthoMatrix=nt.create(),nt.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,lt,0,lt,0,1);const d=u.gl;this._overlapStencilMode=new Se({func:d.GEQUAL,mask:255},0,255,d.KEEP,d.KEEP,d.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new aA(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,i){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const a=t.terrain.properties,l=0===t.terrain.drapeRenderMode,u=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=Ft.now();const d=t.terrain&&t.terrain.scope,f=a.get("source"),p=l?this._mockSourceCache:t.getSourceCache(f,d);if(!p)return void K(`Couldn't find terrain source "${f}".`);if(this.sourceCache=p,this._exaggeration=u?this.calculateExaggeration(n):a.get("exaggeration"),!n.projection.requiresDraping&&u&&0===this._exaggeration)return void this._disable();this.enabled=!0;const g=()=>{this.sourceCache.used&&K(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const _=this.getScaledDemTileSize();this.sourceCache.update(n,_,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){const n=this._previousCameraAltitude,i=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=i;const a=null!=n?i-n:Number.MAX_VALUE;if(Math.abs(a)<2)return this._exaggeration;const l=t.zoom,u=this._style.terrain;if(!this._previousUpdateTimestamp)return u.getExaggeration(l);let d=l-this._previousZoom;const f=this._previousUpdateTimestamp;let p=l;null!=this._evaluationZoom&&(p=this._evaluationZoom,Math.abs(l-p)>.5&&(d=.5*(l-p+d)),d*a<0&&(p+=d)),this._evaluationZoom=p;const g=u.getExaggeration(p),_=g===u.getExaggeration(Math.max(0,p-.1));if(_&&Math.abs(g-this._exaggeration)<.01)return g;let v=Math.min(.1,.00375*(this._updateTimestamp-f));return(_||g<.1||Math.abs(d)<1e-4)&&(v=Math.min(.2,4*v)),ue(this._exaggeration,g,v)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(Ge.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const a=this.proxyCoords=n.getIds().map(f=>{const p=n.getTileByID(f).tileID;return p.projMatrix=i.calculateProjMatrix(p.toUnwrapped()),p});!function(f,p){const g=p.transform.pointCoordinate(p.transform.getCameraPoint()),_=new tt(g.x,g.y);f.sort((v,x)=>{if(x.overscaledZ-v.overscaledZ)return x.overscaledZ-v.overscaledZ;const b=new tt(v.canonical.x+(1<<v.canonical.z)*v.wrap,v.canonical.y),E=new tt(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),T=_.mult(1<<v.canonical.z);return T.x-=.5,T.y-=.5,T.distSqr(b)-T.distSqr(E)})}(a,this.painter);const l=this.proxyToSource||{};this.proxyToSource={},a.forEach(f=>{this.proxyToSource[f.key]={}}),this.terrainTileForTile={};const u=this._style._mergedSourceCaches;for(const f in u){const p=u[f];if(!p.used||(p!==this.sourceCache&&this.resetTileLookupCache(p.id),this._setupProxiedCoordsForOrtho(p,t[f],l),p.usedForTerrain))continue;const g=t[f];p.getSource().reparseOverscaled&&this._assignTerrainTiles(g)}this.proxiedCoords[n.id]=a.map(f=>new CT(f,f.key,this.orthoMatrix)),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(l),this.renderingToTexture=!1;const d={};this._visibleDemTiles=[];for(const f of this.proxyCoords){const p=this.terrainTileForTile[f.key];if(!p)continue;const g=p.tileID.key;g in d||(this._visibleDemTiles.push(p),d[g]=g)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const i=this._findTileCoveringTileID(n,this.sourceCache);i&&(this.terrainTileForTile[n.key]=i)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const i in this.terrainTileForTile){const a=this.terrainTileForTile[i],l=a.dem;!l||a.demTexture&&!a.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),xT(this.painter,a,l))}}_prepareDemTileUniforms(t,n,i,a){if(!n||null==n.demTexture)return!1;const l=t.tileID.canonical,u=Math.pow(2,n.tileID.canonical.z-l.z),d=a||"";return i[`u_dem_tl${d}`]=[l.x*u%1,l.y*u%1],i[`u_dem_scale${d}`]=u,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,n=t.gl;if(!this._emptyDepthBufferTexture){const i=new ur({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new kr(t,i,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const n=this._visibleDemTiles.reduce((i,a)=>{if(!a.dem)return i;const l=a.dem.tree.minimums[0];return l>0&&t++,i+l},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),[a,l]=(()=>{if(this.painter.terrainUseFloatDEM()){const d=new Dp({width:1,height:1},new Float32Array([i]));return[n.R32F,d]}{const d=new ur({width:1,height:1},new Uint8Array(na.pack(i,this.sourceCache.getSource().encoding)));return[n.RGBA,d]}})();this._emptyDEMTextureDirty=!1;let u=this._emptyDEMTexture;return u?u.update(l,{premultiply:!1}):u=this._emptyDEMTexture=new kr(t,l,a,{premultiply:!1}),u}setupElevationDraw(t,n,i){const a=this.painter.context,l=a.gl,u=(d=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:na.getUnpackVector(d),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var d;u.u_exaggeration=this.exaggeration();let f=null,p=null,g=1;if(i&&i.morphing&&this._useVertexMorphing){const x=i.morphing.srcDemTile,b=i.morphing.dstDemTile;g=i.morphing.phase,x&&b&&(this._prepareDemTileUniforms(t,x,u,"_prev")&&(p=x),this._prepareDemTileUniforms(t,b,u)&&(f=b))}const _=x=>x&&x.demTexture&&this.painter.terrainUseFloatDEM()?l.LINEAR:l.NEAREST,v=x=>{u.u_dem_size=1===x.size[0]?1:x.size[0]-2};if(p&&f)a.activeTexture.set(l.TEXTURE2),f.demTexture.bind(_(f),l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE4),p.demTexture.bind(_(p),l.CLAMP_TO_EDGE),f.demTexture&&v(f.demTexture),u.u_dem_lerp=g;else{f=this.terrainTileForTile[t.tileID.key],a.activeTexture.set(l.TEXTURE2);const x=this._prepareDemTileUniforms(t,f,u)?f.demTexture:this.emptyDEMTexture;x.bind(_(f),l.CLAMP_TO_EDGE),v(x)}if(a.activeTexture.set(l.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),this._depthFBO&&(u.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),u.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&f){const x=(1<<f.tileID.canonical.z)*xn(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;u.u_meter_to_dem=x}if(i&&i.labelPlaneMatrixInv&&(u.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(a,u),"globe"===this.painter.transform.projection.name){const x=this.globeUniformValues(this.painter.transform,t.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(a,x)}}globeUniformValues(t,n,i){const a=t.projection;return{u_tile_tl_up:a.upVector(n,0,0),u_tile_tr_up:a.upVector(n,lt,0),u_tile_br_up:a.upVector(n,lt,lt),u_tile_bl_up:a.upVector(n,0,lt),u_tile_up_scale:i?V0(1):a.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,i=this.painter.context;0!==t.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(a,l,u,d,f){if("globe"===a.transform.projection.name)!function(p,g,_,v,x){const b=p.context,E=b.gl;let T,C;const D=p.transform,A=sS(p,b,D),P=(H,V)=>{if(C===V)return;const Z=[wT[V],"PROJECTION_GLOBE_VIEW"];A&&Z.push("CUSTOM_ANTIALIASING");const Q=p.isTileAffectedByFog(H);T=p.getOrCreateProgram("globeRaster",{defines:Z,overrideFog:Q}),C=V},I=p.colorModeForRenderPass(),R=new pe(E.LEQUAL,pe.ReadWrite,p.depthRangeFor3D);Cm.update(x);const k=function(H){const V=H.pixelsPerMeter,Z=V/xn(1,H.center.lat),Q=nt.identity(new Float64Array(16));return nt.translate(Q,Q,[H.point.x,H.point.y,0]),nt.scale(Q,Q,[Z,Z,V]),Float32Array.from(Q)}(D),L=[Li(D.center.lng),Gi(D.center.lat)],N=p.globeSharedBuffers,z=[D.width*Ft.devicePixelRatio,D.height*Ft.devicePixelRatio],j=Float32Array.from(D.globeMatrix),B={useDenormalizedUpVectorScale:!0};{const H=p.transform,V=ET(H.zoom,g.exaggeration(),g.sourceCache._source.tileSize);C=-1;const Z=E.TRIANGLES;for(const Q of v){const et=_.getTile(Q),W=Se.disabled,X=g.prevTerrainTileForTile[Q.key],rt=g.terrainTileForTile[Q.key];bT(X,rt)&&Cm.newMorphing(Q.key,X,rt,x,250),b.activeTexture.set(E.TEXTURE0),et.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);const ot=Cm.getMorphValuesForProxy(Q.key),ct=ot?1:0;ot&&Ic(B,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:wc(ot.phase)}});const dt=yp(Q.canonical),gt=aS(dt.getCenter().lat),at=HE(Q.canonical,dt,gt,H.worldSize/H._pixelsPerMercatorPixel),ut=as(uo(Q.canonical)),St=$1(H.projMatrix,j,k,ut,ki(H.zoom),L,H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.globeCenterInViewSpace,H.globeRadius,z,V,at);if(P(Q,ct),T&&(g.setupElevationDraw(et,T,B),p.uploadCommonUniforms(b,T,Q.toUnwrapped()),N)){const[Nt,zt,Vt]=N.getGridBuffers(gt,0!==V);T.draw(p,Z,R,W,I,Fe.backCCW,St,"globe_raster",Nt,zt,Vt)}}}if(N&&(p.renderDefaultNorthPole||p.renderDefaultSouthPole)){const H=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];A&&H.push("CUSTOM_ANTIALIASING"),T=p.getOrCreateProgram("globeRaster",{defines:H});for(const V of v){const{x:Z,y:Q,z:et}=V.canonical,W=0===Q,X=Q===(1<<et)-1,[rt,ot,ct,dt]=N.getPoleBuffers(et,!1);if(dt&&(W||X)){const gt=_.getTile(V);b.activeTexture.set(E.TEXTURE0),gt.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE);let at=oS(et,Z,D);const ut=as(uo(V.canonical)),St=(Nt,zt)=>Nt.draw(p,E.TRIANGLES,R,Se.disabled,I,Fe.disabled,$1(D.projMatrix,at,at,ut,0,L,D.frustumCorners.TL,D.frustumCorners.TR,D.frustumCorners.BR,D.frustumCorners.BL,D.globeCenterInViewSpace,D.globeRadius,z,0),"globe_pole_raster",zt,ct,dt);g.setupElevationDraw(gt,T,B),p.uploadCommonUniforms(b,T,V.toUnwrapped()),W&&p.renderDefaultNorthPole&&St(T,rt),X&&p.renderDefaultSouthPole&&(at=nt.scale(nt.create(),at,[1,-1,1]),St(T,ot))}}}}(a,l,u,d,f);else{const p=a.context,g=p.gl;let _,v;const x=a.shadowRenderer,b=tf(a,a.longestCutoffRange),E=I=>{if(v===I)return;const R=[];R.push(wT[I]),b.shouldRenderCutoff&&R.push("RENDER_CUTOFF"),_=a.getOrCreateProgram("terrainRaster",{defines:R}),v=I},T=a.colorModeForRenderPass(),C=new pe(g.LEQUAL,pe.ReadWrite,a.depthRangeFor3D);Cm.update(f);const D=a.transform,A=ET(D.zoom,l.exaggeration(),l.sourceCache._source.tileSize);let P=[0,0,0];if(x){const I=a.style.directionalLight,R=a.style.ambientLight;I&&R&&(P=sb(I,R))}{v=-1;const I=g.TRIANGLES,[R,k]=[l.gridIndexBuffer,l.gridSegments];for(const L of d){const N=u.getTile(L),z=Se.disabled,j=l.prevTerrainTileForTile[L.key],B=l.terrainTileForTile[L.key];bT(j,B)&&Cm.newMorphing(L.key,j,B,f,250),p.activeTexture.set(g.TEXTURE0),N.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const H=Cm.getMorphValuesForProxy(L.key),V=H?1:0;let Z;H&&(Z={morphing:{srcDemTile:H.from,dstDemTile:H.to,phase:wc(H.phase)}});const Q=oA(L.projMatrix,sA(L.canonical,D.renderWorldCopies)?A/10:A,P);if(E(V),!_)continue;l.setupElevationDraw(N,_,Z);const et=L.toUnwrapped();x&&x.setupShadows(et,_),a.uploadCommonUniforms(p,_,et,null,b),_.draw(a,I,C,z,T,Fe.backCCW,Q,"terrain_raster",l.gridBuffer,R,k)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,a=this.proxySourceCache,l=this.proxiedCoords[a.id],u=this._drapedRenderBatches.shift(),d=n.style.order,f=[];let p=0;for(const g of l){const _=a.getTileByID(g.proxyTileKey),v=a.proxyCachedFBO[g.key]?a.proxyCachedFBO[g.key][t]:void 0,x=void 0!==v?a.renderCache[v]:this.pool[p++],b=void 0!==v;if(_.texture=x.tex,b&&!x.dirty){f.push(_.tileID);continue}let E;i.bindFramebuffer.set(x.fb.framebuffer),this.renderedToTile=!1,x.dirty&&(i.clear({color:Ae.transparent,stencil:0}),x.dirty=!1);for(let T=u.start;T<=u.end;++T){const C=n.style._mergedLayers[d[T]];if(C.isHidden(n.transform.zoom))continue;const D=n.style.getLayerSourceCache(C),A=D?this.proxyToSource[g.key][D.id]:[g];if(!A)continue;const P=A;i.viewport.set([0,0,x.fb.width,x.fb.height]),E!==(D?D.id:null)&&(this._setupStencil(x,A,C,D),E=D?D.id:null),n.renderLayer(n,D,C,P)}if(0===this._drapedRenderBatches.length)for(const T of this._pendingGroundEffectLayers){const C=n.style._mergedLayers[d[T]];if(C.isHidden(n.transform.zoom))continue;const D=n.style.getLayerSourceCache(C),A=D?this.proxyToSource[g.key][D.id]:[g];if(!A)continue;const P=A;i.viewport.set([0,0,x.fb.width,x.fb.height]),E!==(D?D.id:null)&&(this._setupStencil(x,A,C,D),E=D?D.id:null),n.renderLayer(n,D,C,P)}this.renderedToTile?(x.dirty=!0,f.push(_.tileID)):b||--p,5===p&&(p=0,this.renderToBackBuffer(f))}return this.renderToBackBuffer(f),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),u.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let i=-1,a=n;for(let l=0;l<n;++l)this._style.isLayerDraped(t._mergedLayers[t.order[l]])?i=Math.max(i,l):a=Math.min(a,l);return a>i}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,n,i){if(!this._visibleDemTiles)return null;const a=this._visibleDemTiles.filter(l=>l.dem).map(l=>{const u=l.tileID,d=1<<u.overscaledZ,{x:f,y:p}=u.canonical,g=f/d,_=(f+1)/d,v=p/d,x=(p+1)/d;return{minx:g,miny:v,maxx:_,maxy:x,t:l.dem.tree.raycastRoot(g,v,_,x,t,n,i),tile:l}});a.sort((l,u)=>(null!==l.t?l.t:Number.MAX_VALUE)-(null!==u.t?u.t:Number.MAX_VALUE));for(const l of a){if(null==l.t)return null;const u=l.tile.dem.tree.raycast(l.minx,l.miny,l.maxx,l.maxy,t,n,i);if(null!=u)return u}return null}_createFBO(){const t=this.painter.context,n=t.gl,i=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const a=new kr(t,{width:i[0],height:i[1],data:null},n.RGBA);a.bind(n.LINEAR,n.CLAMP_TO_EDGE);const l=t.createFramebuffer(i[0],i[1],!0,null);return l.colorAttachment.set(a.texture),l.depthAttachment=new rC(t,l.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,l.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):l.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:l,tex:a,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],i=n.isHidden(this.painter.transform.zoom);return"custom"===n.type?!i&&n.shouldRedrape():!i&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const i of this._style.getSources())if(i instanceof pm){t=!0;break}if(!t)return;const n={};for(let i=0;i<this._style.order.length;++i){const a=this._style._mergedLayers[this._style.order[i]],l=this._style.getLayerSourceCache(a);if(l&&!n[l.id]&&!a.isHidden(this.painter.transform.zoom)&&"line"===a.type&&a.widthExpression()instanceof jl){n[l.id]=!0;for(const u of this.proxyCoords){const d=this.proxyToSource[u.key][l.id];if(d)for(const f of d)this._clearRenderCacheForTile(l.id,f)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof su){t=!0;break}if(!t)return;const n={};for(let i=0;i<this._style.order.length;++i){const a=this._style._mergedLayers[this._style.order[i]],l=this._style.getLayerSourceCache(a);if(!l||n[l.id]||a.isHidden(this.painter.transform.zoom)||"raster"!==a.type)continue;const u=a.paint.get("raster-fade-duration");for(const d of this.proxyCoords){const f=this.proxyToSource[d.key][l.id];if(f)for(const p of f){const g=MT(l.getTile(p),l.findLoadedParent(p,0),l,this.painter.transform,u);(1!==g.opacity||0!==g.mix)&&this._clearRenderCacheForTile(l.id,p)}}}}_setupDrapedRenderBatches(){const t=this._style.order,n=t.length;if(0===n)return;const i=[];this._pendingGroundEffectLayers=[];let a,l=0,u=this._style._mergedLayers[t[l]];for(;!this._style.isLayerDraped(u)&&u.isHidden(this.painter.transform.zoom)&&++l<n;)u=this._style._mergedLayers[t[l]];for(;l<n;++l){const d=this._style._mergedLayers[t[l]];d.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(d)?void 0===a&&(a=l):("fill-extrusion"===d.type&&this._pendingGroundEffectLayers.push(l),void 0!==a&&(i.push({start:a,end:l-1}),a=void 0)))}if(void 0!==a&&i.push({start:a,end:l-1}),0!==i.length){const d=i[i.length-1];this._pendingGroundEffectLayers.every(p=>p>d.end)||K("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const u=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let d=0;d<u.length;++d){const f=Object.values(u[d]);n.renderCachePool.push(...f)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,a=this._tilesDirty;for(let u=i.length-1;u>=0;u--){const d=i[u];if(n.getTileByID(d.key),void 0!==n.proxyCachedFBO[d.key]){const f=t[d.key],p=this.proxyToSource[d.key];let g=0;for(const _ in p){const v=p[_],x=f[_];if(!x||x.length!==v.length||v.some((b,E)=>b!==x[E]||a[_]&&a[_].hasOwnProperty(b.key))){g=-1;break}++g}for(const _ in n.proxyCachedFBO[d.key])n.renderCache[n.proxyCachedFBO[d.key][_]].dirty=g<0||g!==Object.values(f).length}}const l=[...this._drapedRenderBatches];l.sort((u,d)=>d.end-d.start-(u.end-u.start));for(const u of l)for(const d of i){if(n.proxyCachedFBO[d.key])continue;let f=n.renderCachePool.pop();void 0===f&&n.renderCache.length<50&&(f=n.renderCache.length,n.renderCache.push(this._createFBO())),void 0!==f&&(n.proxyCachedFBO[d.key]={},n.proxyCachedFBO[d.key][u.start]=f,n.renderCache[f].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,i,a){if(!a||!this._sourceTilesOverlap[a.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const l=this.painter.context,u=l.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let d;if(i.isTileClipped())d=n.length,this._overlapStencilMode.test={func:u.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);d=1,this._overlapStencilMode.test={func:u.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+d>255&&(l.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=d,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Se.disabled}_renderTileClippingMasks(t,n){const i=this.painter,a=this.painter.context,l=a.gl;i._tileClippingMaskIDs={},a.setColorMode(Je.disabled),a.setDepthMode(pe.disabled);const u=i.getOrCreateProgram("clippingMask");for(const d of t){const f=i._tileClippingMaskIDs[d.key]=--n;u.draw(i,l.TRIANGLES,pe.disabled,new Se({func:l.ALWAYS,mask:0},f,255,l.KEEP,l.KEEP,l.REPLACE),Je.disabled,Fe.disabled,H1(d.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const i=[t.x,t.y,1,1];vn.transformMat4(i,i,n.pixelMatrixInverse),vn.scale(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const a=n._camera.position,l=xn(1,n.center.lat),u=[a[0],a[1],a[2]/l,0],d=G.subtract([],i.slice(0,3),u);G.normalize(d,d);const f=this.raycast(u,d,this._exaggeration);return null!==f&&f?(G.scaleAndAdd(u,u,d,f),u[3]=u[2],u[2]*=l,u):null}drawDepth(){const t=this.painter,n=t.context,i=this.proxySourceCache,a=Math.ceil(t.width),l=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===a&&this._depthFBO.height===l||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const u=n.gl,d=n.createFramebuffer(a,l,!0,"renderbuffer");n.activeTexture.set(u.TEXTURE0);const f=new kr(n,{width:a,height:l,data:null},u.RGBA);f.bind(u.NEAREST,u.CLAMP_TO_EDGE),d.colorAttachment.set(f.texture);const p=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,a,l);d.depthAttachment.set(p),this._depthFBO=d,this._depthTexture=f}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,a,l]),function(u,d,f,p){if("globe"===u.transform.projection.name)return;const g=u.context,_=g.gl;g.clear({depth:1});const v=u.getOrCreateProgram("terrainDepth"),x=new pe(_.LESS,pe.ReadWrite,u.depthRangeFor3D);for(const b of p){const E=f.getTile(b),T=oA(b.projMatrix,0,[0,0,0]);d.setupElevationDraw(E,v),v.draw(u,_.TRIANGLES,x,Se.disabled,Je.unblended,Fe.backCCW,T,"terrain_depth",d.gridBuffer,d.gridIndexBuffer,d.gridNoSkirtSegments)}}(t,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,n,i){if(t.getSource()instanceof bl)return this._setupProxiedCoordsForImageSource(t,n,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const a=this.proxiedCoords[t.id]=[],l=this.proxyCoords;for(let d=0;d<l.length;d++){const f=l[d],p=this._findTileCoveringTileID(f,t);if(p){const g=this._createProxiedId(f,p,i[f.key]&&i[f.key][t.id]);a.push(g),this.proxyToSource[f.key][t.id]=[g]}}let u=!1;for(let d=0;d<n.length;d++){const f=t.getTile(n[d]);if(!f||!f.hasData())continue;const p=this._findTileCoveringTileID(f.tileID,this.proxySourceCache);if(p&&p.tileID.canonical.z!==f.tileID.canonical.z){const g=this.proxyToSource[p.tileID.key][t.id],_=this._createProxiedId(p.tileID,f,i[p.tileID.key]&&i[p.tileID.key][t.id]);g?g.splice(g.length-1,0,_):this.proxyToSource[p.tileID.key][t.id]=[_],a.push(_),u=!0}}this._sourceTilesOverlap[t.id]=u}_setupProxiedCoordsForImageSource(t,n,i){if(!t.getSource().loaded())return;const a=this.proxiedCoords[t.id]=[],l=this.proxyCoords,u=t.getSource(),d=u.tileID;if(!d)return;const f=new tt(d.x,d.y)._div(1<<d.z),p=u.coordinates.map(Ge.fromLngLat).reduce((_,v)=>(_.min.x=Math.min(_.min.x,v.x-f.x),_.min.y=Math.min(_.min.y,v.y-f.y),_.max.x=Math.max(_.max.x,v.x-f.x),_.max.y=Math.max(_.max.y,v.y-f.y),_),{min:new tt(Number.MAX_VALUE,Number.MAX_VALUE),max:new tt(-Number.MAX_VALUE,-Number.MAX_VALUE)}),g=(_,v)=>{const x=_.wrap+_.canonical.x/(1<<_.canonical.z),b=_.canonical.y/(1<<_.canonical.z),E=lt/(1<<_.canonical.z),T=v.wrap+v.canonical.x/(1<<v.canonical.z),C=v.canonical.y/(1<<v.canonical.z);return x+E<T+p.min.x||x>T+p.max.x||b+E<C+p.min.y||b>C+p.max.y};for(let _=0;_<l.length;_++){const v=l[_];for(let x=0;x<n.length;x++){const b=t.getTile(n[x]);if(!b||!b.hasData()||g(v,b.tileID))continue;const E=this._createProxiedId(v,b,i[v.key]&&i[v.key][t.id]),T=this.proxyToSource[v.key][t.id];T?T.push(E):this.proxyToSource[v.key][t.id]=[E],a.push(E)}}}_createProxiedId(t,n,i){let a=this.orthoMatrix;if(i){const l=i.find(u=>u.key===n.tileID.key);if(l)return l}if(n.tileID.key!==t.key){const l=t.canonical.z-n.tileID.canonical.z;let u,d,f;a=nt.create();const p=n.tileID.wrap-t.wrap<<t.overscaledZ;l>0?(u=lt>>l,d=u*((n.tileID.canonical.x<<l)-t.canonical.x+p),f=u*((n.tileID.canonical.y<<l)-t.canonical.y)):(u=lt<<-l,d=lt*(n.tileID.canonical.x-(t.canonical.x+p<<-l)),f=lt*(n.tileID.canonical.y-(t.canonical.y<<-l))),nt.ortho(a,0,u,0,u,0,1),nt.translate(a,a,[d,f,0])}return new CT(n.tileID,t.key,a)}_findTileCoveringTileID(t,n){let i=n.getTile(t);if(i&&i.hasData())return i;const a=this._findCoveringTileCache[n.id],l=a[t.key];if(i=l?n.getTileByID(l):null,i&&i.hasData()||null===l)return i;let u=i?i.tileID:t,d=u.overscaledZ;const f=n.getSource().minzoom,p=[];if(!l){const _=n.getSource().maxzoom;if(t.canonical.z>=_){const v=t.canonical.z-_;n.getSource().reparseOverscaled?(d=Math.max(t.canonical.z+2,n.transform.tileZoom),u=new Ze(d,t.wrap,_,t.canonical.x>>v,t.canonical.y>>v)):0!==v&&(d=_,u=new Ze(d,t.wrap,_,t.canonical.x>>v,t.canonical.y>>v))}u.key!==t.key&&(p.push(u.key),i=n.getTile(u))}const g=_=>{p.forEach(v=>{a[v]=_}),p.length=0};for(d-=1;d>=f&&(!i||!i.hasData());d--){i&&g(i.tileID.key);const _=u.calculateScaledKey(d);if(i=n.getTileByID(_),i&&i.hasData())break;const v=a[_];if(null===v)break;void 0===v?p.push(_):i=n.getTileByID(v)}return g(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[n.key]=!0}}function uA(e,t,n){const i=function(d,f,p){const g=G.dot(f,d),_=G.dot(p,[.2126,.7152,.0722]),v=(b,E,T)=>(1-T)*b+T*E,x=v(1-.3*Math.min(_,1),1,Math.min(g+1,1));return v(.92,1,Math.asin(Wt(f[2],-1,1))/Math.PI+.5)*x}(e,[0,0,1],t),a=[0,0,0];G.scale(a,n.slice(0,3),i);const l=[0,0,0];G.scale(l,t.slice(0,3),e[2]);const u=[0,0,0];return G.add(u,a,l),Fn(u)}const hA=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dA=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class ef{static cacheKey(t,n,i,a){let l=`${n}${a?a.cacheKey:""}`;for(const u of i)t.usedDefines.includes(u)&&(l+=`/${u}`);return l}constructor(t,n,i,a,l,u){const d=t.gl;this.program=d.createProgram(),this.configuration=a,this.name=n,this.fixedDefines=[...u];const f=function(C){const D=[];for(let A=0;A<C.length;A++){if(null===C[A])continue;const P=C[A].split(" ");D.push(P.pop())}return D}(i.staticAttributes),p=a?a.getBinderAttributes():[],g=f.concat(p);let _=a?a.defines():[];_=_.concat(u.map(C=>`#define ${C}`));const v="#version 300 es\n";let x=v+_.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ry,V1.fragmentSource).join("\n");for(const C of i.fragmentIncludes)x+=`\n${Qd[C]}`;x+=`\n${i.fragmentSource}`;let b=v+_.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ry,V1.vertexSource).join("\n");for(const C of i.vertexIncludes)b+=`\n${Qd[C]}`;b+=`\n${i.vertexSource}`;const E=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);d.shaderSource(E,x),d.compileShader(E),d.attachShader(this.program,E);const T=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())this.failedToCreate=!0;else{d.shaderSource(T,b),d.compileShader(T),d.attachShader(this.program,T),this.attributes={},this.numAttributes=g.length;for(let C=0;C<this.numAttributes;C++)if(g[C]){const D=g[C].startsWith("a_")?g[C]:`a_${g[C]}`;d.bindAttribLocation(this.program,C,D),this.attributes[D]=C}d.linkProgram(this.program),d.deleteShader(T),d.deleteShader(E),this.fixedUniforms=l(t),this.binderUniforms=a?a.getUniforms(t):[],u.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new Le(C=t),u_dem_prev:new Le(C),u_dem_unpack:new rs(C),u_dem_tl:new Ue(C),u_dem_scale:new xt(C),u_dem_tl_prev:new Ue(C),u_dem_scale_prev:new xt(C),u_dem_size:new xt(C),u_dem_lerp:new xt(C),u_exaggeration:new xt(C),u_depth:new Le(C),u_depth_size_inv:new Ue(C),u_meter_to_dem:new xt(C),u_label_plane_matrix_inv:new we(C)}),u.includes("GLOBE")&&(this.globeUniforms=(C=>({u_tile_tl_up:new se(C),u_tile_tr_up:new se(C),u_tile_br_up:new se(C),u_tile_bl_up:new se(C),u_tile_up_scale:new xt(C)}))(t)),u.includes("FOG")&&(this.fogUniforms=(C=>({u_fog_matrix:new we(C),u_fog_range:new Ue(C),u_fog_color:new rs(C),u_fog_horizon_blend:new xt(C),u_fog_vertical_limit:new Ue(C),u_fog_temporal_offset:new xt(C),u_frustum_tl:new se(C),u_frustum_tr:new se(C),u_frustum_br:new se(C),u_frustum_bl:new se(C),u_globe_pos:new se(C),u_globe_radius:new xt(C),u_globe_transition:new xt(C),u_is_globe:new Le(C),u_viewport:new Ue(C)}))(t)),u.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(C=>({u_cutoff_params:new rs(C)}))(t)),u.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(C=>({u_lighting_ambient_color:new se(C),u_lighting_directional_dir:new se(C),u_lighting_directional_color:new se(C),u_ground_radiance:new se(C)}))(t)),u.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(C=>({u_light_matrix_0:new we(C),u_light_matrix_1:new we(C),u_fade_range:new Ue(C),u_shadow_normal_offset:new se(C),u_shadow_intensity:new xt(C),u_shadow_texel_size:new xt(C),u_shadow_map_resolution:new xt(C),u_shadow_direction:new se(C),u_shadow_bias:new se(C),u_shadowmap_0:new Le(C),u_shadowmap_1:new Le(C)}))(t))}var C}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)i[a]&&i[a].set(this.program,a,n[a])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)i[a]&&i[a].set(this.program,a,n[a])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;t.program.set(this.program);for(const a in n)i[a].set(this.program,a,n[a])}_drawDebugWireframe(t,n,i,a,l,u,d,f,p,g){const _=t.options.wireframe;if(!1===_.terrain&&!1===_.layers2D&&!1===_.layers3D)return;const v=t.context;if(!(()=>!(!_.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!_.layers2D||t._terrain&&t._terrain.renderingToTexture||!hA.includes(this.name))||!(!_.layers3D||!dA.includes(this.name)))())return;const x=v.gl,b=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,l,v);if(!b)return;const E=[...this.fixedDefines];E.push("DEBUG_WIREFRAME");const T=t.getOrCreateProgram(this.name,{config:this.configuration,defines:E});v.program.set(T.program);const C=(P,I,R)=>{if(I[P]&&R[P])for(const k in I[P])R[P][k]&&R[P][k].set(R.program,k,I[P][k].current)};p&&p.setUniforms(T.program,v,T.binderUniforms,d,{zoom:f}),C("fixedUniforms",this,T),C("terrainUniforms",this,T),C("globeUniforms",this,T),C("fogUniforms",this,T),C("lightsUniforms",this,T),C("shadowUniforms",this,T),b.bind(),v.setColorMode(new Je([x.ONE,x.ONE_MINUS_SRC_ALPHA,x.ZERO,x.ONE],Ae.transparent,[!0,!0,!0,!1])),v.setDepthMode(new pe(n.func===x.LESS?x.LEQUAL:n.func,pe.ReadOnly,n.range)),v.setStencilMode(Se.disabled);const D=3*u.primitiveLength*2,A=3*u.primitiveOffset*2*2;g&&g>1?x.drawElementsInstanced(x.LINES,D,x.UNSIGNED_SHORT,A,g):x.drawElements(x.LINES,D,x.UNSIGNED_SHORT,A),l.bind(),v.program.set(this.program),v.setDepthMode(n),v.setStencilMode(i),v.setColorMode(a)}draw(t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T){const C=t.context,D=C.gl;if(this.failedToCreate)return;C.program.set(this.program),C.setDepthMode(i),C.setStencilMode(a),C.setColorMode(l),C.setCullFace(u);for(const I of Object.keys(this.fixedUniforms))this.fixedUniforms[I].set(this.program,I,d[I]);b&&b.setUniforms(this.program,C,this.binderUniforms,v,{zoom:x});const A={[D.LINES]:2,[D.TRIANGLES]:3,[D.LINE_STRIP]:1}[n],P=T&&T>0?1:void 0;for(const I of _.get()){const R=I.vaos||(I.vaos={});(R[f]||(R[f]=new vT)).bind(C,this,p,b?b.getPaintVertexBuffers():[],g,I.vertexOffset,E||[],P),T&&T>1?D.drawElementsInstanced(n,I.primitiveLength*A,D.UNSIGNED_SHORT,I.primitiveOffset*A*2,T):D.drawElements(n,I.primitiveLength*A,D.UNSIGNED_SHORT,I.primitiveOffset*A*2),n===D.TRIANGLES&&this._drawDebugWireframe(t,i,a,l,g,I,v,x,b,T)}}}function G1(e,t){const n=Math.pow(2,t.tileID.overscaledZ),i=t.tileSize*Math.pow(2,e.transform.tileZoom)/n,a=i*(t.tileID.canonical.x+t.tileID.wrap*n),l=i*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/eh(t,1,e.transform.tileZoom),u_pixel_coord_upper:[a>>16,l>>16],u_pixel_coord_lower:[65535&a,65535&l]}}const TT=nt.create(),q1=(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b)=>{const E=t.style.light,T=E.properties.get("position"),C=[T.x,T.y,T.z],D=Mo.create();"viewport"===E.properties.get("anchor")&&(Mo.fromRotation(D,-t.transform.angle),G.transformMat3(C,C,D));const A=E.properties.get("color"),P=t.transform,I={u_matrix:e,u_lightpos:C,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:TT,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:l,u_flood_light_color:_,u_vertical_scale:v,u_flood_light_intensity:x,u_ground_shadow_factor:b};return"globe"===P.projection.name&&(I.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],I.u_zoom_transition=f,I.u_inv_rot_matrix=g,I.u_merc_center=p,I.u_up_dir=P.projection.upVector(new Qs(0,0,0),p[0]*lt,p[1]*lt),I.u_height_lift=d),I},DT=(e,t,n)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:n}),ST=(e,t,n,i,a,l,u,d,f,p,g,_,v,x)=>{const b=q1(e,t,n,i,a,l,u,f,p,g,_,v,x,1,[0,0,0]),E={u_height_factor:-Math.pow(2,u.overscaledZ)/d.tileSize/8};return qt(b,G1(t,d),E)},IT=(e,t)=>({u_matrix:e,u_emissive_strength:t}),AT=(e,t,n,i)=>qt(IT(e,t),G1(n,i)),MO=(e,t,n)=>({u_matrix:e,u_world:n,u_emissive_strength:t}),CO=(e,t,n,i,a)=>qt(AT(e,t,n,i),{u_world:a}),fA=(e,t,n,i)=>{const a=lt/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(i),u_extrude_scale:[t.pixelsToGLUnits[0]/a,t.pixelsToGLUnits[1]/a]}},PT=(e,t,n=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}),pA=nt.create(),mA=(e,t,n,i,a,l,u)=>{const d=e.transform,f="globe"===d.projection.name,p=f?rS(d.zoom,t.canonical)*d._pixelsPerMercatorPixel:eh(n,1,l),g={u_matrix:t.projMatrix,u_extrude_scale:p,u_intensity:u,u_inv_rot_matrix:pA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(f){g.u_inv_rot_matrix=i,g.u_merc_center=a,g.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],g.u_zoom_transition=ki(d.zoom);const _=a[0]*lt,v=a[1]*lt;g.u_up_dir=d.projection.upVector(new Qs(0,0,0),_,v)}return g},RT=(e,t,n,i,a,l,u,d,f,p,g)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_tl_parent:i,u_scale_parent:a,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=u.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Tm(u.paint.get("raster-hue-rotate")),u_perspective_transform:d,u_colorization_mix:p,u_colorization_scale:gA(g),u_color_ramp:f};var _,v};function Tm(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}function gA([e,t]){if(e===t)return[e,t];const n=(t+e)/2,i=(t-e)/2*256/255;return[-(e=n-i)/((t=n+i)-e),1/(t-e)]}const Oy=nt.create(),OT=(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T)=>{const C=a.transform,D={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:C.getCameraToCenterDistance(E),u_rotate_symbol:+n,u_aspect_ratio:C.width/C.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:l,u_label_plane_matrix:u,u_coord_matrix:d,u_is_text:+f,u_pitch_with_map:+i,u_texsize:p,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Oy,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Oy,u_up_vector:[0,-1,0],u_icon_transition:T||0};return"globe"===E.name&&(D.u_tile_id=[g.canonical.x,g.canonical.y,1<<g.canonical.z],D.u_zoom_transition=_,D.u_inv_rot_matrix=x,D.u_merc_center=v,D.u_camera_forward=C._camera.forward(),D.u_ecef_origin=function(A,P){const I=[0,0,0],R=as(uo(P.canonical));return G.transformMat4(I,I,R),G.transformMat4(I,I,A),I}(C.globeMatrix,g.toUnwrapped()),D.u_tile_matrix=Float32Array.from(C.globeMatrix),D.u_up_vector=b),D},_A=(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T)=>qt(OT(e,t,n,i,a,l,u,d,f,p,_,v,x,b,E,T),{u_gamma_scale:i?a.transform.getCameraToCenterDistance(T)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:Ft.devicePixelRatio,u_is_halo:+g,undefined:void 0}),yA=(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E)=>qt(_A(e,t,n,i,a,l,u,d,!0,f,!0,g,_,v,x,b,E),{u_texsize_icon:p,u_texture_icon:1}),TO=(e,t,n,i)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:i}),hc=(e,t,n,i,a,l,u)=>qt(function(d,f,p,g){const _=p.imageManager.getPattern(d.toString(),f),{width:v,height:x}=p.imageManager.getPixelSize(f),b=Math.pow(2,g.tileID.overscaledZ),E=g.tileSize*Math.pow(2,p.transform.tileZoom)/b,T=E*(g.tileID.canonical.x+g.tileID.wrap*b),C=E*g.tileID.canonical.y;return{u_image:0,u_pattern_tl:_.tl,u_pattern_br:_.br,u_texsize:[v,x],u_pattern_size:_.displaySize,u_tile_units_to_pixels:1/eh(g,1,p.transform.tileZoom),u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}(a,l,i,u),{u_matrix:e,u_emissive_strength:t,u_opacity:n}),ps={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Z1=(e,t,n,i,a,l,u,d,f,p,g,_=[0,0,0])=>{const v=i.style.light,x=v.properties.get("position"),b=[-x.x,-x.y,x.z],E=Mo.create();"viewport"===v.properties.get("anchor")&&(Mo.fromRotation(E,-i.transform.angle),G.transformMat3(b,b,E));const T="MASK"===p.alphaMode,C=v.properties.get("color"),D=g.paint.get("model-ambient-occlusion-intensity"),A=g.paint.get("model-color").constantOr(Ae.white),P=g.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:n,u_lightpos:b,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_camera_pos:_,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+T,u_alphaCutoff:p.alphaCutoff,u_baseColorFactor:[l.r,l.g,l.b,l.a],u_emissiveFactor:[u[0],u[1],u[2],1],u_metallicFactor:d,u_roughnessFactor:f,u_baseColorTexture:ps.BaseColor,u_metallicRoughnessTexture:ps.MetallicRoughness,u_normalTexture:ps.Normal,u_occlusionTexture:ps.Occlusion,u_emissionTexture:ps.Emission,u_color_mix:[A.r,A.g,A.b,P],u_aoIntensity:D}},kT=new Float32Array(16),Dm=(e,t=kT,n=kT)=>({u_matrix:e,u_instance:t,u_node_matrix:n}),LT={fillExtrusion:e=>({u_matrix:new we(e),u_lightpos:new se(e),u_lightintensity:new xt(e),u_lightcolor:new se(e),u_vertical_gradient:new xt(e),u_opacity:new xt(e),u_edge_radius:new xt(e),u_ao:new Ue(e),u_tile_id:new se(e),u_zoom_transition:new xt(e),u_inv_rot_matrix:new we(e),u_merc_center:new Ue(e),u_up_dir:new se(e),u_height_lift:new xt(e),u_flood_light_color:new se(e),u_vertical_scale:new xt(e),u_flood_light_intensity:new xt(e),u_ground_shadow_factor:new se(e)}),fillExtrusionDepth:e=>({u_matrix:new we(e),u_edge_radius:new xt(e),u_vertical_scale:new xt(e)}),fillExtrusionPattern:e=>({u_matrix:new we(e),u_lightpos:new se(e),u_lightintensity:new xt(e),u_lightcolor:new se(e),u_vertical_gradient:new xt(e),u_height_factor:new xt(e),u_edge_radius:new xt(e),u_ao:new Ue(e),u_tile_id:new se(e),u_zoom_transition:new xt(e),u_inv_rot_matrix:new we(e),u_merc_center:new Ue(e),u_up_dir:new se(e),u_height_lift:new xt(e),u_image:new Le(e),u_texsize:new Ue(e),u_pixel_coord_upper:new Ue(e),u_pixel_coord_lower:new Ue(e),u_tile_units_to_pixels:new xt(e),u_opacity:new xt(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new we(e),u_opacity:new xt(e),u_ao_pass:new xt(e),u_meter_to_tile:new xt(e),u_ao:new Ue(e),u_flood_light_intensity:new xt(e),u_flood_light_color:new se(e),u_attenuation:new xt(e),u_edge_radius:new xt(e),u_fb:new Le(e),u_fb_size:new xt(e)}),fill:e=>({u_matrix:new we(e),u_emissive_strength:new xt(e)}),fillPattern:e=>({u_matrix:new we(e),u_emissive_strength:new xt(e),u_image:new Le(e),u_texsize:new Ue(e),u_pixel_coord_upper:new Ue(e),u_pixel_coord_lower:new Ue(e),u_tile_units_to_pixels:new xt(e)}),fillOutline:e=>({u_matrix:new we(e),u_emissive_strength:new xt(e),u_world:new Ue(e)}),fillOutlinePattern:e=>({u_matrix:new we(e),u_emissive_strength:new xt(e),u_world:new Ue(e),u_image:new Le(e),u_texsize:new Ue(e),u_pixel_coord_upper:new Ue(e),u_pixel_coord_lower:new Ue(e),u_tile_units_to_pixels:new xt(e)}),circle:e=>({u_camera_to_center_distance:new xt(e),u_extrude_scale:new Bc(e),u_device_pixel_ratio:new xt(e),u_matrix:new we(e),u_inv_rot_matrix:new we(e),u_merc_center:new Ue(e),u_tile_id:new se(e),u_zoom_transition:new xt(e),u_up_dir:new se(e),u_emissive_strength:new xt(e)}),collisionBox:e=>({u_matrix:new we(e),u_camera_to_center_distance:new xt(e),u_extrude_scale:new Ue(e)}),collisionCircle:e=>({u_matrix:new we(e),u_inv_matrix:new we(e),u_camera_to_center_distance:new xt(e),u_viewport_size:new Ue(e)}),debug:e=>({u_color:new ii(e),u_matrix:new we(e),u_overlay:new Le(e),u_overlay_scale:new xt(e)}),clippingMask:e=>({u_matrix:new we(e)}),heatmap:e=>({u_extrude_scale:new xt(e),u_intensity:new xt(e),u_matrix:new we(e),u_inv_rot_matrix:new we(e),u_merc_center:new Ue(e),u_tile_id:new se(e),u_zoom_transition:new xt(e),u_up_dir:new se(e)}),heatmapTexture:e=>({u_image:new Le(e),u_color_ramp:new Le(e),u_opacity:new xt(e)}),hillshade:e=>({u_matrix:new we(e),u_image:new Le(e),u_latrange:new Ue(e),u_light:new Ue(e),u_shadow:new ii(e),u_highlight:new ii(e),u_emissive_strength:new xt(e),u_accent:new ii(e)}),hillshadePrepare:e=>({u_matrix:new we(e),u_image:new Le(e),u_dimension:new Ue(e),u_zoom:new xt(e),u_unpack:new rs(e)}),line:e=>({u_matrix:new we(e),u_pixels_to_tile_units:new Bc(e),u_device_pixel_ratio:new xt(e),u_units_to_pixels:new Ue(e),u_dash_image:new Le(e),u_gradient_image:new Le(e),u_image_height:new xt(e),u_texsize:new Ue(e),u_tile_units_to_pixels:new xt(e),u_alpha_discard_threshold:new xt(e),u_trim_offset:new Ue(e),u_emissive_strength:new xt(e)}),linePattern:e=>({u_matrix:new we(e),u_texsize:new Ue(e),u_pixels_to_tile_units:new Bc(e),u_device_pixel_ratio:new xt(e),u_image:new Le(e),u_units_to_pixels:new Ue(e),u_tile_units_to_pixels:new xt(e),u_alpha_discard_threshold:new xt(e)}),raster:e=>({u_matrix:new we(e),u_normalize_matrix:new we(e),u_globe_matrix:new we(e),u_tl_parent:new Ue(e),u_scale_parent:new xt(e),u_fade_t:new xt(e),u_opacity:new xt(e),u_image0:new Le(e),u_image1:new Le(e),u_brightness_low:new xt(e),u_brightness_high:new xt(e),u_saturation_factor:new xt(e),u_contrast_factor:new xt(e),u_spin_weights:new se(e),u_perspective_transform:new Ue(e),u_colorization_mix:new rs(e),u_colorization_scale:new Ue(e),u_color_ramp:new Le(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Le(e),u_is_size_feature_constant:new Le(e),u_size_t:new xt(e),u_size:new xt(e),u_camera_to_center_distance:new xt(e),u_rotate_symbol:new Le(e),u_aspect_ratio:new xt(e),u_fade_change:new xt(e),u_matrix:new we(e),u_label_plane_matrix:new we(e),u_coord_matrix:new we(e),u_is_text:new Le(e),u_pitch_with_map:new Le(e),u_texsize:new Ue(e),u_tile_id:new se(e),u_zoom_transition:new xt(e),u_inv_rot_matrix:new we(e),u_merc_center:new Ue(e),u_camera_forward:new se(e),u_tile_matrix:new we(e),u_up_vector:new se(e),u_ecef_origin:new se(e),u_texture:new Le(e),u_icon_transition:new xt(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Le(e),u_is_size_feature_constant:new Le(e),u_size_t:new xt(e),u_size:new xt(e),u_camera_to_center_distance:new xt(e),u_rotate_symbol:new Le(e),u_aspect_ratio:new xt(e),u_fade_change:new xt(e),u_matrix:new we(e),u_label_plane_matrix:new we(e),u_coord_matrix:new we(e),u_is_text:new Le(e),u_pitch_with_map:new Le(e),u_texsize:new Ue(e),u_texture:new Le(e),u_gamma_scale:new xt(e),u_device_pixel_ratio:new xt(e),u_tile_id:new se(e),u_zoom_transition:new xt(e),u_inv_rot_matrix:new we(e),u_merc_center:new Ue(e),u_camera_forward:new se(e),u_tile_matrix:new we(e),u_up_vector:new se(e),u_ecef_origin:new se(e),u_is_halo:new Le(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Le(e),u_is_size_feature_constant:new Le(e),u_size_t:new xt(e),u_size:new xt(e),u_camera_to_center_distance:new xt(e),u_rotate_symbol:new Le(e),u_aspect_ratio:new xt(e),u_fade_change:new xt(e),u_matrix:new we(e),u_label_plane_matrix:new we(e),u_coord_matrix:new we(e),u_is_text:new Le(e),u_pitch_with_map:new Le(e),u_texsize:new Ue(e),u_texsize_icon:new Ue(e),u_texture:new Le(e),u_texture_icon:new Le(e),u_gamma_scale:new xt(e),u_device_pixel_ratio:new xt(e),u_is_halo:new Le(e)}),background:e=>({u_matrix:new we(e),u_emissive_strength:new xt(e),u_opacity:new xt(e),u_color:new ii(e)}),backgroundPattern:e=>({u_matrix:new we(e),u_emissive_strength:new xt(e),u_opacity:new xt(e),u_image:new Le(e),u_pattern_tl:new Ue(e),u_pattern_br:new Ue(e),u_texsize:new Ue(e),u_pattern_size:new Ue(e),u_pixel_coord_upper:new Ue(e),u_pixel_coord_lower:new Ue(e),u_tile_units_to_pixels:new xt(e)}),terrainRaster:U1,terrainDepth:U1,skybox:e=>({u_matrix:new we(e),u_sun_direction:new se(e),u_cubemap:new Le(e),u_opacity:new xt(e),u_temporal_offset:new xt(e)}),skyboxGradient:e=>({u_matrix:new we(e),u_color_ramp:new Le(e),u_center_direction:new se(e),u_radius:new xt(e),u_opacity:new xt(e),u_temporal_offset:new xt(e)}),skyboxCapture:e=>({u_matrix_3f:new op(e),u_sun_direction:new se(e),u_sun_intensity:new xt(e),u_color_tint_r:new rs(e),u_color_tint_m:new rs(e),u_luminance:new xt(e)}),globeRaster:e=>({u_proj_matrix:new we(e),u_globe_matrix:new we(e),u_normalize_matrix:new we(e),u_merc_matrix:new we(e),u_zoom_transition:new xt(e),u_merc_center:new Ue(e),u_image0:new Le(e),u_grid_matrix:new op(e),u_skirt_height:new xt(e),u_frustum_tl:new se(e),u_frustum_tr:new se(e),u_frustum_br:new se(e),u_frustum_bl:new se(e),u_globe_pos:new se(e),u_globe_radius:new xt(e),u_viewport:new Ue(e)}),globeAtmosphere:e=>({u_frustum_tl:new se(e),u_frustum_tr:new se(e),u_frustum_br:new se(e),u_frustum_bl:new se(e),u_horizon:new xt(e),u_transition:new xt(e),u_fadeout_range:new xt(e),u_color:new rs(e),u_high_color:new rs(e),u_space_color:new rs(e),u_temporal_offset:new xt(e),u_horizon_angle:new xt(e)}),model:e=>({u_matrix:new we(e),u_lighting_matrix:new we(e),u_normal_matrix:new we(e),u_lightpos:new se(e),u_lightintensity:new xt(e),u_lightcolor:new se(e),u_camera_pos:new se(e),u_opacity:new xt(e),u_baseColorFactor:new rs(e),u_emissiveFactor:new rs(e),u_metallicFactor:new xt(e),u_roughnessFactor:new xt(e),u_baseTextureIsAlpha:new Le(e),u_alphaMask:new Le(e),u_alphaCutoff:new xt(e),u_baseColorTexture:new Le(e),u_metallicRoughnessTexture:new Le(e),u_normalTexture:new Le(e),u_occlusionTexture:new Le(e),u_emissionTexture:new Le(e),u_color_mix:new rs(e),u_aoIntensity:new xt(e)}),modelDepth:e=>({u_matrix:new we(e),u_instance:new we(e),u_node_matrix:new we(e)}),groundShadow:e=>({u_matrix:new we(e),u_ground_shadow_factor:new se(e)}),stars:e=>({u_matrix:new we(e),u_up:new se(e),u_right:new se(e),u_intensity_multiplier:new xt(e)})};let ky;function W1(e,t,n,i,a,l,u){const d=e.context,f=d.gl,p=e.transform,g=e.getOrCreateProgram("collisionBox"),_=[];let v=0,x=0;for(let P=0;P<i.length;P++){const I=i[P],R=t.getTile(I),k=R.getBucket(n);if(!k)continue;const L=$I(I,k,p);let N=L;0===a[0]&&0===a[1]||(N=e.translatePosMatrix(L,R,a,l));const z=u?k.textCollisionBox:k.iconCollisionBox,j=k.collisionCircleArray;if(j.length>0){const B=nt.create(),H=N;nt.mul(B,k.placementInvProjMatrix,p.glCoordMatrix),nt.mul(B,B,k.placementViewportMatrix),_.push({circleArray:j,circleOffset:x,transform:H,invTransform:B,projection:k.getProjection()}),v+=j.length/4,x=v}z&&(e.terrain&&e.terrain.setupElevationDraw(R,g),g.draw(e,f.LINES,pe.disabled,Se.disabled,e.colorModeForRenderPass(),Fe.disabled,fA(N,p,R,k.getProjection()),n.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,null,p.zoom,null,[z.collisionVertexBuffer,z.collisionVertexBufferExt]))}if(!u||!_.length)return;const b=e.getOrCreateProgram("collisionCircle"),E=new Zh;E.resize(4*v),E._trim();let T=0;for(const P of _)for(let I=0;I<P.circleArray.length/4;I++){const R=4*I,k=P.circleArray[R+0],L=P.circleArray[R+1],N=P.circleArray[R+2],z=P.circleArray[R+3];E.emplace(T++,k,L,N,z,0),E.emplace(T++,k,L,N,z,1),E.emplace(T++,k,L,N,z,2),E.emplace(T++,k,L,N,z,3)}(!ky||ky.length<2*v)&&(ky=function(P){const I=2*P,R=new Rr;R.resize(I),R._trim();for(let k=0;k<I;k++){const L=6*k;R.uint16[L+0]=4*k+0,R.uint16[L+1]=4*k+1,R.uint16[L+2]=4*k+2,R.uint16[L+3]=4*k+2,R.uint16[L+4]=4*k+3,R.uint16[L+5]=4*k+0}return R}(v));const C=d.createIndexBuffer(ky,!0),D=d.createVertexBuffer(E,DS.members,!0);for(const P of _){const I={u_matrix:P.transform,u_inv_matrix:P.invTransform,u_camera_to_center_distance:(A=p).getCameraToCenterDistance(P.projection),u_viewport_size:[A.width,A.height]};b.draw(e,f.TRIANGLES,pe.disabled,Se.disabled,e.colorModeForRenderPass(),Fe.disabled,I,n.id,D,C,bn.simpleSegment(0,2*P.circleOffset,P.circleArray.length,P.circleArray.length/2),null,p.zoom)}var A;D.destroy(),C.destroy()}const Sm=nt.create();function vA({width:e,height:t,anchor:n,textOffset:i,textScale:a},l){const{horizontalAlign:u,verticalAlign:d}=B_(n),f=-(u-.5)*e,p=-(d-.5)*t,g=Up(n,i);return new tt((f/a+g[0])*l,(p/a+g[1])*l)}function xA(e,t,n,i,a,l,u,d,f,p,g){const _=e.text.placedSymbolArray,v=e.text.dynamicLayoutVertexArray,x=e.icon.dynamicLayoutVertexArray,b={},E=e.getProjection(),T=wy(d,E,l),C=l.elevation,D=E.upVectorScale(d.canonical,l.center.lat,l.worldSize).metersToTile;v.clear();for(let A=0;A<_.length;A++){const P=_.get(A),{tileAnchorX:I,tileAnchorY:R,numGlyphs:k}=P,L=P.hidden||!P.crossTileID||e.allowVerticalPlacement&&!P.placedOrientation?null:i[P.crossTileID];if(L){let N=0,z=0,j=0;if(C){const rt=C?C.getAtTileOffset(d,I,R):0,[ot,ct,dt]=E.upVector(d.canonical,I,R);N=rt*ot*D,z=rt*ct*D,j=rt*dt*D}let[B,H,V,Z]=ia(P.projectedAnchorX+N,P.projectedAnchorY+z,P.projectedAnchorZ+j,n?T:u);const Q=uC(l.getCameraToCenterDistance(E),Z);let et=a.evaluateSizeForFeature(e.textSizeData,p,P)*Q/pi;n&&(et*=e.tilePixelRatio/f);const W=vA(L,et);n?(({x:B,y:H,z:V}=E.projectTilePoint(I+W.x,R+W.y,d.canonical)),[B,H,V]=ia(B+N,H+z,V+j,u)):(t&&W._rotate(-l.angle),B+=W.x,H+=W.y,V=0);const X=e.allowVerticalPlacement&&P.placedOrientation===Hn.vertical?Math.PI/2:0;for(let rt=0;rt<k;rt++)Pd(v,B,H,V,X);g&&P.associatedIconIndex>=0&&(b[P.associatedIconIndex]={x:B,y:H,z:V,angle:X})}else nh(k,v)}if(g){x.clear();const A=e.icon.placedSymbolArray;for(let P=0;P<A.length;P++){const I=A.get(P),{numGlyphs:R}=I,k=b[P];if(I.hidden||!k)nh(R,x);else{const{x:L,y:N,z,angle:j}=k;for(let B=0;B<R;B++)Pd(x,L,N,z,j)}}e.icon.dynamicLayoutVertexBuffer.updateData(x)}e.text.dynamicLayoutVertexBuffer.updateData(v)}function FT(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function NT(e,t,n,i,a,l,u,d,f,p,g,_){const v=e.context,x=v.gl,b=e.transform,E="map"===d,T="map"===f,C=E&&"point"!==n.layout.get("symbol-placement"),D=E&&!T&&!C,A=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let P=!1;const I=e.depthModeForSublayer(0,pe.ReadOnly),R=[Li(b.center.lng),Gi(b.center.lat)],k=n.layout.get("text-variable-anchor"),L="globe"===b.projection.name,N=[],z=[0,-1,0];let j=z;!L&&!b.mercatorFromTransition||E||(j=function(B){const H=B._camera.getWorldToCamera(B.worldSize,1),V=nt.multiply([],H,B.globeMatrix);nt.invert(V,V);const Z=[0,0,0],Q=[0,1,0,0];return vn.transformMat4(Q,Q,V),Z[0]=Q[0],Z[1]=Q[1],Z[2]=Q[2],G.normalize(Z,Z),Z}(b));for(const B of i){const H=t.getTile(B),V=H.getBucket(n);if(!V||"mercator"===V.projection.name&&L)continue;const Z=a?V.text:V.icon;if(!Z||V.fullyClipped||!Z.segments.get().length)continue;const Q=Z.programConfigurations.get(n.id),et=a||V.sdfIcons,W=a?V.textSizeData:V.iconSizeData,X=T||0!==b.pitch,rt=tc(W,b.zoom);let ot,ct,dt,gt,at=[0,0],ut=null;if(a)ct=H.glyphAtlasTexture,dt=x.LINEAR,ot=H.glyphAtlasTexture.size,V.iconsInText&&(at=H.imageAtlasTexture.size,ut=H.imageAtlasTexture,gt=X||e.options.rotating||e.options.zooming||"composite"===W.kind||"camera"===W.kind?x.LINEAR:x.NEAREST);else{const Kn=1!==n.layout.get("icon-size").constantOr(0)||V.iconsNeedLinear;ct=H.imageAtlasTexture,dt=et||e.options.rotating||e.options.zooming||Kn||X?x.LINEAR:x.NEAREST,ot=H.imageAtlasTexture.size}const St="globe"===V.projection.name,Nt=St?j:z,zt=St?ki(b.zoom):0,Vt=wy(B,V.getProjection(),b),Kt=b.calculatePixelsToTileUnitsMatrix(H),he=Hd(Vt,H.tileID.canonical,T,E,b,V.getProjection(),Kt),Oe=e.terrain&&T&&C?nt.invert(nt.create(),he):Sm,Xe=Yx(Vt,H.tileID.canonical,T,E,b,V.getProjection(),Kt),Ce=k&&V.hasTextData(),xe=V.hasIconTextFit()&&Ce&&V.hasIconData();if(C){const Kn=b.elevation,qn=Kn?Kn.getAtTileOffsetFunc(B,b.center.lat,b.worldSize,V.getProjection()):null,Cn=ly(Vt,H.tileID.canonical,T,E,b,V.getProjection(),Kt);aI(V,Vt,e,a,Cn,Xe,T,p,qn,B)}const ce=C||a&&k||xe,ie=e.translatePosMatrix(Vt,H,l,u),Ne=ce?Sm:he,Ke=e.translatePosMatrix(Xe,H,l,u,!0),Re=V.getProjection().createInversionMatrix(b,B.canonical),Sn=n.paint.get("icon-image-cross-fade").constantOr(0),or=[];e.terrainRenderModeElevated()&&T&&or.push("PITCH_WITH_MAP_TERRAIN"),St&&(or.push("PROJECTION_GLOBE_VIEW"),ce&&or.push("PROJECTED_POS_ON_VIEWPORT")),Sn>0&&or.push("ICON_TRANSITION"),Z.zOffsetVertexBuffer&&or.push("Z_OFFSET");const Gn=et&&0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let kn;kn=et?V.iconsInText?yA(W.kind,rt,D,T,e,ie,Ne,Ke,ot,at,B,zt,R,Re,Nt,V.getProjection()):_A(W.kind,rt,D,T,e,ie,Ne,Ke,a,ot,!0,B,zt,R,Re,Nt,V.getProjection()):OT(W.kind,rt,D,T,e,ie,Ne,Ke,a,ot,B,zt,R,Re,Nt,V.getProjection(),Sn);const Vr={program:e.getOrCreateProgram(FT(et,a,V),{config:Q,defines:or}),buffers:Z,uniformValues:kn,atlasTexture:ct,atlasTextureIcon:ut,atlasInterpolation:dt,atlasInterpolationIcon:gt,isSDF:et,hasHalo:Gn,tile:H,labelPlaneMatrixInv:Oe};if(A&&V.canOverlap){P=!0;const Kn=Z.segments.get();for(const qn of Kn)N.push({segments:new bn([qn]),sortKey:qn.sortKey,state:Vr})}else N.push({segments:Z.segments,sortKey:0,state:Vr})}P&&N.sort((B,H)=>B.sortKey-H.sortKey);for(const B of N){const H=B.state;if(e.terrain&&e.terrain.setupElevationDraw(H.tile,H.program,{useDepthForOcclusion:b.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:H.labelPlaneMatrixInv}),v.activeTexture.set(x.TEXTURE0),H.atlasTexture.bind(H.atlasInterpolation,x.CLAMP_TO_EDGE),H.atlasTextureIcon&&(v.activeTexture.set(x.TEXTURE1),H.atlasTextureIcon&&H.atlasTextureIcon.bind(H.atlasInterpolationIcon,x.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,H.program),H.hasHalo){const V=H.uniformValues;V.u_is_halo=1,X1(H.buffers,B.segments,n,e,H.program,I,g,_,V,2),V.u_is_halo=0}else{if(H.isSDF){const V=H.uniformValues;H.hasHalo&&(V.u_is_halo=1,X1(H.buffers,B.segments,n,e,H.program,I,g,_,V,1)),V.u_is_halo=0}X1(H.buffers,B.segments,n,e,H.program,I,g,_,H.uniformValues,1)}}}function X1(e,t,n,i,a,l,u,d,f,p){const g=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];a.draw(i,i.context.gl.TRIANGLES,l,u,d,Fe.disabled,f,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,i.transform.zoom,e.programConfigurations.get(n.id),g,p)}function Y1(e,t,n,i,a,l,u){const d=e.context.gl,f=n.paint.get("fill-pattern"),p=f&&f.constantOr(1);let g,_,v,x,b;u?(_=p&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",g=d.LINES):(_=p?"fillPattern":"fill",g=d.TRIANGLES);for(const E of i){const T=t.getTile(E);if(p&&!T.patternsLoaded())continue;const C=T.getBucket(n);if(!C)continue;e.prepareDrawTile();const D=C.programConfigurations.get(n.id),A=e.isTileAffectedByFog(E),P=e.getOrCreateProgram(_,{config:D,overrideFog:A});p&&(e.context.activeTexture.set(d.TEXTURE0),T.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),D.updatePaintBuffers());const I=f.constantOr(null);if(I&&T.imageAtlas){const L=T.imageAtlas.patternPositions[I.toString()];L&&D.setConstantPatternPositions(L)}const R=e.translatePosMatrix(E.projMatrix,T,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),k=n.paint.get("fill-emissive-strength");if(u){x=C.indexBuffer2,b=C.segments2;const L=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];v="fillOutlinePattern"===_&&p?CO(R,k,e,T,L):MO(R,k,L)}else x=C.indexBuffer,b=C.segments,v=p?AT(R,k,e,T):IT(R,k);e.uploadCommonUniforms(e.context,P,E.toUnwrapped()),P.draw(e,g,a,e.stencilModeForClipping(E),l,Fe.disabled,v,n.id,C.layoutVertexBuffer,x,b,n.paint,e.transform.zoom,D,void 0)}}function ms(e,t,n,i,a,l,u,d){const f=e.context,p=f.gl,g=e.transform,_=n.paint.get("fill-extrusion-pattern"),v=_.constantOr(1),x=n.paint.get("fill-extrusion-opacity"),b=e.style.enable3dLights(),E=n.paint.get(b&&!v?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),T=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),E],C=n.layout.get("fill-extrusion-edge-radius"),D=C>0&&!n.paint.get("fill-extrusion-rounded-roof"),A=D?0:C,P="globe"===g.projection.name?a1():0,I="globe"===g.projection.name,R=I?ki(g.zoom):0,k=[Li(g.center.lng),Gi(g.center.lat)],L=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=n.paint.get("fill-extrusion-flood-light-intensity"),z=n.paint.get("fill-extrusion-vertical-scale"),j=tf(e,n.paint.get("fill-extrusion-cutoff-fade-range")),B=[];let H;I&&B.push("PROJECTION_GLOBE_VIEW"),T[0]>0&&B.push("FAUX_AO"),D&&B.push("ZERO_ROOF_RADIUS"),d&&B.push("HAS_CENTROID"),N>0&&B.push("FLOOD_LIGHT"),j.shouldRenderCutoff&&B.push("RENDER_CUTOFF");const V="shadow"===e.renderPass,Z=e.shadowRenderer,Q=V&&!!Z;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let et=[0,0,0];if(Z){const X=e.style.directionalLight,rt=e.style.ambientLight;X&&rt&&(et=sb(X,rt)),H=B.concat(["SHADOWS_SINGLE_CASCADE"])}const W=Q?"fillExtrusionDepth":v?"fillExtrusionPattern":"fillExtrusion";for(const X of i){const rt=t.getTile(X),ot=rt.getBucket(n);if(!ot||ot.projection.name!==g.projection.name)continue;let ct=!1;Z&&(ct=0===Z.getMaxCascadeForTile(X.toUnwrapped()));const dt=e.isTileAffectedByFog(X),gt=ot.programConfigurations.get(n.id),at=e.getOrCreateProgram(W,{config:gt,defines:ct?H:B,overrideFog:dt});if(e.terrain){const Vt=e.terrain;e.style.terrainSetForDrapingOnly(),Vt.setupElevationDraw(rt,at,{useMeterToDem:!0})}if(!ot.centroidVertexBuffer){const Vt=at.attributes.a_centroid_pos;void 0!==Vt&&p.vertexAttrib2f(Vt,0,0)}!V&&Z&&Z.setupShadows(rt.tileID.toUnwrapped(),at,"vector-tile",rt.tileID.overscaledZ),v&&(e.context.activeTexture.set(p.TEXTURE0),rt.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),gt.updatePaintBuffers());const ut=_.constantOr(null);if(ut&&rt.imageAtlas){const Vt=rt.imageAtlas.patternPositions[ut.toString()];Vt&&gt.setConstantPatternPositions(Vt)}const St=n.paint.get("fill-extrusion-vertical-gradient");let Nt;if(V&&Z){if(VT(rt.tileID,ot,e))continue;const Vt=Z.calculateShadowPassMatrixFromTile(rt.tileID.toUnwrapped());Nt=DT(Vt,A,z)}else{const Vt=e.translatePosMatrix(X.projMatrix,rt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Kt=g.projection.createInversionMatrix(g,X.canonical);Nt=v?ST(Vt,e,St,x,T,A,X,rt,P,R,k,Kt,L,z):q1(Vt,e,St,x,T,A,X,P,R,k,Kt,L,z,N,et)}e.uploadCommonUniforms(f,at,X.toUnwrapped(),null,j);const zt=[];(e.terrain||d)&&zt.push(ot.centroidVertexBuffer),I&&zt.push(ot.layoutVertexExtBuffer),at.draw(e,f.gl.TRIANGLES,a,l,u,Fe.backCCW,Nt,n.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,n.paint,e.transform.zoom,gt,zt)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function nf(e,t,n,i,a,l,u,d,f,p,g,_,v,x,b,E,T,C,D){const A=e.context,P=A.gl,I=e.transform,R=e.transform.zoom,k=[],L=tf(e,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===p?(k.push("CLEAR_SUBPASS"),D&&(k.push("CLEAR_FROM_TEXTURE"),A.activeTexture.set(P.TEXTURE0),D.bind(P.LINEAR,P.CLAMP_TO_EDGE))):"sdf"===p&&k.push("SDF_SUBPASS"),T&&k.push("HAS_CENTROID"),L.shouldRenderCutoff&&k.push("RENDER_CUTOFF");const N=n.layout.get("fill-extrusion-edge-radius"),z=(j,B,H,V,Z)=>{const Q=B.programConfigurations.get(n.id),et=e.isTileAffectedByFog(j),W=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:Q,defines:k,overrideFog:et}),X={u_matrix:V,u_opacity:g,u_ao_pass:f?1:0,u_meter_to_tile:Z,u_ao:[_,v*Z],u_flood_light_intensity:x,u_flood_light_color:b,u_attenuation:E,u_edge_radius:R>=17?0:N*Z,u_fb:0,u_fb_size:D?D.size[0]:0},rt=[];T&&rt.push(B.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(A,W,j.toUnwrapped(),null,L),W.draw(e,A.gl.TRIANGLES,a,l,u,d,X,n.id,B.vertexBuffer,B.indexBuffer,H,n.paint,R,Q,rt)};for(const j of i){const B=t.getTile(j),H=B.getBucket(n);if(!H||H.projection.name!==I.projection.name||!H.groundEffect||H.groundEffect&&!H.groundEffect.hasData())continue;const V=H.groundEffect,Z=1/H.tileToMeter;{const Q=e.translatePosMatrix(j.projMatrix,B,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),et=V.getDefaultSegment();z(j,V,et,Q,Z)}if(C)for(let Q=0;Q<4;Q++){const et=B0[Q](j),W=t.getTile(et);if(!W)continue;const X=W.getBucket(n);if(!X||X.projection.name!==I.projection.name||!X.groundEffect||X.groundEffect&&!X.groundEffect.hasData())continue;const rt=X.groundEffect;let ot,ct;0===Q?(ot=[-lt,0,0],ct=1):1===Q?(ot=[lt,0,0],ct=0):2===Q?(ot=[0,-lt,0],ct=3):(ot=[0,lt,0],ct=2);const dt=rt.regionSegments[ct];if(!dt)continue;const gt=new Float32Array(16);nt.translate(gt,j.projMatrix,ot),z(j,rt,dt,e.translatePosMatrix(gt,B,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Z)}}}function bA(e,t,n,i,a,l,u){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const d=l?l.findDEMTileFor(n):null;if(!(d&&d.dem||u))return;const f=C=>{const D=t.getSource().minzoom,A=I=>{const R=t.getTileByID(I);if(R&&R.hasData())return R.getBucket(a)},P=[0,-1,1];for(const I of P){if(C.overscaledZ+I<D)continue;const R=A(C.calculateScaledKey(C.overscaledZ+I));if(R)return R}},p=[0,0,0],g=(C,D)=>(p[0]=Math.min(C.min.y,D.min.y),p[1]=Math.max(C.max.y,D.max.y),p[2]=lt-D.min.x>C.max.x?D.min.x-lt:C.max.x,p),_=(C,D)=>(p[0]=Math.min(C.min.x,D.min.x),p[1]=Math.max(C.max.x,D.max.x),p[2]=lt-D.min.y>C.max.y?D.min.y-lt:C.max.y,p),v=[(C,D)=>g(C,D),(C,D)=>g(D,C),(C,D)=>_(C,D),(C,D)=>_(D,C)],x=(C,D,A,P,I,R,k)=>{if(!l)return 0;const L=[[R?A:C,R?C:A,0],[R?A:D,R?D:A,0]],N=k<0?lt+k:k,z=[R?N:(C+D)/2,R?(C+D)/2:N,0];return 0===A&&k<0||0!==A&&k>0?l.getForTilePoints(I,[z],!0,P):L.push(z),l.getForTilePoints(n,L,!0,d),Math.max(L[0][2],L[1][2],z[2])/l.exaggeration()};for(let C=0;C<4;C++){const D=i.borderFeatureIndices[C];if(0===D.length)continue;const A=B0[C](n),P=f(A);if(!(P&&P instanceof Wd)||i.borderDoneWithNeighborZ[C]===P.canonical.z)continue;0===P.centroidVertexArray.length&&P.createCentroidsBuffer();const I=l?l.findDEMTileFor(A):null;if(!(I&&I.dem||u))continue;const R=(C<2?1:5)-C,k=P.borderDoneWithNeighborZ[R]!==i.canonical.z,L=P.borderFeatureIndices[R];let N=0;if(i.canonical.z!==P.canonical.z){for(const z of D)i.showCentroid(i.featuresOnBorder[z]);if(k)for(const z of L)P.showCentroid(P.featuresOnBorder[z]);i.borderDoneWithNeighborZ[C]=P.canonical.z,P.borderDoneWithNeighborZ[R]=i.canonical.z}for(const z of D){const j=i.featuresOnBorder[z],B=i.centroidData[j.centroidDataIndex],H=j.borders[C];let V;for(;N<L.length;){V=P.featuresOnBorder[L[N]];const Z=V.borders[R];if(Z[1]>H[0]+3||Z[0]>H[0]-3)break;P.showCentroid(V),N++}if(V&&N<L.length){const Z=N;let Q=0;for(;!(V.borders[R][0]>H[1]-3)&&(Q++,++N!==L.length);)V=P.featuresOnBorder[L[N]];if(V=P.featuresOnBorder[L[Z]],Q>1){const X=V.borders[R];Math.abs(H[0]-X[0])<3&&Math.abs(H[1]-X[1])<3&&(Q=1,N=Z+1)}else if(0===Q){i.showCentroid(j);continue}const et=P.centroidData[V.centroidDataIndex];u&&1===Q&&(((E=B).flags|(T=et).flags)&Ra?(E.flags|=Ra,T.flags|=Ra):(E.flags&=2147483647,T.flags&=2147483647));let W=new tt(0,0);if(Q>1)N=Z;else if(I&&I.dem&&!(j.intersectsCount()>1||V.intersectsCount()>1)){const X=v[C](B,et),rt=C%2?lt-1:0;b=x(X[0],Math.min(lt-1,X[1]),rt,I,A,C<2,X[2]),W=new tt(Math.ceil(7*(b+450)),0)}B.centroidXY=et.centroidXY=W,i.writeCentroidToBuffer(B),P.writeCentroidToBuffer(et)}else i.showCentroid(j)}i.borderDoneWithNeighborZ[C]=P.canonical.z,P.borderDoneWithNeighborZ[R]=i.canonical.z}var b,E,T;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(e)}const zT=[1,0,0],BT=[0,1,0],J1=[0,0,1];function VT(e,t,n){const i=n.transform,a=n.shadowRenderer;if(!a)return!0;const l=e.toUnwrapped(),u=i.tileSize*a._cascades[n.currentShadowCascade].scale;let d=t.maxHeight;if(i.elevation){const E=i.elevation.getMinMaxForTile(e);E&&(d+=E.max)}const f=[...a.shadowDirection];f[2]=-f[2];const p=a.computeSimplifiedTileShadowVolume(l,d,u,f);if(!p)return!1;const g=[zT,BT,J1,f,[f[0],0,f[2]],[0,f[1],f[2]]],_="globe"===i.projection.name,v=i.scaleZoom(u),x=fl.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,v,!_),b=a.getCurrentCascadeFrustum();return 0===x.intersectsPrecise(p.vertices,p.planes,g)||0===b.intersectsPrecise(p.vertices,p.planes,g)}const wA=new Ae(1,0,0,1),jT=new Ae(0,1,0,1),UT=new Ae(0,0,1,1),EA=new Ae(1,0,1,1),MA=new Ae(0,1,1,1);function K1(e,t,n){const i=e.context,a=e.transform,l=i.gl,u="globe"===a.projection.name,d=u?["PROJECTION_GLOBE_VIEW"]:[];let f=n.projMatrix;if(u&&ki(a.zoom)>0){const z=Hu(u_(n.canonical,a));f=nt.multiply(new Float32Array(16),a.globeMatrix,z),nt.multiply(f,a.projMatrix,f)}const p=e.getOrCreateProgram("debug",{defines:d}),g=t.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(g,p);const _=pe.disabled,v=Se.disabled,x=e.colorModeForRenderPass(),b="$debug";i.activeTexture.set(l.TEXTURE0),e.emptyTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),u?g._makeGlobeTileDebugBuffers(e.context,a):g._makeDebugTileBoundsBuffers(e.context,a.projection);const E=g._tileDebugBuffer||e.debugBuffer,T=g._tileDebugIndexBuffer||e.debugIndexBuffer,C=g._tileDebugSegments||e.debugSegments;p.draw(e,l.LINE_STRIP,_,v,x,Fe.disabled,PT(f,Ae.red),b,E,T,C,null,null,null,[g._globeTileDebugBorderBuffer]);const D=g.latestRawTileData,A=Math.floor((D&&D.byteLength||0)/1024),P=t.getTile(n).tileSize,I=512/Math.min(P,512)*(n.overscaledZ/a.zoom)*.5;let R=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(R+=` => ${n.overscaledZ}`),R+=` ${A}kb`,function(z,j){z.initDebugOverlayCanvas();const B=z.debugOverlayCanvas,H=z.context.gl,V=z.debugOverlayCanvas.getContext("2d");V.clearRect(0,0,B.width,B.height),V.shadowColor="white",V.shadowBlur=2,V.lineWidth=1.5,V.strokeStyle="white",V.textBaseline="top",V.font="bold 36px Open Sans, sans-serif",V.fillText(j,5,5),V.strokeText(j,5,5),z.debugOverlayTexture.update(B),z.debugOverlayTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE)}(e,R);const k=g._tileDebugTextBuffer||e.debugBuffer,L=g._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,N=g._tileDebugTextSegments||e.debugSegments;p.draw(e,l.TRIANGLES,_,v,Je.alphaBlended,Fe.disabled,PT(f,Ae.transparent,I),b,k,L,N,null,null,null,[g._globeTileDebugTextBuffer])}function Ly(e,t,n,i){rf(e,0,t+n/2,e.transform.width,n,i)}function Q1(e,t,n,i){rf(e,t-n/2,0,n,e.transform.height,i)}function rf(e,t,n,i,a,l){const u=e.context,d=u.gl;d.enable(d.SCISSOR_TEST),d.scissor(t*Ft.devicePixelRatio,n*Ft.devicePixelRatio,i*Ft.devicePixelRatio,a*Ft.devicePixelRatio),u.clear({color:l}),d.disable(d.SCISSOR_TEST)}const tb=sn([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:CA}=tb;function lu(e,t,n,i){e.emplaceBack(t,n,i)}class $T{constructor(t){this.vertexArray=new wa,this.indices=new Rr,lu(this.vertexArray,-1,-1,1),lu(this.vertexArray,1,-1,1),lu(this.vertexArray,-1,1,1),lu(this.vertexArray,1,1,1),lu(this.vertexArray,-1,-1,-1),lu(this.vertexArray,1,-1,-1),lu(this.vertexArray,-1,1,-1),lu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,CA),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=bn.simpleSegment(0,0,36,12)}}function sf(e,t,n,i,a,l){const u=e.context.gl,d=t.paint.get("sky-atmosphere-color"),f=t.paint.get("sky-atmosphere-halo-color"),p=t.paint.get("sky-atmosphere-sun-intensity"),g={u_matrix_3f:Mo.fromMat4(Mo.create(),i),u_sun_direction:a,u_sun_intensity:p,u_color_tint_r:[(b=d).r,b.g,b.b,b.a],u_color_tint_m:[(E=f).r,E.g,E.b,E.a],u_luminance:5e-5};var b,E;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+l,t.skyboxTexture,0),n.draw(e,u.TRIANGLES,pe.disabled,Se.disabled,Je.unblended,Fe.frontCW,g,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const HT=sn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class eb{constructor(t){const n=new Ys;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const i=new Rr;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,HT.members),this.indexBuffer=t.createIndexBuffer(i),this.segments=bn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const GT=sn([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class TA{constructor(){this.colorModeAlphaBlendedWriteRGB=new Je([1,771,1,771],Ae.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Je([1,0,1,0],Ae.transparent,[!1,!1,!1,!0])}update(t){const n=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new eb(n);const i=100,a=200,l=function(g){const _=Dw(30),v=[];for(let x=0;x<16e3;++x){const b=2*Math.PI*_(),E=Math.acos(1-2*_())-.5*Math.PI;v.push(G.fromValues(Math.cos(E)*Math.cos(b),Math.cos(E)*Math.sin(b),Math.sin(E)))}return v}(),u=Dw(300),d=new Ou,f=new Rr;let p=0;for(let g=0;g<l.length;++g){const _=G.scale([],l[g],200),v=Math.max(0,1+.01*i*(1*u()-.5)),x=Math.max(0,1+.01*a*(1*u()-.5));d.emplaceBack(_[0],_[1],_[2],-1,-1,v,x),d.emplaceBack(_[0],_[1],_[2],1,-1,v,x),d.emplaceBack(_[0],_[1],_[2],1,1,v,x),d.emplaceBack(_[0],_[1],_[2],-1,1,v,x),f.emplaceBack(p+0,p+1,p+2),f.emplaceBack(p+0,p+2,p+3),p+=4}this.starsVx=n.createVertexBuffer(d,GT.members),this.starsIdx=n.createIndexBuffer(f),this.starsSegments=bn.simpleSegment(0,0,d.length,f.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const i=t.context,a=i.gl,l=t.transform,u=new pe(a.LEQUAL,pe.ReadOnly,[0,1]),d=ki(l.zoom),f=n.properties.get("color").toArray01(),p=n.properties.get("high-color").toArray01(),g=n.properties.get("space-color").toArray01PremultipliedAlpha(),_=5e-4,v=Wt((n.properties.get("horizon-blend")-0)/1*.2495+_,5e-4,.25),x=sS(t,i,l)&&v===_?l.worldSize/(2*Math.PI*1.025)-1:l.globeRadius,b=t.frameCounter/1e3%1,E=G.length(l.globeCenterInViewSpace),T=Math.sqrt(Math.pow(E,2)-Math.pow(x,2)),C=Math.acos(T/E),D=A=>{const P="globe"===l.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];A&&P.push("ALPHA_PASS");const I=t.getOrCreateProgram("globeAtmosphere",{defines:P}),R={u_frustum_tl:l.frustumCorners.TL,u_frustum_tr:l.frustumCorners.TR,u_frustum_br:l.frustumCorners.BR,u_frustum_bl:l.frustumCorners.BL,u_horizon:l.frustumCorners.horizon,u_transition:d,u_fadeout_range:v,u_color:f,u_high_color:p,u_space_color:g,u_temporal_offset:b,u_horizon_angle:C};t.uploadCommonUniforms(i,I);const k=this.atmosphereBuffer;k&&I.draw(t,a.TRIANGLES,u,Se.disabled,A?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Fe.backCW,R,A?"atmosphere_glow_alpha":"atmosphere_glow",k.vertexBuffer,k.indexBuffer,k.segments)};D(!1),D(!0)}drawStars(t,n){const i=Wt(n.properties.get("star-intensity"),0,1);if(0===i)return;const a=t.context,l=a.gl,u=t.transform,d=t.getOrCreateProgram("stars"),f=Oi.identity([]);Oi.rotateX(f,f,-u._pitch),Oi.rotateZ(f,f,-u.angle),Oi.rotateX(f,f,Ee(u._center.lat)),Oi.rotateY(f,f,-Ee(u._center.lng));const p=nt.fromQuat(new Float32Array(16),f),g=nt.multiply([],u.starsProjMatrix,p),_=Mo.fromMat4([],p),v=Mo.invert([],_),x=[0,1,0];G.transformMat3(x,x,v),G.scale(x,x,.15);const b=[1,0,0];G.transformMat3(b,b,v),G.scale(b,b,.15);const E=(C=x,D=b,A=i,{u_matrix:Float32Array.from(g),u_up:C,u_right:D,u_intensity_multiplier:A});var C,D,A;t.uploadCommonUniforms(a,d),this.starsVx&&this.starsIdx&&d.draw(t,l.TRIANGLES,pe.disabled,Se.disabled,this.colorModeAlphaBlendedWriteRGB,Fe.disabled,E,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function nb(e,t){const n=[...e],i=t.cameraWorldSizeForFog/t.worldSize,a=nt.identity([]);return nt.scale(a,a,[i,i,1]),nt.multiply(n,a,n),nt.multiply(n,t.worldToFogMatrix,n),n}function Fy(e,t,n,i){const a=n.material,l=i.context,{baseColorTexture:u,metallicRoughnessTexture:d}=a.pbrMetallicRoughness,{normalTexture:f,occlusionTexture:p,emissionTexture:g}=a;function _(v,x,b){if(v&&(e.push(x),l.activeTexture.set(l.gl.TEXTURE0+b),v.gfxTexture)){const{minFilter:E,magFilter:T,wrapS:C,wrapT:D}=v.sampler;v.gfxTexture.bindExtraParam(E,T,C,D)}}_(u,"HAS_TEXTURE_u_baseColorTexture",ps.BaseColor),_(d,"HAS_TEXTURE_u_metallicRoughnessTexture",ps.MetallicRoughness),_(f,"HAS_TEXTURE_u_normalTexture",ps.Normal),_(p,"HAS_TEXTURE_u_occlusionTexture",ps.Occlusion),_(g,"HAS_TEXTURE_u_emissionTexture",ps.Emission),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),"OPAQUE"!==a.alphaMode&&"MASK"!==a.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function Ny(e,t,n,i,a,l){const u=n.paint.get("model-opacity"),d=t.context,f=new pe(t.context.gl.LEQUAL,pe.ReadWrite,t.depthRangeFor3D),p=t.transform,g=e.mesh,_=g.material,v=_.pbrMetallicRoughness,x=t.style.fog;let b;b="pixels"===t.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:nt.multiply([],i.zScaleMatrix,e.nodeModelMatrix),nt.multiply(b,i.negCameraPosMatrix,b);const E=nt.invert([],b);nt.transpose(E,E);const T=Z1(new Float32Array(e.worldViewProjection),new Float32Array(b),new Float32Array(E),t,u,v.baseColorFactor,_.emissiveFactor,v.metallicFactor,v.roughnessFactor,_,n),C={defines:[]},D=[];Fy(C.defines,D,g,t);const A=t.shadowRenderer;A&&(A.useNormalOffset=!1);let P=null;if(x){const k=nb(e.nodeModelMatrix,t.transform);if(P=new Float32Array(k),"globe"!==p.projection.name){const L=g.aabb.min,N=g.aabb.max,[z,j]=x.getOpacityForBounds(k,L[0],L[1],N[0],N[1]);C.overrideFog=z>=ru||j>=ru}}const I=tf(t,n.paint.get("model-cutoff-fade-range"));I.shouldRenderCutoff&&C.defines.push("RENDER_CUTOFF");const R=t.getOrCreateProgram("model",C);t.uploadCommonUniforms(d,R,null,P,I),"shadow"!==t.renderPass&&A&&A.setupShadowsFromMatrix(e.nodeModelMatrix,R),R.draw(t,d.gl.TRIANGLES,f,a,l,g.material.doubleSided?Fe.disabled:Fe.backCCW,T,n.id,g.vertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,void 0,D)}function rb(e,t,n,i,a,l,u){let d;d="globe"===e.projection.name?cy(n,e):[...n],nt.multiply(d,d,t.matrix);const f=nt.multiply([],i,d);if(t.meshes)for(const p of t.meshes){if("BLEND"!==p.material.alphaMode){u.push({mesh:p,depth:0,modelIndex:a,worldViewProjection:f,nodeModelMatrix:d});continue}const g=G.transformMat4([],p.centroid,f);g[2]>0&&l.push({mesh:p,depth:g[2],modelIndex:a,worldViewProjection:f,nodeModelMatrix:d})}if(t.children)for(const p of t.children)rb(e,p,n,i,a,l,u)}function zy(e,t,n,i){const a=n.shadowRenderer;if(!a)return;const l=a.getShadowPassDepthMode(),u=a.getShadowPassColorMode(),d=a.calculateShadowPassMatrixFromMatrix(t),f=Dm(d);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,l,Se.disabled,u,Fe.backCCW,f,i.id,e.vertexBuffer,e.indexBuffer,e.segments,i.paint,n.transform.zoom,void 0,void 0)}function DA(e,t,n){const i=t.updateZoomBasedPaintProperties(),a=function(l,u,d){let f,p,g,_=l.terrain?l.terrain.exaggeration():0;if(l.terrain&&_>0){const v=l.terrain,x=v.findDEMTileFor(d);x&&x.dem?f=Da.create(v,d,x):_=0}if(0===_&&(u.terrainElevationMin=0,u.terrainElevationMax=0),_===u.validForExaggeration&&(0===_||f&&f._demTile&&f._demTile.tileID===u.validForDEMTile.id&&f._dem._timestamp===u.validForDEMTile.timestamp))return!1;for(const v in u.instancesPerModel){const x=u.instancesPerModel[v];for(let b=0;b<x.instancedDataArray.length;++b){const E=(f?_*f.getElevationAt(0|x.instancedDataArray.float32[16*b],0|x.instancedDataArray.float32[16*b+1],!0,!0):0)+x.instancesEvaluatedElevation[b];x.instancedDataArray.float32[16*b+6]=E,p=p?Math.min(u.terrainElevationMin,E):E,g=g?Math.max(u.terrainElevationMax,E):E}}return u.terrainElevationMin=p||0,u.terrainElevationMax=g||0,u.validForExaggeration=_,u.validForDEMTile=f&&f._demTile?{id:f._demTile.tileID,timestamp:f._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,n);(i||a)&&(t.uploaded=!1,t.upload(e.context))}const za={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new $n([0,0,0],[lt,lt,0])};function SA(e,t){const n=1<<e.canonical.z,i=t.getFreeCameraOptions().position,a=t.elevation,l=e.canonical.x/n,u=(e.canonical.x+1)/n,d=e.canonical.y/n,f=(e.canonical.y+1)/n;let p=t._centerAltitude;if(a){const x=a.getMinMaxForTile(e);x&&x.max>p&&(p=x.max)}const g=Wt(i.x,l,u)-i.x,_=Wt(i.y,d,f)-i.y,v=xn(p,t.center.lat)-i.z;return t._zoomFromMercatorZ(Math.sqrt(g*g+_*_+v*v))}function Do(e,t,n,i,a,l,u){const d=e.context,f="shadow"===e.renderPass,p=e.shadowRenderer,g=f&&p?p.getShadowPassDepthMode():new pe(d.gl.LEQUAL,pe.ReadWrite,e.depthRangeFor3D),_=e.isTileAffectedByFog(l);if(n.meshes)for(const v of n.meshes){const x=["MODEL_POSITION_ON_GPU"],b=[];let E,T,C;i.instancedDataArray.length>20&&x.push("INSTANCED_ARRAYS");const D=tf(e,t.paint.get("model-cutoff-fade-range"));if(D.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),f&&p)E=e.getOrCreateProgram("modelDepth",{defines:x}),T=Dm(u.shadowTileMatrix,u.shadowTileMatrix,Float32Array.from(n.matrix)),C=p.getShadowPassColorMode();else{Fy(x,b,v,e),E=e.getOrCreateProgram("model",{defines:x,overrideFog:_});const P=v.material,I=P.pbrMetallicRoughness,R=t.paint.get("model-opacity");T=Z1(l.projMatrix,Float32Array.from(n.matrix),new Float32Array(16),e,R,I.baseColorFactor,P.emissiveFactor,I.metallicFactor,I.roughnessFactor,P,t,a),p&&(u.shadowUniformsInitialized?E.setShadowUniformValues(d,p.getShadowUniformValues()):(p.setupShadows(l.toUnwrapped(),E,"model-tile",l.overscaledZ),u.shadowUniformsInitialized=!0)),C=D.shouldRenderCutoff||R<1||"OPAQUE"!==P.alphaMode?Je.alphaBlended:Je.unblended}e.uploadCommonUniforms(d,E,l.toUnwrapped(),null,D);const A=v.material.doubleSided?Fe.disabled:Fe.backCCW;if(i.instancedDataArray.length>20)b.push(i.instancedDataBuffer),E.draw(e,d.gl.TRIANGLES,g,Se.disabled,C,A,T,t.id,v.vertexBuffer,v.indexBuffer,v.segments,t.paint,e.transform.zoom,void 0,b,i.instancedDataArray.length);else{const P=f?"u_instance":"u_normal_matrix";for(let I=0;I<i.instancedDataArray.length;++I)T[P]=new Float32Array(i.instancedDataArray.arrayBuffer,64*I,16),E.draw(e,d.gl.TRIANGLES,g,Se.disabled,C,A,T,t.id,v.vertexBuffer,v.indexBuffer,v.segments,t.paint,e.transform.zoom,void 0,b)}}if(n.children)for(const v of n.children)Do(e,t,v,i,a,l,u)}const af=[1,-1,1];function IA(e,t,n,i){if(!n.modelManager)return!0;const a=n.modelManager;if(!n.shadowRenderer)return!0;const l=n.shadowRenderer,u=t.aabb;let d=!0,f=e.maxHeight;if(0===f){let g=0;for(const _ in e.instancesPerModel){const v=a.getModel(_,i);v?g=Math.max(g,Math.max(Math.max(v.aabb.max[0],v.aabb.max[1]),v.aabb.max[2])):d=!1}f=e.maxScale*g*1.41+e.maxVerticalOffset,d&&(e.maxHeight=f)}u.max[2]=f,u.min[2]+=e.terrainElevationMin,u.max[2]+=e.terrainElevationMax,G.transformMat4(u.min,u.min,t.tileMatrix),G.transformMat4(u.max,u.max,t.tileMatrix);const p=u.intersects(l.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===p),0===p}class AA{}class DO{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,i){{const _=this._storage.get(n.id);if(_)return _.lastUsedFrameIdx=t,_.buf}const a=i.gl,l=a.getBufferParameter(a.ELEMENT_ARRAY_BUFFER,a.BUFFER_SIZE),u=new ArrayBuffer(l),d=new Int16Array(u);a.getBufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Int16Array(u));const f=new ba;for(let _=0;_<l/2;_+=3){const v=d[_],x=d[_+1],b=d[_+2];f.emplaceBack(v,x),f.emplaceBack(x,b),f.emplaceBack(b,v)}const p=i.bindVertexArrayOES.current,g=new AA;return g.buf=new ho(i,f),g.lastUsedFrameIdx=t,this._storage.set(n.id,g),i.bindVertexArrayOES.set(p),g.buf}update(t){for(const[n,i]of this._storage)t-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}const PA={symbol:function(e,t,n,i,a){if("translucent"!==e.renderPass)return;const l=Se.disabled,u=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(d,f,p,g,_,v,x){const b=f.transform,E="map"===_,T="map"===v;for(const C of d){const D=g.getTile(C),A=D.getBucket(p);if(!A||!A.text||!A.text.segments.get().length)continue;const P=tc(A.textSizeData,b.zoom),I=wy(C,A.getProjection(),b),R=b.calculatePixelsToTileUnitsMatrix(D),k=Hd(I,D.tileID.canonical,T,E,b,A.getProjection(),R),L=A.hasIconTextFit()&&A.hasIconData();if(P){const N=Math.pow(2,b.zoom-D.tileID.overscaledZ);xA(A,E,T,x,fO,b,k,C,N,P,L)}}}(i,e,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),a),0!==n.paint.get("icon-opacity").constantOr(1)&&NT(e,t,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),l,u),0!==n.paint.get("text-opacity").constantOr(1)&&NT(e,t,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),l,u),t.map.showCollisionBoxes&&(W1(e,t,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),W1(e,t,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,n,i){if("translucent"!==e.renderPass)return;const a=n.paint.get("circle-opacity"),l=n.paint.get("circle-stroke-width"),u=n.paint.get("circle-stroke-opacity"),d=void 0!==n.layout.get("circle-sort-key").constantOr(1),f=n.paint.get("circle-emissive-strength");if(0===a.constantOr(1)&&(0===l.constantOr(1)||0===u.constantOr(1)))return;const p=e.context,g=p.gl,_=e.transform,v=e.depthModeForSublayer(0,pe.ReadOnly),x=Se.disabled,b=e.colorModeForDrapableLayerRenderPass(f),E="globe"===_.projection.name,T=[Li(_.center.lng),Gi(_.center.lat)],C=[];for(let A=0;A<i.length;A++){const P=i[A],I=t.getTile(P),R=I.getBucket(n);if(!R||R.projection.name!==_.projection.name)continue;const k=R.programConfigurations.get(n.id),L=Tp(n),N=e.isTileAffectedByFog(P);E&&L.push("PROJECTION_GLOBE_VIEW");const z=e.getOrCreateProgram("circle",{config:k,defines:L,overrideFog:N}),j=R.layoutVertexBuffer,B=R.globeExtVertexBuffer,H=R.indexBuffer,V=_.projection.createInversionMatrix(_,P.canonical),Z={programConfiguration:k,program:z,layoutVertexBuffer:j,globeExtVertexBuffer:B,indexBuffer:H,uniformValues:rx(e,P,I,V,T,n),tile:I};if(d){const Q=R.segments.get();for(const et of Q)C.push({segments:new bn([et]),sortKey:et.sortKey,state:Z})}else C.push({segments:R.segments,sortKey:0,state:Z})}d&&C.sort((A,P)=>A.sortKey-P.sortKey);const D={useDepthForOcclusion:_.depthOcclusionForSymbolsAndCircles};for(const A of C){const{programConfiguration:P,program:I,layoutVertexBuffer:R,globeExtVertexBuffer:k,indexBuffer:L,uniformValues:N,tile:z}=A.state,j=A.segments;e.terrain&&e.terrain.setupElevationDraw(z,I,D),e.uploadCommonUniforms(p,I,z.tileID.toUnwrapped()),I.draw(e,g.TRIANGLES,v,x,b,Fe.disabled,N,n.id,R,L,j,n.paint,_.zoom,P,[k])}},heatmap:function(e,t,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const a=e.context,l=a.gl,u=Se.disabled,d=new Je([l.ONE,l.ONE,l.ONE,l.ONE],Ae.transparent,[!0,!0,!0,!0]);(function(x,b,E,T){const C=x.gl,D=b.width*T,A=b.height*T;x.activeTexture.set(C.TEXTURE1),x.viewport.set([0,0,D,A]);let P=E.heatmapFbo;if(!P||P&&(P.width!==D||P.height!==A)){P&&P.destroy();const I=C.createTexture();C.bindTexture(C.TEXTURE_2D,I),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR),P=E.heatmapFbo=x.createFramebuffer(D,A,!0,null),function(R,k,L,N,z,j){const B=R.gl;B.texImage2D(B.TEXTURE_2D,0,R.extRenderToTextureHalfFloat?B.RGBA16F:B.RGBA,z,j,0,B.RGBA,R.extRenderToTextureHalfFloat?B.HALF_FLOAT:B.UNSIGNED_BYTE,null),N.colorAttachment.set(L)}(x,0,I,P,D,A)}else C.bindTexture(C.TEXTURE_2D,P.colorAttachment.get()),x.bindFramebuffer.set(P.framebuffer)})(a,e,n,"globe"===e.transform.projection.name?.5:.25),a.clear({color:Ae.transparent});const f=e.transform,p="globe"===f.projection.name,g=p?["PROJECTION_GLOBE_VIEW"]:[],_=p?Fe.frontCCW:Fe.disabled,v=[Li(f.center.lng),Gi(f.center.lat)];for(let x=0;x<i.length;x++){const b=i[x];if(t.hasRenderableParent(b))continue;const E=t.getTile(b),T=E.getBucket(n);if(!T||T.projection.name!==f.projection.name)continue;const C=e.isTileAffectedByFog(b),D=T.programConfigurations.get(n.id),A=e.getOrCreateProgram("heatmap",{config:D,defines:g,overrideFog:C}),{zoom:P}=e.transform;e.terrain&&e.terrain.setupElevationDraw(E,A),e.uploadCommonUniforms(a,A,b.toUnwrapped());const I=f.projection.createInversionMatrix(f,b.canonical);A.draw(e,l.TRIANGLES,pe.disabled,u,d,_,mA(e,b,E,I,v,P,n.paint.get("heatmap-intensity")),n.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,n.paint,e.transform.zoom,D,p?[T.globeExtVertexBuffer]:null)}a.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(a,l){const u=a.context,d=u.gl,f=l.heatmapFbo;if(!f)return;u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.colorAttachment.get()),u.activeTexture.set(d.TEXTURE1);let p=l.colorRampTexture;p||(p=l.colorRampTexture=new kr(u,l.colorRamp,d.RGBA)),p.bind(d.LINEAR,d.CLAMP_TO_EDGE),a.getOrCreateProgram("heatmapTexture").draw(a,d.TRIANGLES,pe.disabled,Se.disabled,a.colorModeForRenderPass(),Fe.disabled,{u_image:0,u_color_ramp:1,u_opacity:l.paint.get("heatmap-opacity")},l.id,a.viewportBuffer,a.quadTriangleIndexBuffer,a.viewportSegments,l.paint,a.transform.zoom)}(e,n))},line:function(e,t,n,i){if("translucent"!==e.renderPass)return;const a=n.paint.get("line-opacity"),l=n.paint.get("line-width");if(0===a.constantOr(1)||0===l.constantOr(1))return;const u=n.paint.get("line-emissive-strength"),d=e.depthModeForSublayer(0,pe.ReadOnly),f=e.colorModeForDrapableLayerRenderPass(u),p=e.terrain&&e.terrain.renderingToTexture?1:Ft.devicePixelRatio,g=n.paint.get("line-dasharray"),_=g.constantOr(1),v=n.layout.get("line-cap"),x=n.paint.get("line-pattern"),b=x.constantOr(1),E=n.paint.get("line-pattern").constantOr(1),T=1!==n.paint.get("line-opacity").constantOr(1);let C=!E&&T;const D=n.paint.get("line-gradient"),A=b?"linePattern":"line",P=e.context,I=P.gl,R=h1(n);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(C=!1);for(const k of i){const L=t.getTile(k);if(b&&!L.patternsLoaded())continue;const N=L.getBucket(n);if(!N)continue;e.prepareDrawTile();const z=N.programConfigurations.get(n.id),j=e.isTileAffectedByFog(k),B=e.getOrCreateProgram(A,{config:z,defines:R,overrideFog:j}),H=x.constantOr(null);if(H&&L.imageAtlas){const ot=L.imageAtlas.patternPositions[H.toString()];ot&&z.setConstantPatternPositions(ot)}const V=g.constantOr(null),Z=v.constantOr(null);if(!b&&V&&Z&&L.lineAtlas){const ot=L.lineAtlas.getDash(V,Z);ot&&z.setConstantPatternPositions(ot)}let[Q,et]=n.paint.get("line-trim-offset");("round"===Z||"square"===Z)&&Q!==et&&(0===Q&&(Q-=1),1===et&&(et+=1));const W=e.terrain?k.projMatrix:null,X=b?c1(e,L,n,W,p):_I(e,L,n,W,N.lineClipsArray.length,p,[Q,et]);if(D){const ot=N.gradients[n.id];let ct=ot.texture;if(n.gradientVersion!==ot.version){let dt=256;if(n.stepInterpolant){const gt=t.getSource().maxzoom,at=k.canonical.z===gt?Math.ceil(1<<e.transform.maxZoom-k.canonical.z):1;dt=Wt(On(N.maxLineLength/lt*1024*at),256,P.maxTextureSize)}ot.gradient=ml({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:dt,image:ot.gradient||void 0,clips:N.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new kr(P,ot.gradient,I.RGBA),ot.version=n.gradientVersion,ct=ot.texture}P.activeTexture.set(I.TEXTURE1),ct.bind(n.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE)}_&&(P.activeTexture.set(I.TEXTURE0),L.lineAtlasTexture.bind(I.LINEAR,I.REPEAT),z.updatePaintBuffers()),b&&(P.activeTexture.set(I.TEXTURE0),L.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),z.updatePaintBuffers()),e.uploadCommonUniforms(P,B,k.toUnwrapped());const rt=ot=>{B.draw(e,I.TRIANGLES,d,ot,f,Fe.disabled,X,n.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,n.paint,e.transform.zoom,z,[N.layoutVertexBuffer2])};if(C){const ot=e.stencilModeForClipping(k).ref;0===ot&&e.terrain&&P.clear({stencil:0});const ct={func:I.EQUAL,mask:255};X.u_alpha_discard_threshold=.8,rt(new Se(ct,ot,255,I.KEEP,I.KEEP,I.INVERT)),X.u_alpha_discard_threshold=0,rt(new Se(ct,ot,255,I.KEEP,I.KEEP,I.KEEP))}else rt(e.stencilModeForClipping(k))}C&&(e.resetStencilClippingMasks(),e.terrain&&P.clear({stencil:0}))},fill:function(e,t,n,i){const a=n.paint.get("fill-color"),l=n.paint.get("fill-opacity");if(0===l.constantOr(1))return;const u=n.paint.get("fill-emissive-strength"),d=e.colorModeForDrapableLayerRenderPass(u),f=n.paint.get("fill-pattern"),p=e.opaquePassEnabledForLayer()&&!f.constantOr(1)&&1===a.constantOr(Ae.transparent).a&&1===l.constantOr(0)?"opaque":"translucent";if(e.renderPass===p){const g=e.depthModeForSublayer(1,"opaque"===e.renderPass?pe.ReadWrite:pe.ReadOnly);Y1(e,t,n,i,g,d,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const g=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,pe.ReadOnly);Y1(e,t,n,i,g,d,!0)}},"fill-extrusion":function(e,t,n,i){const a=n.paint.get("fill-extrusion-opacity"),l=e.context,u=l.gl,d=e.terrain,f=d&&d.renderingToTexture,p=n.paint.get("fill-extrusion-cutoff-fade-range");if(0===a)return;const g=e.conflationActive&&e.layerUsedInConflation(n,t.getSource());if(g&&function(_,v,x,b){for(const E of b){const T=v.getTile(E).getBucket(x);T&&(T.updateReplacement(E,_.replacementSource),T.uploadCentroid(_.context))}}(e,t,n,i),d||g)for(const _ of i){const v=t.getTile(_).getBucket(n);v&&bA(e.context,t,_,v,n,d,g)}if("shadow"===e.renderPass&&e.shadowRenderer){const _=e.shadowRenderer;if(d&&a<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof jl)return;const v=_.getShadowPassDepthMode(),x=_.getShadowPassColorMode();ms(e,t,n,i,v,Se.disabled,x,g)}else if("translucent"===e.renderPass){const _=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!f){const v=new pe(e.context.gl.LEQUAL,pe.ReadWrite,e.depthRangeFor3D);0===p&&1===a&&_?ms(e,t,n,i,v,Se.disabled,Je.unblended,g):(ms(e,t,n,i,v,Se.disabled,Je.disabled,g),ms(e,t,n,i,v,e.stencilModeFor3D(),e.colorModeForRenderPass(),g),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&_&&(!d&&"globe"!==e.transform.projection.name||f)){const v=n.paint.get("fill-extrusion-opacity"),x=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),b=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),E=n.paint.get("fill-extrusion-flood-light-intensity"),T=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),C=x>0&&b>0,D=E>0,A=(I,R,k)=>(1-k)*I+k*R,P=I=>{const R=e.depthModeForSublayer(1,pe.ReadOnly,u.LEQUAL,!0),k=n.paint.get(I?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),L=A(.1,3,k),N=e._showOverdrawInspector;if(!N){const z=new Se({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),j=new Je([u.ONE,u.ONE,u.ONE,u.ONE],Ae.transparent,[!1,!1,!1,!0],u.MIN);nf(e,t,n,i,R,z,j,Fe.disabled,I,"sdf",v,x,b,E,T,L,g,!1)}{const z=N?Se.disabled:new Se({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),j=N?e.colorModeForRenderPass():new Je([u.ONE_MINUS_DST_ALPHA,u.DST_ALPHA,u.ONE,u.ONE],Ae.transparent,[!0,!0,!0,!0]);nf(e,t,n,i,R,z,j,Fe.disabled,I,"color",v,x,b,E,T,L,g,!1)}};if(f){const I=(R,k,L)=>{const N=e.depthModeForSublayer(1,pe.ReadOnly,u.LEQUAL,!1),z=n.paint.get(R?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),j=A(.1,3,z);{const B=new Je([u.ONE,u.ONE,u.ONE,u.ONE],Ae.transparent,[!1,!1,!1,!0]);nf(e,t,n,i,N,Se.disabled,B,Fe.disabled,R,"clear",v,x,b,E,T,j,g,k)}{const B=new Se({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),H=new Je([u.ONE,u.ONE,u.ONE,u.ONE],Ae.transparent,[!1,!1,!1,!0],u.MIN);nf(e,t,n,i,N,B,H,Fe.disabled,R,"sdf",v,x,b,E,T,j,g,k)}{const B=R?u.ZERO:u.ONE_MINUS_DST_ALPHA,H=new Se({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),V=new Je([B,u.DST_ALPHA,u.ONE_MINUS_DST_ALPHA,u.ZERO],Ae.transparent,[!0,!0,!0,!0]);nf(e,t,n,i,N,H,V,Fe.disabled,R,"color",v,x,b,E,T,j,g,k)}{const B=new Je([u.ONE,u.ONE,u.ONE,R?u.ZERO:u.ONE],Ae.transparent,[!1,!1,!1,!0],R?u.FUNC_ADD:u.MAX);nf(e,t,n,i,N,Se.disabled,B,Fe.disabled,R,"clear",v,x,b,E,T,j,g,k,L)}};if(C||D){let R;if(e.prepareDrawTile(),d){const k=d.drapeBufferSize[0],L=d.drapeBufferSize[1];R=d.framebufferCopyTexture,R&&(!R||R.size[0]===k&&R.size[1]===L)||(R&&R.destroy(),R=d.framebufferCopyTexture=new kr(l,new ur({width:k,height:L}),u.RGBA)),R.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,k,L,0)}C&&I(!0,!1,R),D&&I(!1,!0,R)}}else C&&P(!0),D&&P(!1)}}},hillshade:function(e,t,n,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const a=e.context,l=e.terrain&&e.terrain.renderingToTexture,[u,d]="translucent"!==e.renderPass||l?[{},i]:e.stencilConfigForOverlap(i);for(const f of d){const p=t.getTile(f);if(p.needsHillshadePrepare&&"offscreen"===e.renderPass)iA(e,p,n);else if("translucent"===e.renderPass){const g=e.depthModeForSublayer(0,pe.ReadOnly),_=n.paint.get("hillshade-emissive-strength"),v=e.colorModeForDrapableLayerRenderPass(_),x=l&&e.terrain?e.terrain.stencilModeForRTTOverlap(f):u[f.overscaledZ];rA(e,f,p,n,g,x,v)}}a.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,n,i,a,l){if("translucent"!==e.renderPass||0===n.paint.get("raster-opacity"))return;const u=e.context,d=u.gl,f=t.getSource(),p=function(A,P,I){const R=[];let k,L;if(A.paint.get("raster-color")){R.push("RASTER_COLOR"),k=A.paint.get("raster-color-mix"),L=A.paint.get("raster-color-range"),P.activeTexture.set(I.TEXTURE2);let N=A.colorRampTexture;N||(N=A.colorRampTexture=new kr(P,A.colorRamp,I.RGBA)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE)}return{mix:k,range:L,defines:R}}(n,u,d),g=p.defines;let _=!1;if(f instanceof bl&&!i.length){if("globe"!==e.transform.projection.name)return;if(f.onNorthPole)_=!0,g.push("PROJECTION_GLOBE_VIEW");else{if(!f.onSouthPole)return;_=!0,g.push("PROJECTION_GLOBE_VIEW")}}const v=e.colorModeForDrapableLayerRenderPass(),x=e.terrain&&e.terrain.renderingToTexture,b=!e.options.moving,E="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;if(_){const A=t.getSource();if(!(A instanceof bl))return;const P=A.texture;if(!P)return;const I=e.globeSharedBuffers;if(!I)return;const R=new pe(d.LEQUAL,pe.ReadWrite,e.depthRangeFor3D),k=Float32Array.from(e.transform.projMatrix);let L=oS(0,0,e.transform);const N=Float32Array.from(as(uo(new Qs(0,0,0)))),z={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),P.bind(E,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),P.bind(E,d.CLAMP_TO_EDGE),P.useMipmap&&u.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const[j,B,H,V]=I.getPoleBuffers(0,!0);let Z;A.onNorthPole?(Z=j,e.renderDefaultNorthPole=!1):(L=nt.scale(nt.create(),L,[1,-1,1]),Z=B,e.renderDefaultSouthPole=!1);const Q=RT(k,N,L,[0,0],1,z,n,A.perspectiveTransform||[0,0],2,p.mix||[0,0,0,0],p.range||[0,0]),et=e.getOrCreateProgram("raster",{defines:p.defines});return e.uploadCommonUniforms(u,et,null),void et.draw(e,d.TRIANGLES,R,Se.disabled,v,Fe.disabled,Q,n.id,Z,H,V)}if(!i.length)return;const[T,C]=f instanceof bl||x?[{},i]:e.stencilConfigForOverlap(i),D=C[C.length-1].overscaledZ;for(const A of C){const P=x?pe.disabled:e.depthModeForSublayer(A.overscaledZ-D,1===n.paint.get("raster-opacity")?pe.ReadWrite:pe.ReadOnly,d.LESS),I=A.toUnwrapped(),R=t.getTile(A);if(x&&(!R||!R.hasData())||!R.texture)continue;const k=x?A.projMatrix:e.transform.calculateProjMatrix(I,b),L=e.terrain&&x?e.terrain.stencilModeForRTTOverlap(A):T[A.overscaledZ],N=l?0:n.paint.get("raster-fade-duration");R.registerFadeDuration(N);const z=t.findLoadedParent(A,0),j=MT(R,z,t,e.transform,N);let B,H;e.terrain&&e.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),R.texture.bind(E,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),z?(z.texture.bind(E,d.CLAMP_TO_EDGE),B=Math.pow(2,z.tileID.overscaledZ-R.tileID.overscaledZ),H=[R.tileID.canonical.x*B%1,R.tileID.canonical.y*B%1]):R.texture.bind(E,d.CLAMP_TO_EDGE),R.texture.useMipmap&&u.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const V=f instanceof bl?f.perspectiveTransform:[0,0],Z=new Float32Array(16),Q=RT(k,Z,Z,H||[0,0],B||1,j,n,V,2,p.mix||[0,0,0,0],p.range||[0,0]),et=e.isTileAffectedByFog(A),W=e.getOrCreateProgram("raster",{defines:p.defines,overrideFog:et});if(e.uploadCommonUniforms(u,W,I),f instanceof bl)f.boundsBuffer&&f.boundsSegments&&W.draw(e,d.TRIANGLES,P,Se.disabled,v,Fe.disabled,Q,n.id,f.boundsBuffer,e.quadTriangleIndexBuffer,f.boundsSegments);else{const{tileBoundsBuffer:X,tileBoundsIndexBuffer:rt,tileBoundsSegments:ot}=e.getTileBoundsBuffers(R);W.draw(e,d.TRIANGLES,P,L,v,Fe.disabled,Q,n.id,X,rt,ot)}}e.resetStencilClippingMasks()},background:function(e,t,n,i){const a=n.paint.get("background-color"),l=n.paint.get("background-opacity"),u=n.paint.get("background-emissive-strength");if(0===l)return;const d=e.context,f=d.gl,p=e.transform,g=p.tileSize,_=n.paint.get("background-pattern");if(e.isPatternMissing(_,n.scope))return;const v=!_&&1===a.a&&1===l&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==v)return;const x=Se.disabled,b=e.depthModeForSublayer(0,"opaque"===v?pe.ReadWrite:pe.ReadOnly),E=e.colorModeForDrapableLayerRenderPass(u),T=_?"backgroundPattern":"background";let C,D=i;D||(C=e.getBackgroundTiles(),D=Object.values(C).map(A=>A.tileID)),_&&(d.activeTexture.set(f.TEXTURE0),e.imageManager.bind(e.context,n.scope));for(const A of D){const P=e.isTileAffectedByFog(A),I=e.getOrCreateProgram(T,{overrideFog:P}),R=A.toUnwrapped(),k=i?A.projMatrix:e.transform.calculateProjMatrix(R);e.prepareDrawTile();const L=t?t.getTile(A):C?C[A.key]:new ds(A,g,p.zoom,e),N=_?hc(k,u,l,e,_,n.scope,{tileID:A,tileSize:g}):TO(k,u,l,a);e.uploadCommonUniforms(d,I,R);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:j,tileBoundsSegments:B}=e.getTileBoundsBuffers(L);I.draw(e,f.TRIANGLES,b,x,E,Fe.disabled,N,n.id,z,j,B)}},sky:function(e,t,n){const i=e._atmosphere?ki(e.transform.zoom):1,a=n.paint.get("sky-opacity")*i;if(0===a)return;const l=e.context,u=n.paint.get("sky-type"),d=new pe(l.gl.LEQUAL,pe.ReadOnly,[0,1]),f=e.frameCounter/1e3%1;"atmosphere"===u?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(p,g,_,v){const x=p.context,b=x.gl;let E=g.skyboxFbo;if(!E){E=g.skyboxFbo=x.createFramebuffer(32,32,!0,null),g.skyboxGeometry=new $T(x),g.skyboxTexture=x.gl.createTexture(),b.bindTexture(b.TEXTURE_CUBE_MAP,g.skyboxTexture),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR);for(let A=0;A<6;++A)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+A,0,b.RGBA,32,32,0,b.RGBA,b.UNSIGNED_BYTE,null)}x.bindFramebuffer.set(E.framebuffer),x.viewport.set([0,0,32,32]);const T=g.getCenter(p,!0),C=p.getOrCreateProgram("skyboxCapture"),D=new Float64Array(16);nt.identity(D),nt.rotateY(D,D,.5*-Math.PI),sf(p,g,C,D,T,0),nt.identity(D),nt.rotateY(D,D,.5*Math.PI),sf(p,g,C,D,T,1),nt.identity(D),nt.rotateX(D,D,.5*-Math.PI),sf(p,g,C,D,T,2),nt.identity(D),nt.rotateX(D,D,.5*Math.PI),sf(p,g,C,D,T,3),nt.identity(D),sf(p,g,C,D,T,4),nt.identity(D),nt.rotateY(D,D,Math.PI),sf(p,g,C,D,T,5),x.viewport.set([0,0,p.width,p.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(p,g,_,v,x){const b=p.context,E=b.gl,T=p.transform,C=p.getOrCreateProgram("skybox");b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_CUBE_MAP,g.skyboxTexture);const D={u_matrix:T.skyboxMatrix,u_sun_direction:g.getCenter(p,!1),u_cubemap:0,u_opacity:v,u_temporal_offset:x};p.uploadCommonUniforms(b,C),C.draw(p,E.TRIANGLES,_,Se.disabled,p.colorModeForRenderPass(),Fe.backCW,D,"skybox",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(e,n,d,a,f):"gradient"===u&&"sky"===e.renderPass&&function(p,g,_,v,x){const b=p.context,E=b.gl,T=p.transform,C=p.getOrCreateProgram("skyboxGradient");g.skyboxGeometry||(g.skyboxGeometry=new $T(b)),b.activeTexture.set(E.TEXTURE0);let D=g.colorRampTexture;D||(D=g.colorRampTexture=new kr(b,g.colorRamp,E.RGBA)),D.bind(E.LINEAR,E.CLAMP_TO_EDGE);const A=(k=v,L=x,{u_matrix:T.skyboxMatrix,u_color_ramp:0,u_center_direction:g.getCenter(p,!1),u_radius:Ee(g.paint.get("sky-gradient-radius")),u_opacity:k,u_temporal_offset:L});var k,L;p.uploadCommonUniforms(b,C),C.draw(p,E.TRIANGLES,_,Se.disabled,p.colorModeForRenderPass(),Fe.backCW,A,"skyboxGradient",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(e,n,d,a,f)},debug:function(e,t,n){for(let i=0;i<n.length;i++)K1(e,t,n[i])},custom:function(e,t,n,i){const a=e.context,l=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&n.isLayerDraped(t)){if("offscreen"===e.renderPass){const u=l.prerender;if(u){if(e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const d=e.transform.pointMerc;u.call(l,a.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),ki(e.transform.zoom),[d.x,d.y],e.transform.pixelsPerMeterRatio)}else u.call(l,a.gl,e.transform.customLayerMatrix());a.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const d=l.renderToTile;if(d){const f=i[0].canonical,p=new Ge(f.x+i[0].wrap*(1<<f.z),f.y,f.z);a.setDepthMode(pe.disabled),a.setStencilMode(Se.disabled),a.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),d.call(l,a.gl,p),a.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),a.setStencilMode(Se.disabled);const u="3d"===l.renderingMode?new pe(e.context.gl.LEQUAL,pe.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,pe.ReadOnly);if(a.setDepthMode(u),"globe"===e.transform.projection.name){const d=e.transform.pointMerc;l.render(a.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),ki(e.transform.zoom),[d.x,d.y],e.transform.pixelsPerMeterRatio)}else l.render(a.gl,e.transform.customLayerMatrix());a.setDirty(),e.setBaseState(),a.bindFramebuffer.set(null)}}else K("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,n,i){if("opaque"===e.renderPass)return;const a=n.paint.get("model-opacity");if(0===a)return;const l=n.paint.get("model-cast-shadows");if("shadow"===e.renderPass&&(!l||e.terrain&&a<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof jl))return;const u=e.shadowRenderer,d=n.paint.get("model-receive-shadows");u&&(u.useNormalOffset=!0,d||(u.enabled=!1));const f=()=>{u&&(u.useNormalOffset=!0,d||(u.enabled=!0))},p=t.getSource();if("light-beam"===e.renderPass&&"batched-model"!==p.type)return;if("vector"===p.type||"geojson"===p.type)return function(C,D,A,P){const I=C.transform;if("mercator"!==I.projection.name)return void K(`Drawing 3D models for ${I.projection.name} projection is not yet implemented`);const R=I.getFreeCameraOptions().position;if(!C.modelManager)return;const k=C.modelManager,L=C.shadowRenderer;if(!A._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const N=A._unevaluatedLayout._values["model-id"],z={...A.layout.get("model-id").parameters};for(const j of P){const B=D.getTile(j).getBucket(A);if(!B||B.projection.name!==I.projection.name)continue;const H=SA(j,I);z.zoom=H;const V=N.possiblyEvaluate(z);if(DA(C,B,j),za.shadowUniformsInitialized=!1,za.useSingleShadowCascade=!!L&&0===L.getMaxCascadeForTile(j.toUnwrapped()),"shadow"===C.renderPass&&L){if(1===C.currentShadowCascade&&B.isInsideFirstShadowMapFrustum)continue;const et=I.calculatePosMatrix(j.toUnwrapped(),I.worldSize);if(za.tileMatrix.set(et),za.shadowTileMatrix=Float32Array.from(L.calculateShadowPassMatrixFromMatrix(et)),za.aabb.min.fill(0),za.aabb.max[0]=za.aabb.max[1]=lt,za.aabb.max[2]=0,IA(B,za,C,A.scope))continue}const Z=1<<j.canonical.z,Q=[((R.x-j.wrap)*Z-j.canonical.x)*lt,(R.y*Z-j.canonical.y)*lt,R.z*Z*lt];for(let et in B.instancesPerModel){const W=B.instancesPerModel[et];W.features.length>0&&(et=V.evaluate(W.features[0].feature,{}));const X=k.getModel(et,A.scope);if(X&&X.uploaded)for(const rt of X.nodes)Do(C,A,rt,W,Q,j,za)}}}(e,t,n,i),void f();if(!p.loaded())return;if("batched-model"===p.type)return function(C,D,A,P){const I=C.context,R=C.transform,k=C.style.fog,L=C.shadowRenderer;if("mercator"!==R.projection.name)return void K(`Drawing 3D landmark models for ${R.projection.name} projection is not yet implemented`);const N=C.transform.getFreeCameraOptions().position,z=G.scale([],[N.x,N.y,N.z],C.transform.worldSize);G.negate(z,z);const j=nt.identity([]),B=Ca(R.center.lat,R.zoom),H=nt.fromScaling([],[1,1,1/B]);nt.translate(j,j,z);const V=A.paint.get("model-opacity"),Z=new pe(I.gl.LEQUAL,pe.ReadWrite,C.depthRangeFor3D),Q=new pe(I.gl.LEQUAL,pe.ReadOnly,C.depthRangeFor3D),et=function(W,X){for(const rt of P){const ot=D.getTile(rt).getBucket(A);if(!ot||!ot.uploaded)continue;let ct=!1;L&&(ct=0===L.getMaxCascadeForTile(rt.toUnwrapped()));const dt=R.calculatePosMatrix(rt.toUnwrapped(),R.worldSize),gt=ot.modelTraits;for(const at of ot.getNodesInfo()){if(at.hiddenByReplacement||!at.node.meshes)continue;const ut=at.node,St="light-beam"===C.renderPass,Nt=[...dt],zt=at.evaluatedScale;let Vt=0;C.terrain&&ut.elevation&&(Vt=ut.elevation*C.terrain.exaggeration()),nt.translate(Nt,Nt,[(ut.anchor?ut.anchor[0]:0)*(zt[0]-1),(ut.anchor?ut.anchor[1]:0)*(zt[1]-1),Vt]),zt!==mC&&nt.scale(Nt,Nt,zt),nt.multiply(Nt,Nt,ut.matrix);const Kt=nt.multiply([],H,Nt);nt.multiply(Kt,j,Kt);const he=nt.invert([],Kt);nt.transpose(he,he),nt.scale(he,he,af);const Oe=nt.multiply([],R.projMatrix,Nt);for(let Xe=0;Xe<ut.meshes.length;++Xe){const Ce=ut.meshes[Xe],xe=Xe===ut.lightMeshIndex;if(xe){if(!St&&!C.terrain&&C.shadowRenderer){C.currentLayer<C.firstLightBeamLayer&&(C.firstLightBeamLayer=C.currentLayer);continue}}else if(St)continue;const ce={defines:[]},ie=[];Fy(ce.defines,ie,Ce,C),4&gt||ce.defines.push("DIFFUSE_SHADED"),ct&&ce.defines.push("SHADOWS_SINGLE_CASCADE");const Ne="shadow"===C.renderPass;if(Ne){zy(Ce,Nt,C,A);continue}let Ke=null;if(k){const kn=nb(Nt,C.transform);if(Ke=new Float32Array(kn),"globe"!==R.projection.name){const Vr=Ce.aabb.min,Kn=Ce.aabb.max,[qn,Cn]=k.getOpacityForBounds(kn,Vr[0],Vr[1],Kn[0],Kn[1]);ce.overrideFog=qn>=ru||Cn>=ru}}const Re=C.getOrCreateProgram("model",ce);!Ne&&L&&(L.useNormalOffset=!!Ce.normalBuffer,L.setupShadowsFromMatrix(Nt,Re,L.useNormalOffset)),C.uploadCommonUniforms(I,Re,rt.toUnwrapped(),Ke);const Sn=Ce.material,or=Sn.pbrMetallicRoughness;or.metallicFactor=.9,or.roughnessFactor=.5;const Gn=Z1(new Float32Array(Oe),new Float32Array(Kt),new Float32Array(he),C,V,or.baseColorFactor,Sn.emissiveFactor,or.metallicFactor,or.roughnessFactor,Sn,A);Re.draw(C,I.gl.TRIANGLES,X&&!xe?Z:Q,Se.disabled,W?xe||V<1||at.hasTranslucentParts?Je.alphaBlended:Je.unblended:Je.disabled,Fe.backCCW,Gn,A.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.segments,A.paint,C.transform.zoom,void 0,ie)}}}};(function(W,X,rt,ot){const ct=W.terrain?W.terrain.exaggeration():0,dt=W.transform.zoom;for(const gt of ot){const at=X.getTile(gt).getBucket(rt);at&&(W.conflationActive&&at.updateReplacement(gt,W.replacementSource),at.evaluateScale(W,rt),W.terrain&&ct>0&&at.elevationUpdate(W.terrain,ct,gt,rt.source),at.needsReEvaluation(W,dt,rt)&&at.evaluate(rt))}})(C,D,A,P),1===V?et(!0,!0):(et(!1,!0),et(!0,!1))}(e,t,n,i),void f();const g=p.getModels(),_=[],v=e.transform.getFreeCameraOptions().position,x=G.scale([],[v.x,v.y,v.z],e.transform.worldSize);G.negate(x,x);const b=[],E=[];let T=0;for(const C of g){const D=n.paint.get("model-rotation").constantOr(null),A=n.paint.get("model-scale").constantOr(null),P=n.paint.get("model-translation").constantOr(null);C.computeModelMatrix(e,D,A,P,!0,!0,!1);const I=nt.identity([]),R=Ca(C.position.lat,e.transform.zoom),k=nt.fromScaling([],[1,1,1/R]);nt.translate(I,I,x),_.push({zScaleMatrix:k,negCameraPosMatrix:I});for(const L of C.nodes)rb(e.transform,L,C.matrix,e.transform.projMatrix,T,b,E);T++}if(b.sort((C,D)=>D.depth-C.depth),"shadow"!==e.renderPass){if(1===a)for(const C of E)Ny(C,e,n,_[C.modelIndex],Se.disabled,e.colorModeForRenderPass());else{for(const C of E)Ny(C,e,n,_[C.modelIndex],Se.disabled,Je.disabled);for(const C of E)Ny(C,e,n,_[C.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const C of b)Ny(C,e,n,_[C.modelIndex],Se.disabled,e.colorModeForRenderPass());f()}else{for(const C of E)zy(C.mesh,C.nodeModelMatrix,e,n);for(const C of b)zy(C.mesh,C.nodeModelMatrix,e,n);f()}}},ib={modelUpload:function(e,t,n){const i=t.getSource();if(!i.loaded())return;if("vector"===i.type||"geojson"===i.type)return void(e.modelManager&&e.modelManager.upload(e,n));if("batched-model"===i.type)return;const a=i.getModels();for(const l of a)l.upload(e.context)}};class ob{constructor(t,n){this.context=new oy(t),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=fs.maxUnderzooming+fs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new dI,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Im(this),this._wireframeDebugCache=new DO,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,n){const i=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cA(this,t));const a=this._terrain;this.transform.elevation=i?a:null,a.update(t,this.transform,n),this.transform.elevation&&!a.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||"globe"===this.transform.projection.name||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,a]=n.getFovAdjustedRange(this.transform._fov);if(i>a)return void(this.transform.fogCullDistSq=null);const l=i+.78*(a-i);this.transform.fogCullDistSq=l*l}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*Ft.devicePixelRatio,this.height=n*Ft.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const i of this.style.order)this.style._mergedLayers[i].resize()}setup(){const t=this.context,n=new wo;n.emplaceBack(0,0),n.emplaceBack(lt,0),n.emplaceBack(0,lt),n.emplaceBack(lt,lt),this.tileExtentBuffer=t.createVertexBuffer(n,Gl.members),this.tileExtentSegments=bn.simpleSegment(0,0,4,2);const i=new wo;i.emplaceBack(0,0),i.emplaceBack(lt,0),i.emplaceBack(0,lt),i.emplaceBack(lt,lt),this.debugBuffer=t.createVertexBuffer(i,Gl.members),this.debugSegments=bn.simpleSegment(0,0,4,5);const a=new wo;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(-1,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,Gl.members),this.viewportSegments=bn.simpleSegment(0,0,4,2);const l=new Ru;l.emplaceBack(0,0,0,0),l.emplaceBack(lt,0,lt,0),l.emplaceBack(0,lt,0,lt),l.emplaceBack(lt,lt,lt,lt),this.mercatorBoundsBuffer=t.createVertexBuffer(l,Jp.members),this.mercatorBoundsSegments=bn.simpleSegment(0,0,4,2);const u=new Rr;u.emplaceBack(0,1,2),u.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(u);const d=new qg;for(const p of[0,1,3,2,0])d.emplaceBack(p);this.debugIndexBuffer=t.createIndexBuffer(d),this.emptyTexture=new kr(t,new ur({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=nt.create();const f=this.context.gl;this.stencilClearMode=new Se({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO),this.loadTimeStamps.push(it.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,pe.disabled,this.stencilClearMode,Je.disabled,Fe.disabled,H1(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,i){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let d=!1;for(const f of i)if(void 0===this._tileClippingMaskIDs[f.key]){d=!0;break}if(!d)return}this.currentStencilSource=n.id;const a=this.context,l=a.gl;this.nextStencilID+i.length>256&&this.clearStencil(),a.setColorMode(Je.disabled),a.setDepthMode(pe.disabled);const u=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const d of i){const f=n.getTile(d),p=this._tileClippingMaskIDs[d.key]=this.nextStencilID++,{tileBoundsBuffer:g,tileBoundsIndexBuffer:_,tileBoundsSegments:v}=this.getTileBoundsBuffers(f);u.draw(this,l.TRIANGLES,pe.disabled,new Se({func:l.ALWAYS,mask:0},p,255,l.KEEP,l.KEEP,l.REPLACE),Je.disabled,Fe.disabled,H1(d.projMatrix),"$clipping",g,_,v)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Se({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new Se({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,i=t.sort((u,d)=>d.overscaledZ-u.overscaledZ),a=i[i.length-1].overscaledZ,l=i[0].overscaledZ-a+1;if(l>1){this.currentStencilSource=void 0,this.nextStencilID+l>256&&this.clearStencil();const u={};for(let d=0;d<l;d++)u[d+a]=new Se({func:n.GEQUAL,mask:255},d+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=l,[u,i]}return[{[a]:Se.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Je([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new Ae(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Je.unblended:Je.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Je([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new Ae(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,i,a=!1){if(!this.opaquePassEnabledForLayer()&&!a)return pe.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new pe(i||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=n;const i=this.style._mergedLayers,a=this.style.order,l=a.map(I=>i[I]),u=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(Ft.now()),this.imageManager.beginFrame();let d=0,f=!1;for(const I in u){const R=u[I];R.used&&(R.prepare(this.context),R.getSource().usedInConflation&&++d)}const p={},g={},_={},v={},x={};for(const I in u){const R=u[I];p[I]=R.getVisibleCoordinates(),g[I]=p[I].slice().reverse(),_[I]=R.getVisibleCoordinates(!0).reverse(),v[I]=R.getShadowCasterCoordinates(),x[I]=R.sortCoordinatesByDistance(p[I])}const b=I=>{const R=this.style.getLayerSourceCache(I);return R&&R.used?R.getSource():null};if(d){const I=[];for(const R of l)this.layerUsedInConflation(R,b(R))&&I.push(R);if(I&&I.length>1){const R=[];for(const k of I){const L=this.style.getLayerSourceCache(k);L&&L.used&&L.getSource().usedInConflation&&R.push({layer:k.fqid,cache:L})}this.replacementSource.setSources(R),f=!0}}f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const I of l){const R=I.cutoffRange();if(this.longestCutoffRange=Math.max(R,this.longestCutoffRange),R>0){const k=b(I);k&&(this.minCutoffZoom=Math.max(k.minzoom,this.minCutoffZoom)),I.minzoom&&(this.minCutoffZoom=Math.max(I.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let I=0;I<l.length;I++)if(l[I].is3D()){this.opaquePassCutoff=I;break}const E=this.style&&this.style.fog;E?(this._fogVisible=0!==E.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=E.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_),this.opaquePassCutoff=0);const T=this._shadowRenderer;if(T){T.updateShadowParameters(this.transform,this.style.directionalLight);for(const I in u)for(const R of p[I]){let k={min:0,max:0};this.terrain&&(k=this.terrain.getMinMaxForTile(R)||k),T.addShadowReceiver(R.toUnwrapped(),k.min,k.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new ZE(this.context));for(const I of l){if(I.isHidden(this.transform.zoom))continue;const R=t.getLayerSourceCache(I);this.uploadLayer(this,I,R)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new TA),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Sc.has(this.context.gl))return;this.renderPass="offscreen";for(const I of l){const R=t.getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const k=R?g[R.id]:void 0;("custom"===I.type||"raster"===I.type||I.isSky()||k&&k.length)&&this.renderLayer(this,R,I,k)}this.depthRangeFor3D=[0,1-(l.length+2)*this.numSublayers*this.depthEpsilon];const C=this.terrain;C&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&C.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const D="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),A=(()=>{if(n.showOverdrawInspector)return Ae.black;if(this.style.fog&&this.transform.projection.supportsFog&&!D){const I=this.style.fog.properties.get("color").toArray01();return new Ae(...I)}if(this.style.fog&&this.transform.projection.supportsFog&&D){const I=this.style.fog.properties.get("space-color").toArray01();return new Ae(...I)}return Ae.transparent})();if(this.context.clear({color:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&D&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const I=l[this.currentLayer],R=t.getLayerSourceCache(I);if(I.isSky())continue;const k=R?(I.is3D()?x:g)[R.id]:void 0;this._renderTileClippingMasks(I,R,k),this.renderLayer(this,R,I,k)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&D&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||ki(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const I=l[this.currentLayer],R=t.getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,R,I,R?g[R.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let P=0;for(T&&(P=T.getShadowCastingLayerCount());this.currentLayer<a.length;){const I=l[this.currentLayer],R=t.getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(C&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=C.renderBatch(this.currentLayer);continue}let k;if(R&&(k=("symbol"===I.type?_:I.is3D()?x:g)[R.id]),this._renderTileClippingMasks(I,R,R?p[R.id]:void 0),this.renderLayer(this,R,I,k),!C&&T&&P>0&&I.hasShadowPass()&&0==--P&&(T.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const L=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=L;this.currentLayer++){const N=l[this.currentLayer];if(!N.hasLightBeamPass())continue;const z=t.getLayerSourceCache(N);this.renderLayer(this,z,N,z?g[z.id]:void 0)}this.currentLayer=L,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;l.forEach(R=>{const k=t.getLayerSourceCache(R);k&&!R.isHidden(this.transform.zoom)&&k.getVisibleCoordinates().length&&(!I||I.getSource().maxzoom<k.getSource().maxzoom)&&(I=k)}),I&&this.options.showTileBoundaries&&PA.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const R=I.transform.padding;Ly(I,I.transform.height-(R.top||0),3,wA),Ly(I,R.bottom||0,3,jT),Q1(I,R.left||0,3,UT),Q1(I,I.transform.width-(R.right||0),3,EA);const k=I.transform.centerPoint;var L,N,z,j;rf(L=I,(N=k.x)-1,(z=I.transform.height-k.y)-10,2,20,j=MA),rf(L,N-10,z-1,20,2,j)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(it.performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}uploadLayer(t,n,i){this.gpuTimingStart(n),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(n.type)||t.terrain&&"custom"===n.type)&&ib[`${n.type}Upload`]&&ib[`${n.type}Upload`](t,i,n.scope),this.gpuTimingEnd()}renderLayer(t,n,i,a){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||a&&a.length)&&(this.id=i.id,this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&"custom"===i.type)&&PA[i.type](t,n,i,a,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,i=this.context.gl;let a=this.gpuTimers[t.id];a||(a=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:i.createQuery()}),a.calls++,i.beginQuery(n.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,i=n.createQuery();this.deferredRenderGpuTimeQueries.push(i),n.beginQuery(t.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const i in t){const a=t[i],l=this.context.extTimerQuery,u=l.getQueryParameter(a.query,this.context.gl.QUERY_RESULT)/1e6;l.deleteQueryEXT(a.query),n[i]=u}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.extTimerQuery,i=this.context.gl;let a=0;for(const l of t)a+=n.getQueryParameter(l,i.QUERY_RESULT)/1e6,n.deleteQueryEXT(l);return a}translatePosMatrix(t,n,i,a,l){if(!i[0]&&!i[1])return t;const u=l?"map"===a?this.transform.angle:0:"viewport"===a?-this.transform.angle:0;if(u){const p=Math.sin(u),g=Math.cos(u);i=[i[0]*g-i[1]*p,i[0]*p+i[1]*g]}const d=[l?i[0]:eh(n,i[0],this.transform.zoom),l?i[1]:eh(n,i[1],this.transform.zoom),0],f=new Float32Array(16);return nt.translate(f,t,d),f}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t,n){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString(),n)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,n,i){const a=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,l=this.terrain&&0===this.terrain.exaggeration(),u=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(u.push("LIGHTING_3D_MODE"),u.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):a||u.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||u.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?u.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):u.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(u.push("TERRAIN"),this.terrainUseFloatDEM()&&u.push("TERRAIN_DEM_FLOAT_FORMAT"),l&&u.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&u.push("GLOBE"),!this._fogVisible||a||void 0!==n&&!n||u.push("FOG","FOG_DITHERING"),a&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}getOrCreateProgram(t,n){this.cache=this.cache||{};const i=n&&n.defines||[],a=n&&n.config,l=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(i),u=ef.cacheKey(j1[t],t,l,a);return this.cache[u]||(this.cache[u]=new ef(this.context,t,j1[t],a,LT[t],l)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=it.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new kr(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const i=this.style.directionalLight,a=this.style.ambientLight;if(i&&a){const l=((u,d)=>{const f=u.properties.get("direction"),p=u.properties.get("color").toArray01(),g=u.properties.get("intensity"),_=d.properties.get("color").toArray01(),v=d.properties.get("intensity"),x=[f.x,f.y,f.z],b=yr(_,v),E=yr(p,g);return{u_lighting_ambient_color:b,u_lighting_directional_dir:x,u_lighting_directional_color:E,u_ground_radiance:uA(x,E,b)}})(i,a);n.setLightsUniformValues(t,l)}}}uploadCommonUniforms(t,n,i,a,l){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const u=this.style.fog;if(u){const d=u.getOpacity(this.transform.pitch),f=((p,g,_,v,x,b,E,T,C,D,A,P)=>{const I=p.transform,R=g.properties.get("color").toArray01();R[3]=v;const k=p.frameCounter/1e3%1,[L,N]=g.properties.get("vertical-range");return{u_fog_matrix:_?I.calculateFogTileMatrix(_):P||p.identityMat,u_fog_range:g.getFovAdjustedRange(I._fov),u_fog_color:R,u_fog_horizon_blend:g.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(L,N),N],u_fog_temporal_offset:k,u_frustum_tl:x,u_frustum_tr:b,u_frustum_br:E,u_frustum_bl:T,u_globe_pos:C,u_globe_radius:D,u_viewport:A,u_globe_transition:ki(I.zoom),u_is_globe:+("globe"===I.projection.name)}})(this,u,i,d,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*Ft.devicePixelRatio,this.transform.height*Ft.devicePixelRatio],a);n.setFogUniformValues(t,f)}l&&n.setCutoffUniformValues(t,l.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const a of i)n[a.key]=t[a.key]||new ds(a,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,n){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||"building"!==t.sourceLayer&&(!n||"batched-model"!==n.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=ru||n[1]>=ru}}const lf=2048;class SO{constructor(t,n){this.aabb=t,this.lastCascade=n}}class IO{add(t,n){const i=this.receivers[t.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],n.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],n.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],n.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],n.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],n.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],n.max[2])):this.receivers[t.key]=new SO(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,i){const a=$n.fromPoints(t.points);let l=0;for(const u in this.receivers){const d=this.receivers[u];if(!d||!a.intersectsAabb(d.aabb))continue;d.aabb.min=a.closestPoint(d.aabb.min),d.aabb.max=a.closestPoint(d.aabb.max);const f=d.aabb.getCorners();for(let p=0;p<i.length;p++){let g=!0;for(const _ of f){const v=[_[0]*n,_[1]*n,_[2]];if(G.transformMat4(v,v,i[p].matrix),v[0]<-1||v[0]>1||v[1]<-1||v[1]>1){g=!1;break}}if(d.lastCascade=p,l=Math.max(l,p),g)break}}return l+1}}class Im{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new IO,this._depthMode=new pe(t.context.gl.LEQUAL,pe.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const a=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||a<=0||(this._shadowLayerCount=i.style.order.reduce((x,b)=>{const E=i.style._mergedLayers[b];return x+(E.hasShadowPass()&&!E.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const l=i.context,u=lf,d=lf;if(0===this._cascades.length)for(let x=0;x<2;++x){const b=i._shadowMapDebug,E=l.gl,T=l.createFramebuffer(u,d,b,"texture"),C=new kr(l,{width:u,height:d,data:null},E.DEPTH_COMPONENT);if(T.depthAttachment.set(C.texture),b){const D=new kr(l,{width:u,height:d,data:null},E.RGBA);T.colorAttachment.set(D.texture)}this._cascades.push({framebuffer:T,texture:C,matrix:[],far:0,boundingSphereRadius:0,frustum:new fl,scale:0})}this.shadowDirection=Vy(n);let f=0;if(t.elevation){const x=t.elevation,b=[1e4,-1e4];x.visibleDemTiles.filter(E=>E.dem).forEach(E=>{const T=E.dem.tree;b[0]=Math.min(b[0],T.minimums[0]),b[1]=Math.max(b[1],T.maximums[0])}),1e4!==b[0]&&(f=(b[1]-b[0])*x.exaggeration())}const p=1.5*t.cameraToCenterDistance,g=3*p,_=new Float64Array(16);for(let x=0;x<2;++x){const b=this._cascades[x];let E=t.height/50,T=1;0===x?T=p:(E=p,T=g);const[C,D]=qT(t,this.shadowDirection,E,T,lf,f);b.scale=t.scale,b.matrix=C,b.boundingSphereRadius=D,nt.invert(_,b.matrix),b.frustum=fl.fromInvProjectionMatrix(_,1,0,!0),b.far=T}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=a,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=lf,this._uniformValues.u_shadowmap_0=ps.ShadowMap0,this._uniformValues.u_shadowmap_1=ps.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const v=i.transform.elevation;for(const x of this._groundShadowTiles){let b={min:0,max:0};if(v){const E=v.getMinMaxForTile(x);E&&(b=E)}this.addShadowReceiver(x.toUnwrapped(),b.min,b.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this._enabled)return;const i=this.painter,a=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),a.viewport.set([0,0,lf,lf]);for(let l=0;l<this._numCascadesToRender;++l){i.currentShadowCascade=l,a.bindFramebuffer.set(this._cascades[l].framebuffer.framebuffer),a.clear({color:Ae.white,depth:1});for(const u of t.order){const d=t._mergedLayers[u];if(!d.hasShadowPass()||d.isHidden(i.transform.zoom))continue;const f=t.getLayerSourceCache(d),p=f?n[f.id]:void 0;("model"===d.type||p&&p.length)&&i.renderLayer(i,f,d,p)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,n=t.style,i=t.context,a=n.directionalLight,l=n.ambientLight;if(!a||!l)return;const u=[],d=tf(t,t.longestCutoffRange);d.shouldRenderCutoff&&u.push("RENDER_CUTOFF");const f=sb(a,l),p=new pe(i.gl.LEQUAL,pe.ReadOnly,t.depthRangeFor3D);for(const g of this._groundShadowTiles){const _=g.toUnwrapped(),v=t.isTileAffectedByFog(g),x=t.getOrCreateProgram("groundShadow",{defines:u,overrideFog:v});this.setupShadows(_,x),t.uploadCommonUniforms(i,x,_,null,d);const b={u_matrix:t.transform.calculateProjMatrix(_),u_ground_shadow_factor:f};x.draw(t,i.gl.TRIANGLES,p,Se.disabled,Je.multiply,Fe.disabled,b,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Je.unblended:Je.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,i=n.calculatePosMatrix(t,n.worldSize);return nt.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(t){return nt.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,i,a=0){if(!this._enabled)return;const l=this.painter.transform,u=this.painter.context,d=u.gl,f=this._uniformValues,p=new Float64Array(16),g=l.calculatePosMatrix(t,l.worldSize);for(let _=0;_<2;_++)nt.multiply(p,this._cascades[_].matrix,g),f[0===_?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),u.activeTexture.set(d.TEXTURE0+ps.ShadowMap0+_),this._cascades[_].texture.bind(d.NEAREST,d.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){const _=Zu(t.canonical),v=2/l.tileSize*lt/lf,x=v*this._cascades[0].boundingSphereRadius,b=v*this._cascades[1].boundingSphereRadius,E=("vector-tile"===i?1:3)/Math.pow(2,a-t.canonical.z-(1-l.zoom+Math.floor(l.zoom)));f.u_shadow_normal_offset=[_,x*E,b*E],f.u_shadow_bias=[6e-5,.0012,.012]}else f.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(u,f)}setupShadowsFromMatrix(t,n,i=!1){if(!this._enabled)return;const a=this.painter.context,l=a.gl,u=this._uniformValues,d=new Float64Array(16);for(let f=0;f<2;f++)nt.multiply(d,this._cascades[f].matrix,t),u[0===f?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(d),a.activeTexture.set(l.TEXTURE0+ps.ShadowMap0+f),this._cascades[f].texture.bind(l.NEAREST,l.CLAMP_TO_EDGE);this.useNormalOffset=i,i?(u.u_shadow_normal_offset=[1,5,5],u.u_shadow_bias=[6e-5,.0012,.012]):u.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(a,u)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,i,a){if(a[2]>=0)return{};const l=function(f,p,g){const _=g/(1<<f.canonical.z);return new $n([f.canonical.x*_+f.wrap*g,f.canonical.y*_+f.wrap*g,0],[(f.canonical.x+1)*_+f.wrap*g,(f.canonical.y+1)*_+f.wrap*g,p])}(t,n,i).getCorners(),u=n/-a[2];a[0]<0?(G.add(l[0],l[0],[a[0]*u,0,0]),G.add(l[3],l[3],[a[0]*u,0,0])):a[0]>0&&(G.add(l[1],l[1],[a[0]*u,0,0]),G.add(l[2],l[2],[a[0]*u,0,0])),a[1]<0?(G.add(l[0],l[0],[0,a[1]*u,0]),G.add(l[1],l[1],[0,a[1]*u,0])):a[1]>0&&(G.add(l[2],l[2],[0,a[1]*u,0]),G.add(l[3],l[3],[0,a[1]*u,0]));const d={};return d.vertices=l,d.planes=[By(l[1],l[0],l[4]),By(l[2],l[1],l[5]),By(l[3],l[2],l[6]),By(l[0],l[3],l[7])],d}addShadowReceiver(t,n,i){this._receivers.add(t,$n.fromTileIdAndHeight(t,n,i))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function By(e,t,n){const i=G.sub([],n,t),a=G.sub([],e,t),l=G.cross([],i,a),u=G.length(l);return 0===u?[0,0,1,0]:(G.scale(l,l,1/u),[l[0],l[1],l[2],-G.dot(l,t)])}function Vy(e){const t=e.properties.get("direction"),n=Yt(t.x,t.y,t.z);n[2]=Wt(n[2],0,75);const i=$t([n[0],n[1],n[2]]);return G.fromValues(i.x,i.y,i.z)}function sb(e,t){const n=e.properties.get("color"),i=e.properties.get("intensity"),a=e.properties.get("direction"),l=[a.x,a.y,a.z],u=t.properties.get("color"),d=t.properties.get("intensity"),f=Math.max(G.dot([0,0,1],l),0),p=[0,0,0];G.scale(p,u.toArray01Linear().slice(0,3),d);const g=[0,0,0];return G.scale(g,n.toArray01Linear().slice(0,3),f*i),Fn([p[0]>0?p[0]/(p[0]+g[0]):0,p[1]>0?p[1]/(p[1]+g[1]):0,p[2]>0?p[2]/(p[2]+g[2]):0])}function qT(e,t,n,i,a,l){const u=e.zoom,d=e.scale,f=e.worldSize,p=1/f,g=e.aspect,_=Math.sqrt(1+g*g)*Math.tan(.5*e.fovX),v=_*_,x=i-n,b=i+n;let E,T;v>x/b?(E=i,T=i*_):(E=.5*b*(1+v),T=.5*Math.sqrt(x*x+2*(i*i+n*n)*v+b*b*v*v));const C=e.projection.pixelsPerMeter(e.center.lat,f),D=e._camera.getCameraToWorldMercator(),A=[0,0,-E*p];G.transformMat4(A,A,D);let P=T*p;const I=e._edgeInsets;if(!(0===I.left&&0===I.top&&0===I.right&&0===I.bottom||I.left===I.right&&I.top===I.bottom)){const ot=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?C:1),ct=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,i);ct[8]=2*-e.centerOffset.x/e.width,ct[9]=2*e.centerOffset.y/e.height;const dt=new Float64Array(16);nt.mul(dt,ct,ot);const gt=new Float64Array(16);nt.invert(gt,dt);const at=fl.fromInvProjectionMatrix(gt,f,u,!0);for(const ut of at.points){const St=((R=ut)[0]/=d,R[1]/=d,R[2]=xn(R[2],e._center.lat),R);P=Math.max(P,G.len(G.subtract([],A,St)))}}var R;P*=a/(a-1);const k=Math.acos(t[2]),L=Math.atan2(-t[0],-t[1]),N=new jd;N.position=A,N.setPitchBearing(k,L);const z=N.getWorldToCamera(f,C),j=P*f,B=Math.min(e._mercatorZfromZoom(17)*f*-2,-2*j),H=N.getCameraToClipOrthographic(-j,j,-j,j,B,(j+l*C)/t[2]),V=new Float64Array(16);nt.multiply(V,H,z);const Z=G.fromValues(Math.floor(1e6*A[0])/1e6*f,Math.floor(1e6*A[1])/1e6*f,0),Q=.5*a,et=[0,0,0];G.transformMat4(et,Z,V),G.scale(et,et,Q);const W=[Math.floor(et[0]),Math.floor(et[1]),Math.floor(et[2])],X=[0,0,0];G.sub(X,et,W),G.scale(X,X,-1/Q);const rt=new Float64Array(16);return nt.identity(rt),nt.translate(rt,rt,X),nt.multiply(V,rt,V),[V,j]}class RA extends wr{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,n){return T1(this.requestManager.transformRequest(n,ft.Model).url).then(i=>{if(!i)return;const a=iT(i),l=new e1(t,void 0,void 0,a);return l.computeBoundsAndApplyParent(),l}).catch(i=>{this.fire(new pt(new Error(`Could not load model ${t} from ${n}: ${i.message}`)))})}load(t,n){this.models[n]||(this.models[n]={});const i=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+i.length;const a=[];for(const l of i)a.push(this.loadModel(l,t[l]));Promise.allSettled(a).then(l=>{for(let u=0;u<l.length;u++){const{status:d,value:f}=l[u];"fulfilled"===d&&f&&(this.models[n][i[u]]=f)}this.numModelsLoading[n]-=i.length,this.fire(new Mt("data",{dataType:"style"}))}).catch(l=>{this.fire(new pt(new Error(`Could not load models: ${l.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]}addModel(t,n,i){this.models[i]||(this.models[i]={}),this.hasModel(t,i)&&this.removeModel(t,i),this.load({[t]:this.requestManager.normalizeModelURL(n)},i)}addModels(t,n){const i={};for(const a in t)i[a]=this.requestManager.normalizeModelURL(t[a]);this.load(i,n)}removeModel(t,n){this.models[n]||(this.models[n]={});const i=this.models[n][t];delete this.models[n][t],i.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const i in this.models[n])this.models[n][i].upload(t.context)}}const Am=(e,t)=>Pg(e,t&&t.filter(n=>"source.canvas"!==n.identifier)),OA=Ro(ln,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),ab=Ro(ln,["setCenter","setZoom","setBearing","setPitch"]),lb={version:8,layers:[],sources:{}},ZT={duration:300,delay:0},jy=new Set(["fill","line","background","hillshade","raster"]);class Ns extends wr{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=qt({},ZT),this._buildingIndex=new zI(this),this.crossTileSymbolIndex=new Br,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new Kw,this.dispatcher=n.dispatcher?n.dispatcher:new dm(Yd(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new CI,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new Ku(t._requestManager,n.localFontFamily?2:n.localIdeographFontFamily?1:0,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new RA(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",Ct());const i=this;this._rtlTextPluginCallback=Ns.registerForPluginStateChange(a=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:a.pluginStatus,pluginURL:a.pluginURL},(l,u)=>{if($i(l),u&&u.every(d=>d))for(const d in i._sourceCaches){const f=i._sourceCaches[d],p=f.getSource().type;"vector"!==p&&"geojson"!==p||f.reload()}})}),this.on("data",a=>{if("source"!==a.dataType||"metadata"!==a.sourceDataType)return;const l=this.getOwnSource(a.sourceId);if(l&&l.vectorLayerIds)for(const u in this._layers){const d=this._layers[u];d.source===l.id&&this._validateLayer(d)}})}loadURL(t,n={}){this.fire(new Mt("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!dn(t);t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const a=this.importsCache.get(t);if(a)return this._load(a,i);const l=this.map._requestManager.transformRequest(t,ft.Style);this._request=At(l,(u,d)=>{if(this._request=null,u)this.fire(new pt(u));else if(d)return this.importsCache.set(t,d),this._load(d,i)})}loadJSON(t,n={}){this.fire(new Mt("dataloading",{dataType:"style"})),this._request=Ft.frame(()=>{this._request=null,this._load(t,!1!==n.validate)})}loadEmpty(){this.fire(new Mt("dataloading",{dataType:"style"})),this._load(lb,!1)}_loadImports(t,n){if(this.importDepth>=4)return K("Style doesn't support nesting deeper than 5"),this._reloadImports();const i=[];for(const a of t){const l=this._createFragmentStyle(a),u=new Promise(f=>l.on("style.import.load",f));if(i.push(u),this.resolvedImports.has(a.url)){l.loadEmpty();continue}const d=a.data||this.importsCache.get(a.url);d?l.loadJSON(d,{validate:n}):a.url?l.loadURL(a.url,{validate:n}):l.loadEmpty(),this.fragments.push({style:l,id:a.id,config:a.config})}Promise.all(i).then(()=>this._reloadImports())}_createFragmentStyle(t){const n=this.scope?Pi(t.id,this.scope):t.id,i=new Ns(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return i.setEventedParent(this.map,{style:i}),i.setConfig(t.config),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new Mt("data",{dataType:"style"})),this.fire(new Mt(t?"style.load":"style.import.load"))}_load(t,n){const i=t.schema;if(this.isRootStyle()&&(t.fragment||i&&!1!==t.fragment)){const u=qt({},lb,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(u,n)}if(this.updateSchema(i),n&&Am(this,zo(t)))return;this._loaded=!0,this.stylesheet=U(t);for(const u in t.sources)this.addSource(u,t.sources[u],{validate:!1});this._changes.changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const a=VI(this.stylesheet.layers);if(this._order=a.map(u=>u.id),this.stylesheet.light&&K("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const u=this.stylesheet.lights[0];this.light=new jC(u.properties,u.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new jC(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const u of a){const d=my(u,this.options);d.setScope(this.scope),d.isConfigDependent&&this._configDependentLayers.add(d.fqid),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize();const f=this.getOwnLayerSourceCache(d),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();f&&d.canCastShadows()&&p&&(f.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const l=this.stylesheet.terrain;if(l&&!this.terrainSetForDrapingOnly()&&this._createTerrain(l,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new Mt("data",{dataType:"style"})),t.imports)this._loadImports(t.imports,n);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const u=this.isRootStyle();this._shouldPrecompile=u,this.fire(new Mt(u?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,n,i,a,l,u,d,f;this.forEachFragmentStyle(p=>{if(p.stylesheet){if(null!=p.light&&(t=p.light),p.stylesheet.lights)for(const g of p.stylesheet.lights)"ambient"===g.type&&null!=p.ambientLight&&(n=p.ambientLight),"directional"===g.type&&null!=p.directionalLight&&(i=p.directionalLight);(p.stylesheet.terrain||p.stylesheet.projection&&"globe"===p.stylesheet.projection.name)&&null!=p.terrain&&(!a||a&&0===a.drapeRenderMode||1===p.terrain.drapeRenderMode)&&(a=p.terrain),p.stylesheet.fog&&null!=p.fog&&(l=p.fog),null!=p.stylesheet.camera&&(f=p.stylesheet.camera),null!=p.stylesheet.projection&&(u=p.stylesheet.projection),null!=p.stylesheet.transition&&(d=p.stylesheet.transition)}}),this.light=t,this.ambientLight=n,this.directionalLight=i,this.terrain=a,this.fog=l,this.camera=f||{"camera-projection":"perspective"},this.projection=u||{name:"mercator"},this.transition=qt({},ZT,d),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=i=>{for(const a of i.fragments)n(a.style);t(i)};n(this)}mergeTerrain(){let t;this.forEachFragmentStyle(n=>{null!=n.terrain&&(!t||t&&0===t.drapeRenderMode||1===n.terrain.drapeRenderMode)&&(t=n.terrain)}),this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{null!=n.stylesheet.projection&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},i={};this.forEachFragmentStyle(a=>{for(const l in a._sourceCaches){const u=Pi(l,a.scope);t[u]=a._sourceCaches[l]}for(const l in a._otherSourceCaches){const u=Pi(l,a.scope);n[u]=a._otherSourceCaches[l]}for(const l in a._symbolSourceCaches){const u=Pi(l,a.scope);i[u]=a._symbolSourceCaches[l]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=i}mergeLayers(){const t={},n=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(l=>{for(const u of l._order){const d=l._layers[u];if("slot"===d.type){const f=Fg(u);if(t[f])continue;t[f]=[]}d.slot&&t[d.slot]?t[d.slot].push(d):n.push(d)}}),this._mergedOrder=[];const a=(l=[])=>{for(const u of l)if("slot"===u.type){const d=Fg(u.id);t[d]&&a(t[d])}else{const d=Pi(u.id,u.scope);this._mergedOrder.push(d),i[d]=u,u.is3D()&&(this._has3DLayers=!0),"circle"===u.type&&(this._hasCircleLayers=!0),"symbol"===u.type&&(this._hasSymbolLayers=!0)}};a(n),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=qt({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,i,a){let l,u,d;const f=Ft.devicePixelRatio>1?"@2x":"";let p=At(i.transformRequest(i.normalizeSpriteURL(n,f,".json"),ft.SpriteJSON),(v,x)=>{p=null,d||(d=v,l=x,_())}),g=Te(i.transformRequest(i.normalizeSpriteURL(n,f,".png"),ft.SpriteImage),(v,x)=>{g=null,d||(d=v,u=x,_())});function _(){if(d)a(d);else if(l&&u){const v=Ft.getImageData(u),x={};for(const b in l){const{width:E,height:T,x:C,y:D,sdf:A,pixelRatio:P,stretchX:I,stretchY:R,content:k}=l[b],L=new ur({width:E,height:T});ur.copy(v,L,{x:C,y:D},{x:0,y:0},{width:E,height:T}),x[b]={data:L,pixelRatio:P,sdf:A,stretchX:I,stretchY:R,content:k}}a(null,x)}}return{cancel(){p&&(p.cancel(),p=null),g&&(g.cancel(),g=null)}}}(t,this.map._requestManager,(n,i)=>{if(this._spriteRequest=null,n)this.fire(new pt(n));else if(i)for(const a in i)this.imageManager.addImage(a,this.scope,i[a]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Mt("data",{dataType:"style"}))})}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const i=t.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new pt(new Error(`Source layer "${i}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const i=this.fragments[n];return i&&i.style&&(t.data=i.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const i=this._sourceCaches[n].getSource();t[i.id]||(t[i.id]=i.serialize())}return t}_serializeLayers(t){const n=[];for(const i of t){const a=this._layers[i];a&&"custom"!==a.type&&n.push(a.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped(this.getLayerSourceCache(t)):jy.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new pt(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new pt(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const i=this._changes.changed;if(this._changes.changed){const l=this._changes.getLayerUpdatesByScope();for(const u in l){const{updatedIds:d,removedIds:f}=l[u];(d||f)&&this._updateWorkerLayers(u,d,f)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const a={};for(const l in this._mergedSourceCaches){const u=this._mergedSourceCaches[l];a[l]=u.used,u.used=!1}for(const l of this._mergedOrder){const u=this._mergedLayers[l];if(u.recalculate(t,this._availableImages),!u.isHidden(t.zoom)){const d=this.getOwnLayerSourceCache(u);d&&(d.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let d=u.minzoom||0;d<(u.maxzoom||25.5);d++){const f=this.map.painter;if(f){const p=u.getProgramIds();if(!p)continue;for(const g of p){const _=u.getDefaultProgramParams(g,t.zoom);_&&(f.style=this,this.fog&&(f._fogVisible=!0,_.overrideFog=!0,f.getOrCreateProgram(g,_)),f._fogVisible=!1,_.overrideFog=!1,f.getOrCreateProgram(g,_),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(_.overrideRtt=!0,f.getOrCreateProgram(g,_)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const l in a){const u=this._mergedSourceCaches[l];a[l]!==u.used&&u.getSource().fire(new Mt("data",{sourceDataType:"visibility",dataType:"source",sourceId:u.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new Mt("data",{dataType:"style"}));for(const{style:l}of this.fragments)l.update(t)}_updateTilesForChangedImages(){const t=Array.from(this._changes.changedImages.keys());if(t.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.changedImages.clear()}}_updateWorkerLayers(t,n,i){const a=this.getFragmentStyle(t);this.dispatcher.broadcast("updateLayers",{layers:n?a._serializeLayers(n):[],scope:t,removedIds:i||[],options:a.options})}setState(t){if(this._checkLoaded(),Am(this,zo(t)))return!1;(t=U(t)).layers=VI(t.layers);const n=function(a,l){if(!a)return[{command:ln.setStyle,args:[l]}];let u=[];try{if(!tn(a.version,l.version))return[{command:ln.setStyle,args:[l]}];tn(a.center,l.center)||u.push({command:ln.setCenter,args:[l.center]}),tn(a.zoom,l.zoom)||u.push({command:ln.setZoom,args:[l.zoom]}),tn(a.bearing,l.bearing)||u.push({command:ln.setBearing,args:[l.bearing]}),tn(a.pitch,l.pitch)||u.push({command:ln.setPitch,args:[l.pitch]}),tn(a.sprite,l.sprite)||u.push({command:ln.setSprite,args:[l.sprite]}),tn(a.glyphs,l.glyphs)||u.push({command:ln.setGlyphs,args:[l.glyphs]}),tn(a.transition,l.transition)||u.push({command:ln.setTransition,args:[l.transition]}),tn(a.light,l.light)||u.push({command:ln.setLight,args:[l.light]}),tn(a.fog,l.fog)||u.push({command:ln.setFog,args:[l.fog]}),tn(a.projection,l.projection)||u.push({command:ln.setProjection,args:[l.projection]}),tn(a.lights,l.lights)||u.push({command:ln.setLights,args:[l.lights]}),tn(a.camera,l.camera)||u.push({command:ln.setCamera,args:[l.camera]});const d={},f=[];!function(_,v,x,b){let E;for(E in v=v||{},_=_||{})_.hasOwnProperty(E)&&(v.hasOwnProperty(E)||cT(E,x,b));for(E in v){if(!v.hasOwnProperty(E))continue;const T=v[E];_.hasOwnProperty(E)?tn(_[E],T)||("geojson"===_[E].type&&"geojson"===T.type&&xm(_,v,E)?x.push({command:ln.setGeoJSONSourceData,args:[E,T.data]}):jI(E,v,x,b)):I1(E,v,x)}}(a.sources,l.sources,f,d);const p=[];a.layers&&a.layers.forEach(_=>{_.source&&d[_.source]?u.push({command:ln.removeLayer,args:[_.id]}):p.push(_)});let g=a.terrain;g&&d[g.source]&&(u.push({command:ln.setTerrain,args:[void 0]}),g=void 0),u=u.concat(f),tn(g,l.terrain)||u.push({command:ln.setTerrain,args:[l.terrain]}),function(_,v,x){v=v||[];const b=(_=_||[]).map(bm),E=v.map(bm),T=_.reduce(by,{}),C=v.reduce(by,{}),D=b.slice(),A=Object.create(null);let P,I,R,k,L,N,z;for(P=0,I=0;P<b.length;P++)R=b[P],C.hasOwnProperty(R)?I++:(x.push({command:ln.removeLayer,args:[R]}),D.splice(D.indexOf(R,I),1));for(P=0,I=0;P<E.length;P++)R=E[E.length-1-P],D[D.length-1-P]!==R&&(T.hasOwnProperty(R)?(x.push({command:ln.removeLayer,args:[R]}),D.splice(D.lastIndexOf(R,D.length-I),1)):I++,N=D[D.length-P],x.push({command:ln.addLayer,args:[C[R],N]}),D.splice(D.length-P,0,R),A[R]=!0);for(P=0;P<E.length;P++)if(R=E[P],k=T[R],L=C[R],!A[R]&&!tn(k,L))if(tn(k.source,L.source)&&tn(k["source-layer"],L["source-layer"])&&tn(k.type,L.type)){for(z in xy(k.layout,L.layout,x,R,null,ln.setLayoutProperty),xy(k.paint,L.paint,x,R,null,ln.setPaintProperty),tn(k.slot,L.slot)||x.push({command:ln.setSlot,args:[R,L.slot]}),tn(k.filter,L.filter)||x.push({command:ln.setFilter,args:[R,L.filter]}),tn(k.minzoom,L.minzoom)&&tn(k.maxzoom,L.maxzoom)||x.push({command:ln.setLayerZoomRange,args:[R,L.minzoom,L.maxzoom]}),k)k.hasOwnProperty(z)&&"layout"!==z&&"paint"!==z&&"filter"!==z&&"metadata"!==z&&"minzoom"!==z&&"maxzoom"!==z&&"slot"!==z&&(0===z.indexOf("paint.")?xy(k[z],L[z],x,R,z.slice(6),ln.setPaintProperty):tn(k[z],L[z])||x.push({command:ln.setLayerProperty,args:[R,z,L[z]]}));for(z in L)L.hasOwnProperty(z)&&!k.hasOwnProperty(z)&&"layout"!==z&&"paint"!==z&&"filter"!==z&&"metadata"!==z&&"minzoom"!==z&&"maxzoom"!==z&&"slot"!==z&&(0===z.indexOf("paint.")?xy(k[z],L[z],x,R,z.slice(6),ln.setPaintProperty):tn(k[z],L[z])||x.push({command:ln.setLayerProperty,args:[R,z,L[z]]}))}else x.push({command:ln.removeLayer,args:[R]}),N=D[D.lastIndexOf(R)+1],x.push({command:ln.addLayer,args:[L,N]})}(p,l.layers,u),function(_=[],v=[],x){v=v||[];const b=(_=_||[]).map(bm),E=v.map(bm),T=_.reduce(by,{}),C=v.reduce(by,{}),D=b.slice();let A,P,I,R;for(A=0,P=0;A<b.length;A++)I=b[A],C.hasOwnProperty(I)?P++:(x.push({command:ln.removeImport,args:[I]}),D.splice(D.indexOf(I,P),1));for(A=0,P=0;A<E.length;A++)I=E[E.length-1-A],D[D.length-1-A]!==I&&(T.hasOwnProperty(I)?(x.push({command:ln.removeImport,args:[I]}),D.splice(D.lastIndexOf(I,D.length-P),1)):P++,R=D[D.length-A],x.push({command:ln.addImport,args:[C[I],R]}),D.splice(D.length-A,0,I));for(const k of v){const L=T[k.id];if(!L||tn(L,k))continue;tn(L.config,k.config)||x.push({command:ln.setImportConfig,args:[k.id,k.config]}),tn(L.url,k.url)||x.push({command:ln.setImportUrl,args:[k.id,k.url]});const N=k.data;tn(L&&L.data,N)||x.push({command:ln.setImportData,args:[k.id,N]})}}(a.imports,l.imports,u)}catch(d){console.warn("Unable to compute style diff:",d),u=[{command:ln.setStyle,args:[l]}]}return u}(this.serialize(),t).filter(a=>!(a.command in ab));if(0===n.length)return!1;const i=n.filter(a=>!(a.command in OA));if(i.length>0)throw new Error(`Unimplemented: ${i.map(a=>a.command).join(", ")}.`);return n.forEach(a=>{this[a.command].apply(this,a.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new pt(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(t,n){this.imageManager.updateImage(t,this.scope,n)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new pt(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(t),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Mt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,i={}){return this._checkLoaded(),this._validate(As,`models.${t}`,n,null,i)||(this.modelManager.addModel(t,n,this.scope),this._changes.changed=!0),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new pt(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,i={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Zw,`sources.${t}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const a=S1(t,n,this.dispatcher,this);a.scope=this.scope,a.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a.id),source:a.serialize(),sourceId:a.id}));const l=u=>{const d=(u?"symbol:":"other:")+a.id,f=Pi(d,this.scope),p=this._sourceCaches[d]=new fs(f,a,u);(u?this._symbolSourceCaches:this._otherSourceCaches)[a.id]=p,p.onAdd(this.map)};l(!1),"vector"!==n.type&&"geojson"!==n.type||l(!0),a.onAdd&&a.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new pt(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new pt(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const i=this.getOwnSourceCaches(t);for(const a of i){const l=Fg(a.id);delete this._sourceCaches[l],delete this._changes.updatedSourceCaches[a.id],a.fire(new Mt("data",{sourceDataType:"metadata",dataType:"source",sourceId:a.getSource().id})),a.setEventedParent(null),a.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.changed=!0}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const i=this.getOwnSourceCache(n);i&&t.push(i.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const a of t){if(this._validate(Dr,"lights",a))return;switch(a.type){case"ambient":if(this.ambientLight){const l=this.ambientLight;l.set(a),l.updateTransitions(n)}else this.ambientLight=new iu(a,II,this.scope,this.options);break;case"directional":if(this.directionalLight){const l=this.directionalLight;l.set(a),l.updateTransitions(n)}else this.directionalLight=new iu(a,AI,this.scope,this.options)}}const i=new er(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const i=_=>.2126*(_[0]<=.03928?_[0]/12.92:Math.pow((_[0]+.055)/1.055,2.4))+.7152*(_[1]<=.03928?_[1]/12.92:Math.pow((_[1]+.055)/1.055,2.4))+.0722*(_[2]<=.03928?_[2]/12.92:Math.pow((_[2]+.055)/1.055,2.4)),a=t.properties.get("color").toArray01(),l=t.properties.get("intensity"),u=t.properties.get("direction"),d=1-Yt(u.x,u.y,u.z)[2]/90,f=i(a)*l*d,p=n.properties.get("color").toArray01(),g=n.properties.get("intensity");return(f+i(p)*g)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;const n=this.fragments.find(({id:i})=>i===t);if(!n)throw new Error(`Style import not found: ${t}`);return n.style}setConfigProperty(t,n,i){const a=Vl(i);if("success"!==a.result)return void Am(this,a.value);const l=a.value.expression,u=this.getFragmentStyle(t);u.options.set(n,l),u.updateConfigDependencies()}setConfig(t,n){if(this.options.clear(),t){for(const i in t){const a=Vl(t[i]);"success"===a.result&&this.options.set(i,a.value.expression)}this.updateSchema(n)}}updateSchema(t){if(t)for(const n in t){if(this.options.has(n))continue;const i=Vl(t[n].default);"success"===i.result&&this.options.set(n,i.value.expression)}}updateConfigDependencies(){for(const t of this._configDependentLayers){const n=this.getLayer(t);n&&(n.possiblyEvaluateVisibility(),this._updateLayer(n))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(t,n,i={}){this._checkLoaded();const a=t.id;if(this._layers[a])return void this.fire(new pt(new Error(`Layer with id "${a}" already exists on this map`)));let l;if("custom"===t.type){if(Am(this,function(g){const _=[],v=g.id;return void 0===v&&_.push({message:`layers.${v}: missing required property "id"`}),void 0===g.render&&_.push({message:`layers.${v}: missing required method "render"`}),g.renderingMode&&"2d"!==g.renderingMode&&"3d"!==g.renderingMode&&_.push({message:`layers.${v}: property "renderingMode" must be either "2d" or "3d"`}),_}(t)))return;l=my(t,this.options)}else{if("object"==typeof t.source&&(this.addSource(a,t.source),t=qt(t=U(t),{source:a})),this._validate(Qo,`layers.${a}`,t,{arrayIndex:-1},i))return;l=my(t,this.options),this._validateLayer(l),l.setEventedParent(this,{layer:{id:a}}),this._serializedLayers[l.id]=l.serialize()}l.isConfigDependent&&this._configDependentLayers.add(l.fqid),l.setScope(this.scope);const u=n?this._order.indexOf(n):this._order.length;if(n&&-1===u)return void this.fire(new pt(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(u,0,a),this._layerOrderChanged=!0,this._layers[a]=l;const d=this.getOwnLayerSourceCache(l),f=!!this.directionalLight&&this.directionalLight.shadowsEnabled();d&&l.canCastShadows()&&f&&(d.castsShadows=!0);const p=this._changes.getRemovedLayer(l);if(p&&l.source&&d&&"custom"!==l.type){this._changes.discardLayerRemoval(l);const g=Pi(l.source,l.scope);p.type!==l.type?this._changes.updatedSourceCaches[g]="clear":(this._changes.updatedSourceCaches[g]="reload",d.pause())}this._updateLayer(l),l.onAdd&&l.onAdd(this.map),l.scope=this.scope,this.mergeLayers()}moveLayer(t,n){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(t)||t===n)return;const i=this._order.indexOf(t);this._order.splice(i,1);const a=n?this._order.indexOf(n):this._order.length;n&&-1===a?this.fire(new pt(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(a,0,t),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const i=this._order.indexOf(t);this._order.splice(i,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const a=this.getOwnLayerSourceCache(n);if(a&&a.castsShadows){let l=!1;for(const u in this._layers)if(this._layers[u].source===n.source&&this._layers[u].canCastShadows()){l=!0;break}a.castsShadows=l}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,i){this._checkLoaded();const a=this._checkLayer(t);a&&(a.minzoom===n&&a.maxzoom===i||(null!=n&&(a.minzoom=n),null!=i&&(a.maxzoom=i),this._updateLayer(a)))}setSlot(t,n){this._checkLoaded();const i=this._checkLayer(t);i&&i.slot!==n&&(i.slot=n,this._updateLayer(i))}setFilter(t,n,i={}){this._checkLoaded();const a=this._checkLayer(t);if(a&&!tn(a.filter,n))return null==n?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(Kv,`layers.${a.id}.filter`,n,{layerType:a.type},i)||(a.filter=U(n),this._updateLayer(a)))}getFilter(t){const n=this._checkLayer(t);if(n)return U(n.filter)}setLayoutProperty(t,n,i,a={}){this._checkLoaded();const l=this._checkLayer(t);l&&(tn(l.getLayoutProperty(n),i)||(l.setLayoutProperty(n,i,a),l.isConfigDependent&&this._configDependentLayers.add(l.fqid),this._updateLayer(l)))}getLayoutProperty(t,n){const i=this._checkLayer(t);if(i)return i.getLayoutProperty(n)}setPaintProperty(t,n,i,a={}){this._checkLoaded();const l=this._checkLayer(t);if(!l||tn(l.getPaintProperty(n),i))return;const u=l.setPaintProperty(n,i,a);l.isConfigDependent&&this._configDependentLayers.add(l.fqid),u&&this._updateLayer(l),this._changes.changed=!0,this._changes.updatedPaintProps.add(l.fqid)}getPaintProperty(t,n){const i=this._checkLayer(t);if(i)return i.getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const i=t.source,a=t.sourceLayer,l=this._checkSource(i);if(!l)return;const u=l.type;if("geojson"===u&&a)return void this.fire(new pt(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===u&&!a)return void this.fire(new pt(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new pt(new Error("The feature id parameter must be provided.")));const d=this.getOwnSourceCaches(i);for(const f of d)f.setFeatureState(a,t.id,n)}removeFeatureState(t,n){this._checkLoaded();const i=t.source,a=this._checkSource(i);if(!a)return;const l=a.type,u="vector"===l?t.sourceLayer:void 0;if("vector"===l&&!u)return void this.fire(new pt(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new pt(new Error("A feature id is required to remove its specific state property.")));const d=this.getOwnSourceCaches(i);for(const f of d)f.removeFeatureState(u,t.id,n)}getFeatureState(t){this._checkLoaded();const n=t.source,i=t.sourceLayer,a=this._checkSource(n);if(a){if("vector"!==a.type||i)return void 0===t.id&&this.fire(new pt(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(i,t.id);this.fire(new pt(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=qt({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return qt({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:void 0;return It({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},i=>void 0!==i)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),i=Pi(t.source,t.scope);t.source&&!this._changes.updatedSourceCaches[i]&&n&&"raster"!==n.getSource().type&&(this._changes.updatedSourceCaches[i]="reload",n.pause()),this._changes.changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=d=>"fill-extrusion"===this._mergedLayers[d].type,i=this.order,a={},l=[];for(let d=i.length-1;d>=0;d--){const f=i[d];if(n(f)){a[f]=d;for(const p of t){const g=p[f];if(g)for(const _ of g)l.push(_)}}}l.sort((d,f)=>f.intersectionZ-d.intersectionZ);const u=[];for(let d=i.length-1;d>=0;d--){const f=i[d];if(n(f))for(let p=l.length-1;p>=0;p--){const g=l[p].feature;if(a[g.layer.id]<d)break;u.push(g),l.pop()}else for(const p of t){const g=p[f];if(g)for(const _ of g)u.push(_.feature)}}return u}queryRenderedFeatures(t,n,i){n&&n.filter&&this._validate(Kv,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;const a={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new pt(new Error("parameters.layers must be an Array."))),[];for(const p of n.layers){const g=this._mergedLayers[p];if(!g)return this.fire(new pt(new Error(`The layer '${p}' does not exist in the map's style and cannot be queried for features.`))),[];a[g.source]=!0}}const l=[],u=n.serializedLayers||{},d=n&&n.layers?n.layers.some(p=>{const g=this.getLayer(p);return g&&g.is3D()}):this.has3DLayers(),f=ou.createFromScreenPoints(t,i);for(const p in this._mergedSourceCaches){const g=this._mergedSourceCaches[p].getSource();if(!g||g.scope!==n.scope)continue;const _=this._mergedSourceCaches[p].getSource().id;n.layers&&!a[_]||l.push(sT(this._mergedSourceCaches[p],this._mergedLayers,u,f,n,i,d,!!this.map._showQueryGeometry))}return this.placement&&l.push(function(p,g,_,v,x,b,E){const T={},C=b.queryRenderedSymbols(v),D=[];for(const A of Object.keys(C).map(Number))D.push(E[A]);D.sort(aT);for(const A of D){const P=A.featureIndex.lookupSymbolFeatures(C[A.bucketInstanceId],g,A.bucketIndex,A.sourceLayerIndex,x.filter,x.layers,x.availableImages,p);for(const I in P){const R=T[I]=T[I]||[],k=P[I];k.sort((L,N)=>{const z=A.featureSortOrder;if(z){const j=z.indexOf(L.featureIndex);return z.indexOf(N.featureIndex)-j}return N.featureIndex-L.featureIndex});for(const L of k)R.push(L)}}for(const A in T)T[A].forEach(P=>{const I=P.feature,R=_(p[A]);if(!R)return;const k=R.getFeatureState(I.layer["source-layer"],I.id);I.source=I.layer.source,I.layer["source-layer"]&&(I.sourceLayer=I.layer["source-layer"]),I.state=k});return T}(this._mergedLayers,u,this.getLayerSourceCache.bind(this),f.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)}querySourceFeatures(t,n){n&&n.filter&&this._validate(Kv,"querySourceFeatures.filter",n.filter,null,n);const i=this.getOwnSourceCaches(t);let a=[];for(const l of i)a=a.concat(vm(l,n));return a}addSourceType(t,n,i){return Ns.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(Ns.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,i={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const d in t)if(!tn(t[d],a[d])){l=!0;break}if(!l)return;const u=this._getTransitionParameters();this.light.setLight(t,n,i),this.light.updateTransitions(u)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,n=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let i=t;if(1===n){if("object"==typeof i.source){const a="terrain-dem-src";this.addSource(a,i.source),i=U(i),i=qt(i,{source:a})}if(this._validate(Jv,"terrain",i))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode){if(!i)return;this._createTerrain(i,n),this.fire(new Mt("data",{dataType:"style"}))}else{const a=this.terrain,l=a.get();for(const u of Object.keys(J.terrain))!i.hasOwnProperty(u)&&J.terrain[u].default&&(i[u]=J.terrain[u].default);for(const u in t)if(!tn(t[u],l[u])){a.set(t),this.stylesheet.terrain=t;const d=this._getTransitionParameters({duration:0});a.updateTransitions(d),this.fire(new Mt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new GC(t,this.map.transform);this.stylesheet.fog=n.get();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!tn(n.get(),t)){n.set(t),this.stylesheet.fog=n.get();const i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:Ft.now(),transition:qt(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?t.push(i):n.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const i=this.terrain=new SI(t,n);i.setScope(this.scope),this.stylesheet.terrain=t,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const a=this._getTransitionParameters({duration:0});i.updateTransitions(a)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];"fill-extrusion"===n.type&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];"symbol"===n.type&&this._updateLayer(n)}}_validate(t,n,i,a,l={}){if(l&&!1===l.validate)return!1;const u=qt({},this.serialize());return Am(this,t.call(zo,qt({key:n,style:u,value:i,styleSpec:J},a)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Pu.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const i of n)i.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const i of n)i.resume(),i.reload()}updateSources(t){let n;this.directionalLight&&(n=Vy(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,i,a,l=!1){let u=!1,d=!1;const f={},p={};for(const g of this._mergedOrder){const _=this._mergedLayers[g];if("symbol"!==_.type)continue;const v=Pi(_.source,_.scope);let x=f[v];if(!x){const E=this.getLayerSourceCache(_);if(!E)continue;const T=E.getRenderableIds(!0).map(C=>E.getTileByID(C));p[v]=T.slice(),x=f[v]=T.sort((C,D)=>D.tileID.overscaledZ-C.tileID.overscaledZ||(C.tileID.isLessThan(D.tileID)?-1:1))}const b=this.crossTileSymbolIndex.addLayer(_,x,t.center.lng,t.projection);u=u||b}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),l=l||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new Mt("neworder")),(l||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ft.now(),t.zoom))&&(this.pauseablePlacement=new KI(t,this._mergedOrder,l,n,i,a,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,f,p),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ft.now()),d=!0),u&&this.pauseablePlacement.placement.setStale()),d||u)for(const g of this._mergedOrder){const _=this._mergedLayers[g];"symbol"===_.type&&this.placement.updateLayerOpacities(_,f[Pi(_.source,_.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ft.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==n.findIndex(({id:a})=>a===t.id)?this.fire(new pt(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(n.push(t),this._loadImports([t],!0),this)}setImportUrl(t,n){this._checkLoaded();const i=this.stylesheet.imports||[],a=this.getImportIndex(t);if(-1===a)return this;i[a].url=n;const l=this.fragments[a];l.style=this._createFragmentStyle({id:t,url:n});const u=new Promise(d=>l.style.on("style.import.load",d));return l.style.loadURL(n),u.then(()=>this._reloadImports()),this}setImportData(t,n){this._checkLoaded();const i=this.getImportIndex(t),a=this.stylesheet.imports||[];return-1===i?this:n?(this.fragments[i].style.setState(n),this._reloadImports(),this):(delete a[i].data,this.setImportUrl(t,a[i].url))}setImportConfig(t,n){this._checkLoaded();const i=this.getImportIndex(t),a=this.stylesheet.imports||[];if(-1===i)return this;n?a[i].config=n:delete a[i].config;const l=this.fragments[i],u=l.style.stylesheet&&l.style.stylesheet.schema;return l.config=n,l.style.setConfig(n,u),l.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(t);return-1===i||(n.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(i=>i.id===t);return-1===n&&this.fire(new pt(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[n];i&&t.push(i.getSource())}return t}getSource(t,n){const i=this.getSourceCache(t,n);return i&&i.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const i=Pi(t,n);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(t){const n=Pi(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){for(const t in this._changes.updatedSourceCaches){const n=this._changes.updatedSourceCaches[t];"reload"===n?this.reloadSource(t):"clear"===n&&this.clearSource(t)}}updateLayers(t){for(const n of this._changes.updatedPaintProps){const i=this.getLayer(n);i&&i.updateTransitions(t)}}getImages(t,n,i){this.imageManager.getImages(n.icons,n.scope,i),this._updateTilesForChangedImages();const a=l=>{l&&l.setDependencies(n.tileID.key,n.type,n.icons)};a(this._otherSourceCaches[n.source]),a(this._symbolSourceCaches[n.source])}getGlyphs(t,n,i){this.glyphManager.getGlyphs(n.stacks,n.scope,i)}getResource(t,n,i){return Pt(n,i)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return 0===n.length?(this.fire(new pt(new Error(`There is no source with ID '${t}'`))),!1):n.every(i=>i.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function kA(e,t){let n=!1,i=null;const a=()=>{i=null,n&&(e(),i=setTimeout(a,t),n=!1)};return()=>(n=!0,i||a(),i)}Ns.getSourceType=function(e){return Kd[e]},Ns.setSourceType=function(e,t){Kd[e]=t},Ns.registerForPluginStateChange=function(e){return e({pluginStatus:ts,pluginURL:Nc}),Pu.on("pluginStateChange",e),e};class WT{constructor(t){this._hashName=t&&encodeURIComponent(t),ui(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kA(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,it.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),it.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=XT(t);if(this._hashName){const i=this._hashName;let a=!1;const l=it.location.hash.slice(1).split("&").map(u=>{const d=u.split("=")[0];return d===i?(a=!0,`${d}=${n}`):u}).filter(u=>u);return a||l.push(`${i}=${n}`),`#${l.join("&")}`}return`#${n}`}_getCurrentHash(){const t=it.location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(i=>i.split("=")).forEach(i=>{i[0]===this._hashName&&(n=i)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(i=>isNaN(i))){const i=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:i,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=it.location.href.replace(/(#.+)?$/,this.getHashString());it.history.replaceState(it.history.state,null,t)}}function XT(e,t){const n=e.getCenter(),i=Math.round(100*e.getZoom())/100,a=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,a),u=Math.round(n.lng*l)/l,d=Math.round(n.lat*l)/l,f=e.getBearing(),p=e.getPitch();let g=t?`/${u}/${d}/${i}`:`${i}/${d}/${u}`;return(f||p)&&(g+="/"+Math.round(10*f)/10),p&&(g+=`/${Math.round(p)}`),g}const Pm={linearity:.3,easing:Ec(0,0,.3,1)},cf=qt({deceleration:2500,maxSpeed:1400},Pm),LA=qt({deceleration:20,maxSpeed:1400},Pm),YT=qt({deceleration:1e3,maxSpeed:360},Pm),cb=qt({deceleration:1e3,maxSpeed:90},Pm);class AO{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ft.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=Ft.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new tt(0,0),pinchAround:void 0,around:void 0};for(const{settings:l}of this._inertiaBuffer)n.zoom+=l.zoomDelta||0,n.bearing+=l.bearingDelta||0,n.pitch+=l.pitchDelta||0,l.panDelta&&n.pan._add(l.panDelta),l.around&&(n.around=l.around),l.pinchAround&&(n.pinchAround=l.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(n.pan.mag()){const l=ub(n.pan.mag(),i,qt({},cf,t||{}));a.offset=n.pan.mult(l.amount/n.pan.mag()),a.center=this._map.transform.center,Uy(a,l)}if(n.zoom){const l=ub(n.zoom,i,LA);a.zoom=this._map.transform.zoom+l.amount,Uy(a,l)}if(n.bearing){const l=ub(n.bearing,i,YT);a.bearing=this._map.transform.bearing+Wt(l.amount,-179,179),Uy(a,l)}if(n.pitch){const l=ub(n.pitch,i,cb);a.pitch=this._map.transform.pitch+l.amount,Uy(a,l)}if(a.zoom||a.bearing){const l=void 0===n.pinchAround?n.around:n.pinchAround;a.around=l?this._map.unproject(l):this._map.getCenter()}return this.clear(),a.noMoveStart=!0,a}}function Uy(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function ub(e,t,n){const{maxSpeed:i,linearity:a,deceleration:l}=n,u=Wt(e*a/(t/1e3),-i,i),d=Math.abs(u)/(l*a);return{easing:n.easing,duration:1e3*d,amount:u*(d/2)}}class zs extends Mt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i,a={}){const l=Sf(n.getCanvasContainer(),i);super(t,qt({point:l,lngLat:n.unproject(l),originalEvent:i},a)),this._defaultPrevented=!1,this.target=n}}class $y extends Mt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){const a="touchend"===t?i.changedTouches:i.touches,l=ar(n.getCanvasContainer(),a),u=l.map(f=>n.unproject(f)),d=l.reduce((f,p,g,_)=>f.add(p.div(_.length)),new tt(0,0));super(t,{points:l,point:d,lngLats:u,lngLat:n.unproject(d),originalEvent:i}),this._defaultPrevented=!1}}class FA extends Mt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class JT{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new FA(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new zs(t.type,this._map,t))}mouseup(t){this._map.fire(new zs(t.type,this._map,t))}preclick(t){const n=qt({},t);n.type="preclick",this._map.fire(new zs(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new zs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new zs(t.type,this._map,t))}mouseover(t){this._map.fire(new zs(t.type,this._map,t))}mouseout(t){this._map.fire(new zs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new $y(t.type,this._map,t))}touchmove(t){this._map.fire(new $y(t.type,this._map,t))}touchend(t){this._map.fire(new $y(t.type,this._map,t))}touchcancel(t){this._map.fire(new $y(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class KT{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new zs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new zs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class NA{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&0===t.button&&(tr(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const i=n,a=this._startPos,l=this._lastPos;if(!a||!l||l.equals(i)||!this._box&&i.dist(a)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=Tn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const u=Math.min(a.x,i.x),d=Math.max(a.x,i.x),f=Math.min(a.y,i.y),p=Math.max(a.y,i.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${u}px,${f}px)`,this._box.style.width=d-u+"px",this._box.style.height=p-f+"px")})}mouseupWindow(t,n){if(!this._active)return;const i=this._startPos,a=n;if(i&&0===t.button){if(this.reset(),Df(),i.x!==a.x||i.y!==a.y)return this._map.fire(new Mt("boxzoomend",{originalEvent:t})),{cameraAnimation:l=>l.fitScreenCoordinates(i,a,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Tf(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new Mt(t,{originalEvent:n}))}}function Hy(e,t){const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class QT{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(a){const l=new tt(0,0);for(const u of a)l._add(u);return l.div(a.length)}(n),this.touches=Hy(i,n)))}touchmove(t,n,i){if(this.aborted||!this.centroid)return;const a=Hy(i,n);for(const l in this.touches){const u=a[l];(!u||u.dist(this.touches[l])>30)&&(this.aborted=!0)}}touchend(t,n,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}class hb{constructor(t){this.singleTap=new QT(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,i){this.singleTap.touchstart(t,n,i)}touchmove(t,n,i){this.singleTap.touchmove(t,n,i)}touchend(t,n,i){const a=this.singleTap.touchend(t,n,i);if(a){const l=t.timeStamp-this.lastTime<500,u=!this.lastTap||this.lastTap.dist(a)<30;if(l&&u||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}class zA{constructor(){this._zoomIn=new hb({numTouches:1,numTaps:2}),this._zoomOut=new hb({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,i){this._zoomIn.touchstart(t,n,i),this._zoomOut.touchstart(t,n,i)}touchmove(t,n,i){this._zoomIn.touchmove(t,n,i),this._zoomOut.touchmove(t,n,i)}touchend(t,n,i){const a=this._zoomIn.touchend(t,n,i),l=this._zoomOut.touchend(t,n,i);return a?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:u.getZoom()+1,around:u.unproject(a)},{originalEvent:t})}):l?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:u.getZoom()-1,around:u.unproject(l)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tD={0:1,2:2};class db{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const i=qe(t);this._correctButton(t,i)&&(this._lastPoint=n,this._eventButton=i)}mousemoveWindow(t,n){const i=this._lastPoint;if(i)if(t.preventDefault(),null!=this._eventButton&&function(a,l){const u=tD[l];return void 0===a.buttons||(a.buttons&u)!==u}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(i,n)}mouseupWindow(t){this._lastPoint&&qe(t)===this._eventButton&&(this._moved&&Df(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eD extends db{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return 0===n&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class fb extends db{_correctButton(t,n){return 0===n&&t.ctrlKey||2===n}_move(t,n){const i=.8*(n.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class pb extends db{_correctButton(t,n){return 0===n&&t.ctrlKey||2===n}_move(t,n){const i=-.5*(n.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class nD{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),ui(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new tt(0,0)}touchstart(t,n,i){return this._calculateTransform(t,n,i)}touchmove(t,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length&&!ge())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,i)}}touchend(t,n,i){this._calculateTransform(t,n,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,i){i.length>0&&(this._active=!0);const a=Hy(i,n),l=new tt(0,0),u=new tt(0,0);let d=0;for(const p in a){const g=a[p],_=this._touches[p];_&&(l._add(g),u._add(g.sub(_)),d++,a[p]=g)}if(this._touches=a,d<this._minTouches||!u.mag())return;const f=u.div(d);return this._sum._add(f),this._sum.mag()<this._clickTolerance?void 0:{around:l.div(d),panDelta:f}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Tn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class mb{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,i){return{}}touchstart(t,n,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,i){const a=this._firstTwoTouches;if(!a)return;t.preventDefault();const[l,u]=a,d=Gy(i,n,l),f=Gy(i,n,u);if(!d||!f)return;const p=this._aroundCenter?null:d.add(f).div(2);return this._move([d,f],p,t)}touchend(t,n,i){if(!this._firstTwoTouches)return;const[a,l]=this._firstTwoTouches,u=Gy(i,n,a),d=Gy(i,n,l);u&&d||(this._active&&Df(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gy(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function BA(e,t){return Math.log(e/t)/Math.LN2}class rD extends mb{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(BA(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:BA(this._distance,i),pinchAround:n}}}function VA(e,t){return 180*e.angleWith(t)/Math.PI}class PO extends mb{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const i=this._vector;if(this._vector=t[0].sub(t[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:VA(this._vector,i),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const a=VA(t,i);return Math.abs(a)<n}}function iD(e){return Math.abs(e.y)>Math.abs(e.x)}class RO extends mb{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,iD(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,i){const a=this._lastPoints;if(!a)return;const l=t[0].sub(a[0]),u=t[1].sub(a[1]);return this._map._cooperativeGestures&&!ge()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(l,u,i.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(l.y+u.y)/2*-.5})}gestureBeginsVertically(t,n,i){if(void 0!==this._valid)return this._valid;const a=t.mag()>=2,l=n.mag()>=2;if(!a&&!l)return;if(!a||!l)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const u=t.y>0==n.y>0;return iD(t)&&iD(n)&&u}}const OO={panStep:100,bearingStep:15,pitchStep:10};class kO{constructor(){const t=OO;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,i=0,a=0,l=0,u=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),l=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),l=1);break;case 38:t.shiftKey?a=1:(t.preventDefault(),u=-1);break;case 40:t.shiftKey?a=-1:(t.preventDefault(),u=1);break;default:return}return this._rotationDisabled&&(i=0,a=0),{cameraAnimation:d=>{const f=d.getZoom();d.easeTo({duration:300,easeId:"keyboardHandler",easing:LO,zoom:n?Math.round(f)+n*(t.shiftKey?2:1):f,bearing:d.getBearing()+i*this._bearingStep,pitch:d.getPitch()+a*this._pitchStep,offset:[-l*this._panStep,-u*this._panStep],center:d.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function LO(e){return e*(2-e)}const jA=4.000244140625;class FO{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,ui(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||ge()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===it.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=Ft.now(),a=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%jA==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":a>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(a*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Sf(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const p="wheel"===this._type&&Math.abs(this._delta)>jA?this._wheelZoomRate:this._defaultZoomRate;let g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&0!==g&&(g=1/g);const _=n(),v=Math.pow(2,_),x="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):v;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(x*g))),"wheel"===this._type&&(this._startZoom=_,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),a=this._startZoom,l=this._easing;let u,d=!1;if("wheel"===this._type&&a&&l){const p=Math.min((Ft.now()-this._lastWheelEventTime)/200,1);u=ue(a,i,l(p)),p<1?this._frameId||(this._frameId=!0):d=!0}else u=i,d=!0;this._active=!0,d&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let f=u-n();return f*this._lastDelta<0&&(f=0),{noInertia:!0,needsRenderFrame:!d,zoomDelta:f,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=Un;if(this._prevEase){const i=this._prevEase,a=(Ft.now()-i.start)/i.duration,l=i.easing(a+.01)-i.easing(a),u=.27/Math.sqrt(l*l+1e-4)*.01;n=Ec(u,Math.sqrt(.0729-u*u),.25,1)}return this._prevEase={start:Ft.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Tn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(it.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class gb{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _b{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oD{constructor(){this._tap=new hb({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=n[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,n,i))}touchmove(t,n,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const a=n[0],l=a.y-this._swipePoint.y;return this._swipePoint=a,t.preventDefault(),this._active=!0,{zoomDelta:l/128}}}else this._tap.touchmove(t,n,i)}touchend(t,n,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,n,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class UA{constructor(t,n,i){this._el=t,this._mousePan=n,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dc{constructor(t,n,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $A{constructor(t,n,i,a){this._el=t,this._touchZoom=n,this._touchRotate=i,this._tapDragZoom=a,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const yb=e=>e.zoom||e.drag||e.pitch||e.rotate;class NO extends Mt{}class HA{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const i=G.sub([],n,t);this.radius=G.length(i[2]<0?G.div([],i,this.constants):[i[0],i[1],0])}projectRay(t){G.div(t,t,this.constants),G.normalize(t,t),G.mul(t,t,this.constants);const n=G.scale([],t,this.radius);if(n[2]>0){const i=G.scale([],[0,0,1],G.dot(n,[0,0,1])),a=G.scale([],G.normalize([],[n[0],n[1],0]),this.radius),l=G.add([],n,G.scale([],G.sub([],G.add([],a,i),n),2));n[0]=l[0],n[1]=l[1]}return n}}function lh(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class GA{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new AO(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new HA,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),ui(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[it.document,"mousemove",{capture:!0}],[it.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[it,"blur",void 0]];for(const[a,l,u]of this._listeners)a.addEventListener(l,a===it.document?this.handleWindowEvent:this.handleEvent,u)}destroy(){for(const[t,n,i]of this._listeners)t.removeEventListener(n,t===it.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(t){const n=this._map,i=n.getCanvasContainer();this._add("mapEvent",new JT(n,t));const a=n.boxZoom=new NA(n,t);this._add("boxZoom",a);const l=new zA,u=new _b;n.doubleClickZoom=new gb(u,l),this._add("tapZoom",l),this._add("clickZoom",u);const d=new oD;this._add("tapDragZoom",d);const f=n.touchPitch=new RO(n);this._add("touchPitch",f);const p=new fb(t),g=new pb(t);n.dragRotate=new dc(t,p,g),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",g,["mouseRotate"]);const _=new eD(t),v=new nD(n,t);n.dragPan=new UA(i,_,v),this._add("mousePan",_),this._add("touchPan",v,["touchZoom","touchRotate"]);const x=new PO,b=new rD;n.touchZoomRotate=new $A(i,b,x,d),this._add("touchRotate",x,["touchPan","touchZoom"]),this._add("touchZoom",b,["touchPan","touchRotate"]),this._add("blockableMapEvent",new KT(n));const E=n.scrollZoom=new FO(n,this);this._add("scrollZoom",E,["mousePan"]);const T=n.keyboard=new kO;this._add("keyboard",T);for(const C of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[C]&&n[C].enable(t[C])}_add(t,n,i){this._handlers.push({handlerName:t,handler:n,allowed:i}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yb(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,i){for(const a in t)if(a!==i&&(!n||n.indexOf(a)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const i of t)this._el.contains(i.target)&&n.push(i);return n}handleEvent(t,n){this._updatingCamera=!0;const i="renderFrame"===t.type,a=i?void 0:t,l={needsRenderFrame:!1},u={},d={},f=t.touches?this._getMapTouches(t.touches):void 0,p=f?ar(this._el,f):i?void 0:Sf(this._el,t);for(const{handlerName:v,handler:x,allowed:b}of this._handlers){if(!x.isEnabled())continue;let E;this._blockedByActive(d,b,v)?x.reset():x[n||t.type]&&(E=x[n||t.type](t,p,f),this.mergeHandlerResult(l,u,E,v,a),E&&E.needsRenderFrame&&this._triggerRenderFrame()),(E||x.isActive())&&(d[v]=x)}const g={};for(const v in this._previousActiveHandlers)d[v]||(g[v]=a);this._previousActiveHandlers=d,(Object.keys(g).length||lh(l))&&(this._changes.push([l,u,g]),this._triggerRenderFrame()),(Object.keys(d).length||lh(l))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:_}=l;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))}mergeHandlerResult(t,n,i,a,l){if(!i)return;qt(t,i);const u={handlerName:a,originalEvent:i.originalEvent||l};void 0!==i.zoomDelta&&(n.zoom=u),void 0!==i.panDelta&&(n.drag=u),void 0!==i.pitchDelta&&(n.pitch=u),void 0!==i.bearingDelta&&(n.rotate=u)}_applyChanges(){const t={},n={},i={};for(const[a,l,u]of this._changes)a.panDelta&&(t.panDelta=(t.panDelta||new tt(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.aroundCoord&&(t.aroundCoord=a.aroundCoord),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),qt(n,l),qt(i,u);this._updateMapTransform(t,n,i),this._changes=[]}_updateMapTransform(t,n,i){const a=this._map,l=a.transform,u=D=>[D.x,D.y,D.z];if((D=>{const A=this._eventsInProgress.drag;return A&&!this._handlersById[A.handlerName].isActive()})()&&!lh(t)){const D=l.zoom;l.cameraElevationReference="sea",null!=this._originalZoom&&l._orthographicProjectionAtLowPitch&&"globe"!==l.projection.name&&0===l.pitch?(l.cameraElevationReference="ground",l.zoom=this._originalZoom):(l.recenterOnTerrain(),l.cameraElevationReference="ground"),D!==l.zoom&&this._map._update(!0)}if(l._isCameraConstrained&&a._stop(!0),!lh(t))return void this._fireEvents(n,i,!0);let{panDelta:d,zoomDelta:f,bearingDelta:p,pitchDelta:g,around:_,aroundCoord:v,pinchAround:x}=t;l._isCameraConstrained&&(f>0&&(f=0),l._isCameraConstrained=!1),void 0!==x&&(_=x),(f||(D=>n[D]&&!this._eventsInProgress[D])("drag"))&&_&&(this._dragOrigin=u(l.pointCoordinate3D(_)),this._originalZoom=l.zoom,this._trackingEllipsoid.setup(l._camera.position,this._dragOrigin)),l.cameraElevationReference="sea",a._stop(!0),_=_||a.transform.centerPoint,p&&(l.bearing+=p),g&&(l.pitch+=g),l._updateCameraState();const b=[0,0,0];if(d)if("mercator"===l.projection.name){const D=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(_).dir),A=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(_.sub(d)).dir);b[0]=A[0]-D[0],b[1]=A[1]-D[1]}else{const D=l.pointCoordinate(_);if("globe"===l.projection.name){d=d.rotate(-l.angle);const A=l._pixelsPerMercatorPixel/l.worldSize;b[0]=-d.x*Z0(zr(D.y))*A,b[1]=-d.y*Z0(l.center.lat)*A}else{const A=l.pointCoordinate(_.sub(d));D&&A&&(b[0]=A.x-D.x,b[1]=A.y-D.y)}}const E=l.zoom,T=[0,0,0];if(f){const D=u(v||l.pointCoordinate3D(_)),A={dir:G.normalize([],G.sub([],D,l._camera.position))};if(A.dir[2]<0){const P=l.zoomDeltaToMovement(D,f);G.scale(T,A.dir,P)}}const C=G.add(b,b,T);l._translateCameraConstrained(C),f&&Math.abs(l.zoom-E)>1e-4&&l.recenterOnTerrain(),l.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,i,!0)}_fireEvents(t,n,i){const a=yb(this._eventsInProgress),l=yb(t),u={};for(const g in t){const{originalEvent:_}=t[g];this._eventsInProgress[g]||(u[`${g}start`]=_),this._eventsInProgress[g]=t[g]}!a&&l&&this._fireEvent("movestart",l.originalEvent);for(const g in u)this._fireEvent(g,u[g]);l&&this._fireEvent("move",l.originalEvent);for(const g in t){const{originalEvent:_}=t[g];this._fireEvent(g,_)}const d={};let f;for(const g in this._eventsInProgress){const{handlerName:_,originalEvent:v}=this._eventsInProgress[g];this._handlersById[_].isActive()||(delete this._eventsInProgress[g],f=n[_]||v,d[`${g}end`]=f)}for(const g in d)this._fireEvent(g,d[g]);const p=yb(this._eventsInProgress);if(i&&(a||l)&&!p){this._updatingCamera=!0;const g=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),_=v=>0!==v&&-this._bearingSnap<v&&v<this._bearingSnap;g?(_(g.bearing||this._map.getBearing())&&(g.bearing=0),this._map.easeTo(g,{originalEvent:f})):(this._map.fire(new Mt("moveend",{originalEvent:f})),_(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new Mt(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new NO("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const vb="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qA extends wr{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=!1!==n.respectPrefersReducedMotion,ui(["_renderFrameCallback"],this)}getCenter(){return new _e(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,i){return t=tt.convert(t).mult(-1),this.panTo(this.transform.center,qt({offset:t},n),i)}panTo(t,n,i){return this.easeTo(qt({center:t},n),i)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,i){return this.easeTo(qt({zoom:t},n),i)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,i){return this.easeTo(qt({bearing:t},n),i)}resetNorth(t,n){return this.rotateTo(0,qt({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(qt({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Rs.convert(t);const i=n&&n.bearing||0,a=n&&n.pitch||0,l=t.getNorthWest(),u=t.getSouthEast();return this._cameraForBounds(this.transform,l,u,i,a,n)}_extendCameraOptions(t){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=qt({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const i=t.padding;t.padding={top:i,bottom:i,right:i,left:i}}return t.padding=qt(n,t.padding),t}_minimumAABBFrustumDistance(t,n){const i=n.max[0]-n.min[0],a=n.max[1]-n.min[1];return i/a>t.aspect?i/(2*Math.tan(.5*t.fovX)*t.aspect):a/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,i,a,l,u){const d=t.clone(),f=this._extendCameraOptions(u);d.bearing=a,d.pitch=l;const p=_e.convert(n),g=_e.convert(i),_=.5*(p.lat+g.lat),v=.5*(p.lng+g.lng),x=Vo(_,v),b=G.normalize([],x),E=G.normalize([],G.cross([],b,[0,1,0])),T=G.cross([],E,b),C=[E[0],E[1],E[2],0,T[0],T[1],T[2],0,b[0],b[1],b[2],0,0,0,0,1],D=[x,Vo(p.lat,p.lng),Vo(g.lat,p.lng),Vo(g.lat,g.lng),Vo(p.lat,g.lng),Vo(_,p.lng),Vo(_,g.lng),Vo(p.lat,v),Vo(g.lat,v)];let A=$n.fromPoints(D.map(X=>[G.dot(E,X),G.dot(T,X),G.dot(b,X)]));const P=G.transformMat4([],A.center,C);0===G.squaredLength(P)&&G.set(P,0,0,1),G.normalize(P,P),G.scale(P,P,lo),d.center=function([X,rt,ot]){const ct=Math.hypot(X,rt,ot),dt=Math.atan2(X,ot),gt=.5*Math.PI-Math.acos(-rt/ct);return new _e(ti(dt),ti(gt))}(P);const I=d.getWorldToCameraMatrix(),R=nt.invert(new Float64Array(16),I);A=$n.applyTransform(A,nt.multiply([],I,C)),G.transformMat4(P,P,I);const k=.5*(A.max[2]-A.min[2]),L=this._minimumAABBFrustumDistance(d,A),N=G.scale([],[0,0,1],k),z=G.add(N,P,N),j=L+(0===d.pitch?0:G.distance(P,z)),B=d.globeCenterInViewSpace,H=G.sub([],P,[B[0],B[1],B[2]]);G.normalize(H,H),G.scale(H,H,j);const V=G.add([],P,H);G.transformMat4(V,V,R);const Z=Gu/lo,Q=G.length(V),et=xn(Math.max(Q*Z-Gu,Number.EPSILON),0),W=Math.min(d.zoomFromMercatorZAdjusted(et),f.maxZoom);return W>.5*(gp+$c)?(d.setProjection({name:"mercator"}),d.zoom=W,this._cameraForBounds(d,n,i,a,l,u)):{center:d.center,zoom:W,bearing:a,pitch:l}}queryTerrainElevation(t,n){const i=this.transform.elevation;return i?(n=qt({},{exaggerated:!0},n),i.getAtPoint(Ge.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,i,a,l,u){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,n,i,a,l,u);const d=t.clone(),f=this._extendCameraOptions(u),p=d.padding;d.bearing=a,d.pitch=l;const g=_e.convert(n),_=_e.convert(i),v=new _e(g.lng,_.lat),x=new _e(_.lng,g.lat),b=d.project(g),E=d.project(_),T=this.queryTerrainElevation(g),C=this.queryTerrainElevation(_),D=this.queryTerrainElevation(v),A=this.queryTerrainElevation(x),P=[[b.x,b.y,Math.min(T||0,C||0,D||0,A||0)],[E.x,E.y,Math.max(T||0,C||0,D||0,A||0)]];let I=$n.fromPoints(P);const R=d.getWorldToCameraMatrix(),k=nt.invert(new Float64Array(16),R);I=$n.applyTransform(I,R);const L=G.sub([],I.max,I.min),N=p.left||0,z=p.right||0,j=p.bottom||0,B=p.top||0,{left:H,right:V,top:Z,bottom:Q}=f.padding,et=.5*(N+z),W=.5*(B+j),X=Math.min(d.scaleZoom(d.scale*Math.min((d.width-(N+z+H+V))/L[0],(d.height-(j+B+Q+Z))/L[1])),f.maxZoom),rt=d.scale/d.zoomScale(X);I=new $n([I.min[0]-(H+et)*rt,I.min[1]-(Q+W)*rt,I.min[2]],[I.max[0]+(V+et)*rt,I.max[1]+(Z+W)*rt,I.max[2]]);const ot=.5*L[2],ct=this._minimumAABBFrustumDistance(d,I),dt=[0,0,1,0];vn.transformMat4(dt,dt,R),vn.normalize(dt,dt);const gt=G.scale([],dt,ct+ot),at=G.add([],I.center,gt),ut=("number"==typeof f.offset.x&&"number"==typeof f.offset.y?new tt(f.offset.x,f.offset.y):tt.convert(f.offset)).rotate(-Ee(a));I.center[0]-=ut.x*rt,I.center[1]+=ut.y*rt,G.transformMat4(I.center,I.center,k),G.transformMat4(at,at,k);const St=[I.center[0],I.center[1],at[2]*d.pixelsPerMeter];G.scale(St,St,1/d.worldSize);const Nt=ls(St[0]),zt=zr(St[1]),Vt=Math.min(d._zoomFromMercatorZ(St[2]),f.maxZoom),Kt=new _e(Nt,zt);return d.mercatorFromTransition&&Vt<.5*(gp+$c)?(d.setProjection({name:"globe"}),d.zoom=Vt,this._cameraForBounds(d,n,i,a,l,u)):{center:Kt,zoom:Vt,bearing:a,pitch:l}}fitBounds(t,n,i){const a=this.cameraForBounds(t,n);return this._fitInternal(a,n,i)}fitScreenCoordinates(t,n,i,a,l){const u=tt.convert(t),d=tt.convert(n),f=new tt(Math.min(u.x,d.x),Math.min(u.y,d.y)),p=new tt(Math.max(u.x,d.x),Math.max(u.y,d.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(u,d))return this;const g=this.transform.pointLocation3D(f),_=this.transform.pointLocation3D(p),v=this.transform.pointLocation3D(new tt(f.x,p.y)),x=this.transform.pointLocation3D(new tt(p.x,f.y)),b=[Math.min(g.lng,_.lng,v.lng,x.lng),Math.min(g.lat,_.lat,v.lat,x.lat)],E=[Math.max(g.lng,_.lng,v.lng,x.lng),Math.max(g.lat,_.lat,v.lat,x.lat)],T=a&&a.pitch?a.pitch:this.getPitch(),C=this._cameraForBounds(this.transform,b,E,i,T,a);return this._fitInternal(C,a,l)}_fitInternal(t,n,i){return t?(delete(n=qt(t,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(t,n){this.stop();const i=t.preloadOnly?this.transform.clone():this.transform;let a=!1,l=!1,u=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(a=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=_e.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(l=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(u=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),t.preloadOnly?(this._preloadTiles(i),this):(this.fire(new Mt("movestart",n)).fire(new Mt("move",n)),a&&this.fire(new Mt("zoomstart",n)).fire(new Mt("zoom",n)).fire(new Mt("zoomend",n)),l&&this.fire(new Mt("rotatestart",n)).fire(new Mt("rotate",n)).fire(new Mt("rotateend",n)),u&&this.fire(new Mt("pitchstart",n)).fire(new Mt("pitch",n)).fire(new Mt("pitchend",n)),this.fire(new Mt("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||K(vb),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const i=this.transform;if(!i.projection.supportsFreeCamera)return K(vb),this;this.stop();const a=i.zoom,l=i.pitch,u=i.bearing;i.setFreeCameraOptions(t);const d=a!==i.zoom,f=l!==i.pitch,p=u!==i.bearing;return this.fire(new Mt("movestart",n)).fire(new Mt("move",n)),d&&this.fire(new Mt("zoomstart",n)).fire(new Mt("zoom",n)).fire(new Mt("zoomend",n)),p&&this.fire(new Mt("rotatestart",n)).fire(new Mt("rotate",n)).fire(new Mt("rotateend",n)),f&&this.fire(new Mt("pitchstart",n)).fire(new Mt("pitch",n)).fire(new Mt("pitchend",n)),this.fire(new Mt("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=qt({offset:[0,0],duration:500,easing:Un},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const i=this.transform,a=this.getZoom(),l=this.getBearing(),u=this.getPitch(),d=this.getPadding(),f="zoom"in t?+t.zoom:a,p="bearing"in t?this._normalizeBearing(t.bearing,l):l,g="pitch"in t?+t.pitch:u,_="padding"in t?t.padding:i.padding,v=tt.convert(t.offset);let x,b,E;if("globe"===i.projection.name){const N=Ge.fromLngLat(i.center),z=v.rotate(-i.angle);N.x+=z.x/i.worldSize,N.y+=z.y/i.worldSize;const j=N.toLngLat(),B=_e.convert(t.center||j);this._normalizeCenter(B),x=i.centerPoint.add(z),b=new tt(N.x,N.y).mult(i.worldSize),E=new tt(Li(B.lng),Gi(B.lat)).mult(i.worldSize).sub(b)}else{x=i.centerPoint.add(v);const N=i.pointLocation(x),z=_e.convert(t.center||N);this._normalizeCenter(z),b=i.project(N),E=i.project(z).sub(b)}const T=i.zoomScale(f-a);let C,D;t.around&&(C=_e.convert(t.around),D=i.locationPoint(C));const A=this._zooming||f!==a,P=this._rotating||l!==p,I=this._pitching||g!==u,R=!i.isPaddingEqual(_),k=N=>z=>{if(A&&(N.zoom=ue(a,f,z)),P&&(N.bearing=ue(l,p,z)),I&&(N.pitch=ue(u,g,z)),R&&(N.interpolatePadding(d,_,z),x=N.centerPoint.add(v)),C)N.setLocationAtPoint(C,D);else{const j=N.zoomScale(N.zoom-a),B=f>a?Math.min(2,T):Math.max(.5,T),H=Math.pow(B,1-z),V=N.unproject(b.add(E.mult(z*H)).mult(j));N.setLocationAtPoint(N.renderWorldCopies?V.wrap():V,x)}return t.preloadOnly||this._fireMoveEvents(n),N};if(t.preloadOnly){const N=this._emulate(k,t.duration,i);return this._preloadTiles(N),this}const L={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=A,this._rotating=P,this._pitching=I,this._padding=R,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,L),this._ease(k(i),N=>{"sea"===i.cameraElevationReference&&i.recenterOnTerrain(),this._afterEase(n,N)},t),this}_prepareEase(t,n,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),n||i.moving||this.fire(new Mt("movestart",t)),this._zooming&&!i.zooming&&this.fire(new Mt("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new Mt("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new Mt("pitchstart",t))}_fireMoveEvents(t){this.fire(new Mt("move",t)),this._zooming&&this.fire(new Mt("zoom",t)),this._rotating&&this.fire(new Mt("rotate",t)),this._pitching&&this.fire(new Mt("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const i=this._zooming,a=this._rotating,l=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new Mt("zoomend",t)),a&&this.fire(new Mt("rotateend",t)),l&&this.fire(new Mt("pitchend",t)),this.fire(new Mt("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const X=Ro(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(X,n)}this.stop(),t=qt({offset:[0,0],speed:1.2,curve:1.42,easing:Un},t);const i=this.transform,a=this.getZoom(),l=this.getBearing(),u=this.getPitch(),d=this.getPadding(),f="zoom"in t?Wt(+t.zoom,i.minZoom,i.maxZoom):a,p="bearing"in t?this._normalizeBearing(t.bearing,l):l,g="pitch"in t?+t.pitch:u,_="padding"in t?t.padding:i.padding,v=i.zoomScale(f-a),x=tt.convert(t.offset);let b=i.centerPoint.add(x);const E=i.pointLocation(b),T=_e.convert(t.center||E);this._normalizeCenter(T);const C=i.project(E),D=i.project(T).sub(C);let A=t.curve;const P=Math.max(i.width,i.height),I=P/v,R=D.mag();if("minZoom"in t){const X=Wt(Math.min(t.minZoom,a,f),i.minZoom,i.maxZoom),rt=P/i.zoomScale(X-a);A=Math.sqrt(rt/R*2)}const k=A*A;function L(X){const rt=(I*I-P*P+(X?-1:1)*k*k*R*R)/(2*(X?I:P)*k*R);return Math.log(Math.sqrt(rt*rt+1)-rt)}function N(X){return(Math.exp(X)-Math.exp(-X))/2}function z(X){return(Math.exp(X)+Math.exp(-X))/2}const j=L(0);let B=function(X){return z(j)/z(j+A*X)},H=function(X){return P*((z(j)*(N(rt=j+A*X)/z(rt))-N(j))/k)/R;var rt},V=(L(1)-j)/A;if(Math.abs(R)<1e-6||!isFinite(V)){if(Math.abs(P-I)<1e-6)return this.easeTo(t,n);const X=I<P?-1:1;V=Math.abs(Math.log(I/P))/A,H=function(){return 0},B=function(rt){return Math.exp(X*A*rt)}}t.duration="duration"in t?+t.duration:1e3*V/("screenSpeed"in t?+t.screenSpeed/A:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Z=l!==p,Q=g!==u,et=!i.isPaddingEqual(_),W=X=>rt=>{const ot=rt*V,ct=1/B(ot);X.zoom=1===rt?f:a+X.scaleZoom(ct),Z&&(X.bearing=ue(l,p,rt)),Q&&(X.pitch=ue(u,g,rt)),et&&(X.interpolatePadding(d,_,rt),b=X.centerPoint.add(x));const dt=1===rt?T:X.unproject(C.add(D.mult(H(ot))).mult(ct));return X.setLocationAtPoint(X.renderWorldCopies?dt.wrap():dt,b),X._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),X};if(t.preloadOnly){const X=this._emulate(W,t.duration,i);return this._preloadTiles(X),this}return this._zooming=!0,this._rotating=Z,this._pitching=Q,this._padding=et,this._prepareEase(n,!1),this._ease(W(i),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const i=this._onEaseEnd;this._onEaseEnd=void 0,i.call(this,n)}if(!t){const i=this.handlers;i&&i.stop(!1)}return this}_ease(t,n,i){!1===i.animate||0===i.duration?(t(1),n()):(this._easeStart=Ft.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((Ft.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=Ja(t,-180,180);const i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.maxBounds)return;const i=t.lng-n.center.lng;t.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&Ft.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,i){const a=Math.ceil(15*n/1e3),l=[],u=t(i.clone());for(let d=0;d<=a;d++){const f=u(d/a);l.push(f.clone())}return l}}class ZA{constructor(t={}){this.options=t,ui(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact;return this._map=t,this._container=Tn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Tn("button","mapboxgl-ctrl-attrib-button",this._container),Tn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Tn("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===n&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const i=this._map._getUIString(`AttributionControl.${n}`);t.setAttribute("aria-label",i),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||ke.ACCESS_TOKEN}];if(t){const i=n.reduce((a,l,u)=>(l.value&&(a+=`${l.key}=${l.value}${u<n.length-1?"&":""}`),a),"?");t.href=`${ke.FEEDBACK_URL}/${i}#${XT(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const a=this._map.style.stylesheet;this.styleOwner=a.owner,this.styleId=a.id}const n=this._map.style._mergedSourceCaches;for(const a in n){const l=n[a];if(l.used){const u=l.getSource();u.attribution&&t.indexOf(u.attribution)<0&&t.push(u.attribution)}}t.sort((a,l)=>a.length-l.length),t=t.filter((a,l)=>{for(let u=l+1;u<t.length;u++)if(t[u].indexOf(a)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class sD{constructor(){ui(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Tn("div","mapboxgl-ctrl");const n=Tn("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const n in t){const i=t[n].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class uf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,i=n?this._queue.concat(n):this._queue;for(const a of i)if(a.id===t)return void(a.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const i of n)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Rm(e,t,n){if(e=new _e(e.lng,e.lat),t){const i=new _e(e.lng-360,e.lat),a=new _e(e.lng+360,e.lat),l=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),u=n.locationPoint(e).distSqr(t),d=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(i).distSqr(t)<u&&(d||Math.abs(i.lng-n.center.lng)<l)?e=i:n.locationPoint(a).distSqr(t)<u&&(d||Math.abs(a.lng-n.center.lng)<l)&&(e=a)}for(;Math.abs(e.lng-n.center.lng)>180;){const i=n.locationPoint(e);if(i.x>=0&&i.y>=0&&i.x<=n.width&&i.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const xb={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class bb extends wr{constructor(t,n){if(super(),(t instanceof it.HTMLElement||n)&&(t=qt({element:t},n)),ui(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=tt.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Tn("div");const l=41,u=27,d=da("svg",{display:"block",height:l*this._scale+"px",width:u*this._scale+"px",viewBox:`0 0 ${u} ${l}`},this._element),f=da("radialGradient",{id:"shadowGradient"},da("defs",{},d));da("stop",{offset:"10%","stop-opacity":.4},f),da("stop",{offset:"100%","stop-opacity":.05},f),da("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d),da("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),da("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),da("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),this._offset=tt.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()});const i=this._element.classList;for(const l in xb)i.remove(`mapboxgl-marker-anchor-${l}`);i.add(`mapboxgl-marker-anchor-${this._anchor}`);const a=t&&t.className?t.className.trim().split(/\s+/):[];i.add(...a),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=_e.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const a=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[a,-1*(24.6+a)],"bottom-right":[-a,-1*(24.6+a)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,i=t.charCode||t.keyCode;"Space"!==n&&"Enter"!==n&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,i=this._element;this._popup&&(n===i||i.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const i=t.unproject(n),a=t.getFreeCameraOptions();if(!a.position)return!1;const l=a.position.toLngLat();return l.distanceTo(i)<.9*l.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const i=t.unproject(n);let a;t._showingGlobe()&&p_(t.transform,this._lngLat)?a=0:(a=1-t._queryFogOpacity(i),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(a*=this._occludedOpacity)),this._element.style.opacity=`${a}`,this._element.style.pointerEvents=a>0?"auto":"none",this._popup&&this._popup._setOpacity(a),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${xb[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${n.x}px,${n.y}px)\n        `}_calculateXYTransform(){const t=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!t||"map"!==i)return"";if(!n._showingGlobe()){const f=n.getPitch();return f?`rotateX(${f}deg)`:""}const a=ti(qE(n.transform,this._lngLat)),l=t.sub(GE(n.transform)),u=Math.abs(l.x)+Math.abs(l.y);if(0===u)return"";const d=a/u;return`rotateX(${-l.y*d}deg) rotateY(${l.x*d}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let i=0;const a=this.getRotationAlignment();if("map"===a)if(n._showingGlobe()){const l=n.project(new _e(this._lngLat.lng,this._lngLat.lat+.001)),u=n.project(new _e(this._lngLat.lng,this._lngLat.lat-.001)).sub(l);i=ti(Math.atan2(u.y,u.x))-90}else i=-n.getBearing();else if("horizon"===a){const l=Ya(4,6,n.getZoom()),u=GE(n.transform);u.y+=l*n.transform.height;const d=t.sub(u),f=ti(Math.atan2(d.y,d.x));i=(f>90?f-270:f+90)*(1-l)}return i+=this._rotation,i?`rotateZ(${i}deg)`:""}_update(t){it.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Rm(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===t?this._updateFrameId=it.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=tt.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const i=this._pointerdownPos,a=this._positionDelta;if(i&&a){if(!this._isDragging){const l=this._clickTolerance||n._clickTolerance;if(t.point.dist(i)<l)return;this._isDragging=!0}this._pos=t.point.sub(a),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Mt("dragstart"))),this.fire(new Mt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Mt("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,i=this._pos;n&&i&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(i),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const WA={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},XA=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function aD(e=new tt(0,0),t="bottom"){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new tt(0,e);case"top-left":return new tt(n,n);case"top-right":return new tt(-n,n);case"bottom":return new tt(0,-e);case"bottom-left":return new tt(n,-n);case"bottom-right":return new tt(-n,-n);case"left":return new tt(e,0);case"right":return new tt(-e,0)}return new tt(0,0)}return e instanceof tt||Array.isArray(e)?tt.convert(e):tt.convert(e[t]||[0,0])}class YA{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=wc((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,i){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+i}}const wb={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},JA={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},KA={showCompass:!0,showZoom:!0,visualizePitch:!1};class QA{constructor(t,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new fb({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new pb({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),ui(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),tr()}move(t,n){const i=this.map,a=this.mouseRotate.mousemoveWindow(t,n),l=a&&a.bearingDelta;if(l&&i.setBearing(i.getBearing()+l),this.mousePitch){const u=this.mousePitch.mousemoveWindow(t,n),d=u&&u.pitchDelta;d&&i.setPitch(i.getPitch()+d)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Tf(),it.removeEventListener("mousemove",this.mousemove),it.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(qt({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Sf(this.element,t)),it.addEventListener("mousemove",this.mousemove),it.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Sf(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=ar(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=ar(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const tP={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},eP={maxWidth:100,unit:"metric"},nP={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},qy={version:la,supported:hw,setRTLTextPlugin:function(e,t,n=!1){if(ts===e0||ts===n0||ts===Ot)throw new Error("setRTLTextPlugin cannot be called multiple times.");Nc=Ft.resolveURL(e),ts=e0,Dn=t,Og(),n||kg()},getRTLTextPluginStatus:Xs,Map:class extends qA{constructor(e){if(Cv.mark(Mf.create),null!=(e=qt({},JA,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(t){const n=t.navigator?t.navigator.userAgent:null;return!!function(i){if(null==me){const a=i.navigator?i.navigator.userAgent:null;me=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return me}(t)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(it)&&(e.antialias=!1,K("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new t1(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new uf,this._domRenderTaskQueue=new uf,this._controls=[],this._markers=[],this._popups=[],this._mapId=Ar(),this._locale=qt({},wb,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new YA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new re(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=it.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof it.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&K("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),ui(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==it&&(this._fullscreenchangeEvent="onfullscreenchange"in it.document?"fullscreenchange":"webkitfullscreenchange",it.addEventListener("online",this._onWindowOnline,!1),it.addEventListener("resize",this._onWindowResize,!1),it.addEventListener("orientationchange",this._onWindowResize,!1),it.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),it.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new GA(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||ke.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new WT("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const t=e.bounds;t&&(this.resize(),this.fitBounds(t,qt({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new ZA({customAttribution:e.customAttribution})),this._logoControl=new sD,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new Mt(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new Mt(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new pt(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[t];return-1!==t.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new pt(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new Mt("movestart",e)).fire(new Mt("move",e)),this.fire(new Mt("resize",e)),t&&this.fire(new Mt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Rs.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Mt("zoomstart")).fire(new Mt("zoom")).fire(new Mt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Mt("zoomstart")).fire(new Mt("zoom")).fire(new Mt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Mt("pitchstart")).fire(new Mt("pitch")).fire(new Mt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Mt("pitchstart")).fire(new Mt("pitch")).fire(new Mt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?it.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(t=>"auto"===t?it.navigator.language:t):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.clearSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,t=e.projection.name;let n;"globe"===t&&e.zoom>=$c?(e.setMercatorFromTransition(),n=!0):"mercator"===t&&e.zoom<$c&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t="globe"===e.name&&this.transform.zoom>=$c?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(_e.convert(e))}unproject(e){return this.transform.pointLocation3D(tt.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let i=!1;const a=u=>{const d=t.filter(p=>this.getLayer(p)),f=d.length?this.queryRenderedFeatures(u.point,{layers:d}):[];f.length?i||(i=!0,n.call(this,new zs(e,this,u.originalEvent,{features:f}))):i=!1},l=()=>{i=!1};return{layers:new Set(t),listener:n,delegates:{mousemove:a,mouseout:l}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const a=u=>{const d=t.filter(f=>this.getLayer(f));(d.length?this.queryRenderedFeatures(u.point,{layers:d}):[]).length?i=!0:i&&(i=!1,n.call(this,new zs(e,this,u.originalEvent)))},l=u=>{i&&(i=!1,n.call(this,new zs(e,this,u.originalEvent)))};return{layers:new Set(t),listener:n,delegates:{mousemove:a,mouseout:l}}}{const i=a=>{const l=t.filter(d=>this.getLayer(d)),u=l.length?this.queryRenderedFeatures(a.point,{layers:l}):[];u.length&&(a.features=u,n.call(this,a),delete a.features)};return{layers:new Set(t),listener:n,delegates:{[e]:i}}}}on(e,t,n){if(void 0===n)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const a of t)if(!this._isValidId(a))return this;const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const a in i.delegates)this.on(a,i.delegates[a]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const a of t)if(!this._isValidId(a))return this;const i=this._createDelegatedListener(e,t,n);for(const a in i.delegates)this.once(a,i.delegates[a]);return this}off(e,t,n){if(void 0===n)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const l of t)if(!this._isValidId(l))return this;const i=(l,u)=>{if(l.size!==u.size)return!1;for(const d of l)if(!u.has(d))return!1;return!0},a=this._delegatedListeners?this._delegatedListeners[e]:void 0;return a&&(l=>{for(let u=0;u<l.length;u++){const d=l[u];if(d.listener===n&&i(d.layers,t)){for(const f in d.delegates)this.off(f,d.delegates[f]);return l.splice(u,1),this}}})(a),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(void 0!==t||void 0===e||e instanceof tt||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const n of t.layers)if(!this._isValidId(n))return[];return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&K(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(tt.convert(e))}setStyle(e,t){return!1!==(t=qt({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new Ns(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),i=this._requestManager.transformRequest(n,ft.Style);At(i,(a,l)=>{a?this.fire(new pt(a)):l&&this._updateDiff(l,t)})}else"object"==typeof e&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(n){K(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(K("There is no style added to the map."),!1)}_isValidId(e){return!(t=e,t.indexOf("\x1f")>=0&&(this.fire(new pt(new Error(`IDs can't contain special symbols: "${e}".`))),1));var t}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const n=e[t]._tiles;for(const i in n){const a=n[i];if("loaded"!==a.state&&"errored"!==a.state)return!1}}return!0}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:n=1,sdf:i=!1,stretchX:a,stretchY:l,content:u}={}){if(this._lazyInitEmptyStyle(),t instanceof it.HTMLImageElement||it.ImageBitmap&&t instanceof it.ImageBitmap){const{width:d,height:f,data:p}=Ft.getImageData(t);this.style.addImage(e,{data:new ur({width:d,height:f},p),pixelRatio:n,stretchX:a,stretchY:l,content:u,sdf:i,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new pt(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:d,height:f}=t,p=t;this.style.addImage(e,{data:new ur({width:d,height:f},new Uint8Array(p.data)),pixelRatio:n,stretchX:a,stretchY:l,content:u,sdf:i,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e)}}updateImage(e,t){this._lazyInitEmptyStyle();const n=this.style.getImage(e);if(!n)return void this.fire(new pt(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=t instanceof it.HTMLImageElement||it.ImageBitmap&&t instanceof it.ImageBitmap?Ft.getImageData(t):t,{width:a,height:l}=i;void 0!==a&&void 0!==l?a===n.data.width&&l===n.data.height?(n.data.replace(i.data,!(t instanceof it.HTMLImageElement||it.ImageBitmap&&t instanceof it.ImageBitmap)),this.style.updateImage(e,n)):this.fire(new pt(new Error(`The width and height of the updated image (${a}, ${l})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new pt(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new pt(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){Te(this._requestManager.transformRequest(e,ft.Image),(n,i)=>{t(n,i instanceof it.HTMLImageElement?Ft.getImageData(i):i)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new pt(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t,n={}){return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n,i={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,i),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n,i={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,i),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(_e.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,i,a,l=this._container;for(;l&&(!i||!a);){const u=it.getComputedStyle(l).transform;u&&"none"!==u&&(n=u.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(i=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(a=n[3])),l=l.parentElement}this._containerWidth=i?Math.abs(e/i):e,this._containerHeight=a?Math.abs(t/a):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==it.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&K("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=Tn("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Tn("div","mapboxgl-canvas-container",e);this._canvas=Tn("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Tn("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{i[a]=Tn("div",`mapboxgl-ctrl-${a}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const n=Ft.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const e=qt({},hw.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(cw(t,!0),this.painter=new ob(t,this.transform),this.on("data",n=>{"source"===n.dataType&&this.painter.setTileLoadedFlag(!0)}),ws.testSupport(t)):this.fire(new pt(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Mt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Mt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let t;this.fire(new Mt("renderstart"));const n=this.painter.context.extTimerQuery,i=Ft.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=a.createQuery(),a.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],it.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],it.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const f=this.transform.zoom,p=this.transform.pitch,g=Ft.now(),_=new er(f,{now:g,fadeDuration:l,pitch:p,transition:this.style.transition});this.style.update(_)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let u=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),u=this._updateAverageElevation(i),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):u=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Mt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Mt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const f=Ft.now()-i;a.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const p=a.getQueryParameter(t,a.QUERY_RESULT)/1e6;a.deleteQuery(t),this.fire(new Mt("gpu-timing-frame",{cpuTime:f,gpuTime:p})),it.performance.mark("frame-gpu",{startTime:i,detail:{gpuTime:p}})},50)}if(this.listens("gpu-timing-layer")){const f=this.painter.collectGpuTimers();setTimeout(()=>{const p=this.painter.queryGpuTimers(f);this.fire(new Mt("gpu-timing-layer",{layerTimes:p}))},50)}if(this.listens("gpu-timing-deferred-render")){const f=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const p=this.painter.queryGpuTimeDeferredRender(f);this.fire(new Mt("gpu-timing-deferred-render",{gpuTime:p}))},50)}const d=this._sourcesDirty||this._styleDirty||this._placementDirty||u;if(d||this._repaint)this.triggerRepaint();else{const f=!this.isMoving()&&this.loaded();if(f&&(u=this._updateAverageElevation(i,!0)),u)this.triggerRepaint();else if(this._triggerFrame(!1),f&&(this.fire(new Mt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const p=this._calculateSpeedIndex();this.fire(new Mt("speedindexcompleted",{speedIndex:p})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,Cv.mark(Mf.fullLoad),this._performanceMetricsCollection&&o2(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const n=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const a=this.transform.averageElevation;let l=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(l)?l=0:this._averageElevationLastSampledAt=e;const u=Math.abs(a-l);if(u>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(l),n(l);this._averageElevation.easeTo(l,e,300)}else if(u>1e-4)return this._averageElevation.jumpTo(l),n(l)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){lw(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===mn||401===e.status)){const t=this.painter.context.gl;cw(t,!1),this._logoControl instanceof sD&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new pt(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),qR(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function a(l){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,l,0);const u=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,u),u}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(a(e),t.canvasCopies.map(a),t.timeStamps)}_canvasPixelComparison(e,t,n){let i=n[1]-n[0];const a=e.length/4;for(let l=0;l<t.length;l++){const u=t[l];let d=0;for(let f=0;f<u.length;f+=4)u[f]===e[f]&&u[f+1]===e[f+1]&&u[f+2]===e[f+2]&&u[f+3]===e[f+3]&&(d+=1);i+=(n[l+2]-n[l+1])*(1-d/a)}return i}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==it&&(it.removeEventListener("resize",this._onWindowResize,!1),it.removeEventListener("orientationchange",this._onWindowResize,!1),it.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),it.removeEventListener("online",this._onWindowOnline,!1),it.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Sc.delete(this.painter.context.gl),this._removed=!0,this.fire(new Mt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=Ft.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(e){return xu(this.style?Object.values(this.style._sourceCaches):[],(t,n)=>t._preloadTiles(e,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===it.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){to=e,go=t}get version(){return la}},NavigationControl:class{constructor(e){this.options=qt({},KA,e),this._container=Tn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(ui(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Tn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Tn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(ui(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Tn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),i=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new QA(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=Tn("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends wr{constructor(e){super(),this.options=qt({geolocation:it.navigator.geolocation},tP,e),ui(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kA(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=Tn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,e(n)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==it.navigator.permissions?it.navigator.permissions.query({name:"geolocation"}).then(n=>t("denied"!==n.state)).catch(()=>t()):t()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Mt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Mt("geolocate",e)),this._finish()}}_updateCamera(e){const t=new _e(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,i=qt({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),i,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new _e(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=xn(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Mt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Tn("button","mapboxgl-ctrl-geolocate",this._container),Tn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){K("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Tn("div","mapboxgl-user-location"),this._dotElement.appendChild(Tn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Tn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new bb({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Tn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bb({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Mt("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return K("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Mt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Mt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Mt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{it.addEventListener("ondeviceorientationabsolute"in it?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==it.DeviceMotionEvent&&"function"==typeof it.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),it.removeEventListener("deviceorientation",this._onDeviceOrientation),it.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ZA,ScaleControl:class{constructor(e){this.options=qt({},eP,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),ui(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,i=t._containerWidth/2-e/2,a=t.unproject([i,n]),l=t.unproject([i+e,n]),u=a.distanceTo(l);if("imperial"===this.options.unit){const d=3.2808*u;d>5280?this._setScale(e,d/5280,"mile"):this._setScale(e,d,"foot")}else"nautical"===this.options.unit?this._setScale(e,u/1852,"nautical-mile"):u>=1e3?this._setScale(e,u/1e3,"kilometer"):this._setScale(e,u,"meter")}_setScale(e,t,n){this._map._requestDomTask(()=>{const i=function(l){const u=Math.pow(10,`${Math.floor(l)}`.length-1);let d=l/u;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(f){const p=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*p)/p}(d),u*d}(t),a=i/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):`${i}&nbsp;${nP[n]}`,this._container.style.width=e*a+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=Tn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof it.HTMLElement?this._container=e.container:K("Full screen control 'container' must be a DOM element.")),ui(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in it.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in it.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=Tn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",K("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,it.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!it.document.fullscreenEnabled&&!it.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=Tn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Tn("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),it.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(it.document.fullscreenElement||it.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?it.document.exitFullscreen?it.document.exitFullscreen():it.document.webkitCancelFullScreen&&it.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends wr{constructor(e){super(),this.options=qt(Object.create(WA),e),ui(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Mt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Mt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=_e.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(it.document.createTextNode(e))}setHTML(e){const t=it.document.createDocumentFragment(),n=it.document.createElement("body");let i;for(n.innerHTML=e;i=n.firstChild,i;)t.appendChild(i);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Tn("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const n=this._closeButton=Tn("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,i=this._pos;if(!t||!n||!i)return"bottom";const a=n.offsetWidth,l=n.offsetHeight,u=i.x<a/2,d=i.x>t.transform.width-a/2;if(i.y+e<l)return u?"top-left":d?"top-right":"top";if(i.y>t.transform.height-l){if(u)return"bottom-left";if(d)return"bottom-right"}return u?"left":d?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=Tn("div","mapboxgl-popup",t.getContainer()),this._tip=Tn("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Rm(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const a=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),l=aD(this.options.offset),u=this._anchor=this._getAnchor(l.y),d=aD(this.options.offset,u),f=a.add(d).round();t._requestDomTask(()=>{this._container&&u&&(this._container.style.transform=`${xb[u]} translate(${f.x}px,${f.y}px)`)})}if(!this._marker&&t._showingGlobe()){const a=p_(t.transform,this._lngLat)?0:1;this._setOpacity(a)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(XA);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:bb,Style:Ns,LngLat:_e,LngLatBounds:Rs,Point:tt,MercatorCoordinate:Ge,FreeCameraOptions:lC,Evented:wr,config:ke,prewarm:function(){Yd().acquire(_y)},clearPrewarmedResources:function(){const e=mm;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(_y),mm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return ke.ACCESS_TOKEN},set accessToken(e){ke.ACCESS_TOKEN=e},get baseApiUrl(){return ke.API_URL},set baseApiUrl(e){ke.API_URL=e},get workerCount(){return ih.workerCount},set workerCount(e){ih.workerCount=e},get maxParallelImageRequests(){return ke.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){ke.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){!function(t){if(!Eh())return;const n=it.caches.delete(Nn);t&&n.catch(t).then(()=>t())}(e)},workerUrl:"",workerClass:null,get dracoUrl(){return JC()},set dracoUrl(e){yy=Ft.resolveURL(e),b1||(b1=new dm(Yd(),new wr)),b1.broadcast("setDracoUrl",yy)},setNow:Ft.setNow,restoreNow:Ft.restoreNow};Xt.A=v1,Xt.D=na,Xt.E=lt,Xt.F=Dx,Xt.K=Cy,Xt.O=Ze,Xt.P=tt,Xt.T=uI,Xt.V=Lp,Xt.a=D_,Xt.b=fM,Xt.c=my,Xt.d=class extends wr{constructor(e,t,n,i,a,l){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=a||YC,this.loading={},this.loaded={},this.deduped=new rh(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler,this.brightness=l}loadTile(e,t){const n=e.uid,i=e&&e.request,a=i&&i.collectResourceTiming,l=this.loading[n]=new OI(e);l.abort=this.loadVectorData(e,(u,d)=>{const f=!this.loading[n];if(delete this.loading[n],f||u||!d)return l.status="done",f||(this.loaded[n]=l),t(u);const p=d.rawData,g={};d.expires&&(g.expires=d.expires),d.cacheControl&&(g.cacheControl=d.cacheControl),l.vectorTile=d.vectorTile||new kp(new hr(p));const _=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,(v,x)=>{if(v||!x)return t(v);const b={};if(a){const E=uw(i);E.length>0&&(b.resourceTiming=JSON.parse(JSON.stringify(E)))}t(null,qt({rawTileData:p.slice(0)},x,g,b))})};this.isSpriteLoaded?_():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):_()}),this.loaded=this.loaded||{},this.loaded[n]=l})}reloadTile(e,t){const n=this.loaded,i=e.uid,a=this;if(n&&n[i]){const l=n[i];l.showCollisionBoxes=e.showCollisionBoxes,l.projection=e.projection,l.brightness=e.brightness,l.tileTransform=Kc(e.tileID.canonical,e.projection),l.extraShadowCaster=e.extraShadowCaster;const u=(d,f)=>{const p=l.reloadCallback;p&&(delete l.reloadCallback,l.parse(l.vectorTile,a.layerIndex,this.availableImages,a.actor,p)),t(d,f)};"parsing"===l.status?l.reloadCallback=u:"done"===l.status&&(l.vectorTile?l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,u):u())}}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}},Xt.e=Vl,Xt.f=uw,Xt.g=Zo,Xt.h=At,Xt.i=kt,Xt.j=function(e,t){const n=iT(e);for(const i of n){for(const a of i.meshes)EO(a);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(oT(i.lights,t)))}return n},Xt.k=er,Xt.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==C1){const n=new Uint32Array(e,0,7),[,,i,a,l,u]=n;t=n.byteLength+a+l+u+l,(i!==e.byteLength||t>=e.byteLength)&&K("Invalid b3dm header information.")}return eT(e,t)},Xt.m=Wp,Xt.n=es,Xt.o=Mt,Xt.p=bc,Xt.q=function(e){Wo(),Oo&&Oo.then(t=>{t.keys().then(n=>{for(let i=0;i<n.length-e;i++)t.delete(n[i])})})},Xt.r=lT,Xt.s=qy,Xt.t=Zu,Xt.v=vi,Xt.w=it}),wf(0,function(Xt){function it(It){if("number"==typeof It||"boolean"==typeof It||"string"==typeof It||null==It)return JSON.stringify(It);if(Array.isArray(It)){let q="[";for(const K of It)q+=`${it(K)},`;return`${q}]`}let U="{";for(const q of Object.keys(It).sort())U+=`${q}:${it(It[q])},`;return`${U}}`}function la(It){let U="";for(const q of Xt.r)U+=`/${it(It[q])}`;return U}class Ha{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U,q){this._layerConfigs={},this._layers={},this.update(U,[],q)}update(U,q,K){this._options=K;for(const Et of U){this._layerConfigs[Et.id]=Et;const $t=this._layers[Et.id]=Xt.c(Et,this._options);$t.setScope(this.scope),$t.compileFilter(),this.keyCache[Et.id]&&delete this.keyCache[Et.id]}for(const Et of q)delete this.keyCache[Et],delete this._layerConfigs[Et],delete this._layers[Et];this.familiesBySource={};const vt=function(Et,$t){const Yt={};for(let ee=0;ee<Et.length;ee++){const me=$t&&$t[Et[ee].id]||la(Et[ee]);$t&&($t[Et[ee].id]=me);let ge=Yt[me];ge||(ge=Yt[me]=[]),ge.push(Et[ee])}const wt=[];for(const ee in Yt)wt.push(Yt[ee]);return wt}(Xt.v(this._layerConfigs),this.keyCache);for(const Et of vt){const $t=Et.map(In=>this._layers[In.id]),Yt=$t[0];if("none"===Yt.visibility)continue;const wt=Yt.source||"";let ee=this.familiesBySource[wt];ee||(ee=this.familiesBySource[wt]={});const me=Yt.sourceLayer||"_geojsonTileLayer";let ge=ee[me];ge||(ge=ee[me]=[]),ge.push($t)}}}class ke{loadTile(U,q){const{uid:K,encoding:vt,rawImageData:Et,padding:$t}=U,Yt=Xt.w.ImageBitmap&&Et instanceof Xt.w.ImageBitmap?this.getImageData(Et,$t):Et;q(null,new Xt.D(K,Yt,vt,U.convertToFloat,$t<1))}getImageData(U,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const K=this.offscreenCanvasContext.getImageData(-q,-q,U.width+2*q,U.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),K}}function ws(It,U){if(0!==It.length){ca(It[0],U);for(var q=1;q<It.length;q++)ca(It[q],!U)}}function ca(It,U){for(var q=0,K=0,vt=0,Et=It.length,$t=Et-1;vt<Et;$t=vt++){var Yt=(It[vt][0]-It[$t][0])*(It[$t][1]+It[vt][1]),wt=q+Yt;K+=Math.abs(q)>=Math.abs(Yt)?q-wt+Yt:Yt-wt+q,q=wt}q+K>=0!=!!U&&It.reverse()}var kl=Xt.g(function It(U,q){var K,vt=U&&U.type;if("FeatureCollection"===vt)for(K=0;K<U.features.length;K++)It(U.features[K],q);else if("GeometryCollection"===vt)for(K=0;K<U.geometries.length;K++)It(U.geometries[K],q);else if("Feature"===vt)It(U.geometry,q);else if("Polygon"===vt)ws(U.coordinates,q);else if("MultiPolygon"===vt)for(K=0;K<U.coordinates.length;K++)ws(U.coordinates[K],q);return U});const _u=Xt.V.prototype.toGeoJSON;var xc={exports:{}},Zm=Xt.p,Ef=Xt.a.VectorTileFeature,Zo=Ga;function Ga(It,U){this.options=U||{},this.features=It,this.length=It.length}function qa(It,U){this.id="number"==typeof It.id?It.id:void 0,this.type=It.type,this.rawGeometry=1===It.type?[It.geometry]:It.geometry,this.properties=It.tags,this.extent=U||4096}Ga.prototype.feature=function(It){return new qa(this.features[It],this.options.extent)},qa.prototype.loadGeometry=function(){var It=this.rawGeometry;this.geometry=[];for(var U=0;U<It.length;U++){for(var q=It[U],K=[],vt=0;vt<q.length;vt++)K.push(new Zm(q[vt][0],q[vt][1]));this.geometry.push(K)}return this.geometry},qa.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var It=this.geometry,U=1/0,q=-1/0,K=1/0,vt=-1/0,Et=0;Et<It.length;Et++)for(var $t=It[Et],Yt=0;Yt<$t.length;Yt++){var wt=$t[Yt];U=Math.min(U,wt.x),q=Math.max(q,wt.x),K=Math.min(K,wt.y),vt=Math.max(vt,wt.y)}return[U,K,q,vt]},qa.prototype.toGeoJSON=Ef.prototype.toGeoJSON;var Wm=Xt.b,bc=Zo;function Za(It){var U=new Wm;return function(q,K){for(var vt in q.layers)K.writeMessage(3,tt,q.layers[vt])}(It,U),U.finish()}function tt(It,U){var q;U.writeVarintField(15,It.version||1),U.writeStringField(1,It.name||""),U.writeVarintField(5,It.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<It.length;q++)K.feature=It.feature(q),U.writeMessage(2,tn,K);var vt=K.keys;for(q=0;q<vt.length;q++)U.writeStringField(3,vt[q]);var Et=K.values;for(q=0;q<Et.length;q++)U.writeMessage(4,Mv,Et[q])}function tn(It,U){var q=It.feature;void 0!==q.id&&U.writeVarintField(1,q.id),U.writeMessage(2,yu,It),U.writeVarintField(3,q.type),U.writeMessage(4,ti,q)}function yu(It,U){var q=It.feature,K=It.keys,vt=It.values,Et=It.keycache,$t=It.valuecache;for(var Yt in q.properties){var wt=q.properties[Yt],ee=Et[Yt];if(null!==wt){void 0===ee&&(K.push(Yt),Et[Yt]=ee=K.length-1),U.writeVarint(ee);var me=typeof wt;"string"!==me&&"boolean"!==me&&"number"!==me&&(wt=JSON.stringify(wt));var ge=me+":"+wt,In=$t[ge];void 0===In&&(vt.push(wt),$t[ge]=In=vt.length-1),U.writeVarint(In)}}}function Wa(It,U){return(U<<3)+(7&It)}function Ee(It){return It<<1^It>>31}function ti(It,U){for(var q=It.loadGeometry(),K=It.type,vt=0,Et=0,$t=q.length,Yt=0;Yt<$t;Yt++){var wt=q[Yt],ee=1;1===K&&(ee=wt.length),U.writeVarint(Wa(1,ee));for(var me=3===K?wt.length-1:wt.length,ge=0;ge<me;ge++){1===ge&&1!==K&&U.writeVarint(Wa(2,me-1));var In=wt[ge].x-vt,_r=wt[ge].y-Et;U.writeVarint(Ee(In)),U.writeVarint(Ee(_r)),vt+=In,Et+=_r}3===K&&U.writeVarint(Wa(7,1))}}function Mv(It,U){var q=typeof It;"string"===q?U.writeStringField(1,It):"boolean"===q?U.writeBooleanField(7,It):"number"===q&&(It%1!=0?U.writeDoubleField(3,It):It<0?U.writeSVarintField(6,It):U.writeVarintField(5,It))}xc.exports=Za,xc.exports.fromVectorTileJs=Za,xc.exports.fromGeojsonVt=function(It,U){U=U||{};var q={};for(var K in It)q[K]=new bc(It[K].features,U),q[K].name=K,q[K].version=U.version,q[K].extent=U.extent;return Za({layers:q})},xc.exports.GeoJSONWrapper=bc;var wc=Xt.g(xc.exports);const Xa={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:It=>It},vu=Math.fround||(Ec=new Float32Array(1),It=>(Ec[0]=+It,Ec[0]));var Ec;const Un=3,Wt=5,Ya=6;class Ja{constructor(U){this.options=Object.assign(Object.create(Xa),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:q,minZoom:K,maxZoom:vt}=this.options;q&&console.time("total time");const Et=`prepare ${U.length} points`;q&&console.time(Et),this.points=U;const $t=[];for(let wt=0;wt<U.length;wt++){const ee=U[wt];if(!ee.geometry)continue;const[me,ge]=ee.geometry.coordinates,In=vu(qt(me)),_r=vu(Ro(ge));$t.push(In,_r,1/0,wt,-1,1),this.options.reduce&&$t.push(0)}let Yt=this.trees[vt+1]=this._createTree($t);q&&console.timeEnd(Et);for(let wt=vt;wt>=K;wt--){const ee=+Date.now();Yt=this.trees[wt]=this._createTree(this._cluster(Yt,wt)),q&&console.log("z%d: %d clusters in %dms",wt,Yt.numItems,+Date.now()-ee)}return q&&console.timeEnd("total time"),this}getClusters(U,q){let K=((U[0]+180)%360+360)%360-180;const vt=Math.max(-90,Math.min(90,U[1]));let Et=180===U[2]?180:((U[2]+180)%360+360)%360-180;const $t=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)K=-180,Et=180;else if(K>Et){const ge=this.getClusters([K,vt,180,$t],q),In=this.getClusters([-180,vt,Et,$t],q);return ge.concat(In)}const Yt=this.trees[this._limitZoom(q)],wt=Yt.range(qt(K),Ro($t),qt(Et),Ro(vt)),ee=Yt.data,me=[];for(const ge of wt){const In=this.stride*ge;me.push(ee[In+Wt]>1?xu(ee,In,this.clusterProps):this.points[ee[In+Un]])}return me}getChildren(U){const q=this._getOriginId(U),K=this._getOriginZoom(U),vt="No cluster with the specified id.",Et=this.trees[K];if(!Et)throw new Error(vt);const $t=Et.data;if(q*this.stride>=$t.length)throw new Error(vt);const Yt=this.options.radius/(this.options.extent*Math.pow(2,K-1)),wt=Et.within($t[q*this.stride],$t[q*this.stride+1],Yt),ee=[];for(const me of wt){const ge=me*this.stride;$t[ge+4]===U&&ee.push($t[ge+Wt]>1?xu($t,ge,this.clusterProps):this.points[$t[ge+Un]])}if(0===ee.length)throw new Error(vt);return ee}getLeaves(U,q,K){const vt=[];return this._appendLeaves(vt,U,q=q||10,K=K||0,0),vt}getTile(U,q,K){const vt=this.trees[this._limitZoom(U)],Et=Math.pow(2,U),{extent:$t,radius:Yt}=this.options,wt=Yt/$t,ee=(K-wt)/Et,me=(K+1+wt)/Et,ge={features:[]};return this._addTileFeatures(vt.range((q-wt)/Et,ee,(q+1+wt)/Et,me),vt.data,q,K,Et,ge),0===q&&this._addTileFeatures(vt.range(1-wt/Et,ee,1,me),vt.data,Et,K,Et,ge),q===Et-1&&this._addTileFeatures(vt.range(0,ee,wt/Et,me),vt.data,-1,K,Et,ge),ge.features.length?ge:null}getClusterExpansionZoom(U){let q=this._getOriginZoom(U)-1;for(;q<=this.options.maxZoom;){const K=this.getChildren(U);if(q++,1!==K.length)break;U=K[0].properties.cluster_id}return q}_appendLeaves(U,q,K,vt,Et){const $t=this.getChildren(q);for(const Yt of $t){const wt=Yt.properties;if(wt&&wt.cluster?Et+wt.point_count<=vt?Et+=wt.point_count:Et=this._appendLeaves(U,wt.cluster_id,K,vt,Et):Et<vt?Et++:U.push(Yt),U.length===K)break}return Et}_createTree(U){const q=new Xt.K(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<U.length;K+=this.stride)q.add(U[K],U[K+1]);return q.finish(),q.data=U,q}_addTileFeatures(U,q,K,vt,Et,$t){for(const Yt of U){const wt=Yt*this.stride,ee=q[wt+Wt]>1;let me,ge,In;if(ee)me=vi(q,wt,this.clusterProps),ge=q[wt],In=q[wt+1];else{const yr=this.points[q[wt+Un]];me=yr.properties;const[Fn,Nn]=yr.geometry.coordinates;ge=qt(Fn),In=Ro(Nn)}const _r={type:1,geometry:[[Math.round(this.options.extent*(ge*Et-K)),Math.round(this.options.extent*(In*Et-vt))]],tags:me};let xi;xi=ee||this.options.generateId?q[wt+Un]:this.points[q[wt+Un]].id,void 0!==xi&&(_r.id=xi),$t.features.push(_r)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,q){const{radius:K,extent:vt,reduce:Et,minPoints:$t}=this.options,Yt=K/(vt*Math.pow(2,q)),wt=U.data,ee=[],me=this.stride;for(let ge=0;ge<wt.length;ge+=me){if(wt[ge+2]<=q)continue;wt[ge+2]=q;const In=wt[ge],_r=wt[ge+1],xi=U.within(wt[ge],wt[ge+1],Yt),yr=wt[ge+Wt];let Fn=yr;for(const Nn of xi){const to=Nn*me;wt[to+2]>q&&(Fn+=wt[to+Wt])}if(Fn>yr&&Fn>=$t){let Nn,to=In*yr,go=_r*yr,Oo=-1;const ua=((ge/me|0)<<5)+(q+1)+this.points.length;for(const Eh of xi){const Wo=Eh*me;if(wt[Wo+2]<=q)continue;wt[Wo+2]=q;const Ll=wt[Wo+Wt];to+=wt[Wo]*Ll,go+=wt[Wo+1]*Ll,wt[Wo+4]=ua,Et&&(Nn||(Nn=this._map(wt,ge,!0),Oo=this.clusterProps.length,this.clusterProps.push(Nn)),Et(Nn,this._map(wt,Wo)))}wt[ge+4]=ua,ee.push(to/Fn,go/Fn,1/0,ua,-1,Fn),Et&&ee.push(Oo)}else{for(let Nn=0;Nn<me;Nn++)ee.push(wt[ge+Nn]);if(Fn>1)for(const Nn of xi){const to=Nn*me;if(!(wt[to+2]<=q)){wt[to+2]=q;for(let go=0;go<me;go++)ee.push(wt[to+go])}}}}return ee}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,q,K){if(U[q+Wt]>1){const $t=this.clusterProps[U[q+Ya]];return K?Object.assign({},$t):$t}const vt=this.points[U[q+Un]].properties,Et=this.options.map(vt);return K&&Et===vt?Object.assign({},Et):Et}}function xu(It,U,q){return{type:"Feature",id:It[U+Un],properties:vi(It,U,q),geometry:{type:"Point",coordinates:[(K=It[U],360*(K-.5)),ci(It[U+1])]}};var K}function vi(It,U,q){const K=It[U+Wt],vt=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,Et=It[U+Ya],$t=-1===Et?{}:Object.assign({},q[Et]);return Object.assign($t,{cluster:!0,cluster_id:It[U+Un],point_count:K,point_count_abbreviated:vt})}function qt(It){return It/360+.5}function Ro(It){const U=Math.sin(It*Math.PI/180),q=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return q<0?0:q>1?1:q}function ci(It){const U=(180-360*It)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}var Ar={exports:{}};Ar.exports=function(){function It(ft,yt,Ct,Pt){for(var At,kt=Pt,Bt=Ct-yt>>1,Rt=Ct-yt,Zt=ft[yt],Lt=ft[yt+1],Te=ft[Ct],mn=ft[Ct+1],re=yt+3;re<Ct;re+=3){var dn=U(ft[re],ft[re+1],Zt,Lt,Te,mn);if(dn>kt)At=re,kt=dn;else if(dn===kt){var fn=Math.abs(re-Bt);fn<Rt&&(At=re,Rt=fn)}}kt>Pt&&(At-yt>3&&It(ft,yt,At,Pt),ft[At+2]=kt,Ct-At>3&&It(ft,At,Ct,Pt))}function U(ft,yt,Ct,Pt,At,kt){var Bt=At-Ct,Rt=kt-Pt;if(0!==Bt||0!==Rt){var Zt=((ft-Ct)*Bt+(yt-Pt)*Rt)/(Bt*Bt+Rt*Rt);Zt>1?(Ct=At,Pt=kt):Zt>0&&(Ct+=Bt*Zt,Pt+=Rt*Zt)}return(Bt=ft-Ct)*Bt+(Rt=yt-Pt)*Rt}function q(ft,yt,Ct,Pt){var At={id:void 0===ft?null:ft,type:yt,geometry:Ct,tags:Pt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(kt){var Bt=kt.geometry,Rt=kt.type;if("Point"===Rt||"MultiPoint"===Rt||"LineString"===Rt)K(kt,Bt);else if("Polygon"===Rt||"MultiLineString"===Rt)for(var Zt=0;Zt<Bt.length;Zt++)K(kt,Bt[Zt]);else if("MultiPolygon"===Rt)for(Zt=0;Zt<Bt.length;Zt++)for(var Lt=0;Lt<Bt[Zt].length;Lt++)K(kt,Bt[Zt][Lt])}(At),At}function K(ft,yt){for(var Ct=0;Ct<yt.length;Ct+=3)ft.minX=Math.min(ft.minX,yt[Ct]),ft.minY=Math.min(ft.minY,yt[Ct+1]),ft.maxX=Math.max(ft.maxX,yt[Ct]),ft.maxY=Math.max(ft.maxY,yt[Ct+1])}function vt(ft,yt,Ct,Pt){if(yt.geometry){var At=yt.geometry.coordinates,kt=yt.geometry.type,Bt=Math.pow(Ct.tolerance/((1<<Ct.maxZoom)*Ct.extent),2),Rt=[],Zt=yt.id;if(Ct.promoteId?Zt=yt.properties[Ct.promoteId]:Ct.generateId&&(Zt=Pt||0),"Point"===kt)Et(At,Rt);else if("MultiPoint"===kt)for(var Lt=0;Lt<At.length;Lt++)Et(At[Lt],Rt);else if("LineString"===kt)$t(At,Rt,Bt,!1);else if("MultiLineString"===kt){if(Ct.lineMetrics){for(Lt=0;Lt<At.length;Lt++)$t(At[Lt],Rt=[],Bt,!1),ft.push(q(Zt,"LineString",Rt,yt.properties));return}Yt(At,Rt,Bt,!1)}else if("Polygon"===kt)Yt(At,Rt,Bt,!0);else{if("MultiPolygon"!==kt){if("GeometryCollection"===kt){for(Lt=0;Lt<yt.geometry.geometries.length;Lt++)vt(ft,{id:Zt,geometry:yt.geometry.geometries[Lt],properties:yt.properties},Ct,Pt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Lt=0;Lt<At.length;Lt++){var Te=[];Yt(At[Lt],Te,Bt,!0),Rt.push(Te)}}ft.push(q(Zt,kt,Rt,yt.properties))}}function Et(ft,yt){yt.push(wt(ft[0])),yt.push(ee(ft[1])),yt.push(0)}function $t(ft,yt,Ct,Pt){for(var At,kt,Bt=0,Rt=0;Rt<ft.length;Rt++){var Zt=wt(ft[Rt][0]),Lt=ee(ft[Rt][1]);yt.push(Zt),yt.push(Lt),yt.push(0),Rt>0&&(Bt+=Pt?(At*Lt-Zt*kt)/2:Math.sqrt(Math.pow(Zt-At,2)+Math.pow(Lt-kt,2))),At=Zt,kt=Lt}var Te=yt.length-3;yt[2]=1,It(yt,0,Te,Ct),yt[Te+2]=1,yt.size=Math.abs(Bt),yt.start=0,yt.end=yt.size}function Yt(ft,yt,Ct,Pt){for(var At=0;At<ft.length;At++){var kt=[];$t(ft[At],kt,Ct,Pt),yt.push(kt)}}function wt(ft){return ft/360+.5}function ee(ft){var yt=Math.sin(ft*Math.PI/180),Ct=.5-.25*Math.log((1+yt)/(1-yt))/Math.PI;return Ct<0?0:Ct>1?1:Ct}function me(ft,yt,Ct,Pt,At,kt,Bt,Rt){if(Pt/=yt,kt>=(Ct/=yt)&&Bt<Pt)return ft;if(Bt<Ct||kt>=Pt)return null;for(var Zt=[],Lt=0;Lt<ft.length;Lt++){var Te=ft[Lt],mn=Te.geometry,re=Te.type,dn=0===At?Te.minX:Te.minY,fn=0===At?Te.maxX:Te.maxY;if(dn>=Ct&&fn<Pt)Zt.push(Te);else if(!(fn<Ct||dn>=Pt)){var Tr=[];if("Point"===re||"MultiPoint"===re)ge(mn,Tr,Ct,Pt,At);else if("LineString"===re)In(mn,Tr,Ct,Pt,At,!1,Rt.lineMetrics);else if("MultiLineString"===re)xi(mn,Tr,Ct,Pt,At,!1);else if("Polygon"===re)xi(mn,Tr,Ct,Pt,At,!0);else if("MultiPolygon"===re)for(var Gr=0;Gr<mn.length;Gr++){var eo=[];xi(mn[Gr],eo,Ct,Pt,At,!0),eo.length&&Tr.push(eo)}if(Tr.length){if(Rt.lineMetrics&&"LineString"===re){for(Gr=0;Gr<Tr.length;Gr++)Zt.push(q(Te.id,re,Tr[Gr],Te.tags));continue}"LineString"!==re&&"MultiLineString"!==re||(1===Tr.length?(re="LineString",Tr=Tr[0]):re="MultiLineString"),"Point"!==re&&"MultiPoint"!==re||(re=3===Tr.length?"Point":"MultiPoint"),Zt.push(q(Te.id,re,Tr,Te.tags))}}}return Zt.length?Zt:null}function ge(ft,yt,Ct,Pt,At){for(var kt=0;kt<ft.length;kt+=3){var Bt=ft[kt+At];Bt>=Ct&&Bt<=Pt&&(yt.push(ft[kt]),yt.push(ft[kt+1]),yt.push(ft[kt+2]))}}function In(ft,yt,Ct,Pt,At,kt,Bt){for(var Rt,Zt,Lt=_r(ft),Te=0===At?Fn:Nn,mn=ft.start,re=0;re<ft.length-3;re+=3){var dn=ft[re],fn=ft[re+1],Tr=ft[re+2],Gr=ft[re+3],eo=ft[re+4],Hs=0===At?dn:fn,ei=0===At?Gr:eo,ko=!1;Bt&&(Rt=Math.sqrt(Math.pow(dn-Gr,2)+Math.pow(fn-eo,2))),Hs<Ct?ei>Ct&&(Zt=Te(Lt,dn,fn,Gr,eo,Ct),Bt&&(Lt.start=mn+Rt*Zt)):Hs>Pt?ei<Pt&&(Zt=Te(Lt,dn,fn,Gr,eo,Pt),Bt&&(Lt.start=mn+Rt*Zt)):yr(Lt,dn,fn,Tr),ei<Ct&&Hs>=Ct&&(Zt=Te(Lt,dn,fn,Gr,eo,Ct),ko=!0),ei>Pt&&Hs<=Pt&&(Zt=Te(Lt,dn,fn,Gr,eo,Pt),ko=!0),!kt&&ko&&(Bt&&(Lt.end=mn+Rt*Zt),yt.push(Lt),Lt=_r(ft)),Bt&&(mn+=Rt)}var no=ft.length-3;dn=ft[no],fn=ft[no+1],Tr=ft[no+2],(Hs=0===At?dn:fn)>=Ct&&Hs<=Pt&&yr(Lt,dn,fn,Tr),no=Lt.length-3,kt&&no>=3&&(Lt[no]!==Lt[0]||Lt[no+1]!==Lt[1])&&yr(Lt,Lt[0],Lt[1],Lt[2]),Lt.length&&yt.push(Lt)}function _r(ft){var yt=[];return yt.size=ft.size,yt.start=ft.start,yt.end=ft.end,yt}function xi(ft,yt,Ct,Pt,At,kt){for(var Bt=0;Bt<ft.length;Bt++)In(ft[Bt],yt,Ct,Pt,At,kt,!1)}function yr(ft,yt,Ct,Pt){ft.push(yt),ft.push(Ct),ft.push(Pt)}function Fn(ft,yt,Ct,Pt,At,kt){var Bt=(kt-yt)/(Pt-yt);return ft.push(kt),ft.push(Ct+(At-Ct)*Bt),ft.push(1),Bt}function Nn(ft,yt,Ct,Pt,At,kt){var Bt=(kt-Ct)/(At-Ct);return ft.push(yt+(Pt-yt)*Bt),ft.push(kt),ft.push(1),Bt}function to(ft,yt){for(var Ct=[],Pt=0;Pt<ft.length;Pt++){var At,kt=ft[Pt],Bt=kt.type;if("Point"===Bt||"MultiPoint"===Bt||"LineString"===Bt)At=go(kt.geometry,yt);else if("MultiLineString"===Bt||"Polygon"===Bt){At=[];for(var Rt=0;Rt<kt.geometry.length;Rt++)At.push(go(kt.geometry[Rt],yt))}else if("MultiPolygon"===Bt)for(At=[],Rt=0;Rt<kt.geometry.length;Rt++){for(var Zt=[],Lt=0;Lt<kt.geometry[Rt].length;Lt++)Zt.push(go(kt.geometry[Rt][Lt],yt));At.push(Zt)}Ct.push(q(kt.id,Bt,At,kt.tags))}return Ct}function go(ft,yt){var Ct=[];Ct.size=ft.size,void 0!==ft.start&&(Ct.start=ft.start,Ct.end=ft.end);for(var Pt=0;Pt<ft.length;Pt+=3)Ct.push(ft[Pt]+yt,ft[Pt+1],ft[Pt+2]);return Ct}function Oo(ft,yt){if(ft.transformed)return ft;var Ct,Pt,At,kt=1<<ft.z,Bt=ft.x,Rt=ft.y;for(Ct=0;Ct<ft.features.length;Ct++){var Zt=ft.features[Ct],Lt=Zt.geometry,Te=Zt.type;if(Zt.geometry=[],1===Te)for(Pt=0;Pt<Lt.length;Pt+=2)Zt.geometry.push(ua(Lt[Pt],Lt[Pt+1],yt,kt,Bt,Rt));else for(Pt=0;Pt<Lt.length;Pt++){var mn=[];for(At=0;At<Lt[Pt].length;At+=2)mn.push(ua(Lt[Pt][At],Lt[Pt][At+1],yt,kt,Bt,Rt));Zt.geometry.push(mn)}}return ft.transformed=!0,ft}function ua(ft,yt,Ct,Pt,At,kt){return[Math.round(Ct*(ft*Pt-At)),Math.round(Ct*(yt*Pt-kt))]}function Eh(ft,yt,Ct,Pt,At){for(var kt=yt===At.maxZoom?0:At.tolerance/((1<<yt)*At.extent),Bt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ct,y:Pt,z:yt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Rt=0;Rt<ft.length;Rt++){Bt.numFeatures++,Wo(Bt,ft[Rt],kt,At);var Zt=ft[Rt].minX,Lt=ft[Rt].minY,Te=ft[Rt].maxX,mn=ft[Rt].maxY;Zt<Bt.minX&&(Bt.minX=Zt),Lt<Bt.minY&&(Bt.minY=Lt),Te>Bt.maxX&&(Bt.maxX=Te),mn>Bt.maxY&&(Bt.maxY=mn)}return Bt}function Wo(ft,yt,Ct,Pt){var At=yt.geometry,kt=yt.type,Bt=[];if("Point"===kt||"MultiPoint"===kt)for(var Rt=0;Rt<At.length;Rt+=3)Bt.push(At[Rt]),Bt.push(At[Rt+1]),ft.numPoints++,ft.numSimplified++;else if("LineString"===kt)Ll(Bt,At,ft,Ct,!1,!1);else if("MultiLineString"===kt||"Polygon"===kt)for(Rt=0;Rt<At.length;Rt++)Ll(Bt,At[Rt],ft,Ct,"Polygon"===kt,0===Rt);else if("MultiPolygon"===kt)for(var Zt=0;Zt<At.length;Zt++){var Lt=At[Zt];for(Rt=0;Rt<Lt.length;Rt++)Ll(Bt,Lt[Rt],ft,Ct,!0,0===Rt)}if(Bt.length){var Te=yt.tags||null;if("LineString"===kt&&Pt.lineMetrics){for(var mn in Te={},yt.tags)Te[mn]=yt.tags[mn];Te.mapbox_clip_start=At.start/At.size,Te.mapbox_clip_end=At.end/At.size}var re={geometry:Bt,type:"Polygon"===kt||"MultiPolygon"===kt?3:"LineString"===kt||"MultiLineString"===kt?2:1,tags:Te};null!==yt.id&&(re.id=yt.id),ft.features.push(re)}}function Ll(ft,yt,Ct,Pt,At,kt){var Bt=Pt*Pt;if(Pt>0&&yt.size<(At?Bt:Pt))Ct.numPoints+=yt.length/3;else{for(var Rt=[],Zt=0;Zt<yt.length;Zt+=3)(0===Pt||yt[Zt+2]>Bt)&&(Ct.numSimplified++,Rt.push(yt[Zt]),Rt.push(yt[Zt+1])),Ct.numPoints++;At&&function(Lt,Te){for(var mn=0,re=0,dn=Lt.length,fn=dn-2;re<dn;fn=re,re+=2)mn+=(Lt[re]-Lt[fn])*(Lt[re+1]+Lt[fn+1]);if(mn>0===Te)for(re=0,dn=Lt.length;re<dn/2;re+=2){var Tr=Lt[re],Gr=Lt[re+1];Lt[re]=Lt[dn-2-re],Lt[re+1]=Lt[dn-1-re],Lt[dn-2-re]=Tr,Lt[dn-1-re]=Gr}}(Rt,kt),ft.push(Rt)}}function Cc(ft,yt){var Ct=(yt=this.options=function(At,kt){for(var Bt in kt)At[Bt]=kt[Bt];return At}(Object.create(this.options),yt)).debug;if(Ct&&console.time("preprocess data"),yt.maxZoom<0||yt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(yt.promoteId&&yt.generateId)throw new Error("promoteId and generateId cannot be used together.");var At,kt,Bt,Rt,Zt,Lt,Pt=function(At,kt){var Bt=[];if("FeatureCollection"===At.type)for(var Rt=0;Rt<At.features.length;Rt++)vt(Bt,At.features[Rt],kt,Rt);else vt(Bt,"Feature"===At.type?At:{geometry:At},kt);return Bt}(ft,yt);this.tiles={},this.tileCoords=[],Ct&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",yt.indexMaxZoom,yt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(At=Pt,kt=yt,Bt=kt.buffer/kt.extent,Rt=At,Zt=me(At,1,-1-Bt,Bt,0,-1,2,kt),Lt=me(At,1,1-Bt,2+Bt,0,-1,2,kt),(Zt||Lt)&&(Rt=me(At,1,-Bt,1+Bt,0,-1,2,kt)||[],Zt&&(Rt=to(Zt,1).concat(Rt)),Lt&&(Rt=Rt.concat(to(Lt,-1)))),Pt=Rt).length&&this.splitTile(Pt,0,0,0),Ct&&(Pt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Mh(ft,yt,Ct){return 32*((1<<ft)*Ct+yt)+ft}return Cc.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Cc.prototype.splitTile=function(ft,yt,Ct,Pt,At,kt,Bt){for(var Rt=[ft,yt,Ct,Pt],Zt=this.options,Lt=Zt.debug;Rt.length;){Pt=Rt.pop(),Ct=Rt.pop(),yt=Rt.pop(),ft=Rt.pop();var Te=1<<yt,mn=Mh(yt,Ct,Pt),re=this.tiles[mn];if(!re&&(Lt>1&&console.time("creation"),re=this.tiles[mn]=Eh(ft,yt,Ct,Pt,Zt),this.tileCoords.push({z:yt,x:Ct,y:Pt}),Lt)){Lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",yt,Ct,Pt,re.numFeatures,re.numPoints,re.numSimplified),console.timeEnd("creation"));var dn="z"+yt;this.stats[dn]=(this.stats[dn]||0)+1,this.total++}if(re.source=ft,At){if(yt===Zt.maxZoom||yt===At)continue;var fn=1<<At-yt;if(Ct!==Math.floor(kt/fn)||Pt!==Math.floor(Bt/fn))continue}else if(yt===Zt.indexMaxZoom||re.numPoints<=Zt.indexMaxPoints)continue;if(re.source=null,0!==ft.length){Lt>1&&console.time("clipping");var Tr,Gr,eo,Hs,ei,ko,no=.5*Zt.buffer/Zt.extent,Xo=.5-no,Tc=.5+no,ni=1+no;Tr=Gr=eo=Hs=null,ei=me(ft,Te,Ct-no,Ct+Tc,0,re.minX,re.maxX,Zt),ko=me(ft,Te,Ct+Xo,Ct+ni,0,re.minX,re.maxX,Zt),ft=null,ei&&(Tr=me(ei,Te,Pt-no,Pt+Tc,1,re.minY,re.maxY,Zt),Gr=me(ei,Te,Pt+Xo,Pt+ni,1,re.minY,re.maxY,Zt),ei=null),ko&&(eo=me(ko,Te,Pt-no,Pt+Tc,1,re.minY,re.maxY,Zt),Hs=me(ko,Te,Pt+Xo,Pt+ni,1,re.minY,re.maxY,Zt),ko=null),Lt>1&&console.timeEnd("clipping"),Rt.push(Tr||[],yt+1,2*Ct,2*Pt),Rt.push(Gr||[],yt+1,2*Ct,2*Pt+1),Rt.push(eo||[],yt+1,2*Ct+1,2*Pt),Rt.push(Hs||[],yt+1,2*Ct+1,2*Pt+1)}}},Cc.prototype.getTile=function(ft,yt,Ct){var Pt=this.options,At=Pt.extent,kt=Pt.debug;if(ft<0||ft>24)return null;var Bt=1<<ft,Rt=Mh(ft,yt=(yt%Bt+Bt)%Bt,Ct);if(this.tiles[Rt])return Oo(this.tiles[Rt],At);kt>1&&console.log("drilling down to z%d-%d-%d",ft,yt,Ct);for(var Zt,Lt=ft,Te=yt,mn=Ct;!Zt&&Lt>0;)Lt--,Te=Math.floor(Te/2),mn=Math.floor(mn/2),Zt=this.tiles[Mh(Lt,Te,mn)];return Zt&&Zt.source?(kt>1&&console.log("found parent tile z%d-%d-%d",Lt,Te,mn),kt>1&&console.time("drilling down"),this.splitTile(Zt.source,Lt,Te,mn,ft,yt,Ct),kt>1&&console.timeEnd("drilling down"),this.tiles[Rt]?Oo(this.tiles[Rt],At):null):null},function(ft,yt){return new Cc(ft,yt)}}();var Xm=Xt.g(Ar.exports);function On(It,U){const q=It.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const K=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!K)return U(null,null);const vt=new class{constructor($t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Xt.E,this.length=$t.length,this._features=$t}feature($t){return new class{constructor(Yt){this._feature=Yt,this.extent=Xt.E,this.type=Yt.type,this.properties=Yt.tags,"id"in Yt&&!isNaN(Yt.id)&&(this.id=parseInt(Yt.id,10))}loadGeometry(){if(1===this._feature.type){const Yt=[];for(const wt of this._feature.geometry)Yt.push([new Xt.P(wt[0],wt[1])]);return Yt}{const Yt=[];for(const wt of this._feature.geometry){const ee=[];for(const me of wt)ee.push(new Xt.P(me[0],me[1]));Yt.push(ee)}return Yt}}toGeoJSON(Yt,wt,ee){return _u.call(this,Yt,wt,ee)}}(this._features[$t])}}(K.features);let Et=wc(vt);0===Et.byteOffset&&Et.byteLength===Et.buffer.byteLength||(Et=new Uint8Array(Et)),U(null,{vectorTile:vt,rawData:Et.buffer})}class bh extends Xt.d{constructor(U,q,K,vt,Et,$t){super(U,q,K,vt,On,$t),Et&&(this.loadGeoJSON=Et)}loadData(U,q){const K=U&&U.request,vt=K&&K.collectResourceTiming;this.loadGeoJSON(U,(Et,$t)=>{if(Et||!$t)return q(Et);if("object"!=typeof $t)return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{kl($t,!0);try{if(U.filter){const wt=Xt.e(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===wt.result)throw new Error(wt.value.map(me=>`${me.key}: ${me.message}`).join(", "));$t={type:"FeatureCollection",features:$t.features.filter(me=>wt.value.evaluate({zoom:0},me))}}this._geoJSONIndex=U.cluster?new Ja(function({superclusterOptions:wt,clusterProperties:ee}){if(!ee||!wt)return wt;const me={},ge={},In={accumulated:null,zoom:0},_r={properties:null},xi=Object.keys(ee);for(const yr of xi){const[Fn,Nn]=ee[yr],to=Xt.e(Nn),go=Xt.e("string"==typeof Fn?[Fn,["accumulated"],["get",yr]]:Fn);me[yr]=to.value,ge[yr]=go.value}return wt.map=yr=>{_r.properties=yr;const Fn={};for(const Nn of xi)Fn[Nn]=me[Nn].evaluate(In,_r);return Fn},wt.reduce=(yr,Fn)=>{_r.properties=Fn;for(const Nn of xi)In.accumulated=yr[Nn],yr[Nn]=ge[Nn].evaluate(In,_r)},wt}(U)).load($t.features):Xm($t,U.geojsonVtOptions)}catch(wt){return q(wt)}this.loaded={};const Yt={};if(vt){const wt=Xt.f(K);wt&&(Yt.resourceTiming={},Yt.resourceTiming[U.source]=JSON.parse(JSON.stringify(wt)))}q(null,Yt)}})}reloadTile(U,q){const K=this.loaded;return K&&K[U.uid]?super.reloadTile(U,q):this.loadTile(U,q)}loadGeoJSON(U,q){if(U.request)Xt.h(U.request,q);else{if("string"!=typeof U.data)return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(U.data))}catch{return q(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(K){q(K)}}getClusterChildren(U,q){try{q(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(K){q(K)}}getClusterLeaves(U,q){try{q(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(K){q(K)}}}class ui{constructor(U,q){this.tileID=new Xt.O(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=U.projection,this.brightness=q}parse(U,q,K,vt){this.status="parsing";const Et=new Xt.O(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),$t={},Yt=q.familiesBySource[K.source],wt=new Xt.F(Et,K.promoteId);return wt.bucketLayerIDs=[],Xt.l(U).then(ee=>{if(!ee)return vt(new Error("Could not parse tile"));const me=Xt.j(ee,1/Xt.t(K.tileID.canonical)),ge=ee.json.extensionsUsed&&ee.json.extensionsUsed.includes("MAPBOX_mesh_features"),In=new Xt.k(this.zoom,{brightness:this.brightness});for(const _r in Yt)for(const xi of Yt[_r]){const yr=xi[0],Fn=ee.json.extensionsUsed;yr.recalculate(In,[]);const Nn=new Xt.T(me,Et,Fn&&Fn.includes("MAPBOX_mesh_features"),this.brightness);ge||(Nn.needsUpload=!0),$t[yr.fqid]=Nn,Nn.evaluate(yr)}this.status="done",vt(null,{buckets:$t,featureIndex:wt})}).catch(ee=>vt(new Error(ee.message)))}}class Mc{constructor(U,q,K,vt,Et,$t){this.actor=U,this.layerIndex=q,this.brightness=$t,this.loading={},this.loaded={}}loadTile(U,q){const K=U.uid,vt=this.loading[K]=new ui(U,this.brightness);Xt.i(U.request,(Et,$t)=>{const Yt=!this.loading[K];return delete this.loading[K],Yt||Et?(vt.status="done",Yt||(this.loaded[K]=vt),q(Et)):$t&&0!==$t.byteLength?void vt.parse($t,this.layerIndex,U,(wt,ee)=>{vt.status="done",this.loaded=this.loaded||{},this.loaded[K]=vt,wt||!ee?q(wt):q(null,ee)}):(vt.status="done",this.loaded[K]=vt,q())})}reloadTile(U,q){const K=this.loaded,vt=U.uid;if(K&&K[vt]){const Et=K[vt];Et.projection=U.projection,Et.brightness=U.brightness;const $t=(Yt,wt)=>{Et.reloadCallback&&(delete Et.reloadCallback,this.loadTile(U,q)),q(Yt,wt)};"parsing"===Et.status?Et.reloadCallback=$t:"done"===Et.status&&this.loadTile(U,q)}}abortTile(U,q){const K=U.uid;this.loading[K]&&delete this.loading[K],q()}removeTile(U,q){const K=this.loaded,vt=U.uid;K&&K[vt]&&delete K[vt],q()}}class wh{constructor(U){this.self=U,this.actor=new Xt.A(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=Xt.m({name:"mercator"}),this.workerSourceTypes={vector:Xt.d,geojson:bh,"batched-model":Mc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,K)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=K},this.self.registerRTLTextPlugin=q=>{if(Xt.n.isParsed())throw new Error("RTL text plugin already registered.");Xt.n.applyArabicShaping=q.applyArabicShaping,Xt.n.processBidirectionalText=q.processBidirectionalText,Xt.n.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(U,q,K){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],K()}checkIfReady(U,q,K){K()}setReferrer(U,q){this.referrer=q}spriteLoaded(U,{scope:q,isLoaded:K}){if(this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),this.isSpriteLoaded[U][q]=K,this.workerSources[U]&&this.workerSources[U][q])for(const vt in this.workerSources[U][q]){const Et=this.workerSources[U][q][vt];for(const $t in Et)Et[$t]instanceof Xt.d&&(Et[$t].isSpriteLoaded=K,Et[$t].fire(new Xt.o("isSpriteLoaded")))}}setImages(U,{scope:q,images:K},vt){if(this.availableImages[U]||(this.availableImages[U]={}),this.availableImages[U][q]=K,this.workerSources[U]&&this.workerSources[U][q]){for(const Et in this.workerSources[U][q]){const $t=this.workerSources[U][q][Et];for(const Yt in $t)$t[Yt].availableImages=K}vt()}else vt()}setProjection(U,q){this.projections[U]=Xt.m(q)}setBrightness(U,q,K){this.brightness=q,K()}setLayers(U,q,K){this.getLayerIndex(U,q.scope).replace(q.layers,q.options),K()}updateLayers(U,q,K){this.getLayerIndex(U,q.scope).update(q.layers,q.removedIds,q.options),K()}loadTile(U,q,K){q.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,q.type,q.source,q.scope).loadTile(q,K)}loadDEMTile(U,q,K){this.getDEMWorkerSource(U,q.source,q.scope).loadTile(q,K)}reloadTile(U,q,K){q.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,q.type,q.source,q.scope).reloadTile(q,K)}abortTile(U,q,K){this.getWorkerSource(U,q.type,q.source,q.scope).abortTile(q,K)}removeTile(U,q,K){this.getWorkerSource(U,q.type,q.source,q.scope).removeTile(q,K)}removeSource(U,q,K){if(!(this.workerSources[U]&&this.workerSources[U][q.scope]&&this.workerSources[U][q.scope][q.type]&&this.workerSources[U][q.scope][q.type][q.source]))return;const vt=this.workerSources[U][q.scope][q.type][q.source];delete this.workerSources[U][q.scope][q.type][q.source],void 0!==vt.removeSource?vt.removeSource(q,K):K()}loadWorkerSource(U,q,K){try{this.self.importScripts(q.url),K()}catch(vt){K(vt.toString())}}syncRTLPluginState(U,q,K){try{Xt.n.setState(q);const vt=Xt.n.getPluginURL();if(Xt.n.isLoaded()&&!Xt.n.isParsed()&&null!=vt){this.self.importScripts(vt);const Et=Xt.n.isParsed();K(Et?void 0:new Error(`RTL Text Plugin failed to import scripts from ${vt}`),Et)}}catch(vt){K(vt.toString())}}setDracoUrl(U,q){this.dracoUrl=q}getAvailableImages(U,q){this.availableImages[U]||(this.availableImages[U]={});let K=this.availableImages[U][q];return K||(K=[]),K}getLayerIndex(U,q){this.layerIndexes[U]||(this.layerIndexes[U]={});let K=this.layerIndexes[U][q];return K||(K=this.layerIndexes[U][q]=new Ha,K.scope=q),K}getWorkerSource(U,q,K,vt){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][vt]||(this.workerSources[U][vt]={}),this.workerSources[U][vt][q]||(this.workerSources[U][vt][q]={}),this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),this.workerSources[U][vt][q][K]||(this.workerSources[U][vt][q][K]=new this.workerSourceTypes[q]({send:($t,Yt,wt,ee,me,ge)=>{this.actor.send($t,Yt,wt,U,me,ge)},scheduler:this.actor.scheduler},this.getLayerIndex(U,vt),this.getAvailableImages(U,vt),this.isSpriteLoaded[U][vt],void 0,this.brightness)),this.workerSources[U][vt][q][K]}getDEMWorkerSource(U,q,K){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][K]||(this.demWorkerSources[U][K]={}),this.demWorkerSources[U][K][q]||(this.demWorkerSources[U][K][q]=new ke),this.demWorkerSources[U][K][q]}enforceCacheSizeLimit(U,q){Xt.q(q)}getWorkerPerformanceMetrics(U,q,K){K(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new wh(self)),wh}),wf(0,function(Xt){return Xt.s}),sr}()}},wv=>{wv(wv.s=575)}]);