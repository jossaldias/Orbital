(self.webpackChunkOrbital=self.webpackChunkOrbital||[]).push([[179],{369:(d0,Yd,Hu)=>{"use strict";function Gn(e){return"function"==typeof e}function ep(e){const i=e(a=>{Error.call(a),a.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const h0=ep(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((a,u)=>`${u+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function Qt(e,o){if(e){const i=e.indexOf(o);0<=i&&e.splice(i,1)}}class st{constructor(o){this.initialTeardown=o,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let o;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const f of i)f.remove(this);else i.remove(this);const{initialTeardown:a}=this;if(Gn(a))try{a()}catch(f){o=f instanceof h0?f.errors:[f]}const{_finalizers:u}=this;if(u){this._finalizers=null;for(const f of u)try{$e(f)}catch(g){o=o??[],g instanceof h0?o=[...o,...g.errors]:o.push(g)}}if(o)throw new h0(o)}}add(o){var i;if(o&&o!==this)if(this.closed)$e(o);else{if(o instanceof st){if(o.closed||o._hasParent(this))return;o._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(o)}}_hasParent(o){const{_parentage:i}=this;return i===o||Array.isArray(i)&&i.includes(o)}_addParent(o){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(o),i):i?[i,o]:o}_removeParent(o){const{_parentage:i}=this;i===o?this._parentage=null:Array.isArray(i)&&Qt(i,o)}remove(o){const{_finalizers:i}=this;i&&Qt(i,o),o instanceof st&&o._removeParent(this)}}st.EMPTY=(()=>{const e=new st;return e.closed=!0,e})();const Ta=st.EMPTY;function pl(e){return e instanceof st||e&&"closed"in e&&Gn(e.remove)&&Gn(e.add)&&Gn(e.unsubscribe)}function $e(e){Gn(e)?e():e.unsubscribe()}const Ns={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Da={setTimeout(e,o,...i){const{delegate:a}=Da;return a?.setTimeout?a.setTimeout(e,o,...i):setTimeout(e,o,...i)},clearTimeout(e){const{delegate:o}=Da;return(o?.clearTimeout||clearTimeout)(e)},delegate:void 0};function lc(e){Da.setTimeout(()=>{const{onUnhandledError:o}=Ns;if(!o)throw e;o(e)})}function Gu(){}const Zc=hs("C",void 0,void 0);function hs(e,o,i){return{kind:e,value:o,error:i}}let ml=null;function gl(e){if(Ns.useDeprecatedSynchronousErrorHandling){const o=!ml;if(o&&(ml={errorThrown:!1,error:null}),e(),o){const{errorThrown:i,error:a}=ml;if(ml=null,i)throw a}}else e()}class Xc extends st{constructor(o){super(),this.isStopped=!1,o?(this.destination=o,pl(o)&&o.add(this)):this.destination=f0}static create(o,i,a){return new qu(o,i,a)}next(o){this.isStopped?Er(function np(e){return hs("N",e,void 0)}(o),this):this._next(o)}error(o){this.isStopped?Er(function Ng(e){return hs("E",void 0,e)}(o),this):(this.isStopped=!0,this._error(o))}complete(){this.isStopped?Er(Zc,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(o){this.destination.next(o)}_error(o){try{this.destination.error(o)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const _l=Function.prototype.bind;function nt(e,o){return _l.call(e,o)}class ln{constructor(o){this.partialObserver=o}next(o){const{partialObserver:i}=this;if(i.next)try{i.next(o)}catch(a){yl(a)}}error(o){const{partialObserver:i}=this;if(i.error)try{i.error(o)}catch(a){yl(a)}else yl(o)}complete(){const{partialObserver:o}=this;if(o.complete)try{o.complete()}catch(i){yl(i)}}}class qu extends Xc{constructor(o,i,a){let u;if(super(),Gn(o)||!o)u={next:o??void 0,error:i??void 0,complete:a??void 0};else{let f;this&&Ns.useDeprecatedNextContext?(f=Object.create(o),f.unsubscribe=()=>this.unsubscribe(),u={next:o.next&&nt(o.next,f),error:o.error&&nt(o.error,f),complete:o.complete&&nt(o.complete,f)}):u=o}this.destination=new ln(u)}}function yl(e){Ns.useDeprecatedSynchronousErrorHandling?function zg(e){Ns.useDeprecatedSynchronousErrorHandling&&ml&&(ml.errorThrown=!0,ml.error=e)}(e):lc(e)}function Er(e,o){const{onStoppedNotification:i}=Ns;i&&Da.setTimeout(()=>i(e,o))}const f0={closed:!0,next:Gu,error:function Ie(e){throw e},complete:Gu},Yc="function"==typeof Symbol&&Symbol.observable||"@@observable";function vl(e){return e}function Kc(e){return 0===e.length?vl:1===e.length?e[0]:function(i){return e.reduce((a,u)=>u(a),i)}}let $n=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){const a=new e;return a.source=this,a.operator=i,a}subscribe(i,a,u){const f=function bl(e){return e&&e instanceof Xc||function xl(e){return e&&Gn(e.next)&&Gn(e.error)&&Gn(e.complete)}(e)&&pl(e)}(i)?i:new qu(i,a,u);return gl(()=>{const{operator:g,source:x}=this;f.add(g?g.call(f,x):x?this._subscribe(f):this._trySubscribe(f))}),f}_trySubscribe(i){try{return this._subscribe(i)}catch(a){i.error(a)}}forEach(i,a){return new(a=Jt(a))((u,f)=>{const g=new qu({next:x=>{try{i(x)}catch(w){f(w),g.unsubscribe()}},error:f,complete:u});this.subscribe(g)})}_subscribe(i){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(i)}[Yc](){return this}pipe(...i){return Kc(i)(this)}toPromise(i){return new(i=Jt(i))((a,u)=>{let f;this.subscribe(g=>f=g,g=>u(g),()=>a(f))})}}return e.create=o=>new e(o),e})();function Jt(e){var o;return null!==(o=e??Ns.Promise)&&void 0!==o?o:Promise}const Zu=ep(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let xn=(()=>{class e extends $n{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const a=new Yt(this,this);return a.operator=i,a}_throwIfClosed(){if(this.closed)throw new Zu}next(i){gl(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const a of this.currentObservers)a.next(i)}})}error(i){gl(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:a}=this;for(;a.length;)a.shift().error(i)}})}complete(){gl(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:a,isStopped:u,observers:f}=this;return a||u?Ta:(this.currentObservers=null,f.push(i),new st(()=>{this.currentObservers=null,Qt(f,i)}))}_checkFinalizedStatuses(i){const{hasError:a,thrownError:u,isStopped:f}=this;a?i.error(u):f&&i.complete()}asObservable(){const i=new $n;return i.source=this,i}}return e.create=(o,i)=>new Yt(o,i),e})();class Yt extends xn{constructor(o,i){super(),this.destination=o,this.source=i}next(o){var i,a;null===(a=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===a||a.call(i,o)}error(o){var i,a;null===(a=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===a||a.call(i,o)}complete(){var o,i;null===(i=null===(o=this.destination)||void 0===o?void 0:o.complete)||void 0===i||i.call(o)}_subscribe(o){var i,a;return null!==(a=null===(i=this.source)||void 0===i?void 0:i.subscribe(o))&&void 0!==a?a:Ta}}function ts(e){return Gn(e?.lift)}function ar(e){return o=>{if(ts(o))return o.lift(function(i){try{return e(i,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ti(e,o,i,a,u){return new Bg(e,o,i,a,u)}class Bg extends Xc{constructor(o,i,a,u,f,g){super(o),this.onFinalize=f,this.shouldUnsubscribe=g,this._next=i?function(x){try{i(x)}catch(w){o.error(w)}}:super._next,this._error=u?function(x){try{u(x)}catch(w){o.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(x){o.error(x)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var o;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(o=this.onFinalize)||void 0===o||o.call(this))}}}function cn(e,o){return ar((i,a)=>{let u=0;i.subscribe(Ti(a,f=>{a.next(e.call(o,f,u++))}))})}function ni(e){return this instanceof ni?(this.v=e,this):new ni(e)}function zo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,o=e[Symbol.asyncIterator];return o?o.call(e):(e=function be(e){var o="function"==typeof Symbol&&Symbol.iterator,i=o&&e[o],a=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i);function a(f){i[f]=e[f]&&function(g){return new Promise(function(x,w){!function u(f,g,x,w){Promise.resolve(w).then(function(T){f({value:T,done:x})},g)}(x,w,(g=e[f](g)).done,g.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const At=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function zt(e){return Gn(e?.then)}function Ut(e){return Gn(e[Yc])}function Lt(e){return Symbol.asyncIterator&&Gn(e?.[Symbol.asyncIterator])}function Kt(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Oe=function Bt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Rn(e){return Gn(e?.[Oe])}function ce(e){return function ii(e,o,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,a=i.apply(e,o||[]),f=[];return u={},g("next"),g("throw"),g("return"),u[Symbol.asyncIterator]=function(){return this},u;function g(B){a[B]&&(u[B]=function(G){return new Promise(function(K,et){f.push([B,G,K,et])>1||x(B,G)})})}function x(B,G){try{!function w(B){B.value instanceof ni?Promise.resolve(B.value.v).then(T,A):k(f[0][2],B)}(a[B](G))}catch(K){k(f[0][3],K)}}function T(B){x("next",B)}function A(B){x("throw",B)}function k(B,G){B(G),f.shift(),f.length&&x(f[0][0],f[0][1])}}(this,arguments,function*(){const i=e.getReader();try{for(;;){const{value:a,done:u}=yield ni(i.read());if(u)return yield ni(void 0);yield yield ni(a)}}finally{i.releaseLock()}})}function Tn(e){return Gn(e?.getReader)}function bn(e){if(e instanceof $n)return e;if(null!=e){if(Ut(e))return function Xi(e){return new $n(o=>{const i=e[Yc]();if(Gn(i.subscribe))return i.subscribe(o);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(At(e))return function fr(e){return new $n(o=>{for(let i=0;i<e.length&&!o.closed;i++)o.next(e[i]);o.complete()})}(e);if(zt(e))return function Mo(e){return new $n(o=>{e.then(i=>{o.closed||(o.next(i),o.complete())},i=>o.error(i)).then(null,lc)})}(e);if(Lt(e))return Cr(e);if(Rn(e))return function sa(e){return new $n(o=>{for(const i of e)if(o.next(i),o.closed)return;o.complete()})}(e);if(Tn(e))return function ns(e){return Cr(ce(e))}(e)}throw Kt(e)}function Cr(e){return new $n(o=>{(function So(e,o){var i,a,u,f;return function te(e,o,i,a){return new(i||(i=Promise))(function(f,g){function x(A){try{T(a.next(A))}catch(k){g(k)}}function w(A){try{T(a.throw(A))}catch(k){g(k)}}function T(A){A.done?f(A.value):function u(f){return f instanceof i?f:new i(function(g){g(f)})}(A.value).then(x,w)}T((a=a.apply(e,o||[])).next())})}(this,void 0,void 0,function*(){try{for(i=zo(e);!(a=yield i.next()).done;)if(o.next(a.value),o.closed)return}catch(g){u={error:g}}finally{try{a&&!a.done&&(f=i.return)&&(yield f.call(i))}finally{if(u)throw u.error}}o.complete()})})(e,o).catch(i=>o.error(i))})}function ps(e,o,i,a=0,u=!1){const f=o.schedule(function(){i(),u?e.add(this.schedule(null,a)):this.unsubscribe()},a);if(e.add(f),!u)return f}function pr(e,o,i=1/0){return Gn(o)?pr((a,u)=>cn((f,g)=>o(a,f,u,g))(bn(e(a,u))),i):("number"==typeof o&&(i=o),ar((a,u)=>function tu(e,o,i,a,u,f,g,x){const w=[];let T=0,A=0,k=!1;const B=()=>{k&&!w.length&&!T&&o.complete()},G=et=>T<a?K(et):w.push(et),K=et=>{f&&o.next(et),T++;let ut=!1;bn(i(et,A++)).subscribe(Ti(o,_t=>{u?.(_t),f?G(_t):o.next(_t)},()=>{ut=!0},void 0,()=>{if(ut)try{for(T--;w.length&&T<a;){const _t=w.shift();g?ps(o,g,()=>K(_t)):K(_t)}B()}catch(_t){o.error(_t)}}))};return e.subscribe(Ti(o,G,()=>{k=!0,B()})),()=>{x?.()}}(a,u,e,i)))}function eu(e=1/0){return pr(vl,e)}const Aa=new $n(e=>e.complete());function rE(e){return e&&Gn(e.schedule)}function Vg(e){return e[e.length-1]}function oE(e){return Gn(Vg(e))?e.pop():void 0}function nu(e){return rE(Vg(e))?e.pop():void 0}function ip(e,o=0){return ar((i,a)=>{i.subscribe(Ti(a,u=>ps(a,e,()=>a.next(u),o),()=>ps(a,e,()=>a.complete(),o),u=>ps(a,e,()=>a.error(u),o)))})}function p0(e,o=0){return ar((i,a)=>{a.add(e.schedule(()=>i.subscribe(a),o))})}function jg(e,o){if(!e)throw new Error("Iterable cannot be null");return new $n(i=>{ps(i,o,()=>{const a=e[Symbol.asyncIterator]();ps(i,o,()=>{a.next().then(u=>{u.done?i.complete():i.next(u.value)})},0,!0)})})}function Ar(e,o){return o?function Ug(e,o){if(null!=e){if(Ut(e))return function BI(e,o){return bn(e).pipe(p0(o),ip(o))}(e,o);if(At(e))return function aE(e,o){return new $n(i=>{let a=0;return o.schedule(function(){a===e.length?i.complete():(i.next(e[a++]),i.closed||this.schedule())})})}(e,o);if(zt(e))return function VI(e,o){return bn(e).pipe(p0(o),ip(o))}(e,o);if(Lt(e))return jg(e,o);if(Rn(e))return function lE(e,o){return new $n(i=>{let a;return ps(i,o,()=>{a=e[Oe](),ps(i,o,()=>{let u,f;try{({value:u,done:f}=a.next())}catch(g){return void i.error(g)}f?i.complete():i.next(u)},0,!0)}),()=>Gn(a?.return)&&a.return()})}(e,o);if(Tn(e))return function m0(e,o){return jg(ce(e),o)}(e,o)}throw Kt(e)}(e,o):bn(e)}function uc(...e){const o=nu(e),i=function sE(e,o){return"number"==typeof Vg(e)?e.pop():o}(e,1/0),a=e;return a.length?1===a.length?bn(a[0]):eu(i)(Ar(a,o)):Aa}class $r extends xn{constructor(o){super(),this._value=o}get value(){return this.getValue()}_subscribe(o){const i=super._subscribe(o);return!i.closed&&o.next(this._value),i}getValue(){const{hasError:o,thrownError:i,_value:a}=this;if(o)throw i;return this._throwIfClosed(),a}next(o){super.next(this._value=o)}}function kt(...e){return Ar(e,nu(e))}function zn(e={}){const{connector:o=(()=>new xn),resetOnError:i=!0,resetOnComplete:a=!0,resetOnRefCountZero:u=!0}=e;return f=>{let g,x,w,T=0,A=!1,k=!1;const B=()=>{x?.unsubscribe(),x=void 0},G=()=>{B(),g=w=void 0,A=k=!1},K=()=>{const et=g;G(),et?.unsubscribe()};return ar((et,ut)=>{T++,!k&&!A&&B();const _t=w=w??o();ut.add(()=>{T--,0===T&&!k&&!A&&(x=Ra(K,u))}),_t.subscribe(ut),!g&&T>0&&(g=new qu({next:pt=>_t.next(pt),error:pt=>{k=!0,B(),x=Ra(G,i,pt),_t.error(pt)},complete:()=>{A=!0,B(),x=Ra(G,a),_t.complete()}}),bn(et).subscribe(g))})(f)}}function Ra(e,o,...i){if(!0===o)return void e();if(!1===o)return;const a=new qu({next:()=>{a.unsubscribe(),e()}});return bn(o(...i)).subscribe(a)}function Hr(e,o){return ar((i,a)=>{let u=null,f=0,g=!1;const x=()=>g&&!u&&a.complete();i.subscribe(Ti(a,w=>{u?.unsubscribe();let T=0;const A=f++;bn(e(w,A)).subscribe(u=Ti(a,k=>a.next(o?o(w,k,A,T++):k),()=>{u=null,x()}))},()=>{g=!0,x()}))})}function Xu(e,o=vl){return e=e??cE,ar((i,a)=>{let u,f=!0;i.subscribe(Ti(a,g=>{const x=o(g);(f||!e(u,x))&&(f=!1,u=x,a.next(g))}))})}function cE(e,o){return e===o}function xi(e){for(let o in e)if(e[o]===xi)return o;throw Error("Could not find renamed property on target object.")}function rp(e,o){for(const i in o)o.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=o[i])}function Rr(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Rr).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const o=e.toString();if(null==o)return""+o;const i=o.indexOf("\n");return-1===i?o:o.substring(0,i)}function op(e,o){return null==e||""===e?null===o?"":o:null==o||""===o?e:e+" "+o}const sp=xi({__forward_ref__:xi});function Di(e){return e.__forward_ref__=Di,e.toString=function(){return Rr(this())},e}function Qe(e){return $g(e)?e():e}function $g(e){return"function"==typeof e&&e.hasOwnProperty(sp)&&e.__forward_ref__===Di}function Hg(e){return e&&!!e.\u0275providers}class at extends Error{constructor(o,i){super(function $i(e,o){return`NG0${Math.abs(e)}${o?": "+o:""}`}(o,i)),this.code=o}}function J(e){return"string"==typeof e?e:null==e?"":String(e)}function Pa(e,o){throw new at(-201,!1)}function Bo(e,o){null==e&&function Se(e,o,i,a){throw new Error(`ASSERTION ERROR: ${e}`+(null==a?"":` [Expected=> ${i} ${a} ${o} <=Actual]`))}(o,e,null,"!=")}function ie(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ii(e){return{providers:e.providers||[],imports:e.imports||[]}}function ap(e){return Yg(e,To)||Yg(e,Jg)}function Yg(e,o){return e.hasOwnProperty(o)?e[o]:null}function nh(e){return e&&(e.hasOwnProperty(Ne)||e.hasOwnProperty(_0))?e[Ne]:null}const To=xi({\u0275prov:xi}),Ne=xi({\u0275inj:xi}),Jg=xi({ngInjectableDef:xi}),_0=xi({ngInjectorDef:xi});var Ye=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Ye||{});let ms;function Gr(e){const o=ms;return ms=e,o}function Mr(e,o,i){const a=ap(e);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:i&Ye.Optional?null:void 0!==o?o:void Pa(Rr(e))}const Bi=globalThis;class Gt{constructor(o,i){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=ie({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const gs={},oh="__NG_DI_FLAG__",up="ngTempTokenPath",$I=/\n/gm,sh="__source";let ah;function hc(e){const o=ah;return ah=e,o}function e_(e,o=Ye.Default){if(void 0===ah)throw new at(-203,!1);return null===ah?Mr(e,void 0,o):ah.get(e,o&Ye.Optional?null:void 0,o)}function bt(e,o=Ye.Default){return(function y0(){return ms}()||e_)(Qe(e),o)}function ee(e,o=Ye.Default){return bt(e,n_(o))}function n_(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function i_(e){const o=[];for(let i=0;i<e.length;i++){const a=Qe(e[i]);if(Array.isArray(a)){if(0===a.length)throw new at(900,!1);let u,f=Ye.Default;for(let g=0;g<a.length;g++){const x=a[g],w=x0(x);"number"==typeof w?-1===w?u=x.token:f|=w:u=x}o.push(bt(u,f))}else o.push(bt(a))}return o}function hp(e,o){return e[oh]=o,e.prototype[oh]=o,e}function x0(e){return e[oh]}function wl(e){return{toString:e}.toString()}var fp=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(fp||{}),Vo=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Vo||{});const la={},ri=[],ch=xi({\u0275cmp:xi}),r_=xi({\u0275dir:xi}),pp=xi({\u0275pipe:xi}),dt=xi({\u0275mod:xi}),El=xi({\u0275fac:xi}),Ju=xi({__NG_ELEMENT_ID__:xi}),o_=xi({__NG_ENV_ID__:xi});function b0(e,o,i){let a=e.length;for(;;){const u=e.indexOf(o,i);if(-1===u)return u;if(0===u||e.charCodeAt(u-1)<=32){const f=o.length;if(u+f===a||e.charCodeAt(u+f)<=32)return u}i=u+1}}function uh(e,o,i){let a=0;for(;a<i.length;){const u=i[a];if("number"==typeof u){if(0!==u)break;a++;const f=i[a++],g=i[a++],x=i[a++];e.setAttribute(o,g,x,f)}else{const f=u,g=i[++a];s_(f)?e.setProperty(o,f,g):e.setAttribute(o,f,g),a++}}return a}function Cl(e){return 3===e||4===e||6===e}function s_(e){return 64===e.charCodeAt(0)}function Fa(e,o){if(null!==o&&0!==o.length)if(null===e||0===e.length)e=o.slice();else{let i=-1;for(let a=0;a<o.length;a++){const u=o[a];"number"==typeof u?i=u:0===i||mp(e,i,u,null,-1===i||2===i?o[++a]:null)}}return e}function mp(e,o,i,a,u){let f=0,g=e.length;if(-1===o)g=-1;else for(;f<e.length;){const x=e[f++];if("number"==typeof x){if(x===o){g=-1;break}if(x>o){g=f-1;break}}}for(;f<e.length;){const x=e[f];if("number"==typeof x)break;if(x===i){if(null===a)return void(null!==u&&(e[f+1]=u));if(a===e[f+1])return void(e[f+2]=u)}f++,null!==a&&f++,null!==u&&f++}-1!==g&&(e.splice(g,0,o),f=g+1),e.splice(f++,0,i),null!==a&&e.splice(f++,0,a),null!==u&&e.splice(f++,0,u)}const Qu="ng-template";function w0(e,o,i){let a=0,u=!0;for(;a<e.length;){let f=e[a++];if("string"==typeof f&&u){const g=e[a++];if(i&&"class"===f&&-1!==b0(g.toLowerCase(),o,0))return!0}else{if(1===f){for(;a<e.length&&"string"==typeof(f=e[a++]);)if(f.toLowerCase()===o)return!0;return!1}"number"==typeof f&&(u=!1)}}return!1}function mE(e){return 4===e.type&&e.value!==Qu}function gE(e,o,i){return o===(4!==e.type||i?e.value:Qu)}function _E(e,o,i){let a=4;const u=e.attrs||[],f=function qI(e){for(let o=0;o<e.length;o++)if(Cl(e[o]))return o;return e.length}(u);let g=!1;for(let x=0;x<o.length;x++){const w=o[x];if("number"!=typeof w){if(!g)if(4&a){if(a=2|1&a,""!==w&&!gE(e,w,i)||""===w&&1===o.length){if(Bs(a))return!1;g=!0}}else{const T=8&a?w:o[++x];if(8&a&&null!==e.attrs){if(!w0(e.attrs,T,i)){if(Bs(a))return!1;g=!0}continue}const k=HI(8&a?"class":w,u,mE(e),i);if(-1===k){if(Bs(a))return!1;g=!0;continue}if(""!==T){let B;B=k>f?"":u[k+1].toLowerCase();const G=8&a?B:null;if(G&&-1!==b0(G,T,0)||2&a&&T!==B){if(Bs(a))return!1;g=!0}}}}else{if(!g&&!Bs(a)&&!Bs(w))return!1;if(g&&Bs(w))continue;g=!1,a=w|1&a}}return Bs(a)||g}function Bs(e){return 0==(1&e)}function HI(e,o,i,a){if(null===o)return-1;let u=0;if(a||!i){let f=!1;for(;u<o.length;){const g=o[u];if(g===e)return u;if(3===g||6===g)f=!0;else{if(1===g||2===g){let x=o[++u];for(;"string"==typeof x;)x=o[++u];continue}if(4===g)break;if(0===g){u+=4;continue}}u+=f?1:2}return-1}return function vE(e,o){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){const a=e[i];if("number"==typeof a)return-1;if(a===o)return i;i++}return-1}(o,e)}function yE(e,o,i=!1){for(let a=0;a<o.length;a++)if(_E(e,o[a],i))return!0;return!1}function WI(e,o){t:for(let i=0;i<o.length;i++){const a=o[i];if(e.length===a.length){for(let u=0;u<e.length;u++)if(e[u]!==a[u])continue t;return!0}}return!1}function gp(e,o){return e?":not("+o.trim()+")":o}function ZI(e){let o=e[0],i=1,a=2,u="",f=!1;for(;i<e.length;){let g=e[i];if("string"==typeof g)if(2&a){const x=e[++i];u+="["+g+(x.length>0?'="'+x+'"':"")+"]"}else 8&a?u+="."+g:4&a&&(u+=" "+g);else""!==u&&!Bs(g)&&(o+=gp(f,u),u=""),a=g,f=f||!Bs(a);i++}return""!==u&&(o+=gp(f,u)),o}function _s(e){return wl(()=>{const o=c_(e),i={...o,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===fp.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Vo.Emulated,styles:e.styles||ri,_:null,schemas:e.schemas||null,tView:null,id:""};u_(i);const a=e.dependencies;return i.directiveDefs=_e(a,!1),i.pipeDefs=_e(a,!0),i.id=function d_(e){let o=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const u of i)o=Math.imul(31,o)+u.charCodeAt(0)<<0;return o+=2147483648,"c"+o}(i),i})}function _p(e){return Kn(e)||Wr(e)}function M0(e){return null!==e}function bi(e){return wl(()=>({type:e.type,bootstrap:e.bootstrap||ri,declarations:e.declarations||ri,imports:e.imports||ri,exports:e.exports||ri,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function l_(e,o){if(null==e)return la;const i={};for(const a in e)if(e.hasOwnProperty(a)){let u=e[a],f=u;Array.isArray(u)&&(f=u[1],u=u[0]),i[u]=a,o&&(o[u]=f)}return i}function Ee(e){return wl(()=>{const o=c_(e);return u_(o),o})}function Kn(e){return e[ch]||null}function Wr(e){return e[r_]||null}function Uo(e){return e[pp]||null}function $o(e,o){const i=e[dt]||null;if(!i&&!0===o)throw new Error(`Type ${Rr(e)} does not have '\u0275mod' property.`);return i}function c_(e){const o={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:o,inputTransforms:null,inputConfig:e.inputs||la,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||ri,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:l_(e.inputs,o),outputs:l_(e.outputs)}}function u_(e){e.features?.forEach(o=>o(e))}function _e(e,o){if(!e)return null;const i=o?Uo:_p;return()=>("function"==typeof e?e():e).map(a=>i(a)).filter(M0)}const _r=0,he=1,dn=2,Ai=3,ca=4,yp=5,Ho=6,dh=7,yr=8,Ml=9,ou=10,nn=11,hh=12,S0=13,fh=14,tr=15,fc=16,td=17,Vs=18,ed=19,La=20,Sl=21,Tl=22,nd=23,ph=24,On=25,vp=1,wE=2,js=7,su=9,Zr=11;function Do(e){return Array.isArray(e)&&"object"==typeof e[vp]}function is(e){return Array.isArray(e)&&!0===e[vp]}function f_(e){return 0!=(4&e.flags)}function au(e){return e.componentOffset>-1}function pc(e){return 1==(1&e.flags)}function Na(e){return!!e.template}function T0(e){return 0!=(512&e[dn])}function Dl(e,o){return e.hasOwnProperty(El)?e[El]:null}let Io=null,g_=!1;function Us(e){const o=Io;return Io=e,o}const DE={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function bp(e){if(!yh(e)||e.dirty){if(!e.producerMustRecompute(e)&&!Cp(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function gc(e){e.dirty=!0,function mc(e){if(void 0===e.liveConsumerNode)return;const o=g_;g_=!0;try{for(const i of e.liveConsumerNode)i.dirty||gc(i)}finally{g_=o}}(e),e.consumerMarkedDirty?.(e)}function Ep(e){return e&&(e.nextProducerIndex=0),Us(e)}function _h(e,o){if(Us(o),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(yh(e))for(let i=e.nextProducerIndex;i<e.producerNode.length;i++)Mp(e.producerNode[i],e.producerIndexOfThis[i]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Cp(e){ua(e);for(let o=0;o<e.producerNode.length;o++){const i=e.producerNode[o],a=e.producerLastReadVersion[o];if(a!==i.version||(bp(i),a!==i.version))return!0}return!1}function $s(e){if(ua(e),yh(e))for(let o=0;o<e.producerNode.length;o++)Mp(e.producerNode[o],e.producerIndexOfThis[o]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function Mp(e,o){if(function R0(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),ua(e),1===e.liveConsumerNode.length)for(let a=0;a<e.producerNode.length;a++)Mp(e.producerNode[a],e.producerIndexOfThis[a]);const i=e.liveConsumerNode.length-1;if(e.liveConsumerNode[o]=e.liveConsumerNode[i],e.liveConsumerIndexOfThis[o]=e.liveConsumerIndexOfThis[i],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,o<e.liveConsumerNode.length){const a=e.liveConsumerIndexOfThis[o],u=e.liveConsumerNode[o];ua(u),u.producerIndexOfThis[a]=o}}function yh(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function ua(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let PE=null;const id=()=>{},VE=(()=>({...DE,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:id}))();class lA{constructor(o,i,a){this.previousValue=o,this.currentValue=i,this.firstChange=a}isFirstChange(){return this.firstChange}}function rs(){return L0}function L0(e){return e.type.prototype.ngOnChanges&&(e.setInput=UE),jE}function jE(){const e=z0(this),o=e?.current;if(o){const i=e.previous;if(i===la)e.previous=o;else for(let a in o)i[a]=o[a];e.current=null,this.ngOnChanges(o)}}function UE(e,o,i,a){const u=this.declaredInputs[i],f=z0(e)||function Xr(e,o){return e[N0]=o}(e,{previous:la,current:null}),g=f.current||(f.current={}),x=f.previous,w=x[u];g[u]=new lA(w&&w.currentValue,o,x===la),e[a]=o}rs.ngInherit=!0;const N0="__ngSimpleChanges__";function z0(e){return e[N0]||null}const os=function(e,o,i){},HE="svg";function Yi(e){for(;Array.isArray(e);)e=e[_r];return e}function v_(e,o){return Yi(o[e])}function ys(e,o){return Yi(o[e.index])}function qE(e,o){return e.data[o]}function Hs(e,o){const i=o[e];return Do(i)?i:i[_r]}function ss(e,o){return null==o?null:e[o]}function Ba(e){e[td]=0}function bh(e){1024&e[dn]||(e[dn]|=1024,Xt(e,1))}function Dp(e){1024&e[dn]&&(e[dn]&=-1025,Xt(e,-1))}function Xt(e,o){let i=e[Ai];if(null===i)return;i[yp]+=o;let a=i;for(i=i[Ai];null!==i&&(1===o&&1===a[yp]||-1===o&&0===a[yp]);)i[yp]+=o,a=i,i=i[Ai]}const qe={lFrame:mi(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function b_(){return qe.bindingsEnabled}function od(){return null!==qe.skipHydrationRootTNode}function Nt(){return qe.lFrame.lView}function qn(){return qe.lFrame.tView}function Go(e){return qe.lFrame.contextLView=e,e[yr]}function Il(e){return qe.lFrame.contextLView=null,e}function ho(){let e=w_();for(;null!==e&&64===e.type;)e=e.parent;return e}function w_(){return qe.lFrame.currentTNode}function da(e,o){const i=qe.lFrame;i.currentTNode=e,i.isParent=o}function E_(){return qe.lFrame.isParent}function vs(){qe.lFrame.isParent=!1}function wh(){return qe.lFrame.bindingIndex++}function xs(e){const o=qe.lFrame,i=o.bindingIndex;return o.bindingIndex=o.bindingIndex+e,i}function se(e,o){const i=qe.lFrame;i.bindingIndex=i.bindingRootIndex=e,Ei(o)}function Ei(e){qe.lFrame.currentDirectiveIndex=e}function M_(){return qe.lFrame.currentQueryIndex}function S_(e){qe.lFrame.currentQueryIndex=e}function Gs(e){const o=e[he];return 2===o.type?o.declTNode:1===o.type?e[Ho]:null}function XE(e,o,i){if(i&Ye.SkipSelf){let u=o,f=e;for(;!(u=u.parent,null!==u||i&Ye.Host||(u=Gs(f),null===u||(f=f[fh],10&u.type))););if(null===u)return!1;o=u,e=f}const a=qe.lFrame=Rp();return a.currentTNode=o,a.lView=e,!0}function Z0(e){const o=Rp(),i=e[he];qe.lFrame=o,o.currentTNode=i.firstChild,o.lView=e,o.tView=i,o.contextLView=e,o.bindingIndex=i.bindingStartIndex,o.inI18n=!1}function Rp(){const e=qe.lFrame,o=null===e?null:e.child;return null===o?mi(e):o}function mi(e){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=o),o}function pn(){const e=qe.lFrame;return qe.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const X0=pn;function qo(){const e=pn();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Ao(){return qe.lFrame.selectedIndex}function _c(e){qe.lFrame.selectedIndex=e}function Ci(){const e=qe.lFrame;return qE(e.tView,e.selectedIndex)}function Rl(){qe.lFrame.currentNamespace=HE}let A_=!0;function Va(){return A_}function Pl(e){A_=e}function Eh(e,o){for(let i=o.directiveStart,a=o.directiveEnd;i<a;i++){const f=e.data[i].type.prototype,{ngAfterContentInit:g,ngAfterContentChecked:x,ngAfterViewInit:w,ngAfterViewChecked:T,ngOnDestroy:A}=f;g&&(e.contentHooks??=[]).push(-i,g),x&&((e.contentHooks??=[]).push(i,x),(e.contentCheckHooks??=[]).push(i,x)),w&&(e.viewHooks??=[]).push(-i,w),T&&((e.viewHooks??=[]).push(i,T),(e.viewCheckHooks??=[]).push(i,T)),null!=A&&(e.destroyHooks??=[]).push(i,A)}}function Ch(e,o,i){P_(e,o,3,i)}function ja(e,o,i,a){(3&e[dn])===i&&P_(e,o,i,a)}function er(e,o){let i=e[dn];(3&i)===o&&(i&=8191,i+=1,e[dn]=i)}function P_(e,o,i,a){const f=a??-1,g=o.length-1;let x=0;for(let w=void 0!==a?65535&e[td]:0;w<g;w++)if("number"==typeof o[w+1]){if(x=o[w],null!=a&&x>=a)break}else o[w]<0&&(e[td]+=65536),(x<f||-1==f)&&(Op(e,i,o,w),e[td]=(4294901760&e[td])+w+2),w++}function O_(e,o){os(4,e,o);const i=Us(null);try{o.call(e)}finally{Us(i),os(5,e,o)}}function Op(e,o,i,a){const u=i[a]<0,f=i[a+1],x=e[u?-i[a]:i[a]];u?e[dn]>>13<e[td]>>16&&(3&e[dn])===o&&(e[dn]+=8192,O_(x,f)):O_(x,f)}const ha=-1;class ld{constructor(o,i,a){this.factory=o,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=a}}function L_(e){return e!==ha}function Mh(e){return 32767&e}function Sh(e,o){let i=function JE(e){return e>>16}(e),a=o;for(;i>0;)a=a[fh],i--;return a}let N_=!0;function kp(e){const o=N_;return N_=e,o}const Q0=255,tx=5;let gA=0;const Ol={};function Fp(e,o){const i=QE(e,o);if(-1!==i)return i;const a=o[he];a.firstCreatePass&&(e.injectorIndex=o.length,ex(a.data,e),ex(o,null),ex(a.blueprint,null));const u=ud(e,o),f=e.injectorIndex;if(L_(u)){const g=Mh(u),x=Sh(u,o),w=x[he].data;for(let T=0;T<8;T++)o[f+T]=x[g+T]|w[g+T]}return o[f+8]=u,f}function ex(e,o){e.push(0,0,0,0,0,0,0,0,o)}function QE(e,o){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===o[e.injectorIndex+8]?-1:e.injectorIndex}function ud(e,o){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let i=0,a=null,u=o;for(;null!==u;){if(a=eC(u),null===a)return ha;if(i++,u=u[fh],-1!==a.injectorIndex)return a.injectorIndex|i<<16}return ha}function z_(e,o,i){!function Bn(e,o,i){let a;"string"==typeof i?a=i.charCodeAt(0)||0:i.hasOwnProperty(Ju)&&(a=i[Ju]),null==a&&(a=i[Ju]=gA++);const u=a&Q0;o.data[e+(u>>tx)]|=1<<u}(e,o,i)}function nx(e,o,i){if(i&Ye.Optional||void 0!==e)return e;Pa()}function ix(e,o,i,a){if(i&Ye.Optional&&void 0===a&&(a=null),!(i&(Ye.Self|Ye.Host))){const u=e[Ml],f=Gr(void 0);try{return u?u.get(o,a,i&Ye.Optional):Mr(o,a,i&Ye.Optional)}finally{Gr(f)}}return nx(a,0,i)}function tC(e,o,i,a=Ye.Default,u){if(null!==e){if(2048&o[dn]&&!(a&Ye.Self)){const g=function De(e,o,i,a,u){let f=e,g=o;for(;null!==f&&null!==g&&2048&g[dn]&&!(512&g[dn]);){const x=B_(f,g,i,a|Ye.Self,Ol);if(x!==Ol)return x;let w=f.parent;if(!w){const T=g[La];if(T){const A=T.get(i,Ol,a);if(A!==Ol)return A}w=eC(g),g=g[fh]}f=w}return u}(e,o,i,a,Ol);if(g!==Ol)return g}const f=B_(e,o,i,a,Ol);if(f!==Ol)return f}return ix(o,i,a,u)}function B_(e,o,i,a,u){const f=function V_(e){if("string"==typeof e)return e.charCodeAt(0)||0;const o=e.hasOwnProperty(Ju)?e[Ju]:void 0;return"number"==typeof o?o>=0?o&Q0:bs:o}(i);if("function"==typeof f){if(!XE(o,e,a))return a&Ye.Host?nx(u,0,a):ix(o,i,a,u);try{let g;if(g=f(a),null!=g||a&Ye.Optional)return g;Pa()}finally{X0()}}else if("number"==typeof f){let g=null,x=QE(e,o),w=ha,T=a&Ye.Host?o[tr][Ho]:null;for((-1===x||a&Ye.SkipSelf)&&(w=-1===x?ud(e,o):o[x+8],w!==ha&&He(a,!1)?(g=o[he],x=Mh(w),o=Sh(w,o)):x=-1);-1!==x;){const A=o[he];if(kl(f,x,A.data)){const k=Lp(x,o,i,g,a,T);if(k!==Ol)return k}w=o[x+8],w!==ha&&He(a,o[he].data[x+8]===T)&&kl(f,x,o)?(g=A,x=Mh(w),o=Sh(w,o)):x=-1}}return u}function Lp(e,o,i,a,u,f){const g=o[he],x=g.data[e+8],A=Np(x,g,i,null==a?au(x)&&N_:a!=g&&0!=(3&x.type),u&Ye.Host&&f===x);return null!==A?yc(o,g,A,x):Ol}function Np(e,o,i,a,u){const f=e.providerIndexes,g=o.data,x=1048575&f,w=e.directiveStart,A=f>>20,B=u?x+A:e.directiveEnd;for(let G=a?x:x+A;G<B;G++){const K=g[G];if(G<w&&i===K||G>=w&&K.type===i)return G}if(u){const G=g[w];if(G&&Na(G)&&G.type===i)return w}return null}function yc(e,o,i,a){let u=e[i];const f=o.data;if(function K0(e){return e instanceof ld}(u)){const g=u;g.resolving&&function Yu(e,o){const i=o?`. Dependency path: ${o.join(" > ")} > ${e}`:"";throw new at(-200,`Circular dependency in DI detected for ${e}${i}`)}(function It(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():J(e)}(f[i]));const x=kp(g.canSeeViewProviders);g.resolving=!0;const T=g.injectImpl?Gr(g.injectImpl):null;XE(e,a,Ye.Default);try{u=e[i]=g.factory(void 0,f,e,a),o.firstCreatePass&&i>=a.directiveStart&&function R_(e,o,i){const{ngOnChanges:a,ngOnInit:u,ngDoCheck:f}=o.type.prototype;if(a){const g=L0(o);(i.preOrderHooks??=[]).push(e,g),(i.preOrderCheckHooks??=[]).push(e,g)}u&&(i.preOrderHooks??=[]).push(0-e,u),f&&((i.preOrderHooks??=[]).push(e,f),(i.preOrderCheckHooks??=[]).push(e,f))}(i,f[i],o)}finally{null!==T&&Gr(T),kp(x),g.resolving=!1,X0()}}return u}function kl(e,o,i){return!!(i[o+(e>>tx)]&1<<e)}function He(e,o){return!(e&Ye.Self||e&Ye.Host&&o)}class me{constructor(o,i){this._tNode=o,this._lView=i}get(o,i,a){return tC(this._tNode,this._lView,o,n_(a),i)}}function bs(){return new me(ho(),Nt())}function vr(e){return wl(()=>{const o=e.prototype.constructor,i=o[El]||rx(o),a=Object.prototype;let u=Object.getPrototypeOf(e.prototype).constructor;for(;u&&u!==a;){const f=u[El]||rx(u);if(f&&f!==i)return f;u=Object.getPrototypeOf(u)}return f=>new f})}function rx(e){return $g(e)?()=>{const o=rx(Qe(e));return o&&o()}:Dl(e)}function eC(e){const o=e[he],i=o.type;return 2===i?o.declTNode:1===i?e[Ho]:null}const uu="__parameters__";function ws(e,o,i){return wl(()=>{const a=function hu(e){return function(...i){if(e){const a=e(...i);for(const u in a)this[u]=a[u]}}}(o);function u(...f){if(this instanceof u)return a.apply(this,f),this;const g=new u(...f);return x.annotation=g,x;function x(w,T,A){const k=w.hasOwnProperty(uu)?w[uu]:Object.defineProperty(w,uu,{value:[]})[uu];for(;k.length<=A;)k.push(null);return(k[A]=k[A]||[]).push(g),w}}return i&&(u.prototype=Object.create(i.prototype)),u.prototype.ngMetadataName=e,u.annotationCls=u,u})}function Jn(e,o){e.forEach(i=>Array.isArray(i)?Jn(i,o):o(i))}function j_(e,o,i){o>=e.length?e.push(i):e.splice(o,0,i)}function Ua(e,o){return o>=e.length-1?e.pop():e.splice(o,1)[0]}function Ph(e,o){const i=[];for(let a=0;a<e;a++)i.push(o);return i}function Sr(e,o,i){let a=fd(e,o);return a>=0?e[1|a]=i:(a=~a,function Ri(e,o,i,a){let u=e.length;if(u==o)e.push(i,a);else if(1===u)e.push(a,e[0]),e[0]=i;else{for(u--,e.push(e[u-1],e[u]);u>o;)e[u]=e[u-2],u--;e[o]=i,e[o+1]=a}}(e,a,o,i)),a}function U_(e,o){const i=fd(e,o);if(i>=0)return e[1|i]}function fd(e,o){return function Vn(e,o,i){let a=0,u=e.length>>i;for(;u!==a;){const f=a+(u-a>>1),g=e[f<<i];if(o===g)return f<<i;g>o?u=f:a=f+1}return~(u<<i)}(e,o,1)}const pu=hp(ws("Optional"),8),Oh=hp(ws("SkipSelf"),4);function Up(e){return 128==(128&e.flags)}var vc=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(vc||{});const $p=new Map;let $a=0;const Xe="__ngContext__";function fo(e,o){Do(o)?(e[Xe]=o[ed],function CC(e){$p.set(e[ed],e)}(o)):e[Xe]=o}let ze;function Hp(e,o){return ze(e,o)}function Lh(e){const o=e[Ai];return is(o)?o[Ai]:o}function yx(e){return xx(e[hh])}function vx(e){return xx(e[ca])}function xx(e){for(;null!==e&&!is(e);)e=e[ca];return e}function _d(e,o,i,a,u){if(null!=a){let f,g=!1;is(a)?f=a:Do(a)&&(g=!0,a=a[_r]);const x=Yi(a);0===e&&null!==i?null==u?kC(o,i,x):q(o,i,x,u||null,!0):1===e&&null!==i?q(o,i,x,u||null,!0):2===e?function Vh(e,o,i){const a=yd(e,o);a&&function zl(e,o,i,a){e.removeChild(o,i,a)}(e,a,o,i)}(o,x,g):3===e&&o.destroyNode(x),null!=f&&function ci(e,o,i,a,u){const f=i[js];f!==Yi(i)&&_d(o,e,a,f,u);for(let x=Zr;x<i.length;x++){const w=i[x];Uh(w[he],w,e,o,a,f)}}(o,e,f,i,u)}}function Nh(e,o,i){return e.createElement(o,i)}function Zo(e,o){const i=e[su],a=i.indexOf(o);Dp(o),i.splice(a,1)}function X_(e,o){if(e.length<=Zr)return;const i=Zr+o,a=e[i];if(a){const u=a[fc];null!==u&&u!==e&&Zo(u,a),o>0&&(e[i-1][ca]=a[ca]);const f=Ua(e,Zr+o);!function Fn(e,o){Uh(e,o,o[nn],2,null,null),o[_r]=null,o[Ho]=null}(a[he],a);const g=f[Vs];null!==g&&g.detachView(f[he]),a[Ai]=null,a[ca]=null,a[dn]&=-129}return a}function rt(e,o){if(!(256&o[dn])){const i=o[nn];o[nd]&&$s(o[nd]),o[ph]&&$s(o[ph]),i.destroyNode&&Uh(e,o,i,3,null,null),function zh(e){let o=e[hh];if(!o)return Ex(e[he],e);for(;o;){let i=null;if(Do(o))i=o[hh];else{const a=o[Zr];a&&(i=a)}if(!i){for(;o&&!o[ca]&&o!==e;)Do(o)&&Ex(o[he],o),o=o[Ai];null===o&&(o=e),Do(o)&&Ex(o[he],o),i=o&&o[ca]}o=i}}(o)}}function Ex(e,o){if(!(256&o[dn])){o[dn]&=-129,o[dn]|=256,function kA(e,o){let i;if(null!=e&&null!=(i=e.destroyHooks))for(let a=0;a<i.length;a+=2){const u=o[i[a]];if(!(u instanceof ld)){const f=i[a+1];if(Array.isArray(f))for(let g=0;g<f.length;g+=2){const x=u[f[g]],w=f[g+1];os(4,x,w);try{w.call(x)}finally{os(5,x,w)}}else{os(4,u,f);try{f.call(u)}finally{os(5,u,f)}}}}}(e,o),function Qr(e,o){const i=e.cleanup,a=o[dh];if(null!==i)for(let f=0;f<i.length-1;f+=2)if("string"==typeof i[f]){const g=i[f+3];g>=0?a[g]():a[-g].unsubscribe(),f+=2}else i[f].call(a[i[f+1]]);null!==a&&(o[dh]=null);const u=o[Sl];if(null!==u){o[Sl]=null;for(let f=0;f<u.length;f++)(0,u[f])()}}(e,o),1===o[he].type&&o[nn].destroy();const i=o[fc];if(null!==i&&is(o[Ai])){i!==o[Ai]&&Zo(i,o);const a=o[Vs];null!==a&&a.detachView(e)}!function fx(e){$p.delete(e[ed])}(o)}}function Cx(e,o,i){return function OC(e,o,i){let a=o;for(;null!==a&&40&a.type;)a=(o=a).parent;if(null===a)return i[_r];{const{componentOffset:u}=a;if(u>-1){const{encapsulation:f}=e.data[a.directiveStart+u];if(f===Vo.None||f===Vo.Emulated)return null}return ys(a,i)}}(e,o.parent,i)}function q(e,o,i,a,u){e.insertBefore(o,i,a,u)}function kC(e,o,i){e.appendChild(o,i)}function Mx(e,o,i,a,u){null!==a?q(e,o,i,a,u):kC(e,o,i)}function yd(e,o){return e.parentNode(o)}function xc(e,o,i){return LC(e,o,i)}let ma,Ix,LC=function Sx(e,o,i){return 40&e.type?ys(e,i):null};function tn(e,o,i,a){const u=Cx(e,a,o),f=o[nn],x=xc(a.parent||o[Ho],a,o);if(null!=u)if(Array.isArray(i))for(let w=0;w<i.length;w++)Mx(f,u,i[w],x,!1);else Mx(f,u,i,x,!1);void 0!==ma&&ma(f,a,o,i,u)}function bc(e,o){if(null!==o){const i=o.type;if(3&i)return ys(o,e);if(4&i)return Bh(-1,e[o.index]);if(8&i){const a=o.child;if(null!==a)return bc(e,a);{const u=e[o.index];return is(u)?Bh(-1,u):Yi(u)}}if(32&i)return Hp(o,e)()||Yi(e[o.index]);{const a=Tx(e,o);return null!==a?Array.isArray(a)?a[0]:bc(Lh(e[tr]),a):bc(e,o.next)}}return null}function Tx(e,o){return null!==o?e[tr][Ho].projection[o.projection]:null}function Bh(e,o){const i=Zr+e+1;if(i<o.length){const a=o[i],u=a[he].firstChild;if(null!==u)return bc(a,u)}return o[js]}function K_(e,o,i,a,u,f,g){for(;null!=i;){const x=a[i.index],w=i.type;if(g&&0===o&&(x&&fo(Yi(x),a),i.flags|=2),32!=(32&i.flags))if(8&w)K_(e,o,i.child,a,u,f,!1),_d(o,e,u,x,f);else if(32&w){const T=Hp(i,a);let A;for(;A=T();)_d(o,e,u,A,f);_d(o,e,u,x,f)}else 16&w?Bl(e,o,a,i,u,f):_d(o,e,u,x,f);i=g?i.projectionNext:i.next}}function Uh(e,o,i,a,u,f){K_(i,a,e.firstChild,o,u,f,!1)}function Bl(e,o,i,a,u,f){const g=i[tr],w=g[Ho].projection[a.projection];if(Array.isArray(w))for(let T=0;T<w.length;T++)_d(o,e,u,w[T],f);else{let T=w;const A=g[Ai];Up(a)&&(T.flags|=128),K_(e,o,T,A,u,f,!0)}}function Ro(e,o,i){""===i?e.removeAttribute(o,"class"):e.setAttribute(o,"class",i)}function zC(e,o,i){const{mergedAttrs:a,classes:u,styles:f}=i;null!==a&&uh(e,o,a),null!==u&&Ro(e,o,u),null!==f&&function mu(e,o,i){e.setAttribute(o,"style",i)}(e,o,f)}class Ec{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function to(e){return e instanceof Ec?e.changingThisBreaksApplicationSecurity:e}const Qp=new Gt("ENVIRONMENT_INITIALIZER"),Nx=new Gt("INJECTOR",-1),tM=new Gt("INJECTOR_DEF_TYPES");class tm{get(o,i=gs){if(i===gs){const a=new Error(`NullInjectorError: No provider for ${Rr(o)}!`);throw a.name="NullInjectorError",a}return i}}function Bx(...e){return{\u0275providers:Vx(0,e),\u0275fromNgModule:!0}}function Vx(e,...o){const i=[],a=new Set;let u;const f=g=>{i.push(g)};return Jn(o,g=>{const x=g;Ga(x,f,[],a)&&(u||=[],u.push(x))}),void 0!==u&&jx(u,f),i}function jx(e,o){for(let i=0;i<e.length;i++){const{ngModule:a,providers:u}=e[i];Ux(u,f=>{o(f,a)})}}function Ga(e,o,i,a){if(!(e=Qe(e)))return!1;let u=null,f=nh(e);const g=!f&&Kn(e);if(f||g){if(g&&!g.standalone)return!1;u=e}else{const w=e.ngModule;if(f=nh(w),!f)return!1;u=w}const x=a.has(u);if(g){if(x)return!1;if(a.add(u),g.dependencies){const w="function"==typeof g.dependencies?g.dependencies():g.dependencies;for(const T of w)Ga(T,o,i,a)}}else{if(!f)return!1;{if(null!=f.imports&&!x){let T;a.add(u);try{Jn(f.imports,A=>{Ga(A,o,i,a)&&(T||=[],T.push(A))})}finally{}void 0!==T&&jx(T,o)}if(!x){const T=Dl(u)||(()=>new u);o({provide:u,useFactory:T,deps:ri},u),o({provide:tM,useValue:u,multi:!0},u),o({provide:Qp,useValue:()=>bt(u),multi:!0},u)}const w=f.providers;if(null!=w&&!x){const T=e;Ux(w,A=>{o(A,T)})}}}return u!==e&&void 0!==e.providers}function Ux(e,o){for(let i of e)Hg(i)&&(i=i.\u0275providers),Array.isArray(i)?Ux(i,o):o(i)}const qh=xi({provide:String,useValue:xi});function em(e){return null!==e&&"object"==typeof e&&qh in e}function _u(e){return"function"==typeof e}const $x=new Gt("Set Injector scope."),oy={},BA={};let Hx;function im(){return void 0===Hx&&(Hx=new tm),Hx}class Ss{}class Wh extends Ss{get destroyed(){return this._destroyed}constructor(o,i,a,u){super(),this.parent=i,this.source=a,this.scopes=u,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Pi(o,g=>this.processProvider(g)),this.records.set(Nx,Ed(void 0,this)),u.has("environment")&&this.records.set(Ss,Ed(void 0,this));const f=this.records.get($x);null!=f&&"string"==typeof f.value&&this.scopes.add(f.value),this.injectorDefTypes=new Set(this.get(tM.multi,ri,Ye.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const o=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of o)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(o){return this.assertNotDestroyed(),this._onDestroyHooks.push(o),()=>this.removeOnDestroy(o)}runInContext(o){this.assertNotDestroyed();const i=hc(this),a=Gr(void 0);try{return o()}finally{hc(i),Gr(a)}}get(o,i=gs,a=Ye.Default){if(this.assertNotDestroyed(),o.hasOwnProperty(o_))return o[o_](this);a=n_(a);const f=hc(this),g=Gr(void 0);try{if(!(a&Ye.SkipSelf)){let w=this.records.get(o);if(void 0===w){const T=function Mc(e){return"function"==typeof e||"object"==typeof e&&e instanceof Gt}(o)&&ap(o);w=T&&this.injectableDefInScope(T)?Ed(sy(o),oy):null,this.records.set(o,w)}if(null!=w)return this.hydrate(o,w)}return(a&Ye.Self?im():this.parent).get(o,i=a&Ye.Optional&&i===gs?null:i)}catch(x){if("NullInjectorError"===x.name){if((x[up]=x[up]||[]).unshift(Rr(o)),f)throw x;return function fE(e,o,i,a){const u=e[up];throw o[sh]&&u.unshift(o[sh]),e.message=function pE(e,o,i,a=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let u=Rr(o);if(Array.isArray(o))u=o.map(Rr).join(" -> ");else if("object"==typeof o){let f=[];for(let g in o)if(o.hasOwnProperty(g)){let x=o[g];f.push(g+":"+("string"==typeof x?JSON.stringify(x):Rr(x)))}u=`{${f.join(", ")}}`}return`${i}${a?"("+a+")":""}[${u}]: ${e.replace($I,"\n  ")}`}("\n"+e.message,u,i,a),e.ngTokenPath=u,e[up]=null,e}(x,o,"R3InjectorError",this.source)}throw x}finally{Gr(g),hc(f)}}resolveInjectorInitializers(){const o=hc(this),i=Gr(void 0);try{const u=this.get(Qp.multi,ri,Ye.Self);for(const f of u)f()}finally{hc(o),Gr(i)}}toString(){const o=[],i=this.records;for(const a of i.keys())o.push(Rr(a));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new at(205,!1)}processProvider(o){let i=_u(o=Qe(o))?o:Qe(o&&o.provide);const a=function jA(e){return em(e)?Ed(void 0,e.useValue):Ed(Gx(e),oy)}(o);if(_u(o)||!0!==o.multi)this.records.get(i);else{let u=this.records.get(i);u||(u=Ed(void 0,oy,!0),u.factory=()=>i_(u.multi),this.records.set(i,u)),i=o,u.multi.push(o)}this.records.set(i,a)}hydrate(o,i){return i.value===oy&&(i.value=BA,i.value=i.factory()),"object"==typeof i.value&&i.value&&function qx(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(o){if(!o.providedIn)return!1;const i=Qe(o.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(o){const i=this._onDestroyHooks.indexOf(o);-1!==i&&this._onDestroyHooks.splice(i,1)}}function sy(e){const o=ap(e),i=null!==o?o.factory:Dl(e);if(null!==i)return i;if(e instanceof Gt)throw new at(204,!1);if(e instanceof Function)return function VA(e){const o=e.length;if(o>0)throw Ph(o,"?"),new at(204,!1);const i=function Kg(e){return e&&(e[To]||e[Jg])||null}(e);return null!==i?()=>i.factory(e):()=>new e}(e);throw new at(204,!1)}function Gx(e,o,i){let a;if(_u(e)){const u=Qe(e);return Dl(u)||sy(u)}if(em(e))a=()=>Qe(e.useValue);else if(function nm(e){return!(!e||!e.useFactory)}(e))a=()=>e.useFactory(...i_(e.deps||[]));else if(function wd(e){return!(!e||!e.useExisting)}(e))a=()=>bt(Qe(e.useExisting));else{const u=Qe(e&&(e.useClass||e.provide));if(!function nM(e){return!!e.deps}(e))return Dl(u)||sy(u);a=()=>new u(...i_(e.deps))}return a}function Ed(e,o,i=!1){return{factory:e,value:o,multi:i?[]:void 0}}function Pi(e,o){for(const i of e)Array.isArray(i)?Pi(i,o):i&&Hg(i)?Pi(i.\u0275providers,o):o(i)}const rm=new Gt("AppId",{providedIn:"root",factory:()=>UA}),UA="ng",iM=new Gt("Platform Initializer"),qa=new Gt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),yu=new Gt("AnimationModuleType"),Wx=new Gt("CSP nonce",{providedIn:"root",factory:()=>function Oo(){if(void 0!==Ix)return Ix;if(typeof document<"u")return document;throw new at(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let lm=(e,o,i)=>null;function cy(e,o,i=!1){return lm(e,o,i)}class HA{}class aM{}class qA{resolveComponentFactory(o){throw function GA(e){const o=Error(`No component factory found for ${Rr(e)}.`);return o.ngComponent=e,o}(o)}}let dm=(()=>{class e{static#t=this.NULL=new qA}return e})();function fy(){return Jh(ho(),Nt())}function Jh(e,o){return new Gi(ys(e,o))}let Gi=(()=>{class e{constructor(i){this.nativeElement=i}static#t=this.__NG_ELEMENT_ID__=fy}return e})();function Qh(e){return e instanceof Gi?e.nativeElement:e}class hm{}let Tc=(()=>{class e{constructor(){this.destroyNode=null}static#t=this.__NG_ELEMENT_ID__=()=>function WA(){const e=Nt(),i=Hs(ho().index,e);return(Do(i)?i:e)[nn]}()}return e})(),cM=(()=>{class e{static#t=this.\u0275prov=ie({token:e,providedIn:"root",factory:()=>null})}return e})();class xu{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const ZA=new xu("16.2.12"),ib={};function ob(e,o=null,i=null,a){const u=jl(e,o,i,a);return u.resolveInjectorInitializers(),u}function jl(e,o=null,i=null,a,u=new Set){const f=[i||ri,Bx(e)];return a=a||("object"==typeof e?void 0:Rr(e)),new Wh(f,o||im(),a||null,u)}let Or=(()=>{class e{static#t=this.THROW_IF_NOT_FOUND=gs;static#e=this.NULL=new tm;static create(i,a){if(Array.isArray(i))return ob({name:""},a,i,"");{const u=i.name??"";return ob({name:u},i.parent,i.providers,u)}}static#n=this.\u0275prov=ie({token:e,providedIn:"any",factory:()=>bt(Nx)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();function ab(e){return e.ngOriginalError}class Wa{constructor(){this._console=console}handleError(o){const i=this._findOriginalError(o);this._console.error("ERROR",o),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(o){let i=o&&ab(o);for(;i&&ab(i);)i=ab(i);return i||null}}function cb(e){return o=>{setTimeout(e,void 0,o)}}const oi=class KA extends xn{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,i,a){let u=o,f=i||(()=>null),g=a;if(o&&"object"==typeof o){const w=o;u=w.next?.bind(w),f=w.error?.bind(w),g=w.complete?.bind(w)}this.__isAsync&&(f=cb(f),u&&(u=cb(u)),g&&(g=cb(g)));const x=super.subscribe({next:u,error:f,complete:g});return o instanceof st&&o.add(x),x}};function gm(...e){}class Je{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new oi(!1),this.onMicrotaskEmpty=new oi(!1),this.onStable=new oi(!1),this.onError=new oi(!1),typeof Zone>"u")throw new at(908,!1);Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!a&&i,u.shouldCoalesceRunChangeDetection=a,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function tf(){const e="function"==typeof Bi.requestAnimationFrame;let o=Bi[e?"requestAnimationFrame":"setTimeout"],i=Bi[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&o&&i){const a=o[Zone.__symbol__("OriginalDelegate")];a&&(o=a);const u=i[Zone.__symbol__("OriginalDelegate")];u&&(i=u)}return{nativeRequestAnimationFrame:o,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function fM(e){const o=()=>{!function t2(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Bi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,gy(e),e.isCheckStableRunning=!0,my(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),gy(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,a,u,f,g,x)=>{if(function bu(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(x))return i.invokeTask(u,f,g,x);try{return ub(e),i.invokeTask(u,f,g,x)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===f.type||e.shouldCoalesceRunChangeDetection)&&o(),db(e)}},onInvoke:(i,a,u,f,g,x,w)=>{try{return ub(e),i.invoke(u,f,g,x,w)}finally{e.shouldCoalesceRunChangeDetection&&o(),db(e)}},onHasTask:(i,a,u,f)=>{i.hasTask(u,f),a===u&&("microTask"==f.change?(e._hasPendingMicrotasks=f.microTask,gy(e),my(e)):"macroTask"==f.change&&(e.hasPendingMacrotasks=f.macroTask))},onHandleError:(i,a,u,f)=>(i.handleError(u,f),e.runOutsideAngular(()=>e.onError.emit(f)),!1)})}(u)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Je.isInAngularZone())throw new at(909,!1)}static assertNotInAngularZone(){if(Je.isInAngularZone())throw new at(909,!1)}run(o,i,a){return this._inner.run(o,i,a)}runTask(o,i,a,u){const f=this._inner,g=f.scheduleEventTask("NgZoneEvent: "+u,o,QA,gm,gm);try{return f.runTask(g,i,a)}finally{f.cancelTask(g)}}runGuarded(o,i,a){return this._inner.runGuarded(o,i,a)}runOutsideAngular(o){return this._outer.run(o)}}const QA={};function my(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function gy(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function ub(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function db(e){e._nesting--,my(e)}class pM{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new oi,this.onMicrotaskEmpty=new oi,this.onStable=new oi,this.onError=new oi}run(o,i,a){return o.apply(i,a)}runGuarded(o,i,a){return o.apply(i,a)}runOutsideAngular(o){return o()}runTask(o,i,a,u){return o.apply(i,a)}}const hb=new Gt("",{providedIn:"root",factory:fb});function fb(){const e=ee(Je);let o=!0;return uc(new $n(u=>{o=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{u.next(o),u.complete()})}),new $n(u=>{let f;e.runOutsideAngular(()=>{f=e.onStable.subscribe(()=>{Je.assertNotInAngularZone(),queueMicrotask(()=>{!o&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(o=!0,u.next(!0))})})});const g=e.onUnstable.subscribe(()=>{Je.assertInAngularZone(),o&&(o=!1,e.runOutsideAngular(()=>{u.next(!1)}))});return()=>{f.unsubscribe(),g.unsubscribe()}}).pipe(zn()))}function Dc(e){return e instanceof Function?e():e}let gb=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#t=this.\u0275prov=ie({token:e,providedIn:"root",factory:()=>new e})}return e})();function _m(e){for(;e;){e[dn]|=64;const o=Lh(e);if(T0(e)&&!o)return e;e=o}return null}const xM=new Gt("",{providedIn:"root",factory:()=>!1});let vy=null;function xy(e,o){return e[o]??_b()}function CM(e,o){const i=_b();i.producerNode?.length&&(e[o]=vy,i.lView=e,vy=MM())}const r2={...DE,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{_m(e.lView)},lView:null};function MM(){return Object.create(r2)}function _b(){return vy??=MM(),vy}const on={};function mn(e){by(qn(),Nt(),Ao()+e,!1)}function by(e,o,i,a){if(!a)if(3==(3&o[dn])){const f=e.preOrderCheckHooks;null!==f&&Ch(o,f,i)}else{const f=e.preOrderHooks;null!==f&&ja(o,f,0,i)}_c(i)}function xt(e,o=Ye.Default){const i=Nt();return null===i?bt(e,o):tC(ho(),i,Qe(e),o)}function ti(){throw new Error("invalid")}function wu(e,o,i,a,u,f,g,x,w,T,A){const k=o.blueprint.slice();return k[_r]=u,k[dn]=140|a,(null!==T||e&&2048&e[dn])&&(k[dn]|=2048),Ba(k),k[Ai]=k[fh]=e,k[yr]=i,k[ou]=g||e&&e[ou],k[nn]=x||e&&e[nn],k[Ml]=w||e&&e[Ml]||null,k[Ho]=f,k[ed]=function EC(){return $a++}(),k[Tl]=A,k[La]=T,k[tr]=2==o.type?e[tr]:k,k}function Xa(e,o,i,a,u){let f=e.data[o];if(null===f)f=function vm(e,o,i,a,u){const f=w_(),g=E_(),w=e.data[o]=function RM(e,o,i,a,u,f){let g=o?o.injectorIndex:-1,x=0;return od()&&(x|=128),{type:i,index:a,insertBeforeIndex:null,injectorIndex:g,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:x,providerIndexes:0,value:u,attrs:f,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,g?f:f&&f.parent,i,o,a,u);return null===e.firstChild&&(e.firstChild=w),null!==f&&(g?null==f.child&&null!==w.parent&&(f.child=w):null===f.next&&(f.next=w,w.prev=f)),w}(e,o,i,a,u),function Ip(){return qe.lFrame.inI18n}()&&(f.flags|=32);else if(64&f.type){f.type=i,f.value=a,f.attrs=u;const g=function sd(){const e=qe.lFrame,o=e.currentTNode;return e.isParent?o:o.parent}();f.injectorIndex=null===g?-1:g.injectorIndex}return da(f,!0),f}function Eu(e,o,i,a){if(0===i)return-1;const u=o.length;for(let f=0;f<i;f++)o.push(a),e.blueprint.push(a),e.data.push(null);return u}function TM(e,o,i,a,u){const f=xy(o,nd),g=Ao(),x=2&a;try{_c(-1),x&&o.length>On&&by(e,o,On,!1),os(x?2:0,u);const T=x?f:null,A=Ep(T);try{null!==T&&(T.dirty=!1),i(a,u)}finally{_h(T,A)}}finally{x&&null===o[nd]&&CM(o,nd),_c(g),os(x?3:1,u)}}function wy(e,o,i){if(f_(o)){const a=Us(null);try{const f=o.directiveEnd;for(let g=o.directiveStart;g<f;g++){const x=e.data[g];x.contentQueries&&x.contentQueries(1,i[g],g)}}finally{Us(a)}}}function Ey(e,o,i){b_()&&(function Sy(e,o,i,a){const u=i.directiveStart,f=i.directiveEnd;au(i)&&function Cb(e,o,i){const a=ys(o,e),u=vb(i);let g=16;i.signals?g=4096:i.onPush&&(g=64);const x=wm(e,wu(e,u,null,g,a,o,null,e[ou].rendererFactory.createRenderer(a,i),null,null,null));e[o.index]=x}(o,i,e.data[u+i.componentOffset]),e.firstCreatePass||Fp(i,o),fo(a,o);const g=i.initialInputs;for(let x=u;x<f;x++){const w=e.data[x],T=yc(o,e,x,i);fo(T,o),null!==g&&u2(0,x-u,T,w,0,g),Na(w)&&(Hs(i.index,o)[yr]=yc(o,e,x,i))}}(e,o,i,ys(i,o)),64==(64&i.flags)&&wb(e,o,i))}function yb(e,o,i=ys){const a=o.localNames;if(null!==a){let u=o.index+1;for(let f=0;f<a.length;f+=2){const g=a[f+1],x=-1===g?i(o,e):e[g];e[u++]=x}}}function vb(e){const o=e.tView;return null===o||o.incompleteFirstPass?e.tView=Cy(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):o}function Cy(e,o,i,a,u,f,g,x,w,T,A){const k=On+a,B=k+u,G=function My(e,o){const i=[];for(let a=0;a<o;a++)i.push(a<e?null:on);return i}(k,B),K="function"==typeof T?T():T;return G[he]={type:e,blueprint:G,template:i,queries:null,viewQuery:x,declTNode:o,data:G.slice().fill(null,k),bindingStartIndex:k,expandoStartIndex:B,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof f?f():f,pipeRegistry:"function"==typeof g?g():g,firstChild:null,schemas:w,consts:K,incompleteFirstPass:!1,ssrId:A}}let xb=e=>null;function bb(e,o,i,a){for(let u in e)if(e.hasOwnProperty(u)){i=null===i?{}:i;const f=e[u];null===a?PM(i,o,u,f):a.hasOwnProperty(u)&&PM(i,o,a[u],f)}return i}function PM(e,o,i,a){e.hasOwnProperty(i)?e[i].push(o,a):e[i]=[o,a]}function Ts(e,o,i,a,u,f,g,x){const w=ys(o,i);let A,T=o.inputs;!x&&null!=T&&(A=T[a])?(Py(e,i,A,a,u),au(o)&&function xm(e,o){const i=Hs(o,e);16&i[dn]||(i[dn]|=64)}(i,o.index)):3&o.type&&(a=function OM(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(a),u=null!=g?g(u,o.value||"",a):u,f.setProperty(w,a,u))}function Ys(e,o,i,a){if(b_()){const u=null===a?null:{"":-1},f=function Dy(e,o){const i=e.directiveRegistry;let a=null,u=null;if(i)for(let f=0;f<i.length;f++){const g=i[f];if(yE(o,g.selectors,!1))if(a||(a=[]),Na(g))if(null!==g.findHostDirectiveDefs){const x=[];u=u||new Map,g.findHostDirectiveDefs(g,x,u),a.unshift(...x,g),Eb(e,o,x.length)}else a.unshift(g),Eb(e,o,0);else u=u||new Map,g.findHostDirectiveDefs?.(g,a,u),a.push(g)}return null===a?null:[a,u]}(e,i);let g,x;null===f?g=x=null:[g,x]=f,null!==g&&Sd(e,o,i,g,u,x),u&&function l2(e,o,i){if(o){const a=e.localNames=[];for(let u=0;u<o.length;u+=2){const f=i[o[u+1]];if(null==f)throw new at(-301,!1);a.push(o[u],f)}}}(i,a,u)}i.mergedAttrs=Fa(i.mergedAttrs,i.attrs)}function Sd(e,o,i,a,u,f){for(let T=0;T<a.length;T++)z_(Fp(i,o),e,a[T].type);!function nf(e,o,i){e.flags|=1,e.directiveStart=o,e.directiveEnd=o+i,e.providerIndexes=o}(i,e.data.length,a.length);for(let T=0;T<a.length;T++){const A=a[T];A.providersResolver&&A.providersResolver(A)}let g=!1,x=!1,w=Eu(e,o,a.length,null);for(let T=0;T<a.length;T++){const A=a[T];i.mergedAttrs=Fa(i.mergedAttrs,A.hostAttrs),rf(e,i,o,w,A),c2(w,A,u),null!==A.contentQueries&&(i.flags|=4),(null!==A.hostBindings||null!==A.hostAttrs||0!==A.hostVars)&&(i.flags|=64);const k=A.type.prototype;!g&&(k.ngOnChanges||k.ngOnInit||k.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),g=!0),!x&&(k.ngOnChanges||k.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),x=!0),w++}!function s2(e,o,i){const u=o.directiveEnd,f=e.data,g=o.attrs,x=[];let w=null,T=null;for(let A=o.directiveStart;A<u;A++){const k=f[A],B=i?i.get(k):null,K=B?B.outputs:null;w=bb(k.inputs,A,w,B?B.inputs:null),T=bb(k.outputs,A,T,K);const et=null===w||null===g||mE(o)?null:d2(w,A,g);x.push(et)}null!==w&&(w.hasOwnProperty("class")&&(o.flags|=8),w.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=x,o.inputs=w,o.outputs=T}(e,i,f)}function wb(e,o,i){const a=i.directiveStart,u=i.directiveEnd,f=i.index,g=function Ap(){return qe.lFrame.currentDirectiveIndex}();try{_c(f);for(let x=a;x<u;x++){const w=e.data[x],T=o[x];Ei(x),(null!==w.hostBindings||0!==w.hostVars||null!==w.hostAttrs)&&Ty(w,T)}}finally{_c(-1),Ei(g)}}function Ty(e,o){null!==e.hostBindings&&e.hostBindings(1,o)}function Eb(e,o,i){o.componentOffset=i,(e.components??=[]).push(o.index)}function c2(e,o,i){if(i){if(o.exportAs)for(let a=0;a<o.exportAs.length;a++)i[o.exportAs[a]]=e;Na(o)&&(i[""]=e)}}function rf(e,o,i,a,u){e.data[a]=u;const f=u.factory||(u.factory=Dl(u.type)),g=new ld(f,Na(u),xt);e.blueprint[a]=g,i[a]=g,function Cu(e,o,i,a,u){const f=u.hostBindings;if(f){let g=e.hostBindingOpCodes;null===g&&(g=e.hostBindingOpCodes=[]);const x=~o.index;(function FM(e){let o=e.length;for(;o>0;){const i=e[--o];if("number"==typeof i&&i<0)return i}return 0})(g)!=x&&g.push(x),g.push(i,a,f)}}(e,o,a,Eu(e,i,u.hostVars,on),u)}function Ul(e,o,i,a,u,f){const g=ys(e,o);!function bm(e,o,i,a,u,f,g){if(null==f)e.removeAttribute(o,u,i);else{const x=null==g?J(f):g(f,a||"",u);e.setAttribute(o,u,x,i)}}(o[nn],g,f,e.value,i,a,u)}function u2(e,o,i,a,u,f){const g=f[o];if(null!==g)for(let x=0;x<g.length;)Iy(a,i,g[x++],g[x++],g[x++])}function Iy(e,o,i,a,u){const f=Us(null);try{const g=e.inputTransforms;null!==g&&g.hasOwnProperty(a)&&(u=g[a].call(o,u)),null!==e.setInput?e.setInput(o,u,i,a):o[a]=u}finally{Us(f)}}function d2(e,o,i){let a=null,u=0;for(;u<i.length;){const f=i[u];if(0!==f)if(5!==f){if("number"==typeof f)break;if(e.hasOwnProperty(f)){null===a&&(a=[]);const g=e[f];for(let x=0;x<g.length;x+=2)if(g[x]===o){a.push(f,g[x+1],i[u+1]);break}}u+=2}else u+=2;else u+=4}return a}function sf(e,o,i,a){return[e,!0,!1,o,null,0,a,i,null,null,null]}function Rc(e,o){const i=e.contentQueries;if(null!==i)for(let a=0;a<i.length;a+=2){const f=i[a+1];if(-1!==f){const g=e.data[f];S_(i[a]),g.contentQueries(2,o[f],f)}}}function wm(e,o){return e[hh]?e[S0][ca]=o:e[hh]=o,e[S0]=o,o}function Ay(e,o,i){S_(0);const a=Us(null);try{o(e,i)}finally{Us(a)}}function Ry(e){return e[dh]||(e[dh]=[])}function LM(e){return e.cleanup||(e.cleanup=[])}function Mu(e,o){const i=e[Ml],a=i?i.get(Wa,null):null;a&&a.handleError(o)}function Py(e,o,i,a,u){for(let f=0;f<i.length;){const g=i[f++],x=i[f++];Iy(e.data[g],o[g],a,x,u)}}function NM(e,o){const i=Hs(o,e),a=i[he];!function h2(e,o){for(let i=o.length;i<e.blueprint.length;i++)o.push(e.blueprint[i])}(a,i);const u=i[_r];null!==u&&null===i[Tl]&&(i[Tl]=cy(u,i[Ml])),Hl(a,i,i[yr])}function Hl(e,o,i){Z0(o);try{const a=e.viewQuery;null!==a&&Ay(1,a,i);const u=e.template;null!==u&&TM(e,o,u,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Rc(e,o),e.staticViewQueries&&Ay(2,e.viewQuery,i);const f=e.components;null!==f&&function f2(e,o){for(let i=0;i<o.length;i++)NM(e,o[i])}(o,f)}catch(a){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),a}finally{o[dn]&=-5,qo()}}let af=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(i,a,u){const f=typeof Zone>"u"?null:Zone.current,g=function BE(e,o,i){const a=Object.create(VE);i&&(a.consumerAllowSignalWrites=!0),a.fn=e,a.schedule=o;const u=g=>{a.cleanupFn=g};return a.ref={notify:()=>gc(a),run:()=>{if(a.dirty=!1,a.hasRun&&!Cp(a))return;a.hasRun=!0;const g=Ep(a);try{a.cleanupFn(),a.cleanupFn=id,a.fn(u)}finally{_h(a,g)}},cleanup:()=>a.cleanupFn()},a.ref}(i,T=>{this.all.has(T)&&this.queue.set(T,f)},u);let x;this.all.add(g),g.notify();const w=()=>{g.cleanup(),x?.(),this.all.delete(g),this.queue.delete(g)};return x=a?.onDestroy(w),{destroy:w}}flush(){if(0!==this.queue.size)for(const[i,a]of this.queue)this.queue.delete(i),a?a.run(()=>i.run()):i.run()}get isQueueEmpty(){return 0===this.queue.size}static#t=this.\u0275prov=ie({token:e,providedIn:"root",factory:()=>new e})}return e})();function Su(e,o,i){let a=i?e.styles:null,u=i?e.classes:null,f=0;if(null!==o)for(let g=0;g<o.length;g++){const x=o[g];"number"==typeof x?f=x:1==f?u=op(u,x):2==f&&(a=op(a,x+": "+o[++g]+";"))}i?e.styles=a:e.stylesWithoutHost=a,i?e.classes=u:e.classesWithoutHost=u}function Pc(e,o,i,a,u=!1){for(;null!==i;){const f=o[i.index];null!==f&&a.push(Yi(f)),is(f)&&Cm(f,a);const g=i.type;if(8&g)Pc(e,o,i.child,a);else if(32&g){const x=Hp(i,o);let w;for(;w=x();)a.push(w)}else if(16&g){const x=Tx(o,i);if(Array.isArray(x))a.push(...x);else{const w=Lh(o[tr]);Pc(w[he],w,x,a,!0)}}i=u?i.projectionNext:i.next}return a}function Cm(e,o){for(let i=Zr;i<e.length;i++){const a=e[i],u=a[he].firstChild;null!==u&&Pc(a[he],a,u,o)}e[js]!==e[_r]&&o.push(e[js])}function Oy(e,o,i,a=!0){const u=o[ou],f=u.rendererFactory,g=u.afterRenderEventManager;f.begin?.(),g?.begin();try{Mm(e,o,e.template,i)}catch(w){throw a&&Mu(o,w),w}finally{f.end?.(),u.effectManager?.flush(),g?.end()}}function Mm(e,o,i,a){const u=o[dn];if(256!=(256&u)){o[ou].effectManager?.flush(),Z0(o);try{Ba(o),function W0(e){return qe.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==i&&TM(e,o,i,2,a);const g=3==(3&u);if(g){const T=e.preOrderCheckHooks;null!==T&&Ch(o,T,null)}else{const T=e.preOrderHooks;null!==T&&ja(o,T,0,null),er(o,0)}if(function BM(e){for(let o=yx(e);null!==o;o=vx(o)){if(!o[wE])continue;const i=o[su];for(let a=0;a<i.length;a++){bh(i[a])}}}(o),zM(o,2),null!==e.contentQueries&&Rc(e,o),g){const T=e.contentCheckHooks;null!==T&&Ch(o,T)}else{const T=e.contentHooks;null!==T&&ja(o,T,1),er(o,1)}!function SM(e,o){const i=e.hostBindingOpCodes;if(null===i)return;const a=xy(o,ph);try{for(let u=0;u<i.length;u++){const f=i[u];if(f<0)_c(~f);else{const g=f,x=i[++u],w=i[++u];se(x,g),a.dirty=!1;const T=Ep(a);try{w(2,o[g])}finally{_h(a,T)}}}}finally{null===o[ph]&&CM(o,ph),_c(-1)}}(e,o);const x=e.components;null!==x&&Tb(o,x,0);const w=e.viewQuery;if(null!==w&&Ay(2,w,a),g){const T=e.viewCheckHooks;null!==T&&Ch(o,T)}else{const T=e.viewHooks;null!==T&&ja(o,T,2),er(o,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),o[dn]&=-73,Dp(o)}finally{qo()}}}function zM(e,o){for(let i=yx(e);null!==i;i=vx(i))for(let a=Zr;a<i.length;a++)jM(i[a],o)}function VM(e,o,i){jM(Hs(o,e),i)}function jM(e,o){if(!function x_(e){return 128==(128&e[dn])}(e))return;const i=e[he],a=e[dn];if(80&a&&0===o||1024&a||2===o)Mm(i,e,i.template,e[yr]);else if(e[yp]>0){zM(e,1);const u=i.components;null!==u&&Tb(e,u,1)}}function Tb(e,o,i){for(let a=0;a<o.length;a++)VM(e,o[a],i)}class Sm{get rootNodes(){const o=this._lView,i=o[he];return Pc(i,o,i.firstChild,[])}constructor(o,i){this._lView=o,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[yr]}set context(o){this._lView[yr]=o}get destroyed(){return 256==(256&this._lView[dn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[Ai];if(is(o)){const i=o[8],a=i?i.indexOf(this):-1;a>-1&&(X_(o,a),Ua(i,a))}this._attachedToViewContainer=!1}rt(this._lView[he],this._lView)}onDestroy(o){!function U0(e,o){if(256==(256&e[dn]))throw new at(911,!1);null===e[Sl]&&(e[Sl]=[]),e[Sl].push(o)}(this._lView,o)}markForCheck(){_m(this._cdRefInjectingView||this._lView)}detach(){this._lView[dn]&=-129}reattach(){this._lView[dn]|=128}detectChanges(){Oy(this._lView[he],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new at(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function RA(e,o){Uh(e,o,o[nn],2,null,null)}(this._lView[he],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new at(902,!1);this._appRef=o}}class UM extends Sm{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Oy(o[he],o,o[yr],!1)}checkNoChanges(){}get context(){return null}}class $M extends dm{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const i=Kn(o);return new cf(i,this.ngModule)}}function Tm(e){const o=[];for(let i in e)e.hasOwnProperty(i)&&o.push({propName:e[i],templateName:i});return o}class Db{constructor(o,i){this.injector=o,this.parentInjector=i}get(o,i,a){a=n_(a);const u=this.injector.get(o,ib,a);return u!==ib||i===ib?u:this.parentInjector.get(o,i,a)}}class cf extends aM{get inputs(){const o=this.componentDef,i=o.inputTransforms,a=Tm(o.inputs);if(null!==i)for(const u of a)i.hasOwnProperty(u.propName)&&(u.transform=i[u.propName]);return a}get outputs(){return Tm(this.componentDef.outputs)}constructor(o,i){super(),this.componentDef=o,this.ngModule=i,this.componentType=o.type,this.selector=function xE(e){return e.map(ZI).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!i}create(o,i,a,u){let f=(u=u||this.ngModule)instanceof Ss?u:u?.injector;f&&null!==this.componentDef.getStandaloneInjector&&(f=this.componentDef.getStandaloneInjector(f)||f);const g=f?new Db(o,f):o,x=g.get(hm,null);if(null===x)throw new at(407,!1);const k={rendererFactory:x,sanitizer:g.get(cM,null),effectManager:g.get(af,null),afterRenderEventManager:g.get(gb,null)},B=x.createRenderer(null,this.componentDef),G=this.componentDef.selectors[0][0]||"div",K=a?function DM(e,o,i,a){const f=a.get(xM,!1)||i===Vo.ShadowDom,g=e.selectRootElement(o,f);return function o2(e){xb(e)}(g),g}(B,a,this.componentDef.encapsulation,g):Nh(B,G,function p2(e){const o=e.toLowerCase();return"svg"===o?HE:"math"===o?"math":null}(G)),_t=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let pt=null;null!==K&&(pt=cy(K,g,!0));const Ft=Cy(0,null,null,1,0,null,null,null,null,null,null),Zt=wu(null,Ft,null,_t,null,null,k,B,g,null,pt);let de,oe;Z0(Zt);try{const Te=this.componentDef;let hn,yn=null;Te.findHostDirectiveDefs?(hn=[],yn=new Map,Te.findHostDirectiveDefs(Te,hn,yn),hn.push(Te)):hn=[Te];const si=function m2(e,o){const i=e[he],a=On;return e[a]=o,Xa(i,a,2,"#host",null)}(Zt,K),hi=function g2(e,o,i,a,u,f,g){const x=u[he];!function Fy(e,o,i,a){for(const u of e)o.mergedAttrs=Fa(o.mergedAttrs,u.hostAttrs);null!==o.mergedAttrs&&(Su(o,o.mergedAttrs,!0),null!==i&&zC(a,i,o))}(a,e,o,g);let w=null;null!==o&&(w=cy(o,u[Ml]));const T=f.rendererFactory.createRenderer(o,i);let A=16;i.signals?A=4096:i.onPush&&(A=64);const k=wu(u,vb(i),null,A,u[e.index],e,f,T,null,null,w);return x.firstCreatePass&&Eb(x,e,a.length-1),wm(u,k),u[e.index]=k}(si,K,Te,hn,Zt,k,B);oe=qE(Ft,On),K&&function Ny(e,o,i,a){if(a)uh(e,i,["ng-version",ZA.full]);else{const{attrs:u,classes:f}=function E0(e){const o=[],i=[];let a=1,u=2;for(;a<e.length;){let f=e[a];if("string"==typeof f)2===u?""!==f&&o.push(f,e[++a]):8===u&&i.push(f);else{if(!Bs(u))break;u=f}a++}return{attrs:o,classes:i}}(o.selectors[0]);u&&uh(e,i,u),f&&f.length>0&&Ro(e,i,f.join(" "))}}(B,Te,K,a),void 0!==i&&function zy(e,o,i){const a=e.projection=[];for(let u=0;u<o.length;u++){const f=i[u];a.push(null!=f?Array.from(f):null)}}(oe,this.ngContentSelectors,i),de=function Ly(e,o,i,a,u,f){const g=ho(),x=u[he],w=ys(g,u);Sd(x,u,g,i,null,a);for(let A=0;A<i.length;A++)fo(yc(u,x,g.directiveStart+A,g),u);wb(x,u,g),w&&fo(w,u);const T=yc(u,x,g.directiveStart+g.componentOffset,g);if(e[yr]=u[yr]=T,null!==f)for(const A of f)A(T,o);return wy(x,g,e),T}(hi,Te,hn,yn,Zt,[uf]),Hl(Ft,Zt,null)}finally{qo()}return new ky(this.componentType,de,Jh(oe,Zt),Zt,oe)}}class ky extends HA{constructor(o,i,a,u,f){super(),this.location=a,this._rootLView=u,this._tNode=f,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new UM(u),this.componentType=o}setInput(o,i){const a=this._tNode.inputs;let u;if(null!==a&&(u=a[o])){if(this.previousInputValues??=new Map,this.previousInputValues.has(o)&&Object.is(this.previousInputValues.get(o),i))return;const f=this._rootLView;Py(f[he],f,u,o,i),this.previousInputValues.set(o,i),_m(Hs(this._tNode.index,f))}}get injector(){return new me(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function uf(){const e=ho();Eh(Nt()[he],e)}function Wn(e){let o=function HM(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),i=!0;const a=[e];for(;o;){let u;if(Na(e))u=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new at(903,!1);u=o.\u0275dir}if(u){if(i){a.push(u);const g=e;g.inputs=Td(e.inputs),g.inputTransforms=Td(e.inputTransforms),g.declaredInputs=Td(e.declaredInputs),g.outputs=Td(e.outputs);const x=u.hostBindings;x&&y2(e,x);const w=u.viewQuery,T=u.contentQueries;if(w&&Dm(e,w),T&&_2(e,T),rp(e.inputs,u.inputs),rp(e.declaredInputs,u.declaredInputs),rp(e.outputs,u.outputs),null!==u.inputTransforms&&(null===g.inputTransforms&&(g.inputTransforms={}),rp(g.inputTransforms,u.inputTransforms)),Na(u)&&u.data.animation){const A=e.data;A.animation=(A.animation||[]).concat(u.data.animation)}}const f=u.features;if(f)for(let g=0;g<f.length;g++){const x=f[g];x&&x.ngInherit&&x(e),x===Wn&&(i=!1)}}o=Object.getPrototypeOf(o)}!function Ib(e){let o=0,i=null;for(let a=e.length-1;a>=0;a--){const u=e[a];u.hostVars=o+=u.hostVars,u.hostAttrs=Fa(u.hostAttrs,i=Fa(i,u.hostAttrs))}}(a)}function Td(e){return e===la?{}:e===ri?[]:e}function Dm(e,o){const i=e.viewQuery;e.viewQuery=i?(a,u)=>{o(a,u),i(a,u)}:o}function _2(e,o){const i=e.contentQueries;e.contentQueries=i?(a,u,f)=>{o(a,u,f),i(a,u,f)}:o}function y2(e,o){const i=e.hostBindings;e.hostBindings=i?(a,u)=>{o(a,u),i(a,u)}:o}function Ja(e){return!!Am(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Am(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function ko(e,o,i){return!Object.is(e[o],i)&&(e[o]=i,!0)}function Fo(e,o,i,a){const u=Nt();return ko(u,wh(),o)&&(qn(),Ul(Ci(),u,e,o,i,a)),Fo}function hf(e,o,i,a){return ko(e,wh(),i)?o+J(i)+a:on}function Ki(e,o,i,a,u,f,g,x){const w=Nt(),T=qn(),A=e+On,k=T.firstCreatePass?function O2(e,o,i,a,u,f,g,x,w){const T=o.consts,A=Xa(o,e,4,g||null,ss(T,x));Ys(o,i,A,ss(T,w)),Eh(o,A);const k=A.tView=Cy(2,A,a,u,f,o.directiveRegistry,o.pipeRegistry,null,o.schemas,T,null);return null!==o.queries&&(o.queries.template(o,A),k.queries=o.queries.embeddedTView(A)),A}(A,T,w,o,i,a,u,f,g):T.data[A];da(k,!1);const B=rS(T,w,k,e);Va()&&tn(T,w,B,k),fo(B,w),wm(w,w[A]=sf(B,w,B,k)),pc(k)&&Ey(T,w,k),null!=g&&yb(w,k,x)}let rS=function qy(e,o,i,a){return Pl(!0),o[nn].createComment("")};function Lm(e){return function xh(e,o){return e[o]}(function wi(){return qe.lFrame.contextLView}(),On+e)}function Cn(e,o,i){const a=Nt();return ko(a,wh(),o)&&Ts(qn(),Ci(),a,e,o,a[nn],i,!1),Cn}function Wy(e,o,i,a,u){const g=u?"class":"style";Py(e,i,o.inputs[g],g,a)}function Dn(e,o,i,a){const u=Nt(),f=qn(),g=On+e,x=u[nn],w=f.firstCreatePass?function aS(e,o,i,a,u,f){const g=o.consts,w=Xa(o,e,2,a,ss(g,u));return Ys(o,i,w,ss(g,f)),null!==w.attrs&&Su(w,w.attrs,!1),null!==w.mergedAttrs&&Su(w,w.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,w),w}(g,f,u,o,i,a):f.data[g],T=Nb(f,u,w,x,o,e);u[g]=T;const A=pc(w);return da(w,!0),zC(x,T,w),32!=(32&w.flags)&&Va()&&tn(f,u,T,w),0===function $0(){return qe.lFrame.elementDepthCount}()&&fo(T,u),function uA(){qe.lFrame.elementDepthCount++}(),A&&(Ey(f,u,w),wy(f,w,u)),null!==a&&yb(u,w),Dn}function Nn(){let e=ho();E_()?vs():(e=e.parent,da(e,!1));const o=e;(function ZE(e){return qe.skipHydrationRootTNode===e})(o)&&function G0(){qe.skipHydrationRootTNode=null}(),function dA(){qe.lFrame.elementDepthCount--}();const i=qn();return i.firstCreatePass&&(Eh(i,e),f_(e)&&i.queries.elementEnd(e)),null!=o.classesWithoutHost&&function F_(e){return 0!=(8&e.flags)}(o)&&Wy(i,o,Nt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function J0(e){return 0!=(16&e.flags)}(o)&&Wy(i,o,Nt(),o.stylesWithoutHost,!1),Nn}function io(e,o,i,a){return Dn(e,o,i,a),Nn(),io}let Nb=(e,o,i,a,u,f)=>(Pl(!0),Nh(a,u,function I_(){return qe.lFrame.currentNamespace}()));function wf(e){return!!e&&"function"==typeof e.then}function Bb(e){return!!e&&"function"==typeof e.subscribe}function Fr(e,o,i,a){const u=Nt(),f=qn(),g=ho();return function Nm(e,o,i,a,u,f,g){const x=pc(a),T=e.firstCreatePass&&LM(e),A=o[yr],k=Ry(o);let B=!0;if(3&a.type||g){const et=ys(a,o),ut=g?g(et):et,_t=k.length,pt=g?Zt=>g(Yi(Zt[a.index])):a.index;let Ft=null;if(!g&&x&&(Ft=function uS(e,o,i,a){const u=e.cleanup;if(null!=u)for(let f=0;f<u.length-1;f+=2){const g=u[f];if(g===i&&u[f+1]===a){const x=o[dh],w=u[f+2];return x.length>w?x[w]:null}"string"==typeof g&&(f+=2)}return null}(e,o,u,a.index)),null!==Ft)(Ft.__ngLastListenerFn__||Ft).__ngNextListenerFn__=f,Ft.__ngLastListenerFn__=f,B=!1;else{f=jb(a,o,A,f,!1);const Zt=i.listen(ut,u,f);k.push(f,Zt),T&&T.push(u,pt,_t,_t+1)}}else f=jb(a,o,A,f,!1);const G=a.outputs;let K;if(B&&null!==G&&(K=G[u])){const et=K.length;if(et)for(let ut=0;ut<et;ut+=2){const de=o[K[ut]][K[ut+1]].subscribe(f),oe=k.length;k.push(f,de),T&&T.push(u,a.index,oe,-(oe+1))}}}(f,u,u[nn],g,e,o,a),Fr}function Ad(e,o,i,a){try{return os(6,o,i),!1!==i(a)}catch(u){return Mu(e,u),!1}finally{os(7,o,i)}}function jb(e,o,i,a,u){return function f(g){if(g===Function)return a;_m(e.componentOffset>-1?Hs(e.index,o):o);let w=Ad(o,i,a,g),T=f.__ngNextListenerFn__;for(;T;)w=Ad(o,i,T,g)&&w,T=T.__ngNextListenerFn__;return u&&!1===w&&g.preventDefault(),w}}function ro(e=1){return function T_(e){return(qe.lFrame.contextLView=function ad(e,o){for(;e>0;)o=o[fh],e--;return o}(e,qe.lFrame.contextLView))[yr]}(e)}function dS(e,o){let i=null;const a=function GI(e){const o=e.attrs;if(null!=o){const i=o.indexOf(5);if(!(1&i))return o[i+1]}return null}(e);for(let u=0;u<o.length;u++){const f=o[u];if("*"!==f){if(null===a?yE(e,f,!0):WI(a,f))return u}else i=u}return i}function Tu(e){const o=Nt()[tr][Ho];if(!o.projection){const a=o.projection=Ph(e?e.length:1,null),u=a.slice();let f=o.child;for(;null!==f;){const g=e?dS(f,e):0;null!==g&&(u[g]?u[g].projectionNext=f:a[g]=f,u[g]=f),f=f.next}}}function oo(e,o=0,i){const a=Nt(),u=qn(),f=Xa(u,On+e,16,null,i||null);null===f.projection&&(f.projection=o),vs(),(!a[Tl]||od())&&32!=(32&f.flags)&&function NC(e,o,i){Bl(o[nn],0,o,i,Cx(e,i,o),xc(i.parent||o[Ho],i,o))}(u,a,f)}function jm(e,o){return e<<17|o<<2}function Fc(e){return e>>17&32767}function $b(e){return 2|e}function Lc(e){return(131068&e)>>2}function Nc(e,o){return-131069&e|o<<2}function Ky(e){return 1|e}function gS(e,o,i,a,u){const f=e[i+1],g=null===o;let x=a?Fc(f):Lc(f),w=!1;for(;0!==x&&(!1===w||g);){const A=e[x+1];V2(e[x],o)&&(w=!0,e[x+1]=a?Ky(A):$b(A)),x=a?Fc(A):Lc(A)}w&&(e[i+1]=a?$b(f):Ky(f))}function V2(e,o){return null===e||null==o||(Array.isArray(e)?e[1]:e)===o||!(!Array.isArray(e)||"string"!=typeof o)&&fd(e,o)>=0}const Tr={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Hb(e){return e.substring(Tr.key,Tr.keyEnd)}function vS(e,o){const i=Tr.textEnd;return i===o?-1:(o=Tr.keyEnd=function j2(e,o,i){for(;o<i&&e.charCodeAt(o)>32;)o++;return o}(e,Tr.key=o,i),Cf(e,o,i))}function Cf(e,o,i){for(;o<i&&e.charCodeAt(o)<=32;)o++;return o}function Vr(e,o){return function nl(e,o,i,a){const u=Nt(),f=qn(),g=xs(2);f.firstUpdatePass&&Mf(f,e,g,a),o!==on&&ko(u,g,o)&&AS(f,f.data[Ao()],u,u[nn],e,u[g+1]=function Hm(e,o){return null==e||""===e||("string"==typeof o?e+=o:"object"==typeof e&&(e=Rr(to(e)))),e}(o,i),a,g)}(e,o,null,!0),Vr}function el(e,o){for(let i=function yS(e){return function bS(e){Tr.key=0,Tr.keyEnd=0,Tr.value=0,Tr.valueEnd=0,Tr.textEnd=e.length}(e),vS(e,Cf(e,0,Tr.textEnd))}(o);i>=0;i=vS(o,i))Sr(e,Hb(o),!0)}function qb(e,o){return o>=e.expandoStartIndex}function Mf(e,o,i,a){const u=e.data;if(null===u[i+1]){const f=u[Ao()],g=qb(e,i);Xb(f,a)&&null===o&&!g&&(o=!1),o=function SS(e,o,i,a){const u=function Kr(e){const o=qe.lFrame.currentDirectiveIndex;return-1===o?null:e[o]}(e);let f=a?o.residualClasses:o.residualStyles;if(null===u)0===(a?o.classBindings:o.styleBindings)&&(i=Sf(i=Qy(null,e,o,i,a),o.attrs,a),f=null);else{const g=o.directiveStylingLast;if(-1===g||e[g]!==u)if(i=Qy(u,e,o,i,a),null===f){let w=function $2(e,o,i){const a=i?o.classBindings:o.styleBindings;if(0!==Lc(a))return e[Fc(a)]}(e,o,a);void 0!==w&&Array.isArray(w)&&(w=Qy(null,e,o,w[1],a),w=Sf(w,o.attrs,a),function TS(e,o,i,a){e[Fc(i?o.classBindings:o.styleBindings)]=a}(e,o,a,w))}else f=function Wb(e,o,i){let a;const u=o.directiveEnd;for(let f=1+o.directiveStylingLast;f<u;f++)a=Sf(a,e[f].hostAttrs,i);return Sf(a,o.attrs,i)}(e,o,a)}return void 0!==f&&(a?o.residualClasses=f:o.residualStyles=f),i}(u,f,o,a),function Um(e,o,i,a,u,f){let g=f?o.classBindings:o.styleBindings,x=Fc(g),w=Lc(g);e[a]=i;let A,T=!1;if(Array.isArray(i)?(A=i[1],(null===A||fd(i,A)>0)&&(T=!0)):A=i,u)if(0!==w){const B=Fc(e[x+1]);e[a+1]=jm(B,x),0!==B&&(e[B+1]=Nc(e[B+1],a)),e[x+1]=function L2(e,o){return 131071&e|o<<17}(e[x+1],a)}else e[a+1]=jm(x,0),0!==x&&(e[x+1]=Nc(e[x+1],a)),x=a;else e[a+1]=jm(w,0),0===x?x=a:e[w+1]=Nc(e[w+1],a),w=a;T&&(e[a+1]=$b(e[a+1])),gS(e,A,a,!0),gS(e,A,a,!1),function B2(e,o,i,a,u){const f=u?e.residualClasses:e.residualStyles;null!=f&&"string"==typeof o&&fd(f,o)>=0&&(i[a+1]=Ky(i[a+1]))}(o,A,e,a,f),g=jm(x,w),f?o.classBindings=g:o.styleBindings=g}(u,f,o,i,g,a)}}function Qy(e,o,i,a,u){let f=null;const g=i.directiveEnd;let x=i.directiveStylingLast;for(-1===x?x=i.directiveStart:x++;x<g&&(f=o[x],a=Sf(a,f.hostAttrs,u),f!==e);)x++;return null!==e&&(i.directiveStylingLast=x),a}function Sf(e,o,i){const a=i?1:2;let u=-1;if(null!==o)for(let f=0;f<o.length;f++){const g=o[f];"number"==typeof g?u=g:u===a&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Sr(e,g,!!i||o[++f]))}return void 0===e?null:e}function AS(e,o,i,a,u,f,g,x){if(!(3&o.type))return;const w=e.data,T=w[x+1],A=function mS(e){return 1==(1&e)}(T)?RS(w,o,i,u,Lc(T),g):void 0;zc(A)||(zc(f)||function pS(e){return 2==(2&e)}(T)&&(f=RS(w,null,i,u,x,g)),function qp(e,o,i,a,u){if(o)u?e.addClass(i,a):e.removeClass(i,a);else{let f=-1===a.indexOf("-")?void 0:vc.DashCase;null==u?e.removeStyle(i,a,f):("string"==typeof u&&u.endsWith("!important")&&(u=u.slice(0,-10),f|=vc.Important),e.setStyle(i,a,u,f))}}(a,g,v_(Ao(),i),u,f))}function RS(e,o,i,a,u,f){const g=null===o;let x;for(;u>0;){const w=e[u],T=Array.isArray(w),A=T?w[1]:w,k=null===A;let B=i[u+1];B===on&&(B=k?ri:void 0);let G=k?U_(B,a):A===a?B:void 0;if(T&&!zc(G)&&(G=U_(w,a)),zc(G)&&(x=G,g))return x;const K=e[u+1];u=g?Fc(K):Lc(K)}if(null!==o){let w=f?o.residualClasses:o.residualStyles;null!=w&&(x=U_(w,a))}return x}function zc(e){return void 0!==e}function Xb(e,o){return 0!=(e.flags&(o?8:16))}function rl(e,o=""){const i=Nt(),a=qn(),u=e+On,f=a.firstCreatePass?Xa(a,u,1,o,null):a.data[u],g=PS(a,i,f,o,e);i[u]=g,Va()&&tn(a,i,g,f),da(f,!1)}let PS=(e,o,i,a,u)=>(Pl(!0),function Gp(e,o){return e.createText(o)}(o[nn],a));function Gm(e){return qm("",e,""),Gm}function qm(e,o,i){const a=Nt(),u=hf(a,e,o,i);return u!==on&&function $l(e,o,i){const a=v_(o,e);!function bx(e,o,i){e.setValue(o,i)}(e[nn],a,i)}(a,Ao(),u),qm}function NS(e,o,i){!function il(e,o,i,a){const u=qn(),f=xs(2);u.firstUpdatePass&&Mf(u,null,f,a);const g=Nt();if(i!==on&&ko(g,f,i)){const x=u.data[Ao()];if(Xb(x,a)&&!qb(u,f)){let w=a?x.classesWithoutHost:x.stylesWithoutHost;null!==w&&(i=op(w,i||"")),Wy(u,x,g,i,a)}else!function H2(e,o,i,a,u,f,g,x){u===on&&(u=ri);let w=0,T=0,A=0<u.length?u[0]:null,k=0<f.length?f[0]:null;for(;null!==A||null!==k;){const B=w<u.length?u[w+1]:void 0,G=T<f.length?f[T+1]:void 0;let et,K=null;A===k?(w+=2,T+=2,B!==G&&(K=k,et=G)):null===k||null!==A&&A<k?(w+=2,K=A):(T+=2,K=k,et=G),null!==K&&AS(e,o,i,a,K,et,g,x),A=w<u.length?u[w]:null,k=T<f.length?f[T]:null}}(u,x,g,g[nn],g[f+1],g[f+1]=function DS(e,o,i){if(null==i||""===i)return ri;const a=[],u=to(i);if(Array.isArray(u))for(let f=0;f<u.length;f++)e(a,u[f],!0);else if("object"==typeof u)for(const f in u)u.hasOwnProperty(f)&&e(a,f,u[f]);else"string"==typeof u&&o(a,u);return a}(e,o,i),a,f)}}(Sr,el,hf(Nt(),e,o,i),!0)}function Zm(e,o,i){const a=Nt();return ko(a,wh(),o)&&Ts(qn(),Ci(),a,e,o,a[nn],i,!0),Zm}const Rd="en-US";let nv=Rd;function dv(e,o,i,a,u){if(e=Qe(e),Array.isArray(e))for(let f=0;f<e.length;f++)dv(e[f],o,i,a,u);else{const f=qn(),g=Nt(),x=ho();let w=_u(e)?e:Qe(e.provide);const T=Gx(e),A=1048575&x.providerIndexes,k=x.directiveStart,B=x.providerIndexes>>20;if(_u(e)||!e.multi){const G=new ld(T,u,xt),K=fv(w,o,u?A:A+B,k);-1===K?(z_(Fp(x,g),f,w),Fd(f,e,o.length),o.push(w),x.directiveStart++,x.directiveEnd++,u&&(x.providerIndexes+=1048576),i.push(G),g.push(G)):(i[K]=G,g[K]=G)}else{const G=fv(w,o,A+B,k),K=fv(w,o,A,A+B),ut=K>=0&&i[K];if(u&&!ut||!u&&!(G>=0&&i[G])){z_(Fp(x,g),f,w);const _t=function TR(e,o,i,a,u){const f=new ld(e,i,xt);return f.multi=[],f.index=o,f.componentProviders=0,hv(f,u,a&&!i),f}(u?SR:w1,i.length,u,a,T);!u&&ut&&(i[K].providerFactory=_t),Fd(f,e,o.length,0),o.push(w),x.directiveStart++,x.directiveEnd++,u&&(x.providerIndexes+=1048576),i.push(_t),g.push(_t)}else Fd(f,e,G>-1?G:K,hv(i[u?K:G],T,!u&&a));!u&&a&&ut&&i[K].componentProviders++}}}function Fd(e,o,i,a){const u=_u(o),f=function eM(e){return!!e.useClass}(o);if(u||f){const w=(f?Qe(o.useClass):o).prototype.ngOnDestroy;if(w){const T=e.destroyHooks||(e.destroyHooks=[]);if(!u&&o.multi){const A=T.indexOf(i);-1===A?T.push(i,[a,w]):T[A+1].push(a,w)}else T.push(i,w)}}}function hv(e,o,i){return i&&e.componentProviders++,e.multi.push(o)-1}function fv(e,o,i,a){for(let u=i;u<a;u++)if(o[u]===e)return u;return-1}function w1(e,o,i,a){return E1(this.multi,[])}function SR(e,o,i,a){const u=this.multi;let f;if(this.providerFactory){const g=this.providerFactory.componentProviders,x=yc(i,i[he],this.providerFactory.index,a);f=x.slice(0,g),E1(u,f);for(let w=g;w<x.length;w++)f.push(x[w])}else f=[],E1(u,f);return f}function E1(e,o){for(let i=0;i<e.length;i++)o.push((0,e[i])());return o}function Ji(e,o=[]){return i=>{i.providersResolver=(a,u)=>function b1(e,o,i){const a=qn();if(a.firstCreatePass){const u=Na(e);dv(i,a.data,a.blueprint,u,!0),dv(o,a.data,a.blueprint,u,!1)}}(a,u?u(e):e,o)}}class Ou{}class C1{}class pv extends Ou{constructor(o,i,a){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new $M(this);const u=$o(o);this._bootstrapComponents=Dc(u.bootstrap),this._r3Injector=jl(o,i,[{provide:Ou,useValue:this},{provide:dm,useValue:this.componentFactoryResolver},...a],Rr(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class mv extends C1{constructor(o){super(),this.moduleType=o}create(o){return new pv(this.moduleType,o,[])}}class M1 extends Ou{constructor(o){super(),this.componentFactoryResolver=new $M(this),this.instance=null;const i=new Wh([...o.providers,{provide:Ou,useValue:this},{provide:dm,useValue:this.componentFactoryResolver}],o.parent||im(),o.debugName,new Set(["environment"]));this.injector=i,o.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function Af(e,o,i=null){return new M1({providers:e,parent:o,debugName:i,runEnvironmentInitializers:!0}).injector}let gv=(()=>{class e{constructor(i){this._injector=i,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){const a=Vx(0,i.type),u=a.length>0?Af([a],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,u)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(const i of this.cachedInjectors.values())null!==i&&i.destroy()}finally{this.cachedInjectors.clear()}}static#t=this.\u0275prov=ie({token:e,providedIn:"environment",factory:()=>new e(bt(Ss))})}return e})();function S1(e){e.getStandaloneInjector=o=>o.get(gv).getOrCreateStandaloneInjector(e)}function $R(){return this._results[Symbol.iterator]()}class Of{static#t=Symbol.iterator;get changes(){return this._changes||(this._changes=new oi)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=Of.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=$R)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,i){return this._results.reduce(o,i)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,i){const a=this;a.dirty=!1;const u=function fa(e){return e.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function yA(e,o,i){if(e.length!==o.length)return!1;for(let a=0;a<e.length;a++){let u=e[a],f=o[a];if(i&&(u=i(u),f=i(f)),f!==u)return!1}return!0}(a._results,u,i))&&(a._results=u,a.length=u.length,a.last=u[this.length-1],a.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function GR(e,o,i,a=!0){const u=o[he];if(function PA(e,o,i,a){const u=Zr+a,f=i.length;a>0&&(i[u-1][ca]=o),a<f-Zr?(o[ca]=i[u],j_(i,Zr+a,o)):(i.push(o),o[ca]=null),o[Ai]=i;const g=o[fc];null!==g&&i!==g&&function OA(e,o){const i=e[su];o[tr]!==o[Ai][Ai][tr]&&(e[wE]=!0),null===i?e[su]=[o]:i.push(o)}(g,o);const x=o[Vs];null!==x&&x.insertView(e),o[dn]|=128}(u,o,e,i),a){const f=Bh(i,e),g=o[nn],x=yd(g,e[js]);null!==x&&function AA(e,o,i,a,u,f){a[_r]=u,a[Ho]=o,Uh(e,a,i,1,u,f)}(u,e[Ho],g,o,x,f)}}let ql=(()=>{class e{static#t=this.__NG_ELEMENT_ID__=PT}return e})();const As=ql,O1=class extends As{constructor(o,i,a){super(),this._declarationLView=o,this._declarationTContainer=i,this.elementRef=a}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(o,i){return this.createEmbeddedViewImpl(o,i)}createEmbeddedViewImpl(o,i,a){const u=function RT(e,o,i,a){const u=o.tView,x=wu(e,u,i,4096&e[dn]?4096:16,null,o,null,null,null,a?.injector??null,a?.hydrationInfo??null);x[fc]=e[o.index];const T=e[Vs];return null!==T&&(x[Vs]=T.createEmbeddedView(u)),Hl(u,x,i),x}(this._declarationLView,this._declarationTContainer,o,{injector:i,hydrationInfo:a});return new Sm(u)}};function PT(){return ug(ho(),Nt())}function ug(e,o){return 4&e.type?new O1(o,e,Jh(e,o)):null}let ls=(()=>{class e{static#t=this.__NG_ELEMENT_ID__=kf}return e})();function kf(){return zT(ho(),Nt())}const ZR=ls,LT=class extends ZR{constructor(o,i,a){super(),this._lContainer=o,this._hostTNode=i,this._hostLView=a}get element(){return Jh(this._hostTNode,this._hostLView)}get injector(){return new me(this._hostTNode,this._hostLView)}get parentInjector(){const o=ud(this._hostTNode,this._hostLView);if(L_(o)){const i=Sh(o,this._hostLView),a=Mh(o);return new me(i[he].data[a+8],i)}return new me(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const i=NT(this._lContainer);return null!==i&&i[o]||null}get length(){return this._lContainer.length-Zr}createEmbeddedView(o,i,a){let u,f;"number"==typeof a?u=a:null!=a&&(u=a.index,f=a.injector);const x=o.createEmbeddedViewImpl(i||{},f,null);return this.insertImpl(x,u,false),x}createComponent(o,i,a,u,f){const g=o&&!function Rh(e){return"function"==typeof e}(o);let x;if(g)x=i;else{const et=i||{};x=et.index,a=et.injector,u=et.projectableNodes,f=et.environmentInjector||et.ngModuleRef}const w=g?o:new cf(Kn(o)),T=a||this.parentInjector;if(!f&&null==w.ngModule){const ut=(g?T:this.parentInjector).get(Ss,null);ut&&(f=ut)}Kn(w.componentType??{});const G=w.create(T,u,null,f);return this.insertImpl(G.hostView,x,false),G}insert(o,i){return this.insertImpl(o,i,!1)}insertImpl(o,i,a){const u=o._lView;if(function cA(e){return is(e[Ai])}(u)){const w=this.indexOf(o);if(-1!==w)this.detach(w);else{const T=u[Ai],A=new LT(T,T[Ho],T[Ai]);A.detach(A.indexOf(o))}}const g=this._adjustIndex(i),x=this._lContainer;return GR(x,u,g,!a),o.attachToViewContainerRef(),j_(N1(x),g,o),o}move(o,i){return this.insert(o,i)}indexOf(o){const i=NT(this._lContainer);return null!==i?i.indexOf(o):-1}remove(o){const i=this._adjustIndex(o,-1),a=X_(this._lContainer,i);a&&(Ua(N1(this._lContainer),i),rt(a[he],a))}detach(o){const i=this._adjustIndex(o,-1),a=X_(this._lContainer,i);return a&&null!=Ua(N1(this._lContainer),i)?new Sm(a):null}_adjustIndex(o,i=0){return o??this.length+i}};function NT(e){return e[8]}function N1(e){return e[8]||(e[8]=[])}function zT(e,o){let i;const a=o[e.index];return is(a)?i=a:(i=sf(a,o,null,e),o[e.index]=i,wm(o,i)),BT(i,o,e,a),new LT(i,e,o)}let BT=function VT(e,o,i,a){if(e[js])return;let u;u=8&i.type?Yi(a):function XR(e,o){const i=e[nn],a=i.createComment(""),u=ys(o,e);return q(i,yd(i,u),a,function FC(e,o){return e.nextSibling(o)}(i,u),!1),a}(o,i),e[js]=u};class z1{constructor(o){this.queryList=o,this.matches=null}clone(){return new z1(this.queryList)}setDirty(){this.queryList.setDirty()}}class vv{constructor(o=[]){this.queries=o}createEmbeddedView(o){const i=o.queries;if(null!==i){const a=null!==o.contentQueries?o.contentQueries[0]:i.length,u=[];for(let f=0;f<a;f++){const g=i.getByIndex(f);u.push(this.queries[g.indexInDeclarationView].clone())}return new vv(u)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let i=0;i<this.queries.length;i++)null!==sl(o,i).matches&&this.queries[i].setDirty()}}class B1{constructor(o,i,a=null){this.predicate=o,this.flags=i,this.read=a}}class Ff{constructor(o=[]){this.queries=o}elementStart(o,i){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(o,i)}elementEnd(o){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(o)}embeddedTView(o){let i=null;for(let a=0;a<this.length;a++){const u=null!==i?i.length:0,f=this.getByIndex(a).embeddedTView(o,u);f&&(f.indexInDeclarationView=a,null!==i?i.push(f):i=[f])}return null!==i?new Ff(i):null}template(o,i){for(let a=0;a<this.queries.length;a++)this.queries[a].template(o,i)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class V1{constructor(o,i=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(o,i){this.isApplyingToNode(i)&&this.matchTNode(o,i)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,i){this.elementStart(o,i)}embeddedTView(o,i){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,i),new V1(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let a=o.parent;for(;null!==a&&8&a.type&&a.index!==i;)a=a.parent;return i===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(o,i){const a=this.metadata.predicate;if(Array.isArray(a))for(let u=0;u<a.length;u++){const f=a[u];this.matchTNodeWithReadOption(o,i,JR(i,f)),this.matchTNodeWithReadOption(o,i,Np(i,o,f,!1,!1))}else a===ql?4&i.type&&this.matchTNodeWithReadOption(o,i,-1):this.matchTNodeWithReadOption(o,i,Np(i,o,a,!1,!1))}matchTNodeWithReadOption(o,i,a){if(null!==a){const u=this.metadata.read;if(null!==u)if(u===Gi||u===ls||u===ql&&4&i.type)this.addMatch(i.index,-2);else{const f=Np(i,o,u,!1,!1);null!==f&&this.addMatch(i.index,f)}else this.addMatch(i.index,a)}}addMatch(o,i){null===this.matches?this.matches=[o,i]:this.matches.push(o,i)}}function JR(e,o){const i=e.localNames;if(null!==i)for(let a=0;a<i.length;a+=2)if(i[a]===o)return i[a+1];return null}function jT(e,o,i,a){return-1===i?function ku(e,o){return 11&e.type?Jh(e,o):4&e.type?ug(e,o):null}(o,e):-2===i?function Lf(e,o,i){return i===Gi?Jh(o,e):i===ql?ug(o,e):i===ls?zT(o,e):void 0}(e,o,a):yc(e,e[he],i,o)}function UT(e,o,i,a){const u=o[Vs].queries[a];if(null===u.matches){const f=e.data,g=i.matches,x=[];for(let w=0;w<g.length;w+=2){const T=g[w];x.push(T<0?null:jT(o,f[T],g[w+1],i.metadata.read))}u.matches=x}return u.matches}function j1(e,o,i,a){const u=e.queries.getByIndex(i),f=u.matches;if(null!==f){const g=UT(e,o,u,i);for(let x=0;x<f.length;x+=2){const w=f[x];if(w>0)a.push(g[x/2]);else{const T=f[x+1],A=o[-w];for(let k=Zr;k<A.length;k++){const B=A[k];B[fc]===B[Ai]&&j1(B[he],B,T,a)}if(null!==A[su]){const k=A[su];for(let B=0;B<k.length;B++){const G=k[B];j1(G[he],G,T,a)}}}}}return a}function xr(e){const o=Nt(),i=qn(),a=M_();S_(a+1);const u=sl(i,a);if(e.dirty&&function za(e){return 4==(4&e[dn])}(o)===(2==(2&u.metadata.flags))){if(null===u.matches)e.reset([]);else{const f=u.crossesNgTemplate?j1(i,o,a,[]):UT(i,o,u,a);e.reset(f,Qh),e.notifyOnChanges()}return!0}return!1}function Ea(e,o,i){const a=qn();a.firstCreatePass&&(bv(a,new B1(e,o,i),-1),2==(2&o)&&(a.staticViewQueries=!0)),U1(a,Nt(),o)}function Ks(e,o,i,a){const u=qn();if(u.firstCreatePass){const f=ho();bv(u,new B1(o,i,a),f.index),function QR(e,o){const i=e.contentQueries||(e.contentQueries=[]);o!==(i.length?i[i.length-1]:-1)&&i.push(e.queries.length-1,o)}(u,e),2==(2&i)&&(u.staticContentQueries=!0)}U1(u,Nt(),i)}function rr(){return function xv(e,o){return e[Vs].queries[o].queryList}(Nt(),M_())}function U1(e,o,i){const a=new Of(4==(4&i));(function AM(e,o,i,a){const u=Ry(o);u.push(i),e.firstCreatePass&&LM(e).push(a,u.length-1)})(e,o,a,a.destroy),null===o[Vs]&&(o[Vs]=new vv),o[Vs].queries.push(new z1(a))}function bv(e,o,i){null===e.queries&&(e.queries=new Ff),e.queries.track(new V1(o,i))}function sl(e,o){return e.queries.getByIndex(o)}function $T(e,o){return ug(e,o)}const ew=new Gt("Application Initializer");let nw=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,a)=>{this.resolve=i,this.reject=a}),this.appInits=ee(ew,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const i=[];for(const u of this.appInits){const f=u();if(wf(f))i.push(f);else if(Bb(f)){const g=new Promise((x,w)=>{f.subscribe({complete:x,error:w})});i.push(g)}}const a=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{a()}).catch(u=>{this.reject(u)}),0===i.length&&a(),this.initialized=!0}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),iD=(()=>{class e{log(i){console.log(i)}warn(i){console.warn(i)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const Wl=new Gt("LocaleId",{providedIn:"root",factory:()=>ee(Wl,Ye.Optional|Ye.SkipSelf)||function fP(){return typeof $localize<"u"&&$localize.locale||Rd}()});let Ld=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new $r(!1)}add(){this.hasPendingTasks.next(!0);const i=this.taskId++;return this.pendingTasks.add(i),i}remove(i){this.pendingTasks.delete(i),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class gP{constructor(o,i){this.ngModuleFactory=o,this.componentFactories=i}}let rw=(()=>{class e{compileModuleSync(i){return new mv(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){const a=this.compileModuleSync(i),f=Dc($o(i).declarations).reduce((g,x)=>{const w=Kn(x);return w&&g.push(new cf(w)),g},[]);return new gP(a,f)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const v=new Gt(""),b=new Gt("");let M,E=(()=>{class e{constructor(i,a,u){this._ngZone=i,this.registry=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,M||(function S(e){M=e}(u),u.addToWindow(a)),this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Je.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(i)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,a,u){let f=-1;a&&a>0&&(f=setTimeout(()=>{this._callbacks=this._callbacks.filter(g=>g.timeoutId!==f),i(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:i,timeoutId:f,updateCb:u})}whenStable(i,a,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,a,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(i){this.registry.registerApplication(i,this)}unregisterApplication(i){this.registry.unregisterApplication(i)}findProviders(i,a,u){return[]}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Je),bt(C),bt(b))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})(),C=(()=>{class e{constructor(){this._applications=new Map}registerApplication(i,a){this._applications.set(i,a)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,a=!0){return M?.findTestabilityInTree(this,i,a)??null}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),D=null;const R=new Gt("AllowMultipleToken"),P=new Gt("PlatformDestroyListeners"),I=new Gt("appBootstrapListener");class z{constructor(o,i){this.name=o,this.token=i}}function Z(e,o,i=[]){const a=`Platform: ${o}`,u=new Gt(a);return(f=[])=>{let g=Y();if(!g||g.injector.get(R,!1)){const x=[...i,...f,{provide:u,useValue:!0}];e?e(x):function U(e){if(D&&!D.get(R,!1))throw new at(400,!1);(function L(){!function OE(e){PE=e}(()=>{throw new at(600,!1)})})(),D=e;const o=e.get(ot);(function H(e){e.get(iM,null)?.forEach(i=>i())})(e)}(function it(e=[],o){return Or.create({name:o,providers:[{provide:$x,useValue:"platform"},{provide:P,useValue:new Set([()=>D=null])},...e]})}(x,a))}return function tt(e){const o=Y();if(!o)throw new at(401,!1);return o}()}}function Y(){return D?.get(ot)??null}let ot=(()=>{class e{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,a){const u=function ht(e="zone.js",o){return"noop"===e?new pM:"zone.js"===e?new Je(o):e}(a?.ngZone,function lt(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:a?.ngZoneEventCoalescing,runCoalescing:a?.ngZoneRunCoalescing}));return u.run(()=>{const f=function gT(e,o,i){return new pv(e,o,i)}(i.moduleType,this.injector,function ye(e){return[{provide:Je,useFactory:e},{provide:Qp,multi:!0,useFactory:()=>{const o=ee($t,{optional:!0});return()=>o.initialize()}},{provide:Vt,useFactory:jt},{provide:hb,useFactory:fb}]}(()=>u)),g=f.injector.get(Wa,null);return u.runOutsideAngular(()=>{const x=u.onError.subscribe({next:w=>{g.handleError(w)}});f.onDestroy(()=>{ft(this._modules,f),x.unsubscribe()})}),function mt(e,o,i){try{const a=i();return wf(a)?a.catch(u=>{throw o.runOutsideAngular(()=>e.handleError(u)),u}):a}catch(a){throw o.runOutsideAngular(()=>e.handleError(a)),a}}(g,u,()=>{const x=f.injector.get(nw);return x.runInitializers(),x.donePromise.then(()=>(function Pd(e){Bo(e,"Expected localeId to be defined"),"string"==typeof e&&(nv=e.toLowerCase().replace(/_/g,"-"))}(f.injector.get(Wl,Rd)||Rd),this._moduleDoBootstrap(f),f))})})}bootstrapModule(i,a=[]){const u=yt({},a);return function O(e,o,i){const a=new mv(i);return Promise.resolve(a)}(0,0,i).then(f=>this.bootstrapModuleFactory(f,u))}_moduleDoBootstrap(i){const a=i.injector.get(ct);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(u=>a.bootstrap(u));else{if(!i.instance.ngDoBootstrap)throw new at(-403,!1);i.instance.ngDoBootstrap(a)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new at(404,!1);this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const i=this._injector.get(P,null);i&&(i.forEach(a=>a()),i.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Or))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function yt(e,o){return Array.isArray(o)?o.reduce(yt,e):{...e,...o}}let ct=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ee(Vt),this.zoneIsStable=ee(hb),this.componentTypes=[],this.components=[],this.isStable=ee(Ld).hasPendingTasks.pipe(Hr(i=>i?kt(!1):this.zoneIsStable),Xu(),zn()),this._injector=ee(Ss)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(i,a){const u=i instanceof aM;if(!this._injector.get(nw).done)throw!u&&function ru(e){const o=Kn(e)||Wr(e)||Uo(e);return null!==o&&o.standalone}(i),new at(405,!1);let g;g=u?i:this._injector.get(dm).resolveComponentFactory(i),this.componentTypes.push(g.componentType);const x=function N(e){return e.isBoundToModule}(g)?void 0:this._injector.get(Ou),T=g.create(Or.NULL,[],a||g.selector,x),A=T.location.nativeElement,k=T.injector.get(v,null);return k?.registerApplication(A),T.onDestroy(()=>{this.detachView(T.hostView),ft(this.components,T),k?.unregisterApplication(A)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new at(101,!1);try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1}}attachView(i){const a=i;this._views.push(a),a.attachToAppRef(this)}detachView(i){const a=i;ft(this._views,a),a.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i);const a=this._injector.get(I,[]);a.push(...this._bootstrapListeners),a.forEach(u=>u(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>ft(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new at(406,!1);const i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function ft(e,o){const i=e.indexOf(o);i>-1&&e.splice(i,1)}const Vt=new Gt("",{providedIn:"root",factory:()=>ee(Wa).handleError.bind(void 0)});function jt(){const e=ee(Je),o=ee(Wa);return i=>e.runOutsideAngular(()=>o.handleError(i))}let $t=(()=>{class e{constructor(){this.zone=ee(Je),this.applicationRef=ee(ct)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let Le=(()=>{class e{static#t=this.__NG_ELEMENT_ID__=an}return e})();function an(e){return function Be(e,o,i){if(au(e)&&!i){const a=Hs(e.index,o);return new Sm(a,a)}return 47&e.type?new Sm(o[tr],o):null}(ho(),Nt(),16==(16&e))}class lw{constructor(){}supports(o){return Ja(o)}create(o){return new uw(o)}}const cw=(e,o)=>o;class uw{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||cw}forEachItem(o){let i;for(i=this._itHead;null!==i;i=i._next)o(i)}forEachOperation(o){let i=this._itHead,a=this._removalsHead,u=0,f=null;for(;i||a;){const g=!a||i&&i.currentIndex<Ov(a,u,f)?i:a,x=Ov(g,u,f),w=g.currentIndex;if(g===a)u--,a=a._nextRemoved;else if(i=i._next,null==g.previousIndex)u++;else{f||(f=[]);const T=x-u,A=w-u;if(T!=A){for(let B=0;B<T;B++){const G=B<f.length?f[B]:f[B]=0,K=G+B;A<=K&&K<T&&(f[B]=G+1)}f[g.previousIndex]=A-T}}x!==w&&o(g,x,w)}}forEachPreviousItem(o){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)o(i)}forEachAddedItem(o){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)o(i)}forEachMovedItem(o){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)o(i)}forEachRemovedItem(o){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)o(i)}forEachIdentityChange(o){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)o(i)}diff(o){if(null==o&&(o=[]),!Ja(o))throw new at(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let u,f,g,i=this._itHead,a=!1;if(Array.isArray(o)){this.length=o.length;for(let x=0;x<this.length;x++)f=o[x],g=this._trackByFn(x,f),null!==i&&Object.is(i.trackById,g)?(a&&(i=this._verifyReinsertion(i,f,g,x)),Object.is(i.item,f)||this._addIdentityChange(i,f)):(i=this._mismatch(i,f,g,x),a=!0),i=i._next}else u=0,function GM(e,o){if(Array.isArray(e))for(let i=0;i<e.length;i++)o(e[i]);else{const i=e[Symbol.iterator]();let a;for(;!(a=i.next()).done;)o(a.value)}}(o,x=>{g=this._trackByFn(u,x),null!==i&&Object.is(i.trackById,g)?(a&&(i=this._verifyReinsertion(i,x,g,u)),Object.is(i.item,x)||this._addIdentityChange(i,x)):(i=this._mismatch(i,x,g,u),a=!0),i=i._next,u++}),this.length=u;return this._truncate(i),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,i,a,u){let f;return null===o?f=this._itTail:(f=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(o.item,i)||this._addIdentityChange(o,i),this._reinsertAfter(o,f,u)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(a,u))?(Object.is(o.item,i)||this._addIdentityChange(o,i),this._moveAfter(o,f,u)):o=this._addAfter(new Xl(i,a),f,u),o}_verifyReinsertion(o,i,a,u){let f=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==f?o=this._reinsertAfter(f,o._prev,u):o.currentIndex!=u&&(o.currentIndex=u,this._addToMoves(o,u)),o}_truncate(o){for(;null!==o;){const i=o._next;this._addToRemovals(this._unlink(o)),o=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,i,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const u=o._prevRemoved,f=o._nextRemoved;return null===u?this._removalsHead=f:u._nextRemoved=f,null===f?this._removalsTail=u:f._prevRemoved=u,this._insertAfter(o,i,a),this._addToMoves(o,a),o}_moveAfter(o,i,a){return this._unlink(o),this._insertAfter(o,i,a),this._addToMoves(o,a),o}_addAfter(o,i,a){return this._insertAfter(o,i,a),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,i,a){const u=null===i?this._itHead:i._next;return o._next=u,o._prev=i,null===u?this._itTail=o:u._prev=o,null===i?this._itHead=o:i._next=o,null===this._linkedRecords&&(this._linkedRecords=new Fu),this._linkedRecords.put(o),o.currentIndex=a,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const i=o._prev,a=o._next;return null===i?this._itHead=a:i._next=a,null===a?this._itTail=i:a._prev=i,o}_addToMoves(o,i){return o.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Fu),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,i){return o.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Xl{constructor(o,i){this.item=o,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class sD{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,i){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===i||i<=a.currentIndex)&&Object.is(a.trackById,o))return a;return null}remove(o){const i=o._prevDup,a=o._nextDup;return null===i?this._head=a:i._nextDup=a,null===a?this._tail=i:a._prevDup=i,null===this._head}}class Fu{constructor(){this.map=new Map}put(o){const i=o.trackById;let a=this.map.get(i);a||(a=new sD,this.map.set(i,a)),a.add(o)}get(o,i){const u=this.map.get(o);return u?u.get(o,i):null}remove(o){const i=o.trackById;return this.map.get(i).remove(o)&&this.map.delete(i),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Ov(e,o,i){const a=e.previousIndex;if(null===a)return a;let u=0;return i&&a<i.length&&(u=i[a]),a+o+u}class kv{constructor(){}supports(o){return o instanceof Map||Am(o)}create(){return new dw}}class dw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let i;for(i=this._mapHead;null!==i;i=i._next)o(i)}forEachPreviousItem(o){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)o(i)}forEachChangedItem(o){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)o(i)}forEachAddedItem(o){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)o(i)}forEachRemovedItem(o){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)o(i)}diff(o){if(o){if(!(o instanceof Map||Am(o)))throw new at(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(o,(a,u)=>{if(i&&i.key===u)this._maybeAddToChanges(i,a),this._appendAfter=i,i=i._next;else{const f=this._getOrCreateRecordForKey(u,a);i=this._insertBeforeOrAppend(i,f)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let a=i;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,i){if(o){const a=o._prev;return i._next=o,i._prev=a,o._prev=i,a&&(a._next=i),o===this._mapHead&&(this._mapHead=i),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(o,i){if(this._records.has(o)){const u=this._records.get(o);this._maybeAddToChanges(u,i);const f=u._prev,g=u._next;return f&&(f._next=g),g&&(g._prev=f),u._next=null,u._prev=null,u}const a=new Lu(o);return this._records.set(o,a),a.currentValue=i,this._addToAdditions(a),a}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,i){Object.is(i,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=i,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,i){o instanceof Map?o.forEach(i):Object.keys(o).forEach(a=>i(o[a],a))}}class Lu{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Fv(){return new Lv([new lw])}let Lv=(()=>{class e{static#t=this.\u0275prov=ie({token:e,providedIn:"root",factory:Fv});constructor(i){this.factories=i}static create(i,a){if(null!=a){const u=a.factories.slice();i=i.concat(u)}return new e(i)}static extend(i){return{provide:e,useFactory:a=>e.create(i,a||Fv()),deps:[[e,new Oh,new pu]]}}find(i){const a=this.factories.find(u=>u.supports(i));if(null!=a)return a;throw new at(901,!1)}}return e})();function us(){return new Yl([new kv])}let Yl=(()=>{class e{static#t=this.\u0275prov=ie({token:e,providedIn:"root",factory:us});constructor(i){this.factories=i}static create(i,a){if(a){const u=a.factories.slice();i=i.concat(u)}return new e(i)}static extend(i){return{provide:e,useFactory:a=>e.create(i,a||us()),deps:[[e,new Oh,new pu]]}}find(i){const a=this.factories.find(u=>u.supports(i));if(a)return a;throw new at(901,!1)}}return e})();const t5=Z(null,"core",[]);let e5=(()=>{class e{constructor(i){}static#t=this.\u0275fac=function(a){return new(a||e)(bt(ct))};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({})}return e})();let PP=null;function jf(){return PP}class m5{}const Qn=new Gt("DocumentToken");let OP=(()=>{class e{historyGo(i){throw new Error("Not implemented")}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:function(){return ee(_5)},providedIn:"platform"})}return e})();const g5=new Gt("Location Initialized");let _5=(()=>{class e extends OP{constructor(){super(),this._doc=ee(Qn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return jf().getBaseHref(this._doc)}onPopState(i){const a=jf().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",i,!1),()=>a.removeEventListener("popstate",i)}onHashChange(i){const a=jf().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",i,!1),()=>a.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,a,u){this._history.pushState(i,a,u)}replaceState(i,a,u){this._history.replaceState(i,a,u)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function kP(e,o){if(0==e.length)return o;if(0==o.length)return e;let i=0;return e.endsWith("/")&&i++,o.startsWith("/")&&i++,2==i?e+o.substring(1):1==i?e+o:e+"/"+o}function hL(e){const o=e.match(/#|\?|$/),i=o&&o.index||e.length;return e.slice(0,i-("/"===e[i-1]?1:0))+e.slice(i)}function Vd(e){return e&&"?"!==e[0]?"?"+e:e}let _g=(()=>{class e{historyGo(i){throw new Error("Not implemented")}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:function(){return ee(pL)},providedIn:"root"})}return e})();const fL=new Gt("appBaseHref");let pL=(()=>{class e extends _g{constructor(i,a){super(),this._platformLocation=i,this._removeListenerFns=[],this._baseHref=a??this._platformLocation.getBaseHrefFromDOM()??ee(Qn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return kP(this._baseHref,i)}path(i=!1){const a=this._platformLocation.pathname+Vd(this._platformLocation.search),u=this._platformLocation.hash;return u&&i?`${a}${u}`:a}pushState(i,a,u,f){const g=this.prepareExternalUrl(u+Vd(f));this._platformLocation.pushState(i,a,g)}replaceState(i,a,u,f){const g=this.prepareExternalUrl(u+Vd(f));this._platformLocation.replaceState(i,a,g)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(OP),bt(fL,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),y5=(()=>{class e extends _g{constructor(i,a){super(),this._platformLocation=i,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(i){const a=kP(this._baseHref,i);return a.length>0?"#"+a:a}pushState(i,a,u,f){let g=this.prepareExternalUrl(u+Vd(f));0==g.length&&(g=this._platformLocation.pathname),this._platformLocation.pushState(i,a,g)}replaceState(i,a,u,f){let g=this.prepareExternalUrl(u+Vd(f));0==g.length&&(g=this._platformLocation.pathname),this._platformLocation.replaceState(i,a,g)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(OP),bt(fL,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})(),cD=(()=>{class e{constructor(i){this._subject=new oi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=i;const a=this._locationStrategy.getBaseHref();this._basePath=function b5(e){if(new RegExp("^(https?:)?//").test(e)){const[,i]=e.split(/\/\/[^\/]+/);return i}return e}(hL(mL(a))),this._locationStrategy.onPopState(u=>{this._subject.emit({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,a=""){return this.path()==this.normalize(i+Vd(a))}normalize(i){return e.stripTrailingSlash(function x5(e,o){if(!e||!o.startsWith(e))return o;const i=o.substring(e.length);return""===i||["/",";","?","#"].includes(i[0])?i:o}(this._basePath,mL(i)))}prepareExternalUrl(i){return i&&"/"!==i[0]&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,a="",u=null){this._locationStrategy.pushState(u,"",i,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Vd(a)),u)}replaceState(i,a="",u=null){this._locationStrategy.replaceState(u,"",i,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Vd(a)),u)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)})),()=>{const a=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(a,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",a){this._urlChangeListeners.forEach(u=>u(i,a))}subscribe(i,a,u){return this._subject.subscribe({next:i,error:a,complete:u})}static#t=this.normalizeQueryParams=Vd;static#e=this.joinWithSlash=kP;static#n=this.stripTrailingSlash=hL;static#i=this.\u0275fac=function(a){return new(a||e)(bt(_g))};static#r=this.\u0275prov=ie({token:e,factory:function(){return function v5(){return new cD(bt(_g))}()},providedIn:"root"})}return e})();function mL(e){return e.replace(/\/index.html$/,"")}function CL(e,o){o=encodeURIComponent(o);for(const i of e.split(";")){const a=i.indexOf("="),[u,f]=-1==a?[i,""]:[i.slice(0,a),i.slice(a+1)];if(u.trim()===o)return decodeURIComponent(f)}return null}const HP=/\s+/,ML=[];let SL=(()=>{class e{constructor(i,a,u,f){this._iterableDiffers=i,this._keyValueDiffers=a,this._ngEl=u,this._renderer=f,this.initialClasses=ML,this.stateMap=new Map}set klass(i){this.initialClasses=null!=i?i.trim().split(HP):ML}set ngClass(i){this.rawClass="string"==typeof i?i.trim().split(HP):i}ngDoCheck(){for(const a of this.initialClasses)this._updateState(a,!0);const i=this.rawClass;if(Array.isArray(i)||i instanceof Set)for(const a of i)this._updateState(a,!0);else if(null!=i)for(const a of Object.keys(i))this._updateState(a,!!i[a]);this._applyStateDiff()}_updateState(i,a){const u=this.stateMap.get(i);void 0!==u?(u.enabled!==a&&(u.changed=!0,u.enabled=a),u.touched=!0):this.stateMap.set(i,{enabled:a,changed:!0,touched:!0})}_applyStateDiff(){for(const i of this.stateMap){const a=i[0],u=i[1];u.changed?(this._toggleClass(a,u.enabled),u.changed=!1):u.touched||(u.enabled&&this._toggleClass(a,!1),this.stateMap.delete(a)),u.touched=!1}}_toggleClass(i,a){(i=i.trim()).length>0&&i.split(HP).forEach(u=>{a?this._renderer.addClass(this._ngEl.nativeElement,u):this._renderer.removeClass(this._ngEl.nativeElement,u)})}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Lv),xt(Yl),xt(Gi),xt(Tc))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return e})(),GP=(()=>{class e{constructor(i,a){this._viewContainer=i,this._context=new lV,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){IL("ngIfThen",i),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){IL("ngIfElse",i),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(i,a){return!0}static#t=this.\u0275fac=function(a){return new(a||e)(xt(ls),xt(ql))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class lV{constructor(){this.$implicit=null,this.ngIf=null}}function IL(e,o){if(o&&!o.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Rr(o)}'.`)}class qP{constructor(o,i){this._viewContainerRef=o,this._templateRef=i,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(o){o&&!this._created?this.create():!o&&this._created&&this.destroy()}}let pw=(()=>{class e{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(i){this._ngSwitch=i,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(i){this._defaultViews.push(i)}_matchCase(i){const a=i==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||a,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),a}_updateDefaultCases(i){if(this._defaultViews.length>0&&i!==this._defaultUsed){this._defaultUsed=i;for(const a of this._defaultViews)a.enforceState(i)}}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0})}return e})(),WP=(()=>{class e{constructor(i,a,u){this.ngSwitch=u,u._addCase(),this._view=new qP(i,a)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}static#t=this.\u0275fac=function(a){return new(a||e)(xt(ls),xt(ql),xt(pw,9))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0})}return e})(),AL=(()=>{class e{constructor(i,a,u){u._addDefault(new qP(i,a))}static#t=this.\u0275fac=function(a){return new(a||e)(xt(ls),xt(ql),xt(pw,9))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngSwitchDefault",""]],standalone:!0})}return e})(),PL=(()=>{class e{constructor(i){this._viewContainerRef=i,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(i){if(i.ngTemplateOutlet||i.ngTemplateOutletInjector){const a=this._viewContainerRef;if(this._viewRef&&a.remove(a.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:u,ngTemplateOutletContext:f,ngTemplateOutletInjector:g}=this;this._viewRef=a.createEmbeddedView(u,f,g?{injector:g}:void 0)}else this._viewRef=null}else this._viewRef&&i.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}static#t=this.\u0275fac=function(a){return new(a||e)(xt(ls))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[rs]})}return e})(),xD=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({})}return e})();const kL="browser";function FL(e){return"server"===e}let NV=(()=>{class e{static#t=this.\u0275prov=ie({token:e,providedIn:"root",factory:()=>new zV(bt(Qn),window)})}return e})();class zV{constructor(o,i){this.document=o,this.window=i,this.offset=()=>[0,0]}setOffset(o){this.offset=Array.isArray(o)?()=>o:o}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(o){this.supportsScrolling()&&this.window.scrollTo(o[0],o[1])}scrollToAnchor(o){if(!this.supportsScrolling())return;const i=function BV(e,o){const i=e.getElementById(o)||e.getElementsByName(o)[0];if(i)return i;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const a=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let u=a.currentNode;for(;u;){const f=u.shadowRoot;if(f){const g=f.getElementById(o)||f.querySelector(`[name="${o}"]`);if(g)return g}u=a.nextNode()}}return null}(this.document,o);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(o){this.supportsScrolling()&&(this.window.history.scrollRestoration=o)}scrollToElement(o){const i=o.getBoundingClientRect(),a=i.left+this.window.pageXOffset,u=i.top+this.window.pageYOffset,f=this.offset();this.window.scrollTo(a-f[0],u-f[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class LL{}class lj extends m5{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class JP extends lj{static makeCurrent(){!function p5(e){PP||(PP=e)}(new JP)}onAndCancel(o,i,a){return o.addEventListener(i,a),()=>{o.removeEventListener(i,a)}}dispatchEvent(o,i){o.dispatchEvent(i)}remove(o){o.parentNode&&o.parentNode.removeChild(o)}createElement(o,i){return(i=i||this.getDefaultDocument()).createElement(o)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(o){return o.nodeType===Node.ELEMENT_NODE}isShadowRoot(o){return o instanceof DocumentFragment}getGlobalEventTarget(o,i){return"window"===i?window:"document"===i?o:"body"===i?o.body:null}getBaseHref(o){const i=function cj(){return gw=gw||document.querySelector("base"),gw?gw.getAttribute("href"):null}();return null==i?null:function uj(e){ED=ED||document.createElement("a"),ED.setAttribute("href",e);const o=ED.pathname;return"/"===o.charAt(0)?o:`/${o}`}(i)}resetBaseElement(){gw=null}getUserAgent(){return window.navigator.userAgent}getCookie(o){return CL(document.cookie,o)}}let ED,gw=null,hj=(()=>{class e{build(){return new XMLHttpRequest}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();const QP=new Gt("EventManagerPlugins");let jL=(()=>{class e{constructor(i,a){this._zone=a,this._eventNameToPlugin=new Map,i.forEach(u=>{u.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,a,u){return this._findPluginFor(a).addEventListener(i,a,u)}getZone(){return this._zone}_findPluginFor(i){let a=this._eventNameToPlugin.get(i);if(a)return a;if(a=this._plugins.find(f=>f.supports(i)),!a)throw new at(5101,!1);return this._eventNameToPlugin.set(i,a),a}static#t=this.\u0275fac=function(a){return new(a||e)(bt(QP),bt(Je))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();class UL{constructor(o){this._doc=o}}const tO="ng-app-id";let $L=(()=>{class e{constructor(i,a,u,f={}){this.doc=i,this.appId=a,this.nonce=u,this.platformId=f,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=FL(f),this.resetHostNodes()}addStyles(i){for(const a of i)1===this.changeUsageCount(a,1)&&this.onStyleAdded(a)}removeStyles(i){for(const a of i)this.changeUsageCount(a,-1)<=0&&this.onStyleRemoved(a)}ngOnDestroy(){const i=this.styleNodesInDOM;i&&(i.forEach(a=>a.remove()),i.clear());for(const a of this.getAllStyles())this.onStyleRemoved(a);this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(const a of this.getAllStyles())this.addStyleToHost(i,a)}removeHost(i){this.hostNodes.delete(i)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(i){for(const a of this.hostNodes)this.addStyleToHost(a,i)}onStyleRemoved(i){const a=this.styleRef;a.get(i)?.elements?.forEach(u=>u.remove()),a.delete(i)}collectServerRenderedStyles(){const i=this.doc.head?.querySelectorAll(`style[${tO}="${this.appId}"]`);if(i?.length){const a=new Map;return i.forEach(u=>{null!=u.textContent&&a.set(u.textContent,u)}),a}return null}changeUsageCount(i,a){const u=this.styleRef;if(u.has(i)){const f=u.get(i);return f.usage+=a,f.usage}return u.set(i,{usage:a,elements:[]}),a}getStyleElement(i,a){const u=this.styleNodesInDOM,f=u?.get(a);if(f?.parentNode===i)return u.delete(a),f.removeAttribute(tO),f;{const g=this.doc.createElement("style");return this.nonce&&g.setAttribute("nonce",this.nonce),g.textContent=a,this.platformIsServer&&g.setAttribute(tO,this.appId),g}}addStyleToHost(i,a){const u=this.getStyleElement(i,a);i.appendChild(u);const f=this.styleRef,g=f.get(a)?.elements;g?g.push(u):f.set(a,{elements:[u],usage:1})}resetHostNodes(){const i=this.hostNodes;i.clear(),i.add(this.doc.head)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn),bt(rm),bt(Wx,8),bt(qa))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();const eO={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},nO=/%COMP%/g,gj=new Gt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function GL(e,o){return o.map(i=>i.replace(nO,e))}let iO=(()=>{class e{constructor(i,a,u,f,g,x,w,T=null){this.eventManager=i,this.sharedStylesHost=a,this.appId=u,this.removeStylesOnCompDestroy=f,this.doc=g,this.platformId=x,this.ngZone=w,this.nonce=T,this.rendererByCompId=new Map,this.platformIsServer=FL(x),this.defaultRenderer=new rO(i,g,w,this.platformIsServer)}createRenderer(i,a){if(!i||!a)return this.defaultRenderer;this.platformIsServer&&a.encapsulation===Vo.ShadowDom&&(a={...a,encapsulation:Vo.Emulated});const u=this.getOrCreateRenderer(i,a);return u instanceof WL?u.applyToHost(i):u instanceof oO&&u.applyStyles(),u}getOrCreateRenderer(i,a){const u=this.rendererByCompId;let f=u.get(a.id);if(!f){const g=this.doc,x=this.ngZone,w=this.eventManager,T=this.sharedStylesHost,A=this.removeStylesOnCompDestroy,k=this.platformIsServer;switch(a.encapsulation){case Vo.Emulated:f=new WL(w,T,a,this.appId,A,g,x,k);break;case Vo.ShadowDom:return new xj(w,T,i,a,g,x,this.nonce,k);default:f=new oO(w,T,a,A,g,x,k)}u.set(a.id,f)}return f}ngOnDestroy(){this.rendererByCompId.clear()}static#t=this.\u0275fac=function(a){return new(a||e)(bt(jL),bt($L),bt(rm),bt(gj),bt(Qn),bt(qa),bt(Je),bt(Wx))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();class rO{constructor(o,i,a,u){this.eventManager=o,this.doc=i,this.ngZone=a,this.platformIsServer=u,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(o,i){return i?this.doc.createElementNS(eO[i]||i,o):this.doc.createElement(o)}createComment(o){return this.doc.createComment(o)}createText(o){return this.doc.createTextNode(o)}appendChild(o,i){(qL(o)?o.content:o).appendChild(i)}insertBefore(o,i,a){o&&(qL(o)?o.content:o).insertBefore(i,a)}removeChild(o,i){o&&o.removeChild(i)}selectRootElement(o,i){let a="string"==typeof o?this.doc.querySelector(o):o;if(!a)throw new at(-5104,!1);return i||(a.textContent=""),a}parentNode(o){return o.parentNode}nextSibling(o){return o.nextSibling}setAttribute(o,i,a,u){if(u){i=u+":"+i;const f=eO[u];f?o.setAttributeNS(f,i,a):o.setAttribute(i,a)}else o.setAttribute(i,a)}removeAttribute(o,i,a){if(a){const u=eO[a];u?o.removeAttributeNS(u,i):o.removeAttribute(`${a}:${i}`)}else o.removeAttribute(i)}addClass(o,i){o.classList.add(i)}removeClass(o,i){o.classList.remove(i)}setStyle(o,i,a,u){u&(vc.DashCase|vc.Important)?o.style.setProperty(i,a,u&vc.Important?"important":""):o.style[i]=a}removeStyle(o,i,a){a&vc.DashCase?o.style.removeProperty(i):o.style[i]=""}setProperty(o,i,a){o[i]=a}setValue(o,i){o.nodeValue=i}listen(o,i,a){if("string"==typeof o&&!(o=jf().getGlobalEventTarget(this.doc,o)))throw new Error(`Unsupported event target ${o} for event ${i}`);return this.eventManager.addEventListener(o,i,this.decoratePreventDefault(a))}decoratePreventDefault(o){return i=>{if("__ngUnwrap__"===i)return o;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>o(i)):o(i))&&i.preventDefault()}}}function qL(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class xj extends rO{constructor(o,i,a,u,f,g,x,w){super(o,f,g,w),this.sharedStylesHost=i,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const T=GL(u.id,u.styles);for(const A of T){const k=document.createElement("style");x&&k.setAttribute("nonce",x),k.textContent=A,this.shadowRoot.appendChild(k)}}nodeOrShadowRoot(o){return o===this.hostEl?this.shadowRoot:o}appendChild(o,i){return super.appendChild(this.nodeOrShadowRoot(o),i)}insertBefore(o,i,a){return super.insertBefore(this.nodeOrShadowRoot(o),i,a)}removeChild(o,i){return super.removeChild(this.nodeOrShadowRoot(o),i)}parentNode(o){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(o)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class oO extends rO{constructor(o,i,a,u,f,g,x,w){super(o,f,g,x),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=u,this.styles=w?GL(w,a.styles):a.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class WL extends oO{constructor(o,i,a,u,f,g,x,w){const T=u+"-"+a.id;super(o,i,a,f,g,x,w,T),this.contentAttr=function _j(e){return"_ngcontent-%COMP%".replace(nO,e)}(T),this.hostAttr=function yj(e){return"_nghost-%COMP%".replace(nO,e)}(T)}applyToHost(o){this.applyStyles(),this.setAttribute(o,this.hostAttr,"")}createElement(o,i){const a=super.createElement(o,i);return super.setAttribute(a,this.contentAttr,""),a}}let bj=(()=>{class e extends UL{constructor(i){super(i)}supports(i){return!0}addEventListener(i,a,u){return i.addEventListener(a,u,!1),()=>this.removeEventListener(i,a,u)}removeEventListener(i,a,u){return i.removeEventListener(a,u)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();const ZL=["alt","control","meta","shift"],wj={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ej={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Cj=(()=>{class e extends UL{constructor(i){super(i)}supports(i){return null!=e.parseEventName(i)}addEventListener(i,a,u){const f=e.parseEventName(a),g=e.eventCallback(f.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>jf().onAndCancel(i,f.domEventName,g))}static parseEventName(i){const a=i.toLowerCase().split("."),u=a.shift();if(0===a.length||"keydown"!==u&&"keyup"!==u)return null;const f=e._normalizeKey(a.pop());let g="",x=a.indexOf("code");if(x>-1&&(a.splice(x,1),g="code."),ZL.forEach(T=>{const A=a.indexOf(T);A>-1&&(a.splice(A,1),g+=T+".")}),g+=f,0!=a.length||0===f.length)return null;const w={};return w.domEventName=u,w.fullKey=g,w}static matchEventFullKeyCode(i,a){let u=wj[i.key]||i.key,f="";return a.indexOf("code.")>-1&&(u=i.code,f="code."),!(null==u||!u)&&(u=u.toLowerCase()," "===u?u="space":"."===u&&(u="dot"),ZL.forEach(g=>{g!==u&&(0,Ej[g])(i)&&(f+=g+".")}),f+=u,f===a)}static eventCallback(i,a,u){return f=>{e.matchEventFullKeyCode(f,i)&&u.runGuarded(()=>a(f))}}static _normalizeKey(i){return"esc"===i?"escape":i}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();const Dj=Z(t5,"browser",[{provide:qa,useValue:kL},{provide:iM,useValue:function Mj(){JP.makeCurrent()},multi:!0},{provide:Qn,useFactory:function Tj(){return function Ax(e){Ix=e}(document),document},deps:[]}]),Ij=new Gt(""),KL=[{provide:b,useClass:class dj{addToWindow(o){Bi.getAngularTestability=(a,u=!0)=>{const f=o.findTestabilityInTree(a,u);if(null==f)throw new at(5103,!1);return f},Bi.getAllAngularTestabilities=()=>o.getAllTestabilities(),Bi.getAllAngularRootElements=()=>o.getAllRootElements(),Bi.frameworkStabilizers||(Bi.frameworkStabilizers=[]),Bi.frameworkStabilizers.push(a=>{const u=Bi.getAllAngularTestabilities();let f=u.length,g=!1;const x=function(w){g=g||w,f--,0==f&&a(g)};u.forEach(w=>{w.whenStable(x)})})}findTestabilityInTree(o,i,a){return null==i?null:o.getTestability(i)??(a?jf().isShadowRoot(i)?this.findTestabilityInTree(o,i.host,!0):this.findTestabilityInTree(o,i.parentElement,!0):null)}},deps:[]},{provide:v,useClass:E,deps:[Je,C,b]},{provide:E,useClass:E,deps:[Je,C,b]}],JL=[{provide:$x,useValue:"root"},{provide:Wa,useFactory:function Sj(){return new Wa},deps:[]},{provide:QP,useClass:bj,multi:!0,deps:[Qn,Je,qa]},{provide:QP,useClass:Cj,multi:!0,deps:[Qn]},iO,$L,jL,{provide:hm,useExisting:iO},{provide:LL,useClass:hj,deps:[]},[]];let QL=(()=>{class e{constructor(i){}static withServerTransition(i){return{ngModule:e,providers:[{provide:rm,useValue:i.appId}]}}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Ij,12))};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({providers:[...JL,...KL],imports:[xD,e5]})}return e})(),tN=(()=>{class e{constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn))};static#e=this.\u0275prov=ie({token:e,factory:function(a){let u=null;return u=a?new a:function Rj(){return new tN(bt(Qn))}(),u},providedIn:"root"})}return e})();typeof window<"u"&&window;class oN{}class Lj{}const $d="*";function lO(e,o){return{type:7,name:e,definitions:o,options:{}}}function cO(e,o=null){return{type:4,styles:o,timings:e}}function sN(e,o=null){return{type:2,steps:e,options:o}}function yg(e){return{type:6,styles:e,offset:null}}function aN(e,o,i){return{type:0,name:e,styles:o,options:i}}function CD(e,o,i=null){return{type:1,expr:e,animation:o,options:i}}function Nj(e=null){return{type:9,options:e}}function zj(e,o,i=null){return{type:11,selector:e,animation:o,options:i}}class _w{constructor(o=0,i=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=o+i}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(o=>o()),this._onDoneFns=[])}onStart(o){this._originalOnStartFns.push(o),this._onStartFns.push(o)}onDone(o){this._originalOnDoneFns.push(o),this._onDoneFns.push(o)}onDestroy(o){this._onDestroyFns.push(o)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(o=>o()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(o=>o()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(o){this._position=this.totalTime?o*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(o){const i="start"==o?this._onStartFns:this._onDoneFns;i.forEach(a=>a()),i.length=0}}class lN{constructor(o){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=o;let i=0,a=0,u=0;const f=this.players.length;0==f?queueMicrotask(()=>this._onFinish()):this.players.forEach(g=>{g.onDone(()=>{++i==f&&this._onFinish()}),g.onDestroy(()=>{++a==f&&this._onDestroy()}),g.onStart(()=>{++u==f&&this._onStart()})}),this.totalTime=this.players.reduce((g,x)=>Math.max(g,x.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(o=>o()),this._onDoneFns=[])}init(){this.players.forEach(o=>o.init())}onStart(o){this._onStartFns.push(o)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(o=>o()),this._onStartFns=[])}onDone(o){this._onDoneFns.push(o)}onDestroy(o){this._onDestroyFns.push(o)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(o=>o.play())}pause(){this.players.forEach(o=>o.pause())}restart(){this.players.forEach(o=>o.restart())}finish(){this._onFinish(),this.players.forEach(o=>o.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(o=>o.destroy()),this._onDestroyFns.forEach(o=>o()),this._onDestroyFns=[])}reset(){this.players.forEach(o=>o.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(o){const i=o*this.totalTime;this.players.forEach(a=>{const u=a.totalTime?Math.min(1,i/a.totalTime):1;a.setPosition(u)})}getPosition(){const o=this.players.reduce((i,a)=>null===i||a.totalTime>i.totalTime?a:i,null);return null!=o?o.getPosition():0}beforeDestroy(){this.players.forEach(o=>{o.beforeDestroy&&o.beforeDestroy()})}triggerCallback(o){const i="start"==o?this._onStartFns:this._onDoneFns;i.forEach(a=>a()),i.length=0}}function cN(e){return new at(3e3,!1)}function $f(e){switch(e.length){case 0:return new _w;case 1:return e[0];default:return new lN(e)}}function uN(e,o,i=new Map,a=new Map){const u=[],f=[];let g=-1,x=null;if(o.forEach(w=>{const T=w.get("offset"),A=T==g,k=A&&x||new Map;w.forEach((B,G)=>{let K=G,et=B;if("offset"!==G)switch(K=e.normalizePropertyName(K,u),et){case"!":et=i.get(G);break;case $d:et=a.get(G);break;default:et=e.normalizeStyleValue(G,K,et,u)}k.set(K,et)}),A||f.push(k),x=k,g=T}),u.length)throw function aU(e){return new at(3502,!1)}();return f}function dO(e,o,i,a){switch(o){case"start":e.onStart(()=>a(i&&hO(i,"start",e)));break;case"done":e.onDone(()=>a(i&&hO(i,"done",e)));break;case"destroy":e.onDestroy(()=>a(i&&hO(i,"destroy",e)))}}function hO(e,o,i){const f=fO(e.element,e.triggerName,e.fromState,e.toState,o||e.phaseName,i.totalTime??e.totalTime,!!i.disabled),g=e._data;return null!=g&&(f._data=g),f}function fO(e,o,i,a,u="",f=0,g){return{element:e,triggerName:o,fromState:i,toState:a,phaseName:u,totalTime:f,disabled:!!g}}function cl(e,o,i){let a=e.get(o);return a||e.set(o,a=i),a}function dN(e){const o=e.indexOf(":");return[e.substring(1,o),e.slice(o+1)]}const vU=(()=>typeof document>"u"?null:document.documentElement)();function pO(e){const o=e.parentNode||e.host||null;return o===vU?null:o}let vg=null,hN=!1;function fN(e,o){for(;o;){if(o===e)return!0;o=pO(o)}return!1}function pN(e,o,i){if(i)return Array.from(e.querySelectorAll(o));const a=e.querySelector(o);return a?[a]:[]}let mN=(()=>{class e{validateStyleProperty(i){return function bU(e){vg||(vg=function wU(){return typeof document<"u"?document.body:null}()||{},hN=!!vg.style&&"WebkitAppearance"in vg.style);let o=!0;return vg.style&&!function xU(e){return"ebkit"==e.substring(1,6)}(e)&&(o=e in vg.style,!o&&hN&&(o="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in vg.style)),o}(i)}matchesElement(i,a){return!1}containsElement(i,a){return fN(i,a)}getParentElement(i){return pO(i)}query(i,a,u){return pN(i,a,u)}computeStyle(i,a,u){return u||""}animate(i,a,u,f,g,x=[],w){return new _w(u,f)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})(),mO=(()=>{class e{static#t=this.NOOP=new mN}return e})();const EU=1e3,gO="ng-enter",MD="ng-leave",SD="ng-trigger",TD=".ng-trigger",_N="ng-animating",_O=".ng-animating";function Hd(e){if("number"==typeof e)return e;const o=e.match(/^(-?[\.\d]+)(m?s)/);return!o||o.length<2?0:yO(parseFloat(o[1]),o[2])}function yO(e,o){return"s"===o?e*EU:e}function DD(e,o,i){return e.hasOwnProperty("duration")?e:function MU(e,o,i){let u,f=0,g="";if("string"==typeof e){const x=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===x)return o.push(cN()),{duration:0,delay:0,easing:""};u=yO(parseFloat(x[1]),x[2]);const w=x[3];null!=w&&(f=yO(parseFloat(w),x[4]));const T=x[5];T&&(g=T)}else u=e;if(!i){let x=!1,w=o.length;u<0&&(o.push(function Bj(){return new at(3100,!1)}()),x=!0),f<0&&(o.push(function Vj(){return new at(3101,!1)}()),x=!0),x&&o.splice(w,0,cN())}return{duration:u,delay:f,easing:g}}(e,o,i)}function yw(e,o={}){return Object.keys(e).forEach(i=>{o[i]=e[i]}),o}function yN(e){const o=new Map;return Object.keys(e).forEach(i=>{o.set(i,e[i])}),o}function Hf(e,o=new Map,i){if(i)for(let[a,u]of i)o.set(a,u);for(let[a,u]of e)o.set(a,u);return o}function Nu(e,o,i){o.forEach((a,u)=>{const f=xO(u);i&&!i.has(u)&&i.set(u,e.style[f]),e.style[f]=a})}function xg(e,o){o.forEach((i,a)=>{const u=xO(a);e.style[u]=""})}function vw(e){return Array.isArray(e)?1==e.length?e[0]:sN(e):e}const vO=new RegExp("{{\\s*(.+?)\\s*}}","g");function xN(e){let o=[];if("string"==typeof e){let i;for(;i=vO.exec(e);)o.push(i[1]);vO.lastIndex=0}return o}function xw(e,o,i){const a=e.toString(),u=a.replace(vO,(f,g)=>{let x=o[g];return null==x&&(i.push(function Uj(e){return new at(3003,!1)}()),x=""),x.toString()});return u==a?e:u}function ID(e){const o=[];let i=e.next();for(;!i.done;)o.push(i.value),i=e.next();return o}const DU=/-+([a-z0-9])/g;function xO(e){return e.replace(DU,(...o)=>o[1].toUpperCase())}function ul(e,o,i){switch(o.type){case 7:return e.visitTrigger(o,i);case 0:return e.visitState(o,i);case 1:return e.visitTransition(o,i);case 2:return e.visitSequence(o,i);case 3:return e.visitGroup(o,i);case 4:return e.visitAnimate(o,i);case 5:return e.visitKeyframes(o,i);case 6:return e.visitStyle(o,i);case 8:return e.visitReference(o,i);case 9:return e.visitAnimateChild(o,i);case 10:return e.visitAnimateRef(o,i);case 11:return e.visitQuery(o,i);case 12:return e.visitStagger(o,i);default:throw function $j(e){return new at(3004,!1)}()}}function bN(e,o){return window.getComputedStyle(e)[o]}const AD="*";function RU(e,o){const i=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(a=>function PU(e,o,i){if(":"==e[0]){const w=function OU(e,o){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(i,a)=>parseFloat(a)>parseFloat(i);case":decrement":return(i,a)=>parseFloat(a)<parseFloat(i);default:return o.push(function iU(e){return new at(3016,!1)}()),"* => *"}}(e,i);if("function"==typeof w)return void o.push(w);e=w}const a=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==a||a.length<4)return i.push(function nU(e){return new at(3015,!1)}()),o;const u=a[1],f=a[2],g=a[3];o.push(wN(u,g));"<"==f[0]&&!(u==AD&&g==AD)&&o.push(wN(g,u))}(a,i,o)):i.push(e),i}const RD=new Set(["true","1"]),PD=new Set(["false","0"]);function wN(e,o){const i=RD.has(e)||PD.has(e),a=RD.has(o)||PD.has(o);return(u,f)=>{let g=e==AD||e==u,x=o==AD||o==f;return!g&&i&&"boolean"==typeof u&&(g=u?RD.has(e):PD.has(e)),!x&&a&&"boolean"==typeof f&&(x=f?RD.has(o):PD.has(o)),g&&x}}const kU=new RegExp("s*:selfs*,?","g");function bO(e,o,i,a){return new FU(e).build(o,i,a)}class FU{constructor(o){this._driver=o}build(o,i,a){const u=new zU(i);return this._resetContextStyleTimingState(u),ul(this,vw(o),u)}_resetContextStyleTimingState(o){o.currentQuerySelector="",o.collectedStyles=new Map,o.collectedStyles.set("",new Map),o.currentTime=0}visitTrigger(o,i){let a=i.queryCount=0,u=i.depCount=0;const f=[],g=[];return"@"==o.name.charAt(0)&&i.errors.push(function Gj(){return new at(3006,!1)}()),o.definitions.forEach(x=>{if(this._resetContextStyleTimingState(i),0==x.type){const w=x,T=w.name;T.toString().split(/\s*,\s*/).forEach(A=>{w.name=A,f.push(this.visitState(w,i))}),w.name=T}else if(1==x.type){const w=this.visitTransition(x,i);a+=w.queryCount,u+=w.depCount,g.push(w)}else i.errors.push(function qj(){return new at(3007,!1)}())}),{type:7,name:o.name,states:f,transitions:g,queryCount:a,depCount:u,options:null}}visitState(o,i){const a=this.visitStyle(o.styles,i),u=o.options&&o.options.params||null;if(a.containsDynamicStyles){const f=new Set,g=u||{};a.styles.forEach(x=>{x instanceof Map&&x.forEach(w=>{xN(w).forEach(T=>{g.hasOwnProperty(T)||f.add(T)})})}),f.size&&(ID(f.values()),i.errors.push(function Wj(e,o){return new at(3008,!1)}()))}return{type:0,name:o.name,style:a,options:u?{params:u}:null}}visitTransition(o,i){i.queryCount=0,i.depCount=0;const a=ul(this,vw(o.animation),i);return{type:1,matchers:RU(o.expr,i.errors),animation:a,queryCount:i.queryCount,depCount:i.depCount,options:bg(o.options)}}visitSequence(o,i){return{type:2,steps:o.steps.map(a=>ul(this,a,i)),options:bg(o.options)}}visitGroup(o,i){const a=i.currentTime;let u=0;const f=o.steps.map(g=>{i.currentTime=a;const x=ul(this,g,i);return u=Math.max(u,i.currentTime),x});return i.currentTime=u,{type:3,steps:f,options:bg(o.options)}}visitAnimate(o,i){const a=function VU(e,o){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return wO(DD(e,o).duration,0,"");const i=e;if(i.split(/\s+/).some(f=>"{"==f.charAt(0)&&"{"==f.charAt(1))){const f=wO(0,0,"");return f.dynamic=!0,f.strValue=i,f}const u=DD(i,o);return wO(u.duration,u.delay,u.easing)}(o.timings,i.errors);i.currentAnimateTimings=a;let u,f=o.styles?o.styles:yg({});if(5==f.type)u=this.visitKeyframes(f,i);else{let g=o.styles,x=!1;if(!g){x=!0;const T={};a.easing&&(T.easing=a.easing),g=yg(T)}i.currentTime+=a.duration+a.delay;const w=this.visitStyle(g,i);w.isEmptyStep=x,u=w}return i.currentAnimateTimings=null,{type:4,timings:a,style:u,options:null}}visitStyle(o,i){const a=this._makeStyleAst(o,i);return this._validateStyleAst(a,i),a}_makeStyleAst(o,i){const a=[],u=Array.isArray(o.styles)?o.styles:[o.styles];for(let x of u)"string"==typeof x?x===$d?a.push(x):i.errors.push(new at(3002,!1)):a.push(yN(x));let f=!1,g=null;return a.forEach(x=>{if(x instanceof Map&&(x.has("easing")&&(g=x.get("easing"),x.delete("easing")),!f))for(let w of x.values())if(w.toString().indexOf("{{")>=0){f=!0;break}}),{type:6,styles:a,easing:g,offset:o.offset,containsDynamicStyles:f,options:null}}_validateStyleAst(o,i){const a=i.currentAnimateTimings;let u=i.currentTime,f=i.currentTime;a&&f>0&&(f-=a.duration+a.delay),o.styles.forEach(g=>{"string"!=typeof g&&g.forEach((x,w)=>{const T=i.collectedStyles.get(i.currentQuerySelector),A=T.get(w);let k=!0;A&&(f!=u&&f>=A.startTime&&u<=A.endTime&&(i.errors.push(function Xj(e,o,i,a,u){return new at(3010,!1)}()),k=!1),f=A.startTime),k&&T.set(w,{startTime:f,endTime:u}),i.options&&function TU(e,o,i){const a=o.params||{},u=xN(e);u.length&&u.forEach(f=>{a.hasOwnProperty(f)||i.push(function jj(e){return new at(3001,!1)}())})}(x,i.options,i.errors)})})}visitKeyframes(o,i){const a={type:5,styles:[],options:null};if(!i.currentAnimateTimings)return i.errors.push(function Yj(){return new at(3011,!1)}()),a;let f=0;const g=[];let x=!1,w=!1,T=0;const A=o.steps.map(_t=>{const pt=this._makeStyleAst(_t,i);let Ft=null!=pt.offset?pt.offset:function BU(e){if("string"==typeof e)return null;let o=null;if(Array.isArray(e))e.forEach(i=>{if(i instanceof Map&&i.has("offset")){const a=i;o=parseFloat(a.get("offset")),a.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const i=e;o=parseFloat(i.get("offset")),i.delete("offset")}return o}(pt.styles),Zt=0;return null!=Ft&&(f++,Zt=pt.offset=Ft),w=w||Zt<0||Zt>1,x=x||Zt<T,T=Zt,g.push(Zt),pt});w&&i.errors.push(function Kj(){return new at(3012,!1)}()),x&&i.errors.push(function Jj(){return new at(3200,!1)}());const k=o.steps.length;let B=0;f>0&&f<k?i.errors.push(function Qj(){return new at(3202,!1)}()):0==f&&(B=1/(k-1));const G=k-1,K=i.currentTime,et=i.currentAnimateTimings,ut=et.duration;return A.forEach((_t,pt)=>{const Ft=B>0?pt==G?1:B*pt:g[pt],Zt=Ft*ut;i.currentTime=K+et.delay+Zt,et.duration=Zt,this._validateStyleAst(_t,i),_t.offset=Ft,a.styles.push(_t)}),a}visitReference(o,i){return{type:8,animation:ul(this,vw(o.animation),i),options:bg(o.options)}}visitAnimateChild(o,i){return i.depCount++,{type:9,options:bg(o.options)}}visitAnimateRef(o,i){return{type:10,animation:this.visitReference(o.animation,i),options:bg(o.options)}}visitQuery(o,i){const a=i.currentQuerySelector,u=o.options||{};i.queryCount++,i.currentQuery=o;const[f,g]=function LU(e){const o=!!e.split(/\s*,\s*/).find(i=>":self"==i);return o&&(e=e.replace(kU,"")),e=e.replace(/@\*/g,TD).replace(/@\w+/g,i=>TD+"-"+i.slice(1)).replace(/:animating/g,_O),[e,o]}(o.selector);i.currentQuerySelector=a.length?a+" "+f:f,cl(i.collectedStyles,i.currentQuerySelector,new Map);const x=ul(this,vw(o.animation),i);return i.currentQuery=null,i.currentQuerySelector=a,{type:11,selector:f,limit:u.limit||0,optional:!!u.optional,includeSelf:g,animation:x,originalSelector:o.selector,options:bg(o.options)}}visitStagger(o,i){i.currentQuery||i.errors.push(function tU(){return new at(3013,!1)}());const a="full"===o.timings?{duration:0,delay:0,easing:"full"}:DD(o.timings,i.errors,!0);return{type:12,animation:ul(this,vw(o.animation),i),timings:a,options:null}}}class zU{constructor(o){this.errors=o,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function bg(e){return e?(e=yw(e)).params&&(e.params=function NU(e){return e?yw(e):null}(e.params)):e={},e}function wO(e,o,i){return{duration:e,delay:o,easing:i}}function EO(e,o,i,a,u,f,g=null,x=!1){return{type:1,element:e,keyframes:o,preStyleProps:i,postStyleProps:a,duration:u,delay:f,totalTime:u+f,easing:g,subTimeline:x}}class OD{constructor(){this._map=new Map}get(o){return this._map.get(o)||[]}append(o,i){let a=this._map.get(o);a||this._map.set(o,a=[]),a.push(...i)}has(o){return this._map.has(o)}clear(){this._map.clear()}}const $U=new RegExp(":enter","g"),GU=new RegExp(":leave","g");function CO(e,o,i,a,u,f=new Map,g=new Map,x,w,T=[]){return(new qU).buildKeyframes(e,o,i,a,u,f,g,x,w,T)}class qU{buildKeyframes(o,i,a,u,f,g,x,w,T,A=[]){T=T||new OD;const k=new MO(o,i,T,u,f,A,[]);k.options=w;const B=w.delay?Hd(w.delay):0;k.currentTimeline.delayNextStep(B),k.currentTimeline.setStyles([g],null,k.errors,w),ul(this,a,k);const G=k.timelines.filter(K=>K.containsAnimation());if(G.length&&x.size){let K;for(let et=G.length-1;et>=0;et--){const ut=G[et];if(ut.element===i){K=ut;break}}K&&!K.allowOnlyTimelineStyles()&&K.setStyles([x],null,k.errors,w)}return G.length?G.map(K=>K.buildKeyframes()):[EO(i,[],[],[],0,B,"",!1)]}visitTrigger(o,i){}visitState(o,i){}visitTransition(o,i){}visitAnimateChild(o,i){const a=i.subInstructions.get(i.element);if(a){const u=i.createSubContext(o.options),f=i.currentTimeline.currentTime,g=this._visitSubInstructions(a,u,u.options);f!=g&&i.transformIntoNewTimeline(g)}i.previousNode=o}visitAnimateRef(o,i){const a=i.createSubContext(o.options);a.transformIntoNewTimeline(),this._applyAnimationRefDelays([o.options,o.animation.options],i,a),this.visitReference(o.animation,a),i.transformIntoNewTimeline(a.currentTimeline.currentTime),i.previousNode=o}_applyAnimationRefDelays(o,i,a){for(const u of o){const f=u?.delay;if(f){const g="number"==typeof f?f:Hd(xw(f,u?.params??{},i.errors));a.delayNextStep(g)}}}_visitSubInstructions(o,i,a){let f=i.currentTimeline.currentTime;const g=null!=a.duration?Hd(a.duration):null,x=null!=a.delay?Hd(a.delay):null;return 0!==g&&o.forEach(w=>{const T=i.appendInstructionToTimeline(w,g,x);f=Math.max(f,T.duration+T.delay)}),f}visitReference(o,i){i.updateOptions(o.options,!0),ul(this,o.animation,i),i.previousNode=o}visitSequence(o,i){const a=i.subContextCount;let u=i;const f=o.options;if(f&&(f.params||f.delay)&&(u=i.createSubContext(f),u.transformIntoNewTimeline(),null!=f.delay)){6==u.previousNode.type&&(u.currentTimeline.snapshotCurrentStyles(),u.previousNode=kD);const g=Hd(f.delay);u.delayNextStep(g)}o.steps.length&&(o.steps.forEach(g=>ul(this,g,u)),u.currentTimeline.applyStylesToKeyframe(),u.subContextCount>a&&u.transformIntoNewTimeline()),i.previousNode=o}visitGroup(o,i){const a=[];let u=i.currentTimeline.currentTime;const f=o.options&&o.options.delay?Hd(o.options.delay):0;o.steps.forEach(g=>{const x=i.createSubContext(o.options);f&&x.delayNextStep(f),ul(this,g,x),u=Math.max(u,x.currentTimeline.currentTime),a.push(x.currentTimeline)}),a.forEach(g=>i.currentTimeline.mergeTimelineCollectedStyles(g)),i.transformIntoNewTimeline(u),i.previousNode=o}_visitTiming(o,i){if(o.dynamic){const a=o.strValue;return DD(i.params?xw(a,i.params,i.errors):a,i.errors)}return{duration:o.duration,delay:o.delay,easing:o.easing}}visitAnimate(o,i){const a=i.currentAnimateTimings=this._visitTiming(o.timings,i),u=i.currentTimeline;a.delay&&(i.incrementTime(a.delay),u.snapshotCurrentStyles());const f=o.style;5==f.type?this.visitKeyframes(f,i):(i.incrementTime(a.duration),this.visitStyle(f,i),u.applyStylesToKeyframe()),i.currentAnimateTimings=null,i.previousNode=o}visitStyle(o,i){const a=i.currentTimeline,u=i.currentAnimateTimings;!u&&a.hasCurrentStyleProperties()&&a.forwardFrame();const f=u&&u.easing||o.easing;o.isEmptyStep?a.applyEmptyStep(f):a.setStyles(o.styles,f,i.errors,i.options),i.previousNode=o}visitKeyframes(o,i){const a=i.currentAnimateTimings,u=i.currentTimeline.duration,f=a.duration,x=i.createSubContext().currentTimeline;x.easing=a.easing,o.styles.forEach(w=>{x.forwardTime((w.offset||0)*f),x.setStyles(w.styles,w.easing,i.errors,i.options),x.applyStylesToKeyframe()}),i.currentTimeline.mergeTimelineCollectedStyles(x),i.transformIntoNewTimeline(u+f),i.previousNode=o}visitQuery(o,i){const a=i.currentTimeline.currentTime,u=o.options||{},f=u.delay?Hd(u.delay):0;f&&(6===i.previousNode.type||0==a&&i.currentTimeline.hasCurrentStyleProperties())&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=kD);let g=a;const x=i.invokeQuery(o.selector,o.originalSelector,o.limit,o.includeSelf,!!u.optional,i.errors);i.currentQueryTotal=x.length;let w=null;x.forEach((T,A)=>{i.currentQueryIndex=A;const k=i.createSubContext(o.options,T);f&&k.delayNextStep(f),T===i.element&&(w=k.currentTimeline),ul(this,o.animation,k),k.currentTimeline.applyStylesToKeyframe(),g=Math.max(g,k.currentTimeline.currentTime)}),i.currentQueryIndex=0,i.currentQueryTotal=0,i.transformIntoNewTimeline(g),w&&(i.currentTimeline.mergeTimelineCollectedStyles(w),i.currentTimeline.snapshotCurrentStyles()),i.previousNode=o}visitStagger(o,i){const a=i.parentContext,u=i.currentTimeline,f=o.timings,g=Math.abs(f.duration),x=g*(i.currentQueryTotal-1);let w=g*i.currentQueryIndex;switch(f.duration<0?"reverse":f.easing){case"reverse":w=x-w;break;case"full":w=a.currentStaggerTime}const A=i.currentTimeline;w&&A.delayNextStep(w);const k=A.currentTime;ul(this,o.animation,i),i.previousNode=o,a.currentStaggerTime=u.currentTime-k+(u.startTime-a.currentTimeline.startTime)}}const kD={};class MO{constructor(o,i,a,u,f,g,x,w){this._driver=o,this.element=i,this.subInstructions=a,this._enterClassName=u,this._leaveClassName=f,this.errors=g,this.timelines=x,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=kD,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=w||new FD(this._driver,i,0),x.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(o,i){if(!o)return;const a=o;let u=this.options;null!=a.duration&&(u.duration=Hd(a.duration)),null!=a.delay&&(u.delay=Hd(a.delay));const f=a.params;if(f){let g=u.params;g||(g=this.options.params={}),Object.keys(f).forEach(x=>{(!i||!g.hasOwnProperty(x))&&(g[x]=xw(f[x],g,this.errors))})}}_copyOptions(){const o={};if(this.options){const i=this.options.params;if(i){const a=o.params={};Object.keys(i).forEach(u=>{a[u]=i[u]})}}return o}createSubContext(o=null,i,a){const u=i||this.element,f=new MO(this._driver,u,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(u,a||0));return f.previousNode=this.previousNode,f.currentAnimateTimings=this.currentAnimateTimings,f.options=this._copyOptions(),f.updateOptions(o),f.currentQueryIndex=this.currentQueryIndex,f.currentQueryTotal=this.currentQueryTotal,f.parentContext=this,this.subContextCount++,f}transformIntoNewTimeline(o){return this.previousNode=kD,this.currentTimeline=this.currentTimeline.fork(this.element,o),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(o,i,a){const u={duration:i??o.duration,delay:this.currentTimeline.currentTime+(a??0)+o.delay,easing:""},f=new WU(this._driver,o.element,o.keyframes,o.preStyleProps,o.postStyleProps,u,o.stretchStartingKeyframe);return this.timelines.push(f),u}incrementTime(o){this.currentTimeline.forwardTime(this.currentTimeline.duration+o)}delayNextStep(o){o>0&&this.currentTimeline.delayNextStep(o)}invokeQuery(o,i,a,u,f,g){let x=[];if(u&&x.push(this.element),o.length>0){o=(o=o.replace($U,"."+this._enterClassName)).replace(GU,"."+this._leaveClassName);let T=this._driver.query(this.element,o,1!=a);0!==a&&(T=a<0?T.slice(T.length+a,T.length):T.slice(0,a)),x.push(...T)}return!f&&0==x.length&&g.push(function eU(e){return new at(3014,!1)}()),x}}class FD{constructor(o,i,a,u){this._driver=o,this.element=i,this.startTime=a,this._elementTimelineStylesLookup=u,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(i),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(i,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(o){const i=1===this._keyframes.size&&this._pendingStyles.size;this.duration||i?(this.forwardTime(this.currentTime+o),i&&this.snapshotCurrentStyles()):this.startTime+=o}fork(o,i){return this.applyStylesToKeyframe(),new FD(this._driver,o,i||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(o){this.applyStylesToKeyframe(),this.duration=o,this._loadKeyframe()}_updateStyle(o,i){this._localTimelineStyles.set(o,i),this._globalTimelineStyles.set(o,i),this._styleSummary.set(o,{time:this.currentTime,value:i})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(o){o&&this._previousKeyframe.set("easing",o);for(let[i,a]of this._globalTimelineStyles)this._backFill.set(i,a||$d),this._currentKeyframe.set(i,$d);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(o,i,a,u){i&&this._previousKeyframe.set("easing",i);const f=u&&u.params||{},g=function ZU(e,o){const i=new Map;let a;return e.forEach(u=>{if("*"===u){a=a||o.keys();for(let f of a)i.set(f,$d)}else Hf(u,i)}),i}(o,this._globalTimelineStyles);for(let[x,w]of g){const T=xw(w,f,a);this._pendingStyles.set(x,T),this._localTimelineStyles.has(x)||this._backFill.set(x,this._globalTimelineStyles.get(x)??$d),this._updateStyle(x,T)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((o,i)=>{this._currentKeyframe.set(i,o)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((o,i)=>{this._currentKeyframe.has(i)||this._currentKeyframe.set(i,o)}))}snapshotCurrentStyles(){for(let[o,i]of this._localTimelineStyles)this._pendingStyles.set(o,i),this._updateStyle(o,i)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const o=[];for(let i in this._currentKeyframe)o.push(i);return o}mergeTimelineCollectedStyles(o){o._styleSummary.forEach((i,a)=>{const u=this._styleSummary.get(a);(!u||i.time>u.time)&&this._updateStyle(a,i.value)})}buildKeyframes(){this.applyStylesToKeyframe();const o=new Set,i=new Set,a=1===this._keyframes.size&&0===this.duration;let u=[];this._keyframes.forEach((x,w)=>{const T=Hf(x,new Map,this._backFill);T.forEach((A,k)=>{"!"===A?o.add(k):A===$d&&i.add(k)}),a||T.set("offset",w/this.duration),u.push(T)});const f=o.size?ID(o.values()):[],g=i.size?ID(i.values()):[];if(a){const x=u[0],w=new Map(x);x.set("offset",0),w.set("offset",1),u=[x,w]}return EO(this.element,u,f,g,this.duration,this.startTime,this.easing,!1)}}class WU extends FD{constructor(o,i,a,u,f,g,x=!1){super(o,i,g.delay),this.keyframes=a,this.preStyleProps=u,this.postStyleProps=f,this._stretchStartingKeyframe=x,this.timings={duration:g.duration,delay:g.delay,easing:g.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let o=this.keyframes,{delay:i,duration:a,easing:u}=this.timings;if(this._stretchStartingKeyframe&&i){const f=[],g=a+i,x=i/g,w=Hf(o[0]);w.set("offset",0),f.push(w);const T=Hf(o[0]);T.set("offset",MN(x)),f.push(T);const A=o.length-1;for(let k=1;k<=A;k++){let B=Hf(o[k]);const G=B.get("offset");B.set("offset",MN((i+G*a)/g)),f.push(B)}a=g,i=0,u="",o=f}return EO(this.element,o,this.preStyleProps,this.postStyleProps,a,i,u,!0)}}function MN(e,o=3){const i=Math.pow(10,o-1);return Math.round(e*i)/i}class SO{}const XU=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class YU extends SO{normalizePropertyName(o,i){return xO(o)}normalizeStyleValue(o,i,a,u){let f="";const g=a.toString().trim();if(XU.has(i)&&0!==a&&"0"!==a)if("number"==typeof a)f="px";else{const x=a.match(/^[+-]?[\d\.]+([a-z]*)$/);x&&0==x[1].length&&u.push(function Hj(e,o){return new at(3005,!1)}())}return g+f}}function SN(e,o,i,a,u,f,g,x,w,T,A,k,B){return{type:0,element:e,triggerName:o,isRemovalTransition:u,fromState:i,fromStyles:f,toState:a,toStyles:g,timelines:x,queriedElements:w,preStyleProps:T,postStyleProps:A,totalTime:k,errors:B}}const TO={};class TN{constructor(o,i,a){this._triggerName=o,this.ast=i,this._stateStyles=a}match(o,i,a,u){return function KU(e,o,i,a,u){return e.some(f=>f(o,i,a,u))}(this.ast.matchers,o,i,a,u)}buildStyles(o,i,a){let u=this._stateStyles.get("*");return void 0!==o&&(u=this._stateStyles.get(o?.toString())||u),u?u.buildStyles(i,a):new Map}build(o,i,a,u,f,g,x,w,T,A){const k=[],B=this.ast.options&&this.ast.options.params||TO,K=this.buildStyles(a,x&&x.params||TO,k),et=w&&w.params||TO,ut=this.buildStyles(u,et,k),_t=new Set,pt=new Map,Ft=new Map,Zt="void"===u,de={params:JU(et,B),delay:this.ast.options?.delay},oe=A?[]:CO(o,i,this.ast.animation,f,g,K,ut,de,T,k);let Te=0;if(oe.forEach(yn=>{Te=Math.max(yn.duration+yn.delay,Te)}),k.length)return SN(i,this._triggerName,a,u,Zt,K,ut,[],[],pt,Ft,Te,k);oe.forEach(yn=>{const si=yn.element,hi=cl(pt,si,new Set);yn.preStyleProps.forEach(Vi=>hi.add(Vi));const Sn=cl(Ft,si,new Set);yn.postStyleProps.forEach(Vi=>Sn.add(Vi)),si!==i&&_t.add(si)});const hn=ID(_t.values());return SN(i,this._triggerName,a,u,Zt,K,ut,oe,hn,pt,Ft,Te)}}function JU(e,o){const i=yw(o);for(const a in e)e.hasOwnProperty(a)&&null!=e[a]&&(i[a]=e[a]);return i}class QU{constructor(o,i,a){this.styles=o,this.defaultParams=i,this.normalizer=a}buildStyles(o,i){const a=new Map,u=yw(this.defaultParams);return Object.keys(o).forEach(f=>{const g=o[f];null!==g&&(u[f]=g)}),this.styles.styles.forEach(f=>{"string"!=typeof f&&f.forEach((g,x)=>{g&&(g=xw(g,u,i));const w=this.normalizer.normalizePropertyName(x,i);g=this.normalizer.normalizeStyleValue(x,w,g,i),a.set(x,g)})}),a}}class e6{constructor(o,i,a){this.name=o,this.ast=i,this._normalizer=a,this.transitionFactories=[],this.states=new Map,i.states.forEach(u=>{this.states.set(u.name,new QU(u.style,u.options&&u.options.params||{},a))}),DN(this.states,"true","1"),DN(this.states,"false","0"),i.transitions.forEach(u=>{this.transitionFactories.push(new TN(o,u,this.states))}),this.fallbackTransition=function n6(e,o,i){return new TN(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(g,x)=>!0],options:null,queryCount:0,depCount:0},o)}(o,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(o,i,a,u){return this.transitionFactories.find(g=>g.match(o,i,a,u))||null}matchStyles(o,i,a){return this.fallbackTransition.buildStyles(o,i,a)}}function DN(e,o,i){e.has(o)?e.has(i)||e.set(i,e.get(o)):e.has(i)&&e.set(o,e.get(i))}const i6=new OD;class r6{constructor(o,i,a){this.bodyNode=o,this._driver=i,this._normalizer=a,this._animations=new Map,this._playersById=new Map,this.players=[]}register(o,i){const a=[],f=bO(this._driver,i,a,[]);if(a.length)throw function lU(e){return new at(3503,!1)}();this._animations.set(o,f)}_buildPlayer(o,i,a){const u=o.element,f=uN(this._normalizer,o.keyframes,i,a);return this._driver.animate(u,f,o.duration,o.delay,o.easing,[],!0)}create(o,i,a={}){const u=[],f=this._animations.get(o);let g;const x=new Map;if(f?(g=CO(this._driver,i,f,gO,MD,new Map,new Map,a,i6,u),g.forEach(A=>{const k=cl(x,A.element,new Map);A.postStyleProps.forEach(B=>k.set(B,null))})):(u.push(function cU(){return new at(3300,!1)}()),g=[]),u.length)throw function uU(e){return new at(3504,!1)}();x.forEach((A,k)=>{A.forEach((B,G)=>{A.set(G,this._driver.computeStyle(k,G,$d))})});const T=$f(g.map(A=>{const k=x.get(A.element);return this._buildPlayer(A,new Map,k)}));return this._playersById.set(o,T),T.onDestroy(()=>this.destroy(o)),this.players.push(T),T}destroy(o){const i=this._getPlayer(o);i.destroy(),this._playersById.delete(o);const a=this.players.indexOf(i);a>=0&&this.players.splice(a,1)}_getPlayer(o){const i=this._playersById.get(o);if(!i)throw function dU(e){return new at(3301,!1)}();return i}listen(o,i,a,u){const f=fO(i,"","","");return dO(this._getPlayer(o),a,f,u),()=>{}}command(o,i,a,u){if("register"==a)return void this.register(o,u[0]);if("create"==a)return void this.create(o,i,u[0]||{});const f=this._getPlayer(o);switch(a){case"play":f.play();break;case"pause":f.pause();break;case"reset":f.reset();break;case"restart":f.restart();break;case"finish":f.finish();break;case"init":f.init();break;case"setPosition":f.setPosition(parseFloat(u[0]));break;case"destroy":this.destroy(o)}}}const IN="ng-animate-queued",DO="ng-animate-disabled",c6=[],AN={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},u6={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Uc="__ng_removed";class IO{get params(){return this.options.params}constructor(o,i=""){this.namespaceId=i;const a=o&&o.hasOwnProperty("value");if(this.value=function p6(e){return e??null}(a?o.value:o),a){const f=yw(o);delete f.value,this.options=f}else this.options={};this.options.params||(this.options.params={})}absorbOptions(o){const i=o.params;if(i){const a=this.options.params;Object.keys(i).forEach(u=>{null==a[u]&&(a[u]=i[u])})}}}const bw="void",AO=new IO(bw);class d6{constructor(o,i,a){this.id=o,this.hostElement=i,this._engine=a,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+o,Ql(i,this._hostClassName)}listen(o,i,a,u){if(!this._triggers.has(i))throw function hU(e,o){return new at(3302,!1)}();if(null==a||0==a.length)throw function fU(e){return new at(3303,!1)}();if(!function m6(e){return"start"==e||"done"==e}(a))throw function pU(e,o){return new at(3400,!1)}();const f=cl(this._elementListeners,o,[]),g={name:i,phase:a,callback:u};f.push(g);const x=cl(this._engine.statesByElement,o,new Map);return x.has(i)||(Ql(o,SD),Ql(o,SD+"-"+i),x.set(i,AO)),()=>{this._engine.afterFlush(()=>{const w=f.indexOf(g);w>=0&&f.splice(w,1),this._triggers.has(i)||x.delete(i)})}}register(o,i){return!this._triggers.has(o)&&(this._triggers.set(o,i),!0)}_getTrigger(o){const i=this._triggers.get(o);if(!i)throw function mU(e){return new at(3401,!1)}();return i}trigger(o,i,a,u=!0){const f=this._getTrigger(i),g=new RO(this.id,i,o);let x=this._engine.statesByElement.get(o);x||(Ql(o,SD),Ql(o,SD+"-"+i),this._engine.statesByElement.set(o,x=new Map));let w=x.get(i);const T=new IO(a,this.id);if(!(a&&a.hasOwnProperty("value"))&&w&&T.absorbOptions(w.options),x.set(i,T),w||(w=AO),T.value!==bw&&w.value===T.value){if(!function y6(e,o){const i=Object.keys(e),a=Object.keys(o);if(i.length!=a.length)return!1;for(let u=0;u<i.length;u++){const f=i[u];if(!o.hasOwnProperty(f)||e[f]!==o[f])return!1}return!0}(w.params,T.params)){const et=[],ut=f.matchStyles(w.value,w.params,et),_t=f.matchStyles(T.value,T.params,et);et.length?this._engine.reportError(et):this._engine.afterFlush(()=>{xg(o,ut),Nu(o,_t)})}return}const B=cl(this._engine.playersByElement,o,[]);B.forEach(et=>{et.namespaceId==this.id&&et.triggerName==i&&et.queued&&et.destroy()});let G=f.matchTransition(w.value,T.value,o,T.params),K=!1;if(!G){if(!u)return;G=f.fallbackTransition,K=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:o,triggerName:i,transition:G,fromState:w,toState:T,player:g,isFallbackTransition:K}),K||(Ql(o,IN),g.onStart(()=>{Bv(o,IN)})),g.onDone(()=>{let et=this.players.indexOf(g);et>=0&&this.players.splice(et,1);const ut=this._engine.playersByElement.get(o);if(ut){let _t=ut.indexOf(g);_t>=0&&ut.splice(_t,1)}}),this.players.push(g),B.push(g),g}deregister(o){this._triggers.delete(o),this._engine.statesByElement.forEach(i=>i.delete(o)),this._elementListeners.forEach((i,a)=>{this._elementListeners.set(a,i.filter(u=>u.name!=o))})}clearElementCache(o){this._engine.statesByElement.delete(o),this._elementListeners.delete(o);const i=this._engine.playersByElement.get(o);i&&(i.forEach(a=>a.destroy()),this._engine.playersByElement.delete(o))}_signalRemovalForInnerTriggers(o,i){const a=this._engine.driver.query(o,TD,!0);a.forEach(u=>{if(u[Uc])return;const f=this._engine.fetchNamespacesByElement(u);f.size?f.forEach(g=>g.triggerLeaveAnimation(u,i,!1,!0)):this.clearElementCache(u)}),this._engine.afterFlushAnimationsDone(()=>a.forEach(u=>this.clearElementCache(u)))}triggerLeaveAnimation(o,i,a,u){const f=this._engine.statesByElement.get(o),g=new Map;if(f){const x=[];if(f.forEach((w,T)=>{if(g.set(T,w.value),this._triggers.has(T)){const A=this.trigger(o,T,bw,u);A&&x.push(A)}}),x.length)return this._engine.markElementAsRemoved(this.id,o,!0,i,g),a&&$f(x).onDone(()=>this._engine.processLeaveNode(o)),!0}return!1}prepareLeaveAnimationListeners(o){const i=this._elementListeners.get(o),a=this._engine.statesByElement.get(o);if(i&&a){const u=new Set;i.forEach(f=>{const g=f.name;if(u.has(g))return;u.add(g);const w=this._triggers.get(g).fallbackTransition,T=a.get(g)||AO,A=new IO(bw),k=new RO(this.id,g,o);this._engine.totalQueuedPlayers++,this._queue.push({element:o,triggerName:g,transition:w,fromState:T,toState:A,player:k,isFallbackTransition:!0})})}}removeNode(o,i){const a=this._engine;if(o.childElementCount&&this._signalRemovalForInnerTriggers(o,i),this.triggerLeaveAnimation(o,i,!0))return;let u=!1;if(a.totalAnimations){const f=a.players.length?a.playersByQueriedElement.get(o):[];if(f&&f.length)u=!0;else{let g=o;for(;g=g.parentNode;)if(a.statesByElement.get(g)){u=!0;break}}}if(this.prepareLeaveAnimationListeners(o),u)a.markElementAsRemoved(this.id,o,!1,i);else{const f=o[Uc];(!f||f===AN)&&(a.afterFlush(()=>this.clearElementCache(o)),a.destroyInnerAnimations(o),a._onRemovalComplete(o,i))}}insertNode(o,i){Ql(o,this._hostClassName)}drainQueuedTransitions(o){const i=[];return this._queue.forEach(a=>{const u=a.player;if(u.destroyed)return;const f=a.element,g=this._elementListeners.get(f);g&&g.forEach(x=>{if(x.name==a.triggerName){const w=fO(f,a.triggerName,a.fromState.value,a.toState.value);w._data=o,dO(a.player,x.phase,w,x.callback)}}),u.markedForDestroy?this._engine.afterFlush(()=>{u.destroy()}):i.push(a)}),this._queue=[],i.sort((a,u)=>{const f=a.transition.ast.depCount,g=u.transition.ast.depCount;return 0==f||0==g?f-g:this._engine.driver.containsElement(a.element,u.element)?1:-1})}destroy(o){this.players.forEach(i=>i.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,o)}}class h6{_onRemovalComplete(o,i){this.onRemovalComplete(o,i)}constructor(o,i,a){this.bodyNode=o,this.driver=i,this._normalizer=a,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(u,f)=>{}}get queuedPlayers(){const o=[];return this._namespaceList.forEach(i=>{i.players.forEach(a=>{a.queued&&o.push(a)})}),o}createNamespace(o,i){const a=new d6(o,i,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,i)?this._balanceNamespaceList(a,i):(this.newHostElements.set(i,a),this.collectEnterElement(i)),this._namespaceLookup[o]=a}_balanceNamespaceList(o,i){const a=this._namespaceList,u=this.namespacesByHostElement;if(a.length-1>=0){let g=!1,x=this.driver.getParentElement(i);for(;x;){const w=u.get(x);if(w){const T=a.indexOf(w);a.splice(T+1,0,o),g=!0;break}x=this.driver.getParentElement(x)}g||a.unshift(o)}else a.push(o);return u.set(i,o),o}register(o,i){let a=this._namespaceLookup[o];return a||(a=this.createNamespace(o,i)),a}registerTrigger(o,i,a){let u=this._namespaceLookup[o];u&&u.register(i,a)&&this.totalAnimations++}destroy(o,i){o&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const a=this._fetchNamespace(o);this.namespacesByHostElement.delete(a.hostElement);const u=this._namespaceList.indexOf(a);u>=0&&this._namespaceList.splice(u,1),a.destroy(i),delete this._namespaceLookup[o]}))}_fetchNamespace(o){return this._namespaceLookup[o]}fetchNamespacesByElement(o){const i=new Set,a=this.statesByElement.get(o);if(a)for(let u of a.values())if(u.namespaceId){const f=this._fetchNamespace(u.namespaceId);f&&i.add(f)}return i}trigger(o,i,a,u){if(LD(i)){const f=this._fetchNamespace(o);if(f)return f.trigger(i,a,u),!0}return!1}insertNode(o,i,a,u){if(!LD(i))return;const f=i[Uc];if(f&&f.setForRemoval){f.setForRemoval=!1,f.setForMove=!0;const g=this.collectedLeaveElements.indexOf(i);g>=0&&this.collectedLeaveElements.splice(g,1)}if(o){const g=this._fetchNamespace(o);g&&g.insertNode(i,a)}u&&this.collectEnterElement(i)}collectEnterElement(o){this.collectedEnterElements.push(o)}markElementAsDisabled(o,i){i?this.disabledNodes.has(o)||(this.disabledNodes.add(o),Ql(o,DO)):this.disabledNodes.has(o)&&(this.disabledNodes.delete(o),Bv(o,DO))}removeNode(o,i,a){if(LD(i)){const u=o?this._fetchNamespace(o):null;u?u.removeNode(i,a):this.markElementAsRemoved(o,i,!1,a);const f=this.namespacesByHostElement.get(i);f&&f.id!==o&&f.removeNode(i,a)}else this._onRemovalComplete(i,a)}markElementAsRemoved(o,i,a,u,f){this.collectedLeaveElements.push(i),i[Uc]={namespaceId:o,setForRemoval:u,hasAnimation:a,removedBeforeQueried:!1,previousTriggersValues:f}}listen(o,i,a,u,f){return LD(i)?this._fetchNamespace(o).listen(i,a,u,f):()=>{}}_buildInstruction(o,i,a,u,f){return o.transition.build(this.driver,o.element,o.fromState.value,o.toState.value,a,u,o.fromState.options,o.toState.options,i,f)}destroyInnerAnimations(o){let i=this.driver.query(o,TD,!0);i.forEach(a=>this.destroyActiveAnimationsForElement(a)),0!=this.playersByQueriedElement.size&&(i=this.driver.query(o,_O,!0),i.forEach(a=>this.finishActiveQueriedAnimationOnElement(a)))}destroyActiveAnimationsForElement(o){const i=this.playersByElement.get(o);i&&i.forEach(a=>{a.queued?a.markedForDestroy=!0:a.destroy()})}finishActiveQueriedAnimationOnElement(o){const i=this.playersByQueriedElement.get(o);i&&i.forEach(a=>a.finish())}whenRenderingDone(){return new Promise(o=>{if(this.players.length)return $f(this.players).onDone(()=>o());o()})}processLeaveNode(o){const i=o[Uc];if(i&&i.setForRemoval){if(o[Uc]=AN,i.namespaceId){this.destroyInnerAnimations(o);const a=this._fetchNamespace(i.namespaceId);a&&a.clearElementCache(o)}this._onRemovalComplete(o,i.setForRemoval)}o.classList?.contains(DO)&&this.markElementAsDisabled(o,!1),this.driver.query(o,".ng-animate-disabled",!0).forEach(a=>{this.markElementAsDisabled(a,!1)})}flush(o=-1){let i=[];if(this.newHostElements.size&&(this.newHostElements.forEach((a,u)=>this._balanceNamespaceList(a,u)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let a=0;a<this.collectedEnterElements.length;a++)Ql(this.collectedEnterElements[a],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const a=[];try{i=this._flushAnimations(a,o)}finally{for(let u=0;u<a.length;u++)a[u]()}}else for(let a=0;a<this.collectedLeaveElements.length;a++)this.processLeaveNode(this.collectedLeaveElements[a]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(a=>a()),this._flushFns=[],this._whenQuietFns.length){const a=this._whenQuietFns;this._whenQuietFns=[],i.length?$f(i).onDone(()=>{a.forEach(u=>u())}):a.forEach(u=>u())}}reportError(o){throw function gU(e){return new at(3402,!1)}()}_flushAnimations(o,i){const a=new OD,u=[],f=new Map,g=[],x=new Map,w=new Map,T=new Map,A=new Set;this.disabledNodes.forEach(Ht=>{A.add(Ht);const fe=this.driver.query(Ht,".ng-animate-queued",!0);for(let pe=0;pe<fe.length;pe++)A.add(fe[pe])});const k=this.bodyNode,B=Array.from(this.statesByElement.keys()),G=ON(B,this.collectedEnterElements),K=new Map;let et=0;G.forEach((Ht,fe)=>{const pe=gO+et++;K.set(fe,pe),Ht.forEach(Pe=>Ql(Pe,pe))});const ut=[],_t=new Set,pt=new Set;for(let Ht=0;Ht<this.collectedLeaveElements.length;Ht++){const fe=this.collectedLeaveElements[Ht],pe=fe[Uc];pe&&pe.setForRemoval&&(ut.push(fe),_t.add(fe),pe.hasAnimation?this.driver.query(fe,".ng-star-inserted",!0).forEach(Pe=>_t.add(Pe)):pt.add(fe))}const Ft=new Map,Zt=ON(B,Array.from(_t));Zt.forEach((Ht,fe)=>{const pe=MD+et++;Ft.set(fe,pe),Ht.forEach(Pe=>Ql(Pe,pe))}),o.push(()=>{G.forEach((Ht,fe)=>{const pe=K.get(fe);Ht.forEach(Pe=>Bv(Pe,pe))}),Zt.forEach((Ht,fe)=>{const pe=Ft.get(fe);Ht.forEach(Pe=>Bv(Pe,pe))}),ut.forEach(Ht=>{this.processLeaveNode(Ht)})});const de=[],oe=[];for(let Ht=this._namespaceList.length-1;Ht>=0;Ht--)this._namespaceList[Ht].drainQueuedTransitions(i).forEach(pe=>{const Pe=pe.player,jn=pe.element;if(de.push(Pe),this.collectedEnterElements.length){const wn=jn[Uc];if(wn&&wn.setForMove){if(wn.previousTriggersValues&&wn.previousTriggersValues.has(pe.triggerName)){const An=wn.previousTriggersValues.get(pe.triggerName),Xn=this.statesByElement.get(pe.element);if(Xn&&Xn.has(pe.triggerName)){const yi=Xn.get(pe.triggerName);yi.value=An,Xn.set(pe.triggerName,yi)}}return void Pe.destroy()}}const fi=!k||!this.driver.containsElement(k,jn),Ve=Ft.get(jn),sr=K.get(jn),vn=this._buildInstruction(pe,a,sr,Ve,fi);if(vn.errors&&vn.errors.length)return void oe.push(vn);if(fi)return Pe.onStart(()=>xg(jn,vn.fromStyles)),Pe.onDestroy(()=>Nu(jn,vn.toStyles)),void u.push(Pe);if(pe.isFallbackTransition)return Pe.onStart(()=>xg(jn,vn.fromStyles)),Pe.onDestroy(()=>Nu(jn,vn.toStyles)),void u.push(Pe);const Ue=[];vn.timelines.forEach(wn=>{wn.stretchStartingKeyframe=!0,this.disabledNodes.has(wn.element)||Ue.push(wn)}),vn.timelines=Ue,a.append(jn,vn.timelines),g.push({instruction:vn,player:Pe,element:jn}),vn.queriedElements.forEach(wn=>cl(x,wn,[]).push(Pe)),vn.preStyleProps.forEach((wn,An)=>{if(wn.size){let Xn=w.get(An);Xn||w.set(An,Xn=new Set),wn.forEach((yi,lo)=>Xn.add(lo))}}),vn.postStyleProps.forEach((wn,An)=>{let Xn=T.get(An);Xn||T.set(An,Xn=new Set),wn.forEach((yi,lo)=>Xn.add(lo))})});if(oe.length){const Ht=[];oe.forEach(fe=>{Ht.push(function _U(e,o){return new at(3505,!1)}())}),de.forEach(fe=>fe.destroy()),this.reportError(Ht)}const Te=new Map,hn=new Map;g.forEach(Ht=>{const fe=Ht.element;a.has(fe)&&(hn.set(fe,fe),this._beforeAnimationBuild(Ht.player.namespaceId,Ht.instruction,Te))}),u.forEach(Ht=>{const fe=Ht.element;this._getPreviousPlayers(fe,!1,Ht.namespaceId,Ht.triggerName,null).forEach(Pe=>{cl(Te,fe,[]).push(Pe),Pe.destroy()})});const yn=ut.filter(Ht=>FN(Ht,w,T)),si=new Map;PN(si,this.driver,pt,T,$d).forEach(Ht=>{FN(Ht,w,T)&&yn.push(Ht)});const Sn=new Map;G.forEach((Ht,fe)=>{PN(Sn,this.driver,new Set(Ht),w,"!")}),yn.forEach(Ht=>{const fe=si.get(Ht),pe=Sn.get(Ht);si.set(Ht,new Map([...fe?.entries()??[],...pe?.entries()??[]]))});const Vi=[],Zi=[],dr={};g.forEach(Ht=>{const{element:fe,player:pe,instruction:Pe}=Ht;if(a.has(fe)){if(A.has(fe))return pe.onDestroy(()=>Nu(fe,Pe.toStyles)),pe.disabled=!0,pe.overrideTotalTime(Pe.totalTime),void u.push(pe);let jn=dr;if(hn.size>1){let Ve=fe;const sr=[];for(;Ve=Ve.parentNode;){const vn=hn.get(Ve);if(vn){jn=vn;break}sr.push(Ve)}sr.forEach(vn=>hn.set(vn,jn))}const fi=this._buildAnimation(pe.namespaceId,Pe,Te,f,Sn,si);if(pe.setRealPlayer(fi),jn===dr)Vi.push(pe);else{const Ve=this.playersByElement.get(jn);Ve&&Ve.length&&(pe.parentPlayer=$f(Ve)),u.push(pe)}}else xg(fe,Pe.fromStyles),pe.onDestroy(()=>Nu(fe,Pe.toStyles)),Zi.push(pe),A.has(fe)&&u.push(pe)}),Zi.forEach(Ht=>{const fe=f.get(Ht.element);if(fe&&fe.length){const pe=$f(fe);Ht.setRealPlayer(pe)}}),u.forEach(Ht=>{Ht.parentPlayer?Ht.syncPlayerEvents(Ht.parentPlayer):Ht.destroy()});for(let Ht=0;Ht<ut.length;Ht++){const fe=ut[Ht],pe=fe[Uc];if(Bv(fe,MD),pe&&pe.hasAnimation)continue;let Pe=[];if(x.size){let fi=x.get(fe);fi&&fi.length&&Pe.push(...fi);let Ve=this.driver.query(fe,_O,!0);for(let sr=0;sr<Ve.length;sr++){let vn=x.get(Ve[sr]);vn&&vn.length&&Pe.push(...vn)}}const jn=Pe.filter(fi=>!fi.destroyed);jn.length?g6(this,fe,jn):this.processLeaveNode(fe)}return ut.length=0,Vi.forEach(Ht=>{this.players.push(Ht),Ht.onDone(()=>{Ht.destroy();const fe=this.players.indexOf(Ht);this.players.splice(fe,1)}),Ht.play()}),Vi}afterFlush(o){this._flushFns.push(o)}afterFlushAnimationsDone(o){this._whenQuietFns.push(o)}_getPreviousPlayers(o,i,a,u,f){let g=[];if(i){const x=this.playersByQueriedElement.get(o);x&&(g=x)}else{const x=this.playersByElement.get(o);if(x){const w=!f||f==bw;x.forEach(T=>{T.queued||!w&&T.triggerName!=u||g.push(T)})}}return(a||u)&&(g=g.filter(x=>!(a&&a!=x.namespaceId||u&&u!=x.triggerName))),g}_beforeAnimationBuild(o,i,a){const f=i.element,g=i.isRemovalTransition?void 0:o,x=i.isRemovalTransition?void 0:i.triggerName;for(const w of i.timelines){const T=w.element,A=T!==f,k=cl(a,T,[]);this._getPreviousPlayers(T,A,g,x,i.toState).forEach(G=>{const K=G.getRealPlayer();K.beforeDestroy&&K.beforeDestroy(),G.destroy(),k.push(G)})}xg(f,i.fromStyles)}_buildAnimation(o,i,a,u,f,g){const x=i.triggerName,w=i.element,T=[],A=new Set,k=new Set,B=i.timelines.map(K=>{const et=K.element;A.add(et);const ut=et[Uc];if(ut&&ut.removedBeforeQueried)return new _w(K.duration,K.delay);const _t=et!==w,pt=function _6(e){const o=[];return kN(e,o),o}((a.get(et)||c6).map(Te=>Te.getRealPlayer())).filter(Te=>!!Te.element&&Te.element===et),Ft=f.get(et),Zt=g.get(et),de=uN(this._normalizer,K.keyframes,Ft,Zt),oe=this._buildPlayer(K,de,pt);if(K.subTimeline&&u&&k.add(et),_t){const Te=new RO(o,x,et);Te.setRealPlayer(oe),T.push(Te)}return oe});T.forEach(K=>{cl(this.playersByQueriedElement,K.element,[]).push(K),K.onDone(()=>function f6(e,o,i){let a=e.get(o);if(a){if(a.length){const u=a.indexOf(i);a.splice(u,1)}0==a.length&&e.delete(o)}return a}(this.playersByQueriedElement,K.element,K))}),A.forEach(K=>Ql(K,_N));const G=$f(B);return G.onDestroy(()=>{A.forEach(K=>Bv(K,_N)),Nu(w,i.toStyles)}),k.forEach(K=>{cl(u,K,[]).push(G)}),G}_buildPlayer(o,i,a){return i.length>0?this.driver.animate(o.element,i,o.duration,o.delay,o.easing,a):new _w(o.duration,o.delay)}}class RO{constructor(o,i,a){this.namespaceId=o,this.triggerName=i,this.element=a,this._player=new _w,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(o){this._containsRealPlayer||(this._player=o,this._queuedCallbacks.forEach((i,a)=>{i.forEach(u=>dO(o,a,void 0,u))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(o.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(o){this.totalTime=o}syncPlayerEvents(o){const i=this._player;i.triggerCallback&&o.onStart(()=>i.triggerCallback("start")),o.onDone(()=>this.finish()),o.onDestroy(()=>this.destroy())}_queueEvent(o,i){cl(this._queuedCallbacks,o,[]).push(i)}onDone(o){this.queued&&this._queueEvent("done",o),this._player.onDone(o)}onStart(o){this.queued&&this._queueEvent("start",o),this._player.onStart(o)}onDestroy(o){this.queued&&this._queueEvent("destroy",o),this._player.onDestroy(o)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(o){this.queued||this._player.setPosition(o)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(o){const i=this._player;i.triggerCallback&&i.triggerCallback(o)}}function LD(e){return e&&1===e.nodeType}function RN(e,o){const i=e.style.display;return e.style.display=o??"none",i}function PN(e,o,i,a,u){const f=[];i.forEach(w=>f.push(RN(w)));const g=[];a.forEach((w,T)=>{const A=new Map;w.forEach(k=>{const B=o.computeStyle(T,k,u);A.set(k,B),(!B||0==B.length)&&(T[Uc]=u6,g.push(T))}),e.set(T,A)});let x=0;return i.forEach(w=>RN(w,f[x++])),g}function ON(e,o){const i=new Map;if(e.forEach(x=>i.set(x,[])),0==o.length)return i;const u=new Set(o),f=new Map;function g(x){if(!x)return 1;let w=f.get(x);if(w)return w;const T=x.parentNode;return w=i.has(T)?T:u.has(T)?1:g(T),f.set(x,w),w}return o.forEach(x=>{const w=g(x);1!==w&&i.get(w).push(x)}),i}function Ql(e,o){e.classList?.add(o)}function Bv(e,o){e.classList?.remove(o)}function g6(e,o,i){$f(i).onDone(()=>e.processLeaveNode(o))}function kN(e,o){for(let i=0;i<e.length;i++){const a=e[i];a instanceof lN?kN(a.players,o):o.push(a)}}function FN(e,o,i){const a=i.get(e);if(!a)return!1;let u=o.get(e);return u?a.forEach(f=>u.add(f)):o.set(e,a),i.delete(e),!0}class ND{constructor(o,i,a){this.bodyNode=o,this._driver=i,this._normalizer=a,this._triggerCache={},this.onRemovalComplete=(u,f)=>{},this._transitionEngine=new h6(o,i,a),this._timelineEngine=new r6(o,i,a),this._transitionEngine.onRemovalComplete=(u,f)=>this.onRemovalComplete(u,f)}registerTrigger(o,i,a,u,f){const g=o+"-"+u;let x=this._triggerCache[g];if(!x){const w=[],A=bO(this._driver,f,w,[]);if(w.length)throw function sU(e,o){return new at(3404,!1)}();x=function t6(e,o,i){return new e6(e,o,i)}(u,A,this._normalizer),this._triggerCache[g]=x}this._transitionEngine.registerTrigger(i,u,x)}register(o,i){this._transitionEngine.register(o,i)}destroy(o,i){this._transitionEngine.destroy(o,i)}onInsert(o,i,a,u){this._transitionEngine.insertNode(o,i,a,u)}onRemove(o,i,a){this._transitionEngine.removeNode(o,i,a)}disableAnimations(o,i){this._transitionEngine.markElementAsDisabled(o,i)}process(o,i,a,u){if("@"==a.charAt(0)){const[f,g]=dN(a);this._timelineEngine.command(f,i,g,u)}else this._transitionEngine.trigger(o,i,a,u)}listen(o,i,a,u,f){if("@"==a.charAt(0)){const[g,x]=dN(a);return this._timelineEngine.listen(g,i,x,f)}return this._transitionEngine.listen(o,i,a,u,f)}flush(o=-1){this._transitionEngine.flush(o)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(o){this._transitionEngine.afterFlushAnimationsDone(o)}}let x6=(()=>{class e{static#t=this.initialStylesByElement=new WeakMap;constructor(i,a,u){this._element=i,this._startStyles=a,this._endStyles=u,this._state=0;let f=e.initialStylesByElement.get(i);f||e.initialStylesByElement.set(i,f=new Map),this._initialStyles=f}start(){this._state<1&&(this._startStyles&&Nu(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Nu(this._element,this._initialStyles),this._endStyles&&(Nu(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(xg(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(xg(this._element,this._endStyles),this._endStyles=null),Nu(this._element,this._initialStyles),this._state=3)}}return e})();function PO(e){let o=null;return e.forEach((i,a)=>{(function b6(e){return"display"===e||"position"===e})(a)&&(o=o||new Map,o.set(a,i))}),o}class LN{constructor(o,i,a,u){this.element=o,this.keyframes=i,this.options=a,this._specialStyles=u,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=a.duration,this._delay=a.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(o=>o()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const o=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,o,this.options),this._finalKeyframe=o.length?o[o.length-1]:new Map;const i=()=>this._onFinish();this.domPlayer.addEventListener("finish",i),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",i)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(o){const i=[];return o.forEach(a=>{i.push(Object.fromEntries(a))}),i}_triggerWebAnimation(o,i,a){return o.animate(this._convertKeyframesToObject(i),a)}onStart(o){this._originalOnStartFns.push(o),this._onStartFns.push(o)}onDone(o){this._originalOnDoneFns.push(o),this._onDoneFns.push(o)}onDestroy(o){this._onDestroyFns.push(o)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(o=>o()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(o=>o()),this._onDestroyFns=[])}setPosition(o){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=o*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const o=new Map;this.hasStarted()&&this._finalKeyframe.forEach((a,u)=>{"offset"!==u&&o.set(u,this._finished?a:bN(this.element,u))}),this.currentSnapshot=o}triggerCallback(o){const i="start"===o?this._onStartFns:this._onDoneFns;i.forEach(a=>a()),i.length=0}}class w6{validateStyleProperty(o){return!0}validateAnimatableStyleProperty(o){return!0}matchesElement(o,i){return!1}containsElement(o,i){return fN(o,i)}getParentElement(o){return pO(o)}query(o,i,a){return pN(o,i,a)}computeStyle(o,i,a){return window.getComputedStyle(o)[i]}animate(o,i,a,u,f,g=[]){const w={duration:a,delay:u,fill:0==u?"both":"forwards"};f&&(w.easing=f);const T=new Map,A=g.filter(G=>G instanceof LN);(function IU(e,o){return 0===e||0===o})(a,u)&&A.forEach(G=>{G.currentSnapshot.forEach((K,et)=>T.set(et,K))});let k=function SU(e){return e.length?e[0]instanceof Map?e:e.map(o=>yN(o)):[]}(i).map(G=>Hf(G));k=function AU(e,o,i){if(i.size&&o.length){let a=o[0],u=[];if(i.forEach((f,g)=>{a.has(g)||u.push(g),a.set(g,f)}),u.length)for(let f=1;f<o.length;f++){let g=o[f];u.forEach(x=>g.set(x,bN(e,x)))}}return o}(o,k,T);const B=function v6(e,o){let i=null,a=null;return Array.isArray(o)&&o.length?(i=PO(o[0]),o.length>1&&(a=PO(o[o.length-1]))):o instanceof Map&&(i=PO(o)),i||a?new x6(e,i,a):null}(o,k);return new LN(o,k,w,B)}}let E6=(()=>{class e extends oN{constructor(i,a){super(),this._nextAnimationId=0,this._renderer=i.createRenderer(a.body,{id:"0",encapsulation:Vo.None,styles:[],data:{animation:[]}})}build(i){const a=this._nextAnimationId.toString();this._nextAnimationId++;const u=Array.isArray(i)?sN(i):i;return NN(this._renderer,null,a,"register",[u]),new C6(a,this._renderer)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(hm),bt(Qn))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();class C6 extends Lj{constructor(o,i){super(),this._id=o,this._renderer=i}create(o,i){return new M6(this._id,o,i||{},this._renderer)}}class M6{constructor(o,i,a,u){this.id=o,this.element=i,this._renderer=u,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",a)}_listen(o,i){return this._renderer.listen(this.element,`@@${this.id}:${o}`,i)}_command(o,...i){return NN(this._renderer,this.element,this.id,o,i)}onDone(o){this._listen("done",o)}onStart(o){this._listen("start",o)}onDestroy(o){this._listen("destroy",o)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(o){this._command("setPosition",o)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function NN(e,o,i,a,u){return e.setProperty(o,`@@${i}:${a}`,u)}const zN="@.disabled";let S6=(()=>{class e{constructor(i,a,u){this.delegate=i,this.engine=a,this._zone=u,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,a.onRemovalComplete=(f,g)=>{const x=g?.parentNode(f);x&&g.removeChild(x,f)}}createRenderer(i,a){const f=this.delegate.createRenderer(i,a);if(!(i&&a&&a.data&&a.data.animation)){let A=this._rendererCache.get(f);return A||(A=new BN("",f,this.engine,()=>this._rendererCache.delete(f)),this._rendererCache.set(f,A)),A}const g=a.id,x=a.id+"-"+this._currentId;this._currentId++,this.engine.register(x,i);const w=A=>{Array.isArray(A)?A.forEach(w):this.engine.registerTrigger(g,x,i,A.name,A)};return a.data.animation.forEach(w),new T6(this,x,f,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,a,u){i>=0&&i<this._microtaskId?this._zone.run(()=>a(u)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(f=>{const[g,x]=f;g(x)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([a,u]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}static#t=this.\u0275fac=function(a){return new(a||e)(bt(hm),bt(ND),bt(Je))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();class BN{constructor(o,i,a,u){this.namespaceId=o,this.delegate=i,this.engine=a,this._onDestroy=u}get data(){return this.delegate.data}destroyNode(o){this.delegate.destroyNode?.(o)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(o,i){return this.delegate.createElement(o,i)}createComment(o){return this.delegate.createComment(o)}createText(o){return this.delegate.createText(o)}appendChild(o,i){this.delegate.appendChild(o,i),this.engine.onInsert(this.namespaceId,i,o,!1)}insertBefore(o,i,a,u=!0){this.delegate.insertBefore(o,i,a),this.engine.onInsert(this.namespaceId,i,o,u)}removeChild(o,i,a){this.engine.onRemove(this.namespaceId,i,this.delegate)}selectRootElement(o,i){return this.delegate.selectRootElement(o,i)}parentNode(o){return this.delegate.parentNode(o)}nextSibling(o){return this.delegate.nextSibling(o)}setAttribute(o,i,a,u){this.delegate.setAttribute(o,i,a,u)}removeAttribute(o,i,a){this.delegate.removeAttribute(o,i,a)}addClass(o,i){this.delegate.addClass(o,i)}removeClass(o,i){this.delegate.removeClass(o,i)}setStyle(o,i,a,u){this.delegate.setStyle(o,i,a,u)}removeStyle(o,i,a){this.delegate.removeStyle(o,i,a)}setProperty(o,i,a){"@"==i.charAt(0)&&i==zN?this.disableAnimations(o,!!a):this.delegate.setProperty(o,i,a)}setValue(o,i){this.delegate.setValue(o,i)}listen(o,i,a){return this.delegate.listen(o,i,a)}disableAnimations(o,i){this.engine.disableAnimations(o,i)}}class T6 extends BN{constructor(o,i,a,u,f){super(i,a,u,f),this.factory=o,this.namespaceId=i}setProperty(o,i,a){"@"==i.charAt(0)?"."==i.charAt(1)&&i==zN?this.disableAnimations(o,a=void 0===a||!!a):this.engine.process(this.namespaceId,o,i.slice(1),a):this.delegate.setProperty(o,i,a)}listen(o,i,a){if("@"==i.charAt(0)){const u=function D6(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(o);let f=i.slice(1),g="";return"@"!=f.charAt(0)&&([f,g]=function I6(e){const o=e.indexOf(".");return[e.substring(0,o),e.slice(o+1)]}(f)),this.engine.listen(this.namespaceId,u,f,g,x=>{this.factory.scheduleListenerCallback(x._data||-1,a,x)})}return this.delegate.listen(o,i,a)}}const VN=[{provide:oN,useClass:E6},{provide:SO,useFactory:function R6(){return new YU}},{provide:ND,useClass:(()=>{class e extends ND{constructor(i,a,u,f){super(i.body,a,u)}ngOnDestroy(){this.flush()}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn),bt(mO),bt(SO),bt(ct))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})()},{provide:hm,useFactory:function P6(e,o,i){return new S6(e,o,i)},deps:[iO,ND,Je]}],OO=[{provide:mO,useFactory:()=>new w6},{provide:yu,useValue:"BrowserAnimations"},...VN],jN=[{provide:mO,useClass:mN},{provide:yu,useValue:"NoopAnimations"},...VN];let O6=(()=>{class e{static withConfig(i){return{ngModule:e,providers:i.disableAnimations?jN:OO}}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({providers:OO,imports:[QL]})}return e})();function Vv(e,o){return Gn(o)?pr(e,o,1):pr(e,1)}function Rs(e,o){return ar((i,a)=>{let u=0;i.subscribe(Ti(a,f=>e.call(o,f,u++)&&a.next(f)))})}function jv(e){return ar((o,i)=>{try{o.subscribe(i)}finally{i.add(e)}})}class BD{}class VD{}class zu{constructor(o){this.normalizedNames=new Map,this.lazyUpdate=null,o?"string"==typeof o?this.lazyInit=()=>{this.headers=new Map,o.split("\n").forEach(i=>{const a=i.indexOf(":");if(a>0){const u=i.slice(0,a),f=u.toLowerCase(),g=i.slice(a+1).trim();this.maybeSetNormalizedName(u,f),this.headers.has(f)?this.headers.get(f).push(g):this.headers.set(f,[g])}})}:typeof Headers<"u"&&o instanceof Headers?(this.headers=new Map,o.forEach((i,a)=>{this.setHeaderEntries(a,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(o).forEach(([i,a])=>{this.setHeaderEntries(i,a)})}:this.headers=new Map}has(o){return this.init(),this.headers.has(o.toLowerCase())}get(o){this.init();const i=this.headers.get(o.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(o){return this.init(),this.headers.get(o.toLowerCase())||null}append(o,i){return this.clone({name:o,value:i,op:"a"})}set(o,i){return this.clone({name:o,value:i,op:"s"})}delete(o,i){return this.clone({name:o,value:i,op:"d"})}maybeSetNormalizedName(o,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,o)}init(){this.lazyInit&&(this.lazyInit instanceof zu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(o=>this.applyUpdate(o)),this.lazyUpdate=null))}copyFrom(o){o.init(),Array.from(o.headers.keys()).forEach(i=>{this.headers.set(i,o.headers.get(i)),this.normalizedNames.set(i,o.normalizedNames.get(i))})}clone(o){const i=new zu;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof zu?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([o]),i}applyUpdate(o){const i=o.name.toLowerCase();switch(o.op){case"a":case"s":let a=o.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(o.name,i);const u=("a"===o.op?this.headers.get(i):void 0)||[];u.push(...a),this.headers.set(i,u);break;case"d":const f=o.value;if(f){let g=this.headers.get(i);if(!g)return;g=g.filter(x=>-1===f.indexOf(x)),0===g.length?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,g)}else this.headers.delete(i),this.normalizedNames.delete(i)}}setHeaderEntries(o,i){const a=(Array.isArray(i)?i:[i]).map(f=>f.toString()),u=o.toLowerCase();this.headers.set(u,a),this.maybeSetNormalizedName(o,u)}forEach(o){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>o(this.normalizedNames.get(i),this.headers.get(i)))}}class k6{encodeKey(o){return UN(o)}encodeValue(o){return UN(o)}decodeKey(o){return decodeURIComponent(o)}decodeValue(o){return decodeURIComponent(o)}}const L6=/%(\d[a-f0-9])/gi,N6={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function UN(e){return encodeURIComponent(e).replace(L6,(o,i)=>N6[i]??o)}function jD(e){return`${e}`}class Gf{constructor(o={}){if(this.updates=null,this.cloneFrom=null,this.encoder=o.encoder||new k6,o.fromString){if(o.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function F6(e,o){const i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(u=>{const f=u.indexOf("="),[g,x]=-1==f?[o.decodeKey(u),""]:[o.decodeKey(u.slice(0,f)),o.decodeValue(u.slice(f+1))],w=i.get(g)||[];w.push(x),i.set(g,w)}),i}(o.fromString,this.encoder)}else o.fromObject?(this.map=new Map,Object.keys(o.fromObject).forEach(i=>{const a=o.fromObject[i],u=Array.isArray(a)?a.map(jD):[jD(a)];this.map.set(i,u)})):this.map=null}has(o){return this.init(),this.map.has(o)}get(o){this.init();const i=this.map.get(o);return i?i[0]:null}getAll(o){return this.init(),this.map.get(o)||null}keys(){return this.init(),Array.from(this.map.keys())}append(o,i){return this.clone({param:o,value:i,op:"a"})}appendAll(o){const i=[];return Object.keys(o).forEach(a=>{const u=o[a];Array.isArray(u)?u.forEach(f=>{i.push({param:a,value:f,op:"a"})}):i.push({param:a,value:u,op:"a"})}),this.clone(i)}set(o,i){return this.clone({param:o,value:i,op:"s"})}delete(o,i){return this.clone({param:o,value:i,op:"d"})}toString(){return this.init(),this.keys().map(o=>{const i=this.encoder.encodeKey(o);return this.map.get(o).map(a=>i+"="+this.encoder.encodeValue(a)).join("&")}).filter(o=>""!==o).join("&")}clone(o){const i=new Gf({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(o),i}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(o=>this.map.set(o,this.cloneFrom.map.get(o))),this.updates.forEach(o=>{switch(o.op){case"a":case"s":const i=("a"===o.op?this.map.get(o.param):void 0)||[];i.push(jD(o.value)),this.map.set(o.param,i);break;case"d":if(void 0===o.value){this.map.delete(o.param);break}{let a=this.map.get(o.param)||[];const u=a.indexOf(jD(o.value));-1!==u&&a.splice(u,1),a.length>0?this.map.set(o.param,a):this.map.delete(o.param)}}}),this.cloneFrom=this.updates=null)}}class z6{constructor(){this.map=new Map}set(o,i){return this.map.set(o,i),this}get(o){return this.map.has(o)||this.map.set(o,o.defaultValue()),this.map.get(o)}delete(o){return this.map.delete(o),this}has(o){return this.map.has(o)}keys(){return this.map.keys()}}function $N(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function HN(e){return typeof Blob<"u"&&e instanceof Blob}function GN(e){return typeof FormData<"u"&&e instanceof FormData}class ww{constructor(o,i,a,u){let f;if(this.url=i,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=o.toUpperCase(),function B6(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||u?(this.body=void 0!==a?a:null,f=u):f=a,f&&(this.reportProgress=!!f.reportProgress,this.withCredentials=!!f.withCredentials,f.responseType&&(this.responseType=f.responseType),f.headers&&(this.headers=f.headers),f.context&&(this.context=f.context),f.params&&(this.params=f.params)),this.headers||(this.headers=new zu),this.context||(this.context=new z6),this.params){const g=this.params.toString();if(0===g.length)this.urlWithParams=i;else{const x=i.indexOf("?");this.urlWithParams=i+(-1===x?"?":x<i.length-1?"&":"")+g}}else this.params=new Gf,this.urlWithParams=i}serializeBody(){return null===this.body?null:$N(this.body)||HN(this.body)||GN(this.body)||function V6(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Gf?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||GN(this.body)?null:HN(this.body)?this.body.type||null:$N(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Gf?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(o={}){const i=o.method||this.method,a=o.url||this.url,u=o.responseType||this.responseType,f=void 0!==o.body?o.body:this.body,g=void 0!==o.withCredentials?o.withCredentials:this.withCredentials,x=void 0!==o.reportProgress?o.reportProgress:this.reportProgress;let w=o.headers||this.headers,T=o.params||this.params;const A=o.context??this.context;return void 0!==o.setHeaders&&(w=Object.keys(o.setHeaders).reduce((k,B)=>k.set(B,o.setHeaders[B]),w)),o.setParams&&(T=Object.keys(o.setParams).reduce((k,B)=>k.set(B,o.setParams[B]),T)),new ww(i,a,f,{params:T,headers:w,context:A,reportProgress:x,responseType:u,withCredentials:g})}}var Uv=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Uv||{});class kO{constructor(o,i=200,a="OK"){this.headers=o.headers||new zu,this.status=void 0!==o.status?o.status:i,this.statusText=o.statusText||a,this.url=o.url||null,this.ok=this.status>=200&&this.status<300}}class FO extends kO{constructor(o={}){super(o),this.type=Uv.ResponseHeader}clone(o={}){return new FO({headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class $v extends kO{constructor(o={}){super(o),this.type=Uv.Response,this.body=void 0!==o.body?o.body:null}clone(o={}){return new $v({body:void 0!==o.body?o.body:this.body,headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class qN extends kO{constructor(o){super(o,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${o.url||"(unknown url)"}`:`Http failure response for ${o.url||"(unknown url)"}: ${o.status} ${o.statusText}`,this.error=o.error||null}}function LO(e,o){return{body:o,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let UD=(()=>{class e{constructor(i){this.handler=i}request(i,a,u={}){let f;if(i instanceof ww)f=i;else{let w,T;w=u.headers instanceof zu?u.headers:new zu(u.headers),u.params&&(T=u.params instanceof Gf?u.params:new Gf({fromObject:u.params})),f=new ww(i,a,void 0!==u.body?u.body:null,{headers:w,context:u.context,params:T,reportProgress:u.reportProgress,responseType:u.responseType||"json",withCredentials:u.withCredentials})}const g=kt(f).pipe(Vv(w=>this.handler.handle(w)));if(i instanceof ww||"events"===u.observe)return g;const x=g.pipe(Rs(w=>w instanceof $v));switch(u.observe||"body"){case"body":switch(f.responseType){case"arraybuffer":return x.pipe(cn(w=>{if(null!==w.body&&!(w.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return w.body}));case"blob":return x.pipe(cn(w=>{if(null!==w.body&&!(w.body instanceof Blob))throw new Error("Response is not a Blob.");return w.body}));case"text":return x.pipe(cn(w=>{if(null!==w.body&&"string"!=typeof w.body)throw new Error("Response is not a string.");return w.body}));default:return x.pipe(cn(w=>w.body))}case"response":return x;default:throw new Error(`Unreachable: unhandled observe type ${u.observe}}`)}}delete(i,a={}){return this.request("DELETE",i,a)}get(i,a={}){return this.request("GET",i,a)}head(i,a={}){return this.request("HEAD",i,a)}jsonp(i,a){return this.request("JSONP",i,{params:(new Gf).append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(i,a={}){return this.request("OPTIONS",i,a)}patch(i,a,u={}){return this.request("PATCH",i,LO(u,a))}post(i,a,u={}){return this.request("POST",i,LO(u,a))}put(i,a,u={}){return this.request("PUT",i,LO(u,a))}static#t=this.\u0275fac=function(a){return new(a||e)(bt(BD))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();function XN(e,o){return o(e)}function U6(e,o){return(i,a)=>o.intercept(i,{handle:u=>e(u,a)})}const H6=new Gt(""),Ew=new Gt(""),YN=new Gt("");function G6(){let e=null;return(o,i)=>{null===e&&(e=(ee(H6,{optional:!0})??[]).reduceRight(U6,XN));const a=ee(Ld),u=a.add();return e(o,i).pipe(jv(()=>a.remove(u)))}}let KN=(()=>{class e extends BD{constructor(i,a){super(),this.backend=i,this.injector=a,this.chain=null,this.pendingTasks=ee(Ld)}handle(i){if(null===this.chain){const u=Array.from(new Set([...this.injector.get(Ew),...this.injector.get(YN,[])]));this.chain=u.reduceRight((f,g)=>function $6(e,o,i){return(a,u)=>i.runInContext(()=>o(a,f=>e(f,u)))}(f,g,this.injector),XN)}const a=this.pendingTasks.add();return this.chain(i,u=>this.backend.handle(u)).pipe(jv(()=>this.pendingTasks.remove(a)))}static#t=this.\u0275fac=function(a){return new(a||e)(bt(VD),bt(Ss))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();const X6=/^\)\]\}',?\n/;let QN=(()=>{class e{constructor(i){this.xhrFactory=i}handle(i){if("JSONP"===i.method)throw new at(-2800,!1);const a=this.xhrFactory;return(a.\u0275loadImpl?Ar(a.\u0275loadImpl()):kt(null)).pipe(Hr(()=>new $n(f=>{const g=a.build();if(g.open(i.method,i.urlWithParams),i.withCredentials&&(g.withCredentials=!0),i.headers.forEach((et,ut)=>g.setRequestHeader(et,ut.join(","))),i.headers.has("Accept")||g.setRequestHeader("Accept","application/json, text/plain, */*"),!i.headers.has("Content-Type")){const et=i.detectContentTypeHeader();null!==et&&g.setRequestHeader("Content-Type",et)}if(i.responseType){const et=i.responseType.toLowerCase();g.responseType="json"!==et?et:"text"}const x=i.serializeBody();let w=null;const T=()=>{if(null!==w)return w;const et=g.statusText||"OK",ut=new zu(g.getAllResponseHeaders()),_t=function Y6(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(g)||i.url;return w=new FO({headers:ut,status:g.status,statusText:et,url:_t}),w},A=()=>{let{headers:et,status:ut,statusText:_t,url:pt}=T(),Ft=null;204!==ut&&(Ft=typeof g.response>"u"?g.responseText:g.response),0===ut&&(ut=Ft?200:0);let Zt=ut>=200&&ut<300;if("json"===i.responseType&&"string"==typeof Ft){const de=Ft;Ft=Ft.replace(X6,"");try{Ft=""!==Ft?JSON.parse(Ft):null}catch(oe){Ft=de,Zt&&(Zt=!1,Ft={error:oe,text:Ft})}}Zt?(f.next(new $v({body:Ft,headers:et,status:ut,statusText:_t,url:pt||void 0})),f.complete()):f.error(new qN({error:Ft,headers:et,status:ut,statusText:_t,url:pt||void 0}))},k=et=>{const{url:ut}=T(),_t=new qN({error:et,status:g.status||0,statusText:g.statusText||"Unknown Error",url:ut||void 0});f.error(_t)};let B=!1;const G=et=>{B||(f.next(T()),B=!0);let ut={type:Uv.DownloadProgress,loaded:et.loaded};et.lengthComputable&&(ut.total=et.total),"text"===i.responseType&&g.responseText&&(ut.partialText=g.responseText),f.next(ut)},K=et=>{let ut={type:Uv.UploadProgress,loaded:et.loaded};et.lengthComputable&&(ut.total=et.total),f.next(ut)};return g.addEventListener("load",A),g.addEventListener("error",k),g.addEventListener("timeout",k),g.addEventListener("abort",k),i.reportProgress&&(g.addEventListener("progress",G),null!==x&&g.upload&&g.upload.addEventListener("progress",K)),g.send(x),f.next({type:Uv.Sent}),()=>{g.removeEventListener("error",k),g.removeEventListener("abort",k),g.removeEventListener("load",A),g.removeEventListener("timeout",k),i.reportProgress&&(g.removeEventListener("progress",G),null!==x&&g.upload&&g.upload.removeEventListener("progress",K)),g.readyState!==g.DONE&&g.abort()}})))}static#t=this.\u0275fac=function(a){return new(a||e)(bt(LL))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();const NO=new Gt("XSRF_ENABLED"),t3=new Gt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),e3=new Gt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class n3{}let Q6=(()=>{class e{constructor(i,a,u){this.doc=i,this.platform=a,this.cookieName=u,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const i=this.doc.cookie||"";return i!==this.lastCookieString&&(this.parseCount++,this.lastToken=CL(i,this.cookieName),this.lastCookieString=i),this.lastToken}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn),bt(qa),bt(t3))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();function t8(e,o){const i=e.url.toLowerCase();if(!ee(NO)||"GET"===e.method||"HEAD"===e.method||i.startsWith("http://")||i.startsWith("https://"))return o(e);const a=ee(n3).getToken(),u=ee(e3);return null!=a&&!e.headers.has(u)&&(e=e.clone({headers:e.headers.set(u,a)})),o(e)}var qf=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(qf||{});function e8(...e){const o=[UD,QN,KN,{provide:BD,useExisting:KN},{provide:VD,useExisting:QN},{provide:Ew,useValue:t8,multi:!0},{provide:NO,useValue:!0},{provide:n3,useClass:Q6}];for(const i of e)o.push(...i.\u0275providers);return function zx(e){return{\u0275providers:e}}(o)}const i3=new Gt("LEGACY_INTERCEPTOR_FN");function n8(){return function wg(e,o){return{\u0275kind:e,\u0275providers:o}}(qf.LegacyInterceptors,[{provide:i3,useFactory:G6},{provide:Ew,useExisting:i3,multi:!0}])}let i8=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({providers:[e8(n8())]})}return e})();const{isArray:c8}=Array,{getPrototypeOf:u8,prototype:d8,keys:h8}=Object;function r3(e){if(1===e.length){const o=e[0];if(c8(o))return{args:o,keys:null};if(function f8(e){return e&&"object"==typeof e&&u8(e)===d8}(o)){const i=h8(o);return{args:i.map(a=>o[a]),keys:i}}}return{args:e,keys:null}}const{isArray:p8}=Array;function zO(e){return cn(o=>function m8(e,o){return p8(o)?e(...o):e(o)}(e,o))}function o3(e,o){return e.reduce((i,a,u)=>(i[a]=o[u],i),{})}let a3=(()=>{class e{constructor(i,a){this._renderer=i,this._elementRef=a,this.onChange=u=>{},this.onTouched=()=>{}}setProperty(i,a){this._renderer.setProperty(this._elementRef.nativeElement,i,a)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Tc),xt(Gi))};static#e=this.\u0275dir=Ee({type:e})}return e})(),Eg=(()=>{class e extends a3{static#t=this.\u0275fac=function(){let i;return function(u){return(i||(i=vr(e)))(u||e)}}();static#e=this.\u0275dir=Ee({type:e,features:[Wn]})}return e})();const Bu=new Gt("NgValueAccessor"),_8={provide:Bu,useExisting:Di(()=>BO),multi:!0},v8=new Gt("CompositionEventMode");let BO=(()=>{class e extends a3{constructor(i,a,u){super(i,a),this._compositionMode=u,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function y8(){const e=jf()?jf().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(i){this.setProperty("value",i??"")}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Tc),xt(Gi),xt(v8,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(a,u){1&a&&Fr("input",function(g){return u._handleInput(g.target.value)})("blur",function(){return u.onTouched()})("compositionstart",function(){return u._compositionStart()})("compositionend",function(g){return u._compositionEnd(g.target.value)})},features:[Ji([_8]),Wn]})}return e})();function Wf(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function c3(e){return null!=e&&"number"==typeof e.length}const Ps=new Gt("NgValidators"),Zf=new Gt("NgAsyncValidators"),x8=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class b8{static min(o){return function u3(e){return o=>{if(Wf(o.value)||Wf(e))return null;const i=parseFloat(o.value);return!isNaN(i)&&i<e?{min:{min:e,actual:o.value}}:null}}(o)}static max(o){return function d3(e){return o=>{if(Wf(o.value)||Wf(e))return null;const i=parseFloat(o.value);return!isNaN(i)&&i>e?{max:{max:e,actual:o.value}}:null}}(o)}static required(o){return function h3(e){return Wf(e.value)?{required:!0}:null}(o)}static requiredTrue(o){return function f3(e){return!0===e.value?null:{required:!0}}(o)}static email(o){return function p3(e){return Wf(e.value)||x8.test(e.value)?null:{email:!0}}(o)}static minLength(o){return function m3(e){return o=>Wf(o.value)||!c3(o.value)?null:o.value.length<e?{minlength:{requiredLength:e,actualLength:o.value.length}}:null}(o)}static maxLength(o){return function g3(e){return o=>c3(o.value)&&o.value.length>e?{maxlength:{requiredLength:e,actualLength:o.value.length}}:null}(o)}static pattern(o){return function _3(e){if(!e)return HD;let o,i;return"string"==typeof e?(i="","^"!==e.charAt(0)&&(i+="^"),i+=e,"$"!==e.charAt(e.length-1)&&(i+="$"),o=new RegExp(i)):(i=e.toString(),o=e),a=>{if(Wf(a.value))return null;const u=a.value;return o.test(u)?null:{pattern:{requiredPattern:i,actualValue:u}}}}(o)}static nullValidator(o){return null}static compose(o){return E3(o)}static composeAsync(o){return C3(o)}}function HD(e){return null}function y3(e){return null!=e}function v3(e){return wf(e)?Ar(e):e}function x3(e){let o={};return e.forEach(i=>{o=null!=i?{...o,...i}:o}),0===Object.keys(o).length?null:o}function b3(e,o){return o.map(i=>i(e))}function w3(e){return e.map(o=>function w8(e){return!e.validate}(o)?o:i=>o.validate(i))}function E3(e){if(!e)return null;const o=e.filter(y3);return 0==o.length?null:function(i){return x3(b3(i,o))}}function VO(e){return null!=e?E3(w3(e)):null}function C3(e){if(!e)return null;const o=e.filter(y3);return 0==o.length?null:function(i){return function s3(...e){const o=oE(e),{args:i,keys:a}=r3(e),u=new $n(f=>{const{length:g}=i;if(!g)return void f.complete();const x=new Array(g);let w=g,T=g;for(let A=0;A<g;A++){let k=!1;bn(i[A]).subscribe(Ti(f,B=>{k||(k=!0,T--),x[A]=B},()=>w--,void 0,()=>{(!w||!k)&&(T||f.next(a?o3(a,x):x),f.complete())}))}});return o?u.pipe(zO(o)):u}(b3(i,o).map(v3)).pipe(cn(x3))}}function jO(e){return null!=e?C3(w3(e)):null}function M3(e,o){return null===e?[o]:Array.isArray(e)?[...e,o]:[e,o]}function S3(e){return e._rawValidators}function T3(e){return e._rawAsyncValidators}function UO(e){return e?Array.isArray(e)?e:[e]:[]}function GD(e,o){return Array.isArray(e)?e.includes(o):e===o}function D3(e,o){const i=UO(o);return UO(e).forEach(u=>{GD(i,u)||i.push(u)}),i}function I3(e,o){return UO(o).filter(i=>!GD(e,i))}class A3{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(o){this._rawValidators=o||[],this._composedValidatorFn=VO(this._rawValidators)}_setAsyncValidators(o){this._rawAsyncValidators=o||[],this._composedAsyncValidatorFn=jO(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(o){this._onDestroyCallbacks.push(o)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(o=>o()),this._onDestroyCallbacks=[]}reset(o=void 0){this.control&&this.control.reset(o)}hasError(o,i){return!!this.control&&this.control.hasError(o,i)}getError(o,i){return this.control?this.control.getError(o,i):null}}class na extends A3{get formDirective(){return null}get path(){return null}}class Gd extends A3{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class R3{constructor(o){this._cd=o}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let P3=(()=>{class e extends R3{constructor(i){super(i)}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gd,2))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(a,u){2&a&&Vr("ng-untouched",u.isUntouched)("ng-touched",u.isTouched)("ng-pristine",u.isPristine)("ng-dirty",u.isDirty)("ng-valid",u.isValid)("ng-invalid",u.isInvalid)("ng-pending",u.isPending)},features:[Wn]})}return e})();const Cw="VALID",WD="INVALID",Hv="PENDING",Mw="DISABLED";function GO(e){return(ZD(e)?e.validators:e)||null}function qO(e,o){return(ZD(o)?o.asyncValidators:e)||null}function ZD(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class L3{constructor(o,i){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(o),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(o){this._rawValidators=this._composedValidatorFn=o}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(o){this._rawAsyncValidators=this._composedAsyncValidatorFn=o}get parent(){return this._parent}get valid(){return this.status===Cw}get invalid(){return this.status===WD}get pending(){return this.status==Hv}get disabled(){return this.status===Mw}get enabled(){return this.status!==Mw}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(o){this._assignValidators(o)}setAsyncValidators(o){this._assignAsyncValidators(o)}addValidators(o){this.setValidators(D3(o,this._rawValidators))}addAsyncValidators(o){this.setAsyncValidators(D3(o,this._rawAsyncValidators))}removeValidators(o){this.setValidators(I3(o,this._rawValidators))}removeAsyncValidators(o){this.setAsyncValidators(I3(o,this._rawAsyncValidators))}hasValidator(o){return GD(this._rawValidators,o)}hasAsyncValidator(o){return GD(this._rawAsyncValidators,o)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(o={}){this.touched=!0,this._parent&&!o.onlySelf&&this._parent.markAsTouched(o)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(o=>o.markAllAsTouched())}markAsUntouched(o={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}markAsDirty(o={}){this.pristine=!1,this._parent&&!o.onlySelf&&this._parent.markAsDirty(o)}markAsPristine(o={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(i=>{i.markAsPristine({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}markAsPending(o={}){this.status=Hv,!1!==o.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!o.onlySelf&&this._parent.markAsPending(o)}disable(o={}){const i=this._parentMarkedDirty(o.onlySelf);this.status=Mw,this.errors=null,this._forEachChild(a=>{a.disable({...o,onlySelf:!0})}),this._updateValue(),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...o,skipPristineCheck:i}),this._onDisabledChange.forEach(a=>a(!0))}enable(o={}){const i=this._parentMarkedDirty(o.onlySelf);this.status=Cw,this._forEachChild(a=>{a.enable({...o,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent}),this._updateAncestors({...o,skipPristineCheck:i}),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(o){this._parent&&!o.onlySelf&&(this._parent.updateValueAndValidity(o),o.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(o){this._parent=o}getRawValue(){return this.value}updateValueAndValidity(o={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Cw||this.status===Hv)&&this._runAsyncValidator(o.emitEvent)),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!o.onlySelf&&this._parent.updateValueAndValidity(o)}_updateTreeValidity(o={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(o)),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Mw:Cw}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(o){if(this.asyncValidator){this.status=Hv,this._hasOwnPendingAsyncValidator=!0;const i=v3(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(a=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(a,{emitEvent:o})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(o,i={}){this.errors=o,this._updateControlsErrors(!1!==i.emitEvent)}get(o){let i=o;return null==i||(Array.isArray(i)||(i=i.split(".")),0===i.length)?null:i.reduce((a,u)=>a&&a._find(u),this)}getError(o,i){const a=i?this.get(i):this;return a&&a.errors?a.errors[o]:null}hasError(o,i){return!!this.getError(o,i)}get root(){let o=this;for(;o._parent;)o=o._parent;return o}_updateControlsErrors(o){this.status=this._calculateStatus(),o&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(o)}_initObservables(){this.valueChanges=new oi,this.statusChanges=new oi}_calculateStatus(){return this._allControlsDisabled()?Mw:this.errors?WD:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Hv)?Hv:this._anyControlsHaveStatus(WD)?WD:Cw}_anyControlsHaveStatus(o){return this._anyControls(i=>i.status===o)}_anyControlsDirty(){return this._anyControls(o=>o.dirty)}_anyControlsTouched(){return this._anyControls(o=>o.touched)}_updatePristine(o={}){this.pristine=!this._anyControlsDirty(),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}_updateTouched(o={}){this.touched=this._anyControlsTouched(),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}_registerOnCollectionChange(o){this._onCollectionChange=o}_setUpdateStrategy(o){ZD(o)&&null!=o.updateOn&&(this._updateOn=o.updateOn)}_parentMarkedDirty(o){return!o&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(o){return null}_assignValidators(o){this._rawValidators=Array.isArray(o)?o.slice():o,this._composedValidatorFn=function T8(e){return Array.isArray(e)?VO(e):e||null}(this._rawValidators)}_assignAsyncValidators(o){this._rawAsyncValidators=Array.isArray(o)?o.slice():o,this._composedAsyncValidatorFn=function D8(e){return Array.isArray(e)?jO(e):e||null}(this._rawAsyncValidators)}}class WO extends L3{constructor(o,i,a){super(GO(i),qO(a,i)),this.controls=o,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(o,i){return this.controls[o]?this.controls[o]:(this.controls[o]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(o,i,a={}){this.registerControl(o,i),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(o,i={}){this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),delete this.controls[o],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(o,i,a={}){this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),delete this.controls[o],i&&this.registerControl(o,i),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(o){return this.controls.hasOwnProperty(o)&&this.controls[o].enabled}setValue(o,i={}){(function F3(e,o,i){e._forEachChild((a,u)=>{if(void 0===i[u])throw new at(1002,"")})})(this,0,o),Object.keys(o).forEach(a=>{(function k3(e,o,i){const a=e.controls;if(!(o?Object.keys(a):a).length)throw new at(1e3,"");if(!a[i])throw new at(1001,"")})(this,!0,a),this.controls[a].setValue(o[a],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(o,i={}){null!=o&&(Object.keys(o).forEach(a=>{const u=this.controls[a];u&&u.patchValue(o[a],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(o={},i={}){this._forEachChild((a,u)=>{a.reset(o?o[u]:null,{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i),this._updateTouched(i),this.updateValueAndValidity(i)}getRawValue(){return this._reduceChildren({},(o,i,a)=>(o[a]=i.getRawValue(),o))}_syncPendingControls(){let o=this._reduceChildren(!1,(i,a)=>!!a._syncPendingControls()||i);return o&&this.updateValueAndValidity({onlySelf:!0}),o}_forEachChild(o){Object.keys(this.controls).forEach(i=>{const a=this.controls[i];a&&o(a,i)})}_setUpControls(){this._forEachChild(o=>{o.setParent(this),o._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(o){for(const[i,a]of Object.entries(this.controls))if(this.contains(i)&&o(a))return!0;return!1}_reduceValue(){return this._reduceChildren({},(i,a,u)=>((a.enabled||this.disabled)&&(i[u]=a.value),i))}_reduceChildren(o,i){let a=o;return this._forEachChild((u,f)=>{a=i(a,u,f)}),a}_allControlsDisabled(){for(const o of Object.keys(this.controls))if(this.controls[o].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(o){return this.controls.hasOwnProperty(o)?this.controls[o]:null}}const Gv=new Gt("CallSetDisabledState",{providedIn:"root",factory:()=>XD}),XD="always";function Sw(e,o,i=XD){ZO(e,o),o.valueAccessor.writeValue(e.value),(e.disabled||"always"===i)&&o.valueAccessor.setDisabledState?.(e.disabled),function R8(e,o){o.valueAccessor.registerOnChange(i=>{e._pendingValue=i,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&N3(e,o)})}(e,o),function O8(e,o){const i=(a,u)=>{o.valueAccessor.writeValue(a),u&&o.viewToModelUpdate(a)};e.registerOnChange(i),o._registerOnDestroy(()=>{e._unregisterOnChange(i)})}(e,o),function P8(e,o){o.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&N3(e,o),"submit"!==e.updateOn&&e.markAsTouched()})}(e,o),function A8(e,o){if(o.valueAccessor.setDisabledState){const i=a=>{o.valueAccessor.setDisabledState(a)};e.registerOnDisabledChange(i),o._registerOnDestroy(()=>{e._unregisterOnDisabledChange(i)})}}(e,o)}function KD(e,o,i=!0){const a=()=>{};o.valueAccessor&&(o.valueAccessor.registerOnChange(a),o.valueAccessor.registerOnTouched(a)),QD(e,o),e&&(o._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function JD(e,o){e.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(o)})}function ZO(e,o){const i=S3(e);null!==o.validator?e.setValidators(M3(i,o.validator)):"function"==typeof i&&e.setValidators([i]);const a=T3(e);null!==o.asyncValidator?e.setAsyncValidators(M3(a,o.asyncValidator)):"function"==typeof a&&e.setAsyncValidators([a]);const u=()=>e.updateValueAndValidity();JD(o._rawValidators,u),JD(o._rawAsyncValidators,u)}function QD(e,o){let i=!1;if(null!==e){if(null!==o.validator){const u=S3(e);if(Array.isArray(u)&&u.length>0){const f=u.filter(g=>g!==o.validator);f.length!==u.length&&(i=!0,e.setValidators(f))}}if(null!==o.asyncValidator){const u=T3(e);if(Array.isArray(u)&&u.length>0){const f=u.filter(g=>g!==o.asyncValidator);f.length!==u.length&&(i=!0,e.setAsyncValidators(f))}}}const a=()=>{};return JD(o._rawValidators,a),JD(o._rawAsyncValidators,a),i}function N3(e,o){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),o.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function z3(e,o){ZO(e,o)}function B3(e,o){e._syncPendingControls(),o.forEach(i=>{const a=i.control;"submit"===a.updateOn&&a._pendingChange&&(i.viewToModelUpdate(a._pendingValue),a._pendingChange=!1)})}const z8={provide:na,useExisting:Di(()=>tI)},Tw=(()=>Promise.resolve())();let tI=(()=>{class e extends na{constructor(i,a,u){super(),this.callSetDisabledState=u,this.submitted=!1,this._directives=new Set,this.ngSubmit=new oi,this.form=new WO({},VO(i),jO(a))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(i){Tw.then(()=>{const a=this._findContainer(i.path);i.control=a.registerControl(i.name,i.control),Sw(i.control,i,this.callSetDisabledState),i.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(i)})}getControl(i){return this.form.get(i.path)}removeControl(i){Tw.then(()=>{const a=this._findContainer(i.path);a&&a.removeControl(i.name),this._directives.delete(i)})}addFormGroup(i){Tw.then(()=>{const a=this._findContainer(i.path),u=new WO({});z3(u,i),a.registerControl(i.name,u),u.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(i){Tw.then(()=>{const a=this._findContainer(i.path);a&&a.removeControl(i.name)})}getFormGroup(i){return this.form.get(i.path)}updateModel(i,a){Tw.then(()=>{this.form.get(i.path).setValue(a)})}setValue(i){this.control.setValue(i)}onSubmit(i){return this.submitted=!0,B3(this.form,this._directives),this.ngSubmit.emit(i),"dialog"===i?.target?.method}onReset(){this.resetForm()}resetForm(i=void 0){this.form.reset(i),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(i){return i.pop(),i.length?this.form.get(i):this.form}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Ps,10),xt(Zf,10),xt(Gv,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(a,u){1&a&&Fr("submit",function(g){return u.onSubmit(g)})("reset",function(){return u.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Ji([z8]),Wn]})}return e})();function V3(e,o){const i=e.indexOf(o);i>-1&&e.splice(i,1)}function j3(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const U3=class extends L3{constructor(o=null,i,a){super(GO(i),qO(a,i)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(o),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ZD(i)&&(i.nonNullable||i.initialValueIsDefault)&&(this.defaultValue=j3(o)?o.value:o)}setValue(o,i={}){this.value=this._pendingValue=o,this._onChange.length&&!1!==i.emitModelToViewChange&&this._onChange.forEach(a=>a(this.value,!1!==i.emitViewToModelChange)),this.updateValueAndValidity(i)}patchValue(o,i={}){this.setValue(o,i)}reset(o=this.defaultValue,i={}){this._applyFormState(o),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(o){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(o){this._onChange.push(o)}_unregisterOnChange(o){V3(this._onChange,o)}registerOnDisabledChange(o){this._onDisabledChange.push(o)}_unregisterOnDisabledChange(o){V3(this._onDisabledChange,o)}_forEachChild(o){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(o){j3(o)?(this.value=this._pendingValue=o.value,o.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=o}},j8={provide:Gd,useExisting:Di(()=>JO)},G3=(()=>Promise.resolve())();let JO=(()=>{class e extends Gd{constructor(i,a,u,f,g,x){super(),this._changeDetectorRef=g,this.callSetDisabledState=x,this.control=new U3,this._registered=!1,this.name="",this.update=new oi,this._parent=i,this._setValidators(a),this._setAsyncValidators(u),this.valueAccessor=function KO(e,o){if(!o)return null;let i,a,u;return Array.isArray(o),o.forEach(f=>{f.constructor===BO?i=f:function L8(e){return Object.getPrototypeOf(e.constructor)===Eg}(f)?a=f:u=f}),u||a||i||null}(0,f)}ngOnChanges(i){if(this._checkForErrors(),!this._registered||"name"in i){if(this._registered&&(this._checkName(),this.formDirective)){const a=i.name.previousValue;this.formDirective.removeControl({name:a,path:this._getPath(a)})}this._setUpControl()}"isDisabled"in i&&this._updateDisabled(i),function YO(e,o){if(!e.hasOwnProperty("model"))return!1;const i=e.model;return!!i.isFirstChange()||!Object.is(o,i.currentValue)}(i,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Sw(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(i){G3.then(()=>{this.control.setValue(i,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(i){const a=i.isDisabled.currentValue,u=0!==a&&function Nv(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}(a);G3.then(()=>{u&&!this.control.disabled?this.control.disable():!u&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(i){return this._parent?function YD(e,o){return[...o.path,e]}(i,this._parent):[i]}static#t=this.\u0275fac=function(a){return new(a||e)(xt(na,9),xt(Ps,10),xt(Zf,10),xt(Bu,10),xt(Le,8),xt(Gv,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Ji([j8]),Wn,rs]})}return e})(),W3=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({})}return e})();const Z8={provide:na,useExisting:Di(()=>eI)};let rk,eI=(()=>{class e extends na{constructor(i,a,u){super(),this.callSetDisabledState=u,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new oi,this._setValidators(i),this._setAsyncValidators(a)}ngOnChanges(i){this._checkFormPresent(),i.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(QD(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(i){const a=this.form.get(i.path);return Sw(a,i,this.callSetDisabledState),a.updateValueAndValidity({emitEvent:!1}),this.directives.push(i),a}getControl(i){return this.form.get(i.path)}removeControl(i){KD(i.control||null,i,!1),function N8(e,o){const i=e.indexOf(o);i>-1&&e.splice(i,1)}(this.directives,i)}addFormGroup(i){this._setUpFormContainer(i)}removeFormGroup(i){this._cleanUpFormContainer(i)}getFormGroup(i){return this.form.get(i.path)}addFormArray(i){this._setUpFormContainer(i)}removeFormArray(i){this._cleanUpFormContainer(i)}getFormArray(i){return this.form.get(i.path)}updateModel(i,a){this.form.get(i.path).setValue(a)}onSubmit(i){return this.submitted=!0,B3(this.form,this.directives),this.ngSubmit.emit(i),"dialog"===i?.target?.method}onReset(){this.resetForm()}resetForm(i=void 0){this.form.reset(i),this.submitted=!1}_updateDomValue(){this.directives.forEach(i=>{const a=i.control,u=this.form.get(i.path);a!==u&&(KD(a||null,i),(e=>e instanceof U3)(u)&&(Sw(u,i,this.callSetDisabledState),i.control=u))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(i){const a=this.form.get(i.path);z3(a,i),a.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(i){if(this.form){const a=this.form.get(i.path);a&&function k8(e,o){return QD(e,o)}(a,i)&&a.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){ZO(this.form,this),this._oldForm&&QD(this._oldForm,this)}_checkFormPresent(){}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Ps,10),xt(Zf,10),xt(Gv,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","formGroup",""]],hostBindings:function(a,u){1&a&&Fr("submit",function(g){return u.onSubmit(g)})("reset",function(){return u.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Ji([Z8]),Wn,rs]})}return e})(),h$=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[W3]})}return e})(),p$=(()=>{class e{static withConfig(i){return{ngModule:e,providers:[{provide:Gv,useValue:i.callSetDisabledState??XD}]}}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[h$]})}return e})();try{rk=typeof Intl<"u"&&Intl.v8BreakIterator}catch{rk=!1}let Dw,Mg,ok,dl=(()=>{class e{constructor(i){this._platformId=i,this.isBrowser=this._platformId?function LV(e){return e===kL}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!rk)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#t=this.\u0275fac=function(a){return new(a||e)(bt(qa))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function nI(e){return function m$(){if(null==Dw&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Dw=!0}))}finally{Dw=Dw||!1}return Dw}()?e:!!e.capture}function g$(){if(null==Mg){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Mg=!1,Mg;if("scrollBehavior"in document.documentElement.style)Mg=!0;else{const e=Element.prototype.scrollTo;Mg=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return Mg}function Xf(e){return e.composedPath?e.composedPath()[0]:e.target}function sk(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Iw(e,...o){return o.length?o.some(i=>e[i]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}function go(e,o,i){const a=Gn(e)||o||i?{next:e,error:o,complete:i}:e;return a?ar((u,f)=>{var g;null===(g=a.subscribe)||void 0===g||g.call(a);let x=!0;u.subscribe(Ti(f,w=>{var T;null===(T=a.next)||void 0===T||T.call(a,w),f.next(w)},()=>{var w;x=!1,null===(w=a.complete)||void 0===w||w.call(a),f.complete()},w=>{var T;x=!1,null===(T=a.error)||void 0===T||T.call(a,w),f.error(w)},()=>{var w,T;x&&(null===(w=a.unsubscribe)||void 0===w||w.call(a)),null===(T=a.finalize)||void 0===T||T.call(a)}))}):vl}class O$ extends st{constructor(o,i){super()}schedule(o,i=0){return this}}const rI={setInterval(e,o,...i){const{delegate:a}=rI;return a?.setInterval?a.setInterval(e,o,...i):setInterval(e,o,...i)},clearInterval(e){const{delegate:o}=rI;return(o?.clearInterval||clearInterval)(e)},delegate:void 0};class dk extends O${constructor(o,i){super(o,i),this.scheduler=o,this.work=i,this.pending=!1}schedule(o,i=0){var a;if(this.closed)return this;this.state=o;const u=this.id,f=this.scheduler;return null!=u&&(this.id=this.recycleAsyncId(f,u,i)),this.pending=!0,this.delay=i,this.id=null!==(a=this.id)&&void 0!==a?a:this.requestAsyncId(f,this.id,i),this}requestAsyncId(o,i,a=0){return rI.setInterval(o.flush.bind(o,this),a)}recycleAsyncId(o,i,a=0){if(null!=a&&this.delay===a&&!1===this.pending)return i;null!=i&&rI.clearInterval(i)}execute(o,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(o,i);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(o,i){let u,a=!1;try{this.work(o)}catch(f){a=!0,u=f||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),u}unsubscribe(){if(!this.closed){const{id:o,scheduler:i}=this,{actions:a}=i;this.work=this.state=this.scheduler=null,this.pending=!1,Qt(a,this),null!=o&&(this.id=this.recycleAsyncId(i,o,null)),this.delay=null,super.unsubscribe()}}}const hk={now:()=>(hk.delegate||Date).now(),delegate:void 0};class Aw{constructor(o,i=Aw.now){this.schedulerActionCtor=o,this.now=i}schedule(o,i=0,a){return new this.schedulerActionCtor(this,o).schedule(a,i)}}Aw.now=hk.now;class fk extends Aw{constructor(o,i=Aw.now){super(o,i),this.actions=[],this._active=!1}flush(o){const{actions:i}=this;if(this._active)return void i.push(o);let a;this._active=!0;do{if(a=o.execute(o.state,o.delay))break}while(o=i.shift());if(this._active=!1,a){for(;o=i.shift();)o.unsubscribe();throw a}}}const pk=new fk(dk),k$=pk;function mz(e,o=pk){return ar((i,a)=>{let u=null,f=null,g=null;const x=()=>{if(u){u.unsubscribe(),u=null;const T=f;f=null,a.next(T)}};function w(){const T=g+e,A=o.now();if(A<T)return u=this.schedule(void 0,T-A),void a.add(u);x()}i.subscribe(Ti(a,T=>{f=T,g=o.now(),u||(u=o.schedule(w,e),a.add(u))},()=>{x(),a.complete()},void 0,()=>{f=u=null}))})}function gz(e){return Rs((o,i)=>e<=i)}function Ca(e){return ar((o,i)=>{bn(e).subscribe(Ti(i,()=>i.complete(),Gu)),!i.closed&&o.subscribe(i)})}function ia(e){return null!=e&&"false"!=`${e}`}function _z(e,o=0){return function F$(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):o}function oI(e){return Array.isArray(e)?e:[e]}function _o(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Wv(e){return e instanceof Gi?e.nativeElement:e}function sI(...e){const o=nu(e),i=oE(e),{args:a,keys:u}=r3(e);if(0===a.length)return Ar([],o);const f=new $n(function L$(e,o,i=vl){return a=>{yz(o,()=>{const{length:u}=e,f=new Array(u);let g=u,x=u;for(let w=0;w<u;w++)yz(o,()=>{const T=Ar(e[w],o);let A=!1;T.subscribe(Ti(a,k=>{f[w]=k,A||(A=!0,x--),x||a.next(i(f.slice()))},()=>{--g||a.complete()}))},a)},a)}}(a,o,u?g=>o3(u,g):vl));return i?f.pipe(zO(i)):f}function yz(e,o,i){e?ps(i,e,o):o()}function aI(...e){return function N$(){return eu(1)}()(Ar(e,nu(e)))}function Vu(e){return e<=0?()=>Aa:ar((o,i)=>{let a=0;o.subscribe(Ti(i,u=>{++a<=e&&(i.next(u),e<=a&&i.complete())}))})}function lI(...e){const o=nu(e);return ar((i,a)=>{(o?aI(e,i,o):aI(e,i)).subscribe(a)})}const vz=new Set;let Sg,z$=(()=>{class e{constructor(i,a){this._platform=i,this._nonce=a,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):V$}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&function B$(e,o){if(!vz.has(e))try{Sg||(Sg=document.createElement("style"),o&&(Sg.nonce=o),Sg.setAttribute("type","text/css"),document.head.appendChild(Sg)),Sg.sheet&&(Sg.sheet.insertRule(`@media ${e} {body{ }}`,0),vz.add(e))}catch(i){console.error(i)}}(i,this._nonce),this._matchMedia(i)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(dl),bt(Wx,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function V$(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let j$=(()=>{class e{constructor(i,a){this._mediaMatcher=i,this._zone=a,this._queries=new Map,this._destroySubject=new xn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return xz(oI(i)).some(u=>this._registerQuery(u).mql.matches)}observe(i){let f=sI(xz(oI(i)).map(g=>this._registerQuery(g).observable));return f=aI(f.pipe(Vu(1)),f.pipe(gz(1),mz(0))),f.pipe(cn(g=>{const x={matches:!1,breakpoints:{}};return g.forEach(({matches:w,query:T})=>{x.matches=x.matches||w,x.breakpoints[T]=w}),x}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);const a=this._mediaMatcher.matchMedia(i),f={observable:new $n(g=>{const x=w=>this._zone.run(()=>g.next(w));return a.addListener(x),()=>{a.removeListener(x)}}).pipe(lI(a),cn(({matches:g})=>({query:i,matches:g})),Ca(this._destroySubject)),mql:a};return this._queries.set(i,f),f}static#t=this.\u0275fac=function(a){return new(a||e)(bt(z$),bt(Je))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function xz(e){return e.map(o=>o.split(",")).reduce((o,i)=>o.concat(i)).map(o=>o.trim())}function wz(e,o,i){const u=Ez(e,o).filter(f=>f!=i.trim());u.length?e.setAttribute(o,u.join(" ")):e.removeAttribute(o)}function Ez(e,o){return(e.getAttribute(o)||"").match(/\S+/g)||[]}class G${constructor(o){this._items=o,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new xn,this._typeaheadSubscription=st.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._pageUpAndDown={enabled:!1,delta:10},this._skipPredicateFn=i=>i.disabled,this._pressedLetters=[],this.tabOut=new xn,this.change=new xn,o instanceof Of&&(this._itemChangesSubscription=o.changes.subscribe(i=>{if(this._activeItem){const u=i.toArray().indexOf(this._activeItem);u>-1&&u!==this._activeItemIndex&&(this._activeItemIndex=u)}}))}skipPredicate(o){return this._skipPredicateFn=o,this}withWrap(o=!0){return this._wrap=o,this}withVerticalOrientation(o=!0){return this._vertical=o,this}withHorizontalOrientation(o){return this._horizontal=o,this}withAllowedModifierKeys(o){return this._allowedModifierKeys=o,this}withTypeAhead(o=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(go(i=>this._pressedLetters.push(i)),mz(o),Rs(()=>this._pressedLetters.length>0),cn(()=>this._pressedLetters.join(""))).subscribe(i=>{const a=this._getItemsArray();for(let u=1;u<a.length+1;u++){const f=(this._activeItemIndex+u)%a.length,g=a[f];if(!this._skipPredicateFn(g)&&0===g.getLabel().toUpperCase().trim().indexOf(i)){this.setActiveItem(f);break}}this._pressedLetters=[]}),this}cancelTypeahead(){return this._pressedLetters=[],this}withHomeAndEnd(o=!0){return this._homeAndEnd=o,this}withPageUpDown(o=!0,i=10){return this._pageUpAndDown={enabled:o,delta:i},this}setActiveItem(o){const i=this._activeItem;this.updateActiveItem(o),this._activeItem!==i&&this.change.next(this._activeItemIndex)}onKeydown(o){const i=o.keyCode,u=["altKey","ctrlKey","metaKey","shiftKey"].every(f=>!o[f]||this._allowedModifierKeys.indexOf(f)>-1);switch(i){case 9:return void this.tabOut.next();case 40:if(this._vertical&&u){this.setNextItemActive();break}return;case 38:if(this._vertical&&u){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&u){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&u){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&u){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&u){this.setLastItemActive();break}return;case 33:if(this._pageUpAndDown.enabled&&u){const f=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(f>0?f:0,1);break}return;case 34:if(this._pageUpAndDown.enabled&&u){const f=this._activeItemIndex+this._pageUpAndDown.delta,g=this._getItemsArray().length;this._setActiveItemByIndex(f<g?f:g-1,-1);break}return;default:return void((u||Iw(o,"shiftKey"))&&(o.key&&1===o.key.length?this._letterKeyStream.next(o.key.toLocaleUpperCase()):(i>=65&&i<=90||i>=48&&i<=57)&&this._letterKeyStream.next(String.fromCharCode(i))))}this._pressedLetters=[],o.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(o){const i=this._getItemsArray(),a="number"==typeof o?o:i.indexOf(o);this._activeItem=i[a]??null,this._activeItemIndex=a}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._letterKeyStream.complete(),this.tabOut.complete(),this.change.complete(),this._pressedLetters=[]}_setActiveItemByDelta(o){this._wrap?this._setActiveInWrapMode(o):this._setActiveInDefaultMode(o)}_setActiveInWrapMode(o){const i=this._getItemsArray();for(let a=1;a<=i.length;a++){const u=(this._activeItemIndex+o*a+i.length)%i.length;if(!this._skipPredicateFn(i[u]))return void this.setActiveItem(u)}}_setActiveInDefaultMode(o){this._setActiveItemByIndex(this._activeItemIndex+o,o)}_setActiveItemByIndex(o,i){const a=this._getItemsArray();if(a[o]){for(;this._skipPredicateFn(a[o]);)if(!a[o+=i])return;this.setActiveItem(o)}}_getItemsArray(){return this._items instanceof Of?this._items.toArray():this._items}}class q$ extends G${setActiveItem(o){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(o),this.activeItem&&this.activeItem.setActiveStyles()}}function Mz(e){return 0===e.buttons||0===e.detail}function Sz(e){const o=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!o||-1!==o.identifier||null!=o.radiusX&&1!==o.radiusX||null!=o.radiusY&&1!==o.radiusY)}const J$=new Gt("cdk-input-modality-detector-options"),Q$={ignoreKeys:[18,17,224,91,16]},Zv=nI({passive:!0,capture:!0});let tH=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(i,a,u,f){this._platform=i,this._mostRecentTarget=null,this._modality=new $r(null),this._lastTouchMs=0,this._onKeydown=g=>{this._options?.ignoreKeys?.some(x=>x===g.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Xf(g))},this._onMousedown=g=>{Date.now()-this._lastTouchMs<650||(this._modality.next(Mz(g)?"keyboard":"mouse"),this._mostRecentTarget=Xf(g))},this._onTouchstart=g=>{Sz(g)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Xf(g))},this._options={...Q$,...f},this.modalityDetected=this._modality.pipe(gz(1)),this.modalityChanged=this.modalityDetected.pipe(Xu()),i.isBrowser&&a.runOutsideAngular(()=>{u.addEventListener("keydown",this._onKeydown,Zv),u.addEventListener("mousedown",this._onMousedown,Zv),u.addEventListener("touchstart",this._onTouchstart,Zv)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Zv),document.removeEventListener("mousedown",this._onMousedown,Zv),document.removeEventListener("touchstart",this._onTouchstart,Zv))}static#t=this.\u0275fac=function(a){return new(a||e)(bt(dl),bt(Je),bt(Qn),bt(J$,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const eH=new Gt("liveAnnouncerElement",{providedIn:"root",factory:function nH(){return null}}),iH=new Gt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let rH=0,oH=(()=>{class e{constructor(i,a,u,f){this._ngZone=a,this._defaultOptions=f,this._document=u,this._liveElement=i||this._createLiveElement()}announce(i,...a){const u=this._defaultOptions;let f,g;return 1===a.length&&"number"==typeof a[0]?g=a[0]:[f,g]=a,this.clear(),clearTimeout(this._previousTimeout),f||(f=u&&u.politeness?u.politeness:"polite"),null==g&&u&&(g=u.duration),this._liveElement.setAttribute("aria-live",f),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(x=>this._currentResolve=x)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=i,"number"==typeof g&&(this._previousTimeout=setTimeout(()=>this.clear(),g)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const i="cdk-live-announcer-element",a=this._document.getElementsByClassName(i),u=this._document.createElement("div");for(let f=0;f<a.length;f++)a[f].remove();return u.classList.add(i),u.classList.add("cdk-visually-hidden"),u.setAttribute("aria-atomic","true"),u.setAttribute("aria-live","polite"),u.id="cdk-live-announcer-"+rH++,this._document.body.appendChild(u),u}_exposeAnnouncerToModals(i){const a=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let u=0;u<a.length;u++){const f=a[u],g=f.getAttribute("aria-owns");g?-1===g.indexOf(i)&&f.setAttribute("aria-owns",g+" "+i):f.setAttribute("aria-owns",i)}}static#t=this.\u0275fac=function(a){return new(a||e)(bt(eH,8),bt(Je),bt(Qn),bt(iH,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const sH=new Gt("cdk-focus-monitor-default-options"),cI=nI({passive:!0,capture:!0});let aH=(()=>{class e{constructor(i,a,u,f,g){this._ngZone=i,this._platform=a,this._inputModalityDetector=u,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new xn,this._rootNodeFocusAndBlurListener=x=>{for(let T=Xf(x);T;T=T.parentElement)"focus"===x.type?this._onFocus(x,T):this._onBlur(x,T)},this._document=f,this._detectionMode=g?.detectionMode||0}monitor(i,a=!1){const u=Wv(i);if(!this._platform.isBrowser||1!==u.nodeType)return kt();const f=function y$(e){if(function _$(){if(null==ok){const e=typeof document<"u"?document.head:null;ok=!(!e||!e.createShadowRoot&&!e.attachShadow)}return ok}()){const o=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&o instanceof ShadowRoot)return o}return null}(u)||this._getDocument(),g=this._elementInfo.get(u);if(g)return a&&(g.checkChildren=!0),g.subject;const x={checkChildren:a,subject:new xn,rootNode:f};return this._elementInfo.set(u,x),this._registerGlobalListeners(x),x.subject}stopMonitoring(i){const a=Wv(i),u=this._elementInfo.get(a);u&&(u.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(u))}focusVia(i,a,u){const f=Wv(i);f===this._getDocument().activeElement?this._getClosestElementsInfo(f).forEach(([x,w])=>this._originChanged(x,a,w)):(this._setOrigin(a),"function"==typeof f.focus&&f.focus(u))}ngOnDestroy(){this._elementInfo.forEach((i,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(i){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(i)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:i&&this._isLastInteractionFromInputLabel(i)?"mouse":"program"}_shouldBeAttributedToTouch(i){return 1===this._detectionMode||!!i?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(i,a){i.classList.toggle("cdk-focused",!!a),i.classList.toggle("cdk-touch-focused","touch"===a),i.classList.toggle("cdk-keyboard-focused","keyboard"===a),i.classList.toggle("cdk-mouse-focused","mouse"===a),i.classList.toggle("cdk-program-focused","program"===a)}_setOrigin(i,a=!1){this._ngZone.runOutsideAngular(()=>{this._origin=i,this._originFromTouchInteraction="touch"===i&&a,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(i,a){const u=this._elementInfo.get(a),f=Xf(i);!u||!u.checkChildren&&a!==f||this._originChanged(a,this._getFocusOrigin(f),u)}_onBlur(i,a){const u=this._elementInfo.get(a);!u||u.checkChildren&&i.relatedTarget instanceof Node&&a.contains(i.relatedTarget)||(this._setClasses(a),this._emitOrigin(u,null))}_emitOrigin(i,a){i.subject.observers.length&&this._ngZone.run(()=>i.subject.next(a))}_registerGlobalListeners(i){if(!this._platform.isBrowser)return;const a=i.rootNode,u=this._rootNodeFocusListenerCount.get(a)||0;u||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,cI),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,cI)}),this._rootNodeFocusListenerCount.set(a,u+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Ca(this._stopInputModalityDetector)).subscribe(f=>{this._setOrigin(f,!0)}))}_removeGlobalListeners(i){const a=i.rootNode;if(this._rootNodeFocusListenerCount.has(a)){const u=this._rootNodeFocusListenerCount.get(a);u>1?this._rootNodeFocusListenerCount.set(a,u-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,cI),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,cI),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(i,a,u){this._setClasses(i,a),this._emitOrigin(u,a),this._lastFocusOrigin=a}_getClosestElementsInfo(i){const a=[];return this._elementInfo.forEach((u,f)=>{(f===i||u.checkChildren&&f.contains(i))&&a.push([f,u])}),a}_isLastInteractionFromInputLabel(i){const{_mostRecentTarget:a,mostRecentModality:u}=this._inputModalityDetector;if("mouse"!==u||!a||a===i||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName||i.disabled)return!1;const f=i.labels;if(f)for(let g=0;g<f.length;g++)if(f[g].contains(a))return!0;return!1}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Je),bt(dl),bt(tH),bt(Qn,8),bt(sH,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Dz="cdk-high-contrast-black-on-white",Iz="cdk-high-contrast-white-on-black",mk="cdk-high-contrast-active";let lH=(()=>{class e{constructor(i,a){this._platform=i,this._document=a,this._breakpointSubscription=ee(j$).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);const a=this._document.defaultView||window,u=a&&a.getComputedStyle?a.getComputedStyle(i):null,f=(u&&u.backgroundColor||"").replace(/ /g,"");switch(i.remove(),f){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const i=this._document.body.classList;i.remove(mk,Dz,Iz),this._hasCheckedHighContrastMode=!0;const a=this.getHighContrastMode();1===a?i.add(mk,Dz):2===a&&i.add(mk,Iz)}}static#t=this.\u0275fac=function(a){return new(a||e)(bt(dl),bt(Qn))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const cH=new Gt("cdk-dir-doc",{providedIn:"root",factory:function uH(){return ee(Qn)}}),dH=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let uI=(()=>{class e{constructor(i){this.value="ltr",this.change=new oi,i&&(this.value=function hH(e){const o=e?.toLowerCase()||"";return"auto"===o&&typeof navigator<"u"&&navigator?.language?dH.test(navigator.language)?"rtl":"ltr":"rtl"===o?"rtl":"ltr"}((i.body?i.body.dir:null)||(i.documentElement?i.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#t=this.\u0275fac=function(a){return new(a||e)(bt(cH,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Rw=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({})}return e})();const fH=["text"];function pH(e,o){if(1&e&&io(0,"mat-pseudo-checkbox",6),2&e){const i=ro();Cn("disabled",i.disabled)("state",i.selected?"checked":"unchecked")}}function mH(e,o){1&e&&io(0,"mat-pseudo-checkbox",7),2&e&&Cn("disabled",ro().disabled)}function gH(e,o){if(1&e&&(Dn(0,"span",8),rl(1),Nn()),2&e){const i=ro();mn(1),qm("(",i.group.label,")")}}const _H=[[["mat-icon"]],"*"],yH=["mat-icon","*"],xH=new Gt("mat-sanity-checks",{providedIn:"root",factory:function vH(){return!0}});let tc=(()=>{class e{constructor(i,a,u){this._sanityChecks=a,this._document=u,this._hasDoneGlobalChecks=!1,i._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(i){return!sk()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[i])}static#t=this.\u0275fac=function(a){return new(a||e)(bt(lH),bt(xH,8),bt(Qn))};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[Rw,Rw]})}return e})();function Pz(e){return class extends e{get disabled(){return this._disabled}set disabled(o){this._disabled=ia(o)}constructor(...o){super(...o),this._disabled=!1}}}function bH(e,o){return class extends e{get color(){return this._color}set color(i){const a=i||this.defaultColor;a!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),a&&this._elementRef.nativeElement.classList.add(`mat-${a}`),this._color=a)}constructor(...i){super(...i),this.defaultColor=o,this.color=o}}}function Oz(e){return class extends e{get disableRipple(){return this._disableRipple}set disableRipple(o){this._disableRipple=ia(o)}constructor(...o){super(...o),this._disableRipple=!1}}}function wH(e,o=0){return class extends e{get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(i){this._tabIndex=null!=i?_z(i):this.defaultTabIndex}constructor(...i){super(...i),this._tabIndex=o,this.defaultTabIndex=o}}}function EH(e){return class extends e{updateErrorState(){const o=this.errorState,f=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);f!==o&&(this.errorState=f,this.stateChanges.next())}constructor(...o){super(...o),this.errorState=!1}}}let MH=(()=>{class e{isErrorState(i,a){return!!(i&&i.invalid&&(i.touched||a&&a.submitted))}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class SH{constructor(o,i,a,u=!1){this._renderer=o,this.element=i,this.config=a,this._animationForciblyDisabledThroughCss=u,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const kz=nI({passive:!0,capture:!0});class TH{constructor(){this._events=new Map,this._delegateEventHandler=o=>{const i=Xf(o);i&&this._events.get(o.type)?.forEach((a,u)=>{(u===i||u.contains(i))&&a.forEach(f=>f.handleEvent(o))})}}addHandler(o,i,a,u){const f=this._events.get(i);if(f){const g=f.get(a);g?g.add(u):f.set(a,new Set([u]))}else this._events.set(i,new Map([[a,new Set([u])]])),o.runOutsideAngular(()=>{document.addEventListener(i,this._delegateEventHandler,kz)})}removeHandler(o,i,a){const u=this._events.get(o);if(!u)return;const f=u.get(i);f&&(f.delete(a),0===f.size&&u.delete(i),0===u.size&&(this._events.delete(o),document.removeEventListener(o,this._delegateEventHandler,kz)))}}const Fz={enterDuration:225,exitDuration:150},Lz=nI({passive:!0,capture:!0}),Nz=["mousedown","touchstart"],zz=["mouseup","mouseleave","touchend","touchcancel"];class dI{static#t=this._eventManager=new TH;constructor(o,i,a,u){this._target=o,this._ngZone=i,this._platform=u,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,u.isBrowser&&(this._containerElement=Wv(a))}fadeInRipple(o,i,a={}){const u=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),f={...Fz,...a.animation};a.centered&&(o=u.left+u.width/2,i=u.top+u.height/2);const g=a.radius||function IH(e,o,i){const a=Math.max(Math.abs(e-i.left),Math.abs(e-i.right)),u=Math.max(Math.abs(o-i.top),Math.abs(o-i.bottom));return Math.sqrt(a*a+u*u)}(o,i,u),x=o-u.left,w=i-u.top,T=f.enterDuration,A=document.createElement("div");A.classList.add("mat-ripple-element"),A.style.left=x-g+"px",A.style.top=w-g+"px",A.style.height=2*g+"px",A.style.width=2*g+"px",null!=a.color&&(A.style.backgroundColor=a.color),A.style.transitionDuration=`${T}ms`,this._containerElement.appendChild(A);const k=window.getComputedStyle(A),G=k.transitionDuration,K="none"===k.transitionProperty||"0s"===G||"0s, 0s"===G||0===u.width&&0===u.height,et=new SH(this,A,a,K);A.style.transform="scale3d(1, 1, 1)",et.state=0,a.persistent||(this._mostRecentTransientRipple=et);let ut=null;return!K&&(T||f.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const _t=()=>this._finishRippleTransition(et),pt=()=>this._destroyRipple(et);A.addEventListener("transitionend",_t),A.addEventListener("transitioncancel",pt),ut={onTransitionEnd:_t,onTransitionCancel:pt}}),this._activeRipples.set(et,ut),(K||!T)&&this._finishRippleTransition(et),et}fadeOutRipple(o){if(2===o.state||3===o.state)return;const i=o.element,a={...Fz,...o.config.animation};i.style.transitionDuration=`${a.exitDuration}ms`,i.style.opacity="0",o.state=2,(o._animationForciblyDisabledThroughCss||!a.exitDuration)&&this._finishRippleTransition(o)}fadeOutAll(){this._getActiveRipples().forEach(o=>o.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(o=>{o.config.persistent||o.fadeOut()})}setupTriggerEvents(o){const i=Wv(o);!this._platform.isBrowser||!i||i===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=i,Nz.forEach(a=>{dI._eventManager.addHandler(this._ngZone,a,i,this)}))}handleEvent(o){"mousedown"===o.type?this._onMousedown(o):"touchstart"===o.type?this._onTouchStart(o):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{zz.forEach(i=>{this._triggerElement.addEventListener(i,this,Lz)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(o){0===o.state?this._startFadeOutTransition(o):2===o.state&&this._destroyRipple(o)}_startFadeOutTransition(o){const i=o===this._mostRecentTransientRipple,{persistent:a}=o.config;o.state=1,!a&&(!i||!this._isPointerDown)&&o.fadeOut()}_destroyRipple(o){const i=this._activeRipples.get(o)??null;this._activeRipples.delete(o),this._activeRipples.size||(this._containerRect=null),o===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),o.state=3,null!==i&&(o.element.removeEventListener("transitionend",i.onTransitionEnd),o.element.removeEventListener("transitioncancel",i.onTransitionCancel)),o.element.remove()}_onMousedown(o){const i=Mz(o),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!i&&!a&&(this._isPointerDown=!0,this.fadeInRipple(o.clientX,o.clientY,this._target.rippleConfig))}_onTouchStart(o){if(!this._target.rippleDisabled&&!Sz(o)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const i=o.changedTouches;if(i)for(let a=0;a<i.length;a++)this.fadeInRipple(i[a].clientX,i[a].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(o=>{!o.config.persistent&&(1===o.state||o.config.terminateOnPointerUp&&0===o.state)&&o.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const o=this._triggerElement;o&&(Nz.forEach(i=>dI._eventManager.removeHandler(i,o,this)),this._pointerUpEventsRegistered&&zz.forEach(i=>o.removeEventListener(i,this,Lz)))}}const Bz=new Gt("mat-ripple-global-options");let Vz=(()=>{class e{get disabled(){return this._disabled}set disabled(i){i&&this.fadeOutAllNonPersistent(),this._disabled=i,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(i){this._trigger=i,this._setupTriggerEventsIfEnabled()}constructor(i,a,u,f,g){this._elementRef=i,this._animationMode=g,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=f||{},this._rippleRenderer=new dI(this,a,i,u)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(i,a=0,u){return"number"==typeof i?this._rippleRenderer.fadeInRipple(i,a,{...this.rippleConfig,...u}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...i})}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gi),xt(Je),xt(dl),xt(Bz,8),xt(yu,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(a,u){2&a&&Vr("mat-ripple-unbounded",u.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]})}return e})(),jz=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[tc,tc]})}return e})(),AH=(()=>{class e{constructor(i){this._animationMode=i,this.state="unchecked",this.disabled=!1,this.appearance="full"}static#t=this.\u0275fac=function(a){return new(a||e)(xt(yu,8))};static#e=this.\u0275cmp=_s({type:e,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:12,hostBindings:function(a,u){2&a&&Vr("mat-pseudo-checkbox-indeterminate","indeterminate"===u.state)("mat-pseudo-checkbox-checked","checked"===u.state)("mat-pseudo-checkbox-disabled",u.disabled)("mat-pseudo-checkbox-minimal","minimal"===u.appearance)("mat-pseudo-checkbox-full","full"===u.appearance)("_mat-animation-noopable","NoopAnimations"===u._animationMode)},inputs:{state:"state",disabled:"disabled",appearance:"appearance"},decls:0,vars:0,template:function(a,u){},styles:['.mat-pseudo-checkbox{border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox._mat-animation-noopable{transition:none !important;animation:none !important}.mat-pseudo-checkbox._mat-animation-noopable::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{left:1px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{left:1px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}.mat-pseudo-checkbox-full{border:2px solid}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate{border-color:rgba(0,0,0,0)}.mat-pseudo-checkbox{width:18px;height:18px}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after{width:14px;height:6px;transform-origin:center;top:-4.2426406871px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{top:8px;width:16px}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after{width:10px;height:4px;transform-origin:center;top:-2.8284271247px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{top:6px;width:12px}'],encapsulation:2,changeDetection:0})}return e})(),RH=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[tc]})}return e})();const Uz=new Gt("MAT_OPTION_PARENT_COMPONENT"),$z=new Gt("MatOptgroup");let PH=0;class OH{constructor(o,i=!1){this.source=o,this.isUserInput=i}}let kH=(()=>{class e{get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(i){this._disabled=ia(i)}get disableRipple(){return!(!this._parent||!this._parent.disableRipple)}get hideSingleSelectionIndicator(){return!(!this._parent||!this._parent.hideSingleSelectionIndicator)}constructor(i,a,u,f){this._element=i,this._changeDetectorRef=a,this._parent=u,this.group=f,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this.id="mat-option-"+PH++,this.onSelectionChange=new oi,this._stateChanges=new xn}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(i=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),i&&this._emitSelectionChangeEvent())}deselect(i=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),i&&this._emitSelectionChangeEvent())}focus(i,a){const u=this._getHostElement();"function"==typeof u.focus&&u.focus(a)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(i){(13===i.keyCode||32===i.keyCode)&&!Iw(i)&&(this._selectViaInteraction(),i.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this._selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const i=this.viewValue;i!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=i)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(i=!1){this.onSelectionChange.emit(new OH(this,i))}static#t=this.\u0275fac=function(a){ti()};static#e=this.\u0275dir=Ee({type:e,viewQuery:function(a,u){if(1&a&&Ea(fH,7),2&a){let f;xr(f=rr())&&(u._text=f.first)}},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"}})}return e})(),Hz=(()=>{class e extends kH{constructor(i,a,u,f){super(i,a,u,f)}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gi),xt(Le),xt(Uz,8),xt($z,8))};static#e=this.\u0275cmp=_s({type:e,selectors:[["mat-option"]],hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(a,u){1&a&&Fr("click",function(){return u._selectViaInteraction()})("keydown",function(g){return u._handleKeydown(g)}),2&a&&(Zm("id",u.id),Fo("aria-selected",u.selected)("aria-disabled",u.disabled.toString()),Vr("mdc-list-item--selected",u.selected)("mat-mdc-option-multiple",u.multiple)("mat-mdc-option-active",u.active)("mdc-list-item--disabled",u.disabled))},exportAs:["matOption"],features:[Wn],ngContentSelectors:yH,decls:8,vars:5,consts:[["class","mat-mdc-option-pseudo-checkbox","aria-hidden","true",3,"disabled","state",4,"ngIf"],[1,"mdc-list-item__primary-text"],["text",""],["class","mat-mdc-option-pseudo-checkbox","state","checked","aria-hidden","true","appearance","minimal",3,"disabled",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled"],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"]],template:function(a,u){1&a&&(Tu(_H),Ki(0,pH,1,2,"mat-pseudo-checkbox",0),oo(1),Dn(2,"span",1,2),oo(4,1),Nn(),Ki(5,mH,1,1,"mat-pseudo-checkbox",3),Ki(6,gH,2,1,"span",4),io(7,"div",5)),2&a&&(Cn("ngIf",u.multiple),mn(5),Cn("ngIf",!u.multiple&&u.selected&&!u.hideSingleSelectionIndicator),mn(1),Cn("ngIf",u.group&&u.group._inert),mn(1),Cn("matRippleTrigger",u._getHostElement())("matRippleDisabled",u.disabled||u.disableRipple))},dependencies:[Vz,GP,AH],styles:['.mat-mdc-option{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;padding-left:16px;padding-right:16px;-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color);font-family:var(--mat-option-label-text-font);line-height:var(--mat-option-label-text-line-height);font-size:var(--mat-option-label-text-size);letter-spacing:var(--mat-option-label-text-tracking);font-weight:var(--mat-option-label-text-weight);min-height:48px}.mat-mdc-option:focus{outline:none}[dir=rtl] .mat-mdc-option,.mat-mdc-option[dir=rtl]{padding-left:16px;padding-right:16px}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color)}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color)}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color)}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-multiple){background-color:var(--mat-option-selected-state-layer-color)}.mat-mdc-option.mdc-list-item{align-items:center}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}.cdk-high-contrast-active .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple)::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .cdk-high-contrast-active .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple)::after{right:auto;left:16px}.mat-mdc-option-active .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0})}return e})(),Gz=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[jz,xD,tc,RH]})}return e})();const qz={capture:!0},Wz=["focus","click","mouseenter","touchstart"],gk="mat-ripple-loader-uninitialized",_k="mat-ripple-loader-class-name",Zz="mat-ripple-loader-centered",hI="mat-ripple-loader-disabled";let NH=(()=>{class e{constructor(){this._document=ee(Qn,{optional:!0}),this._animationMode=ee(yu,{optional:!0}),this._globalRippleOptions=ee(Bz,{optional:!0}),this._platform=ee(dl),this._ngZone=ee(Je),this._onInteraction=i=>{if(!(i.target instanceof HTMLElement))return;const u=i.target.closest(`[${gk}]`);u&&this.createRipple(u)},this._ngZone.runOutsideAngular(()=>{for(const i of Wz)this._document?.addEventListener(i,this._onInteraction,qz)})}ngOnDestroy(){for(const i of Wz)this._document?.removeEventListener(i,this._onInteraction,qz)}configureRipple(i,a){i.setAttribute(gk,""),(a.className||!i.hasAttribute(_k))&&i.setAttribute(_k,a.className||""),a.centered&&i.setAttribute(Zz,""),a.disabled&&i.setAttribute(hI,"")}getRipple(i){return i.matRipple?i.matRipple:this.createRipple(i)}setDisabled(i,a){const u=i.matRipple;u?u.disabled=a:a?i.setAttribute(hI,""):i.removeAttribute(hI)}createRipple(i){if(!this._document)return;i.querySelector(".mat-ripple")?.remove();const a=this._document.createElement("span");a.classList.add("mat-ripple",i.getAttribute(_k)),i.append(a);const u=new Vz(new Gi(a),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return u._isInitialized=!0,u.trigger=i,u.centered=i.hasAttribute(Zz),u.disabled=i.hasAttribute(hI),this.attachRipple(i,u),u}attachRipple(i,a){i.removeAttribute(gk),i.matRipple=a}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const zH=["mat-button",""],BH=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],VH=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],jH=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],UH=bH(Pz(Oz(class{constructor(e){this._elementRef=e}})));let $H=(()=>{class e extends UH{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(i){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,i)}get disableRipple(){return this._disableRipple}set disableRipple(i){this._disableRipple=ia(i),this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(i){this._disabled=ia(i),this._updateRippleDisabled()}constructor(i,a,u,f){super(i),this._platform=a,this._ngZone=u,this._animationMode=f,this._focusMonitor=ee(aH),this._rippleLoader=ee(NH),this._isFab=!1,this._disableRipple=!1,this._disabled=!1,this._rippleLoader?.configureRipple(this._elementRef.nativeElement,{className:"mat-mdc-button-ripple"});const g=i.nativeElement.classList;for(const x of jH)this._hasHostAttributes(x.selector)&&x.mdcClasses.forEach(w=>{g.add(w)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(i="program",a){i?this._focusMonitor.focusVia(this._elementRef.nativeElement,i,a):this._elementRef.nativeElement.focus(a)}_hasHostAttributes(...i){return i.some(a=>this._elementRef.nativeElement.hasAttribute(a))}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static#t=this.\u0275fac=function(a){ti()};static#e=this.\u0275dir=Ee({type:e,features:[Wn]})}return e})(),GH=(()=>{class e extends $H{constructor(i,a,u,f){super(i,a,u,f)}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gi),xt(dl),xt(Je),xt(yu,8))};static#e=this.\u0275cmp=_s({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:7,hostBindings:function(a,u){2&a&&(Fo("disabled",u.disabled||null),Vr("_mat-animation-noopable","NoopAnimations"===u._animationMode)("mat-unthemed",!u.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Wn],attrs:zH,ngContentSelectors:VH,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(a,u){1&a&&(Tu(BH),io(0,"span",0),oo(1),Dn(2,"span",1),oo(3,1),Nn(),oo(4,2),io(5,"span",2)(6,"span",3)),2&a&&Vr("mdc-button__ripple",!u._isFab)("mdc-fab__ripple",u._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}return e})(),WH=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[tc,jz,tc]})}return e})();function Xv(e,o){const i=Gn(e)?e:()=>e,a=u=>u.error(i());return new $n(o?u=>o.schedule(a,0,u):a)}function Yf(e){return ar((o,i)=>{let f,a=null,u=!1;a=o.subscribe(Ti(i,void 0,void 0,g=>{f=bn(e(g,Yf(e)(o))),a?(a.unsubscribe(),a=null,f.subscribe(i)):u=!0})),u&&(a.unsubscribe(),a=null,f.subscribe(i))})}let QH=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[tc,tc]})}return e})();const tG=["addListener","removeListener"],eG=["addEventListener","removeEventListener"],nG=["on","off"];function vk(e,o,i,a){if(Gn(i)&&(a=i,i=void 0),a)return vk(e,o,i).pipe(zO(a));const[u,f]=function oG(e){return Gn(e.addEventListener)&&Gn(e.removeEventListener)}(e)?eG.map(g=>x=>e[g](o,x,i)):function iG(e){return Gn(e.addListener)&&Gn(e.removeListener)}(e)?tG.map(Qz(e,o)):function rG(e){return Gn(e.on)&&Gn(e.off)}(e)?nG.map(Qz(e,o)):[];if(!u&&At(e))return pr(g=>vk(g,o,i))(bn(e));if(!u)throw new TypeError("Invalid event target");return new $n(g=>{const x=(...w)=>g.next(1<w.length?w:w[0]);return u(x),()=>f(x)})}function Qz(e,o){return i=>a=>e[i](o,a)}const kw={schedule(e){let o=requestAnimationFrame,i=cancelAnimationFrame;const{delegate:a}=kw;a&&(o=a.requestAnimationFrame,i=a.cancelAnimationFrame);const u=o(f=>{i=void 0,e(f)});return new st(()=>i?.(u))},requestAnimationFrame(...e){const{delegate:o}=kw;return(o?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:o}=kw;return(o?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class aG extends fk{flush(o){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:a}=this;let u;o=o||a.shift();do{if(u=o.execute(o.state,o.delay))break}while((o=a[0])&&o.id===i&&a.shift());if(this._active=!1,u){for(;(o=a[0])&&o.id===i&&a.shift();)o.unsubscribe();throw u}}}(class sG extends dk{constructor(o,i){super(o,i),this.scheduler=o,this.work=i}requestAsyncId(o,i,a=0){return null!==a&&a>0?super.requestAsyncId(o,i,a):(o.actions.push(this),o._scheduled||(o._scheduled=kw.requestAnimationFrame(()=>o.flush(void 0))))}recycleAsyncId(o,i,a=0){var u;if(null!=a?a>0:this.delay>0)return super.recycleAsyncId(o,i,a);const{actions:f}=o;null!=i&&(null===(u=f[f.length-1])||void 0===u?void 0:u.id)!==i&&(kw.cancelAnimationFrame(i),o._scheduled=void 0)}});let xk,cG=1;const mI={};function tB(e){return e in mI&&(delete mI[e],!0)}const uG={setImmediate(e){const o=cG++;return mI[o]=!0,xk||(xk=Promise.resolve()),xk.then(()=>tB(o)&&e()),o},clearImmediate(e){tB(e)}},{setImmediate:dG,clearImmediate:hG}=uG,gI={setImmediate(...e){const{delegate:o}=gI;return(o?.setImmediate||dG)(...e)},clearImmediate(e){const{delegate:o}=gI;return(o?.clearImmediate||hG)(e)},delegate:void 0};new class pG extends fk{flush(o){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:a}=this;let u;o=o||a.shift();do{if(u=o.execute(o.state,o.delay))break}while((o=a[0])&&o.id===i&&a.shift());if(this._active=!1,u){for(;(o=a[0])&&o.id===i&&a.shift();)o.unsubscribe();throw u}}}(class fG extends dk{constructor(o,i){super(o,i),this.scheduler=o,this.work=i}requestAsyncId(o,i,a=0){return null!==a&&a>0?super.requestAsyncId(o,i,a):(o.actions.push(this),o._scheduled||(o._scheduled=gI.setImmediate(o.flush.bind(o,void 0))))}recycleAsyncId(o,i,a=0){var u;if(null!=a?a>0:this.delay>0)return super.recycleAsyncId(o,i,a);const{actions:f}=o;null!=i&&(null===(u=f[f.length-1])||void 0===u?void 0:u.id)!==i&&(gI.clearImmediate(i),o._scheduled===i&&(o._scheduled=void 0))}});function eB(e,o=pk){return function gG(e){return ar((o,i)=>{let a=!1,u=null,f=null,g=!1;const x=()=>{if(f?.unsubscribe(),f=null,a){a=!1;const T=u;u=null,i.next(T)}g&&i.complete()},w=()=>{f=null,g&&i.complete()};o.subscribe(Ti(i,T=>{a=!0,u=T,f||bn(e(T)).subscribe(f=Ti(i,x,w))},()=>{g=!0,(!a||!f||f.closed)&&i.complete()}))})}(()=>function yG(e=0,o,i=k$){let a=-1;return null!=o&&(rE(o)?i=o:a=o),new $n(u=>{let f=function _G(e){return e instanceof Date&&!isNaN(e)}(e)?+e-i.now():e;f<0&&(f=0);let g=0;return i.schedule(function(){u.closed||(u.next(g++),0<=a?this.schedule(void 0,a):u.complete())},f)})}(e,o))}let xG=(()=>{class e{constructor(i,a,u){this._ngZone=i,this._platform=a,this._scrolled=new xn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=u}register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){const a=this.scrollContainers.get(i);a&&(a.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=20){return this._platform.isBrowser?new $n(a=>{this._globalSubscription||this._addGlobalListener();const u=i>0?this._scrolled.pipe(eB(i)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{u.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):kt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((i,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(i,a){const u=this.getAncestorScrollContainers(i);return this.scrolled(a).pipe(Rs(f=>!f||u.indexOf(f)>-1))}getAncestorScrollContainers(i){const a=[];return this.scrollContainers.forEach((u,f)=>{this._scrollableContainsElement(f,i)&&a.push(f)}),a}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(i,a){let u=Wv(a),f=i.getElementRef().nativeElement;do{if(u==f)return!0}while(u=u.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>vk(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Je),bt(dl),bt(Qn,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),bk=(()=>{class e{constructor(i,a,u){this._platform=i,this._change=new xn,this._changeListener=f=>{this._change.next(f)},this._document=u,a.runOutsideAngular(()=>{if(i.isBrowser){const f=this._getWindow();f.addEventListener("resize",this._changeListener),f.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const i=this._getWindow();i.removeEventListener("resize",this._changeListener),i.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){const i=this.getViewportScrollPosition(),{width:a,height:u}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+u,right:i.left+a,height:u,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const i=this._document,a=this._getWindow(),u=i.documentElement,f=u.getBoundingClientRect();return{top:-f.top||i.body.scrollTop||a.scrollY||u.scrollTop||0,left:-f.left||i.body.scrollLeft||a.scrollX||u.scrollLeft||0}}change(i=20){return i>0?this._change.pipe(eB(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}static#t=this.\u0275fac=function(a){return new(a||e)(bt(dl),bt(Je),bt(Qn,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wk=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({})}return e})(),nB=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[Rw,wk,Rw,wk]})}return e})();class Ek{attach(o){return this._attachedHost=o,o.attach(this)}detach(){let o=this._attachedHost;null!=o&&(this._attachedHost=null,o.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(o){this._attachedHost=o}}class EG extends Ek{constructor(o,i,a,u,f){super(),this.component=o,this.viewContainerRef=i,this.injector=a,this.componentFactoryResolver=u,this.projectableNodes=f}}class iB extends Ek{constructor(o,i,a,u){super(),this.templateRef=o,this.viewContainerRef=i,this.context=a,this.injector=u}get origin(){return this.templateRef.elementRef}attach(o,i=this.context){return this.context=i,super.attach(o)}detach(){return this.context=void 0,super.detach()}}class CG extends Ek{constructor(o){super(),this.element=o instanceof Gi?o.nativeElement:o}}class MG{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(o){return o instanceof EG?(this._attachedPortal=o,this.attachComponentPortal(o)):o instanceof iB?(this._attachedPortal=o,this.attachTemplatePortal(o)):this.attachDomPortal&&o instanceof CG?(this._attachedPortal=o,this.attachDomPortal(o)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(o){this._disposeFn=o}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class SG extends MG{constructor(o,i,a,u,f){super(),this.outletElement=o,this._componentFactoryResolver=i,this._appRef=a,this._defaultInjector=u,this.attachDomPortal=g=>{const x=g.element,w=this._document.createComment("dom-portal");x.parentNode.insertBefore(w,x),this.outletElement.appendChild(x),this._attachedPortal=g,super.setDisposeFn(()=>{w.parentNode&&w.parentNode.replaceChild(x,w)})},this._document=f}attachComponentPortal(o){const a=(o.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(o.component);let u;return o.viewContainerRef?(u=o.viewContainerRef.createComponent(a,o.viewContainerRef.length,o.injector||o.viewContainerRef.injector,o.projectableNodes||void 0),this.setDisposeFn(()=>u.destroy())):(u=a.create(o.injector||this._defaultInjector||Or.NULL),this._appRef.attachView(u.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(u.hostView),u.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(u)),this._attachedPortal=o,u}attachTemplatePortal(o){let i=o.viewContainerRef,a=i.createEmbeddedView(o.templateRef,o.context,{injector:o.injector});return a.rootNodes.forEach(u=>this.outletElement.appendChild(u)),a.detectChanges(),this.setDisposeFn(()=>{let u=i.indexOf(a);-1!==u&&i.remove(u)}),this._attachedPortal=o,a}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(o){return o.hostView.rootNodes[0]}}let TG=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({})}return e})();const rB=g$();class DG{constructor(o,i){this._viewportRuler=o,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=i}attach(){}enable(){if(this._canBeEnabled()){const o=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=o.style.left||"",this._previousHTMLStyles.top=o.style.top||"",o.style.left=_o(-this._previousScrollPosition.left),o.style.top=_o(-this._previousScrollPosition.top),o.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const o=this._document.documentElement,a=o.style,u=this._document.body.style,f=a.scrollBehavior||"",g=u.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,o.classList.remove("cdk-global-scrollblock"),rB&&(a.scrollBehavior=u.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),rB&&(a.scrollBehavior=f,u.scrollBehavior=g)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const i=this._document.body,a=this._viewportRuler.getViewportSize();return i.scrollHeight>a.height||i.scrollWidth>a.width}}class IG{constructor(o,i,a,u){this._scrollDispatcher=o,this._ngZone=i,this._viewportRuler=a,this._config=u,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(o){this._overlayRef=o}enable(){if(this._scrollSubscription)return;const o=this._scrollDispatcher.scrolled(0).pipe(Rs(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=o.subscribe(()=>{const i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=o.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class oB{enable(){}disable(){}attach(){}}function Ck(e,o){return o.some(i=>e.bottom<i.top||e.top>i.bottom||e.right<i.left||e.left>i.right)}function sB(e,o){return o.some(i=>e.top<i.top||e.bottom>i.bottom||e.left<i.left||e.right>i.right)}class AG{constructor(o,i,a,u){this._scrollDispatcher=o,this._viewportRuler=i,this._ngZone=a,this._config=u,this._scrollSubscription=null}attach(o){this._overlayRef=o}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:u}=this._viewportRuler.getViewportSize();Ck(i,[{width:a,height:u,bottom:u,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let RG=(()=>{class e{constructor(i,a,u,f){this._scrollDispatcher=i,this._viewportRuler=a,this._ngZone=u,this.noop=()=>new oB,this.close=g=>new IG(this._scrollDispatcher,this._ngZone,this._viewportRuler,g),this.block=()=>new DG(this._viewportRuler,this._document),this.reposition=g=>new AG(this._scrollDispatcher,this._viewportRuler,this._ngZone,g),this._document=f}static#t=this.\u0275fac=function(a){return new(a||e)(bt(xG),bt(bk),bt(Je),bt(Qn))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class aB{constructor(o){if(this.scrollStrategy=new oB,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,o){const i=Object.keys(o);for(const a of i)void 0!==o[a]&&(this[a]=o[a])}}}class PG{constructor(o,i){this.connectionPair=o,this.scrollableViewProperties=i}}let lB=(()=>{class e{constructor(i){this._attachedOverlays=[],this._document=i}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){const a=this._attachedOverlays.indexOf(i);a>-1&&this._attachedOverlays.splice(a,1),0===this._attachedOverlays.length&&this.detach()}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),OG=(()=>{class e extends lB{constructor(i,a){super(i),this._ngZone=a,this._keydownListener=u=>{const f=this._attachedOverlays;for(let g=f.length-1;g>-1;g--)if(f[g]._keydownEvents.observers.length>0){const x=f[g]._keydownEvents;this._ngZone?this._ngZone.run(()=>x.next(u)):x.next(u);break}}}add(i){super.add(i),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn),bt(Je,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),kG=(()=>{class e extends lB{constructor(i,a,u){super(i),this._platform=a,this._ngZone=u,this._cursorStyleIsSet=!1,this._pointerDownListener=f=>{this._pointerDownEventTarget=Xf(f)},this._clickListener=f=>{const g=Xf(f),x="click"===f.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:g;this._pointerDownEventTarget=null;const w=this._attachedOverlays.slice();for(let T=w.length-1;T>-1;T--){const A=w[T];if(A._outsidePointerEvents.observers.length<1||!A.hasAttached())continue;if(A.overlayElement.contains(g)||A.overlayElement.contains(x))break;const k=A._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>k.next(f)):k.next(f)}}}add(i){if(super.add(i),!this._isAttached){const a=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(a)):this._addEventListeners(a),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn),bt(dl),bt(Je,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),cB=(()=>{class e{constructor(i,a){this._platform=a,this._document=i}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const i="cdk-overlay-container";if(this._platform.isBrowser||sk()){const u=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let f=0;f<u.length;f++)u[f].remove()}const a=this._document.createElement("div");a.classList.add(i),sk()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}static#t=this.\u0275fac=function(a){return new(a||e)(bt(Qn),bt(dl))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class FG{constructor(o,i,a,u,f,g,x,w,T,A=!1){this._portalOutlet=o,this._host=i,this._pane=a,this._config=u,this._ngZone=f,this._keyboardDispatcher=g,this._document=x,this._location=w,this._outsideClickDispatcher=T,this._animationsDisabled=A,this._backdropElement=null,this._backdropClick=new xn,this._attachments=new xn,this._detachments=new xn,this._locationChanges=st.EMPTY,this._backdropClickHandler=k=>this._backdropClick.next(k),this._backdropTransitionendHandler=k=>{this._disposeBackdrop(k.target)},this._keydownEvents=new xn,this._outsidePointerEvents=new xn,u.scrollStrategy&&(this._scrollStrategy=u.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=u.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(o){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const i=this._portalOutlet.attach(o);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Vu(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof i?.onDestroy&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const o=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),o}dispose(){const o=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,o&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(o){o!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=o,this.hasAttached()&&(o.attach(this),this.updatePosition()))}updateSize(o){this._config={...this._config,...o},this._updateElementSize()}setDirection(o){this._config={...this._config,direction:o},this._updateElementDirection()}addPanelClass(o){this._pane&&this._toggleClasses(this._pane,o,!0)}removePanelClass(o){this._pane&&this._toggleClasses(this._pane,o,!1)}getDirection(){const o=this._config.direction;return o?"string"==typeof o?o:o.value:"ltr"}updateScrollStrategy(o){o!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=o,this.hasAttached()&&(o.attach(this),o.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const o=this._pane.style;o.width=_o(this._config.width),o.height=_o(this._config.height),o.minWidth=_o(this._config.minWidth),o.minHeight=_o(this._config.minHeight),o.maxWidth=_o(this._config.maxWidth),o.maxHeight=_o(this._config.maxHeight)}_togglePointerEvents(o){this._pane.style.pointerEvents=o?"":"none"}_attachBackdrop(){const o="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(o)})}):this._backdropElement.classList.add(o)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const o=this._backdropElement;if(o){if(this._animationsDisabled)return void this._disposeBackdrop(o);o.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{o.addEventListener("transitionend",this._backdropTransitionendHandler)}),o.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(o)},500))}}_toggleClasses(o,i,a){const u=oI(i||[]).filter(f=>!!f);u.length&&(a?o.classList.add(...u):o.classList.remove(...u))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const o=this._ngZone.onStable.pipe(Ca(uc(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),o.unsubscribe())})})}_disposeScrollStrategy(){const o=this._scrollStrategy;o&&(o.disable(),o.detach&&o.detach())}_disposeBackdrop(o){o&&(o.removeEventListener("click",this._backdropClickHandler),o.removeEventListener("transitionend",this._backdropTransitionendHandler),o.remove(),this._backdropElement===o&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const uB="cdk-overlay-connected-position-bounding-box",LG=/([A-Za-z%]+)$/;class NG{get positions(){return this._preferredPositions}constructor(o,i,a,u,f){this._viewportRuler=i,this._document=a,this._platform=u,this._overlayContainer=f,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new xn,this._resizeSubscription=st.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(o)}attach(o){this._validatePositions(),o.hostElement.classList.add(uB),this._overlayRef=o,this._boundingBox=o.hostElement,this._pane=o.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const o=this._originRect,i=this._overlayRect,a=this._viewportRect,u=this._containerRect,f=[];let g;for(let x of this._preferredPositions){let w=this._getOriginPoint(o,u,x),T=this._getOverlayPoint(w,i,x),A=this._getOverlayFit(T,i,a,x);if(A.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(x,w);this._canFitWithFlexibleDimensions(A,T,a)?f.push({position:x,origin:w,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(w,x)}):(!g||g.overlayFit.visibleArea<A.visibleArea)&&(g={overlayFit:A,overlayPoint:T,originPoint:w,position:x,overlayRect:i})}if(f.length){let x=null,w=-1;for(const T of f){const A=T.boundingBoxRect.width*T.boundingBoxRect.height*(T.position.weight||1);A>w&&(w=A,x=T)}return this._isPushed=!1,void this._applyPosition(x.position,x.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(g.position,g.originPoint);this._applyPosition(g.position,g.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Dg(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(uB),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const o=this._lastPosition;if(o){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._getOriginPoint(this._originRect,this._containerRect,o);this._applyPosition(o,i)}else this.apply()}withScrollableContainers(o){return this._scrollables=o,this}withPositions(o){return this._preferredPositions=o,-1===o.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(o){return this._viewportMargin=o,this}withFlexibleDimensions(o=!0){return this._hasFlexibleDimensions=o,this}withGrowAfterOpen(o=!0){return this._growAfterOpen=o,this}withPush(o=!0){return this._canPush=o,this}withLockedPosition(o=!0){return this._positionLocked=o,this}setOrigin(o){return this._origin=o,this}withDefaultOffsetX(o){return this._offsetX=o,this}withDefaultOffsetY(o){return this._offsetY=o,this}withTransformOriginOn(o){return this._transformOriginSelector=o,this}_getOriginPoint(o,i,a){let u,f;if("center"==a.originX)u=o.left+o.width/2;else{const g=this._isRtl()?o.right:o.left,x=this._isRtl()?o.left:o.right;u="start"==a.originX?g:x}return i.left<0&&(u-=i.left),f="center"==a.originY?o.top+o.height/2:"top"==a.originY?o.top:o.bottom,i.top<0&&(f-=i.top),{x:u,y:f}}_getOverlayPoint(o,i,a){let u,f;return u="center"==a.overlayX?-i.width/2:"start"===a.overlayX?this._isRtl()?-i.width:0:this._isRtl()?0:-i.width,f="center"==a.overlayY?-i.height/2:"top"==a.overlayY?0:-i.height,{x:o.x+u,y:o.y+f}}_getOverlayFit(o,i,a,u){const f=hB(i);let{x:g,y:x}=o,w=this._getOffset(u,"x"),T=this._getOffset(u,"y");w&&(g+=w),T&&(x+=T);let B=0-x,G=x+f.height-a.height,K=this._subtractOverflows(f.width,0-g,g+f.width-a.width),et=this._subtractOverflows(f.height,B,G),ut=K*et;return{visibleArea:ut,isCompletelyWithinViewport:f.width*f.height===ut,fitsInViewportVertically:et===f.height,fitsInViewportHorizontally:K==f.width}}_canFitWithFlexibleDimensions(o,i,a){if(this._hasFlexibleDimensions){const u=a.bottom-i.y,f=a.right-i.x,g=dB(this._overlayRef.getConfig().minHeight),x=dB(this._overlayRef.getConfig().minWidth);return(o.fitsInViewportVertically||null!=g&&g<=u)&&(o.fitsInViewportHorizontally||null!=x&&x<=f)}return!1}_pushOverlayOnScreen(o,i,a){if(this._previousPushAmount&&this._positionLocked)return{x:o.x+this._previousPushAmount.x,y:o.y+this._previousPushAmount.y};const u=hB(i),f=this._viewportRect,g=Math.max(o.x+u.width-f.width,0),x=Math.max(o.y+u.height-f.height,0),w=Math.max(f.top-a.top-o.y,0),T=Math.max(f.left-a.left-o.x,0);let A=0,k=0;return A=u.width<=f.width?T||-g:o.x<this._viewportMargin?f.left-a.left-o.x:0,k=u.height<=f.height?w||-x:o.y<this._viewportMargin?f.top-a.top-o.y:0,this._previousPushAmount={x:A,y:k},{x:o.x+A,y:o.y+k}}_applyPosition(o,i){if(this._setTransformOrigin(o),this._setOverlayElementStyles(i,o),this._setBoundingBoxStyles(i,o),o.panelClass&&this._addPanelClasses(o.panelClass),this._lastPosition=o,this._positionChanges.observers.length){const a=this._getScrollVisibility(),u=new PG(o,a);this._positionChanges.next(u)}this._isInitialRender=!1}_setTransformOrigin(o){if(!this._transformOriginSelector)return;const i=this._boundingBox.querySelectorAll(this._transformOriginSelector);let a,u=o.overlayY;a="center"===o.overlayX?"center":this._isRtl()?"start"===o.overlayX?"right":"left":"start"===o.overlayX?"left":"right";for(let f=0;f<i.length;f++)i[f].style.transformOrigin=`${a} ${u}`}_calculateBoundingBoxRect(o,i){const a=this._viewportRect,u=this._isRtl();let f,g,x,A,k,B;if("top"===i.overlayY)g=o.y,f=a.height-g+this._viewportMargin;else if("bottom"===i.overlayY)x=a.height-o.y+2*this._viewportMargin,f=a.height-x+this._viewportMargin;else{const G=Math.min(a.bottom-o.y+a.top,o.y),K=this._lastBoundingBoxSize.height;f=2*G,g=o.y-G,f>K&&!this._isInitialRender&&!this._growAfterOpen&&(g=o.y-K/2)}if("end"===i.overlayX&&!u||"start"===i.overlayX&&u)B=a.width-o.x+this._viewportMargin,A=o.x-this._viewportMargin;else if("start"===i.overlayX&&!u||"end"===i.overlayX&&u)k=o.x,A=a.right-o.x;else{const G=Math.min(a.right-o.x+a.left,o.x),K=this._lastBoundingBoxSize.width;A=2*G,k=o.x-G,A>K&&!this._isInitialRender&&!this._growAfterOpen&&(k=o.x-K/2)}return{top:g,left:k,bottom:x,right:B,width:A,height:f}}_setBoundingBoxStyles(o,i){const a=this._calculateBoundingBoxRect(o,i);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));const u={};if(this._hasExactPosition())u.top=u.left="0",u.bottom=u.right=u.maxHeight=u.maxWidth="",u.width=u.height="100%";else{const f=this._overlayRef.getConfig().maxHeight,g=this._overlayRef.getConfig().maxWidth;u.height=_o(a.height),u.top=_o(a.top),u.bottom=_o(a.bottom),u.width=_o(a.width),u.left=_o(a.left),u.right=_o(a.right),u.alignItems="center"===i.overlayX?"center":"end"===i.overlayX?"flex-end":"flex-start",u.justifyContent="center"===i.overlayY?"center":"bottom"===i.overlayY?"flex-end":"flex-start",f&&(u.maxHeight=_o(f)),g&&(u.maxWidth=_o(g))}this._lastBoundingBoxSize=a,Dg(this._boundingBox.style,u)}_resetBoundingBoxStyles(){Dg(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Dg(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(o,i){const a={},u=this._hasExactPosition(),f=this._hasFlexibleDimensions,g=this._overlayRef.getConfig();if(u){const A=this._viewportRuler.getViewportScrollPosition();Dg(a,this._getExactOverlayY(i,o,A)),Dg(a,this._getExactOverlayX(i,o,A))}else a.position="static";let x="",w=this._getOffset(i,"x"),T=this._getOffset(i,"y");w&&(x+=`translateX(${w}px) `),T&&(x+=`translateY(${T}px)`),a.transform=x.trim(),g.maxHeight&&(u?a.maxHeight=_o(g.maxHeight):f&&(a.maxHeight="")),g.maxWidth&&(u?a.maxWidth=_o(g.maxWidth):f&&(a.maxWidth="")),Dg(this._pane.style,a)}_getExactOverlayY(o,i,a){let u={top:"",bottom:""},f=this._getOverlayPoint(i,this._overlayRect,o);return this._isPushed&&(f=this._pushOverlayOnScreen(f,this._overlayRect,a)),"bottom"===o.overlayY?u.bottom=this._document.documentElement.clientHeight-(f.y+this._overlayRect.height)+"px":u.top=_o(f.y),u}_getExactOverlayX(o,i,a){let g,u={left:"",right:""},f=this._getOverlayPoint(i,this._overlayRect,o);return this._isPushed&&(f=this._pushOverlayOnScreen(f,this._overlayRect,a)),g=this._isRtl()?"end"===o.overlayX?"left":"right":"end"===o.overlayX?"right":"left","right"===g?u.right=this._document.documentElement.clientWidth-(f.x+this._overlayRect.width)+"px":u.left=_o(f.x),u}_getScrollVisibility(){const o=this._getOriginRect(),i=this._pane.getBoundingClientRect(),a=this._scrollables.map(u=>u.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:sB(o,a),isOriginOutsideView:Ck(o,a),isOverlayClipped:sB(i,a),isOverlayOutsideView:Ck(i,a)}}_subtractOverflows(o,...i){return i.reduce((a,u)=>a-Math.max(u,0),o)}_getNarrowedViewportRect(){const o=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+o-this._viewportMargin,bottom:a.top+i-this._viewportMargin,width:o-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(o,i){return"x"===i?null==o.offsetX?this._offsetX:o.offsetX:null==o.offsetY?this._offsetY:o.offsetY}_validatePositions(){}_addPanelClasses(o){this._pane&&oI(o).forEach(i=>{""!==i&&-1===this._appliedPanelClasses.indexOf(i)&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(o=>{this._pane.classList.remove(o)}),this._appliedPanelClasses=[])}_getOriginRect(){const o=this._origin;if(o instanceof Gi)return o.nativeElement.getBoundingClientRect();if(o instanceof Element)return o.getBoundingClientRect();const i=o.width||0,a=o.height||0;return{top:o.y,bottom:o.y+a,left:o.x,right:o.x+i,height:a,width:i}}}function Dg(e,o){for(let i in o)o.hasOwnProperty(i)&&(e[i]=o[i]);return e}function dB(e){if("number"!=typeof e&&null!=e){const[o,i]=e.split(LG);return i&&"px"!==i?null:parseFloat(o)}return e||null}function hB(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const fB="cdk-global-overlay-wrapper";class zG{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(o){const i=o.getConfig();this._overlayRef=o,this._width&&!i.width&&o.updateSize({width:this._width}),this._height&&!i.height&&o.updateSize({height:this._height}),o.hostElement.classList.add(fB),this._isDisposed=!1}top(o=""){return this._bottomOffset="",this._topOffset=o,this._alignItems="flex-start",this}left(o=""){return this._xOffset=o,this._xPosition="left",this}bottom(o=""){return this._topOffset="",this._bottomOffset=o,this._alignItems="flex-end",this}right(o=""){return this._xOffset=o,this._xPosition="right",this}start(o=""){return this._xOffset=o,this._xPosition="start",this}end(o=""){return this._xOffset=o,this._xPosition="end",this}width(o=""){return this._overlayRef?this._overlayRef.updateSize({width:o}):this._width=o,this}height(o=""){return this._overlayRef?this._overlayRef.updateSize({height:o}):this._height=o,this}centerHorizontally(o=""){return this.left(o),this._xPosition="center",this}centerVertically(o=""){return this.top(o),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const o=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:u,height:f,maxWidth:g,maxHeight:x}=a,w=!("100%"!==u&&"100vw"!==u||g&&"100%"!==g&&"100vw"!==g),T=!("100%"!==f&&"100vh"!==f||x&&"100%"!==x&&"100vh"!==x),A=this._xPosition,k=this._xOffset,B="rtl"===this._overlayRef.getConfig().direction;let G="",K="",et="";w?et="flex-start":"center"===A?(et="center",B?K=k:G=k):B?"left"===A||"end"===A?(et="flex-end",G=k):("right"===A||"start"===A)&&(et="flex-start",K=k):"left"===A||"start"===A?(et="flex-start",G=k):("right"===A||"end"===A)&&(et="flex-end",K=k),o.position=this._cssPosition,o.marginLeft=w?"0":G,o.marginTop=T?"0":this._topOffset,o.marginBottom=this._bottomOffset,o.marginRight=w?"0":K,i.justifyContent=et,i.alignItems=T?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const o=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,a=i.style;i.classList.remove(fB),a.justifyContent=a.alignItems=o.marginTop=o.marginBottom=o.marginLeft=o.marginRight=o.position="",this._overlayRef=null,this._isDisposed=!0}}let BG=(()=>{class e{constructor(i,a,u,f){this._viewportRuler=i,this._document=a,this._platform=u,this._overlayContainer=f}global(){return new zG}flexibleConnectedTo(i){return new NG(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(bk),bt(Qn),bt(dl),bt(cB))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),VG=0,_I=(()=>{class e{constructor(i,a,u,f,g,x,w,T,A,k,B,G){this.scrollStrategies=i,this._overlayContainer=a,this._componentFactoryResolver=u,this._positionBuilder=f,this._keyboardDispatcher=g,this._injector=x,this._ngZone=w,this._document=T,this._directionality=A,this._location=k,this._outsideClickDispatcher=B,this._animationsModuleType=G}create(i){const a=this._createHostElement(),u=this._createPaneElement(a),f=this._createPortalOutlet(u),g=new aB(i);return g.direction=g.direction||this._directionality.value,new FG(f,a,u,g,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(i){const a=this._document.createElement("div");return a.id="cdk-overlay-"+VG++,a.classList.add("cdk-overlay-pane"),i.appendChild(a),a}_createHostElement(){const i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(ct)),new SG(i,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(RG),bt(cB),bt(dm),bt(BG),bt(OG),bt(Or),bt(Je),bt(Qn),bt(uI),bt(cD),bt(kG),bt(yu,8))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const jG=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],pB=new Gt("cdk-connected-overlay-scroll-strategy");let Mk=(()=>{class e{constructor(i){this.elementRef=i}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gi))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"],standalone:!0})}return e})(),mB=(()=>{class e{get offsetX(){return this._offsetX}set offsetX(i){this._offsetX=i,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(i){this._offsetY=i,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(i){this._hasBackdrop=ia(i)}get lockPosition(){return this._lockPosition}set lockPosition(i){this._lockPosition=ia(i)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(i){this._flexibleDimensions=ia(i)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(i){this._growAfterOpen=ia(i)}get push(){return this._push}set push(i){this._push=ia(i)}constructor(i,a,u,f,g){this._overlay=i,this._dir=g,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=st.EMPTY,this._attachSubscription=st.EMPTY,this._detachSubscription=st.EMPTY,this._positionSubscription=st.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new oi,this.positionChange=new oi,this.attach=new oi,this.detach=new oi,this.overlayKeydown=new oi,this.overlayOutsideClick=new oi,this._templatePortal=new iB(a,u),this._scrollStrategyFactory=f,this.scrollStrategy=this._scrollStrategyFactory()}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(i){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),i.origin&&this.open&&this._position.apply()),i.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=jG);const i=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=i.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=i.detachments().subscribe(()=>this.detach.emit()),i.keydownEvents().subscribe(a=>{this.overlayKeydown.next(a),27===a.keyCode&&!this.disableClose&&!Iw(a)&&(a.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(a=>{this.overlayOutsideClick.next(a)})}_buildConfig(){const i=this._position=this.positionStrategy||this._createPositionStrategy(),a=new aB({direction:this._dir,positionStrategy:i,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(a.width=this.width),(this.height||0===this.height)&&(a.height=this.height),(this.minWidth||0===this.minWidth)&&(a.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(a.minHeight=this.minHeight),this.backdropClass&&(a.backdropClass=this.backdropClass),this.panelClass&&(a.panelClass=this.panelClass),a}_updatePositionStrategy(i){const a=this.positions.map(u=>({originX:u.originX,originY:u.originY,overlayX:u.overlayX,overlayY:u.overlayY,offsetX:u.offsetX||this.offsetX,offsetY:u.offsetY||this.offsetY,panelClass:u.panelClass||void 0}));return i.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(a).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const i=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(i),i}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof Mk?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(i=>{this.backdropClick.emit(i)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(function wG(e,o=!1){return ar((i,a)=>{let u=0;i.subscribe(Ti(a,f=>{const g=e(f,u++);(g||o)&&a.next(f),!g&&a.complete()}))})}(()=>this.positionChange.observers.length>0)).subscribe(i=>{this.positionChange.emit(i),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}static#t=this.\u0275fac=function(a){return new(a||e)(xt(_I),xt(ql),xt(ls),xt(pB),xt(uI,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],standalone:!0,features:[rs]})}return e})();const $G={provide:pB,deps:[_I],useFactory:function UG(e){return()=>e.scrollStrategies.reposition()}};let HG=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({providers:[_I,$G],imports:[Rw,TG,nB,nB]})}return e})();class GG extends xn{constructor(o=1/0,i=1/0,a=hk){super(),this._bufferSize=o,this._windowTime=i,this._timestampProvider=a,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=i===1/0,this._bufferSize=Math.max(1,o),this._windowTime=Math.max(1,i)}next(o){const{isStopped:i,_buffer:a,_infiniteTimeWindow:u,_timestampProvider:f,_windowTime:g}=this;i||(a.push(o),!u&&a.push(f.now()+g)),this._trimBuffer(),super.next(o)}_subscribe(o){this._throwIfClosed(),this._trimBuffer();const i=this._innerSubscribe(o),{_infiniteTimeWindow:a,_buffer:u}=this,f=u.slice();for(let g=0;g<f.length&&!o.closed;g+=a?1:2)o.next(f[g]);return this._checkFinalizedStatuses(o),i}_trimBuffer(){const{_bufferSize:o,_timestampProvider:i,_buffer:a,_infiniteTimeWindow:u}=this,f=(u?1:2)*o;if(o<1/0&&f<a.length&&a.splice(0,a.length-f),!u){const g=i.now();let x=0;for(let w=1;w<a.length&&a[w]<=g;w+=2)x=w;x&&a.splice(0,x+1)}}}class WG{constructor(o){this._box=o,this._destroyed=new xn,this._resizeSubject=new xn,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(i=>this._resizeSubject.next(i)))}observe(o){return this._elementObservables.has(o)||this._elementObservables.set(o,new $n(i=>{const a=this._resizeSubject.subscribe(i);return this._resizeObserver?.observe(o,{box:this._box}),()=>{this._resizeObserver?.unobserve(o),a.unsubscribe(),this._elementObservables.delete(o)}}).pipe(Rs(i=>i.some(a=>a.target===o)),function qG(e,o,i){let a,u=!1;return e&&"object"==typeof e?({bufferSize:a=1/0,windowTime:o=1/0,refCount:u=!1,scheduler:i}=e):a=e??1/0,zn({connector:()=>new GG(a,o,i),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:u})}({bufferSize:1,refCount:!0}),Ca(this._destroyed))),this._elementObservables.get(o)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let ZG=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=ee(Je)}ngOnDestroy(){for(const[,i]of this._observers)i.destroy();this._observers.clear()}observe(i,a){const u=a?.box||"content-box";return this._observers.has(u)||this._observers.set(u,new WG(u)),this._observers.get(u).observe(i)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),XG=(()=>{class e{create(i){return typeof MutationObserver>"u"?null:new MutationObserver(i)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),YG=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({providers:[XG]})}return e})();const KG=["notch"],JG=["matFormFieldNotchedOutline",""],QG=["*"],tq=["textField"],eq=["iconPrefixContainer"],nq=["textPrefixContainer"];function iq(e,o){1&e&&io(0,"span",19)}function rq(e,o){if(1&e&&(Dn(0,"label",17),oo(1,1),Ki(2,iq,1,0,"span",18),Nn()),2&e){const i=ro(2);Cn("floating",i._shouldLabelFloat())("monitorResize",i._hasOutline())("id",i._labelId),Fo("for",i._control.id),mn(2),Cn("ngIf",!i.hideRequiredMarker&&i._control.required)}}function oq(e,o){1&e&&Ki(0,rq,3,5,"label",16),2&e&&Cn("ngIf",ro()._hasFloatingLabel())}function sq(e,o){1&e&&io(0,"div",20)}function aq(e,o){}function lq(e,o){1&e&&Ki(0,aq,0,0,"ng-template",22),2&e&&(ro(2),Cn("ngTemplateOutlet",Lm(1)))}function cq(e,o){if(1&e&&(Dn(0,"div",21),Ki(1,lq,1,1,"ng-template",9),Nn()),2&e){const i=ro();Cn("matFormFieldNotchedOutlineOpen",i._shouldLabelFloat()),mn(1),Cn("ngIf",!i._forceDisplayInfixLabel())}}function uq(e,o){1&e&&(Dn(0,"div",23,24),oo(2,2),Nn())}function dq(e,o){1&e&&(Dn(0,"div",25,26),oo(2,3),Nn())}function hq(e,o){}function fq(e,o){1&e&&Ki(0,hq,0,0,"ng-template",22),2&e&&(ro(),Cn("ngTemplateOutlet",Lm(1)))}function pq(e,o){1&e&&(Dn(0,"div",27),oo(1,4),Nn())}function mq(e,o){1&e&&(Dn(0,"div",28),oo(1,5),Nn())}function gq(e,o){1&e&&io(0,"div",29)}function _q(e,o){1&e&&(Dn(0,"div",30),oo(1,6),Nn()),2&e&&Cn("@transitionMessages",ro()._subscriptAnimationState)}function yq(e,o){if(1&e&&(Dn(0,"mat-hint",34),rl(1),Nn()),2&e){const i=ro(2);Cn("id",i._hintLabelId),mn(1),Gm(i.hintLabel)}}function vq(e,o){if(1&e&&(Dn(0,"div",31),Ki(1,yq,2,2,"mat-hint",32),oo(2,7),io(3,"div",33),oo(4,8),Nn()),2&e){const i=ro();Cn("@transitionMessages",i._subscriptAnimationState),mn(1),Cn("ngIf",i.hintLabel)}}const xq=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],bq=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];let Sk=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275dir=Ee({type:e,selectors:[["mat-label"]]})}return e})();const wq=new Gt("MatError");let Eq=0,gB=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+Eq++}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275dir=Ee({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(a,u){2&a&&(Zm("id",u.id),Fo("align",null),Vr("mat-mdc-form-field-hint-end","end"===u.align))},inputs:{align:"align",id:"id"}})}return e})();const Cq=new Gt("MatPrefix"),Mq=new Gt("MatSuffix"),_B=new Gt("FloatingLabelParent");let yB=(()=>{class e{get floating(){return this._floating}set floating(i){this._floating=i,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(i){this._monitorResize=i,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(i){this._elementRef=i,this._floating=!1,this._monitorResize=!1,this._resizeObserver=ee(ZG),this._ngZone=ee(Je),this._parent=ee(_B),this._resizeSubscription=new st}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function Sq(e){if(null!==e.offsetParent)return e.scrollWidth;const i=e.cloneNode(!0);i.style.setProperty("position","absolute"),i.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(i);const a=i.scrollWidth;return i.remove(),a}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gi))};static#e=this.\u0275dir=Ee({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(a,u){2&a&&Vr("mdc-floating-label--float-above",u.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"}})}return e})();const vB="mdc-line-ripple--active",yI="mdc-line-ripple--deactivating";let xB=(()=>{class e{constructor(i,a){this._elementRef=i,this._handleTransitionEnd=u=>{const f=this._elementRef.nativeElement.classList,g=f.contains(yI);"opacity"===u.propertyName&&g&&f.remove(vB,yI)},a.runOutsideAngular(()=>{i.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const i=this._elementRef.nativeElement.classList;i.remove(yI),i.add(vB)}deactivate(){this._elementRef.nativeElement.classList.add(yI)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gi),xt(Je))};static#e=this.\u0275dir=Ee({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"]})}return e})(),bB=(()=>{class e{constructor(i,a){this._elementRef=i,this._ngZone=a,this.open=!1}ngAfterViewInit(){const i=this._elementRef.nativeElement.querySelector(".mdc-floating-label");i?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(i.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>i.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(i){this._notch.nativeElement.style.width=this.open&&i?`calc(${i}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gi),xt(Je))};static#e=this.\u0275cmp=_s({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(a,u){if(1&a&&Ea(KG,5),2&a){let f;xr(f=rr())&&(u._notch=f.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(a,u){2&a&&Vr("mdc-notched-outline--notched",u.open)},inputs:{open:["matFormFieldNotchedOutlineOpen","open"]},attrs:JG,ngContentSelectors:QG,decls:5,vars:0,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],["notch",""],[1,"mdc-notched-outline__trailing"]],template:function(a,u){1&a&&(Tu(),io(0,"div",0),Dn(1,"div",1,2),oo(3),Nn(),io(4,"div",3))},encapsulation:2,changeDetection:0})}return e})();const Tq={transitionMessages:lO("transitionMessages",[aN("enter",yg({opacity:1,transform:"translateY(0%)"})),CD("void => enter",[yg({opacity:0,transform:"translateY(-5px)"}),cO("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let wB=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275dir=Ee({type:e})}return e})();const EB=new Gt("MatFormField"),Dq=new Gt("MAT_FORM_FIELD_DEFAULT_OPTIONS");let CB=0,Rq=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(i){this._hideRequiredMarker=ia(i)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(i){i!==this._floatLabel&&(this._floatLabel=i,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(i){const a=this._appearance;this._appearance=i||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==a&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(i){this._subscriptSizing=i||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(i){this._hintLabel=i,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(i){this._explicitFormFieldControl=i}constructor(i,a,u,f,g,x,w,T){this._elementRef=i,this._changeDetectorRef=a,this._ngZone=u,this._dir=f,this._platform=g,this._defaults=x,this._animationMode=w,this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+CB++,this._hintLabelId="mat-mdc-hint-"+CB++,this._subscriptAnimationState="",this._destroyed=new xn,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,x&&(x.appearance&&(this.appearance=x.appearance),this._hideRequiredMarker=!!x?.hideRequiredMarker,x.color&&(this.color=x.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){const i=this._control;i.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${i.controlType}`),i.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),i.ngControl&&i.ngControl.valueChanges&&i.ngControl.valueChanges.pipe(Ca(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(i=>!i._isText),this._hasTextPrefix=!!this._prefixChildren.find(i=>i._isText),this._hasIconSuffix=!!this._suffixChildren.find(i=>!i._isText),this._hasTextSuffix=!!this._suffixChildren.find(i=>i._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),uc(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Ca(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(Ca(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(i){const a=this._control?this._control.ngControl:null;return a&&a[i]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let i=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&i.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const a=this._hintChildren?this._hintChildren.find(f=>"start"===f.align):null,u=this._hintChildren?this._hintChildren.find(f=>"end"===f.align):null;a?i.push(a.id):this._hintLabel&&i.push(this._hintLabelId),u&&i.push(u.id)}else this._errorChildren&&i.push(...this._errorChildren.map(a=>a.id));this._control.setDescribedByIds(i)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;const i=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(i.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdateOnStable=!0);const a=this._iconPrefixContainer?.nativeElement,u=this._textPrefixContainer?.nativeElement,f=a?.getBoundingClientRect().width??0,g=u?.getBoundingClientRect().width??0;i.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${f+g}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`}_isAttachedToDom(){const i=this._elementRef.nativeElement;if(i.getRootNode){const a=i.getRootNode();return a&&a!==i}return document.documentElement.contains(i)}static#t=this.\u0275fac=function(a){return new(a||e)(xt(Gi),xt(Le),xt(Je),xt(uI),xt(dl),xt(Dq,8),xt(yu,8),xt(Qn))};static#e=this.\u0275cmp=_s({type:e,selectors:[["mat-form-field"]],contentQueries:function(a,u,f){if(1&a&&(Ks(f,Sk,5),Ks(f,Sk,7),Ks(f,wB,5),Ks(f,Cq,5),Ks(f,Mq,5),Ks(f,wq,5),Ks(f,gB,5)),2&a){let g;xr(g=rr())&&(u._labelChildNonStatic=g.first),xr(g=rr())&&(u._labelChildStatic=g.first),xr(g=rr())&&(u._formFieldControl=g.first),xr(g=rr())&&(u._prefixChildren=g),xr(g=rr())&&(u._suffixChildren=g),xr(g=rr())&&(u._errorChildren=g),xr(g=rr())&&(u._hintChildren=g)}},viewQuery:function(a,u){if(1&a&&(Ea(tq,5),Ea(eq,5),Ea(nq,5),Ea(yB,5),Ea(bB,5),Ea(xB,5)),2&a){let f;xr(f=rr())&&(u._textField=f.first),xr(f=rr())&&(u._iconPrefixContainer=f.first),xr(f=rr())&&(u._textPrefixContainer=f.first),xr(f=rr())&&(u._floatingLabel=f.first),xr(f=rr())&&(u._notchedOutline=f.first),xr(f=rr())&&(u._lineRipple=f.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(a,u){2&a&&Vr("mat-mdc-form-field-label-always-float",u._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",u._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",u._hasIconSuffix)("mat-form-field-invalid",u._control.errorState)("mat-form-field-disabled",u._control.disabled)("mat-form-field-autofilled",u._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===u._animationMode)("mat-form-field-appearance-fill","fill"==u.appearance)("mat-form-field-appearance-outline","outline"==u.appearance)("mat-form-field-hide-placeholder",u._hasFloatingLabel()&&!u._shouldLabelFloat())("mat-focused",u._control.focused)("mat-primary","accent"!==u.color&&"warn"!==u.color)("mat-accent","accent"===u.color)("mat-warn","warn"===u.color)("ng-untouched",u._shouldForward("untouched"))("ng-touched",u._shouldForward("touched"))("ng-pristine",u._shouldForward("pristine"))("ng-dirty",u._shouldForward("dirty"))("ng-valid",u._shouldForward("valid"))("ng-invalid",u._shouldForward("invalid"))("ng-pending",u._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],features:[Ji([{provide:EB,useExisting:e},{provide:_B,useExisting:e}])],ngContentSelectors:bq,decls:18,vars:23,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay",4,"ngIf"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen",4,"ngIf"],["class","mat-mdc-form-field-icon-prefix",4,"ngIf"],["class","mat-mdc-form-field-text-prefix",4,"ngIf"],[1,"mat-mdc-form-field-infix"],[3,"ngIf"],["class","mat-mdc-form-field-text-suffix",4,"ngIf"],["class","mat-mdc-form-field-icon-suffix",4,"ngIf"],["matFormFieldLineRipple","",4,"ngIf"],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align",3,"ngSwitch"],["class","mat-mdc-form-field-error-wrapper",4,"ngSwitchCase"],["class","mat-mdc-form-field-hint-wrapper",4,"ngSwitchCase"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id",4,"ngIf"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required",4,"ngIf"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id",4,"ngIf"],[1,"mat-mdc-form-field-hint-spacer"],[3,"id"]],template:function(a,u){1&a&&(Tu(xq),Ki(0,oq,1,1,"ng-template",null,0,$T),Dn(2,"div",1,2),Fr("click",function(g){return u._control.onContainerClick(g)}),Ki(4,sq,1,0,"div",3),Dn(5,"div",4),Ki(6,cq,2,2,"div",5),Ki(7,uq,3,0,"div",6),Ki(8,dq,3,0,"div",7),Dn(9,"div",8),Ki(10,fq,1,1,"ng-template",9),oo(11),Nn(),Ki(12,pq,2,0,"div",10),Ki(13,mq,2,0,"div",11),Nn(),Ki(14,gq,1,0,"div",12),Nn(),Dn(15,"div",13),Ki(16,_q,2,1,"div",14),Ki(17,vq,5,2,"div",15),Nn()),2&a&&(mn(2),Vr("mdc-text-field--filled",!u._hasOutline())("mdc-text-field--outlined",u._hasOutline())("mdc-text-field--no-label",!u._hasFloatingLabel())("mdc-text-field--disabled",u._control.disabled)("mdc-text-field--invalid",u._control.errorState),mn(2),Cn("ngIf",!u._hasOutline()&&!u._control.disabled),mn(2),Cn("ngIf",u._hasOutline()),mn(1),Cn("ngIf",u._hasIconPrefix),mn(1),Cn("ngIf",u._hasTextPrefix),mn(2),Cn("ngIf",!u._hasOutline()||u._forceDisplayInfixLabel()),mn(2),Cn("ngIf",u._hasTextSuffix),mn(1),Cn("ngIf",u._hasIconSuffix),mn(1),Cn("ngIf",!u._hasOutline()),mn(1),Vr("mat-mdc-form-field-subscript-dynamic-size","dynamic"===u.subscriptSizing),Cn("ngSwitch",u._getDisplayedMessages()),mn(1),Cn("ngSwitchCase","error"),mn(1),Cn("ngSwitchCase","hint"))},dependencies:[GP,PL,pw,WP,gB,yB,bB,xB],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 96px / 0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px * 2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{--mdc-filled-text-field-active-indicator-height:1px;--mdc-filled-text-field-focus-active-indicator-height:2px;--mdc-filled-text-field-container-shape:4px;border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined{--mdc-outlined-text-field-outline-width:1px;--mdc-outlined-text-field-focus-outline-width:2px;--mdc-outlined-text-field-container-shape:4px}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size) * var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:12px;box-sizing:content-box}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[Tq.transitionMessages]},changeDetection:0})}return e})(),TB=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[tc,xD,YG,tc]})}return e})();class Pq{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(o=!1,i,a=!0,u){this._multiple=o,this._emitChanges=a,this.compareWith=u,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new xn,i&&i.length&&(o?i.forEach(f=>this._markSelected(f)):this._markSelected(i[0]),this._selectedToEmit.length=0)}select(...o){this._verifyValueAssignment(o),o.forEach(a=>this._markSelected(a));const i=this._hasQueuedChanges();return this._emitChangeEvent(),i}deselect(...o){this._verifyValueAssignment(o),o.forEach(a=>this._unmarkSelected(a));const i=this._hasQueuedChanges();return this._emitChangeEvent(),i}setSelection(...o){this._verifyValueAssignment(o);const i=this.selected,a=new Set(o);o.forEach(f=>this._markSelected(f)),i.filter(f=>!a.has(f)).forEach(f=>this._unmarkSelected(f));const u=this._hasQueuedChanges();return this._emitChangeEvent(),u}toggle(o){return this.isSelected(o)?this.deselect(o):this.select(o)}clear(o=!0){this._unmarkAll();const i=this._hasQueuedChanges();return o&&this._emitChangeEvent(),i}isSelected(o){return this._selection.has(this._getConcreteValue(o))}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(o){this._multiple&&this.selected&&this._selected.sort(o)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(o){o=this._getConcreteValue(o),this.isSelected(o)||(this._multiple||this._unmarkAll(),this.isSelected(o)||this._selection.add(o),this._emitChanges&&this._selectedToEmit.push(o))}_unmarkSelected(o){o=this._getConcreteValue(o),this.isSelected(o)&&(this._selection.delete(o),this._emitChanges&&this._deselectedToEmit.push(o))}_unmarkAll(){this.isEmpty()||this._selection.forEach(o=>this._unmarkSelected(o))}_verifyValueAssignment(o){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}_getConcreteValue(o){if(this.compareWith){for(let i of this._selection)if(this.compareWith(o,i))return i;return o}return o}}function Tk(e){return new $n(o=>{bn(e()).subscribe(o)})}const Oq=["trigger"],kq=["panel"];function Fq(e,o){if(1&e&&(Dn(0,"span",10),rl(1),Nn()),2&e){const i=ro();mn(1),Gm(i.placeholder)}}function Lq(e,o){if(1&e&&(Dn(0,"span",14),rl(1),Nn()),2&e){const i=ro(2);mn(1),Gm(i.triggerValue)}}function Nq(e,o){1&e&&oo(0,0,["*ngSwitchCase","true"])}function zq(e,o){1&e&&(Dn(0,"span",11),Ki(1,Lq,2,1,"span",12),Ki(2,Nq,1,0,"ng-content",13),Nn()),2&e&&(Cn("ngSwitch",!!ro().customTrigger),mn(2),Cn("ngSwitchCase",!0))}function Bq(e,o){if(1&e){const i=function cS(){return Nt()}();Rl(),function Pp(){!function Y0(){qe.lFrame.currentNamespace=null}()}(),Dn(0,"div",15,16),Fr("@transformPanel.done",function(u){return Go(i),Il(ro()._panelDoneAnimatingStream.next(u.toState))})("keydown",function(u){return Go(i),Il(ro()._handleKeydown(u))}),oo(2,1),Nn()}if(2&e){const i=ro();NS("mat-mdc-select-panel mdc-menu-surface mdc-menu-surface--open ",i._getPanelTheme(),""),Cn("ngClass",i.panelClass)("@transformPanel","showing"),Fo("id",i.id+"-panel")("aria-multiselectable",i.multiple)("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby())}}const Vq=[[["mat-select-trigger"]],"*"],jq=["mat-select-trigger","*"],Uq={transformPanelWrap:lO("transformPanelWrap",[CD("* => void",zj("@transformPanel",[Nj()],{optional:!0}))]),transformPanel:lO("transformPanel",[aN("void",yg({opacity:0,transform:"scale(1, 0.8)"})),CD("void => showing",cO("120ms cubic-bezier(0, 0, 0.2, 1)",yg({opacity:1,transform:"scale(1, 1)"}))),CD("* => void",cO("100ms linear",yg({opacity:0})))])};let DB=0;const IB=new Gt("mat-select-scroll-strategy"),Hq=new Gt("MAT_SELECT_CONFIG"),Gq={provide:IB,deps:[_I],useFactory:function $q(e){return()=>e.scrollStrategies.reposition()}},qq=new Gt("MatSelectTrigger");class Wq{constructor(o,i){this.source=o,this.value=i}}const Zq=Oz(wH(Pz(EH(class{constructor(e,o,i,a,u){this._elementRef=e,this._defaultErrorStateMatcher=o,this._parentForm=i,this._parentFormGroup=a,this.ngControl=u,this.stateChanges=new xn}}))));let Xq=(()=>{class e extends Zq{get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(i){this._placeholder=i,this.stateChanges.next()}get required(){return this._required??this.ngControl?.control?.hasValidator(b8.required)??!1}set required(i){this._required=ia(i),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(i){this._multiple=ia(i)}get disableOptionCentering(){return this._disableOptionCentering}set disableOptionCentering(i){this._disableOptionCentering=ia(i)}get compareWith(){return this._compareWith}set compareWith(i){this._compareWith=i,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(i){this._assignValue(i)&&this._onChange(i)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(i){this._typeaheadDebounceInterval=_z(i)}get id(){return this._id}set id(i){this._id=i||this._uid,this.stateChanges.next()}constructor(i,a,u,f,g,x,w,T,A,k,B,G,K,et){super(g,f,w,T,k),this._viewportRuler=i,this._changeDetectorRef=a,this._ngZone=u,this._dir=x,this._parentFormField=A,this._liveAnnouncer=K,this._defaultOptions=et,this._panelOpen=!1,this._compareWith=(ut,_t)=>ut===_t,this._uid="mat-select-"+DB++,this._triggerAriaLabelledBy=null,this._destroy=new xn,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="mat-select-value-"+DB++,this._panelDoneAnimatingStream=new xn,this._overlayPanelClass=this._defaultOptions?.overlayPanelClass||"",this._focused=!1,this.controlType="mat-select",this._multiple=!1,this._disableOptionCentering=this._defaultOptions?.disableOptionCentering??!1,this.ariaLabel="",this.optionSelectionChanges=Tk(()=>{const ut=this.options;return ut?ut.changes.pipe(lI(ut),Hr(()=>uc(...ut.map(_t=>_t.onSelectionChange)))):this._ngZone.onStable.pipe(Vu(1),Hr(()=>this.optionSelectionChanges))}),this.openedChange=new oi,this._openedStream=this.openedChange.pipe(Rs(ut=>ut),cn(()=>{})),this._closedStream=this.openedChange.pipe(Rs(ut=>!ut),cn(()=>{})),this.selectionChange=new oi,this.valueChange=new oi,this._trackedModal=null,this.ngControl&&(this.ngControl.valueAccessor=this),null!=et?.typeaheadDebounceInterval&&(this._typeaheadDebounceInterval=et.typeaheadDebounceInterval),this._scrollStrategyFactory=G,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(B)||0,this.id=this.id}ngOnInit(){this._selectionModel=new Pq(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(Xu(),Ca(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen))}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Ca(this._destroy)).subscribe(i=>{i.added.forEach(a=>a.select()),i.removed.forEach(a=>a.deselect())}),this.options.changes.pipe(lI(null),Ca(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const i=this._getTriggerAriaLabelledby(),a=this.ngControl;if(i!==this._triggerAriaLabelledBy){const u=this._elementRef.nativeElement;this._triggerAriaLabelledBy=i,i?u.setAttribute("aria-labelledby",i):u.removeAttribute("aria-labelledby")}a&&(this._previousControl!==a.control&&(void 0!==this._previousControl&&null!==a.disabled&&a.disabled!==this.disabled&&(this.disabled=a.disabled),this._previousControl=a.control),this.updateErrorState())}ngOnChanges(i){(i.disabled||i.userAriaDescribedBy)&&this.stateChanges.next(),i.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._keyManager?.destroy(),this._destroy.next(),this._destroy.complete(),this.stateChanges.complete(),this._clearFromModal()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._applyModalPanelOwnership(),this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck())}_applyModalPanelOwnership(){const i=this._elementRef.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!i)return;const a=`${this.id}-panel`;this._trackedModal&&wz(this._trackedModal,"aria-owns",a),function U$(e,o,i){const a=Ez(e,o);a.some(u=>u.trim()==i.trim())||(a.push(i.trim()),e.setAttribute(o,a.join(" ")))}(i,"aria-owns",a),this._trackedModal=i}_clearFromModal(){this._trackedModal&&(wz(this._trackedModal,"aria-owns",`${this.id}-panel`),this._trackedModal=null)}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(i){this._assignValue(i)}registerOnChange(i){this._onChange=i}registerOnTouched(i){this._onTouched=i}setDisabledState(i){this.disabled=i,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel?.selected||[]:this._selectionModel?.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){const i=this._selectionModel.selected.map(a=>a.viewValue);return this._isRtl()&&i.reverse(),i.join(", ")}return this._selectionModel.selected[0].viewValue}_isRtl(){return!!this._dir&&"rtl"===this._dir.value}_handleKeydown(i){this.disabled||(this.panelOpen?this._handleOpenKeydown(i):this._handleClosedKeydown(i))}_handleClosedKeydown(i){const a=i.keyCode,u=40===a||38===a||37===a||39===a,f=13===a||32===a,g=this._keyManager;if(!g.isTyping()&&f&&!Iw(i)||(this.multiple||i.altKey)&&u)i.preventDefault(),this.open();else if(!this.multiple){const x=this.selected;g.onKeydown(i);const w=this.selected;w&&x!==w&&this._liveAnnouncer.announce(w.viewValue,1e4)}}_handleOpenKeydown(i){const a=this._keyManager,u=i.keyCode,f=40===u||38===u,g=a.isTyping();if(f&&i.altKey)i.preventDefault(),this.close();else if(g||13!==u&&32!==u||!a.activeItem||Iw(i))if(!g&&this._multiple&&65===u&&i.ctrlKey){i.preventDefault();const x=this.options.some(w=>!w.disabled&&!w.selected);this.options.forEach(w=>{w.disabled||(x?w.select():w.deselect())})}else{const x=a.activeItemIndex;a.onKeydown(i),this._multiple&&f&&i.shiftKey&&a.activeItem&&a.activeItemIndex!==x&&a.activeItem._selectViaInteraction()}else i.preventDefault(),a.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,this._keyManager?.cancelTypeahead(),!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this._overlayDir.positionChange.pipe(Vu(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(i){if(this.options.forEach(a=>a.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&i)Array.isArray(i),i.forEach(a=>this._selectOptionByValue(a)),this._sortValues();else{const a=this._selectOptionByValue(i);a?this._keyManager.updateActiveItem(a):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(i){const a=this.options.find(u=>{if(this._selectionModel.isSelected(u))return!1;try{return null!=u.value&&this._compareWith(u.value,i)}catch{return!1}});return a&&this._selectionModel.select(a),a}_assignValue(i){return!!(i!==this._value||this._multiple&&Array.isArray(i))&&(this.options&&this._setSelectionByValue(i),this._value=i,!0)}_skipPredicate(i){return i.disabled}_initKeyManager(){this._keyManager=new q$(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withPageUpDown().withAllowedModifierKeys(["shiftKey"]).skipPredicate(this._skipPredicate),this._keyManager.tabOut.subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const i=uc(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Ca(i)).subscribe(a=>{this._onSelect(a.source,a.isUserInput),a.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),uc(...this.options.map(a=>a._stateChanges)).pipe(Ca(i)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this.stateChanges.next()})}_onSelect(i,a){const u=this._selectionModel.isSelected(i);null!=i.value||this._multiple?(u!==i.selected&&(i.selected?this._selectionModel.select(i):this._selectionModel.deselect(i)),a&&this._keyManager.setActiveItem(i),this.multiple&&(this._sortValues(),a&&this.focus())):(i.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(i.value)),u!==this._selectionModel.isSelected(i)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const i=this.options.toArray();this._selectionModel.sort((a,u)=>this.sortComparator?this.sortComparator(a,u,i):i.indexOf(a)-i.indexOf(u)),this.stateChanges.next()}}_propagateChanges(i){let a=null;a=this.multiple?this.selected.map(u=>u.value):this.selected?this.selected.value:i,this._value=a,this.valueChange.emit(a),this._onChange(a),this.selectionChange.emit(this._getChangeEvent(a)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){if(this._keyManager)if(this.empty){let i=-1;for(let a=0;a<this.options.length;a++)if(!this.options.get(a).disabled){i=a;break}this._keyManager.setActiveItem(i)}else this._keyManager.setActiveItem(this._selectionModel.selected[0])}_canOpen(){return!this._panelOpen&&!this.disabled&&this.options?.length>0}focus(i){this._elementRef.nativeElement.focus(i)}_getPanelAriaLabelledby(){if(this.ariaLabel)return null;const i=this._parentFormField?.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){if(this.ariaLabel)return null;const i=this._parentFormField?.getLabelId();let a=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(a+=" "+this.ariaLabelledby),a}_panelDoneAnimating(i){this.openedChange.emit(i)}setDescribedByIds(i){i.length?this._elementRef.nativeElement.setAttribute("aria-describedby",i.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this._panelOpen||!this.empty||this._focused&&!!this._placeholder}static#t=this.\u0275fac=function(a){return new(a||e)(xt(bk),xt(Le),xt(Je),xt(MH),xt(Gi),xt(uI,8),xt(tI,8),xt(eI,8),xt(EB,8),xt(Gd,10),function Th(e){return function _A(e,o){if("class"===o)return e.classes;if("style"===o)return e.styles;const i=e.attrs;if(i){const a=i.length;let u=0;for(;u<a;){const f=i[u];if(Cl(f))break;if(0===f)u+=2;else if("number"==typeof f)for(u++;u<a&&"string"==typeof i[u];)u++;else{if(f===o)return i[u+1];u+=2}}}return null}(ho(),e)}("tabindex"),xt(IB),xt(oH),xt(Hq,8))};static#e=this.\u0275dir=Ee({type:e,viewQuery:function(a,u){if(1&a&&(Ea(Oq,5),Ea(kq,5),Ea(mB,5)),2&a){let f;xr(f=rr())&&(u.trigger=f.first),xr(f=rr())&&(u.panel=f.first),xr(f=rr())&&(u._overlayDir=f.first)}},inputs:{userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",disableOptionCentering:"disableOptionCentering",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},features:[Wn,rs]})}return e})(),Yq=(()=>{class e extends Xq{constructor(){super(...arguments),this.panelWidth=this._defaultOptions&&typeof this._defaultOptions.panelWidth<"u"?this._defaultOptions.panelWidth:"auto",this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"}],this._hideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1,this._skipPredicate=i=>!this.panelOpen&&i.disabled}get shouldLabelFloat(){return this.panelOpen||!this.empty||this.focused&&!!this.placeholder}ngOnInit(){super.ngOnInit(),this._viewportRuler.change().pipe(Ca(this._destroy)).subscribe(()=>{this.panelOpen&&(this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._changeDetectorRef.detectChanges())})}open(){this._parentFormField&&(this._preferredOverlayOrigin=this._parentFormField.getConnectedOverlayOrigin()),this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),super.open(),this.stateChanges.next()}close(){super.close(),this.stateChanges.next()}_scrollOptionIntoView(i){const a=this.options.toArray()[i];if(a){const u=this.panel.nativeElement,f=function FH(e,o,i){if(i.length){let a=o.toArray(),u=i.toArray(),f=0;for(let g=0;g<e+1;g++)a[g].group&&a[g].group===u[f]&&f++;return f}return 0}(i,this.options,this.optionGroups),g=a._getHostElement();u.scrollTop=0===i&&1===f?0:function LH(e,o,i,a){return e<i?e:e+o>i+a?Math.max(0,e-a+o):i}(g.offsetTop,g.offsetHeight,u.scrollTop,u.offsetHeight)}}_positioningSettled(){this._scrollOptionIntoView(this._keyManager.activeItemIndex||0)}_getChangeEvent(i){return new Wq(this,i)}_getOverlayWidth(i){return"auto"===this.panelWidth?(i instanceof Mk?i.elementRef:i||this._elementRef).nativeElement.getBoundingClientRect().width:null===this.panelWidth?"":this.panelWidth}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(i){this._hideSingleSelectionIndicator=ia(i),this._syncParentProperties()}_syncParentProperties(){if(this.options)for(const i of this.options)i._changeDetectorRef.markForCheck()}static#t=this.\u0275fac=function(){let i;return function(u){return(i||(i=vr(e)))(u||e)}}();static#e=this.\u0275cmp=_s({type:e,selectors:[["mat-select"]],contentQueries:function(a,u,f){if(1&a&&(Ks(f,qq,5),Ks(f,Hz,5),Ks(f,$z,5)),2&a){let g;xr(g=rr())&&(u.customTrigger=g.first),xr(g=rr())&&(u.options=g),xr(g=rr())&&(u.optionGroups=g)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","listbox","ngSkipHydration","",1,"mat-mdc-select"],hostVars:19,hostBindings:function(a,u){1&a&&Fr("keydown",function(g){return u._handleKeydown(g)})("focus",function(){return u._onFocus()})("blur",function(){return u._onBlur()}),2&a&&(Fo("id",u.id)("tabindex",u.tabIndex)("aria-controls",u.panelOpen?u.id+"-panel":null)("aria-expanded",u.panelOpen)("aria-label",u.ariaLabel||null)("aria-required",u.required.toString())("aria-disabled",u.disabled.toString())("aria-invalid",u.errorState)("aria-activedescendant",u._getAriaActiveDescendant()),Vr("mat-mdc-select-disabled",u.disabled)("mat-mdc-select-invalid",u.errorState)("mat-mdc-select-required",u.required)("mat-mdc-select-empty",u.empty)("mat-mdc-select-multiple",u.multiple))},inputs:{disabled:"disabled",disableRipple:"disableRipple",tabIndex:"tabIndex",panelWidth:"panelWidth",hideSingleSelectionIndicator:"hideSingleSelectionIndicator"},exportAs:["matSelect"],features:[Ji([{provide:wB,useExisting:e},{provide:Uz,useExisting:e}]),Wn],ngContentSelectors:jq,decls:11,vars:10,consts:[["cdk-overlay-origin","",1,"mat-mdc-select-trigger",3,"click"],["fallbackOverlayOrigin","cdkOverlayOrigin","trigger",""],[1,"mat-mdc-select-value",3,"ngSwitch"],["class","mat-mdc-select-placeholder mat-mdc-select-min-line",4,"ngSwitchCase"],["class","mat-mdc-select-value-text",3,"ngSwitch",4,"ngSwitchCase"],[1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],["viewBox","0 0 24 24","width","24px","height","24px","focusable","false","aria-hidden","true"],["d","M7 10l5 5 5-5z"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","backdropClick","attach","detach"],[1,"mat-mdc-select-placeholder","mat-mdc-select-min-line"],[1,"mat-mdc-select-value-text",3,"ngSwitch"],["class","mat-mdc-select-min-line",4,"ngSwitchDefault"],[4,"ngSwitchCase"],[1,"mat-mdc-select-min-line"],["role","listbox","tabindex","-1",3,"ngClass","keydown"],["panel",""]],template:function(a,u){if(1&a&&(Tu(Vq),Dn(0,"div",0,1),Fr("click",function(){return u.toggle()}),Dn(3,"div",2),Ki(4,Fq,2,1,"span",3),Ki(5,zq,3,2,"span",4),Nn(),Dn(6,"div",5)(7,"div",6),Rl(),Dn(8,"svg",7),io(9,"path",8),Nn()()()(),Ki(10,Bq,3,9,"ng-template",9),Fr("backdropClick",function(){return u.close()})("attach",function(){return u._onAttached()})("detach",function(){return u.close()})),2&a){const f=Lm(1);mn(3),Cn("ngSwitch",u.empty),Fo("id",u._valueId),mn(1),Cn("ngSwitchCase",!0),mn(1),Cn("ngSwitchCase",!1),mn(5),Cn("cdkConnectedOverlayPanelClass",u._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",u._scrollStrategy)("cdkConnectedOverlayOrigin",u._preferredOverlayOrigin||f)("cdkConnectedOverlayOpen",u.panelOpen)("cdkConnectedOverlayPositions",u._positions)("cdkConnectedOverlayWidth",u._overlayWidth)}},dependencies:[SL,pw,WP,AL,mB,Mk],styles:['.mat-mdc-select{display:inline-block;width:100%;outline:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-select-enabled-trigger-text-color);font-family:var(--mat-select-trigger-text-font);line-height:var(--mat-select-trigger-text-line-height);font-size:var(--mat-select-trigger-text-size);font-weight:var(--mat-select-trigger-text-weight);letter-spacing:var(--mat-select-trigger-text-tracking)}.mat-mdc-select-disabled{color:var(--mat-select-disabled-trigger-text-color)}.mat-mdc-select-trigger{display:inline-flex;align-items:center;cursor:pointer;position:relative;box-sizing:border-box;width:100%}.mat-mdc-select-disabled .mat-mdc-select-trigger{-webkit-user-select:none;user-select:none;cursor:default}.mat-mdc-select-value{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-mdc-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-mdc-select-arrow-wrapper{height:24px;flex-shrink:0;display:inline-flex;align-items:center}.mat-form-field-appearance-fill .mat-mdc-select-arrow-wrapper{transform:translateY(-8px)}.mat-form-field-appearance-fill .mdc-text-field--no-label .mat-mdc-select-arrow-wrapper{transform:none}.mat-mdc-select-arrow{width:10px;height:5px;position:relative;color:var(--mat-select-enabled-arrow-color)}.mat-mdc-form-field.mat-focused .mat-mdc-select-arrow{color:var(--mat-select-focused-arrow-color)}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-invalid .mat-mdc-select-arrow{color:var(--mat-select-invalid-arrow-color)}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-disabled .mat-mdc-select-arrow{color:var(--mat-select-disabled-arrow-color)}.mat-mdc-select-arrow svg{fill:currentColor;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:CanvasText}.mat-mdc-select-disabled .cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:GrayText}div.mat-mdc-select-panel{box-shadow:0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12);width:100%;max-height:275px;outline:0;overflow:auto;padding:8px 0;border-radius:4px;box-sizing:border-box;position:static;background-color:var(--mat-select-panel-background-color)}.cdk-high-contrast-active div.mat-mdc-select-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-select-panel-above) div.mat-mdc-select-panel{border-top-left-radius:0;border-top-right-radius:0;transform-origin:top center}.mat-mdc-select-panel-above div.mat-mdc-select-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:bottom center}.mat-mdc-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1);color:var(--mat-select-placeholder-text-color)}._mat-animation-noopable .mat-mdc-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-mdc-select-placeholder{color:rgba(0,0,0,0);-webkit-text-fill-color:rgba(0,0,0,0);transition:none;display:block}.mat-mdc-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper{cursor:pointer}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mat-mdc-floating-label{max-width:calc(100% - 18px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 24px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-text-field--label-floating .mdc-notched-outline__notch{max-width:calc(100% - 24px)}.mat-mdc-select-min-line:empty::before{content:" ";white-space:pre;width:1px;display:inline-block;visibility:hidden}'],encapsulation:2,data:{animation:[Uq.transformPanel]},changeDetection:0})}return e})(),Kq=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({providers:[Gq],imports:[xD,HG,Gz,tc,wk,TB,Gz,tc]})}return e})();const vI=ep(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Dk(){return ar((e,o)=>{let i=null;e._refCount++;const a=Ti(o,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(i=null);const u=e._connection,f=i;i=null,u&&(!f||u===f)&&u.unsubscribe(),o.unsubscribe()});e.subscribe(a),a.closed||(i=e.connect())})}class AB extends $n{constructor(o,i){super(),this.source=o,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,ts(o)&&(this.lift=o.lift)}_subscribe(o){return this.getSubject().subscribe(o)}getSubject(){const o=this._subject;return(!o||o.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:o}=this;this._subject=this._connection=null,o?.unsubscribe()}connect(){let o=this._connection;if(!o){o=this._connection=new st;const i=this.getSubject();o.add(this.source.subscribe(Ti(i,void 0,()=>{this._teardown(),i.complete()},a=>{this._teardown(),i.error(a)},()=>this._teardown()))),o.closed&&(this._connection=null,o=st.EMPTY)}return o}refCount(){return Dk()(this)}}function xI(e){return ar((o,i)=>{let a=!1;o.subscribe(Ti(i,u=>{a=!0,i.next(u)},()=>{a||i.next(e),i.complete()}))})}function RB(e=Qq){return ar((o,i)=>{let a=!1;o.subscribe(Ti(i,u=>{a=!0,i.next(u)},()=>a?i.complete():i.error(e())))})}function Qq(){return new vI}function Ig(e,o){const i=arguments.length>=2;return a=>a.pipe(e?Rs((u,f)=>e(u,f,a)):vl,Vu(1),i?xI(o):RB(()=>new vI))}function Ik(e){return e<=0?()=>Aa:ar((o,i)=>{let a=[];o.subscribe(Ti(i,u=>{a.push(u),e<a.length&&a.shift()},()=>{for(const u of a)i.next(u);i.complete()},void 0,()=>{a=null}))})}const In="primary",Fw=Symbol("RouteTitle");class r7{constructor(o){this.params=o||{}}has(o){return Object.prototype.hasOwnProperty.call(this.params,o)}get(o){if(this.has(o)){const i=this.params[o];return Array.isArray(i)?i[0]:i}return null}getAll(o){if(this.has(o)){const i=this.params[o];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function Yv(e){return new r7(e)}function o7(e,o,i){const a=i.path.split("/");if(a.length>e.length||"full"===i.pathMatch&&(o.hasChildren()||a.length<e.length))return null;const u={};for(let f=0;f<a.length;f++){const g=a[f],x=e[f];if(g.startsWith(":"))u[g.substring(1)]=x;else if(g!==x.path)return null}return{consumed:e.slice(0,a.length),posParams:u}}function ju(e,o){const i=e?Object.keys(e):void 0,a=o?Object.keys(o):void 0;if(!i||!a||i.length!=a.length)return!1;let u;for(let f=0;f<i.length;f++)if(u=i[f],!PB(e[u],o[u]))return!1;return!0}function PB(e,o){if(Array.isArray(e)&&Array.isArray(o)){if(e.length!==o.length)return!1;const i=[...e].sort(),a=[...o].sort();return i.every((u,f)=>a[f]===u)}return e===o}function OB(e){return e.length>0?e[e.length-1]:null}function Kf(e){return function Jq(e){return!!e&&(e instanceof $n||Gn(e.lift)&&Gn(e.subscribe))}(e)?e:wf(e)?Ar(Promise.resolve(e)):kt(e)}const a7={exact:function LB(e,o,i){if(!Ag(e.segments,o.segments)||!bI(e.segments,o.segments,i)||e.numberOfChildren!==o.numberOfChildren)return!1;for(const a in o.children)if(!e.children[a]||!LB(e.children[a],o.children[a],i))return!1;return!0},subset:NB},kB={exact:function l7(e,o){return ju(e,o)},subset:function c7(e,o){return Object.keys(o).length<=Object.keys(e).length&&Object.keys(o).every(i=>PB(e[i],o[i]))},ignored:()=>!0};function FB(e,o,i){return a7[i.paths](e.root,o.root,i.matrixParams)&&kB[i.queryParams](e.queryParams,o.queryParams)&&!("exact"===i.fragment&&e.fragment!==o.fragment)}function NB(e,o,i){return zB(e,o,o.segments,i)}function zB(e,o,i,a){if(e.segments.length>i.length){const u=e.segments.slice(0,i.length);return!(!Ag(u,i)||o.hasChildren()||!bI(u,i,a))}if(e.segments.length===i.length){if(!Ag(e.segments,i)||!bI(e.segments,i,a))return!1;for(const u in o.children)if(!e.children[u]||!NB(e.children[u],o.children[u],a))return!1;return!0}{const u=i.slice(0,e.segments.length),f=i.slice(e.segments.length);return!!(Ag(e.segments,u)&&bI(e.segments,u,a)&&e.children[In])&&zB(e.children[In],o,f,a)}}function bI(e,o,i){return o.every((a,u)=>kB[i](e[u].parameters,a.parameters))}class Kv{constructor(o=new Wi([],{}),i={},a=null){this.root=o,this.queryParams=i,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Yv(this.queryParams)),this._queryParamMap}toString(){return h7.serialize(this)}}class Wi{constructor(o,i){this.segments=o,this.children=i,this.parent=null,Object.values(i).forEach(a=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return wI(this)}}class Lw{constructor(o,i){this.path=o,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=Yv(this.parameters)),this._parameterMap}toString(){return jB(this)}}function Ag(e,o){return e.length===o.length&&e.every((i,a)=>i.path===o[a].path)}let Nw=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:function(){return new Ak},providedIn:"root"})}return e})();class Ak{parse(o){const i=new E7(o);return new Kv(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(o){const i=`/${zw(o.root,!0)}`,a=function m7(e){const o=Object.keys(e).map(i=>{const a=e[i];return Array.isArray(a)?a.map(u=>`${EI(i)}=${EI(u)}`).join("&"):`${EI(i)}=${EI(a)}`}).filter(i=>!!i);return o.length?`?${o.join("&")}`:""}(o.queryParams);return`${i}${a}${"string"==typeof o.fragment?`#${function f7(e){return encodeURI(e)}(o.fragment)}`:""}`}}const h7=new Ak;function wI(e){return e.segments.map(o=>jB(o)).join("/")}function zw(e,o){if(!e.hasChildren())return wI(e);if(o){const i=e.children[In]?zw(e.children[In],!1):"",a=[];return Object.entries(e.children).forEach(([u,f])=>{u!==In&&a.push(`${u}:${zw(f,!1)}`)}),a.length>0?`${i}(${a.join("//")})`:i}{const i=function d7(e,o){let i=[];return Object.entries(e.children).forEach(([a,u])=>{a===In&&(i=i.concat(o(u,a)))}),Object.entries(e.children).forEach(([a,u])=>{a!==In&&(i=i.concat(o(u,a)))}),i}(e,(a,u)=>u===In?[zw(e.children[In],!1)]:[`${u}:${zw(a,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[In]?`${wI(e)}/${i[0]}`:`${wI(e)}/(${i.join("//")})`}}function BB(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function EI(e){return BB(e).replace(/%3B/gi,";")}function Rk(e){return BB(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function CI(e){return decodeURIComponent(e)}function VB(e){return CI(e.replace(/\+/g,"%20"))}function jB(e){return`${Rk(e.path)}${function p7(e){return Object.keys(e).map(o=>`;${Rk(o)}=${Rk(e[o])}`).join("")}(e.parameters)}`}const g7=/^[^\/()?;#]+/;function Pk(e){const o=e.match(g7);return o?o[0]:""}const _7=/^[^\/()?;=#]+/,v7=/^[^=?&#]+/,b7=/^[^&#]+/;class E7{constructor(o){this.url=o,this.remaining=o}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Wi([],{}):new Wi([],this.parseChildren())}parseQueryParams(){const o={};if(this.consumeOptional("?"))do{this.parseQueryParam(o)}while(this.consumeOptional("&"));return o}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const o=[];for(this.peekStartsWith("(")||o.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),o.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(o.length>0||Object.keys(i).length>0)&&(a[In]=new Wi(o,i)),a}parseSegment(){const o=Pk(this.remaining);if(""===o&&this.peekStartsWith(";"))throw new at(4009,!1);return this.capture(o),new Lw(CI(o),this.parseMatrixParams())}parseMatrixParams(){const o={};for(;this.consumeOptional(";");)this.parseParam(o);return o}parseParam(o){const i=function y7(e){const o=e.match(_7);return o?o[0]:""}(this.remaining);if(!i)return;this.capture(i);let a="";if(this.consumeOptional("=")){const u=Pk(this.remaining);u&&(a=u,this.capture(a))}o[CI(i)]=CI(a)}parseQueryParam(o){const i=function x7(e){const o=e.match(v7);return o?o[0]:""}(this.remaining);if(!i)return;this.capture(i);let a="";if(this.consumeOptional("=")){const g=function w7(e){const o=e.match(b7);return o?o[0]:""}(this.remaining);g&&(a=g,this.capture(a))}const u=VB(i),f=VB(a);if(o.hasOwnProperty(u)){let g=o[u];Array.isArray(g)||(g=[g],o[u]=g),g.push(f)}else o[u]=f}parseParens(o){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=Pk(this.remaining),u=this.remaining[a.length];if("/"!==u&&")"!==u&&";"!==u)throw new at(4010,!1);let f;a.indexOf(":")>-1?(f=a.slice(0,a.indexOf(":")),this.capture(f),this.capture(":")):o&&(f=In);const g=this.parseChildren();i[f]=1===Object.keys(g).length?g[In]:new Wi([],g),this.consumeOptional("//")}return i}peekStartsWith(o){return this.remaining.startsWith(o)}consumeOptional(o){return!!this.peekStartsWith(o)&&(this.remaining=this.remaining.substring(o.length),!0)}capture(o){if(!this.consumeOptional(o))throw new at(4011,!1)}}function UB(e){return e.segments.length>0?new Wi([],{[In]:e}):e}function $B(e){const o={};for(const a of Object.keys(e.children)){const f=$B(e.children[a]);if(a===In&&0===f.segments.length&&f.hasChildren())for(const[g,x]of Object.entries(f.children))o[g]=x;else(f.segments.length>0||f.hasChildren())&&(o[a]=f)}return function C7(e){if(1===e.numberOfChildren&&e.children[In]){const o=e.children[In];return new Wi(e.segments.concat(o.segments),o.children)}return e}(new Wi(e.segments,o))}function Rg(e){return e instanceof Kv}function HB(e){let o;const u=UB(function i(f){const g={};for(const w of f.children){const T=i(w);g[w.outlet]=T}const x=new Wi(f.url,g);return f===e&&(o=x),x}(e.root));return o??u}function GB(e,o,i,a){let u=e;for(;u.parent;)u=u.parent;if(0===o.length)return Ok(u,u,u,i,a);const f=function S7(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new WB(!0,0,e);let o=0,i=!1;const a=e.reduce((u,f,g)=>{if("object"==typeof f&&null!=f){if(f.outlets){const x={};return Object.entries(f.outlets).forEach(([w,T])=>{x[w]="string"==typeof T?T.split("/"):T}),[...u,{outlets:x}]}if(f.segmentPath)return[...u,f.segmentPath]}return"string"!=typeof f?[...u,f]:0===g?(f.split("/").forEach((x,w)=>{0==w&&"."===x||(0==w&&""===x?i=!0:".."===x?o++:""!=x&&u.push(x))}),u):[...u,f]},[]);return new WB(i,o,a)}(o);if(f.toRoot())return Ok(u,u,new Wi([],{}),i,a);const g=function T7(e,o,i){if(e.isAbsolute)return new SI(o,!0,0);if(!i)return new SI(o,!1,NaN);if(null===i.parent)return new SI(i,!0,0);const a=MI(e.commands[0])?0:1;return function D7(e,o,i){let a=e,u=o,f=i;for(;f>u;){if(f-=u,a=a.parent,!a)throw new at(4005,!1);u=a.segments.length}return new SI(a,!1,u-f)}(i,i.segments.length-1+a,e.numberOfDoubleDots)}(f,u,e),x=g.processChildren?Vw(g.segmentGroup,g.index,f.commands):ZB(g.segmentGroup,g.index,f.commands);return Ok(u,g.segmentGroup,x,i,a)}function MI(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Bw(e){return"object"==typeof e&&null!=e&&e.outlets}function Ok(e,o,i,a,u){let g,f={};a&&Object.entries(a).forEach(([w,T])=>{f[w]=Array.isArray(T)?T.map(A=>`${A}`):`${T}`}),g=e===o?i:qB(e,o,i);const x=UB($B(g));return new Kv(x,f,u)}function qB(e,o,i){const a={};return Object.entries(e.children).forEach(([u,f])=>{a[u]=f===o?i:qB(f,o,i)}),new Wi(e.segments,a)}class WB{constructor(o,i,a){if(this.isAbsolute=o,this.numberOfDoubleDots=i,this.commands=a,o&&a.length>0&&MI(a[0]))throw new at(4003,!1);const u=a.find(Bw);if(u&&u!==OB(a))throw new at(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class SI{constructor(o,i,a){this.segmentGroup=o,this.processChildren=i,this.index=a}}function ZB(e,o,i){if(e||(e=new Wi([],{})),0===e.segments.length&&e.hasChildren())return Vw(e,o,i);const a=function A7(e,o,i){let a=0,u=o;const f={match:!1,pathIndex:0,commandIndex:0};for(;u<e.segments.length;){if(a>=i.length)return f;const g=e.segments[u],x=i[a];if(Bw(x))break;const w=`${x}`,T=a<i.length-1?i[a+1]:null;if(u>0&&void 0===w)break;if(w&&T&&"object"==typeof T&&void 0===T.outlets){if(!YB(w,T,g))return f;a+=2}else{if(!YB(w,{},g))return f;a++}u++}return{match:!0,pathIndex:u,commandIndex:a}}(e,o,i),u=i.slice(a.commandIndex);if(a.match&&a.pathIndex<e.segments.length){const f=new Wi(e.segments.slice(0,a.pathIndex),{});return f.children[In]=new Wi(e.segments.slice(a.pathIndex),e.children),Vw(f,0,u)}return a.match&&0===u.length?new Wi(e.segments,{}):a.match&&!e.hasChildren()?kk(e,o,i):a.match?Vw(e,0,u):kk(e,o,i)}function Vw(e,o,i){if(0===i.length)return new Wi(e.segments,{});{const a=function I7(e){return Bw(e[0])?e[0].outlets:{[In]:e}}(i),u={};if(Object.keys(a).some(f=>f!==In)&&e.children[In]&&1===e.numberOfChildren&&0===e.children[In].segments.length){const f=Vw(e.children[In],o,i);return new Wi(e.segments,f.children)}return Object.entries(a).forEach(([f,g])=>{"string"==typeof g&&(g=[g]),null!==g&&(u[f]=ZB(e.children[f],o,g))}),Object.entries(e.children).forEach(([f,g])=>{void 0===a[f]&&(u[f]=g)}),new Wi(e.segments,u)}}function kk(e,o,i){const a=e.segments.slice(0,o);let u=0;for(;u<i.length;){const f=i[u];if(Bw(f)){const w=R7(f.outlets);return new Wi(a,w)}if(0===u&&MI(i[0])){a.push(new Lw(e.segments[o].path,XB(i[0]))),u++;continue}const g=Bw(f)?f.outlets[In]:`${f}`,x=u<i.length-1?i[u+1]:null;g&&x&&MI(x)?(a.push(new Lw(g,XB(x))),u+=2):(a.push(new Lw(g,{})),u++)}return new Wi(a,{})}function R7(e){const o={};return Object.entries(e).forEach(([i,a])=>{"string"==typeof a&&(a=[a]),null!==a&&(o[i]=kk(new Wi([],{}),0,a))}),o}function XB(e){const o={};return Object.entries(e).forEach(([i,a])=>o[i]=`${a}`),o}function YB(e,o,i){return e==i.path&&ju(o,i.parameters)}const jw="imperative";class Uu{constructor(o,i){this.id=o,this.url=i}}class TI extends Uu{constructor(o,i,a="imperative",u=null){super(o,i),this.type=0,this.navigationTrigger=a,this.restoredState=u}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Jf extends Uu{constructor(o,i,a){super(o,i),this.urlAfterRedirects=a,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Uw extends Uu{constructor(o,i,a,u){super(o,i),this.reason=a,this.code=u,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Jv extends Uu{constructor(o,i,a,u){super(o,i),this.reason=a,this.code=u,this.type=16}}class DI extends Uu{constructor(o,i,a,u){super(o,i),this.error=a,this.target=u,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class KB extends Uu{constructor(o,i,a,u){super(o,i),this.urlAfterRedirects=a,this.state=u,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class P7 extends Uu{constructor(o,i,a,u){super(o,i),this.urlAfterRedirects=a,this.state=u,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class O7 extends Uu{constructor(o,i,a,u,f){super(o,i),this.urlAfterRedirects=a,this.state=u,this.shouldActivate=f,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class k7 extends Uu{constructor(o,i,a,u){super(o,i),this.urlAfterRedirects=a,this.state=u,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class F7 extends Uu{constructor(o,i,a,u){super(o,i),this.urlAfterRedirects=a,this.state=u,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class L7{constructor(o){this.route=o,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class N7{constructor(o){this.route=o,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class z7{constructor(o){this.snapshot=o,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class B7{constructor(o){this.snapshot=o,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class V7{constructor(o){this.snapshot=o,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class j7{constructor(o){this.snapshot=o,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class JB{constructor(o,i,a){this.routerEvent=o,this.position=i,this.anchor=a,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Fk{}class Lk{constructor(o){this.url=o}}class U7{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new $w,this.attachRef=null}}let $w=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(i,a){const u=this.getOrCreateContext(i);u.outlet=a,this.contexts.set(i,u)}onChildOutletDestroyed(i){const a=this.getContext(i);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){const i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let a=this.getContext(i);return a||(a=new U7,this.contexts.set(i,a)),a}getContext(i){return this.contexts.get(i)||null}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class QB{constructor(o){this._root=o}get root(){return this._root.value}parent(o){const i=this.pathFromRoot(o);return i.length>1?i[i.length-2]:null}children(o){const i=Nk(o,this._root);return i?i.children.map(a=>a.value):[]}firstChild(o){const i=Nk(o,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(o){const i=zk(o,this._root);return i.length<2?[]:i[i.length-2].children.map(u=>u.value).filter(u=>u!==o)}pathFromRoot(o){return zk(o,this._root).map(i=>i.value)}}function Nk(e,o){if(e===o.value)return o;for(const i of o.children){const a=Nk(e,i);if(a)return a}return null}function zk(e,o){if(e===o.value)return[o];for(const i of o.children){const a=zk(e,i);if(a.length)return a.unshift(o),a}return[]}class qd{constructor(o,i){this.value=o,this.children=i}toString(){return`TreeNode(${this.value})`}}function Qv(e){const o={};return e&&e.children.forEach(i=>o[i.value.outlet]=i),o}class t4 extends QB{constructor(o,i){super(o),this.snapshot=i,Bk(this,o)}toString(){return this.snapshot.toString()}}function e4(e,o){const i=function $7(e,o){const g=new II([],{},{},"",{},In,o,null,{});return new i4("",new qd(g,[]))}(0,o),a=new $r([new Lw("",{})]),u=new $r({}),f=new $r({}),g=new $r({}),x=new $r(""),w=new t0(a,u,g,x,f,In,o,i.root);return w.snapshot=i.root,new t4(new qd(w,[]),i)}class t0{constructor(o,i,a,u,f,g,x,w){this.urlSubject=o,this.paramsSubject=i,this.queryParamsSubject=a,this.fragmentSubject=u,this.dataSubject=f,this.outlet=g,this.component=x,this._futureSnapshot=w,this.title=this.dataSubject?.pipe(cn(T=>T[Fw]))??kt(void 0),this.url=o,this.params=i,this.queryParams=a,this.fragment=u,this.data=f}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(cn(o=>Yv(o)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(cn(o=>Yv(o)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function n4(e,o="emptyOnly"){const i=e.pathFromRoot;let a=0;if("always"!==o)for(a=i.length-1;a>=1;){const u=i[a],f=i[a-1];if(u.routeConfig&&""===u.routeConfig.path)a--;else{if(f.component)break;a--}}return function H7(e){return e.reduce((o,i)=>({params:{...o.params,...i.params},data:{...o.data,...i.data},resolve:{...i.data,...o.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(a))}class II{get title(){return this.data?.[Fw]}constructor(o,i,a,u,f,g,x,w,T){this.url=o,this.params=i,this.queryParams=a,this.fragment=u,this.data=f,this.outlet=g,this.component=x,this.routeConfig=w,this._resolve=T}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Yv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Yv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class i4 extends QB{constructor(o,i){super(i),this.url=o,Bk(this,i)}toString(){return r4(this._root)}}function Bk(e,o){o.value._routerState=e,o.children.forEach(i=>Bk(e,i))}function r4(e){const o=e.children.length>0?` { ${e.children.map(r4).join(", ")} } `:"";return`${e.value}${o}`}function Vk(e){if(e.snapshot){const o=e.snapshot,i=e._futureSnapshot;e.snapshot=i,ju(o.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),o.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),ju(o.params,i.params)||e.paramsSubject.next(i.params),function s7(e,o){if(e.length!==o.length)return!1;for(let i=0;i<e.length;++i)if(!ju(e[i],o[i]))return!1;return!0}(o.url,i.url)||e.urlSubject.next(i.url),ju(o.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function jk(e,o){const i=ju(e.params,o.params)&&function u7(e,o){return Ag(e,o)&&e.every((i,a)=>ju(i.parameters,o[a].parameters))}(e.url,o.url);return i&&!(!e.parent!=!o.parent)&&(!e.parent||jk(e.parent,o.parent))}let o4=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=In,this.activateEvents=new oi,this.deactivateEvents=new oi,this.attachEvents=new oi,this.detachEvents=new oi,this.parentContexts=ee($w),this.location=ee(ls),this.changeDetector=ee(Le),this.environmentInjector=ee(Ss),this.inputBinder=ee(AI,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(i){if(i.name){const{firstChange:a,previousValue:u}=i.name;if(a)return;this.isTrackedInParentContexts(u)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(u)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new at(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new at(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new at(4012,!1);this.location.detach();const i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,a){this.activated=i,this._activatedRoute=a,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){const i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,a){if(this.isActivated)throw new at(4013,!1);this._activatedRoute=i;const u=this.location,g=i.snapshot.component,x=this.parentContexts.getOrCreateContext(this.name).children,w=new G7(i,x,u.injector);this.activated=u.createComponent(g,{index:u.length,injector:w,environmentInjector:a??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275dir=Ee({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[rs]})}return e})();class G7{constructor(o,i,a){this.route=o,this.childContexts=i,this.parent=a}get(o,i){return o===t0?this.route:o===$w?this.childContexts:this.parent.get(o,i)}}const AI=new Gt("");let s4=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(i){this.unsubscribeFromRouteData(i),this.subscribeToRouteData(i)}unsubscribeFromRouteData(i){this.outletDataSubscriptions.get(i)?.unsubscribe(),this.outletDataSubscriptions.delete(i)}subscribeToRouteData(i){const{activatedRoute:a}=i,u=sI([a.queryParams,a.params,a.data]).pipe(Hr(([f,g,x],w)=>(x={...f,...g,...x},0===w?kt(x):Promise.resolve(x)))).subscribe(f=>{if(!i.isActivated||!i.activatedComponentRef||i.activatedRoute!==a||null===a.component)return void this.unsubscribeFromRouteData(i);const g=function f5(e){const o=Kn(e);if(!o)return null;const i=new cf(o);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return o.standalone},get isSignal(){return o.signals}}}(a.component);if(g)for(const{templateName:x}of g.inputs)i.activatedComponentRef.setInput(x,f[x]);else this.unsubscribeFromRouteData(i)});this.outletDataSubscriptions.set(i,u)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();function Hw(e,o,i){if(i&&e.shouldReuseRoute(o.value,i.value.snapshot)){const a=i.value;a._futureSnapshot=o.value;const u=function W7(e,o,i){return o.children.map(a=>{for(const u of i.children)if(e.shouldReuseRoute(a.value,u.value.snapshot))return Hw(e,a,u);return Hw(e,a)})}(e,o,i);return new qd(a,u)}{if(e.shouldAttach(o.value)){const f=e.retrieve(o.value);if(null!==f){const g=f.route;return g.value._futureSnapshot=o.value,g.children=o.children.map(x=>Hw(e,x)),g}}const a=function Z7(e){return new t0(new $r(e.url),new $r(e.params),new $r(e.queryParams),new $r(e.fragment),new $r(e.data),e.outlet,e.component,e)}(o.value),u=o.children.map(f=>Hw(e,f));return new qd(a,u)}}const Uk="ngNavigationCancelingError";function a4(e,o){const{redirectTo:i,navigationBehaviorOptions:a}=Rg(o)?{redirectTo:o,navigationBehaviorOptions:void 0}:o,u=l4(!1,0,o);return u.url=i,u.navigationBehaviorOptions=a,u}function l4(e,o,i){const a=new Error("NavigationCancelingError: "+(e||""));return a[Uk]=!0,a.cancellationCode=o,i&&(a.url=i),a}function c4(e){return e&&e[Uk]}let u4=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275cmp=_s({type:e,selectors:[["ng-component"]],standalone:!0,features:[S1],decls:1,vars:0,template:function(a,u){1&a&&io(0,"router-outlet")},dependencies:[o4],encapsulation:2})}return e})();function $k(e){const o=e.children&&e.children.map($k),i=o?{...e,children:o}:{...e};return!i.component&&!i.loadComponent&&(o||i.loadChildren)&&i.outlet&&i.outlet!==In&&(i.component=u4),i}function $c(e){return e.outlet||In}function Gw(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let o=e.parent;o;o=o.parent){const i=o.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class n9{constructor(o,i,a,u,f){this.routeReuseStrategy=o,this.futureState=i,this.currState=a,this.forwardEvent=u,this.inputBindingEnabled=f}activate(o){const i=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,a,o),Vk(this.futureState.root),this.activateChildRoutes(i,a,o)}deactivateChildRoutes(o,i,a){const u=Qv(i);o.children.forEach(f=>{const g=f.value.outlet;this.deactivateRoutes(f,u[g],a),delete u[g]}),Object.values(u).forEach(f=>{this.deactivateRouteAndItsChildren(f,a)})}deactivateRoutes(o,i,a){const u=o.value,f=i?i.value:null;if(u===f)if(u.component){const g=a.getContext(u.outlet);g&&this.deactivateChildRoutes(o,i,g.children)}else this.deactivateChildRoutes(o,i,a);else f&&this.deactivateRouteAndItsChildren(i,a)}deactivateRouteAndItsChildren(o,i){o.value.component&&this.routeReuseStrategy.shouldDetach(o.value.snapshot)?this.detachAndStoreRouteSubtree(o,i):this.deactivateRouteAndOutlet(o,i)}detachAndStoreRouteSubtree(o,i){const a=i.getContext(o.value.outlet),u=a&&o.value.component?a.children:i,f=Qv(o);for(const g of Object.keys(f))this.deactivateRouteAndItsChildren(f[g],u);if(a&&a.outlet){const g=a.outlet.detach(),x=a.children.onOutletDeactivated();this.routeReuseStrategy.store(o.value.snapshot,{componentRef:g,route:o,contexts:x})}}deactivateRouteAndOutlet(o,i){const a=i.getContext(o.value.outlet),u=a&&o.value.component?a.children:i,f=Qv(o);for(const g of Object.keys(f))this.deactivateRouteAndItsChildren(f[g],u);a&&(a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated()),a.attachRef=null,a.route=null)}activateChildRoutes(o,i,a){const u=Qv(i);o.children.forEach(f=>{this.activateRoutes(f,u[f.value.outlet],a),this.forwardEvent(new j7(f.value.snapshot))}),o.children.length&&this.forwardEvent(new B7(o.value.snapshot))}activateRoutes(o,i,a){const u=o.value,f=i?i.value:null;if(Vk(u),u===f)if(u.component){const g=a.getOrCreateContext(u.outlet);this.activateChildRoutes(o,i,g.children)}else this.activateChildRoutes(o,i,a);else if(u.component){const g=a.getOrCreateContext(u.outlet);if(this.routeReuseStrategy.shouldAttach(u.snapshot)){const x=this.routeReuseStrategy.retrieve(u.snapshot);this.routeReuseStrategy.store(u.snapshot,null),g.children.onOutletReAttached(x.contexts),g.attachRef=x.componentRef,g.route=x.route.value,g.outlet&&g.outlet.attach(x.componentRef,x.route.value),Vk(x.route.value),this.activateChildRoutes(o,null,g.children)}else{const x=Gw(u.snapshot);g.attachRef=null,g.route=u,g.injector=x,g.outlet&&g.outlet.activateWith(u,g.injector),this.activateChildRoutes(o,null,g.children)}}else this.activateChildRoutes(o,null,a)}}class d4{constructor(o){this.path=o,this.route=this.path[this.path.length-1]}}class RI{constructor(o,i){this.component=o,this.route=i}}function i9(e,o,i){const a=e._root;return qw(a,o?o._root:null,i,[a.value])}function e0(e,o){const i=Symbol(),a=o.get(e,i);return a===i?"function"!=typeof e||function Xg(e){return null!==ap(e)}(e)?o.get(e):e:a}function qw(e,o,i,a,u={canDeactivateChecks:[],canActivateChecks:[]}){const f=Qv(o);return e.children.forEach(g=>{(function o9(e,o,i,a,u={canDeactivateChecks:[],canActivateChecks:[]}){const f=e.value,g=o?o.value:null,x=i?i.getContext(e.value.outlet):null;if(g&&f.routeConfig===g.routeConfig){const w=function s9(e,o,i){if("function"==typeof i)return i(e,o);switch(i){case"pathParamsChange":return!Ag(e.url,o.url);case"pathParamsOrQueryParamsChange":return!Ag(e.url,o.url)||!ju(e.queryParams,o.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!jk(e,o)||!ju(e.queryParams,o.queryParams);default:return!jk(e,o)}}(g,f,f.routeConfig.runGuardsAndResolvers);w?u.canActivateChecks.push(new d4(a)):(f.data=g.data,f._resolvedData=g._resolvedData),qw(e,o,f.component?x?x.children:null:i,a,u),w&&x&&x.outlet&&x.outlet.isActivated&&u.canDeactivateChecks.push(new RI(x.outlet.component,g))}else g&&Ww(o,x,u),u.canActivateChecks.push(new d4(a)),qw(e,null,f.component?x?x.children:null:i,a,u)})(g,f[g.value.outlet],i,a.concat([g.value]),u),delete f[g.value.outlet]}),Object.entries(f).forEach(([g,x])=>Ww(x,i.getContext(g),u)),u}function Ww(e,o,i){const a=Qv(e),u=e.value;Object.entries(a).forEach(([f,g])=>{Ww(g,u.component?o?o.children.getContext(f):null:o,i)}),i.canDeactivateChecks.push(new RI(u.component&&o&&o.outlet&&o.outlet.isActivated?o.outlet.component:null,u))}function Zw(e){return"function"==typeof e}function h4(e){return e instanceof vI||"EmptyError"===e?.name}const PI=Symbol("INITIAL_VALUE");function n0(){return Hr(e=>sI(e.map(o=>o.pipe(Vu(1),lI(PI)))).pipe(cn(o=>{for(const i of o)if(!0!==i){if(i===PI)return PI;if(!1===i||i instanceof Kv)return i}return!0}),Rs(o=>o!==PI),Vu(1)))}function f4(e){return function Wu(...e){return Kc(e)}(go(o=>{if(Rg(o))throw a4(0,o)}),cn(o=>!0===o))}class OI{constructor(o){this.segmentGroup=o||null}}class p4{constructor(o){this.urlTree=o}}function r0(e){return Xv(new OI(e))}function m4(e){return Xv(new p4(e))}class S9{constructor(o,i){this.urlSerializer=o,this.urlTree=i}noMatchError(o){return new at(4002,!1)}lineralizeSegments(o,i){let a=[],u=i.root;for(;;){if(a=a.concat(u.segments),0===u.numberOfChildren)return kt(a);if(u.numberOfChildren>1||!u.children[In])return Xv(new at(4e3,!1));u=u.children[In]}}applyRedirectCommands(o,i,a){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),o,a)}applyRedirectCreateUrlTree(o,i,a,u){const f=this.createSegmentGroup(o,i.root,a,u);return new Kv(f,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(o,i){const a={};return Object.entries(o).forEach(([u,f])=>{if("string"==typeof f&&f.startsWith(":")){const x=f.substring(1);a[u]=i[x]}else a[u]=f}),a}createSegmentGroup(o,i,a,u){const f=this.createSegments(o,i.segments,a,u);let g={};return Object.entries(i.children).forEach(([x,w])=>{g[x]=this.createSegmentGroup(o,w,a,u)}),new Wi(f,g)}createSegments(o,i,a,u){return i.map(f=>f.path.startsWith(":")?this.findPosParam(o,f,u):this.findOrReturn(f,a))}findPosParam(o,i,a){const u=a[i.path.substring(1)];if(!u)throw new at(4001,!1);return u}findOrReturn(o,i){let a=0;for(const u of i){if(u.path===o.path)return i.splice(a),u;a++}return o}}const Hk={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function T9(e,o,i,a,u){const f=Gk(e,o,i);return f.matched?(a=function Y7(e,o){return e.providers&&!e._injector&&(e._injector=Af(e.providers,o,`Route: ${e.path}`)),e._injector??o}(o,a),function E9(e,o,i,a){const u=o.canMatch;return u&&0!==u.length?kt(u.map(g=>{const x=e0(g,e);return Kf(function h9(e){return e&&Zw(e.canMatch)}(x)?x.canMatch(o,i):e.runInContext(()=>x(o,i)))})).pipe(n0(),f4()):kt(!0)}(a,o,i).pipe(cn(g=>!0===g?f:{...Hk}))):kt(f)}function Gk(e,o,i){if(""===o.path)return"full"===o.pathMatch&&(e.hasChildren()||i.length>0)?{...Hk}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const u=(o.matcher||o7)(i,e,o);if(!u)return{...Hk};const f={};Object.entries(u.posParams??{}).forEach(([x,w])=>{f[x]=w.path});const g=u.consumed.length>0?{...f,...u.consumed[u.consumed.length-1].parameters}:f;return{matched:!0,consumedSegments:u.consumed,remainingSegments:i.slice(u.consumed.length),parameters:g,positionalParamSegments:u.posParams??{}}}function g4(e,o,i,a){return i.length>0&&function A9(e,o,i){return i.some(a=>kI(e,o,a)&&$c(a)!==In)}(e,i,a)?{segmentGroup:new Wi(o,I9(a,new Wi(i,e.children))),slicedSegments:[]}:0===i.length&&function R9(e,o,i){return i.some(a=>kI(e,o,a))}(e,i,a)?{segmentGroup:new Wi(e.segments,D9(e,0,i,a,e.children)),slicedSegments:i}:{segmentGroup:new Wi(e.segments,e.children),slicedSegments:i}}function D9(e,o,i,a,u){const f={};for(const g of a)if(kI(e,i,g)&&!u[$c(g)]){const x=new Wi([],{});f[$c(g)]=x}return{...u,...f}}function I9(e,o){const i={};i[In]=o;for(const a of e)if(""===a.path&&$c(a)!==In){const u=new Wi([],{});i[$c(a)]=u}return i}function kI(e,o,i){return(!(e.hasChildren()||o.length>0)||"full"!==i.pathMatch)&&""===i.path}class F9{constructor(o,i,a,u,f,g,x){this.injector=o,this.configLoader=i,this.rootComponentType=a,this.config=u,this.urlTree=f,this.paramsInheritanceStrategy=g,this.urlSerializer=x,this.allowRedirects=!0,this.applyRedirects=new S9(this.urlSerializer,this.urlTree)}noMatchError(o){return new at(4002,!1)}recognize(){const o=g4(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,o,In).pipe(Yf(i=>{if(i instanceof p4)return this.allowRedirects=!1,this.urlTree=i.urlTree,this.match(i.urlTree);throw i instanceof OI?this.noMatchError(i):i}),cn(i=>{const a=new II([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},In,this.rootComponentType,null,{}),u=new qd(a,i),f=new i4("",u),g=function M7(e,o,i=null,a=null){return GB(HB(e),o,i,a)}(a,[],this.urlTree.queryParams,this.urlTree.fragment);return g.queryParams=this.urlTree.queryParams,f.url=this.urlSerializer.serialize(g),this.inheritParamsAndData(f._root),{state:f,tree:g}}))}match(o){return this.processSegmentGroup(this.injector,this.config,o.root,In).pipe(Yf(a=>{throw a instanceof OI?this.noMatchError(a):a}))}inheritParamsAndData(o){const i=o.value,a=n4(i,this.paramsInheritanceStrategy);i.params=Object.freeze(a.params),i.data=Object.freeze(a.data),o.children.forEach(u=>this.inheritParamsAndData(u))}processSegmentGroup(o,i,a,u){return 0===a.segments.length&&a.hasChildren()?this.processChildren(o,i,a):this.processSegment(o,i,a,a.segments,u,!0)}processChildren(o,i,a){const u=[];for(const f of Object.keys(a.children))"primary"===f?u.unshift(f):u.push(f);return Ar(u).pipe(Vv(f=>{const g=a.children[f],x=function t9(e,o){const i=e.filter(a=>$c(a)===o);return i.push(...e.filter(a=>$c(a)!==o)),i}(i,f);return this.processSegmentGroup(o,x,g,f)}),function e7(e,o){return ar(function t7(e,o,i,a,u){return(f,g)=>{let x=i,w=o,T=0;f.subscribe(Ti(g,A=>{const k=T++;w=x?e(w,A,k):(x=!0,A),a&&g.next(w)},u&&(()=>{x&&g.next(w),g.complete()})))}}(e,o,arguments.length>=2,!0))}((f,g)=>(f.push(...g),f)),xI(null),function n7(e,o){const i=arguments.length>=2;return a=>a.pipe(e?Rs((u,f)=>e(u,f,a)):vl,Ik(1),i?xI(o):RB(()=>new vI))}(),pr(f=>{if(null===f)return r0(a);const g=_4(f);return function L9(e){e.sort((o,i)=>o.value.outlet===In?-1:i.value.outlet===In?1:o.value.outlet.localeCompare(i.value.outlet))}(g),kt(g)}))}processSegment(o,i,a,u,f,g){return Ar(i).pipe(Vv(x=>this.processSegmentAgainstRoute(x._injector??o,i,x,a,u,f,g).pipe(Yf(w=>{if(w instanceof OI)return kt(null);throw w}))),Ig(x=>!!x),Yf(x=>{if(h4(x))return function O9(e,o,i){return 0===o.length&&!e.children[i]}(a,u,f)?kt([]):r0(a);throw x}))}processSegmentAgainstRoute(o,i,a,u,f,g,x){return function P9(e,o,i,a){return!!($c(e)===a||a!==In&&kI(o,i,e))&&("**"===e.path||Gk(o,e,i).matched)}(a,u,f,g)?void 0===a.redirectTo?this.matchSegmentAgainstRoute(o,u,a,f,g,x):x&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(o,u,i,a,f,g):r0(u):r0(u)}expandSegmentAgainstRouteUsingRedirect(o,i,a,u,f,g){return"**"===u.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(o,a,u,g):this.expandRegularSegmentAgainstRouteUsingRedirect(o,i,a,u,f,g)}expandWildCardWithParamsAgainstRouteUsingRedirect(o,i,a,u){const f=this.applyRedirects.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?m4(f):this.applyRedirects.lineralizeSegments(a,f).pipe(pr(g=>{const x=new Wi(g,{});return this.processSegment(o,i,x,g,u,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(o,i,a,u,f,g){const{matched:x,consumedSegments:w,remainingSegments:T,positionalParamSegments:A}=Gk(i,u,f);if(!x)return r0(i);const k=this.applyRedirects.applyRedirectCommands(w,u.redirectTo,A);return u.redirectTo.startsWith("/")?m4(k):this.applyRedirects.lineralizeSegments(u,k).pipe(pr(B=>this.processSegment(o,a,i,B.concat(T),g,!1)))}matchSegmentAgainstRoute(o,i,a,u,f,g){let x;if("**"===a.path){const w=u.length>0?OB(u).parameters:{};x=kt({snapshot:new II(u,w,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,y4(a),$c(a),a.component??a._loadedComponent??null,a,v4(a)),consumedSegments:[],remainingSegments:[]}),i.children={}}else x=T9(i,a,u,o).pipe(cn(({matched:w,consumedSegments:T,remainingSegments:A,parameters:k})=>w?{snapshot:new II(T,k,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,y4(a),$c(a),a.component??a._loadedComponent??null,a,v4(a)),consumedSegments:T,remainingSegments:A}:null));return x.pipe(Hr(w=>null===w?r0(i):this.getChildConfig(o=a._injector??o,a,u).pipe(Hr(({routes:T})=>{const A=a._loadedInjector??o,{snapshot:k,consumedSegments:B,remainingSegments:G}=w,{segmentGroup:K,slicedSegments:et}=g4(i,B,G,T);if(0===et.length&&K.hasChildren())return this.processChildren(A,T,K).pipe(cn(_t=>null===_t?null:[new qd(k,_t)]));if(0===T.length&&0===et.length)return kt([new qd(k,[])]);const ut=$c(a)===f;return this.processSegment(A,T,K,et,ut?In:f,!0).pipe(cn(_t=>[new qd(k,_t)]))}))))}getChildConfig(o,i,a){return i.children?kt({routes:i.children,injector:o}):i.loadChildren?void 0!==i._loadedRoutes?kt({routes:i._loadedRoutes,injector:i._loadedInjector}):function w9(e,o,i,a){const u=o.canLoad;return void 0===u||0===u.length?kt(!0):kt(u.map(g=>{const x=e0(g,e);return Kf(function l9(e){return e&&Zw(e.canLoad)}(x)?x.canLoad(o,i):e.runInContext(()=>x(o,i)))})).pipe(n0(),f4())}(o,i,a).pipe(pr(u=>u?this.configLoader.loadChildren(o,i).pipe(go(f=>{i._loadedRoutes=f.routes,i._loadedInjector=f.injector})):function M9(e){return Xv(l4(!1,3))}())):kt({routes:[],injector:o})}}function N9(e){const o=e.value.routeConfig;return o&&""===o.path}function _4(e){const o=[],i=new Set;for(const a of e){if(!N9(a)){o.push(a);continue}const u=o.find(f=>a.value.routeConfig===f.value.routeConfig);void 0!==u?(u.children.push(...a.children),i.add(u)):o.push(a)}for(const a of i){const u=_4(a.children);o.push(new qd(a.value,u))}return o.filter(a=>!i.has(a))}function y4(e){return e.data||{}}function v4(e){return e.resolve||{}}function x4(e){return"string"==typeof e.title||null===e.title}function qk(e){return Hr(o=>{const i=e(o);return i?Ar(i).pipe(cn(()=>o)):kt(o)})}const o0=new Gt("ROUTES");let Wk=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ee(rw)}loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return kt(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const a=Kf(i.loadComponent()).pipe(cn(b4),go(f=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=f}),jv(()=>{this.componentLoaders.delete(i)})),u=new AB(a,()=>new xn).pipe(Dk());return this.componentLoaders.set(i,u),u}loadChildren(i,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return kt({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);const f=function H9(e,o,i,a){return Kf(e.loadChildren()).pipe(cn(b4),pr(u=>u instanceof C1||Array.isArray(u)?kt(u):Ar(o.compileModuleAsync(u))),cn(u=>{a&&a(e);let f,g,x=!1;return Array.isArray(u)?(g=u,!0):(f=u.create(i).injector,g=f.get(o0,[],{optional:!0,self:!0}).flat()),{routes:g.map($k),injector:f}}))}(a,this.compiler,i,this.onLoadEndListener).pipe(jv(()=>{this.childrenLoaders.delete(a)})),g=new AB(f,()=>new xn).pipe(Dk());return this.childrenLoaders.set(a,g),g}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function b4(e){return function G9(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let FI=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new xn,this.transitionAbortSubject=new xn,this.configLoader=ee(Wk),this.environmentInjector=ee(Ss),this.urlSerializer=ee(Nw),this.rootContexts=ee($w),this.inputBindingEnabled=null!==ee(AI,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>kt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=u=>this.events.next(new N7(u)),this.configLoader.onLoadStartListener=u=>this.events.next(new L7(u))}complete(){this.transitions?.complete()}handleNavigationRequest(i){const a=++this.navigationId;this.transitions?.next({...this.transitions.value,...i,id:a})}setupNavigations(i,a,u){return this.transitions=new $r({id:0,currentUrlTree:a,currentRawUrl:a,currentBrowserUrl:a,extractedUrl:i.urlHandlingStrategy.extract(a),urlAfterRedirects:i.urlHandlingStrategy.extract(a),rawUrl:a,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:jw,restoredState:null,currentSnapshot:u.snapshot,targetSnapshot:null,currentRouterState:u,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Rs(f=>0!==f.id),cn(f=>({...f,extractedUrl:i.urlHandlingStrategy.extract(f.rawUrl)})),Hr(f=>{this.currentTransition=f;let g=!1,x=!1;return kt(f).pipe(go(w=>{this.currentNavigation={id:w.id,initialUrl:w.rawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Hr(w=>{const T=w.currentBrowserUrl.toString(),A=!i.navigated||w.extractedUrl.toString()!==T||T!==w.currentUrlTree.toString();if(!A&&"reload"!==(w.extras.onSameUrlNavigation??i.onSameUrlNavigation)){const B="";return this.events.next(new Jv(w.id,this.urlSerializer.serialize(w.rawUrl),B,0)),w.resolve(null),Aa}if(i.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return kt(w).pipe(Hr(B=>{const G=this.transitions?.getValue();return this.events.next(new TI(B.id,this.urlSerializer.serialize(B.extractedUrl),B.source,B.restoredState)),G!==this.transitions?.getValue()?Aa:Promise.resolve(B)}),function z9(e,o,i,a,u,f){return pr(g=>function k9(e,o,i,a,u,f,g="emptyOnly"){return new F9(e,o,i,a,u,g,f).recognize()}(e,o,i,a,g.extractedUrl,u,f).pipe(cn(({state:x,tree:w})=>({...g,targetSnapshot:x,urlAfterRedirects:w}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,i.paramsInheritanceStrategy),go(B=>{f.targetSnapshot=B.targetSnapshot,f.urlAfterRedirects=B.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:B.urlAfterRedirects};const G=new KB(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects),B.targetSnapshot);this.events.next(G)}));if(A&&i.urlHandlingStrategy.shouldProcessUrl(w.currentRawUrl)){const{id:B,extractedUrl:G,source:K,restoredState:et,extras:ut}=w,_t=new TI(B,this.urlSerializer.serialize(G),K,et);this.events.next(_t);const pt=e4(0,this.rootComponentType).snapshot;return this.currentTransition=f={...w,targetSnapshot:pt,urlAfterRedirects:G,extras:{...ut,skipLocationChange:!1,replaceUrl:!1}},kt(f)}{const B="";return this.events.next(new Jv(w.id,this.urlSerializer.serialize(w.extractedUrl),B,1)),w.resolve(null),Aa}}),go(w=>{const T=new P7(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(T)}),cn(w=>(this.currentTransition=f={...w,guards:i9(w.targetSnapshot,w.currentSnapshot,this.rootContexts)},f)),function p9(e,o){return pr(i=>{const{targetSnapshot:a,currentSnapshot:u,guards:{canActivateChecks:f,canDeactivateChecks:g}}=i;return 0===g.length&&0===f.length?kt({...i,guardsResult:!0}):function m9(e,o,i,a){return Ar(e).pipe(pr(u=>function b9(e,o,i,a,u){const f=o&&o.routeConfig?o.routeConfig.canDeactivate:null;return f&&0!==f.length?kt(f.map(x=>{const w=Gw(o)??u,T=e0(x,w);return Kf(function d9(e){return e&&Zw(e.canDeactivate)}(T)?T.canDeactivate(e,o,i,a):w.runInContext(()=>T(e,o,i,a))).pipe(Ig())})).pipe(n0()):kt(!0)}(u.component,u.route,i,o,a)),Ig(u=>!0!==u,!0))}(g,a,u,e).pipe(pr(x=>x&&function a9(e){return"boolean"==typeof e}(x)?function g9(e,o,i,a){return Ar(o).pipe(Vv(u=>aI(function y9(e,o){return null!==e&&o&&o(new z7(e)),kt(!0)}(u.route.parent,a),function _9(e,o){return null!==e&&o&&o(new V7(e)),kt(!0)}(u.route,a),function x9(e,o,i){const a=o[o.length-1],f=o.slice(0,o.length-1).reverse().map(g=>function r9(e){const o=e.routeConfig?e.routeConfig.canActivateChild:null;return o&&0!==o.length?{node:e,guards:o}:null}(g)).filter(g=>null!==g).map(g=>Tk(()=>kt(g.guards.map(w=>{const T=Gw(g.node)??i,A=e0(w,T);return Kf(function u9(e){return e&&Zw(e.canActivateChild)}(A)?A.canActivateChild(a,e):T.runInContext(()=>A(a,e))).pipe(Ig())})).pipe(n0())));return kt(f).pipe(n0())}(e,u.path,i),function v9(e,o,i){const a=o.routeConfig?o.routeConfig.canActivate:null;if(!a||0===a.length)return kt(!0);const u=a.map(f=>Tk(()=>{const g=Gw(o)??i,x=e0(f,g);return Kf(function c9(e){return e&&Zw(e.canActivate)}(x)?x.canActivate(o,e):g.runInContext(()=>x(o,e))).pipe(Ig())}));return kt(u).pipe(n0())}(e,u.route,i))),Ig(u=>!0!==u,!0))}(a,f,e,o):kt(x)),cn(x=>({...i,guardsResult:x})))})}(this.environmentInjector,w=>this.events.next(w)),go(w=>{if(f.guardsResult=w.guardsResult,Rg(w.guardsResult))throw a4(0,w.guardsResult);const T=new O7(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.events.next(T)}),Rs(w=>!!w.guardsResult||(this.cancelNavigationTransition(w,"",3),!1)),qk(w=>{if(w.guards.canActivateChecks.length)return kt(w).pipe(go(T=>{const A=new k7(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(A)}),Hr(T=>{let A=!1;return kt(T).pipe(function B9(e,o){return pr(i=>{const{targetSnapshot:a,guards:{canActivateChecks:u}}=i;if(!u.length)return kt(i);let f=0;return Ar(u).pipe(Vv(g=>function V9(e,o,i,a){const u=e.routeConfig,f=e._resolve;return void 0!==u?.title&&!x4(u)&&(f[Fw]=u.title),function j9(e,o,i,a){const u=function U9(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===u.length)return kt({});const f={};return Ar(u).pipe(pr(g=>function $9(e,o,i,a){const u=Gw(o)??a,f=e0(e,u);return Kf(f.resolve?f.resolve(o,i):u.runInContext(()=>f(o,i)))}(e[g],o,i,a).pipe(Ig(),go(x=>{f[g]=x}))),Ik(1),function i7(e){return cn(()=>e)}(f),Yf(g=>h4(g)?Aa:Xv(g)))}(f,e,o,a).pipe(cn(g=>(e._resolvedData=g,e.data=n4(e,i).resolve,u&&x4(u)&&(e.data[Fw]=u.title),null)))}(g.route,a,e,o)),go(()=>f++),Ik(1),pr(g=>f===u.length?kt(i):Aa))})}(i.paramsInheritanceStrategy,this.environmentInjector),go({next:()=>A=!0,complete:()=>{A||this.cancelNavigationTransition(T,"",2)}}))}),go(T=>{const A=new F7(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(A)}))}),qk(w=>{const T=A=>{const k=[];A.routeConfig?.loadComponent&&!A.routeConfig._loadedComponent&&k.push(this.configLoader.loadComponent(A.routeConfig).pipe(go(B=>{A.component=B}),cn(()=>{})));for(const B of A.children)k.push(...T(B));return k};return sI(T(w.targetSnapshot.root)).pipe(xI(),Vu(1))}),qk(()=>this.afterPreactivation()),cn(w=>{const T=function q7(e,o,i){const a=Hw(e,o._root,i?i._root:void 0);return new t4(a,o)}(i.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return this.currentTransition=f={...w,targetRouterState:T},f}),go(()=>{this.events.next(new Fk)}),((e,o,i,a)=>cn(u=>(new n9(o,u.targetRouterState,u.currentRouterState,i,a).activate(e),u)))(this.rootContexts,i.routeReuseStrategy,w=>this.events.next(w),this.inputBindingEnabled),Vu(1),go({next:w=>{g=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Jf(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects))),i.titleStrategy?.updateTitle(w.targetRouterState.snapshot),w.resolve(!0)},complete:()=>{g=!0}}),Ca(this.transitionAbortSubject.pipe(go(w=>{throw w}))),jv(()=>{g||x||this.cancelNavigationTransition(f,"",1),this.currentNavigation?.id===f.id&&(this.currentNavigation=null)}),Yf(w=>{if(x=!0,c4(w))this.events.next(new Uw(f.id,this.urlSerializer.serialize(f.extractedUrl),w.message,w.cancellationCode)),function X7(e){return c4(e)&&Rg(e.url)}(w)?this.events.next(new Lk(w.url)):f.resolve(!1);else{this.events.next(new DI(f.id,this.urlSerializer.serialize(f.extractedUrl),w,f.targetSnapshot??void 0));try{f.resolve(i.errorHandler(w))}catch(T){f.reject(T)}}return Aa}))}))}cancelNavigationTransition(i,a,u){const f=new Uw(i.id,this.urlSerializer.serialize(i.extractedUrl),a,u);this.events.next(f),i.resolve(!1)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function w4(e){return e!==jw}let E4=(()=>{class e{buildTitle(i){let a,u=i.root;for(;void 0!==u;)a=this.getResolvedTitleForRoute(u)??a,u=u.children.find(f=>f.outlet===In);return a}getResolvedTitleForRoute(i){return i.data[Fw]}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:function(){return ee(q9)},providedIn:"root"})}return e})(),q9=(()=>{class e extends E4{constructor(i){super(),this.title=i}updateTitle(i){const a=this.buildTitle(i);void 0!==a&&this.title.setTitle(a)}static#t=this.\u0275fac=function(a){return new(a||e)(bt(tN))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),W9=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:function(){return ee(X9)},providedIn:"root"})}return e})();class Z9{shouldDetach(o){return!1}store(o,i){}shouldAttach(o){return!1}retrieve(o){return null}shouldReuseRoute(o,i){return o.routeConfig===i.routeConfig}}let X9=(()=>{class e extends Z9{static#t=this.\u0275fac=function(){let i;return function(u){return(i||(i=vr(e)))(u||e)}}();static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const LI=new Gt("",{providedIn:"root",factory:()=>({})});let Y9=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:function(){return ee(K9)},providedIn:"root"})}return e})(),K9=(()=>{class e{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,a){return i}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Xw=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(Xw||{});function C4(e,o){e.events.pipe(Rs(i=>i instanceof Jf||i instanceof Uw||i instanceof DI||i instanceof Jv),cn(i=>i instanceof Jf||i instanceof Jv?Xw.COMPLETE:i instanceof Uw&&(0===i.code||1===i.code)?Xw.REDIRECTING:Xw.FAILED),Rs(i=>i!==Xw.REDIRECTING),Vu(1)).subscribe(()=>{o()})}function J9(e){throw e}function Q9(e,o,i){return o.parse("/")}const tW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},eW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ec=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=ee(iD),this.isNgZoneEnabled=!1,this._events=new xn,this.options=ee(LI,{optional:!0})||{},this.pendingTasks=ee(Ld),this.errorHandler=this.options.errorHandler||J9,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Q9,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=ee(Y9),this.routeReuseStrategy=ee(W9),this.titleStrategy=ee(E4),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=ee(o0,{optional:!0})?.flat()??[],this.navigationTransitions=ee(FI),this.urlSerializer=ee(Nw),this.location=ee(cD),this.componentInputBindingEnabled=!!ee(AI,{optional:!0}),this.eventsSubscription=new st,this.isNgZoneEnabled=ee(Je)instanceof Je&&Je.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Kv,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=e4(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(i=>{this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId},i=>{this.console.warn(`Unhandled Navigation Error: ${i}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const i=this.navigationTransitions.events.subscribe(a=>{try{const{currentTransition:u}=this.navigationTransitions;if(null===u)return void(M4(a)&&this._events.next(a));if(a instanceof TI)w4(u.source)&&(this.browserUrlTree=u.extractedUrl);else if(a instanceof Jv)this.rawUrlTree=u.rawUrl;else if(a instanceof KB){if("eager"===this.urlUpdateStrategy){if(!u.extras.skipLocationChange){const f=this.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl);this.setBrowserUrl(f,u)}this.browserUrlTree=u.urlAfterRedirects}}else if(a instanceof Fk)this.currentUrlTree=u.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl),this.routerState=u.targetRouterState,"deferred"===this.urlUpdateStrategy&&(u.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,u),this.browserUrlTree=u.urlAfterRedirects);else if(a instanceof Uw)0!==a.code&&1!==a.code&&(this.navigated=!0),(3===a.code||2===a.code)&&this.restoreHistory(u);else if(a instanceof Lk){const f=this.urlHandlingStrategy.merge(a.url,u.currentRawUrl),g={skipLocationChange:u.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||w4(u.source)};this.scheduleNavigation(f,jw,null,g,{resolve:u.resolve,reject:u.reject,promise:u.promise})}a instanceof DI&&this.restoreHistory(u,!0),a instanceof Jf&&(this.navigated=!0),M4(a)&&this._events.next(a)}catch(u){this.navigationTransitions.transitionAbortSubject.next(u)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const i=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),jw,i)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(i=>{const a="popstate"===i.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{this.navigateToSyncWithBrowser(i.url,a,i.state)},0)}))}navigateToSyncWithBrowser(i,a,u){const f={replaceUrl:!0},g=u?.navigationId?u:null;if(u){const w={...u};delete w.navigationId,delete w.\u0275routerPageId,0!==Object.keys(w).length&&(f.state=w)}const x=this.parseUrl(i);this.scheduleNavigation(x,a,g,f)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map($k),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,a={}){const{relativeTo:u,queryParams:f,fragment:g,queryParamsHandling:x,preserveFragment:w}=a,T=w?this.currentUrlTree.fragment:g;let k,A=null;switch(x){case"merge":A={...this.currentUrlTree.queryParams,...f};break;case"preserve":A=this.currentUrlTree.queryParams;break;default:A=f||null}null!==A&&(A=this.removeEmptyProps(A));try{k=HB(u?u.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof i[0]||!i[0].startsWith("/"))&&(i=[]),k=this.currentUrlTree.root}return GB(k,i,A,T??null)}navigateByUrl(i,a={skipLocationChange:!1}){const u=Rg(i)?i:this.parseUrl(i),f=this.urlHandlingStrategy.merge(u,this.rawUrlTree);return this.scheduleNavigation(f,jw,null,a)}navigate(i,a={skipLocationChange:!1}){return function nW(e){for(let o=0;o<e.length;o++)if(null==e[o])throw new at(4008,!1)}(i),this.navigateByUrl(this.createUrlTree(i,a),a)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){let a;try{a=this.urlSerializer.parse(i)}catch(u){a=this.malformedUriErrorHandler(u,this.urlSerializer,i)}return a}isActive(i,a){let u;if(u=!0===a?{...tW}:!1===a?{...eW}:a,Rg(i))return FB(this.currentUrlTree,i,u);const f=this.parseUrl(i);return FB(this.currentUrlTree,f,u)}removeEmptyProps(i){return Object.keys(i).reduce((a,u)=>{const f=i[u];return null!=f&&(a[u]=f),a},{})}scheduleNavigation(i,a,u,f,g){if(this.disposed)return Promise.resolve(!1);let x,w,T;g?(x=g.resolve,w=g.reject,T=g.promise):T=new Promise((k,B)=>{x=k,w=B});const A=this.pendingTasks.add();return C4(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(A))}),this.navigationTransitions.handleNavigationRequest({source:a,restoredState:u,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:i,extras:f,resolve:x,reject:w,promise:T,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),T.catch(k=>Promise.reject(k))}setBrowserUrl(i,a){const u=this.urlSerializer.serialize(i);if(this.location.isCurrentPathEqualTo(u)||a.extras.replaceUrl){const g={...a.extras.state,...this.generateNgRouterState(a.id,this.browserPageId)};this.location.replaceState(u,"",g)}else{const f={...a.extras.state,...this.generateNgRouterState(a.id,this.browserPageId+1)};this.location.go(u,"",f)}}restoreHistory(i,a=!1){if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-this.browserPageId;0!==f?this.location.historyGo(f):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===f&&(this.resetState(i),this.browserUrlTree=i.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=i.currentRouterState,this.currentUrlTree=i.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,a){return"computed"===this.canceledNavigationResolution?{navigationId:i,\u0275routerPageId:a}:{navigationId:i}}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function M4(e){return!(e instanceof Fk||e instanceof Lk)}class S4{}let oW=(()=>{class e{constructor(i,a,u,f,g){this.router=i,this.injector=u,this.preloadingStrategy=f,this.loader=g}setUpPreloading(){this.subscription=this.router.events.pipe(Rs(i=>i instanceof Jf),Vv(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,a){const u=[];for(const f of a){f.providers&&!f._injector&&(f._injector=Af(f.providers,i,`Route: ${f.path}`));const g=f._injector??i,x=f._loadedInjector??g;(f.loadChildren&&!f._loadedRoutes&&void 0===f.canLoad||f.loadComponent&&!f._loadedComponent)&&u.push(this.preloadConfig(g,f)),(f.children||f._loadedRoutes)&&u.push(this.processRoutes(x,f.children??f._loadedRoutes))}return Ar(u).pipe(eu())}preloadConfig(i,a){return this.preloadingStrategy.preload(a,()=>{let u;u=a.loadChildren&&void 0===a.canLoad?this.loader.loadChildren(i,a):kt(null);const f=u.pipe(pr(g=>null===g?kt(void 0):(a._loadedRoutes=g.routes,a._loadedInjector=g.injector,this.processRoutes(g.injector??i,g.routes))));return a.loadComponent&&!a._loadedComponent?Ar([f,this.loader.loadComponent(a)]).pipe(eu()):f})}static#t=this.\u0275fac=function(a){return new(a||e)(bt(ec),bt(rw),bt(Ss),bt(S4),bt(Wk))};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Xk=new Gt("");let T4=(()=>{class e{constructor(i,a,u,f,g={}){this.urlSerializer=i,this.transitions=a,this.viewportScroller=u,this.zone=f,this.options=g,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},g.scrollPositionRestoration=g.scrollPositionRestoration||"disabled",g.anchorScrolling=g.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof TI?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof Jf?(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment)):i instanceof Jv&&0===i.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof JB&&(i.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(i.position):i.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(i.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(i,a){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new JB(i,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#t=this.\u0275fac=function(a){ti()};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac})}return e})();function Wd(e,o){return{\u0275kind:e,\u0275providers:o}}function I4(){const e=ee(Or);return o=>{const i=e.get(ct);if(o!==i.components[0])return;const a=e.get(ec),u=e.get(A4);1===e.get(Yk)&&a.initialNavigation(),e.get(R4,null,Ye.Optional)?.setUpPreloading(),e.get(Xk,null,Ye.Optional)?.init(),a.resetRootComponentType(i.componentTypes[0]),u.closed||(u.next(),u.complete(),u.unsubscribe())}}const A4=new Gt("",{factory:()=>new xn}),Yk=new Gt("",{providedIn:"root",factory:()=>1}),R4=new Gt("");function cW(e){return Wd(0,[{provide:R4,useExisting:oW},{provide:S4,useExisting:e}])}const P4=new Gt("ROUTER_FORROOT_GUARD"),dW=[cD,{provide:Nw,useClass:Ak},ec,$w,{provide:t0,useFactory:function D4(e){return e.routerState.root},deps:[ec]},Wk,[]];function hW(){return new z("Router",ec)}let O4=(()=>{class e{constructor(i){}static forRoot(i,a){return{ngModule:e,providers:[dW,[],{provide:o0,multi:!0,useValue:i},{provide:P4,useFactory:gW,deps:[[ec,new pu,new Oh]]},{provide:LI,useValue:a||{}},a?.useHash?{provide:_g,useClass:y5}:{provide:_g,useClass:pL},{provide:Xk,useFactory:()=>{const e=ee(NV),o=ee(Je),i=ee(LI),a=ee(FI),u=ee(Nw);return i.scrollOffset&&e.setOffset(i.scrollOffset),new T4(u,a,e,o,i)}},a?.preloadingStrategy?cW(a.preloadingStrategy).\u0275providers:[],{provide:z,multi:!0,useFactory:hW},a?.initialNavigation?_W(a):[],a?.bindToComponentInputs?Wd(8,[s4,{provide:AI,useExisting:s4}]).\u0275providers:[],[{provide:k4,useFactory:I4},{provide:I,multi:!0,useExisting:k4}]]}}static forChild(i){return{ngModule:e,providers:[{provide:o0,multi:!0,useValue:i}]}}static#t=this.\u0275fac=function(a){return new(a||e)(bt(P4,8))};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({})}return e})();function gW(e){return"guarded"}function _W(e){return["disabled"===e.initialNavigation?Wd(3,[{provide:ew,multi:!0,useFactory:()=>{const o=ee(ec);return()=>{o.setUpLocationChangeListener()}}},{provide:Yk,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Wd(2,[{provide:Yk,useValue:0},{provide:ew,multi:!0,deps:[Or],useFactory:o=>{const i=o.get(g5,Promise.resolve());return()=>i.then(()=>new Promise(a=>{const u=o.get(ec),f=o.get(A4);C4(u,()=>{a(!0)}),o.get(FI).afterPreactivation=()=>(a(!0),f.closed?kt(void 0):f),u.initialNavigation()}))}}]).\u0275providers:[]]}const k4=new Gt("");var vW=Hu(574),Yw=Hu.n(vW),Jo=Math.PI,br=2*Jo,Pg=Jo/180,F4=180/Jo,Ma=6378.135,$u=60/Math.sqrt(Ma*Ma*Ma/398600.8),NI=Ma*$u/60,z4=1/$u,Qf=.001082616,tp=-253881e-11/Qf,s0=2/3;function U4(e,o,i,a,u,f){var g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return 367*e-Math.floor(7*(e+Math.floor((o+9)/12))*.25)+Math.floor(275*o/9)+i+1721013.5+((g/6e4+f/60+u)/60+a)/24}function Kk(e,o,i,a,u,f,g){if(e instanceof Date){var x=e;return U4(x.getUTCFullYear(),x.getUTCMonth()+1,x.getUTCDate(),x.getUTCHours(),x.getUTCMinutes(),x.getUTCSeconds(),x.getUTCMilliseconds())}return U4(e,o,i,a,u,f,g)}function $4(e,o){var Ue,en,wn,An,Xn,yi,ai,Fi,Dr,vi,pi,Li,li,Un,hr,wr,ji,Qi,i=e.e3,a=e.ee2,u=e.peo,f=e.pgho,g=e.pho,x=e.pinco,w=e.plo,T=e.se2,A=e.se3,k=e.sgh2,B=e.sgh3,G=e.sgh4,K=e.sh2,et=e.sh3,ut=e.si2,_t=e.si3,pt=e.sl2,Ft=e.sl3,Zt=e.sl4,de=e.t,oe=e.xgh2,Te=e.xgh3,hn=e.xgh4,yn=e.xh2,si=e.xh3,hi=e.xi2,Sn=e.xi3,Vi=e.xl2,Zi=e.xl3,dr=e.xl4,Ht=e.zmol,fe=e.zmos,pe=o.init,Pe=o.opsmode,jn=o.ep,fi=o.inclp,Ve=o.nodep,sr=o.argpp,vn=o.mp;Qi=fe+119459e-10*de,"y"===pe&&(Qi=fe),ji=Qi+.0335*Math.sin(Qi);var Os=T*(ai=.5*(Un=Math.sin(ji))*Un-.25)+A*(Fi=-.5*Un*Math.cos(ji)),ks=ut*ai+_t*Fi,xo=pt*ai+Ft*Fi+Zt*Un,uo=k*ai+B*Fi+G*Un,bo=K*ai+et*Fi;return Qi=Ht+.00015835218*de,"y"===pe&&(Qi=Ht),ji=Qi+.1098*Math.sin(Qi),Dr=Os+(a*(ai=.5*(Un=Math.sin(ji))*Un-.25)+i*(Fi=-.5*Un*Math.cos(ji))),Li=ks+(hi*ai+Sn*Fi),li=xo+(Vi*ai+Zi*Fi+dr*Un),vi=uo+(oe*ai+Te*Fi+hn*Un),pi=bo+(yn*ai+si*Fi),"n"===pe&&(li-=w,vi-=f,pi-=g,fi+=Li-=x,jn+=Dr-=u,An=Math.sin(fi),wn=Math.cos(fi),fi>=.2?(sr+=vi-=wn*(pi/=An),Ve+=pi,vn+=li):(Ue=An*(yi=Math.sin(Ve)),en=An*(Xn=Math.cos(Ve)),Ue+=pi*Xn+Li*wn*yi,en+=-pi*yi+Li*wn*Xn,(Ve%=br)<0&&"a"===Pe&&(Ve+=br),hr=vn+sr+wn*Ve,hr+=li+vi-Li*Ve*An,wr=Ve,(Ve=Math.atan2(Ue,en))<0&&"a"===Pe&&(Ve+=br),Math.abs(wr-Ve)>Jo&&(Ve<wr?Ve+=br:Ve-=br),sr=hr-(vn+=li)-wn*Ve)),{ep:jn,inclp:fi,nodep:Ve,argpp:sr,mp:vn}}function H4(e){var o=(e-2451545)/36525,i=-62e-7*o*o*o+.093104*o*o+3164400184.812866*o+67310.54841;return(i=i*Pg/240%br)<0&&(i+=br),i}function G4(){return(arguments.length<=0?void 0:arguments[0])instanceof Date||arguments.length>1?H4(Kk.apply(void 0,arguments)):H4.apply(void 0,arguments)}function q4(e,o){var i,a,u,f,g,w,T,A,k,B,G,K,ut,_t,pt,Ft,Zt,de,oe,Te,hn,yn,si,hi,Sn;e.t=o,e.error=0;var Zi=e.mo+e.mdot*e.t,dr=e.argpo+e.argpdot*e.t;A=dr,oe=Zi;var fe=e.t*e.t;if(hn=e.nodeo+e.nodedot*e.t+e.nodecf*fe,pt=1-e.cc1*e.t,Ft=e.bstar*e.cc4*e.t,Zt=e.t2cof*fe,1!==e.isimp){w=e.omgcof*e.t;var pe=1+e.eta*Math.cos(Zi);oe=Zi+(_t=w+e.xmcof*(pe*pe*pe-e.delmo)),A=dr-_t,pt=pt-e.d2*fe-e.d3*(G=fe*e.t)-e.d4*(K=G*e.t),Ft+=e.bstar*e.cc5*(Math.sin(oe)-e.sinmao),Zt=Zt+e.t3cof*G+K*(e.t4cof+e.t*e.t5cof)}Te=e.no;var Pe=e.ecco;if(de=e.inclo,"d"===e.method){var fi=function EW(e){var yo,ai,Fi,Dr,vi,pi,Li,li,o=e.irez,i=e.d2201,a=e.d2211,u=e.d3210,f=e.d3222,g=e.d4410,x=e.d4422,w=e.d5220,T=e.d5232,A=e.d5421,k=e.d5433,G=e.del1,K=e.del2,et=e.del3,Zt=e.argpo,de=e.argpdot,oe=e.t,yn=e.xfact,si=e.xlamo,hi=e.no,Sn=e.atime,Vi=e.em,Zi=e.argpm,dr=e.inclm,Ht=e.xli,fe=e.mm,pe=e.xni,Pe=e.nodem,jn=e.nm,fi=.13130908,Ve=2.8843198,sr=.37448087,vn=5.7686396,Ue=.95240898,en=1.8014998,wn=1.050833,An=4.4108898,Un=0,hr=0,wr=(e.gsto+.0043752690880113*e.tc)%br;if(Vi+=e.dedt*oe,dr+=e.didt*oe,Zi+=e.domdt*oe,Pe+=e.dnodt*oe,fe+=e.dmdt*oe,0!==o){(0===Sn||oe*Sn<=0||Math.abs(oe)<Math.abs(Sn))&&(Sn=0,pe=hi,Ht=si),yo=oe>0?720:-720;for(var ji=381;381===ji;)2!==o?(Li=G*Math.sin(Ht-fi)+K*Math.sin(2*(Ht-Ve))+et*Math.sin(3*(Ht-sr)),vi=pe+yn,pi=G*Math.cos(Ht-fi)+2*K*Math.cos(2*(Ht-Ve))+3*et*Math.cos(3*(Ht-sr)),pi*=vi):(Fi=(li=Zt+de*Sn)+li,ai=Ht+Ht,Li=i*Math.sin(Fi+Ht-vn)+a*Math.sin(Ht-vn)+u*Math.sin(li+Ht-Ue)+f*Math.sin(-li+Ht-Ue)+g*Math.sin(Fi+ai-en)+x*Math.sin(ai-en)+w*Math.sin(li+Ht-wn)+T*Math.sin(-li+Ht-wn)+A*Math.sin(li+ai-An)+k*Math.sin(-li+ai-An),vi=pe+yn,pi=i*Math.cos(Fi+Ht-vn)+a*Math.cos(Ht-vn)+u*Math.cos(li+Ht-Ue)+f*Math.cos(-li+Ht-Ue)+w*Math.cos(li+Ht-wn)+T*Math.cos(-li+Ht-wn)+2*(g*Math.cos(Fi+ai-en)+x*Math.cos(ai-en)+A*Math.cos(li+ai-An)+k*Math.cos(-li+ai-An)),pi*=vi),Math.abs(oe-Sn)>=720?ji=381:(hr=oe-Sn,ji=0),381===ji&&(Ht+=vi*yo+259200*Li,pe+=Li*yo+259200*pi,Sn+=yo);jn=pe+Li*hr+pi*hr*hr*.5,Dr=Ht+vi*hr+Li*hr*hr*.5,1!==o?(fe=Dr-2*Pe+2*wr,Un=jn-hi):(fe=Dr-Pe-Zi+wr,Un=jn-hi),jn=hi+Un}return{atime:Sn,em:Vi,argpm:Zi,inclm:dr,xli:Ht,mm:fe,xni:pe,nodem:Pe,dndt:Un,nm:jn}}({irez:e.irez,d2201:e.d2201,d2211:e.d2211,d3210:e.d3210,d3222:e.d3222,d4410:e.d4410,d4422:e.d4422,d5220:e.d5220,d5232:e.d5232,d5421:e.d5421,d5433:e.d5433,dedt:e.dedt,del1:e.del1,del2:e.del2,del3:e.del3,didt:e.didt,dmdt:e.dmdt,dnodt:e.dnodt,domdt:e.domdt,argpo:e.argpo,argpdot:e.argpdot,t:e.t,tc:e.t,gsto:e.gsto,xfact:e.xfact,xlamo:e.xlamo,no:e.no,atime:e.atime,em:Pe,argpm:A,inclm:de,xli:e.xli,mm:oe,xni:e.xni,nodem:hn,nm:Te});Pe=fi.em,A=fi.argpm,de=fi.inclm,oe=fi.mm,hn=fi.nodem,Te=fi.nm}if(Te<=0)return e.error=2,[!1,!1];var Ve=Math.pow($u/Te,s0)*pt*pt;if(Te=$u/Math.pow(Ve,1.5),(Pe-=Ft)>=1||Pe<-.001)return e.error=1,[!1,!1];Pe<1e-6&&(Pe=1e-6),si=(oe+=e.no*Zt)+A+hn;var Ue=Pe;if(yn=de,k=A%=br,Sn=hn%=br,hi=oe=((si%=br)-A-hn)%br,f=Math.sin(de),u=Math.cos(de),"d"===e.method){var wn=$4(e,{inclo:e.inclo,init:"n",ep:Ue,inclp:yn,nodep:Sn,argpp:k,mp:hi,opsmode:e.operationmode});if(Sn=wn.nodep,k=wn.argpp,hi=wn.mp,(yn=wn.inclp)<0&&(yn=-yn,Sn+=Jo,k-=Jo),(Ue=wn.ep)<0||Ue>1)return e.error=3,[!1,!1]}"d"===e.method&&(f=Math.sin(yn),u=Math.cos(yn),e.aycof=-.5*tp*f,e.xlcof=Math.abs(u+1)>15e-13?-.25*tp*f*(3+5*u)/(1+u):-.25*tp*f*(3+5*u)/15e-13);var An=Ue*Math.cos(k);_t=1/(Ve*(1-Ue*Ue));var Xn=Ue*Math.sin(k)+_t*e.aycof,lo=(hi+k+Sn+_t*e.xlcof*An-Sn)%br;T=lo,ut=9999.9;for(var Lr=1;Math.abs(ut)>=1e-12&&Lr<=10;)a=Math.sin(T),ut=(lo-Xn*(i=Math.cos(T))+An*a-T)/(ut=1-i*An-a*Xn),Math.abs(ut)>=.95&&(ut=ut>0?.95:-.95),T+=ut,Lr+=1;var yo=An*i+Xn*a,ai=An*a-Xn*i,Fi=An*An+Xn*Xn,Dr=Ve*(1-Fi);if(Dr<0)return e.error=4,[!1,!1];var vi=Ve*(1-yo),pi=Math.sqrt(Ve)*ai/vi,Li=Math.sqrt(Dr)/vi,li=Math.sqrt(1-Fi),Un=Ve/vi*(a-Xn-An*(_t=ai/(1+li))),hr=Ve/vi*(i-An+Xn*_t);B=Math.atan2(Un,hr);var wr=(hr+hr)*Un,ji=1-2*Un*Un,Qi=.5*Qf*(_t=1/Dr),vo=Qi*_t;"d"===e.method&&(e.con41=3*(g=u*u)-1,e.x1mth2=1-g,e.x7thm1=7*g-1);var co=vi*(1-1.5*vo*li*e.con41)+.5*Qi*e.x1mth2*ji;if(co<1)return e.error=6,{position:!1,velocity:!1};B-=.25*vo*e.x7thm1*wr;var Qo=Sn+1.5*vo*u*wr,Lo=yn+1.5*vo*u*f*ji,Os=pi-Te*Qi*e.x1mth2*wr/$u,ks=Li+Te*Qi*(e.x1mth2*ji+1.5*e.con41)/$u,xo=Math.sin(B),uo=Math.cos(B),bo=Math.sin(Qo),hl=Math.cos(Qo),ra=Math.sin(Lo),Nr=Math.cos(Lo),wo=-bo*Nr,Hc=hl*Nr,Sa=wo*xo+hl*uo,Eo=Hc*xo+bo*uo,Zd=ra*xo;return{position:{x:co*Sa*Ma,y:co*Eo*Ma,z:co*Zd*Ma},velocity:{x:(Os*Sa+ks*(wo*uo-hl*xo))*NI,y:(Os*Eo+ks*(Hc*uo-bo*xo))*NI,z:(Os*Zd+ks*(ra*uo))*NI}}}function Jk(e,o){(null==o||o>e.length)&&(o=e.length);for(var i=0,a=new Array(o);i<o;i++)a[i]=e[i];return a}function W4(e){return e*F4}let X4=(()=>{class e{constructor(){this.coordinatesSubject=new xn,this.satelliteJsonSubject=new xn,this.allCoordinates=[],this.tleLine1="",this.tleLine2="",this.updateSatelliteData()}get coordinates$(){return this.coordinatesSubject.asObservable()}get satelliteJson$(){return this.satelliteJsonSubject.asObservable()}updateSatelliteData(){this.intervalId=setInterval(()=>{const i=new Date,a=function MW(e,o){var u,a=1440/(2*Jo),f={error:0};f.satnum=e.substring(2,7),f.epochyr=parseInt(e.substring(18,20),10),f.epochdays=parseFloat(e.substring(20,32)),f.ndot=parseFloat(e.substring(33,43)),f.nddot=parseFloat(".".concat(parseInt(e.substring(44,50),10),"E").concat(e.substring(50,52))),f.bstar=parseFloat("".concat(e.substring(53,54),".").concat(parseInt(e.substring(54,59),10),"E").concat(e.substring(59,61))),f.inclo=parseFloat(o.substring(8,16)),f.nodeo=parseFloat(o.substring(17,25)),f.ecco=parseFloat(".".concat(o.substring(26,33))),f.argpo=parseFloat(o.substring(34,42)),f.mo=parseFloat(o.substring(43,51)),f.no=parseFloat(o.substring(52,63)),f.no/=a,f.inclo*=Pg,f.nodeo*=Pg,f.argpo*=Pg,f.mo*=Pg;var g=function j4(e,o){for(var i=[31,e%4==0?29:28,31,30,31,30,31,31,30,31,30,31],a=Math.floor(o),u=1,f=0;a>f+i[u-1]&&u<12;)f+=i[u-1],u+=1;var g=u,x=a-f,w=24*(o-a),T=Math.floor(w);w=60*(w-T);var A=Math.floor(w);return{mon:g,day:x,hr:T,minute:A,sec:60*(w-A)}}(u=f.epochyr<57?f.epochyr+2e3:f.epochyr+1900,f.epochdays);return f.jdsatepoch=Kk(u,g.mon,g.day,g.hr,g.minute,g.sec),function CW(e,o){var B,G,K,ut,_t,pt,Ft,Zt,de,oe,Te,si,Sn,Vi,Zi,dr,Ht,fe,pe,Pe,jn,fi,Ve,sr,vn,Ue,en,wn,An,Xn,yi,lo,Lr,yo,ai,Fi,vi,pi,Li,li,Un,hr,wr,ji,Qi,vo,co,Qo,Lo,Os,ks,i=o.opsmode,a=o.satn,u=o.epoch,f=o.xbstar,g=o.xecco,x=o.xargpo,w=o.xinclo,T=o.xmo,A=o.xno,k=o.xnodeo;e.isimp=0,e.method="n",e.aycof=0,e.con41=0,e.cc1=0,e.cc4=0,e.cc5=0,e.d2=0,e.d3=0,e.d4=0,e.delmo=0,e.eta=0,e.argpdot=0,e.omgcof=0,e.sinmao=0,e.t=0,e.t2cof=0,e.t3cof=0,e.t4cof=0,e.t5cof=0,e.x1mth2=0,e.x7thm1=0,e.mdot=0,e.nodedot=0,e.xlcof=0,e.xmcof=0,e.nodecf=0,e.irez=0,e.d2201=0,e.d2211=0,e.d3210=0,e.d3222=0,e.d4410=0,e.d4422=0,e.d5220=0,e.d5232=0,e.d5421=0,e.d5433=0,e.dedt=0,e.del1=0,e.del2=0,e.del3=0,e.didt=0,e.dmdt=0,e.dnodt=0,e.domdt=0,e.e3=0,e.ee2=0,e.peo=0,e.pgho=0,e.pho=0,e.pinco=0,e.plo=0,e.se2=0,e.se3=0,e.sgh2=0,e.sgh3=0,e.sgh4=0,e.sh2=0,e.sh3=0,e.si2=0,e.si3=0,e.sl2=0,e.sl3=0,e.sl4=0,e.gsto=0,e.xfact=0,e.xgh2=0,e.xgh3=0,e.xgh4=0,e.xh2=0,e.xh3=0,e.xi2=0,e.xi3=0,e.xl2=0,e.xl3=0,e.xl4=0,e.xlamo=0,e.zmol=0,e.zmos=0,e.atime=0,e.xli=0,e.xni=0,e.bstar=f,e.ecco=g,e.argpo=x,e.inclo=w,e.mo=T,e.no=A,e.nodeo=k,e.operationmode=i;var uo=78/Ma+1,bo=42/Ma,hl=bo*bo*bo*bo;e.init="y",e.t=0;var Nr=function wW(e){var o=e.ecco,i=e.epoch,a=e.inclo,u=e.opsmode,f=e.no,g=o*o,x=1-g,w=Math.sqrt(x),T=Math.cos(a),A=T*T,k=Math.pow($u/f,s0),B=.75*Qf*(3*A-1)/(w*x),G=B/(k*k),K=k*(1-G*G-G*(1/3+134*G*G/81));f/=1+(G=B/(K*K));var hn,et=Math.pow($u/f,s0),ut=Math.sin(a),_t=et*x,pt=1-5*A,Ft=-pt-A-A,Zt=1/et,de=_t*_t,oe=et*(1-o);if("a"===u){var yn=i-7305,si=Math.floor(yn+1e-8),Sn=.017202791694070362;(hn=(1.7321343856509375+Sn*si+(Sn+br)*(yn-si)+yn*yn*5075514194322695e-30)%br)<0&&(hn+=br)}else hn=G4(i+2433281.5);return{no:f,method:"n",ainv:Zt,ao:et,con41:Ft,con42:pt,cosio:T,cosio2:A,eccsq:g,omeosq:x,posq:de,rp:oe,rteosq:w,sinio:ut,gsto:hn}}({satn:a,ecco:e.ecco,epoch:u,inclo:e.inclo,no:e.no,method:e.method,opsmode:e.operationmode}),wo=Nr.ao,Hc=Nr.con42,Sa=Nr.cosio,Eo=Nr.cosio2,Zd=Nr.eccsq,nc=Nr.omeosq,Gc=Nr.posq,ic=Nr.rp,rc=Nr.rteosq,ds=Nr.sinio;if(e.no=Nr.no,e.con41=Nr.con41,e.gsto=Nr.gsto,e.a=Math.pow(e.no*z4,-2/3),e.alta=e.a*(1+e.ecco)-1,e.altp=e.a*(1-e.ecco)-1,e.error=0,nc>=0||e.no>=0){if(e.isimp=0,ic<220/Ma+1&&(e.isimp=1),Ve=uo,Ht=hl,(Vi=(ic-1)*Ma)<156){Ve=Vi-78,Vi<98&&(Ve=20);var oa=(120-Ve)/Ma;Ht=oa*oa*oa*oa,Ve=Ve/Ma+1}Zi=1/Gc,e.eta=wo*e.ecco*(Un=1/(wo-Ve)),Te=e.eta*e.eta,oe=e.ecco*e.eta,dr=Math.abs(1-Te),pt=(_t=Ht*Math.pow(Un,4))/Math.pow(dr,3.5),e.cc1=e.bstar*(pt*e.no*(wo*(1+1.5*Te+oe*(4+Te))+.375*Qf*Un/dr*e.con41*(8+3*Te*(8+Te)))),ut=0,e.ecco>1e-4&&(ut=-2*_t*Un*tp*e.no*ds/e.ecco),e.x1mth2=1-Eo,e.cc4=2*e.no*pt*wo*nc*(e.eta*(2+.5*Te)+e.ecco*(.5+2*Te)-Qf*Un/(wo*dr)*(-3*e.con41*(1-2*oe+Te*(1.5-.5*oe))+.75*e.x1mth2*(2*Te-oe*(1+Te))*Math.cos(2*e.argpo))),e.cc5=2*pt*wo*nc*(1+2.75*(Te+oe)+oe*Te),li=7.762359375e-7*Zi*Zi*e.no,e.mdot=e.no+.5*(pi=1.5*Qf*Zi*e.no)*rc*e.con41+.0625*(Li=.5*pi*Qf*Zi)*rc*(13-78*Eo+137*(Ft=Eo*Eo)),e.argpdot=-.5*pi*Hc+.0625*Li*(7-114*Eo+395*Ft)+li*(3-36*Eo+49*Ft),e.nodedot=(wr=-pi*Sa)+(.5*Li*(4-19*Eo)+2*li*(3-7*Eo))*Sa,hr=e.argpdot+e.nodedot,e.omgcof=e.bstar*ut*Math.cos(e.argpo),e.xmcof=0,e.ecco>1e-4&&(e.xmcof=-s0*_t*e.bstar/oe),e.nodecf=3.5*nc*wr*e.cc1,e.t2cof=1.5*e.cc1,e.xlcof=Math.abs(Sa+1)>15e-13?-.25*tp*ds*(3+5*Sa)/(1+Sa):-.25*tp*ds*(3+5*Sa)/15e-13,e.aycof=-.5*tp*ds;var oc=1+e.eta*Math.cos(e.mo);if(e.delmo=oc*oc*oc,e.sinmao=Math.sin(e.mo),e.x7thm1=7*Eo-1,2*Jo/e.no>=225){e.method="d",e.isimp=1,si=e.inclo;var le=function xW(e){var w,T,A,k,B,G,K,et,ut,_t,pt,Ft,Zt,de,oe,Te,hn,yn,si,hi,Sn,Vi,Zi,dr,Ht,fe,pe,Pe,jn,fi,Ve,sr,vn,Ue,en,wn,An,Xn,yi,lo,Lr,yo,ai,Fi,Dr,vi,pi,Li,li,Un,hr,wr,ji,Qi,vo,co,Qo,Lo,Os,ks,xo,uo,bo,o=e.epoch,a=e.argpp,u=e.tc,f=e.inclp,g=e.nodep,nc=e.np,Gc=e.ep,ic=Math.sin(g),rc=Math.cos(g),ds=Math.sin(a),oa=Math.cos(a),oc=Math.sin(f),qc=Math.cos(f),le=Gc*Gc,sc=1-le,fl=Math.sqrt(sc),Xd=o+18261.5+u/1440,Wc=(4.523602-.00092422029*Xd)%br,No=Math.sin(Wc),ac=Math.cos(Wc),l0=.91375164-.03568096*ac,c0=Math.sqrt(1-l0*l0),Fs=.089683511*No/c0,Ls=Math.sqrt(1-Fs*Fs),Ur=5.8351514+.001944368*Xd,kg=.39785416*No/c0;kg=Math.atan2(kg,Ls*ac+.91744867*Fs*No),kg+=Ur-Wc;var tF=Math.cos(kg),eF=Math.sin(kg);hi=.1945905,Sn=-.98088458,dr=.91744867,Ht=.39785416,Vi=rc,Zi=ic,pt=29864797e-13;for(var nF=1/nc,Qw=0;Qw<2;)vo=-6*(w=hi*Vi+Sn*dr*Zi)*(B=-oc*(K=-hi*Zi+Sn*dr*Vi)+qc*(et=Sn*Ht))+le*(-24*(Ft=w*oa+(T=qc*K+oc*et)*ds)*(yn=B*oa)-6*(de=-w*ds+T*oa)*(Te=B*ds)),co=-6*(w*(G=-oc*(ut=Sn*Zi+hi*dr*Vi)+qc*(_t=hi*Ht))+(A=-Sn*Vi+hi*dr*Zi)*B)+le*(-24*((Zt=A*oa+(k=qc*ut+oc*_t)*ds)*yn+Ft*(si=G*oa))+-6*(de*(hn=G*ds)+(oe=-A*ds+k*oa)*Te)),Qo=-6*A*G+le*(-24*Zt*si-6*oe*hn),Lo=6*T*B+le*(24*Ft*Te-6*de*yn),Os=6*(k*B+T*G)+le*(24*(Zt*Te+Ft*hn)-6*(oe*yn+de*si)),ks=6*k*G+le*(24*Zt*hn-6*oe*si),wr=(wr=3*(w*w+T*T)+(xo=12*Ft*Ft-3*de*de)*le)+wr+sc*xo,ji=(ji=6*(w*A+T*k)+(uo=24*Ft*Zt-6*de*oe)*le)+ji+sc*uo,Qi=(Qi=3*(A*A+k*k)+(bo=12*Zt*Zt-3*oe*oe)*le)+Qi+sc*bo,vi=-.5*(pi=pt*nF)/fl,Dr=-15*Gc*(Li=pi*fl),li=Ft*de+Zt*oe,Un=Zt*de+Ft*oe,hr=Zt*oe-Ft*de,1===(Qw+=1)&&(fe=Dr,pe=vi,Pe=pi,jn=Li,fi=li,Ve=Un,sr=hr,vn=wr,Ue=ji,en=Qi,wn=vo,An=co,Xn=Qo,yi=Lo,lo=Os,Lr=ks,yo=xo,ai=uo,Fi=bo,hi=tF,Sn=eF,dr=l0,Ht=c0,Vi=Ls*rc+Fs*ic,Zi=ic*Ls-rc*Fs,pt=4.7968065e-7);return{snodm:ic,cnodm:rc,sinim:oc,cosim:qc,sinomm:ds,cosomm:oa,day:Xd,e3:2*Dr*hr,ee2:2*Dr*Un,em:Gc,emsq:le,gam:Ur,peo:0,pgho:0,pho:0,pinco:0,plo:0,rtemsq:fl,se2:2*fe*Ve,se3:2*fe*sr,sgh2:2*jn*ai,sgh3:2*jn*(Fi-yo),sgh4:-18*jn*.01675,sh2:-2*pe*lo,sh3:-2*pe*(Lr-yi),si2:2*pe*An,si3:2*pe*(Xn-wn),sl2:-2*Pe*Ue,sl3:-2*Pe*(en-vn),sl4:-2*Pe*(-21-9*le)*.01675,s1:Dr,s2:vi,s3:pi,s4:Li,s5:li,s6:Un,s7:hr,ss1:fe,ss2:pe,ss3:Pe,ss4:jn,ss5:fi,ss6:Ve,ss7:sr,sz1:vn,sz2:Ue,sz3:en,sz11:wn,sz12:An,sz13:Xn,sz21:yi,sz22:lo,sz23:Lr,sz31:yo,sz32:ai,sz33:Fi,xgh2:2*Li*uo,xgh3:2*Li*(bo-xo),xgh4:-18*Li*.0549,xh2:-2*vi*Os,xh3:-2*vi*(ks-Lo),xi2:2*vi*co,xi3:2*vi*(Qo-vo),xl2:-2*pi*ji,xl3:-2*pi*(Qi-wr),xl4:-2*pi*(-21-9*le)*.0549,nm:nc,z1:wr,z2:ji,z3:Qi,z11:vo,z12:co,z13:Qo,z21:Lo,z22:Os,z23:ks,z31:xo,z32:uo,z33:bo,zmol:(.2299715*Xd-Ur+4.7199672)%br,zmos:(6.2565837+.017201977*Xd)%br}}({epoch:u,ep:e.ecco,argpp:e.argpo,tc:0,inclp:e.inclo,nodep:e.nodeo,np:e.no,e3:e.e3,ee2:e.ee2,peo:e.peo,pgho:e.pgho,pho:e.pho,pinco:e.pinco,plo:e.plo,se2:e.se2,se3:e.se3,sgh2:e.sgh2,sgh3:e.sgh3,sgh4:e.sgh4,sh2:e.sh2,sh3:e.sh3,si2:e.si2,si3:e.si3,sl2:e.sl2,sl3:e.sl3,sl4:e.sl4,xgh2:e.xgh2,xgh3:e.xgh3,xgh4:e.xgh4,xh2:e.xh2,xh3:e.xh3,xi2:e.xi2,xi3:e.xi3,xl2:e.xl2,xl3:e.xl3,xl4:e.xl4,zmol:e.zmol,zmos:e.zmos});e.e3=le.e3,e.ee2=le.ee2,e.peo=le.peo,e.pgho=le.pgho,e.pho=le.pho,e.pinco=le.pinco,e.plo=le.plo,e.se2=le.se2,e.se3=le.se3,e.sgh2=le.sgh2,e.sgh3=le.sgh3,e.sgh4=le.sgh4,e.sh2=le.sh2,e.sh3=le.sh3,e.si2=le.si2,e.si3=le.si3,e.sl2=le.sl2,e.sl3=le.sl3,e.sl4=le.sl4,G=le.sinim,B=le.cosim,Zt=le.em,de=le.emsq,fe=le.s1,pe=le.s2,Pe=le.s3,jn=le.s4,fi=le.s5,sr=le.ss1,vn=le.ss2,Ue=le.ss3,en=le.ss4,wn=le.ss5,An=le.sz1,Xn=le.sz3,yi=le.sz11,lo=le.sz13,Lr=le.sz21,yo=le.sz23,ai=le.sz31,Fi=le.sz33,e.xgh2=le.xgh2,e.xgh3=le.xgh3,e.xgh4=le.xgh4,e.xh2=le.xh2,e.xh3=le.xh3,e.xi2=le.xi2,e.xi3=le.xi3,e.xl2=le.xl2,e.xl3=le.xl3,e.xl4=le.xl4,e.zmol=le.zmol,e.zmos=le.zmos,Sn=le.nm,ji=le.z1,Qi=le.z3,vo=le.z11,co=le.z13,Qo=le.z21,Lo=le.z23,Os=le.z31,ks=le.z33;var fl=$4(e,{inclo:si,init:e.init,ep:e.ecco,inclp:e.inclo,nodep:e.nodeo,argpp:e.argpo,mp:e.mo,opsmode:e.operationmode});e.ecco=fl.ep,e.inclo=fl.inclp,e.nodeo=fl.nodep,e.argpo=fl.argpp,e.mo=fl.mp;var Ui=function bW(e){var ji,Qi,vo,ra,Eo,qc,sc,fl,Og,Ui,a0,Kw,Jw,Xd,Wc,No,ac,Fs,Ls,Ur,o=e.cosim,i=e.argpo,u=e.s2,w=e.sinim,A=e.ss2,oe=e.t,yn=e.mo,si=e.mdot,hi=e.no,Sn=e.nodeo,Vi=e.nodedot,Zi=e.xpidot,sr=e.ecco,vn=e.eccsq,Ue=e.emsq,en=e.em,wn=e.argpm,An=e.inclm,Xn=e.mm,yi=e.nm,lo=e.nodem,Lr=e.irez,yo=e.atime,ai=e.d2201,Fi=e.d2211,Dr=e.d3210,vi=e.d3222,pi=e.d4410,Li=e.d4422,li=e.d5220,Un=e.d5232,hr=e.d5421,wr=e.d5433,co=e.dnodt,Qo=e.domdt,Lo=e.del1,Os=e.del2,ks=e.del3,xo=e.xfact,uo=e.xlamo,bo=e.xli,hl=e.xni,tE=.0043752690880113,Fg=.00015835218,Lg=119459e-10;Lr=0,yi<.0052359877&&yi>.0034906585&&(Lr=1),yi>=.00826&&yi<=.00924&&en>=.5&&(Lr=2);var u0=-Lg*A*(e.sz21+e.sz23);(An<.052359877||An>Jo-.052359877)&&(u0=0),0!==w&&(u0/=w);var eE=-Fg*u*(e.z21+e.z23);(An<.052359877||An>Jo-.052359877)&&(eE=0),Qo=e.ss4*Lg*(e.sz31+e.sz33-6)-o*u0+e.s4*Fg*(e.z31+e.z33-6),co=u0,0!==w&&(Qo-=o/w*eE,co+=eE/w);var nE=(e.gsto+e.tc*tE)%br;if(en+=(ji=e.ss1*Lg*e.ss5+e.s1*Fg*e.s5)*oe,An+=(Qi=A*Lg*(e.sz11+e.sz13)+u*Fg*(e.z11+e.z13))*oe,wn+=Qo*oe,lo+=co*oe,Xn+=(vo=-Lg*e.ss3*(e.sz1+e.sz3-14-6*Ue)-Fg*e.s3*(e.z1+e.z3-14-6*Ue))*oe,0!==Lr){if(Fs=Math.pow(yi/$u,s0),2===Lr){var dF=en,hF=Ue;Ur=(en=sr)*(Ue=vn),en<=.65?(qc=3.616-13.247*en+16.29*Ue,sc=117.39*en-19.302-228.419*Ue+156.591*Ur,fl=109.7927*en-18.9068-214.6334*Ue+146.5816*Ur,Og=242.694*en-41.122-471.094*Ue+313.953*Ur,Ui=841.88*en-146.407-1629.014*Ue+1083.435*Ur,a0=3017.977*en-532.114-5740.032*Ue+3708.276*Ur):(qc=331.819*en-72.099-508.738*Ue+266.724*Ur,sc=1582.851*en-346.844-2415.925*Ue+1246.113*Ur,fl=1554.908*en-342.585-2366.899*Ue+1215.972*Ur,Og=4758.686*en-1052.797-7193.992*Ue+3651.957*Ur,Ui=16178.11*en-3581.69-24462.77*Ue+12422.52*Ur,a0=en>.715?29936.92*en-5149.66-54087.36*Ue+31324.56*Ur:1464.74-4664.75*en+3763.64*Ue),en<.7?(Xd=4988.61*en-919.2277-9064.77*Ue+5542.21*Ur,Kw=4568.6173*en-822.71072-8491.4146*Ue+5337.524*Ur,Jw=4690.25*en-853.666-8624.77*Ue+5341.4*Ur):(Xd=161616.52*en-37995.78-229838.2*Ue+109377.94*Ur,Kw=218913.95*en-51752.104-309468.16*Ue+146349.42*Ur,Jw=170470.89*en-40023.88-242699.48*Ue+115605.82*Ur),ai=(No=17891679e-13*(ac=yi*yi*3*(Fs*Fs)))*(ra=.75*(1+2*o+(Ls=o*o)))*(-.306-.44*(en-.64)),Fi=No*(1.5*(Wc=w*w))*qc,Dr=(No=3.7393792e-7*(ac*=Fs))*(1.875*w*(1-2*o-3*Ls))*sc,vi=No*(-1.875*w*(1+2*o-3*Ls))*fl,pi=(No=2*(ac*=Fs)*7.3636953e-9)*(35*Wc*ra)*Og,Li=No*(39.375*Wc*Wc)*Ui,li=(No=1.1428639e-7*(ac*=Fs))*(9.84375*w*(Wc*(1-2*o-5*Ls)+.33333333*(4*o-2+6*Ls)))*a0,Un=No*(w*(4.92187512*Wc*(-2-4*o+10*Ls)+6.56250012*(1+2*o-3*Ls)))*Jw,hr=(No=2*ac*2.1765803e-9)*(29.53125*w*(2-8*o+Ls*(8*o-12+10*Ls)))*Kw,wr=No*(29.53125*w*(-2-8*o+Ls*(12+8*o-10*Ls)))*Xd,uo=(yn+Sn+Sn-(nE+nE))%br,xo=si+vo+2*(Vi+co-tE)-hi,en=dF,Ue=hF}1===Lr&&(Eo=1+o,Os=2*(Lo=3*yi*yi*Fs*Fs)*(ra=.75*(1+o)*(1+o))*(1+Ue*(.8125*Ue-2.5))*17891679e-13,ks=3*Lo*(Eo*=1.875*Eo*Eo)*(1+Ue*(6.60937*Ue-6))*2.2123015e-7*Fs,Lo=Lo*(.9375*w*w*(1+3*o)-.75*(1+o))*(sc=1+2*Ue)*21460748e-13*Fs,uo=(yn+Sn+i-nE)%br,xo=si+Zi+vo+Qo+co-(hi+tE)),bo=uo,hl=hi,yo=0,yi=hi+0}return{em:en,argpm:wn,inclm:An,mm:Xn,nm:yi,nodem:lo,irez:Lr,atime:yo,d2201:ai,d2211:Fi,d3210:Dr,d3222:vi,d4410:pi,d4422:Li,d5220:li,d5232:Un,d5421:hr,d5433:wr,dedt:ji,didt:Qi,dmdt:vo,dndt:0,dnodt:co,domdt:Qo,del1:Lo,del2:Os,del3:ks,xfact:xo,xlamo:uo,xli:bo,xni:hl}}({cosim:B,emsq:de,argpo:e.argpo,s1:fe,s2:pe,s3:Pe,s4:jn,s5:fi,sinim:G,ss1:sr,ss2:vn,ss3:Ue,ss4:en,ss5:wn,sz1:An,sz3:Xn,sz11:yi,sz13:lo,sz21:Lr,sz23:yo,sz31:ai,sz33:Fi,t:e.t,tc:0,gsto:e.gsto,mo:e.mo,mdot:e.mdot,no:e.no,nodeo:e.nodeo,nodedot:e.nodedot,xpidot:hr,z1:ji,z3:Qi,z11:vo,z13:co,z21:Qo,z23:Lo,z31:Os,z33:ks,ecco:e.ecco,eccsq:Zd,em:Zt,argpm:0,inclm:si,mm:0,nm:Sn,nodem:0,irez:e.irez,atime:e.atime,d2201:e.d2201,d2211:e.d2211,d3210:e.d3210,d3222:e.d3222,d4410:e.d4410,d4422:e.d4422,d5220:e.d5220,d5232:e.d5232,d5421:e.d5421,d5433:e.d5433,dedt:e.dedt,didt:e.didt,dmdt:e.dmdt,dnodt:e.dnodt,domdt:e.domdt,del1:e.del1,del2:e.del2,del3:e.del3,xfact:e.xfact,xlamo:e.xlamo,xli:e.xli,xni:e.xni});e.irez=Ui.irez,e.atime=Ui.atime,e.d2201=Ui.d2201,e.d2211=Ui.d2211,e.d3210=Ui.d3210,e.d3222=Ui.d3222,e.d4410=Ui.d4410,e.d4422=Ui.d4422,e.d5220=Ui.d5220,e.d5232=Ui.d5232,e.d5421=Ui.d5421,e.d5433=Ui.d5433,e.dedt=Ui.dedt,e.didt=Ui.didt,e.dmdt=Ui.dmdt,e.dnodt=Ui.dnodt,e.domdt=Ui.domdt,e.del1=Ui.del1,e.del2=Ui.del2,e.del3=Ui.del3,e.xfact=Ui.xfact,e.xlamo=Ui.xlamo,e.xli=Ui.xli,e.xni=Ui.xni}1!==e.isimp&&(e.d2=4*wo*Un*(K=e.cc1*e.cc1),e.d3=(17*wo+Ve)*(vi=e.d2*Un*e.cc1/3),e.d4=.5*vi*wo*Un*(221*wo+31*Ve)*e.cc1,e.t3cof=e.d2+2*K,e.t4cof=.25*(3*e.d3+e.cc1*(12*e.d2+10*K)),e.t5cof=.2*(3*e.d4+12*e.cc1*e.d3+6*e.d2*e.d2+15*K*(2*e.d2+K)))}q4(e,0),e.init="n"}(f,{opsmode:"i",satn:f.satnum,epoch:f.jdsatepoch-2433281.5,xbstar:f.bstar,xecco:f.ecco,xargpo:f.argpo,xinclo:f.inclo,xmo:f.mo,xno:f.no,xnodeo:f.nodeo}),f}(this.tleLine1,this.tleLine2),f=function RW(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];var a=o[0],u=Array.prototype.slice.call(o,1);return q4(a,1440*(Kk.apply(void 0,function SW(e){return function TW(e){if(Array.isArray(e))return Jk(e)}(e)||function DW(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function IW(e,o){if(e){if("string"==typeof e)return Jk(e,o);var i=Object.prototype.toString.call(e).slice(8,-1);if("Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Jk(e,o)}}(e)||function AW(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(u))-a.jdsatepoch))}(a,i).position,x=function FW(e,o){for(var i=6378.137,u=Math.sqrt(e.x*e.x+e.y*e.y),f=(i-6356.7523142)/i,g=2*f-f*f,x=Math.atan2(e.y,e.x)-o;x<-Jo;)x+=br;for(;x>Jo;)x-=br;for(var k,T=0,A=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y));T<20;)k=1/Math.sqrt(1-g*(Math.sin(A)*Math.sin(A))),A=Math.atan2(e.z+i*k*g*Math.sin(A),u),T+=1;return{longitude:x,latitude:A,height:u/Math.cos(A)-i*k}}(f,G4(i)),w=function PW(e){if(e<-Jo/2||e>Jo/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return W4(e)}(x.latitude),T=function OW(e){if(e<-Jo||e>Jo)throw new RangeError("Longitude radians must be in range [-pi; pi].");return W4(e)}(x.longitude);this.coordinatesSubject.next({latitude:w,longitude:T,altitude:x.height})},0)}updateTLE(i,a){clearInterval(this.intervalId),this.tleLine1=i,this.tleLine2=a,this.updateSatelliteData()}updateJson(i){this.satelliteJsonSubject.next(i)}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275prov=ie({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Y4(e,o,i,a,u,f,g){try{var x=e[f](g),w=x.value}catch(T){return void i(T)}x.done?o(w):Promise.resolve(w).then(a,u)}let K4=(()=>{class e{constructor(i,a){this.http=i,this.satelliteService=a,this.selectedSatellite="",this.satelliteInfo="",this.satelliteName="",this.satelliteJson=""}getSatelliteInfo(){var i=this;return function zW(e){return function(){var o=this,i=arguments;return new Promise(function(a,u){var f=e.apply(o,i);function g(w){Y4(f,a,u,g,x,"next",w)}function x(w){Y4(f,a,u,g,x,"throw",w)}g(void 0)})}}(function*(){if(i.selectedSatellite)try{const a=yield i.http.get(`https://us-central1-orbital-trackr.cloudfunctions.net/app/satellite/${i.selectedSatellite}`,{responseType:"text"}).toPromise();if(void 0!==a){i.satelliteInfo=a;const f=a.split(/\r?\n/).filter(g=>g.trim().length>0);if(f.length>=3){i.satelliteName=f[0].trim();const g=f[1].trim(),x=f[2].trim();i.satelliteService.updateTLE(g,x)}else console.error("La respuesta del servidor no tiene el formato esperado")}else console.error("La respuesta del servidor est\xe1 vac\xeda");const u=yield i.http.get(`https://us-central1-orbital-trackr.cloudfunctions.net/app/info/${i.selectedSatellite}`).toPromise();void 0!==u&&u.length>0?i.satelliteService.updateJson(u[0]):console.error("La respuesta del servidor est\xe1 vac\xeda")}catch(a){console.error("Hubo un error al obtener la informaci\xf3n del sat\xe9lite:",a)}else console.error("Por favor, selecciona un sat\xe9lite")})()}static#t=this.\u0275fac=function(a){return new(a||e)(xt(UD),xt(X4))};static#e=this.\u0275cmp=_s({type:e,selectors:[["app-satellite-info"]],decls:10,vars:1,consts:[["for","satelliteSelector"],["id","satelliteSelector",3,"ngModel","ngModelChange","selectionChange"],["value","SSOT"],["value","EROS C3"],["value","EROS B"]],template:function(a,u){1&a&&(Dn(0,"mat-form-field")(1,"mat-label",0),rl(2,"Seleccionar Sat\xe9lite"),Nn(),Dn(3,"mat-select",1),Fr("ngModelChange",function(g){return u.selectedSatellite=g})("selectionChange",function(){return u.getSatelliteInfo()}),Dn(4,"mat-option",2),rl(5,"SSOT"),Nn(),Dn(6,"mat-option",3),rl(7,"EROS C3"),Nn(),Dn(8,"mat-option",4),rl(9,"EROS B"),Nn()()()),2&a&&(mn(3),Cn("ngModel",u.selectedSatellite))},dependencies:[P3,JO,Rq,Sk,Yq,Hz]})}return e})(),J4=(()=>{class e{constructor(i){this.satelliteService=i,this.mapInitialized=!1,this.satelliteJson="",this.coordinatesArray=[]}ngOnInit(){this.satelliteSubscription=this.satelliteService.coordinates$.subscribe(i=>{this.satelliteCoordinates=i,this.updateMarkerPosition(),this.coordinatesArray.push([this.satelliteCoordinates.longitude,this.satelliteCoordinates.latitude]),this.drawSatellitePath(this.coordinatesArray),this.initializeMap()}),this.satelliteService.satelliteJson$.subscribe(i=>{this.coordinatesArray.length=0,this.satelliteJson=i,this.mapInitialized&&this.addOrUpdateMarker()})}ngOnDestroy(){this.satelliteSubscription&&this.satelliteSubscription.unsubscribe()}ngAfterViewInit(){this.initializeMap()}initializeMap(){this.mapInitialized||(Yw().accessToken="pk.eyJ1Ijoic2hpemExOTkxIiwiYSI6ImNscWZ5eGo0ZTE0NGUya3F3eDA5bzh6bXoifQ.ru0c29-QaQzDC_AefTP9tA",this.satelliteSubscription=this.satelliteService.coordinates$.subscribe(i=>{this.satelliteCoordinates=i,this.satelliteCoordinates&&!this.map&&(this.map=new(Yw().Map)({container:"map",style:"mapbox://styles/shiza1991/clqrjzve800ld01pd59dg9y7s",center:[-70.648,-33.456],zoom:1}),this.map.addControl(new(Yw().NavigationControl)),this.map.on("load",()=>{this.mapInitialized=!0,this.addOrUpdateMarker()}))}))}flyToSatellite(){if(this.satelliteCoordinates&&this.map){const{latitude:i,longitude:a}=this.satelliteCoordinates;this.map.flyTo({center:[a,i],zoom:1,essential:!0})}}updateMarkerPosition(){this.mapInitialized&&this.map&&this.satelliteCoordinates&&this.addOrUpdateMarker()}addOrUpdateMarker(){if(!this.map||!this.satelliteCoordinates||!this.satelliteJson)return;const{latitude:i,longitude:a}=this.satelliteCoordinates,u=document.createElement("div");if(u.className="custom-marker",u.style.backgroundImage="url('../../assets/img/fasat.png')",u.style.width="150px",u.style.height="150px",u.style.backgroundSize="contain",u.style.backgroundPosition="center center",u.style.backgroundRepeat="no-repeat",u.style.cursor="pointer",this.marker){this.marker.setLngLat([a,i]);const f=this.marker.getElement().querySelector("#satelliteNameLabel");f&&(f.innerHTML=this.satelliteJson.OBJECT_NAME);const g=`\n\n        <h2>${this.satelliteJson.OBJECT_NAME}</h2>  \n        <table style="font-size: 6px; border-collapse: collapse; padding:0px">\n        <tr>\n            <td><strong>OBJECT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.OBJECT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ECCENTRICITY:</strong></td>\n            <td><pre>${this.satelliteJson.ECCENTRICITY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>INCLINATION:</strong></td>\n            <td><pre>${this.satelliteJson.INCLINATION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>RA_OF_ASC_NODE:</strong></td>\n            <td><pre>${this.satelliteJson.RA_OF_ASC_NODE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ARG_OF_PERICENTER:</strong></td>\n            <td><pre>${this.satelliteJson.ARG_OF_PERICENTER}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_ANOMALY:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_ANOMALY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPHEMERIS_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.EPHEMERIS_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>CLASSIFICATION_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.CLASSIFICATION_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>NORAD_CAT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.NORAD_CAT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ELEMENT_SET_NO:</strong></td>\n            <td><pre>${this.satelliteJson.ELEMENT_SET_NO}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>REV_AT_EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.REV_AT_EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>BSTAR:</strong></td>\n            <td><pre>${this.satelliteJson.BSTAR}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DOT}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DDOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DDOT}</pre></td>\n        </tr>\n        </table>`,x=this.marker.getPopup();x&&x.setHTML(g)}else{this.marker=new(Yw().Marker)(u).setLngLat([a,i]).addTo(this.map);const f=document.createElement("div");f.id="satelliteNameLabel",f.innerHTML=this.satelliteJson.OBJECT_NAME,f.style.color="#ffffff",f.style.fontSize="10px",f.style.height="25px",f.style.textAlign="center",f.style.backgroundColor="#000000",f.style.padding="5px",f.style.borderRadius="5px",f.style.width="70px",f.style.display="flex",f.style.justifyContent="center",f.style.alignItems="center",this.marker.getElement().appendChild(f);const g=new(Yw().Popup)({closeButton:!1}).setHTML(`\n\n        <h6>${this.satelliteJson.OBJECT_NAME}</h6>  \n        <table>\n        <tr>\n            <td><strong>OBJECT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.OBJECT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ECCENTRICITY:</strong></td>\n            <td><pre>${this.satelliteJson.ECCENTRICITY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>INCLINATION:</strong></td>\n            <td><pre>${this.satelliteJson.INCLINATION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>RA_OF_ASC_NODE:</strong></td>\n            <td><pre>${this.satelliteJson.RA_OF_ASC_NODE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ARG_OF_PERICENTER:</strong></td>\n            <td><pre>${this.satelliteJson.ARG_OF_PERICENTER}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_ANOMALY:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_ANOMALY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPHEMERIS_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.EPHEMERIS_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>CLASSIFICATION_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.CLASSIFICATION_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>NORAD_CAT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.NORAD_CAT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ELEMENT_SET_NO:</strong></td>\n            <td><pre>${this.satelliteJson.ELEMENT_SET_NO}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>REV_AT_EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.REV_AT_EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>BSTAR:</strong></td>\n            <td><pre>${this.satelliteJson.BSTAR}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DOT}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DDOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DDOT}</pre></td>\n        </tr>\n        </table>\n        `);this.marker.setPopup(g),this.marker.getElement().addEventListener("click",()=>{this.marker?.getPopup&&this.marker.getPopup().remove()})}}drawSatellitePath(i){if(this.map&&i&&!(i.length<2))if(this.map.getSource("satellitePath")){const a=this.map.getSource("satellitePath");a&&a.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:i}})}else this.map.addSource("satellitePath",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:i}}}),this.map.addLayer({id:"satellitePath",type:"line",source:"satellitePath",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FF0000","line-opacity":.8,"line-width":2}})}static#t=this.\u0275fac=function(a){return new(a||e)(xt(X4))};static#e=this.\u0275cmp=_s({type:e,selectors:[["app-satellite-map"]],decls:6,vars:0,consts:[[1,"container"],[1,"flex-container"],["mat-raised-button","","color","primary",1,"fly-button",3,"click"],["id","map",1,"map-container"]],template:function(a,u){1&a&&(Dn(0,"div",0)(1,"div",1),io(2,"app-satellite-info"),Dn(3,"button",2),Fr("click",function(){return u.flyToSatellite()}),rl(4,"Fly to Satellite"),Nn()()(),io(5,"div",3))},dependencies:[GH,K4],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding-bottom:10px}.flex-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;justify-content:center;width:100%;max-width:800px}.fly-button[_ngcontent-%COMP%]{flex:1 1 auto;max-width:200px;height:50px}app-satellite-info[_ngcontent-%COMP%]{flex:1 1 30%;max-width:30%}.map-container[_ngcontent-%COMP%]{margin-top:3%;margin-left:5%;height:600px;width:90%;align-items:center}.mapboxgl-map[_ngcontent-%COMP%]{font:9px/15px Helvetica Neue,Arial,Helvetica,sans-serif}@media (max-width: 768px){.map-container[_ngcontent-%COMP%]{height:600px;overflow:hidden}.flex-container[_ngcontent-%COMP%]{flex-direction:column;align-items:center}app-satellite-info[_ngcontent-%COMP%], .fly-button[_ngcontent-%COMP%]{flex:1 1 auto;min-width:55%;max-width:45%}}"]})}return e})();const BW=[{path:"satellite",component:J4},{path:"satelliteInfo",component:K4}];let VW=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e});static#n=this.\u0275inj=Ii({imports:[O4.forRoot(BW),O4]})}return e})(),jW=(()=>{class e{constructor(){this.title="Orbital"}static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275cmp=_s({type:e,selectors:[["app-root"]],decls:2,vars:0,consts:[[1,"app-container"]],template:function(a,u){1&a&&(Dn(0,"div",0),io(1,"app-satellite-map"),Nn())},dependencies:[J4],styles:[".app-container[_ngcontent-%COMP%]{margin-top:5%;justify-content:center;align-items:center;height:100vh;text-align:center}"]})}return e})(),UW=(()=>{class e{static#t=this.\u0275fac=function(a){return new(a||e)};static#e=this.\u0275mod=bi({type:e,bootstrap:[jW]});static#n=this.\u0275inj=Ii({imports:[QL,O6,VW,i8,p$,WH,QH,Kq,TB]})}return e})();Dj().bootstrapModule(UW).catch(e=>console.error(e))},574:function(d0){d0.exports=function(){"use strict";var Yd,Hu,Gn;function ep(Qt,st){if(Yd)if(Hu){var Ta="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Yd+")(sharedChunk); ("+Hu+")(sharedChunk); self.onerror = null;",pl={};Yd(pl),Gn=st(pl),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Gn.workerUrl=window.URL.createObjectURL(new Blob([Ta],{type:"text/javascript"})))}else Hu=st;else Yd=st}return ep(0,function(Qt){var st=typeof self<"u"?self:{},Ta="3.0.1";let pl;const $e={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==pl){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{pl=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{pl=n}}return pl},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!$e.API_URL)return null;try{const n=new URL($e.API_URL);return"api.mapbox.cn"===n.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===n.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},Ns={supported:!1,testSupport:function(n){!Gu&&lc&&(Zc?Ng(n):Da=n)}};let Da,lc,Gu=!1,Zc=!1;function Ng(n){const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,lc),n.isContextLost())return;Ns.supported=!0}catch{}n.deleteTexture(t),Gu=!0}st.document&&(lc=st.document.createElement("img"),lc.onload=function(){Da&&Ng(Da),Da=null,Zc=!0},lc.onerror=function(){Gu=!0,Da=null},lc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const np="01";function hs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ml=gl;function gl(n,t,r,s){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=s}gl.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(void 0===t&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,s=0;s<8;s++){var l=this.sampleCurveX(r)-n;if(Math.abs(l)<t)return r;var c=this.sampleCurveDerivativeX(r);if(Math.abs(c)<1e-6)break;r-=l/c}var d=0,h=1;for(r=n,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-n)<t));s++)n>l?d=r:h=r,r=.5*(h-d)+d;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var zg=hs(ml),Xc=_l;function _l(n,t){this.x=n,this.y=t}_l.prototype={clone:function(){return new _l(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),r=Math.sin(n),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround:function(n,t){var r=Math.cos(n),s=Math.sin(n),l=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_l.convert=function(n){return n instanceof _l?n:Array.isArray(n)?new _l(n[0],n[1]):n};var nt=hs(Xc);function ln(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!ln(n[r],t[r]))return!1;return!0}if("object"==typeof n&&null!==n&&null!==t){if("object"!=typeof t||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!ln(n[r],t[r]))return!1;return!0}return n===t}const qu=Math.PI/180,yl=180/Math.PI;function Ie(n){return n*qu}function Er(n){return n*yl}const f0=[[0,0],[1,0],[1,1],[0,1]];function Yc(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function vl(n){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const c of n)t=Math.min(t,c.x),r=Math.min(r,c.y),s=Math.max(s,c.x),l=Math.max(l,c.y);return{min:new nt(t,r),max:new nt(s,l)}}function Wu(n,t,r=0,s=!0){const l=new nt(r,r),c=n.sub(l),d=t.add(l),h=[c,new nt(d.x,c.y),d,new nt(c.x,d.y)];return s&&h.push(c.clone()),h}function Kc(n,t,r,s){const l=new zg(n,t,r,s);return function(c){return l.solve(c)}}const $n=Kc(.25,.1,.25,1);function Jt(n,t,r){return Math.min(r,Math.max(t,n))}function xl(n,t,r){return(r=Jt((r-n)/(t-n),0,1))*r*(3-2*r)}function bl(n,t,r){const s=r-t,l=((n-t)%s+s)%s+t;return l===t?r:l}function Zu(n,t,r){if(!n.length)return r(null,[]);let s=n.length;const l=new Array(n.length);let c=null;n.forEach((d,h)=>{t(d,(p,m)=>{p&&(c=p),l[h]=m,0==--s&&r(c,l)})})}function xn(n){const t=[];for(const r in n)t.push(n[r]);return t}function Yt(n,...t){for(const r of t)for(const s in r)n[s]=r[s];return n}function ts(n,t){const r={};for(let s=0;s<t.length;s++){const l=t[s];l in n&&(r[l]=n[l])}return r}let ar=1;function Ti(){return ar++}function Bg(){return function n(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function cn(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Kd(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Ir(n,t){n.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function Jc(n,t){return-1!==n.indexOf(t,n.length-t.length)}function Jd(n,t,r){const s={};for(const l in n)s[l]=t.call(r||this,n[l],l,n);return s}function Pt(n,t,r){const s={};for(const l in n)t.call(r||this,n[l],l,n)&&(s[l]=n[l]);return s}function $(n){return Array.isArray(n)?n.map($):"object"==typeof n&&n?Jd(n,$):n}const W={};function Q(n){W[n]||(typeof console<"u"&&console.warn(n),W[n]=!0)}function wt(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function Mt(n){let t=0;for(let r,s,l=0,c=n.length,d=c-1;l<c;d=l++)r=n[l],s=n[d],t+=(s.x-r.x)*(r.y+s.y);return t}function qt([n,t,r]){const s=Ie(t+90),l=Ie(r);return{x:n*Math.cos(s)*Math.sin(l),y:n*Math.sin(s)*Math.sin(l),z:n*Math.cos(l),azimuthal:t,polar:r}}function te(n,t,r){const s=Math.sqrt(n*n+t*t+r*r),l=s>0?Math.acos(r/s)*yl:0;let c=0!==n||0!==t?Math.atan2(-t,-n)*yl+90:0;return c<0&&(c+=360),[s,c,l]}function Ct(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ae(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,c)=>{const d=l||c;return t[s]=!d||d.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let xe=null;function be(){return!!st.document.fullscreenElement||!!st.document.webkitFullscreenElement}function Yn(n){try{const t=st[n];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ni(n,t){return[n[4*t],n[4*t+1],n[4*t+2],n[4*t+3]]}function zr(n,t,r){n[4*t+0]=r[0],n[4*t+1]=r[1],n[4*t+2]=r[2],n[4*t+3]=r[3]}function zi(n,t){return[Math.pow(n[0],2.2)*t,Math.pow(n[1],2.2)*t,Math.pow(n[2],2.2)*t]}function ni(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]}const ii="mapbox-tiles";let es,Ia,Co=500,zo=50;function Qd(){try{return st.caches}catch{}}function fs(){Qd()&&!es&&(es=st.caches.open(ii))}function cc(n){const t=n.indexOf("?");if(t<0)return n;const s=function(l){const c=l.indexOf("?");return c>0?l.slice(c+1).split("&"):[]}(n).filter(l=>{const c=l.split("=");return"language"===c[0]||"worldview"===c[0]});return s.length?`${n.slice(0,t)}?${s.join("&")}`:n.slice(0,t)}let Qc=1/0;function th(n){Qc++,Qc>zo&&(n.getActor().send("enforceCacheSizeLimit",Co),Qc=0)}const gt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(gt);class vt extends Error{constructor(t,r,s){401===r&&bn(s)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Tt=Ct()?()=>self.worker&&self.worker.referrer:()=>("blob:"===st.location.protocol?st.parent:st).location.href,Ot=function(n,t){if(!(/^file:/.test(r=n.url)||/^file:/.test(Tt())&&!/^\w+:/.test(r))){if(st.fetch&&st.Request&&st.AbortController&&st.Request.prototype.hasOwnProperty("signal"))return function(s,l){const c=new st.AbortController,d=new st.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Tt(),referrerPolicy:s.referrerPolicy,signal:c.signal});let h=!1,p=!1;const m=(_=d.url).indexOf("sku=")>0&&bn(_);var _;"json"===s.type&&d.headers.set("Accept","application/json");const y=(b,E,C)=>{if(p)return;if(b&&"SecurityError"!==b.message&&Q(b.toString()),E&&C)return v(E);const S=Date.now();st.fetch(d).then(M=>{if(M.ok){const D=m?M.clone():null;return v(M,D,S)}return l(new vt(M.statusText,M.status,s.url))}).catch(M=>{"AbortError"!==M.name&&l(new Error(`${M.message} ${s.url}`))})},v=(b,E,C)=>{("arrayBuffer"===s.type?b.arrayBuffer():"json"===s.type?b.json():b.text()).then(S=>{p||(E&&C&&function(M,D,R){if(fs(),!es)return;const P={status:D.status,statusText:D.statusText,headers:new st.Headers};D.headers.forEach((F,L)=>P.headers.set(L,F));const I=ae(D.headers.get("Cache-Control")||"");if(I["no-store"])return;I["max-age"]&&P.headers.set("Expires",new Date(R+1e3*I["max-age"]).toUTCString());const O=P.headers.get("Expires");O&&(new Date(O).getTime()-R<42e4||function(F,L){if(void 0===Ia)try{new Response(new ReadableStream),Ia=!0}catch{Ia=!1}Ia?L(F.body):F.blob().then(L)}(D,F=>{const L=new st.Response(F,P);fs(),es&&es.then(N=>N.put(cc(M.url),L)).catch(N=>Q(N.message))}))}(d,E,C),h=!0,l(null,S,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(S=>{p||l(new Error(S.message))})};return m?function(b,E){if(fs(),!es)return E(null);const C=cc(b.url);es.then(S=>{S.match(C).then(M=>{const D=function(R){if(!R)return!1;const P=new Date(R.headers.get("Expires")||0),I=ae(R.headers.get("Cache-Control")||"");return P>Date.now()&&!I["no-cache"]}(M);S.delete(C),D&&S.put(C,M.clone()),E(null,M,D)}).catch(E)}).catch(E)}(d,y):y(null,null),{cancel:()=>{p=!0,h||c.abort()}}}(n,t);if(Ct()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var r;return function(s,l){const c=new st.XMLHttpRequest;c.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(c.responseType="arraybuffer");for(const d in s.headers)c.setRequestHeader(d,s.headers[d]);return"json"===s.type&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials="include"===s.credentials,c.onerror=()=>{l(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||0===c.status)&&null!==c.response){let d=c.response;if("json"===s.type)try{d=JSON.parse(c.response)}catch(h){return l(h)}l(null,d,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else l(new vt(c.statusText,c.status,s.url))},c.send(s.body),{cancel:()=>c.abort()}}(n,t)},At=function(n,t){return Ot(Yt(n,{type:"json"}),t)},zt=function(n,t){return Ot(Yt(n,{type:"arrayBuffer"}),t)};function Ut(n){const t=st.document.createElement("a");return t.href=n,t.protocol===st.document.location.protocol&&t.host===st.document.location.host}const Lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Kt,Bt;Kt=[],Bt=0;const Oe=function(n,t){if(Ns.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Bt>=$e.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:n,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Kt.push(c),c}Bt++;let r=!1;const s=()=>{if(!r)for(r=!0,Bt--;Kt.length&&Bt<$e.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Kt.shift(),{requestParameters:d,callback:h,cancelled:p}=c;p||(c.cancel=Oe(d,h).cancel)}},l=zt(n,(c,d,h,p)=>{s(),c?t(c):d&&(st.createImageBitmap?function(m,_){const y=new st.Blob([new Uint8Array(m)],{type:"image/png"});st.createImageBitmap(y).then(v=>{_(null,v)}).catch(v=>{_(new Error(`Could not load image because of ${v.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(m,_)=>t(m,_,h,p)):function(m,_){const y=new st.Image,v=st.URL;y.onload=()=>{_(null,y),v.revokeObjectURL(y.src),y.onload=null,st.requestAnimationFrame(()=>{y.src=Lt})},y.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new st.Blob([new Uint8Array(m)],{type:"image/png"});y.src=m.byteLength?v.createObjectURL(b):Lt}(d,(m,_)=>t(m,_,h,p)))});return{cancel:()=>{l.cancel(),s()}}},Rn="NO_ACCESS_TOKEN";class ce{constructor(t,r,s){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let s=0;s<10;s++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",np,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!Tn(t))return t;const s=Cr(t);return s.params.push(`sdk=js-${Ta}`),s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!Tn(t))return t;const s=Cr(t);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeModelURL(t,r){if(!Tn(t))return t;const s=Cr(t);return s.path=`/models/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeSourceURL(t,r,s,l){if(!Tn(t))return t;const c=Cr(t);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),s&&c.params.push(`language=${s}`),l&&c.params.push(`worldview=${l}`),this._makeAPIURL(c,this._customAccessToken||r)}normalizeSpriteURL(t,r,s,l){const c=Cr(t);return Tn(t)?(c.path=`/styles/v1${c.path}/sprite${r}${s}`,this._makeAPIURL(c,this._customAccessToken||l)):(c.path+=`${r}${s}`,ns(c))}normalizeTileURL(t,r,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Tn(t))return t;const l=Cr(t);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||s&&"raster"!==l.authority&&512===s?"@2x":""}${Ns.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${$e.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${$e.TILE_URL_VERSION}${l.path}`);const c=this._customAccessToken||function(d){for(const h of d){const p=h.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(l.params)||$e.ACCESS_TOKEN;return $e.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,c)}canonicalizeTileURL(t,r){const s=Cr(t);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return t;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${$e.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${$e.TILE_URL_VERSION}/`,"")}`;let c=s.params;return r&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(l+=`?${c.join("&")}`),l}canonicalizeTileset(t,r){const s=!!r&&Tn(r),l=[];for(const c of t.tiles||[])bn(c)?l.push(this.canonicalizeTileURL(c,s)):l.push(c);return l}_makeAPIURL(t,r){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=Cr($e.API_URL);if(t.protocol=l.protocol,t.authority=l.authority,"http"===t.protocol){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if("/"!==l.path&&(t.path=`${l.path}${t.path}`),!$e.REQUIRE_ACCESS_TOKEN)return ns(t);if(r=r||$e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return t.params=t.params.filter(c=>-1===c.indexOf("access_token")),t.params.push(`access_token=${r||""}`),ns(t)}}function Tn(n){return 0===n.indexOf("mapbox:")}function bn(n){return $e.API_URL_REGEX.test(n)}function Xi(n){return $e.API_CDN_URL_REGEX.test(n)}function fr(n){return $e.API_STYLE_REGEX.test(n)&&!Mo(n)}function Mo(n){return $e.API_SPRITE_REGEX.test(n)}const sa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Cr(n){const t=n.match(sa);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ns(n){const t=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${t}`}const So="mapbox.eventData";function ps(n){if(!n)return null;const t=n.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(st.atob(t[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class tu{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=ps($e.ACCESS_TOKEN);let s="";return s=r&&r.u?st.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,c)=>String.fromCharCode(+("0x"+c)))):$e.ACCESS_TOKEN||"",t?`${So}.${t}:${s}`:`${So}:${s}`}fetchEventData(){const t=Yn("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{const l=st.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const c=st.localStorage.getItem(s);c&&(this.anonId=c)}catch{Q("Unable to read from LocalStorage")}}saveEventData(){const t=Yn("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{st.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&st.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Q("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,s,l){if(!$e.EVENTS_URL)return;const c=Cr($e.EVENTS_URL);c.params.push(`access_token=${l||$e.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(t).toISOString()},h=r?Yt(d,r):d,p={url:ns(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([h])};var _;this.pendingRequest=(_=m=>{this.pendingRequest=null,s(m),this.saveEventData(),this.processRequests(l)},Ot(Yt(p,{method:"POST"}),_))}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const pr=new class extends tu{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,t){$e.EVENTS_URL&&$e.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>Tn(r)||bn(r))&&this.queueRequest(Date.now(),t)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ps($e.ACCESS_TOKEN),r=t?t.u:$e.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;Kd(this.anonId)||(this.anonId=Bg(),s=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),d=new Date(l),h=(l-this.eventData.lastSuccess)/864e5;s=s||h>=1||h<-1||c.getDate()!==d.getDate()}else s=!0;s?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ta,skuId:np,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},n):this.processRequests()}},eu=pr.postTurnstileEvent.bind(pr),Aa=new class extends tu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,t,r,s){this.skuToken=t,this.errorCb=s,$e.EVENTS_URL&&(r||$e.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Rn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Kd(this.anonId)||(this.anonId=Bg()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ta,skuId:np,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},n))}},fF=Aa.postMapLoadEvent.bind(Aa),iE=new class extends tu{constructor(){super("gljs.performance")}postPerformanceEvent(n,t){$e.EVENTS_URL&&(n||$e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:r}=this.queue.shift(),s=function(l){const c=st.performance.getEntriesByType("resource"),d=st.performance.getEntriesByType("mark"),h=function(v){const b={};if(v)for(const E in v)if("other"!==E)for(const C of v[E]){const S=`${E}ResolveRangeMin`,M=`${E}ResolveRangeMax`,D=`${E}RequestCount`,R=`${E}RequestCachedCount`;b[S]=Math.min(b[S]||1/0,C.startTime),b[M]=Math.max(b[M]||-1/0,C.responseEnd);const P=I=>{void 0===b[I]&&(b[I]=0),++b[I]};void 0!==C.transferSize&&0===C.transferSize&&P(R),P(D)}return b}(function(v,b){const E={};if(v)for(const C of v){const S=b(C);void 0===E[S]&&(E[S]=[]),E[S].push(C)}return E}(c,BI)),p=st.devicePixelRatio,m=st.navigator.connection||st.navigator.mozConnection||st.navigator.webkitConnection,_={counters:[],metadata:[],attributes:[]},y=(v,b,E)=>{null!=E&&v.push({name:b,value:E.toString()})};for(const v in h)y(_.counters,v,h[v]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(y(_.counters,"interactionRangeMin",l.interactionRange[0]),y(_.counters,"interactionRangeMax",l.interactionRange[1])),d)for(const v of Object.keys(ip)){const b=ip[v],E=d.find(C=>C.name===b);E&&y(_.counters,b,E.startTime)}return y(_.counters,"visibilityHidden",l.visibilityHidden),y(_.attributes,"style",function(v){if(v)for(const b of v){const E=b.name.split("?")[0];if(fr(E)){const C=E.split("/").slice(-2);if(2===C.length)return`mapbox://styles/${C[0]}/${C[1]}`}}}(c)),y(_.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),y(_.attributes,"fogEnabled",l.fogEnabled?"true":"false"),y(_.attributes,"projection",l.projection),y(_.attributes,"zoom",l.zoom),y(_.metadata,"devicePixelRatio",p),y(_.metadata,"connectionEffectiveType",m?m.effectiveType:void 0),y(_.metadata,"navigatorUserAgent",st.navigator.userAgent),y(_.metadata,"screenWidth",st.screen.width),y(_.metadata,"screenHeight",st.screen.height),y(_.metadata,"windowWidth",st.innerWidth),y(_.metadata,"windowHeight",st.innerHeight),y(_.metadata,"mapWidth",l.width/p),y(_.metadata,"mapHeight",l.height/p),y(_.metadata,"webglRenderer",l.renderer),y(_.metadata,"webglVendor",l.vendor),y(_.metadata,"sdkVersion",Ta),y(_.metadata,"sdkIdentifier","mapbox-gl-js"),_}(r);for(const l of s.metadata);for(const l of s.counters);for(const l of s.attributes);this.postEvent(t,s,()=>{},n)}},rE=iE.postPerformanceEvent.bind(iE),Vg=new class extends tu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,t,r,s){if(!$e.API_URL||!$e.SESSION_PATH)return;const l=Cr($e.API_URL+$e.SESSION_PATH);l.params.push(`sku=${t||""}`),l.params.push(`access_token=${s||$e.ACCESS_TOKEN||""}`);const c={url:ns(l),headers:{"Content-Type":"text/plain"}};var h;this.pendingRequest=(h=d=>{this.pendingRequest=null,r(d),this.saveEventData(),this.processRequests(s)},Ot(Yt(c,{method:"GET"}),h))}getSessionAPI(n,t,r,s){this.skuToken=t,this.errorCb=s,$e.SESSION_PATH&&$e.API_URL&&(r||$e.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Rn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},n)}},oE=Vg.getSessionAPI.bind(Vg),nu=new Set;function sE(n,t){t?nu.add(n):nu.delete(n)}const ip={create:"create",load:"load",fullLoad:"fullLoad"},p0={mark(n){st.performance.mark(n)},measure(n,t,r){st.performance.measure(n,t,r)}};function BI(n){const t=n.name.split("?")[0];return Xi(t)&&t.includes("mapbox-gl.js")?"javascript":Xi(t)&&t.includes("mapbox-gl.css")?"css":$e.API_FONTS_REGEX.test(t)?"fontRange":Mo(t)?"sprite":fr(t)?"style":$e.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const VI=st.performance;function aE(n){const t=n?n.url.toString():void 0;return VI.getEntriesByName(t)}var lE=jg;function jg(n){return t=n,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var s,l,c=new Blob([""],{type:"text/javascript"}),d=URL.createObjectURL(c);try{l=new Worker(d),s=!0}catch{s=!1}return l&&l.terminate(),URL.revokeObjectURL(d),s}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var s=document.createElement("canvas");s.width=s.height=1;var l=s.getContext("2d");if(!l)return!1;var c=l.getImageData(0,0,1,1);return c&&c.width===s.width}()||(void 0===m0[r=t&&t.failIfMajorPerformanceCaveat]&&(m0[r]=function(s){var l,d,h,p,c=(d=s,h=document.createElement("canvas"),(p=Object.create(jg.webGLContextAttributes)).failIfMajorPerformanceCaveat=d,h.getContext("webgl",p)||h.getContext("experimental-webgl",p));if(!c)return!1;try{l=c.createShader(c.VERTEX_SHADER)}catch{return!1}return!(!l||c.isContextLost())&&(c.shaderSource(l,"void main() {}"),c.compileShader(l),!0===c.getShaderParameter(l,c.COMPILE_STATUS))}(r)),!m0[r]||document.documentMode));var t,r}var m0={};let Ug,Ar,uc,$r;jg.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const kt={now:()=>void 0!==uc?uc:st.performance.now(),setNow(n){uc=n},restoreNow(){uc=void 0},frame(n){const t=st.requestAnimationFrame(n);return{cancel:()=>st.cancelAnimationFrame(t)}},getImageData(n,t=0){const{width:r,height:s}=n;$r||($r=st.document.createElement("canvas"));const l=$r.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>$r.width||s>$r.height)&&($r.width=r,$r.height=s),l.clearRect(-t,-t,r+2*t,s+2*t),l.drawImage(n,0,0,r,s),l.getImageData(-t,-t,r+2*t,s+2*t)},resolveURL:n=>(Ug||(Ug=st.document.createElement("a")),Ug.href=n,Ug.href),get devicePixelRatio(){return st.devicePixelRatio},get prefersReducedMotion(){return!!st.matchMedia&&(null==Ar&&(Ar=st.matchMedia("(prefers-reduced-motion: reduce)")),Ar.matches)}};function zn(n,t,r){const s=st.document.createElement(n);return void 0!==t&&(s.className=t),r&&r.appendChild(s),s}function Ra(n,t,r){const s=st.document.createElementNS("http://www.w3.org/2000/svg",n);for(const l of Object.keys(t))s.setAttributeNS(null,l,t[l]);return r&&r.appendChild(s),s}const Hr=st.document&&st.document.documentElement.style,Xu=Hr&&void 0!==Hr.userSelect?"userSelect":"WebkitUserSelect";let cE;function xi(){Hr&&Xu&&(cE=Hr[Xu],Hr[Xu]="none")}function rp(){Hr&&Xu&&(Hr[Xu]=cE)}function Rr(n){n.preventDefault(),n.stopPropagation(),st.removeEventListener("click",Rr,!0)}function op(){st.addEventListener("click",Rr,!0),st.setTimeout(()=>{st.removeEventListener("click",Rr,!0)},0)}function sp(n,t){const r=n.getBoundingClientRect();return $g(n,r,t)}function Di(n,t){const r=n.getBoundingClientRect(),s=[];for(let l=0;l<t.length;l++)s.push($g(n,r,t[l]));return s}function Qe(n){return void 0!==st.InstallTrigger&&2===n.button&&n.ctrlKey&&st.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button}function $g(n,t,r){const s=n.offsetWidth===t.width?1:n.offsetWidth/t.width;return new nt((r.clientX-t.left)*s,(r.clientY-t.top)*s)}function Hg(n,t,r){r[n]&&-1!==r[n].indexOf(t)||(r[n]=r[n]||[],r[n].push(t))}function uE(n,t,r){if(r&&r[n]){const s=r[n].indexOf(t);-1!==s&&r[n].splice(s,1)}}class St{constructor(t,r={}){Yt(this,r),this.type=t}}class at extends St{constructor(t,r={}){super("error",Yt({error:t},r))}}class $i{on(t,r){return this._listeners=this._listeners||{},Hg(t,r,this._listeners),this}off(t,r){return uE(t,r,this._listeners),uE(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Hg(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){"string"==typeof t&&(t=new St(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const h of l)h.call(this,t);const c=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const h of c)uE(s,h,this._oneTimeListeners),h.call(this,t);const d=this._eventedParent;d&&(Yt(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),d.fire(t))}else t instanceof at&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var J=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class It{constructor(t,r,s,l){this.message=(t?`${t}: `:"")+s,l&&(this.identifier=l),null!=r&&r.__line__&&(this.line=r.__line__)}}class Yu extends It{}function iu(n,...t){for(const r of t)for(const s in r)n[s]=r[s];return n}function mr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Pa(n){if(Array.isArray(n))return n.map(Pa);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Pa(n[r]);return t}return mr(n)}class zs extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}var dc=zs;class g0{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(t){return new g0(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var pF=g0;const aa={kind:"null"},Wt={kind:"number"},un={kind:"string"},En={kind:"boolean"},Oa={kind:"color"},eh={kind:"object"},fn={kind:"value"},Gg={kind:"collator"},qg={kind:"formatted"},Bo={kind:"resolvedImage"};function Se(n,t){return{kind:"array",itemType:n,N:t}}function gr(n){if("array"===n.kind){const t=gr(n.itemType);return"number"==typeof n.N?`array<${t}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${t}>`}return n.kind}const mF=[aa,Wt,un,En,Oa,qg,eh,Se(fn),Bo];function Wg(n,t){if("error"===t.kind)return null;if("array"===n.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Wg(n.itemType,t.itemType))&&("number"!=typeof n.N||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if("value"===n.kind)for(const r of mF)if(!Wg(r,t))return null}return`Expected ${gr(n)} but found ${gr(t)} instead.`}function ie(n,t){return t.some(r=>r.kind===n.kind)}function Zg(n,t){return t.some(r=>"null"===r?null===n:"array"===r?Array.isArray(n):"object"===r?n&&!Array.isArray(n)&&"object"==typeof n:r===typeof n)}var Ii,ap={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Xg(n){return(n=Math.round(n))<0?0:n>255?255:n}function Yg(n){return Xg("%"===n[n.length-1]?parseFloat(n)/100*255:parseInt(n))}function Kg(n){return(t="%"===n[n.length-1]?parseFloat(n)/100:parseFloat(n))<0?0:t>1?1:t;var t}function nh(n,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?n+(t-n)*r*6:2*r<1?t:3*r<2?n+(t-n)*(2/3-r)*6:n}try{Ii={}.parseCSSColor=function(n){var t,r=n.replace(/ /g,"").toLowerCase();if(r in ap)return ap[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var s=r.indexOf("("),l=r.indexOf(")");if(-1!==s&&l+1===r.length){var c=r.substr(0,s),d=r.substr(s+1,l-(s+1)).split(","),h=1;switch(c){case"rgba":if(4!==d.length)return null;h=Kg(d.pop());case"rgb":return 3!==d.length?null:[Yg(d[0]),Yg(d[1]),Yg(d[2]),h];case"hsla":if(4!==d.length)return null;h=Kg(d.pop());case"hsl":if(3!==d.length)return null;var p=(parseFloat(d[0])%360+360)%360/360,m=Kg(d[1]),_=Kg(d[2]),y=_<=.5?_*(m+1):_+m-_*m,v=2*_-y;return[Xg(255*nh(v,y,p+1/3)),Xg(255*nh(v,y,p)),Xg(255*nh(v,y,p-1/3)),h];default:return null}}return null}}catch{}class To{constructor(t,r,s,l=1){this.r=t,this.g=r,this.b=s,this.a=l}static parse(t){if(!t)return;if(t instanceof To)return t;if("string"!=typeof t)return;const r=Ii(t);return r?new To(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[t,r,s,l]=this.toArray();return`rgba(${Math.round(t)},${Math.round(r)},${Math.round(s)},${l})`}toArray(){const{r:t,g:r,b:s,a:l}=this;return 0===l?[0,0,0,0]:[255*t/l,255*r/l,255*s/l,l]}toArray01(){const{r:t,g:r,b:s,a:l}=this;return 0===l?[0,0,0,0]:[t/l,r/l,s/l,l]}toArray01Scaled(t){const{r,g:s,b:l,a:c}=this;return 0===c?[0,0,0]:[r/c*t,s/c*t,l/c*t]}toArray01PremultipliedAlpha(){const{r:t,g:r,b:s,a:l}=this;return[t,r,s,l]}toArray01Linear(){const{r:t,g:r,b:s,a:l}=this;return 0===l?[0,0,0,0]:[Math.pow(t/l,2.2),Math.pow(r/l,2.2),Math.pow(s/l,2.2),l]}}To.black=new To(0,0,0,1),To.white=new To(1,1,1,1),To.transparent=new To(0,0,0,0),To.red=new To(1,0,0,1),To.blue=new To(0,0,1,1);var Ne=To;class Jg{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _0{constructor(t,r,s,l,c){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=s,this.fontStack=l,this.textColor=c}}class Ye{constructor(t){this.sections=t}static fromString(t){return new Ye([new _0(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length)}static factory(t){return t instanceof Ye?t:Ye.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){t.push(["image",r.image.namePrimary]);continue}t.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(s)}return t}}class ms{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,r){return t?new ms({namePrimary:t,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function y0(n,t,r,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,t,r,s]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gr(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof Ne||n instanceof Jg||n instanceof Ye||n instanceof ms)return!0;if(Array.isArray(n)){for(const t of n)if(!Gr(t))return!1;return!0}if("object"==typeof n){for(const t in n)if(!Gr(n[t]))return!1;return!0}return!1}function Mr(n){if(null===n)return aa;if("string"==typeof n)return un;if("boolean"==typeof n)return En;if("number"==typeof n)return Wt;if(n instanceof Ne)return Oa;if(n instanceof Jg)return Gg;if(n instanceof Ye)return qg;if(n instanceof ms)return Bo;if(Array.isArray(n)){const t=n.length;let r;for(const s of n){const l=Mr(s);if(r){if(r===l)continue;r=fn;break}r=l}return Se(r||fn,t)}return eh}function Qg(n){const t=typeof n;return null===n?"":"string"===t||"number"===t||"boolean"===t?String(n):n instanceof Ne||n instanceof Ye||n instanceof ms?n.toString():JSON.stringify(n)}class Bi{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(2!==t.length)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Gr(t[1]))return r.error("invalid value");const s=t[1];let l=Mr(s);const c=r.expectedType;return"array"!==l.kind||0!==l.N||!c||"array"!==c.kind||"number"==typeof c.N&&0!==c.N||(l=c),new Bi(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ne?["rgba"].concat(this.value.toArray()):this.value instanceof Ye?this.value.serialize():this.value}}var t_=Bi,qr=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const Gt={string:un,number:Wt,boolean:En,object:eh};class lp{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,l=1;const c=t[0];if("array"===c){let h,p;if(t.length>2){const m=t[1];if("string"!=typeof m||!(m in Gt)||"object"===m)return r.error('The item type argument of "array" must be one of string, number, boolean',1);h=Gt[m],l++}else h=fn;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);p=t[2],l++}s=Se(h,p)}else s=Gt[c];const d=[];for(;l<t.length;l++){const h=r.parse(t[l],l,fn);if(!h)return null;d.push(h)}return new lp(s,d)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!Wg(this.type,Mr(s)))return s;if(r===this.args.length-1)throw new qr(`Expected value to be of type ${gr(this.type)}, but found ${gr(Mr(s))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if("array"===t.kind){const s=t.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){r.push(s.kind);const l=t.N;("number"==typeof l||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(s=>s.serialize()))}}var ka=lp;class ih{constructor(t){this.type=qg,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&"object"==typeof s)return r.error("First argument must be an image or text section.");const l=[];let c=!1;for(let d=1;d<=t.length-1;++d){const h=t[d];if(c&&"object"==typeof h&&!Array.isArray(h)){c=!1;let p=null;if(h["font-scale"]&&(p=r.parse(h["font-scale"],1,Wt),!p))return null;let m=null;if(h["text-font"]&&(m=r.parse(h["text-font"],1,Se(un)),!m))return null;let _=null;if(h["text-color"]&&(_=r.parse(h["text-color"],1,Oa),!_))return null;const y=l[l.length-1];y.scale=p,y.font=m,y.textColor=_}else{const p=r.parse(t[d],1,fn);if(!p)return null;const m=p.type.kind;if("string"!==m&&"value"!==m&&"null"!==m&&"resolvedImage"!==m)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,l.push({content:p,scale:null,font:null,textColor:null})}}return new ih(l)}evaluate(t){return new Ye(this.sections.map(r=>{const s=r.content.evaluate(t);return Mr(s)===Bo?new _0("",s,null,null,null):new _0(Qg(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),t.push(s)}return t}}class Ku{constructor(t,r){this.type=Bo,this.inputPrimary=t,this.inputSecondary=r}static parse(t,r){if(t.length<2)return r.error("Expected two or more arguments.");const s=r.parse(t[1],1,un);if(!s)return r.error("No image name provided.");if(2===t.length)return new Ku(s);const l=r.parse(t[2],1,un);return l?new Ku(s,l):r.error("Secondary image variant is not a string.")}evaluate(t){const r=ms.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&t.availableImages&&(r.available=t.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Pn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}const v0={"to-boolean":En,"to-color":Oa,"to-number":Wt,"to-string":un};class dE{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0],l=[];let c=aa;if("to-array"===s){if(!Array.isArray(t[1]))return null;const d=t[1].length;if(r.expectedType){if("array"!==r.expectedType.kind)return r.error(`Expected ${r.expectedType.kind} but found array.`);c=Se(r.expectedType.itemType,d)}else{if(!(d>0&&Gr(t[1][0])))return null;c=Se(Mr(t[1][0]),d)}for(let h=0;h<d;h++){const p=t[1][h];let m;if("array"===Pn(p))m=r.parse(p,void 0,c.itemType);else{const _=Pn(p);if(_!==c.itemType.kind)return r.error(`Expected ${c.itemType.kind} but found ${_}.`);m=r.registry.literal.parse(["literal",void 0===p?null:p],r)}if(!m)return null;l.push(m)}}else{if(("to-boolean"===s||"to-string"===s)&&2!==t.length)return r.error("Expected one argument.");c=v0[s];for(let d=1;d<t.length;d++){const h=r.parse(t[d],d,fn);if(!h)return null;l.push(h)}}return new dE(c,l)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let r,s;for(const l of this.args){if(r=l.evaluate(t),s=null,r instanceof Ne)return r;if("string"==typeof r){const c=t.parseColor(r);if(c)return c}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:y0(r[0],r[1],r[2],r[3]),!s))return new Ne(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new qr(s||`Could not parse color from value '${"string"==typeof r?r:String(JSON.stringify(r))}'`)}if("number"===this.type.kind){let r=null;for(const s of this.args){if(r=s.evaluate(t),null===r)return 0;const l=Number(r);if(!isNaN(l))return l}throw new qr(`Could not convert ${JSON.stringify(r)} to number.`)}return"formatted"===this.type.kind?Ye.fromString(Qg(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ms.fromString(Qg(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map(r=>r.evaluate(t)):Qg(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ih([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ku(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}var rh=dE;const gF=["Unknown","Point","LineString","Polygon"];var jI=class{constructor(n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=n}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?gF[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-n[0])+this.featureDistanceData.bearing[1]*(s*t-n[1])}return 0}parseColor(n){let t=this._parseColorCache[n];return t||(t=this._parseColorCache[n]=Ne.parse(n)),t}getConfig(n){return this.options?this.options.get(n):null}};class cp{constructor(t,r,s,l){this.name=t,this.type=r,this._evaluate=s,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const s=t[0],l=cp.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,h=d.filter(([m])=>!Array.isArray(m)||m.length===t.length-1);let p=null;for(const[m,_]of h){p=new Uo(r.registry,r.path,null,r.scope,void 0,r.options);const y=[];let v=!1;for(let b=1;b<t.length;b++){const E=t[b],C=Array.isArray(m)?m[b-1]:m.type,S=p.parse(E,1+y.length,C);if(!S){v=!0;break}y.push(S)}if(!v)if(Array.isArray(m)&&m.length!==y.length)p.error(`Expected ${m.length} arguments, but found ${y.length} instead.`);else{for(let b=0;b<y.length;b++){const E=Array.isArray(m)?m[b]:m.type,C=y[b];p.concat(b+1).checkSubtype(E,C.type)}if(0===p.errors.length)return new cp(s,c,_,y)}}if(1===h.length)r.errors.push(...p.errors);else{const m=(h.length?h:d).map(([y])=>{return v=y,Array.isArray(v)?`(${v.map(gr).join(", ")})`:`(${gr(v.type)}...)`;var v}).join(" | "),_=[];for(let y=1;y<t.length;y++){const v=r.parse(t[y],1+_.length);if(!v)return null;_.push(gr(v.type))}r.error(`Expected arguments of type ${m}, but found (${_.join(", ")}) instead.`)}return null}static register(t,r){cp.definitions=r;for(const s in r)t[s]=cp}}var gs=cp;class oh{constructor(t,r,s){this.type=Gg,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(2!==t.length)return r.error("Expected one argument.");const s=t[1];if("object"!=typeof s||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,En);if(!l)return null;const c=r.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,En);if(!c)return null;let d=null;return s.locale&&(d=r.parse(s.locale,1,un),!d)?null:new oh(l,c,d)}evaluate(t){return new Jg(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var up={exports:{}};up.exports=function(){function n(s,l,c,d,h){for(;d>c;){if(d-c>600){var p=d-c+1,m=l-c+1,_=Math.log(p),y=.5*Math.exp(2*_/3),v=.5*Math.sqrt(_*y*(p-y)/p)*(m-p/2<0?-1:1);n(s,l,Math.max(c,Math.floor(l-m*y/p+v)),Math.min(d,Math.floor(l+(p-m)*y/p+v)),h)}var b=s[l],E=c,C=d;for(t(s,c,l),h(s[d],b)>0&&t(s,c,d);E<C;){for(t(s,E,C),E++,C--;h(s[E],b)<0;)E++;for(;h(s[C],b)>0;)C--}0===h(s[c],b)?t(s,c,C):t(s,++C,d),C<=l&&(c=C+1),l<=C&&(d=C-1)}}function t(s,l,c){var d=s[l];s[l]=s[c],s[c]=d}function r(s,l){return s<l?-1:s>l?1:0}return function(s,l,c,d,h){n(s,l,c||0,d||s.length-1,h||r)}}();var UI=hs(up.exports);function $I(n){let t=0;for(let r,s,l=0,c=n.length,d=c-1;l<c;d=l++)r=n[l],s=n[d],t+=(s.x-r.x)*(r.y+s.y);return t}function dp(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function sh(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function ah(n,t,r){const s=n[0]-t[0],l=n[1]-t[1],c=n[0]-r[0],d=n[1]-r[1];return s*d-c*l==0&&s*c<=0&&l*d<=0}function lh(n,t,r=!1){let s=!1;for(let h=0,p=t.length;h<p;h++){const m=t[h];for(let _=0,y=m.length,v=y-1;_<y;v=_++){const b=m[v],E=m[_];if(ah(n,b,E))return r;(c=b)[1]>(l=n)[1]!=(d=E)[1]>l[1]&&l[0]<(d[0]-c[0])*(l[1]-c[1])/(d[1]-c[1])+c[0]&&(s=!s)}}var l,c,d;return s}function hc(n,t,r,s){const l=s[0]-r[0],c=s[1]-r[1],d=(n[0]-r[0])*c-l*(n[1]-r[1]),h=(t[0]-r[0])*c-l*(t[1]-r[1]);return d>0&&h<0||d<0&&h>0}function e_(n,t,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(c=[t[0]-n[0],t[1]-n[1]])[1]-l[1]*c[0]!=0&&!(!hc(n,t,r,s)||!hc(r,s,n,t));var l,c}const bt=8192;function hE(n,t){const r=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*bt),Math.round(s*l*bt)]}function ee(n,t){for(let r=0;r<t.length;r++)if(lh(n,t[r]))return!0;return!1}function n_(n,t,r){for(const s of r)for(let l=0,c=s.length,d=c-1;l<c;d=l++)if(e_(n,t,s[d],s[l]))return!0;return!1}function i_(n,t){for(let r=0;r<n.length;++r)if(!lh(n[r],t))return!1;for(let r=0;r<n.length-1;++r)if(n_(n[r],n[r+1],t))return!1;return!0}function hp(n,t){for(let r=0;r<t.length;r++)if(i_(n,t[r]))return!0;return!1}function x0(n,t,r){const s=[];for(let l=0;l<n.length;l++){const c=[];for(let d=0;d<n[l].length;d++){const h=hE(n[l][d],r);dp(t,h),c.push(h)}s.push(c)}return s}function fE(n,t,r){const s=[];for(let l=0;l<n.length;l++){const c=x0(n[l],t,r);s.push(c)}return s}function pE(n,t,r,s){if(n[0]<r[0]||n[0]>r[2]){const l=.5*s;let c=n[0]-r[0]>l?-s:r[0]-n[0]>l?s:0;0===c&&(c=n[0]-r[2]>l?-s:r[2]-n[0]>l?s:0),n[0]+=c}dp(t,n)}function wl(n,t,r,s){const l=Math.pow(2,s.z)*bt,c=[s.x*bt,s.y*bt],d=[];if(!n)return d;for(const h of n)for(const p of h){const m=[p.x+c[0],p.y+c[1]];pE(m,t,r,l),d.push(m)}return d}function fp(n,t,r,s){const l=Math.pow(2,s.z)*bt,c=[s.x*bt,s.y*bt],d=[];if(!n)return d;for(const p of n){const m=[];for(const _ of p){const y=[_.x+c[0],_.y+c[1]];dp(t,y),m.push(y)}d.push(m)}if(t[2]-t[0]<=l/2){(h=t)[0]=h[1]=1/0,h[2]=h[3]=-1/0;for(const p of d)for(const m of p)pE(m,t,r,l)}var h;return d}class Vo{constructor(t,r){this.type=En,this.geojson=t,this.geometries=r}static parse(t,r){if(2!==t.length)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Gr(t[1])){const s=t[1];if("FeatureCollection"===s.type)for(let l=0;l<s.features.length;++l){const c=s.features[l].geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new Vo(s,s.features[l].geometry)}else if("Feature"===s.type){const l=s.geometry.type;if("Polygon"===l||"MultiPolygon"===l)return new Vo(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Vo(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(r,s){const l=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if("Polygon"===s.type){const h=x0(s.coordinates,c,d),p=wl(r.geometry(),l,c,d);if(!sh(l,c))return!1;for(const m of p)if(!lh(m,h))return!1}if("MultiPolygon"===s.type){const h=fE(s.coordinates,c,d),p=wl(r.geometry(),l,c,d);if(!sh(l,c))return!1;for(const m of p)if(!ee(m,h))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(r,s){const l=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if("Polygon"===s.type){const h=x0(s.coordinates,c,d),p=fp(r.geometry(),l,c,d);if(!sh(l,c))return!1;for(const m of p)if(!i_(m,h))return!1}if("MultiPolygon"===s.type){const h=fE(s.coordinates,c,d),p=fp(r.geometry(),l,c,d);if(!sh(l,c))return!1;for(const m of p)if(!hp(m,h))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var la=Vo,ri={exports:{}};ri.exports=function(){var n={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,r=t*(2-t),s=Math.PI/180,l=function(m,_){if(void 0===m)throw new Error("No latitude given.");if(_&&!n[_])throw new Error("Unknown unit "+_+". Use one of: "+Object.keys(n).join(", "));var y=6378.137*s*(_?n[_]:1),v=Math.cos(m*s),b=1/(1-r*(1-v*v)),E=Math.sqrt(b);this.kx=y*E*v,this.ky=y*E*b*(1-r)},c={units:{configurable:!0}};function d(m,_){return m[0]===_[0]&&m[1]===_[1]}function h(m,_,y){var v=p(_[0]-m[0]);return[m[0]+v*y,m[1]+(_[1]-m[1])*y]}function p(m){for(;m<-180;)m+=360;for(;m>180;)m-=360;return m}return l.fromTile=function(m,_,y){var v=Math.PI*(1-2*(m+.5)/Math.pow(2,_)),b=Math.atan(.5*(Math.exp(v)-Math.exp(-v)))/s;return new l(b,y)},c.units.get=function(){return n},l.prototype.distance=function(m,_){var y=p(m[0]-_[0])*this.kx,v=(m[1]-_[1])*this.ky;return Math.sqrt(y*y+v*v)},l.prototype.bearing=function(m,_){var y=p(_[0]-m[0])*this.kx;return Math.atan2(y,(_[1]-m[1])*this.ky)/s},l.prototype.destination=function(m,_,y){var v=y*s;return this.offset(m,Math.sin(v)*_,Math.cos(v)*_)},l.prototype.offset=function(m,_,y){return[m[0]+_/this.kx,m[1]+y/this.ky]},l.prototype.lineDistance=function(m){for(var _=0,y=0;y<m.length-1;y++)_+=this.distance(m[y],m[y+1]);return _},l.prototype.area=function(m){for(var _=0,y=0;y<m.length;y++)for(var v=m[y],b=0,E=v.length,C=E-1;b<E;C=b++)_+=p(v[b][0]-v[C][0])*(v[b][1]+v[C][1])*(y?-1:1);return Math.abs(_)/2*this.kx*this.ky},l.prototype.along=function(m,_){var y=0;if(_<=0)return m[0];for(var v=0;v<m.length-1;v++){var b=m[v],E=m[v+1],C=this.distance(b,E);if((y+=C)>_)return h(b,E,(_-(y-C))/C)}return m[m.length-1]},l.prototype.pointToSegmentDistance=function(m,_,y){var v=_[0],b=_[1],E=p(y[0]-v)*this.kx,C=(y[1]-b)*this.ky,S=0;return 0===E&&0===C||((S=(p(m[0]-v)*this.kx*E+(m[1]-b)*this.ky*C)/(E*E+C*C))>1?(v=y[0],b=y[1]):S>0&&(v+=E/this.kx*S,b+=C/this.ky*S)),E=p(m[0]-v)*this.kx,C=(m[1]-b)*this.ky,Math.sqrt(E*E+C*C)},l.prototype.pointOnLine=function(m,_){for(var y,v,b,E,C=1/0,S=0;S<m.length-1;S++){var M=m[S][0],D=m[S][1],R=p(m[S+1][0]-M)*this.kx,P=(m[S+1][1]-D)*this.ky,I=0;0===R&&0===P||((I=(p(_[0]-M)*this.kx*R+(_[1]-D)*this.ky*P)/(R*R+P*P))>1?(M=m[S+1][0],D=m[S+1][1]):I>0&&(M+=R/this.kx*I,D+=P/this.ky*I));var O=(R=p(_[0]-M)*this.kx)*R+(P=(_[1]-D)*this.ky)*P;O<C&&(C=O,y=M,v=D,b=S,E=I)}return{point:[y,v],index:b,t:Math.max(0,Math.min(1,E))}},l.prototype.lineSlice=function(m,_,y){var v=this.pointOnLine(y,m),b=this.pointOnLine(y,_);if(v.index>b.index||v.index===b.index&&v.t>b.t){var E=v;v=b,b=E}var C=[v.point],S=v.index+1,M=b.index;!d(y[S],C[0])&&S<=M&&C.push(y[S]);for(var D=S+1;D<=M;D++)C.push(y[D]);return d(y[M],b.point)||C.push(b.point),C},l.prototype.lineSliceAlong=function(m,_,y){for(var v=0,b=[],E=0;E<y.length-1;E++){var C=y[E],S=y[E+1],M=this.distance(C,S);if((v+=M)>m&&0===b.length&&b.push(h(C,S,(m-(v-M))/M)),v>=_)return b.push(h(C,S,(_-(v-M))/M)),b;v>m&&b.push(S)}return b},l.prototype.bufferPoint=function(m,_){var y=_/this.ky,v=_/this.kx;return[m[0]-v,m[1]-y,m[0]+v,m[1]+y]},l.prototype.bufferBBox=function(m,_){var y=_/this.ky,v=_/this.kx;return[m[0]-v,m[1]-y,m[2]+v,m[3]+y]},l.prototype.insideBBox=function(m,_){return p(m[0]-_[0])>=0&&p(m[0]-_[2])<=0&&m[1]>=_[1]&&m[1]<=_[3]},Object.defineProperties(l,c),l}();var ch=hs(ri.exports),r_={exports:{}};r_.exports=function(){var n=function(r,s){if(void 0===r&&(r=[]),void 0===s&&(s=t),this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function t(r,s){return r<s?-1:r>s?1:0}return n.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(0!==this.length){var r=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),r}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(r){for(var s=this.data,l=this.compare,c=s[r];r>0;){var d=r-1>>1,h=s[d];if(l(c,h)>=0)break;s[r]=h,r=d}s[r]=c},n.prototype._down=function(r){for(var s=this.data,l=this.compare,c=this.length>>1,d=s[r];r<c;){var h=1+(r<<1),p=s[h],m=h+1;if(m<this.length&&l(s[m],p)<0&&(h=m,p=s[m]),l(p,d)>=0)break;s[r]=p,r=h}s[r]=d},n}();var pp=hs(r_.exports),dt=8192;function El(n,t){return t.dist-n.dist}const Ju=100,o_=50;function b0(n){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==n[r])return!1;return!0}function uh(n){return n[1]-n[0]+1}function Cl(n,t){const r=n[1]>=n[0]&&n[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function s_(n,t){if(n[0]>n[1])return[null,null];const r=uh(n);if(t){if(2===r)return[n,null];const s=Math.floor(r/2);return[[n[0],n[0]+s],[n[0]+s,n[1]]]}{if(1===r)return[n,null];const s=Math.floor(r/2)-1;return[[n[0],n[0]+s],[n[0]+s+1,n[1]]]}}function Fa(n,t){const r=[1/0,1/0,-1/0,-1/0];if(!Cl(t,n.length))return r;for(let s=t[0];s<=t[1];++s)dp(r,n[s]);return r}function mp(n){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<n.length;++r)for(let s=0;s<n[r].length;++s)dp(t,n[r][s]);return t}function Qu(n,t,r){if(b0(n)||b0(t))return NaN;let s=0,l=0;return n[2]<t[0]&&(s=t[0]-n[2]),n[0]>t[2]&&(s=n[0]-t[2]),n[1]>t[3]&&(l=n[1]-t[3]),n[3]<t[1]&&(l=t[1]-n[3]),r.distance([0,0],[s,l])}function w0(n,t){const r=Math.pow(2,t.z);return[(l=(n.x/dt+t.x)/r,360*l-180),(s=(n.y/dt+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,l}function mE(n,t){const r=[];for(let s=0;s<n.length;++s)r.push(w0(n[s],t));return r}function gE(n,t,r){const s=r.pointOnLine(t,n).point;return r.distance(n,s)}function _E(n,t,r,s,l){const c=r.slice(s[0],s[1]+1);let d=1/0;for(let h=t[0];h<=t[1];++h)if(0===(d=Math.min(d,gE(n[h],c,l))))return 0;return d}function Bs(n,t,r,s,l){const c=Math.min(l.pointToSegmentDistance(n,r,s),l.pointToSegmentDistance(t,r,s)),d=Math.min(l.pointToSegmentDistance(r,n,t),l.pointToSegmentDistance(s,n,t));return Math.min(c,d)}function HI(n,t,r,s,l){if(!Cl(t,n.length)||!Cl(s,r.length))return NaN;let c=1/0;for(let d=t[0];d<t[1];++d)for(let h=s[0];h<s[1];++h){if(e_(n[d],n[d+1],r[h],r[h+1]))return 0;c=Math.min(c,Bs(n[d],n[d+1],r[h],r[h+1],l))}return c}function yE(n,t,r,s,l){if(!Cl(t,n.length)||!Cl(s,r.length))return NaN;let c=1/0;for(let d=t[0];d<=t[1];++d)for(let h=s[0];h<=s[1];++h)if(0===(c=Math.min(c,l.distance(n[d],r[h]))))return c;return c}function GI(n,t,r){if(lh(n,t,!0))return 0;let s=1/0;for(const l of t){const c=l.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[c-1]&&0===(s=Math.min(s,r.pointToSegmentDistance(n,l[c-1],l[0])))||0===(s=Math.min(s,gE(n,l,r))))return s}return s}function qI(n,t,r,s){if(!Cl(t,n.length))return NaN;for(let c=t[0];c<=t[1];++c)if(lh(n[c],r,!0))return 0;let l=1/0;for(let c=t[0];c<t[1];++c)for(const d of r)for(let h=0,p=d.length,m=p-1;h<p;m=h++){if(e_(n[c],n[c+1],d[m],d[h]))return 0;l=Math.min(l,Bs(n[c],n[c+1],d[m],d[h],s))}return l}function vE(n,t){for(const r of n)for(let s=0;s<=r.length-1;++s)if(lh(r[s],t,!0))return!0;return!1}function WI(n,t,r,s=1/0){const l=mp(n),c=mp(t);if(s!==1/0&&Qu(l,c,r)>=s)return s;if(sh(l,c)){if(vE(n,t))return 0}else if(vE(t,n))return 0;let d=s;for(const h of n)for(let p=0,m=h.length,_=m-1;p<m;_=p++)for(const y of t)for(let v=0,b=y.length,E=b-1;v<b;E=v++){if(e_(h[_],h[p],y[E],y[v]))return 0;d=Math.min(d,Bs(h[_],h[p],y[E],y[v],r))}return d}function gp(n,t,r,s,l,c,d){if(null===c||null===d)return;const h=Qu(Fa(s,c),Fa(l,d),r);h<t&&n.push({dist:h,range1:c,range2:d})}function ZI(n,t,r,s,l=1/0){let c=Math.min(s.distance(n[0],r[0][0]),l);if(0===c)return c;const d=new pp([{dist:0,range1:[0,n.length-1],range2:[0,0]}],El),h=t?o_:Ju,p=mp(r);for(;d.length;){const m=d.pop();if(m.dist>=c)continue;const _=m.range1;if(uh(_)<=h){if(!Cl(_,n.length))return NaN;if(t){const y=qI(n,_,r,s);if(0===(c=Math.min(c,y)))return c}else for(let y=_[0];y<=_[1];++y){const v=GI(n[y],r,s);if(0===(c=Math.min(c,v)))return c}}else{const y=s_(_,t);if(null!==y[0]){const v=Qu(Fa(n,y[0]),p,s);v<c&&d.push({dist:v,range1:y[0],range2:[0,0]})}if(null!==y[1]){const v=Qu(Fa(n,y[1]),p,s);v<c&&d.push({dist:v,range1:y[1],range2:[0,0]})}}}return c}function xE(n,t,r,s,l,c=1/0){let d=Math.min(c,l.distance(n[0],r[0]));if(0===d)return d;const h=new pp([{dist:0,range1:[0,n.length-1],range2:[0,r.length-1]}],El),p=t?o_:Ju,m=s?o_:Ju;for(;h.length;){const _=h.pop();if(_.dist>=d)continue;const y=_.range1,v=_.range2;if(uh(y)<=p&&uh(v)<=m){if(!Cl(y,n.length)||!Cl(v,r.length))return NaN;if(t&&s?d=Math.min(d,HI(n,y,r,v,l)):t||s?t&&!s?d=Math.min(d,_E(r,v,n,y,l)):!t&&s&&(d=Math.min(d,_E(n,y,r,v,l))):d=Math.min(d,yE(n,y,r,v,l)),0===d)return d}else{const b=s_(y,t),E=s_(v,s);gp(h,d,l,n,r,b[0],E[0]),gp(h,d,l,n,r,b[0],E[1]),gp(h,d,l,n,r,b[1],E[0]),gp(h,d,l,n,r,b[1],E[1])}}return d}function E0(n,t,r,s,l=1/0){let c=l;const d=Fa(n,[0,n.length-1]);for(const h of r)if(!(c!==1/0&&Qu(d,Fa(h,[0,h.length-1]),s)>=c)&&(c=Math.min(c,xE(n,t,h,!0,s,c)),0===c))return c;return c}function _s(n,t,r,s,l=1/0){let c=l;const d=Fa(n,[0,n.length-1]);for(const h of r){if(c!==1/0&&Qu(d,mp(h),s)>=c)continue;const p=ZI(n,t,h,s,c);if(isNaN(p))return p;if(0===(c=Math.min(c,p)))return c}return c}function C0(n){return"Point"===n||"MultiPoint"===n||"LineString"===n||"MultiLineString"===n||"Polygon"===n||"MultiPolygon"===n}class _p{constructor(t,r){this.type=Wt,this.geojson=t,this.geometries=r}static parse(t,r){if(2!==t.length)return r.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Gr(t[1])){const s=t[1];if("FeatureCollection"===s.type){for(let l=0;l<s.features.length;++l)if(C0(s.features[l].geometry.type))return new _p(s,s.features[l].geometry)}else if("Feature"===s.type){if(C0(s.geometry.type))return new _p(s,s.geometry)}else if(C0(s.type))return new _p(s,s)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const r=t.geometry(),s=t.canonicalID();if(null!=r&&null!=s){if("Point"===t.geometryType())return function(l,c,d){const h=[];for(const m of l)for(const _ of m)h.push(w0(_,c));const p=new ch(h[0][1],"meters");return"Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type?xE(h,!1,"Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,p):"MultiLineString"===d.type?E0(h,!1,d.coordinates,p):"Polygon"===d.type||"MultiPolygon"===d.type?_s(h,!1,"Polygon"===d.type?[d.coordinates]:d.coordinates,p):null}(r,s,this.geometries);if("LineString"===t.geometryType())return function(l,c,d){const h=[];for(const m of l){const _=[];for(const y of m)_.push(w0(y,c));h.push(_)}const p=new ch(h[0][0][1],"meters");if("Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type)return E0("Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,h,p);if("MultiLineString"===d.type){let m=1/0;for(let _=0;_<d.coordinates.length;_++){const y=E0(d.coordinates[_],!0,h,p,m);if(isNaN(y))return y;if(0===(m=Math.min(m,y)))return m}return m}if("Polygon"===d.type||"MultiPolygon"===d.type){let m=1/0;for(let _=0;_<h.length;_++){const y=_s(h[_],!0,"Polygon"===d.type?[d.coordinates]:d.coordinates,p,m);if(isNaN(y))return y;if(0===(m=Math.min(m,y)))return m}return m}return null}(r,s,this.geometries);if("Polygon"===t.geometryType())return function(l,c,d){const h=[];for(const m of function(_,y){const v=_.length;if(v<=1)return[_];const b=[];let E,C;for(let S=0;S<v;S++){const M=$I(_[S]);0!==M&&(_[S].area=Math.abs(M),void 0===C&&(C=M<0),C===M<0?(E&&b.push(E),E=[_[S]]):E.push(_[S]))}return E&&b.push(E),b}(l)){const _=[];for(let y=0;y<m.length;++y)_.push(mE(m[y],c));h.push(_)}const p=new ch(h[0][0][0][1],"meters");if("Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type)return _s("Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,h,p);if("MultiLineString"===d.type){let m=1/0;for(let _=0;_<d.coordinates.length;_++){const y=_s(d.coordinates[_],!0,h,p,m);if(isNaN(y))return y;if(0===(m=Math.min(m,y)))return m}return m}return"Polygon"===d.type||"MultiPolygon"===d.type?function(m,_,y){let v=1/0;for(const b of m)for(const E of _){const C=WI(b,E,y,v);if(isNaN(C))return C;if(0===(v=Math.min(v,C)))return v}return v}("Polygon"===d.type?[d.coordinates]:d.coordinates,h,p):null}(r,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var M0=_p;function bi(n){if(n instanceof gs&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof la||n instanceof M0)return!1;let t=!0;return n.eachChild(r=>{t&&!bi(r)&&(t=!1)}),t}function a_(n){if(n instanceof gs&&"feature-state"===n.name)return!1;let t=!0;return n.eachChild(r=>{t&&!a_(r)&&(t=!1)}),t}function l_(n){if(n instanceof gs&&"config"===n.name)return!1;let t=!0;return n.eachChild(r=>{t&&!l_(r)&&(t=!1)}),t}function Ee(n,t){if(n instanceof gs&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(s=>{r&&!Ee(s,t)&&(r=!1)}),r}class jo{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(2!==t.length||"string"!=typeof t[1])return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new jo(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Kn=jo;class Wr{constructor(t,r=[],s,l=new pF,c=[],d){this.registry=t,this.path=r,this.key=r.map(h=>`[${h}]`).join(""),this.scope=l,this.errors=c,this.expectedType=s,this.options=d}parse(t,r,s,l,c={}){return r||s?this.concat(r,s,l)._parse(t,c):this._parse(t,c)}_parse(t,r){function s(l,c,d){return"assert"===d?new ka(c,[l]):"coerce"===d?new rh(c,[l]):l}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l="string"==typeof t[0]?this.registry[t[0]]:void 0;if(l){let c=l.parse(t,this);if(!c)return null;if(this.expectedType){const d=this.expectedType,h=c.type;if("string"!==d.kind&&"number"!==d.kind&&"boolean"!==d.kind&&"object"!==d.kind&&"array"!==d.kind||"value"!==h.kind)if("color"!==d.kind&&"formatted"!==d.kind&&"resolvedImage"!==d.kind||"value"!==h.kind&&"string"!==h.kind){if(this.checkSubtype(d,h))return null}else c=s(c,d,r.typeAnnotation||"coerce");else c=s(c,d,r.typeAnnotation||"assert")}if(!(c instanceof t_)&&"resolvedImage"!==c.type.kind&&ru(c)){const d=new jI(this.options);try{c=new t_(c.type,c.evaluate(d))}catch(h){return this.error(h.message),null}}return c}return rh.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const l="number"==typeof t?this.path.concat(t):this.path,c=s?this.scope.concat(s):this.scope;return new Wr(this.registry,l,r||null,c,this.errors,this.options)}error(t,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new dc(s,t))}checkSubtype(t,r){const s=Wg(t,r);return s&&this.error(s),s}}var Uo=Wr;function ru(n){if(n instanceof Kn)return ru(n.boundExpression);if(n instanceof gs&&"error"===n.name||n instanceof gs&&"config"===n.name||n instanceof oh||n instanceof la||n instanceof M0)return!1;const t=n instanceof rh||n instanceof ka;let r=!0;return n.eachChild(s=>{r=t?r&&ru(s):r&&s instanceof t_}),!!r&&bi(n)&&Ee(n,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function $o(n,t){const r=n.length-1;let s,l,c=0,d=r,h=0;for(;c<=d;)if(h=Math.floor((c+d)/2),s=n[h],l=n[h+1],s<=t){if(h===r||t<l)return h;c=h+1}else{if(!(s>t))throw new qr("Input is not a number.");d=h-1}return 0}class c_{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,c]of s)this.labels.push(l),this.outputs.push(c)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,Wt);if(!s)return null;const l=[];let c=null;r.expectedType&&"value"!==r.expectedType.kind&&(c=r.expectedType);for(let d=1;d<t.length;d+=2){const h=1===d?-1/0:t[d],p=t[d+1],m=d,_=d+1;if("number"!=typeof h)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',m);if(l.length&&l[l.length-1][0]>=h)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',m);const y=r.parse(p,_,c);if(!y)return null;c=c||y.type,l.push([h,y])}return new c_(c,s,l)}evaluate(t){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const c=r.length;return l>=r[c-1]?s[c-1].evaluate(t):s[$o(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}var u_=c_;function _e(n,t,r){return n*(1-r)+t*r}function bE(n,t,r){return n.map((s,l)=>_e(s,t[l],r))}var d_=Object.freeze({__proto__:null,array:bE,color:function(n,t,r){return new Ne(_e(n.r,t.r,r),_e(n.g,t.g,r),_e(n.b,t.b,r),_e(n.a,t.a,r))},number:_e});const dn=4/29,Ai=6/29,ca=3*Ai*Ai,yp=Ai*Ai*Ai,Ho=Math.PI/180,dh=180/Math.PI;function yr(n){return n>yp?Math.pow(n,1/3):n/ca+dn}function Ml(n){return n>Ai?n*n*n:ca*(n-dn)}function ou(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function nn(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function hh(n){const t=nn(n.r),r=nn(n.g),s=nn(n.b),l=yr((.4124564*t+.3575761*r+.1804375*s)/.95047),c=yr((.2126729*t+.7151522*r+.072175*s)/1);return{l:116*c-16,a:500*(l-c),b:200*(c-yr((.0193339*t+.119192*r+.9503041*s)/1.08883)),alpha:n.a}}function S0(n){let t=(n.l+16)/116,r=isNaN(n.a)?t:t+n.a/500,s=isNaN(n.b)?t:t-n.b/200;return t=1*Ml(t),r=.95047*Ml(r),s=1.08883*Ml(s),new Ne(ou(3.2404542*r-1.5371385*t-.4985314*s),ou(-.969266*r+1.8760108*t+.041556*s),ou(.0556434*r-.2040259*t+1.0572252*s),n.alpha)}function fh(n,t,r){const s=t-n;return n+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const tr={forward:hh,reverse:S0,interpolate:function(n,t,r){return{l:_e(n.l,t.l,r),a:_e(n.a,t.a,r),b:_e(n.b,t.b,r),alpha:_e(n.alpha,t.alpha,r)}}},fc={forward:function(n){const{l:t,a:r,b:s}=hh(n),l=Math.atan2(s,r)*dh;return{h:l<0?l+360:l,c:Math.sqrt(r*r+s*s),l:t,alpha:n.a}},reverse:function(n){const t=n.h*Ho,r=n.c;return S0({l:n.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:n.alpha})},interpolate:function(n,t,r){return{h:fh(n.h,t.h,r),c:_e(n.c,t.c,r),l:_e(n.l,t.l,r),alpha:_e(n.alpha,t.alpha,r)}}};var td=Object.freeze({__proto__:null,hcl:fc,lab:tr});class Vs{constructor(t,r,s,l,c){this.type=t,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[d,h]of c)this.labels.push(d),this.outputs.push(h)}static interpolationFactor(t,r,s,l){let c=0;if("exponential"===t.name)c=ed(r,t.base,s,l);else if("linear"===t.name)c=ed(r,1,s,l);else if("cubic-bezier"===t.name){const d=t.controlPoints;c=new zg(d[0],d[1],d[2],d[3]).solve(ed(r,1,s,l))}return c}static parse(t,r){let[s,l,c,...d]=t;if(!Array.isArray(l)||0===l.length)return r.error("Expected an interpolation type expression.",1);if("linear"===l[0])l={name:"linear"};else if("exponential"===l[0]){const m=l[1];if("number"!=typeof m)return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:m}}else{if("cubic-bezier"!==l[0])return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const m=l.slice(1);if(4!==m.length||m.some(_=>"number"!=typeof _||_<0||_>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:m}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(c=r.parse(c,2,Wt),!c)return null;const h=[];let p=null;"interpolate-hcl"===s||"interpolate-lab"===s?p=Oa:r.expectedType&&"value"!==r.expectedType.kind&&(p=r.expectedType);for(let m=0;m<d.length;m+=2){const _=d[m],y=d[m+1],v=m+3,b=m+4;if("number"!=typeof _)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(h.length&&h[h.length-1][0]>=_)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',v);const E=r.parse(y,b,p);if(!E)return null;p=p||E.type,h.push([_,E])}return"number"===p.kind||"color"===p.kind||"array"===p.kind&&"number"===p.itemType.kind&&"number"==typeof p.N?new Vs(p,s,l,c,h):r.error(`Type ${gr(p)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const c=r.length;if(l>=r[c-1])return s[c-1].evaluate(t);const d=$o(r,l),h=Vs.interpolationFactor(this.interpolation,l,r[d],r[d+1]),p=s[d].evaluate(t),m=s[d+1].evaluate(t);return"interpolate"===this.operator?d_[this.type.kind.toLowerCase()](p,m,h):"interpolate-hcl"===this.operator?fc.reverse(fc.interpolate(fc.forward(p),fc.forward(m),h)):tr.reverse(tr.interpolate(tr.forward(p),tr.forward(m),h))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,t,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function ed(n,t,r,s){const l=s-r,c=n-r;return 0===l?0:1===t?c/l:(Math.pow(t,c)-1)/(Math.pow(t,l)-1)}var La=Vs;class Sl{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&"value"!==l.kind&&(s=l);const c=[];for(const h of t.slice(1)){const p=r.parse(h,1+c.length,s,void 0,{typeAnnotation:"omit"});if(!p)return null;s=s||p.type,c.push(p)}const d=l&&c.some(h=>Wg(l,h.type));return new Sl(d?fn:s,c)}evaluate(t){let r,s=null,l=0;for(const c of this.args){if(l++,s=c.evaluate(t),s&&s instanceof ms&&!s.available&&(r||(r=s),s=null,l===this.args.length))return r;if(null!==s)break}return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var Tl=Sl;class nd{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let c=1;c<t.length-1;c+=2){const d=t[c];if("string"!=typeof d)return r.error(`Expected string, but found ${typeof d} instead.`,c);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);const h=r.parse(t[c+1],c+1);if(!h)return null;s.push([d,h])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return l?new nd(s,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,s]of this.bindings)t.push(r,s.serialize());return t.push(this.result.serialize()),t}}var ph=nd;class On{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(3!==t.length)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Wt),l=r.parse(t[2],2,Se(r.expectedType||fn));return s&&l?new On(l.type.itemType,s,l):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new qr(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new qr(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new qr(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var _F=On;class vp{constructor(t,r){this.type=En,this.needle=t,this.haystack=r}static parse(t,r){if(3!==t.length)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,fn),l=r.parse(t[2],2,fn);return s&&l?ie(s.type,[En,un,Wt,aa,fn])?new vp(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${gr(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(null==s)return!1;if(!Zg(r,["boolean","string","number","null"]))throw new qr(`Expected first argument to be of type boolean, string, number or null, but found ${gr(Mr(r))} instead.`);if(!Zg(s,["string","array"]))throw new qr(`Expected second argument to be of type array or string, but found ${gr(Mr(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var wE=vp;class js{constructor(t,r,s){this.type=Wt,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,fn),l=r.parse(t[2],2,fn);if(!s||!l)return null;if(!ie(s.type,[En,un,Wt,aa,fn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${gr(s.type)} instead`);if(4===t.length){const c=r.parse(t[3],3,Wt);return c?new js(s,l,c):null}return new js(s,l)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Zg(r,["boolean","string","number","null"]))throw new qr(`Expected first argument to be of type boolean, string, number or null, but found ${gr(Mr(r))} instead.`);if(!Zg(s,["string","array"]))throw new qr(`Expected second argument to be of type array or string, but found ${gr(Mr(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(t);return s.indexOf(r,l)}return s.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var h_=js;class su{constructor(t,r,s,l,c,d){this.inputType=t,this.type=r,this.input=s,this.cases=l,this.outputs=c,this.otherwise=d}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&"value"!==r.expectedType.kind&&(l=r.expectedType);const c={},d=[];for(let m=2;m<t.length-1;m+=2){let _=t[m];const y=t[m+1];Array.isArray(_)||(_=[_]);const v=r.concat(m);if(0===_.length)return v.error("Expected at least one branch label.");for(const E of _){if("number"!=typeof E&&"string"!=typeof E)return v.error("Branch labels must be numbers or strings.");if("number"==typeof E&&Math.abs(E)>Number.MAX_SAFE_INTEGER)return v.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof E&&Math.floor(E)!==E)return v.error("Numeric branch labels must be integer values.");if(s){if(v.checkSubtype(s,Mr(E)))return null}else s=Mr(E);if(void 0!==c[String(E)])return v.error("Branch labels must be unique.");c[String(E)]=d.length}const b=r.parse(y,m,l);if(!b)return null;l=l||b.type,d.push(b)}const h=r.parse(t[1],1,fn);if(!h)return null;const p=r.parse(t[t.length-1],t.length-1,l);return p?"value"!==h.type.kind&&r.concat(1).checkSubtype(s,h.type)?null:new su(s,l,h,c,d,p):null}evaluate(t){const r=this.input.evaluate(t);return(Mr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],l={};for(const d of r){const h=l[this.cases[d]];void 0===h?(l[this.cases[d]]=s.length,s.push([this.cases[d],[d]])):s[h][1].push(d)}const c=d=>"number"===this.inputType.kind?Number(d):d;for(const[d,h]of s)t.push(1===h.length?c(h[0]):h.map(c)),t.push(this.outputs[d].serialize());return t.push(this.otherwise.serialize()),t}}var xp=su;class Zr{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&"value"!==r.expectedType.kind&&(s=r.expectedType);const l=[];for(let d=1;d<t.length-1;d+=2){const h=r.parse(t[d],d,En);if(!h)return null;const p=r.parse(t[d+1],d+1,s);if(!p)return null;l.push([h,p]),s=s||p.type}const c=r.parse(t[t.length-1],t.length-1,s);return c?new Zr(s,l,c):null}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var yF=Zr;class Do{constructor(t,r,s,l){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,fn),l=r.parse(t[2],2,Wt);if(!s||!l)return null;if(!ie(s.type,[Se(fn),un,fn]))return r.error(`Expected first argument to be of type array or string, but found ${gr(s.type)} instead`);if(4===t.length){const c=r.parse(t[3],3,Wt);return c?new Do(s.type,s,l,c):null}return new Do(s.type,s,l)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Zg(r,["string","array"]))throw new qr(`Expected first argument to be of type array or string, but found ${gr(Mr(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(t);return r.slice(s,l)}return r.slice(s)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var is=Do;function f_(n,t){return"=="===n||"!="===n?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function au(n,t,r,s){return 0===s.compare(t,r)}function pc(n,t,r){const s="=="!==n&&"!="!==n;return class Q4{constructor(c,d,h){this.type=En,this.lhs=c,this.rhs=d,this.collator=h,this.hasUntypedArgument="value"===c.type.kind||"value"===d.type.kind}static parse(c,d){if(3!==c.length&&4!==c.length)return d.error("Expected two or three arguments.");const h=c[0];let p=d.parse(c[1],1,fn);if(!p)return null;if(!f_(h,p.type))return d.concat(1).error(`"${h}" comparisons are not supported for type '${gr(p.type)}'.`);let m=d.parse(c[2],2,fn);if(!m)return null;if(!f_(h,m.type))return d.concat(2).error(`"${h}" comparisons are not supported for type '${gr(m.type)}'.`);if(p.type.kind!==m.type.kind&&"value"!==p.type.kind&&"value"!==m.type.kind)return d.error(`Cannot compare types '${gr(p.type)}' and '${gr(m.type)}'.`);s&&("value"===p.type.kind&&"value"!==m.type.kind?p=new ka(m.type,[p]):"value"!==p.type.kind&&"value"===m.type.kind&&(m=new ka(p.type,[m])));let _=null;if(4===c.length){if("string"!==p.type.kind&&"string"!==m.type.kind&&"value"!==p.type.kind&&"value"!==m.type.kind)return d.error("Cannot use collator to compare non-string types.");if(_=d.parse(c[3],3,Gg),!_)return null}return new Q4(p,m,_)}evaluate(c){const d=this.lhs.evaluate(c),h=this.rhs.evaluate(c);if(s&&this.hasUntypedArgument){const p=Mr(d),m=Mr(h);if(p.kind!==m.kind||"string"!==p.kind&&"number"!==p.kind)throw new qr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${p.kind}, ${m.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const p=Mr(d),m=Mr(h);if("string"!==p.kind||"string"!==m.kind)return t(c,d,h)}return this.collator?r(c,d,h,this.collator.evaluate(c)):t(c,d,h)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[n];return this.eachChild(d=>{c.push(d.serialize())}),c}}}const Na=pc("==",function(n,t,r){return t===r},au),T0=pc("!=",function(n,t,r){return t!==r},function(n,t,r,s){return!au(0,t,r,s)}),XI=pc("<",function(n,t,r){return t<r},function(n,t,r,s){return s.compare(t,r)<0}),YI=pc(">",function(n,t,r){return t>r},function(n,t,r,s){return s.compare(t,r)>0}),vF=pc("<=",function(n,t,r){return t<=r},function(n,t,r,s){return s.compare(t,r)<=0}),KI=pc(">=",function(n,t,r){return t>=r},function(n,t,r,s){return s.compare(t,r)>=0});class D0{constructor(t,r,s,l,c,d){this.type=un,this.number=t,this.locale=r,this.currency=s,this.unit=l,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(t,r){if(3!==t.length)return r.error("Expected two arguments.");const s=r.parse(t[1],1,Wt);if(!s)return null;const l=t[2];if("object"!=typeof l||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let c=null;if(l.locale&&(c=r.parse(l.locale,1,un),!c))return null;let d=null;if(l.currency&&(d=r.parse(l.currency,1,un),!d))return null;let h=null;if(l.unit&&(h=r.parse(l.unit,1,un),!h))return null;let p=null;if(l["min-fraction-digits"]&&(p=r.parse(l["min-fraction-digits"],1,Wt),!p))return null;let m=null;return l["max-fraction-digits"]&&(m=r.parse(l["max-fraction-digits"],1,Wt),!m)?null:new D0(s,c,d,h,p,m)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class EE{constructor(t){this.type=Wt,this.input=t}static parse(t,r){if(2!==t.length)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?r.error(`Expected argument of type string or array, but found ${gr(s.type)} instead.`):new EE(s):null}evaluate(t){const r=this.input.evaluate(t);if("string"==typeof r||Array.isArray(r))return r.length;throw new qr(`Expected value to be of type string or array, but found ${gr(Mr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}function CE(n){return function(){n=1831565813+(n|=0)|0;let t=Math.imul(n^n>>>15,1|n);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const JI={"==":Na,"!=":T0,">":YI,"<":XI,">=":KI,"<=":vF,array:ka,at:_F,boolean:ka,case:yF,coalesce:Tl,collator:oh,format:ih,image:Ku,in:wE,"index-of":h_,interpolate:La,"interpolate-hcl":La,"interpolate-lab":La,length:EE,let:ph,literal:t_,match:xp,number:ka,"number-format":D0,object:ka,slice:is,step:u_,string:ka,"to-boolean":rh,"to-color":rh,"to-number":rh,"to-string":rh,var:Kn,within:la,distance:M0};function QI(n,[t,r,s,l]){t=t.evaluate(n),r=r.evaluate(n),s=s.evaluate(n);const c=l?l.evaluate(n):1,d=y0(t,r,s,c);if(d)throw new qr(d);return new Ne(t/255*c,r/255*c,s/255*c,c)}function tA(n,[t,r,s,l]){t=t.evaluate(n),r=r.evaluate(n),s=s.evaluate(n);const c=l?l.evaluate(n):1,d=(_=r,y=s,v=c,"number"==typeof(m=t)&&m>=0&&m<=360?"number"==typeof _&&_>=0&&_<=100&&"number"==typeof y&&y>=0&&y<=100?void 0===v||"number"==typeof v&&v>=0&&v<=1?null:`Invalid hsla value [${[m,_,y,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof v?[m,_,y,v]:[m,_,y]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof v?[m,_,y,v]:[m,_,y]).join(", ")}]: 'h' must be between 0 and 360.`);var m,_,y,v;if(d)throw new qr(d);const h=`hsla(${t}, ${r}%, ${s}%, ${c})`,p=Ne.parse(h);if(!p)throw new qr(`Failed to parse HSLA color: ${h}`);return p}function eA(n,t){return n in t}function ME(n,t){const r=t[n];return void 0===r?null:r}function nA(n,t,r){r.length&&(t+=`\x1f${r}`);const s=n.getConfig(t);return s?s.evaluate(n):null}function mh(n){return{type:n}}gs.register(JI,{error:[{kind:"error"},[un],(n,[t])=>{throw new qr(t.evaluate(n))}],typeof:[un,[fn],(n,[t])=>gr(Mr(t.evaluate(n)))],"to-rgba":[Se(Wt,4),[Oa],(n,[t])=>t.evaluate(n).toArray()],rgb:[Oa,[Wt,Wt,Wt],QI],rgba:[Oa,[Wt,Wt,Wt,Wt],QI],hsl:[Oa,[Wt,Wt,Wt],tA],hsla:[Oa,[Wt,Wt,Wt,Wt],tA],has:{type:En,overloads:[[[un],(n,[t])=>eA(t.evaluate(n),n.properties())],[[un,eh],(n,[t,r])=>eA(t.evaluate(n),r.evaluate(n))]]},get:{type:fn,overloads:[[[un],(n,[t])=>ME(t.evaluate(n),n.properties())],[[un,eh],(n,[t,r])=>ME(t.evaluate(n),r.evaluate(n))]]},config:{type:fn,overloads:[[[un],(n,[t])=>nA(n,t.evaluate(n),"")],[[un,un],(n,[t,r])=>nA(n,t.evaluate(n),r.evaluate(n))]]},"feature-state":[fn,[un],(n,[t])=>ME(t.evaluate(n),n.featureState||{})],properties:[eh,[],n=>n.properties()],"geometry-type":[un,[],n=>n.geometryType()],id:[fn,[],n=>n.id()],zoom:[Wt,[],n=>n.globals.zoom],pitch:[Wt,[],n=>n.globals.pitch||0],"distance-from-center":[Wt,[],n=>n.distanceFromCenter()],"measure-light":[Wt,[un],(n,[t])=>n.measureLight(t.evaluate(n))],"heatmap-density":[Wt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Wt,[],n=>n.globals.lineProgress||0],"raster-value":[Wt,[],n=>n.globals.rasterValue||0],"sky-radial-progress":[Wt,[],n=>n.globals.skyRadialProgress||0],accumulated:[fn,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Wt,mh(Wt),(n,t)=>{let r=0;for(const s of t)r+=s.evaluate(n);return r}],"*":[Wt,mh(Wt),(n,t)=>{let r=1;for(const s of t)r*=s.evaluate(n);return r}],"-":{type:Wt,overloads:[[[Wt,Wt],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Wt],(n,[t])=>-t.evaluate(n)]]},"/":[Wt,[Wt,Wt],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Wt,[Wt,Wt],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Wt,[Wt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))],log2:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Wt,[Wt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Wt,[Wt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Wt,[Wt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Wt,[Wt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Wt,[Wt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Wt,[Wt],(n,[t])=>Math.atan(t.evaluate(n))],min:[Wt,mh(Wt),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[Wt,mh(Wt),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[Wt,[Wt],(n,[t])=>Math.abs(t.evaluate(n))],round:[Wt,[Wt],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Wt,[Wt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Wt,[Wt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[En,[un,fn],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[En,[fn],(n,[t])=>n.id()===t.value],"filter-type-==":[En,[un],(n,[t])=>n.geometryType()===t.value],"filter-<":[En,[un,fn],(n,[t,r])=>{const s=n.properties()[t.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[En,[fn],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[En,[un,fn],(n,[t,r])=>{const s=n.properties()[t.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[En,[fn],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[En,[un,fn],(n,[t,r])=>{const s=n.properties()[t.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[En,[fn],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[En,[un,fn],(n,[t,r])=>{const s=n.properties()[t.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[En,[fn],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[En,[fn],(n,[t])=>t.value in n.properties()],"filter-has-id":[En,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[En,[Se(un)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[En,[Se(fn)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[En,[un,Se(fn)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[En,[un,Se(fn)],(n,[t,r])=>function(s,l,c,d){for(;c<=d;){const h=c+d>>1;if(l[h]===s)return!0;l[h]>s?d=h-1:c=h+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:En,overloads:[[[En,En],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[mh(En),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:En,overloads:[[[En,En],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[mh(En),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[En,[En],(n,[t])=>!t.evaluate(n)],"is-supported-script":[En,[un],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[un,[un],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[un,[un],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[un,mh(fn),(n,t)=>t.map(r=>Qg(r.evaluate(n))).join("")],"resolved-locale":[un,[Gg],(n,[t])=>t.evaluate(n).resolvedLocale()],random:[Wt,[Wt,Wt,fn],(n,t)=>{const[r,s,l]=t.map(d=>d.evaluate(n));if(r>s||r===s)return r;let c;if("string"==typeof l)c=function(d){let h=0;if(0===d.length)return h;for(let p=0;p<d.length;p++)h=(h<<5)-h+d.charCodeAt(p),h&=h;return h}(l);else{if("number"!=typeof l)throw new qr(`Invalid seed input: ${l}`);c=l}return r+CE(c)()*(s-r)}]});var p_=JI;function iA(n){return{result:"success",value:n}}function gh(n){return{result:"error",value:n}}function I0(n,t){return!!n&&!!n.parameters&&n.parameters.indexOf(t)>-1}function lu(n){return"data-driven"===n["property-type"]}function rA(n){return I0(n.expression,"measure-light")}function SE(n){return I0(n.expression,"zoom")}function TE(n){return!!n.expression&&n.expression.interpolated}function Dl(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function cu(n){return n}function oA(n,t){const r="color"===t.type,s=n.stops&&"object"==typeof n.stops[0][0],l=s||!(s||void 0!==n.property),c=n.type||(TE(t)?"exponential":"interval");if(r&&((n=iu({},n)).stops&&(n.stops=n.stops.map(m=>[m[0],Ne.parse(m[1])])),n.default=Ne.parse(n.default?n.default:t.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!td[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let d,h,p;if("exponential"===c)d=Us;else if("interval"===c)d=g_;else if("categorical"===c){d=Io,h=Object.create(null);for(const m of n.stops)h[m[0]]=m[1];p=typeof n.stops[0][0]}else{if("identity"!==c)throw new Error(`Unknown function type "${c}"`);d=DE}if(s){const m={},_=[];for(let b=0;b<n.stops.length;b++){const E=n.stops[b],C=E[0].zoom;void 0===m[C]&&(m[C]={zoom:C,type:n.type,property:n.property,default:n.default,stops:[]},_.push(C)),m[C].stops.push([E[0].value,E[1]])}const y=[];for(const b of _)y.push([m[b].zoom,oA(m[b],t)]);const v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:La.interpolationFactor.bind(void 0,v),zoomStops:y.map(b=>b[0]),evaluate:({zoom:b},E)=>Us({stops:y,base:n.base},t,b).evaluate(b,E)}}if(l){const m="exponential"===c?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:m,interpolationFactor:La.interpolationFactor.bind(void 0,m),zoomStops:n.stops.map(_=>_[0]),evaluate:({zoom:_})=>d(n,t,_,h,p)}}return{kind:"source",evaluate(m,_){const y=_&&_.properties?_.properties[n.property]:void 0;return void 0===y?m_(n.default,t.default):d(n,t,y,h,p)}}}function m_(n,t,r){return void 0!==n?n:void 0!==t?t:void 0!==r?r:void 0}function Io(n,t,r,s,l){return m_(typeof r===l?s[r]:void 0,n.default,t.default)}function g_(n,t,r){if("number"!==Pn(r))return m_(n.default,t.default);const s=n.stops.length;if(1===s||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[s-1][0])return n.stops[s-1][1];const l=$o(n.stops.map(c=>c[0]),r);return n.stops[l][1]}function Us(n,t,r){const s=void 0!==n.base?n.base:1;if("number"!==Pn(r))return m_(n.default,t.default);const l=n.stops.length;if(1===l||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[l-1][0])return n.stops[l-1][1];const c=$o(n.stops.map(_=>_[0]),r),d=function(_,y,v,b){const E=b-v,C=_-v;return 0===E?0:1===y?C/E:(Math.pow(y,C)-1)/(Math.pow(y,E)-1)}(r,s,n.stops[c][0],n.stops[c+1][0]),h=n.stops[c][1],p=n.stops[c+1][1];let m=d_[t.type]||cu;if(n.colorSpace&&"rgb"!==n.colorSpace){const _=td[n.colorSpace];m=(y,v)=>_.reverse(_.interpolate(_.forward(y),_.forward(v),d))}return"function"==typeof h.evaluate?{evaluate(..._){const y=h.evaluate.apply(void 0,_),v=p.evaluate.apply(void 0,_);if(void 0!==y&&void 0!==v)return m(y,v,d)}}:m(h,p,d)}function DE(n,t,r){return"color"===t.type?r=Ne.parse(r):"formatted"===t.type?r=Ye.fromString(r.toString()):"resolvedImage"===t.type?r=ms.fromString(r.toString()):Pn(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),m_(r,n.default,t.default)}class __{constructor(t,r,s){var l;this.expression=t,this._warningHistory={},this._evaluator=new jI(s),this._defaultValue=r?"color"===(l=r).type&&(Dl(l.default)||Array.isArray(l.default))?new Ne(0,0,0,0):"color"===l.type?Ne.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=r&&"enum"===r.type?r.values:null}evaluateWithoutErrorHandling(t,r,s,l,c,d,h,p){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=h||null,this._evaluator.featureDistanceData=p||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,l,c,d,h,p){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=h||null,this._evaluator.featureDistanceData=p||null;try{const m=this.expression.evaluate(this._evaluator);if(null==m||"number"==typeof m&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new qr(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function bp(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in p_}function mc(n,t,r){const s=new Uo(p_,[],t?function(c){const d={color:Oa,string:un,number:Wt,enum:un,boolean:En,formatted:qg,resolvedImage:Bo};return"array"===c.type?Se(d[c.value]||fn,c.length):d[c.type]}(t):void 0,void 0,void 0,r),l=s.parse(n,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return l?iA(new __(l,t,r)):gh(s.errors)}class wp{constructor(t,r,s){this.kind=t,this._styleExpression=r,this.isLightConstant=s,this.isStateDependent="constant"!==t&&!a_(r.expression),this.isConfigDependent=!l_(r.expression)}evaluateWithoutErrorHandling(t,r,s,l,c,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,c,d)}evaluate(t,r,s,l,c,d){return this._styleExpression.evaluate(t,r,s,l,c,d)}}class gc{constructor(t,r,s,l,c){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent="camera"!==t&&!a_(r.expression),this.isLightConstant=c,this.isConfigDependent=!l_(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,s,l,c,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,c,d)}evaluate(t,r,s,l,c,d){return this._styleExpression.evaluate(t,r,s,l,c,d)}interpolationFactor(t,r,s){return this.interpolationType?La.interpolationFactor(this.interpolationType,t,r,s):0}}function Ep(n,t,r){if("error"===(n=mc(n,t,r)).result)return n;const s=n.value.expression,l=bi(s);if(!l&&!lu(t))return gh([new dc("","data expressions not supported")]);const c=Ee(s,["zoom","pitch","distance-from-center"]);if(!c&&!SE(t))return gh([new dc("","zoom expressions not supported")]);const d=Ee(s,["measure-light"]);if(!d&&!rA(t))return gh([new dc("","measure-light expression not supported")]);const h=t.expression&&t.expression.relaxZoomRestriction,p=Cp(s);return p||c||h?p instanceof dc?gh([p]):p instanceof La&&!TE(t)?gh([new dc("",'"interpolate" expressions cannot be used with this property')]):iA(p?new gc(l?"camera":"composite",n.value,p.labels,p instanceof La?p.interpolation:void 0,d):new wp(l?"constant":"source",n.value,d)):gh([new dc("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class _h{constructor(t,r){this._parameters=t,this._specification=r,iu(this,oA(this._parameters,this._specification))}static deserialize(t){return new _h(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Cp(n){let t=null;if(n instanceof ph)t=Cp(n.result);else if(n instanceof Tl){for(const r of n.args)if(t=Cp(r),t)break}else(n instanceof u_||n instanceof La)&&n.input instanceof gs&&"zoom"===n.input.name&&(t=n);return t instanceof dc||n.eachChild(r=>{const s=Cp(r);s instanceof dc?t=s:t&&s&&t!==s&&(t=new dc("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function $s(n){const t=n.key,r=n.value,s=n.valueSpec||{},l=n.objectElementValidators||{},c=n.style,d=n.styleSpec;let h=[];const p=Pn(r);if("object"!==p)return[new It(t,r,`object expected, ${p} found`)];for(const m in r){const _=m.split(".")[0];let y;l[_]?y=l[_]:s[_]?y=Xr:l["*"]?y=l["*"]:s["*"]&&(y=Xr),y?h=h.concat(y({key:(t&&`${t}.`)+m,value:r[m],valueSpec:s[_]||s["*"],style:c,styleSpec:d,object:r,objectKey:m},r)):h.push(new Yu(t,r[m],`unknown property "${m}"`))}for(const m in s)l[m]||s[m].required&&void 0===s[m].default&&void 0===r[m]&&h.push(new It(t,r,`missing required property "${m}"`));return h}function A0(n){const t=n.value,r=n.valueSpec,s=n.style,l=n.styleSpec,c=n.key,d=n.arrayElementValidator||Xr;if("array"!==Pn(t))return[new It(c,t,`array expected, ${Pn(t)} found`)];if(r.length&&t.length!==r.length)return[new It(c,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new It(c,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let h={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(h.function=r.function),"object"===Pn(r.value)&&(h=r.value);let p=[];for(let m=0;m<t.length;m++)p=p.concat(d({array:t,arrayIndex:m,value:t[m],valueSpec:h,style:s,styleSpec:l,key:`${c}[${m}]`},!0));return p}function Mp(n){const t=n.key,r=n.value,s=n.valueSpec;let l=Pn(r);if("number"===l&&r!=r&&(l="NaN"),"number"!==l)return[new It(t,r,`number expected, ${l} found`)];if("minimum"in s){let c=s.minimum;if("array"===Pn(s.minimum)&&(c=s.minimum[n.arrayIndex]),r<c)return[new It(t,r,`${r} is less than the minimum value ${c}`)]}if("maximum"in s){let c=s.maximum;if("array"===Pn(s.maximum)&&(c=s.maximum[n.arrayIndex]),r>c)return[new It(t,r,`${r} is greater than the maximum value ${c}`)]}return[]}function yh(n){const t=n.valueSpec,r=mr(n.value.type);let s,l,c,d={};const h="categorical"!==r&&void 0===n.value.property,p=!h,m="array"===Pn(n.value.stops)&&"array"===Pn(n.value.stops[0])&&"object"===Pn(n.value.stops[0][0]),_=$s({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(b){if("identity"===r)return[new It(b.key,b.value,'identity function may not have a "stops" property')];let E=[];const C=b.value;return E=E.concat(A0({key:b.key,value:C,valueSpec:b.valueSpec,style:b.style,styleSpec:b.styleSpec,arrayElementValidator:y})),"array"===Pn(C)&&0===C.length&&E.push(new It(b.key,C,"array must have at least one stop")),E},default:function(b){return Xr({key:b.key,value:b.value,valueSpec:t,style:b.style,styleSpec:b.styleSpec})}}});return"identity"===r&&h&&_.push(new It(n.key,n.value,'missing required property "property"')),"identity"===r||n.value.stops||_.push(new It(n.key,n.value,'missing required property "stops"')),"exponential"===r&&n.valueSpec.expression&&!TE(n.valueSpec)&&_.push(new It(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(p&&!lu(n.valueSpec)?_.push(new It(n.key,n.value,"property functions not supported")):h&&!SE(n.valueSpec)&&_.push(new It(n.key,n.value,"zoom functions not supported"))),"categorical"!==r&&!m||void 0!==n.value.property||_.push(new It(n.key,n.value,'"property" property is required')),_;function y(b){let E=[];const C=b.value,S=b.key;if("array"!==Pn(C))return[new It(S,C,`array expected, ${Pn(C)} found`)];if(2!==C.length)return[new It(S,C,`array length 2 expected, length ${C.length} found`)];if(m){if("object"!==Pn(C[0]))return[new It(S,C,`object expected, ${Pn(C[0])} found`)];if(void 0===C[0].zoom)return[new It(S,C,"object stop key must have zoom")];if(void 0===C[0].value)return[new It(S,C,"object stop key must have value")];const M=mr(C[0].zoom);if("number"!=typeof M)return[new It(S,C[0].zoom,"stop zoom values must be numbers")];if(c&&c>M)return[new It(S,C[0].zoom,"stop zoom values must appear in ascending order")];M!==c&&(c=M,l=void 0,d={}),E=E.concat($s({key:`${S}[0]`,value:C[0],valueSpec:{zoom:{}},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{zoom:Mp,value:v}}))}else E=E.concat(v({key:`${S}[0]`,value:C[0],valueSpec:{},style:b.style,styleSpec:b.styleSpec},C));return bp(Pa(C[1]))?E.concat([new It(`${S}[1]`,C[1],"expressions are not allowed in function stops.")]):E.concat(Xr({key:`${S}[1]`,value:C[1],valueSpec:t,style:b.style,styleSpec:b.styleSpec}))}function v(b,E){const C=Pn(b.value),S=mr(b.value),M=null!==b.value?b.value:E;if(s){if(C!==s)return[new It(b.key,M,`${C} stop domain type must match previous stop domain type ${s}`)]}else s=C;if("number"!==C&&"string"!==C&&"boolean"!==C&&"number"!=typeof S&&"string"!=typeof S&&"boolean"!=typeof S)return[new It(b.key,M,"stop domain value must be a number, string, or boolean")];if("number"!==C&&"categorical"!==r){let D=`number expected, ${C} found`;return lu(t)&&void 0===r&&(D+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(b.key,M,D)]}return"categorical"!==r||"number"!==C||"number"==typeof S&&isFinite(S)&&Math.floor(S)===S?"categorical"!==r&&"number"===C&&"number"==typeof S&&"number"==typeof l&&void 0!==l&&S<l?[new It(b.key,M,"stop domain values must appear in ascending order")]:(l=S,"categorical"===r&&S in d?[new It(b.key,M,"stop domain values must be unique")]:(d[S]=!0,[])):[new It(b.key,M,`integer expected, found ${String(S)}`)]}}function ua(n){const t=("property"===n.expressionContext?Ep:mc)(Pa(n.value),n.valueSpec);if("error"===t.result)return t.value.map(s=>new It(`${n.key}${s.key}`,n.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!r.outputDefined())return[new It(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!a_(r))return[new It(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return R0(r,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Ee(r,["zoom","feature-state"]))return[new It(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!bi(r))return[new It(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function R0(n,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const l of t.valueSpec.expression.parameters)r.delete(l);if(0===r.size)return[];const s=[];return n instanceof gs&&r.has(n.name)?[new It(t.key,t.value,`["${n.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(n.eachChild(l=>{s.push(...R0(l,t))}),s)}function P0(n){const t=n.key,r=n.value,s=n.valueSpec,l=[];return Array.isArray(s.values)?-1===s.values.indexOf(mr(r))&&l.push(new It(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(s.values).indexOf(mr(r))&&l.push(new It(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function IE(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!IE(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function O0(n,t="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};IE(n)||(n=vh(n));const r=n;let s=!0;try{s=function(m){if(!Sp(m))return m;let _=Pa(m);return RE(_),_=AE(_),_}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const l=J[`filter_${t}`],c=mc(s,l);let d=null;if("error"===c.result)throw new Error(c.value.map(m=>`${m.key}: ${m.message}`).join(", "));d=(m,_,y)=>c.value.evaluate(m,_,{},y);let h=null,p=null;if(s!==r){const m=mc(r,l);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));h=(_,y,v,b,E)=>m.value.evaluate(_,y,{},v,void 0,void 0,b,E),p=!bi(m.value.expression)}return{filter:d,dynamicFilter:h||void 0,needGeometry:OE(s),needFeature:!!p}}function AE(n){if(!Array.isArray(n))return n;const t=function(r){if(PE.has(r[0]))for(let s=1;s<r.length;s++)if(Sp(r[s]))return!0;return r}(n);return!0===t?t:t.map(r=>AE(r))}function RE(n){let t=!1;const r=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)t=t||Sp(n[s]),r.push(n[s+1]);r.push(n[n.length-1])}else if("match"===n[0]){t=t||Sp(n[1]);for(let s=2;s<n.length-1;s+=2)r.push(n[s+1]);r.push(n[n.length-1])}else if("step"===n[0]){t=t||Sp(n[1]);for(let s=1;s<n.length-1;s+=2)r.push(n[s+1])}t&&(n.length=0,n.push("any",...r));for(let s=1;s<n.length;s++)RE(n[s])}function Sp(n){if(!Array.isArray(n))return!1;if("pitch"===(t=n[0])||"distance-from-center"===t)return!0;var t;for(let r=1;r<n.length;r++)if(Sp(n[r]))return!0;return!1}const PE=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function k0(n,t){return n<t?-1:n>t?1:0}function OE(n){if(!Array.isArray(n))return!1;if("within"===n[0]||"distance"===n[0])return!0;for(let t=1;t<n.length;t++)if(OE(n[t]))return!0;return!1}function vh(n){if(!n)return!0;const t=n[0];return n.length<=1?"any"!==t:"=="===t?kE(n[1],n[2],"=="):"!="===t?Tp(kE(n[1],n[2],"==")):"<"===t||">"===t||"<="===t||">="===t?kE(n[1],n[2],t):"any"===t?(r=n.slice(1),["any"].concat(r.map(vh))):"all"===t?["all"].concat(n.slice(1).map(vh)):"none"===t?["all"].concat(n.slice(1).map(vh).map(Tp)):"in"===t?sA(n[1],n.slice(2)):"!in"===t?Tp(sA(n[1],n.slice(2))):"has"===t?FE(n[1]):"!has"!==t||Tp(FE(n[1]));var r}function kE(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function sA(n,t){if(0===t.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(k0)]]:["filter-in-small",n,["literal",t]]}}function FE(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Tp(n){return["!",n]}function y_(n){return IE(Pa(n.value))?ua(iu({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):LE(n)}function LE(n){const t=n.value,r=n.key;if("array"!==Pn(t))return[new It(r,t,`array expected, ${Pn(t)} found`)];const s=n.styleSpec;let l,c=[];if(t.length<1)return[new It(r,t,"filter array must have at least 1 element")];switch(c=c.concat(P0({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),mr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===mr(t[1])&&c.push(new It(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&c.push(new It(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Pn(t[1]),"string"!==l&&c.push(new It(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let d=2;d<t.length;d++)l=Pn(t[d]),"$type"===mr(t[1])?c=c.concat(P0({key:`${r}[${d}]`,value:t[d],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==l&&"number"!==l&&"boolean"!==l&&c.push(new It(`${r}[${d}]`,t[d],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let d=1;d<t.length;d++)c=c.concat(LE({key:`${r}[${d}]`,value:t[d],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":l=Pn(t[1]),2!==t.length?c.push(new It(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==l&&c.push(new It(`${r}[1]`,t[1],`string expected, ${l} found`))}return c}function NE(n,t){const r=n.key,s=n.style,l=n.layer,c=n.styleSpec,d=n.value,h=n.objectKey,p=c[`${t}_${n.layerType}`];if(!p)return[];const m=h.match(/^(.*)-transition$/);if("paint"===t&&m&&p[m[1]]&&p[m[1]].transition)return Xr({key:r,value:d,valueSpec:c.transition,style:s,styleSpec:c});const _=n.valueSpec||p[h];if(!_)return[new Yu(r,d,`unknown property "${h}"`)];let y;if("string"===Pn(d)&&lu(_)&&!_.tokens&&(y=/^{([^}]+)}$/.exec(d))){const b=`\`{ "type": "identity", "property": ${y?JSON.stringify(y[1]):'"_"'} }\``;return[new It(r,d,`"${h}" does not support interpolation syntax\nUse an identity property function instead: ${b}.`)]}const v=[];if("symbol"===n.layerType)"text-field"!==h||!s||s.glyphs||s.imports||v.push(new It(r,d,'use of "text-field" requires a style "glyphs" property')),"text-font"===h&&Dl(Pa(d))&&"identity"===mr(d.type)&&v.push(new It(r,d,'"text-font" does not support identity functions'));else if("model"===n.layerType&&"paint"===t&&l&&l.layout&&l.layout.hasOwnProperty("model-id")&&lu(_)&&(rA(_)||SE(_))){const b=Ep(Pa(d),_),E=b.value.expression||b.value._styleExpression.expression;E&&!Ee(E,["measure-light"])&&v.push(new It(r,d,`${h} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`))}return v.concat(Xr({key:n.key,value:d,valueSpec:_,style:s,styleSpec:c,expressionContext:"property",propertyType:t,propertyKey:h}))}function zE(n){return NE(n,"paint")}function F0(n){return NE(n,"layout")}function BE(n){let t=[];const r=n.value,s=n.key,l=n.style,c=n.styleSpec;r.type||r.ref||t.push(new It(s,r,'either "type" or "ref" is required'));let d=mr(r.type);const h=mr(r.ref);if(r.id){const p=mr(r.id);for(let m=0;m<n.arrayIndex;m++){const _=l.layers[m];mr(_.id)===p&&t.push(new It(s,r.id,`duplicate layer id "${r.id}", previously used at line ${_.id.__line__}`))}}if("ref"in r){let p;["type","source","source-layer","filter","layout"].forEach(m=>{m in r&&t.push(new It(s,r[m],`"${m}" is prohibited for ref layers`))}),l.layers.forEach(m=>{mr(m.id)===h&&(p=m)}),p?p.ref?t.push(new It(s,r.ref,"ref cannot reference another ref layer")):d=mr(p.type):"string"==typeof h&&t.push(new It(s,r.ref,`ref layer "${h}" not found`))}else if("background"!==d&&"sky"!==d&&"slot"!==d)if(r.source){const p=l.sources&&l.sources[r.source],m=p&&mr(p.type);p?"vector"===m&&"raster"===d?t.push(new It(s,r.source,`layer "${r.id}" requires a raster source`)):"raster"===m&&"raster"!==d?t.push(new It(s,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==m||r["source-layer"]?"raster-dem"===m&&"hillshade"!==d?t.push(new It(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==d||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===m&&p.lineMetrics||t.push(new It(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new It(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new It(s,r.source,`source "${r.source}" not found`))}else t.push(new It(s,r,'missing required property "source"'));return t=t.concat($s({key:s,value:r,valueSpec:c.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Xr({key:`${s}.type`,value:r.type,valueSpec:c.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:p=>y_(iu({layerType:d},p)),layout:p=>$s({layer:r,key:p.key,value:p.value,valueSpec:{},style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":m=>F0(iu({layerType:d},m))}}),paint:p=>$s({layer:r,key:p.key,value:p.value,valueSpec:{},style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":m=>zE(iu({layerType:d,layer:r},m))}})}})),t}function id(n){const t=n.value,r=n.key,s=Pn(t);return"string"!==s?[new It(r,t,`string expected, ${s} found`)]:[]}const VE={promoteId:function({key:n,value:t}){if("string"===Pn(t))return id({key:n,value:t});{const r=[];for(const s in t)r.push(...id({key:`${n}.${s}`,value:t[s]}));return r}}};function aA(n){const t=n.value,r=n.key,s=n.styleSpec,l=n.style;if(!t.type)return[new It(r,t,'"type" is required')];const c=mr(t.type);let d;switch(c){case"vector":case"raster":case"raster-dem":return d=$s({key:r,value:t,valueSpec:s[`source_${c.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:VE}),d;case"geojson":if(d=$s({key:r,value:t,valueSpec:s.source_geojson,style:l,styleSpec:s,objectElementValidators:VE}),t.cluster)for(const h in t.clusterProperties){const[p,m]=t.clusterProperties[h],_="string"==typeof p?[p,["accumulated"],["get",h]]:p;d.push(...ua({key:`${r}.${h}.map`,value:m,expressionContext:"cluster-map"})),d.push(...ua({key:`${r}.${h}.reduce`,value:_,expressionContext:"cluster-reduce"}))}return d;case"video":return $s({key:r,value:t,valueSpec:s.source_video,style:l,styleSpec:s});case"image":return $s({key:r,value:t,valueSpec:s.source_image,style:l,styleSpec:s});case"canvas":return[new It(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return P0({key:`${r}.type`,value:t.type,valueSpec:{values:lA(s)},style:l,styleSpec:s})}}function lA(n){return n.source.reduce((t,r)=>{const s=n[r];return"enum"===s.type.type&&(t=t.concat(Object.keys(s.type.values))),t},[])}function rs(n){const t=n.value;let r=[];if(!t)return r;const s=Pn(t);return"string"!==s?(r=r.concat([new It(n.key,t,`string expected, "${s}" found`)]),r):(function(l){const c=-1===l.indexOf("://");try{return new URL(l,c?"http://example.com":void 0),!0}catch{return!1}}(t)||(r=r.concat([new It(n.key,t,`invalid url "${t}"`)])),r)}function L0(n){const t=n.value,r=n.styleSpec,s=r.light,l=n.style;let c=[];const d=Pn(t);if(void 0===t)return c;if("object"!==d)return c=c.concat([new It("light",t,`object expected, ${d} found`)]),c;for(const h in t){const p=h.match(/^(.*)-transition$/);c=c.concat(p&&s[p[1]]&&s[p[1]].transition?Xr({key:h,value:t[h],valueSpec:r.transition,style:l,styleSpec:r}):s[h]?Xr({key:h,value:t[h],valueSpec:s[h],style:l,styleSpec:r}):[new It(h,t[h],`unknown property "${h}"`)])}return c}function jE(n){const t=n.value;let r=[];if(!t)return r;const s=Pn(t);if("object"!==s)return r=r.concat([new It("light-3d",t,`object expected, ${s} found`)]),r;const l=n.styleSpec,c=l["light-3d"],d=n.key,h=n.style,p=n.style.lights;for(const y of["type","id"])if(!(y in t))return r=r.concat([new It("light-3d",t,`missing property ${y} on light`)]),r;if(t.type&&p)for(let y=0;y<n.arrayIndex;y++){const v=mr(t.type),b=p[y];mr(b.type)===v&&r.push(new It(d,t.id,`duplicate light type "${t.type}", previously defined at line ${b.id.__line__}`))}const m=`properties_light_${t.type}`;if(!(m in l))return r=r.concat([new It("light-3d",t,`Invalid light type ${t.type}`)]),r;const _=l[m];for(const y in t)if("properties"===y){const v=t[y],b=Pn(v);if("object"!==b)return r=r.concat([new It("properties",v,`object expected, ${b} found`)]),r;for(const E in v)r=r.concat(_[E]?Xr({key:E,value:v[E],valueSpec:_[E],style:h,styleSpec:l}):[new Yu(n.key,v[E],`unknown property "${E}"`)])}else{const v=y.match(/^(.*)-transition$/);r=r.concat(v&&c[v[1]]&&c[v[1]].transition?Xr({key:y,value:t[y],valueSpec:l.transition,style:h,styleSpec:l}):c[y]?Xr({key:y,value:t[y],valueSpec:c[y],style:h,styleSpec:l}):[new Yu(y,t[y],`unknown property "${y}"`)])}return r}function UE(n){const t=n.value,r=n.key,s=n.style,l=n.styleSpec,c=l.terrain;let d=[];const h=Pn(t);if(void 0===t)return d;if("object"!==h)return d=d.concat([new It("terrain",t,`object expected, ${h} found`)]),d;for(const p in t){const m=p.match(/^(.*)-transition$/);d=d.concat(m&&c[m[1]]&&c[m[1]].transition?Xr({key:p,value:t[p],valueSpec:l.transition,style:s,styleSpec:l}):c[p]?Xr({key:p,value:t[p],valueSpec:c[p],style:s,styleSpec:l}):[new Yu(p,t[p],`unknown property "${p}"`)])}if(t.source){const p=s.sources&&s.sources[t.source],m=p&&mr(p.type);p?"raster-dem"!==m&&d.push(new It(r,t.source,`terrain cannot be used with a source of type ${String(m)}, it only be used with a "raster-dem" source type`)):d.push(new It(r,t.source,`source "${t.source}" not found`))}else d.push(new It(r,t,'terrain is missing required property "source"'));return d}function N0(n){const t=n.value,r=n.style,s=n.styleSpec,l=s.fog;let c=[];const d=Pn(t);if(void 0===t)return c;if("object"!==d)return c=c.concat([new It("fog",t,`object expected, ${d} found`)]),c;for(const h in t){const p=h.match(/^(.*)-transition$/);c=c.concat(p&&l[p[1]]&&l[p[1]].transition?Xr({key:h,value:t[h],valueSpec:s.transition,style:r,styleSpec:s}):l[h]?Xr({key:h,value:t[h],valueSpec:l[h],style:r,styleSpec:s}):[new Yu(h,t[h],`unknown property "${h}"`)])}return c}const z0={"*":()=>[],array:A0,boolean:function(n){const t=n.value,r=n.key,s=Pn(t);return"boolean"!==s?[new It(r,t,`boolean expected, ${s} found`)]:[]},number:Mp,color:function(n){const t=n.key,r=n.value,s=Pn(r);return"string"!==s?[new It(t,r,`color expected, ${s} found`)]:null===Ii(r)?[new It(t,r,`color expected, "${r}" found`)]:[]},enum:P0,filter:y_,function:yh,layer:BE,object:$s,source:aA,model:rs,light:L0,"light-3d":jE,terrain:UE,fog:N0,string:id,formatted:function(n){return 0===id(n).length?[]:ua(n)},resolvedImage:function(n){return 0===id(n).length?[]:ua(n)},projection:function(n){const t=n.value,r=n.styleSpec,s=r.projection,l=n.style;let c=[];const d=Pn(t);if("object"===d)for(const h in t)c=c.concat(Xr({key:h,value:t[h],valueSpec:s[h],style:l,styleSpec:r}));else"string"!==d&&(c=c.concat([new It("projection",t,`object or string expected, ${d} found`)]));return c},import:function(n){const{value:t,styleSpec:r}=n,{data:s,...l}=t;Object.defineProperty(l,"__line__",{value:t.__line__,enumerable:!1});let c=$s(iu({},n,{value:l,valueSpec:r.import}));return""===mr(l.id)&&c.push(new It(`${n.key}.id`,l,"import id can't be an empty string")),s&&(c=c.concat($E(s,r,{key:`${n.key}.data`}))),c}};function Xr(n,t=!1){const r=n.value,s=n.valueSpec,l=n.styleSpec;if(s.expression&&Dl(mr(r)))return yh(n);if(s.expression&&bp(Pa(r)))return ua(n);if(s.type&&z0[s.type]){const c=z0[s.type](n);return!0===t&&c.length>0&&"array"===Pn(n.value)?ua(n):c}return $s(iu({},n,{valueSpec:s.type?l[s.type]:s}))}function B0(n){const t=n.value,r=n.key,s=id(n);return s.length||(-1===t.indexOf("{fontstack}")&&s.push(new It(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&s.push(new It(r,t,'"glyphs" url must include a "{range}" token'))),s}function $E(n,t=J,r={}){return Xr({key:r.key||"",value:n,valueSpec:t.$root,styleSpec:t,style:n,objectElementValidators:{glyphs:B0,"*":()=>[]}})}function os(n,t=J){return za($E(n,t))}const HE=n=>za(aA(n)),GE=n=>za(L0(n)),Yi=n=>za(jE(n)),V0=n=>za(UE(n)),v_=n=>za(N0(n)),ys=n=>za(BE(n)),j0=n=>za(y_(n)),qE=n=>za(zE(n)),xh=n=>za(F0(n)),Hs=n=>za(rs(n));function za(n){return n.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function x_(n,t){let r=!1;if(t&&t.length)for(const s of t)s instanceof Yu?Q(s.message):(n.fire(new at(new Error(s.message))),r=!0);return r}var cA=Ba,ss=3;function Ba(n,t,r){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var l=new Int32Array(this.arrayBuffer);n=l[0],this.d=(t=l[1])+2*(r=l[2]);for(var c=0;c<this.d*this.d;c++){var d=l[ss+c],h=l[ss+c+1];s.push(d===h?null:l.subarray(d,h))}var p=l[ss+s.length+1];this.keys=l.subarray(l[ss+s.length],p),this.bboxes=l.subarray(p),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var m=0;m<this.d*this.d;m++)s.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=n,this.padding=r,this.scale=t/n,this.uid=0;var _=r/t*n;this.min=-_,this.max=n+_}Ba.prototype.insert=function(n,t,r,s,l){this._forEachCell(t,r,s,l,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l)},Ba.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ba.prototype._insertCell=function(n,t,r,s,l,c){this.cells[l].push(c)},Ba.prototype.query=function(n,t,r,s,l){var c=this.min,d=this.max;if(n<=c&&t<=c&&d<=r&&d<=s&&!l)return Array.prototype.slice.call(this.keys);var h=[];return this._forEachCell(n,t,r,s,this._queryCell,h,{},l),h},Ba.prototype._queryCell=function(n,t,r,s,l,c,d,h){var p=this.cells[l];if(null!==p)for(var m=this.keys,_=this.bboxes,y=0;y<p.length;y++){var v=p[y];if(void 0===d[v]){var b=4*v;(h?h(_[b+0],_[b+1],_[b+2],_[b+3]):n<=_[b+2]&&t<=_[b+3]&&r>=_[b+0]&&s>=_[b+1])?(d[v]=!0,c.push(m[v])):d[v]=!1}}},Ba.prototype._forEachCell=function(n,t,r,s,l,c,d,h){for(var p=this._convertToCellCoord(n),m=this._convertToCellCoord(t),_=this._convertToCellCoord(r),y=this._convertToCellCoord(s),v=p;v<=_;v++)for(var b=m;b<=y;b++){var E=this.d*b+v;if((!h||h(this._convertFromCellCoord(v),this._convertFromCellCoord(b),this._convertFromCellCoord(v+1),this._convertFromCellCoord(b+1)))&&l.call(this,n,t,r,s,E,c,d,h))return}},Ba.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Ba.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Ba.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,t=ss+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var l=new Int32Array(t+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var c=t,d=0;d<n.length;d++){var h=n[d];l[ss+d]=c,l.set(h,c),c+=h.length}return l[ss+n.length]=c,l.set(this.keys,c),l[ss+n.length+1]=c+=this.keys.length,l.set(this.bboxes,c),c+=this.bboxes.length,l.buffer};var bh=hs(cA);const Dp={};function Xt(n,t,r={}){Object.defineProperty(n,"_classRegistryKey",{value:t,writeable:!1}),Dp[t]={klass:n,omit:r.omit||[]}}Xt(Object,"Object"),bh.serialize=function(n,t){const r=n.toArrayBuffer();return t&&t.add(r),{buffer:r}},bh.deserialize=function(n){return new bh(n.buffer)},Object.defineProperty(bh,"name",{value:"Grid"}),Xt(bh,"Grid"),Xt(Ne,"Color"),Xt(Error,"Error"),Xt(vt,"AJAXError"),Xt(ms,"ResolvedImage"),Xt(_h,"StylePropertyFunction"),Xt(__,"StyleExpression",{omit:["_evaluator"]}),Xt(gc,"ZoomDependentExpression"),Xt(wp,"ZoomConstantExpression"),Xt(gs,"CompoundExpression",{omit:["_evaluate"]});for(const n in p_)Dp[p_[n]._classRegistryKey]||Xt(p_[n],`Expression${n}`);function U0(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function WE(n){return st.ImageBitmap&&n instanceof st.ImageBitmap}function qe(n,t){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(U0(n)||WE(n))return t&&t.add(n),n;if(ArrayBuffer.isView(n)){const r=n;return t&&t.add(r.buffer),r}if(n instanceof st.ImageData)return t&&t.add(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const s of n)r.push(qe(s,t));return r}if(n instanceof Map){const r={$name:"Map"};for(const[s,l]of n.entries())r[s]=qe(l);return r}if("object"==typeof n){const r=n.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const l=r.serialize?r.serialize(n,t):{};if(!r.serialize){for(const c in n)n.hasOwnProperty(c)&&(Dp[s].omit.indexOf(c)>=0||(l[c]=qe(n[c],t)));n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof n)}function rd(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||U0(n)||WE(n)||ArrayBuffer.isView(n)||n instanceof st.ImageData)return n;if(Array.isArray(n))return n.map(rd);if("object"==typeof n){const t=n.$name||"Object";if("Map"===t){const l=new Map;for(const c of Object.keys(n))"$name"!==c&&l.set(c,rd(n[c]));return l}const{klass:r}=Dp[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const s=Object.create(r.prototype);for(const l of Object.keys(n))"$name"!==l&&(s[l]=rd(n[l]));return s}throw new Error("can't deserialize object of type "+typeof n)}const ne={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function $0(n){for(const t of n)if(b_(t.charCodeAt(0)))return!0;return!1}function uA(n){for(const t of n)if(!dA(t.charCodeAt(0)))return!1;return!0}function dA(n){return!(ne.Arabic(n)||ne["Arabic Supplement"](n)||ne["Arabic Extended-A"](n)||ne["Arabic Presentation Forms-A"](n)||ne["Arabic Presentation Forms-B"](n))}function b_(n){return!(746!==n&&747!==n&&(n<4352||!(ne["Bopomofo Extended"](n)||ne.Bopomofo(n)||ne["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||ne["CJK Compatibility Ideographs"](n)||ne["CJK Compatibility"](n)||ne["CJK Radicals Supplement"](n)||ne["CJK Strokes"](n)||!(!ne["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||ne["CJK Unified Ideographs Extension A"](n)||ne["CJK Unified Ideographs"](n)||ne["Enclosed CJK Letters and Months"](n)||ne["Hangul Compatibility Jamo"](n)||ne["Hangul Jamo Extended-A"](n)||ne["Hangul Jamo Extended-B"](n)||ne["Hangul Jamo"](n)||ne["Hangul Syllables"](n)||ne.Hiragana(n)||ne["Ideographic Description Characters"](n)||ne.Kanbun(n)||ne["Kangxi Radicals"](n)||ne["Katakana Phonetic Extensions"](n)||ne.Katakana(n)&&12540!==n||!(!ne["Halfwidth and Fullwidth Forms"](n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!ne["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||ne["Unified Canadian Aboriginal Syllabics"](n)||ne["Unified Canadian Aboriginal Syllabics Extended"](n)||ne["Vertical Forms"](n)||ne["Yijing Hexagram Symbols"](n)||ne["Yi Syllables"](n)||ne["Yi Radicals"](n))))}function od(n){return!(b_(n)||(t=n,ne["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ne["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ne["Letterlike Symbols"](t)||ne["Number Forms"](t)||ne["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ne["Control Pictures"](t)&&9251!==t||ne["Optical Character Recognition"](t)||ne["Enclosed Alphanumerics"](t)||ne["Geometric Shapes"](t)||ne["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ne["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ne["CJK Symbols and Punctuation"](t)||ne.Katakana(t)||ne["Private Use Area"](t)||ne["CJK Compatibility Forms"](t)||ne["Small Form Variants"](t)||ne["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function ZE(n){return n>=1424&&n<=2303||ne["Arabic Presentation Forms-A"](n)||ne["Arabic Presentation Forms-B"](n)}function hA(n,t){return!(!t&&ZE(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||ne.Khmer(n))}function fA(n){for(const t of n)if(ZE(t.charCodeAt(0)))return!0;return!1}const H0="deferred",G0="loading",Nt="loaded";let qn=null,Go="unavailable",Il=null;const ho=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(Go="error"),qn&&qn(n)};function w_(){sd.fire(new St("pluginStateChange",{pluginStatus:Go,pluginURL:Il}))}const sd=new $i,da=function(){return Go},E_=function(){if(Go!==H0||!Il)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Go=G0,w_(),Il&&zt({url:Il},n=>{n?ho(n):(Go=Nt,w_())})},vs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Go===Nt||null!=vs.applyArabicShaping,isLoading:()=>Go===G0,setState(n){Go=n.pluginStatus,Il=n.pluginURL},isParsed:()=>null!=vs.applyArabicShaping&&null!=vs.processBidirectionalText&&null!=vs.processStyledBidirectionalText,getPluginURL:()=>Il};class wi{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(r,s){for(const l of r)if(!hA(l.charCodeAt(0),s))return!1;return!0}(t,vs.isLoaded())}}class q0{constructor(t,r,s){this.property=t,this.value=r,this.expression=function(l,c,d){if(Dl(l))return new _h(l,c);if(bp(l)||Array.isArray(l)&&l.length>0){const h=Ep(l,c,d);if("error"===h.result)throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=l;return"string"==typeof l&&"color"===c.type&&(h=Ne.parse(l)),{kind:"constant",isConfigDependent:!1,evaluate:()=>h}}}(void 0===r?t.specification.default:r,t.specification,s)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class C_{constructor(t,r){this.property=t,this.value=new q0(t,void 0,r)}transitioned(t,r){return new Al(this.property,this.value,r,Yt({},t.transition,this.transition),t.now)}untransitioned(){return new Al(this.property,this.value,null,{},0)}}class Yr{constructor(t,r){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=r,this.isConfigDependent=!1}getValue(t){return $(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new C_(this._values[t].property,this._options)),this._values[t].value=new q0(this._values[t].property,null===r?void 0:$(r),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,r){r&&(this._options=r);const s=this._properties.properties;if(t)for(const l in t){const c=t[l];if(Jc(l,"-transition")){const d=l.slice(0,-11);s[d]&&this.setTransition(d,c)}else s[l]&&this.setValue(l,c)}}getTransition(t){return $(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new C_(this._values[t].property)),this._values[t].transition=$(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(t[r]=s);const l=this.getTransition(r);void 0!==l&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const s=new W0(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(t,r._values[l]);return s}untransitioned(){const t=new W0(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Al{constructor(t,r,s,l,c){const d=l.delay||0,h=l.duration||0;c=c||0,this.property=t,this.value=r,this.begin=c+d,this.end=this.begin+h,t.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const l=t.now||0,c=this.value.possiblyEvaluate(t,r,s),d=this.prior;if(d){if(l>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(l<this.begin)return d.possiblyEvaluate(t,r,s);{const h=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(t,r,s),c,Yc(h))}}return c}}class W0{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const l=new Ip(this._properties);for(const c of Object.keys(this._values))l._values[c]=this._values[c].possiblyEvaluate(t,r,s);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class wh{constructor(t,r){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=r,this.isConfigDependent=!1}getValue(t){return $(this._values[t].value)}setValue(t,r){this._values[t]=new q0(this._values[t].property,null===r?void 0:$(r),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const l=new Ip(this._properties);for(const c of Object.keys(this._values))l._values[c]=this._values[c].possiblyEvaluate(t,r,s);return l}}class xs{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,r,s,l){return this.property.evaluate(this.value,this.parameters,t,r,s,l)}}class Ip{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Dt{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,s){const l=d_[this.specification.type];return l?l(t,r,s):t}}class se{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,l){return new xs(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(r,null,{},s,l)}:t.expression,r)}interpolate(t,r,s){if("constant"!==t.value.kind||"constant"!==r.value.kind)return t;if(void 0===t.value.value||void 0===r.value.value)return new xs(this,{kind:"constant",value:void 0},t.parameters);const l=d_[this.specification.type];return l?new xs(this,{kind:"constant",value:l(t.value.value,r.value.value,s)},t.parameters):t}evaluate(t,r,s,l,c,d){return"constant"===t.kind?t.value:t.evaluate(r,s,l,c,d)}}class Ap{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){return!!t.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class Ei{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new wi(0,{});for(const s in t){const l=t[s];l.specification.overridable&&this.overridableProperties.push(s);const c=this.defaultPropertyValues[s]=new q0(l,void 0),d=this.defaultTransitionablePropertyValues[s]=new C_(l);this.defaultTransitioningPropertyValues[s]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=c.possiblyEvaluate(r)}}}function Kr(n,t){return t?`${n}\x1f${t}`:n}function M_(n){const t=n.indexOf("\x1f");return t>=0?n.slice(0,t):n}Xt(se,"DataDrivenProperty"),Xt(Dt,"DataConstantProperty"),Xt(Ap,"ColorRampProperty");const S_="-transition";class Gs extends $i{constructor(t,r,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=s,t.slot&&(this.slot=t.slot),r.layout&&(this._unevaluatedLayout=new wh(r.layout,s),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new Yr(r.paint,s);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ip(r.paint)}}setScope(t){this.scope=t,this.fqid=Kr(this.id,t)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){if(null!=r&&this._validate(xh,`layers.${this.id}.layout.${t}`,t,r,s))return;if("custom"===this.type&&"visibility"===t)return void(this.visibility=r);const l=this._unevaluatedLayout;l._properties.properties[t]&&(l.setValue(t,r),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return Jc(t,S_)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(null!=r&&this._validate(qE,`layers.${this.id}.paint.${t}`,t,r,s))return!1;const l=this._transitionablePaint,c=l._properties.properties;if(Jc(t,S_)){const v=t.slice(0,-11);return c[v]&&l.setTransition(v,r||void 0),!1}if(!c[t])return!1;const d=l._values[t],h=d.value.isDataDriven(),p=d.value;l.setValue(t,r),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const m=l._values[t].value,_=m.isDataDriven(),y=Jc(t,"pattern")||"line-dasharray"===t;return _||h||y||this._handleOverridablePaintPropertyUpdate(t,p,m)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,r){return null}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){return Pt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,r)=>!(void 0===t||"layout"===r&&!Object.keys(t).length||"paint"===r&&!Object.keys(t).length))}_validate(t,r,s,l,c={}){return(!c||!1!==c.validate)&&x_(this,t.call(os,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:J,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof xs&&lu(r.property.specification)&&("source"===r.value.kind||"composite"===r.value.kind)&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=O0(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class XE{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id)}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this.updatedPaintProps.delete(t.fqid)}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const Z0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rp{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function pn(n,t=1){let r=0,s=0;return{members:n.map(l=>{const c=Z0[l.type].BYTES_PER_ELEMENT,d=r=X0(r,Math.max(t,c)),h=l.components||1;return s=Math.max(s,c),r+=c*h,{name:l.name,type:l.type,components:h,offset:d}}),size:X0(r,Math.max(s,t)),alignment:t}}function X0(n,t){return Math.ceil(n/t)*t}class qo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=s,t}}qo.prototype.bytesPerElement=4,Xt(qo,"StructArrayLayout2i4");class T_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const c=3*t;return this.int16[c+0]=r,this.int16[c+1]=s,this.int16[c+2]=l,t}}T_.prototype.bytesPerElement=6,Xt(T_,"StructArrayLayout3i6");class ad extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,l)}emplace(t,r,s,l,c){const d=4*t;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=l,this.int16[d+3]=c,t}}ad.prototype.bytesPerElement=8,Xt(ad,"StructArrayLayout4i8");class Ao extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l,c)}emplace(t,r,s,l,c,d){const h=5*t;return this.int16[h+0]=r,this.int16[h+1]=s,this.int16[h+2]=l,this.int16[h+3]=c,this.int16[h+4]=d,t}}Ao.prototype.bytesPerElement=10,Xt(Ao,"StructArrayLayout5i10");class _c extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,l,c,d,h)}emplace(t,r,s,l,c,d,h,p){const m=6*t,_=12*t,y=3*t;return this.int16[m+0]=r,this.int16[m+1]=s,this.uint8[_+4]=l,this.uint8[_+5]=c,this.uint8[_+6]=d,this.uint8[_+7]=h,this.float32[y+2]=p,t}}_c.prototype.bytesPerElement=12,Xt(_c,"StructArrayLayout2i4ub1f12");class Ci extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,l)}emplace(t,r,s,l,c){const d=4*t;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,this.float32[d+3]=c,t}}Ci.prototype.bytesPerElement=16,Xt(Ci,"StructArrayLayout4f16");class Rl extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l,c)}emplace(t,r,s,l,c,d){const h=6*t,p=3*t;return this.uint16[h+0]=r,this.uint16[h+1]=s,this.uint16[h+2]=l,this.uint16[h+3]=c,this.float32[p+2]=d,t}}Rl.prototype.bytesPerElement=12,Xt(Rl,"StructArrayLayout4ui1f12");class D_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,l)}emplace(t,r,s,l,c){const d=4*t;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=l,this.uint16[d+3]=c,t}}D_.prototype.bytesPerElement=8,Xt(D_,"StructArrayLayout4ui8");class Pp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,s,l,c,d)}emplace(t,r,s,l,c,d,h){const p=6*t;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,this.int16[p+3]=c,this.int16[p+4]=d,this.int16[p+5]=h,t}}Pp.prototype.bytesPerElement=12,Xt(Pp,"StructArrayLayout6i12");class Y0 extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h,p,m,_,y,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,r,s,l,c,d,h,p,m,_,y,v)}emplace(t,r,s,l,c,d,h,p,m,_,y,v,b){const E=12*t;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=l,this.int16[E+3]=c,this.uint16[E+4]=d,this.uint16[E+5]=h,this.uint16[E+6]=p,this.uint16[E+7]=m,this.int16[E+8]=_,this.int16[E+9]=y,this.int16[E+10]=v,this.int16[E+11]=b,t}}Y0.prototype.bytesPerElement=24,Xt(Y0,"StructArrayLayout4i4ui4i24");class I_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,s,l,c,d)}emplace(t,r,s,l,c,d,h){const p=10*t,m=5*t;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,this.float32[m+2]=c,this.float32[m+3]=d,this.float32[m+4]=h,t}}I_.prototype.bytesPerElement=20,Xt(I_,"StructArrayLayout3i3f20");class A_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}A_.prototype.bytesPerElement=4,Xt(A_,"StructArrayLayout1ul4");class Va extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=s,t}}Va.prototype.bytesPerElement=4,Xt(Va,"StructArrayLayout2ui4");class Pl extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h,p,m,_,y,v,b){const E=this.length;return this.resize(E+1),this.emplace(E,t,r,s,l,c,d,h,p,m,_,y,v,b)}emplace(t,r,s,l,c,d,h,p,m,_,y,v,b,E){const C=20*t,S=10*t;return this.int16[C+0]=r,this.int16[C+1]=s,this.int16[C+2]=l,this.int16[C+3]=c,this.int16[C+4]=d,this.float32[S+3]=h,this.float32[S+4]=p,this.float32[S+5]=m,this.float32[S+6]=_,this.int16[C+14]=y,this.uint32[S+8]=v,this.uint16[C+18]=b,this.uint16[C+19]=E,t}}Pl.prototype.bytesPerElement=40,Xt(Pl,"StructArrayLayout5i4f1i1ul2ui40");class R_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,l,c,d,h)}emplace(t,r,s,l,c,d,h,p){const m=8*t;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=l,this.int16[m+4]=c,this.int16[m+5]=d,this.int16[m+6]=h,this.int16[m+7]=p,t}}R_.prototype.bytesPerElement=16,Xt(R_,"StructArrayLayout3i2i2i16");class Eh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l,c)}emplace(t,r,s,l,c,d){const h=4*t,p=8*t;return this.float32[h+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,this.int16[p+6]=c,this.int16[p+7]=d,t}}Eh.prototype.bytesPerElement=16,Xt(Eh,"StructArrayLayout2f1f2i16");class Ch extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,l)}emplace(t,r,s,l,c){const d=12*t,h=3*t;return this.uint8[d+0]=r,this.uint8[d+1]=s,this.float32[h+1]=l,this.float32[h+2]=c,t}}Ch.prototype.bytesPerElement=12,Xt(Ch,"StructArrayLayout2ub2f12");class ja extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const c=3*t;return this.float32[c+0]=r,this.float32[c+1]=s,this.float32[c+2]=l,t}}ja.prototype.bytesPerElement=12,Xt(ja,"StructArrayLayout3f12");class er extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const c=3*t;return this.uint16[c+0]=r,this.uint16[c+1]=s,this.uint16[c+2]=l,t}}er.prototype.bytesPerElement=6,Xt(er,"StructArrayLayout3ui6");class P_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D,R,P,I){const O=this.length;return this.resize(O+1),this.emplace(O,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D,R,P,I)}emplace(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D,R,P,I,O){const F=30*t,L=15*t,N=60*t;return this.int16[F+0]=r,this.int16[F+1]=s,this.int16[F+2]=l,this.float32[L+2]=c,this.float32[L+3]=d,this.uint16[F+8]=h,this.uint16[F+9]=p,this.uint32[L+5]=m,this.uint32[L+6]=_,this.uint32[L+7]=y,this.uint16[F+16]=v,this.uint16[F+17]=b,this.uint16[F+18]=E,this.float32[L+10]=C,this.float32[L+11]=S,this.uint8[N+48]=M,this.uint8[N+49]=D,this.uint8[N+50]=R,this.uint32[L+13]=P,this.int16[F+28]=I,this.uint8[N+58]=O,t}}P_.prototype.bytesPerElement=60,Xt(P_,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class O_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D,R,P,I,O,F,L,N,z,U,V,H,j,Z,tt){const it=this.length;return this.resize(it+1),this.emplace(it,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D,R,P,I,O,F,L,N,z,U,V,H,j,Z,tt)}emplace(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D,R,P,I,O,F,L,N,z,U,V,H,j,Z,tt,it){const X=20*t,Y=40*t,ot=80*t;return this.float32[X+0]=r,this.float32[X+1]=s,this.int16[Y+4]=l,this.int16[Y+5]=c,this.int16[Y+6]=d,this.int16[Y+7]=h,this.int16[Y+8]=p,this.int16[Y+9]=m,this.int16[Y+10]=_,this.int16[Y+11]=y,this.int16[Y+12]=v,this.uint16[Y+13]=b,this.uint16[Y+14]=E,this.uint16[Y+15]=C,this.uint16[Y+16]=S,this.uint16[Y+17]=M,this.uint16[Y+18]=D,this.uint16[Y+19]=R,this.uint16[Y+20]=P,this.uint16[Y+21]=I,this.uint16[Y+22]=O,this.uint16[Y+23]=F,this.uint16[Y+24]=L,this.uint16[Y+25]=N,this.uint16[Y+26]=z,this.uint16[Y+27]=U,this.uint32[X+14]=V,this.float32[X+15]=H,this.float32[X+16]=j,this.float32[X+17]=Z,this.float32[X+18]=tt,this.uint8[ot+76]=it,t}}O_.prototype.bytesPerElement=80,Xt(O_,"StructArrayLayout2f9i15ui1ul4f1ub80");class Op extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Op.prototype.bytesPerElement=4,Xt(Op,"StructArrayLayout1f4");class ha extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l,c)}emplace(t,r,s,l,c,d){const h=5*t;return this.float32[h+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,this.float32[h+3]=c,this.float32[h+4]=d,t}}ha.prototype.bytesPerElement=20,Xt(ha,"StructArrayLayout5f20");class ld extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,l,c,d,h)}emplace(t,r,s,l,c,d,h,p){const m=7*t;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=l,this.float32[m+3]=c,this.float32[m+4]=d,this.float32[m+5]=h,this.float32[m+6]=p,t}}ld.prototype.bytesPerElement=28,Xt(ld,"StructArrayLayout7f28");class K0 extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s,l)}emplace(t,r,s,l,c){const d=6*t;return this.uint32[3*t+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=l,this.uint16[d+4]=c,t}}K0.prototype.bytesPerElement=12,Xt(K0,"StructArrayLayout1ul3ui12");class k_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}k_.prototype.bytesPerElement=2,Xt(k_,"StructArrayLayout1ui2");class cd extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=s,t}}cd.prototype.bytesPerElement=8,Xt(cd,"StructArrayLayout2f8");class YE extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S)}emplace(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M){const D=16*t;return this.float32[D+0]=r,this.float32[D+1]=s,this.float32[D+2]=l,this.float32[D+3]=c,this.float32[D+4]=d,this.float32[D+5]=h,this.float32[D+6]=p,this.float32[D+7]=m,this.float32[D+8]=_,this.float32[D+9]=y,this.float32[D+10]=v,this.float32[D+11]=b,this.float32[D+12]=E,this.float32[D+13]=C,this.float32[D+14]=S,this.float32[D+15]=M,t}}YE.prototype.bytesPerElement=64,Xt(YE,"StructArrayLayout16f64");class F_ extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,c,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,l,c,d,h)}emplace(t,r,s,l,c,d,h,p){const m=10*t,_=5*t;return this.uint16[m+0]=r,this.uint16[m+1]=s,this.uint16[m+2]=l,this.uint16[m+3]=c,this.float32[_+2]=d,this.float32[_+3]=h,this.float32[_+4]=p,t}}F_.prototype.bytesPerElement=20,Xt(F_,"StructArrayLayout4ui3f20");class J0 extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint8[1*t+0]=r,t}}J0.prototype.bytesPerElement=1,Xt(J0,"StructArrayLayout1ub1");class pA extends Rp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pA.prototype.size=40;class KE extends Pl{get(t){return new pA(this,t)}}Xt(KE,"CollisionBoxArray");class L_ extends Rp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}L_.prototype.size=60;class Mh extends P_{get(t){return new L_(this,t)}}Xt(Mh,"PlacedSymbolArray");class JE extends Rp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}JE.prototype.size=80;class Sh extends O_{get(t){return new JE(this,t)}}Xt(Sh,"SymbolInstanceArray");class N_ extends Op{getoffsetX(t){return this.float32[1*t+0]}}Xt(N_,"GlyphOffsetArray");class kp extends qo{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Xt(kp,"SymbolLineVertexArray");class mA extends Rp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}mA.prototype.size=12;class Q0 extends K0{get(t){return new mA(this,t)}}Xt(Q0,"FeatureIndexArray");class tx extends Va{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Xt(tx,"FillExtrusionCentroidArray");const gA=pn([{name:"a_pos",components:2,type:"Int16"}],4),Ol=pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Bn{constructor(t=[]){this.segments=t}_prepareSegment(t,r,s,l){let c=this.segments[this.segments.length-1];return t>Bn.MAX_VERTEX_ARRAY_LENGTH&&Q(`Max vertices per segment is ${Bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!c||c.vertexLength+t>Bn.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==l)&&(c={vertexOffset:r,primitiveOffset:s,vertexLength:0,primitiveLength:0},void 0!==l&&(c.sortKey=l),this.segments.push(c)),c}prepareSegment(t,r,s,l){return this._prepareSegment(t,r.length,s.length,l)}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,l){return new Bn([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function Fp(n,t){return 256*(n=Jt(Math.floor(n),0,255))+Jt(Math.floor(t),0,255)}Bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt(Bn,"SegmentVector");const ex=pn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),QE=pn([{name:"a_dash",components:4,type:"Uint16"}]);var ud={exports:{}},_A={exports:function(t,r){var s,l,c,d,h,p,m,_;for(l=t.length-(s=3&t.length),c=r,h=3432918353,p=461845907,_=0;_<l;)m=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24,++_,c=27492+(65535&(d=5*(65535&(c=(c^=m=(65535&(m=(m=(65535&m)*h+(((m>>>16)*h&65535)<<16)&4294967295)<<15|m>>>17))*p+(((m>>>16)*p&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(m=0,s){case 3:m^=(255&t.charCodeAt(_+2))<<16;case 2:m^=(255&t.charCodeAt(_+1))<<8;case 1:c^=m=(65535&(m=(m=(65535&(m^=255&t.charCodeAt(_)))*h+(((m>>>16)*h&65535)<<16)&4294967295)<<15|m>>>17))*p+(((m>>>16)*p&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}}.exports,nx={exports:{}};nx.exports=function(t,r){for(var s,l=t.length,c=r^l,d=0;l>=4;)s=1540483477*(65535&(s=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(s>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),l-=4,++d;switch(l){case 3:c^=(255&t.charCodeAt(d+2))<<16;case 2:c^=(255&t.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var ix=_A,tC=nx.exports;ud.exports=ix,ud.exports.murmur3=ix,ud.exports.murmur2=tC;var B_=hs(ud.exports);class Lp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,r,s,l){this.ids.push(Np(t)),this.positions.push(r,s,l)}eachPosition(t,r){const s=Np(t);let l=0,c=this.ids.length-1;for(;l<c;){const d=l+c>>1;this.ids[d]>=s?c=d:l=d+1}for(;this.ids[l]===s;)r(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(t,r){const s=new Float64Array(t.ids),l=new Uint32Array(t.positions);return yc(s,l,0,s.length-1),r&&(r.add(s.buffer),r.add(l.buffer)),{ids:s,positions:l}}static deserialize(t){const r=new Lp;let s;r.ids=t.ids,r.positions=t.positions;for(const l of r.ids)l!==s&&r.uniqueIds.push(l),s=l;return r.indexed=!0,r}}function Np(n){const t=+n;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:B_(String(n))}function yc(n,t,r,s){for(;r<s;){const l=n[r+s>>1];let c=r-1,d=s+1;for(;;){do{c++}while(n[c]<l);do{d--}while(n[d]>l);if(c>=d)break;V_(n,c,d),V_(t,3*c,3*d),V_(t,3*c+1,3*d+1),V_(t,3*c+2,3*d+2)}d-r<s-d?(yc(n,t,r,d),r=d+1):(yc(n,t,d+1,s),s=d)}}function V_(n,t,r){const s=n[t];n[t]=n[r],n[r]=s}Xt(Lp,"FeaturePositionMap");class kl{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}}class He extends kl{constructor(t){super(t),this.current=0}set(t,r,s){this.fetchUniformLocation(t,r)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Et extends kl{constructor(t){super(t),this.current=0}set(t,r,s){this.fetchUniformLocation(t,r)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Ze extends kl{constructor(t){super(t),this.current=[0,0]}set(t,r,s){this.fetchUniformLocation(t,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class me extends kl{constructor(t){super(t),this.current=[0,0,0]}set(t,r,s){this.fetchUniformLocation(t,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class bs extends kl{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,s){this.fetchUniformLocation(t,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class vr extends kl{constructor(t){super(t),this.current=Ne.transparent}set(t,r,s){this.fetchUniformLocation(t,r)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const rx=new Float32Array(16);class De extends kl{constructor(t){super(t),this.current=rx}set(t,r,s){if(this.fetchUniformLocation(t,r)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let l=1;l<16;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const eC=new Float32Array(9);class Th extends kl{constructor(t){super(t),this.current=eC}set(t,r,s){if(this.fetchUniformLocation(t,r))for(let l=0;l<9;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}const Dh=new Float32Array(4);class uu extends kl{constructor(t){super(t),this.current=Dh}set(t,r,s){if(this.fetchUniformLocation(t,r))for(let l=0;l<4;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}function du(n){return[Fp(255*n.r,255*n.g),Fp(255*n.b,255*n.a)]}class Ih{constructor(t,r,s){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(t,r,s,l,c){r.set(t,c,l.constantOr(this.value))}getBinding(t,r){return"color"===this.type?new vr(t):new Et(t)}}class hu{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,r,s,l,c){const d="u_pattern"===c||"u_dash"===c?this.pattern:"u_pixel_ratio"===c?this.pixelRatio:null;d&&r.set(t,c,d)}getBinding(t,r){return"u_pattern"===r||"u_dash"===r?new bs(t):new Et(t)}}class ws{constructor(t,r,s,l){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(c=>({name:`a_${c}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,s,l,c,d,h){const p=this.paintVertexArray.length,m=this.expression.evaluate(new wi(0,{brightness:d}),r,{},c,l,h);this.paintVertexArray.resize(t),this._setPaintValue(p,t,m)}updatePaintArray(t,r,s,l,c,d,h){const p=this.expression.evaluate({zoom:0,brightness:h},s,l,void 0,c);this._setPaintValue(t,r,p)}_setPaintValue(t,r,s){if("color"===this.type){const l=du(s);for(let c=t;c<r;c++)this.paintVertexArray.emplace(c,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fl{constructor(t,r,s,l,c,d){this.expression=t,this.uniformNames=r.map(h=>`u_${h}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,s,l,c,d,h){const p=this.expression.evaluate(new wi(this.zoom,{brightness:d}),r,{},c,l,h),m=this.expression.evaluate(new wi(this.zoom+1,{brightness:d}),r,{},c,l,h),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,p,m)}updatePaintArray(t,r,s,l,c,d,h){const p=this.expression.evaluate({zoom:this.zoom,brightness:h},s,l,void 0,c),m=this.expression.evaluate({zoom:this.zoom+1,brightness:h},s,l,void 0,c);this._setPaintValue(t,r,p,m)}_setPaintValue(t,r,s,l){if("color"===this.type){const c=du(s),d=du(l);for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,c[0],c[1],d[0],d[1])}else{for(let c=t;c<r;c++)this.paintVertexArray.emplace(c,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,s,l,c){const d=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=Jt(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);r.set(t,c,h)}getBinding(t,r){return new Et(t)}}class fu{constructor(t,r,s,l,c){this.expression=t,this.layerId=c,this.paintVertexAttributes=("array"===s?QE:ex).members;for(let d=0;d<r.length;++d);this.paintVertexArray=new l}populatePaintArray(t,r,s){const l=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,l,c,d,h){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(t,r,s,l){if(!l||!s)return;const c=l[s];if(!c)return;const{tl:d,br:h,pixelRatio:p}=c;for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,d[0],d[1],h[0],h[1],p)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ah{constructor(t,r,s=(()=>!0)){this.binders={},this._buffers=[];const l=[];for(const c in t.paint._values){const d=t.paint.get(c);if(!s(c)||!(d instanceof xs&&lu(d.property.specification)))continue;const h=bF(c,t.type),p=d.value,m=d.property.specification.type,_=!!d.property.useIntegerZoom,y="line-dasharray"===c||c.endsWith("pattern"),v="line-dasharray"===c&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==p.kind||v)if("source"===p.kind||v||y){const b=hd(c,m,"source");this.binders[c]=y?new fu(p,h,m,b,t.id):new ws(p,h,m,b),l.push(`/a_${c}`)}else{const b=hd(c,m,"composite");this.binders[c]=new Fl(p,h,m,_,r,b),l.push(`/z_${c}`)}else this.binders[c]=y?new hu(p.value,h):new Ih(p.value,h,m),l.push(`/u_${c}`)}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof ws||r instanceof Fl?r.maxValue:0}populatePaintArrays(t,r,s,l,c,d,h){for(const p in this.binders){const m=this.binders[p];(m instanceof ws||m instanceof Fl||m instanceof fu)&&m.populatePaintArray(t,r,s,l,c,d,h)}}setConstantPatternPositions(t){for(const r in this.binders){const s=this.binders[r];s instanceof hu&&s.setConstantPatternPositions(t)}}updatePaintArrays(t,r,s,l,c,d,h,p){let m=!1;const _=Object.keys(t),y=0!==_.length,v=y?_:r.uniqueIds;for(const b in this.binders){const E=this.binders[b];if((E instanceof ws||E instanceof Fl||E instanceof fu)&&(!0===E.expression.isStateDependent||!1===E.expression.isLightConstant)){const C=c.paint.get(b);E.expression=C.value;for(const S of v){const M=t[S.toString()];r.eachPosition(S,(D,R,P)=>{const I=l.feature(D);E.updatePaintArray(R,P,I,M,d,h,p)})}if(!y)for(const S of s.uniqueIds){const M=t[S.toString()];s.eachPosition(S,(D,R,P)=>{const I=l.feature(D);E.updatePaintArray(R,P,I,M,d,h,p)})}m=!0}}return m}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Ih||s instanceof hu)&&t.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof ws||s instanceof Fl||s instanceof fu)for(let l=0;l<s.paintVertexAttributes.length;l++)t.push(s.paintVertexAttributes[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Ih||s instanceof hu||s instanceof Fl)for(const l of s.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Ih||l instanceof hu||l instanceof Fl)for(const c of l.uniformNames)r.push({name:c,property:s,binding:l.getBinding(t,c)})}return r}setUniforms(t,r,s,l,c){for(const{name:d,property:h,binding:p}of s)this.binders[h].setUniform(t,p,c,l.get(h),d)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof ws||r instanceof Fl||r instanceof fu)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof ws||s instanceof Fl||s instanceof fu)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof ws||r instanceof Fl||r instanceof fu)&&r.destroy()}}}class dd{constructor(t,r,s=(()=>!0)){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new Ah(l,r,s);this.needsUpload=!1,this._featureMap=new Lp,this._featureMapWithoutIds=new Lp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,r,s,l,c,d,h,p){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,r,l,c,d,h,p);void 0!==r.id?this._featureMap.add(r.id,s,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,l,c,d){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,r,h,l,c,d||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const xF={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function bF(n,t){return xF[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}const wF={"line-pattern":{source:Rl,composite:Rl},"fill-pattern":{source:Rl,composite:Rl},"fill-extrusion-pattern":{source:Rl,composite:Rl},"line-dasharray":{source:D_,composite:D_}},EF={color:{source:cd,composite:Ci},number:{source:Op,composite:cd}};function hd(n,t,r){const s=wF[n];return s&&s[r]||EF[t][r]}Xt(Ih,"ConstantBinder"),Xt(hu,"PatternConstantBinder"),Xt(ws,"SourceExpressionBinder"),Xt(fu,"PatternCompositeBinder"),Xt(Fl,"CompositeExpressionBinder"),Xt(Ah,"ProgramConfiguration",{omit:["_buffers"]}),Xt(dd,"ProgramConfigurationSet");class qs{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof we?new we(t.lng,t.lat):we.convert(t),this}setSouthWest(t){return this._sw=t instanceof we?new we(t.lng,t.lat):we.convert(t),this}extend(t){const r=this._sw,s=this._ne;let l,c;if(t instanceof we)l=t,c=t;else{if(!(t instanceof qs))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(qs.convert(t)):this.extend(we.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(we.convert(t)):this;if(l=t._sw,c=t._ne,!l||!c)return this}return r||s?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),s.lng=Math.max(c.lng,s.lng),s.lat=Math.max(c.lat,s.lat)):(this._sw=new we(l.lng,l.lat),this._ne=new we(c.lng,c.lat)),this}getCenter(){return new we((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new we(this.getWest(),this.getNorth())}getSouthEast(){return new we(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:s}=we.convert(t);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&l}static convert(t){return!t||t instanceof qs?t:new qs(t)}}var Pr={},kn={};Object.defineProperty(kn,"__esModule",{value:!0}),kn.setMatrixArrayType=function(n){kn.ARRAY_TYPE=Rh=n},kn.toRadian=function(n){return n*fa},kn.equals=function(n,t){return Math.abs(n-t)<=nC*Math.max(1,Math.abs(n),Math.abs(t))},kn.RANDOM=kn.ARRAY_TYPE=kn.EPSILON=void 0;var nC=1e-6;kn.EPSILON=nC;var Rh=typeof Float32Array<"u"?Float32Array:Array;kn.ARRAY_TYPE=Rh;var yA=Math.random;kn.RANDOM=yA;var fa=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Jn={};function j_(n){return(j_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.create=function(){var n=new Ua.ARRAY_TYPE(4);return Ua.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},Jn.clone=function(n){var t=new Ua.ARRAY_TYPE(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},Jn.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},Jn.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},Jn.fromValues=function(n,t,r,s){var l=new Ua.ARRAY_TYPE(4);return l[0]=n,l[1]=t,l[2]=r,l[3]=s,l},Jn.set=function(n,t,r,s,l){return n[0]=t,n[1]=r,n[2]=s,n[3]=l,n},Jn.transpose=function(n,t){if(n===t){var r=t[1];n[1]=t[2],n[2]=r}else n[0]=t[0],n[1]=t[2],n[2]=t[1],n[3]=t[3];return n},Jn.invert=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=r*c-l*s;return d?(n[0]=c*(d=1/d),n[1]=-s*d,n[2]=-l*d,n[3]=r*d,n):null},Jn.adjoint=function(n,t){var r=t[0];return n[0]=t[3],n[1]=-t[1],n[2]=-t[2],n[3]=r,n},Jn.determinant=function(n){return n[0]*n[3]-n[2]*n[1]},Jn.multiply=iC,Jn.rotate=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=Math.sin(r),p=Math.cos(r);return n[0]=s*p+c*h,n[1]=l*p+d*h,n[2]=s*-h+c*p,n[3]=l*-h+d*p,n},Jn.scale=function(n,t,r){var s=t[1],l=t[2],c=t[3],d=r[0],h=r[1];return n[0]=t[0]*d,n[1]=s*d,n[2]=l*h,n[3]=c*h,n},Jn.fromRotation=function(n,t){var r=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=r,n[2]=-r,n[3]=s,n},Jn.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=t[1],n},Jn.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},Jn.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},Jn.LDU=function(n,t,r,s){return n[2]=s[2]/s[0],r[0]=s[0],r[1]=s[1],r[3]=s[3]-n[2]*r[1],[n,t,r]},Jn.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n},Jn.subtract=vA,Jn.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},Jn.equals=function(n,t){var r=n[0],s=n[1],l=n[2],c=n[3],d=t[0],h=t[1],p=t[2],m=t[3];return Math.abs(r-d)<=Ua.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-h)<=Ua.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(l-p)<=Ua.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(c-m)<=Ua.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))},Jn.multiplyScalar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},Jn.multiplyScalarAndAdd=function(n,t,r,s){return n[0]=t[0]+r[0]*s,n[1]=t[1]+r[1]*s,n[2]=t[2]+r[2]*s,n[3]=t[3]+r[3]*s,n},Jn.sub=Jn.mul=void 0;var Ua=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==j_(n)&&"function"!=typeof n)return{default:n};var r=Ph(void 0);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}(kn);function Ph(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Ph=function(s){return s?r:t})(n)}function iC(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=r[0],p=r[1],m=r[2],_=r[3];return n[0]=s*h+c*p,n[1]=l*h+d*p,n[2]=s*m+c*_,n[3]=l*m+d*_,n}function vA(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n}Jn.mul=iC,Jn.sub=vA;var Ri={};function rC(n){return(rC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.create=function(){var n=new Sr.ARRAY_TYPE(6);return Sr.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n},Ri.clone=function(n){var t=new Sr.ARRAY_TYPE(6);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},Ri.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},Ri.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},Ri.fromValues=function(n,t,r,s,l,c){var d=new Sr.ARRAY_TYPE(6);return d[0]=n,d[1]=t,d[2]=r,d[3]=s,d[4]=l,d[5]=c,d},Ri.set=function(n,t,r,s,l,c,d){return n[0]=t,n[1]=r,n[2]=s,n[3]=l,n[4]=c,n[5]=d,n},Ri.invert=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=t[4],h=t[5],p=r*c-s*l;return p?(n[0]=c*(p=1/p),n[1]=-s*p,n[2]=-l*p,n[3]=r*p,n[4]=(l*h-c*d)*p,n[5]=(s*d-r*h)*p,n):null},Ri.determinant=function(n){return n[0]*n[3]-n[1]*n[2]},Ri.multiply=fd,Ri.rotate=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=t[4],p=t[5],m=Math.sin(r),_=Math.cos(r);return n[0]=s*_+c*m,n[1]=l*_+d*m,n[2]=s*-m+c*_,n[3]=l*-m+d*_,n[4]=h,n[5]=p,n},Ri.scale=function(n,t,r){var s=t[1],l=t[2],c=t[3],d=t[4],h=t[5],p=r[0],m=r[1];return n[0]=t[0]*p,n[1]=s*p,n[2]=l*m,n[3]=c*m,n[4]=d,n[5]=h,n},Ri.translate=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=t[4],p=t[5],m=r[0],_=r[1];return n[0]=s,n[1]=l,n[2]=c,n[3]=d,n[4]=s*m+c*_+h,n[5]=l*m+d*_+p,n},Ri.fromRotation=function(n,t){var r=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=r,n[2]=-r,n[3]=s,n[4]=0,n[5]=0,n},Ri.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=t[1],n[4]=0,n[5]=0,n},Ri.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=t[0],n[5]=t[1],n},Ri.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"},Ri.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],1)},Ri.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n[4]=t[4]+r[4],n[5]=t[5]+r[5],n},Ri.subtract=xA,Ri.multiplyScalar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*r,n[5]=t[5]*r,n},Ri.multiplyScalarAndAdd=function(n,t,r,s){return n[0]=t[0]+r[0]*s,n[1]=t[1]+r[1]*s,n[2]=t[2]+r[2]*s,n[3]=t[3]+r[3]*s,n[4]=t[4]+r[4]*s,n[5]=t[5]+r[5]*s,n},Ri.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]},Ri.equals=function(n,t){var r=n[0],s=n[1],l=n[2],c=n[3],d=n[4],h=n[5],p=t[0],m=t[1],_=t[2],y=t[3],v=t[4],b=t[5];return Math.abs(r-p)<=Sr.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-m)<=Sr.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-_)<=Sr.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=Sr.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(d-v)<=Sr.EPSILON*Math.max(1,Math.abs(d),Math.abs(v))&&Math.abs(h-b)<=Sr.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))},Ri.sub=Ri.mul=void 0;var Sr=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==rC(n)&&"function"!=typeof n)return{default:n};var r=U_(void 0);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}(kn);function U_(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(U_=function(s){return s?r:t})(n)}function fd(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=t[4],p=t[5],m=r[0],_=r[1],y=r[2],v=r[3],b=r[4],E=r[5];return n[0]=s*m+c*_,n[1]=l*m+d*_,n[2]=s*y+c*v,n[3]=l*y+d*v,n[4]=s*b+c*E+h,n[5]=l*b+d*E+p,n}function xA(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n[4]=t[4]-r[4],n[5]=t[5]-r[5],n}Ri.mul=fd,Ri.sub=xA;var Vn={};function ox(n){return(ox="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.create=function(){var n=new Ws.ARRAY_TYPE(9);return Ws.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},Vn.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},Vn.clone=function(n){var t=new Ws.ARRAY_TYPE(9);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},Vn.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},Vn.fromValues=function(n,t,r,s,l,c,d,h,p){var m=new Ws.ARRAY_TYPE(9);return m[0]=n,m[1]=t,m[2]=r,m[3]=s,m[4]=l,m[5]=c,m[6]=d,m[7]=h,m[8]=p,m},Vn.set=function(n,t,r,s,l,c,d,h,p,m){return n[0]=t,n[1]=r,n[2]=s,n[3]=l,n[4]=c,n[5]=d,n[6]=h,n[7]=p,n[8]=m,n},Vn.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},Vn.transpose=function(n,t){if(n===t){var r=t[1],s=t[2],l=t[5];n[1]=t[3],n[2]=t[6],n[3]=r,n[5]=t[7],n[6]=s,n[7]=l}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n},Vn.invert=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8],y=_*d-h*m,v=-_*c+h*p,b=m*c-d*p,E=r*y+s*v+l*b;return E?(n[0]=y*(E=1/E),n[1]=(-_*s+l*m)*E,n[2]=(h*s-l*d)*E,n[3]=v*E,n[4]=(_*r-l*p)*E,n[5]=(-h*r+l*c)*E,n[6]=b*E,n[7]=(-m*r+s*p)*E,n[8]=(d*r-s*c)*E,n):null},Vn.adjoint=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8];return n[0]=d*_-h*m,n[1]=l*m-s*_,n[2]=s*h-l*d,n[3]=h*p-c*_,n[4]=r*_-l*p,n[5]=l*c-r*h,n[6]=c*m-d*p,n[7]=s*p-r*m,n[8]=r*d-s*c,n},Vn.determinant=function(n){var t=n[3],r=n[4],s=n[5],l=n[6],c=n[7],d=n[8];return n[0]*(d*r-s*c)+n[1]*(-d*t+s*l)+n[2]*(c*t-r*l)},Vn.multiply=sC,Vn.translate=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],v=r[0],b=r[1];return n[0]=s,n[1]=l,n[2]=c,n[3]=d,n[4]=h,n[5]=p,n[6]=v*s+b*d+m,n[7]=v*l+b*h+_,n[8]=v*c+b*p+y,n},Vn.rotate=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],v=Math.sin(r),b=Math.cos(r);return n[0]=b*s+v*d,n[1]=b*l+v*h,n[2]=b*c+v*p,n[3]=b*d-v*s,n[4]=b*h-v*l,n[5]=b*p-v*c,n[6]=m,n[7]=_,n[8]=y,n},Vn.scale=function(n,t,r){var s=r[0],l=r[1];return n[0]=s*t[0],n[1]=s*t[1],n[2]=s*t[2],n[3]=l*t[3],n[4]=l*t[4],n[5]=l*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},Vn.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=t[0],n[7]=t[1],n[8]=1,n},Vn.fromRotation=function(n,t){var r=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=r,n[2]=0,n[3]=-r,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},Vn.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=t[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},Vn.fromMat2d=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=0,n[3]=t[2],n[4]=t[3],n[5]=0,n[6]=t[4],n[7]=t[5],n[8]=1,n},Vn.fromQuat=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=r+r,h=s+s,p=l+l,m=r*d,_=s*d,y=s*h,v=l*d,b=l*h,E=l*p,C=c*d,S=c*h,M=c*p;return n[0]=1-y-E,n[3]=_-M,n[6]=v+S,n[1]=_+M,n[4]=1-m-E,n[7]=b-C,n[2]=v-S,n[5]=b+C,n[8]=1-m-y,n},Vn.normalFromMat4=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8],y=t[9],v=t[10],b=t[11],E=t[12],C=t[13],S=t[14],M=t[15],D=r*h-s*d,R=r*p-l*d,P=r*m-c*d,I=s*p-l*h,O=s*m-c*h,F=l*m-c*p,L=_*C-y*E,N=_*S-v*E,z=_*M-b*E,U=y*S-v*C,V=y*M-b*C,H=v*M-b*S,j=D*H-R*V+P*U+I*z-O*N+F*L;return j?(n[0]=(h*H-p*V+m*U)*(j=1/j),n[1]=(p*z-d*H-m*N)*j,n[2]=(d*V-h*z+m*L)*j,n[3]=(l*V-s*H-c*U)*j,n[4]=(r*H-l*z+c*N)*j,n[5]=(s*z-r*V-c*L)*j,n[6]=(C*F-S*O+M*I)*j,n[7]=(S*P-E*F-M*R)*j,n[8]=(E*O-C*P+M*D)*j,n):null},Vn.projection=function(n,t,r){return n[0]=2/t,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/r,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n},Vn.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"},Vn.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},Vn.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n[4]=t[4]+r[4],n[5]=t[5]+r[5],n[6]=t[6]+r[6],n[7]=t[7]+r[7],n[8]=t[8]+r[8],n},Vn.subtract=aC,Vn.multiplyScalar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*r,n},Vn.multiplyScalarAndAdd=function(n,t,r,s){return n[0]=t[0]+r[0]*s,n[1]=t[1]+r[1]*s,n[2]=t[2]+r[2]*s,n[3]=t[3]+r[3]*s,n[4]=t[4]+r[4]*s,n[5]=t[5]+r[5]*s,n[6]=t[6]+r[6]*s,n[7]=t[7]+r[7]*s,n[8]=t[8]+r[8]*s,n},Vn.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]},Vn.equals=function(n,t){var r=n[0],s=n[1],l=n[2],c=n[3],d=n[4],h=n[5],p=n[6],m=n[7],_=n[8],y=t[0],v=t[1],b=t[2],E=t[3],C=t[4],S=t[5],M=t[6],D=t[7],R=t[8];return Math.abs(r-y)<=Ws.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(s-v)<=Ws.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(l-b)<=Ws.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-E)<=Ws.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(d-C)<=Ws.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(h-S)<=Ws.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(p-M)<=Ws.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(m-D)<=Ws.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(_-R)<=Ws.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},Vn.sub=Vn.mul=void 0;var Ws=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==ox(n)&&"function"!=typeof n)return{default:n};var r=oC(void 0);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}(kn);function oC(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(oC=function(s){return s?r:t})(n)}function sC(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],v=r[0],b=r[1],E=r[2],C=r[3],S=r[4],M=r[5],D=r[6],R=r[7],P=r[8];return n[0]=v*s+b*d+E*m,n[1]=v*l+b*h+E*_,n[2]=v*c+b*p+E*y,n[3]=C*s+S*d+M*m,n[4]=C*l+S*h+M*_,n[5]=C*c+S*p+M*y,n[6]=D*s+R*d+P*m,n[7]=D*l+R*h+P*_,n[8]=D*c+R*p+P*y,n}function aC(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n[4]=t[4]-r[4],n[5]=t[5]-r[5],n[6]=t[6]-r[6],n[7]=t[7]-r[7],n[8]=t[8]-r[8],n}Vn.mul=sC,Vn.sub=aC;var ke={};function zp(n){return(zp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(ke,"__esModule",{value:!0}),ke.create=function(){var n=new Mi.ARRAY_TYPE(16);return Mi.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},ke.clone=function(n){var t=new Mi.ARRAY_TYPE(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},ke.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},ke.fromValues=function(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C){var S=new Mi.ARRAY_TYPE(16);return S[0]=n,S[1]=t,S[2]=r,S[3]=s,S[4]=l,S[5]=c,S[6]=d,S[7]=h,S[8]=p,S[9]=m,S[10]=_,S[11]=y,S[12]=v,S[13]=b,S[14]=E,S[15]=C,S},ke.set=function(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S){return n[0]=t,n[1]=r,n[2]=s,n[3]=l,n[4]=c,n[5]=d,n[6]=h,n[7]=p,n[8]=m,n[9]=_,n[10]=y,n[11]=v,n[12]=b,n[13]=E,n[14]=C,n[15]=S,n},ke.identity=pu,ke.transpose=function(n,t){if(n===t){var r=t[1],s=t[2],l=t[3],c=t[6],d=t[7],h=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=r,n[6]=t[9],n[7]=t[13],n[8]=s,n[9]=c,n[11]=t[14],n[12]=l,n[13]=d,n[14]=h}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n},ke.invert=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8],y=t[9],v=t[10],b=t[11],E=t[12],C=t[13],S=t[14],M=t[15],D=r*h-s*d,R=r*p-l*d,P=r*m-c*d,I=s*p-l*h,O=s*m-c*h,F=l*m-c*p,L=_*C-y*E,N=_*S-v*E,z=_*M-b*E,U=y*S-v*C,V=y*M-b*C,H=v*M-b*S,j=D*H-R*V+P*U+I*z-O*N+F*L;return j?(n[0]=(h*H-p*V+m*U)*(j=1/j),n[1]=(l*V-s*H-c*U)*j,n[2]=(C*F-S*O+M*I)*j,n[3]=(v*O-y*F-b*I)*j,n[4]=(p*z-d*H-m*N)*j,n[5]=(r*H-l*z+c*N)*j,n[6]=(S*P-E*F-M*R)*j,n[7]=(_*F-v*P+b*R)*j,n[8]=(d*V-h*z+m*L)*j,n[9]=(s*z-r*V-c*L)*j,n[10]=(E*O-C*P+M*D)*j,n[11]=(y*P-_*O-b*D)*j,n[12]=(h*N-d*U-p*L)*j,n[13]=(r*U-s*N+l*L)*j,n[14]=(C*R-E*I-S*D)*j,n[15]=(_*I-y*R+v*D)*j,n):null},ke.adjoint=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8],y=t[9],v=t[10],b=t[11],E=t[12],C=t[13],S=t[14],M=t[15];return n[0]=h*(v*M-b*S)-y*(p*M-m*S)+C*(p*b-m*v),n[1]=-(s*(v*M-b*S)-y*(l*M-c*S)+C*(l*b-c*v)),n[2]=s*(p*M-m*S)-h*(l*M-c*S)+C*(l*m-c*p),n[3]=-(s*(p*b-m*v)-h*(l*b-c*v)+y*(l*m-c*p)),n[4]=-(d*(v*M-b*S)-_*(p*M-m*S)+E*(p*b-m*v)),n[5]=r*(v*M-b*S)-_*(l*M-c*S)+E*(l*b-c*v),n[6]=-(r*(p*M-m*S)-d*(l*M-c*S)+E*(l*m-c*p)),n[7]=r*(p*b-m*v)-d*(l*b-c*v)+_*(l*m-c*p),n[8]=d*(y*M-b*C)-_*(h*M-m*C)+E*(h*b-m*y),n[9]=-(r*(y*M-b*C)-_*(s*M-c*C)+E*(s*b-c*y)),n[10]=r*(h*M-m*C)-d*(s*M-c*C)+E*(s*m-c*h),n[11]=-(r*(h*b-m*y)-d*(s*b-c*y)+_*(s*m-c*h)),n[12]=-(d*(y*S-v*C)-_*(h*S-p*C)+E*(h*v-p*y)),n[13]=r*(y*S-v*C)-_*(s*S-l*C)+E*(s*v-l*y),n[14]=-(r*(h*S-p*C)-d*(s*S-l*C)+E*(s*p-l*h)),n[15]=r*(h*v-p*y)-d*(s*v-l*y)+_*(s*p-l*h),n},ke.determinant=function(n){var t=n[0],r=n[1],s=n[2],l=n[3],c=n[4],d=n[5],h=n[6],p=n[7],m=n[8],_=n[9],y=n[10],v=n[11],b=n[12],E=n[13],C=n[14],S=n[15];return(t*d-r*c)*(y*S-v*C)-(t*h-s*c)*(_*S-v*E)+(t*p-l*c)*(_*C-y*E)+(r*h-s*d)*(m*S-v*b)-(r*p-l*d)*(m*C-y*b)+(s*p-l*h)*(m*E-_*b)},ke.multiply=cC,ke.translate=function(n,t,r){var s,l,c,d,h,p,m,_,y,v,b,E,C=r[0],S=r[1],M=r[2];return t===n?(n[12]=t[0]*C+t[4]*S+t[8]*M+t[12],n[13]=t[1]*C+t[5]*S+t[9]*M+t[13],n[14]=t[2]*C+t[6]*S+t[10]*M+t[14],n[15]=t[3]*C+t[7]*S+t[11]*M+t[15]):(l=t[1],c=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],v=t[9],b=t[10],E=t[11],n[0]=s=t[0],n[1]=l,n[2]=c,n[3]=d,n[4]=h,n[5]=p,n[6]=m,n[7]=_,n[8]=y,n[9]=v,n[10]=b,n[11]=E,n[12]=s*C+h*S+y*M+t[12],n[13]=l*C+p*S+v*M+t[13],n[14]=c*C+m*S+b*M+t[14],n[15]=d*C+_*S+E*M+t[15]),n},ke.scale=function(n,t,r){var s=r[0],l=r[1],c=r[2];return n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n[3]=t[3]*s,n[4]=t[4]*l,n[5]=t[5]*l,n[6]=t[6]*l,n[7]=t[7]*l,n[8]=t[8]*c,n[9]=t[9]*c,n[10]=t[10]*c,n[11]=t[11]*c,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},ke.rotate=function(n,t,r,s){var l,c,d,h,p,m,_,y,v,b,E,C,S,M,D,R,P,I,O,F,L,N,z,U,V=s[0],H=s[1],j=s[2],Z=Math.hypot(V,H,j);return Z<Mi.EPSILON?null:(V*=Z=1/Z,H*=Z,j*=Z,l=Math.sin(r),c=Math.cos(r),p=t[1],m=t[2],_=t[3],v=t[5],b=t[6],E=t[7],S=t[9],M=t[10],D=t[11],O=V*H*(d=1-c)-j*l,F=H*H*d+c,L=j*H*d+V*l,N=V*j*d+H*l,z=H*j*d-V*l,U=j*j*d+c,n[0]=(h=t[0])*(R=V*V*d+c)+(y=t[4])*(P=H*V*d+j*l)+(C=t[8])*(I=j*V*d-H*l),n[1]=p*R+v*P+S*I,n[2]=m*R+b*P+M*I,n[3]=_*R+E*P+D*I,n[4]=h*O+y*F+C*L,n[5]=p*O+v*F+S*L,n[6]=m*O+b*F+M*L,n[7]=_*O+E*F+D*L,n[8]=h*N+y*z+C*U,n[9]=p*N+v*z+S*U,n[10]=m*N+b*z+M*U,n[11]=_*N+E*z+D*U,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)},ke.rotateX=function(n,t,r){var s=Math.sin(r),l=Math.cos(r),c=t[4],d=t[5],h=t[6],p=t[7],m=t[8],_=t[9],y=t[10],v=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=c*l+m*s,n[5]=d*l+_*s,n[6]=h*l+y*s,n[7]=p*l+v*s,n[8]=m*l-c*s,n[9]=_*l-d*s,n[10]=y*l-h*s,n[11]=v*l-p*s,n},ke.rotateY=function(n,t,r){var s=Math.sin(r),l=Math.cos(r),c=t[0],d=t[1],h=t[2],p=t[3],m=t[8],_=t[9],y=t[10],v=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=c*l-m*s,n[1]=d*l-_*s,n[2]=h*l-y*s,n[3]=p*l-v*s,n[8]=c*s+m*l,n[9]=d*s+_*l,n[10]=h*s+y*l,n[11]=p*s+v*l,n},ke.rotateZ=function(n,t,r){var s=Math.sin(r),l=Math.cos(r),c=t[0],d=t[1],h=t[2],p=t[3],m=t[4],_=t[5],y=t[6],v=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=c*l+m*s,n[1]=d*l+_*s,n[2]=h*l+y*s,n[3]=p*l+v*s,n[4]=m*l-c*s,n[5]=_*l-d*s,n[6]=y*l-h*s,n[7]=v*l-p*s,n},ke.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},ke.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.fromRotation=function(n,t,r){var s,l,c,d=r[0],h=r[1],p=r[2],m=Math.hypot(d,h,p);return m<Mi.EPSILON?null:(d*=m=1/m,h*=m,p*=m,s=Math.sin(t),l=Math.cos(t),n[0]=d*d*(c=1-l)+l,n[1]=h*d*c+p*s,n[2]=p*d*c-h*s,n[3]=0,n[4]=d*h*c-p*s,n[5]=h*h*c+l,n[6]=p*h*c+d*s,n[7]=0,n[8]=d*p*c+h*s,n[9]=h*p*c-d*s,n[10]=p*p*c+l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)},ke.fromXRotation=function(n,t){var r=Math.sin(t),s=Math.cos(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=r,n[7]=0,n[8]=0,n[9]=-r,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.fromYRotation=function(n,t){var r=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=0,n[2]=-r,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=r,n[9]=0,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.fromZRotation=function(n,t){var r=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=r,n[2]=0,n[3]=0,n[4]=-r,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.fromRotationTranslation=Oh,ke.fromQuat2=function(n,t){var r=new Mi.ARRAY_TYPE(3),s=-t[0],l=-t[1],c=-t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=s*s+l*l+c*c+d*d;return y>0?(r[0]=2*(h*d+_*s+p*c-m*l)/y,r[1]=2*(p*d+_*l+m*s-h*c)/y,r[2]=2*(m*d+_*c+h*l-p*s)/y):(r[0]=2*(h*d+_*s+p*c-m*l),r[1]=2*(p*d+_*l+m*s-h*c),r[2]=2*(m*d+_*c+h*l-p*s)),Oh(n,t,r),n},ke.getTranslation=function(n,t){return n[0]=t[12],n[1]=t[13],n[2]=t[14],n},ke.getScaling=uC,ke.getRotation=function(n,t){var r=new Mi.ARRAY_TYPE(3);uC(r,t);var s=1/r[0],l=1/r[1],c=1/r[2],d=t[0]*s,h=t[1]*l,p=t[2]*c,m=t[4]*s,_=t[5]*l,y=t[6]*c,v=t[8]*s,b=t[9]*l,E=t[10]*c,C=d+_+E,S=0;return C>0?(S=2*Math.sqrt(C+1),n[3]=.25*S,n[0]=(y-b)/S,n[1]=(v-p)/S,n[2]=(h-m)/S):d>_&&d>E?(S=2*Math.sqrt(1+d-_-E),n[3]=(y-b)/S,n[0]=.25*S,n[1]=(h+m)/S,n[2]=(v+p)/S):_>E?(S=2*Math.sqrt(1+_-d-E),n[3]=(v-p)/S,n[0]=(h+m)/S,n[1]=.25*S,n[2]=(y+b)/S):(S=2*Math.sqrt(1+E-d-_),n[3]=(h-m)/S,n[0]=(v+p)/S,n[1]=(y+b)/S,n[2]=.25*S),n},ke.fromRotationTranslationScale=function(n,t,r,s){var l=t[0],c=t[1],d=t[2],h=t[3],p=l+l,m=c+c,_=d+d,y=l*p,v=l*m,b=l*_,E=c*m,C=c*_,S=d*_,M=h*p,D=h*m,R=h*_,P=s[0],I=s[1],O=s[2];return n[0]=(1-(E+S))*P,n[1]=(v+R)*P,n[2]=(b-D)*P,n[3]=0,n[4]=(v-R)*I,n[5]=(1-(y+S))*I,n[6]=(C+M)*I,n[7]=0,n[8]=(b+D)*O,n[9]=(C-M)*O,n[10]=(1-(y+E))*O,n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n},ke.fromRotationTranslationScaleOrigin=function(n,t,r,s,l){var c=t[0],d=t[1],h=t[2],p=t[3],m=c+c,_=d+d,y=h+h,v=c*m,b=c*_,E=c*y,C=d*_,S=d*y,M=h*y,D=p*m,R=p*_,P=p*y,I=s[0],O=s[1],F=s[2],L=l[0],N=l[1],z=l[2],U=(1-(C+M))*I,V=(b+P)*I,H=(E-R)*I,j=(b-P)*O,Z=(1-(v+M))*O,tt=(S+D)*O,it=(E+R)*F,X=(S-D)*F,Y=(1-(v+C))*F;return n[0]=U,n[1]=V,n[2]=H,n[3]=0,n[4]=j,n[5]=Z,n[6]=tt,n[7]=0,n[8]=it,n[9]=X,n[10]=Y,n[11]=0,n[12]=r[0]+L-(U*L+j*N+it*z),n[13]=r[1]+N-(V*L+Z*N+X*z),n[14]=r[2]+z-(H*L+tt*N+Y*z),n[15]=1,n},ke.fromQuat=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=r+r,h=s+s,p=l+l,m=r*d,_=s*d,y=s*h,v=l*d,b=l*h,E=l*p,C=c*d,S=c*h,M=c*p;return n[0]=1-y-E,n[1]=_+M,n[2]=v-S,n[3]=0,n[4]=_-M,n[5]=1-m-E,n[6]=b+C,n[7]=0,n[8]=v+S,n[9]=b-C,n[10]=1-m-y,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.frustum=function(n,t,r,s,l,c,d){var h=1/(r-t),p=1/(l-s),m=1/(c-d);return n[0]=2*c*h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*c*p,n[6]=0,n[7]=0,n[8]=(r+t)*h,n[9]=(l+s)*p,n[10]=(d+c)*m,n[11]=-1,n[12]=0,n[13]=0,n[14]=d*c*2*m,n[15]=0,n},ke.perspectiveNO=sx,ke.perspectiveZO=function(n,t,r,s,l){var c,d=1/Math.tan(t/2);return n[0]=d/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=l&&l!==1/0?(n[10]=l*(c=1/(s-l)),n[14]=l*s*c):(n[10]=-1,n[14]=-s),n},ke.perspectiveFromFieldOfView=function(n,t,r,s){var l=Math.tan(t.upDegrees*Math.PI/180),c=Math.tan(t.downDegrees*Math.PI/180),d=Math.tan(t.leftDegrees*Math.PI/180),h=Math.tan(t.rightDegrees*Math.PI/180),p=2/(d+h),m=2/(l+c);return n[0]=p,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=-(d-h)*p*.5,n[9]=(l-c)*m*.5,n[10]=s/(r-s),n[11]=-1,n[12]=0,n[13]=0,n[14]=s*r/(r-s),n[15]=0,n},ke.orthoNO=$_,ke.orthoZO=function(n,t,r,s,l,c,d){var h=1/(t-r),p=1/(s-l),m=1/(c-d);return n[0]=-2*h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=m,n[11]=0,n[12]=(t+r)*h,n[13]=(l+s)*p,n[14]=c*m,n[15]=1,n},ke.lookAt=function(n,t,r,s){var l,c,d,h,p,m,_,y,v,b,E=t[0],C=t[1],S=t[2],M=s[0],D=s[1],R=s[2],P=r[0],I=r[1],O=r[2];return Math.abs(E-P)<Mi.EPSILON&&Math.abs(C-I)<Mi.EPSILON&&Math.abs(S-O)<Mi.EPSILON?pu(n):(_=E-P,y=C-I,v=S-O,l=D*(v*=b=1/Math.hypot(_,y,v))-R*(y*=b),c=R*(_*=b)-M*v,d=M*y-D*_,(b=Math.hypot(l,c,d))?(l*=b=1/b,c*=b,d*=b):(l=0,c=0,d=0),h=y*d-v*c,p=v*l-_*d,m=_*c-y*l,(b=Math.hypot(h,p,m))?(h*=b=1/b,p*=b,m*=b):(h=0,p=0,m=0),n[0]=l,n[1]=h,n[2]=_,n[3]=0,n[4]=c,n[5]=p,n[6]=y,n[7]=0,n[8]=d,n[9]=m,n[10]=v,n[11]=0,n[12]=-(l*E+c*C+d*S),n[13]=-(h*E+p*C+m*S),n[14]=-(_*E+y*C+v*S),n[15]=1,n)},ke.targetTo=function(n,t,r,s){var l=t[0],c=t[1],d=t[2],h=s[0],p=s[1],m=s[2],_=l-r[0],y=c-r[1],v=d-r[2],b=_*_+y*y+v*v;b>0&&(_*=b=1/Math.sqrt(b),y*=b,v*=b);var E=p*v-m*y,C=m*_-h*v,S=h*y-p*_;return(b=E*E+C*C+S*S)>0&&(E*=b=1/Math.sqrt(b),C*=b,S*=b),n[0]=E,n[1]=C,n[2]=S,n[3]=0,n[4]=y*S-v*C,n[5]=v*E-_*S,n[6]=_*C-y*E,n[7]=0,n[8]=_,n[9]=y,n[10]=v,n[11]=0,n[12]=l,n[13]=c,n[14]=d,n[15]=1,n},ke.str=function(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"},ke.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])},ke.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n[4]=t[4]+r[4],n[5]=t[5]+r[5],n[6]=t[6]+r[6],n[7]=t[7]+r[7],n[8]=t[8]+r[8],n[9]=t[9]+r[9],n[10]=t[10]+r[10],n[11]=t[11]+r[11],n[12]=t[12]+r[12],n[13]=t[13]+r[13],n[14]=t[14]+r[14],n[15]=t[15]+r[15],n},ke.subtract=Bp,ke.multiplyScalar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*r,n[9]=t[9]*r,n[10]=t[10]*r,n[11]=t[11]*r,n[12]=t[12]*r,n[13]=t[13]*r,n[14]=t[14]*r,n[15]=t[15]*r,n},ke.multiplyScalarAndAdd=function(n,t,r,s){return n[0]=t[0]+r[0]*s,n[1]=t[1]+r[1]*s,n[2]=t[2]+r[2]*s,n[3]=t[3]+r[3]*s,n[4]=t[4]+r[4]*s,n[5]=t[5]+r[5]*s,n[6]=t[6]+r[6]*s,n[7]=t[7]+r[7]*s,n[8]=t[8]+r[8]*s,n[9]=t[9]+r[9]*s,n[10]=t[10]+r[10]*s,n[11]=t[11]+r[11]*s,n[12]=t[12]+r[12]*s,n[13]=t[13]+r[13]*s,n[14]=t[14]+r[14]*s,n[15]=t[15]+r[15]*s,n},ke.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},ke.equals=function(n,t){var r=n[0],s=n[1],l=n[2],c=n[3],d=n[4],h=n[5],p=n[6],m=n[7],_=n[8],y=n[9],v=n[10],b=n[11],E=n[12],C=n[13],S=n[14],M=n[15],D=t[0],R=t[1],P=t[2],I=t[3],O=t[4],F=t[5],L=t[6],N=t[7],z=t[8],U=t[9],V=t[10],H=t[11],j=t[12],Z=t[13],tt=t[14],it=t[15];return Math.abs(r-D)<=Mi.EPSILON*Math.max(1,Math.abs(r),Math.abs(D))&&Math.abs(s-R)<=Mi.EPSILON*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(l-P)<=Mi.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(c-I)<=Mi.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-O)<=Mi.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(h-F)<=Mi.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(p-L)<=Mi.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(m-N)<=Mi.EPSILON*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(_-z)<=Mi.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(y-U)<=Mi.EPSILON*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(v-V)<=Mi.EPSILON*Math.max(1,Math.abs(v),Math.abs(V))&&Math.abs(b-H)<=Mi.EPSILON*Math.max(1,Math.abs(b),Math.abs(H))&&Math.abs(E-j)<=Mi.EPSILON*Math.max(1,Math.abs(E),Math.abs(j))&&Math.abs(C-Z)<=Mi.EPSILON*Math.max(1,Math.abs(C),Math.abs(Z))&&Math.abs(S-tt)<=Mi.EPSILON*Math.max(1,Math.abs(S),Math.abs(tt))&&Math.abs(M-it)<=Mi.EPSILON*Math.max(1,Math.abs(M),Math.abs(it))},ke.sub=ke.mul=ke.ortho=ke.perspective=void 0;var Mi=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==zp(n)&&"function"!=typeof n)return{default:n};var r=lC(void 0);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}(kn);function lC(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(lC=function(s){return s?r:t})(n)}function pu(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function cC(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],v=t[9],b=t[10],E=t[11],C=t[12],S=t[13],M=t[14],D=t[15],R=r[0],P=r[1],I=r[2],O=r[3];return n[0]=R*s+P*h+I*y+O*C,n[1]=R*l+P*p+I*v+O*S,n[2]=R*c+P*m+I*b+O*M,n[3]=R*d+P*_+I*E+O*D,n[4]=(R=r[4])*s+(P=r[5])*h+(I=r[6])*y+(O=r[7])*C,n[5]=R*l+P*p+I*v+O*S,n[6]=R*c+P*m+I*b+O*M,n[7]=R*d+P*_+I*E+O*D,n[8]=(R=r[8])*s+(P=r[9])*h+(I=r[10])*y+(O=r[11])*C,n[9]=R*l+P*p+I*v+O*S,n[10]=R*c+P*m+I*b+O*M,n[11]=R*d+P*_+I*E+O*D,n[12]=(R=r[12])*s+(P=r[13])*h+(I=r[14])*y+(O=r[15])*C,n[13]=R*l+P*p+I*v+O*S,n[14]=R*c+P*m+I*b+O*M,n[15]=R*d+P*_+I*E+O*D,n}function Oh(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=s+s,p=l+l,m=c+c,_=s*h,y=s*p,v=s*m,b=l*p,E=l*m,C=c*m,S=d*h,M=d*p,D=d*m;return n[0]=1-(b+C),n[1]=y+D,n[2]=v-M,n[3]=0,n[4]=y-D,n[5]=1-(_+C),n[6]=E+S,n[7]=0,n[8]=v+M,n[9]=E-S,n[10]=1-(_+b),n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n}function uC(n,t){var r=t[4],s=t[5],l=t[6],c=t[8],d=t[9],h=t[10];return n[0]=Math.hypot(t[0],t[1],t[2]),n[1]=Math.hypot(r,s,l),n[2]=Math.hypot(c,d,h),n}function sx(n,t,r,s,l){var c,d=1/Math.tan(t/2);return n[0]=d/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=l&&l!==1/0?(n[10]=(l+s)*(c=1/(s-l)),n[14]=2*l*s*c):(n[10]=-1,n[14]=-2*s),n}function $_(n,t,r,s,l,c,d){var h=1/(t-r),p=1/(s-l),m=1/(c-d);return n[0]=-2*h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*m,n[11]=0,n[12]=(t+r)*h,n[13]=(l+s)*p,n[14]=(d+c)*m,n[15]=1,n}function Bp(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n[4]=t[4]-r[4],n[5]=t[5]-r[5],n[6]=t[6]-r[6],n[7]=t[7]-r[7],n[8]=t[8]-r[8],n[9]=t[9]-r[9],n[10]=t[10]-r[10],n[11]=t[11]-r[11],n[12]=t[12]-r[12],n[13]=t[13]-r[13],n[14]=t[14]-r[14],n[15]=t[15]-r[15],n}ke.perspective=sx,ke.ortho=$_,ke.mul=cC,ke.sub=Bp;var Ce={},Ae={};function ax(n){return(ax="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.create=dC,Ae.clone=function(n){var t=new Es.ARRAY_TYPE(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},Ae.length=bA,Ae.fromValues=function(n,t,r){var s=new Es.ARRAY_TYPE(3);return s[0]=n,s[1]=t,s[2]=r,s},Ae.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},Ae.set=function(n,t,r,s){return n[0]=t,n[1]=r,n[2]=s,n},Ae.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n},Ae.subtract=lx,Ae.multiply=hC,Ae.divide=wA,Ae.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n},Ae.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n},Ae.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n[2]=Math.min(t[2],r[2]),n},Ae.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n[2]=Math.max(t[2],r[2]),n},Ae.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n},Ae.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n},Ae.scaleAndAdd=function(n,t,r,s){return n[0]=t[0]+r[0]*s,n[1]=t[1]+r[1]*s,n[2]=t[2]+r[2]*s,n},Ae.distance=fC,Ae.squaredDistance=pC,Ae.squaredLength=mC,Ae.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n},Ae.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n},Ae.normalize=function(n,t){var r=t[0],s=t[1],l=t[2],c=r*r+s*s+l*l;return c>0&&(c=1/Math.sqrt(c)),n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n},Ae.dot=Vp,Ae.cross=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=r[0],h=r[1],p=r[2];return n[0]=l*p-c*h,n[1]=c*d-s*p,n[2]=s*h-l*d,n},Ae.lerp=function(n,t,r,s){var l=t[0],c=t[1],d=t[2];return n[0]=l+s*(r[0]-l),n[1]=c+s*(r[1]-c),n[2]=d+s*(r[2]-d),n},Ae.hermite=function(n,t,r,s,l,c){var d=c*c,h=d*(2*c-3)+1,p=d*(c-2)+c,m=d*(c-1),_=d*(3-2*c);return n[0]=t[0]*h+r[0]*p+s[0]*m+l[0]*_,n[1]=t[1]*h+r[1]*p+s[1]*m+l[1]*_,n[2]=t[2]*h+r[2]*p+s[2]*m+l[2]*_,n},Ae.bezier=function(n,t,r,s,l,c){var d=1-c,h=d*d,p=c*c,m=h*d,_=3*c*h,y=3*p*d,v=p*c;return n[0]=t[0]*m+r[0]*_+s[0]*y+l[0]*v,n[1]=t[1]*m+r[1]*_+s[1]*y+l[1]*v,n[2]=t[2]*m+r[2]*_+s[2]*y+l[2]*v,n},Ae.random=function(n,t){t=t||1;var r=2*Es.RANDOM()*Math.PI,s=2*Es.RANDOM()-1,l=Math.sqrt(1-s*s)*t;return n[0]=Math.cos(r)*l,n[1]=Math.sin(r)*l,n[2]=s*t,n},Ae.transformMat4=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=r[3]*s+r[7]*l+r[11]*c+r[15];return n[0]=(r[0]*s+r[4]*l+r[8]*c+r[12])/(d=d||1),n[1]=(r[1]*s+r[5]*l+r[9]*c+r[13])/d,n[2]=(r[2]*s+r[6]*l+r[10]*c+r[14])/d,n},Ae.transformMat3=function(n,t,r){var s=t[0],l=t[1],c=t[2];return n[0]=s*r[0]+l*r[3]+c*r[6],n[1]=s*r[1]+l*r[4]+c*r[7],n[2]=s*r[2]+l*r[5]+c*r[8],n},Ae.transformQuat=function(n,t,r){var s=r[0],l=r[1],c=r[2],d=t[0],h=t[1],p=t[2],m=l*p-c*h,_=c*d-s*p,y=s*h-l*d,v=l*y-c*_,b=c*m-s*y,E=s*_-l*m,C=2*r[3];return _*=C,y*=C,b*=2,E*=2,n[0]=d+(m*=C)+(v*=2),n[1]=h+_+b,n[2]=p+y+E,n},Ae.rotateX=function(n,t,r,s){var l=[],c=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],c[0]=l[0],c[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),c[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),n[0]=c[0]+r[0],n[1]=c[1]+r[1],n[2]=c[2]+r[2],n},Ae.rotateY=function(n,t,r,s){var l=[],c=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],c[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),c[1]=l[1],c[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),n[0]=c[0]+r[0],n[1]=c[1]+r[1],n[2]=c[2]+r[2],n},Ae.rotateZ=function(n,t,r,s){var l=[],c=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],c[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),c[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),c[2]=l[2],n[0]=c[0]+r[0],n[1]=c[1]+r[1],n[2]=c[2]+r[2],n},Ae.angle=function(n,t){var r=n[0],s=n[1],l=n[2],c=t[0],d=t[1],h=t[2],p=Math.sqrt(r*r+s*s+l*l)*Math.sqrt(c*c+d*d+h*h),m=p&&Vp(n,t)/p;return Math.acos(Math.min(Math.max(m,-1),1))},Ae.zero=function(n){return n[0]=0,n[1]=0,n[2]=0,n},Ae.str=function(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"},Ae.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]},Ae.equals=function(n,t){var r=n[0],s=n[1],l=n[2],c=t[0],d=t[1],h=t[2];return Math.abs(r-c)<=Es.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-d)<=Es.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(l-h)<=Es.EPSILON*Math.max(1,Math.abs(l),Math.abs(h))},Ae.forEach=Ae.sqrLen=Ae.len=Ae.sqrDist=Ae.dist=Ae.div=Ae.mul=Ae.sub=void 0;var Es=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==ax(n)&&"function"!=typeof n)return{default:n};var r=kh(void 0);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}(kn);function kh(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(kh=function(s){return s?r:t})(n)}function dC(){var n=new Es.ARRAY_TYPE(3);return Es.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function bA(n){return Math.hypot(n[0],n[1],n[2])}function lx(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n}function hC(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n}function wA(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n}function fC(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2])}function pC(n,t){var r=t[0]-n[0],s=t[1]-n[1],l=t[2]-n[2];return r*r+s*s+l*l}function mC(n){var t=n[0],r=n[1],s=n[2];return t*t+r*r+s*s}function Vp(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}Ae.sub=lx,Ae.mul=hC,Ae.div=wA,Ae.dist=fC,Ae.sqrDist=pC,Ae.len=bA,Ae.sqrLen=mC;var Ll,EA=(Ll=dC(),function(n,t,r,s,l,c){var d,h;for(t||(t=3),r||(r=0),h=s?Math.min(s*t+r,n.length):n.length,d=r;d<h;d+=t)Ll[0]=n[d],Ll[1]=n[d+1],Ll[2]=n[d+2],l(Ll,Ll,c),n[d]=Ll[0],n[d+1]=Ll[1],n[d+2]=Ll[2];return n});Ae.forEach=EA;var We={};function gC(n){return(gC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(We,"__esModule",{value:!0}),We.create=_C,We.clone=function(n){var t=new Zs.ARRAY_TYPE(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},We.fromValues=function(n,t,r,s){var l=new Zs.ARRAY_TYPE(4);return l[0]=n,l[1]=t,l[2]=r,l[3]=s,l},We.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},We.set=function(n,t,r,s,l){return n[0]=t,n[1]=r,n[2]=s,n[3]=l,n},We.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n},We.subtract=yC,We.multiply=H_,We.divide=MA,We.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n[3]=Math.ceil(t[3]),n},We.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n[3]=Math.floor(t[3]),n},We.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n[2]=Math.min(t[2],r[2]),n[3]=Math.min(t[3],r[3]),n},We.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n[2]=Math.max(t[2],r[2]),n[3]=Math.max(t[3],r[3]),n},We.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n[3]=Math.round(t[3]),n},We.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},We.scaleAndAdd=function(n,t,r,s){return n[0]=t[0]+r[0]*s,n[1]=t[1]+r[1]*s,n[2]=t[2]+r[2]*s,n[3]=t[3]+r[3]*s,n},We.distance=SA,We.squaredDistance=G_,We.length=TA,We.squaredLength=DA,We.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n},We.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n[3]=1/t[3],n},We.normalize=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=r*r+s*s+l*l+c*c;return d>0&&(d=1/Math.sqrt(d)),n[0]=r*d,n[1]=s*d,n[2]=l*d,n[3]=c*d,n},We.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},We.cross=function(n,t,r,s){var l=r[0]*s[1]-r[1]*s[0],c=r[0]*s[2]-r[2]*s[0],d=r[0]*s[3]-r[3]*s[0],h=r[1]*s[2]-r[2]*s[1],p=r[1]*s[3]-r[3]*s[1],m=r[2]*s[3]-r[3]*s[2],_=t[0],y=t[1],v=t[2],b=t[3];return n[0]=y*m-v*p+b*h,n[1]=-_*m+v*d-b*c,n[2]=_*p-y*d+b*l,n[3]=-_*h+y*c-v*l,n},We.lerp=function(n,t,r,s){var l=t[0],c=t[1],d=t[2],h=t[3];return n[0]=l+s*(r[0]-l),n[1]=c+s*(r[1]-c),n[2]=d+s*(r[2]-d),n[3]=h+s*(r[3]-h),n},We.random=function(n,t){var r,s,l,c,d,h;t=t||1;do{d=(r=2*Zs.RANDOM()-1)*r+(s=2*Zs.RANDOM()-1)*s}while(d>=1);do{h=(l=2*Zs.RANDOM()-1)*l+(c=2*Zs.RANDOM()-1)*c}while(h>=1);var p=Math.sqrt((1-d)/h);return n[0]=t*r,n[1]=t*s,n[2]=t*l*p,n[3]=t*c*p,n},We.transformMat4=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3];return n[0]=r[0]*s+r[4]*l+r[8]*c+r[12]*d,n[1]=r[1]*s+r[5]*l+r[9]*c+r[13]*d,n[2]=r[2]*s+r[6]*l+r[10]*c+r[14]*d,n[3]=r[3]*s+r[7]*l+r[11]*c+r[15]*d,n},We.transformQuat=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=r[0],h=r[1],p=r[2],m=r[3],_=m*s+h*c-p*l,y=m*l+p*s-d*c,v=m*c+d*l-h*s,b=-d*s-h*l-p*c;return n[0]=_*m+b*-d+y*-p-v*-h,n[1]=y*m+b*-h+v*-d-_*-p,n[2]=v*m+b*-p+_*-h-y*-d,n[3]=t[3],n},We.zero=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},We.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},We.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},We.equals=function(n,t){var r=n[0],s=n[1],l=n[2],c=n[3],d=t[0],h=t[1],p=t[2],m=t[3];return Math.abs(r-d)<=Zs.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-h)<=Zs.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(l-p)<=Zs.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(c-m)<=Zs.EPSILON*Math.max(1,Math.abs(c),Math.abs(m))},We.forEach=We.sqrLen=We.len=We.sqrDist=We.dist=We.div=We.mul=We.sub=void 0;var Zs=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==gC(n)&&"function"!=typeof n)return{default:n};var r=CA(void 0);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}(kn);function CA(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(CA=function(s){return s?r:t})(n)}function _C(){var n=new Zs.ARRAY_TYPE(4);return Zs.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function yC(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n}function H_(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n}function MA(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n[3]=t[3]/r[3],n}function SA(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2],t[3]-n[3])}function G_(n,t){var r=t[0]-n[0],s=t[1]-n[1],l=t[2]-n[2],c=t[3]-n[3];return r*r+s*s+l*l+c*c}function TA(n){return Math.hypot(n[0],n[1],n[2],n[3])}function DA(n){var t=n[0],r=n[1],s=n[2],l=n[3];return t*t+r*r+s*s+l*l}We.sub=yC,We.mul=H_,We.div=MA,We.dist=SA,We.sqrDist=G_,We.len=TA,We.sqrLen=DA;var CF=function(){var n=_C();return function(t,r,s,l,c,d){var h,p;for(r||(r=4),s||(s=0),p=l?Math.min(l*r+s,t.length):t.length,h=s;h<p;h+=r)n[0]=t[h],n[1]=t[h+1],n[2]=t[h+2],n[3]=t[h+3],c(n,n,d),t[h]=n[0],t[h+1]=n[1],t[h+2]=n[2],t[h+3]=n[3];return t}}();function vC(n){return(vC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}We.forEach=CF,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.create=q_,Ce.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},Ce.setAxisAngle=pd,Ce.getAxisAngle=function(n,t){var r=2*Math.acos(t[3]),s=Math.sin(r/2);return s>Fh.EPSILON?(n[0]=t[0]/s,n[1]=t[1]/s,n[2]=t[2]/s):(n[0]=1,n[1]=0,n[2]=0),r},Ce.getAngle=function(n,t){var r=bC(n,t);return Math.acos(2*r*r-1)},Ce.multiply=ux,Ce.rotateX=function(n,t,r){r*=.5;var s=t[0],l=t[1],c=t[2],d=t[3],h=Math.sin(r),p=Math.cos(r);return n[0]=s*p+d*h,n[1]=l*p+c*h,n[2]=c*p-l*h,n[3]=d*p-s*h,n},Ce.rotateY=function(n,t,r){r*=.5;var s=t[0],l=t[1],c=t[2],d=t[3],h=Math.sin(r),p=Math.cos(r);return n[0]=s*p-c*h,n[1]=l*p+d*h,n[2]=c*p+s*h,n[3]=d*p-l*h,n},Ce.rotateZ=function(n,t,r){r*=.5;var s=t[0],l=t[1],c=t[2],d=t[3],h=Math.sin(r),p=Math.cos(r);return n[0]=s*p+l*h,n[1]=l*p-s*h,n[2]=c*p+d*h,n[3]=d*p-c*h,n},Ce.calculateW=function(n,t){var r=t[0],s=t[1],l=t[2];return n[0]=r,n[1]=s,n[2]=l,n[3]=Math.sqrt(Math.abs(1-r*r-s*s-l*l)),n},Ce.exp=dx,Ce.ln=Up,Ce.pow=function(n,t,r){return Up(n,t),xC(n,n,r),dx(n,n),n},Ce.slerp=md,Ce.random=function(n){var t=Fh.RANDOM(),r=Fh.RANDOM(),s=Fh.RANDOM(),l=Math.sqrt(1-t),c=Math.sqrt(t);return n[0]=l*Math.sin(2*Math.PI*r),n[1]=l*Math.cos(2*Math.PI*r),n[2]=c*Math.sin(2*Math.PI*s),n[3]=c*Math.cos(2*Math.PI*s),n},Ce.invert=function(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=r*r+s*s+l*l+c*c,h=d?1/d:0;return n[0]=-r*h,n[1]=-s*h,n[2]=-l*h,n[3]=c*h,n},Ce.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n},Ce.fromMat3=vc,Ce.fromEuler=function(n,t,r,s){var l=.5*Math.PI/180;t*=l,r*=l,s*=l;var c=Math.sin(t),d=Math.cos(t),h=Math.sin(r),p=Math.cos(r),m=Math.sin(s),_=Math.cos(s);return n[0]=c*p*_-d*h*m,n[1]=d*h*_+c*p*m,n[2]=d*p*m-c*h*_,n[3]=d*p*_+c*h*m,n},Ce.str=function(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},Ce.setAxes=Ce.sqlerp=Ce.rotationTo=Ce.equals=Ce.exactEquals=Ce.normalize=Ce.sqrLen=Ce.squaredLength=Ce.len=Ce.length=Ce.lerp=Ce.dot=Ce.scale=Ce.mul=Ce.add=Ce.set=Ce.copy=Ce.fromValues=Ce.clone=void 0;var Fh=jp(kn),IA=jp(Vn),pa=jp(Ae),Wo=jp(We);function cx(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(cx=function(s){return s?r:t})(n)}function jp(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==vC(n)&&"function"!=typeof n)return{default:n};var r=cx(t);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}function q_(){var n=new Fh.ARRAY_TYPE(4);return Fh.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function pd(n,t,r){r*=.5;var s=Math.sin(r);return n[0]=s*t[0],n[1]=s*t[1],n[2]=s*t[2],n[3]=Math.cos(r),n}function ux(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=r[0],p=r[1],m=r[2],_=r[3];return n[0]=s*_+d*h+l*m-c*p,n[1]=l*_+d*p+c*h-s*m,n[2]=c*_+d*m+s*p-l*h,n[3]=d*_-s*h-l*p-c*m,n}function dx(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=Math.sqrt(r*r+s*s+l*l),h=Math.exp(c),p=d>0?h*Math.sin(d)/d:0;return n[0]=r*p,n[1]=s*p,n[2]=l*p,n[3]=h*Math.cos(d),n}function Up(n,t){var r=t[0],s=t[1],l=t[2],c=t[3],d=Math.sqrt(r*r+s*s+l*l),h=d>0?Math.atan2(d,c)/d:0;return n[0]=r*h,n[1]=s*h,n[2]=l*h,n[3]=.5*Math.log(r*r+s*s+l*l+c*c),n}function md(n,t,r,s){var l,c,d,h,p,m=t[0],_=t[1],y=t[2],v=t[3],b=r[0],E=r[1],C=r[2],S=r[3];return(c=m*b+_*E+y*C+v*S)<0&&(c=-c,b=-b,E=-E,C=-C,S=-S),1-c>Fh.EPSILON?(l=Math.acos(c),d=Math.sin(l),h=Math.sin((1-s)*l)/d,p=Math.sin(s*l)/d):(h=1-s,p=s),n[0]=h*m+p*b,n[1]=h*_+p*E,n[2]=h*y+p*C,n[3]=h*v+p*S,n}function vc(n,t){var r,s=t[0]+t[4]+t[8];if(s>0)r=Math.sqrt(s+1),n[3]=.5*r,n[0]=(t[5]-t[7])*(r=.5/r),n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{var l=0;t[4]>t[0]&&(l=1),t[8]>t[3*l+l]&&(l=2);var c=(l+1)%3,d=(l+2)%3;r=Math.sqrt(t[3*l+l]-t[3*c+c]-t[3*d+d]+1),n[l]=.5*r,n[3]=(t[3*c+d]-t[3*d+c])*(r=.5/r),n[c]=(t[3*c+l]+t[3*l+c])*r,n[d]=(t[3*d+l]+t[3*l+d])*r}return n}Ce.clone=Wo.clone,Ce.fromValues=Wo.fromValues,Ce.copy=Wo.copy,Ce.set=Wo.set,Ce.add=Wo.add,Ce.mul=ux;var xC=Wo.scale;Ce.scale=xC;var bC=Wo.dot;Ce.dot=bC,Ce.lerp=Wo.lerp;var wC=Wo.length;Ce.length=wC,Ce.len=wC;var hx=Wo.squaredLength;Ce.squaredLength=hx,Ce.sqrLen=hx;var $p=Wo.normalize;Ce.normalize=$p,Ce.exactEquals=Wo.exactEquals,Ce.equals=Wo.equals;var $a,EC,CC,MC=($a=pa.create(),EC=pa.fromValues(1,0,0),CC=pa.fromValues(0,1,0),function(n,t,r){var s=pa.dot(t,r);return s<-.999999?(pa.cross($a,EC,t),pa.len($a)<1e-6&&pa.cross($a,CC,t),pa.normalize($a,$a),pd(n,$a,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(pa.cross($a,t,r),n[0]=$a[0],n[1]=$a[1],n[2]=$a[2],n[3]=1+s,$p(n,n))});Ce.rotationTo=MC;var fx,px,Cs=(fx=q_(),px=q_(),function(n,t,r,s,l,c){return md(fx,t,l,c),md(px,r,s,c),md(n,fx,px,2*c*(1-c)),n});Ce.sqlerp=Cs;var Xs,SC=(Xs=IA.create(),function(n,t,r,s){return Xs[0]=r[0],Xs[3]=r[1],Xs[6]=r[2],Xs[1]=s[0],Xs[4]=s[1],Xs[7]=s[2],Xs[2]=-t[0],Xs[5]=-t[1],Xs[8]=-t[2],$p(n,vc(n,Xs))});Ce.setAxes=SC;var Xe={};function fo(n){return(fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.create=function(){var n=new Jr.ARRAY_TYPE(8);return Jr.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0),n[3]=1,n},Xe.clone=function(n){var t=new Jr.ARRAY_TYPE(8);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t},Xe.fromValues=function(n,t,r,s,l,c,d,h){var p=new Jr.ARRAY_TYPE(8);return p[0]=n,p[1]=t,p[2]=r,p[3]=s,p[4]=l,p[5]=c,p[6]=d,p[7]=h,p},Xe.fromRotationTranslationValues=function(n,t,r,s,l,c,d){var h=new Jr.ARRAY_TYPE(8);h[0]=n,h[1]=t,h[2]=r,h[3]=s;var p=.5*l,m=.5*c,_=.5*d;return h[4]=p*s+m*r-_*t,h[5]=m*s+_*n-p*r,h[6]=_*s+p*t-m*n,h[7]=-p*n-m*t-_*r,h},Xe.fromRotationTranslation=DC,Xe.fromTranslation=function(n,t){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=.5*t[0],n[5]=.5*t[1],n[6]=.5*t[2],n[7]=0,n},Xe.fromRotation=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=0,n[5]=0,n[6]=0,n[7]=0,n},Xe.fromMat4=function(n,t){var r=Nl.create();mx.getRotation(r,t);var s=new Jr.ARRAY_TYPE(3);return mx.getTranslation(s,t),DC(n,r,s),n},Xe.copy=gx,Xe.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n},Xe.set=function(n,t,r,s,l,c,d,h,p){return n[0]=t,n[1]=r,n[2]=s,n[3]=l,n[4]=c,n[5]=d,n[6]=h,n[7]=p,n},Xe.getDual=function(n,t){return n[0]=t[4],n[1]=t[5],n[2]=t[6],n[3]=t[7],n},Xe.setDual=function(n,t){return n[4]=t[0],n[5]=t[1],n[6]=t[2],n[7]=t[3],n},Xe.getTranslation=function(n,t){var r=t[4],s=t[5],l=t[6],c=t[7],d=-t[0],h=-t[1],p=-t[2],m=t[3];return n[0]=2*(r*m+c*d+s*p-l*h),n[1]=2*(s*m+c*h+l*d-r*p),n[2]=2*(l*m+c*p+r*h-s*d),n},Xe.translate=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=.5*r[0],p=.5*r[1],m=.5*r[2],_=t[4],y=t[5],v=t[6],b=t[7];return n[0]=s,n[1]=l,n[2]=c,n[3]=d,n[4]=d*h+l*m-c*p+_,n[5]=d*p+c*h-s*m+y,n[6]=d*m+s*p-l*h+v,n[7]=-s*h-l*p-c*m+b,n},Xe.rotateX=function(n,t,r){var s=-t[0],l=-t[1],c=-t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=h*d+_*s+p*c-m*l,v=p*d+_*l+m*s-h*c,b=m*d+_*c+h*l-p*s,E=_*d-h*s-p*l-m*c;return Nl.rotateX(n,t,r),n[4]=y*(d=n[3])+E*(s=n[0])+v*(c=n[2])-b*(l=n[1]),n[5]=v*d+E*l+b*s-y*c,n[6]=b*d+E*c+y*l-v*s,n[7]=E*d-y*s-v*l-b*c,n},Xe.rotateY=function(n,t,r){var s=-t[0],l=-t[1],c=-t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=h*d+_*s+p*c-m*l,v=p*d+_*l+m*s-h*c,b=m*d+_*c+h*l-p*s,E=_*d-h*s-p*l-m*c;return Nl.rotateY(n,t,r),n[4]=y*(d=n[3])+E*(s=n[0])+v*(c=n[2])-b*(l=n[1]),n[5]=v*d+E*l+b*s-y*c,n[6]=b*d+E*c+y*l-v*s,n[7]=E*d-y*s-v*l-b*c,n},Xe.rotateZ=function(n,t,r){var s=-t[0],l=-t[1],c=-t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=h*d+_*s+p*c-m*l,v=p*d+_*l+m*s-h*c,b=m*d+_*c+h*l-p*s,E=_*d-h*s-p*l-m*c;return Nl.rotateZ(n,t,r),n[4]=y*(d=n[3])+E*(s=n[0])+v*(c=n[2])-b*(l=n[1]),n[5]=v*d+E*l+b*s-y*c,n[6]=b*d+E*c+y*l-v*s,n[7]=E*d-y*s-v*l-b*c,n},Xe.rotateByQuatAppend=function(n,t,r){var s=r[0],l=r[1],c=r[2],d=r[3],h=t[0],p=t[1],m=t[2],_=t[3];return n[0]=h*d+_*s+p*c-m*l,n[1]=p*d+_*l+m*s-h*c,n[2]=m*d+_*c+h*l-p*s,n[3]=_*d-h*s-p*l-m*c,n[4]=(h=t[4])*d+(_=t[7])*s+(p=t[5])*c-(m=t[6])*l,n[5]=p*d+_*l+m*s-h*c,n[6]=m*d+_*c+h*l-p*s,n[7]=_*d-h*s-p*l-m*c,n},Xe.rotateByQuatPrepend=function(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=r[0],p=r[1],m=r[2],_=r[3];return n[0]=s*_+d*h+l*m-c*p,n[1]=l*_+d*p+c*h-s*m,n[2]=c*_+d*m+s*p-l*h,n[3]=d*_-s*h-l*p-c*m,n[4]=s*(_=r[7])+d*(h=r[4])+l*(m=r[6])-c*(p=r[5]),n[5]=l*_+d*p+c*h-s*m,n[6]=c*_+d*m+s*p-l*h,n[7]=d*_-s*h-l*p-c*m,n},Xe.rotateAroundAxis=function(n,t,r,s){if(Math.abs(s)<Jr.EPSILON)return gx(n,t);var l=Math.hypot(r[0],r[1],r[2]);s*=.5;var c=Math.sin(s),d=c*r[0]/l,h=c*r[1]/l,p=c*r[2]/l,m=Math.cos(s),_=t[0],y=t[1],v=t[2],b=t[3];n[0]=_*m+b*d+y*p-v*h,n[1]=y*m+b*h+v*d-_*p,n[2]=v*m+b*p+_*h-y*d,n[3]=b*m-_*d-y*h-v*p;var E=t[4],C=t[5],S=t[6],M=t[7];return n[4]=E*m+M*d+C*p-S*h,n[5]=C*m+M*h+S*d-E*p,n[6]=S*m+M*p+E*h-C*d,n[7]=M*m-E*d-C*h-S*p,n},Xe.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n[4]=t[4]+r[4],n[5]=t[5]+r[5],n[6]=t[6]+r[6],n[7]=t[7]+r[7],n},Xe.multiply=IC,Xe.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n},Xe.lerp=function(n,t,r,s){var l=1-s;return _x(t,r)<0&&(s=-s),n[0]=t[0]*l+r[0]*s,n[1]=t[1]*l+r[1]*s,n[2]=t[2]*l+r[2]*s,n[3]=t[3]*l+r[3]*s,n[4]=t[4]*l+r[4]*s,n[5]=t[5]*l+r[5]*s,n[6]=t[6]*l+r[6]*s,n[7]=t[7]*l+r[7]*s,n},Xe.invert=function(n,t){var r=Z_(t);return n[0]=-t[0]/r,n[1]=-t[1]/r,n[2]=-t[2]/r,n[3]=t[3]/r,n[4]=-t[4]/r,n[5]=-t[5]/r,n[6]=-t[6]/r,n[7]=t[7]/r,n},Xe.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=t[7],n},Xe.normalize=function(n,t){var r=Z_(t);if(r>0){r=Math.sqrt(r);var s=t[0]/r,l=t[1]/r,c=t[2]/r,d=t[3]/r,h=t[4],p=t[5],m=t[6],_=t[7],y=s*h+l*p+c*m+d*_;n[0]=s,n[1]=l,n[2]=c,n[3]=d,n[4]=(h-s*y)/r,n[5]=(p-l*y)/r,n[6]=(m-c*y)/r,n[7]=(_-d*y)/r}return n},Xe.str=function(n){return"quat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+")"},Xe.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]},Xe.equals=function(n,t){var r=n[0],s=n[1],l=n[2],c=n[3],d=n[4],h=n[5],p=n[6],m=n[7],_=t[0],y=t[1],v=t[2],b=t[3],E=t[4],C=t[5],S=t[6],M=t[7];return Math.abs(r-_)<=Jr.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(s-y)<=Jr.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(l-v)<=Jr.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(c-b)<=Jr.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(d-E)<=Jr.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(h-C)<=Jr.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-S)<=Jr.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(m-M)<=Jr.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))},Xe.sqrLen=Xe.squaredLength=Xe.len=Xe.length=Xe.dot=Xe.mul=Xe.setReal=Xe.getReal=void 0;var Jr=W_(kn),Nl=W_(Ce),mx=W_(ke);function TC(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(TC=function(s){return s?r:t})(n)}function W_(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==fo(n)&&"function"!=typeof n)return{default:n};var r=TC(t);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}function DC(n,t,r){var s=.5*r[0],l=.5*r[1],c=.5*r[2],d=t[0],h=t[1],p=t[2],m=t[3];return n[0]=d,n[1]=h,n[2]=p,n[3]=m,n[4]=s*m+l*p-c*h,n[5]=l*m+c*d-s*p,n[6]=c*m+s*h-l*d,n[7]=-s*d-l*h-c*p,n}function gx(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n}function IC(n,t,r){var s=t[0],l=t[1],c=t[2],d=t[3],h=r[4],p=r[5],m=r[6],_=r[7],y=t[4],v=t[5],b=t[6],E=t[7],C=r[0],S=r[1],M=r[2],D=r[3];return n[0]=s*D+d*C+l*M-c*S,n[1]=l*D+d*S+c*C-s*M,n[2]=c*D+d*M+s*S-l*C,n[3]=d*D-s*C-l*S-c*M,n[4]=s*_+d*h+l*m-c*p+y*D+E*C+v*M-b*S,n[5]=l*_+d*p+c*h-s*m+v*D+E*S+b*C-y*M,n[6]=c*_+d*m+s*p-l*h+b*D+E*M+y*S-v*C,n[7]=d*_-s*h-l*p-c*m+E*D-y*C-v*S-b*M,n}Xe.getReal=Nl.copy,Xe.setReal=Nl.copy,Xe.mul=IC;var _x=Nl.dot;Xe.dot=_x;var AC=Nl.length;Xe.length=AC,Xe.len=AC;var Z_=Nl.squaredLength;Xe.squaredLength=Z_,Xe.sqrLen=Z_;var ze={};function Hp(n){return(Hp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(ze,"__esModule",{value:!0}),ze.create=RC,ze.clone=function(n){var t=new gd.ARRAY_TYPE(2);return t[0]=n[0],t[1]=n[1],t},ze.fromValues=function(n,t){var r=new gd.ARRAY_TYPE(2);return r[0]=n,r[1]=t,r},ze.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n},ze.set=function(n,t,r){return n[0]=t,n[1]=r,n},ze.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n},ze.subtract=PC,ze.multiply=yx,ze.divide=vx,ze.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n},ze.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n},ze.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n},ze.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n},ze.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n},ze.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},ze.scaleAndAdd=function(n,t,r,s){return n[0]=t[0]+r[0]*s,n[1]=t[1]+r[1]*s,n},ze.distance=xx,ze.squaredDistance=_d,ze.length=Gp,ze.squaredLength=bx,ze.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n},ze.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n},ze.normalize=function(n,t){var r=t[0],s=t[1],l=r*r+s*s;return l>0&&(l=1/Math.sqrt(l)),n[0]=t[0]*l,n[1]=t[1]*l,n},ze.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]},ze.cross=function(n,t,r){var s=t[0]*r[1]-t[1]*r[0];return n[0]=n[1]=0,n[2]=s,n},ze.lerp=function(n,t,r,s){var l=t[0],c=t[1];return n[0]=l+s*(r[0]-l),n[1]=c+s*(r[1]-c),n},ze.random=function(n,t){t=t||1;var r=2*gd.RANDOM()*Math.PI;return n[0]=Math.cos(r)*t,n[1]=Math.sin(r)*t,n},ze.transformMat2=function(n,t,r){var s=t[0],l=t[1];return n[0]=r[0]*s+r[2]*l,n[1]=r[1]*s+r[3]*l,n},ze.transformMat2d=function(n,t,r){var s=t[0],l=t[1];return n[0]=r[0]*s+r[2]*l+r[4],n[1]=r[1]*s+r[3]*l+r[5],n},ze.transformMat3=function(n,t,r){var s=t[0],l=t[1];return n[0]=r[0]*s+r[3]*l+r[6],n[1]=r[1]*s+r[4]*l+r[7],n},ze.transformMat4=function(n,t,r){var s=t[0],l=t[1];return n[0]=r[0]*s+r[4]*l+r[12],n[1]=r[1]*s+r[5]*l+r[13],n},ze.rotate=function(n,t,r,s){var l=t[0]-r[0],c=t[1]-r[1],d=Math.sin(s),h=Math.cos(s);return n[0]=l*h-c*d+r[0],n[1]=l*d+c*h+r[1],n},ze.angle=function(n,t){var r=n[0],s=n[1],l=t[0],c=t[1],d=Math.sqrt(r*r+s*s)*Math.sqrt(l*l+c*c);return Math.acos(Math.min(Math.max(d&&(r*l+s*c)/d,-1),1))},ze.zero=function(n){return n[0]=0,n[1]=0,n},ze.str=function(n){return"vec2("+n[0]+", "+n[1]+")"},ze.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]},ze.equals=function(n,t){var r=n[0],s=n[1],l=t[0],c=t[1];return Math.abs(r-l)<=gd.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=gd.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},ze.forEach=ze.sqrLen=ze.sqrDist=ze.dist=ze.div=ze.mul=ze.sub=ze.len=void 0;var gd=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==Hp(n)&&"function"!=typeof n)return{default:n};var r=Lh(void 0);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}(kn);function Lh(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Lh=function(s){return s?r:t})(n)}function RC(){var n=new gd.ARRAY_TYPE(2);return gd.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0),n}function PC(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n}function yx(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n}function vx(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n}function xx(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1])}function _d(n,t){var r=t[0]-n[0],s=t[1]-n[1];return r*r+s*s}function Gp(n){return Math.hypot(n[0],n[1])}function bx(n){var t=n[0],r=n[1];return t*t+r*r}ze.len=Gp,ze.sub=PC,ze.mul=yx,ze.div=vx,ze.dist=xx,ze.sqrDist=_d,ze.sqrLen=bx;var wx=function(){var n=RC();return function(t,r,s,l,c,d){var h,p;for(r||(r=2),s||(s=0),p=l?Math.min(l*r+s,t.length):t.length,h=s;h<p;h+=r)n[0]=t[h],n[1]=t[h+1],c(n,n,d),t[h]=n[0],t[h+1]=n[1];return t}}();function Nh(n){return(Nh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}ze.forEach=wx,Object.defineProperty(Pr,"__esModule",{value:!0});var Fn=Pr.vec4=q=Pr.vec3=Pr.vec2=Pr.quat2=Qr=Pr.quat=rt=Pr.mat4=Zo=Pr.mat3=Pr.mat2d=zh=Pr.mat2=Pr.glMatrix=void 0,AA=zl(kn);Pr.glMatrix=AA;var RA=zl(Jn),zh=Pr.mat2=RA,PA=zl(Ri);Pr.mat2d=PA;var OA=zl(Vn),Zo=Pr.mat3=OA,X_=zl(ke),rt=Pr.mat4=X_,Ex=zl(Ce),Qr=Pr.quat=Ex,kA=zl(Xe);Pr.quat2=kA;var Cx=zl(ze);Pr.vec2=Cx;var OC=zl(Ae),q=Pr.vec3=OC,kC=zl(We);function Mx(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Mx=function(s){return s?r:t})(n)}function zl(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==Nh(n)&&"function"!=typeof n)return{default:n};var r=Mx(t);if(r&&r.has(n))return r.get(n);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in n)if("default"!==c&&Object.prototype.hasOwnProperty.call(n,c)){var d=l?Object.getOwnPropertyDescriptor(n,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=n[c]}return s.default=n,r&&r.set(n,s),s}Fn=Pr.vec4=kC;const MF=pn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yd}=MF,FC=pn([{name:"a_pos_3",components:3,type:"Int16"}]);var xc=pn([{name:"a_pos",type:"Int16",components:2}]),Sx={};!function(r){function s(c,d,h){var p=l(256*c,256*(d=Math.pow(2,h)-d-1),h),m=l(256*(c+1),256*(d+1),h);return p[0]+","+p[1]+","+m[0]+","+m[1]}function l(c,d,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[c*p-2*Math.PI*6378137/2,d*p-2*Math.PI*6378137/2]}r.getURL=function(c,d,h,p,m,_){return _=_||{},c+"?"+["bbox="+s(h,p,m),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+d].join("&")},r.getTileBBox=s,r.getMercCoords=l,Object.defineProperty(r,"__esModule",{value:!0})}(Sx);var LC=Sx;class ma{constructor(t,r,s){this.z=t,this.x=r,this.y=s,this.key=bc(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r){const s=LC.getTileBBox(this.x,this.y,this.z),l=function(c,d,h){let p,m="";for(let _=c;_>0;_--)p=1<<_-1,m+=(d&p?1:0)+(h&p?2:0);return m}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Y_{constructor(t,r){this.wrap=t,this.canonical=r,this.key=bc(t,r.z,r.z,r.x,r.y)}}class tn{constructor(t,r,s,l,c){this.overscaledZ=t,this.wrap=r,this.canonical=new ma(s,+l,+c),this.key=0===r&&t===s?this.canonical.key:bc(r,t,s,l,c)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new tn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new tn(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return bc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-t;return bc(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new tn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new tn(r,this.wrap,r,s,l),new tn(r,this.wrap,r,s+1,l),new tn(r,this.wrap,r,s,l+1),new tn(r,this.wrap,r,s+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new tn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new tn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Y_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function bc(n,t,r,s,l){const c=1<<Math.min(r,22);let d=c*(l%c)+s%c;return n&&r<22&&(d+=c*c*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*d+r)+(t-r)}const Tx=[n=>{let t=n.canonical.x-1,r=n.wrap;return t<0&&(t=(1<<n.canonical.z)-1,r--),new tn(n.overscaledZ,r,n.canonical.z,t,n.canonical.y)},n=>{let t=n.canonical.x+1,r=n.wrap;return t===1<<n.canonical.z&&(t=0,r++),new tn(n.overscaledZ,r,n.canonical.z,t,n.canonical.y)},n=>new tn(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(0===n.canonical.y?1<<n.canonical.z:n.canonical.y)-1),n=>new tn(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Xt(ma,"CanonicalTileID"),Xt(tn,"OverscaledTileID",{omit:["projMatrix"]});class Bh{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,s){const l=q.dot(r,this.dir);if(Math.abs(l)<1e-6)return!1;const c=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/l;return s[0]=this.pos[0]+this.dir[0]*c,s[1]=this.pos[1]+this.dir[1]*c,s[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(t,r,s){if(q.equals(this.pos,t)||0===r)return s[0]=s[1]=s[2]=0,!1;const[l,c,d]=this.dir,h=this.pos[0]-t[0],p=this.pos[1]-t[1],m=this.pos[2]-t[2],_=l*l+c*c+d*d,y=2*(h*l+p*c+m*d),v=y*y-4*_*(h*h+p*p+m*m-r*r);if(v<0){const b=Math.max(-y/2,0),E=h+l*b,C=p+c*b,S=m+d*b,M=Math.hypot(E,C,S);return s[0]=E*r/M,s[1]=C*r/M,s[2]=S*r/M,!1}{const b=(-y-Math.sqrt(v))/(2*_);if(b<0){const E=Math.hypot(h,p,m);return s[0]=h*r/E,s[1]=p*r/E,s[2]=m*r/E,!1}return s[0]=h+l*b,s[1]=p+c*b,s[2]=m+d*b,!0}}}class Vh{constructor(t,r,s,l,c){this.TL=t,this.TR=r,this.BR=s,this.BL=l,this.horizon=c}static fromInvProjectionMatrix(t,r,s){const l=[-1,1,1],c=[1,1,1],d=[1,-1,1],h=[-1,-1,1],p=q.transformMat4(l,l,t),m=q.transformMat4(c,c,t),_=q.transformMat4(d,d,t),y=q.transformMat4(h,h,t);return new Vh(p,m,_,y,r/s)}}function jh(n,t,r){let s=1/0,l=-1/0;const c=[];for(const d of n){q.sub(c,d,t);const h=q.dot(c,r);s=Math.min(s,h),l=Math.max(l,h)}return[s,l]}function K_(n,t){let r=!0;for(let s=0;s<n.planes.length;s++){const l=n.planes[s];let c=0;for(let d=0;d<t.length;d++)c+=q.dot(l,t[d])+l[3]>=0;if(0===c)return 0;c!==t.length&&(r=!1)}return r?2:1}function Uh(n,t){for(const r of n.projections){const s=jh(t,n.points[0],r.axis);if(r.projection[1]<s[0]||r.projection[0]>s[1])return 0}return 1}function NC(n,t){let r=0;const s=[0,0,0,0];for(let l=0;l<n.length;l++)s[0]=n[l][0],s[1]=n[l][1],s[2]=n[l][2],s[3]=1,Fn.dot(s,t)>=0&&r++;return r}class Bl{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=ci.fromPoints(this.points),this.projections=[],this.frustumEdges=[q.sub([],this.points[2],this.points[3]),q.sub([],this.points[0],this.points[3]),q.sub([],this.points[4],this.points[0]),q.sub([],this.points[5],this.points[1]),q.sub([],this.points[6],this.points[2]),q.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const l=[0,-s[2],s[1]],c=[s[2],0,-s[0]];this.projections.push({axis:l,projection:jh(this.points,this.points[0],l)}),this.projections.push({axis:c,projection:jh(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(t,r,s,l){const c=Math.pow(2,s),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(m=>{const _=Fn.transformMat4([],m,t),y=1/_[3]/r*c;return Fn.mul(_,_,[y,y,l?1/_[3]:y,y])}),h=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(m=>{const _=q.sub([],d[m[0]],d[m[1]]),y=q.sub([],d[m[2]],d[m[1]]),v=q.normalize([],q.cross([],_,y)),b=-q.dot(v,d[m[1]]);return v.concat(b)}),p=[];for(let m=0;m<d.length;m++)p.push([d[m][0],d[m][1],d[m][2]]);return new Bl(p,h)}intersectsPrecise(t,r,s){for(let l=0;l<r.length;l++)if(!NC(t,r[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!NC(t,this.planes[l]))return 0;for(const l of s)for(const c of this.frustumEdges){const d=q.cross([],l,c),h=q.length(d);if(0===h)continue;q.scale(d,d,1/h);const p=jh(this.points,this.points[0],d),m=jh(t,this.points[0],d);if(p[0]>m[1]||m[0]>p[1])return 0}return 1}}class ci{static fromPoints(t){const r=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const l of t)q.min(r,r,l),q.max(s,s,l);return new ci(r,s)}static fromTileIdAndHeight(t,r,s){const l=1<<t.canonical.z,c=t.canonical.x,d=t.canonical.y;return new ci([c/l,d/l,r],[(c+1)/l,(d+1)/l,s])}static applyTransform(t,r){const s=t.getCorners();for(let l=0;l<s.length;++l)q.transformMat4(s[l],s[l],r);return ci.fromPoints(s)}static projectAabbCorners(t,r){const s=t.getCorners();for(let l=0;l<s.length;++l)q.transformMat4(s[l],s[l],r);return s}constructor(t,r){this.min=t,this.max=r,this.center=q.scale([],q.add([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],s=q.clone(this.min),l=q.clone(this.max);for(let c=0;c<r.length;c++)s[c]=r[c]?this.min[c]:this.center[c],l[c]=r[c]?this.center[c]:this.max[c];return l[2]=this.max[2],new ci(s,l)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?K_(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?K_(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,r){return r||this.intersects(t)?Uh(t,this.getCorners()):0}intersectsPreciseFlat(t,r){return r||this.intersectsFlat(t)?Uh(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let r=0;r<3;++r)if(this.min[r]>t.max[r]||t.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t.min[r]),this.max[r]=Math.max(this.max[r],t.max[r])}encapsulatePoint(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t[r]),this.max[r]=Math.max(this.max[r],t[r])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Xt(ci,"Aabb");const qp=5,mu=6,Ro=dt/Math.PI/2,zC=16383,Wp=[64,32,16],Po=-Ro,ga=Ro,FA=[new ci([Po,Po,Po],[ga,ga,ga]),new ci([Po,Po,Po],[0,0,ga]),new ci([0,Po,Po],[ga,0,ga]),new ci([Po,0,Po],[0,ga,ga]),new ci([0,0,Po],[ga,ga,ga])];function Dx(n){return n*Ro/vd}function BC(n,t,r,s=!0){const l=q.scale([],n._camera.position,n.worldSize),c=[t,r,1,1];Fn.transformMat4(c,c,n.pixelMatrixInverse),Fn.scale(c,c,1/c[3]);const d=q.sub([],c,l),h=q.normalize([],d),p=n.globeMatrix,m=[p[12],p[13],p[14]],_=q.sub([],m,l),y=q.length(_),v=q.normalize([],_),b=n.worldSize/(2*Math.PI),E=q.dot(v,h),C=Math.asin(b/y);if(C<Math.acos(E)){if(!s)return null;const U=[],V=[];q.scale(U,h,y/E),q.normalize(V,q.sub(V,U,_)),q.normalize(h,q.add(h,_,q.scale(h,V,Math.tan(C)*y)))}const S=[];new Bh(l,h).closestPointOnSphere(m,b,S);const M=q.normalize([],Ni(p,0)),D=q.normalize([],Ni(p,1)),R=q.normalize([],Ni(p,2)),P=q.dot(M,S),I=q.dot(D,S),O=q.dot(R,S),F=Er(Math.asin(-I/b));let L=Er(Math.atan2(P,O));L=n.center.lng+function(U,V){const H=(V-U+180)%360-180;return H<-180?H+360:H}(n.center.lng,L);const N=eo(L),z=Jt(po(F),0,1);return new Ke(N,z)}class Ix{constructor(t,r,s){this.a=q.sub([],t,s),this.b=q.sub([],r,s),this.center=s;const l=q.normalize([],this.a),c=q.normalize([],this.b);this.angle=Math.acos(q.dot(l,c))}}function Ax(n,t){if(0===n.angle)return null;let r;return r=0===n.a[t]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[t]/n.a[t]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(s,l,c,d){const h=Math.sin(c);return s*(Math.sin((1-d)*c)/h)+l*(Math.sin(d*c)/h)}(n.a[t],n.b[t],n.angle,Jt(r,0,1))+n.center[t]}function Oo(n){if(n.z<=1)return FA[n.z+2*n.y+n.x];const t=Ec(Zp(n));return ci.fromPoints(t)}function _a(n,t,r){return q.scale(n,n,1-r),q.scaleAndAdd(n,n,t,r)}function J_(n,t){const r=Br(t.zoom);if(0===r)return Oo(n);const s=Zp(n),l=Ec(s),c=eo(s.getWest())*t.worldSize,d=eo(s.getEast())*t.worldSize,h=po(s.getNorth())*t.worldSize,p=po(s.getSouth())*t.worldSize,m=[c,h,0],_=[d,h,0],y=[c,p,0],v=[d,p,0],b=rt.invert([],t.globeMatrix);return q.transformMat4(m,m,b),q.transformMat4(_,_,b),q.transformMat4(y,y,b),q.transformMat4(v,v,b),l[0]=_a(l[0],y,r),l[1]=_a(l[1],v,r),l[2]=_a(l[2],_,r),l[3]=_a(l[3],m,r),ci.fromPoints(l)}function Rx(n,t,r){for(const s of n)q.transformMat4(s,s,t),q.scale(s,s,r)}function Q_(n,t,r,s){const l=t/n.worldSize,c=n.globeMatrix;if(r.z<=1){const N=Oo(r).getCorners();return Rx(N,c,l),ci.fromPoints(N)}const d=Zp(r,s),h=Ec(d);Rx(h,c,l);const p=Number.MAX_VALUE,m=[-p,-p,-p],_=[p,p,p];if(d.contains(n.center)){for(const U of h)q.min(_,_,U),q.max(m,m,U);m[2]=0;const N=n.point,z=[N.x*l,N.y*l,0];return q.min(_,_,z),q.max(m,m,z),new ci(_,m)}const y=[c[12]*l,c[13]*l,c[14]*l],v=d.getCenter(),b=Jt(n.center.lat,-Hi,Hi),E=Jt(v.lat,-Hi,Hi),C=eo(n.center.lng),S=po(b);let M=C-eo(v.lng);const D=S-po(E);M>.5?M-=1:M<-.5&&(M+=1);let R=0;if(Math.abs(M)>Math.abs(D))R=M>=0?1:3;else{R=D>=0?0:2;const N=[c[4]*l,c[5]*l,c[6]*l],z=-Math.sin(Ie(D>=0?d.getSouth():d.getNorth()))*Ro;q.scaleAndAdd(y,y,N,z)}const P=h[R],I=h[(R+1)%4],O=new Ix(P,I,y),F=[Ax(O,0)||P[0],Ax(O,1)||P[1],Ax(O,2)||P[2]],L=Br(n.zoom);if(L>0){const N=function({x:U,y:V,z:H},j,Z,tt,it){const X=1/(1<<H);let Y=U*X,ot=Y+X,lt=V*X,ht=lt+X,mt=0;const yt=(Y+ot)/2-tt;return yt>.5?mt=-1:yt<-.5&&(mt=1),Y=((Y+mt)*j-(tt*=j))*Z+tt,ot=((ot+mt)*j-tt)*Z+tt,lt=(lt*j-(it*=j))*Z+it,ht=(ht*j-it)*Z+it,[[Y,ht,0],[ot,ht,0],[ot,lt,0],[Y,lt,0]]}(r,t,n._pixelsPerMercatorPixel,C,S);for(let U=0;U<h.length;U++)_a(h[U],N[U],L);const z=q.add([],N[R],N[(R+1)%4]);q.scale(z,z,.5),_a(F,z,L)}for(const N of h)q.min(_,_,N),q.max(m,m,N);return _[2]=Math.min(P[2],I[2]),q.min(_,_,F),q.max(m,m,F),new ci(_,m)}function Zp({x:n,y:t,z:r},s=!1){const l=1/(1<<r),c=new we(Ms(n*l),t===(1<<r)-1&&s?-90:lr((t+1)*l)),d=new we(Ms((n+1)*l),0===t&&s?90:lr(t*l));return new qs(c,d)}function Ec(n){const t=Ie(n.getNorth()),r=Ie(n.getSouth()),s=Math.cos(t),l=Math.cos(r),c=Math.sin(t),d=Math.sin(r),h=n.getWest(),p=n.getEast();return[$h(l,d,h),$h(l,d,p),$h(s,c,p),$h(s,c,h)]}function $h(n,t,r,s=Ro){return r=Ie(r),[n*Math.sin(r)*s,-t*s,n*Math.cos(r)*s]}function as(n,t,r){return $h(Math.cos(Ie(n)),Math.sin(Ie(n)),t,r)}function Xp(n,t,r,s){const l=1<<r.z,c=(n/dt+r.x)/l;return as(lr((t/dt+r.y)/l),Ms(c),s)}function ty({min:n,max:t}){return zC/Math.max(t[0]-n[0],t[1]-n[1],t[2]-n[2])}const VC=new Float64Array(16);function to(n){const t=ty(n),r=rt.fromScaling(VC,[t,t,t]);return rt.translate(r,r,q.negate([],n.min))}function ya(n){const t=rt.fromTranslation(VC,n.min),r=1/ty(n);return rt.scale(t,t,[r,r,r])}function Px(n){const t=dt/(2*Math.PI);return n/(2*Math.PI)/t}function jC(n,t){return dt/(512*Math.pow(2,n))*ty(Oo(t))}function UC(n,t,r,s,l){const c=Px(r),d=[n,t,-r/(2*Math.PI)],h=rt.identity(new Float64Array(16));return rt.translate(h,h,d),rt.scale(h,h,[c,c,c]),rt.rotateX(h,h,Ie(-l)),rt.rotateY(h,h,Ie(-s)),h}function Br(n){return xl(qp,mu,n)}function $C(n,t,r){const s=rt.identity(new Float64Array(16)),l=(t/(1<<n)-.5)*Math.PI*2;return rt.rotateY(s,r.globeMatrix,l),Float32Array.from(s)}function HC(n,t,r){const s=Br(r.zoom),l=n.style.map._antialias,c=t.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===s&&!l&&!c}function GC(n,t,r,s){const l=t.getNorth(),c=t.getSouth(),d=t.getWest(),h=t.getEast(),p=1<<n.z,m=h-d,_=l-c,y=m/64,v=-_/Wp[r],b=[0,y,0,v,0,0,l,d,0];if(n.z>0){const E=180/s;Zo.multiply(b,b,[E/m+1,0,0,0,E/_+1,0,-.5*E/y,.5*E/v,1])}return b[2]=p,b[5]=n.x,b[8]=n.y,b}function LA(n){const t=Hi-5;n=Jt(n,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(Ie(n))),3);return Math.round(r*(Wp.length-1))}function qC(n){const t=[0,0,0],r=rt.identity(new Float64Array(16));return rt.multiply(r,n.pixelMatrix,n.globeMatrix),q.transformMat4(t,t,r),new nt(t[0],t[1])}function WC(n,t){const r=as(t.lat,t.lng),s=function(c){const d=as(c._center.lat,c._center.lng),h=q.fromValues(0,1,0);let p=q.cross([],h,d);const m=rt.fromRotation([],-c.angle,d);p=q.transformMat4(p,p,m),rt.fromRotation(m,-c._pitch,p);const _=q.normalize([],d);return q.scale(_,_,Dx(c.cameraToCenterDistance/c.pixelsPerMeter)),q.transformMat4(_,_,m),q.add([],d,_)}(n),l=q.subtract([],s,r);return q.angle(l,r)}function ey(n,t){return WC(n,t)>Math.PI/2*1.01}const Yp=Ie(85),Cc=Math.cos(Yp),Kp=Math.sin(Yp);class ZC{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,r){const s=new qo,l=new er,c=[],d=t+1+2,h=r[0]+1,p=r[0]+1+(1+r.length),m=(_,y,v)=>{let b=_===d-1?_-2:0===_?_:_-1;return b+=v?24575:0,[b,y]};for(let _=0;_<d;++_)s.emplaceBack(...m(_,0,!0));for(let _=0;_<h;++_)for(let y=0;y<d;++y)s.emplaceBack(...m(y,_,(0===y||y===d-1)&&!0));for(let _=0;_<r.length;++_){const y=r[_];for(let v=0;v<d;++v)s.emplaceBack(...m(v,y,!0))}for(let _=0;_<r.length;++_){const y=l.length,v=r[_]+1+2,b=new er;for(let S=0;S<v-1;S++){const M=S===v-2,D=M?d*(p-r.length+_-S):d;for(let R=0;R<d-1;R++){const P=S*d+R;0===S||M||0===R||R===d-2?(b.emplaceBack(P+1,P,P+D),b.emplaceBack(P+D,P+D+1,P+1)):(l.emplaceBack(P+1,P,P+D),l.emplaceBack(P+D,P+D+1,P+1))}}const E=Bn.simpleSegment(0,y,s.length,l.length-y);for(let S=0;S<b.uint16.length;S+=3)l.emplaceBack(b.uint16[S],b.uint16[S+1],b.uint16[S+2]);const C=Bn.simpleSegment(0,y,s.length,l.length-y);c.push({withoutSkirts:E,withSkirts:C})}return{vertices:s,indices:l,segments:c}}_createGrid(t){const r=this._fillGridMeshWithLods(64,Wp);this._gridSegments=r.segments,this._gridBuffer=t.createVertexBuffer(r.vertices,xc.members),this._gridIndexBuffer=t.createIndexBuffer(r.indices,!0)}_createPoles(t){const r=new er;for(let h=0;h<=64;h++)r.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(r,!0);const s=new ha,l=new ha,c=new ha,d=new ha;this._poleSegments=[];for(let h=0,p=0;h<qp;h++){const m=360/(1<<h);s.emplaceBack(0,-Ro,0,.5,0),l.emplaceBack(0,-Ro,0,.5,1),c.emplaceBack(0,-Ro,0,.5,.5),d.emplaceBack(0,-Ro,0,.5,.5);for(let _=0;_<=64;_++){let y=_/64,v=0;const b=_e(0,m,y),[E,C,S]=$h(Cc,Kp,b,Ro);s.emplaceBack(E,C,S,y,v),l.emplaceBack(E,C,S,y,1-v);const M=Ie(b);y=.5+.5*Math.sin(M),v=.5+.5*Math.cos(M),c.emplaceBack(E,C,S,y,v),d.emplaceBack(E,C,S,y,1-v)}this._poleSegments.push(Bn.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(s,yd,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(l,yd,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(c,yd,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,yd,!1)}getGridBuffers(t,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}const vd=6371008.8,ny=2*Math.PI*vd;class xd{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xd(bl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,l=t.lat*r,c=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return vd*Math.acos(Math.min(c,1))}toBounds(t=0){const r=360*t/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new qs(new xd(this.lng-s,this.lat-r),new xd(this.lng+s,this.lat+r))}toEcef(t){const r=Dx(t);return as(this.lat,this.lng,Ro+r)}static convert(t){if(t instanceof xd)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new xd(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new xd(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var we=xd;const SF=0,Ox=25.5;function Hh(n){return ny*Math.cos(n*Math.PI/180)}function eo(n){return(180+n)/360}function po(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ln(n,t){return n/Hh(t)}function Ms(n){return 360*n-180}function lr(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function XC(n,t){return n*Hh(lr(t))}const Hi=85.051129;function kx(n){return Math.cos(Ie(Jt(n,-Hi,Hi)))}function Ha(n,t){const r=Jt(t,SF,Ox),s=Math.pow(2,r);return kx(n)*ny/(512*s)}function iy(n){return 1/Math.cos(n*Math.PI/180)}function bd(n,t=0){const r=Math.exp(Math.PI*(1-(n.y+t/dt)/(1<<n.z)*2));return 80150034*r/(r*r+1)/dt/(1<<n.z)}class Ke{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=we.convert(t);return new Ke(eo(s.lng),po(s.lat),Ln(r,s.lat))}toLngLat(){return new we(Ms(this.x),lr(this.y))}toAltitude(){return XC(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ny*iy(lr(this.y))}}function no(n,t,r,s,l,c,d,h,p){const m=(t+s)/2,_=(r+l)/2,y=new nt(m,_);h(y),function(v,b,E,C,S,M){const D=E-S,R=C-M;return Math.abs((C-b)*D-(E-v)*R)/Math.hypot(D,R)}(y.x,y.y,c.x,c.y,d.x,d.y)>=p?(no(n,t,r,m,_,c,y,h,p),no(n,m,_,s,l,y,d,h,p)):n.push(d)}function YC(n,t,r){let s=n[0],l=s.x,c=s.y;t(s);const d=[s];for(let h=1;h<n.length;h++){const p=n[h],{x:m,y:_}=p;t(p),no(d,l,c,m,_,s,p,t,r),l=m,c=_,s=p}return d}function Fx(n,t,r,s){if(s(t,r)){const l=t.add(r)._mult(.5);Fx(n,t,l,s),Fx(n,l,r,s)}else n.push(r)}function KC(n,t){let r=n[0];const s=[r];for(let l=1;l<n.length;l++){const c=n[l];Fx(s,r,c,t),r=c}return s}const ry=Math.pow(2,14)-1,JC=-ry-1;function NA(n,t){const r=Math.round(n.x*t),s=Math.round(n.y*t);return n.x=Jt(r,JC,ry),n.y=Jt(s,JC,ry),(r<n.x||r>n.x+1||s<n.y||s>n.y+1)&&Q("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Vl(n,t,r){const s=n.loadGeometry(),l=n.extent,c=dt/l;if(t&&r&&r.projection.isReprojectedInTileSpace){const d=1<<t.z,{scale:h,x:p,y:m,projection:_}=r,y=v=>{const b=Ms((t.x+v.x/l)/d),E=lr((t.y+v.y/l)/d),C=_.project(b,E);v.x=(C.x*h-p)*l,v.y=(C.y*h-m)*l};for(let v=0;v<s.length;v++)if(1!==n.type)s[v]=YC(s[v],y,1);else{const b=[];for(const E of s[v])E.x<0||E.x>=l||E.y<0||E.y>=l||(y(E),b.push(E));s[v]=b}}for(const d of s)for(const h of d)NA(h,c);return s}function gu(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Vl(n):[]}}function Jp(n,t,r,s,l){n.emplaceBack(2*t+(s+1)/2,2*r+(l+1)/2)}function Lx(n,t,r){n.emplaceBack(t.x,t.y,t.z,16384*r[0],16384*r[1],16384*r[2])}class QC{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new qo,this.indexArray=new er,this.segments=new Bn,this.programConfigurations=new dd(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s,l){const c=this.layers[0],d=[];let h=null;"circle"===c.type&&(h=c.layout.get("circle-sort-key"));for(const{feature:m,id:_,index:y,sourceLayerIndex:v}of t){const b=this.layers[0]._featureFilter.needGeometry,E=gu(m,b);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),E,s))continue;const C=h?h.evaluate(E,{},s):void 0,S={id:_,properties:m.properties,type:m.type,sourceLayerIndex:v,index:y,geometry:b?E.geometry:Vl(m,s,l),patterns:{},sortKey:C};d.push(S)}h&&d.sort((m,_)=>m.sortKey-_.sortKey);let p=null;"globe"===l.projection.name&&(this.globeExtVertexArray=new Pp,p=l.projection);for(const m of d){const{geometry:_,index:y,sourceLayerIndex:v}=m,b=t[y].feature;this.addFeature(m,_,y,r.availableImages,s,p,r.brightness),r.featureIndex.insert(b,_,y,v,this.index)}}update(t,r,s,l,c){const d=0!==Object.keys(t).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,d?this.stateDependentLayers:this.layers,s,l,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gA.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Ol.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,r,s,l,c,d,h){for(const p of r)for(const m of p){const _=m.x,y=m.y;if(_<0||_>=dt||y<0||y>=dt)continue;if(d){const E=d.projectTilePoint(_,y,c),C=d.upVector(c,_,y),S=this.globeExtVertexArray;Lx(S,E,C),Lx(S,E,C),Lx(S,E,C),Lx(S,E,C)}const v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),b=v.vertexLength;Jp(this.layoutVertexArray,_,y,-1,-1),Jp(this.layoutVertexArray,_,y,1,-1),Jp(this.layoutVertexArray,_,y,1,1),Jp(this.layoutVertexArray,_,y,-1,1),this.indexArray.emplaceBack(b,b+1,b+2),this.indexArray.emplaceBack(b,b+2,b+3),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},l,c,h)}}function Gh(n,t){for(let r=0;r<n.length;r++)if(Ga(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Ga(n,t[r]))return!0;return!!tm(n,t)}function Qp(n,t,r){return!!Ga(n,t)||!!Bx(t,n,r)}function Nx(n,t){if(1===n.length)return jx(t,n[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let l=0;l<s.length;l++)if(Ga(n,s[l]))return!0}for(let r=0;r<n.length;r++)if(jx(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(tm(n,t[r]))return!0;return!1}function tM(n,t,r){if(n.length>1){if(tm(n,t))return!0;for(let s=0;s<t.length;s++)if(Bx(t[s],n,r))return!0}for(let s=0;s<n.length;s++)if(Bx(n[s],t,r))return!0;return!1}function tm(n,t){if(0===n.length||0===t.length)return!1;for(let r=0;r<n.length-1;r++){const s=n[r],l=n[r+1];for(let c=0;c<t.length-1;c++)if(zx(s,l,t[c],t[c+1]))return!0}return!1}function zx(n,t,r,s){return wt(n,r,s)!==wt(t,r,s)&&wt(n,t,r)!==wt(n,t,s)}function Bx(n,t,r){const s=r*r;if(1===t.length)return n.distSqr(t[0])<s;for(let l=1;l<t.length;l++)if(Vx(n,t[l-1],t[l])<s)return!0;return!1}function Vx(n,t,r){const s=t.distSqr(r);if(0===s)return n.distSqr(t);const l=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/s;return n.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function jx(n,t){let r,s,l,c=!1;for(let d=0;d<n.length;d++){r=n[d];for(let h=0,p=r.length-1;h<r.length;p=h++)s=r[h],l=r[p],s.y>t.y!=l.y>t.y&&t.x<(l.x-s.x)*(t.y-s.y)/(l.y-s.y)+s.x&&(c=!c)}return c}function Ga(n,t){let r=!1;for(let s=0,l=n.length-1;s<n.length;l=s++){const c=n[s],d=n[l];c.y>t.y!=d.y>t.y&&t.x<(d.x-c.x)*(t.y-c.y)/(d.y-c.y)+c.x&&(r=!r)}return r}function zA(n,t,r,s,l){for(const d of n)if(t<=d.x&&r<=d.y&&s>=d.x&&l>=d.y)return!0;const c=[new nt(t,r),new nt(t,l),new nt(s,l),new nt(s,r)];if(n.length>2)for(const d of c)if(Ga(n,d))return!0;for(let d=0;d<n.length-1;d++)if(Ux(n[d],n[d+1],c))return!0;return!1}function Ux(n,t,r){const s=r[0],l=r[2];if(n.x<s.x&&t.x<s.x||n.x>l.x&&t.x>l.x||n.y<s.y&&t.y<s.y||n.y>l.y&&t.y>l.y)return!1;const c=wt(n,t,r[0]);return c!==wt(n,t,r[1])||c!==wt(n,t,r[2])||c!==wt(n,t,r[3])}function qh(n,t,r,s,l,c){let d=t.y-n.y,h=n.x-t.x;if(c=c||0){const p=d*d+h*h;if(0===p)return!0;const m=Math.sqrt(p);d/=m,h/=m}return!((r.x-n.x)*d+(r.y-n.y)*h-c<0||(s.x-n.x)*d+(s.y-n.y)*h-c<0||(l.x-n.x)*d+(l.y-n.y)*h-c<0)}function em(n,t,r,s,l,c,d){return!(qh(n,t,s,l,c,d)||qh(t,r,s,l,c,d)||qh(r,n,s,l,c,d)||qh(s,l,n,t,r,d)||qh(l,c,n,t,r,d)||qh(c,s,n,t,r,d))}function wd(n,t,r){const s=t.paint.get(n).value;return"constant"===s.kind?s.value:r.programConfigurations.get(t.id).getMaxValue(n)}function nm(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function _u(n,t,r,s,l){if(!t[0]&&!t[1])return n;const c=nt.convert(t)._mult(l);"viewport"===r&&c._rotate(-s);const d=[];for(let h=0;h<n.length;h++)d.push(n[h].sub(c));return d}function eM(n,t,r,s){const l=nt.convert(n)._mult(s);return"viewport"===t&&l._rotate(-r),l}Xt(QC,"CircleBucket",{omit:["layers"]});const $x=new Ei({"circle-sort-key":new se(J.layout_circle["circle-sort-key"]),visibility:new Dt(J.layout_circle.visibility)});var oy={paint:new Ei({"circle-radius":new se(J.paint_circle["circle-radius"]),"circle-color":new se(J.paint_circle["circle-color"]),"circle-blur":new se(J.paint_circle["circle-blur"]),"circle-opacity":new se(J.paint_circle["circle-opacity"]),"circle-translate":new Dt(J.paint_circle["circle-translate"]),"circle-translate-anchor":new Dt(J.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dt(J.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dt(J.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new se(J.paint_circle["circle-stroke-width"]),"circle-stroke-color":new se(J.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new se(J.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Dt(J.paint_circle["circle-emissive-strength"])}),layout:$x};const BA=rt.create(),Hx=(n,t,r,s,l,c)=>{const d=n.transform,h="globe"===d.projection.name;let p;if("map"===c.paint.get("circle-pitch-alignment"))if(h){const _=jC(d.zoom,t.canonical)*d._pixelsPerMercatorPixel;p=Float32Array.from([_,0,0,_])}else p=d.calculatePixelsToTileUnitsMatrix(r);else p=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const m={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(d.projection),u_matrix:n.translatePosMatrix(t.projMatrix,r,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:kt.devicePixelRatio,u_extrude_scale:p,u_inv_rot_matrix:BA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(h){m.u_inv_rot_matrix=s,m.u_merc_center=l,m.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],m.u_zoom_transition=Br(d.zoom);const _=l[0]*dt,y=l[1]*dt;m.u_up_dir=d.projection.upVector(new ma(0,0,0),_,y)}return m},im=n=>{const t=[];return"map"===n.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===n.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Ss(n,t,r,s,l,c,d,h,p){if(c&&n.queryGeometry.isAboveHorizon)return!1;c&&(p*=n.pixelToTileUnitsFactor);const m=n.tileID.canonical,_=r.projection.upVectorScale(m,r.center.lat,r.worldSize).metersToTile;for(const y of t)for(const v of y){const b=v.add(h),E=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(b.x,b.y,!0):0,C=r.projection.projectTilePoint(b.x,b.y,m);if(E>0){const R=r.projection.upVector(m,b.x,b.y);C.x+=R[0]*_*E,C.y+=R[1]*_*E,C.z+=R[2]*_*E}const S=c?b:Wh(C.x,C.y,C.z,s),M=c?n.tilespaceRays.map(R=>jA(R,E)):n.queryGeometry.screenGeometry,D=Fn.transformMat4([],[C.x,C.y,C.z,1],s);if(!d&&c?p*=D[3]/r.cameraToCenterDistance:d&&!c&&(p*=r.cameraToCenterDistance/D[3]),c){const R=lr((v.y/dt+m.y)/(1<<m.z));p/=r.projection.pixelsPerMeter(R,1)/Ln(1,R)}if(Qp(M,S,p))return!0}return!1}function Wh(n,t,r,s){const l=Fn.transformMat4([],[n,t,r,1],s);return new nt(l[0]/l[3],l[1]/l[3])}const sy=q.fromValues(0,0,0),VA=q.fromValues(0,0,1);function jA(n,t){const r=q.create();return sy[2]=t,n.intersectsPlane(sy,VA,r),new nt(r[0],r[1])}class Gx extends QC{}function Ed(n,{width:t,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*s)throw new RangeError("mismatched image size")}else l=new Uint8Array(t*r*s);return n.width=t,n.height=r,n.data=l,n}function nM(n,t,r){const{width:s,height:l}=t;s===n.width&&l===n.height||(qx(n,t,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,l)},r),n.width=s,n.height=l,n.data=t.data)}function qx(n,t,r,s,l,c){if(0===l.width||0===l.height)return t;if(l.width>n.width||l.height>n.height||r.x>n.width-l.width||r.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||s.x>t.width-l.width||s.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const d=n.data,h=t.data;for(let p=0;p<l.height;p++){const m=((r.y+p)*n.width+r.x)*c,_=((s.y+p)*t.width+s.x)*c;for(let y=0;y<l.width*c;y++)h[_+y]=d[m+y]}return t}Xt(Gx,"HeatmapBucket",{omit:["layers"]});class Mc{constructor(t,r){Ed(this,t,1,r)}resize(t){nM(this,new Mc(t),1)}clone(){return new Mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,c){qx(t,r,s,l,c,1)}}class Pi{constructor(t,r){Ed(this,t,4,r)}resize(t){nM(this,new Pi(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Pi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,c){qx(t,r,s,l,c,4)}}class rm{constructor(t,r){this.width=t.width,this.height=t.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}Xt(Mc,"AlphaImage"),Xt(Pi,"RGBAImage");const UA=new Ei({visibility:new Dt(J.layout_heatmap.visibility)});var iM={paint:new Ei({"heatmap-radius":new se(J.paint_heatmap["heatmap-radius"]),"heatmap-weight":new se(J.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dt(J.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ap(J.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dt(J.paint_heatmap["heatmap-opacity"])}),layout:UA};function qa(n){const t={},r=n.resolution||256,s=n.clips?n.clips.length:1,l=n.image||new Pi({width:r,height:s}),c=(d,h,p)=>{t[n.evaluationKey]=p;const m=n.expression.evaluate(t);m&&(l.data[d+h+0]=Math.floor(255*m.r/m.a),l.data[d+h+1]=Math.floor(255*m.g/m.a),l.data[d+h+2]=Math.floor(255*m.b/m.a),l.data[d+h+3]=Math.floor(255*m.a))};if(n.clips)for(let d=0,h=0;d<s;++d,h+=4*r)for(let p=0,m=0;p<r;p++,m+=4){const _=p/(r-1),{start:y,end:v}=n.clips[d];c(h,m,y*(1-_)+v*_)}else for(let d=0,h=0;d<r;d++,h+=4)c(0,h,d/(r-1));return l}const TF=new Ei({visibility:new Dt(J.layout_hillshade.visibility)});var yu={paint:new Ei({"hillshade-illumination-direction":new Dt(J.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Dt(J.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dt(J.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dt(J.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dt(J.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dt(J.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Dt(J.paint_hillshade["hillshade-emissive-strength"])}),layout:TF};const Wx=pn([{name:"a_pos",components:2,type:"Int16"}],4),{members:$A}=Wx;var rM={exports:{}};function Zx(n,t,r){r=r||2;var s,l,c,d,h,p,m,_=t&&t.length,y=_?t[0]*r:n.length,v=om(n,0,y,r,!0),b=[];if(!v||v.next===v.prev)return b;if(_&&(v=function(C,S,M,D){var R,P,I,O=[];for(R=0,P=S.length;R<P;R++)(I=om(C,S[R]*D,R<P-1?S[R+1]*D:C.length,D,!1))===I.next&&(I.steiner=!0),O.push(Jx(I));for(O.sort(sm),R=0;R<O.length;R++)M=ay(O[R],M);return M}(n,t,v,r)),n.length>80*r){s=c=n[0],l=d=n[1];for(var E=r;E<y;E+=r)(h=n[E])<s&&(s=h),(p=n[E+1])<l&&(l=p),h>c&&(c=h),p>d&&(d=p);m=0!==(m=Math.max(c-s,d-l))?32767/m:0}return Md(v,b,r,s,l,m,0),b}function om(n,t,r,s,l){var c,d;if(l===sM(n,t,r,s)>0)for(c=t;c<r;c+=s)d=Qx(c,n[c],n[c+1],d);else for(c=r-s;c>=t;c-=s)d=Qx(c,n[c],n[c+1],d);return d&&vu(d,d.next)&&(um(d),d=d.next),d}function Cd(n,t){if(!n)return n;t||(t=n);var r,s=n;do{if(r=!1,s.steiner||!vu(s,s.next)&&0!==nr(s.prev,s,s.next))s=s.next;else{if(um(s),(s=t=s.prev)===s.next)break;r=!0}}while(r||s!==t);return t}function Md(n,t,r,s,l,c,d){if(n){!d&&c&&function(_,y,v,b){var E=_;do{0===E.z&&(E.z=am(E.x,E.y,y,v,b)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next}while(E!==_);E.prevZ.nextZ=null,E.prevZ=null,function(C){var S,M,D,R,P,I,O,F,L=1;do{for(M=C,C=null,P=null,I=0;M;){for(I++,D=M,O=0,S=0;S<L&&(O++,D=D.nextZ);S++);for(F=L;O>0||F>0&&D;)0!==O&&(0===F||!D||M.z<=D.z)?(R=M,M=M.nextZ,O--):(R=D,D=D.nextZ,F--),P?P.nextZ=R:C=R,R.prevZ=P,P=R;M=D}P.nextZ=null,L*=2}while(I>1)}(E)}(n,s,l,c);for(var h,p,m=n;n.prev!==n.next;)if(h=n.prev,p=n.next,c?Zh(n,s,l,c):Xx(n))t.push(h.i/r|0),t.push(n.i/r|0),t.push(p.i/r|0),um(n),n=p.next,m=p.next;else if((n=p)===m){d?1===d?Md(n=Yx(Cd(n),t,r),t,r,s,l,c,2):2===d&&Kx(n,t,r,s,l,c):Md(Cd(n),t,r,s,l,c,1);break}}}function Xx(n){var t=n.prev,r=n,s=n.next;if(nr(t,r,s)>=0)return!1;for(var l=t.x,c=r.x,d=s.x,h=t.y,p=r.y,m=s.y,_=l<c?l<d?l:d:c<d?c:d,y=h<p?h<m?h:m:p<m?p:m,v=l>c?l>d?l:d:c>d?c:d,b=h>p?h>m?h:m:p>m?p:m,E=s.next;E!==t;){if(E.x>=_&&E.x<=v&&E.y>=y&&E.y<=b&&Sc(l,h,c,p,d,m,E.x,E.y)&&nr(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function Zh(n,t,r,s){var l=n.prev,c=n,d=n.next;if(nr(l,c,d)>=0)return!1;for(var h=l.x,p=c.x,m=d.x,_=l.y,y=c.y,v=d.y,b=h<p?h<m?h:m:p<m?p:m,E=_<y?_<v?_:v:y<v?y:v,C=h>p?h>m?h:m:p>m?p:m,S=_>y?_>v?_:v:y>v?y:v,M=am(b,E,t,r,s),D=am(C,S,t,r,s),R=n.prevZ,P=n.nextZ;R&&R.z>=M&&P&&P.z<=D;){if(R.x>=b&&R.x<=C&&R.y>=E&&R.y<=S&&R!==l&&R!==d&&Sc(h,_,p,y,m,v,R.x,R.y)&&nr(R.prev,R,R.next)>=0||(R=R.prevZ,P.x>=b&&P.x<=C&&P.y>=E&&P.y<=S&&P!==l&&P!==d&&Sc(h,_,p,y,m,v,P.x,P.y)&&nr(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;R&&R.z>=M;){if(R.x>=b&&R.x<=C&&R.y>=E&&R.y<=S&&R!==l&&R!==d&&Sc(h,_,p,y,m,v,R.x,R.y)&&nr(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;P&&P.z<=D;){if(P.x>=b&&P.x<=C&&P.y>=E&&P.y<=S&&P!==l&&P!==d&&Sc(h,_,p,y,m,v,P.x,P.y)&&nr(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function Yx(n,t,r){var s=n;do{var l=s.prev,c=s.next.next;!vu(l,c)&&oM(l,s,s.next,c)&&cm(l,c)&&cm(c,l)&&(t.push(l.i/r|0),t.push(s.i/r|0),t.push(c.i/r|0),um(s),um(s.next),s=n=c),s=s.next}while(s!==n);return Cd(s)}function Kx(n,t,r,s,l,c){var d=n;do{for(var h=d.next.next;h!==d.prev;){if(d.i!==h.i&&DF(d,h)){var p=cy(d,h);return d=Cd(d,d.next),p=Cd(p,p.next),Md(d,t,r,s,l,c,0),void Md(p,t,r,s,l,c,0)}h=h.next}d=d.next}while(d!==n)}function sm(n,t){return n.x-t.x}function ay(n,t){var r=function(l,c){var d,h=c,p=l.x,m=l.y,_=-1/0;do{if(m<=h.y&&m>=h.next.y&&h.next.y!==h.y){var y=h.x+(m-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(y<=p&&y>_&&(_=y,d=h.x<h.next.x?h:h.next,y===p))return d}h=h.next}while(h!==c);if(!d)return null;var v,b=d,E=d.x,C=d.y,S=1/0;h=d;do{p>=h.x&&h.x>=E&&p!==h.x&&Sc(m<C?p:_,m,E,C,m<C?_:p,m,h.x,h.y)&&(v=Math.abs(m-h.y)/(p-h.x),cm(h,l)&&(v<S||v===S&&(h.x>d.x||h.x===d.x&&Xh(d,h)))&&(d=h,S=v)),h=h.next}while(h!==b);return d}(n,t);if(!r)return t;var s=cy(r,n);return Cd(s,s.next),Cd(r,r.next)}function Xh(n,t){return nr(n.prev,n,t.prev)<0&&nr(t.next,n,n.next)<0}function am(n,t,r,s,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jx(n){var t=n,r=n;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==n);return r}function Sc(n,t,r,s,l,c,d,h){return(l-d)*(t-h)>=(n-d)*(c-h)&&(n-d)*(s-h)>=(r-d)*(t-h)&&(r-d)*(c-h)>=(l-d)*(s-h)}function DF(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,s){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&oM(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(n,t)&&(cm(n,t)&&cm(t,n)&&function(r,s){var l=r,c=!1,d=(r.x+s.x)/2,h=(r.y+s.y)/2;do{l.y>h!=l.next.y>h&&l.next.y!==l.y&&d<(l.next.x-l.x)*(h-l.y)/(l.next.y-l.y)+l.x&&(c=!c),l=l.next}while(l!==r);return c}(n,t)&&(nr(n.prev,n,t.prev)||nr(n,t.prev,t))||vu(n,t)&&nr(n.prev,n,n.next)>0&&nr(t.prev,t,t.next)>0)}function nr(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function vu(n,t){return n.x===t.x&&n.y===t.y}function oM(n,t,r,s){var l=ly(nr(n,t,r)),c=ly(nr(n,t,s)),d=ly(nr(r,s,n)),h=ly(nr(r,s,t));return l!==c&&d!==h||!(0!==l||!lm(n,r,t))||!(0!==c||!lm(n,s,t))||!(0!==d||!lm(r,n,s))||!(0!==h||!lm(r,t,s))}function lm(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function ly(n){return n>0?1:n<0?-1:0}function cm(n,t){return nr(n.prev,n,n.next)<0?nr(n,t,n.next)>=0&&nr(n,n.prev,t)>=0:nr(n,t,n.prev)<0||nr(n,n.next,t)<0}function cy(n,t){var r=new tb(n.i,n.x,n.y),s=new tb(t.i,t.x,t.y),l=n.next,c=t.prev;return n.next=t,t.prev=n,r.next=l,l.prev=r,s.next=r,r.prev=s,c.next=s,s.prev=c,s}function Qx(n,t,r,s){var l=new tb(n,t,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function um(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function tb(n,t,r){this.i=n,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sM(n,t,r,s){for(var l=0,c=t,d=r-s;c<r;c+=s)l+=(n[d]-n[c])*(n[c+1]+n[d+1]),d=c;return l}rM.exports=Zx,rM.exports.default=Zx,Zx.deviation=function(n,t,r,s){var l=t&&t.length,c=Math.abs(sM(n,0,l?t[0]*r:n.length,r));if(l)for(var d=0,h=t.length;d<h;d++)c-=Math.abs(sM(n,t[d]*r,d<h-1?t[d+1]*r:n.length,r));var p=0;for(d=0;d<s.length;d+=3){var m=s[d]*r,_=s[d+1]*r,y=s[d+2]*r;p+=Math.abs((n[m]-n[y])*(n[_+1]-n[m+1])-(n[m]-n[_])*(n[y+1]-n[m+1]))}return 0===c&&0===p?0:Math.abs((p-c)/c)},Zx.flatten=function(n){for(var t=n[0][0].length,r={vertices:[],holes:[],dimensions:t},s=0,l=0;l<n.length;l++){for(var c=0;c<n[l].length;c++)for(var d=0;d<t;d++)r.vertices.push(n[l][c][d]);l>0&&r.holes.push(s+=n[l-1].length)}return r};var uy=hs(rM.exports);function Yh(n,t){const r=n.length;if(r<=1)return[n];const s=[];let l,c;for(let d=0;d<r;d++){const h=Mt(n[d]);0!==h&&(n[d].area=Math.abs(h),void 0===c&&(c=h<0),c===h<0?(l&&s.push(l),l=[n[d]]):l.push(n[d]))}if(l&&s.push(l),t>1)for(let d=0;d<s.length;d++)s[d].length<=t||(UI(s[d],t,1,s[d].length-1,eb),s[d]=s[d].slice(0,t));return s}function eb(n,t){return t.area-n.area}function nb(n,t,r){const s=r.patternDependencies;let l=!1;for(const c of t){const d=c.paint.get(`${n}-pattern`);d.isConstant()||(l=!0);const h=d.constantOr(null);h&&(l=!0,s[h]=!0)}return l}function dy(n,t,r,s,l){const c=l.patternDependencies;for(const d of t){const h=d.paint.get(`${n}-pattern`).value;if("constant"!==h.kind){let p=h.evaluate({zoom:s},r,{},l.availableImages);p=p&&p.name?p.name:p,c[p]=!0,r.patterns[d.id]=p}}return r}class Kh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qo,this.indexArray=new er,this.indexArray2=new Va,this.programConfigurations=new dd(t.layers,t.zoom),this.segments=new Bn,this.segments2=new Bn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection}populate(t,r,s,l){this.hasPattern=nb("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:h,id:p,index:m,sourceLayerIndex:_}of t){const y=this.layers[0]._featureFilter.needGeometry,v=gu(h,y);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),v,s))continue;const b=c?c.evaluate(v,{},s,r.availableImages):void 0,E={id:p,properties:h.properties,type:h.type,sourceLayerIndex:_,index:m,geometry:y?v.geometry:Vl(h,s,l),patterns:{},sortKey:b};d.push(E)}c&&d.sort((h,p)=>h.sortKey-p.sortKey);for(const h of d){const{geometry:p,index:m,sourceLayerIndex:_}=h;if(this.hasPattern){const y=dy("fill",this.layers,h,this.zoom,r);this.patternFeatures.push(y)}else this.addFeature(h,p,m,s,{},r.availableImages,r.brightness);r.featureIndex.insert(t[m].feature,p,m,_,this.index)}}update(t,r,s,l,c){const d=0!==Object.keys(t).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,d?this.stateDependentLayers:this.layers,s,l,c)}addFeatures(t,r,s,l,c,d){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,s,l,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$A),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,l,c,d=[],h){for(const p of Yh(r,500)){let m=0;for(const C of p)m+=C.length;const _=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),y=_.vertexLength,v=[],b=[];for(const C of p){if(0===C.length)continue;C!==p[0]&&b.push(v.length/2);const S=this.segments2.prepareSegment(C.length,this.layoutVertexArray,this.indexArray2),M=S.vertexLength;this.layoutVertexArray.emplaceBack(C[0].x,C[0].y),this.indexArray2.emplaceBack(M+C.length-1,M),v.push(C[0].x),v.push(C[0].y);for(let D=1;D<C.length;D++)this.layoutVertexArray.emplaceBack(C[D].x,C[D].y),this.indexArray2.emplaceBack(M+D-1,M+D),v.push(C[D].x),v.push(C[D].y);S.vertexLength+=C.length,S.primitiveLength+=C.length}const E=uy(v,b);for(let C=0;C<E.length;C+=3)this.indexArray.emplaceBack(y+E[C],y+E[C+1],y+E[C+2]);_.vertexLength+=m,_.primitiveLength+=E.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,c,d,l,h)}}Xt(Kh,"FillBucket",{omit:["layers","patternFeatures"]});const hy=new Ei({"fill-sort-key":new se(J.layout_fill["fill-sort-key"]),visibility:new Dt(J.layout_fill.visibility)});var HA={paint:new Ei({"fill-antialias":new Dt(J.paint_fill["fill-antialias"]),"fill-opacity":new se(J.paint_fill["fill-opacity"]),"fill-color":new se(J.paint_fill["fill-color"]),"fill-outline-color":new se(J.paint_fill["fill-outline-color"]),"fill-translate":new Dt(J.paint_fill["fill-translate"]),"fill-translate-anchor":new Dt(J.paint_fill["fill-translate-anchor"]),"fill-pattern":new se(J.paint_fill["fill-pattern"]),"fill-emissive-strength":new Dt(J.paint_fill["fill-emissive-strength"])}),layout:hy};const aM=pn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),GA=pn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),lM=pn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),IF=pn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),qA=pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:dm}=aM;var fy={},Jh=Xc,Gi=Qh;function Qh(n,t,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=l,n.readFields(hm,this,t)}function hm(n,t,r){1==n?t.id=r.readVarint():2==n?function(s,l){for(var c=s.readVarint()+s.pos;s.pos<c;){var d=l._keys[s.readVarint()],h=l._values[s.readVarint()];l.properties[d]=h}}(r,t):3==n?t.type=r.readVarint():4==n&&(t._geometry=r.pos)}function Tc(n){for(var t,r,s=0,l=0,c=n.length,d=c-1;l<c;d=l++)s+=((r=n[d]).x-(t=n[l]).x)*(t.y+r.y);return s}Qh.types=["Unknown","Point","LineString","Polygon"],Qh.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,r=n.readVarint()+n.pos,s=1,l=0,c=0,d=0,h=[];n.pos<r;){if(l<=0){var p=n.readVarint();s=7&p,l=p>>3}if(l--,1===s||2===s)c+=n.readSVarint(),d+=n.readSVarint(),1===s&&(t&&h.push(t),t=[]),t.push(new Jh(c,d));else{if(7!==s)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&h.push(t),h},Qh.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,r=1,s=0,l=0,c=0,d=1/0,h=-1/0,p=1/0,m=-1/0;n.pos<t;){if(s<=0){var _=n.readVarint();r=7&_,s=_>>3}if(s--,1===r||2===r)(l+=n.readSVarint())<d&&(d=l),l>h&&(h=l),(c+=n.readSVarint())<p&&(p=c),c>m&&(m=c);else if(7!==r)throw new Error("unknown command "+r)}return[d,p,h,m]},Qh.prototype.toGeoJSON=function(n,t,r){var s,l,c=this.extent*Math.pow(2,r),d=this.extent*n,h=this.extent*t,p=this.loadGeometry(),m=Qh.types[this.type];function _(b){for(var E=0;E<b.length;E++){var C=b[E];b[E]=[360*(C.x+d)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(C.y+h)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var y=[];for(s=0;s<p.length;s++)y[s]=p[s][0];_(p=y);break;case 2:for(s=0;s<p.length;s++)_(p[s]);break;case 3:for(p=function(b){var E=b.length;if(E<=1)return[b];for(var C,S,M=[],D=0;D<E;D++){var R=Tc(b[D]);0!==R&&(void 0===S&&(S=R<0),S===R<0?(C&&M.push(C),C=[b[D]]):C.push(b[D]))}return C&&M.push(C),M}(p),s=0;s<p.length;s++)for(l=0;l<p[s].length;l++)_(p[s][l])}1===p.length?p=p[0]:m="Multi"+m;var v={type:"Feature",geometry:{type:m,coordinates:p},properties:this.properties};return"id"in this&&(v.id=this.id),v};var WA=Gi,cM=xu;function xu(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(ZA,this,t),this.length=this._features.length}function ZA(n,t,r){15===n?t.version=r.readVarint():1===n?t.name=r.readString():5===n?t.extent=r.readVarint():2===n?t._features.push(r.pos):3===n?t._keys.push(r.readString()):4===n&&t._values.push(function(s){for(var l=null,c=s.readVarint()+s.pos;s.pos<c;){var d=s.readVarint()>>3;l=1===d?s.readString():2===d?s.readFloat():3===d?s.readDouble():4===d?s.readVarint64():5===d?s.readVarint():6===d?s.readSVarint():7===d?s.readBoolean():null}return l}(r))}xu.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new WA(this._pbf,t,this.extent,this._keys,this._values)};var ib=cM;function AF(n,t,r){if(3===n){var s=new ib(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}var fm=fy.VectorTile=function(n,t){this.layers=n.readFields(AF,{},t)},pm=fy.VectorTileFeature=Gi;function py(n,t,r,s){const l=[],c=0===s?(d,h,p,m,_,y)=>{d.push(new nt(y,p+(y-h)/(m-h)*(_-p)))}:(d,h,p,m,_,y)=>{d.push(new nt(h+(y-p)/(_-p)*(m-h),y))};for(const d of n){const h=[];for(const p of d){if(p.length<=2)continue;const m=[];for(let v=0;v<p.length-1;v++){const b=p[v].x,E=p[v].y,C=p[v+1].x,S=p[v+1].y,M=0===s?b:E,D=0===s?C:S;M<t?D>t&&c(m,b,E,C,S,t):M>r?D<r&&c(m,b,E,C,S,r):m.push(p[v]),D<t&&M>=t&&c(m,b,E,C,S,t),D>r&&M<=r&&c(m,b,E,C,S,r)}let _=p[p.length-1];const y=0===s?_.x:_.y;y>=t&&y<=r&&m.push(_),m.length&&(_=m[m.length-1],m[0].x===_.x&&m[0].y===_.y||m.push(m[0]),h.push(m))}h.length&&l.push(h)}return l}fy.VectorTileLayer=cM;class uM{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var dM={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(n,t,r,s,l){var c,d,h=8*l-s-1,p=(1<<h)-1,m=p>>1,_=-7,y=r?l-1:0,v=r?-1:1,b=n[t+y];for(y+=v,c=b&(1<<-_)-1,b>>=-_,_+=h;_>0;c=256*c+n[t+y],y+=v,_-=8);for(d=c&(1<<-_)-1,c>>=-_,_+=s;_>0;d=256*d+n[t+y],y+=v,_-=8);if(0===c)c=1-m;else{if(c===p)return d?NaN:1/0*(b?-1:1);d+=Math.pow(2,s),c-=m}return(b?-1:1)*d*Math.pow(2,c-s)},write:function(n,t,r,s,l,c){var d,h,p,m=8*c-l-1,_=(1<<m)-1,y=_>>1,v=23===l?Math.pow(2,-24)-Math.pow(2,-77):0,b=s?0:c-1,E=s?1:-1,C=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(h=isNaN(t)?1:0,d=_):(d=Math.floor(Math.log(t)/Math.LN2),t*(p=Math.pow(2,-d))<1&&(d--,p*=2),(t+=d+y>=1?v/p:v*Math.pow(2,1-y))*p>=2&&(d++,p/=2),d+y>=_?(h=0,d=_):d+y>=1?(h=(t*p-1)*Math.pow(2,l),d+=y):(h=t*Math.pow(2,y-1)*Math.pow(2,l),d=0));l>=8;n[r+b]=255&h,b+=E,h/=256,l-=8);for(d=d<<l|h,m+=l;m>0;n[r+b]=255&d,b+=E,d/=256,m-=8);n[r+b-E]|=128*C}},hM=gi,mm=dM;function gi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}gi.Varint=0,gi.Fixed64=1,gi.Bytes=2,gi.Fixed32=5;var rb=4294967296,XA=1/rb,ob=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jl(n){return n.type===gi.Bytes?n.readVarint()+n.pos:n.pos+1}function sb(n,t,r){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=n;l--)r.buf[l+s]=r.buf[l]}function RF(n,t){for(var r=0;r<n.length;r++)t.writeVarint(n[r])}function ab(n,t){for(var r=0;r<n.length;r++)t.writeSVarint(n[r])}function Wa(n,t){for(var r=0;r<n.length;r++)t.writeFloat(n[r])}function lb(n,t){for(var r=0;r<n.length;r++)t.writeDouble(n[r])}function YA(n,t){for(var r=0;r<n.length;r++)t.writeBoolean(n[r])}function PF(n,t){for(var r=0;r<n.length;r++)t.writeFixed32(n[r])}function KA(n,t){for(var r=0;r<n.length;r++)t.writeSFixed32(n[r])}function cb(n,t){for(var r=0;r<n.length;r++)t.writeFixed64(n[r])}function oi(n,t){for(var r=0;r<n.length;r++)t.writeSFixed64(n[r])}function gm(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function tf(n,t,r){n[r]=t,n[r+1]=t>>>8,n[r+2]=t>>>16,n[r+3]=t>>>24}function JA(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}gi.prototype={destroy:function(){this.buf=null},readFields:function(n,t,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,c=this.pos;this.type=7&s,n(l,t,this),this.pos===c&&this.skip(s)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=gm(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=JA(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=gm(this.buf,this.pos)+gm(this.buf,this.pos+4)*rb;return this.pos+=8,n},readSFixed64:function(){var n=gm(this.buf,this.pos)+JA(this.buf,this.pos+4)*rb;return this.pos+=8,n},readFloat:function(){var n=mm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=mm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,r,s=this.buf;return t=127&(r=s[this.pos++]),r<128?t:(t|=(127&(r=s[this.pos++]))<<7,r<128?t:(t|=(127&(r=s[this.pos++]))<<14,r<128?t:(t|=(127&(r=s[this.pos++]))<<21,r<128?t:function(l,c,d){var h,p,m=d.buf;if(h=(112&(p=m[d.pos++]))>>4,p<128||(h|=(127&(p=m[d.pos++]))<<3,p<128)||(h|=(127&(p=m[d.pos++]))<<10,p<128)||(h|=(127&(p=m[d.pos++]))<<17,p<128)||(h|=(127&(p=m[d.pos++]))<<24,p<128)||(h|=(1&(p=m[d.pos++]))<<31,p<128))return function Or(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}(l,h,c);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&ob?ob.decode(this.buf.subarray(t,n)):function(r,s,l){for(var c="",d=s;d<l;){var h,p,m,_=r[d],y=null,v=_>239?4:_>223?3:_>191?2:1;if(d+v>l)break;1===v?_<128&&(y=_):2===v?128==(192&(h=r[d+1]))&&(y=(31&_)<<6|63&h)<=127&&(y=null):3===v?(p=r[d+2],128==(192&(h=r[d+1]))&&128==(192&p)&&((y=(15&_)<<12|(63&h)<<6|63&p)<=2047||y>=55296&&y<=57343)&&(y=null)):4===v&&(p=r[d+2],m=r[d+3],128==(192&(h=r[d+1]))&&128==(192&p)&&128==(192&m)&&((y=(15&_)<<18|(63&h)<<12|(63&p)<<6|63&m)<=65535||y>=1114112)&&(y=null)),null===y?(y=65533,v=1):y>65535&&(y-=65536,c+=String.fromCharCode(y>>>10&1023|55296),y=56320|1023&y),c+=String.fromCharCode(y),d+=v}return c}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==gi.Bytes)return n.push(this.readVarint(t));var r=jl(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==gi.Bytes)return n.push(this.readSVarint());var t=jl(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==gi.Bytes)return n.push(this.readBoolean());var t=jl(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==gi.Bytes)return n.push(this.readFloat());var t=jl(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==gi.Bytes)return n.push(this.readDouble());var t=jl(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==gi.Bytes)return n.push(this.readFixed32());var t=jl(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==gi.Bytes)return n.push(this.readSFixed32());var t=jl(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==gi.Bytes)return n.push(this.readFixed64());var t=jl(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==gi.Bytes)return n.push(this.readSFixed64());var t=jl(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===gi.Varint)for(;this.buf[this.pos++]>127;);else if(t===gi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===gi.Fixed32)this.pos+=4;else{if(t!==gi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),tf(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),tf(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),tf(this.buf,-1&n,this.pos),tf(this.buf,Math.floor(n*XA),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),tf(this.buf,-1&n,this.pos),tf(this.buf,Math.floor(n*XA),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,r){var s,l,c,h;if(t>=0?(s=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,l=l+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),c=s,(h=r).buf[h.pos++]=127&c|128,c>>>=7,h.buf[h.pos++]=127&c|128,c>>>=7,h.buf[h.pos++]=127&c|128,c>>>=7,h.buf[h.pos++]=127&c|128,h.buf[h.pos]=127&(c>>>=7),function(c,d){var h=(7&c)<<4;d.buf[d.pos++]|=h|((c>>>=3)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c)))))}(l,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(s,l,c){for(var d,h,p=0;p<l.length;p++){if((d=l.charCodeAt(p))>55295&&d<57344){if(!h){d>56319||p+1===l.length?(s[c++]=239,s[c++]=191,s[c++]=189):h=d;continue}if(d<56320){s[c++]=239,s[c++]=191,s[c++]=189,h=d;continue}d=h-55296<<10|d-56320|65536,h=null}else h&&(s[c++]=239,s[c++]=191,s[c++]=189,h=null);d<128?s[c++]=d:(d<2048?s[c++]=d>>6|192:(d<65536?s[c++]=d>>12|224:(s[c++]=d>>18|240,s[c++]=d>>12&63|128),s[c++]=d>>6&63|128),s[c++]=63&d|128)}return c}(this.buf,n,this.pos);var r=this.pos-t;r>=128&&sb(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),mm.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),mm.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,t){this.pos++;var r=this.pos;n(t,this);var s=this.pos-r;s>=128&&sb(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,t,r){this.writeTag(n,gi.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,RF,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,ab,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,YA,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,Wa,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,lb,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,PF,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,KA,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,cb,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,oi,t)},writeBytesField:function(n,t){this.writeTag(n,gi.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,gi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,gi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,gi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,gi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,gi.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,gi.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,gi.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,gi.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,gi.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var Je=hs(hM);const QA=["tile","layer","source","sourceLayer","state"];class my{constructor(t,r,s,l,c){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=s,this._y=l,this.properties=t.properties,this.id=c}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const r of QA)void 0!==this[r]&&(t[r]=this[r]);return t}}class t2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,s){const l=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][l]=this.stateChanges[t][l]||{},Yt(this.stateChanges[t][l],s),null===this.deletedStates[t]){this.deletedStates[t]={};for(const c in this.state[t])c!==l&&(this.deletedStates[t][c]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][l]){this.deletedStates[t][l]={};for(const c in this.state[t][l])s[c]||(this.deletedStates[t][l][c]=null)}else for(const c in s)this.deletedStates[t]&&this.deletedStates[t][l]&&null===this.deletedStates[t][l][c]&&delete this.deletedStates[t][l][c]}removeFeatureState(t,r,s){if(null===this.deletedStates[t])return;const l=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&void 0!==r)null!==this.deletedStates[t][l]&&(this.deletedStates[t][l]=this.deletedStates[t][l]||{},this.deletedStates[t][l][s]=null);else if(void 0!==r)if(this.stateChanges[t]&&this.stateChanges[t][l])for(s in this.deletedStates[t][l]={},this.stateChanges[t][l])this.deletedStates[t][l][s]=null;else this.deletedStates[t][l]=null;else this.deletedStates[t]=null}getState(t,r){const s=String(r),l=Yt({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const c=this.deletedStates[t][r];if(null===c)return{};for(const d in c)delete l[d]}return l}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const s={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const c={};for(const d in this.stateChanges[l])this.state[l][d]||(this.state[l][d]={}),Yt(this.state[l][d],this.stateChanges[l][d]),c[d]=this.state[l][d];s[l]=c}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const c={};if(null===this.deletedStates[l])for(const d in this.state[l])c[d]={},this.state[l][d]={};else for(const d in this.deletedStates[l]){if(null===this.deletedStates[l][d])this.state[l][d]={};else if(this.state[l][d])for(const h of Object.keys(this.deletedStates[l][d]))delete this.state[l][d][h];c[d]=this.state[l][d]}s[l]=s[l]||{},Yt(s[l],c)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const l in t)t[l].setFeatureState(s,r)}}class fM{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const s=this.toIdx(t,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function gy(n,t,r,s){let l=0,c=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(s[d])<1e-15){if(r[d]<n[d]||r[d]>t[d])return null}else{const h=1/s[d];let p=(n[d]-r[d])*h,m=(t[d]-r[d])*h;if(p>m){const _=p;p=m,m=_}if(p>l&&(l=p),m<c&&(c=m),l>c)return null}return l}function ub(n,t,r,s,l,c,d,h,p,m,_){const y=s-n,v=l-t,b=c-r,E=d-n,C=h-t,S=p-r,M=_[1]*S-_[2]*C,D=_[2]*E-_[0]*S,R=_[0]*C-_[1]*E,P=y*M+v*D+b*R;if(Math.abs(P)<1e-15)return null;const I=1/P,O=m[0]-n,F=m[1]-t,L=m[2]-r,N=(O*M+F*D+L*R)*I;if(N<0||N>1)return null;const z=F*b-L*v,U=L*y-O*b,V=O*v-F*y,H=(_[0]*z+_[1]*U+_[2]*V)*I;return H<0||N+H>1?null:(E*z+C*U+S*V)*I}function db(n,t,r){return(n-t)/(r-t)}function pM(n,t,r,s,l,c,d,h,p){const m=1<<r,_=c-s,y=d-l,v=(n+1)/m*_+s,b=(t+0)/m*y+l,E=(t+1)/m*y+l;h[0]=(n+0)/m*_+s,h[1]=b,p[0]=v,p[1]=E}class hb{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(c){const d=Math.ceil(Math.log2(c.dim/8)),h=[];let p=Math.ceil(Math.pow(2,d));const m=1/p,_=(b,E,C,S,M)=>{const D=S?1:0,R=(b+1)*C-D,P=E*C,I=(E+1)*C-D;M[0]=b*C,M[1]=P,M[2]=R,M[3]=I};let y=new fM(p);const v=[];for(let b=0;b<p*p;b++){_(b%p,Math.floor(b/p),m,!1,v);const E=bu(v[0],v[1],c),C=bu(v[2],v[1],c),S=bu(v[2],v[3],c),M=bu(v[0],v[3],c);y.minimums.push(Math.min(E,C,S,M)),y.maximums.push(Math.max(E,C,S,M)),y.leaves.push(1)}for(h.push(y),p/=2;p>=1;p/=2){const b=h[h.length-1];y=new fM(p);for(let E=0;E<p*p;E++){_(E%p,Math.floor(E/p),2,!0,v);const C=b.getElevation(v[0],v[1]),S=b.getElevation(v[2],v[1]),M=b.getElevation(v[2],v[3]),D=b.getElevation(v[0],v[3]),R=b.isLeaf(v[0],v[1]),P=b.isLeaf(v[2],v[1]),I=b.isLeaf(v[2],v[3]),O=b.isLeaf(v[0],v[3]),F=Math.min(C.min,S.min,M.min,D.min),L=Math.max(C.max,S.max,M.max,D.max),N=R&&P&&I&&O;y.maximums.push(L),y.minimums.push(F),y.leaves.push(L-F<=5&&N?1:0)}h.push(y)}return h}(this.dem),s=r.length-1,l=r[s];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(t,r,s,l,c,d,h=1){return gy([t,r,-100],[s,l,this.maximums[0]*h],c,d)}raycast(t,r,s,l,c,d,h=1){if(!this.nodeCount)return null;const p=this.raycastRoot(t,r,s,l,c,d,h);if(null==p)return null;const m=[],_=[],y=[],v=[],b=[{idx:0,t:p,nodex:0,nodey:0,depth:0}];for(;b.length>0;){const{idx:E,t:C,nodex:S,nodey:M,depth:D}=b.pop();if(this.leaves[E]){pM(S,M,D,t,r,s,l,y,v);const P=1<<D,I=(S+0)/P,O=(S+1)/P,F=(M+0)/P,L=(M+1)/P,N=bu(I,F,this.dem)*h,z=bu(O,F,this.dem)*h,U=bu(O,L,this.dem)*h,V=bu(I,L,this.dem)*h,H=ub(y[0],y[1],N,v[0],y[1],z,v[0],v[1],U,c,d),j=ub(v[0],v[1],U,y[0],v[1],V,y[0],y[1],N,c,d),Z=Math.min(null!==H?H:Number.MAX_VALUE,null!==j?j:Number.MAX_VALUE);if(Z!==Number.MAX_VALUE)return Z;{const tt=q.scaleAndAdd([],c,d,C);if(fb(N,z,V,U,db(tt[0],y[0],v[0]),db(tt[1],y[1],v[1]))>=tt[2])return C}continue}let R=0;for(let P=0;P<this._siblingOffset.length;P++){pM((S<<1)+this._siblingOffset[P][0],(M<<1)+this._siblingOffset[P][1],D+1,t,r,s,l,y,v),y[2]=-100,v[2]=this.maximums[this.childOffsets[E]+P]*h;const I=gy(y,v,c,d);if(null!=I){const O=I;m[P]=O;let F=!1;for(let L=0;L<R&&!F;L++)O>=m[_[L]]&&(_.splice(L,0,P),F=!0);F||(_[R]=P),R++}}for(let P=0;P<R;P++){const I=_[P];b.push({idx:this.childOffsets[E]+I,t:m[I],nodex:(S<<1)+this._siblingOffset[I][0],nodey:(M<<1)+this._siblingOffset[I][1],depth:D+1})}}return null}_addNode(t,r,s){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,s,l,c){if(1===t[l].isLeaf(r,s))return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const d=l-1,h=t[d];let p=0,m=0;for(let _=0;_<this._siblingOffset.length;_++){const y=2*r+this._siblingOffset[_][0],v=2*s+this._siblingOffset[_][1],b=h.getElevation(y,v),E=h.isLeaf(y,v),C=this._addNode(b.min,b.max,E);E&&(p|=1<<_),m||(m=C)}for(let _=0;_<this._siblingOffset.length;_++)p&1<<_||this._construct(t,2*r+this._siblingOffset[_][0],2*s+this._siblingOffset[_][1],d,m+_)}}function fb(n,t,r,s,l,c){return _e(_e(n,r,c),_e(t,s,c),l)}function bu(n,t,r){const s=r.dim,l=Jt(n*s-.5,0,s-1),c=Jt(t*s-.5,0,s-1),d=Math.floor(l),h=Math.floor(c),p=Math.min(d+1,s-1),m=Math.min(h+1,s-1);return fb(r.get(d,h),r.get(p,h),r.get(d,m),r.get(p,m),l-d,c-h)}const mM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function pb(n,t,r){return(256*n*256+256*t+r)/10-1e4}function _y(n,t,r){return 256*n+t+r/256-32768}class va{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,s,l,c=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Q(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const d=this.dim=r.height-2,h=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,this._modifiedForSources={},!c){for(let p=0;p<d;p++)h[this._idx(-1,p)]=h[this._idx(0,p)],h[this._idx(d,p)]=h[this._idx(d-1,p)],h[this._idx(p,-1)]=h[this._idx(p,0)],h[this._idx(p,d)]=h[this._idx(p,d-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(d,-1)]=h[this._idx(d-1,0)],h[this._idx(-1,d)]=h[this._idx(0,d-1)],h[this._idx(d,d)]=h[this._idx(d-1,d-1)]}if(l){const p=new Float32Array(r.data.buffer),m="terrarium"===this.encoding?_y:pb;for(let _=0;_<h.length;++_){const y=4*_;p[_]=m(this.pixels[y],this.pixels[y+1],this.pixels[y+2])}this.encoding="float"}this._timestamp=kt.now()}_buildQuadTree(){this._tree=new hb(this)}get(t,r,s=!1){s&&(t=Jt(t,-1,this.dim),r=Jt(r,-1,this.dim));const l=this._idx(t,r);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[l];const c=4*l;return("terrarium"===this.encoding?_y:pb)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}set(t,r,s){const l=this._idx(t,r);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const p=this.floatView[l];return this.floatView[l]=s,s-p}const c=4*l,d=("terrarium"===this.encoding?_y:pb)(this.pixels[c],this.pixels[c+1],this.pixels[c+2]),h=va.pack(s,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[c]=h[0],this.pixels[c+1]=h[1],this.pixels[c+2]=h[2],s-d}static getUnpackVector(t){return mM[t]}get unpackVector(){return mM[this.encoding]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}static pack(t,r){const s=[0,0,0,0],l=va.getUnpackVector(r);let c=Math.floor((t+l[3])/l[2]);return s[2]=c%256,c=Math.floor(c/256),s[1]=c%256,c=Math.floor(c/256),s[0]=c,s}getPixels(){return"float"===this.encoding?new rm({width:this.stride,height:this.stride},this.pixels):new Pi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,c=r*this.dim+this.dim,d=s*this.dim,h=s*this.dim+this.dim;switch(r){case-1:l=c-1;break;case 1:c=l+1}switch(s){case-1:d=h-1;break;case 1:h=d+1}const p=-r*this.dim,m=-s*this.dim;for(let _=d;_<h;_++)for(let y=l;y<c;y++){const v=4*this._idx(y,_),b=4*this._idx(y+p,_+m);this.pixels[v+0]=t.pixels[b+0],this.pixels[v+1]=t.pixels[b+1],this.pixels[v+2]=t.pixels[b+2],this.pixels[v+3]=t.pixels[b+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Xt(va,"DEMData"),Xt(hb,"DemMinMaxQuadTree",{omit:["dem"]});class Dc{isDataAvailableAtPoint(t){const r=this._source();if(this.isUsingMockSource()||!r||t.y<0||t.y>1)return!1;const s=r.getSource().maxzoom,l=1<<s,c=Math.floor(t.x),d=Math.floor((t.x-c)*l),h=Math.floor(t.y*l),p=this.findDEMTileFor(new tn(s,c,s,d,h));return!(!p||!p.dem)}getAtPointOrZero(t,r=0){return this.getAtPoint(t,r)||0}getAtPoint(t,r,s=!0){if(this.isUsingMockSource())return null;null==r&&(r=null);const l=this._source();if(!l||t.y<0||t.y>1)return r;const c=l.getSource().maxzoom,d=1<<c,h=Math.floor(t.x),p=t.x-h,m=new tn(c,h,c,Math.floor(p*d),Math.floor(t.y*d)),_=this.findDEMTileFor(m);if(!_||!_.dem)return r;const y=_.dem,v=1<<_.tileID.canonical.z,b=(p*v-_.tileID.canonical.x)*y.dim,E=(t.y*v-_.tileID.canonical.y)*y.dim,C=Math.floor(b),S=Math.floor(E);return(s?this.exaggeration():1)*_e(_e(y.get(C,S),y.get(C,S+1),E-S),_e(y.get(C+1,S),y.get(C+1,S+1),E-S),b-C)}getAtTileOffset(t,r,s){const l=1<<t.canonical.z;return this.getAtPointOrZero(new Ke(t.wrap+(t.canonical.x+r/dt)/l,(t.canonical.y+s/dt)/l))}getAtTileOffsetFunc(t,r,s,l){return c=>{const d=this.getAtTileOffset(t,c.x,c.y),h=l.upVector(t.canonical,c.x,c.y),p=l.upVectorScale(t.canonical,r,s).metersToTile;return q.scale(h,h,d*p),h}}getForTilePoints(t,r,s,l){if(this.isUsingMockSource())return!1;const c=Za.create(this,t,l);return!!c&&(r.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],s)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(t);if(!r||!r.dem)return null;const s=r.dem.tree,l=r.tileID,c=1<<t.canonical.z-l.canonical.z;let d=t.canonical.x/c-l.canonical.x,h=t.canonical.y/c-l.canonical.y,p=0;for(let m=0;m<t.canonical.z-l.canonical.z&&!s.leaves[p];m++){d*=2,h*=2;const _=2*Math.floor(h)+Math.floor(d);p=s.childOffsets[p]+_,d%=1,h%=1}return{min:this.exaggeration()*s.minimums[p],max:this.exaggeration()*s.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}class Za{constructor(t,r,s){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(t,r,s){const l=s||t.findDEMTileFor(r);if(!l||!l.dem)return;const c=l.dem,d=l.tileID,h=1<<r.canonical.z-d.canonical.z;return new Za(l,c.dim/dt/h,[(r.canonical.x/h-d.canonical.x)*c.dim,(r.canonical.y/h-d.canonical.y)*c.dim])}tileCoordToPixel(t,r){const s=r*this._scale+this._offset[1],l=Math.floor(t*this._scale+this._offset[0]),c=Math.floor(s);return new nt(l,c)}getElevationAt(t,r,s,l){const c=t*this._scale+this._offset[0],d=r*this._scale+this._offset[1],h=Math.floor(c),p=Math.floor(d),m=this._dem;return l=!!l,s?_e(_e(m.get(h,p,l),m.get(h,p+1,l),d-p),_e(m.get(h+1,p,l),m.get(h+1,p+1,l),d-p),c-h):m.get(h,p,l)}getElevationAtPixel(t,r,s){return this._dem.get(t,r,!!s)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Ln(1,t)*this._dem.stride}}class mb{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new bh(dt,16,0),this.featureIndexArray=new Q0,this.promoteId=r}insert(t,r,s,l,c,d=0){const h=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,c,d);const p=this.grid;for(let m=0;m<r.length;m++){const _=r[m],y=[1/0,1/0,-1/0,-1/0];for(let v=0;v<_.length;v++){const b=_[v];y[0]=Math.min(y[0],b.x),y[1]=Math.min(y[1],b.y),y[2]=Math.max(y[2],b.x),y[3]=Math.max(y[3],b.y)}y[0]<dt&&y[1]<dt&&y[2]>=0&&y[3]>=0&&p.insert(h,y[0],y[1],y[2],y[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fm(new Je(this.rawTileData)).layers,this.sourceLayerCoder=new uM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r,s,l){this.loadVTLayers();const c=t.params||{},d=O0(c.filter),h=t.tileResult,p=t.transform,m=h.bufferedTilespaceBounds,_=this.grid.query(m.min.x,m.min.y,m.max.x,m.max.y,(E,C,S,M)=>zA(h.bufferedTilespaceGeometry,E,C,S,M));_.sort(_M);let y=null;p.elevation&&_.length>0&&(y=Za.create(p.elevation,this.tileID));const v={};let b;for(let E=0;E<_.length;E++){const C=_[E];if(C===b)continue;b=C;const S=this.featureIndexArray.get(C);let M=null;this.loadMatchingFeature(v,S,d,c.layers,c.availableImages,r,s,l,(D,R,P,I=0)=>(M||(M=Vl(D,this.tileID.canonical,t.tileTransform)),R.queryIntersectsFeature(h,D,P,M,this.z,t.transform,t.pixelPosMatrix,y,I)))}return v}loadMatchingFeature(t,r,s,l,c,d,h,p,m){const{featureIndex:_,bucketIndex:y,sourceLayerIndex:v,layoutVertexArrayOffset:b}=r,E=this.bucketLayerIDs[y];if(l&&!function(D,R){for(let P=0;P<D.length;P++)if(R.indexOf(D[P])>=0)return!0;return!1}(l,E))return;const C=this.sourceLayerCoder.decode(v),S=this.vtLayers[C].feature(_);if(s.needGeometry){const D=gu(S,!0);if(!s.filter(new wi(this.tileID.overscaledZ),D,this.tileID.canonical))return}else if(!s.filter(new wi(this.tileID.overscaledZ),S))return;const M=this.getId(S,C);for(let D=0;D<E.length;D++){const R=E[D];if(l&&l.indexOf(R)<0)continue;const P=d[R];if(!P)continue;let I={};void 0!==M&&p&&(I=p.getState(P.sourceLayer||"_geojsonTileLayer",M));const O=Yt({},h[R]);O.paint=gM(O.paint,P.paint,S,I,c),O.layout=gM(O.layout,P.layout,S,I,c);const F=!m||m(S,P,I,b);if(!F)continue;const L=new my(S,this.z,this.x,this.y,M);L.layer=O;let N=t[R];void 0===N&&(N=t[R]=[]),N.push({featureIndex:_,feature:L,intersectionZ:F})}}lookupSymbolFeatures(t,r,s,l,c,d,h,p){const m={};this.loadVTLayers();const _=O0(c);for(const y of t)this.loadMatchingFeature(m,{bucketIndex:s,sourceLayerIndex:l,featureIndex:y,layoutVertexArrayOffset:0},_,d,h,p,r);return m}loadFeature(t){const{featureIndex:r,sourceLayerIndex:s}=t;this.loadVTLayers();const l=this.sourceLayerCoder.decode(s),c=this.vtFeatures[l];if(c[r])return c[r];const d=this.vtLayers[l].feature(r);return c[r]=d,d}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){let s=t.id;if(this.promoteId){const l="string"==typeof this.promoteId?this.promoteId:this.promoteId[r];null!=l&&(s=t.properties[l]),"boolean"==typeof s&&(s=Number(s))}return s}}function gM(n,t,r,s,l){return Jd(n,(c,d)=>{const h=t instanceof Ip?t.get(d):null;return h&&h.evaluate?h.evaluate(r,s,l):h})}function _M(n,t){return t-n}Xt(mb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const yM=pn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gb=pn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),_m=pn([{name:"a_projected_pos",components:4,type:"Float32"}],4);pn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yy=pn([{name:"a_z_offset",components:1,type:"Float32"}],4),vM=pn([{name:"a_texb",components:2,type:"Uint16"}]),xM=pn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),e2=pn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const bM=pn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),n2=pn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);pn([{name:"triangle",components:3,type:"Uint16"}]),pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),pn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),pn([{type:"Float32",name:"offsetX"}]),pn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var kr=24;const xa=128;function wM(n,t){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new wi(n+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let c=0;for(;c<s.length&&s[c]<=n;)c++;c=Math.max(0,c-1);let d=c;for(;d<s.length&&s[d]<n+1;)d++;d=Math.min(s.length-1,d);const h=s[c],p=s[d];return"composite"===r.kind?{kind:"composite",minZoom:h,maxZoom:p,interpolationType:l}:{kind:"camera",minZoom:h,maxZoom:p,minSize:r.evaluate(new wi(h)),maxSize:r.evaluate(new wi(p)),interpolationType:l}}}function ym(n,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:l}){return"source"===n.kind?s/xa:"composite"===n.kind?_e(s/xa,l/xa,r):t}function Ic(n,t){let r=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:l,minZoom:c,maxZoom:d}=n,h=l?Jt(La.interpolationFactor(l,t,c,d),0,1):0;"camera"===n.kind?s=_e(n.minSize,n.maxSize,h):r=h}return{uSizeT:r,uSize:s}}var OF=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:xa,evaluateSizeForFeature:ym,evaluateSizeForZoom:Ic,getSizeData:wM});function EM(n,t,r){return n.sections.forEach(s=>{s.text=function(l,c,d){const h=c.layout.get("text-transform").evaluate(d,{});return"uppercase"===h?l=l.toLocaleUpperCase():"lowercase"===h&&(l=l.toLocaleLowerCase()),vs.applyArabicShaping&&(l=vs.applyArabicShaping(l)),l}(s.text,t,r)}),n}const ef={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function kF(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function vy(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}const xy=3;function CM(n,t,r){t.glyphs=[],1===n&&r.readMessage(r2,t)}function r2(n,t,r){if(3===n){const{id:s,bitmap:l,width:c,height:d,left:h,top:p,advance:m}=r.readMessage(MM,{});t.glyphs.push({id:s,bitmap:new Mc({width:c+2*xy,height:d+2*xy},l),metrics:{width:c,height:d,left:h,top:p,advance:m}})}else 4===n?t.ascender=r.readSVarint():5===n&&(t.descender=r.readSVarint())}function MM(n,t,r){1===n?t.id=r.readVarint():2===n?t.bitmap=r.readBytes():3===n?t.width=r.readVarint():4===n?t.height=r.readVarint():5===n?t.left=r.readSVarint():6===n?t.top=r.readSVarint():7===n&&(t.advance=r.readVarint())}const _b=xy;function on(n){let t=0,r=0;for(const d of n)t+=d.w*d.h,r=Math.max(r,d.w);n.sort((d,h)=>h.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,c=0;for(const d of n)for(let h=s.length-1;h>=0;h--){const p=s[h];if(!(d.w>p.w||d.h>p.h)){if(d.x=p.x,d.y=p.y,c=Math.max(c,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===p.w&&d.h===p.h){const m=s.pop();h<s.length&&(s[h]=m)}else d.h===p.h?(p.x+=d.w,p.w-=d.w):d.w===p.w?(p.y+=d.h,p.h-=d.h):(s.push({x:p.x+d.w,y:p.y,w:p.w-d.w,h:d.h}),p.y+=d.h,p.h-=d.h);break}}return{w:l,h:c,fill:t/(l*c)||0}}const mn=1;class by{constructor(t,{pixelRatio:r,version:s,stretchX:l,stretchY:c,content:d}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=c,this.content=d,this.version=s}get tl(){return[this.paddedRect.x+mn,this.paddedRect.y+mn]}get br(){return[this.paddedRect.x+this.paddedRect.w-mn,this.paddedRect.y+this.paddedRect.h-mn]}get displaySize(){return[(this.paddedRect.w-2*mn)/this.pixelRatio,(this.paddedRect.h-2*mn)/this.pixelRatio]}}class xt{constructor(t,r){const s={},l={};this.haveRenderCallbacks=[];const c=[];this.addImages(t,s,c),this.addImages(r,l,c);const{w:d,h}=on(c),p=new Pi({width:d||1,height:h||1});for(const m in t){const _=t[m],y=s[m].paddedRect;Pi.copy(_.data,p,{x:0,y:0},{x:y.x+mn,y:y.y+mn},_.data)}for(const m in r){const _=r[m],y=l[m].paddedRect,v=y.x+mn,b=y.y+mn,E=_.data.width,C=_.data.height;Pi.copy(_.data,p,{x:0,y:0},{x:v,y:b},_.data),Pi.copy(_.data,p,{x:0,y:C-1},{x:v,y:b-1},{width:E,height:1}),Pi.copy(_.data,p,{x:0,y:0},{x:v,y:b+C},{width:E,height:1}),Pi.copy(_.data,p,{x:E-1,y:0},{x:v-1,y:b},{width:1,height:C}),Pi.copy(_.data,p,{x:0,y:0},{x:v+E,y:b},{width:1,height:C})}this.image=p,this.iconPositions=s,this.patternPositions=l}addImages(t,r,s){for(const l in t){const c=t[l],d={x:0,y:0,w:c.data.width+2*mn,h:c.data.height+2*mn};s.push(d),r[l]=new by(d,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>t.hasImage(l,s)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const l in t.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[l],t.getImage(l,s),r),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l,s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,c]=t.tl;s.update(r.data,void 0,{x:l,y:c})}}Xt(by,"ImagePosition"),Xt(xt,"ImageAtlas");const ti={horizontal:1,vertical:2,horizontalOnly:3},SM=-17;class wu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const s=new wu;return s.scale=t||1,s.fontStack=r,s}static forImage(t){const r=new wu;return r.imageName=t,r}}class Xa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new Xa;for(let l=0;l<t.sections.length;l++){const c=t.sections[l];c.image?s.addImageSection(c):s.addTextSection(c,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(r,s){let l="";for(let c=0;c<r.length;c++){const d=r.charCodeAt(c+1)||null,h=r.charCodeAt(c-1)||null;l+=!s&&(d&&od(d)&&!ef[r[c+1]]||h&&od(h)&&!ef[r[c-1]])||!ef[r[c]]?r[c]:ef[r[c]]}return l}(this.text,t)}trim(){let t=0;for(let s=0;s<this.text.length&&Eu[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&Eu[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new Xa;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(wu.forText(t.scale,t.fontStack||r));const s=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.namePrimary:"";if(0===r.length)return void Q("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(wu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Q("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vm(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E){const C=Xa.fromFeature(n,l);y===ti.vertical&&C.verticalizePunctuation(v);let S=[];const M=function(O,F,L,N,z,U){if(!O)return[];const V=[],H=function(it,X,Y,ot,lt,ht){let mt=0;for(let yt=0;yt<it.length();yt++){const ct=it.getSection(yt);mt+=wy(it.getCodePoint(yt),ct,ot,lt,X,ht)}return mt/Math.max(1,Math.ceil(mt/Y))}(O,F,L,N,z,U),j=O.text.indexOf("\u200b")>=0;let Z=0;for(let it=0;it<O.length();it++){const X=O.getSection(it),Y=O.getCodePoint(it);if(Eu[Y]||(Z+=wy(Y,X,N,z,F,U)),it<O.length()-1){const ot=!((tt=Y)<11904||!(ne["Bopomofo Extended"](tt)||ne.Bopomofo(tt)||ne["CJK Compatibility Forms"](tt)||ne["CJK Compatibility Ideographs"](tt)||ne["CJK Compatibility"](tt)||ne["CJK Radicals Supplement"](tt)||ne["CJK Strokes"](tt)||ne["CJK Symbols and Punctuation"](tt)||ne["CJK Unified Ideographs Extension A"](tt)||ne["CJK Unified Ideographs"](tt)||ne["Enclosed CJK Letters and Months"](tt)||ne["Halfwidth and Fullwidth Forms"](tt)||ne.Hiragana(tt)||ne["Ideographic Description Characters"](tt)||ne["Kangxi Radicals"](tt)||ne["Katakana Phonetic Extensions"](tt)||ne.Katakana(tt)||ne["Vertical Forms"](tt)||ne["Yi Radicals"](tt)||ne["Yi Syllables"](tt)));(TM[Y]||ot||X.imageName)&&V.push(vb(it+1,Z,H,V,yb(Y,O.getCodePoint(it+1),ot&&j),!1))}}var tt;return Cy(vb(O.length(),Z,H,V,0,!0))}(C,m,c,t,s,b),{processBidirectionalText:D,processStyledBidirectionalText:R}=vs;if(D&&1===C.sections.length){const O=D(C.toString(),M);for(const F of O){const L=new Xa;L.text=F,L.sections=C.sections;for(let N=0;N<F.length;N++)L.sectionIndex.push(0);S.push(L)}}else if(R){const O=R(C.text,C.sectionIndex,M);for(const F of O){const L=new Xa;L.text=F[0],L.sectionIndex=F[1],L.sections=C.sections,S.push(L)}}else S=function(O,F){const L=[],N=O.text;let z=0;for(const U of F)L.push(O.substring(z,U)),z=U;return z<N.length&&L.push(O.substring(z,N.length)),L}(C,M);const P=[],I={positionedLines:P,text:C.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:y,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(O,F,L,N,z,U,V,H,j,Z,tt,it){let X=0,Y=0,ot=0;const lt="right"===H?1:"left"===H?0:.5;let ht=!1;for(const Vt of z){const jt=Vt.getSections();for(const $t of jt){if($t.imageName)continue;const re=F[$t.fontStack];if(re&&(ht=void 0!==re.ascender&&void 0!==re.descender,!ht))break}if(!ht)break}let mt=0;for(const Vt of z){Vt.trim();const jt=Vt.getMaxScale(),$t=(jt-1)*kr,re={positionedGlyphs:[],lineOffset:0};O.positionedLines[mt]=re;const ye=re.positionedGlyphs;let je=0;if(!Vt.length()){Y+=U,++mt;continue}let rn=0,Re=0;for(let ge=0;ge<Vt.length();ge++){const ue=Vt.getSection(ge),Le=Vt.getSectionIndex(ge),an=Vt.getCodePoint(ge);let Be=ue.scale,Zn=null,Si=null,ui=null,ei=kr,cr=0;const _i=!(j===ti.horizontal||!tt&&!b_(an)||tt&&(Eu[an]||(yt=an,ne.Arabic(yt)||ne["Arabic Supplement"](yt)||ne["Arabic Extended-A"](yt)||ne["Arabic Presentation Forms-A"](yt)||ne["Arabic Presentation Forms-B"](yt))));if(ue.imageName){const di=N[ue.imageName];if(!di)continue;ui=ue.imageName,O.iconsInText=O.iconsInText||!0,Si=di.paddedRect;const Hn=di.displaySize;Be=Be*kr/it,Zn={width:Hn[0],height:Hn[1],left:mn,top:-_b,advance:_i?Hn[1]:Hn[0],localGlyph:!1},cr=ht?-Zn.height*Be:SM+jt*kr-Hn[1]*Be,ei=Zn.advance;const Ko=(_i?Hn[0]:Hn[1])*Be-kr*jt;Ko>0&&Ko>je&&(je=Ko)}else{const di=L[ue.fontStack];if(!di)continue;di[an]&&(Si=di[an]);const Hn=F[ue.fontStack];if(!Hn)continue;const Ko=Hn.glyphs[an];if(!Ko)continue;if(Zn=Ko.metrics,ei=8203!==an?kr:0,ht){const al=void 0!==Hn.ascender?Math.abs(Hn.ascender):0,cs=void 0!==Hn.descender?Math.abs(Hn.descender):0,Zl=(al+cs)*Be;rn<Zl&&(rn=Zl,Re=(al-cs)/2*Be),cr=-al*Be}else cr=SM+(jt-Be)*kr}_i?(O.verticalizable=!0,ye.push({glyph:an,imageName:ui,x:X,y:Y+cr,vertical:_i,scale:Be,localGlyph:Zn.localGlyph,fontStack:ue.fontStack,sectionIndex:Le,metrics:Zn,rect:Si}),X+=ei*Be+Z):(ye.push({glyph:an,imageName:ui,x:X,y:Y+cr,vertical:_i,scale:Be,localGlyph:Zn.localGlyph,fontStack:ue.fontStack,sectionIndex:Le,metrics:Zn,rect:Si}),X+=Zn.advance*Be+Z)}0!==ye.length&&(ot=Math.max(X-Z,ot),ht?DM(ye,lt,je,Re,U*jt/2):DM(ye,lt,je,0,U/2)),X=0;const Me=U*jt+je;re.lineOffset=Math.max(je,$t),Y+=Me,++mt}var yt;const ct=Y,{horizontalAlign:ft,verticalAlign:Rt}=My(V);(function(Vt,jt,$t,re,ye,je){const rn=(jt-$t)*ye,Re=-je*re;for(const Me of Vt)for(const ge of Me.positionedGlyphs)ge.x+=rn,ge.y+=Re})(O.positionedLines,lt,ft,Rt,ot,ct),O.top+=-Rt*ct,O.bottom=O.top+ct,O.left+=-ft*ot,O.right=O.left+ot,O.hasBaseline=ht}(I,t,r,s,S,d,h,p,y,m,v,E),!function(O){for(const F of O)if(0!==F.positionedGlyphs.length)return!1;return!0}(P)&&I}const Eu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},TM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wy(n,t,r,s,l,c){if(t.imageName){const d=s[t.imageName];return d?d.displaySize[0]*t.scale*kr/c+l:0}{const d=r[t.fontStack],h=d&&d.glyphs[n];return h?h.metrics.advance*t.scale+l:0}}function Ey(n,t,r,s){const l=Math.pow(n-t,2);return s?n<t?l/2:2*l:l+Math.abs(r)*r}function yb(n,t,r){let s=0;return 10===n&&(s-=1e4),r&&(s+=150),40!==n&&65288!==n||(s+=50),41!==t&&65289!==t||(s+=50),s}function vb(n,t,r,s,l,c){let d=null,h=Ey(t,r,l,c);for(const p of s){const m=Ey(t-p.x,r,l,c)+p.badness;m<=h&&(d=p,h=m)}return{index:n,x:t,priorBreak:d,badness:h}}function Cy(n){return n?Cy(n.priorBreak).concat(n.index):[]}function My(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function DM(n,t,r,s,l){if(!(t||r||s||l))return;const c=n.length-1,d=n[c],h=(d.x+d.metrics.advance*d.scale)*t;for(let p=0;p<=c;p++)n[p].x-=h,n[p].y+=r+s+l}function o2(n,t,r,s){const{horizontalAlign:l,verticalAlign:c}=My(s),d=r[0]-n.displaySize[0]*l,h=r[1]-n.displaySize[1]*c;return{imagePrimary:n,imageSecondary:t,top:h,bottom:h+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function xb(n,t,r,s,l,c){const d=n.imagePrimary;let h;if(d.content){const S=d.content,M=d.pixelRatio||1;h=[S[0]/M,S[1]/M,d.displaySize[0]-S[2]/M,d.displaySize[1]-S[3]/M]}const p=t.left*c,m=t.right*c;let _,y,v,b;"width"===r||"both"===r?(b=l[0]+p-s[3],y=l[0]+m+s[1]):(b=l[0]+(p+m-d.displaySize[0])/2,y=b+d.displaySize[0]);const E=t.top*c,C=t.bottom*c;return"height"===r||"both"===r?(_=l[1]+E-s[0],v=l[1]+C+s[2]):(_=l[1]+(E+C-d.displaySize[1])/2,v=_+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:_,right:y,bottom:v,left:b,collisionPadding:h}}class Ac extends nt{constructor(t,r,s,l,c){super(t,r),this.angle=l,this.z=s,void 0!==c&&(this.segment=c)}clone(){return new Ac(this.x,this.y,this.z,this.angle,this.segment)}}function IM(n,t,r,s,l){if(void 0===t.segment)return!0;let c=t,d=t.segment+1,h=0;for(;h>-r/2;){if(d--,d<0)return!1;h-=n[d].dist(c),c=n[d]}h+=n[d].dist(n[d+1]),d++;const p=[];let m=0;for(;h<r/2;){const _=n[d],y=n[d+1];if(!y)return!1;let v=n[d-1].angleTo(_)-_.angleTo(y);for(v=Math.abs((v+3*Math.PI)%(2*Math.PI)-Math.PI),p.push({distance:h,angleDelta:v}),m+=v;h-p[0].distance>s;)m-=p.shift().angleDelta;if(m>l)return!1;d++,h+=_.dist(y)}return!0}function AM(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function RM(n,t,r){return n?.6*t*r:0}function bb(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function PM(n,t,r,s,l,c){const d=RM(r,l,c),h=bb(r,s)*c;let p=0;const m=AM(n)/2;for(let _=0;_<n.length-1;_++){const y=n[_],v=n[_+1],b=y.dist(v);if(p+b>m){const E=(m-p)/b,C=_e(y.x,v.x,E),S=_e(y.y,v.y,E),M=new Ac(C,S,0,v.angleTo(y),_);return!d||IM(n,M,h,d,t)?M:void 0}p+=b}}function s2(n,t,r,s,l,c,d,h,p){const m=RM(s,c,d),_=bb(s,l),y=_*d,v=0===n[0].x||n[0].x===p||0===n[0].y||n[0].y===p;return t-y<t/4&&(t=y+t/4),OM(n,v?t/2*h%t:(_/2+2*c)*d*h%t,t,m,r,y,v,!1,p)}function OM(n,t,r,s,l,c,d,h,p){const m=c/2,_=AM(n);let y=0,v=t-r,b=[];for(let E=0;E<n.length-1;E++){const C=n[E],S=n[E+1],M=C.dist(S),D=S.angleTo(C);for(;v+r<y+M;){v+=r;const R=(v-y)/M,P=_e(C.x,S.x,R),I=_e(C.y,S.y,R);if(P>=0&&P<p&&I>=0&&I<p&&v-m>=0&&v+m<=_){const O=new Ac(P,I,0,D,E);s&&!IM(n,O,c,s,l)||b.push(O)}}y+=M}return h||b.length||d||(b=OM(n,y/2,r,s,l,c,d,!0,p)),b}function Ts(n,t,r,s,l){const c=[];for(let d=0;d<n.length;d++){const h=n[d];let p;for(let m=0;m<h.length-1;m++){let _=h[m],y=h[m+1];_.x<t&&y.x<t||(_.x<t?_=new nt(t,_.y+(t-_.x)/(y.x-_.x)*(y.y-_.y))._round():y.x<t&&(y=new nt(t,_.y+(t-_.x)/(y.x-_.x)*(y.y-_.y))._round()),_.y<r&&y.y<r||(_.y<r?_=new nt(_.x+(r-_.y)/(y.y-_.y)*(y.x-_.x),r)._round():y.y<r&&(y=new nt(_.x+(r-_.y)/(y.y-_.y)*(y.x-_.x),r)._round()),_.x>=s&&y.x>=s||(_.x>=s?_=new nt(s,_.y+(s-_.x)/(y.x-_.x)*(y.y-_.y))._round():y.x>=s&&(y=new nt(s,_.y+(s-_.x)/(y.x-_.x)*(y.y-_.y))._round()),_.y>=l&&y.y>=l||(_.y>=l?_=new nt(_.x+(l-_.y)/(y.y-_.y)*(y.x-_.x),l)._round():y.y>=l&&(y=new nt(_.x+(l-_.y)/(y.y-_.y)*(y.x-_.x),l)._round()),p&&_.equals(p[p.length-1])||(p=[_],c.push(p)),p.push(y)))))}}return c}Xt(Ac,"Anchor");const xm=1e20;function kM(n,t,r,s,l,c,d,h,p){for(let m=t;m<t+s;m++)a2(n,r*c+m,c,l,d,h,p);for(let m=r;m<r+l;m++)a2(n,m*c+t,1,s,d,h,p)}function a2(n,t,r,s,l,c,d){c[0]=0,d[0]=-xm,d[1]=xm,l[0]=n[t];for(let h=1,p=0,m=0;h<s;h++){l[h]=n[t+h*r];const _=h*h;do{const y=c[p];m=(l[h]-l[y]+_-y*y)/(h-y)/2}while(m<=d[p]&&--p>-1);p++,c[p]=h,d[p]=m,d[p+1]=xm}for(let h=0,p=0;h<s;h++){for(;d[p+1]<h;)p++;const m=c[p],_=h-m;n[t+h*r]=l[m]+_*_}}const Ys=2;class Sd{constructor(t,r,s){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,r){this.urls[r]=t}getGlyphs(t,r,s){const l=[],c=this.urls[r]||$e.GLYPHS_URL;for(const d in t)for(const h of t[d])l.push({stack:d,id:h});Zu(l,({stack:d,id:h},p)=>{let m=this.entries[d];m||(m=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=m.glyphs[h];if(void 0!==_)return void p(null,{stack:d,id:h,glyph:_});if(_=this._tinySDF(m,d,h),_)return m.glyphs[h]=_,void p(null,{stack:d,id:h,glyph:_});const y=Math.floor(h/256);if(256*y>65535)return void p(new Error("glyphs > 65535 not supported"));if(m.ranges[y])return void p(null,{stack:d,id:h,glyph:_});let v=m.requests[y];v||(v=m.requests[y]=[],Sd.loadGlyphRange(d,y,c,this.requestManager,(b,E)=>{if(E){m.ascender=E.ascender,m.descender=E.descender;for(const C in E.glyphs)this._doesCharSupportLocalGlyph(+C)||(m.glyphs[+C]=E.glyphs[+C]);m.ranges[y]=!0}for(const C of v)C(b,E);delete m.requests[y]})),v.push((b,E)=>{b?p(b):E&&p(null,{stack:d,id:h,glyph:E.glyphs[h]||null})})},(d,h)=>{if(d)s(d);else if(h){const p={};for(const{stack:m,id:_,glyph:y}of h)void 0===p[m]&&(p[m]={}),void 0===p[m].glyphs&&(p[m].glyphs={}),p[m].glyphs[_]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics},p[m].ascender=this.entries[m].ascender,p[m].descender=this.entries[m].descender;s(null,p)}})}_doesCharSupportLocalGlyph(t){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(ne["CJK Unified Ideographs"](t)||ne["Hangul Syllables"](t)||ne.Hiragana(t)||ne.Katakana(t)||ne["CJK Symbols and Punctuation"](t)||ne["CJK Unified Ideographs Extension A"](t)||ne["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,r,s){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(s))return;let c=t.tinySDF;if(!c){let C="400";/bold/i.test(r)?C="900":/medium/i.test(r)?C="500":/light/i.test(r)&&(C="200"),c=t.tinySDF=new Sd.TinySDF({fontFamily:l,fontWeight:C,fontSize:24*Ys,buffer:3*Ys,radius:8*Ys}),c.fontWeight=C}if(this.localGlyphs[c.fontWeight][s])return this.localGlyphs[c.fontWeight][s];const d=String.fromCodePoint(s),{data:h,width:p,height:m,glyphWidth:_,glyphHeight:y,glyphLeft:v,glyphTop:b,glyphAdvance:E}=c.draw(d);return this.localGlyphs[c.fontWeight][s]={id:s,bitmap:new Mc({width:p,height:m},h),metrics:{width:_/Ys,height:y/Ys,left:v/Ys,top:b/Ys-27,advance:E/Ys,localGlyph:!0}}}}Sd.loadGlyphRange=function(n,t,r,s,l){const c=256*t,d=c+255,h=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${c}-${d}`),gt.Glyphs);zt(h,(p,m)=>{if(p)l(p);else if(m){const _={},y=new Je(m).readFields(CM,{});for(const v of y.glyphs)_[v.id]=v;l(null,{glyphs:_,ascender:y.ascender,descender:y.descender})}})},Sd.TinySDF=class{constructor({fontSize:n=24,buffer:t=3,radius:r=8,cutoff:s=.25,fontFamily:l="sans-serif",fontWeight:c="normal",fontStyle:d="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=r;const h=this.size=n+4*t,p=this._createCanvas(h),m=this.ctx=p.getContext("2d",{willReadFrequently:!0});m.font=`${d} ${c} ${n}px ${l}`,m.textBaseline="alphabetic",m.textAlign="left",m.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(n){const t=document.createElement("canvas");return t.width=t.height=n,t}draw(n){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:l,actualBoundingBoxRight:c}=this.ctx.measureText(n),d=Math.ceil(r),h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-l))),p=Math.min(this.size-this.buffer,d+Math.ceil(s)),m=h+2*this.buffer,_=p+2*this.buffer,y=Math.max(m*_,0),v=new Uint8ClampedArray(y),b={data:v,width:m,height:_,glyphWidth:h,glyphHeight:p,glyphTop:d,glyphLeft:0,glyphAdvance:t};if(0===h||0===p)return b;const{ctx:E,buffer:C,gridInner:S,gridOuter:M}=this;E.clearRect(C,C,h,p),E.fillText(n,C,C+d);const D=E.getImageData(C,C,h,p);M.fill(xm,0,y),S.fill(0,0,y);for(let R=0;R<p;R++)for(let P=0;P<h;P++){const I=D.data[4*(R*h+P)+3]/255;if(0===I)continue;const O=(R+C)*m+P+C;if(1===I)M[O]=0,S[O]=xm;else{const F=.5-I;M[O]=F>0?F*F:0,S[O]=F<0?F*F:0}}kM(M,0,0,m,_,m,this.f,this.v,this.z),kM(S,C,C,h,p,m,this.f,this.v,this.z);for(let R=0;R<y;R++){const P=Math.sqrt(M[R])-Math.sqrt(S[R]);v[R]=Math.round(255-255*(P/this.radius+this.cutoff))}return b}};const Cu=mn;function FM(n,t,r,s){const l=[],c=n.imagePrimary,d=c.pixelRatio,h=c.paddedRect.w-2*Cu,p=c.paddedRect.h-2*Cu,m=n.right-n.left,_=n.bottom-n.top,y=c.stretchX||[[0,h]],v=c.stretchY||[[0,p]],b=(U,V)=>U+V[1]-V[0],E=y.reduce(b,0),C=v.reduce(b,0),S=h-E,M=p-C;let D=0,R=E,P=0,I=C,O=0,F=S,L=0,N=M;if(c.content&&s){const U=c.content;D=Sy(y,0,U[0]),P=Sy(v,0,U[1]),R=Sy(y,U[0],U[2]),I=Sy(v,U[1],U[3]),O=U[0]-D,L=U[1]-P,F=U[2]-U[0]-R,N=U[3]-U[1]-I}const z=(U,V,H,j)=>{const Z=Ty(U.stretch-D,R,m,n.left),tt=Dy(U.fixed-O,F,U.stretch,E),it=Ty(V.stretch-P,I,_,n.top),X=Dy(V.fixed-L,N,V.stretch,C),Y=Ty(H.stretch-D,R,m,n.left),ot=Dy(H.fixed-O,F,H.stretch,E),lt=Ty(j.stretch-P,I,_,n.top),ht=Dy(j.fixed-L,N,j.stretch,C),mt=new nt(Z,it),yt=new nt(Y,it),ct=new nt(Y,lt),ft=new nt(Z,lt),Rt=new nt(tt/d,X/d),Vt=new nt(ot/d,ht/d),jt=t*Math.PI/180;if(jt){const Re=Math.sin(jt),Me=Math.cos(jt),ge=[Me,-Re,Re,Me];mt._matMult(ge),yt._matMult(ge),ft._matMult(ge),ct._matMult(ge)}const $t=U.stretch+U.fixed,re=H.stretch+H.fixed,ye=V.stretch+V.fixed,je=j.stretch+j.fixed,rn=n.imageSecondary;return{tl:mt,tr:yt,bl:ft,br:ct,texPrimary:{x:c.paddedRect.x+Cu+$t,y:c.paddedRect.y+Cu+ye,w:re-$t,h:je-ye},texSecondary:rn?{x:rn.paddedRect.x+Cu+$t,y:rn.paddedRect.y+Cu+ye,w:re-$t,h:je-ye}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rt,pixelOffsetBR:Vt,minFontScaleX:F/d/m,minFontScaleY:N/d/_,isSDF:r}};if(s&&(c.stretchX||c.stretchY)){const U=wb(y,S,E),V=wb(v,M,C);for(let H=0;H<U.length-1;H++){const j=U[H],Z=U[H+1];for(let tt=0;tt<V.length-1;tt++)l.push(z(j,V[tt],Z,V[tt+1]))}}else l.push(z({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:h+1},{fixed:0,stretch:p+1}));return l}function Sy(n,t,r){let s=0;for(const l of n)s+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return s}function wb(n,t,r){const s=[{fixed:-Cu,stretch:0}];for(const[l,c]of n){const d=s[s.length-1];s.push({fixed:l-d.stretch,stretch:d.stretch}),s.push({fixed:l-d.stretch,stretch:d.stretch+(c-l)})}return s.push({fixed:t+Cu,stretch:r}),s}function Ty(n,t,r,s){return n/t*r+s}function Dy(n,t,r,s){return n-t*r/s}function Eb(n,t,r,s){const l=t+n.positionedLines[s].lineOffset;return 0===s?r+l/2:r+(l+(t+n.positionedLines[s-1].lineOffset))/2}function l2(n,t=1,r=!1){let s=1/0,l=1/0,c=-1/0,d=-1/0;const h=n[0];for(let b=0;b<h.length;b++){const E=h[b];(!b||E.x<s)&&(s=E.x),(!b||E.y<l)&&(l=E.y),(!b||E.x>c)&&(c=E.x),(!b||E.y>d)&&(d=E.y)}const p=Math.min(c-s,d-l);let m=p/2;const _=new pp([],c2);if(0===p)return new nt(s,l);for(let b=s;b<c;b+=p)for(let E=l;E<d;E+=p)_.push(new nf(b+m,E+m,m,n));let y=function(b){let E=0,C=0,S=0;const M=b[0];for(let D=0,R=M.length,P=R-1;D<R;P=D++){const I=M[D],O=M[P],F=I.x*O.y-O.x*I.y;C+=(I.x+O.x)*F,S+=(I.y+O.y)*F,E+=3*F}return new nf(C/E,S/E,0,b)}(n),v=_.length;for(;_.length;){const b=_.pop();(b.d>y.d||!y.d)&&(y=b,r&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,v)),b.max-y.d<=t||(m=b.h/2,_.push(new nf(b.p.x-m,b.p.y-m,m,n)),_.push(new nf(b.p.x+m,b.p.y-m,m,n)),_.push(new nf(b.p.x-m,b.p.y+m,m,n)),_.push(new nf(b.p.x+m,b.p.y+m,m,n)),v+=4)}return r&&(console.log(`num probes: ${v}`),console.log(`best distance: ${y.d}`)),y.p}function c2(n,t){return t.max-n.max}class nf{constructor(t,r,s,l){this.p=new nt(t,r),this.h=s,this.d=function(c,d){let h=!1,p=1/0;for(let m=0;m<d.length;m++){const _=d[m];for(let y=0,v=_.length,b=v-1;y<v;b=y++){const E=_[y],C=_[b];E.y>c.y!=C.y>c.y&&c.x<(C.x-E.x)*(c.y-E.y)/(C.y-E.y)+E.x&&(h=!h),p=Math.min(p,Vx(c,E,C))}}return(h?1:-1)*Math.sqrt(p)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const rf=7,Cb=Number.POSITIVE_INFINITY,Ul=Math.sqrt(2);function bm(n,[t,r]){let s=0,l=0;if(r===Cb){t<0&&(t=0);const c=t/Ul;switch(n){case"top-right":case"top-left":l=c-rf;break;case"bottom-right":case"bottom-left":l=-c+rf;break;case"bottom":l=-t+rf;break;case"top":l=t-rf}switch(n){case"top-right":case"bottom-right":s=-c;break;case"top-left":case"bottom-left":s=c;break;case"left":s=t;break;case"right":s=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),n){case"top-right":case"top-left":case"top":l=r-rf;break;case"bottom-right":case"bottom-left":case"bottom":l=-r+rf}switch(n){case"top-right":case"bottom-right":case"right":s=-t;break;case"top-left":case"bottom-left":case"left":s=t}}return[s,l]}function u2(n,t,r,s,l,c,d,h,p,m,_){n.createArrays(),n.tilePixelRatio=dt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const y=n.layers[0].layout,v=n.layers[0]._unevaluatedLayout._values,b={};if("composite"===n.textSizeData.kind){const{minZoom:M,maxZoom:D}=n.textSizeData;b.compositeTextSizes=[v["text-size"].possiblyEvaluate(new wi(M),h),v["text-size"].possiblyEvaluate(new wi(D),h)]}if("composite"===n.iconSizeData.kind){const{minZoom:M,maxZoom:D}=n.iconSizeData;b.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new wi(M),h),v["icon-size"].possiblyEvaluate(new wi(D),h)]}b.layoutTextSize=v["text-size"].possiblyEvaluate(new wi(p+1),h),b.layoutIconSize=v["icon-size"].possiblyEvaluate(new wi(p+1),h),b.textMaxSize=v["text-size"].possiblyEvaluate(new wi(18),h);const E="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement"),C=y.get("text-size");let S=!1;for(const M of n.features)if(M.icon&&M.icon.nameSecondary){S=!0;break}for(const M of n.features){const D=y.get("text-font").evaluate(M,{},h).join(","),R=C.evaluate(M,{},h),P=b.layoutTextSize.evaluate(M,{},h),I=(b.layoutIconSize.evaluate(M,{},h),{horizontal:{},vertical:void 0}),O=M.text;let F,L=[0,0];if(O){const U=O.toString(),V=y.get("text-letter-spacing").evaluate(M,{},h)*kr,H=y.get("text-line-height").evaluate(M,{},h)*kr,j=uA(U)?V:0,Z=y.get("text-anchor").evaluate(M,{},h),tt=y.get("text-variable-anchor");if(!tt){const lt=y.get("text-radial-offset").evaluate(M,{},h);L=lt?bm(Z,[lt*kr,Cb]):y.get("text-offset").evaluate(M,{},h).map(ht=>ht*kr)}let it=E?"center":y.get("text-justify").evaluate(M,{},h);const X="point"===y.get("symbol-placement"),Y=X?y.get("text-max-width").evaluate(M,{},h)*kr:1/0,ot=lt=>{n.allowVerticalPlacement&&$0(U)&&(I.vertical=vm(O,t,r,l,D,Y,H,Z,lt,j,L,ti.vertical,!0,P,R))};if(!E&&tt){const lt="auto"===it?tt.map(mt=>Iy(mt)):[it];let ht=!1;for(let mt=0;mt<lt.length;mt++){const yt=lt[mt];if(!I.horizontal[yt])if(ht)I.horizontal[yt]=I.horizontal[0];else{const ct=vm(O,t,r,l,D,Y,H,"center",yt,j,L,ti.horizontal,!1,P,R);ct&&(I.horizontal[yt]=ct,ht=1===ct.positionedLines.length)}}ot("left")}else{if("auto"===it&&(it=Iy(Z)),X||y.get("text-writing-mode").indexOf("horizontal")>=0||!$0(U)){const lt=vm(O,t,r,l,D,Y,H,Z,it,j,L,ti.horizontal,!1,P,R);lt&&(I.horizontal[it]=lt)}ot(X?"left":it)}}let N=!1;if(M.icon&&M.icon.namePrimary){const U=s[M.icon.namePrimary];U&&(F=o2(l[M.icon.namePrimary],M.icon.nameSecondary?l[M.icon.nameSecondary]:void 0,y.get("icon-offset").evaluate(M,{},h),y.get("icon-anchor").evaluate(M,{},h)),N=U.sdf,void 0===n.sdfIcons?n.sdfIcons=U.sdf:n.sdfIcons!==U.sdf&&Q("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(U.pixelRatio!==n.pixelRatio||0!==y.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const z=Ay(I.horizontal)||I.vertical;n.iconsInText||(n.iconsInText=!!z&&z.iconsInText),(z||F)&&d2(n,M,I,F,s,b,P,0,L,N,d,h,m,_,S)}c&&n.generateCollisionDebugBuffers(p,n.collisionBoxArray)}function Iy(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function d2(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E){let C=c.textMaxSize.evaluate(t,{},y);void 0===C&&(C=d);const S=n.layers[0].layout,M=S.get("icon-offset").evaluate(t,{},y),D=Ay(r.horizontal)||r.vertical,R="globe"===v.name,P=kr,I=d/P,O=n.tilePixelRatio*C/P,F=(Z=n.overscaling,n.zoom>18&&Z>2&&(Z>>=1),Math.max(dt/(512*Z),1)*S.get("symbol-spacing")),L=S.get("text-padding")*n.tilePixelRatio,N=S.get("icon-padding")*n.tilePixelRatio,z=Ie(S.get("text-max-angle")),U="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),V="map"===S.get("icon-rotation-alignment")&&"point"!==S.get("symbol-placement"),H=S.get("symbol-placement"),j=F/2;var Z;const tt=S.get("icon-text-fit").evaluate(t,{},y),it=S.get("icon-text-fit-padding").evaluate(t,{},y),X="none"!==tt;let Y;!1===n.hasAnyIconTextFit&&X&&(n.hasAnyIconTextFit=!0),s&&X&&(n.allowVerticalPlacement&&r.vertical&&(Y=xb(s,r.vertical,tt,it,M,I)),D&&(s=xb(s,D,tt,it,M,I)));const ot=(lt,ht,mt)=>{if(ht.x<0||ht.x>=dt||ht.y<0||ht.y>=dt)return;let yt=null;if(R){const{x:ct,y:ft,z:Rt}=v.projectTilePoint(ht.x,ht.y,mt);yt={anchor:new Ac(ct,ft,Rt,0,void 0),up:v.upVector(mt,ht.x,ht.y)}}!function(ct,ft,Rt,Vt,jt,$t,re,ye,je,rn,Re,Me,ge,ue,Le,an,Be,Zn,Si,ui,ei,cr,_i,di,Hn,Ko,al){const cs=ct.addToLineVertexArray(ft,Vt);let Zl,Nd,zd,Av,Rv,Pv,gg,DP=0,IP=0,AP=0,lw=0,cw=-1,uw=-1;const Xl={};let sD=B_("");const Fu=Rt?Rt.anchor:ft,Ov="none"!==je.layout.get("icon-text-fit").evaluate(ei,{},Hn);let kv=0,dw=0;if(void 0===je._unevaluatedLayout.getValue("text-radial-offset")?[kv,dw]=je.layout.get("text-offset").evaluate(ei,{},Hn).map(ta=>ta*kr):(kv=je.layout.get("text-radial-offset").evaluate(ei,{},Hn)*kr,dw=Cb),ct.allowVerticalPlacement&&jt.vertical){const ta=jt.vertical;if(Le)Pv=Ry(ta),ye&&(gg=Ry(ye));else{const us=je.layout.get("text-rotate").evaluate(ei,{},Hn)+90;zd=Mb(rn,Fu,ft,Re,Me,ge,ta,ue,us,an),ye&&(Av=Mb(rn,Fu,ft,Re,Me,ge,ye,Zn,us))}}if($t){const ta=je.layout.get("icon-rotate").evaluate(ei,{},Hn),us=FM($t,ta,_i,Ov),Yl=ye?FM(ye,ta,_i,Ov):void 0;Nd=Mb(rn,Fu,ft,Re,Me,ge,$t,Zn,ta),DP=4*us.length;const aD=ct.iconSizeData;let Bd=null;"source"===aD.kind?(Bd=[xa*je.layout.get("icon-size").evaluate(ei,{},Hn)],Bd[0]>Rc&&Q(`${ct.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)):"composite"===aD.kind&&(Bd=[xa*cr.compositeIconSizes[0].evaluate(ei,{},Hn),xa*cr.compositeIconSizes[1].evaluate(ei,{},Hn)],(Bd[0]>Rc||Bd[1]>Rc)&&Q(`${ct.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)),ct.addSymbols(ct.icon,us,Bd,ui,Si,ei,!1,Rt,ft,cs.lineStartIndex,cs.lineLength,-1,di,Hn,Ko,al),cw=ct.icon.placedSymbolArray.length-1,Yl&&(IP=4*Yl.length,ct.addSymbols(ct.icon,Yl,Bd,ui,Si,ei,ti.vertical,Rt,ft,cs.lineStartIndex,cs.lineLength,-1,di,Hn,Ko,al),uw=ct.icon.placedSymbolArray.length-1)}for(const ta in jt.horizontal){const us=jt.horizontal[ta];Zl||(sD=B_(us.text),Le?Rv=Ry(us):Zl=Mb(rn,Fu,ft,Re,Me,ge,us,ue,je.layout.get("text-rotate").evaluate(ei,{},Hn),an));const Yl=1===us.positionedLines.length;if(AP+=wm(ct,Rt,ft,us,re,je,Le,ei,an,cs,jt.vertical?ti.horizontal:ti.horizontalOnly,Yl?Object.keys(jt.horizontal):[ta],Xl,cw,cr,di,Hn,Ko),Yl)break}jt.vertical&&(lw+=wm(ct,Rt,ft,jt.vertical,re,je,Le,ei,an,cs,ti.vertical,["vertical"],Xl,uw,cr,di,Hn,Ko));let Lu=-1;const Fv=(ta,us)=>ta?Math.max(ta,us):us;Lu=Fv(Rv,Lu),Lu=Fv(Pv,Lu),Lu=Fv(gg,Lu);const Lv=Lu>-1?1:0;ct.glyphOffsetArray.length>=Dm.MAX_GLYPHS&&Q("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ei.sortKey&&ct.addToSortKeyRanges(ct.symbolInstances.length,ei.sortKey),ct.symbolInstances.emplaceBack(ft.x,ft.y,Fu.x,Fu.y,Fu.z,Xl.right>=0?Xl.right:-1,Xl.center>=0?Xl.center:-1,Xl.left>=0?Xl.left:-1,Xl.vertical>=0?Xl.vertical:-1,cw,uw,sD,void 0!==Zl?Zl:ct.collisionBoxArray.length,void 0!==Zl?Zl+1:ct.collisionBoxArray.length,void 0!==zd?zd:ct.collisionBoxArray.length,void 0!==zd?zd+1:ct.collisionBoxArray.length,void 0!==Nd?Nd:ct.collisionBoxArray.length,void 0!==Nd?Nd+1:ct.collisionBoxArray.length,Av||ct.collisionBoxArray.length,Av?Av+1:ct.collisionBoxArray.length,Re,AP,lw,DP,IP,Lv,0,kv,dw,Lu,0,Ov?1:0)}(n,ht,yt,lt,r,s,l,Y,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,L,U,p,0,N,V,M,t,c,m,_,y,b,E)};if("line"===H)for(const lt of Ts(t.geometry,0,0,dt,dt)){const ht=s2(lt,F,z,r.vertical||D,s,P,O,n.overscaling,dt);for(const mt of ht)D&&LM(n,D.text,j,mt)||ot(lt,mt,y)}else if("line-center"===H){for(const lt of t.geometry)if(lt.length>1){const ht=PM(lt,z,r.vertical||D,s,P,O);ht&&ot(lt,ht,y)}}else if("Polygon"===t.type)for(const lt of Yh(t.geometry,0)){const ht=l2(lt,16);ot(lt[0],new Ac(ht.x,ht.y,0,0,void 0),y)}else if("LineString"===t.type)for(const lt of t.geometry)ot(lt,new Ac(lt[0].x,lt[0].y,0,0,void 0),y);else if("Point"===t.type)for(const lt of t.geometry)for(const ht of lt)ot([ht],new Ac(ht.x,ht.y,0,0,void 0),y)}const sf=255,Rc=sf*xa;function wm(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M){const D=function(I,O,F,L,N,z,U,V){const H=[];if(0===O.positionedLines.length)return H;const j=L.layout.get("text-rotate").evaluate(z,{})*Math.PI/180,Z=function(ot){const lt=ot[0],ht=ot[1],mt=lt*ht;return mt>0?[lt,-ht]:mt<0?[-lt,ht]:0===lt?[ht,lt]:[ht,-lt]}(F);let tt=Math.abs(O.top-O.bottom);for(const ot of O.positionedLines)tt-=ot.lineOffset;const it=O.positionedLines.length,X=tt/it;let Y=O.top-F[1];for(let ot=0;ot<it;++ot){const lt=O.positionedLines[ot];Y=Eb(O,X,Y,ot);for(const ht of lt.positionedGlyphs){if(!ht.rect)continue;const mt=ht.rect||{};let yt=_b+1,ct=!0,ft=1,Rt=0;if(ht.imageName){const ui=U[ht.imageName];if(!ui)continue;if(ui.sdf){Q("SDF images are not supported in formatted text and will be ignored.");continue}ct=!1,ft=ui.pixelRatio,yt=mn/ft}const Vt=(N||V)&&ht.vertical,jt=ht.metrics.advance*ht.scale/2,$t=ht.metrics,re=ht.rect;if(null===re)continue;V&&O.verticalizable&&(Rt=ht.imageName?jt-ht.metrics.width*ht.scale/2:0);const ye=N?[ht.x+jt,ht.y]:[0,0];let je=[0,0],rn=[0,0],Re=!1;N||(Vt?(rn=[ht.x+jt+Z[0],ht.y+Z[1]-Rt],Re=!0):je=[ht.x+jt+F[0],ht.y+F[1]-Rt]);const Me=re.w*ht.scale/(ft*(ht.localGlyph?Ys:1)),ge=re.h*ht.scale/(ft*(ht.localGlyph?Ys:1));let ue,Le,an,Be;if(Vt){const ui=ht.y-Y,ei=new nt(-jt,jt-ui),cr=-Math.PI/2,_i=new nt(...rn);ue=new nt(-jt+je[0],je[1]),ue._rotateAround(cr,ei)._add(_i),ue.x+=-ui+jt,ue.y-=($t.left-yt)*ht.scale;const di=ht.imageName?$t.advance*ht.scale:kr*ht.scale,Hn=String.fromCodePoint(ht.glyph);kF(Hn)?ue.x+=(1-yt)*ht.scale:vy(Hn)?ue.x+=di-$t.height*ht.scale+(-yt-1)*ht.scale:ue.x+=ht.imageName||$t.width+2*yt===re.w&&$t.height+2*yt===re.h?(di-ge)/2:(di-($t.height+2*yt)*ht.scale)/2,Le=new nt(ue.x,ue.y-Me),an=new nt(ue.x+ge,ue.y),Be=new nt(ue.x+ge,ue.y-Me)}else{const ui=($t.left-yt)*ht.scale-jt+je[0],ei=(-$t.top-yt)*ht.scale+je[1],cr=ui+Me,_i=ei+ge;ue=new nt(ui,ei),Le=new nt(cr,ei),an=new nt(ui,_i),Be=new nt(cr,_i)}if(j){let ui;ui=N?new nt(0,0):Re?new nt(Z[0],Z[1]):new nt(F[0],F[1]),ue._rotateAround(j,ui),Le._rotateAround(j,ui),an._rotateAround(j,ui),Be._rotateAround(j,ui)}const Zn=new nt(0,0),Si=new nt(0,0);H.push({tl:ue,tr:Le,bl:an,br:Be,texPrimary:mt,texSecondary:void 0,writingMode:O.writingMode,glyphOffset:ye,sectionIndex:ht.sectionIndex,isSDF:ct,pixelOffsetTL:Zn,pixelOffsetBR:Si,minFontScaleX:0,minFontScaleY:0})}}return H}(0,s,p,c,d,h,l,n.allowVerticalPlacement),R=n.textSizeData;let P=null;"source"===R.kind?(P=[xa*c.layout.get("text-size").evaluate(h,{},S)],P[0]>Rc&&Q(`${n.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)):"composite"===R.kind&&(P=[xa*E.compositeTextSizes[0].evaluate(h,{},S),xa*E.compositeTextSizes[1].evaluate(h,{},S)],(P[0]>Rc||P[1]>Rc)&&Q(`${n.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)),n.addSymbols(n.text,D,P,p,d,h,_,t,r,m.lineStartIndex,m.lineLength,b,C,S,M,!1);for(const I of y)v[I]=n.text.placedSymbolArray.length-1;return 4*D.length}function Ay(n){for(const t in n)return n[t];return null}function Mb(n,t,r,s,l,c,d,h,p,m){let _=d.top,y=d.bottom,v=d.left,b=d.right;const E=d.collisionPadding;if(E&&(v-=E[0],_-=E[1],b+=E[2],y+=E[3]),p){const C=new nt(v,_),S=new nt(b,_),M=new nt(v,y),D=new nt(b,y),R=Ie(p);let P=new nt(0,0);m&&(P=new nt(m[0],m[1])),C._rotateAround(R,P),S._rotateAround(R,P),M._rotateAround(R,P),D._rotateAround(R,P),v=Math.min(C.x,S.x,M.x,D.x),b=Math.max(C.x,S.x,M.x,D.x),_=Math.min(C.y,S.y,M.y,D.y),y=Math.max(C.y,S.y,M.y,D.y)}return n.emplaceBack(t.x,t.y,t.z,r.x,r.y,v,_,b,y,h,s,l,c),n.length-1}function Ry(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const t=n.bottom-n.top;return t>0?Math.max(10,t):null}function LM(n,t,r,s){const l=n.compareText;if(t in l){const c=l[t];for(let d=c.length-1;d>=0;d--)if(s.dist(c[d])<r)return!0}else l[t]=[];return l[t].push(s),!1}function Sb(n,t){const r=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*t:0,l=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),c=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01)),d=Math.sin(n._pitch)*c+l;return Math.min(1.01*d,l*(1/n._horizonShift))}function Mu(n,t){if(!t.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:t};const r=Math.pow(2,-n.z),s=n.x*r,l=(n.x+1)*r,c=n.y*r,d=(n.y+1)*r,h=Ms(s),p=Ms(l),m=lr(c),_=lr(d),y=t.project(h,m),v=t.project(p,m),b=t.project(p,_),E=t.project(h,_);let C=Math.min(y.x,v.x,b.x,E.x),S=Math.min(y.y,v.y,b.y,E.y),M=Math.max(y.x,v.x,b.x,E.x),D=Math.max(y.y,v.y,b.y,E.y);const R=r/16;function P(O,F,L,N,z,U){const V=(L+z)/2,H=(N+U)/2,j=t.project(Ms(V),lr(H)),Z=Math.max(0,C-j.x,S-j.y,j.x-M,j.y-D);C=Math.min(C,j.x),M=Math.max(M,j.x),S=Math.min(S,j.y),D=Math.max(D,j.y),Z>R&&(P(O,j,L,N,V,H),P(j,F,V,H,z,U))}P(y,v,s,c,l,c),P(v,b,l,c,l,d),P(b,E,l,d,s,d),P(E,y,s,d,s,c),C-=R,S-=R,M+=R,D+=R;const I=1/Math.max(M-C,D-S);return{scale:I,x:C*I,y:S*I,x2:M*I,y2:D*I,projection:t}}function Py(n,t,r,s,l,c,d,h,p){if("globe"===p.name)return Q_(n,t,new ma(r,s,l),!1);const m=Mu({z:r,x:s,y:l},p);return new ci([(c+m.x/m.scale)*t,t*(m.y/m.scale),d],[(c+m.x2/m.scale)*t,t*(m.y2/m.scale),h])}function $l(n,{x:t,y:r},s=0){return new nt(((t-s)*n.scale-n.x)*dt,(r*n.scale-n.y)*dt)}function NM(n,t,r=0){return q.fromValues(((t.x-r)*n.scale-n.x)*dt,(t.y*n.scale-n.y)*dt,XC(t.z,t.y))}const h2=rt.identity(new Float32Array(16));class Hl{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new we(0,0)}projectTilePoint(t,r,s){return{x:t,y:r,z:0}}locationPoint(t,r,s=!0){return t._coordinatePoint(t.locationCoordinate(r),s)}pixelsPerMeter(t,r){return Ln(1,t)*r}pixelSpaceConversion(t,r,s){return 1}farthestPixelDistance(t){return Sb(t,t.pixelsPerMeter)}pointCoordinate(t,r,s,l){const c=t.horizonLineFromTop(!1),d=new nt(r,Math.max(c,s));return t.rayIntersectionCoordinate(t.pointRayIntersection(d,l))}pointCoordinate3D(t,r,s){const l=new nt(r,s);if(t.elevation)return t.elevation.pointCoordinate(l);{const c=this.pointCoordinate(t,l.x,l.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(t,r){if(t.elevation)return!this.pointCoordinate3D(t,r.x,r.y);const s=t.horizonLineFromTop();return r.y<s}createInversionMatrix(t,r){return h2}createTileMatrix(t,r,s){let l,c,d;const h=s.canonical,p=rt.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const m=Mu(h,this);l=1,c=m.x+s.wrap*m.scale,d=m.y,rt.scale(p,p,[l/m.scale,l/m.scale,t.pixelsPerMeter/r])}else l=r/t.zoomScale(h.z),c=(h.x+Math.pow(2,h.z)*s.wrap)*l,d=h.y*l;return rt.translate(p,p,[c,d,0]),rt.scale(p,p,[l/dt,l/dt,1]),p}upVector(t,r,s){return[0,0,1]}upVectorScale(t,r,s){return{metersToTile:1}}}class f2 extends Hl{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,s]=this.parallels=t.parallels||[29.5,45.5],l=Math.sin(Ie(r));this.n=(l+Math.sin(Ie(s)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:s,c:l,r0:c}=this,d=Ie(t-this.center[0]),h=Ie(r),p=Math.sqrt(l-2*s*Math.sin(h))/s;return{x:p*Math.sin(d*s),y:p*Math.cos(d*s)-c,z:0}}unproject(t,r){const{n:s,c:l,r0:c}=this,d=c+r;let h=Math.atan2(t,Math.abs(d))*Math.sign(d);d*s<0&&(h-=Math.PI*Math.sign(t)*Math.sign(d));const p=Ie(this.center[0])*s;h=bl(h,-Math.PI-p,Math.PI-p);const m=Jt(Er(h/s)+this.center[0],-180,180),_=Math.asin(Jt((l-(t*t+d*d)*s*s)/(2*s),-1,1)),y=Jt(Er(_),-Hi,Hi);return new we(m,y)}}const af=1.340264,Em=-.081106,Su=893e-6,Pc=.003796,Cm=Math.sqrt(3)/2;class Oy extends Hl{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const s=Math.asin(Cm*Math.sin(r)),l=s*s,c=l*l*l;return{x:.5*(t*Math.cos(s)/(Cm*(af+3*Em*l+c*(7*Su+9*Pc*l)))/Math.PI+.5),y:1-.5*(s*(af+Em*l+c*(Su+Pc*l))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,l=s*s,c=l*l*l;for(let _,y,v,b=0;b<12&&(y=s*(af+Em*l+c*(Su+Pc*l))-r,v=af+3*Em*l+c*(7*Su+9*Pc*l),_=y/v,s=Jt(s-_,-Math.PI/3,Math.PI/3),l=s*s,c=l*l*l,!(Math.abs(_)<1e-12));++b);const d=Cm*t*(af+3*Em*l+c*(7*Su+9*Pc*l))/Math.cos(s),h=Math.asin(Math.sin(s)/Cm),p=Jt(180*d/Math.PI,-180,180),m=Jt(180*h/Math.PI,-Hi,Hi);return new we(p,m)}}class FF extends Hl{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const s=360*(t-.5),l=Jt(360*(.5-r),-Hi,Hi);return new we(s,l)}}const lf=Math.PI/2;function Mm(n){return Math.tan((lf+n)/2)}class zM extends Hl{constructor(t){super(t),this.center=t.center||[0,30];const[r,s]=this.parallels=t.parallels||[30,30];let l=Ie(r),c=Ie(s);this.southernCenter=l+c<0,this.southernCenter&&(l=-l,c=-c);const d=Math.cos(l),h=Mm(l);this.n=l===c?Math.sin(l):Math.log(d/Math.cos(c))/Math.log(Mm(c)/h),this.f=d*Math.pow(Mm(l),this.n)/this.n}project(t,r){r=Ie(r),this.southernCenter&&(r=-r),t=Ie(t-this.center[0]);const s=1e-6,{n:l,f:c}=this;c>0?r<-lf+s&&(r=-lf+s):r>lf-s&&(r=lf-s);const d=c/Math.pow(Mm(r),l);let h=d*Math.sin(l*t),p=c-d*Math.cos(l*t);return h=.5*(h/Math.PI+.5),p=.5*(p/Math.PI+.5),{x:h,y:this.southernCenter?p:1-p,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:s,f:l}=this,c=l-r,d=Math.sign(c),h=Math.sign(s)*Math.sqrt(t*t+c*c);let p=Math.atan2(t,Math.abs(c))*d;c*s<0&&(p-=Math.PI*Math.sign(t)*d);const m=Jt(Er(p/s)+this.center[0],-180,180),_=Jt(Er(2*Math.atan(Math.pow(l/h,1/s))-lf),-Hi,Hi);return new we(m,this.southernCenter?-_:_)}}class BM extends Hl{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:eo(t),y:po(r),z:0}}unproject(t,r){const s=Ms(t),l=lr(r);return new we(s,l)}}const VM=Ie(Hi);class jM extends Hl{project(t,r){const s=(r=Ie(r))*r,l=s*s;return{x:.5*((t=Ie(t))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,l=25,c=0,d=s*s;do{d=s*s;const m=d*d;c=(s*(1.007226+d*(.015085+m*(.028874*d-.044475-.005916*m)))-r)/(1.007226+d*(.045255+m*(.259866*d-.311325-.005916*11*m))),s=Jt(s-c,-VM,VM)}while(Math.abs(c)>1e-6&&--l>0);d=s*s;const h=Jt(Er(t/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),p=Er(s);return new we(h,p)}}const Tb=Ie(Hi);class Sm extends Hl{project(t,r){r=Ie(r),t=Ie(t);const s=Math.cos(r),l=2/Math.PI,c=Math.acos(s*Math.cos(t/2)),d=Math.sin(c)/c,h=.5*(t*l+2*s*Math.sin(t/2)/d)||0,p=.5*(r+Math.sin(r)/d)||0;return{x:.5*(h/Math.PI+.5),y:1-.5*(p/Math.PI+1),z:0}}unproject(t,r){let s=t=(2*t-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,c=25;const d=1e-6;let h=0,p=0;do{const m=Math.cos(l),_=Math.sin(l),y=2*_*m,v=_*_,b=m*m,E=Math.cos(s/2),C=Math.sin(s/2),S=2*E*C,M=C*C,D=1-b*E*E,R=D?1/D:0,P=D?Math.acos(m*E)*Math.sqrt(1/D):0,I=.5*(2*P*m*C+2*s/Math.PI)-t,O=.5*(P*_+l)-r,F=.5*R*(b*M+P*m*E*v)+1/Math.PI,L=R*(S*y/4-P*_*C),N=.125*R*(y*C-P*_*b*S),z=.5*R*(v*E+P*M*m)+.5,U=L*N-z*F;h=(O*L-I*z)/U,p=(I*N-O*F)/U,s=Jt(s-h,-Math.PI,Math.PI),l=Jt(l-p,-Tb,Tb)}while((Math.abs(h)>d||Math.abs(p)>d)&&--c>0);return new we(Er(s),Er(l))}}class UM extends Hl{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ie(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:s,cosPhi:l}=this;return{x:Ie(t)*l*s+.5,y:-Math.sin(Ie(r))/l*s+.5,z:0}}unproject(t,r){const{scale:s,cosPhi:l}=this,c=-(r-.5)/s,d=Jt(Er((t-.5)/s)/l,-180,180),h=Math.asin(Jt(c*l,-1,1)),p=Jt(Er(h),-Hi,Hi);return new we(d,p)}}class $M extends BM{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,s){const l=Xp(t,r,s),c=to(Oo(s));return q.transformMat4(l,l,c),{x:l[0],y:l[1],z:l[2]}}locationPoint(t,r){const s=as(r.lat,r.lng),l=q.normalize([],s),c=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude,d=Ln(1,0)*dt*c;q.scaleAndAdd(s,s,l,d);const h=rt.identity(new Float64Array(16));return rt.multiply(h,t.pixelMatrix,t.globeMatrix),q.transformMat4(s,s,h),new nt(s[0],s[1])}pixelsPerMeter(t,r){return Ln(1,0)*r}pixelSpaceConversion(t,r,s){const l=Ln(1,t)*r,c=_e(Ln(1,45)*r,l,s);return this.pixelsPerMeter(t,r)/c}createTileMatrix(t,r,s){const l=ya(Oo(s.canonical));return rt.multiply(new Float64Array(16),t.globeMatrix,l)}createInversionMatrix(t,r){const{center:s}=t,l=to(Oo(r));return rt.rotateY(l,l,Ie(s.lng)),rt.rotateX(l,l,Ie(s.lat)),rt.scale(l,l,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(t,r,s,l){return BC(t,r,s,!0)||new Ke(0,0)}pointCoordinate3D(t,r,s){const l=this.pointCoordinate(t,r,s,0);return[l.x,l.y,l.z]}isPointAboveHorizon(t,r){return!BC(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=function(l,c){const d=l.cameraToCenterDistance,h=l._centerAltitude*c,p=l._camera,m=l._camera.forward(),_=q.add([],q.scale([],m,-d),[0,0,h]),y=l.worldSize/(2*Math.PI),v=[0,0,-y],b=l.width/l.height,E=Math.tan(l.fovAboveCenter),C=q.scale([],p.up(),E),S=q.scale([],p.right(),E*b),M=q.normalize([],q.add([],q.add([],m,C),S)),D=[];let R;if(new Bh(_,M).closestPointOnSphere(v,y,D)){const P=q.add([],D,v),I=q.sub([],P,_);R=Math.cos(l.fovAboveCenter)*q.length(I)}else{const P=q.sub([],_,v),I=q.sub([],v,_);q.normalize(I,I);const O=q.length(P)-y;R=Math.sqrt(O*(O+2*y));const F=Math.acos(R/(y+O))-Math.acos(q.dot(m,I));R*=Math.cos(F)}return 1.01*R}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),s=Br(t.zoom);if(s>0){const l=Sb(t,Ln(1,t.center.lat)*t.worldSize),c=t.worldSize/(2*Math.PI),d=Math.max(t.width,t.height)/t.worldSize*Math.PI;return _e(r,l+c*(1-Math.cos(d)),Math.pow(s,10))}return r}upVector(t,r,s){return Xp(r,s,t,1)}upVectorScale(t){return{metersToTile:Dx(ty(Oo(t)))}}}function Tm(n){const t=n.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(n.name){case"mercator":return new BM(n);case"equirectangular":return new FF(n);case"naturalEarth":return new jM(n);case"equalEarth":return new Oy(n);case"winkelTripel":return new Sm(n);case"albers":return r?new UM(n):new f2(n);case"lambertConformalConic":return r?new UM(n):new zM(n);case"globe":return new $M(n)}throw new Error(`Invalid projection name: ${n.name}`)}const p2=new Ei({"symbol-placement":new Dt(J.layout_symbol["symbol-placement"]),"symbol-spacing":new Dt(J.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dt(J.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new se(J.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dt(J.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Dt(J.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Dt(J.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Dt(J.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dt(J.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dt(J.layout_symbol["icon-rotation-alignment"]),"icon-size":new se(J.layout_symbol["icon-size"]),"icon-text-fit":new se(J.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new se(J.layout_symbol["icon-text-fit-padding"]),"icon-image":new se(J.layout_symbol["icon-image"]),"icon-rotate":new se(J.layout_symbol["icon-rotate"]),"icon-padding":new Dt(J.layout_symbol["icon-padding"]),"icon-keep-upright":new Dt(J.layout_symbol["icon-keep-upright"]),"icon-offset":new se(J.layout_symbol["icon-offset"]),"icon-anchor":new se(J.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dt(J.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dt(J.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dt(J.layout_symbol["text-rotation-alignment"]),"text-field":new se(J.layout_symbol["text-field"]),"text-font":new se(J.layout_symbol["text-font"]),"text-size":new se(J.layout_symbol["text-size"]),"text-max-width":new se(J.layout_symbol["text-max-width"]),"text-line-height":new se(J.layout_symbol["text-line-height"]),"text-letter-spacing":new se(J.layout_symbol["text-letter-spacing"]),"text-justify":new se(J.layout_symbol["text-justify"]),"text-radial-offset":new se(J.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dt(J.layout_symbol["text-variable-anchor"]),"text-anchor":new se(J.layout_symbol["text-anchor"]),"text-max-angle":new Dt(J.layout_symbol["text-max-angle"]),"text-writing-mode":new Dt(J.layout_symbol["text-writing-mode"]),"text-rotate":new se(J.layout_symbol["text-rotate"]),"text-padding":new Dt(J.layout_symbol["text-padding"]),"text-keep-upright":new Dt(J.layout_symbol["text-keep-upright"]),"text-transform":new se(J.layout_symbol["text-transform"]),"text-offset":new se(J.layout_symbol["text-offset"]),"text-allow-overlap":new Dt(J.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Dt(J.layout_symbol["text-ignore-placement"]),"text-optional":new Dt(J.layout_symbol["text-optional"]),visibility:new Dt(J.layout_symbol.visibility)});var Db={paint:new Ei({"icon-opacity":new se(J.paint_symbol["icon-opacity"]),"icon-emissive-strength":new se(J.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new se(J.paint_symbol["text-emissive-strength"]),"icon-color":new se(J.paint_symbol["icon-color"]),"icon-halo-color":new se(J.paint_symbol["icon-halo-color"]),"icon-halo-width":new se(J.paint_symbol["icon-halo-width"]),"icon-halo-blur":new se(J.paint_symbol["icon-halo-blur"]),"icon-translate":new Dt(J.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dt(J.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new se(J.paint_symbol["icon-image-cross-fade"]),"text-opacity":new se(J.paint_symbol["text-opacity"]),"text-color":new se(J.paint_symbol["text-color"],{runtimeType:Oa,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new se(J.paint_symbol["text-halo-color"]),"text-halo-width":new se(J.paint_symbol["text-halo-width"]),"text-halo-blur":new se(J.paint_symbol["text-halo-blur"]),"text-translate":new Dt(J.paint_symbol["text-translate"]),"text-translate-anchor":new Dt(J.paint_symbol["text-translate-anchor"])}),layout:p2};class cf{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:aa,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xt(cf,"FormatSectionOverride",{omit:["defaultValue"]});class ky extends Gs{constructor(t,r){super(t,Db,r)}recalculate(t,r){super.recalculate(t,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const c of s)l.indexOf(c)<0&&l.push(c);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,l){const c=this.layout.get(t).evaluate(r,{},s,l),d=this._unevaluatedLayout._values[t];return d.isDataDriven()||bp(d.value)||!c?c:(h=r.properties,c.replace(/{([^{}]+)}/g,(m,_)=>_ in h?String(h[_]):""));var h}createBucket(t){return new Dm(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Db.paint.overridableProperties){if(!ky.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new cf(r),l=new __(s,r.property.specification);let c=null;c="constant"===r.value.kind||"source"===r.value.kind?new wp("source",l):new gc("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[t]=new xs(r.property,c,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&ky.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),l=Db.paint.properties[r];let c=!1;const d=h=>{for(const p of h)if(l.overrides&&l.overrides.hasOverride(p))return void(c=!0)};if("constant"===s.value.kind&&s.value.value instanceof Ye)d(s.value.value.sections);else if("source"===s.value.kind){const h=m=>{c||(m instanceof t_&&Mr(m.value)===qg?d(m.value.sections):m instanceof ih?d(m.sections):m.eachChild(h))},p=s.value;p._styleExpression&&h(p._styleExpression.expression)}return c}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),r=0!==this.paint.get("text-opacity").constantOr(1),s=[];return t&&s.push("symbolIcon"),r&&s.push("symbolSDF"),s}getDefaultProgramParams(t,r){return{config:new Ah(this,r),overrideFog:!1}}}const m2=pm.types,g2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fy(n,t,r,s,l,c,d,h,p,m,_,y,v){const b=h?Math.min(Rc,Math.round(h[0])):0,E=h?Math.min(Rc,Math.round(h[1])):0;n.emplaceBack(t,r,Math.round(32*s),Math.round(32*l),c,d,(b<<1)+(p?1:0),E,16*m,16*_,256*y,256*v)}function Ly(n,t,r){n.emplaceBack(t,r)}function Ny(n,t,r,s,l,c,d){n.emplaceBack(t,r,s,l,c,d)}function zy(n,t,r,s,l){const c=5*t+2;n.float32[c+0]=r,n.float32[c+1]=s,n.float32[c+2]=l}function uf(n,t,r,s,l){n.emplaceBack(t,r,s,l),n.emplaceBack(t,r,s,l),n.emplaceBack(t,r,s,l),n.emplaceBack(t,r,s,l)}function HM(n){for(const t of n.sections)if(fA(t.text))return!0;return!1}class Wn{constructor(t){this.layoutVertexArray=new Y0,this.indexArray=new er,this.programConfigurations=t,this.segments=new Bn,this.dynamicLayoutVertexArray=new Ci,this.opacityVertexArray=new A_,this.placedSymbolArray=new Mh,this.iconTransitioningVertexArray=new Va,this.globeExtVertexArray=new I_,this.zOffsetVertexArray=new Op}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,r,s,l,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yM.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,_m.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,g2,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,vM.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,gb.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,yy.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Xt(Wn,"SymbolBuffers");class Ib{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Bn,this.collisionVertexArray=new Ch,this.collisionVertexArrayExt=new ja}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,xM.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,e2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xt(Ib,"CollisionBuffers");class Td{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rt.identity([]),this.placementViewportMatrix=rt.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wM(this.zoom,r["text-size"]),this.iconSizeData=wM(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),c=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==c&&void 0!==l.constantOr(1),this.sortFeaturesByY=("viewport-y"===c||"auto"===c&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(d=>ti[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate")}createArrays(){this.text=new Wn(new dd(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Wn(new dd(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new N_,this.lineVertexArray=new kp,this.symbolInstances=new Sh}calculateGlyphDependencies(t,r,s,l,c){for(let d=0;d<t.length;d++){const h=t.codePointAt(d);if(void 0===h)break;if(r[h]=!0,l&&c&&h<=65535){const p=ef[t.charAt(d)];p&&(r[p.charCodeAt(0)]=!0)}}}populate(t,r,s,l){const c=this.layers[0],d=c.layout,h="globe"===this.projection.name,p=d.get("text-font"),m=d.get("text-field"),_=d.get("icon-image"),y=("constant"!==m.value.kind||m.value.value instanceof Ye&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&("constant"!==p.value.kind||p.value.value.length>0),v="constant"!==_.value.kind||!!_.value.value||Object.keys(_.parameters).length>0,b=d.get("symbol-sort-key");if(this.features=[],!y&&!v)return;const E=r.iconDependencies,C=r.glyphDependencies,S=r.availableImages,M=new wi(this.zoom);for(const{feature:D,id:R,index:P,sourceLayerIndex:I}of t){const O=c._featureFilter.needGeometry,F=gu(D,O);if(!c._featureFilter.filter(M,F,s))continue;if(O||(F.geometry=Vl(D,s,l)),h&&1!==D.type&&s.z<=5){const U=F.geometry,V=.98078528056,H=(j,Z)=>{const tt=Xp(j.x,j.y,s,1),it=Xp(Z.x,Z.y,s,1);return q.dot(tt,it)<V};for(let j=0;j<U.length;j++)U[j]=KC(U[j],H)}let L,N;if(y){const U=c.getValueAndResolveTokens("text-field",F,s,S),V=Ye.factory(U);HM(V)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===da()||this.hasRTLText&&vs.isParsed())&&(L=EM(V,c,F))}if(v){const U=c.getValueAndResolveTokens("icon-image",F,s,S);N=U instanceof ms?U:ms.fromString(U)}if(!L&&!N)continue;const z=this.sortFeaturesByKey?b.evaluate(F,{},s):void 0;if(this.features.push({id:R,text:L,icon:N,index:P,sourceLayerIndex:I,geometry:F.geometry,properties:D.properties,type:m2[D.type],sortKey:z}),N&&(E[N.namePrimary]=!0,N.nameSecondary&&(E[N.nameSecondary]=!0)),L){const U=p.evaluate(F,{},s).join(","),V="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ti.vertical)>=0;for(const H of L.sections)if(H.image)E[H.image.namePrimary]=!0;else{const j=$0(L.toString()),Z=H.fontStack||U,tt=C[Z]=C[Z]||{};this.calculateGlyphDependencies(H.text,tt,V,this.allowVerticalPlacement,j)}}}"line"===d.get("symbol-placement")&&(this.features=function(D){const R={},P={},I=[];let O=0;function F(U){I.push(D[U]),O++}function L(U,V,H){const j=P[U];return delete P[U],P[V]=j,I[j].geometry[0].pop(),I[j].geometry[0]=I[j].geometry[0].concat(H[0]),j}function N(U,V,H){const j=R[V];return delete R[V],R[U]=j,I[j].geometry[0].shift(),I[j].geometry[0]=H[0].concat(I[j].geometry[0]),j}function z(U,V,H){const j=H?V[0][V[0].length-1]:V[0][0];return`${U}:${j.x}:${j.y}`}for(let U=0;U<D.length;U++){const V=D[U],H=V.geometry,j=V.text?V.text.toString():null;if(!j){F(U);continue}const Z=z(j,H),tt=z(j,H,!0);if(Z in P&&tt in R&&P[Z]!==R[tt]){const it=N(Z,tt,H),X=L(Z,tt,I[it].geometry);delete R[Z],delete P[tt],P[z(j,I[X].geometry,!0)]=X,I[it].geometry=null}else Z in P?L(Z,tt,H):tt in R?N(Z,tt,H):(F(U),R[Z]=O-1,P[tt]=O-1)}return I.filter(U=>U.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((D,R)=>D.sortKey-R.sortKey)}update(t,r,s,l,c){const d=0!==Object.keys(t).length;if(d&&!this.stateDependentLayers.length)return;const h=d?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,r,h,s,l,c),this.icon.programConfigurations.updatePaintArrays(t,r,h,s,l,c)}updateZOffset(){const t=(c,d,h)=>{s+=d,s>c.length&&c.resize(s);for(let p=-d;p<0;p++)c.emplace(p+s,h)},r=(c,d,h)=>{l+=d,l>c.length&&c.resize(l);for(let p=-d;p<0;p++)c.emplace(p+l,h)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,l=0;for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c),{numHorizontalGlyphVertices:h,numVerticalGlyphVertices:p,numIconVertices:m}=d,_=d.zOffset,y=m>0;if((h>0||p>0)&&(t(this.text.zOffsetVertexArray,h,_),t(this.text.zOffsetVertexArray,p,_)),y){const{placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:b}=d;v>=0&&r(this.icon.zOffsetVertexArray,m,_),b>=0&&r(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Tm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:l,y:c}of r)this.lineVertexArray.emplaceBack(l,c);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S){const M=t.indexArray,D=t.layoutVertexArray,R=t.globeExtVertexArray,P=t.segments.prepareSegment(4*r.length,D,M,this.canOverlap?d.sortKey:void 0),I=this.glyphOffsetArray.length,O=P.vertexLength,F=this.allowVerticalPlacement&&h===ti.vertical?Math.PI/2:0,L=d.text&&d.text.sections;for(let z=0;z<r.length;z++){const{tl:U,tr:V,bl:H,br:j,texPrimary:Z,texSecondary:tt,pixelOffsetTL:it,pixelOffsetBR:X,minFontScaleX:Y,minFontScaleY:ot,glyphOffset:lt,isSDF:ht,sectionIndex:mt}=r[z],yt=P.vertexLength,ct=lt[1];if(Fy(D,m.x,m.y,U.x,ct+U.y,Z.x,Z.y,s,ht,it.x,it.y,Y,ot),Fy(D,m.x,m.y,V.x,ct+V.y,Z.x+Z.w,Z.y,s,ht,X.x,it.y,Y,ot),Fy(D,m.x,m.y,H.x,ct+H.y,Z.x,Z.y+Z.h,s,ht,it.x,X.y,Y,ot),Fy(D,m.x,m.y,j.x,ct+j.y,Z.x+Z.w,Z.y+Z.h,s,ht,X.x,X.y,Y,ot),p){const{x:ft,y:Rt,z:Vt}=p.anchor,[jt,$t,re]=p.up;Ny(R,ft,Rt,Vt,jt,$t,re),Ny(R,ft,Rt,Vt,jt,$t,re),Ny(R,ft,Rt,Vt,jt,$t,re),Ny(R,ft,Rt,Vt,jt,$t,re),uf(t.dynamicLayoutVertexArray,ft,Rt,Vt,F)}else uf(t.dynamicLayoutVertexArray,m.x,m.y,m.z,F);if(S){const ft=tt||Z;Ly(t.iconTransitioningVertexArray,ft.x,ft.y),Ly(t.iconTransitioningVertexArray,ft.x+ft.w,ft.y),Ly(t.iconTransitioningVertexArray,ft.x,ft.y+ft.h),Ly(t.iconTransitioningVertexArray,ft.x+ft.w,ft.y+ft.h)}M.emplaceBack(yt,yt+1,yt+2),M.emplaceBack(yt+1,yt+2,yt+3),P.vertexLength+=4,P.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(lt[0]),z!==r.length-1&&mt===r[z+1].sectionIndex||t.programConfigurations.populatePaintArrays(D.length,d,d.index,{},b,E,C,L&&L[mt])}const N=p?p.anchor:m;t.placedSymbolArray.emplaceBack(N.x,N.y,N.z,m.x,m.y,I,this.glyphOffsetArray.length-I,O,_,y,m.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],h,0,!1,0,v,0)}_commitLayoutVertex(t,r,s,l,c,d,h){t.emplaceBack(r,s,l,c,d,Math.round(h.x),Math.round(h.y))}_addCollisionDebugVertices(t,r,s,l,c,d,h){const p=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),m=p.vertexLength,_=h.tileAnchorX,y=h.tileAnchorY;for(let b=0;b<4;b++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(r,-t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(r,t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(r,t.padding,t.padding),s.collisionVertexArrayExt.emplaceBack(r,-t.padding,t.padding),this._commitLayoutVertex(s.layoutVertexArray,l,c,d,_,y,new nt(t.x1,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,c,d,_,y,new nt(t.x2,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,c,d,_,y,new nt(t.x2,t.y2)),this._commitLayoutVertex(s.layoutVertexArray,l,c,d,_,y,new nt(t.x1,t.y2)),p.vertexLength+=4;const v=s.indexArray;v.emplaceBack(m,m+1),v.emplaceBack(m+1,m+2),v.emplaceBack(m+2,m+3),v.emplaceBack(m+3,m),p.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,s,l,c,d){for(let h=l;h<c;h++){const p=s.get(h),m=this.getSymbolInstanceTextSize(t,d,r,h);this._addCollisionDebugVertices(p,m,this.textCollisionBox,p.projectedAnchorX,p.projectedAnchorY,p.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(t,r,s,l,c,d){for(let h=l;h<c;h++){const p=s.get(h),m=this.getSymbolInstanceIconSize(t,r,d.placedIconSymbolIndex);this._addCollisionDebugVertices(p,m,this.iconCollisionBox,p.projectedAnchorX,p.projectedAnchorY,p.projectedAnchorZ,d)}}generateCollisionDebugBuffers(t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ib(R_,bM.members,Va),this.iconCollisionBox=new Ib(R_,bM.members,Va);const s=Ic(this.iconSizeData,t),l=Ic(this.textSizeData,t);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(l,t,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(l,t,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(s,t,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(s,t,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(t,r,s,l){const c=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),d=ym(this.textSizeData,t,c)/kr;return this.tilePixelRatio*d}getSymbolInstanceIconSize(t,r,s){const l=this.icon.placedSymbolArray.get(s),c=ym(this.iconSizeData,t,l);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(t,r,s){t.emplaceBack(r,-s,-s),t.emplaceBack(r,s,-s),t.emplaceBack(r,s,s),t.emplaceBack(r,-s,s)}_updateTextDebugCollisionBoxes(t,r,s,l,c,d){for(let h=l;h<c;h++){const p=s.get(h),m=this.getSymbolInstanceTextSize(t,d,r,h);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,m,p.padding)}}_updateIconDebugCollisionBoxes(t,r,s,l,c,d){for(let h=l;h<c;h++){const p=s.get(h),m=this.getSymbolInstanceIconSize(t,r,d);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,m,p.padding)}}updateCollisionDebugBuffers(t,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Ic(this.iconSizeData,t),l=Ic(this.textSizeData,t);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(l,t,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(l,t,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(s,t,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,t,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,s,l,c,d,h,p,m){const _={};if(r<s){const{x1:y,y1:v,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(r);_.textBox={x1:y,y1:v,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P},_.textFeatureIndex=I}if(l<c){const{x1:y,y1:v,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(l);_.verticalTextBox={x1:y,y1:v,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P},_.verticalTextFeatureIndex=I}if(d<h){const{x1:y,y1:v,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(d);_.iconBox={x1:y,y1:v,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P},_.iconFeatureIndex=I}if(p<m){const{x1:y,y1:v,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(p);_.verticalIconBox={x1:y,y1:v,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P},_.verticalIconFeatureIndex=I}return _}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let c=s.vertexStartIndex;c<l;c+=4)t.indexArray.emplaceBack(c,c+1,c+2),t.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),l=[],c=[],d=[];for(let h=0;h<this.symbolInstances.length;++h){d.push(h);const p=this.symbolInstances.get(h);l.push(0|Math.round(r*p.tileAnchorX+s*p.tileAnchorY)),c.push(p.featureIndex)}return d.sort((h,p)=>l[h]-l[p]||c[p]-c[h]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:h,placedIconSymbolIndex:p,verticalPlacedIconSymbolIndex:m}=s;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),c>=0&&c!==l&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p),m>=0&&this.addIndicesForPlacedSymbol(this.icon,m)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xt(Td,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Td.MAX_GLYPHS=65535,Td.addDynamicAttributes=uf;var Dm=Td;const _2=pn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:y2}=_2,v2=pn([{name:"a_packed",components:4,type:"Float32"}]),{members:x2}=v2,b2=pm.types,w2=Math.cos(Math.PI/180*37.5);class Im{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new _c,this.layoutVertexArray2=new Ci,this.indexArray=new er,this.programConfigurations=new dd(t.layers,t.zoom),this.segments=new Bn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s,l){this.hasPattern=nb("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:_,id:y,index:v,sourceLayerIndex:b}of t){const E=this.layers[0]._featureFilter.needGeometry,C=gu(_,E);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),C,s))continue;const S=c?c.evaluate(C,{},s):void 0,M={id:y,properties:_.properties,type:_.type,sourceLayerIndex:b,index:v,geometry:E?C.geometry:Vl(_,s,l),patterns:{},sortKey:S};d.push(M)}c&&d.sort((_,y)=>_.sortKey-y.sortKey);const{lineAtlas:h,featureIndex:p}=r,m=this.addConstantDashes(h);for(const _ of d){const{geometry:y,index:v,sourceLayerIndex:b}=_;if(m&&this.addFeatureDashes(_,h),this.hasPattern){const E=dy("line",this.layers,_,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(_,y,v,s,h.positions,r.availableImages,r.brightness);p.insert(t[v].feature,y,v,b,this.index)}}addConstantDashes(t){let r=!1;for(const s of this.layers){const l=s.paint.get("line-dasharray").value,c=s.layout.get("line-cap").value;if("constant"!==l.kind||"constant"!==c.kind)r=!0;else{const d=c.value,h=l.value;if(!h)continue;t.addDash(h,d)}}return r}addFeatureDashes(t,r){const s=this.zoom;for(const l of this.layers){const c=l.paint.get("line-dasharray").value,d=l.layout.get("line-cap").value;if("constant"===c.kind&&"constant"===d.kind)continue;let h,p;if("constant"===c.kind){if(h=c.value,!h)continue}else h=c.evaluate({zoom:s},t);p="constant"===d.kind?d.value:d.evaluate({zoom:s},t),r.addDash(h,p),t.patterns[l.id]=r.getKey(h,p)}}update(t,r,s,l,c){const d=0!==Object.keys(t).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,d?this.stateDependentLayers:this.layers,s,l,c)}addFeatures(t,r,s,l,c,d){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,s,l,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,x2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,y2),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,l,c,d,h){const p=this.layers[0].layout,m=p.get("line-join").evaluate(t,{}),_=p.get("line-cap").evaluate(t,{}),y=p.get("line-miter-limit"),v=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const b of r)this.addLine(b,t,m,_,y,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,c,d,l,h)}addLine(t,r,s,l,c,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let M=0;M<t.length-1;M++)this.totalDistance+=t[M].dist(t[M+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const h="Polygon"===b2[r.type];let p=t.length;for(;p>=2&&t[p-1].equals(t[p-2]);)p--;let m=0;for(;m<p-1&&t[m].equals(t[m+1]);)m++;if(p<(h?3:2))return;"bevel"===s&&(c=1.05);const _=this.overscaling<=16?15*dt/(512*this.overscaling):0,y=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);let v,b,E,C,S;this.e1=this.e2=-1,h&&(v=t[p-2],S=t[m].sub(v)._unit()._perp());for(let M=m;M<p;M++){if(E=M===p-1?h?t[m+1]:void 0:t[M+1],E&&t[M].equals(E))continue;S&&(C=S),v&&(b=v),v=t[M],S=E?E.sub(v)._unit()._perp():C,C=C||S;let D=C.add(S);0===D.x&&0===D.y||D._unit();const R=C.x*S.x+C.y*S.y,P=D.x*S.x+D.y*S.y,I=0!==P?1/P:1/0,O=2*Math.sqrt(2-2*P),F=P<w2&&b&&E,L=C.x*S.y-C.y*S.x>0;if(F&&M>m){const U=v.dist(b);if(U>2*_){const V=v.sub(v.sub(b)._mult(_/U)._round());this.updateDistance(b,V),this.addCurrentVertex(V,C,0,0,y),b=V}}const N=b&&E;let z=N?s:h?"butt":l;if(N&&"round"===z&&(I<d?z="miter":I<=2&&(z="fakeround")),"miter"===z&&I>c&&(z="bevel"),"bevel"===z&&(I>2&&(z="flipbevel"),I<c&&(z="miter")),b&&this.updateDistance(b,v),"miter"===z)D._mult(I),this.addCurrentVertex(v,D,0,0,y);else if("flipbevel"===z){if(I>100)D=S.mult(-1);else{const U=I*C.add(S).mag()/C.sub(S).mag();D._perp()._mult(U*(L?-1:1))}this.addCurrentVertex(v,D,0,0,y),this.addCurrentVertex(v,D.mult(-1),0,0,y)}else if("bevel"===z||"fakeround"===z){const U=-Math.sqrt(I*I-1),V=L?U:0,H=L?0:U;if(b&&this.addCurrentVertex(v,C,V,H,y),"fakeround"===z){const j=Math.round(180*O/Math.PI/20);for(let Z=1;Z<j;Z++){let tt=Z/j;if(.5!==tt){const X=tt-.5;tt+=tt*X*(tt-1)*((1.0904+R*(R*(3.55645-1.43519*R)-3.2452))*X*X+(.848013+R*(.215638*R-1.06021)))}const it=S.sub(C)._mult(tt)._add(C)._unit()._mult(L?-1:1);this.addHalfVertex(v,it.x,it.y,!1,L,0,y)}}E&&this.addCurrentVertex(v,S,-V,-H,y)}else if("butt"===z)this.addCurrentVertex(v,D,0,0,y);else if("square"===z){const U=b?1:-1;b||this.addCurrentVertex(v,D,U,U,y),this.addCurrentVertex(v,D,0,0,y),b&&this.addCurrentVertex(v,D,U,U,y)}else"round"===z&&(b&&(this.addCurrentVertex(v,C,0,0,y),this.addCurrentVertex(v,C,1,1,y,!0)),E&&(this.addCurrentVertex(v,S,-1,-1,y,!0),this.addCurrentVertex(v,S,0,0,y)));if(F&&M<p-1){const U=v.dist(E);if(U>2*_){const V=v.add(E.sub(v)._mult(_/U)._round());this.updateDistance(v,V),this.addCurrentVertex(V,S,0,0,y),v=V}}}}addCurrentVertex(t,r,s,l,c,d=!1){const h=r.y*l-r.x,p=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,d,!1,s,c),this.addHalfVertex(t,h,p,d,!0,-l,c)}addHalfVertex({x:t,y:r},s,l,c,d,h,p){this.layoutVertexArray.emplaceBack((t<<1)+(c?1:0),(r<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(0===h?0:h<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const m=p.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,m),p.primitiveLength++),d?this.e2=m:this.e1=m}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}Xt(Im,"LineBucket",{omit:["layers","patternFeatures"]});class ir{constructor(t,r,s,l){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(r,l)}update(t,r,s){const{width:l,height:c}=t,{context:d}=this,{gl:h}=d,{HTMLImageElement:p,HTMLCanvasElement:m,HTMLVideoElement:_,ImageData:y,ImageBitmap:v}=st;if(h.bindTexture(h.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA&&(!r||!1!==r.premultiply)),s||this.size&&this.size[0]===l&&this.size[1]===c){const{x:b,y:E}=s||{x:0,y:0};if(t instanceof p||t instanceof m||t instanceof _||t instanceof y||v&&t instanceof v)h.texSubImage2D(h.TEXTURE_2D,0,b,E,h.RGBA,h.UNSIGNED_BYTE,t);else{let C=this.format,S=h.UNSIGNED_BYTE;this.format===h.R32F&&(C=h.RED,S=h.FLOAT),h.texSubImage2D(h.TEXTURE_2D,0,b,E,l,c,C,S,t.data)}}else if(this.size=[l,c],t instanceof p||t instanceof m||t instanceof _||t instanceof y||v&&t instanceof v){let b=this.format;this.format===h.R8&&(b=h.RED),h.texImage2D(h.TEXTURE_2D,0,this.format,b,h.UNSIGNED_BYTE,t)}else{let b=this.format,E=this.format,C=h.UNSIGNED_BYTE;this.format===h.DEPTH_COMPONENT&&(b=h.DEPTH_COMPONENT16,C=h.UNSIGNED_SHORT),this.format===h.R32F&&(C=h.FLOAT,E=h.RED),h.texImage2D(h.TEXTURE_2D,0,b,l,c,0,E,C,t.data)}this.useMipmap=!(!r||!r.useMipmap),this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(t,r){const{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),t!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?t===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),r!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(t,r,s,l){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),this.magFilter=r),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?t===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),this.wrapS=s),l!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class By{constructor(t,r){this.context=t,this.texture=r}bind(t,r){const{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),t!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,t),this.minFilter=t),r!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrapS=r)}}const Oc=new Uint16Array(8184);for(let n=0;n<2046;n++){let t=n+2,r=0,s=0,l=0,c=0,d=0,h=0;for(1&t?l=c=d=32:r=s=h=32;(t>>=1)>1;){const m=r+l>>1,_=s+c>>1;1&t?(l=r,c=s,r=d,s=h):(r=l,s=c,l=d,c=h),d=m,h=_}const p=4*n;Oc[p+0]=r,Oc[p+1]=s,Oc[p+2]=l,Oc[p+3]=c}const kc=new Uint16Array(2178),Ja=new Uint8Array(1089),Vy=new Uint16Array(1089);function GM(n){return 0===n?-.03125:32===n?.03125:0}var Am=pn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const qM={type:2,extent:dt,loadGeometry:()=>[[new nt(0,0),new nt(dt+1,0),new nt(dt+1,dt+1),new nt(0,dt+1),new nt(0,0)]]};class Ds{constructor(t,r,s,l,c){this.tileID=t,this.uid=Ti(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,l&&l.style&&(this._lastUpdatedBrightness=l.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<kt.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Mu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,s){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(l,c){const d={};if(!c)return d;for(const h of l){const p=h.layerIds.map(m=>c.getLayer(m)).filter(Boolean);if(0!==p.length){h.layers=p,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(m=>p.filter(_=>_.id===m)[0]));for(const m of p)d[m.fqid]=h}}return d}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const c=this.buckets[l];if(c instanceof Dm){if(this.hasSymbolBuckets=!0,!s)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const c=this.buckets[l];if(c instanceof Dm&&c.hasRTLText){this.hasRTLText=!0,vs.isLoading()||vs.isLoaded()||"deferred"!==da()||E_();break}}this.queryPadding=0;for(const l in this.buckets){const c=this.buckets[l],d=r.style.getOwnLayer(l);if(!d)continue;const h=d.queryRadius(c);this.queryPadding=Math.max(this.queryPadding,h)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new KE}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const s in this.buckets){const l=this.buckets[s];l.uploadPending()&&l.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ir(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ir(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ir(t,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,r,s){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,s),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const l=r.style.getBrightness();(this._lastUpdatedBrightness||l)&&(this._lastUpdatedBrightness&&l&&Math.abs(this._lastUpdatedBrightness-l)<.001||(this._lastUpdatedBrightness=l,this.updateBuckets(void 0,r)))}queryRenderedFeatures(t,r,s,l,c,d,h,p){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:h,transform:d,params:c,tileTransform:this.tileTransform},t,r,s):{}}querySourceFeatures(t,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const l=s.loadVTLayers(),c=r?r.sourceLayer:"",d=l._geojsonTileLayer||l[c];if(!d)return;const h=O0(r&&r.filter),{z:p,x:m,y:_}=this.tileID.canonical,y={z:p,x:m,y:_};for(let v=0;v<d.length;v++){const b=d.feature(v);if(h.needGeometry){const S=gu(b,!0);if(!h.filter(new wi(this.tileID.overscaledZ),S,this.tileID.canonical))continue}else if(!h.filter(new wi(this.tileID.overscaledZ),b))continue;const E=s.getId(b,c),C=new my(b,p,m,_,E);C.tile=y,t.push(C)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const s=ae(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const s=Date.now();let l=!1;if(this.expirationTime>s)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const c=this.expirationTime-r;c?this.expirationTime=s+Math.max(c,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&r&&this.updateBuckets(t,r)}updateBuckets(t,r){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages(),c=r.style.getBrightness();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const h=this.buckets[d],p=h.layers[0].sourceLayer||"_geojsonTileLayer",m=s[p];let _={};if(t&&(_=t[p],!m||!_||0===Object.keys(_).length))continue;if(h.update(_,m,l,this.imageAtlas&&this.imageAtlas.patternPositions||{},c),h instanceof Im||h instanceof Kh){const v=r.style.getOwnSourceCache(h.layers[0].source);r._terrain&&r._terrain.enabled&&v&&h.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(v.id,this.tileID)}const y=r&&r.style&&r.style.getOwnLayer(d);y&&(this.queryPadding=Math.max(this.queryPadding,y.queryRadius(h)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<kt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=kt.now()+t}setTexture(t,r){const s=r.context,l=s.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new ir(s,t,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(t,r){const s={};for(const l of r)s[l]=!0;this.dependencies[t]=s}hasDependency(t,r){for(const s of t){const l=this.dependencies[s];if(l)for(const c of r)if(l[c])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const s=Vl(qM,this.tileID.canonical,this.tileTransform)[0],l=new qo,c=new k_;for(let d=0;d<s.length;d++){const{x:h,y:p}=s[d];l.emplaceBack(h,p),c.emplaceBack(d)}c.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(c),this._tileDebugBuffer=t.createVertexBuffer(l,xc.members),this._tileDebugSegments=Bn.simpleSegment(0,0,l.length,c.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const s=Vl(qM,this.tileID.canonical,this.tileTransform)[0];let l,c;if(this.isRaster){const d=function(h,p){const m=Mu(h,p),_=Math.pow(2,h.z);for(let S=0;S<33;S++)for(let M=0;M<33;M++){const D=Ms((h.x+(M+GM(M))/32)/_),R=lr((h.y+(S+GM(S))/32)/_),P=p.project(D,R),I=33*S+M;kc[2*I+0]=Math.round((P.x*m.scale-m.x)*dt),kc[2*I+1]=Math.round((P.y*m.scale-m.y)*dt)}Ja.fill(0),Vy.fill(0);for(let S=2045;S>=0;S--){const M=4*S,D=Oc[M+0],R=Oc[M+1],P=Oc[M+2],I=Oc[M+3],O=D+P>>1,F=R+I>>1,L=O+F-R,N=F+D-O,z=33*R+D,U=33*I+P,V=33*F+O,H=Math.hypot((kc[2*z+0]+kc[2*U+0])/2-kc[2*V+0],(kc[2*z+1]+kc[2*U+1])/2-kc[2*V+1])>=16;Ja[V]=Ja[V]||(H?1:0),S<1022&&(Ja[V]=Ja[V]||Ja[33*(R+N>>1)+(D+L>>1)]||Ja[33*(I+N>>1)+(P+L>>1)])}const y=new ad,v=new er;let b=0;function E(S,M){const D=33*M+S;return 0===Vy[D]&&(y.emplaceBack(kc[2*D+0],kc[2*D+1],S*dt/32,M*dt/32),Vy[D]=++b),Vy[D]-1}function C(S,M,D,R,P,I){const O=S+D>>1,F=M+R>>1;if(Math.abs(S-P)+Math.abs(M-I)>1&&Ja[33*F+O])C(P,I,S,M,O,F),C(D,R,P,I,O,F);else{const L=E(S,M),N=E(D,R),z=E(P,I);v.emplaceBack(L,N,z)}}return C(0,0,32,32,32,0),C(32,32,0,0,0,32),{vertices:y,indices:v}}(this.tileID.canonical,r);l=d.vertices,c=d.indices}else{l=new ad,c=new er;for(const{x:h,y:p}of s)l.emplaceBack(h,p,0,0);const d=uy(l.int16,void 0,4);for(let h=0;h<d.length;h+=3)c.emplaceBack(d[h],d[h+1],d[h+2])}this._tileBoundsBuffer=t.createVertexBuffer(l,Am.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(c),this._tileBoundsSegments=Bn.simpleSegment(0,0,l.length,c.length)}_makeGlobeTileDebugBuffers(t,r){const s=r.projection;if(!s||"globe"!==s.name||r.freezeTileCoverage)return;const l=this.tileID.canonical,c=to(J_(l,r)),d=Br(r.zoom);let h;d>0&&(h=rt.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,l,r,c,h,d),this._makeGlobeTileDebugTextBuffer(t,l,r,c,h,d)}_globePoint(t,r,s,l,c,d,h){let p=Xp(t,r,s);if(d){const m=1<<s.z,_=eo(l.center.lng),y=po(l.center.lat),v=(s.x+.5)/m-_;let b=0;v>.5?b=-1:v<-.5&&(b=1);let E=(t/dt+s.x)/m+b,C=(r/dt+s.y)/m;E=(E-_)*l._pixelsPerMercatorPixel+_,C=(C-y)*l._pixelsPerMercatorPixel+y;const S=[E*l.worldSize,C*l.worldSize,0];q.transformMat4(S,S,d),p=_a(p,S,h)}return q.transformMat4(p,p,c)}_makeGlobeTileDebugBorderBuffer(t,r,s,l,c,d){const h=new qo,p=new k_,m=new T_,_=(v,b,E,C,S)=>{const M=(E-v)/(S-1),D=(C-b)/(S-1),R=h.length;for(let P=0;P<S;P++){const I=v+P*M,O=b+P*D;h.emplaceBack(I,O);const F=this._globePoint(I,O,r,s,l,c,d);m.emplaceBack(F[0],F[1],F[2]),p.emplaceBack(R+P)}},y=dt;_(0,0,y,0,16),_(y,0,y,y,16),_(y,y,0,y,16),_(0,y,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(h,xc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(m,FC.members),this._tileDebugSegments=Bn.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugTextBuffer(t,r,s,l,c,d){const h=dt/4,p=new qo,m=new er,_=new T_,y=25;m.reserve(32),p.reserve(y),_.reserve(y);const v=(b,E)=>y*b+E;for(let b=0;b<y;b++){const E=b*h;for(let C=0;C<y;C++){const S=C*h;p.emplaceBack(S,E);const M=this._globePoint(S,E,r,s,l,c,d);_.emplaceBack(M[0],M[1],M[2])}}for(let b=0;b<4;b++)for(let E=0;E<4;E++){const C=v(b,E),S=v(b,E+1),M=v(b+1,E),D=v(b+1,E+1);m.emplaceBack(C,S,M),m.emplaceBack(M,S,D)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(m),this._tileDebugTextBuffer=t.createVertexBuffer(p,xc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(_,FC.members),this._tileDebugTextSegments=Bn.simpleSegment(0,0,y,32)}}class Rm{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,s){const l=t.wrapped().key;void 0===this.data[l]&&(this.data[l]=[]);const c={value:r,timeout:void 0};if(void 0!==s&&(c.timeout=setTimeout(()=>{this.remove(t,c)},s)),this.data[l].push(c),this.order.push(l),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const s=t.wrapped().key,l=void 0===r?0:this.data[s].indexOf(r),c=this.data[s][l];return this.data[s].splice(l,1),c.timeout&&clearTimeout(c.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(c.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const s in this.data)for(const l of this.data[s])t(l.value)||r.push(l);for(const s of r)this.remove(s.value.tileID,s)}}let ko=(()=>{class n{constructor(r,s,l,c){this.id=n.uniqueIdxCounter,n.uniqueIdxCounter++,this.context=r;const d=r.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||c||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=n.uniqueIdxCounter,n.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return n.uniqueIdxCounter=0,n})();const Dd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jy{constructor(t,r,s,l,c,d){this.length=r.length,this.attributes=s,this.itemSize=r.bytesPerElement,this.dynamicDraw=l,this.instanceCount=d,this.context=t;const h=t.gl;this.buffer=h.createBuffer(),t.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||c||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let s=0;s<this.attributes.length;s++){const l=r.attributes[this.attributes[s].name];void 0!==l&&t.enableVertexAttribArray(l)}}setVertexAttribPointers(t,r,s){for(let l=0;l<this.attributes.length;l++){const c=this.attributes[l],d=r.attributes[c.name];void 0!==d&&t.vertexAttribPointer(d,c.components,t[Dd[c.type]],!1,this.itemSize,c.offset+this.itemSize*(s||0))}}setVertexAttribDivisor(t,r,s){for(let l=0;l<this.attributes.length;l++){const c=r.attributes[this.attributes[l].name];void 0!==c&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(c,s)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fo extends gn{getDefault(){return Ne.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class df extends gn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class hf extends gn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ff extends gn{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pf extends gn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class mf extends gn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class gf extends gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class _f extends gn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class yf extends gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class vf extends gn{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class WM extends gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class ZM extends gn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class XM extends gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class YM extends gn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class KM extends gn{getDefault(){return Ne.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class JM extends gn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class QM extends gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class tS extends gn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class eS extends gn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Ab=class extends gn{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}};class E2 extends gn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class LF extends gn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class NF extends gn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class C2 extends gn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class M2 extends gn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class zF extends gn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class S2 extends gn{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class BF extends gn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class T2 extends gn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class D2 extends gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class I2 extends gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Pm extends gn{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Om extends Pm{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Uy extends Pm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $y extends Pm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class nS extends Uy{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class km{constructor(t,r,s,l,c){this.context=t,this.width=r,this.height=s;const d=this.framebuffer=t.gl.createFramebuffer();l&&(this.colorAttachment=new Om(t,d)),c&&(this.depthAttachmentType=c,this.depthAttachment="renderbuffer"===c?new Uy(t,d):new $y(t,d))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class ve{constructor(t,r,s){this.func=t,this.mask=r,this.range=s}}ve.ReadOnly=!1,ve.ReadWrite=!0,ve.disabled=new ve(519,ve.ReadOnly,[0,1]);class Fe{constructor(t,r,s,l,c,d){this.test=t,this.ref=r,this.mask=s,this.fail=l,this.depthFail=c,this.pass=d}}Fe.disabled=new Fe({func:519,mask:0},0,0,7680,7680,7680);class sn{constructor(t,r,s,l){this.blendFunction=t,this.blendColor=r,this.mask=s,this.blendEquation=l}}sn.Replace=[1,0,1,0],sn.disabled=new sn(sn.Replace,Ne.transparent,[!1,!1,!1,!1]),sn.unblended=new sn(sn.Replace,Ne.transparent,[!0,!0,!0,!0]),sn.alphaBlended=new sn([1,771,1,771],Ne.transparent,[!0,!0,!0,!0]),sn.multiply=new sn([774,0,774,0],Ne.transparent,[!0,!0,!0,!0]);class Ge{constructor(t,r,s){this.enable=t,this.mode=r,this.frontFace=s}}Ge.disabled=new Ge(!1,1029,2305),Ge.backCCW=new Ge(!0,1029,2305),Ge.backCW=new Ge(!0,1029,2304),Ge.frontCW=new Ge(!0,1028,2304),Ge.frontCCW=new Ge(!0,1028,2305);class Gy{constructor(t){this.gl=t,this.clearColor=new Fo(this),this.clearDepth=new df(this),this.clearStencil=new hf(this),this.colorMask=new ff(this),this.depthMask=new pf(this),this.stencilMask=new mf(this),this.stencilFunc=new gf(this),this.stencilOp=new _f(this),this.stencilTest=new yf(this),this.depthRange=new vf(this),this.depthTest=new WM(this),this.depthFunc=new ZM(this),this.blend=new XM(this),this.blendFunc=new YM(this),this.blendColor=new KM(this),this.blendEquation=new JM(this),this.cullFace=new QM(this),this.cullFaceSide=new tS(this),this.frontFace=new eS(this),this.program=new Ab(this),this.activeTexture=new E2(this),this.viewport=new LF(this),this.bindFramebuffer=new NF(this),this.bindRenderbuffer=new C2(this),this.bindTexture=new M2(this),this.bindVertexBuffer=new zF(this),this.bindElementBuffer=new S2(this),this.bindVertexArrayOES=new BF(this),this.pixelStoreUnpack=new T2(this),this.pixelStoreUnpackPremultiplyAlpha=new D2(this),this.pixelStoreUnpackFlipY=new I2(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,s){return new ko(this,t,r,s)}createVertexBuffer(t,r,s,l,c){return new jy(this,t,r,s,l,c)}createRenderbuffer(t,r,s){const l=this.gl,c=l.createRenderbuffer();return this.bindRenderbuffer.set(c),l.renderbufferStorage(l.RENDERBUFFER,t,r,s),this.bindRenderbuffer.set(null),c}createFramebuffer(t,r,s,l){return new km(this,t,r,s,l)}clear({color:t,depth:r,stencil:s,colorMask:l}){const c=this.gl;let d=0;t&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(l||[!0,!0,!0,!0])),void 0!==r&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),void 0!==s&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(s),this.stencilMask.set(255)),c.clear(d)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){ln(t.blendFunction,sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Is extends $i{constructor(t,r,s){super(),this.id=t,this._onlySymbols=s,r.on("data",l=>{"source"===l.dataType&&"metadata"===l.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===l.dataType&&"content"===l.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new Rm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new t2,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if("errored"!==r.state&&("loaded"!==r.state||!r.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const s=this._tiles[r];s.upload(t),s.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return xn(this._tiles).map(t=>t.tileID).sort(A2).map(t=>t.key)}getRenderableIds(t,r){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,t,r)&&s.push(this._tiles[l]);return t?s.sort((l,c)=>{const d=l.tileID,h=c.tileID,p=new nt(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),m=new nt(h.canonical.x,h.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-h.overscaledZ||m.y-p.y||m.x-p.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(A2).map(l=>l.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(s||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const s=this._tiles[t];s&&("loading"!==s.state&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,t,r)))}_tileLoaded(t,r,s,l){if(l)if(t.state="errored",404!==l.status)this._source.fire(new at(l,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=kt.now(),"expired"===s&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new St("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const c=r[l];if(t.neighboringTiles&&t.neighboringTiles[c]){const d=this.getTileByID(c);s(t,d),s(d,t)}}function s(l,c){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let d=c.tileID.canonical.x-l.tileID.canonical.x;const h=c.tileID.canonical.y-l.tileID.canonical.y,p=Math.pow(2,l.tileID.canonical.z),m=c.tileID.key;0===d&&0===h||Math.abs(h)>1||(Math.abs(d)>1&&(1===Math.abs(d+p)?d+=p:1===Math.abs(d-p)&&(d-=p)),c.dem&&l.dem&&(l.dem.backfillBorder(c.dem,d,h),l.neighboringTiles&&l.neighboringTiles[m]&&(l.neighboringTiles[m].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,s,l){for(const c in this._tiles){let d=this._tiles[c];if(l[c]||!d.hasData()||d.tileID.overscaledZ<=r||d.tileID.overscaledZ>s)continue;let h=d.tileID;for(;d&&d.tileID.overscaledZ>r+1;){const m=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[m.key],d&&d.hasData()&&(h=m)}let p=h;for(;p.overscaledZ>r;)if(p=p.scaledTo(p.overscaledZ-1),t[p.key]){l[h.key]=h;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const s=this._loadedParentTiles[t.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=t.overscaledZ-1;s>=r;s--){const l=t.scaledTo(s),c=this._getLoadedTile(l);if(c)return c}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const s=Math.ceil(t.width/r)+1,l=Math.ceil(t.height/r)+1,c=Math.floor(s*l*5),d="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,c):c,h="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(h)}handleWrapJump(t){const r=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,r){const s={};for(const l in this._tiles){const c=this._tiles[l];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+r),s[c.tileID.key]=c}this._tiles=s;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(t,r,s,l){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;if(this.updateCacheSize(t,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new tn(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(c=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(p=>this._source.hasTile(p)))):c=[],c.length>0&&this.castsShadows&&l&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!kb(this._source.type)){const p=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!s}),m=Math.min(p,this._source.maxzoom),_=t.extendTileCoverForShadows(c,l,m);for(const y of _)this._shadowCasterTiles[y.key]=!0,c.push(y)}const d=this._updateRetainedTiles(c);if(kb(this._source.type)&&0!==c.length){const p={},m={},_=Object.keys(d);for(const v of _){const b=d[v],E=this._tiles[v];if(!E||E.fadeEndTime&&E.fadeEndTime<=kt.now())continue;const C=this.findLoadedParent(b,Math.max(b.overscaledZ-Is.maxOverzooming,this._source.minzoom));C&&(this._addTile(C.tileID),p[C.tileID.key]=C.tileID),m[v]=b}const y=c[c.length-1].overscaledZ;for(const v in this._tiles){const b=this._tiles[v];if(d[v]||!b.hasData())continue;let E=b.tileID;for(;E.overscaledZ>y;){E=E.scaledTo(E.overscaledZ-1);const C=this._tiles[E.key];if(C&&C.hasData()&&m[E.key]){d[v]=b.tileID;break}}}for(const v in p)d[v]||(this._coveredTiles[v]=!0,d[v]=p[v])}for(const p in d)this._tiles[p].clearFadeHold();const h=function(p,m){const _=[];for(const y in p)y in m||_.push(y);return _}(this._tiles,d);for(const p of h){const m=this._tiles[p];m.hasSymbolBuckets&&!m.holdingForFade()?m.setHoldDuration(this.map._fadeDuration):m.hasSymbolBuckets&&!m.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(0===t.length)return r;const s={},l=t.reduce((m,_)=>Math.min(m,_.overscaledZ),1/0),c=t[0].overscaledZ,d=Math.max(c-Is.maxOverzooming,this._source.minzoom),h=Math.max(c+Is.maxUnderzooming,this._source.minzoom),p={};for(const m of t){const _=this._addTile(m);r[m.key]=m,_.hasData()||l<this._source.maxzoom&&(p[m.key]=m)}this._retainLoadedChildren(p,l,h,r);for(const m of t){let _=this._tiles[m.key];if(_.hasData())continue;if(m.canonical.z>=this._source.maxzoom){const v=m.children(this._source.maxzoom)[0],b=this.getTile(v);if(b&&b.hasData()){r[v.key]=v;continue}}else{const v=m.children(this._source.maxzoom);if(r[v[0].key]&&r[v[1].key]&&r[v[2].key]&&r[v[3].key])continue}let y=_.wasRequested();for(let v=m.overscaledZ-1;v>=d;--v){const b=m.scaledTo(v);if(s[b.key]||(s[b.key]=!0,_=this.getTile(b),!_&&y&&(_=this._addTile(b)),_&&(r[b.key]=b,y=_.wasRequested(),_.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let s,l=this._tiles[t].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){s=this._loadedParentTiles[l.key];break}r.push(l.key);const c=l.scaledTo(l.overscaledZ-1);if(s=this._getLoadedTile(c),s)break;l=c}for(const c of r)this._loadedParentTiles[c]=s}}_addTile(t){let r=this._tiles[t.key];if(r)return!0!==r.isExtraShadowCaster||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const s=!!r;if(!s){const l=this.map?this.map.painter:null;r=new Ds(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,s||this._source.fire(new St("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const s=r.getExpiryTimeout();s&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},s))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&"reloading"!==r.state?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,s){const l=[],c=this.transform;if(!c)return l;const d="globe"===c.projection.name,h=eo(c.center.lng);for(const p in this._tiles){const m=this._tiles[p];if(s&&m.clearQueryDebugViz(),m.holdingForFade())continue;let _;if(d){const y=m.tileID.canonical;if(0===y.z){const v=[Math.abs(Jt(h,...Fm(y,-1))-h),Math.abs(Jt(h,...Fm(y,1))-h)];_=[0,2*v.indexOf(Math.min(...v))-1]}else{const v=[Math.abs(Jt(h,...Fm(y,-1))-h),Math.abs(Jt(h,...Fm(y,0))-h),Math.abs(Jt(h,...Fm(y,1))-h)];_=[v.indexOf(Math.min(...v))-1]}}else _=[0];for(const y of _){const v=t.containsTile(m,c,r,y);v&&l.push(v)}}return l}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const s=this.getRenderableIds(t,r).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}sortCoordinatesByDistance(t){const r=t.slice(),s=this.transform._camera.position,l=this.transform._camera.forward(),c={};for(const d of r){const h=1/(1<<d.canonical.z);c[d.key]=((d.canonical.x+.5)*h+d.wrap-s[0])*l[0]+((d.canonical.y+.5)*h-s[1])*l[1]-s[2]*l[2]}return r.sort((d,h)=>c[d.key]-c[h.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(kb(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=kt.now())return!0}return!1}setFeatureState(t,r,s){this._state.updateState(t=t||"_geojsonTileLayer",r,s)}removeFeatureState(t,r,s){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,s)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,s){const l=this._tiles[t];l&&l.setDependencies(r,s)}reloadTilesForDependencies(t,r){for(const s in this._tiles)this._tiles[s].hasDependency(t,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const h=()=>{this._sourceLoaded&&(this._source.off("data",h),this._preloadTiles(t,r))};return void this._source.on("data",h)}const s=new Map,l=Array.isArray(t)?t:[t],c=this.map.painter.terrain,d=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const h of l){const p=h.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const m of p)s.set(m.key,m);this.usedForTerrain&&h.updateElevation(!1)}Zu(Array.from(s.values()),(h,p)=>{const m=new Ds(h,this._source.tileSize*h.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(m,_=>{"raster-dem"===this._source.type&&m.dem&&this._backfillDEM(m),p(_,m)})},r)}}function A2(n,t){const r=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*t.wrap)-+(t.wrap<0);return n.overscaledZ-t.overscaledZ||s-r||t.canonical.y-n.canonical.y||t.canonical.x-n.canonical.x}function kb(n){return"raster"===n||"image"===n||"video"===n||"custom"===n}function Fm(n,t){const r=1<<n.z;return[n.x/r+t,(n.x+1)/r+t]}Is.maxOverzooming=10,Is.maxUnderzooming=3;const Fb=pn([{name:"a_pos_3f",components:3,type:"Float32"}]),R2=pn([{name:"a_color_3f",components:3,type:"Float32"}]),iS=pn([{name:"a_color_4f",components:4,type:"Float32"}]),P2=pn([{name:"a_uv_2f",components:2,type:"Float32"}]),O2=pn([{name:"a_normal_3f",components:3,type:"Float32"}]),Ki=pn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),rS=pn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class qy{constructor(t=0,r=0,s=0,l=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(s)||s<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=s,this.right=l}interpolate(t,r,s){return null!=r.top&&null!=t.top&&(this.top=_e(t.top,r.top,s)),null!=r.bottom&&null!=t.bottom&&(this.bottom=_e(t.bottom,r.bottom,s)),null!=r.left&&null!=t.left&&(this.left=_e(t.left,r.left,s)),null!=r.right&&null!=t.right&&(this.right=_e(t.right,r.right,s)),this}getCenter(t,r){const s=Jt((this.left+t-this.right)/2,0,t),l=Jt((this.top+r-this.bottom)/2,0,r);return new nt(s,l)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new qy(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function oS(n,t){const r=Ni(n,3);rt.fromQuat(n,t),zr(n,3,r)}function Lb(n,t){const r=Qr.identity([]);return Qr.rotateZ(r,r,-t),Qr.rotateX(r,r,-n),r}function sS(n,t){const r=[n[0],n[1],0],s=[t[0],t[1],0];if(q.length(r)>=1e-15){const d=q.normalize([],r);q.scale(s,d,q.dot(s,d)),t[0]=s[0],t[1]=s[1]}const l=q.cross([],t,n);if(q.len(l)<1e-15)return null;const c=Math.atan2(-l[1],l[0]);return Lb(Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2]),c)}class Lm{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof Ke?t:new Ke(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=bl(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const s=this.position,l=this._elevation?this._elevation.getAtPointOrZero(Ke.fromLngLat(t)):0,c=Ke.fromLngLat(t,l),d=[c.x-s.x,c.y-s.y,c.z-s.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=sS(d,r)}setPitchBearing(t,r){this.orientation=Lb(Ie(t),Ie(-r))}}class Cn{constructor(t,r){this._transform=rt.identity([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new Ke(t[0],t[1],t[2])}get position(){const t=Ni(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&zr(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||Qr.identity([]),t&&oS(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Lb(t,r),oS(this._transform,this._orientation)}forward(){const t=Ni(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=Ni(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=Ni(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const s=new Float64Array(16);return rt.invert(s,this.getWorldToCamera(t,r)),s}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,s){const l=this.position;q.scale(l,l,-t);const c=new Float64Array(16);return rt.fromScaling(c,[s,s,s]),rt.translate(c,c,l),c[10]*=r,c}getWorldToCamera(t,r){const s=new Float64Array(16),l=new Float64Array(4),c=this.position;return Qr.conjugate(l,this._orientation),q.scale(c,c,-t),rt.fromQuat(s,l),rt.translate(s,s,c),s[1]*=-1,s[5]*=-1,s[9]*=-1,s[13]*=-1,s[8]*=r,s[9]*=r,s[10]*=r,s[11]*=r,s}getCameraToClipPerspective(t,r,s,l){const c=new Float64Array(16);return rt.perspective(c,t,r,s,l),c}getCameraToClipOrthographic(t,r,s,l,c,d){const h=new Float64Array(16);return rt.ortho(h,t,r,s,l,c,d),h}getDistanceToElevation(t,r=!1){const s=0===t?0:Ln(t,r?lr(this.position[1]):this.position[1]),l=this.forward();return(s-this.position[2])/l[2]}clone(){return new Cn([...this.position],[...this.orientation])}}function Wy(n,t){const r=Dn(n.projection,n.zoom,n.width,n.height),s=function(c,d,h,p,m){const _=new we(h.lng-180*Nn,h.lat),y=new we(h.lng+180*Nn,h.lat),v=c.project(_.lng,_.lat),b=c.project(y.lng,y.lat),E=-Math.atan2(b.y-v.y,b.x-v.x),C=Ke.fromLngLat(h);C.y=Jt(C.y,-1+Nn,1-Nn);const S=C.toLngLat(),M=c.project(S.lng,S.lat),D=Ke.fromLngLat(S);D.x+=Nn;const R=D.toLngLat(),P=c.project(R.lng,R.lat),I=Nb(P.x-M.x,P.y-M.y,E),O=Ke.fromLngLat(S);O.y+=Nn;const F=O.toLngLat(),L=c.project(F.lng,F.lat),N=Nb(L.x-M.x,L.y-M.y,E),z=Math.abs(I.x)/Math.abs(N.y),U=rt.identity([]);rt.rotateZ(U,U,-E*(1-(m?0:p)));const V=rt.identity([]);return rt.scale(V,V,[1,1-(1-z)*p,1]),V[4]=-N.x/N.y*p,rt.rotateZ(V,V,E),rt.multiply(V,U,V),V}(n.projection,0,n.center,r,t),l=aS(n);return rt.scale(s,s,[l,l,1]),s}function aS(n){const t=n.projection,r=Dn(n.projection,n.zoom,n.width,n.height),s=io(t,n.center),l=io(t,we.convert(t.center));return Math.pow(2,s*r+(1-r)*l)}function Dn(n,t,r,s,l=1/0){const c=n.range;if(!c)return 0;const d=Math.min(l,Math.max(r,s)),h=Math.log(d/1024)/Math.LN2;return xl(c[0]+h,c[1]+h,t)}const Nn=1/4e4;function io(n,t){const r=Jt(t.lat,-Hi,Hi),s=new we(t.lng-180*Nn,r),l=new we(t.lng+180*Nn,r),c=n.project(s.lng,r),d=n.project(l.lng,r),h=Ke.fromLngLat(s),p=Ke.fromLngLat(l),m=d.x-c.x,_=d.y-c.y,y=p.x-h.x,v=p.y-h.y,b=Math.sqrt((y*y+v*v)/(m*m+_*_));return Math.log(b)/Math.LN2}function Nb(n,t,r){const s=Math.cos(r),l=Math.sin(r);return{x:n*s-t*l,y:n*l+t*s}}function Id(n,t,r){return t*(dt/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}const xf={unknown:0,flipRequired:1,flipNotRequired:2},k2=Math.tan(85*Math.PI/180);function bf(n,t,r,s,l,c,d){const h=rt.create();if(r)if("globe"===c.name){const p=function(m,_){const{x:y,y:v}=m.point,b=UC(y,v,m.worldSize/m._pixelsPerMercatorPixel,0,0);return rt.multiply(b,b,ya(Oo(_)))}(l,t);rt.multiply(h,h,p)}else{const p=zh.invert([],d);h[0]=p[0],h[1]=p[1],h[4]=p[2],h[5]=p[3],s||rt.rotateZ(h,h,l.angle)}else rt.multiply(h,l.labelPlaneMatrix,n);return h}function Zy(n,t,r,s,l,c,d){const h=bf(n,t,r,s,l,c,d);return"globe"===c.name&&r||(h[2]=h[6]=h[10]=h[14]=0),h}function zb(n,t,r,s,l,c,d){if(r){if("globe"===c.name){const h=bf(n,t,r,s,l,c,d);return rt.invert(h,h),rt.multiply(h,n,h),h}{const h=rt.clone(n),p=rt.identity([]);return p[0]=d[0],p[1]=d[1],p[4]=d[2],p[5]=d[3],rt.multiply(h,h,p),s||rt.rotateZ(h,h,-l.angle),h}}return l.glCoordMatrix}function ba(n,t,r,s){const l=[n,t,r,1];r?Fn.transformMat4(l,l,s):jb(l,l,s);const c=l[3];return l[0]/=c,l[1]/=c,l[2]/=c,l}function lS(n,t){return Math.min(.5+n/t*.5,1.5)}function F2(n,t){const r=n[0]/n[3],s=n[1]/n[3];return r>=-t[0]&&r<=t[0]&&s>=-t[1]&&s<=t[1]}function cS(n,t,r,s,l,c,d,h,p,m){const _=r.transform,y=s?n.textSizeData:n.iconSizeData,v=Ic(y,r.transform.zoom),b="globe"===_.projection.name,E=[256/r.width*2+1,256/r.height*2+1],C=s?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;C.clear();let S=null;b&&(S=s?n.text.globeExtVertexArray:n.icon.globeExtVertexArray);const M=n.lineVertexArray,D=s?n.text.placedSymbolArray:n.icon.placedSymbolArray,R=r.transform.width/r.transform.height;let P,I=!1;for(let O=0;O<D.length;O++){const F=D.get(O),{numGlyphs:L,writingMode:N}=F;if(N!==ti.vertical||I||P===ti.horizontal||(I=!0),P=N,(F.hidden||N===ti.vertical)&&!I){Ad(L,C);continue}I=!1;const z=new nt(F.tileAnchorX,F.tileAnchorY);let{x:U,y:V,z:H}=_.projection.projectTilePoint(z.x,z.y,m.canonical);if(p){const[mt,yt,ct]=p(z);U+=mt,V+=yt,H+=ct}const j=[U,V,H,1];if(Fn.transformMat4(j,j,t),!F2(j,E)){Ad(L,C);continue}const Z=j[3],tt=lS(r.transform.getCameraToCenterDistance(_.projection),Z),it=ym(y,v,F),X=d?it/tt:it*tt,Y=ba(U,V,H,l);if(Y[3]<=0){Ad(L,C);continue}let ot={};const lt=d?null:p,ht=Fr(F,X,!1,h,t,l,c,n.glyphOffsetArray,M,C,S,Y,z,ot,R,lt,_.projection,m,d);I=ht.useVertical,lt&&ht.needsFlipping&&(ot={}),(ht.notEnoughRoom||I||ht.needsFlipping&&Fr(F,X,!0,h,t,l,c,n.glyphOffsetArray,M,C,S,Y,z,ot,R,lt,_.projection,m,d).notEnoughRoom)&&Ad(L,C)}s?(n.text.dynamicLayoutVertexBuffer.updateData(C),S&&n.text.globeExtVertexBuffer&&n.text.globeExtVertexBuffer.updateData(S)):(n.icon.dynamicLayoutVertexBuffer.updateData(C),S&&n.icon.globeExtVertexBuffer&&n.icon.globeExtVertexBuffer.updateData(S))}function wf(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C){const{lineStartIndex:S,glyphStartIndex:M,segment:D}=h,R=M+h.numGlyphs,P=S+h.lineLength,I=t.getoffsetX(M),O=t.getoffsetX(R-1),F=Nm(n*I,r,s,l,c,d,D,S,P,p,m,_,y,v,!0,b,E,C);if(!F)return null;const L=Nm(n*O,r,s,l,c,d,D,S,P,p,m,_,y,v,!0,b,E,C);return L?{first:F,last:L}:null}function Bb(n,t,r,s){return n===ti.horizontal&&Math.abs(s)>Math.abs(r)?{useVertical:!0}:n===ti.vertical?s>0?{needsFlipping:!0}:null:t!==xf.unknown&&(0===(l=r)||Math.abs(s/l)>k2)?t===xf.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null;var l}function Fr(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D){const R=t/24,P=n.lineOffsetX*R,I=n.lineOffsetY*R,{lineStartIndex:O,glyphStartIndex:F,numGlyphs:L,segment:N,writingMode:z,flipState:U}=n,V=O+n.lineLength,H=j=>{if(_){const[X,Y,ot]=j.up,lt=m.length;zy(_,lt+0,X,Y,ot),zy(_,lt+1,X,Y,ot),zy(_,lt+2,X,Y,ot),zy(_,lt+3,X,Y,ot)}const[Z,tt,it]=j.point;uf(m,Z,tt,it,j.angle)};if(L>1){const j=wf(R,h,P,I,r,y,v,n,p,c,b,C,!1,S,M,D);if(!j)return{notEnoughRoom:!0};if(s&&!r){let[Z,tt,it]=j.first.point,[X,Y,ot]=j.last.point;[Z,tt]=ba(Z,tt,it,d),[X,Y]=ba(X,Y,ot,d);const lt=Bb(z,U,(X-Z)*E,Y-tt);if(n.flipState=lt&&lt.needsFlipping?xf.flipRequired:xf.flipNotRequired,lt)return lt}H(j.first);for(let Z=F+1;Z<F+L-1;Z++){const tt=Nm(R*h.getoffsetX(Z),P,I,r,y,v,N,O,V,p,c,b,C,!1,!1,S,M,D);if(!tt)return m.length-=4*(Z-F),{notEnoughRoom:!0};H(tt)}H(j.last)}else{if(s&&!r){const Z=ba(v.x,v.y,0,l),tt=O+N+1,it=new nt(p.getx(tt),p.gety(tt)),X=ba(it.x,it.y,0,l),Y=X[3]>0?X:uS(v,it,Z,1,l,void 0,S,M.canonical),ot=Bb(z,U,(Y[0]-Z[0])*E,Y[1]-Z[1]);if(n.flipState=ot&&ot.needsFlipping?xf.flipRequired:xf.flipNotRequired,ot)return ot}const j=Nm(R*h.getoffsetX(F),P,I,r,y,v,N,O,V,p,c,b,C,!1,!1,S,M,D);if(!j)return{notEnoughRoom:!0};H(j)}return{}}function Vb(n,t,r,s,l){const{x:c,y:d,z:h}=s.projectTilePoint(n.x,n.y,t);if(!l)return ba(c,d,h,r);const[p,m,_]=l(n);return ba(c+p,d+m,h+_,r)}function uS(n,t,r,s,l,c,d,h){const p=Vb(n.sub(t)._unit()._add(n),h,l,d,c);return q.sub(p,r,p),q.normalize(p,p),q.scaleAndAdd(p,r,p,s)}function Nm(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M){const D=s?n-t:n+t;let R=D>0?1:-1,P=0;s&&(R*=-1,P=Math.PI),R<0&&(P+=Math.PI);let I=h+d+(R>0?0:1)|0,O=l,F=l,L=0,N=0;const z=Math.abs(D),U=[],V=[];let H=c,j=H;const Z=()=>uS(j,H,F,z-L+1,_,v,C,S.canonical);for(;L+N<=z;){if(I+=R,I<h||I>=p)return null;if(F=O,j=H,U.push(F),b&&V.push(j),H=new nt(m.getx(I),m.gety(I)),O=y[I],!O){const yt=Vb(H,S.canonical,_,C,v);O=yt[3]>0?y[I]=yt:Z()}L+=N,N=q.distance(F,O)}E&&v&&(y[I]&&(O=Z(),N=q.distance(F,O)),y[I]=O);const tt=(z-L)/N,it=H.sub(j)._mult(tt)._add(j),X=q.sub([],O,F),Y=q.scaleAndAdd([],F,X,tt);let ot=[0,0,1],lt=X[0],ht=X[1];if(M&&(ot=C.upVector(S.canonical,it.x,it.y),0!==ot[0]||0!==ot[1]||1!==ot[2])){const yt=[ot[2],0,-ot[0]],ct=q.cross([],ot,yt);q.normalize(yt,yt),q.normalize(ct,ct),lt=q.dot(X,yt),ht=q.dot(X,ct)}if(r){const yt=q.cross([],ot,X);q.normalize(yt,yt),q.scaleAndAdd(Y,Y,yt,r*R)}const mt=P+Math.atan2(ht,lt);return U.push(Y),b&&V.push(it),{point:Y,angle:mt,path:U,tilePath:V,up:ot}}function Ad(n,t){const r=t.length,s=r+4*n;t.resize(s),t.float32.fill(-1/0,4*r,4*s)}function jb(n,t,r){const s=t[0],l=t[1];return n[0]=r[0]*s+r[4]*l+r[12],n[1]=r[1]*s+r[5]*l+r[13],n[3]=r[3]*s+r[7]*l+r[15],n}const ro=(n,t,r)=>(1-r)*n+r*t,dS=n=>n*n*n*n*n;class Tu{constructor(t,r,s,l,c,d,h){this.tileSize=512,this._renderWorldCopies=void 0===c||c,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=s??0,this._maxPitch=l??60,this.setProjection(d),this.setMaxBounds(h),this.width=0,this.height=0,this._center=new we(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qy,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Cn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Tu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,r=!1){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||s)&&this._updateCameraOnTerrain(),(t||s)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return ts(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=Tm(this.projectionOptions);const s=!ln(r,this.getProjection());return s&&this._calcMatrices(),this.mercatorFromTransition=!1,s}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Tm({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Ln(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new nt(this.width,this.height)}get bearing(){return bl(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=zh.create(),zh.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=Jt(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=Ie(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&s.exaggeration()&&this._centerAltitudeValidForExaggeration!==s.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*s.exaggeration(),this._centerAltitudeValidForExaggeration=s.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=s.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],s=this.horizonLineFromTop();let l=0,c=0;for(let d=0;d<r.length;d++){const h=new nt(r[d][0]*this.width,s+r[d][1]*(this.height-s)),p=t.pointCoordinate(h);if(!p)continue;const m=1/Math.hypot(p[0]-this._camera.position[0],p[1]-this._camera.position[1]);l+=p[3]*m,c+=m}return 0===c?NaN:l/c}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),s=this.pixelsPerMeter/this.worldSize*r,l=this._mercatorZfromZoom(t),c=this._mercatorZfromZoom(this._maxZoom),d=Math.max(l-s,c);this._setZoom(this._zoomFromMercatorZ(d))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let s;s=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const l=q.length(q.sub([],this._camera.position,s));return Jt(this._zoomFromMercatorZ(l),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!Qr.exactEquals(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const s=[t.position.x,t.position.y,t.position.z];q.exactEquals(s,this._camera.position)||(this._setCameraPosition(s),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new Lm;return r.position=new Ke(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!Qr.length(t))return!1;Qr.normalize(t,t);const r=q.transformQuat([],[0,0,-1],t),s=q.transformQuat([],[0,-1,0],t);if(s[2]<0)return!1;const l=sS(r,s);return!!l&&(this._camera.orientation=l,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,s=this.zoomScale(this.maxZoom)*this.tileSize,l=this.cameraToCenterDistance;t[2]=Jt(t[2],l/s,l/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,s){this._unmodified=!1,this._edgeInsets.interpolate(t,r,s),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new Y_(0,t)];if(this.renderWorldCopies){const s=this.pointCoordinate(new nt(0,0)),l=this.pointCoordinate(new nt(this.width,0)),c=this.pointCoordinate(new nt(this.width,this.height)),d=this.pointCoordinate(new nt(0,this.height)),h=Math.floor(Math.min(s.x,l.x,c.x,d.x)),p=Math.floor(Math.max(s.x,l.x,c.x,d.x)),m=1;for(let _=h-m;_<=p+m;_++)0!==_&&r.push(new Y_(_,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,r,s){let l=[];if(0===r[0]&&0===r[1])return l;for(const d of t){const h=d.canonical,p=d.overscaledZ,m=d.wrap,_=1<<h.z,y=h.x+1<_,v=h.x>0,b=h.y+1<_,E=h.y>0,C=d.wrap-(v?0:1),S=d.wrap+(y?0:1),M=v?h.x-1:_-1,D=y?h.x+1:0;r[0]<0?(l.push(new tn(p,S,h.z,D,h.y)),r[1]<0&&b&&(l.push(new tn(p,m,h.z,h.x,h.y+1)),l.push(new tn(p,S,h.z,D,h.y+1))),r[1]>0&&E&&(l.push(new tn(p,m,h.z,h.x,h.y-1)),l.push(new tn(p,S,h.z,D,h.y-1)))):r[0]>0?(l.push(new tn(p,C,h.z,M,h.y)),r[1]<0&&b&&(l.push(new tn(p,m,h.z,h.x,h.y+1)),l.push(new tn(p,C,h.z,M,h.y+1))),r[1]>0&&E&&(l.push(new tn(p,m,h.z,h.x,h.y-1)),l.push(new tn(p,C,h.z,M,h.y-1)))):r[1]<0&&b?l.push(new tn(p,m,h.z,h.x,h.y+1)):E&&l.push(new tn(p,m,h.z,h.x,h.y-1))}if(l.length>1){l.sort((p,m)=>p.overscaledZ-m.overscaledZ||p.wrap-m.wrap||p.canonical.z-m.canonical.z||p.canonical.x-m.canonical.x||p.canonical.y-m.canonical.y);let d=0,h=0;for(;h<l.length;)l[h].equals(l[d])?++h:l[++d]=l[h++];l.length=d+1}const c=[];for(const d of l)l.some(h=>d.isChildOf(h))||c.push(d);return l=c.filter(d=>!t.some(h=>!!(d.overscaledZ<s&&h.isChildOf(d))||d.equals(h)||d.isChildOf(h))),l}coveringTiles(t){let r=this.coveringZoomLevel(t);const s=r,l=this.elevation&&this.elevation.exaggeration(),c=l&&!t.isTerrainDEM,d="mercator"===this.projection.name;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);const h=this.locationCoordinate(this.center),p=this.center.lat,m=1<<r,_=[m*h.x,m*h.y,0],y="globe"===this.projection.name,v=!y,b=Bl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,v),E=y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),C=m*Ln(1,this.center.lat),S=this._camera.position[2]/Ln(1,this.center.lat),M=[m*E.x,m*E.y,S*(v?1:C)],D=y||l,R=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),P=this.isLODDisabled(!0)?r:0,I=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,O=t.isTerrainDEM?-I:this._elevation?this._elevation.getMinElevationBelowMSL():0,F=this.projection.isReprojectedInTileSpace?aS(this):1,L=X=>{const ot=new Ke(X.x+25e-6,X.y,X.z),lt=new Ke(X.x,X.y+25e-6,X.z),ht=X.toLngLat(),mt=ot.toLngLat(),yt=lt.toLngLat(),ct=this.locationCoordinate(ht),ft=this.locationCoordinate(mt),Rt=this.locationCoordinate(yt),Vt=Math.hypot(ft.x-ct.x,ft.y-ct.y),jt=Math.hypot(Rt.x-ct.x,Rt.y-ct.y);return Math.sqrt(Vt*jt)*F/25e-6},N=X=>{const Y=I,ot=O;return{aabb:Py(this,m,0,0,0,X,ot,Y,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:Y,wrap:X,fullyVisible:!1}},z=[];let U=[];const V=r,H=t.reparseOverscaled?s:r,j=X=>X*X,Z=j((S-this._centerAltitude)*C),tt=X=>{if(!this._elevation||!X.tileID||!d)return;const Y=this._elevation.getMinMaxForTile(X.tileID),ot=X.aabb;Y?(ot.min[2]=Y.min,ot.max[2]=Y.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(X.shouldSplit=it(X),X.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},it=X=>{if(X.zoom<P)return!0;if(X.zoom===V)return!1;if(null!=X.shouldSplit)return X.shouldSplit;const Y=X.aabb.distanceX(M),ot=X.aabb.distanceY(M);let lt=Z,ht=1;if(y){lt=j(X.aabb.distanceZ(M));const ct=Math.pow(2,X.zoom),ft=lr((X.y+1)/ct),Rt=lr(X.y/ct),Vt=Math.min(Math.max(p,ft),Rt),jt=Hh(Vt)/Hh(p);if(ht=Vt===p?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,jt/this._mercatorScaleRatio),this.zoom<=qp&&X.zoom===V-1&&jt>=.9)return!0}else if(c&&(lt=j(X.aabb.distanceZ(M)*C)),this.projection.isReprojectedInTileSpace&&s<=5){const ct=Math.pow(2,X.zoom),ft=L(new Ke((X.x+.5)/ct,(X.y+.5)/ct));ht=ft>.85?1:ft}const mt=Y*Y+ot*ot+lt;return mt<j((1<<V-X.zoom)*R*ht*((ct,ft)=>{if(ft*j(.707)<ct)return 1;const Rt=Math.sqrt(ft/ct);return Rt/(1.4144271570014144+(Math.pow(1.1,Rt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(lt,Z),mt))};if(this.renderWorldCopies)for(let X=1;X<=3;X++)z.push(N(-X)),z.push(N(X));for(z.push(N(0));z.length>0;){const X=z.pop(),Y=X.x,ot=X.y;let lt=X.fullyVisible;const ht=()=>"globe"===this.projection.name&&(0===X.y||X.y===(1<<X.zoom)-1);if(!lt){let mt=D?X.aabb.intersects(b):X.aabb.intersectsFlat(b);if(0===mt&&ht()){const yt=new ma(X.zoom,Y,ot);mt=Q_(this,m,yt,!0).intersects(b)}if(0===mt)continue;lt=2===mt}if(X.zoom!==V&&it(X))for(let mt=0;mt<4;mt++){const yt=(Y<<1)+mt%2,ct=(ot<<1)+(mt>>1),ft={aabb:d?X.aabb.quadrant(mt):Py(this,m,X.zoom+1,yt,ct,X.wrap,X.minZ,X.maxZ,this.projection),zoom:X.zoom+1,x:yt,y:ct,wrap:X.wrap,fullyVisible:lt,tileID:void 0,shouldSplit:void 0,minZ:X.minZ,maxZ:X.maxZ};c&&!y&&(ft.tileID=new tn(X.zoom+1===V?H:X.zoom+1,X.wrap,X.zoom+1,yt,ct),tt(ft)),z.push(ft)}else{const mt=X.zoom===V?H:X.zoom;if(t.minzoom&&t.minzoom>mt)continue;if(!lt){let Rt=D?X.aabb.intersectsPrecise(b):X.aabb.intersectsPreciseFlat(b);if(0===Rt&&ht()){const Vt=new ma(X.zoom,Y,ot);Rt=Q_(this,m,Vt,!0).intersectsPrecise(b)}if(0===Rt)continue}const yt=_[0]-(.5+Y+(X.wrap<<X.zoom))*(1<<r-X.zoom),ct=_[1]-.5-ot,ft=X.tileID?X.tileID:new tn(mt,X.wrap,X.zoom,Y,ot);U.push({tileID:ft,distanceSq:yt*yt+ct*ct})}}if(this.fogCullDistSq){const X=this.fogCullDistSq,Y=this.horizonLineFromTop();U=U.filter(ot=>{const lt=[0,0,0,1],ht=[dt,dt,0,1],mt=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());Fn.transformMat4(lt,lt,mt),Fn.transformMat4(ht,ht,mt);const yt=function(Rt,Vt,jt){let $t=0;for(let re=0;re<2;++re)Rt[re]>0&&($t+=(Rt[re]-0)*(Rt[re]-0)),Vt[re]<0&&($t+=(0-Vt[re])*(0-Vt[re]));return $t}(Fn.min([],lt,ht),Fn.max([],lt,ht));if(0===yt)return!0;let ct=!1;const ft=this._elevation;if(ft&&yt>X&&0!==Y){const Rt=this.calculateProjMatrix(ot.tileID.toUnwrapped());let Vt;t.isTerrainDEM||(Vt=ft.getMinMaxForTile(ot.tileID)),Vt||(Vt={min:O,max:I});const jt=function(re){const ye=Math.round((re+45+360)%360/90)%4;return f0[ye]}(this.rotation),$t=[jt[0]*dt,jt[1]*dt,Vt.max];q.transformMat4($t,$t,Rt),ct=(1-$t[1])*this.height*.5<Y}return yt<X||ct})}return U.sort((X,Y)=>X.distanceSq-Y.distanceSq).map(X=>X.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=Jt(t.lat,-Hi,Hi),s=this.projection.project(t.lng,r);return new nt(s.x*this.worldSize,s.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Ln(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let s,l;const c=this.centerPoint;if("globe"===this.projection.name){const h=this.worldSize;s=(r.x-c.x)/h,l=(r.y-c.y)/h}else{const h=this.pointCoordinate(r),p=this.pointCoordinate(c);s=h.x-p.x,l=h.y-p.y}const d=this.locationCoordinate(t);this.setLocation(new Ke(d.x-s,d.y-l))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,r){const s=r?Ln(r,t.lat):void 0,l=this.projection.project(t.lng,t.lat);return new Ke(l.x,l.y,s)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const s=r??this._centerAltitude,l=[t.x,t.y,0,1],c=[t.x,t.y,1,1];Fn.transformMat4(l,l,this.pixelMatrixInverse),Fn.transformMat4(c,c,this.pixelMatrixInverse);const d=c[3];Fn.scale(l,l,1/l[3]),Fn.scale(c,c,1/d);const h=l[2],p=c[2];return{p0:l,p1:c,t:h===p?0:(s-h)/(p-h)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],s=[t.x,t.y,1,1];return Fn.transformMat4(r,r,this.pixelMatrixInverse),Fn.transformMat4(s,s,this.pixelMatrixInverse),Fn.scale(r,r,1/r[3]),Fn.scale(s,s,1/s[3]),r[2]=Ln(r[2],this._center.lat)*this.worldSize,s[2]=Ln(s[2],this._center.lat)*this.worldSize,Fn.scale(r,r,1/this.worldSize),Fn.scale(s,s,1/this.worldSize),new Bh([r[0],r[1],r[2]],q.normalize([],q.sub([],s,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:s,t:l}=t,c=Ln(r[2],this._center.lat),d=Ln(s[2],this._center.lat);return new Ke(_e(r[0],s[0],l)/this.worldSize,_e(r[1],s[1],l)/this.worldSize,_e(c,d,l))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new Ke(r[0],r[1],r[2]);let s=0,l=this.horizonLineFromTop();if(t.y>l)return this.pointCoordinate(t);const c=.02*l,d=t.clone();for(let h=0;h<10&&l-s>c;h++){d.y=_e(s,l,.66);const p=this.projection.pointCoordinate3D(this,d.x,d.y);p?(l=d.y,r=p):s=d.y}return r?new Ke(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=mu)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const s=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,l=[t.x*this.worldSize,t.y*this.worldSize,s+t.toAltitude(),1];return Fn.transformMat4(l,l,this.pixelMatrix),l[3]>0?new nt(l[0]/l[3],l[1]/l[3]):new nt(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,l=this.width-this._edgeInsets.right,c=this.pointLocation3D(new nt(r,t)),d=this.pointLocation3D(new nt(l,t)),h=this.pointLocation3D(new nt(l,s)),p=this.pointLocation3D(new nt(r,s));let m=Math.min(c.lng,d.lng,h.lng,p.lng),_=Math.max(c.lng,d.lng,h.lng,p.lng),y=Math.min(c.lat,d.lat,h.lat,p.lat),v=Math.max(c.lat,d.lat,h.lat,p.lat);const b=Math.pow(2,-this.zoom)/16*270,E="globe"===this.projection.name?1:4,C=(S,M,D,R,P)=>{const I=(S+D)/2,O=(M+R)/2,F=new nt(I,O),{lng:L,lat:N}=this.pointLocation3D(F),z=Math.max(0,m-L,y-N,L-_,N-v);m=Math.min(m,L),_=Math.max(_,L),y=Math.min(y,N),v=Math.max(v,N),(P<E||z>b)&&(C(S,M,I,O,P+1),C(I,O,D,R,P+1))};if(C(r,t,l,t,1),C(l,t,l,s,1),C(l,s,r,s,1),C(r,s,r,t,1),"globe"===this.projection.name){const[S,M]=function(D){const R=rt.identity(new Float64Array(16));rt.multiply(R,D.pixelMatrix,D.globeMatrix);const P=[0,Po,0],I=[0,ga,0];return q.transformMat4(P,P,R),q.transformMat4(I,I,R),[P[0]>0&&P[0]<=D.width&&P[1]>0&&P[1]<=D.height&&!ey(D,new we(D.center.lat,90)),I[0]>0&&I[0]<=D.width&&I[1]>0&&I[1]<=D.height&&!ey(D,new we(D.center.lat,-90))]}(this);S?(v=90,_=180,m=-180):M&&(y=-90,_=180,m=-180)}return new qs(new we(m,y),new we(_,v))}_getBoundsRectangular(t,r){const{top:s,left:l}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,h=new nt(l,s),p=new nt(d,s),m=new nt(d,c),_=new nt(l,c);let y=this.pointCoordinate(h,t),v=this.pointCoordinate(p,t);const b=this.pointCoordinate(m,r),E=this.pointCoordinate(_,r),C=(S,M)=>(M.y-S.y)/(M.x-S.x);return y.y>1&&v.y>=0?y=new Ke((1-E.y)/C(E,y)+E.x,1):y.y<0&&v.y<=1&&(y=new Ke(-E.y/C(E,y)+E.x,0)),v.y>1&&y.y>=0?v=new Ke((1-b.y)/C(b,v)+b.x,1):v.y<0&&y.y<=1&&(v=new Ke(-b.y/C(b,v)+b.x,0)),(new qs).extend(this.coordinateLocation(y)).extend(this.coordinateLocation(v)).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(b))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((s,l)=>{if(l.dem){const c=l.dem.tree;s.min=Math.min(s.min,c.minimums[0]),s.max=Math.max(s.max,c.maximums[0])}return s},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,s=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,s):s}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-Hi,this.maxLat=Hi,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=eo(this.minLng)*this.tileSize,this.worldMaxX=eo(this.maxLng)*this.tileSize,this.worldMinY=po(this.maxLat)*this.tileSize,this.worldMaxY=po(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,s=this._distanceTileDataCache;if(s[r])return s[r];const l=t.canonical,c=1/this.height,d=this.cameraWorldSize,h=d/this.zoomScale(l.z),p=(l.x+Math.pow(2,l.z)*t.wrap)*h,m=l.y*h,_=this.point;_.x*=d/this.worldSize,_.y*=d/this.worldSize;const y=this.angle,v=Math.sin(-y),b=-Math.cos(-y);return s[r]={bearing:[v,b],center:[(_.x-p)*c,(_.y-m)*c],scale:h/dt*c},s[r]}calculateFogTileMatrix(t){const r=t.key,s=this._fogTileMatrixCache;if(s[r])return s[r];const l=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return rt.multiply(l,this.worldToFogMatrix,l),s[r]=new Float32Array(l),s[r]}calculateProjMatrix(t,r=!1){const s=t.key,l=r?this._alignedProjMatrixCache:this._projMatrixCache;if(l[s])return l[s];const c=this.calculatePosMatrix(t,this.worldSize);return rt.multiply(c,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.alignedProjMatrix:this.projMatrix,c),l[s]=new Float32Array(c),l[s]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,s=this._pixelsToTileUnitsCache;if(s[r])return s[r];const l=function(c,d){const{scale:h}=c.tileTransform,p=h*dt/(c.tileSize*Math.pow(2,d.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return zh.scale(new Float32Array(4),d.inverseAdjustmentMatrix,[p,p])}(t,this);return s[r]=l,s[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,r=rt.fromScaling([],[t,t,t]);return rt.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const r=Ln(1,this._center.lat)*this.worldSize,s=this._computeCameraPosition(r),l=this._camera.forward(),c=Ln(1,this._center.lat);s[2]/=c,l[2]/=c,q.normalize(l,l);const d=t.raycast(s,l,t.exaggeration());if(d){const h=q.scaleAndAdd([],s,l,d),p=new Ke(h[0],h[1],Ln(h[2],lr(h[1]))),m=(p.z+q.length([p.x-s[0],p.y-s[1],p.z-s[2]*c]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(m),this._centerAltitude=p.toAltitude(),this._center=this.coordinateLocation(p),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,s=Ln(1,this._center.lat)*this.worldSize,l=this._computeCameraPosition(s),c=r.getAtPointOrZero(new Ke(...l)),d=this.pixelsPerMeter/this.worldSize*c,h=this._minimumHeightOverTerrain(),p=l[2]-d;if(p<=h)if(p<0||t){const m=this.locationCoordinate(this._center,this._centerAltitude),_=[l[0],l[1],m.z-l[2]],y=q.length(_);_[2]-=(h-p)/this._pixelsPerMercatorPixel;const v=q.length(_);if(0===v)return;q.scale(_,_,y/v*this._pixelsPerMercatorPixel),this._camera.position=[l[0],l[1],m.z*this._pixelsPerMercatorPixel-_[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const v=this.center;return v.lat=Jt(v.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(v.lng=Jt(v.lng,this.minLng,this.maxLng)),this.center=v,void(this._constraining=!1)}const r=this._unmodified,{x:s,y:l}=this.point;let c=0,d=s,h=l;const p=this.width/2,m=this.height/2,_=this.worldMinY*this.scale,y=this.worldMaxY*this.scale;if(l-m<_&&(h=_+m),l+m>y&&(h=y-m),y-_<this.height&&(c=Math.max(c,this.height/(y-_)),h=(y+_)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const v=this.worldMinX*this.scale,b=this.worldMaxX*this.scale,E=this.worldSize/2-(v+b)/2;d=(s+E+this.worldSize)%this.worldSize-E,d-p<v&&(d=v+p),d+p>b&&(d=b-p),b-v<this.width&&(c=Math.max(c,this.width/(b-v)),d=(b+v)/2)}d===s&&h===l||(this.center=this.unproject(new nt(d,h))),c&&(this.zoom+=this.scaleZoom(c)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r="globe"===this.projection.name,s=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=Ln(1,this.center.lat)/Ln(1,45));const l=Dn(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,l),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const c="meters"===this.projection.zAxisUnit?s:1,d=this._camera.getWorldToCamera(this.worldSize,c);let h;const p=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height,this.isOrthographic){let N=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),z=N*this.aspect,U=-z,V=-N;z-=t.x,U-=t.x,N+=t.y,V+=t.y,h=this._camera.getCameraToClipOrthographic(U,z,V,N,this._nearZ,this._farZ),((H,j,Z,tt)=>{for(let it=0;it<16;it++)H[it]=ro(j[it],Z[it],tt)})(h,h,p,dS(this.pitch>=15?1:this.pitch/15))}else h=p;const m=rt.mul([],p,d);let _=rt.mul([],h,d);if(this.projection.isReprojectedInTileSpace){const N=this.locationCoordinate(this.center),z=rt.identity([]);rt.translate(z,z,[N.x*this.worldSize,N.y*this.worldSize,0]),rt.multiply(z,z,Wy(this)),rt.translate(z,z,[-N.x*this.worldSize,-N.y*this.worldSize,0]),rt.multiply(_,_,z),rt.multiply(m,m,z),this.inverseAdjustmentMatrix=function(U){const V=Wy(U,!0);return zh.invert([],[V[0],V[1],V[4],V[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=rt.scale([],_,[this.worldSize,this.worldSize,this.worldSize/c,1]),this.projMatrix=_,this.invProjMatrix=rt.invert(new Float64Array(16),this.projMatrix);const y=rt.invert([],h);this.frustumCorners=Vh.fromInvProjectionMatrix(y,this.horizonLineFromTop(),this.height),this.cameraFrustum=Bl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const v=new Float32Array(16);rt.identity(v),rt.scale(v,v,[1,-1,1]),rt.rotateX(v,v,this._pitch),rt.rotateZ(v,v,this.angle);const b=rt.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=rt.clone(b);const E=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;b[8]=2*-t.x/this.width,b[9]=2*(t.y+E)/this.height,this.skyboxMatrix=rt.multiply(v,b,v);const C=this.point,S=C.x,M=C.y,D=this.width%2/2,R=this.height%2/2,P=Math.cos(this.angle),I=Math.sin(this.angle),O=S-Math.round(S)+P*D+I*R,F=M-Math.round(M)+P*R+I*D,L=new Float64Array(_);if(rt.translate(L,L,[O>.5?O-1:O,F>.5?F-1:F,0]),this.alignedProjMatrix=L,_=rt.create(),rt.scale(_,_,[this.width/2,-this.height/2,1]),rt.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=rt.create(),rt.scale(_,_,[1,-1,1]),rt.translate(_,_,[-1,-1,0]),rt.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.pixelMatrix=rt.multiply(new Float64Array(16),this.labelPlaneMatrix,m),this._calcFogMatrices(),this._distanceTileDataCache={},_=rt.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=_,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(z){const{x:U,y:V}=z.point,{lng:H,lat:j}=z._center;return UC(U,V,z.worldSize,H,j)}(this);const N=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=q.transformMat4(N,N,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=_;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,s=this._camera.position,l=1/this.height/this._pixelsPerMercatorPixel,c=[t,t,r];q.scale(c,c,l),q.scale(s,s,-1),q.multiply(s,s,c);const d=rt.create();rt.translate(d,d,s),rt.scale(d,d,c),this.mercatorFogMatrix=d,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,l)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,s=this._camera.forward(),l=this.point,c=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[l.x/this.worldSize-s[0]*c,l.y/this.worldSize-s[1]*c,t/this.worldSize*this._centerAltitude-s[2]*c]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),s=this._camera.position[2],l=t[2];let c=1;this.projection.wrap&&(this.center=this.center.wrap()),l>0&&(c=Math.min((r-s)/l,1)),this._camera.position=q.scaleAndAdd([],this._camera.position,t,c),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:s,bearing:l}=this._camera.getPitchBearing(),c=Ln(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,d=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Ie(this._maxPitch)),h=Math.max((t[2]-c)/Math.cos(s),d),p=this._zoomFromMercatorZ(h);q.scaleAndAdd(t,t,r,h),this._pitch=Jt(s,Ie(this.minPitch),Ie(this.maxPitch)),this.angle=bl(l,-Math.PI,Math.PI),this._setZoom(Jt(p,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Ke(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,s=mu,l=0,c=1/0;for(;s-r>1e-6&&s>r;){const d=r+.5*(s-r),h=this.tileSize*Math.pow(2,d),p=this.getCameraToCenterDistance(this.projection,d,h),m=this.scaleZoom(p/(t*this.tileSize)),_=Math.abs(d-m);_<c&&(c=_,l=d),d<m?r=d:s=d}return l}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(Q("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const s=Math.min(t.x,r.x),l=Math.max(t.x,r.x),c=Math.min(t.y,r.y),d=Math.max(t.y,r.y);if(c<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const h=[new nt(s,c),new nt(l,d),new nt(s,d),new nt(l,c)],p=this.renderWorldCopies?-3:0,m=this.renderWorldCopies?4:1;for(const _ of h){const y=this.pointRayIntersection(_);if(y.t<0)return!0;const v=this.rayIntersectionCoordinate(y);if(v.x<p||v.y<0||v.x>m||v.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+Er(this.fovAboveCenter)>88||this.anyCornerOffEdge(new nt(0,0),new nt(this.width,this.height))}zoomDeltaToMovement(t,r){const s=q.length(q.sub([],this._camera.position,t)),l=this._zoomFromMercatorZ(s)+r;return s-this._mercatorZfromZoom(l)}getCameraPoint(){if("globe"===this.projection.name){const t=function([r,s,l],c){const d=[r,s,l,1];Fn.transformMat4(d,d,c);const h=d[3]=Math.max(d[3],1e-6);return d[0]/=h,d[1]/=h,d[2]/=h,d}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new nt(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new nt(0,t))}}getCameraToCenterDistance(t,r=this.zoom,s=this.worldSize){const l=Dn(t,r,this.width,this.height,1024),c=t.pixelSpaceConversion(this.center.lat,s,l);let d=.5/Math.tan(.5*this._fov)*this.height*c;return this.isOrthographic&&(d=ro(1,d,dS(this.pitch>=15?1:this.pitch/15))),d}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&rt.multiply(t,t,this.globeMatrix),t}getFrustum(t){return Bl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}function oo(n,t,r){rt.identity(n),rt.rotateZ(n,n,Ie(t[2])),rt.rotateX(n,n,Ie(t[0])),rt.rotateY(n,n,Ie(t[1])),rt.scale(n,n,r),rt.multiply(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function zm(n,t,r,s,l,c,d,h){const p=[r[0]-t[0],r[1]-t[1],0],m=[s[0]-t[0],s[1]-t[1],0];if(q.length(p)<1e-12||q.length(m)<1e-12)return Qr.identity(n);const _=q.cross([],p,m);q.normalize(_,_),q.subtract(m,s,t),p[2]=(c-l)*h,m[2]=(d-l)*h;const y=p;return q.cross(y,p,m),q.normalize(y,y),Qr.rotationTo(n,_,y)}function Xy(n,t,r=!1){const s=Br(t.zoom),l=function(c,d,h){const p=d.worldSize,m=[c[12],c[13],c[14]],_=lr(m[1]/p),y=Ms(m[0]/p),v=rt.identity([]),b=Ln(1,_)*p,E=Ln(1,0)*p*Ha(_,d.zoom),C=1/Px(p);let S=E*C;if(h){const P=Dn(d.projection,d.zoom,d.width,d.height,1024);S=C*d.projection.pixelSpaceConversion(d.center.lat,p,P)}const M=as(_,y);q.add(M,M,q.scale([],q.normalize([],M),b*S*m[2]));const D=function(P){const I=[P[0],P[1],P[2]];let O=[0,1,0];const F=q.cross([],O,I);return q.cross(O,I,F),0===q.squaredLength(O)&&(O=[0,1,0],q.cross(F,I,O)),q.normalize(F,F),q.normalize(O,O),q.normalize(I,I),[F[0],F[1],F[2],0,O[0],O[1],O[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],1]}(M);rt.scale(v,v,[S,S,S*b]),rt.translate(v,v,[-m[0],-m[1],-m[2]]);const R=rt.multiply([],d.globeMatrix,D);return rt.multiply(R,R,v),rt.multiply(R,R,c),R}(n,t,r);return s>0?function(d,h,p){const m=(E,C,S)=>{const M=q.length(E),D=q.length(C),R=_a(E,C,S);return q.scale(R,R,1/q.length(R)*_e(M,D,S))},_=m([d[0],d[1],d[2]],[h[0],h[1],h[2]],p),y=m([d[4],d[5],d[6]],[h[4],h[5],h[6]],p),v=m([d[8],d[9],d[10]],[h[8],h[9],h[10]],p),b=_a([d[12],d[13],d[14]],[h[12],h[13],h[14]],p);return[_[0],_[1],_[2],0,y[0],y[1],y[2],0,v[0],v[1],v[2],0,b[0],b[1],b[2],1]}(l,function(d,h){const p=h.worldSize,m=Ln(1,0)*p*Ha(h.center.lat,h.zoom)/Px(p),_=Ln(1,h.center.lat)*p,y=rt.identity([]);return rt.rotateY(y,y,Ie(h.center.lng)),rt.rotateX(y,y,Ie(h.center.lat)),rt.translate(y,y,[0,0,Ro]),rt.scale(y,y,[m,m,m*_]),rt.translate(y,y,[h.point.x-.5*p,h.point.y-.5*p,0]),rt.multiply(y,y,d),rt.multiply(y,h.globeMatrix,y)}(n,t),s):l}const hS=[1,1,1];class Ub{constructor(t,r,s,l){this.id=t,this.position=null!=r?new we(r[0],r[1]):new we(0,0),this.orientation=s??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,r){if(rt.multiply(t.matrix,r,t.matrix),t.meshes)for(const s of t.meshes){const l=ci.applyTransform(s.aabb,t.matrix);this.aabb.encapsulate(l)}if(t.children)for(const s of t.children)this._applyTransformations(s,t.matrix)}computeBoundsAndApplyParent(){const t=rt.identity([]);for(const r of this.nodes)this._applyTransformations(r,t)}_positionModelOnTerrain(t,r){const s=t.elevation;if(!s)return 0;const l=ci.projectAabbCorners(this.aabb,this.matrix),c=Ln(1,this.position.lat)*t.worldSize,d=function(M,D){const R=[0,0,1],P=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const I of P){const O=M[I.corners[0]],F=M[I.corners[1]],L=M[I.corners[2]],N=[F[0]-O[0],F[1]-O[1],D*(F[2]-O[2])],z=q.cross(N,N,[L[0]-O[0],L[1]-O[1],D*(L[2]-O[2])]);q.normalize(z,z),I.dotProductWithUp=q.dot(z,R)}return P.sort((I,O)=>I.dotProductWithUp-O.dotProductWithUp),P[0].corners}(l,c),h=l[d[0]],p=l[d[1]],m=l[d[2]],_=l[d[3]],y=s.getAtPointOrZero(new Ke(h[0]/t.worldSize,h[1]/t.worldSize),0),v=s.getAtPointOrZero(new Ke(p[0]/t.worldSize,p[1]/t.worldSize),0),b=s.getAtPointOrZero(new Ke(m[0]/t.worldSize,m[1]/t.worldSize),0),E=s.getAtPointOrZero(new Ke(_[0]/t.worldSize,_[1]/t.worldSize),0),C=(y+E)/2,S=(v+b)/2;return C>S?v<b?zm(r,p,_,h,v,E,y,c):zm(r,m,h,_,b,y,E,c):y<E?zm(r,h,p,m,y,v,b,c):zm(r,_,m,p,E,b,v,c),Math.max(C,S)}computeModelMatrix(t,r,s,l,c,d,h=!1){const p=t.transform,m=p.zoom,_=p.project(this.position),y=Ha(this.position.lat,m),v=1/y;rt.identity(this.matrix),rt.translate(this.matrix,this.matrix,[_.x+l[0]*v,_.y+l[1]*v,l[2]]);let b=1,E=1;const C=p.worldSize;if(h){if("mercator"===p.projection.name){let R=0;p.elevation&&(R=p.elevation.getAtPointOrZero(new Ke(_.x/C,_.y/C),0));const P=Fn.transformMat4([],[_.x,_.y,R,1],p.projMatrix)[3]/p.cameraToCenterDistance;b=P,E=P*Ha(p.center.lat,m)}else if("globe"===p.projection.name){const R=Xy(this.matrix,p),P=rt.multiply([],p.projMatrix,R),I=[0,0,0,1];Fn.transformMat4(I,I,P);const O=I[3]/p.cameraToCenterDistance,F=Br(m),L=p.projection.pixelsPerMeter(this.position.lat,C)*Ha(this.position.lat,m),N=p.projection.pixelsPerMeter(p.center.lat,C)*Ha(p.center.lat,m);b=O/_e(L,kx(p.center.lat),F),E=O*y/L,b*=N,E*=N}}else b=v;rt.scale(this.matrix,this.matrix,[b,b,E]);const S=[...this.matrix],M=this.orientation,D=[];if(oo(D,[M[0]+r[0],M[1]+r[1],M[2]+r[2]],s),rt.multiply(this.matrix,S,D),c&&p.elevation){let R=0;const P=[];if(d&&p.elevation){R=this._positionModelOnTerrain(p,P);const I=rt.fromQuat([],P),O=rt.multiply([],I,D);rt.multiply(this.matrix,S,O)}else R=p.elevation.getAtPointOrZero(new Ke(_.x/C,_.y/C),0);0!==R&&(this.matrix[14]+=R)}}upload(t){if(!this.uploaded){for(const r of this.nodes)Yy(r,t);for(const r of this.nodes)Bm(r);this.uploaded=!0}}destroy(){for(const t of this.nodes)Vm(t)}}function Ef(n,t,r=!1){n.uploaded||(n.gfxTexture=new ir(t,n.image,r?t.gl.R8:t.gl.RGBA,{useMipmap:n.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function fS(n,t,r){n.indexBuffer=t.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=t.createVertexBuffer(n.vertexArray,Fb.members,!1,!0),n.normalArray&&(n.normalBuffer=t.createVertexBuffer(n.normalArray,O2.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=t.createVertexBuffer(n.texcoordArray,P2.members,!1,!0)),n.colorArray&&(n.colorBuffer=t.createVertexBuffer(n.colorArray,(12===n.colorArray.bytesPerElement?R2:iS).members,!1,!0)),n.featureArray&&(n.pbrBuffer=t.createVertexBuffer(n.featureArray,rS.members,!0)),n.segments=Bn.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const s=n.material;s.pbrMetallicRoughness.baseColorTexture&&Ef(s.pbrMetallicRoughness.baseColorTexture,t),s.pbrMetallicRoughness.metallicRoughnessTexture&&Ef(s.pbrMetallicRoughness.metallicRoughnessTexture,t),s.normalTexture&&Ef(s.normalTexture,t),s.occlusionTexture&&Ef(s.occlusionTexture,t,r),s.emissionTexture&&Ef(s.emissionTexture,t)}function Yy(n,t,r){if(n.meshes)for(const s of n.meshes)fS(s,t,r);if(n.children)for(const s of n.children)Yy(s,t,r)}function Bm(n){if(n.meshes)for(const t of n.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(n.children)for(const t of n.children)Bm(t)}function Vm(n){if(n.meshes)for(const r of n.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(n.children)for(const r of n.children)Vm(r)}class jm{constructor(t,r){this.feature=t,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Fc{constructor(){this.instancedDataArray=new YE,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class pS{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,r,s,l){this.tileToMeter=bd(s);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:h,index:p,sourceLayerIndex:m}of t){const _=gu(d,c);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),_,s))continue;const y={id:h,sourceLayerIndex:m,index:p,geometry:c?_.geometry:Vl(d,s,l),properties:d.properties,type:d.type,patterns:{}},v=this.addFeature(y,y.geometry,_);v&&r.featureIndex.insert(d,y.geometry,p,m,this.index,this.instancesPerModel[v].instancedDataArray.length)}this.lookup=null}update(t,r,s,l){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];for(const h in t)d.idToFeaturesIndex.hasOwnProperty(h)&&this.evaluate(d.features[d.idToFeaturesIndex[h]],t[h],d,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];for(const l of s.features){const c=this.layers[0],d=l.feature,h=this.canonical,p=c.paint.get("model-rotation").evaluate(d,{},h),m=c.paint.get("model-scale").evaluate(d,{},h),_=c.paint.get("model-translation").evaluate(d,{},h);q.exactEquals(l.rotation,p)&&q.exactEquals(l.scale,m)&&q.exactEquals(l.translation,_)||(this.evaluate(l,l.featureStates,s,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];s.instancedDataArray.length<0||0===s.instancedDataArray.length||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=t.createVertexBuffer(s.instancedDataArray,Ki.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];0!==r.instancedDataArray.length&&r.instancedDataBuffer&&r.instancedDataBuffer.destroy()}}addFeature(t,r,s){const l=this.layers[0],c=l.layout.get("model-id").evaluate(s,{},this.canonical);if(!c)return Q(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),c;this.instancesPerModel[c]||(this.instancesPerModel[c]=new Fc);const d=this.instancesPerModel[c],h=d.instancedDataArray,p=new jm(s,h.length);for(const m of r)for(const _ of m){if(_.x<0||_.x>=dt||_.y<0||_.y>=dt)continue;const y=(this.lookupDim-1)/dt,v=this.lookupDim*(_.y*y|0)+_.x*y|0;if(this.lookup){if(0!==this.lookup[v])continue;this.lookup[v]=1}this.instanceCount++;const b=h.length;h.resize(b+1),d.instancesEvaluatedElevation.push(0),h.float32[16*b]=_.x,h.float32[16*b+1]=_.y}return p.instancedDataCount=d.instancedDataArray.length-p.instancedDataOffset,p.instancedDataCount>0&&(t.id&&(d.idToFeaturesIndex[t.id]=d.features.length),d.features.push(p),this.evaluate(p,{},d,!1)),c}evaluate(t,r,s,l){const c=this.layers[0],d=t.feature,h=this.canonical,p=t.rotation=c.paint.get("model-rotation").evaluate(d,r,h),m=t.scale=c.paint.get("model-scale").evaluate(d,r,h),_=t.translation=c.paint.get("model-translation").evaluate(d,r,h),y=c.paint.get("model-color").evaluate(d,r,h);y.a=c.paint.get("model-color-mix-intensity").evaluate(d,r,h);const v=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,m[0]),Math.max(m[1],m[2])),oo(v,p,m);const b=Math.round(100*y.a)+y.b/1.05;for(let E=0;E<t.instancedDataCount;++E){const C=t.instancedDataOffset+E,S=16*C,M=s.instancedDataArray.float32;let D=0;l&&(D=M[S+6]-s.instancesEvaluatedElevation[C]);const R=0|M[S+1];M[S]=(0|M[S])+y.r/1.05,M[S+1]=R+y.g/1.05,M[S+2]=b,M[S+3]=1/(h.z>10?this.tileToMeter:bd(h,R)),M[S+4]=_[0],M[S+5]=_[1],M[S+6]=_[2]+D,M[S+7]=v[0],M[S+8]=v[1],M[S+9]=v[2],M[S+10]=v[4],M[S+11]=v[5],M[S+12]=v[6],M[S+13]=v[8],M[S+14]=v[9],M[S+15]=v[10],s.instancesEvaluatedElevation[C]=_[2]}}}Xt(pS,"ModelBucket",{omit:["layers"]}),Xt(Fc,"PerModelAttributes"),Xt(jm,"ModelFeature");const L2=new Ei({visibility:new Dt(J.layout_model.visibility),"model-id":new se(J.layout_model["model-id"])});var $b={paint:new Ei({"model-opacity":new Dt(J.paint_model["model-opacity"]),"model-rotation":new se(J.paint_model["model-rotation"]),"model-scale":new se(J.paint_model["model-scale"]),"model-translation":new se(J.paint_model["model-translation"]),"model-color":new se(J.paint_model["model-color"]),"model-color-mix-intensity":new se(J.paint_model["model-color-mix-intensity"]),"model-type":new Dt(J.paint_model["model-type"]),"model-cast-shadows":new Dt(J.paint_model["model-cast-shadows"]),"model-receive-shadows":new Dt(J.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Dt(J.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new se(J.paint_model["model-emissive-strength"]),"model-roughness":new se(J.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new se(J.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Dt(J.paint_model["model-cutoff-fade-range"])}),layout:L2};const Lc=new Float32Array(262144),Nc=new Uint8Array(262144);function mS(n){let t=0;if(n.meshes)for(const r of n.meshes)t=Math.max(t,r.aabb.max[2]);if(n.children)for(const r of n.children)t=Math.max(t,mS(r));return t}const Ky=["","wall","door","roof","window","lamp","logo"];class N2{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:mS(t)}}}}class z2{constructor(t,r,s,l){this.nodes=t,this.id=r,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const s of r){const l=s.node;this.uploaded?this.updatePbrBuffer(l):Yy(l,t,!0)}for(const s of r)Bm(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let r=!1;if(!t.meshes)return r;for(const s of t.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),r=!0);return r}needsReEvaluation(t,r,s){const l=t.transform.projectionOptions,c=t.style.getBrightness(),d=this.brightness!==c;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||Um(s.paint.get("model-color").value,d)||Um(s.paint.get("model-color-mix-intensity").value,d)||Um(s.paint.get("model-roughness").value,d)||Um(s.paint.get("model-emissive-strength").value,d)||Um(s.paint.get("model-height-based-emissive-strength-multiplier").value,d))&&(this.projection=l,this.brightness=c,!0)}evaluateScale(t,r){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const s=this.getNodesInfo(),l=this.id.canonical;for(const c of s){const d=c.feature;c.evaluatedScale=r.paint.get("model-scale").evaluate(d,{},l)}}evaluate(t){const r=this.getNodesInfo();for(const s of r){if(!s.node.meshes)continue;const l=s.feature,c=s.node.meshes&&s.node.meshes[0].featureData,d=s.evaluatedColor[2],h=s.evaluatedRMEA[2],p=this.id.canonical;if(s.hasTranslucentParts=!1,c){for(let m=0;m<Ky.length;m++){const _=Ky[m];_.length&&(l.properties.part=_);const y=t.paint.get("model-color").evaluate(l,{},p),v=t.paint.get("model-color-mix-intensity").evaluate(l,{},p);s.evaluatedColor[m]=[y.r,y.g,y.b,v],s.evaluatedRMEA[m][0]=t.paint.get("model-roughness").evaluate(l,{},p),s.evaluatedRMEA[m][2]=t.paint.get("model-emissive-strength").evaluate(l,{},p),s.evaluatedRMEA[m][3]=y.a,s.emissionHeightBasedParams[m]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},p),!s.hasTranslucentParts&&y.a<1&&(s.hasTranslucentParts=!0)}delete l.properties.part,gS(s,d!==s.evaluatedColor[2]||h!==s.evaluatedRMEA[2])}s.evaluatedScale=t.paint.get("model-scale").evaluate(l,{},p),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,r,s,l){const c=t.findDEMTileFor(s);if(c&&(c.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const d=Za.create(t,s,c);if(!d)return;4&this.modelTraits&&this.updateDEM(t,d,s,l);for(const h of this.getNodesInfo()){const p=h.node;if(!p.footprint||!p.footprint.vertices||!p.footprint.vertices.length)continue;const m=p.footprint.vertices;let _=d.getElevationAt(m[0].x,m[0].y,!0,!0);for(let y=1;y<m.length;y++)_=Math.min(_,d.getElevationAt(m[y].x,m[y].y,!0,!0));p.elevation=_}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=r}}updateDEM(t,r,s,l){let c=r._dem._modifiedForSources[l];if(void 0===c&&(r._dem._modifiedForSources[l]=[],c=r._dem._modifiedForSources[l]),c.includes(s.canonical))return;const d=r._dem.dim;c.push(s.canonical);let h=!1;for(const p of this.getNodesInfo()){const m=p.node;if(!m.footprint||!m.footprint.grid)continue;const _=m.footprint.grid,y=r.tileCoordToPixel(_.min.x,_.min.y),v=r.tileCoordToPixel(_.max.x,_.max.y),b=Math.min(Math.min(d-v.y,y.x),Math.min(y.y,d-v.x));if(b<0)continue;const E=Jt(b,2,5);let C=Math.max(0,y.x-E),S=Math.max(0,y.y-E),M=Math.min(v.x+E,d-1),D=Math.min(v.y+E,d-1);for(let O=S;O<=D;++O)for(let F=C;F<=M;++F)Nc[O*d+F]=255;let R=0,P=0;for(let O=0;O<_.cellsY;++O)for(let F=0;F<_.cellsX;++F){if(!_.cells[O*_.cellsX+F])continue;const L=r.tileCoordToPixel(_.min.x+F/_.xScale,_.min.y+O/_.yScale),N=r.tileCoordToPixel(_.min.x+(F+1)/_.xScale,_.min.y+(O+1)/_.yScale);for(let z=L.y;z<=Math.min(N.y+1,d-1);++z)for(let U=L.x;U<=Math.min(N.x+1,d-1);++U)255===Nc[z*d+U]&&(Nc[z*d+U]=0,R+=r.getElevationAtPixel(U,z),P++)}const I=R/P;C=Math.max(1,y.x-E),S=Math.max(1,y.y-E),M=Math.min(v.x+E,d-2),D=Math.min(v.y+E,d-2),h=!0;for(let O=S;O<=D;++O)for(let F=C;F<=M;++F)0===Nc[O*d+F]&&(Lc[O*d+F]=r._dem.set(F,O,I));for(let O=1;O<E;++O){C=Math.max(1,y.x-O),S=Math.max(1,y.y-O),M=Math.min(v.x+O,d-2),D=Math.min(v.y+O,d-2);for(let F=S;F<=D;++F)for(let L=C;L<=M;++L){const N=F*d+L;if(255===Nc[N]){let z=0,U=0,V=-1,H=-1;for(let j=-1;j<=1;++j)for(let Z=-1;Z<=1;++Z){const tt=(F+j)*d+L+Z;if(Nc[tt]>=O)continue;const it=Lc[tt],X=Math.abs(it);X>U&&(z=it,U=X,V=Z,H=j)}if(U>.1){const j=1-(O+.5*Math.abs(V*H))/E;let Z=r._dem.get(L,F)+z*j;const tt=r._dem.get(L+V,F+H),it=r._dem.get(L-V,F-H,!0);(Z-tt)*(Z-it)>0&&(Z=(tt+it)/2),Lc[N]=r._dem.set(L,F,Z),Nc[N]=O}}}}}h&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=kt.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new N2(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)Vm(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const r of t)Bm(r.node),Vm(r.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const s=r.getReplacementRegionsForTile(t.toUnwrapped()),l=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const d=l[c].node;l[c].hiddenByReplacement=!!d.footprint&&!s.find(h=>h.footprint===d.footprint)}}getHeightAtTileCoord(t,r){const s=this.getNodesInfo(),l=[];for(let c=0;c<this.nodesInfo.length;c++){const d=s[c],h=d.node.meshes[0];if(t<h.aabb.min[0]||r<h.aabb.min[1]||t>h.aabb.max[0]||r>h.aabb.max[1])continue;const p=(t-h.aabb.min[0])/(h.aabb.max[0]-h.aabb.min[0])*64|0,m=64*Math.min(63,(r-h.aabb.min[1])/(h.aabb.max[1]-h.aabb.min[1])*64|0)+Math.min(63,p);if(!(h.heightmap[m]<0&&d.node.footprint))return d.hiddenByReplacement?void 0:{height:h.heightmap[m],maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};if(d.node.footprint.grid.query(new nt(t,r),new nt(t,r),l),l.length>0)return{height:void 0,maxHeight:d.feature.properties.height,hidden:d.hiddenByReplacement,verticalScale:d.evaluatedScale[2]}}}}function Um(n,t){return!n.isLightConstant&&t}function B2(n,t,r,s,l,c,d,h){let p=(61440&t|(61440&t)>>4)>>8,m=(3840&t|(3840&t)>>4)>>4,_=240&t|(240&t)>>4;r[3]>0&&(p=_e(p,255*r[0],r[3]),m=_e(m,255*r[1],r[3]),_=_e(_,255*r[2],r[3]));const y=p<<8|m,v=_<<8|Math.floor(255*s[3]),b=function(O){const F=Jt(O,0,2);return Math.min(Math.round(.5*F*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],E=Jt(l[0],0,1),C=Jt(l[1],0,1),S=Jt(l[2],0,1),M=Jt(l[3],0,1);let D,R,P,I;if(E!==C&&d!==c&&C!==E){const O=d-c;R=1/(O*(C-E)),P=-(c+O*E)/(O*(C-E));const F=Jt(l[4],-1,1);I=Math.pow(10,F),D=255*S<<8|255*M}else D=65535,R=0,P=1,I=1;if(n.emplaceBack(y,v,b,D,R,P,I),h){const O=h.length;h.clear();for(let F=0;F<O;F++)h.emplaceBack(y,v,b,D,R,P,I)}}function gS(n,t){const r=n.node;let s=0;for(const l of r.meshes){if(r.lights&&r.lightMeshIndex===s||!l.featureData)continue;l.featureArray=new F_,l.featureArray.reserve(l.featureData.length);let c=t;for(const d of l.featureData){let h;const p=65535&d,m=(15&p)<8?15&p:0,_=d>>16&65535,y=n.evaluatedRMEA[m],v=n.evaluatedColor[m],b=n.emissionHeightBasedParams[m];if(c&&2===m&&r.lights&&(h=new F_,h.resize(10*r.lights.length)),B2(l.featureArray,_,v,y,b,l.aabb.min[2],l.aabb.max[2],h),h&&c){c=!1;const E=r.meshes[r.lightMeshIndex];E.featureArray=h,E.featureArray._trim()}}l.featureArray._trim(),s++}}Xt(z2,"Tiled3dModelBucket",{omit:["layers"]}),Xt(N2,"Tiled3dModelFeature");class V2{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const r=yS(new nt(0,0),new nt(dt,dt),t),s=[];for(const l of this._activeRegions){if(l.hiddenByOverlap||!_S(r,l))continue;const c=vS(l.min,l.max,t);s.push({min:c.min,max:c.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId})}return s}setSources(t){this._setSources(t.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const s=[];for(const l of r.cache.getVisibleCoordinates()){const c=r.cache.getTile(l).buckets[r.layer];if(c)for(const d of c.getNodesInfo()){const h=d.node;h.footprint&&s.push({footprint:h.footprint,id:l.toUnwrapped()})}}return s}})))}_addSource(t){const r=t.getFootprints();if(0!==r.length){for(const s of r){if(!s.footprint)continue;const l=yS(s.footprint.min,s.footprint.max,s.id);this._activeRegions.push({min:l.min,max:l.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:s.id,footprint:s.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((r,s)=>r.priority-s.priority||Tr(r.min,s.min)||Tr(r.max,s.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let r=0,s=0;for(;!t&&r!==this._activeRegions.length;){const l=this._activeRegions[r],c=this._prevRegions[s];t=l.priority!==c.priority||!Hb(l,c),++r,++s}}if(t){++this._updateTime;const r=s=>{const l=this._activeRegions;if(s>=l.length)return s;const c=l[s].priority;for(;s<l.length&&l[s].priority===c;)++s;return s};if(this._sourceIds.length>1){let s=0,l=r(s);for(;s!==l;){let c=s;const d=s;for(;c!==l;){const h=this._activeRegions[c];h.hiddenByOverlap=!1;for(let p=0;p<d;p++){const m=this._activeRegions[p];if(!m.hiddenByOverlap&&_S(h,m)&&(h.hiddenByOverlap=Gb(h.footprint,h.tileId,m.footprint,m.tileId),h.hiddenByOverlap))break}++c}s=l,l=r(s)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=t.length-1;r>=0;r--)this._addSource(t[r]);this._computeReplacement()}}function Tr(n,t){return n.x-t.x||n.y-t.y}function Hb(n,t){return 0===Tr(n.min,t.min)&&0===Tr(n.max,t.max)}function _S(n,t){return!(n.min.x>t.max.x||n.max.x<t.min.x||n.min.y>t.max.y||n.max.y<t.min.y)}function yS(n,t,r){const s=1/dt,l=1/(1<<r.canonical.z),c=(t.x*s+r.canonical.x)*l+r.wrap,d=(t.y*s+r.canonical.y)*l;return{min:new nt((n.x*s+r.canonical.x)*l+r.wrap,(n.y*s+r.canonical.y)*l),max:new nt(c,d)}}function vS(n,t,r){const s=1<<r.canonical.z,l=((t.x-r.wrap)*s-r.canonical.x)*dt,c=(t.y*s-r.canonical.y)*dt;return{min:new nt(((n.x-r.wrap)*s-r.canonical.x)*dt,(n.y*s-r.canonical.y)*dt),max:new nt(l,c)}}function xS(n,t,r,s,l,c,d){const h=n.indices,p=n.vertices,m=[];for(let _=s;_<s+l;_+=3){const y=t[r[_+0]+c],v=t[r[_+1]+c],b=t[r[_+2]+c],E=Math.min(y.x,v.x,b.x),C=Math.max(y.x,v.x,b.x),S=Math.min(y.y,v.y,b.y),M=Math.max(y.y,v.y,b.y);m.length=0,n.grid.query(new nt(E,S),new nt(C,M),m);for(let D=0;D<m.length;D++){const R=m[D];if(em(p[h[3*R+0]],p[h[3*R+1]],p[h[3*R+2]],y,v,b,d))return!0}}return!1}function Gb(n,t,r,s){if(!n||!r)return!1;let l=n.vertices;if(!t.canonical.equals(s.canonical)||t.wrap!==s.wrap){if(r.vertices.length<n.vertices.length)return Gb(r,s,n,t);const c=t.canonical,d=s.canonical,h=Math.pow(2,d.z-c.z);l=n.vertices.map(p=>new nt(p.x*c.x*dt*h-d.x*dt,p.y*c.y*dt*h-d.y*dt))}return xS(r,l,n.indices,0,n.indices.length,0,0)}const bS=pm.types,Cf=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],j2=["fill-extrusion-flood-light-ground-radius"],U2=Math.pow(2,13),wS=Math.pow(2,15)-1,ES=new nt(0,1),Qa=2147483648;function Jy(n,t,r,s,l,c,d,h){n.emplaceBack((t<<1)+d,(r<<1)+c,(Math.floor(s*U2)<<1)+l,Math.round(h))}function $m(n,t,r,s,l,c){n.emplaceBack(t.x,t.y,(r.x<<1)+s,(r.y<<1)+l,c)}function Vr(n,t,r){n.emplaceBack(t.x,t.y,t.z,16384*r[0],16384*r[1],16384*r[2])}class tl{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class CS{constructor(){this.centroidXY=new nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class MS{constructor(){this.acc=new nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,r){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=r.x,t.min.y=t.max.y=r.y)}appendEdge(t,r,s){this.accCount++,this.acc._add(r);let l=!!this.borders;r.x<t.min.x?(t.min.x=r.x,l=!0):r.x>t.max.x&&(t.max.x=r.x,l=!0),r.y<t.min.y?(t.min.y=r.y,l=!0):r.y>t.max.y&&(t.max.y=r.y,l=!0),((0===r.x||r.x===dt)&&r.x===s.x)!=((0===r.y||r.y===dt)&&r.y===s.y)&&this.processBorderOverlap(r,s),l&&this.checkBorderIntersection(r,s)}checkBorderIntersection(t,r){r.x<0!=t.x<0&&this.addBorderIntersection(0,_e(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>dt!=t.x>dt&&this.addBorderIntersection(1,_e(r.y,t.y,(dt-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,_e(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>dt!=t.y>dt&&this.addBorderIntersection(3,_e(r.x,t.x,(dt-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[t];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const s=0===t.x?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,t.y)}else{const s=0===t.y?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,t.x)}}centroid(){return 0===this.accCount?new nt(0,0):new nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0):0}}function el(n,t){const r=n.add(t)._unit(),s=Jt(n.x*r.x+n.y*r.y,-1,1);var l,c,d;return l=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(l)))/4*wS*((c=n).x*(d=t).y-c.y*d.x<0?-1:1)}const nl=[n=>n.x<0,n=>n.x>dt,n=>n.y<0,n=>n.y>dt];function il(n,t,r,s){const l=[4];if(0===s)return l;r._mult(s);const c=n.sub(r),d=t.sub(r),h=[n,t,c,d];for(let p=0;p<4;p++)for(const m of h)if(nl[p](m)){l.push(p);break}return l}class qb{constructor(t){this.vertexArray=new Ao,this.indexArray=new er,this.programConfigurations=new dd(t.layers,t.zoom,r=>j2.includes(r)),this._segments=new Bn,this.hiddenByLandmarkVertexArray=new J0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Bn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,r,s,l=!1){const c=t.length;if(c>2){let d=Math.max(0,this._segments.get().length-1);const h=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let p;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const m=t[0],_=t[1];p=el(m.sub(t[c-1])._perp()._unit(),_.sub(m)._perp()._unit())}for(let m=0;m<c;m++){const _=m===c-1?0:m+1,y=t[m],v=t[_],b=t[_===c-1?0:_+1],E=v.sub(y)._perp()._unit(),C=el(E,b.sub(v)._perp()._unit()),S=p,M=C;if(Wb(y,v,r)||l&&Qy(y,r)&&Qy(v,r)){p=C;continue}const D=h.vertexLength;$m(this.vertexArray,y,v,1,1,S),$m(this.vertexArray,y,v,1,0,S),$m(this.vertexArray,y,v,0,1,M),$m(this.vertexArray,y,v,0,0,M),h.vertexLength+=4;const R=il(y,v,E,s);for(const P of R)this._segmentToGroundQuads[d].push({id:D,region:P}),this._segmentToRegionTriCounts[d][P]+=2,h.primitiveLength+=2;p=C}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),r=t.length;for(let s=0;s<r;s++)this._segmentToGroundQuads[s].sort((l,c)=>l.region-c.region);for(let s=0;s<r;s++){const l=this._segmentToGroundQuads[s],c=t[s],d=this._segmentToRegionTriCounts[s];d.reduce((p,m)=>p+m,0);let h=0;for(let p=0;p<=4;p++){const m=d[p];if(0!==m){let _=this.regionSegments[p];_||(_=this.regionSegments[p]=new Bn);const y={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+h,vertexLength:c.vertexLength,primitiveLength:m};_.get().push(y)}h+=m}for(let p=0;p<l.length;p++){const m=l[p].id;this.indexArray.emplaceBack(m,m+1,m+3),this.indexArray.emplaceBack(m,m+3,m+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,r,s,l,c,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,r,s,l,c,d)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,GA.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,r,s,l,c,d){this.hasData()&&this.programConfigurations.updatePaintArrays(t,r,s,l,c,d)}updateHiddenByLandmark(t){if(!this.hasData())return;const r=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const s=t.flags&Qa?1:0;for(let l=t.groundVertexArrayOffset;l<r;++l)this.hiddenByLandmarkVertexArray.emplace(l,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,IF.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const r=this.regionSegments[t];r&&r.destroy()}}}}class Mf{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new er,this.footprintVertices=new qo,this.footprintSegments=[],this.layoutVertexArray=new ad,this.centroidVertexArray=new tx,this.indexArray=new er,this.programConfigurations=new dd(t.layers,t.zoom,r=>Cf.includes(r)),this.segments=new Bn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new qb(t),this.maxHeight=0,this.partLookup={}}populate(t,r,s,l){this.features=[],this.hasPattern=nb("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=bd(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:d,index:h,sourceLayerIndex:p}of t){const m=this.layers[0]._featureFilter.needGeometry,_=gu(c,m);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),_,s))continue;const y={id:d,sourceLayerIndex:p,index:h,geometry:m?_.geometry:Vl(c,s,l),properties:c.properties,type:c.type,patterns:{}},v=this.layoutVertexArray.length;this.hasPattern?this.features.push(dy("fill-extrusion",this.layers,y,this.zoom,r)):this.addFeature(y,y.geometry,h,s,{},r.availableImages,l,r.brightness),r.featureIndex.insert(c,y.geometry,h,p,this.index,v)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(t,r,s,l,c,d){for(const h of this.features){const{geometry:p}=h;this.addFeature(h,p,h.index,r,s,l,c,d)}this.sortBorders()}update(t,r,s,l,c){const d=0!==Object.keys(t).length;if(d&&!this.stateDependentLayers.length)return;const h=d?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,r,h,s,l,c),this.groundEffect.update(t,r,h,s,l,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,qA.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,lM.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,l,c,d,h,p){const m=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,_=[new nt(0,0),new nt(dt,dt)],y=h.projection,v="globe"===y.name,b="Polygon"===bS[t.type],E=new MS;E.centroidDataIndex=this.centroidData.length;const C=new CS,S=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},l)<=0,M=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},l);C.height=M,C.vertexArrayOffset=this.layoutVertexArray.length,C.groundVertexArrayOffset=this.groundEffect.vertexArray.length,v&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Pp);const D=Yh(r,500);for(let L=D.length-1;L>=0;L--){const N=D[L];(0===N.length||(R=N[0]).every(z=>z.x<=0)||R.every(z=>z.x>=dt)||R.every(z=>z.y<=0)||R.every(z=>z.y>=dt))&&D.splice(L,1)}var R;let P;if(v)P=IS(D,_,l);else{P=[];for(const L of D)P.push({polygon:L,bounds:_})}const I=b?this.edgeRadius:0,O=I>0&&this.zoom<17,F=(L,N)=>{if(0===L.length)return!1;const z=L[L.length-1];return N.x===z.x&&N.y===z.y};for(const{polygon:L,bounds:N}of P){let z=0,U=0;for(const j of L)b&&!j[0].equals(j[j.length-1])&&j.push(j[0]),U+=b?j.length-1:j.length;const V=this.segments.prepareSegment((b?5:4)*U,this.layoutVertexArray,this.indexArray);C.footprintSegIdx<0&&(C.footprintSegIdx=this.footprintSegments.length);const H=new tl;if(H.vertexOffset=this.footprintVertices.length,H.indexOffset=3*this.footprintIndices.length,H.ringIndices=[],b){const j=[],Z=[];z=V.vertexLength;for(let it=0;it<L.length;it++){const X=L[it];X.length&&0!==it&&Z.push(j.length/2);const Y=[];let ot,lt;ot=X[1].sub(X[0])._perp()._unit(),H.ringIndices.push(X.length-1);for(let ht=1;ht<X.length;ht++){const mt=X[ht],yt=X[ht===X.length-1?1:ht+1],ct=mt.clone();if(I){lt=yt.sub(mt)._perp()._unit();const ft=ot.add(lt)._unit(),Rt=I*Math.min(4,1/(ot.x*ft.x+ot.y*ft.y));ct.x+=Rt*ft.x,ct.y+=Rt*ft.y,ct.x=Math.round(ct.x),ct.y=Math.round(ct.y),ot=lt}!S||0!==I&&!O||F(Y,ct)||Y.push(ct),Jy(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),V.vertexLength++,this.footprintVertices.emplaceBack(mt.x,mt.y),j.push(mt.x,mt.y),v&&Vr(this.layoutVertexExtArray,y.projectTilePoint(ct.x,ct.y,l),y.upVector(l,ct.x,ct.y))}S&&(0===I||O)&&(0!==Y.length&&F(Y,Y[0])&&Y.pop(),this.groundEffect.addData(Y,N,m))}const tt=uy(j,Z);for(let it=0;it<tt.length;it+=3)this.footprintIndices.emplaceBack(H.vertexOffset+tt[it+0],H.vertexOffset+tt[it+1],H.vertexOffset+tt[it+2]),this.indexArray.emplaceBack(z+tt[it],z+tt[it+2],z+tt[it+1]),V.primitiveLength++;H.indexCount+=tt.length,H.vertexCount+=this.footprintVertices.length-H.vertexOffset}for(let j=0;j<L.length;j++){const Z=L[j];E.startRing(C,Z[0]);let tt=Z.length>4&&Sf(Z[Z.length-2],Z[0],Z[1]),it=I?$2(Z[Z.length-2],Z[0],Z[1],I):0;const X=[];let Y,ot,lt;ot=Z[1].sub(Z[0])._perp()._unit();let ht=!0;for(let mt=1,yt=0;mt<Z.length;mt++){let ct=Z[mt-1],ft=Z[mt];const Rt=Z[mt===Z.length-1?1:mt+1];if(E.appendEdge(C,ft,ct),Wb(ft,ct,N)){I&&(ot=Rt.sub(ft)._perp()._unit(),ht=!ht);continue}const Vt=ft.sub(ct)._perp(),jt=Vt.x/(Math.abs(Vt.x)+Math.abs(Vt.y)),$t=Vt.y>0?1:0,re=ct.dist(ft);if(yt+re>32768&&(yt=0),I){lt=Rt.sub(ft)._perp()._unit();let Re=TS(ct,ft,Rt,SS(ot,lt),I);isNaN(Re)&&(Re=0);const Me=ft.sub(ct)._unit();ct=ct.add(Me.mult(it))._round(),ft=ft.add(Me.mult(-Re))._round(),it=Re,ot=lt,S&&this.zoom>=17&&(F(X,ct)||X.push(ct),F(X,ft)||X.push(ft))}const ye=V.vertexLength,je=Z.length>4&&Sf(ct,ft,Rt);let rn=DS(yt,tt,ht);if(Jy(this.layoutVertexArray,ct.x,ct.y,jt,$t,0,0,rn),Jy(this.layoutVertexArray,ct.x,ct.y,jt,$t,0,1,rn),yt+=re,rn=DS(yt,je,!ht),tt=je,Jy(this.layoutVertexArray,ft.x,ft.y,jt,$t,0,0,rn),Jy(this.layoutVertexArray,ft.x,ft.y,jt,$t,0,1,rn),V.vertexLength+=4,this.indexArray.emplaceBack(ye+0,ye+1,ye+2),this.indexArray.emplaceBack(ye+1,ye+3,ye+2),V.primitiveLength+=2,I){const Re=z+(1===mt?Z.length-2:mt-2),Me=1===mt?z:Re+1;if(this.indexArray.emplaceBack(ye+1,Re,ye+3),this.indexArray.emplaceBack(Re,Me,ye+3),V.primitiveLength+=2,void 0===Y&&(Y=ye),!Wb(Rt,Z[mt],N)){const ge=mt===Z.length-1?Y:V.vertexLength;this.indexArray.emplaceBack(ye+2,ye+3,ge),this.indexArray.emplaceBack(ye+3,ge+1,ge),this.indexArray.emplaceBack(ye+3,Me,ge+1),V.primitiveLength+=3}ht=!ht}if(v){const Re=this.layoutVertexExtArray,Me=y.projectTilePoint(ct.x,ct.y,l),ge=y.projectTilePoint(ft.x,ft.y,l),ue=y.upVector(l,ct.x,ct.y),Le=y.upVector(l,ft.x,ft.y);Vr(Re,Me,ue),Vr(Re,Me,ue),Vr(Re,ge,Le),Vr(Re,ge,Le)}}b&&(z+=Z.length-1),S&&I&&this.zoom>=17&&(0!==X.length&&F(X,X[0])&&X.pop(),this.groundEffect.addData(X,N,m,I>0))}this.footprintSegments.push(H),++C.footprintSegLen}if(C.vertexCount=this.layoutVertexArray.length-C.vertexArrayOffset,C.groundVertexCount=this.groundEffect.vertexArray.length-C.groundVertexArrayOffset,0!==C.vertexCount){if(C.centroidXY=E.borders?ES:this.encodeCentroid(E,C),this.centroidData.push(C),E.borders){this.featuresOnBorder.push(E);const L=this.featuresOnBorder.length-1;for(let N=0;N<E.borders.length;N++)E.borders[N][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[N].push(L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,c,d,l,p),this.groundEffect.addPaintPropertiesData(t,s,c,d,l,p),this.maxHeight=Math.max(this.maxHeight,M)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((r,s)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[s].borders[t][0])}encodeCentroid(t,r){const s=t.centroid(),l=r.span(),c=Math.min(7,Math.round(l.x*this.tileToMeter/10)),d=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new nt(Jt(s.x,1,dt-1)<<3|c,Jt(s.y,1,dt-1)<<3|d)}showCentroid(t){const r=this.centroidData[t.centroidDataIndex];r.flags&=Qa,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const r=t.vertexArrayOffset,s=t.vertexCount+t.vertexArrayOffset,l=t.flags&Qa?ES:t.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==l.y||c!==l.x){for(let d=r;d<s;++d)this.centroidVertexArray.emplace(d,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const s=r.getReplacementRegionsForTile(t.toUnwrapped());if(function(c,d){if(c.length!==d.length)return!1;for(let h=0;h<c.length;h++)if(c[h].sourceId!==d[h].sourceId||!Hb(c[h],d[h]))return!1;return!0}(this.activeReplacements,s))return;if(this.activeReplacements=s,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const c of this.centroidData)c.flags&=2147483647;const l=[];for(const c of this.activeReplacements){const d=Math.pow(2,c.footprintTileId.canonical.z-t.canonical.z);for(const h of this.centroidData)if(!(h.flags&Qa||c.min.x>h.max.x||h.min.x>c.max.x||c.min.y>h.max.y||h.min.y>c.max.y))for(let p=0;p<h.footprintSegLen;p++){const m=this.footprintSegments[h.footprintSegIdx+p];if(l.length=0,H2(this.footprintVertices,m.vertexOffset,m.vertexCount,c.footprintTileId.canonical,t.canonical,l),xS(c.footprint,l,this.footprintIndices.uint16,m.indexOffset,m.indexCount,-m.vertexOffset,-d)){h.flags|=Qa;break}}}for(const c of this.centroidData)this.writeCentroidToBuffer(c);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,r,s){let l=!1;for(let c=0;c<s.footprintSegLen;c++){const d=this.footprintSegments[s.footprintSegIdx+c];let h=0;for(const p of d.ringIndices){for(let m=h,_=p+h-1;m<p+h;_=m++){const y=this.footprintVertices.int16[2*(m+d.vertexOffset)+0],v=this.footprintVertices.int16[2*(m+d.vertexOffset)+1],b=this.footprintVertices.int16[2*(_+d.vertexOffset)+1];v>r!=b>r&&t<(this.footprintVertices.int16[2*(_+d.vertexOffset)+0]-y)*(r-v)/(b-v)+y&&(l=!l)}h=p}}return l}getHeightAtTileCoord(t,r){let s=Number.NEGATIVE_INFINITY,l=!0;const c=4*(t+dt)*dt+(r+dt);if(this.partLookup.hasOwnProperty(c)){const d=this.partLookup[c];return d?{height:d.height,hidden:!!(d.flags&Qa)}:void 0}for(const d of this.centroidData)t>d.max.x||d.min.x>t||r>d.max.y||d.min.y>r||this.footprintContainsPoint(t,r,d)&&d&&d.height>s&&(s=d.height,this.partLookup[c]=d,l=!!(d.flags&Qa));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:l};this.partLookup[c]=void 0}}function SS(n,t){const r=n.add(t)._unit();return n.x*r.x+n.y*r.y}function $2(n,t,r,s){const l=t.sub(n)._perp()._unit(),c=r.sub(t)._perp()._unit();return TS(n,t,r,SS(l,c),s)}function TS(n,t,r,s,l){const c=Math.sqrt(1-s*s);return Math.min(n.dist(t)/3,t.dist(r)/3,l*c/s)}function Wb(n,t,r){return n.x<r[0].x&&t.x<r[0].x||n.x>r[1].x&&t.x>r[1].x||n.y<r[0].y&&t.y<r[0].y||n.y>r[1].y&&t.y>r[1].y}function Qy(n,t){return n.x<t[0].x||n.x>t[1].x||n.y<t[0].y||n.y>t[1].y}function Sf(n,t,r){if(n.x<0||n.x>=dt||t.x<0||t.x>=dt||r.x<0||r.x>=dt)return!1;const s=r.sub(t),l=s.perp(),c=n.sub(t);return(s.x*c.x+s.y*c.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(c.x*c.x+c.y*c.y))>-.866&&l.x*c.x+l.y*c.y<0}function DS(n,t,r){const s=t?2|n:-3&n;return r?1|s:-2&s}function Zb(){const n=Math.PI/32,t=Math.tan(n),r=vd;return r*Math.sqrt(1+2*t*t)-r}function IS(n,t,r){const s=1<<r.z,l=Ms(r.x/s),c=Ms((r.x+1)/s),d=lr(r.y/s),h=lr((r.y+1)/s);return function(p,m,_,y,v=0,b){const E=[];if(!p.length||!_||!y)return E;const C=(O,F)=>{for(const L of O)E.push({polygon:L,bounds:F})},S=Math.ceil(Math.log2(_)),M=Math.ceil(Math.log2(y)),D=S-M,R=[];for(let O=0;O<Math.abs(D);O++)R.push(D>0?0:1);for(let O=0;O<Math.min(S,M);O++)R.push(0),R.push(1);let P=p;if(P=py(P,m[0].y-v,m[1].y+v,1),P=py(P,m[0].x-v,m[1].x+v,0),!P.length)return E;const I=[];for(R.length?I.push({polygons:P,bounds:m,depth:0}):C(P,m);I.length;){const O=I.pop(),F=O.depth,L=R[F],N=O.bounds[0],z=O.bounds[1],U=0===L?N.x:N.y,V=0===L?z.x:z.y,H=b?b(L,U,V):.5*(U+V),j=py(O.polygons,U-v,H+v,L),Z=py(O.polygons,H-v,V+v,L);if(j.length){const tt=[N,new nt(0===L?H:z.x,1===L?H:z.y)];R.length>F+1?I.push({polygons:j,bounds:tt,depth:F+1}):C(j,tt)}if(Z.length){const tt=[new nt(0===L?H:N.x,1===L?H:N.y),z];R.length>F+1?I.push({polygons:Z,bounds:tt,depth:F+1}):C(Z,tt)}}return E}(n,t,Math.ceil((c-l)/11.25),Math.ceil((d-h)/11.25),1,(p,m,_)=>{if(0===p)return.5*(m+_);{const y=lr((r.y+m/dt)/s);return(po(.5*(lr((r.y+_/dt)/s)+y))*s-r.y)*dt}})}function H2(n,t,r,s,l,c){const d=Math.pow(2,s.z-l.z);for(let h=0;h<r;h++){let p=n.int16[2*(h+t)+0],m=n.int16[2*(h+t)+1];p=(p+l.x*dt)*d-s.x*dt,m=(m+l.y*dt)*d-s.y*dt,c.push(new nt(p,m))}}Xt(Mf,"FillExtrusionBucket",{omit:["layers","features"]}),Xt(CS,"PartData"),Xt(tl,"FootprintSegment"),Xt(MS,"BorderCentroidData"),Xt(qb,"GroundEffect");const AS=new Ei({visibility:new Dt(J["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Dt(J["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var RS={paint:new Ei({"fill-extrusion-opacity":new Dt(J["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new se(J["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dt(J["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dt(J["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new se(J["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new se(J["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new se(J["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Dt(J["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Dt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Dt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new se(J["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new se(J["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Dt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Dt(J["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Dt(J["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Dt(J["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:AS};class zc extends nt{constructor(t,r,s){super(t,r),this.z=s}}function Hm(n,t){return n.x*t.x+n.y*t.y}function Xb(n,t){if(1===n.length){let r=0;const s=t[r++];let l;for(;!l||s.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const c=t[r],d=n[0],h=l.sub(s),p=c.sub(s),m=d.sub(s),_=Hm(h,h),y=Hm(h,p),v=Hm(p,p),b=Hm(m,h),E=Hm(m,p),C=_*v-y*y,S=(v*b-y*E)/C,M=(_*E-y*b)/C,D=s.z*(1-S-M)+l.z*S+c.z*M;if(isFinite(D))return D}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}function rl(n,t,r,s,l,c,d,h){const p=d*l.getElevationAt(n,t,!0,!0),m=0!==c[0],_=m?0===c[1]?d*(c[0]/7-450):d*function(y,v,b){const E=Math.floor(v[0]/8),C=Math.floor(v[1]/8),S=10*(v[0]-8*E),M=10*(v[1]-8*C),D=y.getElevationAt(E,C,!0,!0),R=y.getMeterToDEM(b),P=Math.floor(.5*(S*R-1)),I=Math.floor(.5*(M*R-1)),O=y.tileCoordToPixel(E,C),F=2*P+1,L=2*I+1,N=(X=F,Y=L,[(Z=y).getElevationAtPixel(tt=O.x-P,it=O.y-I,!0),Z.getElevationAtPixel(tt+Y,it,!0),Z.getElevationAtPixel(tt,it+Y,!0),Z.getElevationAtPixel(tt+X,it+Y,!0)]),z=Math.abs(N[0]-N[1]),U=Math.abs(N[2]-N[3]),V=Math.abs(N[0]-N[2])+Math.abs(N[1]-N[3]),H=Math.min(.25,.5*R*(z+U)/F),j=Math.min(.25,.5*R*V/L);var Z,tt,it,X,Y;return D+Math.max(H*S,j*M)}(l,c,h):p;return{base:p+(0===r)?-1:r,top:m?Math.max(_+s,p+r+2):p+s}}const PS=new Ei({"line-cap":new se(J.layout_line["line-cap"]),"line-join":new se(J.layout_line["line-join"]),"line-miter-limit":new Dt(J.layout_line["line-miter-limit"]),"line-round-limit":new Dt(J.layout_line["line-round-limit"]),"line-sort-key":new se(J.layout_line["line-sort-key"]),visibility:new Dt(J.layout_line.visibility)});var OS={paint:new Ei({"line-opacity":new se(J.paint_line["line-opacity"]),"line-color":new se(J.paint_line["line-color"]),"line-translate":new Dt(J.paint_line["line-translate"]),"line-translate-anchor":new Dt(J.paint_line["line-translate-anchor"]),"line-width":new se(J.paint_line["line-width"]),"line-gap-width":new se(J.paint_line["line-gap-width"]),"line-offset":new se(J.paint_line["line-offset"]),"line-blur":new se(J.paint_line["line-blur"]),"line-dasharray":new se(J.paint_line["line-dasharray"]),"line-pattern":new se(J.paint_line["line-pattern"]),"line-gradient":new Ap(J.paint_line["line-gradient"]),"line-trim-offset":new Dt(J.paint_line["line-trim-offset"]),"line-emissive-strength":new Dt(J.paint_line["line-emissive-strength"]),"line-border-width":new se(J.paint_line["line-border-width"]),"line-border-color":new se(J.paint_line["line-border-color"])}),layout:PS};const G2=(n,t,r,s,l,c,d)=>{const h=n.transform,p=h.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Yb(n,t,r,s),u_pixels_to_tile_units:p,u_device_pixel_ratio:c,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:Jb(r)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:qm(t,n.transform),u_alpha_discard_threshold:0,u_trim_offset:d,u_emissive_strength:r.paint.get("line-emissive-strength")}},Gm=(n,t,r,s,l)=>{const c=n.transform;return{u_matrix:Yb(n,t,r,s),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:c.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:qm(t,c),u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function qm(n,t){return 1/Id(n,1,t.tileZoom)}function Yb(n,t,r,s){return n.translatePosMatrix(s||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Kb=n=>{const t=[];Jb(n)&&t.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=n.paint.get("line-trim-offset");return 0===r[0]&&0===r[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==n.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function Jb(n){const t=n.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Qb=new class extends se{possiblyEvaluate(n,t){return t=new wi(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(n,t)}evaluate(n,t,r,s){return t=Yt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(n,t,r,s)}}(OS.paint.properties["line-width"].specification);function t1(n,t){return t>0?t+2*n:n}Qb.useIntegerZoom=!0;const kS=new Ei({visibility:new Dt(J.layout_background.visibility)});var FS={paint:new Ei({"background-color":new Dt(J.paint_background["background-color"]),"background-pattern":new Dt(J.paint_background["background-pattern"]),"background-opacity":new Dt(J.paint_background["background-opacity"]),"background-emissive-strength":new Dt(J.paint_background["background-emissive-strength"])}),layout:kS};const LS=new Ei({visibility:new Dt(J.layout_raster.visibility)});var NS={paint:new Ei({"raster-opacity":new Dt(J.paint_raster["raster-opacity"]),"raster-color":new Ap(J.paint_raster["raster-color"]),"raster-color-mix":new Dt(J.paint_raster["raster-color-mix"]),"raster-color-range":new Dt(J.paint_raster["raster-color-range"]),"raster-hue-rotate":new Dt(J.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dt(J.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dt(J.paint_raster["raster-brightness-max"]),"raster-saturation":new Dt(J.paint_raster["raster-saturation"]),"raster-contrast":new Dt(J.paint_raster["raster-contrast"]),"raster-resampling":new Dt(J.paint_raster["raster-resampling"]),"raster-fade-duration":new Dt(J.paint_raster["raster-fade-duration"])}),layout:LS};function zS(n,t,r,s,l,c,d,h){const p=[n,r,l,t,s,c,1,1,1],m=[d,h,1],_=Zo.adjoint([],p),[y,v,b]=q.transformMat3(m,m,Zo.transpose(_,_));return Zo.multiply(p,[y,0,0,0,v,0,0,0,b],p)}class Gl extends $i{constructor(t,r,s,l){super(),this.id=t,this.dispatcher=s,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=r,this._dirty=!1}load(t,r){if(this._loaded=r||!1,this.fire(new St("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Oe(this.map._requestManager.transformRequest(this.url,gt.Image),(s,l)=>{if(this._imageRequest=null,this._loaded=!0,s)this.fire(new at(s));else if(l){const{HTMLImageElement:c}=st;this.image=l instanceof c?kt.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new By(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof By||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=t[0][1],s=t[0][1];for(const c of t)c[1]>s&&(s=c[1]),c[1]<r&&(r=c[1]);const l=(s+r)/2;if(l>Hi?this.onNorthPole=!0:l<-Hi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=t.map(Ke.fromLngLat);this.tileID=function(d){let h=1/0,p=1/0,m=-1/0,_=-1/0;for(const E of d)h=Math.min(h,E.x),p=Math.min(p,E.y),m=Math.max(m,E.x),_=Math.max(_,E.y);const y=Math.max(m-h,_-p),v=Math.max(0,Math.floor(-Math.log(y)/Math.LN2)),b=Math.pow(2,v);return new ma(v,Math.floor((h+m)/2*b),Math.floor((p+_)/2*b))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new St("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const p in this.tiles){const m=this.tiles[p];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}if(this._boundsArray)return;const r=Mu(this.tileID,this.map.transform.projection),[s,l,c,d]=this.coordinates.map(p=>{const m=r.projection.project(p[0],p[1]);return $l(r,m)._round()});this.perspectiveTransform=function(p,m,_,y,v,b,E,C,S,M){const D=zS(0,0,p,0,0,m,p,m),R=zS(_,y,v,b,E,C,S,M);return Zo.multiply(R,Zo.adjoint(D,D),R),[R[6]/R[8]*p/dt,R[7]/R[8]*m/dt]}(this.width,this.height,s.x,s.y,l.x,l.y,d.x,d.y,c.x,c.y);const h=this._boundsArray=new ad;h.emplaceBack(s.x,s.y,0,0),h.emplaceBack(l.x,l.y,dt,0),h.emplaceBack(d.x,d.y,0,dt),h.emplaceBack(c.x,c.y,dt,dt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(h,Am.members),this.boundsSegments=Bn.simpleSegment(0,0,4,2)}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const r=this.map.painter.context,s=r.gl;!this._dirty||this.texture instanceof By||(this.texture?this.texture.update(this.image):(this.texture=new ir(r,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(r)}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class q2 extends Gs{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const W2=new Ei({visibility:new Dt(J.layout_sky.visibility)});var Z2={paint:new Ei({"sky-type":new Dt(J.paint_sky["sky-type"]),"sky-atmosphere-sun":new Dt(J.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Dt(J.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Dt(J.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Dt(J.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ap(J.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Dt(J.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Dt(J.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Dt(J.paint_sky["sky-opacity"])}),layout:W2};function e1(n,t,r){const s=[0,0,1],l=Qr.identity([]);return Qr.rotateY(l,l,r?-Ie(n)+Math.PI:Ie(n)),Qr.rotateX(l,l,-Ie(t)),q.transformQuat(s,s,l),q.normalize(s,s)}var X2={paint:new Ei({})};const Y2={circle:class extends Gs{constructor(n,t){super(n,oy,t)}createBucket(n){return new QC(n)}queryRadius(n){const t=n;return wd("circle-radius",this,t)+wd("circle-stroke-width",this,t)+nm(this.paint.get("circle-translate"))}queryIntersectsFeature(n,t,r,s,l,c,d,h){const p=eM(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,n.pixelToTileUnitsFactor),m=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Ss(n,s,c,d,h,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),p,m)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,t){const r=im(this);return{config:new Ah(this,t),defines:r,overrideFog:!1}}},heatmap:class extends Gs{createBucket(n){return new Gx(n)}constructor(n,t){super(n,iM,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qa({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return wd("heatmap-radius",this,n)}queryIntersectsFeature(n,t,r,s,l,c,d,h){const p=this.paint.get("heatmap-radius").evaluate(t,r);return Ss(n,s,c,d,h,!0,!0,new nt(0,0),p)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,t){return"heatmap"===n?{config:new Ah(this,t),overrideFog:!1}:{}}},hillshade:class extends Gs{constructor(n,t){super(n,yu,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,t){return{overrideFog:!1}}},fill:class extends Gs{constructor(n,t){super(n,HA,t)}getProgramIds(){const n=this.paint.get("fill-pattern"),t=n&&n.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(n,t){return{config:new Ah(this,t),overrideFog:!1}}recalculate(n,t){super.recalculate(n,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Kh(n)}queryRadius(){return nm(this.paint.get("fill-translate"))}queryIntersectsFeature(n,t,r,s,l,c){return!n.queryGeometry.isAboveHorizon&&Nx(_u(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Gs{constructor(n,t){super(n,RS,t)}createBucket(n){return new Mf(n)}queryRadius(){return nm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,t,r,s,l,c,d,h,p){const m=eM(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,n.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(t,r),y=this.paint.get("fill-extrusion-base").evaluate(t,r),v=[0,0],b=h&&c.elevation,E=c.elevation?c.elevation.exaggeration():1,C=n.tile.getBucket(this);if(b&&C instanceof Mf){const P=C.centroidVertexArray,I=p+1;I<P.length&&(v[0]=P.geta_centroid_pos0(I),v[1]=P.geta_centroid_pos1(I))}if(0===v[0]&&1===v[1])return!1;"globe"===c.projection.name&&(s=IS([s],[new nt(0,0),new nt(dt,dt)],n.tileID.canonical).map(P=>P.polygon).flat());const S=b?h:null,[M,D]=(I=s,O=y,F=_,L=m,N=d,z=S,U=v,V=E,H=c.center.lat,"globe"===(P=c).projection.name?function(Z,tt,it,X,Y,ot,lt,ht,mt,yt,ct){const ft=[],Rt=[],Vt=Z.projection.upVectorScale(ct,Z.center.lat,Z.worldSize).metersToTile,jt=[0,0,0,1],$t=[0,0,0,1],re=(je,rn,Re,Me)=>{je[0]=rn,je[1]=Re,je[2]=Me,je[3]=1},ye=Zb();it>0&&(it+=ye),X+=ye;for(const je of tt){const rn=[],Re=[];for(const Me of je){const ge=Me.x+Y.x,ue=Me.y+Y.y,Le=Z.projection.projectTilePoint(ge,ue,ct),an=Z.projection.upVector(ct,Me.x,Me.y);let Be=it,Zn=X;if(lt){const Si=rl(ge,ue,it,X,lt,ht,mt,yt);Be+=Si.base,Zn+=Si.top}0!==it?re(jt,Le.x+an[0]*Vt*Be,Le.y+an[1]*Vt*Be,Le.z+an[2]*Vt*Be):re(jt,Le.x,Le.y,Le.z),re($t,Le.x+an[0]*Vt*Zn,Le.y+an[1]*Vt*Zn,Le.z+an[2]*Vt*Zn),q.transformMat4(jt,jt,ot),q.transformMat4($t,$t,ot),rn.push(new zc(jt[0],jt[1],jt[2])),Re.push(new zc($t[0],$t[1],$t[2]))}ft.push(rn),Rt.push(Re)}return[ft,Rt]}(P,I,O,F,L,N,z,U,V,H,n.tileID.canonical):z?function(Z,tt,it,X,Y,ot,lt,ht,mt){const yt=[],ct=[],ft=[0,0,0,1];for(const Rt of Z){const Vt=[],jt=[];for(const $t of Rt){const re=$t.x+X.x,ye=$t.y+X.y,je=rl(re,ye,tt,it,ot,lt,ht,mt);ft[0]=re,ft[1]=ye,ft[2]=je.base,ft[3]=1,Fn.transformMat4(ft,ft,Y),ft[3]=Math.max(ft[3],1e-5);const rn=new zc(ft[0]/ft[3],ft[1]/ft[3],ft[2]/ft[3]);ft[0]=re,ft[1]=ye,ft[2]=je.top,ft[3]=1,Fn.transformMat4(ft,ft,Y),ft[3]=Math.max(ft[3],1e-5);const Re=new zc(ft[0]/ft[3],ft[1]/ft[3],ft[2]/ft[3]);Vt.push(rn),jt.push(Re)}yt.push(Vt),ct.push(jt)}return[yt,ct]}(I,O,F,L,N,z,U,V,H):function(Z,tt,it,X,Y){const ot=[],lt=[],ht=Y[8]*tt,mt=Y[9]*tt,yt=Y[10]*tt,ct=Y[11]*tt,ft=Y[8]*it,Rt=Y[9]*it,Vt=Y[10]*it,jt=Y[11]*it;for(const $t of Z){const re=[],ye=[];for(const je of $t){const rn=je.x+X.x,Re=je.y+X.y,Me=Y[0]*rn+Y[4]*Re+Y[12],ge=Y[1]*rn+Y[5]*Re+Y[13],ue=Y[2]*rn+Y[6]*Re+Y[14],Le=Y[3]*rn+Y[7]*Re+Y[15],an=Me+ht,Be=ge+mt,Zn=ue+yt,Si=Math.max(Le+ct,1e-5),ui=Me+ft,ei=ge+Rt,cr=ue+Vt,_i=Math.max(Le+jt,1e-5);re.push(new zc(an/Si,Be/Si,Zn/Si)),ye.push(new zc(ui/_i,ei/_i,cr/_i))}ot.push(re),lt.push(ye)}return[ot,lt]}(I,O,F,L,N)),R=n.queryGeometry;var P,I,O,F,L,N,z,U,V,H;return function(P,I,O){let F=1/0;Nx(O,I)&&(F=Xb(O,I[0]));for(let L=0;L<I.length;L++){const N=I[L],z=P[L];for(let U=0;U<N.length-1;U++){const V=N[U],H=[V,N[U+1],z[U+1],z[U],V];Gh(O,H)&&(F=Math.min(F,Xb(O,H)))}}return F!==1/0&&F}(M,D,R.isPointQuery()?R.screenBounds:R.screenGeometry)}},line:class extends Gs{constructor(n,t){super(n,OS,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof u_,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,t){super.recalculate(n,t),this.paint._values["line-floorwidth"]=Qb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Im(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,t){const r=Kb(this);return{config:new Ah(this,t),defines:r,overrideFog:!1}}queryRadius(n){const t=n,r=t1(wd("line-width",this,t),wd("line-gap-width",this,t)),s=wd("line-offset",this,t);return r/2+Math.abs(s)+nm(this.paint.get("line-translate"))}queryIntersectsFeature(n,t,r,s,l,c){if(n.queryGeometry.isAboveHorizon)return!1;const d=_u(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,n.pixelToTileUnitsFactor),h=n.pixelToTileUnitsFactor/2*t1(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),p=this.paint.get("line-offset").evaluate(t,r);return p&&(s=function(m,_){const y=[],v=new nt(0,0);for(let b=0;b<m.length;b++){const E=m[b],C=[];for(let S=0;S<E.length;S++){const M=E[S],D=E[S+1],R=0===S?v:M.sub(E[S-1])._unit()._perp(),P=S===E.length-1?v:D.sub(M)._unit()._perp(),I=R._add(P)._unit();I._mult(1/(I.x*P.x+I.y*P.y)),C.push(I._mult(_)._add(M))}y.push(C)}return y}(s,p*n.pixelToTileUnitsFactor)),function(m,_,y){for(let v=0;v<_.length;v++){const b=_[v];if(m.length>=3)for(let E=0;E<b.length;E++)if(Ga(m,b[E]))return!0;if(tM(m,b,y))return!0}return!1}(d,s,h)}isTileClipped(){return!0}},symbol:ky,background:class extends Gs{constructor(n,t){super(n,FS,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,t){return{overrideFog:!1}}},raster:class extends Gs{constructor(n,t){super(n,NS,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(n){return!(n&&n._source instanceof Gl&&(n._source.onNorthPole||n._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(n){"raster-color"!==n&&"raster-color-range"!==n||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-color"].value.expression,[t,r]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=qa({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:r}],resolution:256}),this.colorRampTexture=null}},sky:class extends Gs{constructor(n,t){super(n,Z2,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qa({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(n,t){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),l=!s,c=n.style.light,d=c.properties.get("position");return l&&"viewport"===c.properties.get("anchor")&&Q("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?e1(d.azimuthal,90-d.polar,t):e1(s[0],90-s[1],t)}const r=this.paint.get("sky-gradient-center");return e1(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}},slot:class extends Gs{constructor(n,t){super(n,X2)}},model:class extends Gs{constructor(n,t){super(n,$b,t)}createBucket(n){return new pS(n)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(n,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||"model-color"!==n&&"model-color-mix-intensity"!==n&&"model-rotation"!==n&&"model-scale"!==n&&"model-translation"!==n&&"model-emissive-strength"!==n)}_isPropertyZoomDependent(n){const t=this._transitionablePaint._values[n];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof gc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function tv(n,t){return"custom"===n.type?new q2(n):new Y2[n.type](n,t)}function K2(n){const{userImage:t}=n;return!!(t&&t.render&&t.render())&&(n.data.replace(new Uint8Array(t.data.buffer)),!0)}class J2 extends $i{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new Pi({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,r){if(this.loaded[r]!==t&&(this.loaded[r]=t,t)){for(const{ids:s,callback:l}of this.requestors)this._notify(s,r,l);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images[r][t]}addImage(t,r,s){this._validate(t,s)&&(this.images[r][t]=s)}_validate(t,r){let s=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new at(new Error(`Image "${t}" has invalid "stretchX" value`))),s=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new at(new Error(`Image "${t}" has invalid "stretchY" value`))),s=!1),this._validateContent(r.content,r)||(this.fire(new at(new Error(`Image "${t}" has invalid "content" value`))),s=!1),s}_validateStretch(t,r){if(!t)return!0;let s=0;for(const l of t){if(l[0]<s||l[1]<l[0]||r<l[1])return!1;s=l[1]}return!0}_validateContent(t,r){return!(t&&(4!==t.length||t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,r,s){s.version=this.images[r][t].version+1,this.images[r][t]=s,this.updatedImages[r][t]=!0}removeImage(t,r){const s=this.images[r][t];delete this.images[r][t],delete this.patterns[r][t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,r,s){let l=!0;const c=!!this.loaded[r];if(!c)for(const d of t)this.images[r][d]||(l=!1);c||l?this._notify(t,r,s):this.requestors.push({ids:t,scope:r,callback:s})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,r,s){const l={};for(const c of t){this.images[r][c]||this.fire(new St("styleimagemissing",{id:c}));const d=this.images[r][c];d?l[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!(!d.userImage||!d.userImage.render)}:Q(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,l)}getPixelSize(t){const{width:r,height:s}=this.atlasImage[t];return{width:r,height:s}}getPattern(t,r){const s=this.patterns[r][t],l=this.getImage(t,r);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const c={w:l.data.width+2,h:l.data.height+2,x:0,y:0},d=new by(c,l);this.patterns[r][t]={bin:c,position:d}}return this._updatePatternAtlas(r),this.patterns[r][t].position}bind(t,r){const s=t.gl;let l=this.atlasTexture[r];l?this.dirty&&(l.update(this.atlasImage[r]),this.dirty=!1):(l=new ir(t,this.atlasImage[r],s.RGBA),this.atlasTexture[r]=l),l.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const r=[];for(const d in this.patterns[t])r.push(this.patterns[t][d].bin);const{w:s,h:l}=on(r),c=this.atlasImage[t];c.resize({width:s||1,height:l||1});for(const d in this.patterns[t]){const{bin:h}=this.patterns[t][d],p=h.x+1,m=h.y+1,_=this.images[t][d].data,y=_.width,v=_.height;Pi.copy(_,c,{x:0,y:0},{x:p,y:m},{width:y,height:v}),Pi.copy(_,c,{x:0,y:v-1},{x:p,y:m-1},{width:y,height:1}),Pi.copy(_,c,{x:0,y:0},{x:p,y:m+v},{width:y,height:1}),Pi.copy(_,c,{x:y-1,y:0},{x:p-1,y:m},{width:1,height:v}),Pi.copy(_,c,{x:0,y:0},{x:p+y,y:m},{width:1,height:v})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,r){for(const s of t){if(this.callbackDispatchedThisFrame[r][s])continue;this.callbackDispatchedThisFrame[r][s]=!0;const l=this.images[r][s];K2(l)&&this.updateImage(s,r,l)}}}const Q2=new Ei({anchor:new Dt(J.light.anchor),position:new class{constructor(n){this.specification=n}possiblyEvaluate(n,t){return qt(n.expression.evaluate(t))}interpolate(n,t,r){return{x:_e(n.x,t.x,r),y:_e(n.y,t.y,r),z:_e(n.z,t.z,r),azimuthal:_e(n.azimuthal,t.azimuthal,r),polar:_e(n.polar,t.polar,r)}}}(J.light.position),color:new Dt(J.light.color),intensity:new Dt(J.light.intensity)});class BS extends $i{constructor(t,r="flat"){super(),this._transitionable=new Yr(Q2),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,s={}){this._validate(GE,t,s)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,s){return(!s||!1!==s.validate)&&x_(this,t.call(os,Yt({value:r,style:{glyphs:!0,sprite:!0},styleSpec:J})))}}const tR=new Ei({source:new Dt(J.terrain.source),exaggeration:new Dt(J.terrain.exaggeration)});let eR=class extends $i{constructor(n,t){super(),this._transitionable=new Yr(tR),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}setScope(n){this.scope=n}get(){return this._transitionable.serialize()}set(n){this._transitionable.setTransitionOrValue(n)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}getExaggeration(n){return this._transitioning.possiblyEvaluate(new wi(n)).get("exaggeration")}isZoomDependent(){const n=this._transitionable._values.exaggeration;return null!=n&&null!=n.value&&null!=n.value.expression&&n.value.expression instanceof gc}};const VS=45,jS=65,Iu=.05;function Wm(n,t,r,s){const l=xl(VS,jS,r),[c,d]=n1(n,s);let h=1-Math.min(1,Math.exp((t-c)/(d-c)*-6));return h*=h*h,h=Math.min(1,1.00747*h),h*l*n.alpha}function n1(n,t){const r=.5/Math.tan(.5*t);return[n.range[0]+r,n.range[1]+r]}function r1(n,t,r,s,l){const c=q.transformMat4([],[t,r,s],l.mercatorFogMatrix);return Wm(n,q.length(c),l.pitch,l._fov)}function o1(n,t,r,s,l,c,d){const h=[[r,s,0],[l,s,0],[l,c,0],[r,c,0]];let p=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(const _ of h){const y=q.transformMat4([],_,t),v=q.length(y);p=Math.min(p,v),m=Math.max(m,v)}return[Wm(n,p,d.pitch,d._fov),Wm(n,m,d.pitch,d._fov)]}const US=new Ei({range:new Dt(J.fog.range),color:new Dt(J.fog.color),"high-color":new Dt(J.fog["high-color"]),"space-color":new Dt(J.fog["space-color"]),"horizon-blend":new Dt(J.fog["horizon-blend"]),"star-intensity":new Dt(J.fog["star-intensity"]),"vertical-range":new Dt(J.fog["vertical-range"])});class $S extends $i{constructor(t,r){super(),this._transitionable=new Yr(US),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=r}get state(){const t=this._transform,r="globe"===t.projection.name,s=Br(t.zoom),l=this.properties.get("range"),c=[.5,3];return{range:r?[_e(c[0],l[0],s),_e(c[1],l[1],s)]:l,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r={}){if(this._validate(v_,t,r))return;const s=Yt({},t);for(const l of Object.keys(J.fog))void 0===s[l]&&(s[l]=J.fog[l].default);this._transitionable.setTransitionOrValue(s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:xl(VS,jS,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(s,l,c){const d=Ke.fromLngLat(l),h=c.elevation?c.elevation.getAtPointOrZero(d):0;return r1(s,d.x,d.y,h,c)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return o1(this.state,r,0,0,dt,dt,this._transform)}getOpacityForBounds(t,r,s,l,c){return this._transform.projection.supportsFog?o1(this.state,t,r,s,l,c,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?n1(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const s of r){const l=t.points[s];let c;if(l[2]>=0)c=l;else{const d=t.points[s-4];c=bE(d,l,d[2]/(d[2]-l[2]))}if(r1(this.state,c[0],c[1],0,this._transform)>=Iu)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,s){return(!s||!1!==s.validate)&&x_(this,t.call(os,Yt({value:r,style:{glyphs:!0,sprite:!0},styleSpec:J})))}}class HS{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class GS{constructor(){this.tasks={},this.taskQueue=[],Ir(["process"],this),this.invoker=new HS(this.process),this.nextId=0}add(t,r){const s=this.nextId++,l=function({type:c,isSymbolTile:d,zoom:h}){return h=h||0,"message"===c?0:"maybePrepare"!==c||d?"parseTile"!==c||d?"parseTile"===c&&d?300-h:"maybePrepare"===c&&d?400-h:500:200-h:100-h}(r);if(0===l){Ct();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:t,metadata:r,priority:l,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Ct();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const c=this.tasks[this.taskQueue[l]];c.priority<r&&(r=c.priority,t=l)}if(null===t)return null;const s=this.taskQueue[t];return this.taskQueue.splice(t,1),s}remove(){this.invoker.remove()}}class Zm{constructor(t,r,s){this.target=t,this.parent=r,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Ir(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new GS}send(t,r,s,l,c=!1,d){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=d,this.callbacks[h]=s);const p=new Set;return this.target.postMessage({id:h,type:t,hasCallback:!!s,targetMapId:l,mustQueue:c,sourceMapId:this.mapId,data:qe(r,p)},p),{cancel:()=>{s&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(t){const r=t.data,s=r.id;if(s&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(r.mustQueue||Ct()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,r),l&&l.metadata||{type:"message"})}else this.processTask(s,r)}processTask(t,r){if("<response>"===r.type){const s=this.callbacks[t];delete this.callbacks[t],s&&(r.error?s(rd(r.error)):s(null,rd(r.data)))}else{const s=new Set,l=r.hasCallback?(d,h)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:d?qe(d):null,data:qe(h,s)},s)}:d=>{},c=rd(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,c,l);else if(this.parent.getWorkerSource){const d=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,d[0],c.source,c.scope)[d[1]](c,l)}else l(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Xm=(()=>{class n{constructor(r,s){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Ti();const l=this.workerPool.acquire(this.id);for(let c=0;c<l.length;c++){const d=new n.Actor(l[c],s,this.id);d.name=`Worker ${c}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,l){Zu(this.actors,(c,d)=>{c.send(r,s,d)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}return n.Actor=Zm,n})();class Au extends $i{constructor(t,r,s,l){super(),this.scope=s,this._options=t,this.properties=new Ip(r),this._transitionable=new Yr(r,new Map(l)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const nR=new Ei({color:new Dt(J.properties_light_ambient.color),intensity:new Dt(J.properties_light_ambient.intensity)}),iR=new Ei({direction:new class{constructor(n){this.specification=n}possiblyEvaluate(n,t){return function([r,s]){const l=qt([1,r,s]);return{x:l.x,y:l.y,z:l.z}}(n.expression.evaluate(t))}interpolate(n,t,r){return{x:_e(n.x,t.x,r),y:_e(n.y,t.y,r),z:_e(n.z,t.z,r)}}}(J.properties_light_directional.direction),color:new Dt(J.properties_light_directional.color),intensity:new Dt(J.properties_light_directional.intensity),"cast-shadows":new Dt(J.properties_light_directional["cast-shadows"]),"shadow-intensity":new Dt(J.properties_light_directional["shadow-intensity"])});class Ru{constructor(t,r,s,l){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=s,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,l)}static createFromScreenPoints(t,r){let s,l;if(t instanceof nt||"number"==typeof t[0]){const c=nt.convert(t);s=[c],l=r.isPointAboveHorizon(c)}else{const c=nt.convert(t[0]),d=nt.convert(t[1]);s=[c,d],l=Wu(c,d).every(h=>r.isPointAboveHorizon(h))}return new Ru(s,r.getCameraPoint(),l,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return Wu(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],s=1===this.screenBounds.length?this.screenBounds[0].add(new nt(1,1)):this.screenBounds[1],l=Wu(r,s,0,!1);return this.cameraPoint.y>s.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<s.x?l.splice(3,0,this.cameraPoint):this.cameraPoint.x>=s.x?l[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(l[3]=this.cameraPoint)),function(c,d){const h=[];for(let p=0;p<c.length;p++){const m=bl(p-1,-1,c.length-1),_=bl(p+1,-1,c.length-1),y=c[p],v=c[_],b=c[m].sub(y).unit(),E=v.sub(y).unit(),C=E.angleWithSep(b.x,b.y),S=b.add(E).unit().mult(-1*d/Math.sin(C/2));h.push(y.add(S))}return h}(l,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],s=1===this.screenBounds.length?this.screenBounds[0].add(new nt(1,1)):this.screenBounds[1],l=Wu(r,s,t),c=this.cameraPoint.clone();switch(3*((c.y>r.y)+(c.y>s.y))+((c.x>r.x)+(c.x>s.x))){case 0:l[0]=c,l[4]=c.clone();break;case 1:l.splice(1,0,c);break;case 2:l[1]=c;break;case 3:l.splice(4,0,c);break;case 5:l.splice(2,0,c);break;case 6:l[3]=c;break;case 7:l.splice(3,0,c);break;case 8:l[2]=c}return l}containsTile(t,r,s,l=0){const c=t.queryPadding/r._pixelsPerMercatorPixel+1,d=s?this._bufferedCameraMercator(c,r):this._bufferedScreenMercator(c,r);let h=t.tileID.wrap+(d.unwrapped?l:0);const p=d.polygon.map(S=>$l(t.tileTransform,S,h));if(!zA(p,0,0,dt,dt))return;h=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?l:0);const m=this.screenGeometryMercator.polygon.map(S=>NM(t.tileTransform,S,h)),_=m.map(S=>new nt(S[0],S[1])),y=r.getFreeCameraOptions().position||new Ke(0,0,0),v=NM(t.tileTransform,y,h),b=m.map(S=>{const M=q.sub(S,S,v);return q.normalize(M,M),new Bh(v,M)}),E=Id(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:_,tilespaceRays:b,bufferedTilespaceGeometry:p,bufferedTilespaceBounds:(C=vl(p),C.min.x=Jt(C.min.x,0,dt),C.min.y=Jt(C.min.y,0,dt),C.max.x=Jt(C.max.x,0,dt),C.max.y=Jt(C.max.y,0,dt),C),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:E};var C}_bufferedScreenMercator(t,r){const s=rR(t);if(this._screenRaycastCache[s])return this._screenRaycastCache[s];{let l;return l="globe"===r.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(c=>r.pointCoordinate3D(c)),unwrapped:!0},this._screenRaycastCache[s]=l,l}}_bufferedCameraMercator(t,r){const s=rR(t);if(this._cameraRaycastCache[s])return this._cameraRaycastCache[s];{let l;return l="globe"===r.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(c=>r.pointCoordinate3D(c)),unwrapped:!0},this._cameraRaycastCache[s]=l,l}}_projectAndResample(t,r){const s=function(c,d){const h=rt.multiply([],d.pixelMatrix,d.globeMatrix),p=[0,-Ro,0,1],m=[0,Ro,0,1],_=[0,0,0,1];Fn.transformMat4(p,p,h),Fn.transformMat4(m,m,h),Fn.transformMat4(_,_,h);const y=new nt(p[0]/p[3],p[1]/p[3]),v=new nt(m[0]/m[3],m[1]/m[3]),b=Ga(c,y)&&p[3]<_[3],E=Ga(c,v)&&m[3]<_[3];if(!b&&!E)return null;const C=function(F,L,N){for(let z=1;z<F.length;z++){const U=so(L.pointCoordinate3D(F[z-1]).x),V=so(L.pointCoordinate3D(F[z]).x);if(N<0){if(U<V)return{idx:z,t:-U/(V-1-U)}}else if(V<U)return{idx:z,t:(1-U)/(V+1-U)}}return null}(c,d,b?-1:1);if(!C)return null;const{idx:S,t:M}=C;let D=S>1?qS(c.slice(0,S),d):[],R=S<c.length?qS(c.slice(S),d):[];D=D.map(F=>new nt(so(F.x),F.y)),R=R.map(F=>new nt(so(F.x),F.y));const P=[...D];0===P.length&&P.push(R[R.length-1]);const I=_e(P[P.length-1].y,(0===R.length?D[0]:R[0]).y,M);let O;return O=b?[new nt(0,I),new nt(0,0),new nt(1,0),new nt(1,I)]:[new nt(1,I),new nt(1,1),new nt(0,1),new nt(0,I)],P.push(...O),0===R.length?P.push(D[0]):P.push(...R),{polygon:P.map(F=>new Ke(F.x,F.y)),unwrapped:!1}}(t,r);if(s)return s;const l=function(c,d){let h=!1,p=-1/0,m=0;for(let y=0;y<c.length-1;y++)c[y].x>p&&(p=c[y].x,m=y);for(let y=0;y<c.length-1;y++){const v=(m+y)%(c.length-1),b=c[v],E=c[v+1];Math.abs(b.x-E.x)>.5&&(b.x<E.x?(b.x+=1,0===v&&(c[c.length-1].x+=1)):(E.x+=1,v+1===c.length-1&&(c[0].x+=1)),h=!0)}const _=eo(d.center.lng);return h&&_<Math.abs(_-1)&&c.forEach(y=>{y.x-=1}),{polygon:c,unwrapped:h}}(qS(t,r).map(c=>new nt(so(c.x),c.y)),r);return{polygon:l.polygon.map(c=>new Ke(c.x,c.y)),unwrapped:l.unwrapped}}}function qS(n,t){return YC(n,r=>{const s=t.pointCoordinate3D(r);r.x=s.x,r.y=s.y},1/256)}function so(n){return n<0?1+n%1:n%1}function rR(n){return 100*n|0}function ev(n,t,r,s,l){const c=function(d,h){if(d)return l(d);if(h){n.url&&h.tiles&&n.tiles&&delete n.tiles;const p=ts(Yt(h,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);h.vector_layers&&(p.vectorLayers=h.vector_layers,p.vectorLayerIds=p.vectorLayers.map(m=>m.id)),p.tiles=t.canonicalizeTileset(p,n.url),l(null,p)}};return n.url?At(t.transformRequest(t.normalizeSourceURL(n.url,null,r,s),gt.Source),c):kt.frame(()=>c(null,n))}class Ym{constructor(t,r,s){this.bounds=qs.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=s||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),s=Math.floor(eo(this.bounds.getWest())*r),l=Math.floor(po(this.bounds.getNorth())*r),c=Math.ceil(eo(this.bounds.getEast())*r),d=Math.ceil(po(this.bounds.getSouth())*r);return t.x>=s&&t.x<c&&t.y>=l&&t.y<d}}class oR{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new Mc({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const s=this.getKey(t,r);return this.positions[s]}trim(){const t=this.width,r=this.height=cn(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,s){const l=[];let c=t.length%2==1?-t[t.length-1]*s:0,d=t[0]*s,h=!0;l.push({left:c,right:d,isDash:h,zeroLength:0===t[0]});let p=t[0];for(let m=1;m<t.length;m++){h=!h;const _=t[m];c=p*s,p+=_,d=p*s,l.push({left:c,right:d,isDash:h,zeroLength:0===_})}return l}addRoundDash(t,r,s){const l=r/2;for(let c=-s;c<=s;c++){const d=this.width*(this.nextRow+s+c);let h=0,p=t[h];for(let m=0;m<this.width;m++){m/p.right>1&&(p=t[++h]);const _=Math.abs(m-p.left),y=Math.abs(m-p.right),v=Math.min(_,y);let b;const E=c/s*(l+1);if(p.isDash){const C=l-Math.abs(E);b=Math.sqrt(v*v+C*C)}else b=l-Math.sqrt(v*v+E*E);this.image.data[d+m]=Math.max(0,Math.min(255,b+128))}}}addRegularDash(t,r){for(let p=t.length-1;p>=0;--p){const m=t[p],_=t[p+1];m.zeroLength?t.splice(p,1):_&&_.isDash===m.isDash&&(_.left=m.left,t.splice(p,1))}const s=t[0],l=t[t.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const c=this.width*this.nextRow;let d=0,h=t[d];for(let p=0;p<this.width;p++){p/h.right>1&&(h=t[++d]);const m=Math.abs(p-h.left),_=Math.abs(p-h.right),y=Math.min(m,_);this.image.data[c+p]=Math.max(0,Math.min(255,(h.isDash?y:-y)+r+128))}}addDash(t,r){const s=this.getKey(t,r);if(this.positions[s])return this.positions[s];const l="round"===r,c=l?7:0,d=2*c+1;if(this.nextRow+d>this.height)return Q("LineAtlas out of space"),null;0===t.length&&t.push(1);let h=0;for(let _=0;_<t.length;_++)t[_]<0&&(Q("Negative value is found in line dasharray, replacing values with 0"),t[_]=0),h+=t[_];if(0!==h){const _=this.width/h,y=this.getDashRanges(t,this.width,_);l?this.addRoundDash(y,_,c):this.addRegularDash(y,"square"===r?.5*_:0)}const p=this.nextRow+c;this.nextRow+=d;const m={tl:[p,c],br:[h,0]};return this.positions[s]=m,m}}Xt(oR,"LineAtlas");const qi=1*Ys;class WS{constructor(t){const r={},s=[];for(const h in t){const p=t[h],m=r[h]={};for(const _ in p.glyphs){const y=p.glyphs[+_];if(!y||0===y.bitmap.width||0===y.bitmap.height)continue;const v=y.metrics.localGlyph?qi:1,b={x:0,y:0,w:y.bitmap.width+2*v,h:y.bitmap.height+2*v};s.push(b),m[_]=b}}const{w:l,h:c}=on(s),d=new Mc({width:l||1,height:c||1});for(const h in t){const p=t[h];for(const m in p.glyphs){const _=p.glyphs[+m];if(!_||0===_.bitmap.width||0===_.bitmap.height)continue;const y=r[h][m],v=_.metrics.localGlyph?qi:1;Mc.copy(_.bitmap,d,{x:0,y:0},{x:y.x+v,y:y.y+v},_.bitmap)}}this.image=d,this.positions=r}}Xt(WS,"GlyphAtlas");class sR{constructor(t){this.tileID=new tn(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Mu(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,r,s,l,c){this.status="parsing",this.data=t,this.collisionBoxArray=new KE;const d=new uM(Object.keys(t.layers).sort()),h=new mb(this.tileID,this.promoteId);h.bucketLayerIDs=[];const p={},m=new oR(256,256),_={featureIndex:h,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:m,availableImages:s,brightness:this.brightness},y=r.familiesBySource[this.source];for(const D in y){const R=t.layers[D];if(!R)continue;let P=!1,I=!1,O=!1;for(const N of y[D])"symbol"===N[0].type?P=!0:I=!0,N[0].is3D()&&"model"!==N[0].type&&(O=!0);if(this.extraShadowCaster&&!O||!0===this.isSymbolTile&&!P||!1===this.isSymbolTile&&!I)continue;1===R.version&&Q(`Vector tile source "${this.source}" layer "${D}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const F=d.encode(D),L=[];for(let N=0;N<R.length;N++){const z=R.feature(N),U=h.getId(z,D);L.push({feature:z,id:U,index:N,sourceLayerIndex:F})}for(const N of y[D]){const z=N[0];(!this.extraShadowCaster||z.is3D()&&"model"!==z.type)&&(void 0!==this.isSymbolTile&&"symbol"===z.type!==this.isSymbolTile||z.minzoom&&this.zoom<Math.floor(z.minzoom)||z.maxzoom&&this.zoom>=z.maxzoom||"none"!==z.visibility&&(s1(N,this.zoom,_.brightness,s),(p[z.id]=z.createBucket({index:h.bucketLayerIDs.length,layers:N,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:F,sourceID:this.source,projection:this.projection.spec})).populate(L,_,this.tileID.canonical,this.tileTransform),h.bucketLayerIDs.push(N.map(U=>U.id))))}}let v,b,E,C;m.trim();const S={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},M=()=>{if(v)return c(v);if(this.extraShadowCaster)this.status="done",c(null,{buckets:xn(p).filter(D=>!D.isEmpty()),featureIndex:h,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:_.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(b&&E&&C){const D=new WS(b),R=new xt(E,C);for(const P in p){const I=p[P];I instanceof Dm?(s1(I.layers,this.zoom,_.brightness,s),u2(I,b,D.positions,E,R.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):I.hasPattern&&(I instanceof Im||I instanceof Kh||I instanceof Mf)&&(s1(I.layers,this.zoom,_.brightness,s),I.addFeatures(_,this.tileID.canonical,R.patternPositions,s,this.tileTransform,this.brightness))}this.status="done",c(null,{buckets:xn(p).filter(P=>!P.isEmpty()),featureIndex:h,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:D.image,lineAtlas:m,imageAtlas:R,brightness:_.brightness})}};if(!this.extraShadowCaster){const D=Jd(_.glyphDependencies,I=>Object.keys(I).map(Number));Object.keys(D).length?l.send("getGlyphs",{uid:this.uid,stacks:D,scope:this.scope},(I,O)=>{v||(v=I,b=O,M())},void 0,!1,S):b={};const R=Object.keys(_.iconDependencies);R.length?l.send("getImages",{icons:R,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(I,O)=>{v||(v=I,E=O,M())},void 0,!1,S):E={};const P=Object.keys(_.patternDependencies);P.length?l.send("getImages",{icons:P,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(I,O)=>{v||(v=I,C=O,M())},void 0,!1,S):C={}}M()}}function s1(n,t,r,s){const l=new wi(t,{brightness:r});for(const c of n)c.recalculate(l,s)}class Rd{constructor(t){this.entries={},this.scheduler=t}request(t,r,s,l){const c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){const[d,h]=c.result;return this.scheduler?this.scheduler.add(()=>{l(d,h)},r):l(d,h),()=>{}}return c.callbacks.push(l),c.cancel||(c.cancel=s((d,h)=>{c.result=[d,h];for(const p of c.callbacks)this.scheduler?this.scheduler.add(()=>{p(d,h)},r):p(d,h);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(d=>d!==l),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}}function ZS(n,t,r){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},l=>{const c=zt(n.request,(d,h,p,m)=>{d?l(d):h&&l(null,{vectorTile:r?void 0:new fm(new Je(h)),rawData:h,cacheControl:p,expires:m})});return()=>{c.cancel(),l()}},t)}class Km extends $i{constructor(t,r,s,l){if(super(),this.id=t,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Yt(this,ts(r,["url","scheme","tileSize","promoteId"])),this._options=Yt({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l),this._tileWorkers={},this._deduped=new Rd}load(t){this._loaded=!1,this.fire(new St("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=ev(this._options,this.map._requestManager,r,s,(l,c)=>{this._tileJSONRequest=null,this._loaded=!0,l?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),s&&2!==s.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new at(l))):c&&(Yt(this,c),c.bounds&&(this.tileBounds=new Ym(c.bounds,this.minzoom,this.maxzoom)),eu(c.tiles,this.map._requestManager._customAccessToken),this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))),t&&t(l)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=Kr(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Yt({},this._options)}loadTile(t,r){const s=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),l={request:this.map._requestManager.transformRequest(s,gt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:kt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=r:t.request=t.actor.send("reloadTile",l,c.bind(this));else if(t.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,c.bind(this),void 0,!0);else{const d=ZS.call({deduped:this._deduped},l,(h,p)=>{h||!p?c.call(this,h):(l.data={cacheControl:p.cacheControl,expires:p.expires,rawData:p.rawData.slice(0)},t.actor&&t.actor.send("loadTile",l,c.bind(this),void 0,!0))},!0);t.request={cancel:d}}function c(d,h){return delete t.request,t.aborted?r(null):d&&404!==d.status?r(d):(h&&h.resourceTiming&&(t.resourceTiming=h.resourceTiming),this.map._refreshExpiredTiles&&h&&t.setExpiryData(h),t.loadVectorData(h,this.map.painter),th(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Pu extends $i{constructor(t,r,s,l){super(),this.id=t,this.dispatcher=s,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Yt({type:"raster"},r),Yt(this,ts(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new St("dataloading",{dataType:"source"})),this._tileJSONRequest=ev(this._options,this.map._requestManager,null,null,(r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new at(r)):s&&(Yt(this,s),s.bounds&&(this.tileBounds=new Ym(s.bounds,this.minzoom,this.maxzoom)),eu(s.tiles),this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=Kr(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Yt({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const s=kt.devicePixelRatio>=2,l=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),s,this.tileSize);t.request=Oe(this.map._requestManager.transformRequest(l,gt.Tile),(c,d,h,p)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):c?(t.state="errored",r(c)):d?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:h,expires:p}),t.setTexture(d,this.map.painter),t.state="loaded",th(this.dispatcher),void r(null)):r(null)))}static loadTileData(t,r,s){t.setTexture(r,s)}static unloadTileData(t,r){t.texture&&r.saveTileTexture(t.texture)}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&this.map.painter.saveTileTexture(t.texture),r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Xo;function VF(){return null!=Iv.workerClass?new Iv.workerClass:new st.Worker(Iv.workerUrl)}const nv="mapboxgl_preloaded_worker_pool";class Pd{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Pd.workerCount;)this.workers.push(new VF);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nv]}numActive(){return Object.keys(this.active).length}}let Jm;function Tf(){return Jm||(Jm=new Pd),Jm}Pd.workerCount=2;let Qm,iv,wa,a1=null;function XS(){return Ct()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:iv||$e.DRACO_URL}const l1=5123,Od=5126,c1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[l1]:Uint16Array,5125:Uint32Array,[Od]:Float32Array},aR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[l1]:"DT_UINT16",5125:"DT_UINT32",[Od]:"DT_FLOAT32"},u1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function tg(n,t,r){const s=r.json.bufferViews.length,l=r.buffers.length;t.bufferView=s,r.json.bufferViews[s]={buffer:l,byteLength:n.byteLength},r.buffers[l]=n}const rv="KHR_draco_mesh_compression";function YS(n,t){const r=n.extensions&&n.extensions[rv];if(!r)return;const s=new wa.Decoder,l=JS(t,r.bufferView),c=new wa.Mesh;if(!s.DecodeArrayToMesh(l,l.byteLength,c))throw new Error("Failed to decode Draco mesh");const d=t.json.accessors[n.indices],h=c1[d.componentType],p=d.count*h.BYTES_PER_ELEMENT,m=wa._malloc(p);h===Uint16Array?s.GetTrianglesUInt16Array(c,p,m):s.GetTrianglesUInt32Array(c,p,m),tg(wa.memory.buffer.slice(m,m+p),d,t),wa._free(m);for(const _ of Object.keys(r.attributes)){const y=s.GetAttributeByUniqueId(c,r.attributes[_]),v=t.json.accessors[n.attributes[_]],b=aR[v.componentType],E=v.count*u1[v.type]*c1[v.componentType].BYTES_PER_ELEMENT,C=wa._malloc(E);s.GetAttributeDataArrayForAllPoints(c,y,wa[b],E,C),tg(wa.memory.buffer.slice(C,C+E),v,t),wa._free(C)}s.destroy(),c.destroy(),delete n.extensions[rv]}const d1=1179937895,KS=new TextDecoder("utf8");function Df(n,t){return new URL(n,t).href}function eg(n,t,r,s){return fetch(Df(n.uri,s)).then(l=>l.arrayBuffer()).then(l=>{t.buffers[r]=l})}function JS(n,t){const r=n.json.bufferViews[t];return new Uint8Array(n.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function lR(n,t,r,s){if(n.uri){const l=Df(n.uri,s);return fetch(l).then(c=>c.blob()).then(c=>st.createImageBitmap(c)).then(c=>{t.images[r]=c})}if(void 0!==n.bufferView){const l=JS(t,n.bufferView),c=new st.Blob([l],{type:n.mimeType});return st.createImageBitmap(c).then(d=>{t.images[r]=d})}}function QS(n,t=0,r){const s={json:null,images:[],buffers:[]};if(new Uint32Array(n,t,1)[0]===d1){const m=new Uint32Array(n,t);let _=2;const y=(m[_++]>>2)-3,v=m[_++]>>2;if(_++,s.json=JSON.parse(KS.decode(m.subarray(_,_+v))),_+=v,_<y){const b=m[_++];_++;const E=t+(_<<2);s.buffers[0]=n.slice(E,E+b)}}else s.json=JSON.parse(KS.decode(new Uint8Array(n,t)));const{buffers:l,images:c,meshes:d,extensionsUsed:h}=s.json;let p=Promise.resolve();if(l){const m=[];for(let _=0;_<l.length;_++){const y=l[_];y.uri?m.push(eg(y,s,_,r)):s.buffers[_]||(s.buffers[_]=null)}p=Promise.all(m)}return p.then(()=>{const m=[],_=h&&h.includes(rv);if(_&&m.push(function(){if(!wa)return Qm||(Qm=function(y){let v,b=null;function E(){v=new Uint8Array(b.buffer)}function C(){throw new Error("Unexpected Draco error.")}const S={a:{a:C,d:function(M,D,R){return v.copyWithin(M,D,D+R)},c:function(M){const D=v.length,R=Math.max(M>>>0,Math.ceil(1.2*D)),P=Math.ceil((R-D)/65536);try{return b.grow(P),E(),!0}catch{return!1}},b:C}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(y,S):y.then(M=>M.arrayBuffer()).then(M=>WebAssembly.instantiate(M,S))).then(M=>{const{Rb:D,Qb:R,P,T:I,X:O,Ja:F,La:L,Qa:N,Va:z,Wa:U,eb:V,jb:H,f:j,e:Z,yb:tt,zb:it,Ab:X,Bb:Y,Db:ot,Gb:lt}=M.instance.exports;b=Z;const ht=(()=>{let mt=0,yt=0,ct=0,ft=0;return Rt=>{ct&&(D(ft),D(mt),yt+=ct,ct=mt=0),mt||(yt+=128,mt=R(yt));const Vt=Rt.length+7&-8;let jt=mt;Vt>=yt&&(ct=Vt,jt=ft=R(Vt));for(let $t=0;$t<Rt.length;$t++)v[jt+$t]=Rt[$t];return jt}})();return E(),j(),{memory:Z,_free:D,_malloc:R,Mesh:class{constructor(){this.ptr=P()}destroy(){I(this.ptr)}},Decoder:class{constructor(){this.ptr=F()}destroy(){H(this.ptr)}DecodeArrayToMesh(mt,yt,ct){const ft=ht(mt),Rt=L(this.ptr,ft,yt,ct.ptr);return!!O(Rt)}GetAttributeByUniqueId(mt,yt){return{ptr:N(this.ptr,mt.ptr,yt)}}GetTrianglesUInt16Array(mt,yt,ct){z(this.ptr,mt.ptr,yt,ct)}GetTrianglesUInt32Array(mt,yt,ct){U(this.ptr,mt.ptr,yt,ct)}GetAttributeDataArrayForAllPoints(mt,yt,ct,ft,Rt){V(this.ptr,mt.ptr,yt.ptr,ct,ft,Rt)}},DT_INT8:tt(),DT_UINT8:it(),DT_INT16:X(),DT_UINT16:Y(),DT_UINT32:ot(),DT_FLOAT32:lt()}})}(fetch(XS())),Qm.then(y=>{wa=y,Qm=void 0}))}()),c)for(let y=0;y<c.length;y++)m.push(lR(c[y],s,y,r));return(m.length?Promise.all(m):Promise.resolve()).then(()=>{if(_&&d)for(const{primitives:y}of d)for(const v of y)YS(v,s);return s})})}function h1(n){return fetch(n).then(t=>t.arrayBuffer()).then(t=>QS(t,0,n))}class f1{constructor(t,r,s){if(this.triangleCount=r.length/3,this.min=new nt(0,0),this.max=new nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===s)return;const l=t.map(_=>_.x),c=t.map(_=>_.y);this.min=new nt(Math.min(...l),Math.min(...c)),this.max=new nt(Math.max(...l),Math.max(...c));const d=this.max.sub(this.min);d.x=Math.max(d.x,1),d.y=Math.max(d.y,1);const h=Math.max(d.x,d.y)/s;this.cellsX=Math.max(1,Math.ceil(d.x/h)),this.cellsY=Math.max(1,Math.ceil(d.y/h)),this.xScale=1/h,this.yScale=1/h;const p=[];for(let _=0;_<this.triangleCount;_++){const y=t[r[3*_+0]].sub(this.min),v=t[r[3*_+1]].sub(this.min),b=t[r[3*_+2]].sub(this.min),E=Bc(Math.floor(Math.min(y.x,v.x,b.x)),this.xScale,this.cellsX),C=Bc(Math.floor(Math.max(y.x,v.x,b.x)),this.xScale,this.cellsX),S=Bc(Math.floor(Math.min(y.y,v.y,b.y)),this.yScale,this.cellsY),M=Bc(Math.floor(Math.max(y.y,v.y,b.y)),this.yScale,this.cellsY),D=new nt(0,0),R=new nt(0,0),P=new nt(0,0),I=new nt(0,0);for(let O=S;O<=M;++O){D.y=R.y=O*h,P.y=I.y=(O+1)*h;for(let F=E;F<=C;++F)D.x=P.x=F*h,R.x=I.x=(F+1)*h,(em(y,v,b,D,R,I)||em(y,v,b,D,I,P))&&p.push({cellIdx:O*this.cellsX+F,triIdx:_})}}if(0===p.length)return;p.sort((_,y)=>_.cellIdx-y.cellIdx||_.triIdx-y.triIdx);let m=0;for(;m<p.length;){const _=p[m].cellIdx,y={start:this.payload.length,len:0};for(;m<p.length&&p[m].cellIdx===_;)++y.len,this.payload.push(p[m++].triIdx);this.cells[_]=y}}query(t,r,s){if(0===this.triangleCount||0===this.cells.length||t.x>this.max.x||this.min.x>r.x||t.y>this.max.y||this.min.y>r.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let p=0;p<this.lookup.length;p++)this.lookup[p]=0;const l=Bc(t.x-this.min.x,this.xScale,this.cellsX),c=Bc(r.x-this.min.x,this.xScale,this.cellsX),d=Bc(t.y-this.min.y,this.yScale,this.cellsY),h=Bc(r.y-this.min.y,this.yScale,this.cellsY);for(let p=d;p<=h;p++)for(let m=l;m<=c;m++){const _=this.cells[p*this.cellsX+m];if(_)for(let y=0;y<_.len;y++){const v=this.payload[_.start+y],b=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[b]&E)&&(this.lookup[b]|=E,s.push(v),s.length===this.triangleCount))return}}}}function Bc(n,t,r){return Math.max(0,Math.min(r-1,Math.floor(n*t)))}function kd(n,t){const r=n.json.bufferViews[t.bufferView];return new c1[t.componentType](n.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*u1[t.type])}function tT(n,t,r){const s=n.indices,l=n.attributes,c={};c.indexArray=new er;const d=t.json.accessors[s],h=d.count/3;c.indexArray.reserve(h);const p=kd(t,d);for(let v=0;v<h;v++)c.indexArray.emplaceBack(p[3*v],p[3*v+1],p[3*v+2]);c.indexArray._trim(),c.vertexArray=new ja;const m=t.json.accessors[l.POSITION];c.vertexArray.reserve(m.count);const _=kd(t,m);for(let v=0;v<m.count;v++)c.vertexArray.emplaceBack(_[3*v],_[3*v+1],_[3*v+2]);if(c.vertexArray._trim(),c.aabb=new ci(m.min,m.max),c.centroid=function(v,b){const E=[0,0,0],C=v.length;if(C>0){for(let S=0;S<C;S++){const M=3*v[S];E[0]+=b[M],E[1]+=b[M+1],E[2]+=b[M+2]}E[0]/=C,E[1]/=C,E[2]/=C}return E}(p,_),void 0!==l.COLOR_0){const v=t.json.accessors[l.COLOR_0],b=u1[v.type];if(v.componentType===Od){c.colorArray=3===b?new ja:new Ci,c.colorArray.reserve(v.count);const E=kd(t,v);if(3===b)for(let C=0;C<v.count;C++)c.colorArray.emplaceBack(E[3*C],E[3*C+1],E[3*C+2]);else for(let C=0;C<v.count;C++)c.colorArray.emplaceBack(E[4*C],E[4*C+1],E[4*C+2],E[4*C+3]);c.colorArray._trim()}else if(v.componentType===l1&&4===b){c.colorArray=new Ci,c.colorArray.resize(v.count);const E=kd(t,v),C=1/65535,S=c.colorArray.float32;for(let M=0;M<4*E.length;++M)S[M]=E[M]*C}else Q(`glTF color buffer parsing for accessor ${JSON.stringify(v)} is not supported`)}if(void 0!==l.NORMAL){c.normalArray=new ja;const v=t.json.accessors[l.NORMAL];c.normalArray.reserve(v.count);const b=kd(t,v);for(let E=0;E<v.count;E++)c.normalArray.emplaceBack(b[3*E],b[3*E+1],b[3*E+2]);c.normalArray._trim()}if(void 0!==l.TEXCOORD_0&&r.length>0){c.texcoordArray=new cd;const v=t.json.accessors[l.TEXCOORD_0];c.texcoordArray.reserve(v.count);const b=kd(t,v);for(let E=0;E<v.count;E++)c.texcoordArray.emplaceBack(b[2*E],b[2*E+1]);c.texcoordArray._trim()}const y=n.material;return c.material=function(v,b){const{emissiveFactor:E=[0,0,0],alphaMode:C="OPAQUE",alphaCutoff:S=.5,normalTexture:M,occlusionTexture:D,emissiveTexture:R,doubleSided:P}=v,{baseColorFactor:I=[1,1,1,1],metallicFactor:O=1,roughnessFactor:F=1,baseColorTexture:L,metallicRoughnessTexture:N}=v.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Ne(...I),metallicFactor:O,roughnessFactor:F,baseColorTexture:L?b[L.index]:void 0,metallicRoughnessTexture:N?b[N.index]:void 0},doubleSided:P,emissiveFactor:E,alphaMode:C,alphaCutoff:S,normalTexture:M?b[M.index]:void 0,occlusionTexture:D?b[D.index]:void 0,emissionTexture:R?b[R.index]:void 0,defined:void 0===v.defined}}(void 0!==y?t.json.materials[y]:{defined:!1},r),void 0!==l._FEATURE_RGBA4444&&(c.featureData=new Uint32Array(kd(t,t.json.accessors[l._FEATURE_RGBA4444]).buffer)),c}function eT(n,t,r){const{matrix:s,rotation:l,translation:c,scale:d,mesh:h,extras:p,children:m}=n,_={};if(_.matrix=s||rt.fromRotationTranslationScale([],l||[0,0,0,1],c||[0,0,0],d||[1,1,1]),void 0!==h){_.meshes=r[h];const y=_.anchor=[0,0];for(const v of _.meshes){const{min:b,max:E}=v.aabb;y[0]+=b[0]+E[0],y[1]+=b[1]+E[1]}y[0]=Math.floor(y[0]/_.meshes.length/2),y[1]=Math.floor(y[1]/_.meshes.length/2)}if(p&&(p.id&&(_.id=p.id),p.lights&&(_.lights=function(y){if(!y.length)return[];const v=function(M){const D=atob(M),R=new Uint8Array(D.length);for(let P=0;P<D.length;P++)R[P]=D.codePointAt(P);return R}(y),b=[],E=v.length/24,C=new Uint16Array(v.buffer),S=new Float32Array(v.buffer);for(let M=0;M<E;M++){const D=C[2*M*6]/30,R=C[2*M*6+1]/30,P=C[2*M*6+10]/100,I=S[6*M+1],O=S[6*M+2],F=S[6*M+3],L=S[6*M+4],N=F-I,z=L-O,U=Math.hypot(N,z);b.push({pos:[I+.5*N,O+.5*z,R],normal:[z/U,-N/U,0],width:U,height:D,depth:P,points:[I,O,F,L]})}return b}(p.lights))),m){const y=[];for(const v of m)y.push(eT(t.json.nodes[v],t,r));_.children=y}return _}function cR(n){if(0===n.vertices.length||0===n.indices.length)return null;const[t,r]=[n.vertices[0].clone(),n.vertices[0].clone()];for(let d=1;d<n.vertices.length;++d){const h=n.vertices[d];t.x=Math.min(t.x,h.x),t.y=Math.min(t.y,h.y),r.x=Math.max(r.x,h.x),r.y=Math.max(r.y,h.y)}const s=Math.ceil(Math.max(r.x-t.x,r.y-t.y)/256),l=Math.max(8,s),c=new f1(n.vertices,n.indices,l);return{vertices:n.vertices,indices:n.indices,grid:c,min:t,max:r}}function jF(n){if(!n.extras||!n.extras.ground)return null;const t=n.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const r=t[0];if(!r||!Array.isArray(r)||0===r.length)return null;const s=[];for(const d of r){if(!Array.isArray(d)||2!==d.length)continue;const h=d[0],p=d[1];"number"==typeof h&&"number"==typeof p&&s.push(new nt(h,p))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let l=0;for(let d=0;d<s.length;d++){const h=s[d],p=s[(d+1)%s.length],m=s[(d+2)%s.length];l+=(h.x-p.x)*(m.y-p.y)-(m.x-p.x)*(h.y-p.y)}l>0&&s.reverse();const c=uy(s.flatMap(d=>[d.x,d.y]),[]);return 0===c.length?null:{vertices:s,indices:c}}function UF(n){const t=[],r=[];let s=0;for(const l of n){s=t.length;const c=l.vertexArray.float32,d=l.indexArray.uint16;for(let h=0;h<l.vertexArray.length;h++)t.push(new nt(c[3*h+0],c[3*h+1]));for(let h=0;h<3*l.indexArray.length;h++)r.push(d[h]+s)}if(r.length%3!=0)return null;for(let l=0;l<r.length;l+=3){const c=t[r[l+0]],d=t[r[l+1]],h=t[r[l+2]];(c.x-d.x)*(h.y-d.y)-(h.x-d.x)*(c.y-d.y)>0&&([r[l+1],r[l+2]]=[r[l+2],r[l+1]])}return{vertices:t,indices:r}}function nT(n){const r=function(p,m){const _=[];for(const y of p.json.meshes){const v=[];for(const b of y.primitives)v.push(tT(b,p,m));_.push(v)}return _}(n,function(p,m){const _=[],y=st.WebGL2RenderingContext;if(p.json.textures)for(const v of p.json.textures){const b={magFilter:y.LINEAR,minFilter:y.NEAREST,wrapS:y.REPEAT,wrapT:y.REPEAT};void 0!==v.sampler&&Object.assign(b,p.json.samplers[v.sampler]),_.push({image:m[v.source],sampler:b,uploaded:!1})}return _}(n,n.images)),{scenes:s,scene:l,nodes:c}=n.json,d=s?s[l||0].nodes:c,h=[];for(const p of d)h.push(eT(c[p],n,r));return function(p,m,_){const y={},v=new Set;for(let b=0;b<p.length;b++){const E=_[m[b]];if(!E.extras)continue;const C=E.extras["mapbox:footprint:version"],S=E.extras["mapbox:footprint:id"];(C||S)&&v.add(b),"1.0.0"===C&&S&&(y[S]=b)}for(let b=0;b<p.length;b++){if(v.has(b))continue;const E=p[b],C=_[m[b]];if(!C.extras)continue;let S=null;E.id in y&&(S=UF(p[y[E.id]].meshes)),S||(S=jF(C)),S&&(E.footprint=cR(S))}if(v.size>0){const b=Array.from(v.values()).sort((E,C)=>E-C);for(let E=b.length-1;E>=0;E--)p.splice(b[E],1)}}(h,d,n.json.nodes),h}function $F(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const t=n.vertexArray.float32,r=n.aabb.min[0]-1,s=n.aabb.min[1]-1,l=64/(n.aabb.max[0]-r+2),c=64/(n.aabb.max[1]-s+2);for(let d=0;d<t.length;d+=3){const h=t[d+2],p=(t[d+0]-r)*l|0,m=(t[d+1]-s)*c|0;h>n.heightmap[64*m+p]&&(n.heightmap[64*m+p]=h)}}function iT(n,t){const r={};r.indexArray=new er,r.indexArray.reserve(4*n.length),r.vertexArray=new ja,r.vertexArray.reserve(10*n.length),r.colorArray=new Ci,r.vertexArray.reserve(10*n.length);let s=0;for(const d of n){const h=Math.min(10,Math.max(4,1.3*d.height))*t,p=[-d.normal[1],d.normal[0],0],m=Math.min(.29,.1*d.width/d.depth),_=d.width-2*d.depth*t*(m+.01),y=q.scaleAndAdd([],d.pos,p,_/2),v=q.scaleAndAdd([],d.pos,p,-_/2),b=[y[0],y[1],y[2]+d.height],E=[v[0],v[1],v[2]+d.height],C=q.scaleAndAdd([],d.normal,p,m);q.scale(C,C,h);const S=q.scaleAndAdd([],d.normal,p,-m);q.scale(S,S,h),q.add(C,y,C),q.add(S,v,S),y[2]+=.1,v[2]+=.1,r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(y[0],y[1],y[2]),r.vertexArray.emplaceBack(v[0],v[1],v[2]),r.vertexArray.emplaceBack(b[0],b[1],b[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(y[0],y[1],y[2]),r.vertexArray.emplaceBack(v[0],v[1],v[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]);const M=_/h/2;r.colorArray.emplaceBack(-M-m,-1,M,.8),r.colorArray.emplaceBack(M+m,-1,M,.8),r.colorArray.emplaceBack(-M,0,M,1.3),r.colorArray.emplaceBack(M,0,M,1.3),r.colorArray.emplaceBack(M+m,-.8,M,.7),r.colorArray.emplaceBack(M+m,-.8,M,.7),r.colorArray.emplaceBack(0,0,M,1.3),r.colorArray.emplaceBack(0,0,M,1.3),r.colorArray.emplaceBack(M+m,-1.2,M,.8),r.colorArray.emplaceBack(M+m,-1.2,M,.8),r.indexArray.emplaceBack(6+s,4+s,8+s),r.indexArray.emplaceBack(7+s,9+s,5+s),r.indexArray.emplaceBack(0+s,1+s,2+s),r.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const l={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=Ne.white,l.pbrMetallicRoughness=c,r.material=l,r.aabb=new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}Xt(f1,"TriangleGridIndex");const If={vector:Km,raster:Pu,"raster-dem":class extends Pu{constructor(n,t,r,s){super(n,t,r,s),this.type="raster-dem",this.maxzoom=22,this._options=Yt({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(n,t){const r=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);n.request=Oe(this.map._requestManager.transformRequest(r,gt.Tile),function(c,d,h,p){if(delete n.request,n.aborted)n.state="unloaded",t(null);else if(c)n.state="errored",t(c);else if(d){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:h,expires:p});const _=st.ImageBitmap&&d instanceof st.ImageBitmap&&(null==Xo&&(Xo=st.OffscreenCanvas&&new st.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof st.createImageBitmap),Xo),y=1-(d.width-((m=d.width)<=1?1:Math.pow(2,Math.floor(Math.log(m)/Math.LN2))))/2;y<1||n.neighboringTiles||(n.neighboringTiles=this._getNeighboringTiles(n.tileID));const v=_?d:kt.getImageData(d,y),b={uid:n.uid,coord:n.tileID,source:this.id,scope:this.scope,rawImageData:v,encoding:this.encoding,padding:y,convertToFloat:s};n.actor&&"expired"!==n.state||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",b,l.bind(this),void 0,!0))}var m}.bind(this));const s=this.map?.painter?.terrainUseFloatDEM();function l(c,d){c&&(n.state="errored",t(c)),d&&(n.dem=d,n.dem.onDeserialize(),n.needsHillshadePrepare=!0,n.needsDEMTextureUpload=!0,n.state="loaded",t(null))}}_getNeighboringTiles(n){const t=n.canonical,r=Math.pow(2,t.z),s=(t.x-1+r)%r,l=0===t.x?n.wrap-1:n.wrap,c=(t.x+1+r)%r,d=t.x+1===r?n.wrap+1:n.wrap,h={};return h[new tn(n.overscaledZ,l,t.z,s,t.y).key]={backfilled:!1},h[new tn(n.overscaledZ,d,t.z,c,t.y).key]={backfilled:!1},t.y>0&&(h[new tn(n.overscaledZ,l,t.z,s,t.y-1).key]={backfilled:!1},h[new tn(n.overscaledZ,n.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},h[new tn(n.overscaledZ,d,t.z,c,t.y-1).key]={backfilled:!1}),t.y+1<r&&(h[new tn(n.overscaledZ,l,t.z,s,t.y+1).key]={backfilled:!1},h[new tn(n.overscaledZ,n.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},h[new tn(n.overscaledZ,d,t.z,c,t.y+1).key]={backfilled:!1}),h}unloadTile(n){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.hillshadeFBO&&(n.hillshadeFBO.destroy(),delete n.hillshadeFBO),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded"}},geojson:class extends $i{constructor(n,t,r,s){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(s),this._data=t.data,this._options=Yt({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const l=dt/this.tileSize;this.workerOptions=Yt({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*l,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*l,extent:dt,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:dt,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*l,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(n){this.map=n,this.setData(this._data)}setData(n){return this._data=n,this._updateWorkerData(),this}getClusterExpansionZoom(n,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:n,source:this.id,scope:this.scope},t),this}getClusterChildren(n,t){return this.actor.send("geojson.getClusterChildren",{clusterId:n,source:this.id,scope:this.scope},t),this}getClusterLeaves(n,t,r,s){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:n,limit:t,offset:r},s),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new St("dataloading",{dataType:"source"})),this._loaded=!1;const n=Yt({},this.workerOptions);n.scope=this.scope;const t=this._data;"string"==typeof t?(n.request=this.map._requestManager.transformRequest(kt.resolveURL(t),gt.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(r,s)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new at(r));else{const l={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&s&&s.resourceTiming&&s.resourceTiming[this.id]&&(l.resourceTiming=s.resourceTiming[this.id]),this.fire(new St("data",l)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(n,t){const r=n.actor?"reloadTile":"loadTile";n.actor=this.actor;const s={type:this.type,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:kt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};n.request=this.actor.send(r,s,(l,c)=>(delete n.request,n.unloadVectorData(),n.aborted?t(null):l?t(l):(n.loadVectorData(c,this.map.painter,"reloadTile"===r),t(null))),void 0,"loadTile"===r)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.aborted=!0}unloadTile(n){n.unloadVectorData(),this.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Yt({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Gl{constructor(n,t,r,s){super(n,t,r,s),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const n=this.options;this.urls=[];for(const t of n.urls)this.urls.push(this.map._requestManager.transformRequest(t,gt.Source).url);!function(t,r){const s=st.document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let l=0;l<t.length;l++){const c=st.document.createElement("source");Ut(t[l])||(s.crossOrigin="Anonymous"),c.src=t[l],s.appendChild(c)}}(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new at(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const t=this.video.seekable;n<t.start(0)||n>t.end(0)?this.fire(new at(new It(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const n=this.map.painter.context,t=n.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new ir(n,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(n)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Gl,model:class extends $i{constructor(n,t,r,s){super(),this.id=n,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const n=[];for(const t in this._options.models){const r=this._options.models[t],s=h1(this.map._requestManager.transformRequest(r.uri,gt.Model).url).then(l=>{if(!l)return;const c=nT(l),d=new Ub(t,r.position,r.orientation,c);d.computeBoundsAndApplyParent(),this.models.push(d)}).catch(l=>{this.fire(new at(new Error(`Could not load model ${t} from ${r.uri}: ${l.message}`)))});n.push(s)}return Promise.allSettled(n).then(()=>{this._loaded=!0,this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new at(new Error(`Could not load models: ${t.message}`)))})}onAdd(n){this.map=n,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(n,t){}serialize(){return{type:"model"}}},"batched-model":class extends $i{constructor(n,t,r,s){super(),this.type="batched-model",this.id=n,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(s)}onAdd(n){this.map=n,this.load()}load(n){this._loaded=!1,this.fire(new St("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=ev(this._options,this.map._requestManager,t,r,(s,l)=>{this._tileJSONRequest=null,this._loaded=!0,s?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new at(s))):l&&(Yt(this,l),l.bounds&&(this.tileBounds=new Ym(l.bounds,this.minzoom,this.maxzoom)),eu(l.tiles,this.map._requestManager._customAccessToken),this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))),n&&n(s)})}hasTransition(){return!1}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loaded(){return this._loaded}loadTile(n,t){const r=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),s={request:this.map._requestManager.transformRequest(r,gt.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(n.actor&&"expired"!==n.state)if("loading"===n.state)n.reloadCallback=t;else{if(n.buckets){const c=Object.values(n.buckets);for(const d of c)d.dirty=!0;return void(n.state="loaded")}n.request=n.actor.send("reloadTile",s,l.bind(this))}else n.actor=this.dispatcher.getActor(),n.request=n.actor.send("loadTile",s,l.bind(this),void 0,!0);function l(c,d){return n.aborted?t(null):c&&404!==c.status?t(c):(d&&(d.resourceTiming&&(n.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&n.setExpiryData(d),n.buckets={...n.buckets,...d.buckets}),n.state="loaded",void t(null))}}serialize(){return Yt({},this._options)}},canvas:class extends Gl{constructor(n,t,r,s){super(n,t,r,s),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(l=>!Array.isArray(l)||2!==l.length||l.some(c=>"number"!=typeof c))||this.fire(new at(new It(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new at(new It(`sources.${n}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new at(new It(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof st.HTMLCanvasElement||this.fire(new at(new It(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new at(new It(`sources.${n}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof st.HTMLCanvasElement?this.options.canvas:st.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new at(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!n&&!this._playing||this.texture instanceof By||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ir(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}},custom:class extends $i{constructor(n,t,r,s){super(),this.id=n,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(s),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new at(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new at(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ym(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Yt(this,ts(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return ts(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(n){this._map=n,this._loaded=!1,this.fire(new St("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(n),this.load()}onRemove(n){this._implementation.onRemove&&this._implementation.onRemove(n)}hasTile(n){if(this._implementation.hasTile){const{x:t,y:r,z:s}=n.canonical;return this._implementation.hasTile({x:t,y:r,z:s})}return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,t){const{x:r,y:s,z:l}=n.tileID.canonical,c=new st.AbortController;n.request=Promise.resolve(this._implementation.loadTile({x:r,y:s,z:l},{signal:c.signal})).then(function(d){return delete n.request,n.aborted?(n.state="unloaded",t(null)):void 0===d?(n.state="errored",t(null)):null===d?(this.loadTileData(n,{width:this.tileSize,height:this.tileSize,data:null}),n.state="loaded",t(null)):(h=d)instanceof st.ImageData||h instanceof st.HTMLCanvasElement||h instanceof st.ImageBitmap||h instanceof st.HTMLImageElement?(this.loadTileData(n,d),n.state="loaded",void t(null)):(n.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var h}.bind(this)).catch(d=>{20!==d.code&&(n.state="errored",t(d))}),n.request.cancel=()=>c.abort()}loadTileData(n,t){Pu.loadTileData(n,t,this._map.painter)}unloadTileData(n){Pu.unloadTileData(n,this._map.painter)}unloadTile(n,t){if(this.unloadTileData(n),this._implementation.unloadTile){const{x:r,y:s,z:l}=n.tileID.canonical;this._implementation.unloadTile({x:r,y:s,z:l})}t()}abortTile(n,t){n.request&&n.request.cancel&&(n.request.cancel(),delete n.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(n=>({x:n.canonical.x,y:n.canonical.y,z:n.canonical.z}))}_clearTiles(){const n=Kr(this.id,this.scope);this._map.style.clearSource(n)}_update(){this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))}}},p1=function(n,t,r,s){const l=new If[t.type](n,t,r,s);if(l.id!==n)throw new Error(`Expected Source id to be ${n} instead of ${l.id}`);return Ir(["load","abort","unload","serialize","prepare"],l),l};function uR(n,t){const r=rt.identity([]);return rt.scale(r,r,[.5*n.width,.5*-n.height,1]),rt.translate(r,r,[1,-1,0]),rt.multiply(r,r,n.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(r)}function rT(n,t,r,s,l,c,d,h=!1){const p=n.tilesIn(s,d,h);p.sort(oT);const m=[];for(const y of p)m.push({wrappedTileID:y.tile.tileID.wrapped().key,queryResults:y.tile.queryRenderedFeatures(t,r,n._state,y,l,c,uR(n.transform,y.tile.tileID),h)});const _=function(y){const v={},b={};for(const E of y){const C=E.queryResults,S=E.wrappedTileID,M=b[S]=b[S]||{};for(const D in C){const R=C[D],P=M[D]=M[D]||{},I=v[D]=v[D]||[];for(const O of R)P[O.featureIndex]||(P[O.featureIndex]=!0,I.push(O))}}return v}(m);for(const y in _)_[y].forEach(v=>{const b=v.feature,E=b.layer;E&&"background"!==E.type&&"sky"!==E.type&&"slot"!==E.type&&(b.source=E.source,E["source-layer"]&&(b.sourceLayer=E["source-layer"]),b.state=void 0!==b.id?n.getFeatureState(E["source-layer"],b.id):{})});return _}function ng(n,t){const r=n.getRenderableIds().map(c=>n.getTileByID(c)),s=[],l={};for(let c=0;c<r.length;c++){const d=r[c],h=d.tileID.canonical.key;l[h]||(l[h]=!0,d.querySourceFeatures(s,t))}return s}function oT(n,t){const r=n.tileID,s=t.tileID;return r.overscaledZ-s.overscaledZ||r.canonical.y-s.canonical.y||r.wrap-s.wrap||r.canonical.x-s.canonical.x}class dR{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(const t in this.style._mergedLayers){const r=this.style._mergedLayers[t];if("fill-extrusion"===r.type)this.layers.push(r);else if("model"===r.type){const s=this.style.getLayerSource(r);s&&"batched-model"===s.type&&this.layers.push(r)}}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(let l=0;l<this.layers.length;++l){const c=this.layers[l],d=this.style.getLayerSourceCache(c);let h=1;"fill-extrusion"===c.type&&(h=c.paint.get("fill-extrusion-opacity")>0?c.paint.get("fill-extrusion-vertical-scale"):0);let p=d?d.getTile(r):null;if(!p&&d&&r.canonical.z>d.getSource().minzoom){let m=r.scaledTo(Math.min(d.getSource().maxzoom,r.overscaledZ-1));for(;m.overscaledZ>=d.getSource().minzoom&&(p=d.getTile(m),!p&&0!==m.overscaledZ);)m=m.scaledTo(m.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:p?p.getBucket(c):null,tileID:p?p.tileID:r,verticalScale:h})}t.hasAnyZOffset=!1;let s=!1;for(let l=0;l<t.symbolInstances.length;l++){const c=t.symbolInstances.get(l),d=c.zOffset,h=this._getHeightAtTileOffset(r,c.tileAnchorX,c.tileAnchorY);c.zOffset=-1!==h?h:d,s||d===c.zOffset||(s=!0),t.hasAnyZOffset||0===c.zOffset||(t.hasAnyZOffset=!0)}s&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,s,l){let c=r,d=s;if(t.canonical.z!==l.canonical.z){const h=l.canonical,p=1/(1<<t.canonical.z-h.z);c=(r+t.canonical.x*dt)*p-h.x*dt|0,d=(s+t.canonical.y*dt)*p-h.y*dt|0}return{tileX:c,tileY:d}}_getHeightAtTileOffset(t,r,s){let l;for(let c=0;c<this.layers.length;++c){if("fill-extrusion"!==this.layers[c].type)continue;const{bucket:d,tileID:h,verticalScale:p}=this.currentBuildingBuckets[c];if(!d)continue;const{tileX:m,tileY:_}=this._mapCoordToOverlappingTile(t,r,s,h),y=d.getHeightAtTileCoord(m,_);if(y&&void 0!==y.height){if(!y.hidden)return y.height*p;l=y.height}}for(let c=0;c<this.layers.length;++c){if("model"!==this.layers[c].type)continue;const{bucket:d,tileID:h}=this.currentBuildingBuckets[c];if(!d)continue;const{tileX:p,tileY:m}=this._mapCoordToOverlappingTile(t,r,s,h),_=d.getHeightAtTileCoord(p,m);if(_&&!_.hidden)return void 0===_.height&&void 0!==l?Math.min(_.maxHeight,l)*_.verticalScale:(_.height||0)*_.verticalScale}return-1}}var sT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hR(n,t){const r={};for(const s in n)"ref"!==s&&(r[s]=n[s]);return sT.forEach(s=>{s in t&&(r[s]=t[s])}),r}function fR(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=hR(n[r],t[n[r].ref]));return n}const _n={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function m1(n,t,r){r.push({command:_n.addSource,args:[n,t[n]]})}function aT(n,t,r){t.push({command:_n.removeSource,args:[n]}),r[n]=!0}function pR(n,t,r,s){aT(n,r,s),m1(n,t,r)}function ig(n,t,r){let s;for(s in n[r])if(n[r].hasOwnProperty(s)&&"data"!==s&&!ln(n[r][s],t[r][s]))return!1;for(s in t[r])if(t[r].hasOwnProperty(s)&&"data"!==s&&!ln(n[r][s],t[r][s]))return!1;return!0}function ov(n,t,r,s,l,c){let d;for(d in t=t||{},n=n||{})n.hasOwnProperty(d)&&(ln(n[d],t[d])||r.push({command:c,args:[s,d,t[d],l]}));for(d in t)t.hasOwnProperty(d)&&!n.hasOwnProperty(d)&&(ln(n[d],t[d])||r.push({command:c,args:[s,d,t[d],l]}))}function rg(n){return n.id}function sv(n,t){return n[t.id]=t,n}class lT{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=Jt(t,0,1);let r=1,s=this._distances[r];const l=t*this.paddedLength+this.padding;for(;s<l&&r<this._distances.length;)s=this._distances[++r];const c=r-1,d=this._distances[c],h=s-d,p=h>0?(l-d)/h:0;return this.points[c].mult(1-p).add(this.points[r].mult(p))}}class cT{constructor(t,r,s){const l=this.boxCells=[],c=this.circleCells=[];this.xCellCount=Math.ceil(t/s),this.yCellCount=Math.ceil(r/s);for(let d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]),c.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,s,l,c){this._forEachCell(r,s,l,c,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(c)}insertCircle(t,r,s,l){this._forEachCell(r-l,s-l,r+l,s+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(s),this.circles.push(l)}_insertBoxCell(t,r,s,l,c,d){this.boxCells[c].push(d)}_insertCircleCell(t,r,s,l,c,d){this.circleCells[c].push(d)}_query(t,r,s,l,c,d){if(s<0||t>this.width||l<0||r>this.height)return!c&&[];const h=[];if(t<=0&&r<=0&&this.width<=s&&this.height<=l){if(c)return!0;for(let p=0;p<this.boxKeys.length;p++)h.push({key:this.boxKeys[p],x1:this.bboxes[4*p],y1:this.bboxes[4*p+1],x2:this.bboxes[4*p+2],y2:this.bboxes[4*p+3]});for(let p=0;p<this.circleKeys.length;p++){const m=this.circles[3*p],_=this.circles[3*p+1],y=this.circles[3*p+2];h.push({key:this.circleKeys[p],x1:m-y,y1:_-y,x2:m+y,y2:_+y})}return d?h.filter(d):h}return this._forEachCell(t,r,s,l,this._queryCell,h,{hitTest:c,seenUids:{box:{},circle:{}}},d),c?h.length>0:h}_queryCircle(t,r,s,l,c){const d=t-s,h=t+s,p=r-s,m=r+s;if(h<0||d>this.width||m<0||p>this.height)return!l&&[];const _=[];return this._forEachCell(d,p,h,m,this._queryCellCircle,_,{hitTest:l,circle:{x:t,y:r,radius:s},seenUids:{box:{},circle:{}}},c),l?_.length>0:_}query(t,r,s,l,c){return this._query(t,r,s,l,!1,c)}hitTest(t,r,s,l,c){return this._query(t,r,s,l,!0,c)}hitTestCircle(t,r,s,l){return this._queryCircle(t,r,s,!0,l)}_queryCell(t,r,s,l,c,d,h,p){const m=h.seenUids,_=this.boxCells[c];if(null!==_){const v=this.bboxes;for(const b of _)if(!m.box[b]){m.box[b]=!0;const E=4*b;if(t<=v[E+2]&&r<=v[E+3]&&s>=v[E+0]&&l>=v[E+1]&&(!p||p(this.boxKeys[b]))){if(h.hitTest)return d.push(!0),!0;d.push({key:this.boxKeys[b],x1:v[E],y1:v[E+1],x2:v[E+2],y2:v[E+3]})}}}const y=this.circleCells[c];if(null!==y){const v=this.circles;for(const b of y)if(!m.circle[b]){m.circle[b]=!0;const E=3*b;if(this._circleAndRectCollide(v[E],v[E+1],v[E+2],t,r,s,l)&&(!p||p(this.circleKeys[b]))){if(h.hitTest)return d.push(!0),!0;{const C=v[E],S=v[E+1],M=v[E+2];d.push({key:this.circleKeys[b],x1:C-M,y1:S-M,x2:C+M,y2:S+M})}}}}}_queryCellCircle(t,r,s,l,c,d,h,p){const m=h.circle,_=h.seenUids,y=this.boxCells[c];if(null!==y){const b=this.bboxes;for(const E of y)if(!_.box[E]){_.box[E]=!0;const C=4*E;if(this._circleAndRectCollide(m.x,m.y,m.radius,b[C+0],b[C+1],b[C+2],b[C+3])&&(!p||p(this.boxKeys[E])))return d.push(!0),!0}}const v=this.circleCells[c];if(null!==v){const b=this.circles;for(const E of v)if(!_.circle[E]){_.circle[E]=!0;const C=3*E;if(this._circlesCollide(b[C],b[C+1],b[C+2],m.x,m.y,m.radius)&&(!p||p(this.circleKeys[E])))return d.push(!0),!0}}}_forEachCell(t,r,s,l,c,d,h,p){const m=this._convertToXCellCoord(t),_=this._convertToYCellCoord(r),y=this._convertToXCellCoord(s),v=this._convertToYCellCoord(l);for(let b=m;b<=y;b++)for(let E=_;E<=v;E++)if(c.call(this,t,r,s,l,this.xCellCount*E+b,d,h,p))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,s,l,c,d){const h=l-t,p=c-r,m=s+d;return m*m>h*h+p*p}_circleAndRectCollide(t,r,s,l,c,d,h){const p=(d-l)/2,m=Math.abs(t-(l+p));if(m>p+s)return!1;const _=(h-c)/2,y=Math.abs(r-(c+_));if(y>_+s)return!1;if(m<=p||y<=_)return!0;const v=m-p,b=y-_;return v*v+b*b<=s*s}}const ol=100;class mR{constructor(t,r,s=new cT(t.width+200,t.height+200,25),l=new cT(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ol,this.screenBottomBoundary=t.height+ol,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,s,l,c,d,h,p){let m=s.projectedAnchorX,_=s.projectedAnchorY,y=s.projectedAnchorZ;const v=s.elevation,b=s.tileID,E=t.getProjection();if(v&&b){const[O,F,L]=E.upVector(b.canonical,s.tileAnchorX,s.tileAnchorY),N=E.upVectorScale(b.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;m+=O*v*N,_+=F*v*N,y+=L*v*N}const C=this.projectAndGetPerspectiveRatio(h,m,_,y,s.tileID,"globe"===E.name||!!v||this.transform.pitch>0,E),S=d*C.perspectiveRatio,M=(s.x1*r+l.x-s.padding)*S+C.point.x,D=(s.y1*r+l.y-s.padding)*S+C.point.y,R=(s.x2*r+l.x+s.padding)*S+C.point.x,P=(s.y2*r+l.y+s.padding)*S+C.point.y,I=C.perspectiveRatio<=.55||C.occluded;return!this.isInsideGrid(M,D,R,P)||!c&&this.grid.hitTest(M,D,R,P,p)||I?{box:[],offscreen:!1,occluded:C.occluded}:{box:[M,D,R,P],offscreen:this.isOffscreen(M,D,R,P),occluded:!1}}placeCollisionCircles(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C){const S=[],M=this.transform.elevation,D=t.getProjection(),R=M?M.getAtTileOffsetFunc(C,this.transform.center.lat,this.transform.worldSize,D):null,P=new nt(s.tileAnchorX,s.tileAnchorY);let{x:I,y:O,z:F}=D.projectTilePoint(P.x,P.y,C.canonical);if(R){const[it,X,Y]=R(P);I+=it,O+=X,F+=Y}const L="globe"===D.name,N=this.projectAndGetPerspectiveRatio(h,I,O,F,C,L||!!M||this.transform.pitch>0,D),{perspectiveRatio:z}=N,U=(y?d/z:d*z)/kr,V=ba(I,O,F,p),H=N.signedDistanceFromCamera>0?wf(U,c,s.lineOffsetX*U,s.lineOffsetY*U,!1,V,P,s,l,p,{},M&&!y?R:null,y&&!!M,D,C,y):null;let j=!1,Z=!1,tt=!0;if(H&&!N.occluded){const it=.5*b*z+E,X=new nt(-100,-100),Y=new nt(this.screenRightBoundary,this.screenBottomBoundary),ot=new lT,{first:lt,last:ht}=H,mt=lt.path.length;let yt=[];for(let Rt=mt-1;Rt>=1;Rt--)yt.push(lt.path[Rt]);for(let Rt=1;Rt<ht.path.length;Rt++)yt.push(ht.path[Rt]);const ct=2.5*it;m&&(yt=yt.map(([Rt,Vt,jt],$t)=>(R&&!L&&(jt=R($t<mt-1?lt.tilePath[mt-1-$t]:ht.tilePath[$t-mt+2])[2]),ba(Rt,Vt,jt,m))),yt.some(Rt=>Rt[3]<=0)&&(yt=[]));let ft=[];if(yt.length>0){let Rt=1/0,Vt=-1/0,jt=1/0,$t=-1/0;for(const re of yt)Rt=Math.min(Rt,re[0]),jt=Math.min(jt,re[1]),Vt=Math.max(Vt,re[0]),$t=Math.max($t,re[1]);Vt>=X.x&&Rt<=Y.x&&$t>=X.y&&jt<=Y.y&&(ft=[yt.map(re=>new nt(re[0],re[1]))],(Rt<X.x||Vt>Y.x||jt<X.y||$t>Y.y)&&(ft=Ts(ft,X.x,X.y,Y.x,Y.y)))}for(const Rt of ft){ot.reset(Rt,.25*it);let Vt=0;Vt=ot.length<=.5*it?1:Math.ceil(ot.paddedLength/ct)+1;for(let jt=0;jt<Vt;jt++){const $t=jt/Math.max(Vt-1,1),re=ot.lerp($t),ye=re.x+ol,je=re.y+ol;S.push(ye,je,it,0);const rn=ye-it,Re=je-it,Me=ye+it,ge=je+it;if(tt=tt&&this.isOffscreen(rn,Re,Me,ge),Z=Z||this.isInsideGrid(rn,Re,Me,ge),!r&&this.grid.hitTestCircle(ye,je,it,v)&&(j=!0,!_))return{circles:[],offscreen:!1,collisionDetected:j,occluded:!1}}}}return{circles:!_&&j||!Z?[]:S,offscreen:tt,collisionDetected:j,occluded:N.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let s=1/0,l=1/0,c=-1/0,d=-1/0;for(const _ of t){const y=new nt(_.x+ol,_.y+ol);s=Math.min(s,y.x),l=Math.min(l,y.y),c=Math.max(c,y.x),d=Math.max(d,y.y),r.push(y)}const h=this.grid.query(s,l,c,d).concat(this.ignoredGrid.query(s,l,c,d)),p={},m={};for(const _ of h){const y=_.key;void 0===p[y.bucketInstanceId]&&(p[y.bucketInstanceId]={}),p[y.bucketInstanceId][y.featureIndex]||Gh(r,[new nt(_.x1,_.y1),new nt(_.x2,_.y1),new nt(_.x2,_.y2),new nt(_.x1,_.y2)])&&(p[y.bucketInstanceId][y.featureIndex]=!0,void 0===m[y.bucketInstanceId]&&(m[y.bucketInstanceId]=[]),m[y.bucketInstanceId].push(y.featureIndex))}return m}insertCollisionBox(t,r,s,l,c){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:l,collisionGroupID:c},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,s,l,c){const d=r?this.ignoredGrid:this.grid,h={bucketInstanceId:s,featureIndex:l,collisionGroupID:c};for(let p=0;p<t.length;p+=4)d.insertCircle(h,t[p],t[p+1],t[p+2])}projectAndGetPerspectiveRatio(t,r,s,l,c,d,h){const p=[r,s,l,1];let m=!1;l||this.transform.pitch>0?(Fn.transformMat4(p,p,t),this.fogState&&c&&"globe"!==h.name&&(m=function(v,b,E,C,S,M){const D=M.calculateFogTileMatrix(S),R=[b,E,C];return q.transformMat4(R,R,D),Wm(v,q.length(R),M.pitch,M._fov)}(this.fogState,r,s,l,c.toUnwrapped(),this.transform)>.9)):jb(p,p,t);const _=p[3];return{point:new nt((p[0]/_+1)/2*this.transform.width+ol,(-p[1]/_+1)/2*this.transform.height+ol),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(h)/_*.5,1.5),signedDistanceFromCamera:_,occluded:d&&p[2]>_||m}}isOffscreen(t,r,s,l){return s<ol||t>=this.screenRightBoundary||l<ol||r>this.screenBottomBoundary}isInsideGrid(t,r,s,l){return s>=0&&t<this.gridRightBoundary&&l>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=rt.identity([]);return rt.translate(t,t,[-100,-100,0]),t}}function og(n,t,r){const s=t.createTileMatrix(n,n.worldSize,r.toUnwrapped());return rt.multiply(new Float32Array(16),n.projMatrix,s)}function gR(n,t,r){if(t.projection.name===r.projection.name)return n.projMatrix;const s=r.clone();return s.setProjection(t.projection),og(s,t.getProjection(),n)}function av(n,t,r){return t.name===r.projection.name?n.projMatrix:og(r,t,n)}class g1{constructor(t,r,s,l){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):l&&s?1:0,this.placed=s}isHidden(){return 0===this.opacity&&!this.placed}}class sg{constructor(t,r,s,l,c,d=!1){this.text=new g1(t?t.text:null,r,s,c),this.icon=new g1(t?t.icon:null,r,l,c),this.clipped=d}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _1{constructor(t,r,s,l=!1){this.text=t,this.icon=r,this.skipFade=s,this.clipped=l}}class _R{constructor(){this.invProjMatrix=rt.create(),this.viewportMatrix=rt.create(),this.circles=[]}}class y1{constructor(t,r,s,l,c){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=s,this.bucketIndex=l,this.tileID=c}}class yR{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:s=>s.collisionGroupID===r}}return this.collisionGroups[t]}}function v1(n,t,r,s,l){const{horizontalAlign:c,verticalAlign:d}=My(n),h=-(c-.5)*t,p=-(d-.5)*r,m=bm(n,s);return new nt(h+m[0]*l,p+m[1]*l)}function x1(n,t,r,s,l){const c=new nt(n,t);return r&&c._rotate(s?l:-l),c}class vR{constructor(t,r,s,l,c,d){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new mR(this.transform,c),this.buildingIndex=d,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new yR(s),this.collisionCircleArrays={},this.prevPlacement=l,l&&(l.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,s,l){const c=s.getBucket(r),d=s.latestFeatureIndex;if(!c||!d||r.fqid!==c.layerIds[0])return;const h=c.layers[0].layout,p=s.collisionBoxArray,m=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),_=s.tileSize/dt,y=s.tileID.toUnwrapped();this.transform.setProjection(c.projection);const v=(b=s.tileID,E=c.getProjection(),C=this.transform,E.name===this.projection?C.calculateProjMatrix(b.toUnwrapped()):og(C,E,b));var b,E,C;const S="map"===h.get("text-pitch-alignment"),M="map"===h.get("text-rotation-alignment");r.compileFilter();const D=r.dynamicFilter(),R=r.dynamicFilterNeedsFeature(),P=this.transform.calculatePixelsToTileUnitsMatrix(s),I=Zy(v,s.tileID.canonical,S,M,this.transform,c.getProjection(),P);let O=null;if(S){const N=zb(v,s.tileID.canonical,S,M,this.transform,c.getProjection(),P);O=rt.multiply([],this.transform.labelPlaneMatrix,N)}let F=null;D&&s.latestFeatureIndex&&(F={unwrappedTileID:y,dynamicFilter:D,dynamicFilterNeedsFeature:R,featureIndex:s.latestFeatureIndex}),this.retainedQueryData[c.bucketInstanceId]=new y1(c.bucketInstanceId,d,c.sourceLayerIndex,c.index,s.tileID);const L={bucket:c,layout:h,posMatrix:v,textLabelPlaneMatrix:I,labelToScreenMatrix:O,clippingData:F,scale:m,textPixelRatio:_,holdingForFade:s.holdingForFade(),collisionBoxArray:p,partiallyEvaluatedTextSize:Ic(c.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Ic(c.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(c.sourceID)};if(l)for(const N of c.sortKeyRanges){const{sortKey:z,symbolInstanceStart:U,symbolInstanceEnd:V}=N;t.push({sortKey:z,symbolInstanceStart:U,symbolInstanceEnd:V,parameters:L})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:c.symbolInstances.length,parameters:L})}attemptAnchorPlacement(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D){const{textOffset0:R,textOffset1:P,crossTileID:I}=v,O=[R,P],F=v1(t,s,l,O,c),L=this.collisionIndex.placeCollisionBox(E,c,r,x1(F.x,F.y,d,h,this.transform.angle),y,p,m,_.predicate);if(S){const N=E.getSymbolInstanceIconSize(D,this.transform.zoom,v.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(E,N,S,x1(F.x,F.y,d,h,this.transform.angle),y,p,m,_.predicate).box.length)return}if(L.box.length>0){let N;return this.prevPlacement&&this.prevPlacement.variableOffsets[I]&&this.prevPlacement.placements[I]&&this.prevPlacement.placements[I].text&&(N=this.prevPlacement.variableOffsets[I].anchor),this.variableOffsets[I]={textOffset:O,width:s,height:l,anchor:t,textScale:c,prevAnchor:N},this.markUsedJustification(E,t,v,C),E.allowVerticalPlacement&&(this.markUsedOrientation(E,C,v),this.placedOrientations[I]=C),{shift:F,placedGlyphBoxes:L}}}placeLayerBucketPart(t,r,s,l){const{bucket:c,layout:d,posMatrix:h,textLabelPlaneMatrix:p,labelToScreenMatrix:m,clippingData:_,textPixelRatio:y,holdingForFade:v,collisionBoxArray:b,partiallyEvaluatedTextSize:E,partiallyEvaluatedIconSize:C,collisionGroup:S}=t.parameters,M=d.get("text-optional"),D=d.get("icon-optional"),R=d.get("text-allow-overlap"),P=d.get("icon-allow-overlap"),I="map"===d.get("text-rotation-alignment"),O="map"===d.get("text-pitch-alignment"),F="viewport-y"===d.get("symbol-z-order"),L=d.get("symbol-z-elevate");this.transform.setProjection(c.projection);let N=R&&(P||!c.hasIconData()||D),z=P&&(R||!c.hasTextData()||M);!c.collisionArrays&&b&&c.deserializeCollisionBoxes(b),s&&l&&c.updateCollisionDebugBuffers(this.transform.zoom,b);const U=(V,H,j)=>{const{crossTileID:Z,numVerticalGlyphVertices:tt}=V;if(_){const Me={zoom:this.transform.zoom,pitch:this.transform.pitch};let ge=null;if(_.dynamicFilterNeedsFeature){const ue=this.retainedQueryData[c.bucketInstanceId];ge=_.featureIndex.loadFeature({featureIndex:V.featureIndex,bucketIndex:ue.bucketIndex,sourceLayerIndex:ue.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,_.dynamicFilter)(Me,ge,this.retainedQueryData[c.bucketInstanceId].tileID.canonical,new nt(V.tileAnchorX,V.tileAnchorY),this.transform.calculateDistanceTileData(_.unwrappedTileID)))return this.placements[Z]=new _1(!1,!1,!1,!0),void r.add(Z)}if(r.has(Z))return;if(v)return void(this.placements[Z]=new _1(!1,!1,!1));let it=!1,X=!1,Y=!0,ot=!1,lt=!1,ht=null,mt={box:null,offscreen:null,occluded:null},yt={box:null,offscreen:null,occluded:null},ct=null,ft=null,Rt=null,Vt=0,jt=0,$t=0;j.textFeatureIndex?Vt=j.textFeatureIndex:V.useRuntimeCollisionCircles&&(Vt=V.featureIndex),j.verticalTextFeatureIndex&&(jt=j.verticalTextFeatureIndex);const re=Me=>{Me.tileID=this.retainedQueryData[c.bucketInstanceId].tileID;const ge=this.transform.elevation;Me.elevation=V.zOffset+(ge?ge.getAtTileOffset(Me.tileID,Me.tileAnchorX,Me.tileAnchorY):0)},ye=j.textBox;if(ye){re(ye);const Me=ue=>{let Le=ti.horizontal;if(c.allowVerticalPlacement&&!ue&&this.prevPlacement){const an=this.prevPlacement.placedOrientations[Z];an&&(this.placedOrientations[Z]=an,Le=an,this.markUsedOrientation(c,Le,V))}return Le},ge=(ue,Le)=>{if(c.allowVerticalPlacement&&tt>0&&j.verticalTextBox){for(const an of c.writingModes)if(an===ti.vertical?(mt=Le(),yt=mt):mt=ue(),mt&&mt.box&&mt.box.length)break}else mt=ue()};if(d.get("text-variable-anchor")){let ue=d.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z]){const Be=this.prevPlacement.variableOffsets[Z];ue.indexOf(Be.anchor)>0&&(ue=ue.filter(Zn=>Zn!==Be.anchor),ue.unshift(Be.anchor))}const Le=(Be,Zn,Si)=>{const ui=c.getSymbolInstanceTextSize(E,V,this.transform.zoom,H),ei=(Be.x2-Be.x1)*ui+2*Be.padding,cr=(Be.y2-Be.y1)*ui+2*Be.padding,_i=V.hasIconTextFit&&!P?Zn:null;_i&&re(_i);let di={box:[],offscreen:!1,occluded:!1};const Hn=R?2*ue.length:ue.length;for(let Ko=0;Ko<Hn;++Ko){const al=this.attemptAnchorPlacement(ue[Ko%ue.length],Be,ei,cr,ui,I,O,y,h,S,Ko>=ue.length,V,H,c,Si,_i,E,C);if(al&&(di=al.placedGlyphBoxes,di&&di.box&&di.box.length)){it=!0,ht=al.shift;break}}return di};ge(()=>Le(ye,j.iconBox,ti.horizontal),()=>{const Be=j.verticalTextBox;return Be&&re(Be),c.allowVerticalPlacement&&!(mt&&mt.box&&mt.box.length)&&tt>0&&Be?Le(Be,j.verticalIconBox,ti.vertical):{box:null,offscreen:null,occluded:null}}),mt&&(it=mt.box,Y=mt.offscreen,ot=mt.occluded);const an=Me(!(!mt||!mt.box));if(!it&&this.prevPlacement){const Be=this.prevPlacement.variableOffsets[Z];Be&&(this.variableOffsets[Z]=Be,this.markUsedJustification(c,Be.anchor,V,an))}}else{const ue=(Le,an)=>{const Be=c.getSymbolInstanceTextSize(E,V,this.transform.zoom,H),Zn=this.collisionIndex.placeCollisionBox(c,Be,Le,new nt(0,0),R,y,h,S.predicate);return Zn&&Zn.box&&Zn.box.length&&(this.markUsedOrientation(c,an,V),this.placedOrientations[Z]=an),Zn};ge(()=>ue(ye,ti.horizontal),()=>{const Le=j.verticalTextBox;return c.allowVerticalPlacement&&tt>0&&Le?(re(Le),ue(Le,ti.vertical)):{box:null,offscreen:null,occluded:null}}),Me(!!(mt&&mt.box&&mt.box.length))}}if(ct=mt,it=ct&&ct.box&&ct.box.length>0,Y=ct&&ct.offscreen,ot=ct&&ct.occluded,V.useRuntimeCollisionCircles){const Me=c.text.placedSymbolArray.get(V.centerJustifiedTextSymbolIndex>=0?V.centerJustifiedTextSymbolIndex:V.verticalPlacedTextSymbolIndex),ge=ym(c.textSizeData,E,Me),ue=d.get("text-padding");ft=this.collisionIndex.placeCollisionCircles(c,R,Me,c.lineVertexArray,c.glyphOffsetArray,ge,h,p,m,s,O,S.predicate,V.collisionCircleDiameter*ge/kr,ue,this.retainedQueryData[c.bucketInstanceId].tileID),it=R||ft.circles.length>0&&!ft.collisionDetected,Y=Y&&ft.offscreen,ot=ft.occluded}if(j.iconFeatureIndex&&($t=j.iconFeatureIndex),j.iconBox){const Me=ge=>{re(ge);const ue=V.hasIconTextFit&&ht?x1(ht.x,ht.y,I,O,this.transform.angle):new nt(0,0),Le=c.getSymbolInstanceIconSize(C,this.transform.zoom,V.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(c,Le,ge,ue,P,y,h,S.predicate)};yt&&yt.box&&yt.box.length&&j.verticalIconBox?(Rt=Me(j.verticalIconBox),X=Rt.box.length>0):(Rt=Me(j.iconBox),X=Rt.box.length>0),Y=Y&&Rt.offscreen,lt=Rt.occluded}const je=M||0===V.numHorizontalGlyphVertices&&0===tt,rn=D||0===V.numIconVertices;if(je||rn?rn?je||(X=X&&it):it=X&&it:X=it=X&&it,it&&ct&&ct.box&&this.collisionIndex.insertCollisionBox(ct.box,d.get("text-ignore-placement"),c.bucketInstanceId,yt&&yt.box&&jt?jt:Vt,S.ID),X&&Rt&&this.collisionIndex.insertCollisionBox(Rt.box,d.get("icon-ignore-placement"),c.bucketInstanceId,$t,S.ID),ft&&(it&&this.collisionIndex.insertCollisionCircles(ft.circles,d.get("text-ignore-placement"),c.bucketInstanceId,Vt,S.ID),s)){const Me=c.bucketInstanceId;let ge=this.collisionCircleArrays[Me];void 0===ge&&(ge=this.collisionCircleArrays[Me]=new _R);for(let ue=0;ue<ft.circles.length;ue+=4)ge.circles.push(ft.circles[ue+0]),ge.circles.push(ft.circles[ue+1]),ge.circles.push(ft.circles[ue+2]),ge.circles.push(ft.collisionDetected?1:0)}const Re="globe"!==c.projection.name;N=N&&(Re||!ot),z=z&&(Re||!lt),this.placements[Z]=new _1(it||N,X||z,Y||c.justReloaded),r.add(Z)};if(L&&this.buildingIndex&&(this.buildingIndex.updateZOffset(c,this.retainedQueryData[c.bucketInstanceId].tileID),c.updateZOffset()),F){const V=c.getSortedSymbolIndexes(this.transform.angle);for(let H=V.length-1;H>=0;--H){const j=V[H];U(c.symbolInstances.get(j),j,c.collisionArrays[j])}c.hasAnyZOffset&&Q(`${c.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(c.hasAnyZOffset){const V=c.getSortedIndexesByZOffset();for(let H=0;H<V.length;++H){const j=V[H];U(c.symbolInstances.get(j),j,c.collisionArrays[j])}}else for(let V=t.symbolInstanceStart;V<t.symbolInstanceEnd;V++)U(c.symbolInstances.get(V),V,c.collisionArrays[V]);if(s&&c.bucketInstanceId in this.collisionCircleArrays){const V=this.collisionCircleArrays[c.bucketInstanceId];rt.invert(V.invProjMatrix,h),V.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,r,s,l){const{leftJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,rightJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:p,crossTileID:m}=s,_=Iy(r),y=l===ti.vertical?p:"left"===_?c:"center"===_?d:"right"===_?h:-1;c>=0&&(t.text.placedSymbolArray.get(c).crossTileID=y>=0&&c!==y?0:m),d>=0&&(t.text.placedSymbolArray.get(d).crossTileID=y>=0&&d!==y?0:m),h>=0&&(t.text.placedSymbolArray.get(h).crossTileID=y>=0&&h!==y?0:m),p>=0&&(t.text.placedSymbolArray.get(p).crossTileID=y>=0&&p!==y?0:m)}markUsedOrientation(t,r,s){const l=r===ti.horizontal||r===ti.horizontalOnly?r:0,c=r===ti.vertical?r:0,{leftJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:h,rightJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:m}=s,_=t.text.placedSymbolArray;d>=0&&(_.get(d).placedOrientation=l),h>=0&&(_.get(h).placedOrientation=l),p>=0&&(_.get(p).placedOrientation=l),m>=0&&(_.get(m).placedOrientation=c)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let s=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const l=r?r.symbolFadeChange(t):1,c=r?r.opacities:{},d=r?r.variableOffsets:{},h=r?r.placedOrientations:{};for(const p in this.placements){const m=this.placements[p],_=c[p];_?(this.opacities[p]=new sg(_,l,m.text,m.icon,null,m.clipped),s=s||m.text!==_.text.placed||m.icon!==_.icon.placed):(this.opacities[p]=new sg(null,l,m.text,m.icon,m.skipFade,m.clipped),s=s||m.text||m.icon)}for(const p in c){const m=c[p];if(!this.opacities[p]){const _=new sg(m,l,!1,!1);_.isHidden()||(this.opacities[p]=_,s=s||m.text.placed||m.icon.placed)}}for(const p in d)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=d[p]);for(const p in h)this.placedOrientations[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.placedOrientations[p]=h[p]);s?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const s=new Set;for(const l of r){const c=l.getBucket(t);c&&l.latestFeatureIndex&&t.fqid===c.layerIds[0]&&(this.updateBucketOpacities(c,s,l.collisionBoxArray),c.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(c,l.tileID),c.updateZOffset()))}}updateBucketOpacities(t,r,s){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const l=t.layers[0].layout,c=!!t.layers[0].dynamicFilter(),d=new sg(null,0,!1,!1,!0),h=l.get("text-allow-overlap"),p=l.get("icon-allow-overlap"),m=l.get("text-variable-anchor"),_="map"===l.get("text-rotation-alignment"),y="map"===l.get("text-pitch-alignment"),v=new sg(null,0,h&&(p||!t.hasIconData()||l.get("icon-optional")),p&&(h||!t.hasTextData()||l.get("text-optional")),!0);!t.collisionArrays&&s&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(s);const b=(C,S,M)=>{for(let D=0;D<S/4;D++)C.opacityVertexArray.emplaceBack(M)};let E=0;for(let C=0;C<t.symbolInstances.length;C++){const S=t.symbolInstances.get(C),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:D,crossTileID:R,numIconVertices:P}=S,I=r.has(R);let O=this.opacities[R];I?O=d:O||(O=v,this.opacities[R]=O),r.add(R);const F=M>0||D>0,L=P>0,N=this.placedOrientations[R],z=N===ti.vertical,U=N===ti.horizontal||N===ti.horizontalOnly;if(!F&&!L||O.isHidden()||E++,F){const V=hT(O.text);b(t.text,M,z?cv:V),b(t.text,D,U?cv:V);const H=O.text.isHidden(),{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:Z,rightJustifiedTextSymbolIndex:tt,verticalPlacedTextSymbolIndex:it}=S,X=t.text.placedSymbolArray,Y=H||z?1:0;j>=0&&(X.get(j).hidden=Y),Z>=0&&(X.get(Z).hidden=Y),tt>=0&&(X.get(tt).hidden=Y),it>=0&&(X.get(it).hidden=H||U?1:0);const ot=this.variableOffsets[R];ot&&this.markUsedJustification(t,ot.anchor,S,N);const lt=this.placedOrientations[R];lt&&(this.markUsedJustification(t,"left",S,lt),this.markUsedOrientation(t,lt,S))}if(L){const V=hT(O.icon),{placedIconSymbolIndex:H,verticalPlacedIconSymbolIndex:j}=S,Z=t.icon.placedSymbolArray,tt=O.icon.isHidden()?1:0;H>=0&&(b(t.icon,P,z?cv:V),Z.get(H).hidden=tt),j>=0&&(b(t.icon,S.numVerticalIconVertices,U?cv:V),Z.get(j).hidden=tt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const V=t.collisionArrays[C];if(V){let H=new nt(0,0),j=!0;if(V.textBox||V.verticalTextBox){if(m){const tt=this.variableOffsets[R];tt?(H=v1(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textScale),_&&H._rotate(y?this.transform.angle:-this.transform.angle)):j=!1}c&&(j=!O.clipped),V.textBox&&lv(t.textCollisionBox.collisionVertexArray,O.text.placed,!j||z,H.x,H.y),V.verticalTextBox&&lv(t.textCollisionBox.collisionVertexArray,O.text.placed,!j||U,H.x,H.y)}const Z=j&&!(U||!V.verticalIconBox);V.iconBox&&lv(t.iconCollisionBox.collisionVertexArray,O.icon.placed,Z,S.hasIconTextFit?H.x:0,S.hasIconTextFit?H.y:0),V.verticalIconBox&&lv(t.iconCollisionBox.collisionVertexArray,O.icon.placed,!Z,S.hasIconTextFit?H.x:0,S.hasIconTextFit?H.y:0)}}}if(t.fullyClipped=0===E,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const C=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=C.invProjMatrix,t.placementViewportMatrix=C.viewportMatrix,t.collisionCircleArray=C.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const s=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*s>t}setStale(){this.stale=!0}}function lv(n,t,r,s,l){n.emplaceBack(t?1:0,r?1:0,s||0,l||0),n.emplaceBack(t?1:0,r?1:0,s||0,l||0),n.emplaceBack(t?1:0,r?1:0,s||0,l||0),n.emplaceBack(t?1:0,r?1:0,s||0,l||0)}const xR=Math.pow(2,25),bR=Math.pow(2,24),wR=Math.pow(2,17),ER=Math.pow(2,16),CR=Math.pow(2,9),uT=Math.pow(2,8),dT=Math.pow(2,1);function hT(n){if(0===n.opacity&&!n.placed)return 0;if(1===n.opacity&&n.placed)return 4294967295;const t=n.placed?1:0,r=Math.floor(127*n.opacity);return r*xR+t*bR+r*wR+t*ER+r*CR+t*uT+r*dT+t}const cv=0;class fT{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,s,l,c){const d=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(d,l,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,c())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,d.sort((h,p)=>h.sortKey-p.sortKey));this._currentPartIndex<d.length;){const h=d[this._currentPartIndex];if(r.placeLayerBucketPart(h,this._seenCrossTileIDs,s,0===h.symbolInstanceStart),this._currentPartIndex++,c())return!0}return!1}}class MR{constructor(t,r,s,l,c,d,h,p,m){this.placement=new vR(t,c,d,h,p,m),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=l,this._done=!1}isDone(){return this._done}continuePlacement(t,r,s,l){const c=kt.now(),d=()=>{const h=kt.now()-c;return!this._forceFullPlacement&&h>2};for(;this._currentPlacementIndex>=0;){const h=r[t[this._currentPlacementIndex]],p=this.placement.collisionIndex.transform.zoom;if("symbol"===h.type&&(!h.minzoom||h.minzoom<=p)&&(!h.maxzoom||h.maxzoom>p)){const m=h,_=m.layout.get("symbol-z-elevate"),y=this._inProgressLayer=this._inProgressLayer||new fT(m),v=Kr(h.source,h.scope);if(y.continuePlacement(_?l[v]:s[v],this.placement,this._showCollisionBoxes,h,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const pT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uv{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(219!==r)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(1!==l)throw new Error(`Got v${l} data when expected v1.`);const c=pT[15&s];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,2,1),[h]=new Uint32Array(t,4,1);return new uv(h,d,c,t)}constructor(t,r=64,s=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const c=pT.indexOf(this.ArrayType),d=2*t*this.ArrayType.BYTES_PER_ELEMENT,h=t*this.IndexArrayType.BYTES_PER_ELEMENT,p=(8-h%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+h+p,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+d+h+p),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+h+p,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return b1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:h}=this,p=[0,c.length-1,0],m=[];for(;p.length;){const _=p.pop()||0,y=p.pop()||0,v=p.pop()||0;if(y-v<=h){for(let S=v;S<=y;S++){const M=d[2*S],D=d[2*S+1];M>=t&&M<=s&&D>=r&&D<=l&&m.push(c[S])}continue}const b=v+y>>1,E=d[2*b],C=d[2*b+1];E>=t&&E<=s&&C>=r&&C<=l&&m.push(c[b]),(0===_?t<=E:r<=C)&&(p.push(v),p.push(b-1),p.push(1-_)),(0===_?s>=E:l>=C)&&(p.push(b+1),p.push(y),p.push(1-_))}return m}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:c,nodeSize:d}=this,h=[0,l.length-1,0],p=[],m=s*s;for(;h.length;){const _=h.pop()||0,y=h.pop()||0,v=h.pop()||0;if(y-v<=d){for(let S=v;S<=y;S++)fv(c[2*S],c[2*S+1],t,r)<=m&&p.push(l[S]);continue}const b=v+y>>1,E=c[2*b],C=c[2*b+1];fv(E,C,t,r)<=m&&p.push(l[b]),(0===_?t-s<=E:r-s<=C)&&(h.push(v),h.push(b-1),h.push(1-_)),(0===_?t+s>=E:r+s>=C)&&(h.push(b+1),h.push(y),h.push(1-_))}return p}}function b1(n,t,r,s,l,c){if(l-s<=r)return;const d=s+l>>1;dv(n,t,d,s,l,c),b1(n,t,r,s,d-1,1-c),b1(n,t,r,d+1,l,1-c)}function dv(n,t,r,s,l,c){for(;l>s;){if(l-s>600){const m=l-s+1,_=r-s+1,y=Math.log(m),v=.5*Math.exp(2*y/3),b=.5*Math.sqrt(y*v*(m-v)/m)*(_-m/2<0?-1:1);dv(n,t,r,Math.max(s,Math.floor(r-_*v/m+b)),Math.min(l,Math.floor(r+(m-_)*v/m+b)),c)}const d=t[2*r+c];let h=s,p=l;for(Fd(n,t,s,r),t[2*l+c]>d&&Fd(n,t,s,l);h<p;){for(Fd(n,t,h,p),h++,p--;t[2*h+c]<d;)h++;for(;t[2*p+c]>d;)p--}t[2*s+c]===d?Fd(n,t,s,p):(p++,Fd(n,t,p,l)),p<=r&&(s=p+1),r<=p&&(l=p-1)}}function Fd(n,t,r,s){hv(n,r,s),hv(t,2*r,2*s),hv(t,2*r+1,2*s+1)}function hv(n,t,r){const s=n[t];n[t]=n[r],n[r]=s}function fv(n,t,r,s){const l=n-r,c=t-s;return l*l+c*c}const w1=512/dt/2;class SR{constructor(t,r,s){this.tileID=t,this.bucketInstanceId=s,this.index=new uv(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const l=t.canonical.x*dt,c=t.canonical.y*dt;for(let d=0;d<r.length;d++){const{key:h,crossTileID:p,tileAnchorX:m,tileAnchorY:_}=r.get(d),y=Math.floor((l+m)*w1),v=Math.floor((c+_)*w1);this.index.add(y,v),this.keys.push(h),this.crossTileIDs.push(p)}this.index.finish()}findMatches(t,r,s){const l=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),c=w1/Math.pow(2,r.canonical.z-this.tileID.canonical.z),d=r.canonical.x*dt,h=r.canonical.y*dt;for(let p=0;p<t.length;p++){const m=t.get(p);if(m.crossTileID)continue;const{key:_,tileAnchorX:y,tileAnchorY:v}=m,b=Math.floor((d+y)*c),E=Math.floor((h+v)*c),C=this.index.range(b-l,E-l,b+l,E+l);for(const S of C){const M=this.crossTileIDs[S];if(this.keys[S]===_&&!s.has(M)){s.add(M),m.crossTileID=M;break}}}}}class E1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class TR{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(0!==r)for(const s in this.indexes){const l=this.indexes[s],c={};for(const d in l){const h=l[d];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+r),c[h.tileID.key]=h}this.indexes[s]=c}this.lng=t}addBucket(t,r,s){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let c=0;c<r.symbolInstances.length;c++)r.symbolInstances.get(c).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const l=this.usedCrossTileIDs[t.overscaledZ];for(const c in this.indexes){const d=this.indexes[c];if(Number(c)>t.overscaledZ)for(const h in d){const p=d[h];p.tileID.isChildOf(t)&&p.findMatches(r.symbolInstances,t,l)}else{const h=d[t.scaledTo(Number(c)).key];h&&h.findMatches(r.symbolInstances,t,l)}}for(let c=0;c<r.symbolInstances.length;c++){const d=r.symbolInstances.get(c);d.crossTileID||(d.crossTileID=s.generate(),l.add(d.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new SR(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const s of r.crossTileIDs)this.usedCrossTileIDs[t].delete(s)}removeStaleBuckets(t){let r=!1;for(const s in this.indexes){const l=this.indexes[s];for(const c in l)t[l[c].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,l[c]),delete l[c],r=!0)}return r}}class Ji{constructor(){this.layerIndexes={},this.crossTileIDs=new E1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,s,l){let c=this.layerIndexes[t.fqid];void 0===c&&(c=this.layerIndexes[t.fqid]=new TR);let d=!1;const h={};"globe"!==l.name&&c.handleWrapJump(s);for(const p of r){const m=p.getBucket(t);m&&t.fqid===m.layerIds[0]&&(m.bucketInstanceId||(m.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(p.tileID,m,this.crossTileIDs)&&(d=!0),h[m.bucketInstanceId]=!0)}return c.removeStaleBuckets(h)&&(d=!0),d}pruneUnusedLayers(t){const r={};t.forEach(s=>{r[s]=!0});for(const s in this.layerIndexes)r[s]||delete this.layerIndexes[s]}}var Ou="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\n{return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn)\n{return pow(srgbIn,vec3(2.2));}vec3 linearProduct(vec3 srgbIn,vec3 k)\n{return srgbIn*pow(k,vec3(1./2.2));}\n#if __VERSION__ >=300\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define _HANDLE_WIREFRAME_DEPTH\n#endif\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\n_HANDLE_WIREFRAME_DEPTH;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",C1="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",mT="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",DR="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",pv="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",mv="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",gT="#ifdef RENDER_SHADOWS\n#if defined(NATIVE) && __VERSION__ >=300\n#define TEXTURE_GATHER\n#endif\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const M1=[];ag(Ou,M1);const Af={"_prelude_fog.vertex.glsl":DR,"_prelude_terrain.vertex.glsl":mT,"_prelude_shadow.vertex.glsl":mv,"_prelude_fog.fragment.glsl":pv,"_prelude_shadow.fragment.glsl":gT,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE"},gv={};Mn("",mT),Mn(pv,DR),Mn(gT,mv);const S1=Mn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),_v=Ou;var T1={background:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;varying vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Mn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Mn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Mn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Mn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#if __VERSION__ >=300\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:Mn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nvarying highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Mn('#include "_prelude_shadow.fragment.glsl"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 u_ground_shadow_factor;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\ngl_FragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;attribute vec2 a_pos;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Mn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\ngl_FragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\ngl_FragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nattribute highp vec4 a_pos_end;attribute highp float a_angular_offset_factor;attribute highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Mn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture(u_image,coord).r/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec2 u_colorization_scale;uniform highp vec4 u_colorization_mix;highp vec4 colormap (highp float value) {highp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;highp vec2 coords=vec2(scaled_value,0.5);return texture2D(u_color_ramp,coords);}\n#endif\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);vec4 color;\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);color=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;if (color.a > 0.0) {color.rgb/=color.a;}\n#else\nif (color0.a > 0.0) {color0.rgb/=color0.a;}if (color1.a > 0.0) {color1.rgb/=color1.a;}color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_ground(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;attribute vec2 a_texture_pos;\n#endif\nvarying vec2 v_pos0;varying vec2 v_pos1;void main() {vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),symbolIcon:Mn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nvarying float v_fade_opacity;varying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture2D(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nattribute vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\nvarying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Mn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Mn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture2D(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:Mn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Mn('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',C1),skyboxGradient:Mn('#include "_prelude_fog.fragment.glsl"\nvarying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',C1),skyboxCapture:Mn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Mn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\ngl_FragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\n#else\ngl_FragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);gl_FragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\ngl_FragColor=vec4(c*t,t);\n#endif\n}',"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Mn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;varying highp vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\nconst float M_PI=3.141592653589793;\n#define saturate(_x) clamp(_x,0.,1.)\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(M_PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/M_PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\ngl_FragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nattribute vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\nvarying vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\nvoid main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Mn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}","attribute vec3 a_pos_3f;uniform mat4 u_matrix;varying highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Mn("varying highp vec2 v_uv;varying mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;gl_FragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;varying highp vec2 v_uv;varying mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function ag(n,t){const r=n.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let s of r)if(s=s.trim(),"#"===s[0]&&s.includes("if")&&!s.includes("endif")){s=s.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const l=s.split(" ");for(const c of l)t.includes(c)||t.push(c)}}function Mn(n,t){const r=/#include\s+"([^"]+)"/g,s=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let l=t.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);l&&(l=l.filter((m,_)=>l.indexOf(m)===_));const c={},d=[],h=[];n=n.replace(r,(m,_)=>(h.push(_),"")),t=t.replace(r,(m,_)=>(d.push(_),""));let p=[...M1];ag(n,p),ag(t,p);for(const m of[...d,...h])Af[m]||console.error(`Undefined include: ${m}`),gv[m]||(gv[m]=[],ag(Af[m],gv[m])),p=[...p,...gv[m]];return{fragmentSource:n=n.replace(s,(m,_,y,v,b)=>(c[b]=!0,"define"===_?`\n#ifndef HAS_UNIFORM_u_${b}\nvarying ${y} ${v} ${b};\n#else\nuniform ${y} ${v} u_${b};\n#endif\n`:"initialize"===_?`\n#ifdef HAS_UNIFORM_u_${b}\n    ${y} ${v} ${b} = u_${b};\n#endif\n`:"define-attribute"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\n    varying ${y} ${v} ${b};\n#endif\n`:"initialize-attribute"===_?"":void 0)),vertexSource:t=t.replace(s,(m,_,y,v,b)=>{const E="float"===v?"vec2":v,C=b.match(/color/)?"color":E;return"define-attribute-vertex-shader-only"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\nattribute ${y} ${v} a_${b};\n#endif\n`:c[b]?"define"===_?`\n#ifndef HAS_UNIFORM_u_${b}\nuniform lowp float u_${b}_t;\nattribute ${y} ${E} a_${b};\nvarying ${y} ${v} ${b};\n#else\nuniform ${y} ${v} u_${b};\n#endif\n`:"initialize"===_?"vec4"===C?`\n#ifndef HAS_UNIFORM_u_${b}\n    ${b} = a_${b};\n#else\n    ${y} ${v} ${b} = u_${b};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${b}\n    ${b} = unpack_mix_${C}(a_${b}, u_${b}_t);\n#else\n    ${y} ${v} ${b} = u_${b};\n#endif\n`:"define-attribute"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\n    attribute ${y} ${v} a_${b};\n    varying ${y} ${v} ${b};\n#endif\n`:"initialize-attribute"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\n    ${b} = a_${b};\n#endif\n`:void 0:"define"===_?`\n#ifndef HAS_UNIFORM_u_${b}\nuniform lowp float u_${b}_t;\nattribute ${y} ${E} a_${b};\n#else\nuniform ${y} ${v} u_${b};\n#endif\n`:"define-instanced"===_?"mat4"===C?`\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_${b}0;\nattribute vec4 a_${b}1;\nattribute vec4 a_${b}2;\nattribute vec4 a_${b}3;\n#else\nuniform ${y} ${v} u_${b};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nattribute ${y} ${E} a_${b};\n#else\nuniform ${y} ${v} u_${b};\n#endif\n`:"initialize-attribute-custom"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\n    ${y} ${v} ${b} = a_${b};\n#endif\n`:"vec4"===C?`\n#ifndef HAS_UNIFORM_u_${b}\n    ${y} ${v} ${b} = a_${b};\n#else\n    ${y} ${v} ${b} = u_${b};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${b}\n    ${y} ${v} ${b} = unpack_mix_${C}(a_${b}, u_${b}_t);\n#else\n    ${y} ${v} ${b} = u_${b};\n#endif\n`}),staticAttributes:l,usedDefines:p,vertexIncludes:d,fragmentIncludes:h}}class _T{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,s,l,c,d,h,p){this.context=t;let m=this.boundPaintVertexBuffers.length!==l.length;for(let y=0;!m&&y<l.length;y++)this.boundPaintVertexBuffers[y]!==l[y]&&(m=!0);let _=this.boundDynamicVertexBuffers.length!==h.length;for(let y=0;!_&&y<h.length;y++)this.boundDynamicVertexBuffers[y]!==h[y]&&(_=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==s||m||_||this.boundIndexBuffer!==c||this.boundVertexOffset!==d)this.freshBind(r,s,l,c,d,h,p);else{t.bindVertexArrayOES.set(this.vao);for(const y of h)y&&(y.bind(),p&&y.instanceCount&&y.setVertexAttribDivisor(t.gl,r,p));c&&c.dynamicDraw&&c.bind()}}freshBind(t,r,s,l,c,d,h){const p=t.numAttributes,m=this.context,_=m.gl;this.vao&&this.destroy(),this.vao=m.gl.createVertexArray(),m.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=l,this.boundVertexOffset=c,this.boundDynamicVertexBuffers=d,r.enableAttributes(_,t),r.bind(),r.setVertexAttribPointers(_,t,c);for(const y of s)y.enableAttributes(_,t),y.bind(),y.setVertexAttribPointers(_,t,c);for(const y of d)y&&(y.enableAttributes(_,t),y.bind(),y.setVertexAttribPointers(_,t,c),h&&y.instanceCount&&y.setVertexAttribDivisor(_,t,h));l&&l.bind(),m.currentNumAttributes=p}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function IR(n,t){const r=Math.pow(2,t.canonical.z),s=t.canonical.y;return[new Ke(0,s/r).toLngLat().lat,new Ke(0,(s+1)/r).toLngLat().lat]}function AR(n,t,r,s,l,c,d){const h=n.context,p=h.gl,m=r.hillshadeFBO;if(!m)return;n.prepareDrawTile();const _=n.isTileAffectedByFog(t),y=n.getOrCreateProgram("hillshade",{overrideFog:_});h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,m.colorAttachment.get());const v=((S,M,D,R)=>{const P=D.paint.get("hillshade-shadow-color"),I=D.paint.get("hillshade-highlight-color"),O=D.paint.get("hillshade-accent-color"),F=D.paint.get("hillshade-emissive-strength");let L=Ie(D.paint.get("hillshade-illumination-direction"));if("viewport"===D.paint.get("hillshade-illumination-anchor"))L-=S.transform.angle;else if(S.style&&S.style.enable3dLights()&&S.style.directionalLight){const z=S.style.directionalLight.properties.get("direction");L=Ie(te(z.x,z.y,z.z)[1])}const N=!S.options.moving;return{u_matrix:R||S.transform.calculateProjMatrix(M.tileID.toUnwrapped(),N),u_image:0,u_latrange:IR(0,M.tileID),u_light:[D.paint.get("hillshade-exaggeration"),L],u_shadow:P,u_highlight:I,u_emissive_strength:F,u_accent:O}})(n,r,s,n.terrain?t.projMatrix:null);n.uploadCommonUniforms(h,y,t.toUnwrapped());const{tileBoundsBuffer:b,tileBoundsIndexBuffer:E,tileBoundsSegments:C}=n.getTileBoundsBuffers(r);y.draw(n,p.TRIANGLES,l,c,d,Ge.disabled,v,s.id,b,E,C)}function yT(n,t,r){if(!t.needsDEMTextureUpload)return;const s=n.context,l=s.gl;s.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||n.getTileTexture(r.stride);const c=r.getPixels();t.demTexture?t.demTexture.update(c,{premultiply:!1}):t.demTexture=new ir(s,c,n.terrainUseFloatDEM()?l.R32F:l.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function RR(n,t,r){const s=n.context,l=s.gl;if(!t.dem)return;const c=t.dem;if(s.activeTexture.set(l.TEXTURE1),yT(n,t,c),!t.demTexture)return;t.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const d=c.dim;s.activeTexture.set(l.TEXTURE0);let h=t.hillshadeFBO;if(!h){const v=new ir(s,{width:d,height:d,data:null},l.RGBA);v.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=t.hillshadeFBO=s.createFramebuffer(d,d,!0,"renderbuffer"),h.colorAttachment.set(v.texture)}s.bindFramebuffer.set(h.framebuffer),s.viewport.set([0,0,d,d]);const{tileBoundsBuffer:p,tileBoundsIndexBuffer:m,tileBoundsSegments:_}=n.getMercatorTileBoundsBuffers(),y=[];n.terrainUseFloatDEM()&&y.push("TERRAIN_DEM_FLOAT_FORMAT"),n.getOrCreateProgram("hillshadePrepare",{defines:y}).draw(n,l.TRIANGLES,ve.disabled,Fe.disabled,sn.unblended,Ge.disabled,((v,b)=>{const E=b.stride,C=rt.create();return rt.ortho(C,0,dt,-dt,0,0,1),rt.translate(C,C,[0,-dt,0]),{u_matrix:C,u_image:1,u_dimension:[E,E],u_zoom:v.overscaledZ,u_unpack:b.unpackVector}})(t.tileID,c),r.id,p,m,_),t.needsHillshadePrepare=!1}const D1=n=>({u_matrix:new De(n),u_image0:new He(n),u_skirt_height:new Et(n),u_ground_shadow_factor:new me(n)}),PR=(n,t,r)=>({u_matrix:n,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),I1=(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E)=>({u_proj_matrix:Float32Array.from(n),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(s),u_merc_matrix:r,u_zoom_transition:l,u_merc_center:c,u_image0:0,u_frustum_tl:d,u_frustum_tr:h,u_frustum_br:p,u_frustum_bl:m,u_globe_pos:_,u_globe_radius:y,u_viewport:v,u_grid_matrix:E?Float32Array.from(E):new Float32Array(9),u_skirt_height:b}),Rf=(n,t)=>{if(t>0&&n.terrain&&Q("Cutoff is currently disabled on terrain"),t<=0||n.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const r=n.transform,s=Math.max(Math.abs(r._zoom-(n.minCutoffZoom-1)),1),l=r.isLODDisabled(!1)?xl(60,45,r.pitch):xl(30,15,r.pitch),c=r._farZ-r._nearZ,d=t*r.height,h=((1-(p=l))*(.75*r.cameraToCenterDistance)+p*(r._farZ+d))*s;var p;return{shouldRenderCutoff:l<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(h-r._nearZ)/c,(h-d-r._nearZ)/c]}}};function vT(n,t){return null!=n&&null!=t&&!(!n.hasData()||!t.hasData())&&null!=n.demTexture&&null!=t.demTexture&&n.tileID.key!==t.tileID.key}const lg=new class{constructor(){this.operations={}}newMorphing(n,t,r,s,l){if(n in this.operations){const c=this.operations[n];c.to.tileID.key!==r.tileID.key&&(c.queued=r)}else this.operations[n]={startTime:s,phase:0,duration:l,from:t,to:r,queued:null}}getMorphValuesForProxy(n){if(!(n in this.operations))return null;const t=this.operations[n];return{from:t.from,to:t.to,phase:t.phase}}update(n){for(const t in this.operations){const r=this.operations[t];for(r.phase=(n-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,n)){delete this.operations[t];break}}}_nextOp(n,t){return!!n.queued&&(n.from=n.to,n.to=n.queued,n.queued=null,n.phase=0,n.startTime=t,!0)}_validOp(n){return n.from.hasData()&&n.to.hasData()}},xT={0:null,1:"TERRAIN_VERTEX_MORPHING"};function bT(n,t,r){if(0===t)return 0;const s=t<1&&514===r?.25/t:1;return 6*Math.pow(1.5,22-n)*Math.max(t,1)*s}function OR(n,t){const r=1<<n.z;return!t&&(0===n.x||n.x===r-1)||0===n.y||n.y===r-1}const A1=n=>({u_matrix:n});function wT(n,t,r,s,l){if(l>0){const c=kt.now(),d=(c-n.timeAdded)/l,h=t?(c-t.timeAdded)/l:-1,p=r.getSource(),m=s.coveringZoomLevel({tileSize:p.tileSize,roundZoom:p.roundZoom}),_=!t||Math.abs(t.tileID.overscaledZ-m)>Math.abs(n.tileID.overscaledZ-m),y=_&&n.refreshedUponExpiration?1:Jt(_?d:1-h,0,1);return n.refreshedUponExpiration&&d>=1&&(n.refreshedUponExpiration=!1),t?{opacity:1,mix:1-y}:{opacity:y,mix:0}}return{opacity:1,mix:0}}class kR extends Is{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},s=new Xm(Tf(),null),l=p1("mock-dem",r,s,t.style);super("mock-dem",l,!1),l.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class FR extends Is{constructor(t){const r=p1("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Xm(Tf(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,s){if(t.freezeTileCoverage)return;this.transform=t;const l=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((c,d)=>{if(c[d.key]="",!this._tiles[d.key]){const h=new Ds(d,this._source.tileSize*d.overscaleFactor(),t.tileZoom);h.state="loaded",this._tiles[d.key]=h}return c},{});for(const c in this._tiles)c in l||(this.freeFBO(c),this._tiles[c].unloadVectorData(),delete this._tiles[c])}freeFBO(t){const r=this.proxyCachedFBO[t];if(void 0!==r){const s=Object.values(r);this.renderCachePool.push(...s),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ET extends tn{constructor(t,r,s){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=s}}class LR extends Dc{constructor(t,r){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[s,l,c]=function(p){const m=new qo,_=new er,y=131;m.reserve(17161),_.reserve(33800);const v=dt/128,b=dt+v/2,E=b+v;for(let S=-v;S<E;S+=v)for(let M=-v;M<E;M+=v){const D=M<0||M>b||S<0||S>b?24575:0,R=Jt(Math.round(M),0,dt),P=Jt(Math.round(S),0,dt);m.emplaceBack(R+D,P)}const C=(S,M)=>{const D=M*y+S;_.emplaceBack(D+1,D,D+y),_.emplaceBack(D+y,D+y+1,D+1)};for(let S=1;S<129;S++)for(let M=1;M<129;M++)C(M,S);return[0,129].forEach(S=>{for(let M=0;M<130;M++)C(M,S),C(S,M)}),[m,_,32768]}(),d=t.context;this.gridBuffer=d.createVertexBuffer(s,xc.members),this.gridIndexBuffer=d.createIndexBuffer(l),this.gridSegments=Bn.simpleSegment(0,0,s.length,l.length),this.gridNoSkirtSegments=Bn.simpleSegment(0,0,s.length,c),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new FR(r.map),this.orthoMatrix=rt.create(),rt.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,dt,0,dt,0,1);const h=d.gl;this._overlapStencilMode=new Fe({func:h.GEQUAL,mask:255},0,255,h.KEEP,h.KEEP,h.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new kR(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,s){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const l=t.terrain.properties,c=0===t.terrain.drapeRenderMode,d=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=kt.now();const h=t.terrain&&t.terrain.scope,p=l.get("source"),m=c?this._mockSourceCache:t.getSourceCache(p,h);if(!m)return void Q(`Couldn't find terrain source "${p}".`);if(this.sourceCache=m,this._exaggeration=d?this.calculateExaggeration(r):l.get("exaggeration"),!r.projection.requiresDraping&&d&&0===this._exaggeration)return void this._disable();this.enabled=!0;const _=()=>{this.sourceCache.used&&Q(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const y=this.getScaledDemTileSize();this.sourceCache.update(r,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),r.updateElevation(!0,s),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){const r=this._previousCameraAltitude,s=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=s;const l=null!=r?s-r:Number.MAX_VALUE;if(Math.abs(l)<2)return this._exaggeration;const c=t.zoom,d=this._style.terrain;if(!this._previousUpdateTimestamp)return d.getExaggeration(c);let h=c-this._previousZoom;const p=this._previousUpdateTimestamp;let m=c;null!=this._evaluationZoom&&(m=this._evaluationZoom,Math.abs(c-m)>.5&&(h=.5*(c-m+h)),h*l<0&&(m+=h)),this._evaluationZoom=m;const _=d.getExaggeration(m),y=_===d.getExaggeration(Math.max(0,m-.1));if(y&&Math.abs(_-this._exaggeration)<.01)return _;let v=Math.min(.1,.00375*(this._updateTimestamp-p));return(y||_<.1||Math.abs(h)<1e-4)&&(v=Math.min(.2,4*v)),_e(this._exaggeration,_,v)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,s=this.painter.transform;this._initializing&&(this._initializing=0===s._centerAltitude&&-1===this.getAtPointOrZero(Ke.fromLngLat(s.center),-1),this._emptyDEMTextureDirty=!this._initializing);const l=this.proxyCoords=r.getIds().map(p=>{const m=r.getTileByID(p).tileID;return m.projMatrix=s.calculateProjMatrix(m.toUnwrapped()),m});!function(p,m){const _=m.transform.pointCoordinate(m.transform.getCameraPoint()),y=new nt(_.x,_.y);p.sort((v,b)=>{if(b.overscaledZ-v.overscaledZ)return b.overscaledZ-v.overscaledZ;const E=new nt(v.canonical.x+(1<<v.canonical.z)*v.wrap,v.canonical.y),C=new nt(b.canonical.x+(1<<b.canonical.z)*b.wrap,b.canonical.y),S=y.mult(1<<v.canonical.z);return S.x-=.5,S.y-=.5,S.distSqr(E)-S.distSqr(C)})}(l,this.painter);const c=this.proxyToSource||{};this.proxyToSource={},l.forEach(p=>{this.proxyToSource[p.key]={}}),this.terrainTileForTile={};const d=this._style._mergedSourceCaches;for(const p in d){const m=d[p];if(!m.used||(m!==this.sourceCache&&this.resetTileLookupCache(m.id),this._setupProxiedCoordsForOrtho(m,t[p],c),m.usedForTerrain))continue;const _=t[p];m.getSource().reparseOverscaled&&this._assignTerrainTiles(_)}this.proxiedCoords[r.id]=l.map(p=>new ET(p,p.key,this.orthoMatrix)),this._assignTerrainTiles(l),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(c),this.renderingToTexture=!1;const h={};this._visibleDemTiles=[];for(const p of this.proxyCoords){const m=this.terrainTileForTile[p.key];if(!m)continue;const _=m.tileID.key;_ in h||(this._visibleDemTiles.push(m),h[_]=_)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const s=this._findTileCoveringTileID(r,this.sourceCache);s&&(this.terrainTileForTile[r.key]=s)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const s in this.terrainTileForTile){const l=this.terrainTileForTile[s],c=l.dem;!c||l.demTexture&&!l.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),yT(this.painter,l,c))}}_prepareDemTileUniforms(t,r,s,l){if(!r||null==r.demTexture)return!1;const c=t.tileID.canonical,d=Math.pow(2,r.tileID.canonical.z-c.z),h=l||"";return s[`u_dem_tl${h}`]=[c.x*d%1,c.y*d%1],s[`u_dem_scale${h}`]=d,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,r=t.gl;if(!this._emptyDepthBufferTexture){const s=new Pi({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new ir(t,s,r.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const r=this._visibleDemTiles.reduce((s,l)=>{if(!l.dem)return s;const c=l.dem.tree.minimums[0];return c>0&&t++,s+c},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const s=this._getLoadedAreaMinimum(),[l,c]=(()=>{if(this.painter.terrainUseFloatDEM()){const h=new rm({width:1,height:1},new Float32Array([s]));return[r.R32F,h]}{const h=new Pi({width:1,height:1},new Uint8Array(va.pack(s,this.sourceCache.getSource().encoding)));return[r.RGBA,h]}})();this._emptyDEMTextureDirty=!1;let d=this._emptyDEMTexture;return d?d.update(c,{premultiply:!1}):d=this._emptyDEMTexture=new ir(t,c,l,{premultiply:!1}),d}setupElevationDraw(t,r,s){const l=this.painter.context,c=l.gl,d=(h=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:va.getUnpackVector(h),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var h;d.u_exaggeration=this.exaggeration();let p=null,m=null,_=1;if(s&&s.morphing&&this._useVertexMorphing){const b=s.morphing.srcDemTile,E=s.morphing.dstDemTile;_=s.morphing.phase,b&&E&&(this._prepareDemTileUniforms(t,b,d,"_prev")&&(m=b),this._prepareDemTileUniforms(t,E,d)&&(p=E))}const y=b=>b&&b.demTexture&&this.painter.terrainUseFloatDEM()?c.LINEAR:c.NEAREST,v=b=>{d.u_dem_size=1===b.size[0]?1:b.size[0]-2};if(m&&p)l.activeTexture.set(c.TEXTURE2),p.demTexture.bind(y(p),c.CLAMP_TO_EDGE),l.activeTexture.set(c.TEXTURE4),m.demTexture.bind(y(m),c.CLAMP_TO_EDGE),p.demTexture&&v(p.demTexture),d.u_dem_lerp=_;else{p=this.terrainTileForTile[t.tileID.key],l.activeTexture.set(c.TEXTURE2);const b=this._prepareDemTileUniforms(t,p,d)?p.demTexture:this.emptyDEMTexture;b.bind(y(p),c.CLAMP_TO_EDGE),v(b)}if(l.activeTexture.set(c.TEXTURE3),s&&s.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE),this._depthFBO&&(d.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE),d.u_depth_size_inv=[1,1]),s&&s.useMeterToDem&&p){const b=(1<<p.tileID.canonical.z)*Ln(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;d.u_meter_to_dem=b}if(s&&s.labelPlaneMatrixInv&&(d.u_label_plane_matrix_inv=s.labelPlaneMatrixInv),r.setTerrainUniformValues(l,d),"globe"===this.painter.transform.projection.name){const b=this.globeUniformValues(this.painter.transform,t.tileID.canonical,s&&s.useDenormalizedUpVectorScale);r.setGlobeUniformValues(l,b)}}globeUniformValues(t,r,s){const l=t.projection;return{u_tile_tl_up:l.upVector(r,0,0),u_tile_tr_up:l.upVector(r,dt,0),u_tile_br_up:l.upVector(r,dt,dt),u_tile_bl_up:l.upVector(r,0,dt),u_tile_up_scale:s?Dx(1):l.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,s=this.painter.context;0!==t.length&&(s.bindFramebuffer.set(null),s.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(l,c,d,h,p){if("globe"===l.transform.projection.name)!function(m,_,y,v,b){const E=m.context,C=E.gl;let S,M;const D=m.transform,R=HC(m,E,D),P=(H,j)=>{if(M===j)return;const Z=[xT[j],"PROJECTION_GLOBE_VIEW"];R&&Z.push("CUSTOM_ANTIALIASING");const tt=m.isTileAffectedByFog(H);S=m.getOrCreateProgram("globeRaster",{defines:Z,overrideFog:tt}),M=j},I=m.colorModeForRenderPass(),O=new ve(C.LEQUAL,ve.ReadWrite,m.depthRangeFor3D);lg.update(b);const F=function(H){const j=H.pixelsPerMeter,Z=j/Ln(1,H.center.lat),tt=rt.identity(new Float64Array(16));return rt.translate(tt,tt,[H.point.x,H.point.y,0]),rt.scale(tt,tt,[Z,Z,j]),Float32Array.from(tt)}(D),L=[eo(D.center.lng),po(D.center.lat)],N=m.globeSharedBuffers,z=[D.width*kt.devicePixelRatio,D.height*kt.devicePixelRatio],U=Float32Array.from(D.globeMatrix),V={useDenormalizedUpVectorScale:!0};{const H=m.transform,j=bT(H.zoom,_.exaggeration(),_.sourceCache._source.tileSize);M=-1;const Z=C.TRIANGLES;for(const tt of v){const it=y.getTile(tt),X=Fe.disabled,Y=_.prevTerrainTileForTile[tt.key],ot=_.terrainTileForTile[tt.key];vT(Y,ot)&&lg.newMorphing(tt.key,Y,ot,b,250),E.activeTexture.set(C.TEXTURE0),it.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const lt=lg.getMorphValuesForProxy(tt.key),ht=lt?1:0;lt&&iu(V,{morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:Yc(lt.phase)}});const mt=Zp(tt.canonical),yt=LA(mt.getCenter().lat),ct=GC(tt.canonical,mt,yt,H.worldSize/H._pixelsPerMercatorPixel),ft=to(Oo(tt.canonical)),Rt=I1(H.projMatrix,U,F,ft,Br(H.zoom),L,H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.globeCenterInViewSpace,H.globeRadius,z,j,ct);if(P(tt,ht),S&&(_.setupElevationDraw(it,S,V),m.uploadCommonUniforms(E,S,tt.toUnwrapped()),N)){const[Vt,jt,$t]=N.getGridBuffers(yt,0!==j);S.draw(m,Z,O,X,I,Ge.backCCW,Rt,"globe_raster",Vt,jt,$t)}}}if(N&&(m.renderDefaultNorthPole||m.renderDefaultSouthPole)){const H=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];R&&H.push("CUSTOM_ANTIALIASING"),S=m.getOrCreateProgram("globeRaster",{defines:H});for(const j of v){const{x:Z,y:tt,z:it}=j.canonical,X=0===tt,Y=tt===(1<<it)-1,[ot,lt,ht,mt]=N.getPoleBuffers(it,!1);if(mt&&(X||Y)){const yt=y.getTile(j);E.activeTexture.set(C.TEXTURE0),yt.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE);let ct=$C(it,Z,D);const ft=to(Oo(j.canonical)),Rt=(Vt,jt)=>Vt.draw(m,C.TRIANGLES,O,Fe.disabled,I,Ge.disabled,I1(D.projMatrix,ct,ct,ft,0,L,D.frustumCorners.TL,D.frustumCorners.TR,D.frustumCorners.BR,D.frustumCorners.BL,D.globeCenterInViewSpace,D.globeRadius,z,0),"globe_pole_raster",jt,ht,mt);_.setupElevationDraw(yt,S,V),m.uploadCommonUniforms(E,S,j.toUnwrapped()),X&&m.renderDefaultNorthPole&&Rt(S,ot),Y&&m.renderDefaultSouthPole&&(ct=rt.scale(rt.create(),ct,[1,-1,1]),Rt(S,lt))}}}}(l,c,d,h,p);else{const m=l.context,_=m.gl;let y,v;const b=l.shadowRenderer,E=Rf(l,l.longestCutoffRange),C=I=>{if(v===I)return;const O=[];O.push(xT[I]),E.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),y=l.getOrCreateProgram("terrainRaster",{defines:O}),v=I},S=l.colorModeForRenderPass(),M=new ve(_.LEQUAL,ve.ReadWrite,l.depthRangeFor3D);lg.update(p);const D=l.transform,R=bT(D.zoom,c.exaggeration(),c.sourceCache._source.tileSize);let P=[0,0,0];if(b){const I=l.style.directionalLight,O=l.style.ambientLight;I&&O&&(P=G1(I,O))}{v=-1;const I=_.TRIANGLES,[O,F]=[c.gridIndexBuffer,c.gridSegments];for(const L of h){const N=d.getTile(L),z=Fe.disabled,U=c.prevTerrainTileForTile[L.key],V=c.terrainTileForTile[L.key];vT(U,V)&&lg.newMorphing(L.key,U,V,p,250),m.activeTexture.set(_.TEXTURE0),N.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST);const H=lg.getMorphValuesForProxy(L.key),j=H?1:0;let Z;H&&(Z={morphing:{srcDemTile:H.from,dstDemTile:H.to,phase:Yc(H.phase)}});const tt=PR(L.projMatrix,OR(L.canonical,D.renderWorldCopies)?R/10:R,P);if(C(j),!y)continue;c.setupElevationDraw(N,y,Z);const it=L.toUnwrapped();b&&b.setupShadows(it,y),l.uploadCommonUniforms(m,y,it,null,E),y.draw(l,I,M,z,S,Ge.backCCW,tt,"terrain_raster",c.gridBuffer,O,F)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const r=this.painter,s=this.painter.context,l=this.proxySourceCache,c=this.proxiedCoords[l.id],d=this._drapedRenderBatches.shift(),h=r.style.order,p=[];let m=0;for(const _ of c){const y=l.getTileByID(_.proxyTileKey),v=l.proxyCachedFBO[_.key]?l.proxyCachedFBO[_.key][t]:void 0,b=void 0!==v?l.renderCache[v]:this.pool[m++],E=void 0!==v;if(y.texture=b.tex,E&&!b.dirty){p.push(y.tileID);continue}let C;s.bindFramebuffer.set(b.fb.framebuffer),this.renderedToTile=!1,b.dirty&&(s.clear({color:Ne.transparent,stencil:0}),b.dirty=!1);for(let S=d.start;S<=d.end;++S){const M=r.style._mergedLayers[h[S]];if(M.isHidden(r.transform.zoom))continue;const D=r.style.getLayerSourceCache(M),R=D?this.proxyToSource[_.key][D.id]:[_];if(!R)continue;const P=R;s.viewport.set([0,0,b.fb.width,b.fb.height]),C!==(D?D.id:null)&&(this._setupStencil(b,R,M,D),C=D?D.id:null),r.renderLayer(r,D,M,P)}if(0===this._drapedRenderBatches.length)for(const S of this._pendingGroundEffectLayers){const M=r.style._mergedLayers[h[S]];if(M.isHidden(r.transform.zoom))continue;const D=r.style.getLayerSourceCache(M),R=D?this.proxyToSource[_.key][D.id]:[_];if(!R)continue;const P=R;s.viewport.set([0,0,b.fb.width,b.fb.height]),C!==(D?D.id:null)&&(this._setupStencil(b,R,M,D),C=D?D.id:null),r.renderLayer(r,D,M,P)}this.renderedToTile?(b.dirty=!0,p.push(y.tileID)):E||--m,5===m&&(m=0,this.renderToBackBuffer(p))}return this.renderToBackBuffer(p),this.renderingToTexture=!1,s.bindFramebuffer.set(null),s.viewport.set([0,0,r.width,r.height]),d.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let s=-1,l=r;for(let c=0;c<r;++c)this._style.isLayerDraped(t._mergedLayers[t.order[c]])?s=Math.max(s,c):l=Math.min(l,c);return l>s}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,r,s){if(!this._visibleDemTiles)return null;const l=this._visibleDemTiles.filter(c=>c.dem).map(c=>{const d=c.tileID,h=1<<d.overscaledZ,{x:p,y:m}=d.canonical,_=p/h,y=(p+1)/h,v=m/h,b=(m+1)/h;return{minx:_,miny:v,maxx:y,maxy:b,t:c.dem.tree.raycastRoot(_,v,y,b,t,r,s),tile:c}});l.sort((c,d)=>(null!==c.t?c.t:Number.MAX_VALUE)-(null!==d.t?d.t:Number.MAX_VALUE));for(const c of l){if(null==c.t)return null;const d=c.tile.dem.tree.raycast(c.minx,c.miny,c.maxx,c.maxy,t,r,s);if(null!=d)return d}return null}_createFBO(){const t=this.painter.context,r=t.gl,s=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const l=new ir(t,{width:s[0],height:s[1],data:null},r.RGBA);l.bind(r.LINEAR,r.CLAMP_TO_EDGE);const c=t.createFramebuffer(s[0],s[1],!0,null);return c.colorAttachment.set(l.texture),c.depthAttachment=new nS(t,c.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,s[0],s[1]),this._stencilRef=0,c.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):c.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:c,tex:l,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],s=r.isHidden(this.painter.transform.zoom);return"custom"===r.type?!s&&r.shouldRedrape():!s&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const s of this._style.getSources())if(s instanceof Km){t=!0;break}if(!t)return;const r={};for(let s=0;s<this._style.order.length;++s){const l=this._style._mergedLayers[this._style.order[s]],c=this._style.getLayerSourceCache(l);if(c&&!r[c.id]&&!l.isHidden(this.painter.transform.zoom)&&"line"===l.type&&l.widthExpression()instanceof gc){r[c.id]=!0;for(const d of this.proxyCoords){const h=this.proxyToSource[d.key][c.id];if(h)for(const p of h)this._clearRenderCacheForTile(c.id,p)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s]._source instanceof Pu){t=!0;break}if(!t)return;const r={};for(let s=0;s<this._style.order.length;++s){const l=this._style._mergedLayers[this._style.order[s]],c=this._style.getLayerSourceCache(l);if(!c||r[c.id]||l.isHidden(this.painter.transform.zoom)||"raster"!==l.type)continue;const d=l.paint.get("raster-fade-duration");for(const h of this.proxyCoords){const p=this.proxyToSource[h.key][c.id];if(p)for(const m of p){const _=wT(c.getTile(m),c.findLoadedParent(m,0),c,this.painter.transform,d);(1!==_.opacity||0!==_.mix)&&this._clearRenderCacheForTile(c.id,m)}}}}_setupDrapedRenderBatches(){const t=this._style.order,r=t.length;if(0===r)return;const s=[];this._pendingGroundEffectLayers=[];let l,c=0,d=this._style._mergedLayers[t[c]];for(;!this._style.isLayerDraped(d)&&d.isHidden(this.painter.transform.zoom)&&++c<r;)d=this._style._mergedLayers[t[c]];for(;c<r;++c){const h=this._style._mergedLayers[t[c]];h.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(h)?void 0===l&&(l=c):("fill-extrusion"===h.type&&this._pendingGroundEffectLayers.push(c),void 0!==l&&(s.push({start:l,end:c-1}),l=void 0)))}if(void 0!==l&&s.push({start:l,end:c-1}),0!==s.length){const h=s[s.length-1];this._pendingGroundEffectLayers.every(m=>m>h.end)||Q("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=s}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const d=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let h=0;h<d.length;++h){const p=Object.values(d[h]);r.renderCachePool.push(...p)}}return}this._clearRasterLayersFromRenderCache();const s=this.proxyCoords,l=this._tilesDirty;for(let d=s.length-1;d>=0;d--){const h=s[d];if(r.getTileByID(h.key),void 0!==r.proxyCachedFBO[h.key]){const p=t[h.key],m=this.proxyToSource[h.key];let _=0;for(const y in m){const v=m[y],b=p[y];if(!b||b.length!==v.length||v.some((E,C)=>E!==b[C]||l[y]&&l[y].hasOwnProperty(E.key))){_=-1;break}++_}for(const y in r.proxyCachedFBO[h.key])r.renderCache[r.proxyCachedFBO[h.key][y]].dirty=_<0||_!==Object.values(p).length}}const c=[...this._drapedRenderBatches];c.sort((d,h)=>h.end-h.start-(d.end-d.start));for(const d of c)for(const h of s){if(r.proxyCachedFBO[h.key])continue;let p=r.renderCachePool.pop();void 0===p&&r.renderCache.length<50&&(p=r.renderCache.length,r.renderCache.push(this._createFBO())),void 0!==p&&(r.proxyCachedFBO[h.key]={},r.proxyCachedFBO[h.key][d.start]=p,r.renderCache[p].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,s,l){if(!l||!this._sourceTilesOverlap[l.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const c=this.painter.context,d=c.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let h;if(s.isTileClipped())h=r.length,this._overlapStencilMode.test={func:d.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);h=1,this._overlapStencilMode.test={func:d.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+h>255&&(c.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=h,this._overlapStencilMode.ref=this._stencilRef,s.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Fe.disabled}_renderTileClippingMasks(t,r){const s=this.painter,l=this.painter.context,c=l.gl;s._tileClippingMaskIDs={},l.setColorMode(sn.disabled),l.setDepthMode(ve.disabled);const d=s.getOrCreateProgram("clippingMask");for(const h of t){const p=s._tileClippingMaskIDs[h.key]=--r;d.draw(s,c.TRIANGLES,ve.disabled,new Fe({func:c.ALWAYS,mask:0},p,255,c.KEEP,c.KEEP,c.REPLACE),sn.disabled,Ge.disabled,A1(h.projMatrix),"$clipping",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const s=[t.x,t.y,1,1];Fn.transformMat4(s,s,r.pixelMatrixInverse),Fn.scale(s,s,1/s[3]),s[0]/=r.worldSize,s[1]/=r.worldSize;const l=r._camera.position,c=Ln(1,r.center.lat),d=[l[0],l[1],l[2]/c,0],h=q.subtract([],s.slice(0,3),d);q.normalize(h,h);const p=this.raycast(d,h,this._exaggeration);return null!==p&&p?(q.scaleAndAdd(d,d,h,p),d[3]=d[2],d[2]*=c,d):null}drawDepth(){const t=this.painter,r=t.context,s=this.proxySourceCache,l=Math.ceil(t.width),c=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===l&&this._depthFBO.height===c||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const d=r.gl,h=r.createFramebuffer(l,c,!0,"renderbuffer");r.activeTexture.set(d.TEXTURE0);const p=new ir(r,{width:l,height:c,data:null},d.RGBA);p.bind(d.NEAREST,d.CLAMP_TO_EDGE),h.colorAttachment.set(p.texture);const m=r.createRenderbuffer(r.gl.DEPTH_COMPONENT16,l,c);h.depthAttachment.set(m),this._depthFBO=h,this._depthTexture=p}r.bindFramebuffer.set(this._depthFBO.framebuffer),r.viewport.set([0,0,l,c]),function(d,h,p,m){if("globe"===d.transform.projection.name)return;const _=d.context,y=_.gl;_.clear({depth:1});const v=d.getOrCreateProgram("terrainDepth"),b=new ve(y.LESS,ve.ReadWrite,d.depthRangeFor3D);for(const E of m){const C=p.getTile(E),S=PR(E.projMatrix,0,[0,0,0]);h.setupElevationDraw(C,v),v.draw(d,y.TRIANGLES,b,Fe.disabled,sn.unblended,Ge.backCCW,S,"terrain_depth",h.gridBuffer,h.gridIndexBuffer,h.gridNoSkirtSegments)}}(t,this,s,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,r,s){if(t.getSource()instanceof Gl)return this._setupProxiedCoordsForImageSource(t,r,s);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const l=this.proxiedCoords[t.id]=[],c=this.proxyCoords;for(let h=0;h<c.length;h++){const p=c[h],m=this._findTileCoveringTileID(p,t);if(m){const _=this._createProxiedId(p,m,s[p.key]&&s[p.key][t.id]);l.push(_),this.proxyToSource[p.key][t.id]=[_]}}let d=!1;for(let h=0;h<r.length;h++){const p=t.getTile(r[h]);if(!p||!p.hasData())continue;const m=this._findTileCoveringTileID(p.tileID,this.proxySourceCache);if(m&&m.tileID.canonical.z!==p.tileID.canonical.z){const _=this.proxyToSource[m.tileID.key][t.id],y=this._createProxiedId(m.tileID,p,s[m.tileID.key]&&s[m.tileID.key][t.id]);_?_.splice(_.length-1,0,y):this.proxyToSource[m.tileID.key][t.id]=[y],l.push(y),d=!0}}this._sourceTilesOverlap[t.id]=d}_setupProxiedCoordsForImageSource(t,r,s){if(!t.getSource().loaded())return;const l=this.proxiedCoords[t.id]=[],c=this.proxyCoords,d=t.getSource(),h=d.tileID;if(!h)return;const p=new nt(h.x,h.y)._div(1<<h.z),m=d.coordinates.map(Ke.fromLngLat).reduce((y,v)=>(y.min.x=Math.min(y.min.x,v.x-p.x),y.min.y=Math.min(y.min.y,v.y-p.y),y.max.x=Math.max(y.max.x,v.x-p.x),y.max.y=Math.max(y.max.y,v.y-p.y),y),{min:new nt(Number.MAX_VALUE,Number.MAX_VALUE),max:new nt(-Number.MAX_VALUE,-Number.MAX_VALUE)}),_=(y,v)=>{const b=y.wrap+y.canonical.x/(1<<y.canonical.z),E=y.canonical.y/(1<<y.canonical.z),C=dt/(1<<y.canonical.z),S=v.wrap+v.canonical.x/(1<<v.canonical.z),M=v.canonical.y/(1<<v.canonical.z);return b+C<S+m.min.x||b>S+m.max.x||E+C<M+m.min.y||E>M+m.max.y};for(let y=0;y<c.length;y++){const v=c[y];for(let b=0;b<r.length;b++){const E=t.getTile(r[b]);if(!E||!E.hasData()||_(v,E.tileID))continue;const C=this._createProxiedId(v,E,s[v.key]&&s[v.key][t.id]),S=this.proxyToSource[v.key][t.id];S?S.push(C):this.proxyToSource[v.key][t.id]=[C],l.push(C)}}}_createProxiedId(t,r,s){let l=this.orthoMatrix;if(s){const c=s.find(d=>d.key===r.tileID.key);if(c)return c}if(r.tileID.key!==t.key){const c=t.canonical.z-r.tileID.canonical.z;let d,h,p;l=rt.create();const m=r.tileID.wrap-t.wrap<<t.overscaledZ;c>0?(d=dt>>c,h=d*((r.tileID.canonical.x<<c)-t.canonical.x+m),p=d*((r.tileID.canonical.y<<c)-t.canonical.y)):(d=dt<<-c,h=dt*(r.tileID.canonical.x-(t.canonical.x+m<<-c)),p=dt*(r.tileID.canonical.y-(t.canonical.y<<-c))),rt.ortho(l,0,d,0,d,0,1),rt.translate(l,l,[h,p,0])}return new ET(r.tileID,t.key,l)}_findTileCoveringTileID(t,r){let s=r.getTile(t);if(s&&s.hasData())return s;const l=this._findCoveringTileCache[r.id],c=l[t.key];if(s=c?r.getTileByID(c):null,s&&s.hasData()||null===c)return s;let d=s?s.tileID:t,h=d.overscaledZ;const p=r.getSource().minzoom,m=[];if(!c){const y=r.getSource().maxzoom;if(t.canonical.z>=y){const v=t.canonical.z-y;r.getSource().reparseOverscaled?(h=Math.max(t.canonical.z+2,r.transform.tileZoom),d=new tn(h,t.wrap,y,t.canonical.x>>v,t.canonical.y>>v)):0!==v&&(h=y,d=new tn(h,t.wrap,y,t.canonical.x>>v,t.canonical.y>>v))}d.key!==t.key&&(m.push(d.key),s=r.getTile(d))}const _=y=>{m.forEach(v=>{l[v]=y}),m.length=0};for(h-=1;h>=p&&(!s||!s.hasData());h--){s&&_(s.tileID.key);const y=d.calculateScaledKey(h);if(s=r.getTileByID(y),s&&s.hasData())break;const v=l[y];if(null===v)break;void 0===v?m.push(y):s=r.getTileByID(v)}return _(s?s.tileID.key:null),s&&s.hasData()?s:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let s=this._tilesDirty[t];s||(s=this._tilesDirty[t]={}),s[r.key]=!0}}function NR(n,t,r){const s=function(h,p,m){const _=q.dot(p,h),y=q.dot(m,[.2126,.7152,.0722]),v=(E,C,S)=>(1-S)*E+S*C,b=v(1-.3*Math.min(y,1),1,Math.min(_+1,1));return v(.92,1,Math.asin(Jt(p[2],-1,1))/Math.PI+.5)*b}(n,[0,0,1],t),l=[0,0,0];q.scale(l,r.slice(0,3),s);const c=[0,0,0];q.scale(c,t.slice(0,3),n[2]);const d=[0,0,0];return q.add(d,l,c),ni(d)}const zR=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],BR=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Pf{static cacheKey(t,r,s,l){let c=`${r}${l?l.cacheKey:""}`;for(const d of s)t.usedDefines.includes(d)&&(c+=`/${d}`);return c}constructor(t,r,s,l,c,d){const h=t.gl;this.program=h.createProgram(),this.configuration=l,this.name=r,this.fixedDefines=[...d];const p=function(M){const D=[];for(let R=0;R<M.length;R++){if(null===M[R])continue;const P=M[R].split(" ");D.push(P.pop())}return D}(s.staticAttributes),m=l?l.getBinderAttributes():[],_=p.concat(m);let y=l?l.defines():[];y=y.concat(d.map(M=>`#define ${M}`));const v="#version 300 es\n";let b=v+y.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",_v,S1.fragmentSource).join("\n");for(const M of s.fragmentIncludes)b+=`\n${Af[M]}`;b+=`\n${s.fragmentSource}`;let E=v+y.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",_v,S1.vertexSource).join("\n");for(const M of s.vertexIncludes)E+=`\n${Af[M]}`;E+=`\n${s.vertexSource}`;const C=h.createShader(h.FRAGMENT_SHADER);if(h.isContextLost())return void(this.failedToCreate=!0);h.shaderSource(C,b),h.compileShader(C),h.attachShader(this.program,C);const S=h.createShader(h.VERTEX_SHADER);if(h.isContextLost())this.failedToCreate=!0;else{h.shaderSource(S,E),h.compileShader(S),h.attachShader(this.program,S),this.attributes={},this.numAttributes=_.length;for(let M=0;M<this.numAttributes;M++)if(_[M]){const D=_[M].startsWith("a_")?_[M]:`a_${_[M]}`;h.bindAttribLocation(this.program,M,D),this.attributes[D]=M}h.linkProgram(this.program),h.deleteShader(S),h.deleteShader(C),this.fixedUniforms=c(t),this.binderUniforms=l?l.getUniforms(t):[],d.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new He(M=t),u_dem_prev:new He(M),u_dem_unpack:new bs(M),u_dem_tl:new Ze(M),u_dem_scale:new Et(M),u_dem_tl_prev:new Ze(M),u_dem_scale_prev:new Et(M),u_dem_size:new Et(M),u_dem_lerp:new Et(M),u_exaggeration:new Et(M),u_depth:new He(M),u_depth_size_inv:new Ze(M),u_meter_to_dem:new Et(M),u_label_plane_matrix_inv:new De(M)}),d.includes("GLOBE")&&(this.globeUniforms=(M=>({u_tile_tl_up:new me(M),u_tile_tr_up:new me(M),u_tile_br_up:new me(M),u_tile_bl_up:new me(M),u_tile_up_scale:new Et(M)}))(t)),d.includes("FOG")&&(this.fogUniforms=(M=>({u_fog_matrix:new De(M),u_fog_range:new Ze(M),u_fog_color:new bs(M),u_fog_horizon_blend:new Et(M),u_fog_vertical_limit:new Ze(M),u_fog_temporal_offset:new Et(M),u_frustum_tl:new me(M),u_frustum_tr:new me(M),u_frustum_br:new me(M),u_frustum_bl:new me(M),u_globe_pos:new me(M),u_globe_radius:new Et(M),u_globe_transition:new Et(M),u_is_globe:new He(M),u_viewport:new Ze(M)}))(t)),d.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(M=>({u_cutoff_params:new bs(M)}))(t)),d.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(M=>({u_lighting_ambient_color:new me(M),u_lighting_directional_dir:new me(M),u_lighting_directional_color:new me(M),u_ground_radiance:new me(M)}))(t)),d.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(M=>({u_light_matrix_0:new De(M),u_light_matrix_1:new De(M),u_fade_range:new Ze(M),u_shadow_normal_offset:new me(M),u_shadow_intensity:new Et(M),u_shadow_texel_size:new Et(M),u_shadow_map_resolution:new Et(M),u_shadow_direction:new me(M),u_shadow_bias:new me(M),u_shadowmap_0:new He(M),u_shadowmap_1:new He(M)}))(t))}var M}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const s=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)s[l]&&s[l].set(this.program,l,r[l])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const s=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)s[l]&&s[l].set(this.program,l,r[l])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const s=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)s[l].set(this.program,l,r[l])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const s=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)s[l].set(this.program,l,r[l])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const s=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)s[l].set(this.program,l,r[l])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const s=this.shadowUniforms;t.program.set(this.program);for(const l in r)s[l].set(this.program,l,r[l])}_drawDebugWireframe(t,r,s,l,c,d,h,p,m,_){const y=t.options.wireframe;if(!1===y.terrain&&!1===y.layers2D&&!1===y.layers3D)return;const v=t.context;if(!(()=>!(!y.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!y.layers2D||t._terrain&&t._terrain.renderingToTexture||!zR.includes(this.name))||!(!y.layers3D||!BR.includes(this.name)))())return;const b=v.gl,E=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,c,v);if(!E)return;const C=[...this.fixedDefines];C.push("DEBUG_WIREFRAME");const S=t.getOrCreateProgram(this.name,{config:this.configuration,defines:C});v.program.set(S.program);const M=(P,I,O)=>{if(I[P]&&O[P])for(const F in I[P])O[P][F]&&O[P][F].set(O.program,F,I[P][F].current)};m&&m.setUniforms(S.program,v,S.binderUniforms,h,{zoom:p}),M("fixedUniforms",this,S),M("terrainUniforms",this,S),M("globeUniforms",this,S),M("fogUniforms",this,S),M("lightsUniforms",this,S),M("shadowUniforms",this,S),E.bind(),v.setColorMode(new sn([b.ONE,b.ONE_MINUS_SRC_ALPHA,b.ZERO,b.ONE],Ne.transparent,[!0,!0,!0,!1])),v.setDepthMode(new ve(r.func===b.LESS?b.LEQUAL:r.func,ve.ReadOnly,r.range)),v.setStencilMode(Fe.disabled);const D=3*d.primitiveLength*2,R=3*d.primitiveOffset*2*2;_&&_>1?b.drawElementsInstanced(b.LINES,D,b.UNSIGNED_SHORT,R,_):b.drawElements(b.LINES,D,b.UNSIGNED_SHORT,R),c.bind(),v.program.set(this.program),v.setDepthMode(r),v.setStencilMode(s),v.setColorMode(l)}draw(t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S){const M=t.context,D=M.gl;if(this.failedToCreate)return;M.program.set(this.program),M.setDepthMode(s),M.setStencilMode(l),M.setColorMode(c),M.setCullFace(d);for(const I of Object.keys(this.fixedUniforms))this.fixedUniforms[I].set(this.program,I,h[I]);E&&E.setUniforms(this.program,M,this.binderUniforms,v,{zoom:b});const R={[D.LINES]:2,[D.TRIANGLES]:3,[D.LINE_STRIP]:1}[r],P=S&&S>0?1:void 0;for(const I of y.get()){const O=I.vaos||(I.vaos={});(O[p]||(O[p]=new _T)).bind(M,this,m,E?E.getPaintVertexBuffers():[],_,I.vertexOffset,C||[],P),S&&S>1?D.drawElementsInstanced(r,I.primitiveLength*R,D.UNSIGNED_SHORT,I.primitiveOffset*R*2,S):D.drawElements(r,I.primitiveLength*R,D.UNSIGNED_SHORT,I.primitiveOffset*R*2),r===D.TRIANGLES&&this._drawDebugWireframe(t,s,l,c,_,I,v,b,E,S)}}}function R1(n,t){const r=Math.pow(2,t.tileID.overscaledZ),s=t.tileSize*Math.pow(2,n.transform.tileZoom)/r,l=s*(t.tileID.canonical.x+t.tileID.wrap*r),c=s*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/Id(t,1,n.transform.tileZoom),u_pixel_coord_upper:[l>>16,c>>16],u_pixel_coord_lower:[65535&l,65535&c]}}const CT=rt.create(),P1=(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E)=>{const C=t.style.light,S=C.properties.get("position"),M=[S.x,S.y,S.z],D=Zo.create();"viewport"===C.properties.get("anchor")&&(Zo.fromRotation(D,-t.transform.angle),q.transformMat3(M,M,D));const R=C.properties.get("color"),P=t.transform,I={u_matrix:n,u_lightpos:M,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+r,u_opacity:s,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:CT,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:l,u_edge_radius:c,u_flood_light_color:y,u_vertical_scale:v,u_flood_light_intensity:b,u_ground_shadow_factor:E};return"globe"===P.projection.name&&(I.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],I.u_zoom_transition=p,I.u_inv_rot_matrix=_,I.u_merc_center=m,I.u_up_dir=P.projection.upVector(new ma(0,0,0),m[0]*dt,m[1]*dt),I.u_height_lift=h),I},MT=(n,t,r)=>({u_matrix:n,u_edge_radius:t,u_vertical_scale:r}),ST=(n,t,r,s,l,c,d,h,p,m,_,y,v,b)=>{const E=P1(n,t,r,s,l,c,d,p,m,_,y,v,b,1,[0,0,0]),C={u_height_factor:-Math.pow(2,d.overscaledZ)/h.tileSize/8};return Yt(E,R1(t,h),C)},TT=(n,t)=>({u_matrix:n,u_emissive_strength:t}),DT=(n,t,r,s)=>Yt(TT(n,t),R1(r,s)),HF=(n,t,r)=>({u_matrix:n,u_world:r,u_emissive_strength:t}),GF=(n,t,r,s,l)=>Yt(DT(n,t,r,s),{u_world:l}),VR=(n,t,r,s)=>{const l=dt/r.tileSize;return{u_matrix:n,u_camera_to_center_distance:t.getCameraToCenterDistance(s),u_extrude_scale:[t.pixelsToGLUnits[0]/l,t.pixelsToGLUnits[1]/l]}},IT=(n,t,r=1)=>({u_matrix:n,u_color:t,u_overlay:0,u_overlay_scale:r}),jR=rt.create(),UR=(n,t,r,s,l,c,d)=>{const h=n.transform,p="globe"===h.projection.name,m=p?jC(h.zoom,t.canonical)*h._pixelsPerMercatorPixel:Id(r,1,c),_={u_matrix:t.projMatrix,u_extrude_scale:m,u_intensity:d,u_inv_rot_matrix:jR,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(p){_.u_inv_rot_matrix=s,_.u_merc_center=l,_.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],_.u_zoom_transition=Br(h.zoom);const y=l[0]*dt,v=l[1]*dt;_.u_up_dir=h.projection.upVector(new ma(0,0,0),y,v)}return _},AT=(n,t,r,s,l,c,d,h,p,m,_)=>{return{u_matrix:n,u_normalize_matrix:t,u_globe_matrix:r,u_tl_parent:s,u_scale_parent:l,u_fade_t:c.mix,u_opacity:c.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(v=d.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(y=d.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:cg(d.paint.get("raster-hue-rotate")),u_perspective_transform:h,u_colorization_mix:m,u_colorization_scale:$R(_),u_color_ramp:p};var y,v};function cg(n){n*=Math.PI/180;const t=Math.sin(n),r=Math.cos(n);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}function $R([n,t]){if(n===t)return[n,t];const r=(t+n)/2,s=(t-n)/2*256/255;return[-(n=r-s)/((t=r+s)-n),1/(t-n)]}const Of=rt.create(),RT=(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S)=>{const M=l.transform,D={u_is_size_zoom_constant:+("constant"===n||"source"===n),u_is_size_feature_constant:+("constant"===n||"camera"===n),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:M.getCameraToCenterDistance(C),u_rotate_symbol:+r,u_aspect_ratio:M.width/M.height,u_fade_change:l.options.fadeDuration?l.symbolFadeChange:1,u_matrix:c,u_label_plane_matrix:d,u_coord_matrix:h,u_is_text:+p,u_pitch_with_map:+s,u_texsize:m,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Of,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Of,u_up_vector:[0,-1,0],u_icon_transition:S||0};return"globe"===C.name&&(D.u_tile_id=[_.canonical.x,_.canonical.y,1<<_.canonical.z],D.u_zoom_transition=y,D.u_inv_rot_matrix=b,D.u_merc_center=v,D.u_camera_forward=M._camera.forward(),D.u_ecef_origin=function(R,P){const I=[0,0,0],O=to(Oo(P.canonical));return q.transformMat4(I,I,O),q.transformMat4(I,I,R),I}(M.globeMatrix,_.toUnwrapped()),D.u_tile_matrix=Float32Array.from(M.globeMatrix),D.u_up_vector=E),D},HR=(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S)=>Yt(RT(n,t,r,s,l,c,d,h,p,m,y,v,b,E,C,S),{u_gamma_scale:s?l.transform.getCameraToCenterDistance(S)*Math.cos(l.terrain?0:l.transform._pitch):1,u_device_pixel_ratio:kt.devicePixelRatio,u_is_halo:+_,undefined:void 0}),GR=(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C)=>Yt(HR(n,t,r,s,l,c,d,h,!0,p,!0,_,y,v,b,E,C),{u_texsize_icon:m,u_texture_icon:1}),qF=(n,t,r,s)=>({u_matrix:n,u_emissive_strength:t,u_opacity:r,u_color:s}),ql=(n,t,r,s,l,c,d)=>Yt(function(h,p,m,_){const y=m.imageManager.getPattern(h.toString(),p),{width:v,height:b}=m.imageManager.getPixelSize(p),E=Math.pow(2,_.tileID.overscaledZ),C=_.tileSize*Math.pow(2,m.transform.tileZoom)/E,S=C*(_.tileID.canonical.x+_.tileID.wrap*E),M=C*_.tileID.canonical.y;return{u_image:0,u_pattern_tl:y.tl,u_pattern_br:y.br,u_texsize:[v,b],u_pattern_size:y.displaySize,u_tile_units_to_pixels:1/Id(_,1,m.transform.tileZoom),u_pixel_coord_upper:[S>>16,M>>16],u_pixel_coord_lower:[65535&S,65535&M]}}(l,c,s,d),{u_matrix:n,u_emissive_strength:t,u_opacity:r}),As={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},O1=(n,t,r,s,l,c,d,h,p,m,_,y=[0,0,0])=>{const v=s.style.light,b=v.properties.get("position"),E=[-b.x,-b.y,b.z],C=Zo.create();"viewport"===v.properties.get("anchor")&&(Zo.fromRotation(C,-s.transform.angle),q.transformMat3(E,E,C));const S="MASK"===m.alphaMode,M=v.properties.get("color"),D=_.paint.get("model-ambient-occlusion-intensity"),R=_.paint.get("model-color").constantOr(Ne.white),P=_.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:n,u_lighting_matrix:t,u_normal_matrix:r,u_lightpos:E,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_camera_pos:y,u_opacity:l,u_baseTextureIsAlpha:0,u_alphaMask:+S,u_alphaCutoff:m.alphaCutoff,u_baseColorFactor:[c.r,c.g,c.b,c.a],u_emissiveFactor:[d[0],d[1],d[2],1],u_metallicFactor:h,u_roughnessFactor:p,u_baseColorTexture:As.BaseColor,u_metallicRoughnessTexture:As.MetallicRoughness,u_normalTexture:As.Normal,u_occlusionTexture:As.Occlusion,u_emissionTexture:As.Emission,u_color_mix:[R.r,R.g,R.b,P],u_aoIntensity:D}},PT=new Float32Array(16),ug=(n,t=PT,r=PT)=>({u_matrix:n,u_instance:t,u_node_matrix:r}),OT={fillExtrusion:n=>({u_matrix:new De(n),u_lightpos:new me(n),u_lightintensity:new Et(n),u_lightcolor:new me(n),u_vertical_gradient:new Et(n),u_opacity:new Et(n),u_edge_radius:new Et(n),u_ao:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_up_dir:new me(n),u_height_lift:new Et(n),u_flood_light_color:new me(n),u_vertical_scale:new Et(n),u_flood_light_intensity:new Et(n),u_ground_shadow_factor:new me(n)}),fillExtrusionDepth:n=>({u_matrix:new De(n),u_edge_radius:new Et(n),u_vertical_scale:new Et(n)}),fillExtrusionPattern:n=>({u_matrix:new De(n),u_lightpos:new me(n),u_lightintensity:new Et(n),u_lightcolor:new me(n),u_vertical_gradient:new Et(n),u_height_factor:new Et(n),u_edge_radius:new Et(n),u_ao:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_up_dir:new me(n),u_height_lift:new Et(n),u_image:new He(n),u_texsize:new Ze(n),u_pixel_coord_upper:new Ze(n),u_pixel_coord_lower:new Ze(n),u_tile_units_to_pixels:new Et(n),u_opacity:new Et(n)}),fillExtrusionGroundEffect:n=>({u_matrix:new De(n),u_opacity:new Et(n),u_ao_pass:new Et(n),u_meter_to_tile:new Et(n),u_ao:new Ze(n),u_flood_light_intensity:new Et(n),u_flood_light_color:new me(n),u_attenuation:new Et(n),u_edge_radius:new Et(n),u_fb:new He(n),u_fb_size:new Et(n)}),fill:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n)}),fillPattern:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_image:new He(n),u_texsize:new Ze(n),u_pixel_coord_upper:new Ze(n),u_pixel_coord_lower:new Ze(n),u_tile_units_to_pixels:new Et(n)}),fillOutline:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_world:new Ze(n)}),fillOutlinePattern:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_world:new Ze(n),u_image:new He(n),u_texsize:new Ze(n),u_pixel_coord_upper:new Ze(n),u_pixel_coord_lower:new Ze(n),u_tile_units_to_pixels:new Et(n)}),circle:n=>({u_camera_to_center_distance:new Et(n),u_extrude_scale:new uu(n),u_device_pixel_ratio:new Et(n),u_matrix:new De(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_up_dir:new me(n),u_emissive_strength:new Et(n)}),collisionBox:n=>({u_matrix:new De(n),u_camera_to_center_distance:new Et(n),u_extrude_scale:new Ze(n)}),collisionCircle:n=>({u_matrix:new De(n),u_inv_matrix:new De(n),u_camera_to_center_distance:new Et(n),u_viewport_size:new Ze(n)}),debug:n=>({u_color:new vr(n),u_matrix:new De(n),u_overlay:new He(n),u_overlay_scale:new Et(n)}),clippingMask:n=>({u_matrix:new De(n)}),heatmap:n=>({u_extrude_scale:new Et(n),u_intensity:new Et(n),u_matrix:new De(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_up_dir:new me(n)}),heatmapTexture:n=>({u_image:new He(n),u_color_ramp:new He(n),u_opacity:new Et(n)}),hillshade:n=>({u_matrix:new De(n),u_image:new He(n),u_latrange:new Ze(n),u_light:new Ze(n),u_shadow:new vr(n),u_highlight:new vr(n),u_emissive_strength:new Et(n),u_accent:new vr(n)}),hillshadePrepare:n=>({u_matrix:new De(n),u_image:new He(n),u_dimension:new Ze(n),u_zoom:new Et(n),u_unpack:new bs(n)}),line:n=>({u_matrix:new De(n),u_pixels_to_tile_units:new uu(n),u_device_pixel_ratio:new Et(n),u_units_to_pixels:new Ze(n),u_dash_image:new He(n),u_gradient_image:new He(n),u_image_height:new Et(n),u_texsize:new Ze(n),u_tile_units_to_pixels:new Et(n),u_alpha_discard_threshold:new Et(n),u_trim_offset:new Ze(n),u_emissive_strength:new Et(n)}),linePattern:n=>({u_matrix:new De(n),u_texsize:new Ze(n),u_pixels_to_tile_units:new uu(n),u_device_pixel_ratio:new Et(n),u_image:new He(n),u_units_to_pixels:new Ze(n),u_tile_units_to_pixels:new Et(n),u_alpha_discard_threshold:new Et(n)}),raster:n=>({u_matrix:new De(n),u_normalize_matrix:new De(n),u_globe_matrix:new De(n),u_tl_parent:new Ze(n),u_scale_parent:new Et(n),u_fade_t:new Et(n),u_opacity:new Et(n),u_image0:new He(n),u_image1:new He(n),u_brightness_low:new Et(n),u_brightness_high:new Et(n),u_saturation_factor:new Et(n),u_contrast_factor:new Et(n),u_spin_weights:new me(n),u_perspective_transform:new Ze(n),u_colorization_mix:new bs(n),u_colorization_scale:new Ze(n),u_color_ramp:new He(n)}),symbolIcon:n=>({u_is_size_zoom_constant:new He(n),u_is_size_feature_constant:new He(n),u_size_t:new Et(n),u_size:new Et(n),u_camera_to_center_distance:new Et(n),u_rotate_symbol:new He(n),u_aspect_ratio:new Et(n),u_fade_change:new Et(n),u_matrix:new De(n),u_label_plane_matrix:new De(n),u_coord_matrix:new De(n),u_is_text:new He(n),u_pitch_with_map:new He(n),u_texsize:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_camera_forward:new me(n),u_tile_matrix:new De(n),u_up_vector:new me(n),u_ecef_origin:new me(n),u_texture:new He(n),u_icon_transition:new Et(n)}),symbolSDF:n=>({u_is_size_zoom_constant:new He(n),u_is_size_feature_constant:new He(n),u_size_t:new Et(n),u_size:new Et(n),u_camera_to_center_distance:new Et(n),u_rotate_symbol:new He(n),u_aspect_ratio:new Et(n),u_fade_change:new Et(n),u_matrix:new De(n),u_label_plane_matrix:new De(n),u_coord_matrix:new De(n),u_is_text:new He(n),u_pitch_with_map:new He(n),u_texsize:new Ze(n),u_texture:new He(n),u_gamma_scale:new Et(n),u_device_pixel_ratio:new Et(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_camera_forward:new me(n),u_tile_matrix:new De(n),u_up_vector:new me(n),u_ecef_origin:new me(n),u_is_halo:new He(n)}),symbolTextAndIcon:n=>({u_is_size_zoom_constant:new He(n),u_is_size_feature_constant:new He(n),u_size_t:new Et(n),u_size:new Et(n),u_camera_to_center_distance:new Et(n),u_rotate_symbol:new He(n),u_aspect_ratio:new Et(n),u_fade_change:new Et(n),u_matrix:new De(n),u_label_plane_matrix:new De(n),u_coord_matrix:new De(n),u_is_text:new He(n),u_pitch_with_map:new He(n),u_texsize:new Ze(n),u_texsize_icon:new Ze(n),u_texture:new He(n),u_texture_icon:new He(n),u_gamma_scale:new Et(n),u_device_pixel_ratio:new Et(n),u_is_halo:new He(n)}),background:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_opacity:new Et(n),u_color:new vr(n)}),backgroundPattern:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_opacity:new Et(n),u_image:new He(n),u_pattern_tl:new Ze(n),u_pattern_br:new Ze(n),u_texsize:new Ze(n),u_pattern_size:new Ze(n),u_pixel_coord_upper:new Ze(n),u_pixel_coord_lower:new Ze(n),u_tile_units_to_pixels:new Et(n)}),terrainRaster:D1,terrainDepth:D1,skybox:n=>({u_matrix:new De(n),u_sun_direction:new me(n),u_cubemap:new He(n),u_opacity:new Et(n),u_temporal_offset:new Et(n)}),skyboxGradient:n=>({u_matrix:new De(n),u_color_ramp:new He(n),u_center_direction:new me(n),u_radius:new Et(n),u_opacity:new Et(n),u_temporal_offset:new Et(n)}),skyboxCapture:n=>({u_matrix_3f:new Th(n),u_sun_direction:new me(n),u_sun_intensity:new Et(n),u_color_tint_r:new bs(n),u_color_tint_m:new bs(n),u_luminance:new Et(n)}),globeRaster:n=>({u_proj_matrix:new De(n),u_globe_matrix:new De(n),u_normalize_matrix:new De(n),u_merc_matrix:new De(n),u_zoom_transition:new Et(n),u_merc_center:new Ze(n),u_image0:new He(n),u_grid_matrix:new Th(n),u_skirt_height:new Et(n),u_frustum_tl:new me(n),u_frustum_tr:new me(n),u_frustum_br:new me(n),u_frustum_bl:new me(n),u_globe_pos:new me(n),u_globe_radius:new Et(n),u_viewport:new Ze(n)}),globeAtmosphere:n=>({u_frustum_tl:new me(n),u_frustum_tr:new me(n),u_frustum_br:new me(n),u_frustum_bl:new me(n),u_horizon:new Et(n),u_transition:new Et(n),u_fadeout_range:new Et(n),u_color:new bs(n),u_high_color:new bs(n),u_space_color:new bs(n),u_temporal_offset:new Et(n),u_horizon_angle:new Et(n)}),model:n=>({u_matrix:new De(n),u_lighting_matrix:new De(n),u_normal_matrix:new De(n),u_lightpos:new me(n),u_lightintensity:new Et(n),u_lightcolor:new me(n),u_camera_pos:new me(n),u_opacity:new Et(n),u_baseColorFactor:new bs(n),u_emissiveFactor:new bs(n),u_metallicFactor:new Et(n),u_roughnessFactor:new Et(n),u_baseTextureIsAlpha:new He(n),u_alphaMask:new He(n),u_alphaCutoff:new Et(n),u_baseColorTexture:new He(n),u_metallicRoughnessTexture:new He(n),u_normalTexture:new He(n),u_occlusionTexture:new He(n),u_emissionTexture:new He(n),u_color_mix:new bs(n),u_aoIntensity:new Et(n)}),modelDepth:n=>({u_matrix:new De(n),u_instance:new De(n),u_node_matrix:new De(n)}),groundShadow:n=>({u_matrix:new De(n),u_ground_shadow_factor:new me(n)}),stars:n=>({u_matrix:new De(n),u_up:new me(n),u_right:new me(n),u_intensity_multiplier:new Et(n)})};let yv;function k1(n,t,r,s,l,c,d){const h=n.context,p=h.gl,m=n.transform,_=n.getOrCreateProgram("collisionBox"),y=[];let v=0,b=0;for(let P=0;P<s.length;P++){const I=s[P],O=t.getTile(I),F=O.getBucket(r);if(!F)continue;const L=gR(I,F,m);let N=L;0===l[0]&&0===l[1]||(N=n.translatePosMatrix(L,O,l,c));const z=d?F.textCollisionBox:F.iconCollisionBox,U=F.collisionCircleArray;if(U.length>0){const V=rt.create(),H=N;rt.mul(V,F.placementInvProjMatrix,m.glCoordMatrix),rt.mul(V,V,F.placementViewportMatrix),y.push({circleArray:U,circleOffset:b,transform:H,invTransform:V,projection:F.getProjection()}),v+=U.length/4,b=v}z&&(n.terrain&&n.terrain.setupElevationDraw(O,_),_.draw(n,p.LINES,ve.disabled,Fe.disabled,n.colorModeForRenderPass(),Ge.disabled,VR(N,m,O,F.getProjection()),r.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,null,m.zoom,null,[z.collisionVertexBuffer,z.collisionVertexBufferExt]))}if(!d||!y.length)return;const E=n.getOrCreateProgram("collisionCircle"),C=new Eh;C.resize(4*v),C._trim();let S=0;for(const P of y)for(let I=0;I<P.circleArray.length/4;I++){const O=4*I,F=P.circleArray[O+0],L=P.circleArray[O+1],N=P.circleArray[O+2],z=P.circleArray[O+3];C.emplace(S++,F,L,N,z,0),C.emplace(S++,F,L,N,z,1),C.emplace(S++,F,L,N,z,2),C.emplace(S++,F,L,N,z,3)}(!yv||yv.length<2*v)&&(yv=function(P){const I=2*P,O=new er;O.resize(I),O._trim();for(let F=0;F<I;F++){const L=6*F;O.uint16[L+0]=4*F+0,O.uint16[L+1]=4*F+1,O.uint16[L+2]=4*F+2,O.uint16[L+3]=4*F+2,O.uint16[L+4]=4*F+3,O.uint16[L+5]=4*F+0}return O}(v));const M=h.createIndexBuffer(yv,!0),D=h.createVertexBuffer(C,n2.members,!0);for(const P of y){const I={u_matrix:P.transform,u_inv_matrix:P.invTransform,u_camera_to_center_distance:(R=m).getCameraToCenterDistance(P.projection),u_viewport_size:[R.width,R.height]};E.draw(n,p.TRIANGLES,ve.disabled,Fe.disabled,n.colorModeForRenderPass(),Ge.disabled,I,r.id,D,M,Bn.simpleSegment(0,2*P.circleOffset,P.circleArray.length,P.circleArray.length/2),null,m.zoom)}var R;D.destroy(),M.destroy()}const dg=rt.create();function qR({width:n,height:t,anchor:r,textOffset:s,textScale:l},c){const{horizontalAlign:d,verticalAlign:h}=My(r),p=-(d-.5)*n,m=-(h-.5)*t,_=bm(r,s);return new nt((p/l+_[0])*c,(m/l+_[1])*c)}function WR(n,t,r,s,l,c,d,h,p,m,_){const y=n.text.placedSymbolArray,v=n.text.dynamicLayoutVertexArray,b=n.icon.dynamicLayoutVertexArray,E={},C=n.getProjection(),S=av(h,C,c),M=c.elevation,D=C.upVectorScale(h.canonical,c.center.lat,c.worldSize).metersToTile;v.clear();for(let R=0;R<y.length;R++){const P=y.get(R),{tileAnchorX:I,tileAnchorY:O,numGlyphs:F}=P,L=P.hidden||!P.crossTileID||n.allowVerticalPlacement&&!P.placedOrientation?null:s[P.crossTileID];if(L){let N=0,z=0,U=0;if(M){const ot=M?M.getAtTileOffset(h,I,O):0,[lt,ht,mt]=C.upVector(h.canonical,I,O);N=ot*lt*D,z=ot*ht*D,U=ot*mt*D}let[V,H,j,Z]=ba(P.projectedAnchorX+N,P.projectedAnchorY+z,P.projectedAnchorZ+U,r?S:d);const tt=lS(c.getCameraToCenterDistance(C),Z);let it=l.evaluateSizeForFeature(n.textSizeData,m,P)*tt/kr;r&&(it*=n.tilePixelRatio/p);const X=qR(L,it);r?(({x:V,y:H,z:j}=C.projectTilePoint(I+X.x,O+X.y,h.canonical)),[V,H,j]=ba(V+N,H+z,j+U,d)):(t&&X._rotate(-c.angle),V+=X.x,H+=X.y,j=0);const Y=n.allowVerticalPlacement&&P.placedOrientation===ti.vertical?Math.PI/2:0;for(let ot=0;ot<F;ot++)uf(v,V,H,j,Y);_&&P.associatedIconIndex>=0&&(E[P.associatedIconIndex]={x:V,y:H,z:j,angle:Y})}else Ad(F,v)}if(_){b.clear();const R=n.icon.placedSymbolArray;for(let P=0;P<R.length;P++){const I=R.get(P),{numGlyphs:O}=I,F=E[P];if(I.hidden||!F)Ad(O,b);else{const{x:L,y:N,z,angle:U}=F;for(let V=0;V<O;V++)uf(b,L,N,z,U)}}n.icon.dynamicLayoutVertexBuffer.updateData(b)}n.text.dynamicLayoutVertexBuffer.updateData(v)}function kT(n,t,r){return r.iconsInText&&t?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function FT(n,t,r,s,l,c,d,h,p,m,_,y){const v=n.context,b=v.gl,E=n.transform,C="map"===h,S="map"===p,M=C&&"point"!==r.layout.get("symbol-placement"),D=C&&!S&&!M,R=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let P=!1;const I=n.depthModeForSublayer(0,ve.ReadOnly),O=[eo(E.center.lng),po(E.center.lat)],F=r.layout.get("text-variable-anchor"),L="globe"===E.projection.name,N=[],z=[0,-1,0];let U=z;!L&&!E.mercatorFromTransition||C||(U=function(V){const H=V._camera.getWorldToCamera(V.worldSize,1),j=rt.multiply([],H,V.globeMatrix);rt.invert(j,j);const Z=[0,0,0],tt=[0,1,0,0];return Fn.transformMat4(tt,tt,j),Z[0]=tt[0],Z[1]=tt[1],Z[2]=tt[2],q.normalize(Z,Z),Z}(E));for(const V of s){const H=t.getTile(V),j=H.getBucket(r);if(!j||"mercator"===j.projection.name&&L)continue;const Z=l?j.text:j.icon;if(!Z||j.fullyClipped||!Z.segments.get().length)continue;const tt=Z.programConfigurations.get(r.id),it=l||j.sdfIcons,X=l?j.textSizeData:j.iconSizeData,Y=S||0!==E.pitch,ot=Ic(X,E.zoom);let lt,ht,mt,yt,ct=[0,0],ft=null;if(l)ht=H.glyphAtlasTexture,mt=b.LINEAR,lt=H.glyphAtlasTexture.size,j.iconsInText&&(ct=H.imageAtlasTexture.size,ft=H.imageAtlasTexture,yt=Y||n.options.rotating||n.options.zooming||"composite"===X.kind||"camera"===X.kind?b.LINEAR:b.NEAREST);else{const _i=1!==r.layout.get("icon-size").constantOr(0)||j.iconsNeedLinear;ht=H.imageAtlasTexture,mt=it||n.options.rotating||n.options.zooming||_i||Y?b.LINEAR:b.NEAREST,lt=H.imageAtlasTexture.size}const Rt="globe"===j.projection.name,Vt=Rt?U:z,jt=Rt?Br(E.zoom):0,$t=av(V,j.getProjection(),E),re=E.calculatePixelsToTileUnitsMatrix(H),ye=bf($t,H.tileID.canonical,S,C,E,j.getProjection(),re),je=n.terrain&&S&&M?rt.invert(rt.create(),ye):dg,rn=zb($t,H.tileID.canonical,S,C,E,j.getProjection(),re),Re=F&&j.hasTextData(),Me=j.hasIconTextFit()&&Re&&j.hasIconData();if(M){const _i=E.elevation,di=_i?_i.getAtTileOffsetFunc(V,E.center.lat,E.worldSize,j.getProjection()):null,Hn=Zy($t,H.tileID.canonical,S,C,E,j.getProjection(),re);cS(j,$t,n,l,Hn,rn,S,m,di,V)}const ge=M||l&&F||Me,ue=n.translatePosMatrix($t,H,c,d),Le=ge?dg:ye,an=n.translatePosMatrix(rn,H,c,d,!0),Be=j.getProjection().createInversionMatrix(E,V.canonical),Zn=r.paint.get("icon-image-cross-fade").constantOr(0),Si=[];n.terrainRenderModeElevated()&&S&&Si.push("PITCH_WITH_MAP_TERRAIN"),Rt&&(Si.push("PROJECTION_GLOBE_VIEW"),ge&&Si.push("PROJECTED_POS_ON_VIEWPORT")),Zn>0&&Si.push("ICON_TRANSITION"),Z.zOffsetVertexBuffer&&Si.push("Z_OFFSET");const ui=it&&0!==r.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1);let ei;ei=it?j.iconsInText?GR(X.kind,ot,D,S,n,ue,Le,an,lt,ct,V,jt,O,Be,Vt,j.getProjection()):HR(X.kind,ot,D,S,n,ue,Le,an,l,lt,!0,V,jt,O,Be,Vt,j.getProjection()):RT(X.kind,ot,D,S,n,ue,Le,an,l,lt,V,jt,O,Be,Vt,j.getProjection(),Zn);const cr={program:n.getOrCreateProgram(kT(it,l,j),{config:tt,defines:Si}),buffers:Z,uniformValues:ei,atlasTexture:ht,atlasTextureIcon:ft,atlasInterpolation:mt,atlasInterpolationIcon:yt,isSDF:it,hasHalo:ui,tile:H,labelPlaneMatrixInv:je};if(R&&j.canOverlap){P=!0;const _i=Z.segments.get();for(const di of _i)N.push({segments:new Bn([di]),sortKey:di.sortKey,state:cr})}else N.push({segments:Z.segments,sortKey:0,state:cr})}P&&N.sort((V,H)=>V.sortKey-H.sortKey);for(const V of N){const H=V.state;if(n.terrain&&n.terrain.setupElevationDraw(H.tile,H.program,{useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:H.labelPlaneMatrixInv}),v.activeTexture.set(b.TEXTURE0),H.atlasTexture.bind(H.atlasInterpolation,b.CLAMP_TO_EDGE),H.atlasTextureIcon&&(v.activeTexture.set(b.TEXTURE1),H.atlasTextureIcon&&H.atlasTextureIcon.bind(H.atlasInterpolationIcon,b.CLAMP_TO_EDGE)),n.uploadCommonLightUniforms(n.context,H.program),H.hasHalo){const j=H.uniformValues;j.u_is_halo=1,F1(H.buffers,V.segments,r,n,H.program,I,_,y,j,2),j.u_is_halo=0}else{if(H.isSDF){const j=H.uniformValues;H.hasHalo&&(j.u_is_halo=1,F1(H.buffers,V.segments,r,n,H.program,I,_,y,j,1)),j.u_is_halo=0}F1(H.buffers,V.segments,r,n,H.program,I,_,y,H.uniformValues,1)}}}function F1(n,t,r,s,l,c,d,h,p,m){const _=[n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer,n.iconTransitioningVertexBuffer,n.globeExtVertexBuffer,n.zOffsetVertexBuffer];l.draw(s,s.context.gl.TRIANGLES,c,d,h,Ge.disabled,p,r.id,n.layoutVertexBuffer,n.indexBuffer,t,r.paint,s.transform.zoom,n.programConfigurations.get(r.id),_,m)}function L1(n,t,r,s,l,c,d){const h=n.context.gl,p=r.paint.get("fill-pattern"),m=p&&p.constantOr(1);let _,y,v,b,E;d?(y=m&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_=h.LINES):(y=m?"fillPattern":"fill",_=h.TRIANGLES);for(const C of s){const S=t.getTile(C);if(m&&!S.patternsLoaded())continue;const M=S.getBucket(r);if(!M)continue;n.prepareDrawTile();const D=M.programConfigurations.get(r.id),R=n.isTileAffectedByFog(C),P=n.getOrCreateProgram(y,{config:D,overrideFog:R});m&&(n.context.activeTexture.set(h.TEXTURE0),S.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),D.updatePaintBuffers());const I=p.constantOr(null);if(I&&S.imageAtlas){const L=S.imageAtlas.patternPositions[I.toString()];L&&D.setConstantPatternPositions(L)}const O=n.translatePosMatrix(C.projMatrix,S,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),F=r.paint.get("fill-emissive-strength");if(d){b=M.indexBuffer2,E=M.segments2;const L=n.terrain&&n.terrain.renderingToTexture?n.terrain.drapeBufferSize:[h.drawingBufferWidth,h.drawingBufferHeight];v="fillOutlinePattern"===y&&m?GF(O,F,n,S,L):HF(O,F,L)}else b=M.indexBuffer,E=M.segments,v=m?DT(O,F,n,S):TT(O,F);n.uploadCommonUniforms(n.context,P,C.toUnwrapped()),P.draw(n,_,l,n.stencilModeForClipping(C),c,Ge.disabled,v,r.id,M.layoutVertexBuffer,b,E,r.paint,n.transform.zoom,D,void 0)}}function ls(n,t,r,s,l,c,d,h){const p=n.context,m=p.gl,_=n.transform,y=r.paint.get("fill-extrusion-pattern"),v=y.constantOr(1),b=r.paint.get("fill-extrusion-opacity"),E=n.style.enable3dLights(),C=r.paint.get(E&&!v?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),S=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),C],M=r.layout.get("fill-extrusion-edge-radius"),D=M>0&&!r.paint.get("fill-extrusion-rounded-roof"),R=D?0:M,P="globe"===_.projection.name?Zb():0,I="globe"===_.projection.name,O=I?Br(_.zoom):0,F=[eo(_.center.lng),po(_.center.lat)],L=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=r.paint.get("fill-extrusion-flood-light-intensity"),z=r.paint.get("fill-extrusion-vertical-scale"),U=Rf(n,r.paint.get("fill-extrusion-cutoff-fade-range")),V=[];let H;I&&V.push("PROJECTION_GLOBE_VIEW"),S[0]>0&&V.push("FAUX_AO"),D&&V.push("ZERO_ROOF_RADIUS"),h&&V.push("HAS_CENTROID"),N>0&&V.push("FLOOD_LIGHT"),U.shouldRenderCutoff&&V.push("RENDER_CUTOFF");const j="shadow"===n.renderPass,Z=n.shadowRenderer,tt=j&&!!Z;n.shadowRenderer&&(n.shadowRenderer.useNormalOffset=!0);let it=[0,0,0];if(Z){const Y=n.style.directionalLight,ot=n.style.ambientLight;Y&&ot&&(it=G1(Y,ot)),H=V.concat(["SHADOWS_SINGLE_CASCADE"])}const X=tt?"fillExtrusionDepth":v?"fillExtrusionPattern":"fillExtrusion";for(const Y of s){const ot=t.getTile(Y),lt=ot.getBucket(r);if(!lt||lt.projection.name!==_.projection.name)continue;let ht=!1;Z&&(ht=0===Z.getMaxCascadeForTile(Y.toUnwrapped()));const mt=n.isTileAffectedByFog(Y),yt=lt.programConfigurations.get(r.id),ct=n.getOrCreateProgram(X,{config:yt,defines:ht?H:V,overrideFog:mt});if(n.terrain){const $t=n.terrain;n.style.terrainSetForDrapingOnly(),$t.setupElevationDraw(ot,ct,{useMeterToDem:!0})}if(!lt.centroidVertexBuffer){const $t=ct.attributes.a_centroid_pos;void 0!==$t&&m.vertexAttrib2f($t,0,0)}!j&&Z&&Z.setupShadows(ot.tileID.toUnwrapped(),ct,"vector-tile",ot.tileID.overscaledZ),v&&(n.context.activeTexture.set(m.TEXTURE0),ot.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),yt.updatePaintBuffers());const ft=y.constantOr(null);if(ft&&ot.imageAtlas){const $t=ot.imageAtlas.patternPositions[ft.toString()];$t&&yt.setConstantPatternPositions($t)}const Rt=r.paint.get("fill-extrusion-vertical-gradient");let Vt;if(j&&Z){if(zT(ot.tileID,lt,n))continue;const $t=Z.calculateShadowPassMatrixFromTile(ot.tileID.toUnwrapped());Vt=MT($t,R,z)}else{const $t=n.translatePosMatrix(Y.projMatrix,ot,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),re=_.projection.createInversionMatrix(_,Y.canonical);Vt=v?ST($t,n,Rt,b,S,R,Y,ot,P,O,F,re,L,z):P1($t,n,Rt,b,S,R,Y,P,O,F,re,L,z,N,it)}n.uploadCommonUniforms(p,ct,Y.toUnwrapped(),null,U);const jt=[];(n.terrain||h)&&jt.push(lt.centroidVertexBuffer),I&&jt.push(lt.layoutVertexExtBuffer),ct.draw(n,p.gl.TRIANGLES,l,c,d,Ge.backCCW,Vt,r.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,r.paint,n.transform.zoom,yt,jt)}n.shadowRenderer&&(n.shadowRenderer.useNormalOffset=!1)}function kf(n,t,r,s,l,c,d,h,p,m,_,y,v,b,E,C,S,M,D){const R=n.context,P=R.gl,I=n.transform,O=n.transform.zoom,F=[],L=Rf(n,r.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===m?(F.push("CLEAR_SUBPASS"),D&&(F.push("CLEAR_FROM_TEXTURE"),R.activeTexture.set(P.TEXTURE0),D.bind(P.LINEAR,P.CLAMP_TO_EDGE))):"sdf"===m&&F.push("SDF_SUBPASS"),S&&F.push("HAS_CENTROID"),L.shouldRenderCutoff&&F.push("RENDER_CUTOFF");const N=r.layout.get("fill-extrusion-edge-radius"),z=(U,V,H,j,Z)=>{const tt=V.programConfigurations.get(r.id),it=n.isTileAffectedByFog(U),X=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:tt,defines:F,overrideFog:it}),Y={u_matrix:j,u_opacity:_,u_ao_pass:p?1:0,u_meter_to_tile:Z,u_ao:[y,v*Z],u_flood_light_intensity:b,u_flood_light_color:E,u_attenuation:C,u_edge_radius:O>=17?0:N*Z,u_fb:0,u_fb_size:D?D.size[0]:0},ot=[];S&&ot.push(V.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(R,X,U.toUnwrapped(),null,L),X.draw(n,R.gl.TRIANGLES,l,c,d,h,Y,r.id,V.vertexBuffer,V.indexBuffer,H,r.paint,O,tt,ot)};for(const U of s){const V=t.getTile(U),H=V.getBucket(r);if(!H||H.projection.name!==I.projection.name||!H.groundEffect||H.groundEffect&&!H.groundEffect.hasData())continue;const j=H.groundEffect,Z=1/H.tileToMeter;{const tt=n.translatePosMatrix(U.projMatrix,V,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),it=j.getDefaultSegment();z(U,j,it,tt,Z)}if(M)for(let tt=0;tt<4;tt++){const it=Tx[tt](U),X=t.getTile(it);if(!X)continue;const Y=X.getBucket(r);if(!Y||Y.projection.name!==I.projection.name||!Y.groundEffect||Y.groundEffect&&!Y.groundEffect.hasData())continue;const ot=Y.groundEffect;let lt,ht;0===tt?(lt=[-dt,0,0],ht=1):1===tt?(lt=[dt,0,0],ht=0):2===tt?(lt=[0,-dt,0],ht=3):(lt=[0,dt,0],ht=2);const mt=ot.regionSegments[ht];if(!mt)continue;const yt=new Float32Array(16);rt.translate(yt,U.projMatrix,lt),z(U,ot,mt,n.translatePosMatrix(yt,V,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Z)}}}function ZR(n,t,r,s,l,c,d){0===s.centroidVertexArray.length&&s.createCentroidsBuffer();const h=c?c.findDEMTileFor(r):null;if(!(h&&h.dem||d))return;const p=M=>{const D=t.getSource().minzoom,R=I=>{const O=t.getTileByID(I);if(O&&O.hasData())return O.getBucket(l)},P=[0,-1,1];for(const I of P){if(M.overscaledZ+I<D)continue;const O=R(M.calculateScaledKey(M.overscaledZ+I));if(O)return O}},m=[0,0,0],_=(M,D)=>(m[0]=Math.min(M.min.y,D.min.y),m[1]=Math.max(M.max.y,D.max.y),m[2]=dt-D.min.x>M.max.x?D.min.x-dt:M.max.x,m),y=(M,D)=>(m[0]=Math.min(M.min.x,D.min.x),m[1]=Math.max(M.max.x,D.max.x),m[2]=dt-D.min.y>M.max.y?D.min.y-dt:M.max.y,m),v=[(M,D)=>_(M,D),(M,D)=>_(D,M),(M,D)=>y(M,D),(M,D)=>y(D,M)],b=(M,D,R,P,I,O,F)=>{if(!c)return 0;const L=[[O?R:M,O?M:R,0],[O?R:D,O?D:R,0]],N=F<0?dt+F:F,z=[O?N:(M+D)/2,O?(M+D)/2:N,0];return 0===R&&F<0||0!==R&&F>0?c.getForTilePoints(I,[z],!0,P):L.push(z),c.getForTilePoints(r,L,!0,h),Math.max(L[0][2],L[1][2],z[2])/c.exaggeration()};for(let M=0;M<4;M++){const D=s.borderFeatureIndices[M];if(0===D.length)continue;const R=Tx[M](r),P=p(R);if(!(P&&P instanceof Mf)||s.borderDoneWithNeighborZ[M]===P.canonical.z)continue;0===P.centroidVertexArray.length&&P.createCentroidsBuffer();const I=c?c.findDEMTileFor(R):null;if(!(I&&I.dem||d))continue;const O=(M<2?1:5)-M,F=P.borderDoneWithNeighborZ[O]!==s.canonical.z,L=P.borderFeatureIndices[O];let N=0;if(s.canonical.z!==P.canonical.z){for(const z of D)s.showCentroid(s.featuresOnBorder[z]);if(F)for(const z of L)P.showCentroid(P.featuresOnBorder[z]);s.borderDoneWithNeighborZ[M]=P.canonical.z,P.borderDoneWithNeighborZ[O]=s.canonical.z}for(const z of D){const U=s.featuresOnBorder[z],V=s.centroidData[U.centroidDataIndex],H=U.borders[M];let j;for(;N<L.length;){j=P.featuresOnBorder[L[N]];const Z=j.borders[O];if(Z[1]>H[0]+3||Z[0]>H[0]-3)break;P.showCentroid(j),N++}if(j&&N<L.length){const Z=N;let tt=0;for(;!(j.borders[O][0]>H[1]-3)&&(tt++,++N!==L.length);)j=P.featuresOnBorder[L[N]];if(j=P.featuresOnBorder[L[Z]],tt>1){const Y=j.borders[O];Math.abs(H[0]-Y[0])<3&&Math.abs(H[1]-Y[1])<3&&(tt=1,N=Z+1)}else if(0===tt){s.showCentroid(U);continue}const it=P.centroidData[j.centroidDataIndex];d&&1===tt&&(((C=V).flags|(S=it).flags)&Qa?(C.flags|=Qa,S.flags|=Qa):(C.flags&=2147483647,S.flags&=2147483647));let X=new nt(0,0);if(tt>1)N=Z;else if(I&&I.dem&&!(U.intersectsCount()>1||j.intersectsCount()>1)){const Y=v[M](V,it),ot=M%2?dt-1:0;E=b(Y[0],Math.min(dt-1,Y[1]),ot,I,R,M<2,Y[2]),X=new nt(Math.ceil(7*(E+450)),0)}V.centroidXY=it.centroidXY=X,s.writeCentroidToBuffer(V),P.writeCentroidToBuffer(it)}else s.showCentroid(U)}s.borderDoneWithNeighborZ[M]=P.canonical.z,P.borderDoneWithNeighborZ[O]=s.canonical.z}var E,C,S;(s.needsCentroidUpdate||!s.centroidVertexBuffer&&0!==s.centroidVertexArray.length)&&s.uploadCentroid(n)}const LT=[1,0,0],NT=[0,1,0],N1=[0,0,1];function zT(n,t,r){const s=r.transform,l=r.shadowRenderer;if(!l)return!0;const c=n.toUnwrapped(),d=s.tileSize*l._cascades[r.currentShadowCascade].scale;let h=t.maxHeight;if(s.elevation){const C=s.elevation.getMinMaxForTile(n);C&&(h+=C.max)}const p=[...l.shadowDirection];p[2]=-p[2];const m=l.computeSimplifiedTileShadowVolume(c,h,d,p);if(!m)return!1;const _=[LT,NT,N1,p,[p[0],0,p[2]],[0,p[1],p[2]]],y="globe"===s.projection.name,v=s.scaleZoom(d),b=Bl.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,v,!y),E=l.getCurrentCascadeFrustum();return 0===b.intersectsPrecise(m.vertices,m.planes,_)||0===E.intersectsPrecise(m.vertices,m.planes,_)}const XR=new Ne(1,0,0,1),BT=new Ne(0,1,0,1),VT=new Ne(0,0,1,1),YR=new Ne(1,0,1,1),KR=new Ne(0,1,1,1);function z1(n,t,r){const s=n.context,l=n.transform,c=s.gl,d="globe"===l.projection.name,h=d?["PROJECTION_GLOBE_VIEW"]:[];let p=r.projMatrix;if(d&&Br(l.zoom)>0){const z=ya(J_(r.canonical,l));p=rt.multiply(new Float32Array(16),l.globeMatrix,z),rt.multiply(p,l.projMatrix,p)}const m=n.getOrCreateProgram("debug",{defines:h}),_=t.getTileByID(r.key);n.terrain&&n.terrain.setupElevationDraw(_,m);const y=ve.disabled,v=Fe.disabled,b=n.colorModeForRenderPass(),E="$debug";s.activeTexture.set(c.TEXTURE0),n.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),d?_._makeGlobeTileDebugBuffers(n.context,l):_._makeDebugTileBoundsBuffers(n.context,l.projection);const C=_._tileDebugBuffer||n.debugBuffer,S=_._tileDebugIndexBuffer||n.debugIndexBuffer,M=_._tileDebugSegments||n.debugSegments;m.draw(n,c.LINE_STRIP,y,v,b,Ge.disabled,IT(p,Ne.red),E,C,S,M,null,null,null,[_._globeTileDebugBorderBuffer]);const D=_.latestRawTileData,R=Math.floor((D&&D.byteLength||0)/1024),P=t.getTile(r).tileSize,I=512/Math.min(P,512)*(r.overscaledZ/l.zoom)*.5;let O=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(O+=` => ${r.overscaledZ}`),O+=` ${R}kb`,function(z,U){z.initDebugOverlayCanvas();const V=z.debugOverlayCanvas,H=z.context.gl,j=z.debugOverlayCanvas.getContext("2d");j.clearRect(0,0,V.width,V.height),j.shadowColor="white",j.shadowBlur=2,j.lineWidth=1.5,j.strokeStyle="white",j.textBaseline="top",j.font="bold 36px Open Sans, sans-serif",j.fillText(U,5,5),j.strokeText(U,5,5),z.debugOverlayTexture.update(V),z.debugOverlayTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE)}(n,O);const F=_._tileDebugTextBuffer||n.debugBuffer,L=_._tileDebugTextIndexBuffer||n.quadTriangleIndexBuffer,N=_._tileDebugTextSegments||n.debugSegments;m.draw(n,c.TRIANGLES,y,v,sn.alphaBlended,Ge.disabled,IT(p,Ne.transparent,I),E,F,L,N,null,null,null,[_._globeTileDebugTextBuffer])}function vv(n,t,r,s){Ff(n,0,t+r/2,n.transform.width,r,s)}function B1(n,t,r,s){Ff(n,t-r/2,0,r,n.transform.height,s)}function Ff(n,t,r,s,l,c){const d=n.context,h=d.gl;h.enable(h.SCISSOR_TEST),h.scissor(t*kt.devicePixelRatio,r*kt.devicePixelRatio,s*kt.devicePixelRatio,l*kt.devicePixelRatio),d.clear({color:c}),h.disable(h.SCISSOR_TEST)}const V1=pn([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:JR}=V1;function ku(n,t,r,s){n.emplaceBack(t,r,s)}class jT{constructor(t){this.vertexArray=new ja,this.indices=new er,ku(this.vertexArray,-1,-1,1),ku(this.vertexArray,1,-1,1),ku(this.vertexArray,-1,1,1),ku(this.vertexArray,1,1,1),ku(this.vertexArray,-1,-1,-1),ku(this.vertexArray,1,-1,-1),ku(this.vertexArray,-1,1,-1),ku(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,JR),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=Bn.simpleSegment(0,0,36,12)}}function Lf(n,t,r,s,l,c){const d=n.context.gl,h=t.paint.get("sky-atmosphere-color"),p=t.paint.get("sky-atmosphere-halo-color"),m=t.paint.get("sky-atmosphere-sun-intensity"),_={u_matrix_3f:Zo.fromMat4(Zo.create(),s),u_sun_direction:l,u_sun_intensity:m,u_color_tint_r:[(E=h).r,E.g,E.b,E.a],u_color_tint_m:[(C=p).r,C.g,C.b,C.a],u_luminance:5e-5};var E,C;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+c,t.skyboxTexture,0),r.draw(n,d.TRIANGLES,ve.disabled,Fe.disabled,sn.unblended,Ge.frontCW,_,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const UT=pn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class j1{constructor(t){const r=new ha;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const s=new er;s.emplaceBack(0,1,2),s.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,UT.members),this.indexBuffer=t.createIndexBuffer(s),this.segments=Bn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xr=pn([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ea{constructor(){this.colorModeAlphaBlendedWriteRGB=new sn([1,771,1,771],Ne.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new sn([1,0,1,0],Ne.transparent,[!1,!1,!1,!0])}update(t){const r=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new j1(r);const s=100,l=200,c=function(_){const y=CE(30),v=[];for(let b=0;b<16e3;++b){const E=2*Math.PI*y(),C=Math.acos(1-2*y())-.5*Math.PI;v.push(q.fromValues(Math.cos(C)*Math.cos(E),Math.cos(C)*Math.sin(E),Math.sin(C)))}return v}(),d=CE(300),h=new ld,p=new er;let m=0;for(let _=0;_<c.length;++_){const y=q.scale([],c[_],200),v=Math.max(0,1+.01*s*(1*d()-.5)),b=Math.max(0,1+.01*l*(1*d()-.5));h.emplaceBack(y[0],y[1],y[2],-1,-1,v,b),h.emplaceBack(y[0],y[1],y[2],1,-1,v,b),h.emplaceBack(y[0],y[1],y[2],1,1,v,b),h.emplaceBack(y[0],y[1],y[2],-1,1,v,b),p.emplaceBack(m+0,m+1,m+2),p.emplaceBack(m+0,m+2,m+3),m+=4}this.starsVx=r.createVertexBuffer(h,xr.members),this.starsIdx=r.createIndexBuffer(p),this.starsSegments=Bn.simpleSegment(0,0,h.length,p.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const s=t.context,l=s.gl,c=t.transform,d=new ve(l.LEQUAL,ve.ReadOnly,[0,1]),h=Br(c.zoom),p=r.properties.get("color").toArray01(),m=r.properties.get("high-color").toArray01(),_=r.properties.get("space-color").toArray01PremultipliedAlpha(),y=5e-4,v=Jt((r.properties.get("horizon-blend")-0)/1*.2495+y,5e-4,.25),b=HC(t,s,c)&&v===y?c.worldSize/(2*Math.PI*1.025)-1:c.globeRadius,E=t.frameCounter/1e3%1,C=q.length(c.globeCenterInViewSpace),S=Math.sqrt(Math.pow(C,2)-Math.pow(b,2)),M=Math.acos(S/C),D=R=>{const P="globe"===c.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];R&&P.push("ALPHA_PASS");const I=t.getOrCreateProgram("globeAtmosphere",{defines:P}),O={u_frustum_tl:c.frustumCorners.TL,u_frustum_tr:c.frustumCorners.TR,u_frustum_br:c.frustumCorners.BR,u_frustum_bl:c.frustumCorners.BL,u_horizon:c.frustumCorners.horizon,u_transition:h,u_fadeout_range:v,u_color:p,u_high_color:m,u_space_color:_,u_temporal_offset:E,u_horizon_angle:M};t.uploadCommonUniforms(s,I);const F=this.atmosphereBuffer;F&&I.draw(t,l.TRIANGLES,d,Fe.disabled,R?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ge.backCW,O,R?"atmosphere_glow_alpha":"atmosphere_glow",F.vertexBuffer,F.indexBuffer,F.segments)};D(!1),D(!0)}drawStars(t,r){const s=Jt(r.properties.get("star-intensity"),0,1);if(0===s)return;const l=t.context,c=l.gl,d=t.transform,h=t.getOrCreateProgram("stars"),p=Qr.identity([]);Qr.rotateX(p,p,-d._pitch),Qr.rotateZ(p,p,-d.angle),Qr.rotateX(p,p,Ie(d._center.lat)),Qr.rotateY(p,p,-Ie(d._center.lng));const m=rt.fromQuat(new Float32Array(16),p),_=rt.multiply([],d.starsProjMatrix,m),y=Zo.fromMat4([],m),v=Zo.invert([],y),b=[0,1,0];q.transformMat3(b,b,v),q.scale(b,b,.15);const E=[1,0,0];q.transformMat3(E,E,v),q.scale(E,E,.15);const C=(M=b,D=E,R=s,{u_matrix:Float32Array.from(_),u_up:M,u_right:D,u_intensity_multiplier:R});var M,D,R;t.uploadCommonUniforms(l,h),this.starsVx&&this.starsIdx&&h.draw(t,c.TRIANGLES,ve.disabled,Fe.disabled,this.colorModeAlphaBlendedWriteRGB,Ge.disabled,C,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ks(n,t){const r=[...n],s=t.cameraWorldSizeForFog/t.worldSize,l=rt.identity([]);return rt.scale(l,l,[s,s,1]),rt.multiply(r,l,r),rt.multiply(r,t.worldToFogMatrix,r),r}function rr(n,t,r,s){const l=r.material,c=s.context,{baseColorTexture:d,metallicRoughnessTexture:h}=l.pbrMetallicRoughness,{normalTexture:p,occlusionTexture:m,emissionTexture:_}=l;function y(v,b,E){if(v&&(n.push(b),c.activeTexture.set(c.gl.TEXTURE0+E),v.gfxTexture)){const{minFilter:C,magFilter:S,wrapS:M,wrapT:D}=v.sampler;v.gfxTexture.bindExtraParam(C,S,M,D)}}y(d,"HAS_TEXTURE_u_baseColorTexture",As.BaseColor),y(h,"HAS_TEXTURE_u_metallicRoughnessTexture",As.MetallicRoughness),y(p,"HAS_TEXTURE_u_normalTexture",As.Normal),y(m,"HAS_TEXTURE_u_occlusionTexture",As.Occlusion),y(_,"HAS_TEXTURE_u_emissionTexture",As.Emission),r.texcoordBuffer&&(n.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(n.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(n.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(n.push("HAS_ATTRIBUTE_a_pbr"),n.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),"OPAQUE"!==l.alphaMode&&"MASK"!==l.alphaMode||n.push("UNPREMULT_TEXTURE_IN_SHADER"),l.defined||n.push("DIFFUSE_SHADED"),n.push("USE_STANDARD_DERIVATIVES")}function xv(n,t,r,s,l,c){const d=r.paint.get("model-opacity"),h=t.context,p=new ve(t.context.gl.LEQUAL,ve.ReadWrite,t.depthRangeFor3D),m=t.transform,_=n.mesh,y=_.material,v=y.pbrMetallicRoughness,b=t.style.fog;let E;E="pixels"===t.transform.projection.zAxisUnit?[...n.nodeModelMatrix]:rt.multiply([],s.zScaleMatrix,n.nodeModelMatrix),rt.multiply(E,s.negCameraPosMatrix,E);const C=rt.invert([],E);rt.transpose(C,C);const S=O1(new Float32Array(n.worldViewProjection),new Float32Array(E),new Float32Array(C),t,d,v.baseColorFactor,y.emissiveFactor,v.metallicFactor,v.roughnessFactor,y,r),M={defines:[]},D=[];rr(M.defines,D,_,t);const R=t.shadowRenderer;R&&(R.useNormalOffset=!1);let P=null;if(b){const F=Ks(n.nodeModelMatrix,t.transform);if(P=new Float32Array(F),"globe"!==m.projection.name){const L=_.aabb.min,N=_.aabb.max,[z,U]=b.getOpacityForBounds(F,L[0],L[1],N[0],N[1]);M.overrideFog=z>=Iu||U>=Iu}}const I=Rf(t,r.paint.get("model-cutoff-fade-range"));I.shouldRenderCutoff&&M.defines.push("RENDER_CUTOFF");const O=t.getOrCreateProgram("model",M);t.uploadCommonUniforms(h,O,null,P,I),"shadow"!==t.renderPass&&R&&R.setupShadowsFromMatrix(n.nodeModelMatrix,O),O.draw(t,h.gl.TRIANGLES,p,l,c,_.material.doubleSided?Ge.disabled:Ge.backCCW,S,r.id,_.vertexBuffer,_.indexBuffer,_.segments,r.paint,t.transform.zoom,void 0,D)}function U1(n,t,r,s,l,c,d){let h;h="globe"===n.projection.name?Xy(r,n):[...r],rt.multiply(h,h,t.matrix);const p=rt.multiply([],s,h);if(t.meshes)for(const m of t.meshes){if("BLEND"!==m.material.alphaMode){d.push({mesh:m,depth:0,modelIndex:l,worldViewProjection:p,nodeModelMatrix:h});continue}const _=q.transformMat4([],m.centroid,p);_[2]>0&&c.push({mesh:m,depth:_[2],modelIndex:l,worldViewProjection:p,nodeModelMatrix:h})}if(t.children)for(const m of t.children)U1(n,m,r,s,l,c,d)}function bv(n,t,r,s){const l=r.shadowRenderer;if(!l)return;const c=l.getShadowPassDepthMode(),d=l.getShadowPassColorMode(),h=l.calculateShadowPassMatrixFromMatrix(t),p=ug(h);r.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,c,Fe.disabled,d,Ge.backCCW,p,s.id,n.vertexBuffer,n.indexBuffer,n.segments,s.paint,r.transform.zoom,void 0,void 0)}function QR(n,t,r){const s=t.updateZoomBasedPaintProperties(),l=function(c,d,h){let p,m,_,y=c.terrain?c.terrain.exaggeration():0;if(c.terrain&&y>0){const v=c.terrain,b=v.findDEMTileFor(h);b&&b.dem?p=Za.create(v,h,b):y=0}if(0===y&&(d.terrainElevationMin=0,d.terrainElevationMax=0),y===d.validForExaggeration&&(0===y||p&&p._demTile&&p._demTile.tileID===d.validForDEMTile.id&&p._dem._timestamp===d.validForDEMTile.timestamp))return!1;for(const v in d.instancesPerModel){const b=d.instancesPerModel[v];for(let E=0;E<b.instancedDataArray.length;++E){const C=(p?y*p.getElevationAt(0|b.instancedDataArray.float32[16*E],0|b.instancedDataArray.float32[16*E+1],!0,!0):0)+b.instancesEvaluatedElevation[E];b.instancedDataArray.float32[16*E+6]=C,m=m?Math.min(d.terrainElevationMin,C):C,_=_?Math.max(d.terrainElevationMax,C):C}}return d.terrainElevationMin=m||0,d.terrainElevationMax=_||0,d.validForExaggeration=y,d.validForDEMTile=p&&p._demTile?{id:p._demTile.tileID,timestamp:p._dem._timestamp}:{id:void 0,timestamp:0},!0}(n,t,r);(s||l)&&(t.uploaded=!1,t.upload(n.context))}const sl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new ci([0,0,0],[dt,dt,0])};function $T(n,t){const r=1<<n.canonical.z,s=t.getFreeCameraOptions().position,l=t.elevation,c=n.canonical.x/r,d=(n.canonical.x+1)/r,h=n.canonical.y/r,p=(n.canonical.y+1)/r;let m=t._centerAltitude;if(l){const b=l.getMinMaxForTile(n);b&&b.max>m&&(m=b.max)}const _=Jt(s.x,c,d)-s.x,y=Jt(s.y,h,p)-s.y,v=Ln(m,t.center.lat)-s.z;return t._zoomFromMercatorZ(Math.sqrt(_*_+y*y+v*v))}function Yo(n,t,r,s,l,c,d){const h=n.context,p="shadow"===n.renderPass,m=n.shadowRenderer,_=p&&m?m.getShadowPassDepthMode():new ve(h.gl.LEQUAL,ve.ReadWrite,n.depthRangeFor3D),y=n.isTileAffectedByFog(c);if(r.meshes)for(const v of r.meshes){const b=["MODEL_POSITION_ON_GPU"],E=[];let C,S,M;s.instancedDataArray.length>20&&b.push("INSTANCED_ARRAYS");const D=Rf(n,t.paint.get("model-cutoff-fade-range"));if(D.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),p&&m)C=n.getOrCreateProgram("modelDepth",{defines:b}),S=ug(d.shadowTileMatrix,d.shadowTileMatrix,Float32Array.from(r.matrix)),M=m.getShadowPassColorMode();else{rr(b,E,v,n),C=n.getOrCreateProgram("model",{defines:b,overrideFog:y});const P=v.material,I=P.pbrMetallicRoughness,O=t.paint.get("model-opacity");S=O1(c.projMatrix,Float32Array.from(r.matrix),new Float32Array(16),n,O,I.baseColorFactor,P.emissiveFactor,I.metallicFactor,I.roughnessFactor,P,t,l),m&&(d.shadowUniformsInitialized?C.setShadowUniformValues(h,m.getShadowUniformValues()):(m.setupShadows(c.toUnwrapped(),C,"model-tile",c.overscaledZ),d.shadowUniformsInitialized=!0)),M=D.shouldRenderCutoff||O<1||"OPAQUE"!==P.alphaMode?sn.alphaBlended:sn.unblended}n.uploadCommonUniforms(h,C,c.toUnwrapped(),null,D);const R=v.material.doubleSided?Ge.disabled:Ge.backCCW;if(s.instancedDataArray.length>20)E.push(s.instancedDataBuffer),C.draw(n,h.gl.TRIANGLES,_,Fe.disabled,M,R,S,t.id,v.vertexBuffer,v.indexBuffer,v.segments,t.paint,n.transform.zoom,void 0,E,s.instancedDataArray.length);else{const P=p?"u_instance":"u_normal_matrix";for(let I=0;I<s.instancedDataArray.length;++I)S[P]=new Float32Array(s.instancedDataArray.arrayBuffer,64*I,16),C.draw(n,h.gl.TRIANGLES,_,Fe.disabled,M,R,S,t.id,v.vertexBuffer,v.indexBuffer,v.segments,t.paint,n.transform.zoom,void 0,E)}}if(r.children)for(const v of r.children)Yo(n,t,v,s,l,c,d)}const Nf=[1,-1,1];function tP(n,t,r,s){if(!r.modelManager)return!0;const l=r.modelManager;if(!r.shadowRenderer)return!0;const c=r.shadowRenderer,d=t.aabb;let h=!0,p=n.maxHeight;if(0===p){let _=0;for(const y in n.instancesPerModel){const v=l.getModel(y,s);v?_=Math.max(_,Math.max(Math.max(v.aabb.max[0],v.aabb.max[1]),v.aabb.max[2])):h=!1}p=n.maxScale*_*1.41+n.maxVerticalOffset,h&&(n.maxHeight=p)}d.max[2]=p,d.min[2]+=n.terrainElevationMin,d.max[2]+=n.terrainElevationMax,q.transformMat4(d.min,d.min,t.tileMatrix),q.transformMat4(d.max,d.max,t.tileMatrix);const m=d.intersects(c.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(n.isInsideFirstShadowMapFrustum=2===m),0===m}class eP{}class WF{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,s){{const y=this._storage.get(r.id);if(y)return y.lastUsedFrameIdx=t,y.buf}const l=s.gl,c=l.getBufferParameter(l.ELEMENT_ARRAY_BUFFER,l.BUFFER_SIZE),d=new ArrayBuffer(c),h=new Int16Array(d);l.getBufferSubData(l.ELEMENT_ARRAY_BUFFER,0,new Int16Array(d));const p=new Va;for(let y=0;y<c/2;y+=3){const v=h[y],b=h[y+1],E=h[y+2];p.emplaceBack(v,b),p.emplaceBack(b,E),p.emplaceBack(E,v)}const m=s.bindVertexArrayOES.current,_=new eP;return _.buf=new ko(s,p),_.lastUsedFrameIdx=t,this._storage.set(r.id,_),s.bindVertexArrayOES.set(m),_.buf}update(t){for(const[r,s]of this._storage)t-s.lastUsedFrameIdx>30&&(s.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}const nP={symbol:function(n,t,r,s,l){if("translucent"!==n.renderPass)return;const c=Fe.disabled,d=n.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(h,p,m,_,y,v,b){const E=p.transform,C="map"===y,S="map"===v;for(const M of h){const D=_.getTile(M),R=D.getBucket(m);if(!R||!R.text||!R.text.segments.get().length)continue;const P=Ic(R.textSizeData,E.zoom),I=av(M,R.getProjection(),E),O=E.calculatePixelsToTileUnitsMatrix(D),F=bf(I,D.tileID.canonical,S,C,E,R.getProjection(),O),L=R.hasIconTextFit()&&R.hasIconData();if(P){const N=Math.pow(2,E.zoom-D.tileID.overscaledZ);WR(R,C,S,b,OF,E,F,M,N,P,L)}}}(s,n,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),l),0!==r.paint.get("icon-opacity").constantOr(1)&&FT(n,t,r,s,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),c,d),0!==r.paint.get("text-opacity").constantOr(1)&&FT(n,t,r,s,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),c,d),t.map.showCollisionBoxes&&(k1(n,t,r,s,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),k1(n,t,r,s,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(n,t,r,s){if("translucent"!==n.renderPass)return;const l=r.paint.get("circle-opacity"),c=r.paint.get("circle-stroke-width"),d=r.paint.get("circle-stroke-opacity"),h=void 0!==r.layout.get("circle-sort-key").constantOr(1),p=r.paint.get("circle-emissive-strength");if(0===l.constantOr(1)&&(0===c.constantOr(1)||0===d.constantOr(1)))return;const m=n.context,_=m.gl,y=n.transform,v=n.depthModeForSublayer(0,ve.ReadOnly),b=Fe.disabled,E=n.colorModeForDrapableLayerRenderPass(p),C="globe"===y.projection.name,S=[eo(y.center.lng),po(y.center.lat)],M=[];for(let R=0;R<s.length;R++){const P=s[R],I=t.getTile(P),O=I.getBucket(r);if(!O||O.projection.name!==y.projection.name)continue;const F=O.programConfigurations.get(r.id),L=im(r),N=n.isTileAffectedByFog(P);C&&L.push("PROJECTION_GLOBE_VIEW");const z=n.getOrCreateProgram("circle",{config:F,defines:L,overrideFog:N}),U=O.layoutVertexBuffer,V=O.globeExtVertexBuffer,H=O.indexBuffer,j=y.projection.createInversionMatrix(y,P.canonical),Z={programConfiguration:F,program:z,layoutVertexBuffer:U,globeExtVertexBuffer:V,indexBuffer:H,uniformValues:Hx(n,P,I,j,S,r),tile:I};if(h){const tt=O.segments.get();for(const it of tt)M.push({segments:new Bn([it]),sortKey:it.sortKey,state:Z})}else M.push({segments:O.segments,sortKey:0,state:Z})}h&&M.sort((R,P)=>R.sortKey-P.sortKey);const D={useDepthForOcclusion:y.depthOcclusionForSymbolsAndCircles};for(const R of M){const{programConfiguration:P,program:I,layoutVertexBuffer:O,globeExtVertexBuffer:F,indexBuffer:L,uniformValues:N,tile:z}=R.state,U=R.segments;n.terrain&&n.terrain.setupElevationDraw(z,I,D),n.uploadCommonUniforms(m,I,z.tileID.toUnwrapped()),I.draw(n,_.TRIANGLES,v,b,E,Ge.disabled,N,r.id,O,L,U,r.paint,y.zoom,P,[F])}},heatmap:function(n,t,r,s){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===n.renderPass){const l=n.context,c=l.gl,d=Fe.disabled,h=new sn([c.ONE,c.ONE,c.ONE,c.ONE],Ne.transparent,[!0,!0,!0,!0]);(function(b,E,C,S){const M=b.gl,D=E.width*S,R=E.height*S;b.activeTexture.set(M.TEXTURE1),b.viewport.set([0,0,D,R]);let P=C.heatmapFbo;if(!P||P&&(P.width!==D||P.height!==R)){P&&P.destroy();const I=M.createTexture();M.bindTexture(M.TEXTURE_2D,I),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.LINEAR),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.LINEAR),P=C.heatmapFbo=b.createFramebuffer(D,R,!0,null),function(O,F,L,N,z,U){const V=O.gl;V.texImage2D(V.TEXTURE_2D,0,O.extRenderToTextureHalfFloat?V.RGBA16F:V.RGBA,z,U,0,V.RGBA,O.extRenderToTextureHalfFloat?V.HALF_FLOAT:V.UNSIGNED_BYTE,null),N.colorAttachment.set(L)}(b,0,I,P,D,R)}else M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),b.bindFramebuffer.set(P.framebuffer)})(l,n,r,"globe"===n.transform.projection.name?.5:.25),l.clear({color:Ne.transparent});const p=n.transform,m="globe"===p.projection.name,_=m?["PROJECTION_GLOBE_VIEW"]:[],y=m?Ge.frontCCW:Ge.disabled,v=[eo(p.center.lng),po(p.center.lat)];for(let b=0;b<s.length;b++){const E=s[b];if(t.hasRenderableParent(E))continue;const C=t.getTile(E),S=C.getBucket(r);if(!S||S.projection.name!==p.projection.name)continue;const M=n.isTileAffectedByFog(E),D=S.programConfigurations.get(r.id),R=n.getOrCreateProgram("heatmap",{config:D,defines:_,overrideFog:M}),{zoom:P}=n.transform;n.terrain&&n.terrain.setupElevationDraw(C,R),n.uploadCommonUniforms(l,R,E.toUnwrapped());const I=p.projection.createInversionMatrix(p,E.canonical);R.draw(n,c.TRIANGLES,ve.disabled,d,h,y,UR(n,E,C,I,v,P,r.paint.get("heatmap-intensity")),r.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,r.paint,n.transform.zoom,D,m?[S.globeExtVertexBuffer]:null)}l.viewport.set([0,0,n.width,n.height])}else"translucent"===n.renderPass&&(n.context.setColorMode(n.colorModeForRenderPass()),function(l,c){const d=l.context,h=d.gl,p=c.heatmapFbo;if(!p)return;d.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,p.colorAttachment.get()),d.activeTexture.set(h.TEXTURE1);let m=c.colorRampTexture;m||(m=c.colorRampTexture=new ir(d,c.colorRamp,h.RGBA)),m.bind(h.LINEAR,h.CLAMP_TO_EDGE),l.getOrCreateProgram("heatmapTexture").draw(l,h.TRIANGLES,ve.disabled,Fe.disabled,l.colorModeForRenderPass(),Ge.disabled,{u_image:0,u_color_ramp:1,u_opacity:c.paint.get("heatmap-opacity")},c.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments,c.paint,l.transform.zoom)}(n,r))},line:function(n,t,r,s){if("translucent"!==n.renderPass)return;const l=r.paint.get("line-opacity"),c=r.paint.get("line-width");if(0===l.constantOr(1)||0===c.constantOr(1))return;const d=r.paint.get("line-emissive-strength"),h=n.depthModeForSublayer(0,ve.ReadOnly),p=n.colorModeForDrapableLayerRenderPass(d),m=n.terrain&&n.terrain.renderingToTexture?1:kt.devicePixelRatio,_=r.paint.get("line-dasharray"),y=_.constantOr(1),v=r.layout.get("line-cap"),b=r.paint.get("line-pattern"),E=b.constantOr(1),C=r.paint.get("line-pattern").constantOr(1),S=1!==r.paint.get("line-opacity").constantOr(1);let M=!C&&S;const D=r.paint.get("line-gradient"),R=E?"linePattern":"line",P=n.context,I=P.gl,O=Kb(r);n.terrain&&n.terrain.clipOrMaskOverlapStencilType()&&(M=!1);for(const F of s){const L=t.getTile(F);if(E&&!L.patternsLoaded())continue;const N=L.getBucket(r);if(!N)continue;n.prepareDrawTile();const z=N.programConfigurations.get(r.id),U=n.isTileAffectedByFog(F),V=n.getOrCreateProgram(R,{config:z,defines:O,overrideFog:U}),H=b.constantOr(null);if(H&&L.imageAtlas){const lt=L.imageAtlas.patternPositions[H.toString()];lt&&z.setConstantPatternPositions(lt)}const j=_.constantOr(null),Z=v.constantOr(null);if(!E&&j&&Z&&L.lineAtlas){const lt=L.lineAtlas.getDash(j,Z);lt&&z.setConstantPatternPositions(lt)}let[tt,it]=r.paint.get("line-trim-offset");("round"===Z||"square"===Z)&&tt!==it&&(0===tt&&(tt-=1),1===it&&(it+=1));const X=n.terrain?F.projMatrix:null,Y=E?Gm(n,L,r,X,m):G2(n,L,r,X,N.lineClipsArray.length,m,[tt,it]);if(D){const lt=N.gradients[r.id];let ht=lt.texture;if(r.gradientVersion!==lt.version){let mt=256;if(r.stepInterpolant){const yt=t.getSource().maxzoom,ct=F.canonical.z===yt?Math.ceil(1<<n.transform.maxZoom-F.canonical.z):1;mt=Jt(cn(N.maxLineLength/dt*1024*ct),256,P.maxTextureSize)}lt.gradient=qa({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:mt,image:lt.gradient||void 0,clips:N.lineClipsArray}),lt.texture?lt.texture.update(lt.gradient):lt.texture=new ir(P,lt.gradient,I.RGBA),lt.version=r.gradientVersion,ht=lt.texture}P.activeTexture.set(I.TEXTURE1),ht.bind(r.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE)}y&&(P.activeTexture.set(I.TEXTURE0),L.lineAtlasTexture.bind(I.LINEAR,I.REPEAT),z.updatePaintBuffers()),E&&(P.activeTexture.set(I.TEXTURE0),L.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),z.updatePaintBuffers()),n.uploadCommonUniforms(P,V,F.toUnwrapped());const ot=lt=>{V.draw(n,I.TRIANGLES,h,lt,p,Ge.disabled,Y,r.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,r.paint,n.transform.zoom,z,[N.layoutVertexBuffer2])};if(M){const lt=n.stencilModeForClipping(F).ref;0===lt&&n.terrain&&P.clear({stencil:0});const ht={func:I.EQUAL,mask:255};Y.u_alpha_discard_threshold=.8,ot(new Fe(ht,lt,255,I.KEEP,I.KEEP,I.INVERT)),Y.u_alpha_discard_threshold=0,ot(new Fe(ht,lt,255,I.KEEP,I.KEEP,I.KEEP))}else ot(n.stencilModeForClipping(F))}M&&(n.resetStencilClippingMasks(),n.terrain&&P.clear({stencil:0}))},fill:function(n,t,r,s){const l=r.paint.get("fill-color"),c=r.paint.get("fill-opacity");if(0===c.constantOr(1))return;const d=r.paint.get("fill-emissive-strength"),h=n.colorModeForDrapableLayerRenderPass(d),p=r.paint.get("fill-pattern"),m=n.opaquePassEnabledForLayer()&&!p.constantOr(1)&&1===l.constantOr(Ne.transparent).a&&1===c.constantOr(0)?"opaque":"translucent";if(n.renderPass===m){const _=n.depthModeForSublayer(1,"opaque"===n.renderPass?ve.ReadWrite:ve.ReadOnly);L1(n,t,r,s,_,h,!1)}if("translucent"===n.renderPass&&r.paint.get("fill-antialias")){const _=n.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,ve.ReadOnly);L1(n,t,r,s,_,h,!0)}},"fill-extrusion":function(n,t,r,s){const l=r.paint.get("fill-extrusion-opacity"),c=n.context,d=c.gl,h=n.terrain,p=h&&h.renderingToTexture,m=r.paint.get("fill-extrusion-cutoff-fade-range");if(0===l)return;const _=n.conflationActive&&n.layerUsedInConflation(r,t.getSource());if(_&&function(y,v,b,E){for(const C of E){const S=v.getTile(C).getBucket(b);S&&(S.updateReplacement(C,y.replacementSource),S.uploadCentroid(y.context))}}(n,t,r,s),h||_)for(const y of s){const v=t.getTile(y).getBucket(r);v&&ZR(n.context,t,y,v,r,h,_)}if("shadow"===n.renderPass&&n.shadowRenderer){const y=n.shadowRenderer;if(h&&l<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof gc)return;const v=y.getShadowPassDepthMode(),b=y.getShadowPassColorMode();ls(n,t,r,s,v,Fe.disabled,b,_)}else if("translucent"===n.renderPass){const y=!r.paint.get("fill-extrusion-pattern").constantOr(1);if(!p){const v=new ve(n.context.gl.LEQUAL,ve.ReadWrite,n.depthRangeFor3D);0===m&&1===l&&y?ls(n,t,r,s,v,Fe.disabled,sn.unblended,_):(ls(n,t,r,s,v,Fe.disabled,sn.disabled,_),ls(n,t,r,s,v,n.stencilModeFor3D(),n.colorModeForRenderPass(),_),n.resetStencilClippingMasks())}if(n.style.enable3dLights()&&y&&(!h&&"globe"!==n.transform.projection.name||p)){const v=r.paint.get("fill-extrusion-opacity"),b=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),E=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),C=r.paint.get("fill-extrusion-flood-light-intensity"),S=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),M=b>0&&E>0,D=C>0,R=(I,O,F)=>(1-F)*I+F*O,P=I=>{const O=n.depthModeForSublayer(1,ve.ReadOnly,d.LEQUAL,!0),F=r.paint.get(I?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),L=R(.1,3,F),N=n._showOverdrawInspector;if(!N){const z=new Fe({func:d.ALWAYS,mask:255},255,255,d.KEEP,d.KEEP,d.REPLACE),U=new sn([d.ONE,d.ONE,d.ONE,d.ONE],Ne.transparent,[!1,!1,!1,!0],d.MIN);kf(n,t,r,s,O,z,U,Ge.disabled,I,"sdf",v,b,E,C,S,L,_,!1)}{const z=N?Fe.disabled:new Fe({func:d.EQUAL,mask:255},255,255,d.KEEP,d.DECR,d.DECR),U=N?n.colorModeForRenderPass():new sn([d.ONE_MINUS_DST_ALPHA,d.DST_ALPHA,d.ONE,d.ONE],Ne.transparent,[!0,!0,!0,!0]);kf(n,t,r,s,O,z,U,Ge.disabled,I,"color",v,b,E,C,S,L,_,!1)}};if(p){const I=(O,F,L)=>{const N=n.depthModeForSublayer(1,ve.ReadOnly,d.LEQUAL,!1),z=r.paint.get(O?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),U=R(.1,3,z);{const V=new sn([d.ONE,d.ONE,d.ONE,d.ONE],Ne.transparent,[!1,!1,!1,!0]);kf(n,t,r,s,N,Fe.disabled,V,Ge.disabled,O,"clear",v,b,E,C,S,U,_,F)}{const V=new Fe({func:d.ALWAYS,mask:255},255,255,d.KEEP,d.KEEP,d.REPLACE),H=new sn([d.ONE,d.ONE,d.ONE,d.ONE],Ne.transparent,[!1,!1,!1,!0],d.MIN);kf(n,t,r,s,N,V,H,Ge.disabled,O,"sdf",v,b,E,C,S,U,_,F)}{const V=O?d.ZERO:d.ONE_MINUS_DST_ALPHA,H=new Fe({func:d.EQUAL,mask:255},255,255,d.KEEP,d.DECR,d.DECR),j=new sn([V,d.DST_ALPHA,d.ONE_MINUS_DST_ALPHA,d.ZERO],Ne.transparent,[!0,!0,!0,!0]);kf(n,t,r,s,N,H,j,Ge.disabled,O,"color",v,b,E,C,S,U,_,F)}{const V=new sn([d.ONE,d.ONE,d.ONE,O?d.ZERO:d.ONE],Ne.transparent,[!1,!1,!1,!0],O?d.FUNC_ADD:d.MAX);kf(n,t,r,s,N,Fe.disabled,V,Ge.disabled,O,"clear",v,b,E,C,S,U,_,F,L)}};if(M||D){let O;if(n.prepareDrawTile(),h){const F=h.drapeBufferSize[0],L=h.drapeBufferSize[1];O=h.framebufferCopyTexture,O&&(!O||O.size[0]===F&&O.size[1]===L)||(O&&O.destroy(),O=h.framebufferCopyTexture=new ir(c,new Pi({width:F,height:L}),d.RGBA)),O.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,0,0,F,L,0)}M&&I(!0,!1,O),D&&I(!1,!0,O)}}else M&&P(!0),D&&P(!1)}}},hillshade:function(n,t,r,s){if("offscreen"!==n.renderPass&&"translucent"!==n.renderPass)return;const l=n.context,c=n.terrain&&n.terrain.renderingToTexture,[d,h]="translucent"!==n.renderPass||c?[{},s]:n.stencilConfigForOverlap(s);for(const p of h){const m=t.getTile(p);if(m.needsHillshadePrepare&&"offscreen"===n.renderPass)RR(n,m,r);else if("translucent"===n.renderPass){const _=n.depthModeForSublayer(0,ve.ReadOnly),y=r.paint.get("hillshade-emissive-strength"),v=n.colorModeForDrapableLayerRenderPass(y),b=c&&n.terrain?n.terrain.stencilModeForRTTOverlap(p):d[p.overscaledZ];AR(n,p,m,r,_,b,v)}}l.viewport.set([0,0,n.width,n.height]),n.resetStencilClippingMasks()},raster:function(n,t,r,s,l,c){if("translucent"!==n.renderPass||0===r.paint.get("raster-opacity"))return;const d=n.context,h=d.gl,p=t.getSource(),m=function(R,P,I){const O=[];let F,L;if(R.paint.get("raster-color")){O.push("RASTER_COLOR"),F=R.paint.get("raster-color-mix"),L=R.paint.get("raster-color-range"),P.activeTexture.set(I.TEXTURE2);let N=R.colorRampTexture;N||(N=R.colorRampTexture=new ir(P,R.colorRamp,I.RGBA)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE)}return{mix:F,range:L,defines:O}}(r,d,h),_=m.defines;let y=!1;if(p instanceof Gl&&!s.length){if("globe"!==n.transform.projection.name)return;if(p.onNorthPole)y=!0,_.push("PROJECTION_GLOBE_VIEW");else{if(!p.onSouthPole)return;y=!0,_.push("PROJECTION_GLOBE_VIEW")}}const v=n.colorModeForDrapableLayerRenderPass(),b=n.terrain&&n.terrain.renderingToTexture,E=!n.options.moving,C="nearest"===r.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(y){const R=t.getSource();if(!(R instanceof Gl))return;const P=R.texture;if(!P)return;const I=n.globeSharedBuffers;if(!I)return;const O=new ve(h.LEQUAL,ve.ReadWrite,n.depthRangeFor3D),F=Float32Array.from(n.transform.projMatrix);let L=$C(0,0,n.transform);const N=Float32Array.from(to(Oo(new ma(0,0,0)))),z={opacity:1,mix:0};n.terrain&&n.terrain.prepareDrawTile(),d.activeTexture.set(h.TEXTURE0),P.bind(C,h.CLAMP_TO_EDGE),d.activeTexture.set(h.TEXTURE1),P.bind(C,h.CLAMP_TO_EDGE),P.useMipmap&&d.extTextureFilterAnisotropic&&n.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax);const[U,V,H,j]=I.getPoleBuffers(0,!0);let Z;R.onNorthPole?(Z=U,n.renderDefaultNorthPole=!1):(L=rt.scale(rt.create(),L,[1,-1,1]),Z=V,n.renderDefaultSouthPole=!1);const tt=AT(F,N,L,[0,0],1,z,r,R.perspectiveTransform||[0,0],2,m.mix||[0,0,0,0],m.range||[0,0]),it=n.getOrCreateProgram("raster",{defines:m.defines});return n.uploadCommonUniforms(d,it,null),void it.draw(n,h.TRIANGLES,O,Fe.disabled,v,Ge.disabled,tt,r.id,Z,H,j)}if(!s.length)return;const[S,M]=p instanceof Gl||b?[{},s]:n.stencilConfigForOverlap(s),D=M[M.length-1].overscaledZ;for(const R of M){const P=b?ve.disabled:n.depthModeForSublayer(R.overscaledZ-D,1===r.paint.get("raster-opacity")?ve.ReadWrite:ve.ReadOnly,h.LESS),I=R.toUnwrapped(),O=t.getTile(R);if(b&&(!O||!O.hasData())||!O.texture)continue;const F=b?R.projMatrix:n.transform.calculateProjMatrix(I,E),L=n.terrain&&b?n.terrain.stencilModeForRTTOverlap(R):S[R.overscaledZ],N=c?0:r.paint.get("raster-fade-duration");O.registerFadeDuration(N);const z=t.findLoadedParent(R,0),U=wT(O,z,t,n.transform,N);let V,H;n.terrain&&n.terrain.prepareDrawTile(),d.activeTexture.set(h.TEXTURE0),O.texture.bind(C,h.CLAMP_TO_EDGE),d.activeTexture.set(h.TEXTURE1),z?(z.texture.bind(C,h.CLAMP_TO_EDGE),V=Math.pow(2,z.tileID.overscaledZ-O.tileID.overscaledZ),H=[O.tileID.canonical.x*V%1,O.tileID.canonical.y*V%1]):O.texture.bind(C,h.CLAMP_TO_EDGE),O.texture.useMipmap&&d.extTextureFilterAnisotropic&&n.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax);const j=p instanceof Gl?p.perspectiveTransform:[0,0],Z=new Float32Array(16),tt=AT(F,Z,Z,H||[0,0],V||1,U,r,j,2,m.mix||[0,0,0,0],m.range||[0,0]),it=n.isTileAffectedByFog(R),X=n.getOrCreateProgram("raster",{defines:m.defines,overrideFog:it});if(n.uploadCommonUniforms(d,X,I),p instanceof Gl)p.boundsBuffer&&p.boundsSegments&&X.draw(n,h.TRIANGLES,P,Fe.disabled,v,Ge.disabled,tt,r.id,p.boundsBuffer,n.quadTriangleIndexBuffer,p.boundsSegments);else{const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:ot,tileBoundsSegments:lt}=n.getTileBoundsBuffers(O);X.draw(n,h.TRIANGLES,P,L,v,Ge.disabled,tt,r.id,Y,ot,lt)}}n.resetStencilClippingMasks()},background:function(n,t,r,s){const l=r.paint.get("background-color"),c=r.paint.get("background-opacity"),d=r.paint.get("background-emissive-strength");if(0===c)return;const h=n.context,p=h.gl,m=n.transform,_=m.tileSize,y=r.paint.get("background-pattern");if(n.isPatternMissing(y,r.scope))return;const v=!y&&1===l.a&&1===c&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass!==v)return;const b=Fe.disabled,E=n.depthModeForSublayer(0,"opaque"===v?ve.ReadWrite:ve.ReadOnly),C=n.colorModeForDrapableLayerRenderPass(d),S=y?"backgroundPattern":"background";let M,D=s;D||(M=n.getBackgroundTiles(),D=Object.values(M).map(R=>R.tileID)),y&&(h.activeTexture.set(p.TEXTURE0),n.imageManager.bind(n.context,r.scope));for(const R of D){const P=n.isTileAffectedByFog(R),I=n.getOrCreateProgram(S,{overrideFog:P}),O=R.toUnwrapped(),F=s?R.projMatrix:n.transform.calculateProjMatrix(O);n.prepareDrawTile();const L=t?t.getTile(R):M?M[R.key]:new Ds(R,_,m.zoom,n),N=y?ql(F,d,c,n,y,r.scope,{tileID:R,tileSize:_}):qF(F,d,c,l);n.uploadCommonUniforms(h,I,O);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:V}=n.getTileBoundsBuffers(L);I.draw(n,p.TRIANGLES,E,b,C,Ge.disabled,N,r.id,z,U,V)}},sky:function(n,t,r){const s=n._atmosphere?Br(n.transform.zoom):1,l=r.paint.get("sky-opacity")*s;if(0===l)return;const c=n.context,d=r.paint.get("sky-type"),h=new ve(c.gl.LEQUAL,ve.ReadOnly,[0,1]),p=n.frameCounter/1e3%1;"atmosphere"===d?"offscreen"===n.renderPass?r.needsSkyboxCapture(n)&&(function(m,_,y,v){const b=m.context,E=b.gl;let C=_.skyboxFbo;if(!C){C=_.skyboxFbo=b.createFramebuffer(32,32,!0,null),_.skyboxGeometry=new jT(b),_.skyboxTexture=b.gl.createTexture(),E.bindTexture(E.TEXTURE_CUBE_MAP,_.skyboxTexture),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,E.LINEAR);for(let R=0;R<6;++R)E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,E.RGBA,32,32,0,E.RGBA,E.UNSIGNED_BYTE,null)}b.bindFramebuffer.set(C.framebuffer),b.viewport.set([0,0,32,32]);const S=_.getCenter(m,!0),M=m.getOrCreateProgram("skyboxCapture"),D=new Float64Array(16);rt.identity(D),rt.rotateY(D,D,.5*-Math.PI),Lf(m,_,M,D,S,0),rt.identity(D),rt.rotateY(D,D,.5*Math.PI),Lf(m,_,M,D,S,1),rt.identity(D),rt.rotateX(D,D,.5*-Math.PI),Lf(m,_,M,D,S,2),rt.identity(D),rt.rotateX(D,D,.5*Math.PI),Lf(m,_,M,D,S,3),rt.identity(D),Lf(m,_,M,D,S,4),rt.identity(D),rt.rotateY(D,D,Math.PI),Lf(m,_,M,D,S,5),b.viewport.set([0,0,m.width,m.height])}(n,r),r.markSkyboxValid(n)):"sky"===n.renderPass&&function(m,_,y,v,b){const E=m.context,C=E.gl,S=m.transform,M=m.getOrCreateProgram("skybox");E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_CUBE_MAP,_.skyboxTexture);const D={u_matrix:S.skyboxMatrix,u_sun_direction:_.getCenter(m,!1),u_cubemap:0,u_opacity:v,u_temporal_offset:b};m.uploadCommonUniforms(E,M),M.draw(m,C.TRIANGLES,y,Fe.disabled,m.colorModeForRenderPass(),Ge.backCW,D,"skybox",_.skyboxGeometry.vertexBuffer,_.skyboxGeometry.indexBuffer,_.skyboxGeometry.segment)}(n,r,h,l,p):"gradient"===d&&"sky"===n.renderPass&&function(m,_,y,v,b){const E=m.context,C=E.gl,S=m.transform,M=m.getOrCreateProgram("skyboxGradient");_.skyboxGeometry||(_.skyboxGeometry=new jT(E)),E.activeTexture.set(C.TEXTURE0);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new ir(E,_.colorRamp,C.RGBA)),D.bind(C.LINEAR,C.CLAMP_TO_EDGE);const R=(F=v,L=b,{u_matrix:S.skyboxMatrix,u_color_ramp:0,u_center_direction:_.getCenter(m,!1),u_radius:Ie(_.paint.get("sky-gradient-radius")),u_opacity:F,u_temporal_offset:L});var F,L;m.uploadCommonUniforms(E,M),M.draw(m,C.TRIANGLES,y,Fe.disabled,m.colorModeForRenderPass(),Ge.backCW,R,"skyboxGradient",_.skyboxGeometry.vertexBuffer,_.skyboxGeometry.indexBuffer,_.skyboxGeometry.segment)}(n,r,h,l,p)},debug:function(n,t,r){for(let s=0;s<r.length;s++)z1(n,t,r[s])},custom:function(n,t,r,s){const l=n.context,c=r.implementation;if(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes("custom")||n.terrain&&(n.terrain.renderingToTexture||"offscreen"===n.renderPass)&&r.isLayerDraped(t)){if("offscreen"===n.renderPass){const d=c.prerender;if(d){if(n.setCustomLayerDefaults(),l.setColorMode(n.colorModeForRenderPass()),"globe"===n.transform.projection.name){const h=n.transform.pointMerc;d.call(c,l.gl,n.transform.customLayerMatrix(),n.transform.getProjection(),n.transform.globeToMercatorMatrix(),Br(n.transform.zoom),[h.x,h.y],n.transform.pixelsPerMeterRatio)}else d.call(c,l.gl,n.transform.customLayerMatrix());l.setDirty(),n.setBaseState()}}else if("translucent"===n.renderPass){if(n.terrain&&n.terrain.renderingToTexture){const h=c.renderToTile;if(h){const p=s[0].canonical,m=new Ke(p.x+s[0].wrap*(1<<p.z),p.y,p.z);l.setDepthMode(ve.disabled),l.setStencilMode(Fe.disabled),l.setColorMode(n.colorModeForRenderPass()),n.setCustomLayerDefaults(),h.call(c,l.gl,m),l.setDirty(),n.setBaseState()}return}n.setCustomLayerDefaults(),l.setColorMode(n.colorModeForRenderPass()),l.setStencilMode(Fe.disabled);const d="3d"===c.renderingMode?new ve(n.context.gl.LEQUAL,ve.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,ve.ReadOnly);if(l.setDepthMode(d),"globe"===n.transform.projection.name){const h=n.transform.pointMerc;c.render(l.gl,n.transform.customLayerMatrix(),n.transform.getProjection(),n.transform.globeToMercatorMatrix(),Br(n.transform.zoom),[h.x,h.y],n.transform.pixelsPerMeterRatio)}else c.render(l.gl,n.transform.customLayerMatrix());l.setDirty(),n.setBaseState(),l.bindFramebuffer.set(null)}}else Q("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(n,t,r,s){if("opaque"===n.renderPass)return;const l=r.paint.get("model-opacity");if(0===l)return;const c=r.paint.get("model-cast-shadows");if("shadow"===n.renderPass&&(!c||n.terrain&&l<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof gc))return;const d=n.shadowRenderer,h=r.paint.get("model-receive-shadows");d&&(d.useNormalOffset=!0,h||(d.enabled=!1));const p=()=>{d&&(d.useNormalOffset=!0,h||(d.enabled=!0))},m=t.getSource();if("light-beam"===n.renderPass&&"batched-model"!==m.type)return;if("vector"===m.type||"geojson"===m.type)return function(M,D,R,P){const I=M.transform;if("mercator"!==I.projection.name)return void Q(`Drawing 3D models for ${I.projection.name} projection is not yet implemented`);const O=I.getFreeCameraOptions().position;if(!M.modelManager)return;const F=M.modelManager,L=M.shadowRenderer;if(!R._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const N=R._unevaluatedLayout._values["model-id"],z={...R.layout.get("model-id").parameters};for(const U of P){const V=D.getTile(U).getBucket(R);if(!V||V.projection.name!==I.projection.name)continue;const H=$T(U,I);z.zoom=H;const j=N.possiblyEvaluate(z);if(QR(M,V,U),sl.shadowUniformsInitialized=!1,sl.useSingleShadowCascade=!!L&&0===L.getMaxCascadeForTile(U.toUnwrapped()),"shadow"===M.renderPass&&L){if(1===M.currentShadowCascade&&V.isInsideFirstShadowMapFrustum)continue;const it=I.calculatePosMatrix(U.toUnwrapped(),I.worldSize);if(sl.tileMatrix.set(it),sl.shadowTileMatrix=Float32Array.from(L.calculateShadowPassMatrixFromMatrix(it)),sl.aabb.min.fill(0),sl.aabb.max[0]=sl.aabb.max[1]=dt,sl.aabb.max[2]=0,tP(V,sl,M,R.scope))continue}const Z=1<<U.canonical.z,tt=[((O.x-U.wrap)*Z-U.canonical.x)*dt,(O.y*Z-U.canonical.y)*dt,O.z*Z*dt];for(let it in V.instancesPerModel){const X=V.instancesPerModel[it];X.features.length>0&&(it=j.evaluate(X.features[0].feature,{}));const Y=F.getModel(it,R.scope);if(Y&&Y.uploaded)for(const ot of Y.nodes)Yo(M,R,ot,X,tt,U,sl)}}}(n,t,r,s),void p();if(!m.loaded())return;if("batched-model"===m.type)return function(M,D,R,P){const I=M.context,O=M.transform,F=M.style.fog,L=M.shadowRenderer;if("mercator"!==O.projection.name)return void Q(`Drawing 3D landmark models for ${O.projection.name} projection is not yet implemented`);const N=M.transform.getFreeCameraOptions().position,z=q.scale([],[N.x,N.y,N.z],M.transform.worldSize);q.negate(z,z);const U=rt.identity([]),V=Ha(O.center.lat,O.zoom),H=rt.fromScaling([],[1,1,1/V]);rt.translate(U,U,z);const j=R.paint.get("model-opacity"),Z=new ve(I.gl.LEQUAL,ve.ReadWrite,M.depthRangeFor3D),tt=new ve(I.gl.LEQUAL,ve.ReadOnly,M.depthRangeFor3D),it=function(X,Y){for(const ot of P){const lt=D.getTile(ot).getBucket(R);if(!lt||!lt.uploaded)continue;let ht=!1;L&&(ht=0===L.getMaxCascadeForTile(ot.toUnwrapped()));const mt=O.calculatePosMatrix(ot.toUnwrapped(),O.worldSize),yt=lt.modelTraits;for(const ct of lt.getNodesInfo()){if(ct.hiddenByReplacement||!ct.node.meshes)continue;const ft=ct.node,Rt="light-beam"===M.renderPass,Vt=[...mt],jt=ct.evaluatedScale;let $t=0;M.terrain&&ft.elevation&&($t=ft.elevation*M.terrain.exaggeration()),rt.translate(Vt,Vt,[(ft.anchor?ft.anchor[0]:0)*(jt[0]-1),(ft.anchor?ft.anchor[1]:0)*(jt[1]-1),$t]),jt!==hS&&rt.scale(Vt,Vt,jt),rt.multiply(Vt,Vt,ft.matrix);const re=rt.multiply([],H,Vt);rt.multiply(re,U,re);const ye=rt.invert([],re);rt.transpose(ye,ye),rt.scale(ye,ye,Nf);const je=rt.multiply([],O.projMatrix,Vt);for(let rn=0;rn<ft.meshes.length;++rn){const Re=ft.meshes[rn],Me=rn===ft.lightMeshIndex;if(Me){if(!Rt&&!M.terrain&&M.shadowRenderer){M.currentLayer<M.firstLightBeamLayer&&(M.firstLightBeamLayer=M.currentLayer);continue}}else if(Rt)continue;const ge={defines:[]},ue=[];rr(ge.defines,ue,Re,M),4&yt||ge.defines.push("DIFFUSE_SHADED"),ht&&ge.defines.push("SHADOWS_SINGLE_CASCADE");const Le="shadow"===M.renderPass;if(Le){bv(Re,Vt,M,R);continue}let an=null;if(F){const ei=Ks(Vt,M.transform);if(an=new Float32Array(ei),"globe"!==O.projection.name){const cr=Re.aabb.min,_i=Re.aabb.max,[di,Hn]=F.getOpacityForBounds(ei,cr[0],cr[1],_i[0],_i[1]);ge.overrideFog=di>=Iu||Hn>=Iu}}const Be=M.getOrCreateProgram("model",ge);!Le&&L&&(L.useNormalOffset=!!Re.normalBuffer,L.setupShadowsFromMatrix(Vt,Be,L.useNormalOffset)),M.uploadCommonUniforms(I,Be,ot.toUnwrapped(),an);const Zn=Re.material,Si=Zn.pbrMetallicRoughness;Si.metallicFactor=.9,Si.roughnessFactor=.5;const ui=O1(new Float32Array(je),new Float32Array(re),new Float32Array(ye),M,j,Si.baseColorFactor,Zn.emissiveFactor,Si.metallicFactor,Si.roughnessFactor,Zn,R);Be.draw(M,I.gl.TRIANGLES,Y&&!Me?Z:tt,Fe.disabled,X?Me||j<1||ct.hasTranslucentParts?sn.alphaBlended:sn.unblended:sn.disabled,Ge.backCCW,ui,R.id,Re.vertexBuffer,Re.indexBuffer,Re.segments,R.paint,M.transform.zoom,void 0,ue)}}}};(function(X,Y,ot,lt){const ht=X.terrain?X.terrain.exaggeration():0,mt=X.transform.zoom;for(const yt of lt){const ct=Y.getTile(yt).getBucket(ot);ct&&(X.conflationActive&&ct.updateReplacement(yt,X.replacementSource),ct.evaluateScale(X,ot),X.terrain&&ht>0&&ct.elevationUpdate(X.terrain,ht,yt,ot.source),ct.needsReEvaluation(X,mt,ot)&&ct.evaluate(ot))}})(M,D,R,P),1===j?it(!0,!0):(it(!1,!0),it(!0,!1))}(n,t,r,s),void p();const _=m.getModels(),y=[],v=n.transform.getFreeCameraOptions().position,b=q.scale([],[v.x,v.y,v.z],n.transform.worldSize);q.negate(b,b);const E=[],C=[];let S=0;for(const M of _){const D=r.paint.get("model-rotation").constantOr(null),R=r.paint.get("model-scale").constantOr(null),P=r.paint.get("model-translation").constantOr(null);M.computeModelMatrix(n,D,R,P,!0,!0,!1);const I=rt.identity([]),O=Ha(M.position.lat,n.transform.zoom),F=rt.fromScaling([],[1,1,1/O]);rt.translate(I,I,b),y.push({zScaleMatrix:F,negCameraPosMatrix:I});for(const L of M.nodes)U1(n.transform,L,M.matrix,n.transform.projMatrix,S,E,C);S++}if(E.sort((M,D)=>D.depth-M.depth),"shadow"!==n.renderPass){if(1===l)for(const M of C)xv(M,n,r,y[M.modelIndex],Fe.disabled,n.colorModeForRenderPass());else{for(const M of C)xv(M,n,r,y[M.modelIndex],Fe.disabled,sn.disabled);for(const M of C)xv(M,n,r,y[M.modelIndex],n.stencilModeFor3D(),n.colorModeForRenderPass());n.resetStencilClippingMasks()}for(const M of E)xv(M,n,r,y[M.modelIndex],Fe.disabled,n.colorModeForRenderPass());p()}else{for(const M of C)bv(M.mesh,M.nodeModelMatrix,n,r);for(const M of E)bv(M.mesh,M.nodeModelMatrix,n,r);p()}}},$1={modelUpload:function(n,t,r){const s=t.getSource();if(!s.loaded())return;if("vector"===s.type||"geojson"===s.type)return void(n.modelManager&&n.modelManager.upload(n,r));if("batched-model"===s.type)return;const l=s.getModels();for(const c of l)c.upload(n.context)}};class H1{constructor(t,r){this.context=new Gy(t),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Is.maxUnderzooming+Is.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new V2,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new hg(this),this._wireframeDebugCache=new WF,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,r){const s=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(s||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new LR(this,t));const l=this._terrain;this.transform.elevation=s?l:null,l.update(t,this.transform,r),this.transform.elevation&&!l.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||"globe"===this.transform.projection.name||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[s,l]=r.getFovAdjustedRange(this.transform._fov);if(s>l)return void(this.transform.fogCullDistSq=null);const c=s+.78*(l-s);this.transform.fogCullDistSq=c*c}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*kt.devicePixelRatio,this.height=r*kt.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const s of this.style.order)this.style._mergedLayers[s].resize()}setup(){const t=this.context,r=new qo;r.emplaceBack(0,0),r.emplaceBack(dt,0),r.emplaceBack(0,dt),r.emplaceBack(dt,dt),this.tileExtentBuffer=t.createVertexBuffer(r,xc.members),this.tileExtentSegments=Bn.simpleSegment(0,0,4,2);const s=new qo;s.emplaceBack(0,0),s.emplaceBack(dt,0),s.emplaceBack(0,dt),s.emplaceBack(dt,dt),this.debugBuffer=t.createVertexBuffer(s,xc.members),this.debugSegments=Bn.simpleSegment(0,0,4,5);const l=new qo;l.emplaceBack(-1,-1),l.emplaceBack(1,-1),l.emplaceBack(-1,1),l.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(l,xc.members),this.viewportSegments=Bn.simpleSegment(0,0,4,2);const c=new ad;c.emplaceBack(0,0,0,0),c.emplaceBack(dt,0,dt,0),c.emplaceBack(0,dt,0,dt),c.emplaceBack(dt,dt,dt,dt),this.mercatorBoundsBuffer=t.createVertexBuffer(c,Am.members),this.mercatorBoundsSegments=Bn.simpleSegment(0,0,4,2);const d=new er;d.emplaceBack(0,1,2),d.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(d);const h=new k_;for(const m of[0,1,3,2,0])h.emplaceBack(m);this.debugIndexBuffer=t.createIndexBuffer(h),this.emptyTexture=new ir(t,new Pi({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=rt.create();const p=this.context.gl;this.stencilClearMode=new Fe({func:p.ALWAYS,mask:0},0,255,p.ZERO,p.ZERO,p.ZERO),this.loadTimeStamps.push(st.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ve.disabled,this.stencilClearMode,sn.disabled,Ge.disabled,A1(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,s){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!s||0===s.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let h=!1;for(const p of s)if(void 0===this._tileClippingMaskIDs[p.key]){h=!0;break}if(!h)return}this.currentStencilSource=r.id;const l=this.context,c=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(sn.disabled),l.setDepthMode(ve.disabled);const d=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const h of s){const p=r.getTile(h),m=this._tileClippingMaskIDs[h.key]=this.nextStencilID++,{tileBoundsBuffer:_,tileBoundsIndexBuffer:y,tileBoundsSegments:v}=this.getTileBoundsBuffers(p);d.draw(this,c.TRIANGLES,ve.disabled,new Fe({func:c.ALWAYS,mask:0},m,255,c.KEEP,c.KEEP,c.REPLACE),sn.disabled,Ge.disabled,A1(h.projMatrix),"$clipping",_,y,v)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Fe({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new Fe({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,s=t.sort((d,h)=>h.overscaledZ-d.overscaledZ),l=s[s.length-1].overscaledZ,c=s[0].overscaledZ-l+1;if(c>1){this.currentStencilSource=void 0,this.nextStencilID+c>256&&this.clearStencil();const d={};for(let h=0;h<c;h++)d[h+l]=new Fe({func:r.GEQUAL,mask:255},h+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=c,[d,s]}return[{[l]:Fe.disabled},s]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new sn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new Ne(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?sn.unblended:sn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new sn([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new Ne(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,s,l=!1){if(!this.opaquePassEnabledForLayer()&&!l)return ve.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ve(s||this.context.gl.LEQUAL,r,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=r;const s=this.style._mergedLayers,l=this.style.order,c=l.map(I=>s[I]),d=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(kt.now()),this.imageManager.beginFrame();let h=0,p=!1;for(const I in d){const O=d[I];O.used&&(O.prepare(this.context),O.getSource().usedInConflation&&++h)}const m={},_={},y={},v={},b={};for(const I in d){const O=d[I];m[I]=O.getVisibleCoordinates(),_[I]=m[I].slice().reverse(),y[I]=O.getVisibleCoordinates(!0).reverse(),v[I]=O.getShadowCasterCoordinates(),b[I]=O.sortCoordinatesByDistance(m[I])}const E=I=>{const O=this.style.getLayerSourceCache(I);return O&&O.used?O.getSource():null};if(h){const I=[];for(const O of c)this.layerUsedInConflation(O,E(O))&&I.push(O);if(I&&I.length>1){const O=[];for(const F of I){const L=this.style.getLayerSourceCache(F);L&&L.used&&L.getSource().usedInConflation&&O.push({layer:F.fqid,cache:L})}this.replacementSource.setSources(O),p=!0}}p||this.replacementSource.clear(),this.conflationActive=p,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const I of c){const O=I.cutoffRange();if(this.longestCutoffRange=Math.max(O,this.longestCutoffRange),O>0){const F=E(I);F&&(this.minCutoffZoom=Math.max(F.minzoom,this.minCutoffZoom)),I.minzoom&&(this.minCutoffZoom=Math.max(I.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let I=0;I<c.length;I++)if(c[I].is3D()){this.opaquePassCutoff=I;break}const C=this.style&&this.style.fog;C?(this._fogVisible=0!==C.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=C.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0);const S=this._shadowRenderer;if(S){S.updateShadowParameters(this.transform,this.style.directionalLight);for(const I in d)for(const O of m[I]){let F={min:0,max:0};this.terrain&&(F=this.terrain.getMinMaxForTile(O)||F),S.addShadowReceiver(O.toUnwrapped(),F.min,F.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new ZC(this.context));for(const I of c){if(I.isHidden(this.transform.zoom))continue;const O=t.getLayerSourceCache(I);this.uploadLayer(this,I,O)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ea),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!nu.has(this.context.gl))return;this.renderPass="offscreen";for(const I of c){const O=t.getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const F=O?_[O.id]:void 0;("custom"===I.type||"raster"===I.type||I.isSky()||F&&F.length)&&this.renderLayer(this,O,I,F)}this.depthRangeFor3D=[0,1-(c.length+2)*this.numSublayers*this.depthEpsilon];const M=this.terrain;M&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&M.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const D="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),R=(()=>{if(r.showOverdrawInspector)return Ne.black;if(this.style.fog&&this.transform.projection.supportsFog&&!D){const I=this.style.fog.properties.get("color").toArray01();return new Ne(...I)}if(this.style.fog&&this.transform.projection.supportsFog&&D){const I=this.style.fog.properties.get("space-color").toArray01();return new Ne(...I)}return Ne.transparent})();if(this.context.clear({color:R,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&D&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const I=c[this.currentLayer],O=t.getLayerSourceCache(I);if(I.isSky())continue;const F=O?(I.is3D()?b:_)[O.id]:void 0;this._renderTileClippingMasks(I,O,F),this.renderLayer(this,O,I,F)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&D&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Br(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const I=c[this.currentLayer],O=t.getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,O,I,O?_[O.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let P=0;for(S&&(P=S.getShadowCastingLayerCount());this.currentLayer<l.length;){const I=c[this.currentLayer],O=t.getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(M&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=M.renderBatch(this.currentLayer);continue}let F;if(O&&(F=("symbol"===I.type?y:I.is3D()?b:_)[O.id]),this._renderTileClippingMasks(I,O,O?m[O.id]:void 0),this.renderLayer(this,O,I,F),!M&&S&&P>0&&I.hasShadowPass()&&0==--P&&(S.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const L=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=L;this.currentLayer++){const N=c[this.currentLayer];if(!N.hasLightBeamPass())continue;const z=t.getLayerSourceCache(N);this.renderLayer(this,z,N,z?_[z.id]:void 0)}this.currentLayer=L,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;c.forEach(O=>{const F=t.getLayerSourceCache(O);F&&!O.isHidden(this.transform.zoom)&&F.getVisibleCoordinates().length&&(!I||I.getSource().maxzoom<F.getSource().maxzoom)&&(I=F)}),I&&this.options.showTileBoundaries&&nP.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const O=I.transform.padding;vv(I,I.transform.height-(O.top||0),3,XR),vv(I,O.bottom||0,3,BT),B1(I,O.left||0,3,VT),B1(I,I.transform.width-(O.right||0),3,YR);const F=I.transform.centerPoint;var L,N,z,U;Ff(L=I,(N=F.x)-1,(z=I.transform.height-F.y)-10,2,20,U=KR),Ff(L,N-10,z-1,20,2,U)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(st.performance.now()),this.saveCanvasCopy()),p||(this.conflationActive=!1)}uploadLayer(t,r,s){this.gpuTimingStart(r),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(r.type)||t.terrain&&"custom"===r.type)&&$1[`${r.type}Upload`]&&$1[`${r.type}Upload`](t,s,r.scope),this.gpuTimingEnd()}renderLayer(t,r,s,l){s.isHidden(this.transform.zoom)||("background"===s.type||"sky"===s.type||"custom"===s.type||"model"===s.type||"raster"===s.type||l&&l.length)&&(this.id=s.id,this.gpuTimingStart(s),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(s.type)||t.terrain&&"custom"===s.type)&&nP[s.type](t,r,s,l,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,s=this.context.gl;let l=this.gpuTimers[t.id];l||(l=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQuery()}),l.calls++,s.beginQuery(r.TIME_ELAPSED_EXT,l.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,s=r.createQuery();this.deferredRenderGpuTimeQueries.push(s),r.beginQuery(t.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const s in t){const l=t[s],c=this.context.extTimerQuery,d=c.getQueryParameter(l.query,this.context.gl.QUERY_RESULT)/1e6;c.deleteQueryEXT(l.query),r[s]=d}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.extTimerQuery,s=this.context.gl;let l=0;for(const c of t)l+=r.getQueryParameter(c,s.QUERY_RESULT)/1e6,r.deleteQueryEXT(c);return l}translatePosMatrix(t,r,s,l,c){if(!s[0]&&!s[1])return t;const d=c?"map"===l?this.transform.angle:0:"viewport"===l?-this.transform.angle:0;if(d){const m=Math.sin(d),_=Math.cos(d);s=[s[0]*_-s[1]*m,s[0]*m+s[1]*_]}const h=[c?s[0]:Id(r,s[0],this.transform.zoom),c?s[1]:Id(r,s[1],this.transform.zoom),0],p=new Float32Array(16);return rt.translate(p,t,h),p}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t,r){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString(),r)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,r,s){const l=void 0===s?this.terrain&&this.terrain.renderingToTexture:s,c=this.terrain&&0===this.terrain.exaggeration(),d=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(d.push("LIGHTING_3D_MODE"),d.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):l||d.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||d.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?d.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):d.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(d.push("TERRAIN"),this.terrainUseFloatDEM()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),c&&d.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&d.push("GLOBE"),!this._fogVisible||l||void 0!==r&&!r||d.push("FOG","FOG_DITHERING"),l&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}getOrCreateProgram(t,r){this.cache=this.cache||{};const s=r&&r.defines||[],l=r&&r.config,c=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(s),d=Pf.cacheKey(T1[t],t,c,l);return this.cache[d]||(this.cache[d]=new Pf(this.context,t,T1[t],l,OT[t],c)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=st.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ir(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const s=this.style.directionalLight,l=this.style.ambientLight;if(s&&l){const c=((d,h)=>{const p=d.properties.get("direction"),m=d.properties.get("color").toArray01(),_=d.properties.get("intensity"),y=h.properties.get("color").toArray01(),v=h.properties.get("intensity"),b=[p.x,p.y,p.z],E=zi(y,v),C=zi(m,_);return{u_lighting_ambient_color:E,u_lighting_directional_dir:b,u_lighting_directional_color:C,u_ground_radiance:NR(b,C,E)}})(s,l);r.setLightsUniformValues(t,c)}}}uploadCommonUniforms(t,r,s,l,c){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const h=d.getOpacity(this.transform.pitch),p=((m,_,y,v,b,E,C,S,M,D,R,P)=>{const I=m.transform,O=_.properties.get("color").toArray01();O[3]=v;const F=m.frameCounter/1e3%1,[L,N]=_.properties.get("vertical-range");return{u_fog_matrix:y?I.calculateFogTileMatrix(y):P||m.identityMat,u_fog_range:_.getFovAdjustedRange(I._fov),u_fog_color:O,u_fog_horizon_blend:_.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(L,N),N],u_fog_temporal_offset:F,u_frustum_tl:b,u_frustum_tr:E,u_frustum_br:C,u_frustum_bl:S,u_globe_pos:M,u_globe_radius:D,u_viewport:R,u_globe_transition:Br(I.zoom),u_is_globe:+("globe"===I.projection.name)}})(this,d,s,h,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*kt.devicePixelRatio,this.transform.height*kt.devicePixelRatio],l);r.setFogUniformValues(t,p)}c&&r.setCutoffUniformValues(t,c.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},s=this.transform.coveringTiles({tileSize:512});for(const l of s)r[l.key]=t[l.key]||new Ds(l,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,r){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||"building"!==t.sourceLayer&&(!r||"batched-model"!==r.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=Iu||r[1]>=Iu}}const zf=2048;class ZF{constructor(t,r){this.aabb=t,this.lastCascade=r}}class XF{add(t,r){const s=this.receivers[t.key];void 0!==s?(s.aabb.min[0]=Math.min(s.aabb.min[0],r.min[0]),s.aabb.min[1]=Math.min(s.aabb.min[1],r.min[1]),s.aabb.min[2]=Math.min(s.aabb.min[2],r.min[2]),s.aabb.max[0]=Math.max(s.aabb.max[0],r.max[0]),s.aabb.max[1]=Math.max(s.aabb.max[1],r.max[1]),s.aabb.max[2]=Math.max(s.aabb.max[2],r.max[2])):this.receivers[t.key]=new ZF(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,s){const l=ci.fromPoints(t.points);let c=0;for(const d in this.receivers){const h=this.receivers[d];if(!h||!l.intersectsAabb(h.aabb))continue;h.aabb.min=l.closestPoint(h.aabb.min),h.aabb.max=l.closestPoint(h.aabb.max);const p=h.aabb.getCorners();for(let m=0;m<s.length;m++){let _=!0;for(const y of p){const v=[y[0]*r,y[1]*r,y[2]];if(q.transformMat4(v,v,s[m].matrix),v[0]<-1||v[0]>1||v[1]<-1||v[1]>1){_=!1;break}}if(h.lastCascade=m,c=Math.max(c,m),_)break}}return c+1}}class hg{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new XF,this._depthMode=new ve(t.context.gl.LEQUAL,ve.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const s=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const l=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||l<=0||(this._shadowLayerCount=s.style.order.reduce((b,E)=>{const C=s.style._mergedLayers[E];return b+(C.hasShadowPass()&&!C.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const c=s.context,d=zf,h=zf;if(0===this._cascades.length)for(let b=0;b<2;++b){const E=s._shadowMapDebug,C=c.gl,S=c.createFramebuffer(d,h,E,"texture"),M=new ir(c,{width:d,height:h,data:null},C.DEPTH_COMPONENT);if(S.depthAttachment.set(M.texture),E){const D=new ir(c,{width:d,height:h,data:null},C.RGBA);S.colorAttachment.set(D.texture)}this._cascades.push({framebuffer:S,texture:M,matrix:[],far:0,boundingSphereRadius:0,frustum:new Bl,scale:0})}this.shadowDirection=Ev(r);let p=0;if(t.elevation){const b=t.elevation,E=[1e4,-1e4];b.visibleDemTiles.filter(C=>C.dem).forEach(C=>{const S=C.dem.tree;E[0]=Math.min(E[0],S.minimums[0]),E[1]=Math.max(E[1],S.maximums[0])}),1e4!==E[0]&&(p=(E[1]-E[0])*b.exaggeration())}const m=1.5*t.cameraToCenterDistance,_=3*m,y=new Float64Array(16);for(let b=0;b<2;++b){const E=this._cascades[b];let C=t.height/50,S=1;0===b?S=m:(C=m,S=_);const[M,D]=HT(t,this.shadowDirection,C,S,zf,p);E.scale=t.scale,E.matrix=M,E.boundingSphereRadius=D,rt.invert(y,E.matrix),E.frustum=Bl.fromInvProjectionMatrix(y,1,0,!0),E.far=S}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=l,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=zf,this._uniformValues.u_shadowmap_0=As.ShadowMap0,this._uniformValues.u_shadowmap_1=As.ShadowMap0+1,this._groundShadowTiles=s.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const v=s.transform.elevation;for(const b of this._groundShadowTiles){let E={min:0,max:0};if(v){const C=v.getMinMaxForTile(b);C&&(E=C)}this.addShadowReceiver(b.toUnwrapped(),E.min,E.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this._enabled)return;const s=this.painter,l=s.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(s.transform.getFrustum(0),s.transform.worldSize,this._cascades),l.viewport.set([0,0,zf,zf]);for(let c=0;c<this._numCascadesToRender;++c){s.currentShadowCascade=c,l.bindFramebuffer.set(this._cascades[c].framebuffer.framebuffer),l.clear({color:Ne.white,depth:1});for(const d of t.order){const h=t._mergedLayers[d];if(!h.hasShadowPass()||h.isHidden(s.transform.zoom))continue;const p=t.getLayerSourceCache(h),m=p?r[p.id]:void 0;("model"===h.type||m&&m.length)&&s.renderLayer(s,p,h,m)}}s.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,r=t.style,s=t.context,l=r.directionalLight,c=r.ambientLight;if(!l||!c)return;const d=[],h=Rf(t,t.longestCutoffRange);h.shouldRenderCutoff&&d.push("RENDER_CUTOFF");const p=G1(l,c),m=new ve(s.gl.LEQUAL,ve.ReadOnly,t.depthRangeFor3D);for(const _ of this._groundShadowTiles){const y=_.toUnwrapped(),v=t.isTileAffectedByFog(_),b=t.getOrCreateProgram("groundShadow",{defines:d,overrideFog:v});this.setupShadows(y,b),t.uploadCommonUniforms(s,b,y,null,h);const E={u_matrix:t.transform.calculateProjMatrix(y),u_ground_shadow_factor:p};b.draw(t,s.gl.TRIANGLES,m,Fe.disabled,sn.multiply,Ge.disabled,E,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?sn.unblended:sn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,s=r.calculatePosMatrix(t,r.worldSize);return rt.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}calculateShadowPassMatrixFromMatrix(t){return rt.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,s,l=0){if(!this._enabled)return;const c=this.painter.transform,d=this.painter.context,h=d.gl,p=this._uniformValues,m=new Float64Array(16),_=c.calculatePosMatrix(t,c.worldSize);for(let y=0;y<2;y++)rt.multiply(m,this._cascades[y].matrix,_),p[0===y?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(m),d.activeTexture.set(h.TEXTURE0+As.ShadowMap0+y),this._cascades[y].texture.bind(h.NEAREST,h.CLAMP_TO_EDGE);if(this.useNormalOffset=!!s,this.useNormalOffset){const y=bd(t.canonical),v=2/c.tileSize*dt/zf,b=v*this._cascades[0].boundingSphereRadius,E=v*this._cascades[1].boundingSphereRadius,C=("vector-tile"===s?1:3)/Math.pow(2,l-t.canonical.z-(1-c.zoom+Math.floor(c.zoom)));p.u_shadow_normal_offset=[y,b*C,E*C],p.u_shadow_bias=[6e-5,.0012,.012]}else p.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(d,p)}setupShadowsFromMatrix(t,r,s=!1){if(!this._enabled)return;const l=this.painter.context,c=l.gl,d=this._uniformValues,h=new Float64Array(16);for(let p=0;p<2;p++)rt.multiply(h,this._cascades[p].matrix,t),d[0===p?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(h),l.activeTexture.set(c.TEXTURE0+As.ShadowMap0+p),this._cascades[p].texture.bind(c.NEAREST,c.CLAMP_TO_EDGE);this.useNormalOffset=s,s?(d.u_shadow_normal_offset=[1,5,5],d.u_shadow_bias=[6e-5,.0012,.012]):d.u_shadow_bias=[36e-5,.0012,.012],r.setShadowUniformValues(l,d)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,s,l){if(l[2]>=0)return{};const c=function(p,m,_){const y=_/(1<<p.canonical.z);return new ci([p.canonical.x*y+p.wrap*_,p.canonical.y*y+p.wrap*_,0],[(p.canonical.x+1)*y+p.wrap*_,(p.canonical.y+1)*y+p.wrap*_,m])}(t,r,s).getCorners(),d=r/-l[2];l[0]<0?(q.add(c[0],c[0],[l[0]*d,0,0]),q.add(c[3],c[3],[l[0]*d,0,0])):l[0]>0&&(q.add(c[1],c[1],[l[0]*d,0,0]),q.add(c[2],c[2],[l[0]*d,0,0])),l[1]<0?(q.add(c[0],c[0],[0,l[1]*d,0]),q.add(c[1],c[1],[0,l[1]*d,0])):l[1]>0&&(q.add(c[2],c[2],[0,l[1]*d,0]),q.add(c[3],c[3],[0,l[1]*d,0]));const h={};return h.vertices=c,h.planes=[wv(c[1],c[0],c[4]),wv(c[2],c[1],c[5]),wv(c[3],c[2],c[6]),wv(c[0],c[3],c[7])],h}addShadowReceiver(t,r,s){this._receivers.add(t,ci.fromTileIdAndHeight(t,r,s))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function wv(n,t,r){const s=q.sub([],r,t),l=q.sub([],n,t),c=q.cross([],s,l),d=q.length(c);return 0===d?[0,0,1,0]:(q.scale(c,c,1/d),[c[0],c[1],c[2],-q.dot(c,t)])}function Ev(n){const t=n.properties.get("direction"),r=te(t.x,t.y,t.z);r[2]=Jt(r[2],0,75);const s=qt([r[0],r[1],r[2]]);return q.fromValues(s.x,s.y,s.z)}function G1(n,t){const r=n.properties.get("color"),s=n.properties.get("intensity"),l=n.properties.get("direction"),c=[l.x,l.y,l.z],d=t.properties.get("color"),h=t.properties.get("intensity"),p=Math.max(q.dot([0,0,1],c),0),m=[0,0,0];q.scale(m,d.toArray01Linear().slice(0,3),h);const _=[0,0,0];return q.scale(_,r.toArray01Linear().slice(0,3),p*s),ni([m[0]>0?m[0]/(m[0]+_[0]):0,m[1]>0?m[1]/(m[1]+_[1]):0,m[2]>0?m[2]/(m[2]+_[2]):0])}function HT(n,t,r,s,l,c){const d=n.zoom,h=n.scale,p=n.worldSize,m=1/p,_=n.aspect,y=Math.sqrt(1+_*_)*Math.tan(.5*n.fovX),v=y*y,b=s-r,E=s+r;let C,S;v>b/E?(C=s,S=s*y):(C=.5*E*(1+v),S=.5*Math.sqrt(b*b+2*(s*s+r*r)*v+E*E*v*v));const M=n.projection.pixelsPerMeter(n.center.lat,p),D=n._camera.getCameraToWorldMercator(),R=[0,0,-C*m];q.transformMat4(R,R,D);let P=S*m;const I=n._edgeInsets;if(!(0===I.left&&0===I.top&&0===I.right&&0===I.bottom||I.left===I.right&&I.top===I.bottom)){const lt=n._camera.getWorldToCamera(n.worldSize,"meters"===n.projection.zAxisUnit?M:1),ht=n._camera.getCameraToClipPerspective(n._fov,n.width/n.height,r,s);ht[8]=2*-n.centerOffset.x/n.width,ht[9]=2*n.centerOffset.y/n.height;const mt=new Float64Array(16);rt.mul(mt,ht,lt);const yt=new Float64Array(16);rt.invert(yt,mt);const ct=Bl.fromInvProjectionMatrix(yt,p,d,!0);for(const ft of ct.points){const Rt=((O=ft)[0]/=h,O[1]/=h,O[2]=Ln(O[2],n._center.lat),O);P=Math.max(P,q.len(q.subtract([],R,Rt)))}}var O;P*=l/(l-1);const F=Math.acos(t[2]),L=Math.atan2(-t[0],-t[1]),N=new Cn;N.position=R,N.setPitchBearing(F,L);const z=N.getWorldToCamera(p,M),U=P*p,V=Math.min(n._mercatorZfromZoom(17)*p*-2,-2*U),H=N.getCameraToClipOrthographic(-U,U,-U,U,V,(U+c*M)/t[2]),j=new Float64Array(16);rt.multiply(j,H,z);const Z=q.fromValues(Math.floor(1e6*R[0])/1e6*p,Math.floor(1e6*R[1])/1e6*p,0),tt=.5*l,it=[0,0,0];q.transformMat4(it,Z,j),q.scale(it,it,tt);const X=[Math.floor(it[0]),Math.floor(it[1]),Math.floor(it[2])],Y=[0,0,0];q.sub(Y,it,X),q.scale(Y,Y,-1/tt);const ot=new Float64Array(16);return rt.identity(ot),rt.translate(ot,ot,Y),rt.multiply(j,ot,j),[j,U]}class iP extends $i{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,r){return h1(this.requestManager.transformRequest(r,gt.Model).url).then(s=>{if(!s)return;const l=nT(s),c=new Ub(t,void 0,void 0,l);return c.computeBoundsAndApplyParent(),c}).catch(s=>{this.fire(new at(new Error(`Could not load model ${t} from ${r}: ${s.message}`)))})}load(t,r){this.models[r]||(this.models[r]={});const s=Object.keys(t);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+s.length;const l=[];for(const c of s)l.push(this.loadModel(c,t[c]));Promise.allSettled(l).then(c=>{for(let d=0;d<c.length;d++){const{status:h,value:p}=c[d];"fulfilled"===h&&p&&(this.models[r][s[d]]=p)}this.numModelsLoading[r]-=s.length,this.fire(new St("data",{dataType:"style"}))}).catch(c=>{this.fire(new at(new Error(`Could not load models: ${c.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r){return!!this.getModel(t,r)}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]}addModel(t,r,s){this.models[s]||(this.models[s]={}),this.hasModel(t,s)&&this.removeModel(t,s),this.load({[t]:this.requestManager.normalizeModelURL(r)},s)}addModels(t,r){const s={};for(const l in t)s[l]=this.requestManager.normalizeModelURL(t[l]);this.load(s,r)}removeModel(t,r){this.models[r]||(this.models[r]={});const s=this.models[r][t];delete this.models[r][t],s.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const s in this.models[r])this.models[r][s].upload(t.context)}}const fg=(n,t)=>x_(n,t&&t.filter(r=>"source.canvas"!==r.identifier)),rP=ts(_n,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),q1=ts(_n,["setCenter","setZoom","setBearing","setPitch"]),W1={version:8,layers:[],sources:{}},GT={duration:300,delay:0},Cv=new Set(["fill","line","background","hillshade","raster"]);class Js extends $i{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=Yt({},GT),this._buildingIndex=new dR(this),this.crossTileSymbolIndex=new Ji,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new XE,this.dispatcher=r.dispatcher?r.dispatcher:new Xm(Tf(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new J2,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new Sd(t._requestManager,r.localFontFamily?2:r.localIdeographFontFamily?1:0,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new iP(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",Tt());const s=this;this._rtlTextPluginCallback=Js.registerForPluginStateChange(l=>{s.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:l.pluginStatus,pluginURL:l.pluginURL},(c,d)=>{if(ho(c),d&&d.every(h=>h))for(const h in s._sourceCaches){const p=s._sourceCaches[h],m=p.getSource().type;"vector"!==m&&"geojson"!==m||p.reload()}})}),this.on("data",l=>{if("source"!==l.dataType||"metadata"!==l.sourceDataType)return;const c=this.getOwnSource(l.sourceId);if(c&&c.vectorLayerIds)for(const d in this._layers){const h=this._layers[d];h.source===c.id&&this._validateLayer(h)}})}loadURL(t,r={}){this.fire(new St("dataloading",{dataType:"style"}));const s="boolean"==typeof r.validate?r.validate:!Tn(t);t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const l=this.importsCache.get(t);if(l)return this._load(l,s);const c=this.map._requestManager.transformRequest(t,gt.Style);this._request=At(c,(d,h)=>{if(this._request=null,d)this.fire(new at(d));else if(h)return this.importsCache.set(t,h),this._load(h,s)})}loadJSON(t,r={}){this.fire(new St("dataloading",{dataType:"style"})),this._request=kt.frame(()=>{this._request=null,this._load(t,!1!==r.validate)})}loadEmpty(){this.fire(new St("dataloading",{dataType:"style"})),this._load(W1,!1)}_loadImports(t,r){if(this.importDepth>=4)return Q("Style doesn't support nesting deeper than 5"),this._reloadImports();const s=[];for(const l of t){const c=this._createFragmentStyle(l),d=new Promise(p=>c.on("style.import.load",p));if(s.push(d),this.resolvedImports.has(l.url)){c.loadEmpty();continue}const h=l.data||this.importsCache.get(l.url);h?c.loadJSON(h,{validate:r}):l.url?c.loadURL(l.url,{validate:r}):c.loadEmpty(),this.fragments.push({style:c,id:l.id,config:l.config})}Promise.all(s).then(()=>this._reloadImports())}_createFragmentStyle(t){const r=this.scope?Kr(t.id,this.scope):t.id,s=new Js(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return s.setEventedParent(this.map,{style:s}),s.setConfig(t.config),s}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new St("data",{dataType:"style"})),this.fire(new St(t?"style.load":"style.import.load"))}_load(t,r){const s=t.schema;if(this.isRootStyle()&&(t.fragment||s&&!1!==t.fragment)){const d=Yt({},W1,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(d,r)}if(this.updateSchema(s),r&&fg(this,os(t)))return;this._loaded=!0,this.stylesheet=$(t);for(const d in t.sources)this.addSource(d,t.sources[d],{validate:!1});this._changes.changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const l=fR(this.stylesheet.layers);if(this._order=l.map(d=>d.id),this.stylesheet.light&&Q("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const d=this.stylesheet.lights[0];this.light=new BS(d.properties,d.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new BS(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const d of l){const h=tv(d,this.options);h.setScope(this.scope),h.isConfigDependent&&this._configDependentLayers.add(h.fqid),h.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=h,this._layers[h.id]=h,this._serializedLayers[h.id]=h.serialize();const p=this.getOwnLayerSourceCache(h),m=!!this.directionalLight&&this.directionalLight.shadowsEnabled();p&&h.canCastShadows()&&m&&(p.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const c=this.stylesheet.terrain;if(c&&!this.terrainSetForDrapingOnly()&&this._createTerrain(c,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new St("data",{dataType:"style"})),t.imports)this._loadImports(t.imports,r);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const d=this.isRootStyle();this._shouldPrecompile=d,this.fire(new St(d?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,r,s,l,c,d,h,p;this.forEachFragmentStyle(m=>{if(m.stylesheet){if(null!=m.light&&(t=m.light),m.stylesheet.lights)for(const _ of m.stylesheet.lights)"ambient"===_.type&&null!=m.ambientLight&&(r=m.ambientLight),"directional"===_.type&&null!=m.directionalLight&&(s=m.directionalLight);(m.stylesheet.terrain||m.stylesheet.projection&&"globe"===m.stylesheet.projection.name)&&null!=m.terrain&&(!l||l&&0===l.drapeRenderMode||1===m.terrain.drapeRenderMode)&&(l=m.terrain),m.stylesheet.fog&&null!=m.fog&&(c=m.fog),null!=m.stylesheet.camera&&(p=m.stylesheet.camera),null!=m.stylesheet.projection&&(d=m.stylesheet.projection),null!=m.stylesheet.transition&&(h=m.stylesheet.transition)}}),this.light=t,this.ambientLight=r,this.directionalLight=s,this.terrain=l,this.fog=c,this.camera=p||{"camera-projection":"perspective"},this.projection=d||{name:"mercator"},this.transition=Yt({},GT,h),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=s=>{for(const l of s.fragments)r(l.style);t(s)};r(this)}mergeTerrain(){let t;this.forEachFragmentStyle(r=>{null!=r.terrain&&(!t||t&&0===t.drapeRenderMode||1===r.terrain.drapeRenderMode)&&(t=r.terrain)}),this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{null!=r.stylesheet.projection&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},s={};this.forEachFragmentStyle(l=>{for(const c in l._sourceCaches){const d=Kr(c,l.scope);t[d]=l._sourceCaches[c]}for(const c in l._otherSourceCaches){const d=Kr(c,l.scope);r[d]=l._otherSourceCaches[c]}for(const c in l._symbolSourceCaches){const d=Kr(c,l.scope);s[d]=l._symbolSourceCaches[c]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=s}mergeLayers(){const t={},r=[],s={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(c=>{for(const d of c._order){const h=c._layers[d];if("slot"===h.type){const p=M_(d);if(t[p])continue;t[p]=[]}h.slot&&t[h.slot]?t[h.slot].push(h):r.push(h)}}),this._mergedOrder=[];const l=(c=[])=>{for(const d of c)if("slot"===d.type){const h=M_(d.id);t[h]&&l(t[h])}else{const h=Kr(d.id,d.scope);this._mergedOrder.push(h),s[h]=d,d.is3D()&&(this._has3DLayers=!0),"circle"===d.type&&(this._hasCircleLayers=!0),"symbol"===d.type&&(this._hasSymbolLayers=!0)}};l(r),this._mergedLayers=s,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Yt({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,s,l){let c,d,h;const p=kt.devicePixelRatio>1?"@2x":"";let m=At(s.transformRequest(s.normalizeSpriteURL(r,p,".json"),gt.SpriteJSON),(v,b)=>{m=null,h||(h=v,c=b,y())}),_=Oe(s.transformRequest(s.normalizeSpriteURL(r,p,".png"),gt.SpriteImage),(v,b)=>{_=null,h||(h=v,d=b,y())});function y(){if(h)l(h);else if(c&&d){const v=kt.getImageData(d),b={};for(const E in c){const{width:C,height:S,x:M,y:D,sdf:R,pixelRatio:P,stretchX:I,stretchY:O,content:F}=c[E],L=new Pi({width:C,height:S});Pi.copy(v,L,{x:M,y:D},{x:0,y:0},{width:C,height:S}),b[E]={data:L,pixelRatio:P,sdf:R,stretchX:I,stretchY:O,content:F}}l(null,b)}}return{cancel(){m&&(m.cancel(),m=null),_&&(_.cancel(),_=null)}}}(t,this.map._requestManager,(r,s)=>{if(this._spriteRequest=null,r)this.fire(new at(r));else if(s)for(const l in s)this.imageManager.addImage(l,this.scope,s[l]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new St("data",{dataType:"style"}))})}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const s=t.sourceLayer;s&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(s))&&this.fire(new at(new Error(`Source layer "${s}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const s=this.fragments[r];return s&&s.style&&(t.data=s.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const s=this._sourceCaches[r].getSource();t[s.id]||(t[s.id]=s.serialize())}return t}_serializeLayers(t){const r=[];for(const s of t){const l=this._layers[s];l&&"custom"!==l.type&&r.push(l.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped(this.getLayerSourceCache(t)):Cv.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new at(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new at(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const s=this._changes.changed;if(this._changes.changed){const c=this._changes.getLayerUpdatesByScope();for(const d in c){const{updatedIds:h,removedIds:p}=c[d];(h||p)&&this._updateWorkerLayers(d,h,p)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const l={};for(const c in this._mergedSourceCaches){const d=this._mergedSourceCaches[c];l[c]=d.used,d.used=!1}for(const c of this._mergedOrder){const d=this._mergedLayers[c];if(d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)){const h=this.getOwnLayerSourceCache(d);h&&(h.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let h=d.minzoom||0;h<(d.maxzoom||25.5);h++){const p=this.map.painter;if(p){const m=d.getProgramIds();if(!m)continue;for(const _ of m){const y=d.getDefaultProgramParams(_,t.zoom);y&&(p.style=this,this.fog&&(p._fogVisible=!0,y.overrideFog=!0,p.getOrCreateProgram(_,y)),p._fogVisible=!1,y.overrideFog=!1,p.getOrCreateProgram(_,y),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(y.overrideRtt=!0,p.getOrCreateProgram(_,y)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const c in l){const d=this._mergedSourceCaches[c];l[c]!==d.used&&d.getSource().fire(new St("data",{sourceDataType:"visibility",dataType:"source",sourceId:d.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new St("data",{dataType:"style"}));for(const{style:c}of this.fragments)c.update(t)}_updateTilesForChangedImages(){const t=Array.from(this._changes.changedImages.keys());if(t.length){for(const r in this._sourceCaches)this._sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changes.changedImages.clear()}}_updateWorkerLayers(t,r,s){const l=this.getFragmentStyle(t);this.dispatcher.broadcast("updateLayers",{layers:r?l._serializeLayers(r):[],scope:t,removedIds:s||[],options:l.options})}setState(t){if(this._checkLoaded(),fg(this,os(t)))return!1;(t=$(t)).layers=fR(t.layers);const r=function(l,c){if(!l)return[{command:_n.setStyle,args:[c]}];let d=[];try{if(!ln(l.version,c.version))return[{command:_n.setStyle,args:[c]}];ln(l.center,c.center)||d.push({command:_n.setCenter,args:[c.center]}),ln(l.zoom,c.zoom)||d.push({command:_n.setZoom,args:[c.zoom]}),ln(l.bearing,c.bearing)||d.push({command:_n.setBearing,args:[c.bearing]}),ln(l.pitch,c.pitch)||d.push({command:_n.setPitch,args:[c.pitch]}),ln(l.sprite,c.sprite)||d.push({command:_n.setSprite,args:[c.sprite]}),ln(l.glyphs,c.glyphs)||d.push({command:_n.setGlyphs,args:[c.glyphs]}),ln(l.transition,c.transition)||d.push({command:_n.setTransition,args:[c.transition]}),ln(l.light,c.light)||d.push({command:_n.setLight,args:[c.light]}),ln(l.fog,c.fog)||d.push({command:_n.setFog,args:[c.fog]}),ln(l.projection,c.projection)||d.push({command:_n.setProjection,args:[c.projection]}),ln(l.lights,c.lights)||d.push({command:_n.setLights,args:[c.lights]}),ln(l.camera,c.camera)||d.push({command:_n.setCamera,args:[c.camera]});const h={},p=[];!function(y,v,b,E){let C;for(C in v=v||{},y=y||{})y.hasOwnProperty(C)&&(v.hasOwnProperty(C)||aT(C,b,E));for(C in v){if(!v.hasOwnProperty(C))continue;const S=v[C];y.hasOwnProperty(C)?ln(y[C],S)||("geojson"===y[C].type&&"geojson"===S.type&&ig(y,v,C)?b.push({command:_n.setGeoJSONSourceData,args:[C,S.data]}):pR(C,v,b,E)):m1(C,v,b)}}(l.sources,c.sources,p,h);const m=[];l.layers&&l.layers.forEach(y=>{y.source&&h[y.source]?d.push({command:_n.removeLayer,args:[y.id]}):m.push(y)});let _=l.terrain;_&&h[_.source]&&(d.push({command:_n.setTerrain,args:[void 0]}),_=void 0),d=d.concat(p),ln(_,c.terrain)||d.push({command:_n.setTerrain,args:[c.terrain]}),function(y,v,b){v=v||[];const E=(y=y||[]).map(rg),C=v.map(rg),S=y.reduce(sv,{}),M=v.reduce(sv,{}),D=E.slice(),R=Object.create(null);let P,I,O,F,L,N,z;for(P=0,I=0;P<E.length;P++)O=E[P],M.hasOwnProperty(O)?I++:(b.push({command:_n.removeLayer,args:[O]}),D.splice(D.indexOf(O,I),1));for(P=0,I=0;P<C.length;P++)O=C[C.length-1-P],D[D.length-1-P]!==O&&(S.hasOwnProperty(O)?(b.push({command:_n.removeLayer,args:[O]}),D.splice(D.lastIndexOf(O,D.length-I),1)):I++,N=D[D.length-P],b.push({command:_n.addLayer,args:[M[O],N]}),D.splice(D.length-P,0,O),R[O]=!0);for(P=0;P<C.length;P++)if(O=C[P],F=S[O],L=M[O],!R[O]&&!ln(F,L))if(ln(F.source,L.source)&&ln(F["source-layer"],L["source-layer"])&&ln(F.type,L.type)){for(z in ov(F.layout,L.layout,b,O,null,_n.setLayoutProperty),ov(F.paint,L.paint,b,O,null,_n.setPaintProperty),ln(F.slot,L.slot)||b.push({command:_n.setSlot,args:[O,L.slot]}),ln(F.filter,L.filter)||b.push({command:_n.setFilter,args:[O,L.filter]}),ln(F.minzoom,L.minzoom)&&ln(F.maxzoom,L.maxzoom)||b.push({command:_n.setLayerZoomRange,args:[O,L.minzoom,L.maxzoom]}),F)F.hasOwnProperty(z)&&"layout"!==z&&"paint"!==z&&"filter"!==z&&"metadata"!==z&&"minzoom"!==z&&"maxzoom"!==z&&"slot"!==z&&(0===z.indexOf("paint.")?ov(F[z],L[z],b,O,z.slice(6),_n.setPaintProperty):ln(F[z],L[z])||b.push({command:_n.setLayerProperty,args:[O,z,L[z]]}));for(z in L)L.hasOwnProperty(z)&&!F.hasOwnProperty(z)&&"layout"!==z&&"paint"!==z&&"filter"!==z&&"metadata"!==z&&"minzoom"!==z&&"maxzoom"!==z&&"slot"!==z&&(0===z.indexOf("paint.")?ov(F[z],L[z],b,O,z.slice(6),_n.setPaintProperty):ln(F[z],L[z])||b.push({command:_n.setLayerProperty,args:[O,z,L[z]]}))}else b.push({command:_n.removeLayer,args:[O]}),N=D[D.lastIndexOf(O)+1],b.push({command:_n.addLayer,args:[L,N]})}(m,c.layers,d),function(y=[],v=[],b){v=v||[];const E=(y=y||[]).map(rg),C=v.map(rg),S=y.reduce(sv,{}),M=v.reduce(sv,{}),D=E.slice();let R,P,I,O;for(R=0,P=0;R<E.length;R++)I=E[R],M.hasOwnProperty(I)?P++:(b.push({command:_n.removeImport,args:[I]}),D.splice(D.indexOf(I,P),1));for(R=0,P=0;R<C.length;R++)I=C[C.length-1-R],D[D.length-1-R]!==I&&(S.hasOwnProperty(I)?(b.push({command:_n.removeImport,args:[I]}),D.splice(D.lastIndexOf(I,D.length-P),1)):P++,O=D[D.length-R],b.push({command:_n.addImport,args:[M[I],O]}),D.splice(D.length-R,0,I));for(const F of v){const L=S[F.id];if(!L||ln(L,F))continue;ln(L.config,F.config)||b.push({command:_n.setImportConfig,args:[F.id,F.config]}),ln(L.url,F.url)||b.push({command:_n.setImportUrl,args:[F.id,F.url]});const N=F.data;ln(L&&L.data,N)||b.push({command:_n.setImportData,args:[F.id,N]})}}(l.imports,c.imports,d)}catch(h){console.warn("Unable to compute style diff:",h),d=[{command:_n.setStyle,args:[c]}]}return d}(this.serialize(),t).filter(l=>!(l.command in q1));if(0===r.length)return!1;const s=r.filter(l=>!(l.command in rP));if(s.length>0)throw new Error(`Unimplemented: ${s.map(l=>l.command).join(", ")}.`);return r.forEach(l=>{this[l.command].apply(this,l.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,r){return this.getImage(t)?this.fire(new at(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,r),this._afterImageUpdated(t),this)}updateImage(t,r){this.imageManager.updateImage(t,this.scope,r)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new at(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(t),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new St("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,r,s={}){return this._checkLoaded(),this._validate(Hs,`models.${t}`,r,null,s)||(this.modelManager.addModel(t,r,this.scope),this._changes.changed=!0),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new at(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,s={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(HE,`sources.${t}`,r,null,s))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const l=p1(t,r,this.dispatcher,this);l.scope=this.scope,l.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l.id),source:l.serialize(),sourceId:l.id}));const c=d=>{const h=(d?"symbol:":"other:")+l.id,p=Kr(h,this.scope),m=this._sourceCaches[h]=new Is(p,l,d);(d?this._symbolSourceCaches:this._otherSourceCaches)[l.id]=m,m.onAdd(this.map)};c(!1),"vector"!==r.type&&"geojson"!==r.type||c(!0),l.onAdd&&l.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new at(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new at(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const s=this.getOwnSourceCaches(t);for(const l of s){const c=M_(l.id);delete this._sourceCaches[c],delete this._changes.updatedSourceCaches[l.id],l.fire(new St("data",{sourceDataType:"metadata",dataType:"source",sourceId:l.getSource().id})),l.setEventedParent(null),l.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.changed=!0}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const s=this.getOwnSourceCache(r);s&&t.push(s.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const l of t){if(this._validate(Yi,"lights",l))return;switch(l.type){case"ambient":if(this.ambientLight){const c=this.ambientLight;c.set(l),c.updateTransitions(r)}else this.ambientLight=new Au(l,nR,this.scope,this.options);break;case"directional":if(this.directionalLight){const c=this.directionalLight;c.set(l),c.updateTransitions(r)}else this.directionalLight=new Au(l,iR,this.scope,this.options)}}const s=new wi(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const s=y=>.2126*(y[0]<=.03928?y[0]/12.92:Math.pow((y[0]+.055)/1.055,2.4))+.7152*(y[1]<=.03928?y[1]/12.92:Math.pow((y[1]+.055)/1.055,2.4))+.0722*(y[2]<=.03928?y[2]/12.92:Math.pow((y[2]+.055)/1.055,2.4)),l=t.properties.get("color").toArray01(),c=t.properties.get("intensity"),d=t.properties.get("direction"),h=1-te(d.x,d.y,d.z)[2]/90,p=s(l)*c*h,m=r.properties.get("color").toArray01(),_=r.properties.get("intensity");return(p+s(m)*_)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;const r=this.fragments.find(({id:s})=>s===t);if(!r)throw new Error(`Style import not found: ${t}`);return r.style}setConfigProperty(t,r,s){const l=mc(s);if("success"!==l.result)return void fg(this,l.value);const c=l.value.expression,d=this.getFragmentStyle(t);d.options.set(r,c),d.updateConfigDependencies()}setConfig(t,r){if(this.options.clear(),t){for(const s in t){const l=mc(t[s]);"success"===l.result&&this.options.set(s,l.value.expression)}this.updateSchema(r)}}updateSchema(t){if(t)for(const r in t){if(this.options.has(r))continue;const s=mc(t[r].default);"success"===s.result&&this.options.set(r,s.value.expression)}}updateConfigDependencies(){for(const t of this._configDependentLayers){const r=this.getLayer(t);r&&(r.possiblyEvaluateVisibility(),this._updateLayer(r))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(t,r,s={}){this._checkLoaded();const l=t.id;if(this._layers[l])return void this.fire(new at(new Error(`Layer with id "${l}" already exists on this map`)));let c;if("custom"===t.type){if(fg(this,function(_){const y=[],v=_.id;return void 0===v&&y.push({message:`layers.${v}: missing required property "id"`}),void 0===_.render&&y.push({message:`layers.${v}: missing required method "render"`}),_.renderingMode&&"2d"!==_.renderingMode&&"3d"!==_.renderingMode&&y.push({message:`layers.${v}: property "renderingMode" must be either "2d" or "3d"`}),y}(t)))return;c=tv(t,this.options)}else{if("object"==typeof t.source&&(this.addSource(l,t.source),t=Yt(t=$(t),{source:l})),this._validate(ys,`layers.${l}`,t,{arrayIndex:-1},s))return;c=tv(t,this.options),this._validateLayer(c),c.setEventedParent(this,{layer:{id:l}}),this._serializedLayers[c.id]=c.serialize()}c.isConfigDependent&&this._configDependentLayers.add(c.fqid),c.setScope(this.scope);const d=r?this._order.indexOf(r):this._order.length;if(r&&-1===d)return void this.fire(new at(new Error(`Layer with id "${r}" does not exist on this map.`)));this._order.splice(d,0,l),this._layerOrderChanged=!0,this._layers[l]=c;const h=this.getOwnLayerSourceCache(c),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();h&&c.canCastShadows()&&p&&(h.castsShadows=!0);const m=this._changes.getRemovedLayer(c);if(m&&c.source&&h&&"custom"!==c.type){this._changes.discardLayerRemoval(c);const _=Kr(c.source,c.scope);m.type!==c.type?this._changes.updatedSourceCaches[_]="clear":(this._changes.updatedSourceCaches[_]="reload",h.pause())}this._updateLayer(c),c.onAdd&&c.onAdd(this.map),c.scope=this.scope,this.mergeLayers()}moveLayer(t,r){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(t)||t===r)return;const s=this._order.indexOf(t);this._order.splice(s,1);const l=r?this._order.indexOf(r):this._order.length;r&&-1===l?this.fire(new at(new Error(`Layer with id "${r}" does not exist on this map.`))):(this._order.splice(l,0,t),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const s=this._order.indexOf(t);this._order.splice(s,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const l=this.getOwnLayerSourceCache(r);if(l&&l.castsShadows){let c=!1;for(const d in this._layers)if(this._layers[d].source===r.source&&this._layers[d].canCastShadows()){c=!0;break}l.castsShadows=c}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,s){this._checkLoaded();const l=this._checkLayer(t);l&&(l.minzoom===r&&l.maxzoom===s||(null!=r&&(l.minzoom=r),null!=s&&(l.maxzoom=s),this._updateLayer(l)))}setSlot(t,r){this._checkLoaded();const s=this._checkLayer(t);s&&s.slot!==r&&(s.slot=r,this._updateLayer(s))}setFilter(t,r,s={}){this._checkLoaded();const l=this._checkLayer(t);if(l&&!ln(l.filter,r))return null==r?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(j0,`layers.${l.id}.filter`,r,{layerType:l.type},s)||(l.filter=$(r),this._updateLayer(l)))}getFilter(t){const r=this._checkLayer(t);if(r)return $(r.filter)}setLayoutProperty(t,r,s,l={}){this._checkLoaded();const c=this._checkLayer(t);c&&(ln(c.getLayoutProperty(r),s)||(c.setLayoutProperty(r,s,l),c.isConfigDependent&&this._configDependentLayers.add(c.fqid),this._updateLayer(c)))}getLayoutProperty(t,r){const s=this._checkLayer(t);if(s)return s.getLayoutProperty(r)}setPaintProperty(t,r,s,l={}){this._checkLoaded();const c=this._checkLayer(t);if(!c||ln(c.getPaintProperty(r),s))return;const d=c.setPaintProperty(r,s,l);c.isConfigDependent&&this._configDependentLayers.add(c.fqid),d&&this._updateLayer(c),this._changes.changed=!0,this._changes.updatedPaintProps.add(c.fqid)}getPaintProperty(t,r){const s=this._checkLayer(t);if(s)return s.getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const s=t.source,l=t.sourceLayer,c=this._checkSource(s);if(!c)return;const d=c.type;if("geojson"===d&&l)return void this.fire(new at(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===d&&!l)return void this.fire(new at(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new at(new Error("The feature id parameter must be provided.")));const h=this.getOwnSourceCaches(s);for(const p of h)p.setFeatureState(l,t.id,r)}removeFeatureState(t,r){this._checkLoaded();const s=t.source,l=this._checkSource(s);if(!l)return;const c=l.type,d="vector"===c?t.sourceLayer:void 0;if("vector"===c&&!d)return void this.fire(new at(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new at(new Error("A feature id is required to remove its specific state property.")));const h=this.getOwnSourceCaches(s);for(const p of h)p.removeFeatureState(d,t.id,r)}getFeatureState(t){this._checkLoaded();const r=t.source,s=t.sourceLayer,l=this._checkSource(r);if(l){if("vector"!==l.type||s)return void 0===t.id&&this.fire(new at(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(s,t.id);this.fire(new at(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Yt({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Yt({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:void 0;return Pt({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},s=>void 0!==s)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),s=Kr(t.source,t.scope);t.source&&!this._changes.updatedSourceCaches[s]&&r&&"raster"!==r.getSource().type&&(this._changes.updatedSourceCaches[s]="reload",r.pause()),this._changes.changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=h=>"fill-extrusion"===this._mergedLayers[h].type,s=this.order,l={},c=[];for(let h=s.length-1;h>=0;h--){const p=s[h];if(r(p)){l[p]=h;for(const m of t){const _=m[p];if(_)for(const y of _)c.push(y)}}}c.sort((h,p)=>p.intersectionZ-h.intersectionZ);const d=[];for(let h=s.length-1;h>=0;h--){const p=s[h];if(r(p))for(let m=c.length-1;m>=0;m--){const _=c[m].feature;if(l[_.layer.id]<h)break;d.push(_),c.pop()}else for(const m of t){const _=m[p];if(_)for(const y of _)d.push(y.feature)}}return d}queryRenderedFeatures(t,r,s){r&&r.filter&&this._validate(j0,"queryRenderedFeatures.filter",r.filter,null,r),r.scope=this.scope,r.availableImages=this._availableImages,r.serializedLayers=this._serializedLayers;const l={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new at(new Error("parameters.layers must be an Array."))),[];for(const m of r.layers){const _=this._mergedLayers[m];if(!_)return this.fire(new at(new Error(`The layer '${m}' does not exist in the map's style and cannot be queried for features.`))),[];l[_.source]=!0}}const c=[],d=r.serializedLayers||{},h=r&&r.layers?r.layers.some(m=>{const _=this.getLayer(m);return _&&_.is3D()}):this.has3DLayers(),p=Ru.createFromScreenPoints(t,s);for(const m in this._mergedSourceCaches){const _=this._mergedSourceCaches[m].getSource();if(!_||_.scope!==r.scope)continue;const y=this._mergedSourceCaches[m].getSource().id;r.layers&&!l[y]||c.push(rT(this._mergedSourceCaches[m],this._mergedLayers,d,p,r,s,h,!!this.map._showQueryGeometry))}return this.placement&&c.push(function(m,_,y,v,b,E,C){const S={},M=E.queryRenderedSymbols(v),D=[];for(const R of Object.keys(M).map(Number))D.push(C[R]);D.sort(oT);for(const R of D){const P=R.featureIndex.lookupSymbolFeatures(M[R.bucketInstanceId],_,R.bucketIndex,R.sourceLayerIndex,b.filter,b.layers,b.availableImages,m);for(const I in P){const O=S[I]=S[I]||[],F=P[I];F.sort((L,N)=>{const z=R.featureSortOrder;if(z){const U=z.indexOf(L.featureIndex);return z.indexOf(N.featureIndex)-U}return N.featureIndex-L.featureIndex});for(const L of F)O.push(L)}}for(const R in S)S[R].forEach(P=>{const I=P.feature,O=y(m[R]);if(!O)return;const F=O.getFeatureState(I.layer["source-layer"],I.id);I.source=I.layer.source,I.layer["source-layer"]&&(I.sourceLayer=I.layer["source-layer"]),I.state=F});return S}(this._mergedLayers,d,this.getLayerSourceCache.bind(this),p.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)}querySourceFeatures(t,r){r&&r.filter&&this._validate(j0,"querySourceFeatures.filter",r.filter,null,r);const s=this.getOwnSourceCaches(t);let l=[];for(const c of s)l=l.concat(ng(c,r));return l}addSourceType(t,r,s){return Js.getSourceType(t)?s(new Error(`A source type called "${t}" already exists.`)):(Js.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},s):s(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,s={}){this._checkLoaded();const l=this.light.getLight();let c=!1;for(const h in t)if(!ln(t[h],l[h])){c=!0;break}if(!c)return;const d=this._getTransitionParameters();this.light.setLight(t,r,s),this.light.updateTransitions(d)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,r=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let s=t;if(1===r){if("object"==typeof s.source){const l="terrain-dem-src";this.addSource(l,s.source),s=$(s),s=Yt(s,{source:l})}if(this._validate(V0,"terrain",s))return}if(!this.terrain||this.terrain&&r!==this.terrain.drapeRenderMode){if(!s)return;this._createTerrain(s,r),this.fire(new St("data",{dataType:"style"}))}else{const l=this.terrain,c=l.get();for(const d of Object.keys(J.terrain))!s.hasOwnProperty(d)&&J.terrain[d].default&&(s[d]=J.terrain[d].default);for(const d in t)if(!ln(t[d],c[d])){l.set(t),this.stylesheet.terrain=t;const h=this._getTransitionParameters({duration:0});l.updateTransitions(h),this.fire(new St("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new $S(t,this.map.transform);this.stylesheet.fog=r.get();const s=this._getTransitionParameters({duration:0});r.updateTransitions(s)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!ln(r.get(),t)){r.set(t),this.stylesheet.fog=r.get();const s=this._getTransitionParameters({duration:0});r.updateTransitions(s)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:kt.now(),transition:Yt(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const s in this._mergedLayers)this.isLayerDraped(this._mergedLayers[s])?t.push(s):r.push(s);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const s=this.terrain=new eR(t,r);s.setScope(this.scope),this.stylesheet.terrain=t,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const l=this._getTransitionParameters({duration:0});s.updateTransitions(l)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];"fill-extrusion"===r.type&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];"symbol"===r.type&&this._updateLayer(r)}}_validate(t,r,s,l,c={}){if(c&&!1===c.validate)return!1;const d=Yt({},this.serialize());return fg(this,t.call(os,Yt({key:r,style:d,value:s,styleSpec:J},l)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),sd.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const s of r)s.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const s of r)s.resume(),s.reload()}updateSources(t){let r;this.directionalLight&&(r=Ev(this.directionalLight));for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].update(t,void 0,void 0,r)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,s,l,c=!1){let d=!1,h=!1;const p={},m={};for(const _ of this._mergedOrder){const y=this._mergedLayers[_];if("symbol"!==y.type)continue;const v=Kr(y.source,y.scope);let b=p[v];if(!b){const C=this.getLayerSourceCache(y);if(!C)continue;const S=C.getRenderableIds(!0).map(M=>C.getTileByID(M));m[v]=S.slice(),b=p[v]=S.sort((M,D)=>D.tileID.overscaledZ-M.tileID.overscaledZ||(M.tileID.isLessThan(D.tileID)?-1:1))}const E=this.crossTileSymbolIndex.addLayer(y,b,t.center.lng,t.projection);d=d||E}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),c=c||this._layerOrderChanged||0===s,this._layerOrderChanged&&this.fire(new St("neworder")),(c||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(kt.now(),t.zoom))&&(this.pauseablePlacement=new MR(t,this._mergedOrder,c,r,s,l,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,p,m),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(kt.now()),h=!0),d&&this.pauseablePlacement.placement.setStale()),h||d)for(const _ of this._mergedOrder){const y=this._mergedLayers[_];"symbol"===y.type&&this.placement.updateLayerOpacities(y,p[Kr(y.source,y.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(kt.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const r=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==r.findIndex(({id:l})=>l===t.id)?this.fire(new at(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(r.push(t),this._loadImports([t],!0),this)}setImportUrl(t,r){this._checkLoaded();const s=this.stylesheet.imports||[],l=this.getImportIndex(t);if(-1===l)return this;s[l].url=r;const c=this.fragments[l];c.style=this._createFragmentStyle({id:t,url:r});const d=new Promise(h=>c.style.on("style.import.load",h));return c.style.loadURL(r),d.then(()=>this._reloadImports()),this}setImportData(t,r){this._checkLoaded();const s=this.getImportIndex(t),l=this.stylesheet.imports||[];return-1===s?this:r?(this.fragments[s].style.setState(r),this._reloadImports(),this):(delete l[s].data,this.setImportUrl(t,l[s].url))}setImportConfig(t,r){this._checkLoaded();const s=this.getImportIndex(t),l=this.stylesheet.imports||[];if(-1===s)return this;r?l[s].config=r:delete l[s].config;const c=this.fragments[s],d=c.style.stylesheet&&c.style.stylesheet.schema;return c.config=r,c.style.setConfig(r,d),c.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],s=this.getImportIndex(t);return-1===s||(r.splice(s,1),this.fragments[s].style._remove(),this.fragments.splice(s,1),this._reloadImports()),this}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(s=>s.id===t);return-1===r&&this.fire(new at(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const s=this._mergedOtherSourceCaches[r];s&&t.push(s.getSource())}return t}getSource(t,r){const s=this.getSourceCache(t,r);return s&&s.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const s=Kr(t,r);return this._mergedOtherSourceCaches[s]}getLayerSourceCache(t){const r=Kr(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){for(const t in this._changes.updatedSourceCaches){const r=this._changes.updatedSourceCaches[t];"reload"===r?this.reloadSource(t):"clear"===r&&this.clearSource(t)}}updateLayers(t){for(const r of this._changes.updatedPaintProps){const s=this.getLayer(r);s&&s.updateTransitions(t)}}getImages(t,r,s){this.imageManager.getImages(r.icons,r.scope,s),this._updateTilesForChangedImages();const l=c=>{c&&c.setDependencies(r.tileID.key,r.type,r.icons)};l(this._otherSourceCaches[r.source]),l(this._symbolSourceCaches[r.source])}getGlyphs(t,r,s){this.glyphManager.getGlyphs(r.stacks,r.scope,s)}getResource(t,r,s){return Ot(r,s)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return 0===r.length?(this.fire(new at(new Error(`There is no source with ID '${t}'`))),!1):r.every(s=>s.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function oP(n,t){let r=!1,s=null;const l=()=>{s=null,r&&(n(),s=setTimeout(l,t),r=!1)};return()=>(r=!0,s||l(),s)}Js.getSourceType=function(n){return If[n]},Js.setSourceType=function(n,t){If[n]=t},Js.registerForPluginStateChange=function(n){return n({pluginStatus:Go,pluginURL:Il}),sd.on("pluginStateChange",n),n};class qT{constructor(t){this._hashName=t&&encodeURIComponent(t),Ir(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=oP(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,st.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),st.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=WT(t);if(this._hashName){const s=this._hashName;let l=!1;const c=st.location.hash.slice(1).split("&").map(d=>{const h=d.split("=")[0];return h===s?(l=!0,`${h}=${r}`):d}).filter(d=>d);return l||c.push(`${s}=${r}`),`#${c.join("&")}`}return`#${r}`}_getCurrentHash(){const t=st.location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(s=>s.split("=")).forEach(s=>{s[0]===this._hashName&&(r=s)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(s=>isNaN(s))){const s=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:s,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=st.location.href.replace(/(#.+)?$/,this.getHashString());st.history.replaceState(st.history.state,null,t)}}function WT(n,t){const r=n.getCenter(),s=Math.round(100*n.getZoom())/100,l=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,l),d=Math.round(r.lng*c)/c,h=Math.round(r.lat*c)/c,p=n.getBearing(),m=n.getPitch();let _=t?`/${d}/${h}/${s}`:`${s}/${h}/${d}`;return(p||m)&&(_+="/"+Math.round(10*p)/10),m&&(_+=`/${Math.round(m)}`),_}const pg={linearity:.3,easing:Kc(0,0,.3,1)},Bf=Yt({deceleration:2500,maxSpeed:1400},pg),sP=Yt({deceleration:20,maxSpeed:1400},pg),ZT=Yt({deceleration:1e3,maxSpeed:360},pg),Z1=Yt({deceleration:1e3,maxSpeed:90},pg);class YF{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:kt.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=kt.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new nt(0,0),pinchAround:void 0,around:void 0};for(const{settings:c}of this._inertiaBuffer)r.zoom+=c.zoomDelta||0,r.bearing+=c.bearingDelta||0,r.pitch+=c.pitchDelta||0,c.panDelta&&r.pan._add(c.panDelta),c.around&&(r.around=c.around),c.pinchAround&&(r.pinchAround=c.pinchAround);const s=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(r.pan.mag()){const c=X1(r.pan.mag(),s,Yt({},Bf,t||{}));l.offset=r.pan.mult(c.amount/r.pan.mag()),l.center=this._map.transform.center,Mv(l,c)}if(r.zoom){const c=X1(r.zoom,s,sP);l.zoom=this._map.transform.zoom+c.amount,Mv(l,c)}if(r.bearing){const c=X1(r.bearing,s,ZT);l.bearing=this._map.transform.bearing+Jt(c.amount,-179,179),Mv(l,c)}if(r.pitch){const c=X1(r.pitch,s,Z1);l.pitch=this._map.transform.pitch+c.amount,Mv(l,c)}if(l.zoom||l.bearing){const c=void 0===r.pinchAround?r.around:r.pinchAround;l.around=c?this._map.unproject(c):this._map.getCenter()}return this.clear(),l.noMoveStart=!0,l}}function Mv(n,t){(!n.duration||n.duration<t.duration)&&(n.duration=t.duration,n.easing=t.easing)}function X1(n,t,r){const{maxSpeed:s,linearity:l,deceleration:c}=r,d=Jt(n*l/(t/1e3),-s,s),h=Math.abs(d)/(c*l);return{easing:r.easing,duration:1e3*h,amount:d*(h/2)}}class Qs extends St{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,s,l={}){const c=sp(r.getCanvasContainer(),s);super(t,Yt({point:c,lngLat:r.unproject(c),originalEvent:s},l)),this._defaultPrevented=!1,this.target=r}}class Sv extends St{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,s){const l="touchend"===t?s.changedTouches:s.touches,c=Di(r.getCanvasContainer(),l),d=c.map(p=>r.unproject(p)),h=c.reduce((p,m,_,y)=>p.add(m.div(y.length)),new nt(0,0));super(t,{points:c,point:h,lngLats:d,lngLat:r.unproject(h),originalEvent:s}),this._defaultPrevented=!1}}class aP extends St{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,s){super(t,{originalEvent:s}),this._defaultPrevented=!1}}class XT{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new aP(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Qs(t.type,this._map,t))}mouseup(t){this._map.fire(new Qs(t.type,this._map,t))}preclick(t){const r=Yt({},t);r.type="preclick",this._map.fire(new Qs(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Qs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Qs(t.type,this._map,t))}mouseover(t){this._map.fire(new Qs(t.type,this._map,t))}mouseout(t){this._map.fire(new Qs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Sv(t.type,this._map,t))}touchmove(t){this._map.fire(new Sv(t.type,this._map,t))}touchend(t){this._map.fire(new Sv(t.type,this._map,t))}touchcancel(t){this._map.fire(new Sv(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class YT{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Qs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Qs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lP{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&0===t.button&&(xi(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const s=r,l=this._startPos,c=this._lastPos;if(!l||!c||c.equals(s)||!this._box&&s.dist(l)<this._clickTolerance)return;this._lastPos=s,this._box||(this._box=zn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(l.x,s.x),h=Math.max(l.x,s.x),p=Math.min(l.y,s.y),m=Math.max(l.y,s.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${d}px,${p}px)`,this._box.style.width=h-d+"px",this._box.style.height=m-p+"px")})}mouseupWindow(t,r){if(!this._active)return;const s=this._startPos,l=r;if(s&&0===t.button){if(this.reset(),op(),s.x!==l.x||s.y!==l.y)return this._map.fire(new St("boxzoomend",{originalEvent:t})),{cameraAnimation:c=>c.fitScreenCoordinates(s,l,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),rp(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new St(t,{originalEvent:r}))}}function Tv(n,t){const r={};for(let s=0;s<n.length;s++)r[n[s].identifier]=t[s];return r}class KT{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),s.length===this.numTouches&&(this.centroid=function(l){const c=new nt(0,0);for(const d of l)c._add(d);return c.div(l.length)}(r),this.touches=Tv(s,r)))}touchmove(t,r,s){if(this.aborted||!this.centroid)return;const l=Tv(s,r);for(const c in this.touches){const d=l[c];(!d||d.dist(this.touches[c])>30)&&(this.aborted=!0)}}touchend(t,r,s){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===s.length){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class Y1{constructor(t){this.singleTap=new KT(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,s){this.singleTap.touchstart(t,r,s)}touchmove(t,r,s){this.singleTap.touchmove(t,r,s)}touchend(t,r,s){const l=this.singleTap.touchend(t,r,s);if(l){const c=t.timeStamp-this.lastTime<500,d=!this.lastTap||this.lastTap.dist(l)<30;if(c&&d||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class cP{constructor(){this._zoomIn=new Y1({numTouches:1,numTaps:2}),this._zoomOut=new Y1({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,s){this._zoomIn.touchstart(t,r,s),this._zoomOut.touchstart(t,r,s)}touchmove(t,r,s){this._zoomIn.touchmove(t,r,s),this._zoomOut.touchmove(t,r,s)}touchend(t,r,s){const l=this._zoomIn.touchend(t,r,s),c=this._zoomOut.touchend(t,r,s);return l?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:d.getZoom()+1,around:d.unproject(l)},{originalEvent:t})}):c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:d.getZoom()-1,around:d.unproject(c)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const JT={0:1,2:2};class K1{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const s=Qe(t);this._correctButton(t,s)&&(this._lastPoint=r,this._eventButton=s)}mousemoveWindow(t,r){const s=this._lastPoint;if(s)if(t.preventDefault(),null!=this._eventButton&&function(l,c){const d=JT[c];return void 0===l.buttons||(l.buttons&d)!==d}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(s)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(s,r)}mouseupWindow(t){this._lastPoint&&Qe(t)===this._eventButton&&(this._moved&&op(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class QT extends K1{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return 0===r&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class J1 extends K1{_correctButton(t,r){return 0===r&&t.ctrlKey||2===r}_move(t,r){const s=.8*(r.x-t.x);if(s)return this._active=!0,{bearingDelta:s}}contextmenu(t){t.preventDefault()}}class Q1 extends K1{_correctButton(t,r){return 0===r&&t.ctrlKey||2===r}_move(t,r){const s=-.5*(r.y-t.y);if(s)return this._active=!0,{pitchDelta:s}}contextmenu(t){t.preventDefault()}}class tD{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),Ir(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new nt(0,0)}touchstart(t,r,s){return this._calculateTransform(t,r,s)}touchmove(t,r,s){if(this._active&&!(s.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===s.length&&!be())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,s)}}touchend(t,r,s){this._calculateTransform(t,r,s),this._active&&s.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,s){s.length>0&&(this._active=!0);const l=Tv(s,r),c=new nt(0,0),d=new nt(0,0);let h=0;for(const m in l){const _=l[m],y=this._touches[m];y&&(c._add(_),d._add(_.sub(y)),h++,l[m]=_)}if(this._touches=l,h<this._minTouches||!d.mag())return;const p=d.div(h);return this._sum._add(p),this._sum.mag()<this._clickTolerance?void 0:{around:c.div(h),panDelta:p}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=zn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class tw{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,s){return{}}touchstart(t,r,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,s){const l=this._firstTwoTouches;if(!l)return;t.preventDefault();const[c,d]=l,h=Dv(s,r,c),p=Dv(s,r,d);if(!h||!p)return;const m=this._aroundCenter?null:h.add(p).div(2);return this._move([h,p],m,t)}touchend(t,r,s){if(!this._firstTwoTouches)return;const[l,c]=this._firstTwoTouches,d=Dv(s,r,l),h=Dv(s,r,c);d&&h||(this._active&&op(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Dv(n,t,r){for(let s=0;s<n.length;s++)if(n[s].identifier===r)return t[s]}function uP(n,t){return Math.log(n/t)/Math.LN2}class eD extends tw{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const s=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(uP(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:uP(this._distance,s),pinchAround:r}}}function dP(n,t){return 180*n.angleWith(t)/Math.PI}class KF extends tw{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const s=this._vector;if(this._vector=t[0].sub(t[1]),s&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:dP(this._vector,s),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,s=this._startVector;if(!s)return!1;const l=dP(t,s);return Math.abs(l)<r}}function nD(n){return Math.abs(n.y)>Math.abs(n.x)}class JF extends tw{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,nD(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,s){const l=this._lastPoints;if(!l)return;const c=t[0].sub(l[0]),d=t[1].sub(l[1]);return this._map._cooperativeGestures&&!be()&&s.touches.length<3||(this._valid=this.gestureBeginsVertically(c,d,s.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5})}gestureBeginsVertically(t,r,s){if(void 0!==this._valid)return this._valid;const l=t.mag()>=2,c=r.mag()>=2;if(!l&&!c)return;if(!l||!c)return null==this._firstMove&&(this._firstMove=s),s-this._firstMove<100&&void 0;const d=t.y>0==r.y>0;return nD(t)&&nD(r)&&d}}const QF={panStep:100,bearingStep:15,pitchStep:10};class tL{constructor(){const t=QF;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,s=0,l=0,c=0,d=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?s=-1:(t.preventDefault(),c=-1);break;case 39:t.shiftKey?s=1:(t.preventDefault(),c=1);break;case 38:t.shiftKey?l=1:(t.preventDefault(),d=-1);break;case 40:t.shiftKey?l=-1:(t.preventDefault(),d=1);break;default:return}return this._rotationDisabled&&(s=0,l=0),{cameraAnimation:h=>{const p=h.getZoom();h.easeTo({duration:300,easeId:"keyboardHandler",easing:eL,zoom:r?Math.round(p)+r*(t.shiftKey?2:1):p,bearing:h.getBearing()+s*this._bearingStep,pitch:h.getPitch()+l*this._pitchStep,offset:[-c*this._panStep,-d*this._panStep],center:h.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function eL(n){return n*(2-n)}const hP=4.000244140625;class nL{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Ir(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||be()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===st.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const s=kt.now(),l=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,0!==r&&r%hP==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(l*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=sp(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const m="wheel"===this._type&&Math.abs(this._delta)>hP?this._wheelZoomRate:this._defaultZoomRate;let _=2/(1+Math.exp(-Math.abs(this._delta*m)));this._delta<0&&0!==_&&(_=1/_);const y=r(),v=Math.pow(2,y),b="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):v;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(b*_))),"wheel"===this._type&&(this._startZoom=y,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const s="number"==typeof this._targetZoom?this._targetZoom:r(),l=this._startZoom,c=this._easing;let d,h=!1;if("wheel"===this._type&&l&&c){const m=Math.min((kt.now()-this._lastWheelEventTime)/200,1);d=_e(l,s,c(m)),m<1?this._frameId||(this._frameId=!0):h=!0}else d=s,h=!0;this._active=!0,h&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let p=d-r();return p*this._lastDelta<0&&(p=0),{noInertia:!0,needsRenderFrame:!h,zoomDelta:p,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=$n;if(this._prevEase){const s=this._prevEase,l=(kt.now()-s.start)/s.duration,c=s.easing(l+.01)-s.easing(l),d=.27/Math.sqrt(c*c+1e-4)*.01;r=Kc(d,Math.sqrt(.0729-d*d),.25,1)}return this._prevEase={start:kt.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=zn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(st.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ew{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nw{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:s=>{s.easeTo({duration:300,zoom:s.getZoom()+(t.shiftKey?-1:1),around:s.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iD{constructor(){this._tap=new Y1({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,s){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?s.length>0&&(this._swipePoint=r[0],this._swipeTouch=s[0].identifier):this._tap.touchstart(t,r,s))}touchmove(t,r,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;const l=r[0],c=l.y-this._swipePoint.y;return this._swipePoint=l,t.preventDefault(),this._active=!0,{zoomDelta:c/128}}}else this._tap.touchmove(t,r,s)}touchend(t,r,s){this._tapTime?this._swipePoint&&0===s.length&&this.reset():this._tap.touchend(t,r,s)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fP{constructor(t,r,s){this._el=t,this._mousePan=r,this._touchPan=s}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wl{constructor(t,r,s){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=s}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class pP{constructor(t,r,s,l){this._el=t,this._touchZoom=r,this._touchRotate=s,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const iw=n=>n.zoom||n.drag||n.pitch||n.rotate;class iL extends St{}class mP{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const s=q.sub([],r,t);this.radius=q.length(s[2]<0?q.div([],s,this.constants):[s[0],s[1],0])}projectRay(t){q.div(t,t,this.constants),q.normalize(t,t),q.mul(t,t,this.constants);const r=q.scale([],t,this.radius);if(r[2]>0){const s=q.scale([],[0,0,1],q.dot(r,[0,0,1])),l=q.scale([],q.normalize([],[r[0],r[1],0]),this.radius),c=q.add([],r,q.scale([],q.sub([],q.add([],l,s),r),2));r[0]=c[0],r[1]=c[1]}return r}}function Ld(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}class gP{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new YF(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new mP,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),Ir(["handleEvent","handleWindowEvent"],this);const s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[st.document,"mousemove",{capture:!0}],[st.document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[st,"blur",void 0]];for(const[l,c,d]of this._listeners)l.addEventListener(c,l===st.document?this.handleWindowEvent:this.handleEvent,d)}destroy(){for(const[t,r,s]of this._listeners)t.removeEventListener(r,t===st.document?this.handleWindowEvent:this.handleEvent,s)}_addDefaultHandlers(t){const r=this._map,s=r.getCanvasContainer();this._add("mapEvent",new XT(r,t));const l=r.boxZoom=new lP(r,t);this._add("boxZoom",l);const c=new cP,d=new nw;r.doubleClickZoom=new ew(d,c),this._add("tapZoom",c),this._add("clickZoom",d);const h=new iD;this._add("tapDragZoom",h);const p=r.touchPitch=new JF(r);this._add("touchPitch",p);const m=new J1(t),_=new Q1(t);r.dragRotate=new Wl(t,m,_),this._add("mouseRotate",m,["mousePitch"]),this._add("mousePitch",_,["mouseRotate"]);const y=new QT(t),v=new tD(r,t);r.dragPan=new fP(s,y,v),this._add("mousePan",y),this._add("touchPan",v,["touchZoom","touchRotate"]);const b=new KF,E=new eD;r.touchZoomRotate=new pP(s,E,b,h),this._add("touchRotate",b,["touchPan","touchZoom"]),this._add("touchZoom",E,["touchPan","touchRotate"]),this._add("blockableMapEvent",new YT(r));const C=r.scrollZoom=new nL(r,this);this._add("scrollZoom",C,["mousePan"]);const S=r.keyboard=new tL;this._add("keyboard",S);for(const M of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[M]&&r[M].enable(t[M])}_add(t,r,s){this._handlers.push({handlerName:t,handler:r,allowed:s}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!iw(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,s){for(const l in t)if(l!==s&&(!r||r.indexOf(l)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const s of t)this._el.contains(s.target)&&r.push(s);return r}handleEvent(t,r){this._updatingCamera=!0;const s="renderFrame"===t.type,l=s?void 0:t,c={needsRenderFrame:!1},d={},h={},p=t.touches?this._getMapTouches(t.touches):void 0,m=p?Di(this._el,p):s?void 0:sp(this._el,t);for(const{handlerName:v,handler:b,allowed:E}of this._handlers){if(!b.isEnabled())continue;let C;this._blockedByActive(h,E,v)?b.reset():b[r||t.type]&&(C=b[r||t.type](t,m,p),this.mergeHandlerResult(c,d,C,v,l),C&&C.needsRenderFrame&&this._triggerRenderFrame()),(C||b.isActive())&&(h[v]=b)}const _={};for(const v in this._previousActiveHandlers)h[v]||(_[v]=l);this._previousActiveHandlers=h,(Object.keys(_).length||Ld(c))&&(this._changes.push([c,d,_]),this._triggerRenderFrame()),(Object.keys(h).length||Ld(c))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:y}=c;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}mergeHandlerResult(t,r,s,l,c){if(!s)return;Yt(t,s);const d={handlerName:l,originalEvent:s.originalEvent||c};void 0!==s.zoomDelta&&(r.zoom=d),void 0!==s.panDelta&&(r.drag=d),void 0!==s.pitchDelta&&(r.pitch=d),void 0!==s.bearingDelta&&(r.rotate=d)}_applyChanges(){const t={},r={},s={};for(const[l,c,d]of this._changes)l.panDelta&&(t.panDelta=(t.panDelta||new nt(0,0))._add(l.panDelta)),l.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+l.pitchDelta),void 0!==l.around&&(t.around=l.around),void 0!==l.aroundCoord&&(t.aroundCoord=l.aroundCoord),void 0!==l.pinchAround&&(t.pinchAround=l.pinchAround),l.noInertia&&(t.noInertia=l.noInertia),Yt(r,c),Yt(s,d);this._updateMapTransform(t,r,s),this._changes=[]}_updateMapTransform(t,r,s){const l=this._map,c=l.transform,d=D=>[D.x,D.y,D.z];if((D=>{const R=this._eventsInProgress.drag;return R&&!this._handlersById[R.handlerName].isActive()})()&&!Ld(t)){const D=c.zoom;c.cameraElevationReference="sea",null!=this._originalZoom&&c._orthographicProjectionAtLowPitch&&"globe"!==c.projection.name&&0===c.pitch?(c.cameraElevationReference="ground",c.zoom=this._originalZoom):(c.recenterOnTerrain(),c.cameraElevationReference="ground"),D!==c.zoom&&this._map._update(!0)}if(c._isCameraConstrained&&l._stop(!0),!Ld(t))return void this._fireEvents(r,s,!0);let{panDelta:h,zoomDelta:p,bearingDelta:m,pitchDelta:_,around:y,aroundCoord:v,pinchAround:b}=t;c._isCameraConstrained&&(p>0&&(p=0),c._isCameraConstrained=!1),void 0!==b&&(y=b),(p||(D=>r[D]&&!this._eventsInProgress[D])("drag"))&&y&&(this._dragOrigin=d(c.pointCoordinate3D(y)),this._originalZoom=c.zoom,this._trackingEllipsoid.setup(c._camera.position,this._dragOrigin)),c.cameraElevationReference="sea",l._stop(!0),y=y||l.transform.centerPoint,m&&(c.bearing+=m),_&&(c.pitch+=_),c._updateCameraState();const E=[0,0,0];if(h)if("mercator"===c.projection.name){const D=this._trackingEllipsoid.projectRay(c.screenPointToMercatorRay(y).dir),R=this._trackingEllipsoid.projectRay(c.screenPointToMercatorRay(y.sub(h)).dir);E[0]=R[0]-D[0],E[1]=R[1]-D[1]}else{const D=c.pointCoordinate(y);if("globe"===c.projection.name){h=h.rotate(-c.angle);const R=c._pixelsPerMercatorPixel/c.worldSize;E[0]=-h.x*iy(lr(D.y))*R,E[1]=-h.y*iy(c.center.lat)*R}else{const R=c.pointCoordinate(y.sub(h));D&&R&&(E[0]=R.x-D.x,E[1]=R.y-D.y)}}const C=c.zoom,S=[0,0,0];if(p){const D=d(v||c.pointCoordinate3D(y)),R={dir:q.normalize([],q.sub([],D,c._camera.position))};if(R.dir[2]<0){const P=c.zoomDeltaToMovement(D,p);q.scale(S,R.dir,P)}}const M=q.add(E,E,S);c._translateCameraConstrained(M),p&&Math.abs(c.zoom-C)>1e-4&&c.recenterOnTerrain(),c.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,s,!0)}_fireEvents(t,r,s){const l=iw(this._eventsInProgress),c=iw(t),d={};for(const _ in t){const{originalEvent:y}=t[_];this._eventsInProgress[_]||(d[`${_}start`]=y),this._eventsInProgress[_]=t[_]}!l&&c&&this._fireEvent("movestart",c.originalEvent);for(const _ in d)this._fireEvent(_,d[_]);c&&this._fireEvent("move",c.originalEvent);for(const _ in t){const{originalEvent:y}=t[_];this._fireEvent(_,y)}const h={};let p;for(const _ in this._eventsInProgress){const{handlerName:y,originalEvent:v}=this._eventsInProgress[_];this._handlersById[y].isActive()||(delete this._eventsInProgress[_],p=r[y]||v,h[`${_}end`]=p)}for(const _ in h)this._fireEvent(_,h[_]);const m=iw(this._eventsInProgress);if(s&&(l||c)&&!m){this._updatingCamera=!0;const _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),y=v=>0!==v&&-this._bearingSnap<v&&v<this._bearingSnap;_?(y(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:p})):(this._map.fire(new St("moveend",{originalEvent:p})),y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new St(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new iL("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const rw="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class _P extends $i{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,Ir(["_renderFrameCallback"],this)}getCenter(){return new we(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,s){return t=nt.convert(t).mult(-1),this.panTo(this.transform.center,Yt({offset:t},r),s)}panTo(t,r,s){return this.easeTo(Yt({center:t},r),s)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,s){return this.easeTo(Yt({zoom:t},r),s)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,s){return this.easeTo(Yt({bearing:t},r),s)}resetNorth(t,r){return this.rotateTo(0,Yt({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(Yt({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=qs.convert(t);const s=r&&r.bearing||0,l=r&&r.pitch||0,c=t.getNorthWest(),d=t.getSouthEast();return this._cameraForBounds(this.transform,c,d,s,l,r)}_extendCameraOptions(t){const r={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=Yt({padding:r,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const s=t.padding;t.padding={top:s,bottom:s,right:s,left:s}}return t.padding=Yt(r,t.padding),t}_minimumAABBFrustumDistance(t,r){const s=r.max[0]-r.min[0],l=r.max[1]-r.min[1];return s/l>t.aspect?s/(2*Math.tan(.5*t.fovX)*t.aspect):l/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,s,l,c,d){const h=t.clone(),p=this._extendCameraOptions(d);h.bearing=l,h.pitch=c;const m=we.convert(r),_=we.convert(s),y=.5*(m.lat+_.lat),v=.5*(m.lng+_.lng),b=as(y,v),E=q.normalize([],b),C=q.normalize([],q.cross([],E,[0,1,0])),S=q.cross([],C,E),M=[C[0],C[1],C[2],0,S[0],S[1],S[2],0,E[0],E[1],E[2],0,0,0,0,1],D=[b,as(m.lat,m.lng),as(_.lat,m.lng),as(_.lat,_.lng),as(m.lat,_.lng),as(y,m.lng),as(y,_.lng),as(m.lat,v),as(_.lat,v)];let R=ci.fromPoints(D.map(Y=>[q.dot(C,Y),q.dot(S,Y),q.dot(E,Y)]));const P=q.transformMat4([],R.center,M);0===q.squaredLength(P)&&q.set(P,0,0,1),q.normalize(P,P),q.scale(P,P,Ro),h.center=function([Y,ot,lt]){const ht=Math.hypot(Y,ot,lt),mt=Math.atan2(Y,lt),yt=.5*Math.PI-Math.acos(-ot/ht);return new we(Er(mt),Er(yt))}(P);const I=h.getWorldToCameraMatrix(),O=rt.invert(new Float64Array(16),I);R=ci.applyTransform(R,rt.multiply([],I,M)),q.transformMat4(P,P,I);const F=.5*(R.max[2]-R.min[2]),L=this._minimumAABBFrustumDistance(h,R),N=q.scale([],[0,0,1],F),z=q.add(N,P,N),U=L+(0===h.pitch?0:q.distance(P,z)),V=h.globeCenterInViewSpace,H=q.sub([],P,[V[0],V[1],V[2]]);q.normalize(H,H),q.scale(H,H,U);const j=q.add([],P,H);q.transformMat4(j,j,O);const Z=vd/Ro,tt=q.length(j),it=Ln(Math.max(tt*Z-vd,Number.EPSILON),0),X=Math.min(h.zoomFromMercatorZAdjusted(it),p.maxZoom);return X>.5*(qp+mu)?(h.setProjection({name:"mercator"}),h.zoom=X,this._cameraForBounds(h,r,s,l,c,d)):{center:h.center,zoom:X,bearing:l,pitch:c}}queryTerrainElevation(t,r){const s=this.transform.elevation;return s?(r=Yt({},{exaggerated:!0},r),s.getAtPoint(Ke.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,s,l,c,d){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,r,s,l,c,d);const h=t.clone(),p=this._extendCameraOptions(d),m=h.padding;h.bearing=l,h.pitch=c;const _=we.convert(r),y=we.convert(s),v=new we(_.lng,y.lat),b=new we(y.lng,_.lat),E=h.project(_),C=h.project(y),S=this.queryTerrainElevation(_),M=this.queryTerrainElevation(y),D=this.queryTerrainElevation(v),R=this.queryTerrainElevation(b),P=[[E.x,E.y,Math.min(S||0,M||0,D||0,R||0)],[C.x,C.y,Math.max(S||0,M||0,D||0,R||0)]];let I=ci.fromPoints(P);const O=h.getWorldToCameraMatrix(),F=rt.invert(new Float64Array(16),O);I=ci.applyTransform(I,O);const L=q.sub([],I.max,I.min),N=m.left||0,z=m.right||0,U=m.bottom||0,V=m.top||0,{left:H,right:j,top:Z,bottom:tt}=p.padding,it=.5*(N+z),X=.5*(V+U),Y=Math.min(h.scaleZoom(h.scale*Math.min((h.width-(N+z+H+j))/L[0],(h.height-(U+V+tt+Z))/L[1])),p.maxZoom),ot=h.scale/h.zoomScale(Y);I=new ci([I.min[0]-(H+it)*ot,I.min[1]-(tt+X)*ot,I.min[2]],[I.max[0]+(j+it)*ot,I.max[1]+(Z+X)*ot,I.max[2]]);const lt=.5*L[2],ht=this._minimumAABBFrustumDistance(h,I),mt=[0,0,1,0];Fn.transformMat4(mt,mt,O),Fn.normalize(mt,mt);const yt=q.scale([],mt,ht+lt),ct=q.add([],I.center,yt),ft=("number"==typeof p.offset.x&&"number"==typeof p.offset.y?new nt(p.offset.x,p.offset.y):nt.convert(p.offset)).rotate(-Ie(l));I.center[0]-=ft.x*ot,I.center[1]+=ft.y*ot,q.transformMat4(I.center,I.center,F),q.transformMat4(ct,ct,F);const Rt=[I.center[0],I.center[1],ct[2]*h.pixelsPerMeter];q.scale(Rt,Rt,1/h.worldSize);const Vt=Ms(Rt[0]),jt=lr(Rt[1]),$t=Math.min(h._zoomFromMercatorZ(Rt[2]),p.maxZoom),re=new we(Vt,jt);return h.mercatorFromTransition&&$t<.5*(qp+mu)?(h.setProjection({name:"globe"}),h.zoom=$t,this._cameraForBounds(h,r,s,l,c,d)):{center:re,zoom:$t,bearing:l,pitch:c}}fitBounds(t,r,s){const l=this.cameraForBounds(t,r);return this._fitInternal(l,r,s)}fitScreenCoordinates(t,r,s,l,c){const d=nt.convert(t),h=nt.convert(r),p=new nt(Math.min(d.x,h.x),Math.min(d.y,h.y)),m=new nt(Math.max(d.x,h.x),Math.max(d.y,h.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(d,h))return this;const _=this.transform.pointLocation3D(p),y=this.transform.pointLocation3D(m),v=this.transform.pointLocation3D(new nt(p.x,m.y)),b=this.transform.pointLocation3D(new nt(m.x,p.y)),E=[Math.min(_.lng,y.lng,v.lng,b.lng),Math.min(_.lat,y.lat,v.lat,b.lat)],C=[Math.max(_.lng,y.lng,v.lng,b.lng),Math.max(_.lat,y.lat,v.lat,b.lat)],S=l&&l.pitch?l.pitch:this.getPitch(),M=this._cameraForBounds(this.transform,E,C,s,S,l);return this._fitInternal(M,l,c)}_fitInternal(t,r,s){return t?(delete(r=Yt(t,r)).padding,r.linear?this.easeTo(r,s):this.flyTo(r,s)):this}jumpTo(t,r){this.stop();const s=t.preloadOnly?this.transform.clone():this.transform;let l=!1,c=!1,d=!1;return"zoom"in t&&s.zoom!==+t.zoom&&(l=!0,s.zoom=+t.zoom),void 0!==t.center&&(s.center=we.convert(t.center)),"bearing"in t&&s.bearing!==+t.bearing&&(c=!0,s.bearing=+t.bearing),"pitch"in t&&s.pitch!==+t.pitch&&(d=!0,s.pitch=+t.pitch),null==t.padding||s.isPaddingEqual(t.padding)||(s.padding=t.padding),t.preloadOnly?(this._preloadTiles(s),this):(this.fire(new St("movestart",r)).fire(new St("move",r)),l&&this.fire(new St("zoomstart",r)).fire(new St("zoom",r)).fire(new St("zoomend",r)),c&&this.fire(new St("rotatestart",r)).fire(new St("rotate",r)).fire(new St("rotateend",r)),d&&this.fire(new St("pitchstart",r)).fire(new St("pitch",r)).fire(new St("pitchend",r)),this.fire(new St("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||Q(rw),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const s=this.transform;if(!s.projection.supportsFreeCamera)return Q(rw),this;this.stop();const l=s.zoom,c=s.pitch,d=s.bearing;s.setFreeCameraOptions(t);const h=l!==s.zoom,p=c!==s.pitch,m=d!==s.bearing;return this.fire(new St("movestart",r)).fire(new St("move",r)),h&&this.fire(new St("zoomstart",r)).fire(new St("zoom",r)).fire(new St("zoomend",r)),m&&this.fire(new St("rotatestart",r)).fire(new St("rotate",r)).fire(new St("rotateend",r)),p&&this.fire(new St("pitchstart",r)).fire(new St("pitch",r)).fire(new St("pitchend",r)),this.fire(new St("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),(!1===(t=Yt({offset:[0,0],duration:500,easing:$n},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const s=this.transform,l=this.getZoom(),c=this.getBearing(),d=this.getPitch(),h=this.getPadding(),p="zoom"in t?+t.zoom:l,m="bearing"in t?this._normalizeBearing(t.bearing,c):c,_="pitch"in t?+t.pitch:d,y="padding"in t?t.padding:s.padding,v=nt.convert(t.offset);let b,E,C;if("globe"===s.projection.name){const N=Ke.fromLngLat(s.center),z=v.rotate(-s.angle);N.x+=z.x/s.worldSize,N.y+=z.y/s.worldSize;const U=N.toLngLat(),V=we.convert(t.center||U);this._normalizeCenter(V),b=s.centerPoint.add(z),E=new nt(N.x,N.y).mult(s.worldSize),C=new nt(eo(V.lng),po(V.lat)).mult(s.worldSize).sub(E)}else{b=s.centerPoint.add(v);const N=s.pointLocation(b),z=we.convert(t.center||N);this._normalizeCenter(z),E=s.project(N),C=s.project(z).sub(E)}const S=s.zoomScale(p-l);let M,D;t.around&&(M=we.convert(t.around),D=s.locationPoint(M));const R=this._zooming||p!==l,P=this._rotating||c!==m,I=this._pitching||_!==d,O=!s.isPaddingEqual(y),F=N=>z=>{if(R&&(N.zoom=_e(l,p,z)),P&&(N.bearing=_e(c,m,z)),I&&(N.pitch=_e(d,_,z)),O&&(N.interpolatePadding(h,y,z),b=N.centerPoint.add(v)),M)N.setLocationAtPoint(M,D);else{const U=N.zoomScale(N.zoom-l),V=p>l?Math.min(2,S):Math.max(.5,S),H=Math.pow(V,1-z),j=N.unproject(E.add(C.mult(z*H)).mult(U));N.setLocationAtPoint(N.renderWorldCopies?j.wrap():j,b)}return t.preloadOnly||this._fireMoveEvents(r),N};if(t.preloadOnly){const N=this._emulate(F,t.duration,s);return this._preloadTiles(N),this}const L={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=R,this._rotating=P,this._pitching=I,this._padding=O,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,L),this._ease(F(s),N=>{"sea"===s.cameraElevationReference&&s.recenterOnTerrain(),this._afterEase(r,N)},t),this}_prepareEase(t,r,s={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||s.moving||this.fire(new St("movestart",t)),this._zooming&&!s.zooming&&this.fire(new St("zoomstart",t)),this._rotating&&!s.rotating&&this.fire(new St("rotatestart",t)),this._pitching&&!s.pitching&&this.fire(new St("pitchstart",t))}_fireMoveEvents(t){this.fire(new St("move",t)),this._zooming&&this.fire(new St("zoom",t)),this._rotating&&this.fire(new St("rotate",t)),this._pitching&&this.fire(new St("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const s=this._zooming,l=this._rotating,c=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,s&&this.fire(new St("zoomend",t)),l&&this.fire(new St("rotateend",t)),c&&this.fire(new St("pitchend",t)),this.fire(new St("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const Y=ts(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Y,r)}this.stop(),t=Yt({offset:[0,0],speed:1.2,curve:1.42,easing:$n},t);const s=this.transform,l=this.getZoom(),c=this.getBearing(),d=this.getPitch(),h=this.getPadding(),p="zoom"in t?Jt(+t.zoom,s.minZoom,s.maxZoom):l,m="bearing"in t?this._normalizeBearing(t.bearing,c):c,_="pitch"in t?+t.pitch:d,y="padding"in t?t.padding:s.padding,v=s.zoomScale(p-l),b=nt.convert(t.offset);let E=s.centerPoint.add(b);const C=s.pointLocation(E),S=we.convert(t.center||C);this._normalizeCenter(S);const M=s.project(C),D=s.project(S).sub(M);let R=t.curve;const P=Math.max(s.width,s.height),I=P/v,O=D.mag();if("minZoom"in t){const Y=Jt(Math.min(t.minZoom,l,p),s.minZoom,s.maxZoom),ot=P/s.zoomScale(Y-l);R=Math.sqrt(ot/O*2)}const F=R*R;function L(Y){const ot=(I*I-P*P+(Y?-1:1)*F*F*O*O)/(2*(Y?I:P)*F*O);return Math.log(Math.sqrt(ot*ot+1)-ot)}function N(Y){return(Math.exp(Y)-Math.exp(-Y))/2}function z(Y){return(Math.exp(Y)+Math.exp(-Y))/2}const U=L(0);let V=function(Y){return z(U)/z(U+R*Y)},H=function(Y){return P*((z(U)*(N(ot=U+R*Y)/z(ot))-N(U))/F)/O;var ot},j=(L(1)-U)/R;if(Math.abs(O)<1e-6||!isFinite(j)){if(Math.abs(P-I)<1e-6)return this.easeTo(t,r);const Y=I<P?-1:1;j=Math.abs(Math.log(I/P))/R,H=function(){return 0},V=function(ot){return Math.exp(Y*R*ot)}}t.duration="duration"in t?+t.duration:1e3*j/("screenSpeed"in t?+t.screenSpeed/R:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Z=c!==m,tt=_!==d,it=!s.isPaddingEqual(y),X=Y=>ot=>{const lt=ot*j,ht=1/V(lt);Y.zoom=1===ot?p:l+Y.scaleZoom(ht),Z&&(Y.bearing=_e(c,m,ot)),tt&&(Y.pitch=_e(d,_,ot)),it&&(Y.interpolatePadding(h,y,ot),E=Y.centerPoint.add(b));const mt=1===ot?S:Y.unproject(M.add(D.mult(H(lt))).mult(ht));return Y.setLocationAtPoint(Y.renderWorldCopies?mt.wrap():mt,E),Y._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),Y};if(t.preloadOnly){const Y=this._emulate(X,t.duration,s);return this._preloadTiles(Y),this}return this._zooming=!0,this._rotating=Z,this._pitching=tt,this._padding=it,this._prepareEase(r,!1),this._ease(X(s),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const s=this._onEaseEnd;this._onEaseEnd=void 0,s.call(this,r)}if(!t){const s=this.handlers;s&&s.stop(!1)}return this}_ease(t,r,s){!1===s.animate||0===s.duration?(t(1),r()):(this._easeStart=kt.now(),this._easeOptions=s,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((kt.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=bl(t,-180,180);const s=Math.abs(t-r);return Math.abs(t-360-r)<s&&(t-=360),Math.abs(t+360-r)<s&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.maxBounds)return;const s=t.lng-r.center.lng;t.lng+=s>180?-360:s<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&kt.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,s){const l=Math.ceil(15*r/1e3),c=[],d=t(s.clone());for(let h=0;h<=l;h++){const p=d(h/l);c.push(p.clone())}return c}}class yP{constructor(t={}){this.options=t,Ir(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact;return this._map=t,this._container=zn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=zn("button","mapboxgl-ctrl-attrib-button",this._container),zn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=zn("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===r&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const s=this._map._getUIString(`AttributionControl.${r}`);t.setAttribute("aria-label",s),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",s)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||$e.ACCESS_TOKEN}];if(t){const s=r.reduce((l,c,d)=>(c.value&&(l+=`${c.key}=${c.value}${d<r.length-1?"&":""}`),l),"?");t.href=`${$e.FEEDBACK_URL}/${s}#${WT(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const r=this._map.style._mergedSourceCaches;for(const l in r){const c=r[l];if(c.used){const d=c.getSource();d.attribution&&t.indexOf(d.attribution)<0&&t.push(d.attribution)}}t.sort((l,c)=>l.length-c.length),t=t.filter((l,c)=>{for(let d=c+1;d<t.length;d++)if(t[d].indexOf(l)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const s=t.join(" | ");s!==this._attribHTML&&(this._attribHTML=s,t.length?(this._innerContainer.innerHTML=s,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class rD{constructor(){Ir(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=zn("div","mapboxgl-ctrl");const r=zn("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const r in t){const s=t[r].getSource();if(s.hasOwnProperty("mapbox_logo")&&!s.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class Vf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,s=r?this._queue.concat(r):this._queue;for(const l of s)if(l.id===t)return void(l.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const s of r)if(!s.cancelled&&(s.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function mg(n,t,r){if(n=new we(n.lng,n.lat),t){const s=new we(n.lng-360,n.lat),l=new we(n.lng+360,n.lat),c=360*Math.ceil(Math.abs(n.lng-r.center.lng)/360),d=r.locationPoint(n).distSqr(t),h=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint(s).distSqr(t)<d&&(h||Math.abs(s.lng-r.center.lng)<c)?n=s:r.locationPoint(l).distSqr(t)<d&&(h||Math.abs(l.lng-r.center.lng)<c)&&(n=l)}for(;Math.abs(n.lng-r.center.lng)>180;){const s=r.locationPoint(n);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;n.lng>r.center.lng?n.lng-=360:n.lng+=360}return n}const ow={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sw extends $i{constructor(t,r){if(super(),(t instanceof st.HTMLElement||r)&&(t=Yt({element:t},r)),Ir(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=nt.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=zn("div");const c=41,d=27,h=Ra("svg",{display:"block",height:c*this._scale+"px",width:d*this._scale+"px",viewBox:`0 0 ${d} ${c}`},this._element),p=Ra("radialGradient",{id:"shadowGradient"},Ra("defs",{},h));Ra("stop",{offset:"10%","stop-opacity":.4},p),Ra("stop",{offset:"100%","stop-opacity":.05},p),Ra("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h),Ra("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),Ra("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),Ra("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),this._offset=nt.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()});const s=this._element.classList;for(const c in ow)s.remove(`mapboxgl-marker-anchor-${c}`);s.add(`mapboxgl-marker-anchor-${this._anchor}`);const l=t&&t.className?t.className.trim().split(/\s+/):[];s.add(...l),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=we.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const l=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(24.6+l)],"bottom-right":[-l,-1*(24.6+l)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,s=t.charCode||t.keyCode;"Space"!==r&&"Enter"!==r&&32!==s&&13!==s||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,s=this._element;this._popup&&(r===s||s.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const s=t.unproject(r),l=t.getFreeCameraOptions();if(!l.position)return!1;const c=l.position.toLngLat();return c.distanceTo(s)<.9*c.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const s=t.unproject(r);let l;t._showingGlobe()&&ey(t.transform,this._lngLat)?l=0:(l=1-t._queryFogOpacity(s),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(l*=this._occludedOpacity)),this._element.style.opacity=`${l}`,this._element.style.pointerEvents=l>0?"auto":"none",this._popup&&this._popup._setOpacity(l),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${ow[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${r.x}px,${r.y}px)\n        `}_calculateXYTransform(){const t=this._pos,r=this._map,s=this.getPitchAlignment();if(!r||!t||"map"!==s)return"";if(!r._showingGlobe()){const p=r.getPitch();return p?`rotateX(${p}deg)`:""}const l=Er(WC(r.transform,this._lngLat)),c=t.sub(qC(r.transform)),d=Math.abs(c.x)+Math.abs(c.y);if(0===d)return"";const h=l/d;return`rotateX(${-c.y*h}deg) rotateY(${c.x*h}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let s=0;const l=this.getRotationAlignment();if("map"===l)if(r._showingGlobe()){const c=r.project(new we(this._lngLat.lng,this._lngLat.lat+.001)),d=r.project(new we(this._lngLat.lng,this._lngLat.lat-.001)).sub(c);s=Er(Math.atan2(d.y,d.x))-90}else s=-r.getBearing();else if("horizon"===l){const c=xl(4,6,r.getZoom()),d=qC(r.transform);d.y+=c*r.transform.height;const h=t.sub(d),p=Er(Math.atan2(h.y,h.x));s=(p>90?p-270:p+90)*(1-c)}return s+=this._rotation,s?`rotateZ(${s}deg)`:""}_update(t){st.cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=mg(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat),!0===t?this._updateFrameId=st.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=nt.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const s=this._pointerdownPos,l=this._positionDelta;if(s&&l){if(!this._isDragging){const c=this._clickTolerance||r._clickTolerance;if(t.point.dist(s)<c)return;this._isDragging=!0}this._pos=t.point.sub(l),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new St("dragstart"))),this.fire(new St("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new St("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,s=this._pos;r&&s&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(s),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const vP={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xP=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function oD(n=new nt(0,0),t="bottom"){if("number"==typeof n){const r=Math.round(Math.sqrt(.5*Math.pow(n,2)));switch(t){case"top":return new nt(0,n);case"top-left":return new nt(r,r);case"top-right":return new nt(-r,r);case"bottom":return new nt(0,-n);case"bottom-left":return new nt(r,-r);case"bottom-right":return new nt(-r,-r);case"left":return new nt(n,0);case"right":return new nt(-n,0)}return new nt(0,0)}return n instanceof nt||Array.isArray(n)?nt.convert(n):nt.convert(n[t]||[0,0])}class bP{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=Yc((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,s){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+s}}const aw={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},wP={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},EP={showCompass:!0,showZoom:!0,visualizePitch:!1};class CP{constructor(t,r,s=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new J1({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,s&&(this.mousePitch=new Q1({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),Ir(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),xi()}move(t,r){const s=this.map,l=this.mouseRotate.mousemoveWindow(t,r),c=l&&l.bearingDelta;if(c&&s.setBearing(s.getBearing()+c),this.mousePitch){const d=this.mousePitch.mousemoveWindow(t,r),h=d&&d.pitchDelta;h&&s.setPitch(s.getPitch()+h)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){rp(),st.removeEventListener("mousemove",this.mousemove),st.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Yt({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),sp(this.element,t)),st.addEventListener("mousemove",this.mousemove),st.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,sp(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=Di(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=Di(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const MP={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},SP={maxWidth:100,unit:"metric"},TP={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Iv={version:Ta,supported:lE,setRTLTextPlugin:function(n,t,r=!1){if(Go===H0||Go===G0||Go===Nt)throw new Error("setRTLTextPlugin cannot be called multiple times.");Il=kt.resolveURL(n),Go=H0,qn=t,w_(),r||E_()},getRTLTextPluginStatus:da,Map:class extends _P{constructor(n){if(p0.mark(ip.create),null!=(n=Yt({},wP,n)).minZoom&&null!=n.maxZoom&&n.minZoom>n.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=n.minPitch&&null!=n.maxPitch&&n.minPitch>n.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=n.minPitch&&n.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=n.maxPitch&&n.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(n.antialias&&function(t){const r=t.navigator?t.navigator.userAgent:null;return!!function(s){if(null==xe){const l=s.navigator?s.navigator.userAgent:null;xe=!!s.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return xe}(t)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(st)&&(n.antialias=!1,Q("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Tu(n.minZoom,n.maxZoom,n.minPitch,n.maxPitch,n.renderWorldCopies),n),this._interactive=n.interactive,this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._failIfMajorPerformanceCaveat=n.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=n.preserveDrawingBuffer,this._antialias=n.antialias,this._trackResize=n.trackResize,this._bearingSnap=n.bearingSnap,this._refreshExpiredTiles=n.refreshExpiredTiles,this._fadeDuration=n.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=n.crossSourceCollisions,this._collectResourceTiming=n.collectResourceTiming,this._language=this._parseLanguage(n.language),this._worldview=n.worldview,this._renderTaskQueue=new Vf,this._domRenderTaskQueue=new Vf,this._controls=[],this._markers=[],this._popups=[],this._mapId=Ti(),this._locale=Yt({},aw,n.locale),this._clickTolerance=n.clickTolerance,this._cooperativeGestures=n.cooperativeGestures,this._performanceMetricsCollection=n.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bP(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new ce(n.transformRequest,n.accessToken,n.testMode),this._silenceAuthErrors=!!n.testMode,"string"==typeof n.container){if(this._container=st.document.getElementById(n.container),!this._container)throw new Error(`Container '${n.container.toString()}' not found.`)}else{if(!(n.container instanceof st.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=n.container}if(this._container.childNodes.length>0&&Q("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),n.maxBounds&&this.setMaxBounds(n.maxBounds),Ir(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==st&&(this._fullscreenchangeEvent="onfullscreenchange"in st.document?"fullscreenchange":"webkitfullscreenchange",st.addEventListener("online",this._onWindowOnline,!1),st.addEventListener("resize",this._onWindowResize,!1),st.addEventListener("orientationchange",this._onWindowResize,!1),st.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),st.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new gP(this,n),this._localFontFamily=n.localFontFamily,this._localIdeographFontFamily=n.localIdeographFontFamily,(n.style||!n.testMode)&&this.setStyle(n.style||$e.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),n.projection&&this.setProjection(n.projection),n.hash&&(this._hash=new qT("string"==typeof n.hash&&n.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch});const t=n.bounds;t&&(this.resize(),this.fitBounds(t,Yt({},n.fitBoundsOptions,{duration:0})))}this.resize(),n.attributionControl&&this.addControl(new yP({customAttribution:n.customAttribution})),this._logoControl=new rD,this.addControl(this._logoControl,n.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new St(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new St(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(n,t){if(void 0===t&&(t=n.getDefaultPosition?n.getDefaultPosition():"top-right"),!n||!n.onAdd)return this.fire(new at(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=n.onAdd(this);this._controls.push(n);const s=this._controlPositions[t];return-1!==t.indexOf("bottom")?s.insertBefore(r,s.firstChild):s.appendChild(r),this}removeControl(n){if(!n||!n.onRemove)return this.fire(new at(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(n);return t>-1&&this._controls.splice(t,1),n.onRemove(this),this}hasControl(n){return this._controls.indexOf(n)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(n){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new St("movestart",n)).fire(new St("move",n)),this.fire(new St("resize",n)),t&&this.fire(new St("moveend",n)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(n){return this.transform.setMaxBounds(qs.convert(n)),this._update()}setMinZoom(n){if((n=n??-2)>=-2&&n<=this.transform.maxZoom)return this.transform.minZoom=n,this._update(),this.getZoom()<n?this.setZoom(n):this.fire(new St("zoomstart")).fire(new St("zoom")).fire(new St("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(n){if((n=n??22)>=this.transform.minZoom)return this.transform.maxZoom=n,this._update(),this.getZoom()>n?this.setZoom(n):this.fire(new St("zoomstart")).fire(new St("zoom")).fire(new St("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(n){if((n=n??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(n>=0&&n<=this.transform.maxPitch)return this.transform.minPitch=n,this._update(),this.getPitch()<n?this.setPitch(n):this.fire(new St("pitchstart")).fire(new St("pitch")).fire(new St("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(n){if((n=n??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(n>=this.transform.minPitch)return this.transform.maxPitch=n,this._update(),this.getPitch()>n?this.setPitch(n):this.fire(new St("pitchstart")).fire(new St("pitch")).fire(new St("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(n){return this.transform.renderWorldCopies=n,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(n){return"auto"===n?st.navigator.language:Array.isArray(n)?0===n.length?void 0:n.map(t=>"auto"===t?st.navigator.language:t):n}setLanguage(n){const t=this._parseLanguage(n);if(!this.style||t===this._language)return this;this._language=t,this.style.clearSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(n){return this.style&&n!==this._worldview?(this._worldview=n,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(n){return this._lazyInitEmptyStyle(),n?"string"==typeof n&&(n={name:n}):n=null,this._useExplicitProjection=!!n,this._prioritizeAndUpdateProjection(n,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const n=this.transform,t=n.projection.name;let r;"globe"===t&&n.zoom>=mu?(n.setMercatorFromTransition(),r=!0):"mercator"===t&&n.zoom<mu&&(n.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(n,t){return this._updateProjection(n||t||{name:"mercator"})}_updateProjection(n){let t;return t="globe"===n.name&&this.transform.zoom>=mu?this.transform.setMercatorFromTransition():this.transform.setProjection(n),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(n){return this.transform.locationPoint3D(we.convert(n))}unproject(n){return this.transform.pointLocation3D(nt.convert(n))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(n,t,r){if("mouseenter"===n||"mouseover"===n){let s=!1;const l=d=>{const h=t.filter(m=>this.getLayer(m)),p=h.length?this.queryRenderedFeatures(d.point,{layers:h}):[];p.length?s||(s=!0,r.call(this,new Qs(n,this,d.originalEvent,{features:p}))):s=!1},c=()=>{s=!1};return{layers:new Set(t),listener:r,delegates:{mousemove:l,mouseout:c}}}if("mouseleave"===n||"mouseout"===n){let s=!1;const l=d=>{const h=t.filter(p=>this.getLayer(p));(h.length?this.queryRenderedFeatures(d.point,{layers:h}):[]).length?s=!0:s&&(s=!1,r.call(this,new Qs(n,this,d.originalEvent)))},c=d=>{s&&(s=!1,r.call(this,new Qs(n,this,d.originalEvent)))};return{layers:new Set(t),listener:r,delegates:{mousemove:l,mouseout:c}}}{const s=l=>{const c=t.filter(h=>this.getLayer(h)),d=c.length?this.queryRenderedFeatures(l.point,{layers:c}):[];d.length&&(l.features=d,r.call(this,l),delete l.features)};return{layers:new Set(t),listener:r,delegates:{[n]:s}}}}on(n,t,r){if(void 0===r)return super.on(n,t);if(Array.isArray(t)||(t=[t]),t)for(const l of t)if(!this._isValidId(l))return this;const s=this._createDelegatedListener(n,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[n]=this._delegatedListeners[n]||[],this._delegatedListeners[n].push(s);for(const l in s.delegates)this.on(l,s.delegates[l]);return this}once(n,t,r){if(void 0===r)return super.once(n,t);if(Array.isArray(t)||(t=[t]),t)for(const l of t)if(!this._isValidId(l))return this;const s=this._createDelegatedListener(n,t,r);for(const l in s.delegates)this.once(l,s.delegates[l]);return this}off(n,t,r){if(void 0===r)return super.off(n,t);t=new Set(Array.isArray(t)?t:[t]);for(const c of t)if(!this._isValidId(c))return this;const s=(c,d)=>{if(c.size!==d.size)return!1;for(const h of c)if(!d.has(h))return!1;return!0},l=this._delegatedListeners?this._delegatedListeners[n]:void 0;return l&&(c=>{for(let d=0;d<c.length;d++){const h=c[d];if(h.listener===r&&s(h.layers,t)){for(const p in h.delegates)this.off(p,h.delegates[p]);return c.splice(d,1),this}}})(l),this}queryRenderedFeatures(n,t){if(!this.style)return[];if(void 0!==t||void 0===n||n instanceof nt||Array.isArray(n)||(t=n,n=void 0),n=n||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const r of t.layers)if(!this._isValidId(r))return[];return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(n,t){return this._isValidId(n)?this.style.querySourceFeatures(n,t):[]}isPointOnSurface(n){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&Q(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(nt.convert(n))}setStyle(n,t){return!1!==(t=Yt({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&n?(this._diffStyle(n,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(n,t))}_getUIString(n){const t=this._locale[n];if(null==t)throw new Error(`Missing UI string '${n}'`);return t}_updateStyle(n,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),n&&(this.style=new Js(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof n?this.style.loadURL(n):this.style.loadJSON(n)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Js(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(n,t){if("string"==typeof n){const r=this._requestManager.normalizeStyleURL(n),s=this._requestManager.transformRequest(r,gt.Style);At(s,(l,c)=>{l?this.fire(new at(l)):c&&this._updateDiff(c,t)})}else"object"==typeof n&&this._updateDiff(n,t)}_updateDiff(n,t){try{this.style.setState(n)&&this._update(!0)}catch(r){Q(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(n,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(Q("There is no style added to the map."),!1)}_isValidId(n){return!(t=n,t.indexOf("\x1f")>=0&&(this.fire(new at(new Error(`IDs can't contain special symbols: "${n}".`))),1));var t}addSource(n,t){return this._isValidId(n)?(this._lazyInitEmptyStyle(),this.style.addSource(n,t),this._update(!0)):this}isSourceLoaded(n){return!!this._isValidId(n)&&!!this.style&&this.style._isSourceCacheLoaded(n)}areTilesLoaded(){const n=this.style&&this.style._sourceCaches;for(const t in n){const r=n[t]._tiles;for(const s in r){const l=r[s];if("loaded"!==l.state&&"errored"!==l.state)return!1}}return!0}addSourceType(n,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(n,t,r)}removeSource(n){return this._isValidId(n)?(this.style.removeSource(n),this._updateTerrain(),this._update(!0)):this}getSource(n){return this._isValidId(n)?this.style.getOwnSource(n):null}addImage(n,t,{pixelRatio:r=1,sdf:s=!1,stretchX:l,stretchY:c,content:d}={}){if(this._lazyInitEmptyStyle(),t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap){const{width:h,height:p,data:m}=kt.getImageData(t);this.style.addImage(n,{data:new Pi({width:h,height:p},m),pixelRatio:r,stretchX:l,stretchY:c,content:d,sdf:s,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new at(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:h,height:p}=t,m=t;this.style.addImage(n,{data:new Pi({width:h,height:p},new Uint8Array(m.data)),pixelRatio:r,stretchX:l,stretchY:c,content:d,sdf:s,version:0,userImage:m}),m.onAdd&&m.onAdd(this,n)}}updateImage(n,t){this._lazyInitEmptyStyle();const r=this.style.getImage(n);if(!r)return void this.fire(new at(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap?kt.getImageData(t):t,{width:l,height:c}=s;void 0!==l&&void 0!==c?l===r.data.width&&c===r.data.height?(r.data.replace(s.data,!(t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap)),this.style.updateImage(n,r)):this.fire(new at(new Error(`The width and height of the updated image (${l}, ${c})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`))):this.fire(new at(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(n){return n?!!this.style&&!!this.style.getImage(n):(this.fire(new at(new Error("Missing required image id"))),!1)}removeImage(n){this.style.removeImage(n)}loadImage(n,t){Oe(this._requestManager.transformRequest(n,gt.Image),(r,s)=>{t(r,s instanceof st.HTMLImageElement?kt.getImageData(s):s)})}listImages(){return this.style.listImages()}addModel(n,t){this._lazyInitEmptyStyle(),this.style.addModel(n,t)}hasModel(n){return n?this.style.hasModel(n):(this.fire(new at(new Error("Missing required model id"))),!1)}removeModel(n){this.style.removeModel(n)}listModels(){return this.style.listModels()}addLayer(n,t){return this._isValidId(n.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(n,t),this._update(!0)):this}moveLayer(n,t){return this._isValidId(n)?(this.style.moveLayer(n,t),this._update(!0)):this}removeLayer(n){return this._isValidId(n)?(this.style.removeLayer(n),this._update(!0)):this}getLayer(n){return this._isValidId(n)?this.style.getOwnLayer(n):null}setLayerZoomRange(n,t,r){return this._isValidId(n)?(this.style.setLayerZoomRange(n,t,r),this._update(!0)):this}setFilter(n,t,r={}){return this._isValidId(n)?(this.style.setFilter(n,t,r),this._update(!0)):this}getFilter(n){return this._isValidId(n)?this.style.getFilter(n):null}setPaintProperty(n,t,r,s={}){return this._isValidId(n)?(this.style.setPaintProperty(n,t,r,s),this._update(!0)):this}getPaintProperty(n,t){return this._isValidId(n)?this.style.getPaintProperty(n,t):null}setLayoutProperty(n,t,r,s={}){return this._isValidId(n)?(this.style.setLayoutProperty(n,t,r,s),this._update(!0)):this}getLayoutProperty(n,t){return this._isValidId(n)?this.style.getLayoutProperty(n,t):null}setConfigProperty(n,t,r){return this.style.setConfigProperty(n,t,r),this._update(!0)}setLights(n){if(this._lazyInitEmptyStyle(),n&&1===n.length&&"flat"===n[0].type){const t=n[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(n),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const n=this.style.getLights()||[];return 0===n.length&&n.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),n}setLight(n,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:n}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(n){return this._lazyInitEmptyStyle(),!n&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(n),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(n){return this._lazyInitEmptyStyle(),this.style.setFog(n),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(n){return this.style.setCamera(n),this._triggerCameraUpdate(n)}_triggerCameraUpdate(n){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===n["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(n){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(we.convert(n),this.transform):0}setFeatureState(n,t){return this._isValidId(n.source)?(this.style.setFeatureState(n,t),this._update()):this}removeFeatureState(n,t){return this._isValidId(n.source)?(this.style.removeFeatureState(n,t),this._update()):this}getFeatureState(n){return this._isValidId(n.source)?this.style.getFeatureState(n):null}_updateContainerDimensions(){if(!this._container)return;const n=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,s,l,c=this._container;for(;c&&(!s||!l);){const d=st.getComputedStyle(c).transform;d&&"none"!==d&&(r=d.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(s=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(l=r[3])),c=c.parentElement}this._containerWidth=s?Math.abs(n/s):n,this._containerHeight=l?Math.abs(t/l):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==st.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&Q("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const n=this._container;n.classList.add("mapboxgl-map"),(this._missingCSSCanary=zn("div","mapboxgl-canary",n)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=zn("div","mapboxgl-canvas-container",n);this._canvas=zn("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=zn("div","mapboxgl-control-container",n),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(l=>{s[l]=zn("div",`mapboxgl-ctrl-${l}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(n,t){const r=kt.devicePixelRatio||1;this._canvas.width=r*Math.ceil(n),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${n}px`,this._canvas.style.height=`${t}px`}_addMarker(n){this._markers.push(n)}_removeMarker(n){const t=this._markers.indexOf(n);-1!==t&&this._markers.splice(t,1)}_addPopup(n){this._popups.push(n)}_removePopup(n){const t=this._popups.indexOf(n);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const n=Yt({},lE.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",n);t?(sE(t,!0),this.painter=new H1(t,this.transform),this.on("data",r=>{"source"===r.dataType&&this.painter.setTileLoadedFlag(!0)}),Ns.testSupport(t)):this.fire(new at(new Error("Failed to initialize WebGL")))}_contextLost(n){n.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new St("webglcontextlost",{originalEvent:n}))}_contextRestored(n){this._setupPainter(),this.resize(),this._update(),this.fire(new St("webglcontextrestored",{originalEvent:n}))}_onMapScroll(n){if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(n){return this.style?(this._styleDirty=this._styleDirty||n,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(n){return this._update(),this._renderTaskQueue.add(n)}_cancelRenderFrame(n){this._renderTaskQueue.remove(n)}_requestDomTask(n){!this.loaded()||this.loaded()&&!this.isMoving()?n():this._domRenderTaskQueue.add(n)}_render(n){let t;this.fire(new St("renderstart"));const r=this.painter.context.extTimerQuery,s=kt.now(),l=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=l.createQuery(),l.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],st.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],st.performance.now())),this._renderTaskQueue.run(n),this._domRenderTaskQueue.run(n),this._removed)return;this._updateProjectionTransition();const c=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,m=this.transform.pitch,_=kt.now(),y=new wi(p,{now:_,fadeDuration:c,pitch:m,transition:this.style.transition});this.style.update(y)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let d=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),d=this._updateAverageElevation(s),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):d=this._updateAverageElevation(s),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,c,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:c,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new St("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new St("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const p=kt.now()-s;l.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const m=l.getQueryParameter(t,l.QUERY_RESULT)/1e6;l.deleteQuery(t),this.fire(new St("gpu-timing-frame",{cpuTime:p,gpuTime:m})),st.performance.mark("frame-gpu",{startTime:s,detail:{gpuTime:m}})},50)}if(this.listens("gpu-timing-layer")){const p=this.painter.collectGpuTimers();setTimeout(()=>{const m=this.painter.queryGpuTimers(p);this.fire(new St("gpu-timing-layer",{layerTimes:m}))},50)}if(this.listens("gpu-timing-deferred-render")){const p=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const m=this.painter.queryGpuTimeDeferredRender(p);this.fire(new St("gpu-timing-deferred-render",{gpuTime:m}))},50)}const h=this._sourcesDirty||this._styleDirty||this._placementDirty||d;if(h||this._repaint)this.triggerRepaint();else{const p=!this.isMoving()&&this.loaded();if(p&&(d=this._updateAverageElevation(s,!0)),d)this.triggerRepaint();else if(this._triggerFrame(!1),p&&(this.fire(new St("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const m=this._calculateSpeedIndex();this.fire(new St("speedindexcompleted",{speedIndex:m})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,p0.mark(ip.fullLoad),this._performanceMetricsCollection&&rE(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(n){for(const t of this._markers)n&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!n||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(n,t=!1){const r=l=>(this.transform.averageElevation=l,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const s=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(s||(t||n-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(n)){const l=this.transform.averageElevation;let c=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(c)?c=0:this._averageElevationLastSampledAt=n;const d=Math.abs(l-c);if(d>1){if(this._isInitialLoad||s)return this._averageElevation.jumpTo(c),r(c);this._averageElevation.easeTo(c,n,300)}else if(d>1e-4)return this._averageElevation.jumpTo(c),r(c)}return!!this._averageElevation.isEasing(n)&&r(this._averageElevation.getValue(n))}_authenticate(){oE(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,n=>{if(n&&(n.message===Rn||401===n.status)){const t=this.painter.context.gl;sE(t,!1),this._logoControl instanceof rD&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new at(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),fF(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const n=this._isDragging();this.painter.updateTerrain(this.style,n)}_calculateSpeedIndex(){const n=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,s=r.createFramebuffer();function l(c){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,c,0);const d=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,d),d}return r.bindFramebuffer(r.FRAMEBUFFER,s),this._canvasPixelComparison(l(n),t.canvasCopies.map(l),t.timeStamps)}_canvasPixelComparison(n,t,r){let s=r[1]-r[0];const l=n.length/4;for(let c=0;c<t.length;c++){const d=t[c];let h=0;for(let p=0;p<d.length;p+=4)d[p]===n[p]&&d[p+1]===n[p+1]&&d[p+2]===n[p+2]&&d[p+3]===n[p+3]&&(h+=1);s+=(r[c+2]-r[c+1])*(1-h/l)}return s}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==st&&(st.removeEventListener("resize",this._onWindowResize,!1),st.removeEventListener("orientationchange",this._onWindowResize,!1),st.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),st.removeEventListener("online",this._onWindowOnline,!1),st.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),nu.delete(this.painter.context.gl),this._removed=!0,this.fire(new St("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(n){this._renderNextFrame=this._renderNextFrame||n,this.style&&!this._frame&&(this._frame=kt.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(n){return Zu(this.style?Object.values(this.style._sourceCaches):[],(t,r)=>t._preloadTiles(n,r),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(n){this._trackResize&&this.resize({originalEvent:n})._update()}_onVisibilityChange(){"hidden"===st.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(n){this._showTileBoundaries!==n&&(this._showTileBoundaries=n,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(n){this._showTerrainWireframe!==n&&(this._showTerrainWireframe=n,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(n){this._showLayers2DWireframe!==n&&(this._showLayers2DWireframe=n,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(n){this._showLayers3DWireframe!==n&&(this._showLayers3DWireframe=n,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(n){this._speedIndexTiming!==n&&(this._speedIndexTiming=n,this._update())}get showPadding(){return!!this._showPadding}set showPadding(n){this._showPadding!==n&&(this._showPadding=n,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(n){this._showCollisionBoxes!==n&&(this._showCollisionBoxes=n,n?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(n){this._showOverdrawInspector!==n&&(this._showOverdrawInspector=n,this._update())}get repaint(){return!!this._repaint}set repaint(n){this._repaint!==n&&(this._repaint=n,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(n){this._vertices=n,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(n){this._showTileAABBs!==n&&(this._showTileAABBs=n,n&&this._update())}_setCacheLimits(n,t){Co=n,zo=t}get version(){return Ta}},NavigationControl:class{constructor(n){this.options=Yt({},EP,n),this._container=zn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(Ir(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),zn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),zn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Ir(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=zn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const n=this._map;if(!n)return;const t=n.getZoom(),r=t===n.getMaxZoom(),s=t===n.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const n=this._map;if(!n)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(n.transform.pitch*(Math.PI/180)),.5)}) rotateX(${n.transform.pitch}deg) rotateZ(${n.transform.angle*(180/Math.PI)}deg)`:`rotate(${n.transform.angle*(180/Math.PI)}deg)`;n._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),n.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&n.on("pitch",this._rotateCompassArrow),n.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new CP(n,this._compass,this.options.visualizePitch)),this._container}onRemove(){const n=this._map;n&&(this._container.remove(),this.options.showZoom&&n.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&n.off("pitch",this._rotateCompassArrow),n.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(n,t){const r=zn("button",n,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(n,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);n.setAttribute("aria-label",r),n.firstElementChild&&n.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends $i{constructor(n){super(),this.options=Yt({geolocation:st.navigator.geolocation},MP,n),Ir(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=oP(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(n){return this._map=n,this._container=zn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(n){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,n(r)};void 0!==this._supportsGeolocation?n(this._supportsGeolocation):void 0!==st.navigator.permissions?st.navigator.permissions.query({name:"geolocation"}).then(r=>t("denied"!==r.state)).catch(()=>t()):t()}_isOutOfMapMaxBounds(n){const t=this._map.getMaxBounds(),r=n.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(n){if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new St("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(n),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(n),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new St("geolocate",n)),this._finish()}}_updateCamera(n){const t=new we(n.coords.longitude,n.coords.latitude),r=n.coords.accuracy,s=Yt({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),s,{geolocateSource:!0})}_updateMarker(n){if(n){const t=new we(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const n=this._map.transform,t=Ln(1,n._center.lat)*n.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(n){if(this._map){if(this.options.trackUserLocation)if(1===n.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===n.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new St("error",n)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(n){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=zn("button","mapboxgl-ctrl-geolocate",this._container),zn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===n){Q("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=zn("div","mapboxgl-user-location"),this._dotElement.appendChild(zn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(zn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sw({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=zn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sw({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new St("trackuserlocationend")))})}}_onDeviceOrientation(n){this._userLocationDotMarker&&(n.webkitCompassHeading?this._heading=n.webkitCompassHeading:!0===n.absolute&&(this._heading=-1*n.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return Q("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new St("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new St("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new St("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let n;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(n={maximumAge:6e5,timeout:0},this._noTimeout=!0):(n=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,n),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const n=()=>{st.addEventListener("ondeviceorientationabsolute"in st?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==st.DeviceMotionEvent&&"function"==typeof st.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&n()}).catch(console.error):n()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),st.removeEventListener("deviceorientation",this._onDeviceOrientation),st.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yP,ScaleControl:class{constructor(n){this.options=Yt({},SP,n),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Ir(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const n=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,s=t._containerWidth/2-n/2,l=t.unproject([s,r]),c=t.unproject([s+n,r]),d=l.distanceTo(c);if("imperial"===this.options.unit){const h=3.2808*d;h>5280?this._setScale(n,h/5280,"mile"):this._setScale(n,h,"foot")}else"nautical"===this.options.unit?this._setScale(n,d/1852,"nautical-mile"):d>=1e3?this._setScale(n,d/1e3,"kilometer"):this._setScale(n,d,"meter")}_setScale(n,t,r){this._map._requestDomTask(()=>{const s=function(c){const d=Math.pow(10,`${Math.floor(c)}`.length-1);let h=c/d;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(p){const m=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*m)/m}(h),d*h}(t),l=s/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(s):`${s}&nbsp;${TP[r]}`,this._container.style.width=n*l+"px"})}onAdd(n){return this._map=n,this._language=n.getLanguage(),this._container=zn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(n){this._language=n,this._update()}setUnit(n){this.options.unit=n,this._update()}},FullscreenControl:class{constructor(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof st.HTMLElement?this._container=n.container:Q("Full screen control 'container' must be a DOM element.")),Ir(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in st.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in st.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=zn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",Q("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,st.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!st.document.fullscreenEnabled&&!st.document.webkitFullscreenEnabled)}_setupUI(){const n=this._fullscreenButton=zn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);zn("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),st.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",n)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(st.document.fullscreenElement||st.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?st.document.exitFullscreen?st.document.exitFullscreen():st.document.webkitCancelFullScreen&&st.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends $i{constructor(n){super(),this.options=Yt(Object.create(vP),n),Ir(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(n&&n.className?n.className.trim().split(/\s+/):[])}addTo(n){return this._map&&this.remove(),this._map=n,this.options.closeOnClick&&n.on("preclick",this._onClose),this.options.closeOnMove&&n.on("move",this._onClose),n.on("remove",this.remove),this._update(),n._addPopup(this),this._focusFirstElement(),this._trackPointer?(n.on("mousemove",this._onMouseEvent),n.on("mouseup",this._onMouseEvent),n._canvasContainer.classList.add("mapboxgl-track-pointer")):n.on("move",this._update),this.fire(new St("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const n=this._map;return n&&(n.off("move",this._update),n.off("move",this._onClose),n.off("preclick",this._onClose),n.off("click",this._onClose),n.off("remove",this.remove),n.off("mousemove",this._onMouseEvent),n.off("mouseup",this._onMouseEvent),n.off("drag",this._onMouseEvent),n._canvasContainer&&n._canvasContainer.classList.remove("mapboxgl-track-pointer"),n._removePopup(this),this._map=void 0),this.fire(new St("close")),this}getLngLat(){return this._lngLat}setLngLat(n){this._lngLat=we.convert(n),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const n=this._map;return n&&(n.off("move",this._update),n.on("mousemove",this._onMouseEvent),n.on("drag",this._onMouseEvent),n._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(n){return this.setDOMContent(st.document.createTextNode(n))}setHTML(n){const t=st.document.createDocumentFragment(),r=st.document.createElement("body");let s;for(r.innerHTML=n;s=r.firstChild,s;)t.appendChild(s);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(n){return this.options.maxWidth=n,this._update(),this}setDOMContent(n){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=zn("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(n),this.options.closeButton){const r=this._closeButton=zn("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.setAttribute("aria-hidden","true"),r.innerHTML="&#215;",r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(n){return this._classList.add(n),this._updateClassList(),this}removeClassName(n){return this._classList.delete(n),this._updateClassList(),this}setOffset(n){return this.options.offset=n,this._update(),this}toggleClassName(n){let t;return this._classList.delete(n)?t=!1:(this._classList.add(n),t=!0),this._updateClassList(),t}_onMouseEvent(n){this._update(n.point)}_getAnchor(n){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,s=this._pos;if(!t||!r||!s)return"bottom";const l=r.offsetWidth,c=r.offsetHeight,d=s.x<l/2,h=s.x>t.transform.width-l/2;if(s.y+n<c)return d?"top-left":h?"top-right":"top";if(s.y>t.transform.height-c){if(d)return"bottom-left";if(h)return"bottom-right"}return d?"left":h?"right":"bottom"}_updateClassList(){const n=this._container;if(!n)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),n.className=t.join(" ")}_update(n){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let s=this._container;if(s||(s=this._container=zn("div","mapboxgl-popup",t.getContainer()),this._tip=zn("div","mapboxgl-popup-tip",s),s.appendChild(r)),this.options.maxWidth&&s.style.maxWidth!==this.options.maxWidth&&(s.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mg(this._lngLat,this._pos,t.transform)),!this._trackPointer||n){const l=this._pos=this._trackPointer&&n?n:t.project(this._lngLat),c=oD(this.options.offset),d=this._anchor=this._getAnchor(c.y),h=oD(this.options.offset,d),p=l.add(h).round();t._requestDomTask(()=>{this._container&&d&&(this._container.style.transform=`${ow[d]} translate(${p.x}px,${p.y}px)`)})}if(!this._marker&&t._showingGlobe()){const l=ey(t.transform,this._lngLat)?0:1;this._setOpacity(l)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const n=this._container.querySelector(xP);n&&n.focus()}_onClose(){this.remove()}_setOpacity(n){this._container&&(this._container.style.opacity=`${n}`),this._content&&(this._content.style.pointerEvents=n?"auto":"none")}},Marker:sw,Style:Js,LngLat:we,LngLatBounds:qs,Point:nt,MercatorCoordinate:Ke,FreeCameraOptions:Lm,Evented:$i,config:$e,prewarm:function(){Tf().acquire(nv)},clearPrewarmedResources:function(){const n=Jm;n&&(n.isPreloaded()&&1===n.numActive()?(n.release(nv),Jm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return $e.ACCESS_TOKEN},set accessToken(n){$e.ACCESS_TOKEN=n},get baseApiUrl(){return $e.API_URL},set baseApiUrl(n){$e.API_URL=n},get workerCount(){return Pd.workerCount},set workerCount(n){Pd.workerCount=n},get maxParallelImageRequests(){return $e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){$e.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage(n){!function(t){if(!Qd())return;const r=st.caches.delete(ii);t&&r.catch(t).then(()=>t())}(n)},workerUrl:"",workerClass:null,get dracoUrl(){return XS()},set dracoUrl(n){iv=kt.resolveURL(n),a1||(a1=new Xm(Tf(),new $i)),a1.broadcast("setDracoUrl",iv)},setNow:kt.setNow,restoreNow:kt.restoreNow};Qt.A=Zm,Qt.D=va,Qt.E=dt,Qt.F=mb,Qt.K=uv,Qt.O=tn,Qt.P=nt,Qt.T=z2,Qt.V=pm,Qt.a=fy,Qt.b=hM,Qt.c=tv,Qt.d=class extends $i{constructor(n,t,r,s,l,c){super(),this.actor=n,this.layerIndex=t,this.availableImages=r,this.loadVectorData=l||ZS,this.loading={},this.loaded={},this.deduped=new Rd(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler,this.brightness=c}loadTile(n,t){const r=n.uid,s=n&&n.request,l=s&&s.collectResourceTiming,c=this.loading[r]=new sR(n);c.abort=this.loadVectorData(n,(d,h)=>{const p=!this.loading[r];if(delete this.loading[r],p||d||!h)return c.status="done",p||(this.loaded[r]=c),t(d);const m=h.rawData,_={};h.expires&&(_.expires=h.expires),h.cacheControl&&(_.cacheControl=h.cacheControl),c.vectorTile=h.vectorTile||new fm(new Je(m));const y=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(v,b)=>{if(v||!b)return t(v);const E={};if(l){const C=aE(s);C.length>0&&(E.resourceTiming=JSON.parse(JSON.stringify(C)))}t(null,Yt({rawTileData:m.slice(0)},b,_,E))})};this.isSpriteLoaded?y():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(y,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):y()}),this.loaded=this.loaded||{},this.loaded[r]=c})}reloadTile(n,t){const r=this.loaded,s=n.uid,l=this;if(r&&r[s]){const c=r[s];c.showCollisionBoxes=n.showCollisionBoxes,c.projection=n.projection,c.brightness=n.brightness,c.tileTransform=Mu(n.tileID.canonical,n.projection),c.extraShadowCaster=n.extraShadowCaster;const d=(h,p)=>{const m=c.reloadCallback;m&&(delete c.reloadCallback,c.parse(c.vectorTile,l.layerIndex,this.availableImages,l.actor,m)),t(h,p)};"parsing"===c.status?c.reloadCallback=d:"done"===c.status&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,d):d())}}abortTile(n,t){const r=n.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),t()}removeTile(n,t){const r=this.loaded,s=n.uid;r&&r[s]&&delete r[s],t()}},Qt.e=mc,Qt.f=aE,Qt.g=hs,Qt.h=At,Qt.i=zt,Qt.j=function(n,t){const r=nT(n);for(const s of r){for(const l of s.meshes)$F(l);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(iT(s.lights,t)))}return r},Qt.k=wi,Qt.l=function(n){let t=0;if(new Uint32Array(n,0,1)[0]!==d1){const r=new Uint32Array(n,0,7),[,,s,l,c,d]=r;t=r.byteLength+l+c+d+c,(s!==n.byteLength||t>=n.byteLength)&&Q("Invalid b3dm header information.")}return QS(n,t)},Qt.m=Tm,Qt.n=vs,Qt.o=St,Qt.p=Xc,Qt.q=function(n){fs(),es&&es.then(t=>{t.keys().then(r=>{for(let s=0;s<r.length-n;s++)t.delete(r[s])})})},Qt.r=sT,Qt.s=Iv,Qt.t=bd,Qt.v=xn,Qt.w=st}),ep(0,function(Qt){function st(Pt){if("number"==typeof Pt||"boolean"==typeof Pt||"string"==typeof Pt||null==Pt)return JSON.stringify(Pt);if(Array.isArray(Pt)){let W="[";for(const Q of Pt)W+=`${st(Q)},`;return`${W}]`}let $="{";for(const W of Object.keys(Pt).sort())$+=`${W}:${st(Pt[W])},`;return`${$}}`}function Ta(Pt){let $="";for(const W of Qt.r)$+=`/${st(Pt[W])}`;return $}class pl{constructor($){this.keyCache={},$&&this.replace($)}replace($,W){this._layerConfigs={},this._layers={},this.update($,[],W)}update($,W,Q){this._options=Q;for(const Mt of $){this._layerConfigs[Mt.id]=Mt;const qt=this._layers[Mt.id]=Qt.c(Mt,this._options);qt.setScope(this.scope),qt.compileFilter(),this.keyCache[Mt.id]&&delete this.keyCache[Mt.id]}for(const Mt of W)delete this.keyCache[Mt],delete this._layerConfigs[Mt],delete this._layers[Mt];this.familiesBySource={};const wt=function(Mt,qt){const te={};for(let ae=0;ae<Mt.length;ae++){const xe=qt&&qt[Mt[ae].id]||Ta(Mt[ae]);qt&&(qt[Mt[ae].id]=xe);let be=te[xe];be||(be=te[xe]=[]),be.push(Mt[ae])}const Ct=[];for(const ae in te)Ct.push(te[ae]);return Ct}(Qt.v(this._layerConfigs),this.keyCache);for(const Mt of wt){const qt=Mt.map(Yn=>this._layers[Yn.id]),te=qt[0];if("none"===te.visibility)continue;const Ct=te.source||"";let ae=this.familiesBySource[Ct];ae||(ae=this.familiesBySource[Ct]={});const xe=te.sourceLayer||"_geojsonTileLayer";let be=ae[xe];be||(be=ae[xe]=[]),be.push(qt)}}}class $e{loadTile($,W){const{uid:Q,encoding:wt,rawImageData:Mt,padding:qt}=$,te=Qt.w.ImageBitmap&&Mt instanceof Qt.w.ImageBitmap?this.getImageData(Mt,qt):Mt;W(null,new Qt.D(Q,te,wt,$.convertToFloat,qt<1))}getImageData($,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);const Q=this.offscreenCanvasContext.getImageData(-W,-W,$.width+2*W,$.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Q}}function Ns(Pt,$){if(0!==Pt.length){Da(Pt[0],$);for(var W=1;W<Pt.length;W++)Da(Pt[W],!$)}}function Da(Pt,$){for(var W=0,Q=0,wt=0,Mt=Pt.length,qt=Mt-1;wt<Mt;qt=wt++){var te=(Pt[wt][0]-Pt[qt][0])*(Pt[qt][1]+Pt[wt][1]),Ct=W+te;Q+=Math.abs(W)>=Math.abs(te)?W-Ct+te:te-Ct+W,W=Ct}W+Q>=0!=!!$&&Pt.reverse()}var lc=Qt.g(function Pt($,W){var Q,wt=$&&$.type;if("FeatureCollection"===wt)for(Q=0;Q<$.features.length;Q++)Pt($.features[Q],W);else if("GeometryCollection"===wt)for(Q=0;Q<$.geometries.length;Q++)Pt($.geometries[Q],W);else if("Feature"===wt)Pt($.geometry,W);else if("Polygon"===wt)Ns($.coordinates,W);else if("MultiPolygon"===wt)for(Q=0;Q<$.coordinates.length;Q++)Ns($.coordinates[Q],W);return $});const Gu=Qt.V.prototype.toGeoJSON;var Zc={exports:{}},Ng=Qt.p,np=Qt.a.VectorTileFeature,hs=ml;function ml(Pt,$){this.options=$||{},this.features=Pt,this.length=Pt.length}function gl(Pt,$){this.id="number"==typeof Pt.id?Pt.id:void 0,this.type=Pt.type,this.rawGeometry=1===Pt.type?[Pt.geometry]:Pt.geometry,this.properties=Pt.tags,this.extent=$||4096}ml.prototype.feature=function(Pt){return new gl(this.features[Pt],this.options.extent)},gl.prototype.loadGeometry=function(){var Pt=this.rawGeometry;this.geometry=[];for(var $=0;$<Pt.length;$++){for(var W=Pt[$],Q=[],wt=0;wt<W.length;wt++)Q.push(new Ng(W[wt][0],W[wt][1]));this.geometry.push(Q)}return this.geometry},gl.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Pt=this.geometry,$=1/0,W=-1/0,Q=1/0,wt=-1/0,Mt=0;Mt<Pt.length;Mt++)for(var qt=Pt[Mt],te=0;te<qt.length;te++){var Ct=qt[te];$=Math.min($,Ct.x),W=Math.max(W,Ct.x),Q=Math.min(Q,Ct.y),wt=Math.max(wt,Ct.y)}return[$,Q,W,wt]},gl.prototype.toGeoJSON=np.prototype.toGeoJSON;var zg=Qt.b,Xc=hs;function _l(Pt){var $=new zg;return function(W,Q){for(var wt in W.layers)Q.writeMessage(3,nt,W.layers[wt])}(Pt,$),$.finish()}function nt(Pt,$){var W;$.writeVarintField(15,Pt.version||1),$.writeStringField(1,Pt.name||""),$.writeVarintField(5,Pt.extent||4096);var Q={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<Pt.length;W++)Q.feature=Pt.feature(W),$.writeMessage(2,ln,Q);var wt=Q.keys;for(W=0;W<wt.length;W++)$.writeStringField(3,wt[W]);var Mt=Q.values;for(W=0;W<Mt.length;W++)$.writeMessage(4,f0,Mt[W])}function ln(Pt,$){var W=Pt.feature;void 0!==W.id&&$.writeVarintField(1,W.id),$.writeMessage(2,qu,Pt),$.writeVarintField(3,W.type),$.writeMessage(4,Er,W)}function qu(Pt,$){var W=Pt.feature,Q=Pt.keys,wt=Pt.values,Mt=Pt.keycache,qt=Pt.valuecache;for(var te in W.properties){var Ct=W.properties[te],ae=Mt[te];if(null!==Ct){void 0===ae&&(Q.push(te),Mt[te]=ae=Q.length-1),$.writeVarint(ae);var xe=typeof Ct;"string"!==xe&&"boolean"!==xe&&"number"!==xe&&(Ct=JSON.stringify(Ct));var be=xe+":"+Ct,Yn=qt[be];void 0===Yn&&(wt.push(Ct),qt[be]=Yn=wt.length-1),$.writeVarint(Yn)}}}function yl(Pt,$){return($<<3)+(7&Pt)}function Ie(Pt){return Pt<<1^Pt>>31}function Er(Pt,$){for(var W=Pt.loadGeometry(),Q=Pt.type,wt=0,Mt=0,qt=W.length,te=0;te<qt;te++){var Ct=W[te],ae=1;1===Q&&(ae=Ct.length),$.writeVarint(yl(1,ae));for(var xe=3===Q?Ct.length-1:Ct.length,be=0;be<xe;be++){1===be&&1!==Q&&$.writeVarint(yl(2,xe-1));var Yn=Ct[be].x-wt,Ni=Ct[be].y-Mt;$.writeVarint(Ie(Yn)),$.writeVarint(Ie(Ni)),wt+=Yn,Mt+=Ni}3===Q&&$.writeVarint(yl(7,1))}}function f0(Pt,$){var W=typeof Pt;"string"===W?$.writeStringField(1,Pt):"boolean"===W?$.writeBooleanField(7,Pt):"number"===W&&(Pt%1!=0?$.writeDoubleField(3,Pt):Pt<0?$.writeSVarintField(6,Pt):$.writeVarintField(5,Pt))}Zc.exports=_l,Zc.exports.fromVectorTileJs=_l,Zc.exports.fromGeojsonVt=function(Pt,$){$=$||{};var W={};for(var Q in Pt)W[Q]=new Xc(Pt[Q].features,$),W[Q].name=Q,W[Q].version=$.version,W[Q].extent=$.extent;return _l({layers:W})},Zc.exports.GeoJSONWrapper=Xc;var Yc=Qt.g(Zc.exports);const vl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pt=>Pt},Wu=Math.fround||(Kc=new Float32Array(1),Pt=>(Kc[0]=+Pt,Kc[0]));var Kc;const $n=3,Jt=5,xl=6;class bl{constructor($){this.options=Object.assign(Object.create(vl),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:W,minZoom:Q,maxZoom:wt}=this.options;W&&console.time("total time");const Mt=`prepare ${$.length} points`;W&&console.time(Mt),this.points=$;const qt=[];for(let Ct=0;Ct<$.length;Ct++){const ae=$[Ct];if(!ae.geometry)continue;const[xe,be]=ae.geometry.coordinates,Yn=Wu(Yt(xe)),Ni=Wu(ts(be));qt.push(Yn,Ni,1/0,Ct,-1,1),this.options.reduce&&qt.push(0)}let te=this.trees[wt+1]=this._createTree(qt);W&&console.timeEnd(Mt);for(let Ct=wt;Ct>=Q;Ct--){const ae=+Date.now();te=this.trees[Ct]=this._createTree(this._cluster(te,Ct)),W&&console.log("z%d: %d clusters in %dms",Ct,te.numItems,+Date.now()-ae)}return W&&console.timeEnd("total time"),this}getClusters($,W){let Q=(($[0]+180)%360+360)%360-180;const wt=Math.max(-90,Math.min(90,$[1]));let Mt=180===$[2]?180:(($[2]+180)%360+360)%360-180;const qt=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)Q=-180,Mt=180;else if(Q>Mt){const be=this.getClusters([Q,wt,180,qt],W),Yn=this.getClusters([-180,wt,Mt,qt],W);return be.concat(Yn)}const te=this.trees[this._limitZoom(W)],Ct=te.range(Yt(Q),ts(qt),Yt(Mt),ts(wt)),ae=te.data,xe=[];for(const be of Ct){const Yn=this.stride*be;xe.push(ae[Yn+Jt]>1?Zu(ae,Yn,this.clusterProps):this.points[ae[Yn+$n]])}return xe}getChildren($){const W=this._getOriginId($),Q=this._getOriginZoom($),wt="No cluster with the specified id.",Mt=this.trees[Q];if(!Mt)throw new Error(wt);const qt=Mt.data;if(W*this.stride>=qt.length)throw new Error(wt);const te=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),Ct=Mt.within(qt[W*this.stride],qt[W*this.stride+1],te),ae=[];for(const xe of Ct){const be=xe*this.stride;qt[be+4]===$&&ae.push(qt[be+Jt]>1?Zu(qt,be,this.clusterProps):this.points[qt[be+$n]])}if(0===ae.length)throw new Error(wt);return ae}getLeaves($,W,Q){const wt=[];return this._appendLeaves(wt,$,W=W||10,Q=Q||0,0),wt}getTile($,W,Q){const wt=this.trees[this._limitZoom($)],Mt=Math.pow(2,$),{extent:qt,radius:te}=this.options,Ct=te/qt,ae=(Q-Ct)/Mt,xe=(Q+1+Ct)/Mt,be={features:[]};return this._addTileFeatures(wt.range((W-Ct)/Mt,ae,(W+1+Ct)/Mt,xe),wt.data,W,Q,Mt,be),0===W&&this._addTileFeatures(wt.range(1-Ct/Mt,ae,1,xe),wt.data,Mt,Q,Mt,be),W===Mt-1&&this._addTileFeatures(wt.range(0,ae,Ct/Mt,xe),wt.data,-1,Q,Mt,be),be.features.length?be:null}getClusterExpansionZoom($){let W=this._getOriginZoom($)-1;for(;W<=this.options.maxZoom;){const Q=this.getChildren($);if(W++,1!==Q.length)break;$=Q[0].properties.cluster_id}return W}_appendLeaves($,W,Q,wt,Mt){const qt=this.getChildren(W);for(const te of qt){const Ct=te.properties;if(Ct&&Ct.cluster?Mt+Ct.point_count<=wt?Mt+=Ct.point_count:Mt=this._appendLeaves($,Ct.cluster_id,Q,wt,Mt):Mt<wt?Mt++:$.push(te),$.length===Q)break}return Mt}_createTree($){const W=new Qt.K($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<$.length;Q+=this.stride)W.add($[Q],$[Q+1]);return W.finish(),W.data=$,W}_addTileFeatures($,W,Q,wt,Mt,qt){for(const te of $){const Ct=te*this.stride,ae=W[Ct+Jt]>1;let xe,be,Yn;if(ae)xe=xn(W,Ct,this.clusterProps),be=W[Ct],Yn=W[Ct+1];else{const zi=this.points[W[Ct+$n]];xe=zi.properties;const[ni,ii]=zi.geometry.coordinates;be=Yt(ni),Yn=ts(ii)}const Ni={type:1,geometry:[[Math.round(this.options.extent*(be*Mt-Q)),Math.round(this.options.extent*(Yn*Mt-wt))]],tags:xe};let zr;zr=ae||this.options.generateId?W[Ct+$n]:this.points[W[Ct+$n]].id,void 0!==zr&&(Ni.id=zr),qt.features.push(Ni)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,W){const{radius:Q,extent:wt,reduce:Mt,minPoints:qt}=this.options,te=Q/(wt*Math.pow(2,W)),Ct=$.data,ae=[],xe=this.stride;for(let be=0;be<Ct.length;be+=xe){if(Ct[be+2]<=W)continue;Ct[be+2]=W;const Yn=Ct[be],Ni=Ct[be+1],zr=$.within(Ct[be],Ct[be+1],te),zi=Ct[be+Jt];let ni=zi;for(const ii of zr){const Co=ii*xe;Ct[Co+2]>W&&(ni+=Ct[Co+Jt])}if(ni>zi&&ni>=qt){let ii,Co=Yn*zi,zo=Ni*zi,es=-1;const Ia=((be/xe|0)<<5)+(W+1)+this.points.length;for(const Qd of zr){const fs=Qd*xe;if(Ct[fs+2]<=W)continue;Ct[fs+2]=W;const cc=Ct[fs+Jt];Co+=Ct[fs]*cc,zo+=Ct[fs+1]*cc,Ct[fs+4]=Ia,Mt&&(ii||(ii=this._map(Ct,be,!0),es=this.clusterProps.length,this.clusterProps.push(ii)),Mt(ii,this._map(Ct,fs)))}Ct[be+4]=Ia,ae.push(Co/ni,zo/ni,1/0,Ia,-1,ni),Mt&&ae.push(es)}else{for(let ii=0;ii<xe;ii++)ae.push(Ct[be+ii]);if(ni>1)for(const ii of zr){const Co=ii*xe;if(!(Ct[Co+2]<=W)){Ct[Co+2]=W;for(let zo=0;zo<xe;zo++)ae.push(Ct[Co+zo])}}}}return ae}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,W,Q){if($[W+Jt]>1){const qt=this.clusterProps[$[W+xl]];return Q?Object.assign({},qt):qt}const wt=this.points[$[W+$n]].properties,Mt=this.options.map(wt);return Q&&Mt===wt?Object.assign({},Mt):Mt}}function Zu(Pt,$,W){return{type:"Feature",id:Pt[$+$n],properties:xn(Pt,$,W),geometry:{type:"Point",coordinates:[(Q=Pt[$],360*(Q-.5)),ar(Pt[$+1])]}};var Q}function xn(Pt,$,W){const Q=Pt[$+Jt],wt=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,Mt=Pt[$+xl],qt=-1===Mt?{}:Object.assign({},W[Mt]);return Object.assign(qt,{cluster:!0,cluster_id:Pt[$+$n],point_count:Q,point_count_abbreviated:wt})}function Yt(Pt){return Pt/360+.5}function ts(Pt){const $=Math.sin(Pt*Math.PI/180),W=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return W<0?0:W>1?1:W}function ar(Pt){const $=(180-360*Pt)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}var Ti={exports:{}};Ti.exports=function(){function Pt(gt,vt,Tt,Ot){for(var At,zt=Ot,Ut=Tt-vt>>1,Lt=Tt-vt,Kt=gt[vt],Bt=gt[vt+1],Oe=gt[Tt],Rn=gt[Tt+1],ce=vt+3;ce<Tt;ce+=3){var Tn=$(gt[ce],gt[ce+1],Kt,Bt,Oe,Rn);if(Tn>zt)At=ce,zt=Tn;else if(Tn===zt){var bn=Math.abs(ce-Ut);bn<Lt&&(At=ce,Lt=bn)}}zt>Ot&&(At-vt>3&&Pt(gt,vt,At,Ot),gt[At+2]=zt,Tt-At>3&&Pt(gt,At,Tt,Ot))}function $(gt,vt,Tt,Ot,At,zt){var Ut=At-Tt,Lt=zt-Ot;if(0!==Ut||0!==Lt){var Kt=((gt-Tt)*Ut+(vt-Ot)*Lt)/(Ut*Ut+Lt*Lt);Kt>1?(Tt=At,Ot=zt):Kt>0&&(Tt+=Ut*Kt,Ot+=Lt*Kt)}return(Ut=gt-Tt)*Ut+(Lt=vt-Ot)*Lt}function W(gt,vt,Tt,Ot){var At={id:void 0===gt?null:gt,type:vt,geometry:Tt,tags:Ot,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(zt){var Ut=zt.geometry,Lt=zt.type;if("Point"===Lt||"MultiPoint"===Lt||"LineString"===Lt)Q(zt,Ut);else if("Polygon"===Lt||"MultiLineString"===Lt)for(var Kt=0;Kt<Ut.length;Kt++)Q(zt,Ut[Kt]);else if("MultiPolygon"===Lt)for(Kt=0;Kt<Ut.length;Kt++)for(var Bt=0;Bt<Ut[Kt].length;Bt++)Q(zt,Ut[Kt][Bt])}(At),At}function Q(gt,vt){for(var Tt=0;Tt<vt.length;Tt+=3)gt.minX=Math.min(gt.minX,vt[Tt]),gt.minY=Math.min(gt.minY,vt[Tt+1]),gt.maxX=Math.max(gt.maxX,vt[Tt]),gt.maxY=Math.max(gt.maxY,vt[Tt+1])}function wt(gt,vt,Tt,Ot){if(vt.geometry){var At=vt.geometry.coordinates,zt=vt.geometry.type,Ut=Math.pow(Tt.tolerance/((1<<Tt.maxZoom)*Tt.extent),2),Lt=[],Kt=vt.id;if(Tt.promoteId?Kt=vt.properties[Tt.promoteId]:Tt.generateId&&(Kt=Ot||0),"Point"===zt)Mt(At,Lt);else if("MultiPoint"===zt)for(var Bt=0;Bt<At.length;Bt++)Mt(At[Bt],Lt);else if("LineString"===zt)qt(At,Lt,Ut,!1);else if("MultiLineString"===zt){if(Tt.lineMetrics){for(Bt=0;Bt<At.length;Bt++)qt(At[Bt],Lt=[],Ut,!1),gt.push(W(Kt,"LineString",Lt,vt.properties));return}te(At,Lt,Ut,!1)}else if("Polygon"===zt)te(At,Lt,Ut,!0);else{if("MultiPolygon"!==zt){if("GeometryCollection"===zt){for(Bt=0;Bt<vt.geometry.geometries.length;Bt++)wt(gt,{id:Kt,geometry:vt.geometry.geometries[Bt],properties:vt.properties},Tt,Ot);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Bt=0;Bt<At.length;Bt++){var Oe=[];te(At[Bt],Oe,Ut,!0),Lt.push(Oe)}}gt.push(W(Kt,zt,Lt,vt.properties))}}function Mt(gt,vt){vt.push(Ct(gt[0])),vt.push(ae(gt[1])),vt.push(0)}function qt(gt,vt,Tt,Ot){for(var At,zt,Ut=0,Lt=0;Lt<gt.length;Lt++){var Kt=Ct(gt[Lt][0]),Bt=ae(gt[Lt][1]);vt.push(Kt),vt.push(Bt),vt.push(0),Lt>0&&(Ut+=Ot?(At*Bt-Kt*zt)/2:Math.sqrt(Math.pow(Kt-At,2)+Math.pow(Bt-zt,2))),At=Kt,zt=Bt}var Oe=vt.length-3;vt[2]=1,Pt(vt,0,Oe,Tt),vt[Oe+2]=1,vt.size=Math.abs(Ut),vt.start=0,vt.end=vt.size}function te(gt,vt,Tt,Ot){for(var At=0;At<gt.length;At++){var zt=[];qt(gt[At],zt,Tt,Ot),vt.push(zt)}}function Ct(gt){return gt/360+.5}function ae(gt){var vt=Math.sin(gt*Math.PI/180),Tt=.5-.25*Math.log((1+vt)/(1-vt))/Math.PI;return Tt<0?0:Tt>1?1:Tt}function xe(gt,vt,Tt,Ot,At,zt,Ut,Lt){if(Ot/=vt,zt>=(Tt/=vt)&&Ut<Ot)return gt;if(Ut<Tt||zt>=Ot)return null;for(var Kt=[],Bt=0;Bt<gt.length;Bt++){var Oe=gt[Bt],Rn=Oe.geometry,ce=Oe.type,Tn=0===At?Oe.minX:Oe.minY,bn=0===At?Oe.maxX:Oe.maxY;if(Tn>=Tt&&bn<Ot)Kt.push(Oe);else if(!(bn<Tt||Tn>=Ot)){var Xi=[];if("Point"===ce||"MultiPoint"===ce)be(Rn,Xi,Tt,Ot,At);else if("LineString"===ce)Yn(Rn,Xi,Tt,Ot,At,!1,Lt.lineMetrics);else if("MultiLineString"===ce)zr(Rn,Xi,Tt,Ot,At,!1);else if("Polygon"===ce)zr(Rn,Xi,Tt,Ot,At,!0);else if("MultiPolygon"===ce)for(var fr=0;fr<Rn.length;fr++){var Mo=[];zr(Rn[fr],Mo,Tt,Ot,At,!0),Mo.length&&Xi.push(Mo)}if(Xi.length){if(Lt.lineMetrics&&"LineString"===ce){for(fr=0;fr<Xi.length;fr++)Kt.push(W(Oe.id,ce,Xi[fr],Oe.tags));continue}"LineString"!==ce&&"MultiLineString"!==ce||(1===Xi.length?(ce="LineString",Xi=Xi[0]):ce="MultiLineString"),"Point"!==ce&&"MultiPoint"!==ce||(ce=3===Xi.length?"Point":"MultiPoint"),Kt.push(W(Oe.id,ce,Xi,Oe.tags))}}}return Kt.length?Kt:null}function be(gt,vt,Tt,Ot,At){for(var zt=0;zt<gt.length;zt+=3){var Ut=gt[zt+At];Ut>=Tt&&Ut<=Ot&&(vt.push(gt[zt]),vt.push(gt[zt+1]),vt.push(gt[zt+2]))}}function Yn(gt,vt,Tt,Ot,At,zt,Ut){for(var Lt,Kt,Bt=Ni(gt),Oe=0===At?ni:ii,Rn=gt.start,ce=0;ce<gt.length-3;ce+=3){var Tn=gt[ce],bn=gt[ce+1],Xi=gt[ce+2],fr=gt[ce+3],Mo=gt[ce+4],sa=0===At?Tn:bn,Cr=0===At?fr:Mo,ns=!1;Ut&&(Lt=Math.sqrt(Math.pow(Tn-fr,2)+Math.pow(bn-Mo,2))),sa<Tt?Cr>Tt&&(Kt=Oe(Bt,Tn,bn,fr,Mo,Tt),Ut&&(Bt.start=Rn+Lt*Kt)):sa>Ot?Cr<Ot&&(Kt=Oe(Bt,Tn,bn,fr,Mo,Ot),Ut&&(Bt.start=Rn+Lt*Kt)):zi(Bt,Tn,bn,Xi),Cr<Tt&&sa>=Tt&&(Kt=Oe(Bt,Tn,bn,fr,Mo,Tt),ns=!0),Cr>Ot&&sa<=Ot&&(Kt=Oe(Bt,Tn,bn,fr,Mo,Ot),ns=!0),!zt&&ns&&(Ut&&(Bt.end=Rn+Lt*Kt),vt.push(Bt),Bt=Ni(gt)),Ut&&(Rn+=Lt)}var So=gt.length-3;Tn=gt[So],bn=gt[So+1],Xi=gt[So+2],(sa=0===At?Tn:bn)>=Tt&&sa<=Ot&&zi(Bt,Tn,bn,Xi),So=Bt.length-3,zt&&So>=3&&(Bt[So]!==Bt[0]||Bt[So+1]!==Bt[1])&&zi(Bt,Bt[0],Bt[1],Bt[2]),Bt.length&&vt.push(Bt)}function Ni(gt){var vt=[];return vt.size=gt.size,vt.start=gt.start,vt.end=gt.end,vt}function zr(gt,vt,Tt,Ot,At,zt){for(var Ut=0;Ut<gt.length;Ut++)Yn(gt[Ut],vt,Tt,Ot,At,zt,!1)}function zi(gt,vt,Tt,Ot){gt.push(vt),gt.push(Tt),gt.push(Ot)}function ni(gt,vt,Tt,Ot,At,zt){var Ut=(zt-vt)/(Ot-vt);return gt.push(zt),gt.push(Tt+(At-Tt)*Ut),gt.push(1),Ut}function ii(gt,vt,Tt,Ot,At,zt){var Ut=(zt-Tt)/(At-Tt);return gt.push(vt+(Ot-vt)*Ut),gt.push(zt),gt.push(1),Ut}function Co(gt,vt){for(var Tt=[],Ot=0;Ot<gt.length;Ot++){var At,zt=gt[Ot],Ut=zt.type;if("Point"===Ut||"MultiPoint"===Ut||"LineString"===Ut)At=zo(zt.geometry,vt);else if("MultiLineString"===Ut||"Polygon"===Ut){At=[];for(var Lt=0;Lt<zt.geometry.length;Lt++)At.push(zo(zt.geometry[Lt],vt))}else if("MultiPolygon"===Ut)for(At=[],Lt=0;Lt<zt.geometry.length;Lt++){for(var Kt=[],Bt=0;Bt<zt.geometry[Lt].length;Bt++)Kt.push(zo(zt.geometry[Lt][Bt],vt));At.push(Kt)}Tt.push(W(zt.id,Ut,At,zt.tags))}return Tt}function zo(gt,vt){var Tt=[];Tt.size=gt.size,void 0!==gt.start&&(Tt.start=gt.start,Tt.end=gt.end);for(var Ot=0;Ot<gt.length;Ot+=3)Tt.push(gt[Ot]+vt,gt[Ot+1],gt[Ot+2]);return Tt}function es(gt,vt){if(gt.transformed)return gt;var Tt,Ot,At,zt=1<<gt.z,Ut=gt.x,Lt=gt.y;for(Tt=0;Tt<gt.features.length;Tt++){var Kt=gt.features[Tt],Bt=Kt.geometry,Oe=Kt.type;if(Kt.geometry=[],1===Oe)for(Ot=0;Ot<Bt.length;Ot+=2)Kt.geometry.push(Ia(Bt[Ot],Bt[Ot+1],vt,zt,Ut,Lt));else for(Ot=0;Ot<Bt.length;Ot++){var Rn=[];for(At=0;At<Bt[Ot].length;At+=2)Rn.push(Ia(Bt[Ot][At],Bt[Ot][At+1],vt,zt,Ut,Lt));Kt.geometry.push(Rn)}}return gt.transformed=!0,gt}function Ia(gt,vt,Tt,Ot,At,zt){return[Math.round(Tt*(gt*Ot-At)),Math.round(Tt*(vt*Ot-zt))]}function Qd(gt,vt,Tt,Ot,At){for(var zt=vt===At.maxZoom?0:At.tolerance/((1<<vt)*At.extent),Ut={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Tt,y:Ot,z:vt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Lt=0;Lt<gt.length;Lt++){Ut.numFeatures++,fs(Ut,gt[Lt],zt,At);var Kt=gt[Lt].minX,Bt=gt[Lt].minY,Oe=gt[Lt].maxX,Rn=gt[Lt].maxY;Kt<Ut.minX&&(Ut.minX=Kt),Bt<Ut.minY&&(Ut.minY=Bt),Oe>Ut.maxX&&(Ut.maxX=Oe),Rn>Ut.maxY&&(Ut.maxY=Rn)}return Ut}function fs(gt,vt,Tt,Ot){var At=vt.geometry,zt=vt.type,Ut=[];if("Point"===zt||"MultiPoint"===zt)for(var Lt=0;Lt<At.length;Lt+=3)Ut.push(At[Lt]),Ut.push(At[Lt+1]),gt.numPoints++,gt.numSimplified++;else if("LineString"===zt)cc(Ut,At,gt,Tt,!1,!1);else if("MultiLineString"===zt||"Polygon"===zt)for(Lt=0;Lt<At.length;Lt++)cc(Ut,At[Lt],gt,Tt,"Polygon"===zt,0===Lt);else if("MultiPolygon"===zt)for(var Kt=0;Kt<At.length;Kt++){var Bt=At[Kt];for(Lt=0;Lt<Bt.length;Lt++)cc(Ut,Bt[Lt],gt,Tt,!0,0===Lt)}if(Ut.length){var Oe=vt.tags||null;if("LineString"===zt&&Ot.lineMetrics){for(var Rn in Oe={},vt.tags)Oe[Rn]=vt.tags[Rn];Oe.mapbox_clip_start=At.start/At.size,Oe.mapbox_clip_end=At.end/At.size}var ce={geometry:Ut,type:"Polygon"===zt||"MultiPolygon"===zt?3:"LineString"===zt||"MultiLineString"===zt?2:1,tags:Oe};null!==vt.id&&(ce.id=vt.id),gt.features.push(ce)}}function cc(gt,vt,Tt,Ot,At,zt){var Ut=Ot*Ot;if(Ot>0&&vt.size<(At?Ut:Ot))Tt.numPoints+=vt.length/3;else{for(var Lt=[],Kt=0;Kt<vt.length;Kt+=3)(0===Ot||vt[Kt+2]>Ut)&&(Tt.numSimplified++,Lt.push(vt[Kt]),Lt.push(vt[Kt+1])),Tt.numPoints++;At&&function(Bt,Oe){for(var Rn=0,ce=0,Tn=Bt.length,bn=Tn-2;ce<Tn;bn=ce,ce+=2)Rn+=(Bt[ce]-Bt[bn])*(Bt[ce+1]+Bt[bn+1]);if(Rn>0===Oe)for(ce=0,Tn=Bt.length;ce<Tn/2;ce+=2){var Xi=Bt[ce],fr=Bt[ce+1];Bt[ce]=Bt[Tn-2-ce],Bt[ce+1]=Bt[Tn-1-ce],Bt[Tn-2-ce]=Xi,Bt[Tn-1-ce]=fr}}(Lt,zt),gt.push(Lt)}}function Qc(gt,vt){var Tt=(vt=this.options=function(At,zt){for(var Ut in zt)At[Ut]=zt[Ut];return At}(Object.create(this.options),vt)).debug;if(Tt&&console.time("preprocess data"),vt.maxZoom<0||vt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(vt.promoteId&&vt.generateId)throw new Error("promoteId and generateId cannot be used together.");var At,zt,Ut,Lt,Kt,Bt,Ot=function(At,zt){var Ut=[];if("FeatureCollection"===At.type)for(var Lt=0;Lt<At.features.length;Lt++)wt(Ut,At.features[Lt],zt,Lt);else wt(Ut,"Feature"===At.type?At:{geometry:At},zt);return Ut}(gt,vt);this.tiles={},this.tileCoords=[],Tt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",vt.indexMaxZoom,vt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(At=Ot,zt=vt,Ut=zt.buffer/zt.extent,Lt=At,Kt=xe(At,1,-1-Ut,Ut,0,-1,2,zt),Bt=xe(At,1,1-Ut,2+Ut,0,-1,2,zt),(Kt||Bt)&&(Lt=xe(At,1,-Ut,1+Ut,0,-1,2,zt)||[],Kt&&(Lt=Co(Kt,1).concat(Lt)),Bt&&(Lt=Lt.concat(Co(Bt,-1)))),Ot=Lt).length&&this.splitTile(Ot,0,0,0),Tt&&(Ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function th(gt,vt,Tt){return 32*((1<<gt)*Tt+vt)+gt}return Qc.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qc.prototype.splitTile=function(gt,vt,Tt,Ot,At,zt,Ut){for(var Lt=[gt,vt,Tt,Ot],Kt=this.options,Bt=Kt.debug;Lt.length;){Ot=Lt.pop(),Tt=Lt.pop(),vt=Lt.pop(),gt=Lt.pop();var Oe=1<<vt,Rn=th(vt,Tt,Ot),ce=this.tiles[Rn];if(!ce&&(Bt>1&&console.time("creation"),ce=this.tiles[Rn]=Qd(gt,vt,Tt,Ot,Kt),this.tileCoords.push({z:vt,x:Tt,y:Ot}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",vt,Tt,Ot,ce.numFeatures,ce.numPoints,ce.numSimplified),console.timeEnd("creation"));var Tn="z"+vt;this.stats[Tn]=(this.stats[Tn]||0)+1,this.total++}if(ce.source=gt,At){if(vt===Kt.maxZoom||vt===At)continue;var bn=1<<At-vt;if(Tt!==Math.floor(zt/bn)||Ot!==Math.floor(Ut/bn))continue}else if(vt===Kt.indexMaxZoom||ce.numPoints<=Kt.indexMaxPoints)continue;if(ce.source=null,0!==gt.length){Bt>1&&console.time("clipping");var Xi,fr,Mo,sa,Cr,ns,So=.5*Kt.buffer/Kt.extent,ps=.5-So,tu=.5+So,pr=1+So;Xi=fr=Mo=sa=null,Cr=xe(gt,Oe,Tt-So,Tt+tu,0,ce.minX,ce.maxX,Kt),ns=xe(gt,Oe,Tt+ps,Tt+pr,0,ce.minX,ce.maxX,Kt),gt=null,Cr&&(Xi=xe(Cr,Oe,Ot-So,Ot+tu,1,ce.minY,ce.maxY,Kt),fr=xe(Cr,Oe,Ot+ps,Ot+pr,1,ce.minY,ce.maxY,Kt),Cr=null),ns&&(Mo=xe(ns,Oe,Ot-So,Ot+tu,1,ce.minY,ce.maxY,Kt),sa=xe(ns,Oe,Ot+ps,Ot+pr,1,ce.minY,ce.maxY,Kt),ns=null),Bt>1&&console.timeEnd("clipping"),Lt.push(Xi||[],vt+1,2*Tt,2*Ot),Lt.push(fr||[],vt+1,2*Tt,2*Ot+1),Lt.push(Mo||[],vt+1,2*Tt+1,2*Ot),Lt.push(sa||[],vt+1,2*Tt+1,2*Ot+1)}}},Qc.prototype.getTile=function(gt,vt,Tt){var Ot=this.options,At=Ot.extent,zt=Ot.debug;if(gt<0||gt>24)return null;var Ut=1<<gt,Lt=th(gt,vt=(vt%Ut+Ut)%Ut,Tt);if(this.tiles[Lt])return es(this.tiles[Lt],At);zt>1&&console.log("drilling down to z%d-%d-%d",gt,vt,Tt);for(var Kt,Bt=gt,Oe=vt,Rn=Tt;!Kt&&Bt>0;)Bt--,Oe=Math.floor(Oe/2),Rn=Math.floor(Rn/2),Kt=this.tiles[th(Bt,Oe,Rn)];return Kt&&Kt.source?(zt>1&&console.log("found parent tile z%d-%d-%d",Bt,Oe,Rn),zt>1&&console.time("drilling down"),this.splitTile(Kt.source,Bt,Oe,Rn,gt,vt,Tt),zt>1&&console.timeEnd("drilling down"),this.tiles[Lt]?es(this.tiles[Lt],At):null):null},function(gt,vt){return new Qc(gt,vt)}}();var Bg=Qt.g(Ti.exports);function cn(Pt,$){const W=Pt.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const Q=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!Q)return $(null,null);const wt=new class{constructor(qt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Qt.E,this.length=qt.length,this._features=qt}feature(qt){return new class{constructor(te){this._feature=te,this.extent=Qt.E,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(1===this._feature.type){const te=[];for(const Ct of this._feature.geometry)te.push([new Qt.P(Ct[0],Ct[1])]);return te}{const te=[];for(const Ct of this._feature.geometry){const ae=[];for(const xe of Ct)ae.push(new Qt.P(xe[0],xe[1]));te.push(ae)}return te}}toGeoJSON(te,Ct,ae){return Gu.call(this,te,Ct,ae)}}(this._features[qt])}}(Q.features);let Mt=Yc(wt);0===Mt.byteOffset&&Mt.byteLength===Mt.buffer.byteLength||(Mt=new Uint8Array(Mt)),$(null,{vectorTile:wt,rawData:Mt.buffer})}class Kd extends Qt.d{constructor($,W,Q,wt,Mt,qt){super($,W,Q,wt,cn,qt),Mt&&(this.loadGeoJSON=Mt)}loadData($,W){const Q=$&&$.request,wt=Q&&Q.collectResourceTiming;this.loadGeoJSON($,(Mt,qt)=>{if(Mt||!qt)return W(Mt);if("object"!=typeof qt)return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{lc(qt,!0);try{if($.filter){const Ct=Qt.e($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ct.result)throw new Error(Ct.value.map(xe=>`${xe.key}: ${xe.message}`).join(", "));qt={type:"FeatureCollection",features:qt.features.filter(xe=>Ct.value.evaluate({zoom:0},xe))}}this._geoJSONIndex=$.cluster?new bl(function({superclusterOptions:Ct,clusterProperties:ae}){if(!ae||!Ct)return Ct;const xe={},be={},Yn={accumulated:null,zoom:0},Ni={properties:null},zr=Object.keys(ae);for(const zi of zr){const[ni,ii]=ae[zi],Co=Qt.e(ii),zo=Qt.e("string"==typeof ni?[ni,["accumulated"],["get",zi]]:ni);xe[zi]=Co.value,be[zi]=zo.value}return Ct.map=zi=>{Ni.properties=zi;const ni={};for(const ii of zr)ni[ii]=xe[ii].evaluate(Yn,Ni);return ni},Ct.reduce=(zi,ni)=>{Ni.properties=ni;for(const ii of zr)Yn.accumulated=zi[ii],zi[ii]=be[ii].evaluate(Yn,Ni)},Ct}($)).load(qt.features):Bg(qt,$.geojsonVtOptions)}catch(Ct){return W(Ct)}this.loaded={};const te={};if(wt){const Ct=Qt.f(Q);Ct&&(te.resourceTiming={},te.resourceTiming[$.source]=JSON.parse(JSON.stringify(Ct)))}W(null,te)}})}reloadTile($,W){const Q=this.loaded;return Q&&Q[$.uid]?super.reloadTile($,W):this.loadTile($,W)}loadGeoJSON($,W){if($.request)Qt.h($.request,W);else{if("string"!=typeof $.data)return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse($.data))}catch{return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(Q){W(Q)}}getClusterChildren($,W){try{W(null,this._geoJSONIndex.getChildren($.clusterId))}catch(Q){W(Q)}}getClusterLeaves($,W){try{W(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(Q){W(Q)}}}class Ir{constructor($,W){this.tileID=new Qt.O($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=W}parse($,W,Q,wt){this.status="parsing";const Mt=new Qt.O(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),qt={},te=W.familiesBySource[Q.source],Ct=new Qt.F(Mt,Q.promoteId);return Ct.bucketLayerIDs=[],Qt.l($).then(ae=>{if(!ae)return wt(new Error("Could not parse tile"));const xe=Qt.j(ae,1/Qt.t(Q.tileID.canonical)),be=ae.json.extensionsUsed&&ae.json.extensionsUsed.includes("MAPBOX_mesh_features"),Yn=new Qt.k(this.zoom,{brightness:this.brightness});for(const Ni in te)for(const zr of te[Ni]){const zi=zr[0],ni=ae.json.extensionsUsed;zi.recalculate(Yn,[]);const ii=new Qt.T(xe,Mt,ni&&ni.includes("MAPBOX_mesh_features"),this.brightness);be||(ii.needsUpload=!0),qt[zi.fqid]=ii,ii.evaluate(zi)}this.status="done",wt(null,{buckets:qt,featureIndex:Ct})}).catch(ae=>wt(new Error(ae.message)))}}class Jc{constructor($,W,Q,wt,Mt,qt){this.actor=$,this.layerIndex=W,this.brightness=qt,this.loading={},this.loaded={}}loadTile($,W){const Q=$.uid,wt=this.loading[Q]=new Ir($,this.brightness);Qt.i($.request,(Mt,qt)=>{const te=!this.loading[Q];return delete this.loading[Q],te||Mt?(wt.status="done",te||(this.loaded[Q]=wt),W(Mt)):qt&&0!==qt.byteLength?void wt.parse(qt,this.layerIndex,$,(Ct,ae)=>{wt.status="done",this.loaded=this.loaded||{},this.loaded[Q]=wt,Ct||!ae?W(Ct):W(null,ae)}):(wt.status="done",this.loaded[Q]=wt,W())})}reloadTile($,W){const Q=this.loaded,wt=$.uid;if(Q&&Q[wt]){const Mt=Q[wt];Mt.projection=$.projection,Mt.brightness=$.brightness;const qt=(te,Ct)=>{Mt.reloadCallback&&(delete Mt.reloadCallback,this.loadTile($,W)),W(te,Ct)};"parsing"===Mt.status?Mt.reloadCallback=qt:"done"===Mt.status&&this.loadTile($,W)}}abortTile($,W){const Q=$.uid;this.loading[Q]&&delete this.loading[Q],W()}removeTile($,W){const Q=this.loaded,wt=$.uid;Q&&Q[wt]&&delete Q[wt],W()}}class Jd{constructor($){this.self=$,this.actor=new Qt.A($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=Qt.m({name:"mercator"}),this.workerSourceTypes={vector:Qt.d,geojson:Kd,"batched-model":Jc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,Q)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=Q},this.self.registerRTLTextPlugin=W=>{if(Qt.n.isParsed())throw new Error("RTL text plugin already registered.");Qt.n.applyArabicShaping=W.applyArabicShaping,Qt.n.processBidirectionalText=W.processBidirectionalText,Qt.n.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches($,W,Q){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],Q()}checkIfReady($,W,Q){Q()}setReferrer($,W){this.referrer=W}spriteLoaded($,{scope:W,isLoaded:Q}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][W]=Q,this.workerSources[$]&&this.workerSources[$][W])for(const wt in this.workerSources[$][W]){const Mt=this.workerSources[$][W][wt];for(const qt in Mt)Mt[qt]instanceof Qt.d&&(Mt[qt].isSpriteLoaded=Q,Mt[qt].fire(new Qt.o("isSpriteLoaded")))}}setImages($,{scope:W,images:Q},wt){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][W]=Q,this.workerSources[$]&&this.workerSources[$][W]){for(const Mt in this.workerSources[$][W]){const qt=this.workerSources[$][W][Mt];for(const te in qt)qt[te].availableImages=Q}wt()}else wt()}setProjection($,W){this.projections[$]=Qt.m(W)}setBrightness($,W,Q){this.brightness=W,Q()}setLayers($,W,Q){this.getLayerIndex($,W.scope).replace(W.layers,W.options),Q()}updateLayers($,W,Q){this.getLayerIndex($,W.scope).update(W.layers,W.removedIds,W.options),Q()}loadTile($,W,Q){W.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,W.type,W.source,W.scope).loadTile(W,Q)}loadDEMTile($,W,Q){this.getDEMWorkerSource($,W.source,W.scope).loadTile(W,Q)}reloadTile($,W,Q){W.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,W.type,W.source,W.scope).reloadTile(W,Q)}abortTile($,W,Q){this.getWorkerSource($,W.type,W.source,W.scope).abortTile(W,Q)}removeTile($,W,Q){this.getWorkerSource($,W.type,W.source,W.scope).removeTile(W,Q)}removeSource($,W,Q){if(!(this.workerSources[$]&&this.workerSources[$][W.scope]&&this.workerSources[$][W.scope][W.type]&&this.workerSources[$][W.scope][W.type][W.source]))return;const wt=this.workerSources[$][W.scope][W.type][W.source];delete this.workerSources[$][W.scope][W.type][W.source],void 0!==wt.removeSource?wt.removeSource(W,Q):Q()}loadWorkerSource($,W,Q){try{this.self.importScripts(W.url),Q()}catch(wt){Q(wt.toString())}}syncRTLPluginState($,W,Q){try{Qt.n.setState(W);const wt=Qt.n.getPluginURL();if(Qt.n.isLoaded()&&!Qt.n.isParsed()&&null!=wt){this.self.importScripts(wt);const Mt=Qt.n.isParsed();Q(Mt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${wt}`),Mt)}}catch(wt){Q(wt.toString())}}setDracoUrl($,W){this.dracoUrl=W}getAvailableImages($,W){this.availableImages[$]||(this.availableImages[$]={});let Q=this.availableImages[$][W];return Q||(Q=[]),Q}getLayerIndex($,W){this.layerIndexes[$]||(this.layerIndexes[$]={});let Q=this.layerIndexes[$][W];return Q||(Q=this.layerIndexes[$][W]=new pl,Q.scope=W),Q}getWorkerSource($,W,Q,wt){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][wt]||(this.workerSources[$][wt]={}),this.workerSources[$][wt][W]||(this.workerSources[$][wt][W]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.workerSources[$][wt][W][Q]||(this.workerSources[$][wt][W][Q]=new this.workerSourceTypes[W]({send:(qt,te,Ct,ae,xe,be)=>{this.actor.send(qt,te,Ct,$,xe,be)},scheduler:this.actor.scheduler},this.getLayerIndex($,wt),this.getAvailableImages($,wt),this.isSpriteLoaded[$][wt],void 0,this.brightness)),this.workerSources[$][wt][W][Q]}getDEMWorkerSource($,W,Q){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][Q]||(this.demWorkerSources[$][Q]={}),this.demWorkerSources[$][Q][W]||(this.demWorkerSources[$][Q][W]=new $e),this.demWorkerSources[$][Q][W]}enforceCacheSizeLimit($,W){Qt.q(W)}getWorkerPerformanceMetrics($,W,Q){Q(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Jd(self)),Jd}),ep(0,function(Qt){return Qt.s}),Gn}()}},d0=>{d0(d0.s=369)}]);