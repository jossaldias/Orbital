(self.webpackChunkOrbital=self.webpackChunkOrbital||[]).push([[179],{47:(h0,Jd,qu)=>{"use strict";function qn(e){return"function"==typeof e}function rp(e){const i=e(s=>{Error.call(s),s.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const f0=rp(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((s,c)=>`${c+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function Qt(e,o){if(e){const i=e.indexOf(o);0<=i&&e.splice(i,1)}}class st{constructor(o){this.initialTeardown=o,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let o;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const f of i)f.remove(this);else i.remove(this);const{initialTeardown:s}=this;if(qn(s))try{s()}catch(f){o=f instanceof f0?f.errors:[f]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const f of c)try{He(f)}catch(g){o=o??[],g instanceof f0?o=[...o,...g.errors]:o.push(g)}}if(o)throw new f0(o)}}add(o){var i;if(o&&o!==this)if(this.closed)He(o);else{if(o instanceof st){if(o.closed||o._hasParent(this))return;o._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(o)}}_hasParent(o){const{_parentage:i}=this;return i===o||Array.isArray(i)&&i.includes(o)}_addParent(o){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(o),i):i?[i,o]:o}_removeParent(o){const{_parentage:i}=this;i===o?this._parentage=null:Array.isArray(i)&&Qt(i,o)}remove(o){const{_finalizers:i}=this;i&&Qt(i,o),o instanceof st&&o._removeParent(this)}}st.EMPTY=(()=>{const e=new st;return e.closed=!0,e})();const Pa=st.EMPTY;function ml(e){return e instanceof st||e&&"closed"in e&&qn(e.remove)&&qn(e.add)&&qn(e.unsubscribe)}function He(e){qn(e)?e():e.unsubscribe()}const Bs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Oa={setTimeout(e,o,...i){const{delegate:s}=Oa;return s?.setTimeout?s.setTimeout(e,o,...i):setTimeout(e,o,...i)},clearTimeout(e){const{delegate:o}=Oa;return(o?.clearTimeout||clearTimeout)(e)},delegate:void 0};function lc(e){Oa.setTimeout(()=>{const{onUnhandledError:o}=Bs;if(!o)throw e;o(e)})}function Wu(){}const Yc=ms("C",void 0,void 0);function ms(e,o,i){return{kind:e,value:o,error:i}}let gl=null;function _l(e){if(Bs.useDeprecatedSynchronousErrorHandling){const o=!gl;if(o&&(gl={errorThrown:!1,error:null}),e(),o){const{errorThrown:i,error:s}=gl;if(gl=null,i)throw s}}else e()}class Kc extends st{constructor(o){super(),this.isStopped=!1,o?(this.destination=o,ml(o)&&o.add(this)):this.destination=p0}static create(o,i,s){return new Zu(o,i,s)}next(o){this.isStopped?Cr(function op(e){return ms("N",e,void 0)}(o),this):this._next(o)}error(o){this.isStopped?Cr(function Bg(e){return ms("E",void 0,e)}(o),this):(this.isStopped=!0,this._error(o))}complete(){this.isStopped?Cr(Yc,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(o){this.destination.next(o)}_error(o){try{this.destination.error(o)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const yl=Function.prototype.bind;function nt(e,o){return yl.call(e,o)}class cn{constructor(o){this.partialObserver=o}next(o){const{partialObserver:i}=this;if(i.next)try{i.next(o)}catch(s){vl(s)}}error(o){const{partialObserver:i}=this;if(i.error)try{i.error(o)}catch(s){vl(s)}else vl(o)}complete(){const{partialObserver:o}=this;if(o.complete)try{o.complete()}catch(i){vl(i)}}}class Zu extends Kc{constructor(o,i,s){let c;if(super(),qn(o)||!o)c={next:o??void 0,error:i??void 0,complete:s??void 0};else{let f;this&&Bs.useDeprecatedNextContext?(f=Object.create(o),f.unsubscribe=()=>this.unsubscribe(),c={next:o.next&&nt(o.next,f),error:o.error&&nt(o.error,f),complete:o.complete&&nt(o.complete,f)}):c=o}this.destination=new cn(c)}}function vl(e){Bs.useDeprecatedSynchronousErrorHandling?function Vg(e){Bs.useDeprecatedSynchronousErrorHandling&&gl&&(gl.errorThrown=!0,gl.error=e)}(e):lc(e)}function Cr(e,o){const{onStoppedNotification:i}=Bs;i&&Oa.setTimeout(()=>i(e,o))}const p0={closed:!0,next:Wu,error:function Ie(e){throw e},complete:Wu},Jc="function"==typeof Symbol&&Symbol.observable||"@@observable";function xl(e){return e}function Qc(e){return 0===e.length?xl:1===e.length?e[0]:function(i){return e.reduce((s,c)=>c(s),i)}}let $n=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){const s=new e;return s.source=this,s.operator=i,s}subscribe(i,s,c){const f=function wl(e){return e&&e instanceof Kc||function bl(e){return e&&qn(e.next)&&qn(e.error)&&qn(e.complete)}(e)&&ml(e)}(i)?i:new Zu(i,s,c);return _l(()=>{const{operator:g,source:v}=this;f.add(g?g.call(f,v):v?this._subscribe(f):this._trySubscribe(f))}),f}_trySubscribe(i){try{return this._subscribe(i)}catch(s){i.error(s)}}forEach(i,s){return new(s=Jt(s))((c,f)=>{const g=new Zu({next:v=>{try{i(v)}catch(w){f(w),g.unsubscribe()}},error:f,complete:c});this.subscribe(g)})}_subscribe(i){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(i)}[Jc](){return this}pipe(...i){return Qc(i)(this)}toPromise(i){return new(i=Jt(i))((s,c)=>{let f;this.subscribe(g=>f=g,g=>c(g),()=>s(f))})}}return e.create=o=>new e(o),e})();function Jt(e){var o;return null!==(o=e??Bs.Promise)&&void 0!==o?o:Promise}const Yu=rp(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let on=(()=>{class e extends $n{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const s=new Yt(this,this);return s.operator=i,s}_throwIfClosed(){if(this.closed)throw new Yu}next(i){_l(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(i)}})}error(i){_l(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:s}=this;for(;s.length;)s.shift().error(i)}})}complete(){_l(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:s,isStopped:c,observers:f}=this;return s||c?Pa:(this.currentObservers=null,f.push(i),new st(()=>{this.currentObservers=null,Qt(f,i)}))}_checkFinalizedStatuses(i){const{hasError:s,thrownError:c,isStopped:f}=this;s?i.error(c):f&&i.complete()}asObservable(){const i=new $n;return i.source=this,i}}return e.create=(o,i)=>new Yt(o,i),e})();class Yt extends on{constructor(o,i){super(),this.destination=o,this.source=i}next(o){var i,s;null===(s=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===s||s.call(i,o)}error(o){var i,s;null===(s=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===s||s.call(i,o)}complete(){var o,i;null===(i=null===(o=this.destination)||void 0===o?void 0:o.complete)||void 0===i||i.call(o)}_subscribe(o){var i,s;return null!==(s=null===(i=this.source)||void 0===i?void 0:i.subscribe(o))&&void 0!==s?s:Pa}}function ns(e){return qn(e?.lift)}function ar(e){return o=>{if(ns(o))return o.lift(function(i){try{return e(i,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function Di(e,o,i,s,c){return new jg(e,o,i,s,c)}class jg extends Kc{constructor(o,i,s,c,f,g){super(o),this.onFinalize=f,this.shouldUnsubscribe=g,this._next=i?function(v){try{i(v)}catch(w){o.error(w)}}:super._next,this._error=c?function(v){try{c(v)}catch(w){o.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(v){o.error(v)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var o;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(o=this.onFinalize)||void 0===o||o.call(this))}}}function dn(e,o){return ar((i,s)=>{let c=0;i.subscribe(Di(s,f=>{s.next(e.call(o,f,c++))}))})}function ni(e){return this instanceof ni?(this.v=e,this):new ni(e)}function Bo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,o=e[Symbol.asyncIterator];return o?o.call(e):(e=function be(e){var o="function"==typeof Symbol&&Symbol.iterator,i=o&&e[o],s=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i);function s(f){i[f]=e[f]&&function(g){return new Promise(function(v,w){!function c(f,g,v,w){Promise.resolve(w).then(function(T){f({value:T,done:v})},g)}(v,w,(g=e[f](g)).done,g.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const At=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function zt(e){return qn(e?.then)}function Ut(e){return qn(e[Jc])}function Lt(e){return Symbol.asyncIterator&&qn(e?.[Symbol.asyncIterator])}function Kt(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Oe=function Bt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Pn(e){return qn(e?.[Oe])}function ce(e){return function ii(e,o,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,s=i.apply(e,o||[]),f=[];return c={},g("next"),g("throw"),g("return"),c[Symbol.asyncIterator]=function(){return this},c;function g(B){s[B]&&(c[B]=function($){return new Promise(function(K,Q){f.push([B,$,K,Q])>1||v(B,$)})})}function v(B,$){try{!function w(B){B.value instanceof ni?Promise.resolve(B.value.v).then(T,A):k(f[0][2],B)}(s[B]($))}catch(K){k(f[0][3],K)}}function T(B){v("next",B)}function A(B){v("throw",B)}function k(B,$){B($),f.shift(),f.length&&v(f[0][0],f[0][1])}}(this,arguments,function*(){const i=e.getReader();try{for(;;){const{value:s,done:c}=yield ni(i.read());if(c)return yield ni(void 0);yield yield ni(s)}}finally{i.releaseLock()}})}function In(e){return qn(e?.getReader)}function En(e){if(e instanceof $n)return e;if(null!=e){if(Ut(e))return function Yi(e){return new $n(o=>{const i=e[Jc]();if(qn(i.subscribe))return i.subscribe(o);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(At(e))return function pr(e){return new $n(o=>{for(let i=0;i<e.length&&!o.closed;i++)o.next(e[i]);o.complete()})}(e);if(zt(e))return function So(e){return new $n(o=>{e.then(i=>{o.closed||(o.next(i),o.complete())},i=>o.error(i)).then(null,lc)})}(e);if(Lt(e))return Mr(e);if(Pn(e))return function la(e){return new $n(o=>{for(const i of e)if(o.next(i),o.closed)return;o.complete()})}(e);if(In(e))return function rs(e){return Mr(ce(e))}(e)}throw Kt(e)}function Mr(e){return new $n(o=>{(function To(e,o){var i,s,c,f;return function te(e,o,i,s){return new(i||(i=Promise))(function(f,g){function v(A){try{T(s.next(A))}catch(k){g(k)}}function w(A){try{T(s.throw(A))}catch(k){g(k)}}function T(A){A.done?f(A.value):function c(f){return f instanceof i?f:new i(function(g){g(f)})}(A.value).then(v,w)}T((s=s.apply(e,o||[])).next())})}(this,void 0,void 0,function*(){try{for(i=Bo(e);!(s=yield i.next()).done;)if(o.next(s.value),o.closed)return}catch(g){c={error:g}}finally{try{s&&!s.done&&(f=i.return)&&(yield f.call(i))}finally{if(c)throw c.error}}o.complete()})})(e,o).catch(i=>o.error(i))})}function _s(e,o,i,s=0,c=!1){const f=o.schedule(function(){i(),c?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(f),!c)return f}function mr(e,o,i=1/0){return qn(o)?mr((s,c)=>dn((f,g)=>o(s,f,c,g))(En(e(s,c))),i):("number"==typeof o&&(i=o),ar((s,c)=>function nu(e,o,i,s,c,f,g,v){const w=[];let T=0,A=0,k=!1;const B=()=>{k&&!w.length&&!T&&o.complete()},$=Q=>T<s?K(Q):w.push(Q),K=Q=>{f&&o.next(Q),T++;let ut=!1;En(i(Q,A++)).subscribe(Di(o,yt=>{c?.(yt),f?$(yt):o.next(yt)},()=>{ut=!0},void 0,()=>{if(ut)try{for(T--;w.length&&T<s;){const yt=w.shift();g?_s(o,g,()=>K(yt)):K(yt)}B()}catch(yt){o.error(yt)}}))};return e.subscribe(Di(o,$,()=>{k=!0,B()})),()=>{v?.()}}(s,c,e,i)))}function iu(e=1/0){return mr(xl,e)}const ca=new $n(e=>e.complete());function aE(e){return e&&qn(e.schedule)}function Ug(e){return e[e.length-1]}function lE(e){return qn(Ug(e))?e.pop():void 0}function ru(e){return aE(Ug(e))?e.pop():void 0}function sp(e,o=0){return ar((i,s)=>{i.subscribe(Di(s,c=>_s(s,e,()=>s.next(c),o),()=>_s(s,e,()=>s.complete(),o),c=>_s(s,e,()=>s.error(c),o)))})}function m0(e,o=0){return ar((i,s)=>{s.add(e.schedule(()=>i.subscribe(s),o))})}function Hg(e,o){if(!e)throw new Error("Iterable cannot be null");return new $n(i=>{_s(i,o,()=>{const s=e[Symbol.asyncIterator]();_s(i,o,()=>{s.next().then(c=>{c.done?i.complete():i.next(c.value)})},0,!0)})})}function Pr(e,o){return o?function $g(e,o){if(null!=e){if(Ut(e))return function UI(e,o){return En(e).pipe(m0(o),sp(o))}(e,o);if(At(e))return function uE(e,o){return new $n(i=>{let s=0;return o.schedule(function(){s===e.length?i.complete():(i.next(e[s++]),i.closed||this.schedule())})})}(e,o);if(zt(e))return function HI(e,o){return En(e).pipe(m0(o),sp(o))}(e,o);if(Lt(e))return Hg(e,o);if(Pn(e))return function dE(e,o){return new $n(i=>{let s;return _s(i,o,()=>{s=e[Oe](),_s(i,o,()=>{let c,f;try{({value:c,done:f}=s.next())}catch(g){return void i.error(g)}f?i.complete():i.next(c)},0,!0)}),()=>qn(s?.return)&&s.return()})}(e,o);if(In(e))return function g0(e,o){return Hg(ce(e),o)}(e,o)}throw Kt(e)}(e,o):En(e)}function uc(...e){const o=ru(e),i=function cE(e,o){return"number"==typeof Ug(e)?e.pop():o}(e,1/0),s=e;return s.length?1===s.length?En(s[0]):iu(i)(Pr(s,o)):ca}class $r extends on{constructor(o){super(),this._value=o}get value(){return this.getValue()}_subscribe(o){const i=super._subscribe(o);return!i.closed&&o.next(this._value),i}getValue(){const{hasError:o,thrownError:i,_value:s}=this;if(o)throw i;return this._throwIfClosed(),s}next(o){super.next(this._value=o)}}function kt(...e){return Pr(e,ru(e))}function zn(e={}){const{connector:o=(()=>new on),resetOnError:i=!0,resetOnComplete:s=!0,resetOnRefCountZero:c=!0}=e;return f=>{let g,v,w,T=0,A=!1,k=!1;const B=()=>{v?.unsubscribe(),v=void 0},$=()=>{B(),g=w=void 0,A=k=!1},K=()=>{const Q=g;$(),Q?.unsubscribe()};return ar((Q,ut)=>{T++,!k&&!A&&B();const yt=w=w??o();ut.add(()=>{T--,0===T&&!k&&!A&&(v=Fa(K,c))}),yt.subscribe(ut),!g&&T>0&&(g=new Zu({next:pt=>yt.next(pt),error:pt=>{k=!0,B(),v=Fa($,i,pt),yt.error(pt)},complete:()=>{A=!0,B(),v=Fa($,s),yt.complete()}}),En(Q).subscribe(g))})(f)}}function Fa(e,o,...i){if(!0===o)return void e();if(!1===o)return;const s=new Zu({next:()=>{s.unsubscribe(),e()}});return En(o(...i)).subscribe(s)}function Gr(e,o){return ar((i,s)=>{let c=null,f=0,g=!1;const v=()=>g&&!c&&s.complete();i.subscribe(Di(s,w=>{c?.unsubscribe();let T=0;const A=f++;En(e(w,A)).subscribe(c=Di(s,k=>s.next(o?o(w,k,A,T++):k),()=>{c=null,v()}))},()=>{g=!0,v()}))})}function Ku(e,o=xl){return e=e??hE,ar((i,s)=>{let c,f=!0;i.subscribe(Di(s,g=>{const v=o(g);(f||!e(c,v))&&(f=!1,c=v,s.next(g))}))})}function hE(e,o){return e===o}function wi(e){for(let o in e)if(e[o]===wi)return o;throw Error("Could not find renamed property on target object.")}function ap(e,o){for(const i in o)o.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=o[i])}function Or(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Or).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const o=e.toString();if(null==o)return""+o;const i=o.indexOf("\n");return-1===i?o:o.substring(0,i)}function lp(e,o){return null==e||""===e?null===o?"":o:null==o||""===o?e:e+" "+o}const cp=wi({__forward_ref__:wi});function Ii(e){return e.__forward_ref__=Ii,e.toString=function(){return Or(this())},e}function Qe(e){return Gg(e)?e():e}function Gg(e){return"function"==typeof e&&e.hasOwnProperty(cp)&&e.__forward_ref__===Ii}function qg(e){return e&&!!e.\u0275providers}const St="https://g.co/ng/security#xss";class at extends Error{constructor(o,i){super(function $i(e,o){return`NG0${Math.abs(e)}${o?": "+o:""}`}(o,i)),this.code=o}}function J(e){return"string"==typeof e?e:null==e?"":String(e)}function La(e,o){throw new at(-201,!1)}function Vo(e,o){null==e&&function Se(e,o,i,s){throw new Error(`ASSERTION ERROR: ${e}`+(null==s?"":` [Expected=> ${i} ${s} ${o} <=Actual]`))}(o,e,null,"!=")}function ee(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function gi(e){return{providers:e.providers||[],imports:e.imports||[]}}function up(e){return Jg(e,Do)||Jg(e,t_)}function Jg(e,o){return e.hasOwnProperty(o)?e[o]:null}function rh(e){return e&&(e.hasOwnProperty(Ne)||e.hasOwnProperty(y0))?e[Ne]:null}const Do=wi({\u0275prov:wi}),Ne=wi({\u0275inj:wi}),t_=wi({ngInjectableDef:wi}),y0=wi({ngInjectorDef:wi});var Ke=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Ke||{});let ys;function qr(e){const o=ys;return ys=e,o}function Sr(e,o,i){const s=up(e);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:i&Ke.Optional?null:void 0!==o?o:void La(Or(e))}const Vi=globalThis;class $t{constructor(o,i){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=ee({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const vs={},ah="__NG_DI_FLAG__",fp="ngTempTokenPath",qI=/\n/gm,lh="__source";let ch;function hc(e){const o=ch;return ch=e,o}function i_(e,o=Ke.Default){if(void 0===ch)throw new at(-203,!1);return null===ch?Sr(e,void 0,o):ch.get(e,o&Ke.Optional?null:void 0,o)}function bt(e,o=Ke.Default){return(function v0(){return ys}()||i_)(Qe(e),o)}function ne(e,o=Ke.Default){return bt(e,r_(o))}function r_(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function o_(e){const o=[];for(let i=0;i<e.length;i++){const s=Qe(e[i]);if(Array.isArray(s)){if(0===s.length)throw new at(900,!1);let c,f=Ke.Default;for(let g=0;g<s.length;g++){const v=s[g],w=b0(v);"number"==typeof w?-1===w?c=v.token:f|=w:c=v}o.push(bt(c,f))}else o.push(bt(s))}return o}function mp(e,o){return e[ah]=o,e.prototype[ah]=o,e}function b0(e){return e[ah]}function El(e){return{toString:e}.toString()}var gp=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(gp||{}),jo=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(jo||{});const da={},ri=[],dh=wi({\u0275cmp:wi}),s_=wi({\u0275dir:wi}),_p=wi({\u0275pipe:wi}),dt=wi({\u0275mod:wi}),Cl=wi({\u0275fac:wi}),td=wi({__NG_ELEMENT_ID__:wi}),a_=wi({__NG_ENV_ID__:wi});function w0(e,o,i){let s=e.length;for(;;){const c=e.indexOf(o,i);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const f=o.length;if(c+f===s||e.charCodeAt(c+f)<=32)return c}i=c+1}}function hh(e,o,i){let s=0;for(;s<i.length;){const c=i[s];if("number"==typeof c){if(0!==c)break;s++;const f=i[s++],g=i[s++],v=i[s++];e.setAttribute(o,g,v,f)}else{const f=c,g=i[++s];l_(f)?e.setProperty(o,f,g):e.setAttribute(o,f,g),s++}}return s}function Ml(e){return 3===e||4===e||6===e}function l_(e){return 64===e.charCodeAt(0)}function Ba(e,o){if(null!==o&&0!==o.length)if(null===e||0===e.length)e=o.slice();else{let i=-1;for(let s=0;s<o.length;s++){const c=o[s];"number"==typeof c?i=c:0===i||yp(e,i,c,null,-1===i||2===i?o[++s]:null)}}return e}function yp(e,o,i,s,c){let f=0,g=e.length;if(-1===o)g=-1;else for(;f<e.length;){const v=e[f++];if("number"==typeof v){if(v===o){g=-1;break}if(v>o){g=f-1;break}}}for(;f<e.length;){const v=e[f];if("number"==typeof v)break;if(v===i){if(null===s)return void(null!==c&&(e[f+1]=c));if(s===e[f+1])return void(e[f+2]=c)}f++,null!==s&&f++,null!==c&&f++}-1!==g&&(e.splice(g,0,o),f=g+1),e.splice(f++,0,i),null!==s&&e.splice(f++,0,s),null!==c&&e.splice(f++,0,c)}const ed="ng-template";function E0(e,o,i){let s=0,c=!0;for(;s<e.length;){let f=e[s++];if("string"==typeof f&&c){const g=e[s++];if(i&&"class"===f&&-1!==w0(g.toLowerCase(),o,0))return!0}else{if(1===f){for(;s<e.length&&"string"==typeof(f=e[s++]);)if(f.toLowerCase()===o)return!0;return!1}"number"==typeof f&&(c=!1)}}return!1}function yE(e){return 4===e.type&&e.value!==ed}function vE(e,o,i){return o===(4!==e.type||i?e.value:ed)}function xE(e,o,i){let s=4;const c=e.attrs||[],f=function XI(e){for(let o=0;o<e.length;o++)if(Ml(e[o]))return o;return e.length}(c);let g=!1;for(let v=0;v<o.length;v++){const w=o[v];if("number"!=typeof w){if(!g)if(4&s){if(s=2|1&s,""!==w&&!vE(e,w,i)||""===w&&1===o.length){if(js(s))return!1;g=!0}}else{const T=8&s?w:o[++v];if(8&s&&null!==e.attrs){if(!E0(e.attrs,T,i)){if(js(s))return!1;g=!0}continue}const k=WI(8&s?"class":w,c,yE(e),i);if(-1===k){if(js(s))return!1;g=!0;continue}if(""!==T){let B;B=k>f?"":c[k+1].toLowerCase();const $=8&s?B:null;if($&&-1!==w0($,T,0)||2&s&&T!==B){if(js(s))return!1;g=!0}}}}else{if(!g&&!js(s)&&!js(w))return!1;if(g&&js(w))continue;g=!1,s=w|1&s}}return js(s)||g}function js(e){return 0==(1&e)}function WI(e,o,i,s){if(null===o)return-1;let c=0;if(s||!i){let f=!1;for(;c<o.length;){const g=o[c];if(g===e)return c;if(3===g||6===g)f=!0;else{if(1===g||2===g){let v=o[++c];for(;"string"==typeof v;)v=o[++c];continue}if(4===g)break;if(0===g){c+=4;continue}}c+=f?1:2}return-1}return function wE(e,o){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){const s=e[i];if("number"==typeof s)return-1;if(s===o)return i;i++}return-1}(o,e)}function bE(e,o,i=!1){for(let s=0;s<o.length;s++)if(xE(e,o[s],i))return!0;return!1}function YI(e,o){t:for(let i=0;i<o.length;i++){const s=o[i];if(e.length===s.length){for(let c=0;c<e.length;c++)if(e[c]!==s[c])continue t;return!0}}return!1}function vp(e,o){return e?":not("+o.trim()+")":o}function KI(e){let o=e[0],i=1,s=2,c="",f=!1;for(;i<e.length;){let g=e[i];if("string"==typeof g)if(2&s){const v=e[++i];c+="["+g+(v.length>0?'="'+v+'"':"")+"]"}else 8&s?c+="."+g:4&s&&(c+=" "+g);else""!==c&&!js(g)&&(o+=vp(f,c),c=""),s=g,f=f||!js(s);i++}return""!==c&&(o+=vp(f,c)),o}function os(e){return El(()=>{const o=d_(e),i={...o,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===gp.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||jo.Emulated,styles:e.styles||ri,_:null,schemas:e.schemas||null,tView:null,id:""};h_(i);const s=e.dependencies;return i.directiveDefs=_e(s,!1),i.pipeDefs=_e(s,!0),i.id=function f_(e){let o=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const c of i)o=Math.imul(31,o)+c.charCodeAt(0)<<0;return o+=2147483648,"c"+o}(i),i})}function xp(e){return Kn(e)||Zr(e)}function S0(e){return null!==e}function ci(e){return El(()=>({type:e.type,bootstrap:e.bootstrap||ri,declarations:e.declarations||ri,imports:e.imports||ri,exports:e.exports||ri,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function u_(e,o){if(null==e)return da;const i={};for(const s in e)if(e.hasOwnProperty(s)){let c=e[s],f=c;Array.isArray(c)&&(f=c[1],c=c[0]),i[c]=s,o&&(o[c]=f)}return i}function Ee(e){return El(()=>{const o=d_(e);return h_(o),o})}function Kn(e){return e[dh]||null}function Zr(e){return e[s_]||null}function Ho(e){return e[_p]||null}function $o(e,o){const i=e[dt]||null;if(!i&&!0===o)throw new Error(`Type ${Or(e)} does not have '\u0275mod' property.`);return i}function d_(e){const o={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:o,inputTransforms:null,inputConfig:e.inputs||da,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||ri,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:u_(e.inputs,o),outputs:u_(e.outputs)}}function h_(e){e.features?.forEach(o=>o(e))}function _e(e,o){if(!e)return null;const i=o?Ho:xp;return()=>("function"==typeof e?e():e).map(s=>i(s)).filter(S0)}const yr=0,he=1,fn=2,Ai=3,ha=4,bp=5,Go=6,fh=7,vr=8,Sl=9,au=10,nn=11,ph=12,T0=13,mh=14,tr=15,fc=16,nd=17,Us=18,id=19,Va=20,Tl=21,Dl=22,rd=23,gh=24,kn=25,wp=1,ME=2,Hs=7,lu=9,Xr=11;function Io(e){return Array.isArray(e)&&"object"==typeof e[wp]}function ss(e){return Array.isArray(e)&&!0===e[wp]}function m_(e){return 0!=(4&e.flags)}function cu(e){return e.componentOffset>-1}function pc(e){return 1==(1&e.flags)}function ja(e){return!!e.template}function D0(e){return 0!=(512&e[fn])}function Il(e,o){return e.hasOwnProperty(Cl)?e[Cl]:null}let Ao=null,y_=!1;function $s(e){const o=Ao;return Ao=e,o}const RE={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Cp(e){if(!xh(e)||e.dirty){if(!e.producerMustRecompute(e)&&!Tp(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function gc(e){e.dirty=!0,function mc(e){if(void 0===e.liveConsumerNode)return;const o=y_;y_=!0;try{for(const i of e.liveConsumerNode)i.dirty||gc(i)}finally{y_=o}}(e),e.consumerMarkedDirty?.(e)}function Sp(e){return e&&(e.nextProducerIndex=0),$s(e)}function vh(e,o){if($s(o),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(xh(e))for(let i=e.nextProducerIndex;i<e.producerNode.length;i++)Dp(e.producerNode[i],e.producerIndexOfThis[i]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Tp(e){fa(e);for(let o=0;o<e.producerNode.length;o++){const i=e.producerNode[o],s=e.producerLastReadVersion[o];if(s!==i.version||(Cp(i),s!==i.version))return!0}return!1}function Gs(e){if(fa(e),xh(e))for(let o=0;o<e.producerNode.length;o++)Dp(e.producerNode[o],e.producerIndexOfThis[o]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function Dp(e,o){if(function P0(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),fa(e),1===e.liveConsumerNode.length)for(let s=0;s<e.producerNode.length;s++)Dp(e.producerNode[s],e.producerIndexOfThis[s]);const i=e.liveConsumerNode.length-1;if(e.liveConsumerNode[o]=e.liveConsumerNode[i],e.liveConsumerIndexOfThis[o]=e.liveConsumerIndexOfThis[i],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,o<e.liveConsumerNode.length){const s=e.liveConsumerIndexOfThis[o],c=e.liveConsumerNode[o];fa(c),c.producerIndexOfThis[s]=o}}function xh(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function fa(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let FE=null;const od=()=>{},HE=(()=>({...RE,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:od}))();class dA{constructor(o,i,s){this.previousValue=o,this.currentValue=i,this.firstChange=s}isFirstChange(){return this.firstChange}}function qo(){return N0}function N0(e){return e.type.prototype.ngOnChanges&&(e.setInput=GE),$E}function $E(){const e=B0(this),o=e?.current;if(o){const i=e.previous;if(i===da)e.previous=o;else for(let s in o)i[s]=o[s];e.current=null,this.ngOnChanges(o)}}function GE(e,o,i,s){const c=this.declaredInputs[i],f=B0(e)||function Yr(e,o){return e[z0]=o}(e,{previous:da,current:null}),g=f.current||(f.current={}),v=f.previous,w=v[c];g[c]=new dA(w&&w.currentValue,o,v===da),e[s]=o}qo.ngInherit=!0;const z0="__ngSimpleChanges__";function B0(e){return e[z0]||null}const as=function(e,o,i){},WE="svg";function Ki(e){for(;Array.isArray(e);)e=e[yr];return e}function b_(e,o){return Ki(o[e])}function xs(e,o){return Ki(o[e.index])}function XE(e,o){return e.data[o]}function qs(e,o){const i=o[e];return Io(i)?i:i[yr]}function ls(e,o){return null==o?null:e[o]}function Ha(e){e[nd]=0}function Eh(e){1024&e[fn]||(e[fn]|=1024,Xt(e,1))}function Rp(e){1024&e[fn]&&(e[fn]&=-1025,Xt(e,-1))}function Xt(e,o){let i=e[Ai];if(null===i)return;i[bp]+=o;let s=i;for(i=i[Ai];null!==i&&(1===o&&1===s[bp]||-1===o&&0===s[bp]);)i[bp]+=o,s=i,i=i[Ai]}const qe={lFrame:_i(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function E_(){return qe.bindingsEnabled}function ad(){return null!==qe.skipHydrationRootTNode}function Nt(){return qe.lFrame.lView}function Wn(){return qe.lFrame.tView}function Wo(e){return qe.lFrame.contextLView=e,e[vr]}function Al(e){return qe.lFrame.contextLView=null,e}function fo(){let e=C_();for(;null!==e&&64===e.type;)e=e.parent;return e}function C_(){return qe.lFrame.currentTNode}function pa(e,o){const i=qe.lFrame;i.currentTNode=e,i.isParent=o}function M_(){return qe.lFrame.isParent}function bs(){qe.lFrame.isParent=!1}function Ch(){return qe.lFrame.bindingIndex++}function ws(e){const o=qe.lFrame,i=o.bindingIndex;return o.bindingIndex=o.bindingIndex+e,i}function se(e,o){const i=qe.lFrame;i.bindingIndex=i.bindingRootIndex=e,Ci(o)}function Ci(e){qe.lFrame.currentDirectiveIndex=e}function T_(){return qe.lFrame.currentQueryIndex}function D_(e){qe.lFrame.currentQueryIndex=e}function Ws(e){const o=e[he];return 2===o.type?o.declTNode:1===o.type?e[Go]:null}function JE(e,o,i){if(i&Ke.SkipSelf){let c=o,f=e;for(;!(c=c.parent,null!==c||i&Ke.Host||(c=Ws(f),null===c||(f=f[mh],10&c.type))););if(null===c)return!1;o=c,e=f}const s=qe.lFrame=kp();return s.currentTNode=o,s.lView=e,!0}function X0(e){const o=kp(),i=e[he];qe.lFrame=o,o.currentTNode=i.firstChild,o.lView=e,o.tView=i,o.contextLView=e,o.bindingIndex=i.bindingStartIndex,o.inI18n=!1}function kp(){const e=qe.lFrame,o=null===e?null:e.child;return null===o?_i(e):o}function _i(e){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=o),o}function yn(){const e=qe.lFrame;return qe.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Y0=yn;function Zo(){const e=yn();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Ro(){return qe.lFrame.selectedIndex}function _c(e){qe.lFrame.selectedIndex=e}function Mi(){const e=qe.lFrame;return XE(e.tView,e.selectedIndex)}function Pl(){qe.lFrame.currentNamespace=WE}let P_=!0;function $a(){return P_}function Ol(e){P_=e}function Mh(e,o){for(let i=o.directiveStart,s=o.directiveEnd;i<s;i++){const f=e.data[i].type.prototype,{ngAfterContentInit:g,ngAfterContentChecked:v,ngAfterViewInit:w,ngAfterViewChecked:T,ngOnDestroy:A}=f;g&&(e.contentHooks??=[]).push(-i,g),v&&((e.contentHooks??=[]).push(i,v),(e.contentCheckHooks??=[]).push(i,v)),w&&(e.viewHooks??=[]).push(-i,w),T&&((e.viewHooks??=[]).push(i,T),(e.viewCheckHooks??=[]).push(i,T)),null!=A&&(e.destroyHooks??=[]).push(i,A)}}function Sh(e,o,i){k_(e,o,3,i)}function Ga(e,o,i,s){(3&e[fn])===i&&k_(e,o,i,s)}function er(e,o){let i=e[fn];(3&i)===o&&(i&=8191,i+=1,e[fn]=i)}function k_(e,o,i,s){const f=s??-1,g=o.length-1;let v=0;for(let w=void 0!==s?65535&e[nd]:0;w<g;w++)if("number"==typeof o[w+1]){if(v=o[w],null!=s&&v>=s)break}else o[w]<0&&(e[nd]+=65536),(v<f||-1==f)&&(Lp(e,i,o,w),e[nd]=(4294901760&e[nd])+w+2),w++}function F_(e,o){as(4,e,o);const i=$s(null);try{o.call(e)}finally{$s(i),as(5,e,o)}}function Lp(e,o,i,s){const c=i[s]<0,f=i[s+1],v=e[c?-i[s]:i[s]];c?e[fn]>>13<e[nd]>>16&&(3&e[fn])===o&&(e[fn]+=8192,F_(v,f)):F_(v,f)}const ma=-1;class ud{constructor(o,i,s){this.factory=o,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=s}}function z_(e){return e!==ma}function Th(e){return 32767&e}function Dh(e,o){let i=function eC(e){return e>>16}(e),s=o;for(;i>0;)s=s[mh],i--;return s}let B_=!0;function Np(e){const o=B_;return B_=e,o}const tx=255,ex=5;let vA=0;const kl={};function zp(e,o){const i=nC(e,o);if(-1!==i)return i;const s=o[he];s.firstCreatePass&&(e.injectorIndex=o.length,nx(s.data,e),nx(o,null),nx(s.blueprint,null));const c=hd(e,o),f=e.injectorIndex;if(z_(c)){const g=Th(c),v=Dh(c,o),w=v[he].data;for(let T=0;T<8;T++)o[f+T]=v[g+T]|w[g+T]}return o[f+8]=c,f}function nx(e,o){e.push(0,0,0,0,0,0,0,0,o)}function nC(e,o){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===o[e.injectorIndex+8]?-1:e.injectorIndex}function hd(e,o){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let i=0,s=null,c=o;for(;null!==c;){if(s=rC(c),null===s)return ma;if(i++,c=c[mh],-1!==s.injectorIndex)return s.injectorIndex|i<<16}return ma}function V_(e,o,i){!function Bn(e,o,i){let s;"string"==typeof i?s=i.charCodeAt(0)||0:i.hasOwnProperty(td)&&(s=i[td]),null==s&&(s=i[td]=vA++);const c=s&tx;o.data[e+(c>>ex)]|=1<<c}(e,o,i)}function ix(e,o,i){if(i&Ke.Optional||void 0!==e)return e;La()}function rx(e,o,i,s){if(i&Ke.Optional&&void 0===s&&(s=null),!(i&(Ke.Self|Ke.Host))){const c=e[Sl],f=qr(void 0);try{return c?c.get(o,s,i&Ke.Optional):Sr(o,s,i&Ke.Optional)}finally{qr(f)}}return ix(s,0,i)}function iC(e,o,i,s=Ke.Default,c){if(null!==e){if(2048&o[fn]&&!(s&Ke.Self)){const g=function De(e,o,i,s,c){let f=e,g=o;for(;null!==f&&null!==g&&2048&g[fn]&&!(512&g[fn]);){const v=j_(f,g,i,s|Ke.Self,kl);if(v!==kl)return v;let w=f.parent;if(!w){const T=g[Va];if(T){const A=T.get(i,kl,s);if(A!==kl)return A}w=rC(g),g=g[mh]}f=w}return c}(e,o,i,s,kl);if(g!==kl)return g}const f=j_(e,o,i,s,kl);if(f!==kl)return f}return rx(o,i,s,c)}function j_(e,o,i,s,c){const f=function U_(e){if("string"==typeof e)return e.charCodeAt(0)||0;const o=e.hasOwnProperty(td)?e[td]:void 0;return"number"==typeof o?o>=0?o&tx:Es:o}(i);if("function"==typeof f){if(!JE(o,e,s))return s&Ke.Host?ix(c,0,s):rx(o,i,s,c);try{let g;if(g=f(s),null!=g||s&Ke.Optional)return g;La()}finally{Y0()}}else if("number"==typeof f){let g=null,v=nC(e,o),w=ma,T=s&Ke.Host?o[tr][Go]:null;for((-1===v||s&Ke.SkipSelf)&&(w=-1===v?hd(e,o):o[v+8],w!==ma&&$e(s,!1)?(g=o[he],v=Th(w),o=Dh(w,o)):v=-1);-1!==v;){const A=o[he];if(Fl(f,v,A.data)){const k=Bp(v,o,i,g,s,T);if(k!==kl)return k}w=o[v+8],w!==ma&&$e(s,o[he].data[v+8]===T)&&Fl(f,v,o)?(g=A,v=Th(w),o=Dh(w,o)):v=-1}}return c}function Bp(e,o,i,s,c,f){const g=o[he],v=g.data[e+8],A=Vp(v,g,i,null==s?cu(v)&&B_:s!=g&&0!=(3&v.type),c&Ke.Host&&f===v);return null!==A?yc(o,g,A,v):kl}function Vp(e,o,i,s,c){const f=e.providerIndexes,g=o.data,v=1048575&f,w=e.directiveStart,A=f>>20,B=c?v+A:e.directiveEnd;for(let $=s?v:v+A;$<B;$++){const K=g[$];if($<w&&i===K||$>=w&&K.type===i)return $}if(c){const $=g[w];if($&&ja($)&&$.type===i)return w}return null}function yc(e,o,i,s){let c=e[i];const f=o.data;if(function J0(e){return e instanceof ud}(c)){const g=c;g.resolving&&function Ju(e,o){const i=o?`. Dependency path: ${o.join(" > ")} > ${e}`:"";throw new at(-200,`Circular dependency in DI detected for ${e}${i}`)}(function It(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():J(e)}(f[i]));const v=Np(g.canSeeViewProviders);g.resolving=!0;const T=g.injectImpl?qr(g.injectImpl):null;JE(e,s,Ke.Default);try{c=e[i]=g.factory(void 0,f,e,s),o.firstCreatePass&&i>=s.directiveStart&&function O_(e,o,i){const{ngOnChanges:s,ngOnInit:c,ngDoCheck:f}=o.type.prototype;if(s){const g=N0(o);(i.preOrderHooks??=[]).push(e,g),(i.preOrderCheckHooks??=[]).push(e,g)}c&&(i.preOrderHooks??=[]).push(0-e,c),f&&((i.preOrderHooks??=[]).push(e,f),(i.preOrderCheckHooks??=[]).push(e,f))}(i,f[i],o)}finally{null!==T&&qr(T),Np(v),g.resolving=!1,Y0()}}return c}function Fl(e,o,i){return!!(i[o+(e>>ex)]&1<<e)}function $e(e,o){return!(e&Ke.Self||e&Ke.Host&&o)}class me{constructor(o,i){this._tNode=o,this._lView=i}get(o,i,s){return iC(this._tNode,this._lView,o,r_(s),i)}}function Es(){return new me(fo(),Nt())}function xr(e){return El(()=>{const o=e.prototype.constructor,i=o[Cl]||ox(o),s=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==s;){const f=c[Cl]||ox(c);if(f&&f!==i)return f;c=Object.getPrototypeOf(c)}return f=>new f})}function ox(e){return Gg(e)?()=>{const o=ox(Qe(e));return o&&o()}:Il(e)}function rC(e){const o=e[he],i=o.type;return 2===i?o.declTNode:1===i?e[Go]:null}function fd(e){return function xA(e,o){if("class"===o)return e.classes;if("style"===o)return e.styles;const i=e.attrs;if(i){const s=i.length;let c=0;for(;c<s;){const f=i[c];if(Ml(f))break;if(0===f)c+=2;else if("number"==typeof f)for(c++;c<s&&"string"==typeof i[c];)c++;else{if(f===o)return i[c+1];c+=2}}}return null}(fo(),e)}const hu="__parameters__";function Cs(e,o,i){return El(()=>{const s=function pu(e){return function(...i){if(e){const s=e(...i);for(const c in s)this[c]=s[c]}}}(o);function c(...f){if(this instanceof c)return s.apply(this,f),this;const g=new c(...f);return v.annotation=g,v;function v(w,T,A){const k=w.hasOwnProperty(hu)?w[hu]:Object.defineProperty(w,hu,{value:[]})[hu];for(;k.length<=A;)k.push(null);return(k[A]=k[A]||[]).push(g),w}}return i&&(c.prototype=Object.create(i.prototype)),c.prototype.ngMetadataName=e,c.annotationCls=c,c})}function Jn(e,o){e.forEach(i=>Array.isArray(i)?Jn(i,o):o(i))}function H_(e,o,i){o>=e.length?e.push(i):e.splice(o,0,i)}function qa(e,o){return o>=e.length-1?e.pop():e.splice(o,1)[0]}function Oh(e,o){const i=[];for(let s=0;s<e;s++)i.push(o);return i}function Tr(e,o,i){let s=gd(e,o);return s>=0?e[1|s]=i:(s=~s,function Ri(e,o,i,s){let c=e.length;if(c==o)e.push(i,s);else if(1===c)e.push(s,e[0]),e[0]=i;else{for(c--,e.push(e[c-1],e[c]);c>o;)e[c]=e[c-2],c--;e[o]=i,e[o+1]=s}}(e,s,o,i)),s}function $_(e,o){const i=gd(e,o);if(i>=0)return e[1|i]}function gd(e,o){return function Vn(e,o,i){let s=0,c=e.length>>i;for(;c!==s;){const f=s+(c-s>>1),g=e[f<<i];if(o===g)return f<<i;g>o?c=f:s=f+1}return~(c<<i)}(e,o,1)}const gu=mp(Cs("Optional"),8),kh=mp(Cs("SkipSelf"),4);function Gp(e){return 128==(128&e.flags)}var vc=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(vc||{});const EC=/^>|^->|<!--|-->|--!>|<!-$/g,CC=/(<|>)/g,MC="\u200b$1\u200b";const qp=new Map;let Wa=0;const Ye="__ngContext__";function po(e,o){Io(o)?(e[Ye]=o[id],function TC(e){qp.set(e[id],e)}(o)):e[Ye]=o}let ze;function Wp(e,o){return ze(e,o)}function Nh(e){const o=e[Ai];return ss(o)?o[Ai]:o}function vx(e){return bx(e[ph])}function xx(e){return bx(e[ha])}function bx(e){for(;null!==e&&!ss(e);)e=e[ha];return e}function xd(e,o,i,s,c){if(null!=s){let f,g=!1;ss(s)?f=s:Io(s)&&(g=!0,s=s[yr]);const v=Ki(s);0===e&&null!==i?null==c?NC(o,i,v):q(o,i,v,c||null,!0):1===e&&null!==i?q(o,i,v,c||null,!0):2===e?function jh(e,o,i){const s=bd(e,o);s&&function Bl(e,o,i,s){e.removeChild(o,i,s)}(e,s,o,i)}(o,v,g):3===e&&o.destroyNode(v),null!=f&&function ui(e,o,i,s,c){const f=i[Hs];f!==Ki(i)&&xd(o,e,s,f,c);for(let v=Xr;v<i.length;v++){const w=i[v];Hh(w[he],w,e,o,s,f)}}(o,e,f,i,c)}}function Ex(e,o){return e.createComment(function fx(e){return e.replace(EC,o=>o.replace(CC,MC))}(o))}function zh(e,o,i){return e.createElement(o,i)}function Yo(e,o){const i=e[lu],s=i.indexOf(o);Rp(o),i.splice(s,1)}function K_(e,o){if(e.length<=Xr)return;const i=Xr+o,s=e[i];if(s){const c=s[fc];null!==c&&c!==e&&Yo(c,s),o>0&&(e[i-1][ha]=s[ha]);const f=qa(e,Xr+o);!function Ln(e,o){Hh(e,o,o[nn],2,null,null),o[yr]=null,o[Go]=null}(s[he],s);const g=f[Us];null!==g&&g.detachView(f[he]),s[Ai]=null,s[ha]=null,s[fn]&=-129}return s}function rt(e,o){if(!(256&o[fn])){const i=o[nn];o[rd]&&Gs(o[rd]),o[gh]&&Gs(o[gh]),i.destroyNode&&Hh(e,o,i,3,null,null),function Bh(e){let o=e[ph];if(!o)return Cx(e[he],e);for(;o;){let i=null;if(Io(o))i=o[ph];else{const s=o[Xr];s&&(i=s)}if(!i){for(;o&&!o[ha]&&o!==e;)Io(o)&&Cx(o[he],o),o=o[Ai];null===o&&(o=e),Io(o)&&Cx(o[he],o),i=o&&o[ha]}o=i}}(o)}}function Cx(e,o){if(!(256&o[fn])){o[fn]&=-129,o[fn]|=256,function NA(e,o){let i;if(null!=e&&null!=(i=e.destroyHooks))for(let s=0;s<i.length;s+=2){const c=o[i[s]];if(!(c instanceof ud)){const f=i[s+1];if(Array.isArray(f))for(let g=0;g<f.length;g+=2){const v=c[f[g]],w=f[g+1];as(4,v,w);try{w.call(v)}finally{as(5,v,w)}}else{as(4,c,f);try{f.call(c)}finally{as(5,c,f)}}}}}(e,o),function to(e,o){const i=e.cleanup,s=o[fh];if(null!==i)for(let f=0;f<i.length-1;f+=2)if("string"==typeof i[f]){const g=i[f+3];g>=0?s[g]():s[-g].unsubscribe(),f+=2}else i[f].call(s[i[f+1]]);null!==s&&(o[fh]=null);const c=o[Tl];if(null!==c){o[Tl]=null;for(let f=0;f<c.length;f++)(0,c[f])()}}(e,o),1===o[he].type&&o[nn].destroy();const i=o[fc];if(null!==i&&ss(o[Ai])){i!==o[Ai]&&Yo(i,o);const s=o[Us];null!==s&&s.detachView(e)}!function px(e){qp.delete(e[id])}(o)}}function Mx(e,o,i){return function LC(e,o,i){let s=o;for(;null!==s&&40&s.type;)s=(o=s).parent;if(null===s)return i[yr];{const{componentOffset:c}=s;if(c>-1){const{encapsulation:f}=e.data[s.directiveStart+c];if(f===jo.None||f===jo.Emulated)return null}return xs(s,i)}}(e,o.parent,i)}function q(e,o,i,s,c){e.insertBefore(o,i,s,c)}function NC(e,o,i){e.appendChild(o,i)}function Sx(e,o,i,s,c){null!==s?q(e,o,i,s,c):NC(e,o,i)}function bd(e,o){return e.parentNode(o)}function xc(e,o,i){return BC(e,o,i)}let ya,wc,Ax,BC=function Tx(e,o,i){return 40&e.type?xs(e,i):null};function tn(e,o,i,s){const c=Mx(e,s,o),f=o[nn],v=xc(s.parent||o[Go],s,o);if(null!=c)if(Array.isArray(i))for(let w=0;w<i.length;w++)Sx(f,c,i[w],v,!1);else Sx(f,c,i,v,!1);void 0!==ya&&ya(f,s,o,i,c)}function bc(e,o){if(null!==o){const i=o.type;if(3&i)return xs(o,e);if(4&i)return Vh(-1,e[o.index]);if(8&i){const s=o.child;if(null!==s)return bc(e,s);{const c=e[o.index];return ss(c)?Vh(-1,c):Ki(c)}}if(32&i)return Wp(o,e)()||Ki(e[o.index]);{const s=Dx(e,o);return null!==s?Array.isArray(s)?s[0]:bc(Nh(e[tr]),s):bc(e,o.next)}}return null}function Dx(e,o){return null!==o?e[tr][Go].projection[o.projection]:null}function Vh(e,o){const i=Xr+e+1;if(i<o.length){const s=o[i],c=s[he].firstChild;if(null!==c)return bc(s,c)}return o[Hs]}function Q_(e,o,i,s,c,f,g){for(;null!=i;){const v=s[i.index],w=i.type;if(g&&0===o&&(v&&po(Ki(v),s),i.flags|=2),32!=(32&i.flags))if(8&w)Q_(e,o,i.child,s,c,f,!1),xd(o,e,c,v,f);else if(32&w){const T=Wp(i,s);let A;for(;A=T();)xd(o,e,c,A,f);xd(o,e,c,v,f)}else 16&w?Vl(e,o,s,i,c,f):xd(o,e,c,v,f);i=g?i.projectionNext:i.next}}function Hh(e,o,i,s,c,f){Q_(i,s,e.firstChild,o,c,f,!1)}function Vl(e,o,i,s,c,f){const g=i[tr],w=g[Go].projection[s.projection];if(Array.isArray(w))for(let T=0;T<w.length;T++)xd(o,e,c,w[T],f);else{let T=w;const A=g[Ai];Gp(s)&&(T.flags|=128),Q_(e,o,T,A,c,f,!0)}}function Po(e,o,i){""===i?e.removeAttribute(o,"class"):e.setAttribute(o,"class",i)}function jC(e,o,i){const{mergedAttrs:s,classes:c,styles:f}=i;null!==s&&hh(e,o,s),null!==c&&Po(e,o,c),null!==f&&function _u(e,o,i){e.setAttribute(o,"style",i)}(e,o,f)}function Oo(e){return function Yp(){if(void 0===wc&&(wc=null,Vi.trustedTypes))try{wc=Vi.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return wc}()?.createHTML(e)||e}class Ec{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${St})`}}class $h extends Ec{getTypeName(){return"HTML"}}class cs extends Ec{getTypeName(){return"Style"}}class Jp extends Ec{getTypeName(){return"Script"}}class ny extends Ec{getTypeName(){return"URL"}}class HC extends Ec{getTypeName(){return"ResourceURL"}}function eo(e){return e instanceof Ec?e.changingThisBreaksApplicationSecurity:e}function ba(e,o){const i=function Ox(e){return e instanceof Ec&&e.getTypeName()||null}(e);if(null!=i&&i!==o){if("ResourceURL"===i&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${i} (see ${St})`)}return i===o}class BA{constructor(o){this.inertDocumentHelper=o}getInertBodyElement(o){o="<body><remove></remove>"+o;try{const i=(new window.DOMParser).parseFromString(Oo(o),"text/html").body;return null===i?this.inertDocumentHelper.getInertBodyElement(o):(i.removeChild(i.firstChild),i)}catch{return null}}}class XC{constructor(o){this.defaultDoc=o,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(o){const i=this.inertDocument.createElement("template");return i.innerHTML=Oo(o),i}}const iy=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Qp(e){return(e=String(e)).match(iy)?e:"unsafe:"+e}function Cc(e){const o={};for(const i of e.split(","))o[i]=!0;return o}function tm(...e){const o={};for(const i of e)for(const s in i)i.hasOwnProperty(s)&&(o[s]=!0);return o}const KC=Cc("area,br,col,hr,img,wbr"),wd=Cc("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ry=Cc("rp,rt"),kx=tm(KC,tm(wd,Cc("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),tm(ry,Cc("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),tm(ry,wd)),Gh=Cc("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Nn=tm(Gh,Cc("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Cc("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Ts=Cc("script,style,template");class lr{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(o){let i=o.firstChild,s=!0;for(;i;)if(i.nodeType===Node.ELEMENT_NODE?s=this.startElement(i):i.nodeType===Node.TEXT_NODE?this.chars(i.nodeValue):this.sanitizedSomething=!0,s&&i.firstChild)i=i.firstChild;else for(;i;){i.nodeType===Node.ELEMENT_NODE&&this.endElement(i);let c=this.checkClobberedElement(i,i.nextSibling);if(c){i=c;break}i=this.checkClobberedElement(i,i.parentNode)}return this.buf.join("")}startElement(o){const i=o.nodeName.toLowerCase();if(!kx.hasOwnProperty(i))return this.sanitizedSomething=!0,!Ts.hasOwnProperty(i);this.buf.push("<"),this.buf.push(i);const s=o.attributes;for(let c=0;c<s.length;c++){const f=s.item(c),g=f.name,v=g.toLowerCase();if(!Nn.hasOwnProperty(v)){this.sanitizedSomething=!0;continue}let w=f.value;Gh[v]&&(w=Qp(w)),this.buf.push(" ",g,'="',Fx(w),'"')}return this.buf.push(">"),!0}endElement(o){const i=o.nodeName.toLowerCase();kx.hasOwnProperty(i)&&!KC.hasOwnProperty(i)&&(this.buf.push("</"),this.buf.push(i),this.buf.push(">"))}chars(o){this.buf.push(Fx(o))}checkClobberedElement(o,i){if(i&&(o.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${o.outerHTML}`);return i}}const JC=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Gi=/([^\#-~ |!])/g;function Fx(e){return e.replace(/&/g,"&amp;").replace(JC,function(o){return"&#"+(1024*(o.charCodeAt(0)-55296)+(o.charCodeAt(1)-56320)+65536)+";"}).replace(Gi,function(o){return"&#"+o.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Za;function oy(e,o){let i=null;try{Za=Za||function ZC(e){const o=new XC(e);return function YC(){try{return!!(new window.DOMParser).parseFromString(Oo(""),"text/html")}catch{return!1}}()?new BA(o):o}(e);let s=o?String(o):"";i=Za.getInertBodyElement(s);let c=5,f=s;do{if(0===c)throw new Error("Failed to sanitize html because the input is unstable");c--,s=f,f=i.innerHTML,i=Za.getInertBodyElement(s)}while(s!==f);return Oo((new lr).sanitizeChildren(Cd(i)||i))}finally{if(i){const s=Cd(i)||i;for(;s.firstChild;)s.removeChild(s.firstChild)}}}function Cd(e){return"content"in e&&function Je(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var io=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(io||{});const nm=new $t("ENVIRONMENT_INITIALIZER"),zx=new $t("INJECTOR",-1),iM=new $t("INJECTOR_DEF_TYPES");class im{get(o,i=vs){if(i===vs){const s=new Error(`NullInjectorError: No provider for ${Or(o)}!`);throw s.name="NullInjectorError",s}return i}}function Vx(...e){return{\u0275providers:jx(0,e),\u0275fromNgModule:!0}}function jx(e,...o){const i=[],s=new Set;let c;const f=g=>{i.push(g)};return Jn(o,g=>{const v=g;Xa(v,f,[],s)&&(c||=[],c.push(v))}),void 0!==c&&Ux(c,f),i}function Ux(e,o){for(let i=0;i<e.length;i++){const{ngModule:s,providers:c}=e[i];Hx(c,f=>{o(f,s)})}}function Xa(e,o,i,s){if(!(e=Qe(e)))return!1;let c=null,f=rh(e);const g=!f&&Kn(e);if(f||g){if(g&&!g.standalone)return!1;c=e}else{const w=e.ngModule;if(f=rh(w),!f)return!1;c=w}const v=s.has(c);if(g){if(v)return!1;if(s.add(c),g.dependencies){const w="function"==typeof g.dependencies?g.dependencies():g.dependencies;for(const T of w)Xa(T,o,i,s)}}else{if(!f)return!1;{if(null!=f.imports&&!v){let T;s.add(c);try{Jn(f.imports,A=>{Xa(A,o,i,s)&&(T||=[],T.push(A))})}finally{}void 0!==T&&Ux(T,o)}if(!v){const T=Il(c)||(()=>new c);o({provide:c,useFactory:T,deps:ri},c),o({provide:iM,useValue:c,multi:!0},c),o({provide:nm,useValue:()=>bt(c),multi:!0},c)}const w=f.providers;if(null!=w&&!v){const T=e;Hx(w,A=>{o(A,T)})}}}return c!==e&&void 0!==e.providers}function Hx(e,o){for(let i of e)qg(i)&&(i=i.\u0275providers),Array.isArray(i)?Hx(i,o):o(i)}const Wh=wi({provide:String,useValue:wi});function rm(e){return null!==e&&"object"==typeof e&&Wh in e}function vu(e){return"function"==typeof e}const $x=new $t("Set Injector scope."),ay={},UA={};let Gx;function sm(){return void 0===Gx&&(Gx=new im),Gx}class Ds{}class Zh extends Ds{get destroyed(){return this._destroyed}constructor(o,i,s,c){super(),this.parent=i,this.source=s,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Pi(o,g=>this.processProvider(g)),this.records.set(zx,Sd(void 0,this)),c.has("environment")&&this.records.set(Ds,Sd(void 0,this));const f=this.records.get($x);null!=f&&"string"==typeof f.value&&this.scopes.add(f.value),this.injectorDefTypes=new Set(this.get(iM.multi,ri,Ke.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const o=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of o)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(o){return this.assertNotDestroyed(),this._onDestroyHooks.push(o),()=>this.removeOnDestroy(o)}runInContext(o){this.assertNotDestroyed();const i=hc(this),s=qr(void 0);try{return o()}finally{hc(i),qr(s)}}get(o,i=vs,s=Ke.Default){if(this.assertNotDestroyed(),o.hasOwnProperty(a_))return o[a_](this);s=r_(s);const f=hc(this),g=qr(void 0);try{if(!(s&Ke.SkipSelf)){let w=this.records.get(o);if(void 0===w){const T=function Mc(e){return"function"==typeof e||"object"==typeof e&&e instanceof $t}(o)&&up(o);w=T&&this.injectableDefInScope(T)?Sd(ly(o),ay):null,this.records.set(o,w)}if(null!=w)return this.hydrate(o,w)}return(s&Ke.Self?sm():this.parent).get(o,i=s&Ke.Optional&&i===vs?null:i)}catch(v){if("NullInjectorError"===v.name){if((v[fp]=v[fp]||[]).unshift(Or(o)),f)throw v;return function gE(e,o,i,s){const c=e[fp];throw o[lh]&&c.unshift(o[lh]),e.message=function _E(e,o,i,s=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=Or(o);if(Array.isArray(o))c=o.map(Or).join(" -> ");else if("object"==typeof o){let f=[];for(let g in o)if(o.hasOwnProperty(g)){let v=o[g];f.push(g+":"+("string"==typeof v?JSON.stringify(v):Or(v)))}c=`{${f.join(", ")}}`}return`${i}${s?"("+s+")":""}[${c}]: ${e.replace(qI,"\n  ")}`}("\n"+e.message,c,i,s),e.ngTokenPath=c,e[fp]=null,e}(v,o,"R3InjectorError",this.source)}throw v}finally{qr(g),hc(f)}}resolveInjectorInitializers(){const o=hc(this),i=qr(void 0);try{const c=this.get(nm.multi,ri,Ke.Self);for(const f of c)f()}finally{hc(o),qr(i)}}toString(){const o=[],i=this.records;for(const s of i.keys())o.push(Or(s));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new at(205,!1)}processProvider(o){let i=vu(o=Qe(o))?o:Qe(o&&o.provide);const s=function $A(e){return rm(e)?Sd(void 0,e.useValue):Sd(qx(e),ay)}(o);if(vu(o)||!0!==o.multi)this.records.get(i);else{let c=this.records.get(i);c||(c=Sd(void 0,ay,!0),c.factory=()=>o_(c.multi),this.records.set(i,c)),i=o,c.multi.push(o)}this.records.set(i,s)}hydrate(o,i){return i.value===ay&&(i.value=UA,i.value=i.factory()),"object"==typeof i.value&&i.value&&function Wx(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(o){if(!o.providedIn)return!1;const i=Qe(o.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(o){const i=this._onDestroyHooks.indexOf(o);-1!==i&&this._onDestroyHooks.splice(i,1)}}function ly(e){const o=up(e),i=null!==o?o.factory:Il(e);if(null!==i)return i;if(e instanceof $t)throw new at(204,!1);if(e instanceof Function)return function HA(e){const o=e.length;if(o>0)throw Oh(o,"?"),new at(204,!1);const i=function Qg(e){return e&&(e[Do]||e[t_])||null}(e);return null!==i?()=>i.factory(e):()=>new e}(e);throw new at(204,!1)}function qx(e,o,i){let s;if(vu(e)){const c=Qe(e);return Il(c)||ly(c)}if(rm(e))s=()=>Qe(e.useValue);else if(function om(e){return!(!e||!e.useFactory)}(e))s=()=>e.useFactory(...o_(e.deps||[]));else if(function Md(e){return!(!e||!e.useExisting)}(e))s=()=>bt(Qe(e.useExisting));else{const c=Qe(e&&(e.useClass||e.provide));if(!function oM(e){return!!e.deps}(e))return Il(c)||ly(c);s=()=>new c(...o_(e.deps))}return s}function Sd(e,o,i=!1){return{factory:e,value:o,multi:i?[]:void 0}}function Pi(e,o){for(const i of e)Array.isArray(i)?Pi(i,o):i&&qg(i)?Pi(i.\u0275providers,o):o(i)}const am=new $t("AppId",{providedIn:"root",factory:()=>GA}),GA="ng",sM=new $t("Platform Initializer"),Ya=new $t("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),xu=new $t("AnimationModuleType"),Zx=new $t("CSP nonce",{providedIn:"root",factory:()=>function ko(){if(void 0!==Ax)return Ax;if(typeof document<"u")return document;throw new at(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let dm=(e,o,i)=>null;function dy(e,o,i=!1){return dm(e,o,i)}class WA{}class uM{}class XA{resolveComponentFactory(o){throw function ZA(e){const o=Error(`No component factory found for ${Or(e)}.`);return o.ngComponent=e,o}(o)}}let pm=(()=>{class e{static#t=this.NULL=new XA}return e})();function my(){return Qh(fo(),Nt())}function Qh(e,o){return new Oi(xs(e,o))}let Oi=(()=>{class e{constructor(i){this.nativeElement=i}static#t=this.__NG_ELEMENT_ID__=my}return e})();function tf(e){return e instanceof Oi?e.nativeElement:e}class mm{}let Tc=(()=>{class e{constructor(){this.destroyNode=null}static#t=this.__NG_ELEMENT_ID__=()=>function YA(){const e=Nt(),i=qs(fo().index,e);return(Io(i)?i:e)[nn]}()}return e})(),hM=(()=>{class e{static#t=this.\u0275prov=ee({token:e,providedIn:"root",factory:()=>null})}return e})();class wu{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const KA=new wu("16.2.12"),rb={};function sb(e,o=null,i=null,s){const c=Ul(e,o,i,s);return c.resolveInjectorInitializers(),c}function Ul(e,o=null,i=null,s,c=new Set){const f=[i||ri,Vx(e)];return s=s||("object"==typeof e?void 0:Or(e)),new Zh(f,o||sm(),s||null,c)}let Fr=(()=>{class e{static#t=this.THROW_IF_NOT_FOUND=vs;static#e=this.NULL=new im;static create(i,s){if(Array.isArray(i))return sb({name:""},s,i,"");{const c=i.name??"";return sb({name:c},i.parent,i.providers,c)}}static#n=this.\u0275prov=ee({token:e,providedIn:"any",factory:()=>bt(zx)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();function lb(e){return e.ngOriginalError}class wa{constructor(){this._console=console}handleError(o){const i=this._findOriginalError(o);this._console.error("ERROR",o),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(o){let i=o&&lb(o);for(;i&&lb(i);)i=lb(i);return i||null}}function ub(e){return o=>{setTimeout(e,void 0,o)}}const oi=class t2 extends on{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,i,s){let c=o,f=i||(()=>null),g=s;if(o&&"object"==typeof o){const w=o;c=w.next?.bind(w),f=w.error?.bind(w),g=w.complete?.bind(w)}this.__isAsync&&(f=ub(f),c&&(c=ub(c)),g&&(g=ub(g)));const v=super.subscribe({next:c,error:f,complete:g});return o instanceof st&&o.add(v),v}};function vm(...e){}class Xe{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:s=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new oi(!1),this.onMicrotaskEmpty=new oi(!1),this.onStable=new oi(!1),this.onError=new oi(!1),typeof Zone>"u")throw new at(908,!1);Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!s&&i,c.shouldCoalesceRunChangeDetection=s,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function ef(){const e="function"==typeof Vi.requestAnimationFrame;let o=Vi[e?"requestAnimationFrame":"setTimeout"],i=Vi[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&o&&i){const s=o[Zone.__symbol__("OriginalDelegate")];s&&(o=s);const c=i[Zone.__symbol__("OriginalDelegate")];c&&(i=c)}return{nativeRequestAnimationFrame:o,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function gM(e){const o=()=>{!function r2(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Vi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,yy(e),e.isCheckStableRunning=!0,_y(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),yy(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,s,c,f,g,v)=>{if(function Eu(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(v))return i.invokeTask(c,f,g,v);try{return db(e),i.invokeTask(c,f,g,v)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===f.type||e.shouldCoalesceRunChangeDetection)&&o(),hb(e)}},onInvoke:(i,s,c,f,g,v,w)=>{try{return db(e),i.invoke(c,f,g,v,w)}finally{e.shouldCoalesceRunChangeDetection&&o(),hb(e)}},onHasTask:(i,s,c,f)=>{i.hasTask(c,f),s===c&&("microTask"==f.change?(e._hasPendingMicrotasks=f.microTask,yy(e),_y(e)):"macroTask"==f.change&&(e.hasPendingMacrotasks=f.macroTask))},onHandleError:(i,s,c,f)=>(i.handleError(c,f),e.runOutsideAngular(()=>e.onError.emit(f)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Xe.isInAngularZone())throw new at(909,!1)}static assertNotInAngularZone(){if(Xe.isInAngularZone())throw new at(909,!1)}run(o,i,s){return this._inner.run(o,i,s)}runTask(o,i,s,c){const f=this._inner,g=f.scheduleEventTask("NgZoneEvent: "+c,o,n2,vm,vm);try{return f.runTask(g,i,s)}finally{f.cancelTask(g)}}runGuarded(o,i,s){return this._inner.runGuarded(o,i,s)}runOutsideAngular(o){return this._outer.run(o)}}const n2={};function _y(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function yy(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function db(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function hb(e){e._nesting--,_y(e)}class _M{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new oi,this.onMicrotaskEmpty=new oi,this.onStable=new oi,this.onError=new oi}run(o,i,s){return o.apply(i,s)}runGuarded(o,i,s){return o.apply(i,s)}runOutsideAngular(o){return o()}runTask(o,i,s,c){return o.apply(i,s)}}const fb=new $t("",{providedIn:"root",factory:pb});function pb(){const e=ne(Xe);let o=!0;return uc(new $n(c=>{o=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{c.next(o),c.complete()})}),new $n(c=>{let f;e.runOutsideAngular(()=>{f=e.onStable.subscribe(()=>{Xe.assertNotInAngularZone(),queueMicrotask(()=>{!o&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(o=!0,c.next(!0))})})});const g=e.onUnstable.subscribe(()=>{Xe.assertInAngularZone(),o&&(o=!1,e.runOutsideAngular(()=>{c.next(!1)}))});return()=>{f.unsubscribe(),g.unsubscribe()}}).pipe(zn()))}function Dc(e){return e instanceof Function?e():e}let _b=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#t=this.\u0275prov=ee({token:e,providedIn:"root",factory:()=>new e})}return e})();function xm(e){for(;e;){e[fn]|=64;const o=Nh(e);if(D0(e)&&!o)return e;e=o}return null}const EM=new $t("",{providedIn:"root",factory:()=>!1});let by=null;function wy(e,o){return e[o]??yb()}function TM(e,o){const i=yb();i.producerNode?.length&&(e[o]=by,i.lView=e,by=DM())}const a2={...RE,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{xm(e.lView)},lView:null};function DM(){return Object.create(a2)}function yb(){return by??=DM(),by}const sn={};function pn(e){Ey(Wn(),Nt(),Ro()+e,!1)}function Ey(e,o,i,s){if(!s)if(3==(3&o[fn])){const f=e.preOrderCheckHooks;null!==f&&Sh(o,f,i)}else{const f=e.preOrderHooks;null!==f&&Ga(o,f,0,i)}_c(i)}function _t(e,o=Ke.Default){const i=Nt();return null===i?bt(e,o):iC(fo(),i,Qe(e),o)}function ti(){throw new Error("invalid")}function Cu(e,o,i,s,c,f,g,v,w,T,A){const k=o.blueprint.slice();return k[yr]=c,k[fn]=140|s,(null!==T||e&&2048&e[fn])&&(k[fn]|=2048),Ha(k),k[Ai]=k[mh]=e,k[vr]=i,k[au]=g||e&&e[au],k[nn]=v||e&&e[nn],k[Sl]=w||e&&e[Sl]||null,k[Go]=f,k[id]=function SC(){return Wa++}(),k[Dl]=A,k[Va]=T,k[tr]=2==o.type?e[tr]:k,k}function Ja(e,o,i,s,c){let f=e.data[o];if(null===f)f=function wm(e,o,i,s,c){const f=C_(),g=M_(),w=e.data[o]=function kM(e,o,i,s,c,f){let g=o?o.injectorIndex:-1,v=0;return ad()&&(v|=128),{type:i,index:s,insertBeforeIndex:null,injectorIndex:g,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:v,providerIndexes:0,value:c,attrs:f,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,g?f:f&&f.parent,i,o,s,c);return null===e.firstChild&&(e.firstChild=w),null!==f&&(g?null==f.child&&null!==w.parent&&(f.child=w):null===f.next&&(f.next=w,w.prev=f)),w}(e,o,i,s,c),function Pp(){return qe.lFrame.inI18n}()&&(f.flags|=32);else if(64&f.type){f.type=i,f.value=s,f.attrs=c;const g=function ld(){const e=qe.lFrame,o=e.currentTNode;return e.isParent?o:o.parent}();f.injectorIndex=null===g?-1:g.injectorIndex}return pa(f,!0),f}function Mu(e,o,i,s){if(0===i)return-1;const c=o.length;for(let f=0;f<i;f++)o.push(s),e.blueprint.push(s),e.data.push(null);return c}function AM(e,o,i,s,c){const f=wy(o,rd),g=Ro(),v=2&s;try{_c(-1),v&&o.length>kn&&Ey(e,o,kn,!1),as(v?2:0,c);const T=v?f:null,A=Sp(T);try{null!==T&&(T.dirty=!1),i(s,c)}finally{vh(T,A)}}finally{v&&null===o[rd]&&TM(o,rd),_c(g),as(v?3:1,c)}}function Cy(e,o,i){if(m_(o)){const s=$s(null);try{const f=o.directiveEnd;for(let g=o.directiveStart;g<f;g++){const v=e.data[g];v.contentQueries&&v.contentQueries(1,i[g],g)}}finally{$s(s)}}}function My(e,o,i){E_()&&(function Dy(e,o,i,s){const c=i.directiveStart,f=i.directiveEnd;cu(i)&&function Mb(e,o,i){const s=xs(o,e),c=xb(i);let g=16;i.signals?g=4096:i.onPush&&(g=64);const v=Mm(e,Cu(e,c,null,g,s,o,null,e[au].rendererFactory.createRenderer(s,i),null,null,null));e[o.index]=v}(o,i,e.data[c+i.componentOffset]),e.firstCreatePass||zp(i,o),po(s,o);const g=i.initialInputs;for(let v=c;v<f;v++){const w=e.data[v],T=yc(o,e,v,i);po(T,o),null!==g&&f2(0,v-c,T,w,0,g),ja(w)&&(qs(i.index,o)[vr]=yc(o,e,v,i))}}(e,o,i,xs(i,o)),64==(64&i.flags)&&Eb(e,o,i))}function vb(e,o,i=xs){const s=o.localNames;if(null!==s){let c=o.index+1;for(let f=0;f<s.length;f+=2){const g=s[f+1],v=-1===g?i(o,e):e[g];e[c++]=v}}}function xb(e){const o=e.tView;return null===o||o.incompleteFirstPass?e.tView=Sy(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):o}function Sy(e,o,i,s,c,f,g,v,w,T,A){const k=kn+s,B=k+c,$=function Ty(e,o){const i=[];for(let s=0;s<o;s++)i.push(s<e?null:sn);return i}(k,B),K="function"==typeof T?T():T;return $[he]={type:e,blueprint:$,template:i,queries:null,viewQuery:v,declTNode:o,data:$.slice().fill(null,k),bindingStartIndex:k,expandoStartIndex:B,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof f?f():f,pipeRegistry:"function"==typeof g?g():g,firstChild:null,schemas:w,consts:K,incompleteFirstPass:!1,ssrId:A}}let bb=e=>null;function wb(e,o,i,s){for(let c in e)if(e.hasOwnProperty(c)){i=null===i?{}:i;const f=e[c];null===s?FM(i,o,c,f):s.hasOwnProperty(c)&&FM(i,o,s[c],f)}return i}function FM(e,o,i,s){e.hasOwnProperty(i)?e[i].push(o,s):e[i]=[o,s]}function Is(e,o,i,s,c,f,g,v){const w=xs(o,i);let A,T=o.inputs;!v&&null!=T&&(A=T[s])?(ky(e,i,A,s,c),cu(o)&&function Em(e,o){const i=qs(o,e);16&i[fn]||(i[fn]|=64)}(i,o.index)):3&o.type&&(s=function LM(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(s),c=null!=g?g(c,o.value||"",s):c,f.setProperty(w,s,c))}function Js(e,o,i,s){if(E_()){const c=null===s?null:{"":-1},f=function Ay(e,o){const i=e.directiveRegistry;let s=null,c=null;if(i)for(let f=0;f<i.length;f++){const g=i[f];if(bE(o,g.selectors,!1))if(s||(s=[]),ja(g))if(null!==g.findHostDirectiveDefs){const v=[];c=c||new Map,g.findHostDirectiveDefs(g,v,c),s.unshift(...v,g),Cb(e,o,v.length)}else s.unshift(g),Cb(e,o,0);else c=c||new Map,g.findHostDirectiveDefs?.(g,s,c),s.push(g)}return null===s?null:[s,c]}(e,i);let g,v;null===f?g=v=null:[g,v]=f,null!==g&&Id(e,o,i,g,c,v),c&&function d2(e,o,i){if(o){const s=e.localNames=[];for(let c=0;c<o.length;c+=2){const f=i[o[c+1]];if(null==f)throw new at(-301,!1);s.push(o[c],f)}}}(i,s,c)}i.mergedAttrs=Ba(i.mergedAttrs,i.attrs)}function Id(e,o,i,s,c,f){for(let T=0;T<s.length;T++)V_(zp(i,o),e,s[T].type);!function rf(e,o,i){e.flags|=1,e.directiveStart=o,e.directiveEnd=o+i,e.providerIndexes=o}(i,e.data.length,s.length);for(let T=0;T<s.length;T++){const A=s[T];A.providersResolver&&A.providersResolver(A)}let g=!1,v=!1,w=Mu(e,o,s.length,null);for(let T=0;T<s.length;T++){const A=s[T];i.mergedAttrs=Ba(i.mergedAttrs,A.hostAttrs),sf(e,i,o,w,A),h2(w,A,c),null!==A.contentQueries&&(i.flags|=4),(null!==A.hostBindings||null!==A.hostAttrs||0!==A.hostVars)&&(i.flags|=64);const k=A.type.prototype;!g&&(k.ngOnChanges||k.ngOnInit||k.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),g=!0),!v&&(k.ngOnChanges||k.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),v=!0),w++}!function c2(e,o,i){const c=o.directiveEnd,f=e.data,g=o.attrs,v=[];let w=null,T=null;for(let A=o.directiveStart;A<c;A++){const k=f[A],B=i?i.get(k):null,K=B?B.outputs:null;w=wb(k.inputs,A,w,B?B.inputs:null),T=wb(k.outputs,A,T,K);const Q=null===w||null===g||yE(o)?null:p2(w,A,g);v.push(Q)}null!==w&&(w.hasOwnProperty("class")&&(o.flags|=8),w.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=v,o.inputs=w,o.outputs=T}(e,i,f)}function Eb(e,o,i){const s=i.directiveStart,c=i.directiveEnd,f=i.index,g=function Op(){return qe.lFrame.currentDirectiveIndex}();try{_c(f);for(let v=s;v<c;v++){const w=e.data[v],T=o[v];Ci(v),(null!==w.hostBindings||0!==w.hostVars||null!==w.hostAttrs)&&Iy(w,T)}}finally{_c(-1),Ci(g)}}function Iy(e,o){null!==e.hostBindings&&e.hostBindings(1,o)}function Cb(e,o,i){o.componentOffset=i,(e.components??=[]).push(o.index)}function h2(e,o,i){if(i){if(o.exportAs)for(let s=0;s<o.exportAs.length;s++)i[o.exportAs[s]]=e;ja(o)&&(i[""]=e)}}function sf(e,o,i,s,c){e.data[s]=c;const f=c.factory||(c.factory=Il(c.type)),g=new ud(f,ja(c),_t);e.blueprint[s]=g,i[s]=g,function Su(e,o,i,s,c){const f=c.hostBindings;if(f){let g=e.hostBindingOpCodes;null===g&&(g=e.hostBindingOpCodes=[]);const v=~o.index;(function zM(e){let o=e.length;for(;o>0;){const i=e[--o];if("number"==typeof i&&i<0)return i}return 0})(g)!=v&&g.push(v),g.push(i,s,f)}}(e,o,s,Mu(e,i,c.hostVars,sn),c)}function Hl(e,o,i,s,c,f){const g=xs(e,o);!function Cm(e,o,i,s,c,f,g){if(null==f)e.removeAttribute(o,c,i);else{const v=null==g?J(f):g(f,s||"",c);e.setAttribute(o,c,v,i)}}(o[nn],g,f,e.value,i,s,c)}function f2(e,o,i,s,c,f){const g=f[o];if(null!==g)for(let v=0;v<g.length;)Ry(s,i,g[v++],g[v++],g[v++])}function Ry(e,o,i,s,c){const f=$s(null);try{const g=e.inputTransforms;null!==g&&g.hasOwnProperty(s)&&(c=g[s].call(o,c)),null!==e.setInput?e.setInput(o,c,i,s):o[s]=c}finally{$s(f)}}function p2(e,o,i){let s=null,c=0;for(;c<i.length;){const f=i[c];if(0!==f)if(5!==f){if("number"==typeof f)break;if(e.hasOwnProperty(f)){null===s&&(s=[]);const g=e[f];for(let v=0;v<g.length;v+=2)if(g[v]===o){s.push(f,g[v+1],i[c+1]);break}}c+=2}else c+=2;else c+=4}return s}function af(e,o,i,s){return[e,!0,!1,o,null,0,s,i,null,null,null]}function Rc(e,o){const i=e.contentQueries;if(null!==i)for(let s=0;s<i.length;s+=2){const f=i[s+1];if(-1!==f){const g=e.data[f];D_(i[s]),g.contentQueries(2,o[f],f)}}}function Mm(e,o){return e[ph]?e[T0][ha]=o:e[ph]=o,e[T0]=o,o}function Py(e,o,i){D_(0);const s=$s(null);try{o(e,i)}finally{$s(s)}}function Oy(e){return e[fh]||(e[fh]=[])}function BM(e){return e.cleanup||(e.cleanup=[])}function Tu(e,o){const i=e[Sl],s=i?i.get(wa,null):null;s&&s.handleError(o)}function ky(e,o,i,s,c){for(let f=0;f<i.length;){const g=i[f++],v=i[f++];Ry(e.data[g],o[g],s,v,c)}}function VM(e,o){const i=qs(o,e),s=i[he];!function m2(e,o){for(let i=o.length;i<e.blueprint.length;i++)o.push(e.blueprint[i])}(s,i);const c=i[yr];null!==c&&null===i[Dl]&&(i[Dl]=dy(c,i[Sl])),Gl(s,i,i[vr])}function Gl(e,o,i){X0(o);try{const s=e.viewQuery;null!==s&&Py(1,s,i);const c=e.template;null!==c&&AM(e,o,c,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Rc(e,o),e.staticViewQueries&&Py(2,e.viewQuery,i);const f=e.components;null!==f&&function g2(e,o){for(let i=0;i<o.length;i++)VM(e,o[i])}(o,f)}catch(s){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),s}finally{o[fn]&=-5,Zo()}}let lf=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(i,s,c){const f=typeof Zone>"u"?null:Zone.current,g=function UE(e,o,i){const s=Object.create(HE);i&&(s.consumerAllowSignalWrites=!0),s.fn=e,s.schedule=o;const c=g=>{s.cleanupFn=g};return s.ref={notify:()=>gc(s),run:()=>{if(s.dirty=!1,s.hasRun&&!Tp(s))return;s.hasRun=!0;const g=Sp(s);try{s.cleanupFn(),s.cleanupFn=od,s.fn(c)}finally{vh(s,g)}},cleanup:()=>s.cleanupFn()},s.ref}(i,T=>{this.all.has(T)&&this.queue.set(T,f)},c);let v;this.all.add(g),g.notify();const w=()=>{g.cleanup(),v?.(),this.all.delete(g),this.queue.delete(g)};return v=s?.onDestroy(w),{destroy:w}}flush(){if(0!==this.queue.size)for(const[i,s]of this.queue)this.queue.delete(i),s?s.run(()=>i.run()):i.run()}get isQueueEmpty(){return 0===this.queue.size}static#t=this.\u0275prov=ee({token:e,providedIn:"root",factory:()=>new e})}return e})();function Du(e,o,i){let s=i?e.styles:null,c=i?e.classes:null,f=0;if(null!==o)for(let g=0;g<o.length;g++){const v=o[g];"number"==typeof v?f=v:1==f?c=lp(c,v):2==f&&(s=lp(s,v+": "+o[++g]+";"))}i?e.styles=s:e.stylesWithoutHost=s,i?e.classes=c:e.classesWithoutHost=c}function Pc(e,o,i,s,c=!1){for(;null!==i;){const f=o[i.index];null!==f&&s.push(Ki(f)),ss(f)&&Tm(f,s);const g=i.type;if(8&g)Pc(e,o,i.child,s);else if(32&g){const v=Wp(i,o);let w;for(;w=v();)s.push(w)}else if(16&g){const v=Dx(o,i);if(Array.isArray(v))s.push(...v);else{const w=Nh(o[tr]);Pc(w[he],w,v,s,!0)}}i=c?i.projectionNext:i.next}return s}function Tm(e,o){for(let i=Xr;i<e.length;i++){const s=e[i],c=s[he].firstChild;null!==c&&Pc(s[he],s,c,o)}e[Hs]!==e[yr]&&o.push(e[Hs])}function Fy(e,o,i,s=!0){const c=o[au],f=c.rendererFactory,g=c.afterRenderEventManager;f.begin?.(),g?.begin();try{Dm(e,o,e.template,i)}catch(w){throw s&&Tu(o,w),w}finally{f.end?.(),c.effectManager?.flush(),g?.end()}}function Dm(e,o,i,s){const c=o[fn];if(256!=(256&c)){o[au].effectManager?.flush(),X0(o);try{Ha(o),function Z0(e){return qe.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==i&&AM(e,o,i,2,s);const g=3==(3&c);if(g){const T=e.preOrderCheckHooks;null!==T&&Sh(o,T,null)}else{const T=e.preOrderHooks;null!==T&&Ga(o,T,0,null),er(o,0)}if(function UM(e){for(let o=vx(e);null!==o;o=xx(o)){if(!o[ME])continue;const i=o[lu];for(let s=0;s<i.length;s++){Eh(i[s])}}}(o),jM(o,2),null!==e.contentQueries&&Rc(e,o),g){const T=e.contentCheckHooks;null!==T&&Sh(o,T)}else{const T=e.contentHooks;null!==T&&Ga(o,T,1),er(o,1)}!function IM(e,o){const i=e.hostBindingOpCodes;if(null===i)return;const s=wy(o,gh);try{for(let c=0;c<i.length;c++){const f=i[c];if(f<0)_c(~f);else{const g=f,v=i[++c],w=i[++c];se(v,g),s.dirty=!1;const T=Sp(s);try{w(2,o[g])}finally{vh(s,T)}}}}finally{null===o[gh]&&TM(o,gh),_c(-1)}}(e,o);const v=e.components;null!==v&&Db(o,v,0);const w=e.viewQuery;if(null!==w&&Py(2,w,s),g){const T=e.viewCheckHooks;null!==T&&Sh(o,T)}else{const T=e.viewHooks;null!==T&&Ga(o,T,2),er(o,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),o[fn]&=-73,Rp(o)}finally{Zo()}}}function jM(e,o){for(let i=vx(e);null!==i;i=xx(i))for(let s=Xr;s<i.length;s++)$M(i[s],o)}function HM(e,o,i){$M(qs(o,e),i)}function $M(e,o){if(!function w_(e){return 128==(128&e[fn])}(e))return;const i=e[he],s=e[fn];if(80&s&&0===o||1024&s||2===o)Dm(i,e,i.template,e[vr]);else if(e[bp]>0){jM(e,1);const c=i.components;null!==c&&Db(e,c,1)}}function Db(e,o,i){for(let s=0;s<o.length;s++)HM(e,o[s],i)}class Im{get rootNodes(){const o=this._lView,i=o[he];return Pc(i,o,i.firstChild,[])}constructor(o,i){this._lView=o,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[vr]}set context(o){this._lView[vr]=o}get destroyed(){return 256==(256&this._lView[fn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[Ai];if(ss(o)){const i=o[8],s=i?i.indexOf(this):-1;s>-1&&(K_(o,s),qa(i,s))}this._attachedToViewContainer=!1}rt(this._lView[he],this._lView)}onDestroy(o){!function H0(e,o){if(256==(256&e[fn]))throw new at(911,!1);null===e[Tl]&&(e[Tl]=[]),e[Tl].push(o)}(this._lView,o)}markForCheck(){xm(this._cdRefInjectingView||this._lView)}detach(){this._lView[fn]&=-129}reattach(){this._lView[fn]|=128}detectChanges(){Fy(this._lView[he],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new at(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function kA(e,o){Hh(e,o,o[nn],2,null,null)}(this._lView[he],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new at(902,!1);this._appRef=o}}class GM extends Im{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Fy(o[he],o,o[vr],!1)}checkNoChanges(){}get context(){return null}}class qM extends pm{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const i=Kn(o);return new uf(i,this.ngModule)}}function Am(e){const o=[];for(let i in e)e.hasOwnProperty(i)&&o.push({propName:e[i],templateName:i});return o}class Ib{constructor(o,i){this.injector=o,this.parentInjector=i}get(o,i,s){s=r_(s);const c=this.injector.get(o,rb,s);return c!==rb||i===rb?c:this.parentInjector.get(o,i,s)}}class uf extends uM{get inputs(){const o=this.componentDef,i=o.inputTransforms,s=Am(o.inputs);if(null!==i)for(const c of s)i.hasOwnProperty(c.propName)&&(c.transform=i[c.propName]);return s}get outputs(){return Am(this.componentDef.outputs)}constructor(o,i){super(),this.componentDef=o,this.ngModule=i,this.componentType=o.type,this.selector=function EE(e){return e.map(KI).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!i}create(o,i,s,c){let f=(c=c||this.ngModule)instanceof Ds?c:c?.injector;f&&null!==this.componentDef.getStandaloneInjector&&(f=this.componentDef.getStandaloneInjector(f)||f);const g=f?new Ib(o,f):o,v=g.get(mm,null);if(null===v)throw new at(407,!1);const k={rendererFactory:v,sanitizer:g.get(hM,null),effectManager:g.get(lf,null),afterRenderEventManager:g.get(_b,null)},B=v.createRenderer(null,this.componentDef),$=this.componentDef.selectors[0][0]||"div",K=s?function RM(e,o,i,s){const f=s.get(EM,!1)||i===jo.ShadowDom,g=e.selectRootElement(o,f);return function l2(e){bb(e)}(g),g}(B,s,this.componentDef.encapsulation,g):zh(B,$,function _2(e){const o=e.toLowerCase();return"svg"===o?WE:"math"===o?"math":null}($)),yt=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let pt=null;null!==K&&(pt=dy(K,g,!0));const Ft=Sy(0,null,null,1,0,null,null,null,null,null,null),Zt=Cu(null,Ft,null,yt,null,null,k,B,g,null,pt);let de,oe;X0(Zt);try{const Te=this.componentDef;let gn,bn=null;Te.findHostDirectiveDefs?(gn=[],bn=new Map,Te.findHostDirectiveDefs(Te,gn,bn),gn.push(Te)):gn=[Te];const si=function y2(e,o){const i=e[he],s=kn;return e[s]=o,Ja(i,s,2,"#host",null)}(Zt,K),fi=function v2(e,o,i,s,c,f,g){const v=c[he];!function Ny(e,o,i,s){for(const c of e)o.mergedAttrs=Ba(o.mergedAttrs,c.hostAttrs);null!==o.mergedAttrs&&(Du(o,o.mergedAttrs,!0),null!==i&&jC(s,i,o))}(s,e,o,g);let w=null;null!==o&&(w=dy(o,c[Sl]));const T=f.rendererFactory.createRenderer(o,i);let A=16;i.signals?A=4096:i.onPush&&(A=64);const k=Cu(c,xb(i),null,A,c[e.index],e,f,T,null,null,w);return v.firstCreatePass&&Cb(v,e,s.length-1),Mm(c,k),c[e.index]=k}(si,K,Te,gn,Zt,k,B);oe=XE(Ft,kn),K&&function By(e,o,i,s){if(s)hh(e,i,["ng-version",KA.full]);else{const{attrs:c,classes:f}=function C0(e){const o=[],i=[];let s=1,c=2;for(;s<e.length;){let f=e[s];if("string"==typeof f)2===c?""!==f&&o.push(f,e[++s]):8===c&&i.push(f);else{if(!js(c))break;c=f}s++}return{attrs:o,classes:i}}(o.selectors[0]);c&&hh(e,i,c),f&&f.length>0&&Po(e,i,f.join(" "))}}(B,Te,K,s),void 0!==i&&function Vy(e,o,i){const s=e.projection=[];for(let c=0;c<o.length;c++){const f=i[c];s.push(null!=f?Array.from(f):null)}}(oe,this.ngContentSelectors,i),de=function zy(e,o,i,s,c,f){const g=fo(),v=c[he],w=xs(g,c);Id(v,c,g,i,null,s);for(let A=0;A<i.length;A++)po(yc(c,v,g.directiveStart+A,g),c);Eb(v,c,g),w&&po(w,c);const T=yc(c,v,g.directiveStart+g.componentOffset,g);if(e[vr]=c[vr]=T,null!==f)for(const A of f)A(T,o);return Cy(v,g,e),T}(fi,Te,gn,bn,Zt,[df]),Gl(Ft,Zt,null)}finally{Zo()}return new Ly(this.componentType,de,Qh(oe,Zt),Zt,oe)}}class Ly extends WA{constructor(o,i,s,c,f){super(),this.location=s,this._rootLView=c,this._tNode=f,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new GM(c),this.componentType=o}setInput(o,i){const s=this._tNode.inputs;let c;if(null!==s&&(c=s[o])){if(this.previousInputValues??=new Map,this.previousInputValues.has(o)&&Object.is(this.previousInputValues.get(o),i))return;const f=this._rootLView;ky(f[he],f,c,o,i),this.previousInputValues.set(o,i),xm(qs(this._tNode.index,f))}}get injector(){return new me(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function df(){const e=fo();Mh(Nt()[he],e)}function jn(e){let o=function WM(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),i=!0;const s=[e];for(;o;){let c;if(ja(e))c=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new at(903,!1);c=o.\u0275dir}if(c){if(i){s.push(c);const g=e;g.inputs=Ad(e.inputs),g.inputTransforms=Ad(e.inputTransforms),g.declaredInputs=Ad(e.declaredInputs),g.outputs=Ad(e.outputs);const v=c.hostBindings;v&&b2(e,v);const w=c.viewQuery,T=c.contentQueries;if(w&&Rm(e,w),T&&x2(e,T),ap(e.inputs,c.inputs),ap(e.declaredInputs,c.declaredInputs),ap(e.outputs,c.outputs),null!==c.inputTransforms&&(null===g.inputTransforms&&(g.inputTransforms={}),ap(g.inputTransforms,c.inputTransforms)),ja(c)&&c.data.animation){const A=e.data;A.animation=(A.animation||[]).concat(c.data.animation)}}const f=c.features;if(f)for(let g=0;g<f.length;g++){const v=f[g];v&&v.ngInherit&&v(e),v===jn&&(i=!1)}}o=Object.getPrototypeOf(o)}!function Ab(e){let o=0,i=null;for(let s=e.length-1;s>=0;s--){const c=e[s];c.hostVars=o+=c.hostVars,c.hostAttrs=Ba(c.hostAttrs,i=Ba(i,c.hostAttrs))}}(s)}function Ad(e){return e===da?{}:e===ri?[]:e}function Rm(e,o){const i=e.viewQuery;e.viewQuery=i?(s,c)=>{o(s,c),i(s,c)}:o}function x2(e,o){const i=e.contentQueries;e.contentQueries=i?(s,c,f)=>{o(s,c,f),i(s,c,f)}:o}function b2(e,o){const i=e.hostBindings;e.hostBindings=i?(s,c)=>{o(s,c),i(s,c)}:o}function el(e){return!!Om(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function Om(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Fo(e,o,i){return!Object.is(e[o],i)&&(e[o]=i,!0)}function ro(e,o,i,s){const c=Nt();return Fo(c,Ch(),o)&&(Wn(),Hl(Mi(),c,e,o,i,s)),ro}function ff(e,o,i,s){return Fo(e,Ch(),i)?o+J(i)+s:sn}function Ji(e,o,i,s,c,f,g,v){const w=Nt(),T=Wn(),A=e+kn,k=T.firstCreatePass?function L2(e,o,i,s,c,f,g,v,w){const T=o.consts,A=Ja(o,e,4,g||null,ls(T,v));Js(o,i,A,ls(T,w)),Mh(o,A);const k=A.tView=Sy(2,A,s,c,f,o.directiveRegistry,o.pipeRegistry,null,o.schemas,T,null);return null!==o.queries&&(o.queries.template(o,A),k.queries=o.queries.embeddedTView(A)),A}(A,T,w,o,i,s,c,f,g):T.data[A];pa(k,!1);const B=aS(T,w,k,e);$a()&&tn(T,w,B,k),po(B,w),Mm(w,w[A]=af(B,w,B,k)),pc(k)&&My(T,w,k),null!=g&&vb(w,k,v)}let aS=function Zy(e,o,i,s){return Ol(!0),o[nn].createComment("")};function Bm(e){return function wh(e,o){return e[o]}(function Ei(){return qe.lFrame.contextLView}(),kn+e)}function Cn(e,o,i){const s=Nt();return Fo(s,Ch(),o)&&Is(Wn(),Mi(),s,e,o,s[nn],i,!1),Cn}function Xy(e,o,i,s,c){const g=c?"class":"style";ky(e,i,o.inputs[g],g,s)}function un(e,o,i,s){const c=Nt(),f=Wn(),g=kn+e,v=c[nn],w=f.firstCreatePass?function uS(e,o,i,s,c,f){const g=o.consts,w=Ja(o,e,2,s,ls(g,c));return Js(o,i,w,ls(g,f)),null!==w.attrs&&Du(w,w.attrs,!1),null!==w.mergedAttrs&&Du(w,w.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,w),w}(g,f,c,o,i,s):f.data[g],T=zb(f,c,w,v,o,e);c[g]=T;const A=pc(w);return pa(w,!0),jC(v,T,w),32!=(32&w.flags)&&$a()&&tn(f,c,T,w),0===function $0(){return qe.lFrame.elementDepthCount}()&&po(T,c),function fA(){qe.lFrame.elementDepthCount++}(),A&&(My(f,c,w),Cy(f,w,c)),null!==s&&vb(c,w),un}function mn(){let e=fo();M_()?bs():(e=e.parent,pa(e,!1));const o=e;(function KE(e){return qe.skipHydrationRootTNode===e})(o)&&function q0(){qe.skipHydrationRootTNode=null}(),function pA(){qe.lFrame.elementDepthCount--}();const i=Wn();return i.firstCreatePass&&(Mh(i,e),m_(e)&&i.queries.elementEnd(e)),null!=o.classesWithoutHost&&function N_(e){return 0!=(8&e.flags)}(o)&&Xy(i,o,Nt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Q0(e){return 0!=(16&e.flags)}(o)&&Xy(i,o,Nt(),o.stylesWithoutHost,!1),mn}function oo(e,o,i,s){return un(e,o,i,s),mn(),oo}let zb=(e,o,i,s,c,f)=>(Ol(!0),zh(s,c,function R_(){return qe.lFrame.currentNamespace}()));function Iu(e,o,i){const s=Nt(),c=Wn(),f=e+kn,g=c.firstCreatePass?function N2(e,o,i,s,c){const f=o.consts,g=ls(f,s),v=Ja(o,e,8,"ng-container",g);return null!==g&&Du(v,g,!0),Js(o,i,v,ls(f,c)),null!==o.queries&&o.queries.elementStart(o,v),v}(f,c,s,o,i):c.data[f];pa(g,!0);const v=Ma(c,s,g,e);return s[f]=v,$a()&&tn(c,s,v,g),po(v,s),pc(g)&&(My(c,s,g),Cy(c,g,s)),null!=i&&vb(s,g),Iu}function wf(){let e=fo();const o=Wn();return M_()?bs():(e=e.parent,pa(e,!1)),o.firstCreatePass&&(Mh(o,e),m_(e)&&o.queries.elementEnd(e)),wf}let Ma=(e,o,i,s)=>(Ol(!0),Ex(o[nn],""));function Ef(e){return!!e&&"function"==typeof e.then}function Vb(e){return!!e&&"function"==typeof e.subscribe}function cr(e,o,i,s){const c=Nt(),f=Wn(),g=fo();return function Vm(e,o,i,s,c,f,g){const v=pc(s),T=e.firstCreatePass&&BM(e),A=o[vr],k=Oy(o);let B=!0;if(3&s.type||g){const Q=xs(s,o),ut=g?g(Q):Q,yt=k.length,pt=g?Zt=>g(Ki(Zt[s.index])):s.index;let Ft=null;if(!g&&v&&(Ft=function fS(e,o,i,s){const c=e.cleanup;if(null!=c)for(let f=0;f<c.length-1;f+=2){const g=c[f];if(g===i&&c[f+1]===s){const v=o[fh],w=c[f+2];return v.length>w?v[w]:null}"string"==typeof g&&(f+=2)}return null}(e,o,c,s.index)),null!==Ft)(Ft.__ngLastListenerFn__||Ft).__ngNextListenerFn__=f,Ft.__ngLastListenerFn__=f,B=!1;else{f=Ub(s,o,A,f,!1);const Zt=i.listen(ut,c,f);k.push(f,Zt),T&&T.push(c,pt,yt,yt+1)}}else f=Ub(s,o,A,f,!1);const $=s.outputs;let K;if(B&&null!==$&&(K=$[c])){const Q=K.length;if(Q)for(let ut=0;ut<Q;ut+=2){const de=o[K[ut]][K[ut+1]].subscribe(f),oe=k.length;k.push(f,de),T&&T.push(c,s.index,oe,-(oe+1))}}}(f,c,c[nn],g,e,o,s),cr}function Od(e,o,i,s){try{return as(6,o,i),!1!==i(s)}catch(c){return Tu(e,c),!1}finally{as(7,o,i)}}function Ub(e,o,i,s,c){return function f(g){if(g===Function)return s;xm(e.componentOffset>-1?qs(e.index,o):o);let w=Od(o,i,s,g),T=f.__ngNextListenerFn__;for(;T;)w=Od(o,i,T,g)&&w,T=T.__ngNextListenerFn__;return c&&!1===w&&g.preventDefault(),w}}function so(e=1){return function I_(e){return(qe.lFrame.contextLView=function cd(e,o){for(;e>0;)o=o[mh],e--;return o}(e,qe.lFrame.contextLView))[vr]}(e)}function pS(e,o){let i=null;const s=function ZI(e){const o=e.attrs;if(null!=o){const i=o.indexOf(5);if(!(1&i))return o[i+1]}return null}(e);for(let c=0;c<o.length;c++){const f=o[c];if("*"!==f){if(null===s?bE(e,f,!0):YI(s,f))return c}else i=c}return i}function Fc(e){const o=Nt()[tr][Go];if(!o.projection){const s=o.projection=Oh(e?e.length:1,null),c=s.slice();let f=o.child;for(;null!==f;){const g=e?pS(f,e):0;null!==g&&(c[g]?c[g].projectionNext=f:s[g]=f,c[g]=f),f=f.next}}}function jr(e,o=0,i){const s=Nt(),c=Wn(),f=Ja(c,kn+e,16,null,i||null);null===f.projection&&(f.projection=o),bs(),(!s[Dl]||ad())&&32!=(32&f.flags)&&function VC(e,o,i){Vl(o[nn],0,o,i,Mx(e,i,o),xc(i.parent||o[Go],i,o))}(c,s,f)}function $m(e,o){return e<<17|o<<2}function Lc(e){return e>>17&32767}function $b(e){return 2|e}function Nc(e){return(131068&e)>>2}function zc(e,o){return-131069&e|o<<2}function Jy(e){return 1|e}function vS(e,o,i,s,c){const f=e[i+1],g=null===o;let v=s?Lc(f):Nc(f),w=!1;for(;0!==v&&(!1===w||g);){const A=e[v+1];H2(e[v],o)&&(w=!0,e[v+1]=s?Jy(A):$b(A)),v=s?Lc(A):Nc(A)}w&&(e[i+1]=s?$b(f):Jy(f))}function H2(e,o){return null===e||null==o||(Array.isArray(e)?e[1]:e)===o||!(!Array.isArray(e)||"string"!=typeof o)&&gd(e,o)>=0}const Dr={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Gb(e){return e.substring(Dr.key,Dr.keyEnd)}function wS(e,o){const i=Dr.textEnd;return i===o?-1:(o=Dr.keyEnd=function $2(e,o,i){for(;o<i&&e.charCodeAt(o)>32;)o++;return o}(e,Dr.key=o,i),Mf(e,o,i))}function Mf(e,o,i){for(;o<i&&e.charCodeAt(o)<=32;)o++;return o}function Ir(e,o){return function ol(e,o,i,s){const c=Nt(),f=Wn(),g=ws(2);f.firstUpdatePass&&Sf(f,e,g,s),o!==sn&&Fo(c,g,o)&&OS(f,f.data[Ro()],c,c[nn],e,c[g+1]=function Wm(e,o){return null==e||""===e||("string"==typeof o?e+=o:"object"==typeof e&&(e=Or(eo(e)))),e}(o,i),s,g)}(e,o,null,!0),Ir}function rl(e,o){for(let i=function bS(e){return function CS(e){Dr.key=0,Dr.keyEnd=0,Dr.value=0,Dr.valueEnd=0,Dr.textEnd=e.length}(e),wS(e,Mf(e,0,Dr.textEnd))}(o);i>=0;i=wS(o,i))Tr(e,Gb(o),!0)}function Wb(e,o){return o>=e.expandoStartIndex}function Sf(e,o,i,s){const c=e.data;if(null===c[i+1]){const f=c[Ro()],g=Wb(e,i);Yb(f,s)&&null===o&&!g&&(o=!1),o=function IS(e,o,i,s){const c=function Jr(e){const o=qe.lFrame.currentDirectiveIndex;return-1===o?null:e[o]}(e);let f=s?o.residualClasses:o.residualStyles;if(null===c)0===(s?o.classBindings:o.styleBindings)&&(i=Tf(i=tv(null,e,o,i,s),o.attrs,s),f=null);else{const g=o.directiveStylingLast;if(-1===g||e[g]!==c)if(i=tv(c,e,o,i,s),null===f){let w=function q2(e,o,i){const s=i?o.classBindings:o.styleBindings;if(0!==Nc(s))return e[Lc(s)]}(e,o,s);void 0!==w&&Array.isArray(w)&&(w=tv(null,e,o,w[1],s),w=Tf(w,o.attrs,s),function AS(e,o,i,s){e[Lc(i?o.classBindings:o.styleBindings)]=s}(e,o,s,w))}else f=function Zb(e,o,i){let s;const c=o.directiveEnd;for(let f=1+o.directiveStylingLast;f<c;f++)s=Tf(s,e[f].hostAttrs,i);return Tf(s,o.attrs,i)}(e,o,s)}return void 0!==f&&(s?o.residualClasses=f:o.residualStyles=f),i}(c,f,o,s),function Gm(e,o,i,s,c,f){let g=f?o.classBindings:o.styleBindings,v=Lc(g),w=Nc(g);e[s]=i;let A,T=!1;if(Array.isArray(i)?(A=i[1],(null===A||gd(i,A)>0)&&(T=!0)):A=i,c)if(0!==w){const B=Lc(e[v+1]);e[s+1]=$m(B,v),0!==B&&(e[B+1]=zc(e[B+1],s)),e[v+1]=function B2(e,o){return 131071&e|o<<17}(e[v+1],s)}else e[s+1]=$m(v,0),0!==v&&(e[v+1]=zc(e[v+1],s)),v=s;else e[s+1]=$m(w,0),0===v?v=s:e[w+1]=zc(e[w+1],s),w=s;T&&(e[s+1]=$b(e[s+1])),vS(e,A,s,!0),vS(e,A,s,!1),function U2(e,o,i,s,c){const f=c?e.residualClasses:e.residualStyles;null!=f&&"string"==typeof o&&gd(f,o)>=0&&(i[s+1]=Jy(i[s+1]))}(o,A,e,s,f),g=$m(v,w),f?o.classBindings=g:o.styleBindings=g}(c,f,o,i,g,s)}}function tv(e,o,i,s,c){let f=null;const g=i.directiveEnd;let v=i.directiveStylingLast;for(-1===v?v=i.directiveStart:v++;v<g&&(f=o[v],s=Tf(s,f.hostAttrs,c),f!==e);)v++;return null!==e&&(i.directiveStylingLast=v),s}function Tf(e,o,i){const s=i?1:2;let c=-1;if(null!==o)for(let f=0;f<o.length;f++){const g=o[f];"number"==typeof g?c=g:c===s&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Tr(e,g,!!i||o[++f]))}return void 0===e?null:e}function OS(e,o,i,s,c,f,g,v){if(!(3&o.type))return;const w=e.data,T=w[v+1],A=function yS(e){return 1==(1&e)}(T)?kS(w,o,i,c,Nc(T),g):void 0;Bc(A)||(Bc(f)||function _S(e){return 2==(2&e)}(T)&&(f=kS(w,null,i,c,v,g)),function Xp(e,o,i,s,c){if(o)c?e.addClass(i,s):e.removeClass(i,s);else{let f=-1===s.indexOf("-")?void 0:vc.DashCase;null==c?e.removeStyle(i,s,f):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),f|=vc.Important),e.setStyle(i,s,c,f))}}(s,g,b_(Ro(),i),c,f))}function kS(e,o,i,s,c,f){const g=null===o;let v;for(;c>0;){const w=e[c],T=Array.isArray(w),A=T?w[1]:w,k=null===A;let B=i[c+1];B===sn&&(B=k?ri:void 0);let $=k?$_(B,s):A===s?B:void 0;if(T&&!Bc($)&&($=$_(w,s)),Bc($)&&(v=$,g))return v;const K=e[c+1];c=g?Lc(K):Nc(K)}if(null!==o){let w=f?o.residualClasses:o.residualStyles;null!=w&&(v=$_(w,s))}return v}function Bc(e){return void 0!==e}function Yb(e,o){return 0!=(e.flags&(o?8:16))}function us(e,o=""){const i=Nt(),s=Wn(),c=e+kn,f=s.firstCreatePass?Ja(s,c,1,o,null):s.data[c],g=FS(s,i,f,o,e);i[c]=g,$a()&&tn(s,i,g,f),pa(f,!1)}let FS=(e,o,i,s,c)=>(Ol(!0),function Zp(e,o){return e.createText(o)}(o[nn],s));function Zm(e){return Xm("",e,""),Zm}function Xm(e,o,i){const s=Nt(),c=ff(s,e,o,i);return c!==sn&&function $l(e,o,i){const s=b_(o,e);!function wx(e,o,i){e.setValue(o,i)}(e[nn],s,i)}(s,Ro(),c),Xm}function VS(e,o,i){!function sl(e,o,i,s){const c=Wn(),f=ws(2);c.firstUpdatePass&&Sf(c,null,f,s);const g=Nt();if(i!==sn&&Fo(g,f,i)){const v=c.data[Ro()];if(Yb(v,s)&&!Wb(c,f)){let w=s?v.classesWithoutHost:v.stylesWithoutHost;null!==w&&(i=lp(w,i||"")),Xy(c,v,g,i,s)}else!function W2(e,o,i,s,c,f,g,v){c===sn&&(c=ri);let w=0,T=0,A=0<c.length?c[0]:null,k=0<f.length?f[0]:null;for(;null!==A||null!==k;){const B=w<c.length?c[w+1]:void 0,$=T<f.length?f[T+1]:void 0;let Q,K=null;A===k?(w+=2,T+=2,B!==$&&(K=k,Q=$)):null===k||null!==A&&A<k?(w+=2,K=A):(T+=2,K=k,Q=$),null!==K&&OS(e,o,i,s,K,Q,g,v),A=w<c.length?c[w]:null,k=T<f.length?f[T]:null}}(c,v,g,g[nn],g[f+1],g[f+1]=function RS(e,o,i){if(null==i||""===i)return ri;const s=[],c=eo(i);if(Array.isArray(c))for(let f=0;f<c.length;f++)e(s,c[f],!0);else if("object"==typeof c)for(const f in c)c.hasOwnProperty(f)&&e(s,f,c[f]);else"string"==typeof c&&o(s,c);return s}(e,o,i),s,f)}}(Tr,rl,ff(Nt(),e,o,i),!0)}function Df(e,o,i){const s=Nt();return Fo(s,Ch(),o)&&Is(Wn(),Mi(),s,e,o,s[nn],i,!0),Df}const kd="en-US";let iv=kd;function hv(e,o,i,s,c){if(e=Qe(e),Array.isArray(e))for(let f=0;f<e.length;f++)hv(e[f],o,i,s,c);else{const f=Wn(),g=Nt(),v=fo();let w=vu(e)?e:Qe(e.provide);const T=qx(e),A=1048575&v.providerIndexes,k=v.directiveStart,B=v.providerIndexes>>20;if(vu(e)||!e.multi){const $=new ud(T,c,_t),K=pv(w,o,c?A:A+B,k);-1===K?(V_(zp(v,g),f,w),zd(f,e,o.length),o.push(w),v.directiveStart++,v.directiveEnd++,c&&(v.providerIndexes+=1048576),i.push($),g.push($)):(i[K]=$,g[K]=$)}else{const $=pv(w,o,A+B,k),K=pv(w,o,A,A+B),ut=K>=0&&i[K];if(c&&!ut||!c&&!($>=0&&i[$])){V_(zp(v,g),f,w);const yt=function AR(e,o,i,s,c){const f=new ud(e,i,_t);return f.multi=[],f.index=o,f.componentProviders=0,fv(f,c,s&&!i),f}(c?IR:E1,i.length,c,s,T);!c&&ut&&(i[K].providerFactory=yt),zd(f,e,o.length,0),o.push(w),v.directiveStart++,v.directiveEnd++,c&&(v.providerIndexes+=1048576),i.push(yt),g.push(yt)}else zd(f,e,$>-1?$:K,fv(i[c?K:$],T,!c&&s));!c&&s&&ut&&i[K].componentProviders++}}}function zd(e,o,i,s){const c=vu(o),f=function rM(e){return!!e.useClass}(o);if(c||f){const w=(f?Qe(o.useClass):o).prototype.ngOnDestroy;if(w){const T=e.destroyHooks||(e.destroyHooks=[]);if(!c&&o.multi){const A=T.indexOf(i);-1===A?T.push(i,[s,w]):T[A+1].push(s,w)}else T.push(i,w)}}}function fv(e,o,i){return i&&e.componentProviders++,e.multi.push(o)-1}function pv(e,o,i,s){for(let c=i;c<s;c++)if(o[c]===e)return c;return-1}function E1(e,o,i,s){return C1(this.multi,[])}function IR(e,o,i,s){const c=this.multi;let f;if(this.providerFactory){const g=this.providerFactory.componentProviders,v=yc(i,i[he],this.providerFactory.index,s);f=v.slice(0,g),C1(c,f);for(let w=g;w<v.length;w++)f.push(v[w])}else f=[],C1(c,f);return f}function C1(e,o){for(let i=0;i<e.length;i++)o.push((0,e[i])());return o}function Wi(e,o=[]){return i=>{i.providersResolver=(s,c)=>function w1(e,o,i){const s=Wn();if(s.firstCreatePass){const c=ja(e);hv(i,s.data,s.blueprint,c,!0),hv(o,s.data,s.blueprint,c,!1)}}(s,c?c(e):e,o)}}class Fu{}class M1{}class mv extends Fu{constructor(o,i,s){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new qM(this);const c=$o(o);this._bootstrapComponents=Dc(c.bootstrap),this._r3Injector=Ul(o,i,[{provide:Fu,useValue:this},{provide:pm,useValue:this.componentFactoryResolver},...s],Or(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class gv extends M1{constructor(o){super(),this.moduleType=o}create(o){return new mv(this.moduleType,o,[])}}class S1 extends Fu{constructor(o){super(),this.componentFactoryResolver=new qM(this),this.instance=null;const i=new Zh([...o.providers,{provide:Fu,useValue:this},{provide:pm,useValue:this.componentFactoryResolver}],o.parent||sm(),o.debugName,new Set(["environment"]));this.injector=i,o.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function Pf(e,o,i=null){return new S1({providers:e,parent:o,debugName:i,runEnvironmentInitializers:!0}).injector}let _v=(()=>{class e{constructor(i){this._injector=i,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){const s=jx(0,i.type),c=s.length>0?Pf([s],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,c)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(const i of this.cachedInjectors.values())null!==i&&i.destroy()}finally{this.cachedInjectors.clear()}}static#t=this.\u0275prov=ee({token:e,providedIn:"environment",factory:()=>new e(bt(Ds))})}return e})();function T1(e){e.getStandaloneInjector=o=>o.get(_v).getOrCreateStandaloneInjector(e)}function qR(){return this._results[Symbol.iterator]()}class Ff{static#t=Symbol.iterator;get changes(){return this._changes||(this._changes=new oi)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=Ff.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=qR)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,i){return this._results.reduce(o,i)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,i){const s=this;s.dirty=!1;const c=function ga(e){return e.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function bA(e,o,i){if(e.length!==o.length)return!1;for(let s=0;s<e.length;s++){let c=e[s],f=o[s];if(i&&(c=i(c),f=i(f)),f!==c)return!1}return!0}(s._results,c,i))&&(s._results=c,s.length=c.length,s.last=c[this.length-1],s.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function ZR(e,o,i,s=!0){const c=o[he];if(function FA(e,o,i,s){const c=Xr+s,f=i.length;s>0&&(i[c-1][ha]=o),s<f-Xr?(o[ha]=i[c],H_(i,Xr+s,o)):(i.push(o),o[ha]=null),o[Ai]=i;const g=o[fc];null!==g&&i!==g&&function LA(e,o){const i=e[lu];o[tr]!==o[Ai][Ai][tr]&&(e[ME]=!0),null===i?e[lu]=[o]:i.push(o)}(g,o);const v=o[Us];null!==v&&v.insertView(e),o[fn]|=128}(c,o,e,i),s){const f=Vh(i,e),g=o[nn],v=bd(g,e[Hs]);null!==v&&function OA(e,o,i,s,c,f){s[yr]=c,s[Go]=o,Hh(e,s,i,1,c,f)}(c,e[Go],g,o,v,f)}}let Wl=(()=>{class e{static#t=this.__NG_ELEMENT_ID__=FT}return e})();const Ps=Wl,k1=class extends Ps{constructor(o,i,s){super(),this._declarationLView=o,this._declarationTContainer=i,this.elementRef=s}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(o,i){return this.createEmbeddedViewImpl(o,i)}createEmbeddedViewImpl(o,i,s){const c=function kT(e,o,i,s){const c=o.tView,v=Cu(e,c,i,4096&e[fn]?4096:16,null,o,null,null,null,s?.injector??null,s?.hydrationInfo??null);v[fc]=e[o.index];const T=e[Us];return null!==T&&(v[Us]=T.createEmbeddedView(c)),Gl(c,v,i),v}(this._declarationLView,this._declarationTContainer,o,{injector:i,hydrationInfo:s});return new Im(c)}};function FT(){return hg(fo(),Nt())}function hg(e,o){return 4&e.type?new k1(o,e,Qh(e,o)):null}let ds=(()=>{class e{static#t=this.__NG_ELEMENT_ID__=Lf}return e})();function Lf(){return jT(fo(),Nt())}const KR=ds,BT=class extends KR{constructor(o,i,s){super(),this._lContainer=o,this._hostTNode=i,this._hostLView=s}get element(){return Qh(this._hostTNode,this._hostLView)}get injector(){return new me(this._hostTNode,this._hostLView)}get parentInjector(){const o=hd(this._hostTNode,this._hostLView);if(z_(o)){const i=Dh(o,this._hostLView),s=Th(o);return new me(i[he].data[s+8],i)}return new me(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const i=VT(this._lContainer);return null!==i&&i[o]||null}get length(){return this._lContainer.length-Xr}createEmbeddedView(o,i,s){let c,f;"number"==typeof s?c=s:null!=s&&(c=s.index,f=s.injector);const v=o.createEmbeddedViewImpl(i||{},f,null);return this.insertImpl(v,c,false),v}createComponent(o,i,s,c,f){const g=o&&!function Ph(e){return"function"==typeof e}(o);let v;if(g)v=i;else{const Q=i||{};v=Q.index,s=Q.injector,c=Q.projectableNodes,f=Q.environmentInjector||Q.ngModuleRef}const w=g?o:new uf(Kn(o)),T=s||this.parentInjector;if(!f&&null==w.ngModule){const ut=(g?T:this.parentInjector).get(Ds,null);ut&&(f=ut)}Kn(w.componentType??{});const $=w.create(T,c,null,f);return this.insertImpl($.hostView,v,false),$}insert(o,i){return this.insertImpl(o,i,!1)}insertImpl(o,i,s){const c=o._lView;if(function hA(e){return ss(e[Ai])}(c)){const w=this.indexOf(o);if(-1!==w)this.detach(w);else{const T=c[Ai],A=new BT(T,T[Go],T[Ai]);A.detach(A.indexOf(o))}}const g=this._adjustIndex(i),v=this._lContainer;return ZR(v,c,g,!s),o.attachToViewContainerRef(),H_(z1(v),g,o),o}move(o,i){return this.insert(o,i)}indexOf(o){const i=VT(this._lContainer);return null!==i?i.indexOf(o):-1}remove(o){const i=this._adjustIndex(o,-1),s=K_(this._lContainer,i);s&&(qa(z1(this._lContainer),i),rt(s[he],s))}detach(o){const i=this._adjustIndex(o,-1),s=K_(this._lContainer,i);return s&&null!=qa(z1(this._lContainer),i)?new Im(s):null}_adjustIndex(o,i=0){return o??this.length+i}};function VT(e){return e[8]}function z1(e){return e[8]||(e[8]=[])}function jT(e,o){let i;const s=o[e.index];return ss(s)?i=s:(i=af(s,o,null,e),o[e.index]=i,Mm(o,i)),UT(i,o,e,s),new BT(i,e,o)}let UT=function HT(e,o,i,s){if(e[Hs])return;let c;c=8&i.type?Ki(s):function JR(e,o){const i=e[nn],s=i.createComment(""),c=xs(o,e);return q(i,bd(i,c),s,function zC(e,o){return e.nextSibling(o)}(i,c),!1),s}(o,i),e[Hs]=c};class B1{constructor(o){this.queryList=o,this.matches=null}clone(){return new B1(this.queryList)}setDirty(){this.queryList.setDirty()}}class xv{constructor(o=[]){this.queries=o}createEmbeddedView(o){const i=o.queries;if(null!==i){const s=null!==o.contentQueries?o.contentQueries[0]:i.length,c=[];for(let f=0;f<s;f++){const g=i.getByIndex(f);c.push(this.queries[g.indexInDeclarationView].clone())}return new xv(c)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let i=0;i<this.queries.length;i++)null!==ll(o,i).matches&&this.queries[i].setDirty()}}class V1{constructor(o,i,s=null){this.predicate=o,this.flags=i,this.read=s}}class Nf{constructor(o=[]){this.queries=o}elementStart(o,i){for(let s=0;s<this.queries.length;s++)this.queries[s].elementStart(o,i)}elementEnd(o){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(o)}embeddedTView(o){let i=null;for(let s=0;s<this.length;s++){const c=null!==i?i.length:0,f=this.getByIndex(s).embeddedTView(o,c);f&&(f.indexInDeclarationView=s,null!==i?i.push(f):i=[f])}return null!==i?new Nf(i):null}template(o,i){for(let s=0;s<this.queries.length;s++)this.queries[s].template(o,i)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class j1{constructor(o,i=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(o,i){this.isApplyingToNode(i)&&this.matchTNode(o,i)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,i){this.elementStart(o,i)}embeddedTView(o,i){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,i),new j1(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let s=o.parent;for(;null!==s&&8&s.type&&s.index!==i;)s=s.parent;return i===(null!==s?s.index:-1)}return this._appliesToNextNode}matchTNode(o,i){const s=this.metadata.predicate;if(Array.isArray(s))for(let c=0;c<s.length;c++){const f=s[c];this.matchTNodeWithReadOption(o,i,eP(i,f)),this.matchTNodeWithReadOption(o,i,Vp(i,o,f,!1,!1))}else s===Wl?4&i.type&&this.matchTNodeWithReadOption(o,i,-1):this.matchTNodeWithReadOption(o,i,Vp(i,o,s,!1,!1))}matchTNodeWithReadOption(o,i,s){if(null!==s){const c=this.metadata.read;if(null!==c)if(c===Oi||c===ds||c===Wl&&4&i.type)this.addMatch(i.index,-2);else{const f=Vp(i,o,c,!1,!1);null!==f&&this.addMatch(i.index,f)}else this.addMatch(i.index,s)}}addMatch(o,i){null===this.matches?this.matches=[o,i]:this.matches.push(o,i)}}function eP(e,o){const i=e.localNames;if(null!==i)for(let s=0;s<i.length;s+=2)if(i[s]===o)return i[s+1];return null}function $T(e,o,i,s){return-1===i?function Lu(e,o){return 11&e.type?Qh(e,o):4&e.type?hg(e,o):null}(o,e):-2===i?function zf(e,o,i){return i===Oi?Qh(o,e):i===Wl?hg(o,e):i===ds?jT(o,e):void 0}(e,o,s):yc(e,e[he],i,o)}function GT(e,o,i,s){const c=o[Us].queries[s];if(null===c.matches){const f=e.data,g=i.matches,v=[];for(let w=0;w<g.length;w+=2){const T=g[w];v.push(T<0?null:$T(o,f[T],g[w+1],i.metadata.read))}c.matches=v}return c.matches}function U1(e,o,i,s){const c=e.queries.getByIndex(i),f=c.matches;if(null!==f){const g=GT(e,o,c,i);for(let v=0;v<f.length;v+=2){const w=f[v];if(w>0)s.push(g[v/2]);else{const T=f[v+1],A=o[-w];for(let k=Xr;k<A.length;k++){const B=A[k];B[fc]===B[Ai]&&U1(B[he],B,T,s)}if(null!==A[lu]){const k=A[lu];for(let B=0;B<k.length;B++){const $=k[B];U1($[he],$,T,s)}}}}}return s}function br(e){const o=Nt(),i=Wn(),s=T_();D_(s+1);const c=ll(i,s);if(e.dirty&&function Ua(e){return 4==(4&e[fn])}(o)===(2==(2&c.metadata.flags))){if(null===c.matches)e.reset([]);else{const f=c.crossesNgTemplate?U1(i,o,s,[]):GT(i,o,c,s);e.reset(f,tf),e.notifyOnChanges()}return!0}return!1}function Ta(e,o,i){const s=Wn();s.firstCreatePass&&(wv(s,new V1(e,o,i),-1),2==(2&o)&&(s.staticViewQueries=!0)),H1(s,Nt(),o)}function Qs(e,o,i,s){const c=Wn();if(c.firstCreatePass){const f=fo();wv(c,new V1(o,i,s),f.index),function nP(e,o){const i=e.contentQueries||(e.contentQueries=[]);o!==(i.length?i[i.length-1]:-1)&&i.push(e.queries.length-1,o)}(c,e),2==(2&i)&&(c.staticContentQueries=!0)}H1(c,Nt(),i)}function rr(){return function bv(e,o){return e[Us].queries[o].queryList}(Nt(),T_())}function H1(e,o,i){const s=new Ff(4==(4&i));(function OM(e,o,i,s){const c=Oy(o);c.push(i),e.firstCreatePass&&BM(e).push(s,c.length-1)})(e,o,s,s.destroy),null===o[Us]&&(o[Us]=new xv),o[Us].queries.push(new B1(s))}function wv(e,o,i){null===e.queries&&(e.queries=new Nf),e.queries.track(new j1(o,i))}function ll(e,o){return e.queries.getByIndex(o)}function qT(e,o){return hg(e,o)}const nw=new $t("Application Initializer");let iw=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,s)=>{this.resolve=i,this.reject=s}),this.appInits=ne(nw,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const i=[];for(const c of this.appInits){const f=c();if(Ef(f))i.push(f);else if(Vb(f)){const g=new Promise((v,w)=>{f.subscribe({complete:v,error:w})});i.push(g)}}const s=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{s()}).catch(c=>{this.reject(c)}),0===i.length&&s(),this.initialized=!0}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),sD=(()=>{class e{log(i){console.log(i)}warn(i){console.warn(i)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const Zl=new $t("LocaleId",{providedIn:"root",factory:()=>ne(Zl,Ke.Optional|Ke.SkipSelf)||function gP(){return typeof $localize<"u"&&$localize.locale||kd}()});let Bd=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new $r(!1)}add(){this.hasPendingTasks.next(!0);const i=this.taskId++;return this.pendingTasks.add(i),i}remove(i){this.pendingTasks.delete(i),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class vP{constructor(o,i){this.ngModuleFactory=o,this.componentFactories=i}}let ow=(()=>{class e{compileModuleSync(i){return new gv(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){const s=this.compileModuleSync(i),f=Dc($o(i).declarations).reduce((g,v)=>{const w=Kn(v);return w&&g.push(new uf(w)),g},[]);return new vP(s,f)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const x=new $t(""),b=new $t("");let M,E=(()=>{class e{constructor(i,s,c){this._ngZone=i,this.registry=s,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,M||(function S(e){M=e}(c),c.addToWindow(s)),this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Xe.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(s=>!s.updateCb||!s.updateCb(i)||(clearTimeout(s.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,s,c){let f=-1;s&&s>0&&(f=setTimeout(()=>{this._callbacks=this._callbacks.filter(g=>g.timeoutId!==f),i(this._didWork,this.getPendingTasks())},s)),this._callbacks.push({doneCb:i,timeoutId:f,updateCb:c})}whenStable(i,s,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,s,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(i){this.registry.registerApplication(i,this)}unregisterApplication(i){this.registry.unregisterApplication(i)}findProviders(i,s,c){return[]}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Xe),bt(C),bt(b))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})(),C=(()=>{class e{constructor(){this._applications=new Map}registerApplication(i,s){this._applications.set(i,s)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,s=!0){return M?.findTestabilityInTree(this,i,s)??null}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),D=null;const R=new $t("AllowMultipleToken"),P=new $t("PlatformDestroyListeners"),I=new $t("appBootstrapListener");class z{constructor(o,i){this.name=o,this.token=i}}function Z(e,o,i=[]){const s=`Platform: ${o}`,c=new $t(s);return(f=[])=>{let g=Y();if(!g||g.injector.get(R,!1)){const v=[...i,...f,{provide:c,useValue:!0}];e?e(v):function U(e){if(D&&!D.get(R,!1))throw new at(400,!1);(function L(){!function LE(e){FE=e}(()=>{throw new at(600,!1)})})(),D=e;const o=e.get(ot);(function G(e){e.get(sM,null)?.forEach(i=>i())})(e)}(function it(e=[],o){return Fr.create({name:o,providers:[{provide:$x,useValue:"platform"},{provide:P,useValue:new Set([()=>D=null])},...e]})}(v,s))}return function et(e){const o=Y();if(!o)throw new at(401,!1);return o}()}}function Y(){return D?.get(ot)??null}let ot=(()=>{class e{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,s){const c=function ht(e="zone.js",o){return"noop"===e?new _M:"zone.js"===e?new Xe(o):e}(s?.ngZone,function lt(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:s?.ngZoneEventCoalescing,runCoalescing:s?.ngZoneRunCoalescing}));return c.run(()=>{const f=function vT(e,o,i){return new mv(e,o,i)}(i.moduleType,this.injector,function ye(e){return[{provide:Xe,useFactory:e},{provide:nm,multi:!0,useFactory:()=>{const o=ne(Ht,{optional:!0});return()=>o.initialize()}},{provide:Vt,useFactory:jt},{provide:fb,useFactory:pb}]}(()=>c)),g=f.injector.get(wa,null);return c.runOutsideAngular(()=>{const v=c.onError.subscribe({next:w=>{g.handleError(w)}});f.onDestroy(()=>{ft(this._modules,f),v.unsubscribe()})}),function mt(e,o,i){try{const s=i();return Ef(s)?s.catch(c=>{throw o.runOutsideAngular(()=>e.handleError(c)),c}):s}catch(s){throw o.runOutsideAngular(()=>e.handleError(s)),s}}(g,c,()=>{const v=f.injector.get(iw);return v.runInitializers(),v.donePromise.then(()=>(function Fd(e){Vo(e,"Expected localeId to be defined"),"string"==typeof e&&(iv=e.toLowerCase().replace(/_/g,"-"))}(f.injector.get(Zl,kd)||kd),this._moduleDoBootstrap(f),f))})})}bootstrapModule(i,s=[]){const c=vt({},s);return function O(e,o,i){const s=new gv(i);return Promise.resolve(s)}(0,0,i).then(f=>this.bootstrapModuleFactory(f,c))}_moduleDoBootstrap(i){const s=i.injector.get(ct);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(c=>s.bootstrap(c));else{if(!i.instance.ngDoBootstrap)throw new at(-403,!1);i.instance.ngDoBootstrap(s)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new at(404,!1);this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s());const i=this._injector.get(P,null);i&&(i.forEach(s=>s()),i.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Fr))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function vt(e,o){return Array.isArray(o)?o.reduce(vt,e):{...e,...o}}let ct=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ne(Vt),this.zoneIsStable=ne(fb),this.componentTypes=[],this.components=[],this.isStable=ne(Bd).hasPendingTasks.pipe(Gr(i=>i?kt(!1):this.zoneIsStable),Ku(),zn()),this._injector=ne(Ds)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(i,s){const c=i instanceof uM;if(!this._injector.get(iw).done)throw!c&&function su(e){const o=Kn(e)||Zr(e)||Ho(e);return null!==o&&o.standalone}(i),new at(405,!1);let g;g=c?i:this._injector.get(pm).resolveComponentFactory(i),this.componentTypes.push(g.componentType);const v=function N(e){return e.isBoundToModule}(g)?void 0:this._injector.get(Fu),T=g.create(Fr.NULL,[],s||g.selector,v),A=T.location.nativeElement,k=T.injector.get(x,null);return k?.registerApplication(A),T.onDestroy(()=>{this.detachView(T.hostView),ft(this.components,T),k?.unregisterApplication(A)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new at(101,!1);try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1}}attachView(i){const s=i;this._views.push(s),s.attachToAppRef(this)}detachView(i){const s=i;ft(this._views,s),s.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i);const s=this._injector.get(I,[]);s.push(...this._bootstrapListeners),s.forEach(c=>c(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>ft(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new at(406,!1);const i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function ft(e,o){const i=e.indexOf(o);i>-1&&e.splice(i,1)}const Vt=new $t("",{providedIn:"root",factory:()=>ne(wa).handleError.bind(void 0)});function jt(){const e=ne(Xe),o=ne(wa);return i=>e.runOutsideAngular(()=>o.handleError(i))}let Ht=(()=>{class e{constructor(){this.zone=ne(Xe),this.applicationRef=ne(ct)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let Le=(()=>{class e{static#t=this.__NG_ELEMENT_ID__=ln}return e})();function ln(e){return function Be(e,o,i){if(cu(e)&&!i){const s=qs(e.index,o);return new Im(s,s)}return 47&e.type?new Im(o[tr],o):null}(fo(),Nt(),16==(16&e))}class cw{constructor(){}supports(o){return el(o)}create(o){return new dw(o)}}const uw=(e,o)=>o;class dw{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||uw}forEachItem(o){let i;for(i=this._itHead;null!==i;i=i._next)o(i)}forEachOperation(o){let i=this._itHead,s=this._removalsHead,c=0,f=null;for(;i||s;){const g=!s||i&&i.currentIndex<kv(s,c,f)?i:s,v=kv(g,c,f),w=g.currentIndex;if(g===s)c--,s=s._nextRemoved;else if(i=i._next,null==g.previousIndex)c++;else{f||(f=[]);const T=v-c,A=w-c;if(T!=A){for(let B=0;B<T;B++){const $=B<f.length?f[B]:f[B]=0,K=$+B;A<=K&&K<T&&(f[B]=$+1)}f[g.previousIndex]=A-T}}v!==w&&o(g,v,w)}}forEachPreviousItem(o){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)o(i)}forEachAddedItem(o){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)o(i)}forEachMovedItem(o){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)o(i)}forEachRemovedItem(o){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)o(i)}forEachIdentityChange(o){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)o(i)}diff(o){if(null==o&&(o=[]),!el(o))throw new at(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let c,f,g,i=this._itHead,s=!1;if(Array.isArray(o)){this.length=o.length;for(let v=0;v<this.length;v++)f=o[v],g=this._trackByFn(v,f),null!==i&&Object.is(i.trackById,g)?(s&&(i=this._verifyReinsertion(i,f,g,v)),Object.is(i.item,f)||this._addIdentityChange(i,f)):(i=this._mismatch(i,f,g,v),s=!0),i=i._next}else c=0,function ZM(e,o){if(Array.isArray(e))for(let i=0;i<e.length;i++)o(e[i]);else{const i=e[Symbol.iterator]();let s;for(;!(s=i.next()).done;)o(s.value)}}(o,v=>{g=this._trackByFn(c,v),null!==i&&Object.is(i.trackById,g)?(s&&(i=this._verifyReinsertion(i,v,g,c)),Object.is(i.item,v)||this._addIdentityChange(i,v)):(i=this._mismatch(i,v,g,c),s=!0),i=i._next,c++}),this.length=c;return this._truncate(i),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,i,s,c){let f;return null===o?f=this._itTail:(f=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null))?(Object.is(o.item,i)||this._addIdentityChange(o,i),this._reinsertAfter(o,f,c)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(s,c))?(Object.is(o.item,i)||this._addIdentityChange(o,i),this._moveAfter(o,f,c)):o=this._addAfter(new Yl(i,s),f,c),o}_verifyReinsertion(o,i,s,c){let f=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null);return null!==f?o=this._reinsertAfter(f,o._prev,c):o.currentIndex!=c&&(o.currentIndex=c,this._addToMoves(o,c)),o}_truncate(o){for(;null!==o;){const i=o._next;this._addToRemovals(this._unlink(o)),o=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,i,s){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const c=o._prevRemoved,f=o._nextRemoved;return null===c?this._removalsHead=f:c._nextRemoved=f,null===f?this._removalsTail=c:f._prevRemoved=c,this._insertAfter(o,i,s),this._addToMoves(o,s),o}_moveAfter(o,i,s){return this._unlink(o),this._insertAfter(o,i,s),this._addToMoves(o,s),o}_addAfter(o,i,s){return this._insertAfter(o,i,s),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,i,s){const c=null===i?this._itHead:i._next;return o._next=c,o._prev=i,null===c?this._itTail=o:c._prev=o,null===i?this._itHead=o:i._next=o,null===this._linkedRecords&&(this._linkedRecords=new Nu),this._linkedRecords.put(o),o.currentIndex=s,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const i=o._prev,s=o._next;return null===i?this._itHead=s:i._next=s,null===s?this._itTail=i:s._prev=i,o}_addToMoves(o,i){return o.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Nu),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,i){return o.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Yl{constructor(o,i){this.item=o,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class cD{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,i){let s;for(s=this._head;null!==s;s=s._nextDup)if((null===i||i<=s.currentIndex)&&Object.is(s.trackById,o))return s;return null}remove(o){const i=o._prevDup,s=o._nextDup;return null===i?this._head=s:i._nextDup=s,null===s?this._tail=i:s._prevDup=i,null===this._head}}class Nu{constructor(){this.map=new Map}put(o){const i=o.trackById;let s=this.map.get(i);s||(s=new cD,this.map.set(i,s)),s.add(o)}get(o,i){const c=this.map.get(o);return c?c.get(o,i):null}remove(o){const i=o.trackById;return this.map.get(i).remove(o)&&this.map.delete(i),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function kv(e,o,i){const s=e.previousIndex;if(null===s)return s;let c=0;return i&&s<i.length&&(c=i[s]),s+o+c}class Fv{constructor(){}supports(o){return o instanceof Map||Om(o)}create(){return new hw}}class hw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let i;for(i=this._mapHead;null!==i;i=i._next)o(i)}forEachPreviousItem(o){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)o(i)}forEachChangedItem(o){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)o(i)}forEachAddedItem(o){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)o(i)}forEachRemovedItem(o){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)o(i)}diff(o){if(o){if(!(o instanceof Map||Om(o)))throw new at(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(o,(s,c)=>{if(i&&i.key===c)this._maybeAddToChanges(i,s),this._appendAfter=i,i=i._next;else{const f=this._getOrCreateRecordForKey(c,s);i=this._insertBeforeOrAppend(i,f)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let s=i;null!==s;s=s._nextRemoved)s===this._mapHead&&(this._mapHead=null),this._records.delete(s.key),s._nextRemoved=s._next,s.previousValue=s.currentValue,s.currentValue=null,s._prev=null,s._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,i){if(o){const s=o._prev;return i._next=o,i._prev=s,o._prev=i,s&&(s._next=i),o===this._mapHead&&(this._mapHead=i),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(o,i){if(this._records.has(o)){const c=this._records.get(o);this._maybeAddToChanges(c,i);const f=c._prev,g=c._next;return f&&(f._next=g),g&&(g._prev=f),c._next=null,c._prev=null,c}const s=new zu(o);return this._records.set(o,s),s.currentValue=i,this._addToAdditions(s),s}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,i){Object.is(i,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=i,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,i){o instanceof Map?o.forEach(i):Object.keys(o).forEach(s=>i(o[s],s))}}class zu{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Lv(){return new Nv([new cw])}let Nv=(()=>{class e{static#t=this.\u0275prov=ee({token:e,providedIn:"root",factory:Lv});constructor(i){this.factories=i}static create(i,s){if(null!=s){const c=s.factories.slice();i=i.concat(c)}return new e(i)}static extend(i){return{provide:e,useFactory:s=>e.create(i,s||Lv()),deps:[[e,new kh,new gu]]}}find(i){const s=this.factories.find(c=>c.supports(i));if(null!=s)return s;throw new at(901,!1)}}return e})();function fs(){return new Kl([new Fv])}let Kl=(()=>{class e{static#t=this.\u0275prov=ee({token:e,providedIn:"root",factory:fs});constructor(i){this.factories=i}static create(i,s){if(s){const c=s.factories.slice();i=i.concat(c)}return new e(i)}static extend(i){return{provide:e,useFactory:s=>e.create(i,s||fs()),deps:[[e,new kh,new gu]]}}find(i){const s=this.factories.find(c=>c.supports(i));if(s)return s;throw new at(901,!1)}}return e})();const f5=Z(null,"core",[]);let p5=(()=>{class e{constructor(i){}static#t=this.\u0275fac=function(s){return new(s||e)(bt(ct))};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({})}return e})();let FP=null;function Hf(){return FP}class D5{}const Qn=new $t("DocumentToken");let LP=(()=>{class e{historyGo(i){throw new Error("Not implemented")}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:function(){return ne(A5)},providedIn:"platform"})}return e})();const I5=new $t("Location Initialized");let A5=(()=>{class e extends LP{constructor(){super(),this._doc=ne(Qn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Hf().getBaseHref(this._doc)}onPopState(i){const s=Hf().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",i,!1),()=>s.removeEventListener("popstate",i)}onHashChange(i){const s=Hf().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",i,!1),()=>s.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,s,c){this._history.pushState(i,s,c)}replaceState(i,s,c){this._history.replaceState(i,s,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function NP(e,o){if(0==e.length)return o;if(0==o.length)return e;let i=0;return e.endsWith("/")&&i++,o.startsWith("/")&&i++,2==i?e+o.substring(1):1==i?e+o:e+"/"+o}function gL(e){const o=e.match(/#|\?|$/),i=o&&o.index||e.length;return e.slice(0,i-("/"===e[i-1]?1:0))+e.slice(i)}function Hd(e){return e&&"?"!==e[0]?"?"+e:e}let vg=(()=>{class e{historyGo(i){throw new Error("Not implemented")}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:function(){return ne(yL)},providedIn:"root"})}return e})();const _L=new $t("appBaseHref");let yL=(()=>{class e extends vg{constructor(i,s){super(),this._platformLocation=i,this._removeListenerFns=[],this._baseHref=s??this._platformLocation.getBaseHrefFromDOM()??ne(Qn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return NP(this._baseHref,i)}path(i=!1){const s=this._platformLocation.pathname+Hd(this._platformLocation.search),c=this._platformLocation.hash;return c&&i?`${s}${c}`:s}pushState(i,s,c,f){const g=this.prepareExternalUrl(c+Hd(f));this._platformLocation.pushState(i,s,g)}replaceState(i,s,c,f){const g=this.prepareExternalUrl(c+Hd(f));this._platformLocation.replaceState(i,s,g)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(LP),bt(_L,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),R5=(()=>{class e extends vg{constructor(i,s){super(),this._platformLocation=i,this._baseHref="",this._removeListenerFns=[],null!=s&&(this._baseHref=s)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let s=this._platformLocation.hash;return null==s&&(s="#"),s.length>0?s.substring(1):s}prepareExternalUrl(i){const s=NP(this._baseHref,i);return s.length>0?"#"+s:s}pushState(i,s,c,f){let g=this.prepareExternalUrl(c+Hd(f));0==g.length&&(g=this._platformLocation.pathname),this._platformLocation.pushState(i,s,g)}replaceState(i,s,c,f){let g=this.prepareExternalUrl(c+Hd(f));0==g.length&&(g=this._platformLocation.pathname),this._platformLocation.replaceState(i,s,g)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(LP),bt(_L,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})(),hD=(()=>{class e{constructor(i){this._subject=new oi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=i;const s=this._locationStrategy.getBaseHref();this._basePath=function k5(e){if(new RegExp("^(https?:)?//").test(e)){const[,i]=e.split(/\/\/[^\/]+/);return i}return e}(gL(vL(s))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,s=""){return this.path()==this.normalize(i+Hd(s))}normalize(i){return e.stripTrailingSlash(function O5(e,o){if(!e||!o.startsWith(e))return o;const i=o.substring(e.length);return""===i||["/",";","?","#"].includes(i[0])?i:o}(this._basePath,vL(i)))}prepareExternalUrl(i){return i&&"/"!==i[0]&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,s="",c=null){this._locationStrategy.pushState(c,"",i,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Hd(s)),c)}replaceState(i,s="",c=null){this._locationStrategy.replaceState(c,"",i,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+Hd(s)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)})),()=>{const s=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(s,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",s){this._urlChangeListeners.forEach(c=>c(i,s))}subscribe(i,s,c){return this._subject.subscribe({next:i,error:s,complete:c})}static#t=this.normalizeQueryParams=Hd;static#e=this.joinWithSlash=NP;static#n=this.stripTrailingSlash=gL;static#i=this.\u0275fac=function(s){return new(s||e)(bt(vg))};static#r=this.\u0275prov=ee({token:e,factory:function(){return function P5(){return new hD(bt(vg))}()},providedIn:"root"})}return e})();function vL(e){return e.replace(/\/index.html$/,"")}function DL(e,o){o=encodeURIComponent(o);for(const i of e.split(";")){const s=i.indexOf("="),[c,f]=-1==s?[i,""]:[i.slice(0,s),i.slice(s+1)];if(c.trim()===o)return decodeURIComponent(f)}return null}const WP=/\s+/,IL=[];let AL=(()=>{class e{constructor(i,s,c,f){this._iterableDiffers=i,this._keyValueDiffers=s,this._ngEl=c,this._renderer=f,this.initialClasses=IL,this.stateMap=new Map}set klass(i){this.initialClasses=null!=i?i.trim().split(WP):IL}set ngClass(i){this.rawClass="string"==typeof i?i.trim().split(WP):i}ngDoCheck(){for(const s of this.initialClasses)this._updateState(s,!0);const i=this.rawClass;if(Array.isArray(i)||i instanceof Set)for(const s of i)this._updateState(s,!0);else if(null!=i)for(const s of Object.keys(i))this._updateState(s,!!i[s]);this._applyStateDiff()}_updateState(i,s){const c=this.stateMap.get(i);void 0!==c?(c.enabled!==s&&(c.changed=!0,c.enabled=s),c.touched=!0):this.stateMap.set(i,{enabled:s,changed:!0,touched:!0})}_applyStateDiff(){for(const i of this.stateMap){const s=i[0],c=i[1];c.changed?(this._toggleClass(s,c.enabled),c.changed=!1):c.touched||(c.enabled&&this._toggleClass(s,!1),this.stateMap.delete(s)),c.touched=!1}}_toggleClass(i,s){(i=i.trim()).length>0&&i.split(WP).forEach(c=>{s?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Nv),_t(Kl),_t(Oi),_t(Tc))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return e})(),ZP=(()=>{class e{constructor(i,s){this._viewContainer=i,this._context=new bV,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){OL("ngIfThen",i),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){OL("ngIfElse",i),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(i,s){return!0}static#t=this.\u0275fac=function(s){return new(s||e)(_t(ds),_t(Wl))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class bV{constructor(){this.$implicit=null,this.ngIf=null}}function OL(e,o){if(o&&!o.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Or(o)}'.`)}class XP{constructor(o,i){this._viewContainerRef=o,this._templateRef=i,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(o){o&&!this._created?this.create():!o&&this._created&&this.destroy()}}let mw=(()=>{class e{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(i){this._ngSwitch=i,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(i){this._defaultViews.push(i)}_matchCase(i){const s=i==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||s,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),s}_updateDefaultCases(i){if(this._defaultViews.length>0&&i!==this._defaultUsed){this._defaultUsed=i;for(const s of this._defaultViews)s.enforceState(i)}}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0})}return e})(),YP=(()=>{class e{constructor(i,s,c){this.ngSwitch=c,c._addCase(),this._view=new XP(i,s)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}static#t=this.\u0275fac=function(s){return new(s||e)(_t(ds),_t(Wl),_t(mw,9))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0})}return e})(),kL=(()=>{class e{constructor(i,s,c){c._addDefault(new XP(i,s))}static#t=this.\u0275fac=function(s){return new(s||e)(_t(ds),_t(Wl),_t(mw,9))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngSwitchDefault",""]],standalone:!0})}return e})(),LL=(()=>{class e{constructor(i){this._viewContainerRef=i,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(i){if(i.ngTemplateOutlet||i.ngTemplateOutletInjector){const s=this._viewContainerRef;if(this._viewRef&&s.remove(s.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:c,ngTemplateOutletContext:f,ngTemplateOutletInjector:g}=this;this._viewRef=s.createEmbeddedView(c,f,g?{injector:g}:void 0)}else this._viewRef=null}else this._viewRef&&i.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(ds))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[qo]})}return e})(),ED=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({})}return e})();const zL="browser";function BL(e){return"server"===e}let YV=(()=>{class e{static#t=this.\u0275prov=ee({token:e,providedIn:"root",factory:()=>new KV(bt(Qn),window)})}return e})();class KV{constructor(o,i){this.document=o,this.window=i,this.offset=()=>[0,0]}setOffset(o){this.offset=Array.isArray(o)?()=>o:o}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(o){this.supportsScrolling()&&this.window.scrollTo(o[0],o[1])}scrollToAnchor(o){if(!this.supportsScrolling())return;const i=function JV(e,o){const i=e.getElementById(o)||e.getElementsByName(o)[0];if(i)return i;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const s=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let c=s.currentNode;for(;c;){const f=c.shadowRoot;if(f){const g=f.getElementById(o)||f.querySelector(`[name="${o}"]`);if(g)return g}c=s.nextNode()}}return null}(this.document,o);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(o){this.supportsScrolling()&&(this.window.history.scrollRestoration=o)}scrollToElement(o){const i=o.getBoundingClientRect(),s=i.left+this.window.pageXOffset,c=i.top+this.window.pageYOffset,f=this.offset();this.window.scrollTo(s-f[0],c-f[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class VL{}class bj extends D5{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class eO extends bj{static makeCurrent(){!function T5(e){FP||(FP=e)}(new eO)}onAndCancel(o,i,s){return o.addEventListener(i,s),()=>{o.removeEventListener(i,s)}}dispatchEvent(o,i){o.dispatchEvent(i)}remove(o){o.parentNode&&o.parentNode.removeChild(o)}createElement(o,i){return(i=i||this.getDefaultDocument()).createElement(o)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(o){return o.nodeType===Node.ELEMENT_NODE}isShadowRoot(o){return o instanceof DocumentFragment}getGlobalEventTarget(o,i){return"window"===i?window:"document"===i?o:"body"===i?o.body:null}getBaseHref(o){const i=function wj(){return _w=_w||document.querySelector("base"),_w?_w.getAttribute("href"):null}();return null==i?null:function Ej(e){SD=SD||document.createElement("a"),SD.setAttribute("href",e);const o=SD.pathname;return"/"===o.charAt(0)?o:`/${o}`}(i)}resetBaseElement(){_w=null}getUserAgent(){return window.navigator.userAgent}getCookie(o){return DL(document.cookie,o)}}let SD,_w=null,Mj=(()=>{class e{build(){return new XMLHttpRequest}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();const nO=new $t("EventManagerPlugins");let GL=(()=>{class e{constructor(i,s){this._zone=s,this._eventNameToPlugin=new Map,i.forEach(c=>{c.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,s,c){return this._findPluginFor(s).addEventListener(i,s,c)}getZone(){return this._zone}_findPluginFor(i){let s=this._eventNameToPlugin.get(i);if(s)return s;if(s=this._plugins.find(f=>f.supports(i)),!s)throw new at(5101,!1);return this._eventNameToPlugin.set(i,s),s}static#t=this.\u0275fac=function(s){return new(s||e)(bt(nO),bt(Xe))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();class qL{constructor(o){this._doc=o}}const iO="ng-app-id";let WL=(()=>{class e{constructor(i,s,c,f={}){this.doc=i,this.appId=s,this.nonce=c,this.platformId=f,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=BL(f),this.resetHostNodes()}addStyles(i){for(const s of i)1===this.changeUsageCount(s,1)&&this.onStyleAdded(s)}removeStyles(i){for(const s of i)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){const i=this.styleNodesInDOM;i&&(i.forEach(s=>s.remove()),i.clear());for(const s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(const s of this.getAllStyles())this.addStyleToHost(i,s)}removeHost(i){this.hostNodes.delete(i)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(i){for(const s of this.hostNodes)this.addStyleToHost(s,i)}onStyleRemoved(i){const s=this.styleRef;s.get(i)?.elements?.forEach(c=>c.remove()),s.delete(i)}collectServerRenderedStyles(){const i=this.doc.head?.querySelectorAll(`style[${iO}="${this.appId}"]`);if(i?.length){const s=new Map;return i.forEach(c=>{null!=c.textContent&&s.set(c.textContent,c)}),s}return null}changeUsageCount(i,s){const c=this.styleRef;if(c.has(i)){const f=c.get(i);return f.usage+=s,f.usage}return c.set(i,{usage:s,elements:[]}),s}getStyleElement(i,s){const c=this.styleNodesInDOM,f=c?.get(s);if(f?.parentNode===i)return c.delete(s),f.removeAttribute(iO),f;{const g=this.doc.createElement("style");return this.nonce&&g.setAttribute("nonce",this.nonce),g.textContent=s,this.platformIsServer&&g.setAttribute(iO,this.appId),g}}addStyleToHost(i,s){const c=this.getStyleElement(i,s);i.appendChild(c);const f=this.styleRef,g=f.get(s)?.elements;g?g.push(c):f.set(s,{elements:[c],usage:1})}resetHostNodes(){const i=this.hostNodes;i.clear(),i.add(this.doc.head)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn),bt(am),bt(Zx,8),bt(Ya))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();const rO={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},oO=/%COMP%/g,Ij=new $t("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function XL(e,o){return o.map(i=>i.replace(oO,e))}let sO=(()=>{class e{constructor(i,s,c,f,g,v,w,T=null){this.eventManager=i,this.sharedStylesHost=s,this.appId=c,this.removeStylesOnCompDestroy=f,this.doc=g,this.platformId=v,this.ngZone=w,this.nonce=T,this.rendererByCompId=new Map,this.platformIsServer=BL(v),this.defaultRenderer=new aO(i,g,w,this.platformIsServer)}createRenderer(i,s){if(!i||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===jo.ShadowDom&&(s={...s,encapsulation:jo.Emulated});const c=this.getOrCreateRenderer(i,s);return c instanceof KL?c.applyToHost(i):c instanceof lO&&c.applyStyles(),c}getOrCreateRenderer(i,s){const c=this.rendererByCompId;let f=c.get(s.id);if(!f){const g=this.doc,v=this.ngZone,w=this.eventManager,T=this.sharedStylesHost,A=this.removeStylesOnCompDestroy,k=this.platformIsServer;switch(s.encapsulation){case jo.Emulated:f=new KL(w,T,s,this.appId,A,g,v,k);break;case jo.ShadowDom:return new Oj(w,T,i,s,g,v,this.nonce,k);default:f=new lO(w,T,s,A,g,v,k)}c.set(s.id,f)}return f}ngOnDestroy(){this.rendererByCompId.clear()}static#t=this.\u0275fac=function(s){return new(s||e)(bt(GL),bt(WL),bt(am),bt(Ij),bt(Qn),bt(Ya),bt(Xe),bt(Zx))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();class aO{constructor(o,i,s,c){this.eventManager=o,this.doc=i,this.ngZone=s,this.platformIsServer=c,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(o,i){return i?this.doc.createElementNS(rO[i]||i,o):this.doc.createElement(o)}createComment(o){return this.doc.createComment(o)}createText(o){return this.doc.createTextNode(o)}appendChild(o,i){(YL(o)?o.content:o).appendChild(i)}insertBefore(o,i,s){o&&(YL(o)?o.content:o).insertBefore(i,s)}removeChild(o,i){o&&o.removeChild(i)}selectRootElement(o,i){let s="string"==typeof o?this.doc.querySelector(o):o;if(!s)throw new at(-5104,!1);return i||(s.textContent=""),s}parentNode(o){return o.parentNode}nextSibling(o){return o.nextSibling}setAttribute(o,i,s,c){if(c){i=c+":"+i;const f=rO[c];f?o.setAttributeNS(f,i,s):o.setAttribute(i,s)}else o.setAttribute(i,s)}removeAttribute(o,i,s){if(s){const c=rO[s];c?o.removeAttributeNS(c,i):o.removeAttribute(`${s}:${i}`)}else o.removeAttribute(i)}addClass(o,i){o.classList.add(i)}removeClass(o,i){o.classList.remove(i)}setStyle(o,i,s,c){c&(vc.DashCase|vc.Important)?o.style.setProperty(i,s,c&vc.Important?"important":""):o.style[i]=s}removeStyle(o,i,s){s&vc.DashCase?o.style.removeProperty(i):o.style[i]=""}setProperty(o,i,s){o[i]=s}setValue(o,i){o.nodeValue=i}listen(o,i,s){if("string"==typeof o&&!(o=Hf().getGlobalEventTarget(this.doc,o)))throw new Error(`Unsupported event target ${o} for event ${i}`);return this.eventManager.addEventListener(o,i,this.decoratePreventDefault(s))}decoratePreventDefault(o){return i=>{if("__ngUnwrap__"===i)return o;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>o(i)):o(i))&&i.preventDefault()}}}function YL(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class Oj extends aO{constructor(o,i,s,c,f,g,v,w){super(o,f,g,w),this.sharedStylesHost=i,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const T=XL(c.id,c.styles);for(const A of T){const k=document.createElement("style");v&&k.setAttribute("nonce",v),k.textContent=A,this.shadowRoot.appendChild(k)}}nodeOrShadowRoot(o){return o===this.hostEl?this.shadowRoot:o}appendChild(o,i){return super.appendChild(this.nodeOrShadowRoot(o),i)}insertBefore(o,i,s){return super.insertBefore(this.nodeOrShadowRoot(o),i,s)}removeChild(o,i){return super.removeChild(this.nodeOrShadowRoot(o),i)}parentNode(o){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(o)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class lO extends aO{constructor(o,i,s,c,f,g,v,w){super(o,f,g,v),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=c,this.styles=w?XL(w,s.styles):s.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class KL extends lO{constructor(o,i,s,c,f,g,v,w){const T=c+"-"+s.id;super(o,i,s,f,g,v,w,T),this.contentAttr=function Aj(e){return"_ngcontent-%COMP%".replace(oO,e)}(T),this.hostAttr=function Rj(e){return"_nghost-%COMP%".replace(oO,e)}(T)}applyToHost(o){this.applyStyles(),this.setAttribute(o,this.hostAttr,"")}createElement(o,i){const s=super.createElement(o,i);return super.setAttribute(s,this.contentAttr,""),s}}let kj=(()=>{class e extends qL{constructor(i){super(i)}supports(i){return!0}addEventListener(i,s,c){return i.addEventListener(s,c,!1),()=>this.removeEventListener(i,s,c)}removeEventListener(i,s,c){return i.removeEventListener(s,c)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();const JL=["alt","control","meta","shift"],Fj={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Lj={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Nj=(()=>{class e extends qL{constructor(i){super(i)}supports(i){return null!=e.parseEventName(i)}addEventListener(i,s,c){const f=e.parseEventName(s),g=e.eventCallback(f.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Hf().onAndCancel(i,f.domEventName,g))}static parseEventName(i){const s=i.toLowerCase().split("."),c=s.shift();if(0===s.length||"keydown"!==c&&"keyup"!==c)return null;const f=e._normalizeKey(s.pop());let g="",v=s.indexOf("code");if(v>-1&&(s.splice(v,1),g="code."),JL.forEach(T=>{const A=s.indexOf(T);A>-1&&(s.splice(A,1),g+=T+".")}),g+=f,0!=s.length||0===f.length)return null;const w={};return w.domEventName=c,w.fullKey=g,w}static matchEventFullKeyCode(i,s){let c=Fj[i.key]||i.key,f="";return s.indexOf("code.")>-1&&(c=i.code,f="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),JL.forEach(g=>{g!==c&&(0,Lj[g])(i)&&(f+=g+".")}),f+=c,f===s)}static eventCallback(i,s,c){return f=>{e.matchEventFullKeyCode(f,i)&&c.runGuarded(()=>s(f))}}static _normalizeKey(i){return"esc"===i?"escape":i}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();const jj=Z(f5,"browser",[{provide:Ya,useValue:zL},{provide:sM,useValue:function zj(){eO.makeCurrent()},multi:!0},{provide:Qn,useFactory:function Vj(){return function Rx(e){Ax=e}(document),document},deps:[]}]),Uj=new $t(""),eN=[{provide:b,useClass:class Cj{addToWindow(o){Vi.getAngularTestability=(s,c=!0)=>{const f=o.findTestabilityInTree(s,c);if(null==f)throw new at(5103,!1);return f},Vi.getAllAngularTestabilities=()=>o.getAllTestabilities(),Vi.getAllAngularRootElements=()=>o.getAllRootElements(),Vi.frameworkStabilizers||(Vi.frameworkStabilizers=[]),Vi.frameworkStabilizers.push(s=>{const c=Vi.getAllAngularTestabilities();let f=c.length,g=!1;const v=function(w){g=g||w,f--,0==f&&s(g)};c.forEach(w=>{w.whenStable(v)})})}findTestabilityInTree(o,i,s){return null==i?null:o.getTestability(i)??(s?Hf().isShadowRoot(i)?this.findTestabilityInTree(o,i.host,!0):this.findTestabilityInTree(o,i.parentElement,!0):null)}},deps:[]},{provide:x,useClass:E,deps:[Xe,C,b]},{provide:E,useClass:E,deps:[Xe,C,b]}],nN=[{provide:$x,useValue:"root"},{provide:wa,useFactory:function Bj(){return new wa},deps:[]},{provide:nO,useClass:kj,multi:!0,deps:[Qn,Xe,Ya]},{provide:nO,useClass:Nj,multi:!0,deps:[Qn]},sO,WL,GL,{provide:mm,useExisting:sO},{provide:VL,useClass:Mj,deps:[]},[]];let iN=(()=>{class e{constructor(i){}static withServerTransition(i){return{ngModule:e,providers:[{provide:am,useValue:i.appId}]}}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Uj,12))};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({providers:[...nN,...eN],imports:[ED,p5]})}return e})(),rN=(()=>{class e{constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn))};static#e=this.\u0275prov=ee({token:e,factory:function(s){let c=null;return c=s?new s:function $j(){return new rN(bt(Qn))}(),c},providedIn:"root"})}return e})();typeof window<"u"&&window;let uO=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:function(s){let c=null;return c=s?new(s||e):bt(aN),c},providedIn:"root"})}return e})(),aN=(()=>{class e extends uO{constructor(i){super(),this._doc=i}sanitize(i,s){if(null==s)return null;switch(i){case io.NONE:return s;case io.HTML:return ba(s,"HTML")?eo(s):oy(this._doc,String(s)).toString();case io.STYLE:return ba(s,"Style")?eo(s):s;case io.SCRIPT:if(ba(s,"Script"))return eo(s);throw new at(5200,!1);case io.URL:return ba(s,"URL")?eo(s):Qp(String(s));case io.RESOURCE_URL:if(ba(s,"ResourceURL"))return eo(s);throw new at(5201,!1);default:throw new at(5202,!1)}}bypassSecurityTrustHtml(i){return function $C(e){return new $h(e)}(i)}bypassSecurityTrustStyle(i){return function GC(e){return new cs(e)}(i)}bypassSecurityTrustScript(i){return function Vr(e){return new Jp(e)}(i)}bypassSecurityTrustUrl(i){return function qC(e){return new ny(e)}(i)}bypassSecurityTrustResourceUrl(i){return function WC(e){return new HC(e)}(i)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn))};static#e=this.\u0275prov=ee({token:e,factory:function(s){let c=null;return c=s?new s:function Zj(e){return new aN(e.get(Qn))}(bt(Fr)),c},providedIn:"root"})}return e})();class cN{}class Xj{}const qd="*";function dO(e,o){return{type:7,name:e,definitions:o,options:{}}}function hO(e,o=null){return{type:4,styles:o,timings:e}}function uN(e,o=null){return{type:2,steps:e,options:o}}function xg(e){return{type:6,styles:e,offset:null}}function dN(e,o,i){return{type:0,name:e,styles:o,options:i}}function TD(e,o,i=null){return{type:1,expr:e,animation:o,options:i}}function Yj(e=null){return{type:9,options:e}}function Kj(e,o,i=null){return{type:11,selector:e,animation:o,options:i}}class yw{constructor(o=0,i=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=o+i}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(o=>o()),this._onDoneFns=[])}onStart(o){this._originalOnStartFns.push(o),this._onStartFns.push(o)}onDone(o){this._originalOnDoneFns.push(o),this._onDoneFns.push(o)}onDestroy(o){this._onDestroyFns.push(o)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(o=>o()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(o=>o()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(o){this._position=this.totalTime?o*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(o){const i="start"==o?this._onStartFns:this._onDoneFns;i.forEach(s=>s()),i.length=0}}class hN{constructor(o){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=o;let i=0,s=0,c=0;const f=this.players.length;0==f?queueMicrotask(()=>this._onFinish()):this.players.forEach(g=>{g.onDone(()=>{++i==f&&this._onFinish()}),g.onDestroy(()=>{++s==f&&this._onDestroy()}),g.onStart(()=>{++c==f&&this._onStart()})}),this.totalTime=this.players.reduce((g,v)=>Math.max(g,v.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(o=>o()),this._onDoneFns=[])}init(){this.players.forEach(o=>o.init())}onStart(o){this._onStartFns.push(o)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(o=>o()),this._onStartFns=[])}onDone(o){this._onDoneFns.push(o)}onDestroy(o){this._onDestroyFns.push(o)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(o=>o.play())}pause(){this.players.forEach(o=>o.pause())}restart(){this.players.forEach(o=>o.restart())}finish(){this._onFinish(),this.players.forEach(o=>o.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(o=>o.destroy()),this._onDestroyFns.forEach(o=>o()),this._onDestroyFns=[])}reset(){this.players.forEach(o=>o.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(o){const i=o*this.totalTime;this.players.forEach(s=>{const c=s.totalTime?Math.min(1,i/s.totalTime):1;s.setPosition(c)})}getPosition(){const o=this.players.reduce((i,s)=>null===i||s.totalTime>i.totalTime?s:i,null);return null!=o?o.getPosition():0}beforeDestroy(){this.players.forEach(o=>{o.beforeDestroy&&o.beforeDestroy()})}triggerCallback(o){const i="start"==o?this._onStartFns:this._onDoneFns;i.forEach(s=>s()),i.length=0}}function fN(e){return new at(3e3,!1)}function Gf(e){switch(e.length){case 0:return new yw;case 1:return e[0];default:return new hN(e)}}function pN(e,o,i=new Map,s=new Map){const c=[],f=[];let g=-1,v=null;if(o.forEach(w=>{const T=w.get("offset"),A=T==g,k=A&&v||new Map;w.forEach((B,$)=>{let K=$,Q=B;if("offset"!==$)switch(K=e.normalizePropertyName(K,c),Q){case"!":Q=i.get($);break;case qd:Q=s.get($);break;default:Q=e.normalizeStyleValue($,K,Q,c)}k.set(K,Q)}),A||f.push(k),v=k,g=T}),c.length)throw function xU(e){return new at(3502,!1)}();return f}function pO(e,o,i,s){switch(o){case"start":e.onStart(()=>s(i&&mO(i,"start",e)));break;case"done":e.onDone(()=>s(i&&mO(i,"done",e)));break;case"destroy":e.onDestroy(()=>s(i&&mO(i,"destroy",e)))}}function mO(e,o,i){const f=gO(e.element,e.triggerName,e.fromState,e.toState,o||e.phaseName,i.totalTime??e.totalTime,!!i.disabled),g=e._data;return null!=g&&(f._data=g),f}function gO(e,o,i,s,c="",f=0,g){return{element:e,triggerName:o,fromState:i,toState:s,phaseName:c,totalTime:f,disabled:!!g}}function dl(e,o,i){let s=e.get(o);return s||e.set(o,s=i),s}function mN(e){const o=e.indexOf(":");return[e.substring(1,o),e.slice(o+1)]}const PU=(()=>typeof document>"u"?null:document.documentElement)();function _O(e){const o=e.parentNode||e.host||null;return o===PU?null:o}let bg=null,gN=!1;function _N(e,o){for(;o;){if(o===e)return!0;o=_O(o)}return!1}function yN(e,o,i){if(i)return Array.from(e.querySelectorAll(o));const s=e.querySelector(o);return s?[s]:[]}let vN=(()=>{class e{validateStyleProperty(i){return function kU(e){bg||(bg=function FU(){return typeof document<"u"?document.body:null}()||{},gN=!!bg.style&&"WebkitAppearance"in bg.style);let o=!0;return bg.style&&!function OU(e){return"ebkit"==e.substring(1,6)}(e)&&(o=e in bg.style,!o&&gN&&(o="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in bg.style)),o}(i)}matchesElement(i,s){return!1}containsElement(i,s){return _N(i,s)}getParentElement(i){return _O(i)}query(i,s,c){return yN(i,s,c)}computeStyle(i,s,c){return c||""}animate(i,s,c,f,g,v=[],w){return new yw(c,f)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})(),yO=(()=>{class e{static#t=this.NOOP=new vN}return e})();const LU=1e3,vO="ng-enter",DD="ng-leave",ID="ng-trigger",AD=".ng-trigger",bN="ng-animating",xO=".ng-animating";function Wd(e){if("number"==typeof e)return e;const o=e.match(/^(-?[\.\d]+)(m?s)/);return!o||o.length<2?0:bO(parseFloat(o[1]),o[2])}function bO(e,o){return"s"===o?e*LU:e}function RD(e,o,i){return e.hasOwnProperty("duration")?e:function zU(e,o,i){let c,f=0,g="";if("string"==typeof e){const v=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===v)return o.push(fN()),{duration:0,delay:0,easing:""};c=bO(parseFloat(v[1]),v[2]);const w=v[3];null!=w&&(f=bO(parseFloat(w),v[4]));const T=v[5];T&&(g=T)}else c=e;if(!i){let v=!1,w=o.length;c<0&&(o.push(function Jj(){return new at(3100,!1)}()),v=!0),f<0&&(o.push(function Qj(){return new at(3101,!1)}()),v=!0),v&&o.splice(w,0,fN())}return{duration:c,delay:f,easing:g}}(e,o,i)}function vw(e,o={}){return Object.keys(e).forEach(i=>{o[i]=e[i]}),o}function wN(e){const o=new Map;return Object.keys(e).forEach(i=>{o.set(i,e[i])}),o}function qf(e,o=new Map,i){if(i)for(let[s,c]of i)o.set(s,c);for(let[s,c]of e)o.set(s,c);return o}function Bu(e,o,i){o.forEach((s,c)=>{const f=EO(c);i&&!i.has(c)&&i.set(c,e.style[f]),e.style[f]=s})}function wg(e,o){o.forEach((i,s)=>{const c=EO(s);e.style[c]=""})}function xw(e){return Array.isArray(e)?1==e.length?e[0]:uN(e):e}const wO=new RegExp("{{\\s*(.+?)\\s*}}","g");function CN(e){let o=[];if("string"==typeof e){let i;for(;i=wO.exec(e);)o.push(i[1]);wO.lastIndex=0}return o}function bw(e,o,i){const s=e.toString(),c=s.replace(wO,(f,g)=>{let v=o[g];return null==v&&(i.push(function eU(e){return new at(3003,!1)}()),v=""),v.toString()});return c==s?e:c}function PD(e){const o=[];let i=e.next();for(;!i.done;)o.push(i.value),i=e.next();return o}const jU=/-+([a-z0-9])/g;function EO(e){return e.replace(jU,(...o)=>o[1].toUpperCase())}function hl(e,o,i){switch(o.type){case 7:return e.visitTrigger(o,i);case 0:return e.visitState(o,i);case 1:return e.visitTransition(o,i);case 2:return e.visitSequence(o,i);case 3:return e.visitGroup(o,i);case 4:return e.visitAnimate(o,i);case 5:return e.visitKeyframes(o,i);case 6:return e.visitStyle(o,i);case 8:return e.visitReference(o,i);case 9:return e.visitAnimateChild(o,i);case 10:return e.visitAnimateRef(o,i);case 11:return e.visitQuery(o,i);case 12:return e.visitStagger(o,i);default:throw function nU(e){return new at(3004,!1)}()}}function MN(e,o){return window.getComputedStyle(e)[o]}const OD="*";function $U(e,o){const i=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(s=>function GU(e,o,i){if(":"==e[0]){const w=function qU(e,o){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(i,s)=>parseFloat(s)>parseFloat(i);case":decrement":return(i,s)=>parseFloat(s)<parseFloat(i);default:return o.push(function gU(e){return new at(3016,!1)}()),"* => *"}}(e,i);if("function"==typeof w)return void o.push(w);e=w}const s=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==s||s.length<4)return i.push(function mU(e){return new at(3015,!1)}()),o;const c=s[1],f=s[2],g=s[3];o.push(SN(c,g));"<"==f[0]&&!(c==OD&&g==OD)&&o.push(SN(g,c))}(s,i,o)):i.push(e),i}const kD=new Set(["true","1"]),FD=new Set(["false","0"]);function SN(e,o){const i=kD.has(e)||FD.has(e),s=kD.has(o)||FD.has(o);return(c,f)=>{let g=e==OD||e==c,v=o==OD||o==f;return!g&&i&&"boolean"==typeof c&&(g=c?kD.has(e):FD.has(e)),!v&&s&&"boolean"==typeof f&&(v=f?kD.has(o):FD.has(o)),g&&v}}const WU=new RegExp("s*:selfs*,?","g");function CO(e,o,i,s){return new ZU(e).build(o,i,s)}class ZU{constructor(o){this._driver=o}build(o,i,s){const c=new KU(i);return this._resetContextStyleTimingState(c),hl(this,xw(o),c)}_resetContextStyleTimingState(o){o.currentQuerySelector="",o.collectedStyles=new Map,o.collectedStyles.set("",new Map),o.currentTime=0}visitTrigger(o,i){let s=i.queryCount=0,c=i.depCount=0;const f=[],g=[];return"@"==o.name.charAt(0)&&i.errors.push(function rU(){return new at(3006,!1)}()),o.definitions.forEach(v=>{if(this._resetContextStyleTimingState(i),0==v.type){const w=v,T=w.name;T.toString().split(/\s*,\s*/).forEach(A=>{w.name=A,f.push(this.visitState(w,i))}),w.name=T}else if(1==v.type){const w=this.visitTransition(v,i);s+=w.queryCount,c+=w.depCount,g.push(w)}else i.errors.push(function oU(){return new at(3007,!1)}())}),{type:7,name:o.name,states:f,transitions:g,queryCount:s,depCount:c,options:null}}visitState(o,i){const s=this.visitStyle(o.styles,i),c=o.options&&o.options.params||null;if(s.containsDynamicStyles){const f=new Set,g=c||{};s.styles.forEach(v=>{v instanceof Map&&v.forEach(w=>{CN(w).forEach(T=>{g.hasOwnProperty(T)||f.add(T)})})}),f.size&&(PD(f.values()),i.errors.push(function sU(e,o){return new at(3008,!1)}()))}return{type:0,name:o.name,style:s,options:c?{params:c}:null}}visitTransition(o,i){i.queryCount=0,i.depCount=0;const s=hl(this,xw(o.animation),i);return{type:1,matchers:$U(o.expr,i.errors),animation:s,queryCount:i.queryCount,depCount:i.depCount,options:Eg(o.options)}}visitSequence(o,i){return{type:2,steps:o.steps.map(s=>hl(this,s,i)),options:Eg(o.options)}}visitGroup(o,i){const s=i.currentTime;let c=0;const f=o.steps.map(g=>{i.currentTime=s;const v=hl(this,g,i);return c=Math.max(c,i.currentTime),v});return i.currentTime=c,{type:3,steps:f,options:Eg(o.options)}}visitAnimate(o,i){const s=function QU(e,o){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return MO(RD(e,o).duration,0,"");const i=e;if(i.split(/\s+/).some(f=>"{"==f.charAt(0)&&"{"==f.charAt(1))){const f=MO(0,0,"");return f.dynamic=!0,f.strValue=i,f}const c=RD(i,o);return MO(c.duration,c.delay,c.easing)}(o.timings,i.errors);i.currentAnimateTimings=s;let c,f=o.styles?o.styles:xg({});if(5==f.type)c=this.visitKeyframes(f,i);else{let g=o.styles,v=!1;if(!g){v=!0;const T={};s.easing&&(T.easing=s.easing),g=xg(T)}i.currentTime+=s.duration+s.delay;const w=this.visitStyle(g,i);w.isEmptyStep=v,c=w}return i.currentAnimateTimings=null,{type:4,timings:s,style:c,options:null}}visitStyle(o,i){const s=this._makeStyleAst(o,i);return this._validateStyleAst(s,i),s}_makeStyleAst(o,i){const s=[],c=Array.isArray(o.styles)?o.styles:[o.styles];for(let v of c)"string"==typeof v?v===qd?s.push(v):i.errors.push(new at(3002,!1)):s.push(wN(v));let f=!1,g=null;return s.forEach(v=>{if(v instanceof Map&&(v.has("easing")&&(g=v.get("easing"),v.delete("easing")),!f))for(let w of v.values())if(w.toString().indexOf("{{")>=0){f=!0;break}}),{type:6,styles:s,easing:g,offset:o.offset,containsDynamicStyles:f,options:null}}_validateStyleAst(o,i){const s=i.currentAnimateTimings;let c=i.currentTime,f=i.currentTime;s&&f>0&&(f-=s.duration+s.delay),o.styles.forEach(g=>{"string"!=typeof g&&g.forEach((v,w)=>{const T=i.collectedStyles.get(i.currentQuerySelector),A=T.get(w);let k=!0;A&&(f!=c&&f>=A.startTime&&c<=A.endTime&&(i.errors.push(function lU(e,o,i,s,c){return new at(3010,!1)}()),k=!1),f=A.startTime),k&&T.set(w,{startTime:f,endTime:c}),i.options&&function VU(e,o,i){const s=o.params||{},c=CN(e);c.length&&c.forEach(f=>{s.hasOwnProperty(f)||i.push(function tU(e){return new at(3001,!1)}())})}(v,i.options,i.errors)})})}visitKeyframes(o,i){const s={type:5,styles:[],options:null};if(!i.currentAnimateTimings)return i.errors.push(function cU(){return new at(3011,!1)}()),s;let f=0;const g=[];let v=!1,w=!1,T=0;const A=o.steps.map(yt=>{const pt=this._makeStyleAst(yt,i);let Ft=null!=pt.offset?pt.offset:function JU(e){if("string"==typeof e)return null;let o=null;if(Array.isArray(e))e.forEach(i=>{if(i instanceof Map&&i.has("offset")){const s=i;o=parseFloat(s.get("offset")),s.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const i=e;o=parseFloat(i.get("offset")),i.delete("offset")}return o}(pt.styles),Zt=0;return null!=Ft&&(f++,Zt=pt.offset=Ft),w=w||Zt<0||Zt>1,v=v||Zt<T,T=Zt,g.push(Zt),pt});w&&i.errors.push(function uU(){return new at(3012,!1)}()),v&&i.errors.push(function dU(){return new at(3200,!1)}());const k=o.steps.length;let B=0;f>0&&f<k?i.errors.push(function hU(){return new at(3202,!1)}()):0==f&&(B=1/(k-1));const $=k-1,K=i.currentTime,Q=i.currentAnimateTimings,ut=Q.duration;return A.forEach((yt,pt)=>{const Ft=B>0?pt==$?1:B*pt:g[pt],Zt=Ft*ut;i.currentTime=K+Q.delay+Zt,Q.duration=Zt,this._validateStyleAst(yt,i),yt.offset=Ft,s.styles.push(yt)}),s}visitReference(o,i){return{type:8,animation:hl(this,xw(o.animation),i),options:Eg(o.options)}}visitAnimateChild(o,i){return i.depCount++,{type:9,options:Eg(o.options)}}visitAnimateRef(o,i){return{type:10,animation:this.visitReference(o.animation,i),options:Eg(o.options)}}visitQuery(o,i){const s=i.currentQuerySelector,c=o.options||{};i.queryCount++,i.currentQuery=o;const[f,g]=function XU(e){const o=!!e.split(/\s*,\s*/).find(i=>":self"==i);return o&&(e=e.replace(WU,"")),e=e.replace(/@\*/g,AD).replace(/@\w+/g,i=>AD+"-"+i.slice(1)).replace(/:animating/g,xO),[e,o]}(o.selector);i.currentQuerySelector=s.length?s+" "+f:f,dl(i.collectedStyles,i.currentQuerySelector,new Map);const v=hl(this,xw(o.animation),i);return i.currentQuery=null,i.currentQuerySelector=s,{type:11,selector:f,limit:c.limit||0,optional:!!c.optional,includeSelf:g,animation:v,originalSelector:o.selector,options:Eg(o.options)}}visitStagger(o,i){i.currentQuery||i.errors.push(function fU(){return new at(3013,!1)}());const s="full"===o.timings?{duration:0,delay:0,easing:"full"}:RD(o.timings,i.errors,!0);return{type:12,animation:hl(this,xw(o.animation),i),timings:s,options:null}}}class KU{constructor(o){this.errors=o,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Eg(e){return e?(e=vw(e)).params&&(e.params=function YU(e){return e?vw(e):null}(e.params)):e={},e}function MO(e,o,i){return{duration:e,delay:o,easing:i}}function SO(e,o,i,s,c,f,g=null,v=!1){return{type:1,element:e,keyframes:o,preStyleProps:i,postStyleProps:s,duration:c,delay:f,totalTime:c+f,easing:g,subTimeline:v}}class LD{constructor(){this._map=new Map}get(o){return this._map.get(o)||[]}append(o,i){let s=this._map.get(o);s||this._map.set(o,s=[]),s.push(...i)}has(o){return this._map.has(o)}clear(){this._map.clear()}}const n6=new RegExp(":enter","g"),r6=new RegExp(":leave","g");function TO(e,o,i,s,c,f=new Map,g=new Map,v,w,T=[]){return(new o6).buildKeyframes(e,o,i,s,c,f,g,v,w,T)}class o6{buildKeyframes(o,i,s,c,f,g,v,w,T,A=[]){T=T||new LD;const k=new DO(o,i,T,c,f,A,[]);k.options=w;const B=w.delay?Wd(w.delay):0;k.currentTimeline.delayNextStep(B),k.currentTimeline.setStyles([g],null,k.errors,w),hl(this,s,k);const $=k.timelines.filter(K=>K.containsAnimation());if($.length&&v.size){let K;for(let Q=$.length-1;Q>=0;Q--){const ut=$[Q];if(ut.element===i){K=ut;break}}K&&!K.allowOnlyTimelineStyles()&&K.setStyles([v],null,k.errors,w)}return $.length?$.map(K=>K.buildKeyframes()):[SO(i,[],[],[],0,B,"",!1)]}visitTrigger(o,i){}visitState(o,i){}visitTransition(o,i){}visitAnimateChild(o,i){const s=i.subInstructions.get(i.element);if(s){const c=i.createSubContext(o.options),f=i.currentTimeline.currentTime,g=this._visitSubInstructions(s,c,c.options);f!=g&&i.transformIntoNewTimeline(g)}i.previousNode=o}visitAnimateRef(o,i){const s=i.createSubContext(o.options);s.transformIntoNewTimeline(),this._applyAnimationRefDelays([o.options,o.animation.options],i,s),this.visitReference(o.animation,s),i.transformIntoNewTimeline(s.currentTimeline.currentTime),i.previousNode=o}_applyAnimationRefDelays(o,i,s){for(const c of o){const f=c?.delay;if(f){const g="number"==typeof f?f:Wd(bw(f,c?.params??{},i.errors));s.delayNextStep(g)}}}_visitSubInstructions(o,i,s){let f=i.currentTimeline.currentTime;const g=null!=s.duration?Wd(s.duration):null,v=null!=s.delay?Wd(s.delay):null;return 0!==g&&o.forEach(w=>{const T=i.appendInstructionToTimeline(w,g,v);f=Math.max(f,T.duration+T.delay)}),f}visitReference(o,i){i.updateOptions(o.options,!0),hl(this,o.animation,i),i.previousNode=o}visitSequence(o,i){const s=i.subContextCount;let c=i;const f=o.options;if(f&&(f.params||f.delay)&&(c=i.createSubContext(f),c.transformIntoNewTimeline(),null!=f.delay)){6==c.previousNode.type&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=ND);const g=Wd(f.delay);c.delayNextStep(g)}o.steps.length&&(o.steps.forEach(g=>hl(this,g,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>s&&c.transformIntoNewTimeline()),i.previousNode=o}visitGroup(o,i){const s=[];let c=i.currentTimeline.currentTime;const f=o.options&&o.options.delay?Wd(o.options.delay):0;o.steps.forEach(g=>{const v=i.createSubContext(o.options);f&&v.delayNextStep(f),hl(this,g,v),c=Math.max(c,v.currentTimeline.currentTime),s.push(v.currentTimeline)}),s.forEach(g=>i.currentTimeline.mergeTimelineCollectedStyles(g)),i.transformIntoNewTimeline(c),i.previousNode=o}_visitTiming(o,i){if(o.dynamic){const s=o.strValue;return RD(i.params?bw(s,i.params,i.errors):s,i.errors)}return{duration:o.duration,delay:o.delay,easing:o.easing}}visitAnimate(o,i){const s=i.currentAnimateTimings=this._visitTiming(o.timings,i),c=i.currentTimeline;s.delay&&(i.incrementTime(s.delay),c.snapshotCurrentStyles());const f=o.style;5==f.type?this.visitKeyframes(f,i):(i.incrementTime(s.duration),this.visitStyle(f,i),c.applyStylesToKeyframe()),i.currentAnimateTimings=null,i.previousNode=o}visitStyle(o,i){const s=i.currentTimeline,c=i.currentAnimateTimings;!c&&s.hasCurrentStyleProperties()&&s.forwardFrame();const f=c&&c.easing||o.easing;o.isEmptyStep?s.applyEmptyStep(f):s.setStyles(o.styles,f,i.errors,i.options),i.previousNode=o}visitKeyframes(o,i){const s=i.currentAnimateTimings,c=i.currentTimeline.duration,f=s.duration,v=i.createSubContext().currentTimeline;v.easing=s.easing,o.styles.forEach(w=>{v.forwardTime((w.offset||0)*f),v.setStyles(w.styles,w.easing,i.errors,i.options),v.applyStylesToKeyframe()}),i.currentTimeline.mergeTimelineCollectedStyles(v),i.transformIntoNewTimeline(c+f),i.previousNode=o}visitQuery(o,i){const s=i.currentTimeline.currentTime,c=o.options||{},f=c.delay?Wd(c.delay):0;f&&(6===i.previousNode.type||0==s&&i.currentTimeline.hasCurrentStyleProperties())&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=ND);let g=s;const v=i.invokeQuery(o.selector,o.originalSelector,o.limit,o.includeSelf,!!c.optional,i.errors);i.currentQueryTotal=v.length;let w=null;v.forEach((T,A)=>{i.currentQueryIndex=A;const k=i.createSubContext(o.options,T);f&&k.delayNextStep(f),T===i.element&&(w=k.currentTimeline),hl(this,o.animation,k),k.currentTimeline.applyStylesToKeyframe(),g=Math.max(g,k.currentTimeline.currentTime)}),i.currentQueryIndex=0,i.currentQueryTotal=0,i.transformIntoNewTimeline(g),w&&(i.currentTimeline.mergeTimelineCollectedStyles(w),i.currentTimeline.snapshotCurrentStyles()),i.previousNode=o}visitStagger(o,i){const s=i.parentContext,c=i.currentTimeline,f=o.timings,g=Math.abs(f.duration),v=g*(i.currentQueryTotal-1);let w=g*i.currentQueryIndex;switch(f.duration<0?"reverse":f.easing){case"reverse":w=v-w;break;case"full":w=s.currentStaggerTime}const A=i.currentTimeline;w&&A.delayNextStep(w);const k=A.currentTime;hl(this,o.animation,i),i.previousNode=o,s.currentStaggerTime=c.currentTime-k+(c.startTime-s.currentTimeline.startTime)}}const ND={};class DO{constructor(o,i,s,c,f,g,v,w){this._driver=o,this.element=i,this.subInstructions=s,this._enterClassName=c,this._leaveClassName=f,this.errors=g,this.timelines=v,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=ND,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=w||new zD(this._driver,i,0),v.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(o,i){if(!o)return;const s=o;let c=this.options;null!=s.duration&&(c.duration=Wd(s.duration)),null!=s.delay&&(c.delay=Wd(s.delay));const f=s.params;if(f){let g=c.params;g||(g=this.options.params={}),Object.keys(f).forEach(v=>{(!i||!g.hasOwnProperty(v))&&(g[v]=bw(f[v],g,this.errors))})}}_copyOptions(){const o={};if(this.options){const i=this.options.params;if(i){const s=o.params={};Object.keys(i).forEach(c=>{s[c]=i[c]})}}return o}createSubContext(o=null,i,s){const c=i||this.element,f=new DO(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,s||0));return f.previousNode=this.previousNode,f.currentAnimateTimings=this.currentAnimateTimings,f.options=this._copyOptions(),f.updateOptions(o),f.currentQueryIndex=this.currentQueryIndex,f.currentQueryTotal=this.currentQueryTotal,f.parentContext=this,this.subContextCount++,f}transformIntoNewTimeline(o){return this.previousNode=ND,this.currentTimeline=this.currentTimeline.fork(this.element,o),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(o,i,s){const c={duration:i??o.duration,delay:this.currentTimeline.currentTime+(s??0)+o.delay,easing:""},f=new s6(this._driver,o.element,o.keyframes,o.preStyleProps,o.postStyleProps,c,o.stretchStartingKeyframe);return this.timelines.push(f),c}incrementTime(o){this.currentTimeline.forwardTime(this.currentTimeline.duration+o)}delayNextStep(o){o>0&&this.currentTimeline.delayNextStep(o)}invokeQuery(o,i,s,c,f,g){let v=[];if(c&&v.push(this.element),o.length>0){o=(o=o.replace(n6,"."+this._enterClassName)).replace(r6,"."+this._leaveClassName);let T=this._driver.query(this.element,o,1!=s);0!==s&&(T=s<0?T.slice(T.length+s,T.length):T.slice(0,s)),v.push(...T)}return!f&&0==v.length&&g.push(function pU(e){return new at(3014,!1)}()),v}}class zD{constructor(o,i,s,c){this._driver=o,this.element=i,this.startTime=s,this._elementTimelineStylesLookup=c,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(i),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(i,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(o){const i=1===this._keyframes.size&&this._pendingStyles.size;this.duration||i?(this.forwardTime(this.currentTime+o),i&&this.snapshotCurrentStyles()):this.startTime+=o}fork(o,i){return this.applyStylesToKeyframe(),new zD(this._driver,o,i||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(o){this.applyStylesToKeyframe(),this.duration=o,this._loadKeyframe()}_updateStyle(o,i){this._localTimelineStyles.set(o,i),this._globalTimelineStyles.set(o,i),this._styleSummary.set(o,{time:this.currentTime,value:i})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(o){o&&this._previousKeyframe.set("easing",o);for(let[i,s]of this._globalTimelineStyles)this._backFill.set(i,s||qd),this._currentKeyframe.set(i,qd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(o,i,s,c){i&&this._previousKeyframe.set("easing",i);const f=c&&c.params||{},g=function a6(e,o){const i=new Map;let s;return e.forEach(c=>{if("*"===c){s=s||o.keys();for(let f of s)i.set(f,qd)}else qf(c,i)}),i}(o,this._globalTimelineStyles);for(let[v,w]of g){const T=bw(w,f,s);this._pendingStyles.set(v,T),this._localTimelineStyles.has(v)||this._backFill.set(v,this._globalTimelineStyles.get(v)??qd),this._updateStyle(v,T)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((o,i)=>{this._currentKeyframe.set(i,o)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((o,i)=>{this._currentKeyframe.has(i)||this._currentKeyframe.set(i,o)}))}snapshotCurrentStyles(){for(let[o,i]of this._localTimelineStyles)this._pendingStyles.set(o,i),this._updateStyle(o,i)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const o=[];for(let i in this._currentKeyframe)o.push(i);return o}mergeTimelineCollectedStyles(o){o._styleSummary.forEach((i,s)=>{const c=this._styleSummary.get(s);(!c||i.time>c.time)&&this._updateStyle(s,i.value)})}buildKeyframes(){this.applyStylesToKeyframe();const o=new Set,i=new Set,s=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((v,w)=>{const T=qf(v,new Map,this._backFill);T.forEach((A,k)=>{"!"===A?o.add(k):A===qd&&i.add(k)}),s||T.set("offset",w/this.duration),c.push(T)});const f=o.size?PD(o.values()):[],g=i.size?PD(i.values()):[];if(s){const v=c[0],w=new Map(v);v.set("offset",0),w.set("offset",1),c=[v,w]}return SO(this.element,c,f,g,this.duration,this.startTime,this.easing,!1)}}class s6 extends zD{constructor(o,i,s,c,f,g,v=!1){super(o,i,g.delay),this.keyframes=s,this.preStyleProps=c,this.postStyleProps=f,this._stretchStartingKeyframe=v,this.timings={duration:g.duration,delay:g.delay,easing:g.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let o=this.keyframes,{delay:i,duration:s,easing:c}=this.timings;if(this._stretchStartingKeyframe&&i){const f=[],g=s+i,v=i/g,w=qf(o[0]);w.set("offset",0),f.push(w);const T=qf(o[0]);T.set("offset",IN(v)),f.push(T);const A=o.length-1;for(let k=1;k<=A;k++){let B=qf(o[k]);const $=B.get("offset");B.set("offset",IN((i+$*s)/g)),f.push(B)}s=g,i=0,c="",o=f}return SO(this.element,o,this.preStyleProps,this.postStyleProps,s,i,c,!0)}}function IN(e,o=3){const i=Math.pow(10,o-1);return Math.round(e*i)/i}class IO{}const l6=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class c6 extends IO{normalizePropertyName(o,i){return EO(o)}normalizeStyleValue(o,i,s,c){let f="";const g=s.toString().trim();if(l6.has(i)&&0!==s&&"0"!==s)if("number"==typeof s)f="px";else{const v=s.match(/^[+-]?[\d\.]+([a-z]*)$/);v&&0==v[1].length&&c.push(function iU(e,o){return new at(3005,!1)}())}return g+f}}function AN(e,o,i,s,c,f,g,v,w,T,A,k,B){return{type:0,element:e,triggerName:o,isRemovalTransition:c,fromState:i,fromStyles:f,toState:s,toStyles:g,timelines:v,queriedElements:w,preStyleProps:T,postStyleProps:A,totalTime:k,errors:B}}const AO={};class RN{constructor(o,i,s){this._triggerName=o,this.ast=i,this._stateStyles=s}match(o,i,s,c){return function u6(e,o,i,s,c){return e.some(f=>f(o,i,s,c))}(this.ast.matchers,o,i,s,c)}buildStyles(o,i,s){let c=this._stateStyles.get("*");return void 0!==o&&(c=this._stateStyles.get(o?.toString())||c),c?c.buildStyles(i,s):new Map}build(o,i,s,c,f,g,v,w,T,A){const k=[],B=this.ast.options&&this.ast.options.params||AO,K=this.buildStyles(s,v&&v.params||AO,k),Q=w&&w.params||AO,ut=this.buildStyles(c,Q,k),yt=new Set,pt=new Map,Ft=new Map,Zt="void"===c,de={params:d6(Q,B),delay:this.ast.options?.delay},oe=A?[]:TO(o,i,this.ast.animation,f,g,K,ut,de,T,k);let Te=0;if(oe.forEach(bn=>{Te=Math.max(bn.duration+bn.delay,Te)}),k.length)return AN(i,this._triggerName,s,c,Zt,K,ut,[],[],pt,Ft,Te,k);oe.forEach(bn=>{const si=bn.element,fi=dl(pt,si,new Set);bn.preStyleProps.forEach(ji=>fi.add(ji));const Dn=dl(Ft,si,new Set);bn.postStyleProps.forEach(ji=>Dn.add(ji)),si!==i&&yt.add(si)});const gn=PD(yt.values());return AN(i,this._triggerName,s,c,Zt,K,ut,oe,gn,pt,Ft,Te)}}function d6(e,o){const i=vw(o);for(const s in e)e.hasOwnProperty(s)&&null!=e[s]&&(i[s]=e[s]);return i}class h6{constructor(o,i,s){this.styles=o,this.defaultParams=i,this.normalizer=s}buildStyles(o,i){const s=new Map,c=vw(this.defaultParams);return Object.keys(o).forEach(f=>{const g=o[f];null!==g&&(c[f]=g)}),this.styles.styles.forEach(f=>{"string"!=typeof f&&f.forEach((g,v)=>{g&&(g=bw(g,c,i));const w=this.normalizer.normalizePropertyName(v,i);g=this.normalizer.normalizeStyleValue(v,w,g,i),s.set(v,g)})}),s}}class p6{constructor(o,i,s){this.name=o,this.ast=i,this._normalizer=s,this.transitionFactories=[],this.states=new Map,i.states.forEach(c=>{this.states.set(c.name,new h6(c.style,c.options&&c.options.params||{},s))}),PN(this.states,"true","1"),PN(this.states,"false","0"),i.transitions.forEach(c=>{this.transitionFactories.push(new RN(o,c,this.states))}),this.fallbackTransition=function m6(e,o,i){return new RN(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(g,v)=>!0],options:null,queryCount:0,depCount:0},o)}(o,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(o,i,s,c){return this.transitionFactories.find(g=>g.match(o,i,s,c))||null}matchStyles(o,i,s){return this.fallbackTransition.buildStyles(o,i,s)}}function PN(e,o,i){e.has(o)?e.has(i)||e.set(i,e.get(o)):e.has(i)&&e.set(o,e.get(i))}const g6=new LD;class _6{constructor(o,i,s){this.bodyNode=o,this._driver=i,this._normalizer=s,this._animations=new Map,this._playersById=new Map,this.players=[]}register(o,i){const s=[],f=CO(this._driver,i,s,[]);if(s.length)throw function bU(e){return new at(3503,!1)}();this._animations.set(o,f)}_buildPlayer(o,i,s){const c=o.element,f=pN(this._normalizer,o.keyframes,i,s);return this._driver.animate(c,f,o.duration,o.delay,o.easing,[],!0)}create(o,i,s={}){const c=[],f=this._animations.get(o);let g;const v=new Map;if(f?(g=TO(this._driver,i,f,vO,DD,new Map,new Map,s,g6,c),g.forEach(A=>{const k=dl(v,A.element,new Map);A.postStyleProps.forEach(B=>k.set(B,null))})):(c.push(function wU(){return new at(3300,!1)}()),g=[]),c.length)throw function EU(e){return new at(3504,!1)}();v.forEach((A,k)=>{A.forEach((B,$)=>{A.set($,this._driver.computeStyle(k,$,qd))})});const T=Gf(g.map(A=>{const k=v.get(A.element);return this._buildPlayer(A,new Map,k)}));return this._playersById.set(o,T),T.onDestroy(()=>this.destroy(o)),this.players.push(T),T}destroy(o){const i=this._getPlayer(o);i.destroy(),this._playersById.delete(o);const s=this.players.indexOf(i);s>=0&&this.players.splice(s,1)}_getPlayer(o){const i=this._playersById.get(o);if(!i)throw function CU(e){return new at(3301,!1)}();return i}listen(o,i,s,c){const f=gO(i,"","","");return pO(this._getPlayer(o),s,f,c),()=>{}}command(o,i,s,c){if("register"==s)return void this.register(o,c[0]);if("create"==s)return void this.create(o,i,c[0]||{});const f=this._getPlayer(o);switch(s){case"play":f.play();break;case"pause":f.pause();break;case"reset":f.reset();break;case"restart":f.restart();break;case"finish":f.finish();break;case"init":f.init();break;case"setPosition":f.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(o)}}}const ON="ng-animate-queued",RO="ng-animate-disabled",w6=[],kN={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},E6={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Hc="__ng_removed";class PO{get params(){return this.options.params}constructor(o,i=""){this.namespaceId=i;const s=o&&o.hasOwnProperty("value");if(this.value=function T6(e){return e??null}(s?o.value:o),s){const f=vw(o);delete f.value,this.options=f}else this.options={};this.options.params||(this.options.params={})}absorbOptions(o){const i=o.params;if(i){const s=this.options.params;Object.keys(i).forEach(c=>{null==s[c]&&(s[c]=i[c])})}}}const ww="void",OO=new PO(ww);class C6{constructor(o,i,s){this.id=o,this.hostElement=i,this._engine=s,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+o,tc(i,this._hostClassName)}listen(o,i,s,c){if(!this._triggers.has(i))throw function MU(e,o){return new at(3302,!1)}();if(null==s||0==s.length)throw function SU(e){return new at(3303,!1)}();if(!function D6(e){return"start"==e||"done"==e}(s))throw function TU(e,o){return new at(3400,!1)}();const f=dl(this._elementListeners,o,[]),g={name:i,phase:s,callback:c};f.push(g);const v=dl(this._engine.statesByElement,o,new Map);return v.has(i)||(tc(o,ID),tc(o,ID+"-"+i),v.set(i,OO)),()=>{this._engine.afterFlush(()=>{const w=f.indexOf(g);w>=0&&f.splice(w,1),this._triggers.has(i)||v.delete(i)})}}register(o,i){return!this._triggers.has(o)&&(this._triggers.set(o,i),!0)}_getTrigger(o){const i=this._triggers.get(o);if(!i)throw function DU(e){return new at(3401,!1)}();return i}trigger(o,i,s,c=!0){const f=this._getTrigger(i),g=new kO(this.id,i,o);let v=this._engine.statesByElement.get(o);v||(tc(o,ID),tc(o,ID+"-"+i),this._engine.statesByElement.set(o,v=new Map));let w=v.get(i);const T=new PO(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&w&&T.absorbOptions(w.options),v.set(i,T),w||(w=OO),T.value!==ww&&w.value===T.value){if(!function R6(e,o){const i=Object.keys(e),s=Object.keys(o);if(i.length!=s.length)return!1;for(let c=0;c<i.length;c++){const f=i[c];if(!o.hasOwnProperty(f)||e[f]!==o[f])return!1}return!0}(w.params,T.params)){const Q=[],ut=f.matchStyles(w.value,w.params,Q),yt=f.matchStyles(T.value,T.params,Q);Q.length?this._engine.reportError(Q):this._engine.afterFlush(()=>{wg(o,ut),Bu(o,yt)})}return}const B=dl(this._engine.playersByElement,o,[]);B.forEach(Q=>{Q.namespaceId==this.id&&Q.triggerName==i&&Q.queued&&Q.destroy()});let $=f.matchTransition(w.value,T.value,o,T.params),K=!1;if(!$){if(!c)return;$=f.fallbackTransition,K=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:o,triggerName:i,transition:$,fromState:w,toState:T,player:g,isFallbackTransition:K}),K||(tc(o,ON),g.onStart(()=>{Vv(o,ON)})),g.onDone(()=>{let Q=this.players.indexOf(g);Q>=0&&this.players.splice(Q,1);const ut=this._engine.playersByElement.get(o);if(ut){let yt=ut.indexOf(g);yt>=0&&ut.splice(yt,1)}}),this.players.push(g),B.push(g),g}deregister(o){this._triggers.delete(o),this._engine.statesByElement.forEach(i=>i.delete(o)),this._elementListeners.forEach((i,s)=>{this._elementListeners.set(s,i.filter(c=>c.name!=o))})}clearElementCache(o){this._engine.statesByElement.delete(o),this._elementListeners.delete(o);const i=this._engine.playersByElement.get(o);i&&(i.forEach(s=>s.destroy()),this._engine.playersByElement.delete(o))}_signalRemovalForInnerTriggers(o,i){const s=this._engine.driver.query(o,AD,!0);s.forEach(c=>{if(c[Hc])return;const f=this._engine.fetchNamespacesByElement(c);f.size?f.forEach(g=>g.triggerLeaveAnimation(c,i,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(o,i,s,c){const f=this._engine.statesByElement.get(o),g=new Map;if(f){const v=[];if(f.forEach((w,T)=>{if(g.set(T,w.value),this._triggers.has(T)){const A=this.trigger(o,T,ww,c);A&&v.push(A)}}),v.length)return this._engine.markElementAsRemoved(this.id,o,!0,i,g),s&&Gf(v).onDone(()=>this._engine.processLeaveNode(o)),!0}return!1}prepareLeaveAnimationListeners(o){const i=this._elementListeners.get(o),s=this._engine.statesByElement.get(o);if(i&&s){const c=new Set;i.forEach(f=>{const g=f.name;if(c.has(g))return;c.add(g);const w=this._triggers.get(g).fallbackTransition,T=s.get(g)||OO,A=new PO(ww),k=new kO(this.id,g,o);this._engine.totalQueuedPlayers++,this._queue.push({element:o,triggerName:g,transition:w,fromState:T,toState:A,player:k,isFallbackTransition:!0})})}}removeNode(o,i){const s=this._engine;if(o.childElementCount&&this._signalRemovalForInnerTriggers(o,i),this.triggerLeaveAnimation(o,i,!0))return;let c=!1;if(s.totalAnimations){const f=s.players.length?s.playersByQueriedElement.get(o):[];if(f&&f.length)c=!0;else{let g=o;for(;g=g.parentNode;)if(s.statesByElement.get(g)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(o),c)s.markElementAsRemoved(this.id,o,!1,i);else{const f=o[Hc];(!f||f===kN)&&(s.afterFlush(()=>this.clearElementCache(o)),s.destroyInnerAnimations(o),s._onRemovalComplete(o,i))}}insertNode(o,i){tc(o,this._hostClassName)}drainQueuedTransitions(o){const i=[];return this._queue.forEach(s=>{const c=s.player;if(c.destroyed)return;const f=s.element,g=this._elementListeners.get(f);g&&g.forEach(v=>{if(v.name==s.triggerName){const w=gO(f,s.triggerName,s.fromState.value,s.toState.value);w._data=o,pO(s.player,v.phase,w,v.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):i.push(s)}),this._queue=[],i.sort((s,c)=>{const f=s.transition.ast.depCount,g=c.transition.ast.depCount;return 0==f||0==g?f-g:this._engine.driver.containsElement(s.element,c.element)?1:-1})}destroy(o){this.players.forEach(i=>i.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,o)}}class M6{_onRemovalComplete(o,i){this.onRemovalComplete(o,i)}constructor(o,i,s){this.bodyNode=o,this.driver=i,this._normalizer=s,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(c,f)=>{}}get queuedPlayers(){const o=[];return this._namespaceList.forEach(i=>{i.players.forEach(s=>{s.queued&&o.push(s)})}),o}createNamespace(o,i){const s=new C6(o,i,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,i)?this._balanceNamespaceList(s,i):(this.newHostElements.set(i,s),this.collectEnterElement(i)),this._namespaceLookup[o]=s}_balanceNamespaceList(o,i){const s=this._namespaceList,c=this.namespacesByHostElement;if(s.length-1>=0){let g=!1,v=this.driver.getParentElement(i);for(;v;){const w=c.get(v);if(w){const T=s.indexOf(w);s.splice(T+1,0,o),g=!0;break}v=this.driver.getParentElement(v)}g||s.unshift(o)}else s.push(o);return c.set(i,o),o}register(o,i){let s=this._namespaceLookup[o];return s||(s=this.createNamespace(o,i)),s}registerTrigger(o,i,s){let c=this._namespaceLookup[o];c&&c.register(i,s)&&this.totalAnimations++}destroy(o,i){o&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const s=this._fetchNamespace(o);this.namespacesByHostElement.delete(s.hostElement);const c=this._namespaceList.indexOf(s);c>=0&&this._namespaceList.splice(c,1),s.destroy(i),delete this._namespaceLookup[o]}))}_fetchNamespace(o){return this._namespaceLookup[o]}fetchNamespacesByElement(o){const i=new Set,s=this.statesByElement.get(o);if(s)for(let c of s.values())if(c.namespaceId){const f=this._fetchNamespace(c.namespaceId);f&&i.add(f)}return i}trigger(o,i,s,c){if(BD(i)){const f=this._fetchNamespace(o);if(f)return f.trigger(i,s,c),!0}return!1}insertNode(o,i,s,c){if(!BD(i))return;const f=i[Hc];if(f&&f.setForRemoval){f.setForRemoval=!1,f.setForMove=!0;const g=this.collectedLeaveElements.indexOf(i);g>=0&&this.collectedLeaveElements.splice(g,1)}if(o){const g=this._fetchNamespace(o);g&&g.insertNode(i,s)}c&&this.collectEnterElement(i)}collectEnterElement(o){this.collectedEnterElements.push(o)}markElementAsDisabled(o,i){i?this.disabledNodes.has(o)||(this.disabledNodes.add(o),tc(o,RO)):this.disabledNodes.has(o)&&(this.disabledNodes.delete(o),Vv(o,RO))}removeNode(o,i,s){if(BD(i)){const c=o?this._fetchNamespace(o):null;c?c.removeNode(i,s):this.markElementAsRemoved(o,i,!1,s);const f=this.namespacesByHostElement.get(i);f&&f.id!==o&&f.removeNode(i,s)}else this._onRemovalComplete(i,s)}markElementAsRemoved(o,i,s,c,f){this.collectedLeaveElements.push(i),i[Hc]={namespaceId:o,setForRemoval:c,hasAnimation:s,removedBeforeQueried:!1,previousTriggersValues:f}}listen(o,i,s,c,f){return BD(i)?this._fetchNamespace(o).listen(i,s,c,f):()=>{}}_buildInstruction(o,i,s,c,f){return o.transition.build(this.driver,o.element,o.fromState.value,o.toState.value,s,c,o.fromState.options,o.toState.options,i,f)}destroyInnerAnimations(o){let i=this.driver.query(o,AD,!0);i.forEach(s=>this.destroyActiveAnimationsForElement(s)),0!=this.playersByQueriedElement.size&&(i=this.driver.query(o,xO,!0),i.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(o){const i=this.playersByElement.get(o);i&&i.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(o){const i=this.playersByQueriedElement.get(o);i&&i.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(o=>{if(this.players.length)return Gf(this.players).onDone(()=>o());o()})}processLeaveNode(o){const i=o[Hc];if(i&&i.setForRemoval){if(o[Hc]=kN,i.namespaceId){this.destroyInnerAnimations(o);const s=this._fetchNamespace(i.namespaceId);s&&s.clearElementCache(o)}this._onRemovalComplete(o,i.setForRemoval)}o.classList?.contains(RO)&&this.markElementAsDisabled(o,!1),this.driver.query(o,".ng-animate-disabled",!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(o=-1){let i=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,c)=>this._balanceNamespaceList(s,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++)tc(this.collectedEnterElements[s],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const s=[];try{i=this._flushAnimations(s,o)}finally{for(let c=0;c<s.length;c++)s[c]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++)this.processLeaveNode(this.collectedLeaveElements[s]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){const s=this._whenQuietFns;this._whenQuietFns=[],i.length?Gf(i).onDone(()=>{s.forEach(c=>c())}):s.forEach(c=>c())}}reportError(o){throw function IU(e){return new at(3402,!1)}()}_flushAnimations(o,i){const s=new LD,c=[],f=new Map,g=[],v=new Map,w=new Map,T=new Map,A=new Set;this.disabledNodes.forEach(Gt=>{A.add(Gt);const fe=this.driver.query(Gt,".ng-animate-queued",!0);for(let pe=0;pe<fe.length;pe++)A.add(fe[pe])});const k=this.bodyNode,B=Array.from(this.statesByElement.keys()),$=NN(B,this.collectedEnterElements),K=new Map;let Q=0;$.forEach((Gt,fe)=>{const pe=vO+Q++;K.set(fe,pe),Gt.forEach(Pe=>tc(Pe,pe))});const ut=[],yt=new Set,pt=new Set;for(let Gt=0;Gt<this.collectedLeaveElements.length;Gt++){const fe=this.collectedLeaveElements[Gt],pe=fe[Hc];pe&&pe.setForRemoval&&(ut.push(fe),yt.add(fe),pe.hasAnimation?this.driver.query(fe,".ng-star-inserted",!0).forEach(Pe=>yt.add(Pe)):pt.add(fe))}const Ft=new Map,Zt=NN(B,Array.from(yt));Zt.forEach((Gt,fe)=>{const pe=DD+Q++;Ft.set(fe,pe),Gt.forEach(Pe=>tc(Pe,pe))}),o.push(()=>{$.forEach((Gt,fe)=>{const pe=K.get(fe);Gt.forEach(Pe=>Vv(Pe,pe))}),Zt.forEach((Gt,fe)=>{const pe=Ft.get(fe);Gt.forEach(Pe=>Vv(Pe,pe))}),ut.forEach(Gt=>{this.processLeaveNode(Gt)})});const de=[],oe=[];for(let Gt=this._namespaceList.length-1;Gt>=0;Gt--)this._namespaceList[Gt].drainQueuedTransitions(i).forEach(pe=>{const Pe=pe.player,Un=pe.element;if(de.push(Pe),this.collectedEnterElements.length){const Mn=Un[Hc];if(Mn&&Mn.setForMove){if(Mn.previousTriggersValues&&Mn.previousTriggersValues.has(pe.triggerName)){const Rn=Mn.previousTriggersValues.get(pe.triggerName),Xn=this.statesByElement.get(pe.element);if(Xn&&Xn.has(pe.triggerName)){const xi=Xn.get(pe.triggerName);xi.value=Rn,Xn.set(pe.triggerName,xi)}}return void Pe.destroy()}}const pi=!k||!this.driver.containsElement(k,Un),Ve=Ft.get(Un),sr=K.get(Un),wn=this._buildInstruction(pe,s,sr,Ve,pi);if(wn.errors&&wn.errors.length)return void oe.push(wn);if(pi)return Pe.onStart(()=>wg(Un,wn.fromStyles)),Pe.onDestroy(()=>Bu(Un,wn.toStyles)),void c.push(Pe);if(pe.isFallbackTransition)return Pe.onStart(()=>wg(Un,wn.fromStyles)),Pe.onDestroy(()=>Bu(Un,wn.toStyles)),void c.push(Pe);const Ue=[];wn.timelines.forEach(Mn=>{Mn.stretchStartingKeyframe=!0,this.disabledNodes.has(Mn.element)||Ue.push(Mn)}),wn.timelines=Ue,s.append(Un,wn.timelines),g.push({instruction:wn,player:Pe,element:Un}),wn.queriedElements.forEach(Mn=>dl(v,Mn,[]).push(Pe)),wn.preStyleProps.forEach((Mn,Rn)=>{if(Mn.size){let Xn=w.get(Rn);Xn||w.set(Rn,Xn=new Set),Mn.forEach((xi,co)=>Xn.add(co))}}),wn.postStyleProps.forEach((Mn,Rn)=>{let Xn=T.get(Rn);Xn||T.set(Rn,Xn=new Set),Mn.forEach((xi,co)=>Xn.add(co))})});if(oe.length){const Gt=[];oe.forEach(fe=>{Gt.push(function AU(e,o){return new at(3505,!1)}())}),de.forEach(fe=>fe.destroy()),this.reportError(Gt)}const Te=new Map,gn=new Map;g.forEach(Gt=>{const fe=Gt.element;s.has(fe)&&(gn.set(fe,fe),this._beforeAnimationBuild(Gt.player.namespaceId,Gt.instruction,Te))}),c.forEach(Gt=>{const fe=Gt.element;this._getPreviousPlayers(fe,!1,Gt.namespaceId,Gt.triggerName,null).forEach(Pe=>{dl(Te,fe,[]).push(Pe),Pe.destroy()})});const bn=ut.filter(Gt=>BN(Gt,w,T)),si=new Map;LN(si,this.driver,pt,T,qd).forEach(Gt=>{BN(Gt,w,T)&&bn.push(Gt)});const Dn=new Map;$.forEach((Gt,fe)=>{LN(Dn,this.driver,new Set(Gt),w,"!")}),bn.forEach(Gt=>{const fe=si.get(Gt),pe=Dn.get(Gt);si.set(Gt,new Map([...fe?.entries()??[],...pe?.entries()??[]]))});const ji=[],Xi=[],hr={};g.forEach(Gt=>{const{element:fe,player:pe,instruction:Pe}=Gt;if(s.has(fe)){if(A.has(fe))return pe.onDestroy(()=>Bu(fe,Pe.toStyles)),pe.disabled=!0,pe.overrideTotalTime(Pe.totalTime),void c.push(pe);let Un=hr;if(gn.size>1){let Ve=fe;const sr=[];for(;Ve=Ve.parentNode;){const wn=gn.get(Ve);if(wn){Un=wn;break}sr.push(Ve)}sr.forEach(wn=>gn.set(wn,Un))}const pi=this._buildAnimation(pe.namespaceId,Pe,Te,f,Dn,si);if(pe.setRealPlayer(pi),Un===hr)ji.push(pe);else{const Ve=this.playersByElement.get(Un);Ve&&Ve.length&&(pe.parentPlayer=Gf(Ve)),c.push(pe)}}else wg(fe,Pe.fromStyles),pe.onDestroy(()=>Bu(fe,Pe.toStyles)),Xi.push(pe),A.has(fe)&&c.push(pe)}),Xi.forEach(Gt=>{const fe=f.get(Gt.element);if(fe&&fe.length){const pe=Gf(fe);Gt.setRealPlayer(pe)}}),c.forEach(Gt=>{Gt.parentPlayer?Gt.syncPlayerEvents(Gt.parentPlayer):Gt.destroy()});for(let Gt=0;Gt<ut.length;Gt++){const fe=ut[Gt],pe=fe[Hc];if(Vv(fe,DD),pe&&pe.hasAnimation)continue;let Pe=[];if(v.size){let pi=v.get(fe);pi&&pi.length&&Pe.push(...pi);let Ve=this.driver.query(fe,xO,!0);for(let sr=0;sr<Ve.length;sr++){let wn=v.get(Ve[sr]);wn&&wn.length&&Pe.push(...wn)}}const Un=Pe.filter(pi=>!pi.destroyed);Un.length?I6(this,fe,Un):this.processLeaveNode(fe)}return ut.length=0,ji.forEach(Gt=>{this.players.push(Gt),Gt.onDone(()=>{Gt.destroy();const fe=this.players.indexOf(Gt);this.players.splice(fe,1)}),Gt.play()}),ji}afterFlush(o){this._flushFns.push(o)}afterFlushAnimationsDone(o){this._whenQuietFns.push(o)}_getPreviousPlayers(o,i,s,c,f){let g=[];if(i){const v=this.playersByQueriedElement.get(o);v&&(g=v)}else{const v=this.playersByElement.get(o);if(v){const w=!f||f==ww;v.forEach(T=>{T.queued||!w&&T.triggerName!=c||g.push(T)})}}return(s||c)&&(g=g.filter(v=>!(s&&s!=v.namespaceId||c&&c!=v.triggerName))),g}_beforeAnimationBuild(o,i,s){const f=i.element,g=i.isRemovalTransition?void 0:o,v=i.isRemovalTransition?void 0:i.triggerName;for(const w of i.timelines){const T=w.element,A=T!==f,k=dl(s,T,[]);this._getPreviousPlayers(T,A,g,v,i.toState).forEach($=>{const K=$.getRealPlayer();K.beforeDestroy&&K.beforeDestroy(),$.destroy(),k.push($)})}wg(f,i.fromStyles)}_buildAnimation(o,i,s,c,f,g){const v=i.triggerName,w=i.element,T=[],A=new Set,k=new Set,B=i.timelines.map(K=>{const Q=K.element;A.add(Q);const ut=Q[Hc];if(ut&&ut.removedBeforeQueried)return new yw(K.duration,K.delay);const yt=Q!==w,pt=function A6(e){const o=[];return zN(e,o),o}((s.get(Q)||w6).map(Te=>Te.getRealPlayer())).filter(Te=>!!Te.element&&Te.element===Q),Ft=f.get(Q),Zt=g.get(Q),de=pN(this._normalizer,K.keyframes,Ft,Zt),oe=this._buildPlayer(K,de,pt);if(K.subTimeline&&c&&k.add(Q),yt){const Te=new kO(o,v,Q);Te.setRealPlayer(oe),T.push(Te)}return oe});T.forEach(K=>{dl(this.playersByQueriedElement,K.element,[]).push(K),K.onDone(()=>function S6(e,o,i){let s=e.get(o);if(s){if(s.length){const c=s.indexOf(i);s.splice(c,1)}0==s.length&&e.delete(o)}return s}(this.playersByQueriedElement,K.element,K))}),A.forEach(K=>tc(K,bN));const $=Gf(B);return $.onDestroy(()=>{A.forEach(K=>Vv(K,bN)),Bu(w,i.toStyles)}),k.forEach(K=>{dl(c,K,[]).push($)}),$}_buildPlayer(o,i,s){return i.length>0?this.driver.animate(o.element,i,o.duration,o.delay,o.easing,s):new yw(o.duration,o.delay)}}class kO{constructor(o,i,s){this.namespaceId=o,this.triggerName=i,this.element=s,this._player=new yw,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(o){this._containsRealPlayer||(this._player=o,this._queuedCallbacks.forEach((i,s)=>{i.forEach(c=>pO(o,s,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(o.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(o){this.totalTime=o}syncPlayerEvents(o){const i=this._player;i.triggerCallback&&o.onStart(()=>i.triggerCallback("start")),o.onDone(()=>this.finish()),o.onDestroy(()=>this.destroy())}_queueEvent(o,i){dl(this._queuedCallbacks,o,[]).push(i)}onDone(o){this.queued&&this._queueEvent("done",o),this._player.onDone(o)}onStart(o){this.queued&&this._queueEvent("start",o),this._player.onStart(o)}onDestroy(o){this.queued&&this._queueEvent("destroy",o),this._player.onDestroy(o)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(o){this.queued||this._player.setPosition(o)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(o){const i=this._player;i.triggerCallback&&i.triggerCallback(o)}}function BD(e){return e&&1===e.nodeType}function FN(e,o){const i=e.style.display;return e.style.display=o??"none",i}function LN(e,o,i,s,c){const f=[];i.forEach(w=>f.push(FN(w)));const g=[];s.forEach((w,T)=>{const A=new Map;w.forEach(k=>{const B=o.computeStyle(T,k,c);A.set(k,B),(!B||0==B.length)&&(T[Hc]=E6,g.push(T))}),e.set(T,A)});let v=0;return i.forEach(w=>FN(w,f[v++])),g}function NN(e,o){const i=new Map;if(e.forEach(v=>i.set(v,[])),0==o.length)return i;const c=new Set(o),f=new Map;function g(v){if(!v)return 1;let w=f.get(v);if(w)return w;const T=v.parentNode;return w=i.has(T)?T:c.has(T)?1:g(T),f.set(v,w),w}return o.forEach(v=>{const w=g(v);1!==w&&i.get(w).push(v)}),i}function tc(e,o){e.classList?.add(o)}function Vv(e,o){e.classList?.remove(o)}function I6(e,o,i){Gf(i).onDone(()=>e.processLeaveNode(o))}function zN(e,o){for(let i=0;i<e.length;i++){const s=e[i];s instanceof hN?zN(s.players,o):o.push(s)}}function BN(e,o,i){const s=i.get(e);if(!s)return!1;let c=o.get(e);return c?s.forEach(f=>c.add(f)):o.set(e,s),i.delete(e),!0}class VD{constructor(o,i,s){this.bodyNode=o,this._driver=i,this._normalizer=s,this._triggerCache={},this.onRemovalComplete=(c,f)=>{},this._transitionEngine=new M6(o,i,s),this._timelineEngine=new _6(o,i,s),this._transitionEngine.onRemovalComplete=(c,f)=>this.onRemovalComplete(c,f)}registerTrigger(o,i,s,c,f){const g=o+"-"+c;let v=this._triggerCache[g];if(!v){const w=[],A=CO(this._driver,f,w,[]);if(w.length)throw function vU(e,o){return new at(3404,!1)}();v=function f6(e,o,i){return new p6(e,o,i)}(c,A,this._normalizer),this._triggerCache[g]=v}this._transitionEngine.registerTrigger(i,c,v)}register(o,i){this._transitionEngine.register(o,i)}destroy(o,i){this._transitionEngine.destroy(o,i)}onInsert(o,i,s,c){this._transitionEngine.insertNode(o,i,s,c)}onRemove(o,i,s){this._transitionEngine.removeNode(o,i,s)}disableAnimations(o,i){this._transitionEngine.markElementAsDisabled(o,i)}process(o,i,s,c){if("@"==s.charAt(0)){const[f,g]=mN(s);this._timelineEngine.command(f,i,g,c)}else this._transitionEngine.trigger(o,i,s,c)}listen(o,i,s,c,f){if("@"==s.charAt(0)){const[g,v]=mN(s);return this._timelineEngine.listen(g,i,v,f)}return this._transitionEngine.listen(o,i,s,c,f)}flush(o=-1){this._transitionEngine.flush(o)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(o){this._transitionEngine.afterFlushAnimationsDone(o)}}let O6=(()=>{class e{static#t=this.initialStylesByElement=new WeakMap;constructor(i,s,c){this._element=i,this._startStyles=s,this._endStyles=c,this._state=0;let f=e.initialStylesByElement.get(i);f||e.initialStylesByElement.set(i,f=new Map),this._initialStyles=f}start(){this._state<1&&(this._startStyles&&Bu(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Bu(this._element,this._initialStyles),this._endStyles&&(Bu(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(wg(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(wg(this._element,this._endStyles),this._endStyles=null),Bu(this._element,this._initialStyles),this._state=3)}}return e})();function FO(e){let o=null;return e.forEach((i,s)=>{(function k6(e){return"display"===e||"position"===e})(s)&&(o=o||new Map,o.set(s,i))}),o}class VN{constructor(o,i,s,c){this.element=o,this.keyframes=i,this.options=s,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(o=>o()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const o=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,o,this.options),this._finalKeyframe=o.length?o[o.length-1]:new Map;const i=()=>this._onFinish();this.domPlayer.addEventListener("finish",i),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",i)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(o){const i=[];return o.forEach(s=>{i.push(Object.fromEntries(s))}),i}_triggerWebAnimation(o,i,s){return o.animate(this._convertKeyframesToObject(i),s)}onStart(o){this._originalOnStartFns.push(o),this._onStartFns.push(o)}onDone(o){this._originalOnDoneFns.push(o),this._onDoneFns.push(o)}onDestroy(o){this._onDestroyFns.push(o)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(o=>o()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(o=>o()),this._onDestroyFns=[])}setPosition(o){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=o*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const o=new Map;this.hasStarted()&&this._finalKeyframe.forEach((s,c)=>{"offset"!==c&&o.set(c,this._finished?s:MN(this.element,c))}),this.currentSnapshot=o}triggerCallback(o){const i="start"===o?this._onStartFns:this._onDoneFns;i.forEach(s=>s()),i.length=0}}class F6{validateStyleProperty(o){return!0}validateAnimatableStyleProperty(o){return!0}matchesElement(o,i){return!1}containsElement(o,i){return _N(o,i)}getParentElement(o){return _O(o)}query(o,i,s){return yN(o,i,s)}computeStyle(o,i,s){return window.getComputedStyle(o)[i]}animate(o,i,s,c,f,g=[]){const w={duration:s,delay:c,fill:0==c?"both":"forwards"};f&&(w.easing=f);const T=new Map,A=g.filter($=>$ instanceof VN);(function UU(e,o){return 0===e||0===o})(s,c)&&A.forEach($=>{$.currentSnapshot.forEach((K,Q)=>T.set(Q,K))});let k=function BU(e){return e.length?e[0]instanceof Map?e:e.map(o=>wN(o)):[]}(i).map($=>qf($));k=function HU(e,o,i){if(i.size&&o.length){let s=o[0],c=[];if(i.forEach((f,g)=>{s.has(g)||c.push(g),s.set(g,f)}),c.length)for(let f=1;f<o.length;f++){let g=o[f];c.forEach(v=>g.set(v,MN(e,v)))}}return o}(o,k,T);const B=function P6(e,o){let i=null,s=null;return Array.isArray(o)&&o.length?(i=FO(o[0]),o.length>1&&(s=FO(o[o.length-1]))):o instanceof Map&&(i=FO(o)),i||s?new O6(e,i,s):null}(o,k);return new VN(o,k,w,B)}}let L6=(()=>{class e extends cN{constructor(i,s){super(),this._nextAnimationId=0,this._renderer=i.createRenderer(s.body,{id:"0",encapsulation:jo.None,styles:[],data:{animation:[]}})}build(i){const s=this._nextAnimationId.toString();this._nextAnimationId++;const c=Array.isArray(i)?uN(i):i;return jN(this._renderer,null,s,"register",[c]),new N6(s,this._renderer)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(mm),bt(Qn))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();class N6 extends Xj{constructor(o,i){super(),this._id=o,this._renderer=i}create(o,i){return new z6(this._id,o,i||{},this._renderer)}}class z6{constructor(o,i,s,c){this.id=o,this.element=i,this._renderer=c,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",s)}_listen(o,i){return this._renderer.listen(this.element,`@@${this.id}:${o}`,i)}_command(o,...i){return jN(this._renderer,this.element,this.id,o,i)}onDone(o){this._listen("done",o)}onStart(o){this._listen("start",o)}onDestroy(o){this._listen("destroy",o)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(o){this._command("setPosition",o)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function jN(e,o,i,s,c){return e.setProperty(o,`@@${i}:${s}`,c)}const UN="@.disabled";let B6=(()=>{class e{constructor(i,s,c){this.delegate=i,this.engine=s,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,s.onRemovalComplete=(f,g)=>{const v=g?.parentNode(f);v&&g.removeChild(v,f)}}createRenderer(i,s){const f=this.delegate.createRenderer(i,s);if(!(i&&s&&s.data&&s.data.animation)){let A=this._rendererCache.get(f);return A||(A=new HN("",f,this.engine,()=>this._rendererCache.delete(f)),this._rendererCache.set(f,A)),A}const g=s.id,v=s.id+"-"+this._currentId;this._currentId++,this.engine.register(v,i);const w=A=>{Array.isArray(A)?A.forEach(w):this.engine.registerTrigger(g,v,i,A.name,A)};return s.data.animation.forEach(w),new V6(this,v,f,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,s,c){i>=0&&i<this._microtaskId?this._zone.run(()=>s(c)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(f=>{const[g,v]=f;g(v)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([s,c]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}static#t=this.\u0275fac=function(s){return new(s||e)(bt(mm),bt(VD),bt(Xe))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();class HN{constructor(o,i,s,c){this.namespaceId=o,this.delegate=i,this.engine=s,this._onDestroy=c}get data(){return this.delegate.data}destroyNode(o){this.delegate.destroyNode?.(o)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(o,i){return this.delegate.createElement(o,i)}createComment(o){return this.delegate.createComment(o)}createText(o){return this.delegate.createText(o)}appendChild(o,i){this.delegate.appendChild(o,i),this.engine.onInsert(this.namespaceId,i,o,!1)}insertBefore(o,i,s,c=!0){this.delegate.insertBefore(o,i,s),this.engine.onInsert(this.namespaceId,i,o,c)}removeChild(o,i,s){this.engine.onRemove(this.namespaceId,i,this.delegate)}selectRootElement(o,i){return this.delegate.selectRootElement(o,i)}parentNode(o){return this.delegate.parentNode(o)}nextSibling(o){return this.delegate.nextSibling(o)}setAttribute(o,i,s,c){this.delegate.setAttribute(o,i,s,c)}removeAttribute(o,i,s){this.delegate.removeAttribute(o,i,s)}addClass(o,i){this.delegate.addClass(o,i)}removeClass(o,i){this.delegate.removeClass(o,i)}setStyle(o,i,s,c){this.delegate.setStyle(o,i,s,c)}removeStyle(o,i,s){this.delegate.removeStyle(o,i,s)}setProperty(o,i,s){"@"==i.charAt(0)&&i==UN?this.disableAnimations(o,!!s):this.delegate.setProperty(o,i,s)}setValue(o,i){this.delegate.setValue(o,i)}listen(o,i,s){return this.delegate.listen(o,i,s)}disableAnimations(o,i){this.engine.disableAnimations(o,i)}}class V6 extends HN{constructor(o,i,s,c,f){super(i,s,c,f),this.factory=o,this.namespaceId=i}setProperty(o,i,s){"@"==i.charAt(0)?"."==i.charAt(1)&&i==UN?this.disableAnimations(o,s=void 0===s||!!s):this.engine.process(this.namespaceId,o,i.slice(1),s):this.delegate.setProperty(o,i,s)}listen(o,i,s){if("@"==i.charAt(0)){const c=function j6(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(o);let f=i.slice(1),g="";return"@"!=f.charAt(0)&&([f,g]=function U6(e){const o=e.indexOf(".");return[e.substring(0,o),e.slice(o+1)]}(f)),this.engine.listen(this.namespaceId,c,f,g,v=>{this.factory.scheduleListenerCallback(v._data||-1,s,v)})}return this.delegate.listen(o,i,s)}}const $N=[{provide:cN,useClass:L6},{provide:IO,useFactory:function $6(){return new c6}},{provide:VD,useClass:(()=>{class e extends VD{constructor(i,s,c,f){super(i.body,s,c)}ngOnDestroy(){this.flush()}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn),bt(yO),bt(IO),bt(ct))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})()},{provide:mm,useFactory:function G6(e,o,i){return new B6(e,o,i)},deps:[sO,VD,Xe]}],LO=[{provide:yO,useFactory:()=>new F6},{provide:xu,useValue:"BrowserAnimations"},...$N],GN=[{provide:yO,useClass:vN},{provide:xu,useValue:"NoopAnimations"},...$N];let q6=(()=>{class e{static withConfig(i){return{ngModule:e,providers:i.disableAnimations?GN:LO}}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({providers:LO,imports:[iN]})}return e})();function jv(e,o){return qn(o)?mr(e,o,1):mr(e,1)}function Os(e,o){return ar((i,s)=>{let c=0;i.subscribe(Di(s,f=>e.call(o,f,c++)&&s.next(f)))})}function Uv(e){return ar((o,i)=>{try{o.subscribe(i)}finally{i.add(e)}})}class UD{}class HD{}class Vu{constructor(o){this.normalizedNames=new Map,this.lazyUpdate=null,o?"string"==typeof o?this.lazyInit=()=>{this.headers=new Map,o.split("\n").forEach(i=>{const s=i.indexOf(":");if(s>0){const c=i.slice(0,s),f=c.toLowerCase(),g=i.slice(s+1).trim();this.maybeSetNormalizedName(c,f),this.headers.has(f)?this.headers.get(f).push(g):this.headers.set(f,[g])}})}:typeof Headers<"u"&&o instanceof Headers?(this.headers=new Map,o.forEach((i,s)=>{this.setHeaderEntries(s,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(o).forEach(([i,s])=>{this.setHeaderEntries(i,s)})}:this.headers=new Map}has(o){return this.init(),this.headers.has(o.toLowerCase())}get(o){this.init();const i=this.headers.get(o.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(o){return this.init(),this.headers.get(o.toLowerCase())||null}append(o,i){return this.clone({name:o,value:i,op:"a"})}set(o,i){return this.clone({name:o,value:i,op:"s"})}delete(o,i){return this.clone({name:o,value:i,op:"d"})}maybeSetNormalizedName(o,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,o)}init(){this.lazyInit&&(this.lazyInit instanceof Vu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(o=>this.applyUpdate(o)),this.lazyUpdate=null))}copyFrom(o){o.init(),Array.from(o.headers.keys()).forEach(i=>{this.headers.set(i,o.headers.get(i)),this.normalizedNames.set(i,o.normalizedNames.get(i))})}clone(o){const i=new Vu;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof Vu?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([o]),i}applyUpdate(o){const i=o.name.toLowerCase();switch(o.op){case"a":case"s":let s=o.value;if("string"==typeof s&&(s=[s]),0===s.length)return;this.maybeSetNormalizedName(o.name,i);const c=("a"===o.op?this.headers.get(i):void 0)||[];c.push(...s),this.headers.set(i,c);break;case"d":const f=o.value;if(f){let g=this.headers.get(i);if(!g)return;g=g.filter(v=>-1===f.indexOf(v)),0===g.length?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,g)}else this.headers.delete(i),this.normalizedNames.delete(i)}}setHeaderEntries(o,i){const s=(Array.isArray(i)?i:[i]).map(f=>f.toString()),c=o.toLowerCase();this.headers.set(c,s),this.maybeSetNormalizedName(o,c)}forEach(o){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>o(this.normalizedNames.get(i),this.headers.get(i)))}}class W6{encodeKey(o){return qN(o)}encodeValue(o){return qN(o)}decodeKey(o){return decodeURIComponent(o)}decodeValue(o){return decodeURIComponent(o)}}const X6=/%(\d[a-f0-9])/gi,Y6={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function qN(e){return encodeURIComponent(e).replace(X6,(o,i)=>Y6[i]??o)}function $D(e){return`${e}`}class Wf{constructor(o={}){if(this.updates=null,this.cloneFrom=null,this.encoder=o.encoder||new W6,o.fromString){if(o.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Z6(e,o){const i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(c=>{const f=c.indexOf("="),[g,v]=-1==f?[o.decodeKey(c),""]:[o.decodeKey(c.slice(0,f)),o.decodeValue(c.slice(f+1))],w=i.get(g)||[];w.push(v),i.set(g,w)}),i}(o.fromString,this.encoder)}else o.fromObject?(this.map=new Map,Object.keys(o.fromObject).forEach(i=>{const s=o.fromObject[i],c=Array.isArray(s)?s.map($D):[$D(s)];this.map.set(i,c)})):this.map=null}has(o){return this.init(),this.map.has(o)}get(o){this.init();const i=this.map.get(o);return i?i[0]:null}getAll(o){return this.init(),this.map.get(o)||null}keys(){return this.init(),Array.from(this.map.keys())}append(o,i){return this.clone({param:o,value:i,op:"a"})}appendAll(o){const i=[];return Object.keys(o).forEach(s=>{const c=o[s];Array.isArray(c)?c.forEach(f=>{i.push({param:s,value:f,op:"a"})}):i.push({param:s,value:c,op:"a"})}),this.clone(i)}set(o,i){return this.clone({param:o,value:i,op:"s"})}delete(o,i){return this.clone({param:o,value:i,op:"d"})}toString(){return this.init(),this.keys().map(o=>{const i=this.encoder.encodeKey(o);return this.map.get(o).map(s=>i+"="+this.encoder.encodeValue(s)).join("&")}).filter(o=>""!==o).join("&")}clone(o){const i=new Wf({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(o),i}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(o=>this.map.set(o,this.cloneFrom.map.get(o))),this.updates.forEach(o=>{switch(o.op){case"a":case"s":const i=("a"===o.op?this.map.get(o.param):void 0)||[];i.push($D(o.value)),this.map.set(o.param,i);break;case"d":if(void 0===o.value){this.map.delete(o.param);break}{let s=this.map.get(o.param)||[];const c=s.indexOf($D(o.value));-1!==c&&s.splice(c,1),s.length>0?this.map.set(o.param,s):this.map.delete(o.param)}}}),this.cloneFrom=this.updates=null)}}class K6{constructor(){this.map=new Map}set(o,i){return this.map.set(o,i),this}get(o){return this.map.has(o)||this.map.set(o,o.defaultValue()),this.map.get(o)}delete(o){return this.map.delete(o),this}has(o){return this.map.has(o)}keys(){return this.map.keys()}}function WN(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function ZN(e){return typeof Blob<"u"&&e instanceof Blob}function XN(e){return typeof FormData<"u"&&e instanceof FormData}class Ew{constructor(o,i,s,c){let f;if(this.url=i,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=o.toUpperCase(),function J6(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||c?(this.body=void 0!==s?s:null,f=c):f=s,f&&(this.reportProgress=!!f.reportProgress,this.withCredentials=!!f.withCredentials,f.responseType&&(this.responseType=f.responseType),f.headers&&(this.headers=f.headers),f.context&&(this.context=f.context),f.params&&(this.params=f.params)),this.headers||(this.headers=new Vu),this.context||(this.context=new K6),this.params){const g=this.params.toString();if(0===g.length)this.urlWithParams=i;else{const v=i.indexOf("?");this.urlWithParams=i+(-1===v?"?":v<i.length-1?"&":"")+g}}else this.params=new Wf,this.urlWithParams=i}serializeBody(){return null===this.body?null:WN(this.body)||ZN(this.body)||XN(this.body)||function Q6(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Wf?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||XN(this.body)?null:ZN(this.body)?this.body.type||null:WN(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Wf?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(o={}){const i=o.method||this.method,s=o.url||this.url,c=o.responseType||this.responseType,f=void 0!==o.body?o.body:this.body,g=void 0!==o.withCredentials?o.withCredentials:this.withCredentials,v=void 0!==o.reportProgress?o.reportProgress:this.reportProgress;let w=o.headers||this.headers,T=o.params||this.params;const A=o.context??this.context;return void 0!==o.setHeaders&&(w=Object.keys(o.setHeaders).reduce((k,B)=>k.set(B,o.setHeaders[B]),w)),o.setParams&&(T=Object.keys(o.setParams).reduce((k,B)=>k.set(B,o.setParams[B]),T)),new Ew(i,s,f,{params:T,headers:w,context:A,reportProgress:v,responseType:c,withCredentials:g})}}var Hv=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(Hv||{});class NO{constructor(o,i=200,s="OK"){this.headers=o.headers||new Vu,this.status=void 0!==o.status?o.status:i,this.statusText=o.statusText||s,this.url=o.url||null,this.ok=this.status>=200&&this.status<300}}class zO extends NO{constructor(o={}){super(o),this.type=Hv.ResponseHeader}clone(o={}){return new zO({headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class $v extends NO{constructor(o={}){super(o),this.type=Hv.Response,this.body=void 0!==o.body?o.body:null}clone(o={}){return new $v({body:void 0!==o.body?o.body:this.body,headers:o.headers||this.headers,status:void 0!==o.status?o.status:this.status,statusText:o.statusText||this.statusText,url:o.url||this.url||void 0})}}class YN extends NO{constructor(o){super(o,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${o.url||"(unknown url)"}`:`Http failure response for ${o.url||"(unknown url)"}: ${o.status} ${o.statusText}`,this.error=o.error||null}}function BO(e,o){return{body:o,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let GD=(()=>{class e{constructor(i){this.handler=i}request(i,s,c={}){let f;if(i instanceof Ew)f=i;else{let w,T;w=c.headers instanceof Vu?c.headers:new Vu(c.headers),c.params&&(T=c.params instanceof Wf?c.params:new Wf({fromObject:c.params})),f=new Ew(i,s,void 0!==c.body?c.body:null,{headers:w,context:c.context,params:T,reportProgress:c.reportProgress,responseType:c.responseType||"json",withCredentials:c.withCredentials})}const g=kt(f).pipe(jv(w=>this.handler.handle(w)));if(i instanceof Ew||"events"===c.observe)return g;const v=g.pipe(Os(w=>w instanceof $v));switch(c.observe||"body"){case"body":switch(f.responseType){case"arraybuffer":return v.pipe(dn(w=>{if(null!==w.body&&!(w.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return w.body}));case"blob":return v.pipe(dn(w=>{if(null!==w.body&&!(w.body instanceof Blob))throw new Error("Response is not a Blob.");return w.body}));case"text":return v.pipe(dn(w=>{if(null!==w.body&&"string"!=typeof w.body)throw new Error("Response is not a string.");return w.body}));default:return v.pipe(dn(w=>w.body))}case"response":return v;default:throw new Error(`Unreachable: unhandled observe type ${c.observe}}`)}}delete(i,s={}){return this.request("DELETE",i,s)}get(i,s={}){return this.request("GET",i,s)}head(i,s={}){return this.request("HEAD",i,s)}jsonp(i,s){return this.request("JSONP",i,{params:(new Wf).append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(i,s={}){return this.request("OPTIONS",i,s)}patch(i,s,c={}){return this.request("PATCH",i,BO(c,s))}post(i,s,c={}){return this.request("POST",i,BO(c,s))}put(i,s,c={}){return this.request("PUT",i,BO(c,s))}static#t=this.\u0275fac=function(s){return new(s||e)(bt(UD))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();function QN(e,o){return o(e)}function e8(e,o){return(i,s)=>o.intercept(i,{handle:c=>e(c,s)})}const i8=new $t(""),Cw=new $t(""),t3=new $t("");function r8(){let e=null;return(o,i)=>{null===e&&(e=(ne(i8,{optional:!0})??[]).reduceRight(e8,QN));const s=ne(Bd),c=s.add();return e(o,i).pipe(Uv(()=>s.remove(c)))}}let e3=(()=>{class e extends UD{constructor(i,s){super(),this.backend=i,this.injector=s,this.chain=null,this.pendingTasks=ne(Bd)}handle(i){if(null===this.chain){const c=Array.from(new Set([...this.injector.get(Cw),...this.injector.get(t3,[])]));this.chain=c.reduceRight((f,g)=>function n8(e,o,i){return(s,c)=>i.runInContext(()=>o(s,f=>e(f,c)))}(f,g,this.injector),QN)}const s=this.pendingTasks.add();return this.chain(i,c=>this.backend.handle(c)).pipe(Uv(()=>this.pendingTasks.remove(s)))}static#t=this.\u0275fac=function(s){return new(s||e)(bt(HD),bt(Ds))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();const l8=/^\)\]\}',?\n/;let i3=(()=>{class e{constructor(i){this.xhrFactory=i}handle(i){if("JSONP"===i.method)throw new at(-2800,!1);const s=this.xhrFactory;return(s.\u0275loadImpl?Pr(s.\u0275loadImpl()):kt(null)).pipe(Gr(()=>new $n(f=>{const g=s.build();if(g.open(i.method,i.urlWithParams),i.withCredentials&&(g.withCredentials=!0),i.headers.forEach((Q,ut)=>g.setRequestHeader(Q,ut.join(","))),i.headers.has("Accept")||g.setRequestHeader("Accept","application/json, text/plain, */*"),!i.headers.has("Content-Type")){const Q=i.detectContentTypeHeader();null!==Q&&g.setRequestHeader("Content-Type",Q)}if(i.responseType){const Q=i.responseType.toLowerCase();g.responseType="json"!==Q?Q:"text"}const v=i.serializeBody();let w=null;const T=()=>{if(null!==w)return w;const Q=g.statusText||"OK",ut=new Vu(g.getAllResponseHeaders()),yt=function c8(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(g)||i.url;return w=new zO({headers:ut,status:g.status,statusText:Q,url:yt}),w},A=()=>{let{headers:Q,status:ut,statusText:yt,url:pt}=T(),Ft=null;204!==ut&&(Ft=typeof g.response>"u"?g.responseText:g.response),0===ut&&(ut=Ft?200:0);let Zt=ut>=200&&ut<300;if("json"===i.responseType&&"string"==typeof Ft){const de=Ft;Ft=Ft.replace(l8,"");try{Ft=""!==Ft?JSON.parse(Ft):null}catch(oe){Ft=de,Zt&&(Zt=!1,Ft={error:oe,text:Ft})}}Zt?(f.next(new $v({body:Ft,headers:Q,status:ut,statusText:yt,url:pt||void 0})),f.complete()):f.error(new YN({error:Ft,headers:Q,status:ut,statusText:yt,url:pt||void 0}))},k=Q=>{const{url:ut}=T(),yt=new YN({error:Q,status:g.status||0,statusText:g.statusText||"Unknown Error",url:ut||void 0});f.error(yt)};let B=!1;const $=Q=>{B||(f.next(T()),B=!0);let ut={type:Hv.DownloadProgress,loaded:Q.loaded};Q.lengthComputable&&(ut.total=Q.total),"text"===i.responseType&&g.responseText&&(ut.partialText=g.responseText),f.next(ut)},K=Q=>{let ut={type:Hv.UploadProgress,loaded:Q.loaded};Q.lengthComputable&&(ut.total=Q.total),f.next(ut)};return g.addEventListener("load",A),g.addEventListener("error",k),g.addEventListener("timeout",k),g.addEventListener("abort",k),i.reportProgress&&(g.addEventListener("progress",$),null!==v&&g.upload&&g.upload.addEventListener("progress",K)),g.send(v),f.next({type:Hv.Sent}),()=>{g.removeEventListener("error",k),g.removeEventListener("abort",k),g.removeEventListener("load",A),g.removeEventListener("timeout",k),i.reportProgress&&(g.removeEventListener("progress",$),null!==v&&g.upload&&g.upload.removeEventListener("progress",K)),g.readyState!==g.DONE&&g.abort()}})))}static#t=this.\u0275fac=function(s){return new(s||e)(bt(VL))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();const VO=new $t("XSRF_ENABLED"),r3=new $t("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),o3=new $t("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class s3{}let h8=(()=>{class e{constructor(i,s,c){this.doc=i,this.platform=s,this.cookieName=c,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const i=this.doc.cookie||"";return i!==this.lastCookieString&&(this.parseCount++,this.lastToken=DL(i,this.cookieName),this.lastCookieString=i),this.lastToken}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn),bt(Ya),bt(r3))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();function f8(e,o){const i=e.url.toLowerCase();if(!ne(VO)||"GET"===e.method||"HEAD"===e.method||i.startsWith("http://")||i.startsWith("https://"))return o(e);const s=ne(s3).getToken(),c=ne(o3);return null!=s&&!e.headers.has(c)&&(e=e.clone({headers:e.headers.set(c,s)})),o(e)}var Zf=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(Zf||{});function p8(...e){const o=[GD,i3,e3,{provide:UD,useExisting:e3},{provide:HD,useExisting:i3},{provide:Cw,useValue:f8,multi:!0},{provide:VO,useValue:!0},{provide:s3,useClass:h8}];for(const i of e)o.push(...i.\u0275providers);return function Bx(e){return{\u0275providers:e}}(o)}const a3=new $t("LEGACY_INTERCEPTOR_FN");function m8(){return function Cg(e,o){return{\u0275kind:e,\u0275providers:o}}(Zf.LegacyInterceptors,[{provide:a3,useFactory:r8},{provide:Cw,useExisting:a3,multi:!0}])}let g8=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({providers:[p8(m8())]})}return e})();const{isArray:w8}=Array,{getPrototypeOf:E8,prototype:C8,keys:M8}=Object;function l3(e){if(1===e.length){const o=e[0];if(w8(o))return{args:o,keys:null};if(function S8(e){return e&&"object"==typeof e&&E8(e)===C8}(o)){const i=M8(o);return{args:i.map(s=>o[s]),keys:i}}}return{args:e,keys:null}}const{isArray:T8}=Array;function jO(e){return dn(o=>function D8(e,o){return T8(o)?e(...o):e(o)}(e,o))}function c3(e,o){return e.reduce((i,s,c)=>(i[s]=o[c],i),{})}function u3(...e){const o=lE(e),{args:i,keys:s}=l3(e),c=new $n(f=>{const{length:g}=i;if(!g)return void f.complete();const v=new Array(g);let w=g,T=g;for(let A=0;A<g;A++){let k=!1;En(i[A]).subscribe(Di(f,B=>{k||(k=!0,T--),v[A]=B},()=>w--,void 0,()=>{(!w||!k)&&(T||f.next(s?c3(s,v):v),f.complete())}))}});return o?c.pipe(jO(o)):c}let d3=(()=>{class e{constructor(i,s){this._renderer=i,this._elementRef=s,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(i,s){this._renderer.setProperty(this._elementRef.nativeElement,i,s)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Tc),_t(Oi))};static#e=this.\u0275dir=Ee({type:e})}return e})(),Mg=(()=>{class e extends d3{static#t=this.\u0275fac=function(){let i;return function(c){return(i||(i=xr(e)))(c||e)}}();static#e=this.\u0275dir=Ee({type:e,features:[jn]})}return e})();const ju=new $t("NgValueAccessor"),A8={provide:ju,useExisting:Ii(()=>WD),multi:!0},P8=new $t("CompositionEventMode");let WD=(()=>{class e extends d3{constructor(i,s,c){super(i,s),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function R8(){const e=Hf()?Hf().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(i){this.setProperty("value",i??"")}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Tc),_t(Oi),_t(P8,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(s,c){1&s&&cr("input",function(g){return c._handleInput(g.target.value)})("blur",function(){return c.onTouched()})("compositionstart",function(){return c._compositionStart()})("compositionend",function(g){return c._compositionEnd(g.target.value)})},features:[Wi([A8]),jn]})}return e})();function Xf(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function f3(e){return null!=e&&"number"==typeof e.length}const ks=new $t("NgValidators"),Yf=new $t("NgAsyncValidators"),O8=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class p3{static min(o){return function m3(e){return o=>{if(Xf(o.value)||Xf(e))return null;const i=parseFloat(o.value);return!isNaN(i)&&i<e?{min:{min:e,actual:o.value}}:null}}(o)}static max(o){return function g3(e){return o=>{if(Xf(o.value)||Xf(e))return null;const i=parseFloat(o.value);return!isNaN(i)&&i>e?{max:{max:e,actual:o.value}}:null}}(o)}static required(o){return function _3(e){return Xf(e.value)?{required:!0}:null}(o)}static requiredTrue(o){return function y3(e){return!0===e.value?null:{required:!0}}(o)}static email(o){return function v3(e){return Xf(e.value)||O8.test(e.value)?null:{email:!0}}(o)}static minLength(o){return function x3(e){return o=>Xf(o.value)||!f3(o.value)?null:o.value.length<e?{minlength:{requiredLength:e,actualLength:o.value.length}}:null}(o)}static maxLength(o){return function b3(e){return o=>f3(o.value)&&o.value.length>e?{maxlength:{requiredLength:e,actualLength:o.value.length}}:null}(o)}static pattern(o){return function w3(e){if(!e)return ZD;let o,i;return"string"==typeof e?(i="","^"!==e.charAt(0)&&(i+="^"),i+=e,"$"!==e.charAt(e.length-1)&&(i+="$"),o=new RegExp(i)):(i=e.toString(),o=e),s=>{if(Xf(s.value))return null;const c=s.value;return o.test(c)?null:{pattern:{requiredPattern:i,actualValue:c}}}}(o)}static nullValidator(o){return null}static compose(o){return D3(o)}static composeAsync(o){return I3(o)}}function ZD(e){return null}function E3(e){return null!=e}function C3(e){return Ef(e)?Pr(e):e}function M3(e){let o={};return e.forEach(i=>{o=null!=i?{...o,...i}:o}),0===Object.keys(o).length?null:o}function S3(e,o){return o.map(i=>i(e))}function T3(e){return e.map(o=>function k8(e){return!e.validate}(o)?o:i=>o.validate(i))}function D3(e){if(!e)return null;const o=e.filter(E3);return 0==o.length?null:function(i){return M3(S3(i,o))}}function UO(e){return null!=e?D3(T3(e)):null}function I3(e){if(!e)return null;const o=e.filter(E3);return 0==o.length?null:function(i){return u3(S3(i,o).map(C3)).pipe(dn(M3))}}function HO(e){return null!=e?I3(T3(e)):null}function A3(e,o){return null===e?[o]:Array.isArray(e)?[...e,o]:[e,o]}function R3(e){return e._rawValidators}function P3(e){return e._rawAsyncValidators}function $O(e){return e?Array.isArray(e)?e:[e]:[]}function XD(e,o){return Array.isArray(e)?e.includes(o):e===o}function O3(e,o){const i=$O(o);return $O(e).forEach(c=>{XD(i,c)||i.push(c)}),i}function k3(e,o){return $O(o).filter(i=>!XD(e,i))}class F3{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(o){this._rawValidators=o||[],this._composedValidatorFn=UO(this._rawValidators)}_setAsyncValidators(o){this._rawAsyncValidators=o||[],this._composedAsyncValidatorFn=HO(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(o){this._onDestroyCallbacks.push(o)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(o=>o()),this._onDestroyCallbacks=[]}reset(o=void 0){this.control&&this.control.reset(o)}hasError(o,i){return!!this.control&&this.control.hasError(o,i)}getError(o,i){return this.control?this.control.getError(o,i):null}}class ra extends F3{get formDirective(){return null}get path(){return null}}class Uu extends F3{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class L3{constructor(o){this._cd=o}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let N3=(()=>{class e extends L3{constructor(i){super(i)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Uu,2))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(s,c){2&s&&Ir("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)},features:[jn]})}return e})();const Mw="VALID",KD="INVALID",Gv="PENDING",Sw="DISABLED";function WO(e){return(JD(e)?e.validators:e)||null}function ZO(e,o){return(JD(o)?o.asyncValidators:e)||null}function JD(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class j3{constructor(o,i){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(o),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(o){this._rawValidators=this._composedValidatorFn=o}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(o){this._rawAsyncValidators=this._composedAsyncValidatorFn=o}get parent(){return this._parent}get valid(){return this.status===Mw}get invalid(){return this.status===KD}get pending(){return this.status==Gv}get disabled(){return this.status===Sw}get enabled(){return this.status!==Sw}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(o){this._assignValidators(o)}setAsyncValidators(o){this._assignAsyncValidators(o)}addValidators(o){this.setValidators(O3(o,this._rawValidators))}addAsyncValidators(o){this.setAsyncValidators(O3(o,this._rawAsyncValidators))}removeValidators(o){this.setValidators(k3(o,this._rawValidators))}removeAsyncValidators(o){this.setAsyncValidators(k3(o,this._rawAsyncValidators))}hasValidator(o){return XD(this._rawValidators,o)}hasAsyncValidator(o){return XD(this._rawAsyncValidators,o)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(o={}){this.touched=!0,this._parent&&!o.onlySelf&&this._parent.markAsTouched(o)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(o=>o.markAllAsTouched())}markAsUntouched(o={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}markAsDirty(o={}){this.pristine=!1,this._parent&&!o.onlySelf&&this._parent.markAsDirty(o)}markAsPristine(o={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(i=>{i.markAsPristine({onlySelf:!0})}),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}markAsPending(o={}){this.status=Gv,!1!==o.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!o.onlySelf&&this._parent.markAsPending(o)}disable(o={}){const i=this._parentMarkedDirty(o.onlySelf);this.status=Sw,this.errors=null,this._forEachChild(s=>{s.disable({...o,onlySelf:!0})}),this._updateValue(),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...o,skipPristineCheck:i}),this._onDisabledChange.forEach(s=>s(!0))}enable(o={}){const i=this._parentMarkedDirty(o.onlySelf);this.status=Mw,this._forEachChild(s=>{s.enable({...o,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent}),this._updateAncestors({...o,skipPristineCheck:i}),this._onDisabledChange.forEach(s=>s(!1))}_updateAncestors(o){this._parent&&!o.onlySelf&&(this._parent.updateValueAndValidity(o),o.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(o){this._parent=o}getRawValue(){return this.value}updateValueAndValidity(o={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Mw||this.status===Gv)&&this._runAsyncValidator(o.emitEvent)),!1!==o.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!o.onlySelf&&this._parent.updateValueAndValidity(o)}_updateTreeValidity(o={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(o)),this.updateValueAndValidity({onlySelf:!0,emitEvent:o.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Sw:Mw}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(o){if(this.asyncValidator){this.status=Gv,this._hasOwnPendingAsyncValidator=!0;const i=C3(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(s=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(s,{emitEvent:o})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(o,i={}){this.errors=o,this._updateControlsErrors(!1!==i.emitEvent)}get(o){let i=o;return null==i||(Array.isArray(i)||(i=i.split(".")),0===i.length)?null:i.reduce((s,c)=>s&&s._find(c),this)}getError(o,i){const s=i?this.get(i):this;return s&&s.errors?s.errors[o]:null}hasError(o,i){return!!this.getError(o,i)}get root(){let o=this;for(;o._parent;)o=o._parent;return o}_updateControlsErrors(o){this.status=this._calculateStatus(),o&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(o)}_initObservables(){this.valueChanges=new oi,this.statusChanges=new oi}_calculateStatus(){return this._allControlsDisabled()?Sw:this.errors?KD:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Gv)?Gv:this._anyControlsHaveStatus(KD)?KD:Mw}_anyControlsHaveStatus(o){return this._anyControls(i=>i.status===o)}_anyControlsDirty(){return this._anyControls(o=>o.dirty)}_anyControlsTouched(){return this._anyControls(o=>o.touched)}_updatePristine(o={}){this.pristine=!this._anyControlsDirty(),this._parent&&!o.onlySelf&&this._parent._updatePristine(o)}_updateTouched(o={}){this.touched=this._anyControlsTouched(),this._parent&&!o.onlySelf&&this._parent._updateTouched(o)}_registerOnCollectionChange(o){this._onCollectionChange=o}_setUpdateStrategy(o){JD(o)&&null!=o.updateOn&&(this._updateOn=o.updateOn)}_parentMarkedDirty(o){return!o&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(o){return null}_assignValidators(o){this._rawValidators=Array.isArray(o)?o.slice():o,this._composedValidatorFn=function B8(e){return Array.isArray(e)?UO(e):e||null}(this._rawValidators)}_assignAsyncValidators(o){this._rawAsyncValidators=Array.isArray(o)?o.slice():o,this._composedAsyncValidatorFn=function V8(e){return Array.isArray(e)?HO(e):e||null}(this._rawAsyncValidators)}}class XO extends j3{constructor(o,i,s){super(WO(i),ZO(s,i)),this.controls=o,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(o,i){return this.controls[o]?this.controls[o]:(this.controls[o]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(o,i,s={}){this.registerControl(o,i),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}removeControl(o,i={}){this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),delete this.controls[o],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(o,i,s={}){this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),delete this.controls[o],i&&this.registerControl(o,i),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}contains(o){return this.controls.hasOwnProperty(o)&&this.controls[o].enabled}setValue(o,i={}){(function V3(e,o,i){e._forEachChild((s,c)=>{if(void 0===i[c])throw new at(1002,"")})})(this,0,o),Object.keys(o).forEach(s=>{(function B3(e,o,i){const s=e.controls;if(!(o?Object.keys(s):s).length)throw new at(1e3,"");if(!s[i])throw new at(1001,"")})(this,!0,s),this.controls[s].setValue(o[s],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(o,i={}){null!=o&&(Object.keys(o).forEach(s=>{const c=this.controls[s];c&&c.patchValue(o[s],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(o={},i={}){this._forEachChild((s,c)=>{s.reset(o?o[c]:null,{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i),this._updateTouched(i),this.updateValueAndValidity(i)}getRawValue(){return this._reduceChildren({},(o,i,s)=>(o[s]=i.getRawValue(),o))}_syncPendingControls(){let o=this._reduceChildren(!1,(i,s)=>!!s._syncPendingControls()||i);return o&&this.updateValueAndValidity({onlySelf:!0}),o}_forEachChild(o){Object.keys(this.controls).forEach(i=>{const s=this.controls[i];s&&o(s,i)})}_setUpControls(){this._forEachChild(o=>{o.setParent(this),o._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(o){for(const[i,s]of Object.entries(this.controls))if(this.contains(i)&&o(s))return!0;return!1}_reduceValue(){return this._reduceChildren({},(i,s,c)=>((s.enabled||this.disabled)&&(i[c]=s.value),i))}_reduceChildren(o,i){let s=o;return this._forEachChild((c,f)=>{s=i(s,c,f)}),s}_allControlsDisabled(){for(const o of Object.keys(this.controls))if(this.controls[o].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(o){return this.controls.hasOwnProperty(o)?this.controls[o]:null}}const qv=new $t("CallSetDisabledState",{providedIn:"root",factory:()=>QD}),QD="always";function Tw(e,o,i=QD){YO(e,o),o.valueAccessor.writeValue(e.value),(e.disabled||"always"===i)&&o.valueAccessor.setDisabledState?.(e.disabled),function H8(e,o){o.valueAccessor.registerOnChange(i=>{e._pendingValue=i,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&U3(e,o)})}(e,o),function G8(e,o){const i=(s,c)=>{o.valueAccessor.writeValue(s),c&&o.viewToModelUpdate(s)};e.registerOnChange(i),o._registerOnDestroy(()=>{e._unregisterOnChange(i)})}(e,o),function $8(e,o){o.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&U3(e,o),"submit"!==e.updateOn&&e.markAsTouched()})}(e,o),function U8(e,o){if(o.valueAccessor.setDisabledState){const i=s=>{o.valueAccessor.setDisabledState(s)};e.registerOnDisabledChange(i),o._registerOnDestroy(()=>{e._unregisterOnDisabledChange(i)})}}(e,o)}function eI(e,o,i=!0){const s=()=>{};o.valueAccessor&&(o.valueAccessor.registerOnChange(s),o.valueAccessor.registerOnTouched(s)),iI(e,o),e&&(o._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function nI(e,o){e.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(o)})}function YO(e,o){const i=R3(e);null!==o.validator?e.setValidators(A3(i,o.validator)):"function"==typeof i&&e.setValidators([i]);const s=P3(e);null!==o.asyncValidator?e.setAsyncValidators(A3(s,o.asyncValidator)):"function"==typeof s&&e.setAsyncValidators([s]);const c=()=>e.updateValueAndValidity();nI(o._rawValidators,c),nI(o._rawAsyncValidators,c)}function iI(e,o){let i=!1;if(null!==e){if(null!==o.validator){const c=R3(e);if(Array.isArray(c)&&c.length>0){const f=c.filter(g=>g!==o.validator);f.length!==c.length&&(i=!0,e.setValidators(f))}}if(null!==o.asyncValidator){const c=P3(e);if(Array.isArray(c)&&c.length>0){const f=c.filter(g=>g!==o.asyncValidator);f.length!==c.length&&(i=!0,e.setAsyncValidators(f))}}}const s=()=>{};return nI(o._rawValidators,s),nI(o._rawAsyncValidators,s),i}function U3(e,o){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),o.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function H3(e,o){YO(e,o)}function $3(e,o){e._syncPendingControls(),o.forEach(i=>{const s=i.control;"submit"===s.updateOn&&s._pendingChange&&(i.viewToModelUpdate(s._pendingValue),s._pendingChange=!1)})}const Y8={provide:ra,useExisting:Ii(()=>Iw)},Dw=(()=>Promise.resolve())();let Iw=(()=>{class e extends ra{constructor(i,s,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._directives=new Set,this.ngSubmit=new oi,this.form=new XO({},UO(i),HO(s))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(i){Dw.then(()=>{const s=this._findContainer(i.path);i.control=s.registerControl(i.name,i.control),Tw(i.control,i,this.callSetDisabledState),i.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(i)})}getControl(i){return this.form.get(i.path)}removeControl(i){Dw.then(()=>{const s=this._findContainer(i.path);s&&s.removeControl(i.name),this._directives.delete(i)})}addFormGroup(i){Dw.then(()=>{const s=this._findContainer(i.path),c=new XO({});H3(c,i),s.registerControl(i.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(i){Dw.then(()=>{const s=this._findContainer(i.path);s&&s.removeControl(i.name)})}getFormGroup(i){return this.form.get(i.path)}updateModel(i,s){Dw.then(()=>{this.form.get(i.path).setValue(s)})}setValue(i){this.control.setValue(i)}onSubmit(i){return this.submitted=!0,$3(this.form,this._directives),this.ngSubmit.emit(i),"dialog"===i?.target?.method}onReset(){this.resetForm()}resetForm(i=void 0){this.form.reset(i),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(i){return i.pop(),i.length?this.form.get(i):this.form}static#t=this.\u0275fac=function(s){return new(s||e)(_t(ks,10),_t(Yf,10),_t(qv,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(s,c){1&s&&cr("submit",function(g){return c.onSubmit(g)})("reset",function(){return c.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wi([Y8]),jn]})}return e})();function G3(e,o){const i=e.indexOf(o);i>-1&&e.splice(i,1)}function q3(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const W3=class extends j3{constructor(o=null,i,s){super(WO(i),ZO(s,i)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(o),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),JD(i)&&(i.nonNullable||i.initialValueIsDefault)&&(this.defaultValue=q3(o)?o.value:o)}setValue(o,i={}){this.value=this._pendingValue=o,this._onChange.length&&!1!==i.emitModelToViewChange&&this._onChange.forEach(s=>s(this.value,!1!==i.emitViewToModelChange)),this.updateValueAndValidity(i)}patchValue(o,i={}){this.setValue(o,i)}reset(o=this.defaultValue,i={}){this._applyFormState(o),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(o){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(o){this._onChange.push(o)}_unregisterOnChange(o){G3(this._onChange,o)}registerOnDisabledChange(o){this._onDisabledChange.push(o)}_unregisterOnDisabledChange(o){G3(this._onDisabledChange,o)}_forEachChild(o){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(o){q3(o)?(this.value=this._pendingValue=o.value,o.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=o}},Q8={provide:Uu,useExisting:Ii(()=>tk)},Y3=(()=>Promise.resolve())();let tk=(()=>{class e extends Uu{constructor(i,s,c,f,g,v){super(),this._changeDetectorRef=g,this.callSetDisabledState=v,this.control=new W3,this._registered=!1,this.name="",this.update=new oi,this._parent=i,this._setValidators(s),this._setAsyncValidators(c),this.valueAccessor=function QO(e,o){if(!o)return null;let i,s,c;return Array.isArray(o),o.forEach(f=>{f.constructor===WD?i=f:function Z8(e){return Object.getPrototypeOf(e.constructor)===Mg}(f)?s=f:c=f}),c||s||i||null}(0,f)}ngOnChanges(i){if(this._checkForErrors(),!this._registered||"name"in i){if(this._registered&&(this._checkName(),this.formDirective)){const s=i.name.previousValue;this.formDirective.removeControl({name:s,path:this._getPath(s)})}this._setUpControl()}"isDisabled"in i&&this._updateDisabled(i),function JO(e,o){if(!e.hasOwnProperty("model"))return!1;const i=e.model;return!!i.isFirstChange()||!Object.is(o,i.currentValue)}(i,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Tw(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(i){Y3.then(()=>{this.control.setValue(i,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(i){const s=i.isDisabled.currentValue,c=0!==s&&function zv(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}(s);Y3.then(()=>{c&&!this.control.disabled?this.control.disable():!c&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(i){return this._parent?function tI(e,o){return[...o.path,e]}(i,this._parent):[i]}static#t=this.\u0275fac=function(s){return new(s||e)(_t(ra,9),_t(ks,10),_t(Yf,10),_t(ju,10),_t(Le,8),_t(qv,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Wi([Q8]),jn,qo]})}return e})(),J3=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({})}return e})();const sH={provide:ra,useExisting:Ii(()=>Aw)};let sk,Aw=(()=>{class e extends ra{constructor(i,s,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new oi,this._setValidators(i),this._setAsyncValidators(s)}ngOnChanges(i){this._checkFormPresent(),i.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(iI(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(i){const s=this.form.get(i.path);return Tw(s,i,this.callSetDisabledState),s.updateValueAndValidity({emitEvent:!1}),this.directives.push(i),s}getControl(i){return this.form.get(i.path)}removeControl(i){eI(i.control||null,i,!1),function X8(e,o){const i=e.indexOf(o);i>-1&&e.splice(i,1)}(this.directives,i)}addFormGroup(i){this._setUpFormContainer(i)}removeFormGroup(i){this._cleanUpFormContainer(i)}getFormGroup(i){return this.form.get(i.path)}addFormArray(i){this._setUpFormContainer(i)}removeFormArray(i){this._cleanUpFormContainer(i)}getFormArray(i){return this.form.get(i.path)}updateModel(i,s){this.form.get(i.path).setValue(s)}onSubmit(i){return this.submitted=!0,$3(this.form,this.directives),this.ngSubmit.emit(i),"dialog"===i?.target?.method}onReset(){this.resetForm()}resetForm(i=void 0){this.form.reset(i),this.submitted=!1}_updateDomValue(){this.directives.forEach(i=>{const s=i.control,c=this.form.get(i.path);s!==c&&(eI(s||null,i),(e=>e instanceof W3)(c)&&(Tw(c,i,this.callSetDisabledState),i.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(i){const s=this.form.get(i.path);H3(s,i),s.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(i){if(this.form){const s=this.form.get(i.path);s&&function q8(e,o){return iI(e,o)}(s,i)&&s.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){YO(this.form,this),this._oldForm&&iI(this._oldForm,this)}_checkFormPresent(){}static#t=this.\u0275fac=function(s){return new(s||e)(_t(ks,10),_t(Yf,10),_t(qv,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","formGroup",""]],hostBindings:function(s,c){1&s&&cr("submit",function(g){return c.onSubmit(g)})("reset",function(){return c.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wi([sH]),jn,qo]})}return e})(),CH=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[J3]})}return e})(),SH=(()=>{class e{static withConfig(i){return{ngModule:e,providers:[{provide:qv,useValue:i.callSetDisabledState??QD}]}}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[CH]})}return e})();try{sk=typeof Intl<"u"&&Intl.v8BreakIterator}catch{sk=!1}let Wv,oa=(()=>{class e{constructor(i){this._platformId=i,this.isBrowser=this._platformId?function XV(e){return e===zL}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!sk)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Ya))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const gz=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function _z(){if(Wv)return Wv;if("object"!=typeof document||!document)return Wv=new Set(gz),Wv;let e=document.createElement("input");return Wv=new Set(gz.filter(o=>(e.setAttribute("type",o),e.type===o))),Wv}let Rw,Tg,ak;function Pw(e){return function TH(){if(null==Rw&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Rw=!0}))}finally{Rw=Rw||!1}return Rw}()?e:!!e.capture}function DH(){if(null==Tg){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Tg=!1,Tg;if("scrollBehavior"in document.documentElement.style)Tg=!0;else{const e=Element.prototype.scrollTo;Tg=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return Tg}function Kf(e){return e.composedPath?e.composedPath()[0]:e.target}function lk(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Ow(e,...o){return o.length?o.some(i=>e[i]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}function _o(e,o,i){const s=qn(e)||o||i?{next:e,error:o,complete:i}:e;return s?ar((c,f)=>{var g;null===(g=s.subscribe)||void 0===g||g.call(s);let v=!0;c.subscribe(Di(f,w=>{var T;null===(T=s.next)||void 0===T||T.call(s,w),f.next(w)},()=>{var w;v=!1,null===(w=s.complete)||void 0===w||w.call(s),f.complete()},w=>{var T;v=!1,null===(T=s.error)||void 0===T||T.call(s,w),f.error(w)},()=>{var w,T;v&&(null===(w=s.unsubscribe)||void 0===w||w.call(s)),null===(T=s.finalize)||void 0===T||T.call(s)}))}):xl}class GH extends st{constructor(o,i){super()}schedule(o,i=0){return this}}const oI={setInterval(e,o,...i){const{delegate:s}=oI;return s?.setInterval?s.setInterval(e,o,...i):setInterval(e,o,...i)},clearInterval(e){const{delegate:o}=oI;return(o?.clearInterval||clearInterval)(e)},delegate:void 0};class fk extends GH{constructor(o,i){super(o,i),this.scheduler=o,this.work=i,this.pending=!1}schedule(o,i=0){var s;if(this.closed)return this;this.state=o;const c=this.id,f=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(f,c,i)),this.pending=!0,this.delay=i,this.id=null!==(s=this.id)&&void 0!==s?s:this.requestAsyncId(f,this.id,i),this}requestAsyncId(o,i,s=0){return oI.setInterval(o.flush.bind(o,this),s)}recycleAsyncId(o,i,s=0){if(null!=s&&this.delay===s&&!1===this.pending)return i;null!=i&&oI.clearInterval(i)}execute(o,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const s=this._execute(o,i);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(o,i){let c,s=!1;try{this.work(o)}catch(f){s=!0,c=f||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:o,scheduler:i}=this,{actions:s}=i;this.work=this.state=this.scheduler=null,this.pending=!1,Qt(s,this),null!=o&&(this.id=this.recycleAsyncId(i,o,null)),this.delay=null,super.unsubscribe()}}}const pk={now:()=>(pk.delegate||Date).now(),delegate:void 0};class kw{constructor(o,i=kw.now){this.schedulerActionCtor=o,this.now=i}schedule(o,i=0,s){return new this.schedulerActionCtor(this,o).schedule(s,i)}}kw.now=pk.now;class mk extends kw{constructor(o,i=kw.now){super(o,i),this.actions=[],this._active=!1}flush(o){const{actions:i}=this;if(this._active)return void i.push(o);let s;this._active=!0;do{if(s=o.execute(o.state,o.delay))break}while(o=i.shift());if(this._active=!1,s){for(;o=i.shift();)o.unsubscribe();throw s}}}const gk=new mk(fk),qH=gk;function bz(e,o=gk){return ar((i,s)=>{let c=null,f=null,g=null;const v=()=>{if(c){c.unsubscribe(),c=null;const T=f;f=null,s.next(T)}};function w(){const T=g+e,A=o.now();if(A<T)return c=this.schedule(void 0,T-A),void s.add(c);v()}i.subscribe(Di(s,T=>{f=T,g=o.now(),c||(c=o.schedule(w,e),s.add(c))},()=>{v(),s.complete()},void 0,()=>{f=c=null}))})}function wz(e){return Os((o,i)=>e<=i)}function Da(e){return ar((o,i)=>{En(e).subscribe(Di(i,()=>i.complete(),Wu)),!i.closed&&o.subscribe(i)})}function Lo(e){return null!=e&&"false"!=`${e}`}function Ez(e,o=0){return function WH(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):o}function sI(e){return Array.isArray(e)?e:[e]}function yo(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Jf(e){return e instanceof Oi?e.nativeElement:e}function aI(...e){const o=ru(e),i=lE(e),{args:s,keys:c}=l3(e);if(0===s.length)return Pr([],o);const f=new $n(function ZH(e,o,i=xl){return s=>{Cz(o,()=>{const{length:c}=e,f=new Array(c);let g=c,v=c;for(let w=0;w<c;w++)Cz(o,()=>{const T=Pr(e[w],o);let A=!1;T.subscribe(Di(s,k=>{f[w]=k,A||(A=!0,v--),v||s.next(i(f.slice()))},()=>{--g||s.complete()}))},s)},s)}}(s,o,c?g=>c3(c,g):xl));return i?f.pipe(jO(i)):f}function Cz(e,o,i){e?_s(i,e,o):o()}function lI(...e){return function XH(){return iu(1)}()(Pr(e,ru(e)))}function $c(e){return e<=0?()=>ca:ar((o,i)=>{let s=0;o.subscribe(Di(i,c=>{++s<=e&&(i.next(c),e<=s&&i.complete())}))})}function cI(...e){const o=ru(e);return ar((i,s)=>{(o?lI(e,i,o):lI(e,i)).subscribe(s)})}const Mz=new Set;let Dg,YH=(()=>{class e{constructor(i,s){this._platform=i,this._nonce=s,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):JH}matchMedia(i){return(this._platform.WEBKIT||this._platform.BLINK)&&function KH(e,o){if(!Mz.has(e))try{Dg||(Dg=document.createElement("style"),o&&(Dg.nonce=o),Dg.setAttribute("type","text/css"),document.head.appendChild(Dg)),Dg.sheet&&(Dg.sheet.insertRule(`@media ${e} {body{ }}`,0),Mz.add(e))}catch(i){console.error(i)}}(i,this._nonce),this._matchMedia(i)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(oa),bt(Zx,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function JH(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let QH=(()=>{class e{constructor(i,s){this._mediaMatcher=i,this._zone=s,this._queries=new Map,this._destroySubject=new on}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(i){return Sz(sI(i)).some(c=>this._registerQuery(c).mql.matches)}observe(i){let f=aI(Sz(sI(i)).map(g=>this._registerQuery(g).observable));return f=lI(f.pipe($c(1)),f.pipe(wz(1),bz(0))),f.pipe(dn(g=>{const v={matches:!1,breakpoints:{}};return g.forEach(({matches:w,query:T})=>{v.matches=v.matches||w,v.breakpoints[T]=w}),v}))}_registerQuery(i){if(this._queries.has(i))return this._queries.get(i);const s=this._mediaMatcher.matchMedia(i),f={observable:new $n(g=>{const v=w=>this._zone.run(()=>g.next(w));return s.addListener(v),()=>{s.removeListener(v)}}).pipe(cI(s),dn(({matches:g})=>({query:i,matches:g})),Da(this._destroySubject)),mql:s};return this._queries.set(i,f),f}static#t=this.\u0275fac=function(s){return new(s||e)(bt(YH),bt(Xe))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Sz(e){return e.map(o=>o.split(",")).reduce((o,i)=>o.concat(i)).map(o=>o.trim())}function Dz(e,o,i){const c=Iz(e,o).filter(f=>f!=i.trim());c.length?e.setAttribute(o,c.join(" ")):e.removeAttribute(o)}function Iz(e,o){return(e.getAttribute(o)||"").match(/\S+/g)||[]}class i${constructor(o){this._items=o,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new on,this._typeaheadSubscription=st.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._pageUpAndDown={enabled:!1,delta:10},this._skipPredicateFn=i=>i.disabled,this._pressedLetters=[],this.tabOut=new on,this.change=new on,o instanceof Ff&&(this._itemChangesSubscription=o.changes.subscribe(i=>{if(this._activeItem){const c=i.toArray().indexOf(this._activeItem);c>-1&&c!==this._activeItemIndex&&(this._activeItemIndex=c)}}))}skipPredicate(o){return this._skipPredicateFn=o,this}withWrap(o=!0){return this._wrap=o,this}withVerticalOrientation(o=!0){return this._vertical=o,this}withHorizontalOrientation(o){return this._horizontal=o,this}withAllowedModifierKeys(o){return this._allowedModifierKeys=o,this}withTypeAhead(o=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(_o(i=>this._pressedLetters.push(i)),bz(o),Os(()=>this._pressedLetters.length>0),dn(()=>this._pressedLetters.join(""))).subscribe(i=>{const s=this._getItemsArray();for(let c=1;c<s.length+1;c++){const f=(this._activeItemIndex+c)%s.length,g=s[f];if(!this._skipPredicateFn(g)&&0===g.getLabel().toUpperCase().trim().indexOf(i)){this.setActiveItem(f);break}}this._pressedLetters=[]}),this}cancelTypeahead(){return this._pressedLetters=[],this}withHomeAndEnd(o=!0){return this._homeAndEnd=o,this}withPageUpDown(o=!0,i=10){return this._pageUpAndDown={enabled:o,delta:i},this}setActiveItem(o){const i=this._activeItem;this.updateActiveItem(o),this._activeItem!==i&&this.change.next(this._activeItemIndex)}onKeydown(o){const i=o.keyCode,c=["altKey","ctrlKey","metaKey","shiftKey"].every(f=>!o[f]||this._allowedModifierKeys.indexOf(f)>-1);switch(i){case 9:return void this.tabOut.next();case 40:if(this._vertical&&c){this.setNextItemActive();break}return;case 38:if(this._vertical&&c){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&c){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&c){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&c){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&c){this.setLastItemActive();break}return;case 33:if(this._pageUpAndDown.enabled&&c){const f=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(f>0?f:0,1);break}return;case 34:if(this._pageUpAndDown.enabled&&c){const f=this._activeItemIndex+this._pageUpAndDown.delta,g=this._getItemsArray().length;this._setActiveItemByIndex(f<g?f:g-1,-1);break}return;default:return void((c||Ow(o,"shiftKey"))&&(o.key&&1===o.key.length?this._letterKeyStream.next(o.key.toLocaleUpperCase()):(i>=65&&i<=90||i>=48&&i<=57)&&this._letterKeyStream.next(String.fromCharCode(i))))}this._pressedLetters=[],o.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(o){const i=this._getItemsArray(),s="number"==typeof o?o:i.indexOf(o);this._activeItem=i[s]??null,this._activeItemIndex=s}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._letterKeyStream.complete(),this.tabOut.complete(),this.change.complete(),this._pressedLetters=[]}_setActiveItemByDelta(o){this._wrap?this._setActiveInWrapMode(o):this._setActiveInDefaultMode(o)}_setActiveInWrapMode(o){const i=this._getItemsArray();for(let s=1;s<=i.length;s++){const c=(this._activeItemIndex+o*s+i.length)%i.length;if(!this._skipPredicateFn(i[c]))return void this.setActiveItem(c)}}_setActiveInDefaultMode(o){this._setActiveItemByIndex(this._activeItemIndex+o,o)}_setActiveItemByIndex(o,i){const s=this._getItemsArray();if(s[o]){for(;this._skipPredicateFn(s[o]);)if(!s[o+=i])return;this.setActiveItem(o)}}_getItemsArray(){return this._items instanceof Ff?this._items.toArray():this._items}}class r$ extends i${setActiveItem(o){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(o),this.activeItem&&this.activeItem.setActiveStyles()}}function Rz(e){return 0===e.buttons||0===e.detail}function Pz(e){const o=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!o||-1!==o.identifier||null!=o.radiusX&&1!==o.radiusX||null!=o.radiusY&&1!==o.radiusY)}const u$=new $t("cdk-input-modality-detector-options"),d$={ignoreKeys:[18,17,224,91,16]},Zv=Pw({passive:!0,capture:!0});let h$=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(i,s,c,f){this._platform=i,this._mostRecentTarget=null,this._modality=new $r(null),this._lastTouchMs=0,this._onKeydown=g=>{this._options?.ignoreKeys?.some(v=>v===g.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Kf(g))},this._onMousedown=g=>{Date.now()-this._lastTouchMs<650||(this._modality.next(Rz(g)?"keyboard":"mouse"),this._mostRecentTarget=Kf(g))},this._onTouchstart=g=>{Pz(g)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Kf(g))},this._options={...d$,...f},this.modalityDetected=this._modality.pipe(wz(1)),this.modalityChanged=this.modalityDetected.pipe(Ku()),i.isBrowser&&s.runOutsideAngular(()=>{c.addEventListener("keydown",this._onKeydown,Zv),c.addEventListener("mousedown",this._onMousedown,Zv),c.addEventListener("touchstart",this._onTouchstart,Zv)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Zv),document.removeEventListener("mousedown",this._onMousedown,Zv),document.removeEventListener("touchstart",this._onTouchstart,Zv))}static#t=this.\u0275fac=function(s){return new(s||e)(bt(oa),bt(Xe),bt(Qn),bt(u$,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const f$=new $t("liveAnnouncerElement",{providedIn:"root",factory:function p$(){return null}}),m$=new $t("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let g$=0,_$=(()=>{class e{constructor(i,s,c,f){this._ngZone=s,this._defaultOptions=f,this._document=c,this._liveElement=i||this._createLiveElement()}announce(i,...s){const c=this._defaultOptions;let f,g;return 1===s.length&&"number"==typeof s[0]?g=s[0]:[f,g]=s,this.clear(),clearTimeout(this._previousTimeout),f||(f=c&&c.politeness?c.politeness:"polite"),null==g&&c&&(g=c.duration),this._liveElement.setAttribute("aria-live",f),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(v=>this._currentResolve=v)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=i,"number"==typeof g&&(this._previousTimeout=setTimeout(()=>this.clear(),g)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const i="cdk-live-announcer-element",s=this._document.getElementsByClassName(i),c=this._document.createElement("div");for(let f=0;f<s.length;f++)s[f].remove();return c.classList.add(i),c.classList.add("cdk-visually-hidden"),c.setAttribute("aria-atomic","true"),c.setAttribute("aria-live","polite"),c.id="cdk-live-announcer-"+g$++,this._document.body.appendChild(c),c}_exposeAnnouncerToModals(i){const s=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let c=0;c<s.length;c++){const f=s[c],g=f.getAttribute("aria-owns");g?-1===g.indexOf(i)&&f.setAttribute("aria-owns",g+" "+i):f.setAttribute("aria-owns",i)}}static#t=this.\u0275fac=function(s){return new(s||e)(bt(f$,8),bt(Xe),bt(Qn),bt(m$,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const y$=new $t("cdk-focus-monitor-default-options"),uI=Pw({passive:!0,capture:!0});let v$=(()=>{class e{constructor(i,s,c,f,g){this._ngZone=i,this._platform=s,this._inputModalityDetector=c,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new on,this._rootNodeFocusAndBlurListener=v=>{for(let T=Kf(v);T;T=T.parentElement)"focus"===v.type?this._onFocus(v,T):this._onBlur(v,T)},this._document=f,this._detectionMode=g?.detectionMode||0}monitor(i,s=!1){const c=Jf(i);if(!this._platform.isBrowser||1!==c.nodeType)return kt();const f=function AH(e){if(function IH(){if(null==ak){const e=typeof document<"u"?document.head:null;ak=!(!e||!e.createShadowRoot&&!e.attachShadow)}return ak}()){const o=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&o instanceof ShadowRoot)return o}return null}(c)||this._getDocument(),g=this._elementInfo.get(c);if(g)return s&&(g.checkChildren=!0),g.subject;const v={checkChildren:s,subject:new on,rootNode:f};return this._elementInfo.set(c,v),this._registerGlobalListeners(v),v.subject}stopMonitoring(i){const s=Jf(i),c=this._elementInfo.get(s);c&&(c.subject.complete(),this._setClasses(s),this._elementInfo.delete(s),this._removeGlobalListeners(c))}focusVia(i,s,c){const f=Jf(i);f===this._getDocument().activeElement?this._getClosestElementsInfo(f).forEach(([v,w])=>this._originChanged(v,s,w)):(this._setOrigin(s),"function"==typeof f.focus&&f.focus(c))}ngOnDestroy(){this._elementInfo.forEach((i,s)=>this.stopMonitoring(s))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(i){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(i)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:i&&this._isLastInteractionFromInputLabel(i)?"mouse":"program"}_shouldBeAttributedToTouch(i){return 1===this._detectionMode||!!i?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(i,s){i.classList.toggle("cdk-focused",!!s),i.classList.toggle("cdk-touch-focused","touch"===s),i.classList.toggle("cdk-keyboard-focused","keyboard"===s),i.classList.toggle("cdk-mouse-focused","mouse"===s),i.classList.toggle("cdk-program-focused","program"===s)}_setOrigin(i,s=!1){this._ngZone.runOutsideAngular(()=>{this._origin=i,this._originFromTouchInteraction="touch"===i&&s,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(i,s){const c=this._elementInfo.get(s),f=Kf(i);!c||!c.checkChildren&&s!==f||this._originChanged(s,this._getFocusOrigin(f),c)}_onBlur(i,s){const c=this._elementInfo.get(s);!c||c.checkChildren&&i.relatedTarget instanceof Node&&s.contains(i.relatedTarget)||(this._setClasses(s),this._emitOrigin(c,null))}_emitOrigin(i,s){i.subject.observers.length&&this._ngZone.run(()=>i.subject.next(s))}_registerGlobalListeners(i){if(!this._platform.isBrowser)return;const s=i.rootNode,c=this._rootNodeFocusListenerCount.get(s)||0;c||this._ngZone.runOutsideAngular(()=>{s.addEventListener("focus",this._rootNodeFocusAndBlurListener,uI),s.addEventListener("blur",this._rootNodeFocusAndBlurListener,uI)}),this._rootNodeFocusListenerCount.set(s,c+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Da(this._stopInputModalityDetector)).subscribe(f=>{this._setOrigin(f,!0)}))}_removeGlobalListeners(i){const s=i.rootNode;if(this._rootNodeFocusListenerCount.has(s)){const c=this._rootNodeFocusListenerCount.get(s);c>1?this._rootNodeFocusListenerCount.set(s,c-1):(s.removeEventListener("focus",this._rootNodeFocusAndBlurListener,uI),s.removeEventListener("blur",this._rootNodeFocusAndBlurListener,uI),this._rootNodeFocusListenerCount.delete(s))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(i,s,c){this._setClasses(i,s),this._emitOrigin(c,s),this._lastFocusOrigin=s}_getClosestElementsInfo(i){const s=[];return this._elementInfo.forEach((c,f)=>{(f===i||c.checkChildren&&f.contains(i))&&s.push([f,c])}),s}_isLastInteractionFromInputLabel(i){const{_mostRecentTarget:s,mostRecentModality:c}=this._inputModalityDetector;if("mouse"!==c||!s||s===i||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName||i.disabled)return!1;const f=i.labels;if(f)for(let g=0;g<f.length;g++)if(f[g].contains(s))return!0;return!1}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Xe),bt(oa),bt(h$),bt(Qn,8),bt(y$,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const kz="cdk-high-contrast-black-on-white",Fz="cdk-high-contrast-white-on-black",_k="cdk-high-contrast-active";let x$=(()=>{class e{constructor(i,s){this._platform=i,this._document=s,this._breakpointSubscription=ne(QH).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const i=this._document.createElement("div");i.style.backgroundColor="rgb(1,2,3)",i.style.position="absolute",this._document.body.appendChild(i);const s=this._document.defaultView||window,c=s&&s.getComputedStyle?s.getComputedStyle(i):null,f=(c&&c.backgroundColor||"").replace(/ /g,"");switch(i.remove(),f){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const i=this._document.body.classList;i.remove(_k,kz,Fz),this._hasCheckedHighContrastMode=!0;const s=this.getHighContrastMode();1===s?i.add(_k,kz):2===s&&i.add(_k,Fz)}}static#t=this.\u0275fac=function(s){return new(s||e)(bt(oa),bt(Qn))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const b$=new $t("cdk-dir-doc",{providedIn:"root",factory:function w$(){return ne(Qn)}}),E$=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let dI=(()=>{class e{constructor(i){this.value="ltr",this.change=new oi,i&&(this.value=function C$(e){const o=e?.toLowerCase()||"";return"auto"===o&&typeof navigator<"u"&&navigator?.language?E$.test(navigator.language)?"rtl":"ltr":"rtl"===o?"rtl":"ltr"}((i.body?i.body.dir:null)||(i.documentElement?i.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#t=this.\u0275fac=function(s){return new(s||e)(bt(b$,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Fw=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({})}return e})();const M$=["text"];function S$(e,o){if(1&e&&oo(0,"mat-pseudo-checkbox",6),2&e){const i=so();Cn("disabled",i.disabled)("state",i.selected?"checked":"unchecked")}}function T$(e,o){1&e&&oo(0,"mat-pseudo-checkbox",7),2&e&&Cn("disabled",so().disabled)}function D$(e,o){if(1&e&&(un(0,"span",8),us(1),mn()),2&e){const i=so();pn(1),Xm("(",i.group.label,")")}}const I$=[[["mat-icon"]],"*"],A$=["mat-icon","*"],P$=new $t("mat-sanity-checks",{providedIn:"root",factory:function R$(){return!0}});let Ia=(()=>{class e{constructor(i,s,c){this._sanityChecks=s,this._document=c,this._hasDoneGlobalChecks=!1,i._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(i){return!lk()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[i])}static#t=this.\u0275fac=function(s){return new(s||e)(bt(x$),bt(P$,8),bt(Qn))};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Fw,Fw]})}return e})();function zz(e){return class extends e{get disabled(){return this._disabled}set disabled(o){this._disabled=Lo(o)}constructor(...o){super(...o),this._disabled=!1}}}function Bz(e,o){return class extends e{get color(){return this._color}set color(i){const s=i||this.defaultColor;s!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),s&&this._elementRef.nativeElement.classList.add(`mat-${s}`),this._color=s)}constructor(...i){super(...i),this.defaultColor=o,this.color=o}}}function Vz(e){return class extends e{get disableRipple(){return this._disableRipple}set disableRipple(o){this._disableRipple=Lo(o)}constructor(...o){super(...o),this._disableRipple=!1}}}function O$(e,o=0){return class extends e{get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(i){this._tabIndex=null!=i?Ez(i):this.defaultTabIndex}constructor(...i){super(...i),this._tabIndex=o,this.defaultTabIndex=o}}}function jz(e){return class extends e{updateErrorState(){const o=this.errorState,f=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);f!==o&&(this.errorState=f,this.stateChanges.next())}constructor(...o){super(...o),this.errorState=!1}}}let Uz=(()=>{class e{isErrorState(i,s){return!!(i&&i.invalid&&(i.touched||s&&s.submitted))}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class F${constructor(o,i,s,c=!1){this._renderer=o,this.element=i,this.config=s,this._animationForciblyDisabledThroughCss=c,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const Hz=Pw({passive:!0,capture:!0});class L${constructor(){this._events=new Map,this._delegateEventHandler=o=>{const i=Kf(o);i&&this._events.get(o.type)?.forEach((s,c)=>{(c===i||c.contains(i))&&s.forEach(f=>f.handleEvent(o))})}}addHandler(o,i,s,c){const f=this._events.get(i);if(f){const g=f.get(s);g?g.add(c):f.set(s,new Set([c]))}else this._events.set(i,new Map([[s,new Set([c])]])),o.runOutsideAngular(()=>{document.addEventListener(i,this._delegateEventHandler,Hz)})}removeHandler(o,i,s){const c=this._events.get(o);if(!c)return;const f=c.get(i);f&&(f.delete(s),0===f.size&&c.delete(i),0===c.size&&(this._events.delete(o),document.removeEventListener(o,this._delegateEventHandler,Hz)))}}const $z={enterDuration:225,exitDuration:150},Gz=Pw({passive:!0,capture:!0}),qz=["mousedown","touchstart"],Wz=["mouseup","mouseleave","touchend","touchcancel"];class hI{static#t=this._eventManager=new L$;constructor(o,i,s,c){this._target=o,this._ngZone=i,this._platform=c,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,c.isBrowser&&(this._containerElement=Jf(s))}fadeInRipple(o,i,s={}){const c=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),f={...$z,...s.animation};s.centered&&(o=c.left+c.width/2,i=c.top+c.height/2);const g=s.radius||function z$(e,o,i){const s=Math.max(Math.abs(e-i.left),Math.abs(e-i.right)),c=Math.max(Math.abs(o-i.top),Math.abs(o-i.bottom));return Math.sqrt(s*s+c*c)}(o,i,c),v=o-c.left,w=i-c.top,T=f.enterDuration,A=document.createElement("div");A.classList.add("mat-ripple-element"),A.style.left=v-g+"px",A.style.top=w-g+"px",A.style.height=2*g+"px",A.style.width=2*g+"px",null!=s.color&&(A.style.backgroundColor=s.color),A.style.transitionDuration=`${T}ms`,this._containerElement.appendChild(A);const k=window.getComputedStyle(A),$=k.transitionDuration,K="none"===k.transitionProperty||"0s"===$||"0s, 0s"===$||0===c.width&&0===c.height,Q=new F$(this,A,s,K);A.style.transform="scale3d(1, 1, 1)",Q.state=0,s.persistent||(this._mostRecentTransientRipple=Q);let ut=null;return!K&&(T||f.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const yt=()=>this._finishRippleTransition(Q),pt=()=>this._destroyRipple(Q);A.addEventListener("transitionend",yt),A.addEventListener("transitioncancel",pt),ut={onTransitionEnd:yt,onTransitionCancel:pt}}),this._activeRipples.set(Q,ut),(K||!T)&&this._finishRippleTransition(Q),Q}fadeOutRipple(o){if(2===o.state||3===o.state)return;const i=o.element,s={...$z,...o.config.animation};i.style.transitionDuration=`${s.exitDuration}ms`,i.style.opacity="0",o.state=2,(o._animationForciblyDisabledThroughCss||!s.exitDuration)&&this._finishRippleTransition(o)}fadeOutAll(){this._getActiveRipples().forEach(o=>o.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(o=>{o.config.persistent||o.fadeOut()})}setupTriggerEvents(o){const i=Jf(o);!this._platform.isBrowser||!i||i===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=i,qz.forEach(s=>{hI._eventManager.addHandler(this._ngZone,s,i,this)}))}handleEvent(o){"mousedown"===o.type?this._onMousedown(o):"touchstart"===o.type?this._onTouchStart(o):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Wz.forEach(i=>{this._triggerElement.addEventListener(i,this,Gz)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(o){0===o.state?this._startFadeOutTransition(o):2===o.state&&this._destroyRipple(o)}_startFadeOutTransition(o){const i=o===this._mostRecentTransientRipple,{persistent:s}=o.config;o.state=1,!s&&(!i||!this._isPointerDown)&&o.fadeOut()}_destroyRipple(o){const i=this._activeRipples.get(o)??null;this._activeRipples.delete(o),this._activeRipples.size||(this._containerRect=null),o===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),o.state=3,null!==i&&(o.element.removeEventListener("transitionend",i.onTransitionEnd),o.element.removeEventListener("transitioncancel",i.onTransitionCancel)),o.element.remove()}_onMousedown(o){const i=Rz(o),s=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!i&&!s&&(this._isPointerDown=!0,this.fadeInRipple(o.clientX,o.clientY,this._target.rippleConfig))}_onTouchStart(o){if(!this._target.rippleDisabled&&!Pz(o)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const i=o.changedTouches;if(i)for(let s=0;s<i.length;s++)this.fadeInRipple(i[s].clientX,i[s].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(o=>{!o.config.persistent&&(1===o.state||o.config.terminateOnPointerUp&&0===o.state)&&o.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const o=this._triggerElement;o&&(qz.forEach(i=>hI._eventManager.removeHandler(i,o,this)),this._pointerUpEventsRegistered&&Wz.forEach(i=>o.removeEventListener(i,this,Gz)))}}const Zz=new $t("mat-ripple-global-options");let Xz=(()=>{class e{get disabled(){return this._disabled}set disabled(i){i&&this.fadeOutAllNonPersistent(),this._disabled=i,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(i){this._trigger=i,this._setupTriggerEventsIfEnabled()}constructor(i,s,c,f,g){this._elementRef=i,this._animationMode=g,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=f||{},this._rippleRenderer=new hI(this,s,i,c)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(i,s=0,c){return"number"==typeof i?this._rippleRenderer.fadeInRipple(i,s,{...this.rippleConfig,...c}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...i})}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi),_t(Xe),_t(oa),_t(Zz,8),_t(xu,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(s,c){2&s&&Ir("mat-ripple-unbounded",c.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]})}return e})(),Yz=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Ia,Ia]})}return e})(),B$=(()=>{class e{constructor(i){this._animationMode=i,this.state="unchecked",this.disabled=!1,this.appearance="full"}static#t=this.\u0275fac=function(s){return new(s||e)(_t(xu,8))};static#e=this.\u0275cmp=os({type:e,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:12,hostBindings:function(s,c){2&s&&Ir("mat-pseudo-checkbox-indeterminate","indeterminate"===c.state)("mat-pseudo-checkbox-checked","checked"===c.state)("mat-pseudo-checkbox-disabled",c.disabled)("mat-pseudo-checkbox-minimal","minimal"===c.appearance)("mat-pseudo-checkbox-full","full"===c.appearance)("_mat-animation-noopable","NoopAnimations"===c._animationMode)},inputs:{state:"state",disabled:"disabled",appearance:"appearance"},decls:0,vars:0,template:function(s,c){},styles:['.mat-pseudo-checkbox{border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox._mat-animation-noopable{transition:none !important;animation:none !important}.mat-pseudo-checkbox._mat-animation-noopable::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{left:1px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{left:1px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}.mat-pseudo-checkbox-full{border:2px solid}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate{border-color:rgba(0,0,0,0)}.mat-pseudo-checkbox{width:18px;height:18px}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after{width:14px;height:6px;transform-origin:center;top:-4.2426406871px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{top:8px;width:16px}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after{width:10px;height:4px;transform-origin:center;top:-2.8284271247px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{top:6px;width:12px}'],encapsulation:2,changeDetection:0})}return e})(),V$=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Ia]})}return e})();const Kz=new $t("MAT_OPTION_PARENT_COMPONENT"),Jz=new $t("MatOptgroup");let j$=0;class U${constructor(o,i=!1){this.source=o,this.isUserInput=i}}let H$=(()=>{class e{get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(i){this._disabled=Lo(i)}get disableRipple(){return!(!this._parent||!this._parent.disableRipple)}get hideSingleSelectionIndicator(){return!(!this._parent||!this._parent.hideSingleSelectionIndicator)}constructor(i,s,c,f){this._element=i,this._changeDetectorRef=s,this._parent=c,this.group=f,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this.id="mat-option-"+j$++,this.onSelectionChange=new oi,this._stateChanges=new on}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(i=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),i&&this._emitSelectionChangeEvent())}deselect(i=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),i&&this._emitSelectionChangeEvent())}focus(i,s){const c=this._getHostElement();"function"==typeof c.focus&&c.focus(s)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(i){(13===i.keyCode||32===i.keyCode)&&!Ow(i)&&(this._selectViaInteraction(),i.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this._selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const i=this.viewValue;i!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=i)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(i=!1){this.onSelectionChange.emit(new U$(this,i))}static#t=this.\u0275fac=function(s){ti()};static#e=this.\u0275dir=Ee({type:e,viewQuery:function(s,c){if(1&s&&Ta(M$,7),2&s){let f;br(f=rr())&&(c._text=f.first)}},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"}})}return e})(),Qz=(()=>{class e extends H${constructor(i,s,c,f){super(i,s,c,f)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi),_t(Le),_t(Kz,8),_t(Jz,8))};static#e=this.\u0275cmp=os({type:e,selectors:[["mat-option"]],hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(s,c){1&s&&cr("click",function(){return c._selectViaInteraction()})("keydown",function(g){return c._handleKeydown(g)}),2&s&&(Df("id",c.id),ro("aria-selected",c.selected)("aria-disabled",c.disabled.toString()),Ir("mdc-list-item--selected",c.selected)("mat-mdc-option-multiple",c.multiple)("mat-mdc-option-active",c.active)("mdc-list-item--disabled",c.disabled))},exportAs:["matOption"],features:[jn],ngContentSelectors:A$,decls:8,vars:5,consts:[["class","mat-mdc-option-pseudo-checkbox","aria-hidden","true",3,"disabled","state",4,"ngIf"],[1,"mdc-list-item__primary-text"],["text",""],["class","mat-mdc-option-pseudo-checkbox","state","checked","aria-hidden","true","appearance","minimal",3,"disabled",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled"],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"]],template:function(s,c){1&s&&(Fc(I$),Ji(0,S$,1,2,"mat-pseudo-checkbox",0),jr(1),un(2,"span",1,2),jr(4,1),mn(),Ji(5,T$,1,1,"mat-pseudo-checkbox",3),Ji(6,D$,2,1,"span",4),oo(7,"div",5)),2&s&&(Cn("ngIf",c.multiple),pn(5),Cn("ngIf",!c.multiple&&c.selected&&!c.hideSingleSelectionIndicator),pn(1),Cn("ngIf",c.group&&c.group._inert),pn(1),Cn("matRippleTrigger",c._getHostElement())("matRippleDisabled",c.disabled||c.disableRipple))},dependencies:[Xz,ZP,B$],styles:['.mat-mdc-option{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;padding-left:16px;padding-right:16px;-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color);font-family:var(--mat-option-label-text-font);line-height:var(--mat-option-label-text-line-height);font-size:var(--mat-option-label-text-size);letter-spacing:var(--mat-option-label-text-tracking);font-weight:var(--mat-option-label-text-weight);min-height:48px}.mat-mdc-option:focus{outline:none}[dir=rtl] .mat-mdc-option,.mat-mdc-option[dir=rtl]{padding-left:16px;padding-right:16px}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color)}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color)}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color)}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-multiple){background-color:var(--mat-option-selected-state-layer-color)}.mat-mdc-option.mdc-list-item{align-items:center}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}.cdk-high-contrast-active .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple)::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .cdk-high-contrast-active .mat-mdc-option.mdc-list-item--selected:not(.mat-mdc-option-multiple)::after{right:auto;left:16px}.mat-mdc-option-active .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0})}return e})(),tB=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Yz,ED,Ia,V$]})}return e})();const eB={capture:!0},nB=["focus","click","mouseenter","touchstart"],yk="mat-ripple-loader-uninitialized",vk="mat-ripple-loader-class-name",iB="mat-ripple-loader-centered",fI="mat-ripple-loader-disabled";let q$=(()=>{class e{constructor(){this._document=ne(Qn,{optional:!0}),this._animationMode=ne(xu,{optional:!0}),this._globalRippleOptions=ne(Zz,{optional:!0}),this._platform=ne(oa),this._ngZone=ne(Xe),this._onInteraction=i=>{if(!(i.target instanceof HTMLElement))return;const c=i.target.closest(`[${yk}]`);c&&this.createRipple(c)},this._ngZone.runOutsideAngular(()=>{for(const i of nB)this._document?.addEventListener(i,this._onInteraction,eB)})}ngOnDestroy(){for(const i of nB)this._document?.removeEventListener(i,this._onInteraction,eB)}configureRipple(i,s){i.setAttribute(yk,""),(s.className||!i.hasAttribute(vk))&&i.setAttribute(vk,s.className||""),s.centered&&i.setAttribute(iB,""),s.disabled&&i.setAttribute(fI,"")}getRipple(i){return i.matRipple?i.matRipple:this.createRipple(i)}setDisabled(i,s){const c=i.matRipple;c?c.disabled=s:s?i.setAttribute(fI,""):i.removeAttribute(fI)}createRipple(i){if(!this._document)return;i.querySelector(".mat-ripple")?.remove();const s=this._document.createElement("span");s.classList.add("mat-ripple",i.getAttribute(vk)),i.append(s);const c=new Xz(new Oi(s),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return c._isInitialized=!0,c.trigger=i,c.centered=i.hasAttribute(iB),c.disabled=i.hasAttribute(fI),this.attachRipple(i,c),c}attachRipple(i,s){i.removeAttribute(yk),i.matRipple=s}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const W$=["mat-button",""],Z$=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],X$=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],Y$=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],K$=Bz(zz(Vz(class{constructor(e){this._elementRef=e}})));let J$=(()=>{class e extends K${get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(i){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,i)}get disableRipple(){return this._disableRipple}set disableRipple(i){this._disableRipple=Lo(i),this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(i){this._disabled=Lo(i),this._updateRippleDisabled()}constructor(i,s,c,f){super(i),this._platform=s,this._ngZone=c,this._animationMode=f,this._focusMonitor=ne(v$),this._rippleLoader=ne(q$),this._isFab=!1,this._disableRipple=!1,this._disabled=!1,this._rippleLoader?.configureRipple(this._elementRef.nativeElement,{className:"mat-mdc-button-ripple"});const g=i.nativeElement.classList;for(const v of Y$)this._hasHostAttributes(v.selector)&&v.mdcClasses.forEach(w=>{g.add(w)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(i="program",s){i?this._focusMonitor.focusVia(this._elementRef.nativeElement,i,s):this._elementRef.nativeElement.focus(s)}_hasHostAttributes(...i){return i.some(s=>this._elementRef.nativeElement.hasAttribute(s))}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static#t=this.\u0275fac=function(s){ti()};static#e=this.\u0275dir=Ee({type:e,features:[jn]})}return e})(),rB=(()=>{class e extends J${constructor(i,s,c,f){super(i,s,c,f)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi),_t(oa),_t(Xe),_t(xu,8))};static#e=this.\u0275cmp=os({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:7,hostBindings:function(s,c){2&s&&(ro("disabled",c.disabled||null),Ir("_mat-animation-noopable","NoopAnimations"===c._animationMode)("mat-unthemed",!c.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[jn],attrs:W$,ngContentSelectors:X$,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,c){1&s&&(Fc(Z$),oo(0,"span",0),jr(1),un(2,"span",1),jr(3,1),mn(),jr(4,2),oo(5,"span",2)(6,"span",3)),2&s&&Ir("mdc-button__ripple",!c._isFab)("mdc-fab__ripple",c._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}return e})(),eG=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Ia,Yz,Ia]})}return e})();function Xv(e,o){const i=qn(e)?e:()=>e,s=c=>c.error(i());return new $n(o?c=>o.schedule(s,0,c):s)}function Qf(e){return ar((o,i)=>{let f,s=null,c=!1;s=o.subscribe(Di(i,void 0,void 0,g=>{f=En(e(g,Qf(e)(o))),s?(s.unsubscribe(),s=null,f.subscribe(i)):c=!0})),c&&(s.unsubscribe(),s=null,f.subscribe(i))})}const nG=["*"];let pI;function Nw(e){return function iG(){if(void 0===pI&&(pI=null,typeof window<"u")){const e=window;void 0!==e.trustedTypes&&(pI=e.trustedTypes.createPolicy("angular#components",{createHTML:o=>o}))}return pI}()?.createHTML(e)||e}function oB(e){return Error(`Unable to find icon with the name "${e}"`)}function sB(e){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${e}".`)}function aB(e){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${e}".`)}class Ig{constructor(o,i,s){this.url=o,this.svgText=i,this.options=s}}let mI=(()=>{class e{constructor(i,s,c,f){this._httpClient=i,this._sanitizer=s,this._errorHandler=f,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=c}addSvgIcon(i,s,c){return this.addSvgIconInNamespace("",i,s,c)}addSvgIconLiteral(i,s,c){return this.addSvgIconLiteralInNamespace("",i,s,c)}addSvgIconInNamespace(i,s,c,f){return this._addSvgIconConfig(i,s,new Ig(c,null,f))}addSvgIconResolver(i){return this._resolvers.push(i),this}addSvgIconLiteralInNamespace(i,s,c,f){const g=this._sanitizer.sanitize(io.HTML,c);if(!g)throw aB(c);const v=Nw(g);return this._addSvgIconConfig(i,s,new Ig("",v,f))}addSvgIconSet(i,s){return this.addSvgIconSetInNamespace("",i,s)}addSvgIconSetLiteral(i,s){return this.addSvgIconSetLiteralInNamespace("",i,s)}addSvgIconSetInNamespace(i,s,c){return this._addSvgIconSetConfig(i,new Ig(s,null,c))}addSvgIconSetLiteralInNamespace(i,s,c){const f=this._sanitizer.sanitize(io.HTML,s);if(!f)throw aB(s);const g=Nw(f);return this._addSvgIconSetConfig(i,new Ig("",g,c))}registerFontClassAlias(i,s=i){return this._fontCssClassesByAlias.set(i,s),this}classNameForFontAlias(i){return this._fontCssClassesByAlias.get(i)||i}setDefaultFontSetClass(...i){return this._defaultFontSetClass=i,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(i){const s=this._sanitizer.sanitize(io.RESOURCE_URL,i);if(!s)throw sB(i);const c=this._cachedIconsByUrl.get(s);return c?kt(gI(c)):this._loadSvgIconFromConfig(new Ig(i,null)).pipe(_o(f=>this._cachedIconsByUrl.set(s,f)),dn(f=>gI(f)))}getNamedSvgIcon(i,s=""){const c=lB(s,i);let f=this._svgIconConfigs.get(c);if(f)return this._getSvgFromConfig(f);if(f=this._getIconConfigFromResolvers(s,i),f)return this._svgIconConfigs.set(c,f),this._getSvgFromConfig(f);const g=this._iconSetConfigs.get(s);return g?this._getSvgFromIconSetConfigs(i,g):Xv(oB(c))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(i){return i.svgText?kt(gI(this._svgElementFromConfig(i))):this._loadSvgIconFromConfig(i).pipe(dn(s=>gI(s)))}_getSvgFromIconSetConfigs(i,s){const c=this._extractIconWithNameFromAnySet(i,s);return c?kt(c):u3(s.filter(g=>!g.svgText).map(g=>this._loadSvgIconSetFromConfig(g).pipe(Qf(v=>{const T=`Loading icon set URL: ${this._sanitizer.sanitize(io.RESOURCE_URL,g.url)} failed: ${v.message}`;return this._errorHandler.handleError(new Error(T)),kt(null)})))).pipe(dn(()=>{const g=this._extractIconWithNameFromAnySet(i,s);if(!g)throw oB(i);return g}))}_extractIconWithNameFromAnySet(i,s){for(let c=s.length-1;c>=0;c--){const f=s[c];if(f.svgText&&f.svgText.toString().indexOf(i)>-1){const g=this._svgElementFromConfig(f),v=this._extractSvgIconFromSet(g,i,f.options);if(v)return v}}return null}_loadSvgIconFromConfig(i){return this._fetchIcon(i).pipe(_o(s=>i.svgText=s),dn(()=>this._svgElementFromConfig(i)))}_loadSvgIconSetFromConfig(i){return i.svgText?kt(null):this._fetchIcon(i).pipe(_o(s=>i.svgText=s))}_extractSvgIconFromSet(i,s,c){const f=i.querySelector(`[id="${s}"]`);if(!f)return null;const g=f.cloneNode(!0);if(g.removeAttribute("id"),"svg"===g.nodeName.toLowerCase())return this._setSvgAttributes(g,c);if("symbol"===g.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(g),c);const v=this._svgElementFromString(Nw("<svg></svg>"));return v.appendChild(g),this._setSvgAttributes(v,c)}_svgElementFromString(i){const s=this._document.createElement("DIV");s.innerHTML=i;const c=s.querySelector("svg");if(!c)throw Error("<svg> tag not found");return c}_toSvgElement(i){const s=this._svgElementFromString(Nw("<svg></svg>")),c=i.attributes;for(let f=0;f<c.length;f++){const{name:g,value:v}=c[f];"id"!==g&&s.setAttribute(g,v)}for(let f=0;f<i.childNodes.length;f++)i.childNodes[f].nodeType===this._document.ELEMENT_NODE&&s.appendChild(i.childNodes[f].cloneNode(!0));return s}_setSvgAttributes(i,s){return i.setAttribute("fit",""),i.setAttribute("height","100%"),i.setAttribute("width","100%"),i.setAttribute("preserveAspectRatio","xMidYMid meet"),i.setAttribute("focusable","false"),s&&s.viewBox&&i.setAttribute("viewBox",s.viewBox),i}_fetchIcon(i){const{url:s,options:c}=i,f=c?.withCredentials??!1;if(!this._httpClient)throw function rG(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==s)throw Error(`Cannot fetch icon from URL "${s}".`);const g=this._sanitizer.sanitize(io.RESOURCE_URL,s);if(!g)throw sB(s);const v=this._inProgressUrlFetches.get(g);if(v)return v;const w=this._httpClient.get(g,{responseType:"text",withCredentials:f}).pipe(dn(T=>Nw(T)),Uv(()=>this._inProgressUrlFetches.delete(g)),zn());return this._inProgressUrlFetches.set(g,w),w}_addSvgIconConfig(i,s,c){return this._svgIconConfigs.set(lB(i,s),c),this}_addSvgIconSetConfig(i,s){const c=this._iconSetConfigs.get(i);return c?c.push(s):this._iconSetConfigs.set(i,[s]),this}_svgElementFromConfig(i){if(!i.svgElement){const s=this._svgElementFromString(i.svgText);this._setSvgAttributes(s,i.options),i.svgElement=s}return i.svgElement}_getIconConfigFromResolvers(i,s){for(let c=0;c<this._resolvers.length;c++){const f=this._resolvers[c](s,i);if(f)return sG(f)?new Ig(f.url,null,f.options):new Ig(f,null)}}static#t=this.\u0275fac=function(s){return new(s||e)(bt(GD,8),bt(uO),bt(Qn,8),bt(wa))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function gI(e){return e.cloneNode(!0)}function lB(e,o){return e+":"+o}function sG(e){return!(!e.url||!e.options)}const aG=Bz(class{constructor(e){this._elementRef=e}}),lG=new $t("MAT_ICON_DEFAULT_OPTIONS"),cG=new $t("mat-icon-location",{providedIn:"root",factory:function uG(){const e=ne(Qn),o=e?e.location:null;return{getPathname:()=>o?o.pathname+o.search:""}}}),cB=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],dG=cB.map(e=>`[${e}]`).join(", "),hG=/^url\(['"]?#(.*?)['"]?\)$/;let fG=(()=>{class e extends aG{get inline(){return this._inline}set inline(i){this._inline=Lo(i)}get svgIcon(){return this._svgIcon}set svgIcon(i){i!==this._svgIcon&&(i?this._updateSvgIcon(i):this._svgIcon&&this._clearSvgElement(),this._svgIcon=i)}get fontSet(){return this._fontSet}set fontSet(i){const s=this._cleanupFontValue(i);s!==this._fontSet&&(this._fontSet=s,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(i){const s=this._cleanupFontValue(i);s!==this._fontIcon&&(this._fontIcon=s,this._updateFontIconClasses())}constructor(i,s,c,f,g,v){super(i),this._iconRegistry=s,this._location=f,this._errorHandler=g,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=st.EMPTY,v&&(v.color&&(this.color=this.defaultColor=v.color),v.fontSet&&(this.fontSet=v.fontSet)),c||i.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(i){if(!i)return["",""];const s=i.split(":");switch(s.length){case 1:return["",s[0]];case 2:return s;default:throw Error(`Invalid icon name: "${i}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const i=this._elementsWithExternalReferences;if(i&&i.size){const s=this._location.getPathname();s!==this._previousPath&&(this._previousPath=s,this._prependPathToReferences(s))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(i){this._clearSvgElement();const s=this._location.getPathname();this._previousPath=s,this._cacheChildrenWithExternalReferences(i),this._prependPathToReferences(s),this._elementRef.nativeElement.appendChild(i)}_clearSvgElement(){const i=this._elementRef.nativeElement;let s=i.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();s--;){const c=i.childNodes[s];(1!==c.nodeType||"svg"===c.nodeName.toLowerCase())&&c.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const i=this._elementRef.nativeElement,s=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(c=>c.length>0);this._previousFontSetClass.forEach(c=>i.classList.remove(c)),s.forEach(c=>i.classList.add(c)),this._previousFontSetClass=s,this.fontIcon!==this._previousFontIconClass&&!s.includes("mat-ligature-font")&&(this._previousFontIconClass&&i.classList.remove(this._previousFontIconClass),this.fontIcon&&i.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(i){return"string"==typeof i?i.trim().split(" ")[0]:i}_prependPathToReferences(i){const s=this._elementsWithExternalReferences;s&&s.forEach((c,f)=>{c.forEach(g=>{f.setAttribute(g.name,`url('${i}#${g.value}')`)})})}_cacheChildrenWithExternalReferences(i){const s=i.querySelectorAll(dG),c=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let f=0;f<s.length;f++)cB.forEach(g=>{const v=s[f],w=v.getAttribute(g),T=w?w.match(hG):null;if(T){let A=c.get(v);A||(A=[],c.set(v,A)),A.push({name:g,value:T[1]})}})}_updateSvgIcon(i){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),i){const[s,c]=this._splitIconName(i);s&&(this._svgNamespace=s),c&&(this._svgName=c),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(c,s).pipe($c(1)).subscribe(f=>this._setSvgElement(f),f=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${s}:${c}! ${f.message}`))})}}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi),_t(mI),fd("aria-hidden"),_t(cG),_t(wa),_t(lG,8))};static#e=this.\u0275cmp=os({type:e,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:8,hostBindings:function(s,c){2&s&&(ro("data-mat-icon-type",c._usingFontIcon()?"font":"svg")("data-mat-icon-name",c._svgName||c.fontIcon)("data-mat-icon-namespace",c._svgNamespace||c.fontSet)("fontIcon",c._usingFontIcon()?c.fontIcon:null),Ir("mat-icon-inline",c.inline)("mat-icon-no-color","primary"!==c.color&&"accent"!==c.color&&"warn"!==c.color))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[jn],ngContentSelectors:nG,decls:1,vars:0,template:function(s,c){1&s&&(Fc(),jr(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}return e})(),pG=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Ia,Ia]})}return e})();const mG=["addListener","removeListener"],gG=["addEventListener","removeEventListener"],_G=["on","off"];function xk(e,o,i,s){if(qn(i)&&(s=i,i=void 0),s)return xk(e,o,i).pipe(jO(s));const[c,f]=function xG(e){return qn(e.addEventListener)&&qn(e.removeEventListener)}(e)?gG.map(g=>v=>e[g](o,v,i)):function yG(e){return qn(e.addListener)&&qn(e.removeListener)}(e)?mG.map(uB(e,o)):function vG(e){return qn(e.on)&&qn(e.off)}(e)?_G.map(uB(e,o)):[];if(!c&&At(e))return mr(g=>xk(g,o,i))(En(e));if(!c)throw new TypeError("Invalid event target");return new $n(g=>{const v=(...w)=>g.next(1<w.length?w:w[0]);return c(v),()=>f(v)})}function uB(e,o){return i=>s=>e[i](o,s)}const zw={schedule(e){let o=requestAnimationFrame,i=cancelAnimationFrame;const{delegate:s}=zw;s&&(o=s.requestAnimationFrame,i=s.cancelAnimationFrame);const c=o(f=>{i=void 0,e(f)});return new st(()=>i?.(c))},requestAnimationFrame(...e){const{delegate:o}=zw;return(o?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:o}=zw;return(o?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class wG extends mk{flush(o){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:s}=this;let c;o=o||s.shift();do{if(c=o.execute(o.state,o.delay))break}while((o=s[0])&&o.id===i&&s.shift());if(this._active=!1,c){for(;(o=s[0])&&o.id===i&&s.shift();)o.unsubscribe();throw c}}}(class bG extends fk{constructor(o,i){super(o,i),this.scheduler=o,this.work=i}requestAsyncId(o,i,s=0){return null!==s&&s>0?super.requestAsyncId(o,i,s):(o.actions.push(this),o._scheduled||(o._scheduled=zw.requestAnimationFrame(()=>o.flush(void 0))))}recycleAsyncId(o,i,s=0){var c;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(o,i,s);const{actions:f}=o;null!=i&&(null===(c=f[f.length-1])||void 0===c?void 0:c.id)!==i&&(zw.cancelAnimationFrame(i),o._scheduled=void 0)}});let bk,CG=1;const _I={};function dB(e){return e in _I&&(delete _I[e],!0)}const MG={setImmediate(e){const o=CG++;return _I[o]=!0,bk||(bk=Promise.resolve()),bk.then(()=>dB(o)&&e()),o},clearImmediate(e){dB(e)}},{setImmediate:SG,clearImmediate:TG}=MG,yI={setImmediate(...e){const{delegate:o}=yI;return(o?.setImmediate||SG)(...e)},clearImmediate(e){const{delegate:o}=yI;return(o?.clearImmediate||TG)(e)},delegate:void 0};new class IG extends mk{flush(o){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:s}=this;let c;o=o||s.shift();do{if(c=o.execute(o.state,o.delay))break}while((o=s[0])&&o.id===i&&s.shift());if(this._active=!1,c){for(;(o=s[0])&&o.id===i&&s.shift();)o.unsubscribe();throw c}}}(class DG extends fk{constructor(o,i){super(o,i),this.scheduler=o,this.work=i}requestAsyncId(o,i,s=0){return null!==s&&s>0?super.requestAsyncId(o,i,s):(o.actions.push(this),o._scheduled||(o._scheduled=yI.setImmediate(o.flush.bind(o,void 0))))}recycleAsyncId(o,i,s=0){var c;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(o,i,s);const{actions:f}=o;null!=i&&(null===(c=f[f.length-1])||void 0===c?void 0:c.id)!==i&&(yI.clearImmediate(i),o._scheduled===i&&(o._scheduled=void 0))}});function hB(e,o=gk){return function RG(e){return ar((o,i)=>{let s=!1,c=null,f=null,g=!1;const v=()=>{if(f?.unsubscribe(),f=null,s){s=!1;const T=c;c=null,i.next(T)}g&&i.complete()},w=()=>{f=null,g&&i.complete()};o.subscribe(Di(i,T=>{s=!0,c=T,f||En(e(T)).subscribe(f=Di(i,v,w))},()=>{g=!0,(!s||!f||f.closed)&&i.complete()}))})}(()=>function OG(e=0,o,i=qH){let s=-1;return null!=o&&(aE(o)?i=o:s=o),new $n(c=>{let f=function PG(e){return e instanceof Date&&!isNaN(e)}(e)?+e-i.now():e;f<0&&(f=0);let g=0;return i.schedule(function(){c.closed||(c.next(g++),0<=s?this.schedule(void 0,s):c.complete())},f)})}(e,o))}let FG=(()=>{class e{constructor(i,s,c){this._ngZone=i,this._platform=s,this._scrolled=new on,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=c}register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){const s=this.scrollContainers.get(i);s&&(s.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=20){return this._platform.isBrowser?new $n(s=>{this._globalSubscription||this._addGlobalListener();const c=i>0?this._scrolled.pipe(hB(i)).subscribe(s):this._scrolled.subscribe(s);return this._scrolledCount++,()=>{c.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):kt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((i,s)=>this.deregister(s)),this._scrolled.complete()}ancestorScrolled(i,s){const c=this.getAncestorScrollContainers(i);return this.scrolled(s).pipe(Os(f=>!f||c.indexOf(f)>-1))}getAncestorScrollContainers(i){const s=[];return this.scrollContainers.forEach((c,f)=>{this._scrollableContainsElement(f,i)&&s.push(f)}),s}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(i,s){let c=Jf(s),f=i.getElementRef().nativeElement;do{if(c==f)return!0}while(c=c.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>xk(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Xe),bt(oa),bt(Qn,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wk=(()=>{class e{constructor(i,s,c){this._platform=i,this._change=new on,this._changeListener=f=>{this._change.next(f)},this._document=c,s.runOutsideAngular(()=>{if(i.isBrowser){const f=this._getWindow();f.addEventListener("resize",this._changeListener),f.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const i=this._getWindow();i.removeEventListener("resize",this._changeListener),i.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){const i=this.getViewportScrollPosition(),{width:s,height:c}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+c,right:i.left+s,height:c,width:s}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const i=this._document,s=this._getWindow(),c=i.documentElement,f=c.getBoundingClientRect();return{top:-f.top||i.body.scrollTop||s.scrollY||c.scrollTop||0,left:-f.left||i.body.scrollLeft||s.scrollX||c.scrollLeft||0}}change(i=20){return i>0?this._change.pipe(hB(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}static#t=this.\u0275fac=function(s){return new(s||e)(bt(oa),bt(Xe),bt(Qn,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Ek=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({})}return e})(),fB=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Fw,Ek,Fw,Ek]})}return e})();class Ck{attach(o){return this._attachedHost=o,o.attach(this)}detach(){let o=this._attachedHost;null!=o&&(this._attachedHost=null,o.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(o){this._attachedHost=o}}class zG extends Ck{constructor(o,i,s,c,f){super(),this.component=o,this.viewContainerRef=i,this.injector=s,this.componentFactoryResolver=c,this.projectableNodes=f}}class pB extends Ck{constructor(o,i,s,c){super(),this.templateRef=o,this.viewContainerRef=i,this.context=s,this.injector=c}get origin(){return this.templateRef.elementRef}attach(o,i=this.context){return this.context=i,super.attach(o)}detach(){return this.context=void 0,super.detach()}}class BG extends Ck{constructor(o){super(),this.element=o instanceof Oi?o.nativeElement:o}}class VG{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(o){return o instanceof zG?(this._attachedPortal=o,this.attachComponentPortal(o)):o instanceof pB?(this._attachedPortal=o,this.attachTemplatePortal(o)):this.attachDomPortal&&o instanceof BG?(this._attachedPortal=o,this.attachDomPortal(o)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(o){this._disposeFn=o}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class jG extends VG{constructor(o,i,s,c,f){super(),this.outletElement=o,this._componentFactoryResolver=i,this._appRef=s,this._defaultInjector=c,this.attachDomPortal=g=>{const v=g.element,w=this._document.createComment("dom-portal");v.parentNode.insertBefore(w,v),this.outletElement.appendChild(v),this._attachedPortal=g,super.setDisposeFn(()=>{w.parentNode&&w.parentNode.replaceChild(v,w)})},this._document=f}attachComponentPortal(o){const s=(o.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(o.component);let c;return o.viewContainerRef?(c=o.viewContainerRef.createComponent(s,o.viewContainerRef.length,o.injector||o.viewContainerRef.injector,o.projectableNodes||void 0),this.setDisposeFn(()=>c.destroy())):(c=s.create(o.injector||this._defaultInjector||Fr.NULL),this._appRef.attachView(c.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(c.hostView),c.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(c)),this._attachedPortal=o,c}attachTemplatePortal(o){let i=o.viewContainerRef,s=i.createEmbeddedView(o.templateRef,o.context,{injector:o.injector});return s.rootNodes.forEach(c=>this.outletElement.appendChild(c)),s.detectChanges(),this.setDisposeFn(()=>{let c=i.indexOf(s);-1!==c&&i.remove(c)}),this._attachedPortal=o,s}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(o){return o.hostView.rootNodes[0]}}let UG=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({})}return e})();const mB=DH();class HG{constructor(o,i){this._viewportRuler=o,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=i}attach(){}enable(){if(this._canBeEnabled()){const o=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=o.style.left||"",this._previousHTMLStyles.top=o.style.top||"",o.style.left=yo(-this._previousScrollPosition.left),o.style.top=yo(-this._previousScrollPosition.top),o.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const o=this._document.documentElement,s=o.style,c=this._document.body.style,f=s.scrollBehavior||"",g=c.scrollBehavior||"";this._isEnabled=!1,s.left=this._previousHTMLStyles.left,s.top=this._previousHTMLStyles.top,o.classList.remove("cdk-global-scrollblock"),mB&&(s.scrollBehavior=c.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),mB&&(s.scrollBehavior=f,c.scrollBehavior=g)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const i=this._document.body,s=this._viewportRuler.getViewportSize();return i.scrollHeight>s.height||i.scrollWidth>s.width}}class $G{constructor(o,i,s,c){this._scrollDispatcher=o,this._ngZone=i,this._viewportRuler=s,this._config=c,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(o){this._overlayRef=o}enable(){if(this._scrollSubscription)return;const o=this._scrollDispatcher.scrolled(0).pipe(Os(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=o.subscribe(()=>{const i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=o.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class gB{enable(){}disable(){}attach(){}}function Mk(e,o){return o.some(i=>e.bottom<i.top||e.top>i.bottom||e.right<i.left||e.left>i.right)}function _B(e,o){return o.some(i=>e.top<i.top||e.bottom>i.bottom||e.left<i.left||e.right>i.right)}class GG{constructor(o,i,s,c){this._scrollDispatcher=o,this._viewportRuler=i,this._ngZone=s,this._config=c,this._scrollSubscription=null}attach(o){this._overlayRef=o}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:s,height:c}=this._viewportRuler.getViewportSize();Mk(i,[{width:s,height:c,bottom:c,right:s,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let qG=(()=>{class e{constructor(i,s,c,f){this._scrollDispatcher=i,this._viewportRuler=s,this._ngZone=c,this.noop=()=>new gB,this.close=g=>new $G(this._scrollDispatcher,this._ngZone,this._viewportRuler,g),this.block=()=>new HG(this._viewportRuler,this._document),this.reposition=g=>new GG(this._scrollDispatcher,this._viewportRuler,this._ngZone,g),this._document=f}static#t=this.\u0275fac=function(s){return new(s||e)(bt(FG),bt(wk),bt(Xe),bt(Qn))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class yB{constructor(o){if(this.scrollStrategy=new gB,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,o){const i=Object.keys(o);for(const s of i)void 0!==o[s]&&(this[s]=o[s])}}}class WG{constructor(o,i){this.connectionPair=o,this.scrollableViewProperties=i}}let vB=(()=>{class e{constructor(i){this._attachedOverlays=[],this._document=i}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){const s=this._attachedOverlays.indexOf(i);s>-1&&this._attachedOverlays.splice(s,1),0===this._attachedOverlays.length&&this.detach()}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),ZG=(()=>{class e extends vB{constructor(i,s){super(i),this._ngZone=s,this._keydownListener=c=>{const f=this._attachedOverlays;for(let g=f.length-1;g>-1;g--)if(f[g]._keydownEvents.observers.length>0){const v=f[g]._keydownEvents;this._ngZone?this._ngZone.run(()=>v.next(c)):v.next(c);break}}}add(i){super.add(i),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn),bt(Xe,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),XG=(()=>{class e extends vB{constructor(i,s,c){super(i),this._platform=s,this._ngZone=c,this._cursorStyleIsSet=!1,this._pointerDownListener=f=>{this._pointerDownEventTarget=Kf(f)},this._clickListener=f=>{const g=Kf(f),v="click"===f.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:g;this._pointerDownEventTarget=null;const w=this._attachedOverlays.slice();for(let T=w.length-1;T>-1;T--){const A=w[T];if(A._outsidePointerEvents.observers.length<1||!A.hasAttached())continue;if(A.overlayElement.contains(g)||A.overlayElement.contains(v))break;const k=A._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>k.next(f)):k.next(f)}}}add(i){if(super.add(i),!this._isAttached){const s=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(s)):this._addEventListeners(s),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=s.style.cursor,s.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const i=this._document.body;i.removeEventListener("pointerdown",this._pointerDownListener,!0),i.removeEventListener("click",this._clickListener,!0),i.removeEventListener("auxclick",this._clickListener,!0),i.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(i.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(i){i.addEventListener("pointerdown",this._pointerDownListener,!0),i.addEventListener("click",this._clickListener,!0),i.addEventListener("auxclick",this._clickListener,!0),i.addEventListener("contextmenu",this._clickListener,!0)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn),bt(oa),bt(Xe,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),xB=(()=>{class e{constructor(i,s){this._platform=s,this._document=i}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const i="cdk-overlay-container";if(this._platform.isBrowser||lk()){const c=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let f=0;f<c.length;f++)c[f].remove()}const s=this._document.createElement("div");s.classList.add(i),lk()?s.setAttribute("platform","test"):this._platform.isBrowser||s.setAttribute("platform","server"),this._document.body.appendChild(s),this._containerElement=s}static#t=this.\u0275fac=function(s){return new(s||e)(bt(Qn),bt(oa))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class YG{constructor(o,i,s,c,f,g,v,w,T,A=!1){this._portalOutlet=o,this._host=i,this._pane=s,this._config=c,this._ngZone=f,this._keyboardDispatcher=g,this._document=v,this._location=w,this._outsideClickDispatcher=T,this._animationsDisabled=A,this._backdropElement=null,this._backdropClick=new on,this._attachments=new on,this._detachments=new on,this._locationChanges=st.EMPTY,this._backdropClickHandler=k=>this._backdropClick.next(k),this._backdropTransitionendHandler=k=>{this._disposeBackdrop(k.target)},this._keydownEvents=new on,this._outsidePointerEvents=new on,c.scrollStrategy&&(this._scrollStrategy=c.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=c.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(o){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const i=this._portalOutlet.attach(o);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe($c(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof i?.onDestroy&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const o=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),o}dispose(){const o=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,o&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(o){o!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=o,this.hasAttached()&&(o.attach(this),this.updatePosition()))}updateSize(o){this._config={...this._config,...o},this._updateElementSize()}setDirection(o){this._config={...this._config,direction:o},this._updateElementDirection()}addPanelClass(o){this._pane&&this._toggleClasses(this._pane,o,!0)}removePanelClass(o){this._pane&&this._toggleClasses(this._pane,o,!1)}getDirection(){const o=this._config.direction;return o?"string"==typeof o?o:o.value:"ltr"}updateScrollStrategy(o){o!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=o,this.hasAttached()&&(o.attach(this),o.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const o=this._pane.style;o.width=yo(this._config.width),o.height=yo(this._config.height),o.minWidth=yo(this._config.minWidth),o.minHeight=yo(this._config.minHeight),o.maxWidth=yo(this._config.maxWidth),o.maxHeight=yo(this._config.maxHeight)}_togglePointerEvents(o){this._pane.style.pointerEvents=o?"":"none"}_attachBackdrop(){const o="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(o)})}):this._backdropElement.classList.add(o)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const o=this._backdropElement;if(o){if(this._animationsDisabled)return void this._disposeBackdrop(o);o.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{o.addEventListener("transitionend",this._backdropTransitionendHandler)}),o.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(o)},500))}}_toggleClasses(o,i,s){const c=sI(i||[]).filter(f=>!!f);c.length&&(s?o.classList.add(...c):o.classList.remove(...c))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const o=this._ngZone.onStable.pipe(Da(uc(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),o.unsubscribe())})})}_disposeScrollStrategy(){const o=this._scrollStrategy;o&&(o.disable(),o.detach&&o.detach())}_disposeBackdrop(o){o&&(o.removeEventListener("click",this._backdropClickHandler),o.removeEventListener("transitionend",this._backdropTransitionendHandler),o.remove(),this._backdropElement===o&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const bB="cdk-overlay-connected-position-bounding-box",KG=/([A-Za-z%]+)$/;class JG{get positions(){return this._preferredPositions}constructor(o,i,s,c,f){this._viewportRuler=i,this._document=s,this._platform=c,this._overlayContainer=f,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new on,this._resizeSubscription=st.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(o)}attach(o){this._validatePositions(),o.hostElement.classList.add(bB),this._overlayRef=o,this._boundingBox=o.hostElement,this._pane=o.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const o=this._originRect,i=this._overlayRect,s=this._viewportRect,c=this._containerRect,f=[];let g;for(let v of this._preferredPositions){let w=this._getOriginPoint(o,c,v),T=this._getOverlayPoint(w,i,v),A=this._getOverlayFit(T,i,s,v);if(A.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(v,w);this._canFitWithFlexibleDimensions(A,T,s)?f.push({position:v,origin:w,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(w,v)}):(!g||g.overlayFit.visibleArea<A.visibleArea)&&(g={overlayFit:A,overlayPoint:T,originPoint:w,position:v,overlayRect:i})}if(f.length){let v=null,w=-1;for(const T of f){const A=T.boundingBoxRect.width*T.boundingBoxRect.height*(T.position.weight||1);A>w&&(w=A,v=T)}return this._isPushed=!1,void this._applyPosition(v.position,v.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(g.position,g.originPoint);this._applyPosition(g.position,g.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Ag(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(bB),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const o=this._lastPosition;if(o){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._getOriginPoint(this._originRect,this._containerRect,o);this._applyPosition(o,i)}else this.apply()}withScrollableContainers(o){return this._scrollables=o,this}withPositions(o){return this._preferredPositions=o,-1===o.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(o){return this._viewportMargin=o,this}withFlexibleDimensions(o=!0){return this._hasFlexibleDimensions=o,this}withGrowAfterOpen(o=!0){return this._growAfterOpen=o,this}withPush(o=!0){return this._canPush=o,this}withLockedPosition(o=!0){return this._positionLocked=o,this}setOrigin(o){return this._origin=o,this}withDefaultOffsetX(o){return this._offsetX=o,this}withDefaultOffsetY(o){return this._offsetY=o,this}withTransformOriginOn(o){return this._transformOriginSelector=o,this}_getOriginPoint(o,i,s){let c,f;if("center"==s.originX)c=o.left+o.width/2;else{const g=this._isRtl()?o.right:o.left,v=this._isRtl()?o.left:o.right;c="start"==s.originX?g:v}return i.left<0&&(c-=i.left),f="center"==s.originY?o.top+o.height/2:"top"==s.originY?o.top:o.bottom,i.top<0&&(f-=i.top),{x:c,y:f}}_getOverlayPoint(o,i,s){let c,f;return c="center"==s.overlayX?-i.width/2:"start"===s.overlayX?this._isRtl()?-i.width:0:this._isRtl()?0:-i.width,f="center"==s.overlayY?-i.height/2:"top"==s.overlayY?0:-i.height,{x:o.x+c,y:o.y+f}}_getOverlayFit(o,i,s,c){const f=EB(i);let{x:g,y:v}=o,w=this._getOffset(c,"x"),T=this._getOffset(c,"y");w&&(g+=w),T&&(v+=T);let B=0-v,$=v+f.height-s.height,K=this._subtractOverflows(f.width,0-g,g+f.width-s.width),Q=this._subtractOverflows(f.height,B,$),ut=K*Q;return{visibleArea:ut,isCompletelyWithinViewport:f.width*f.height===ut,fitsInViewportVertically:Q===f.height,fitsInViewportHorizontally:K==f.width}}_canFitWithFlexibleDimensions(o,i,s){if(this._hasFlexibleDimensions){const c=s.bottom-i.y,f=s.right-i.x,g=wB(this._overlayRef.getConfig().minHeight),v=wB(this._overlayRef.getConfig().minWidth);return(o.fitsInViewportVertically||null!=g&&g<=c)&&(o.fitsInViewportHorizontally||null!=v&&v<=f)}return!1}_pushOverlayOnScreen(o,i,s){if(this._previousPushAmount&&this._positionLocked)return{x:o.x+this._previousPushAmount.x,y:o.y+this._previousPushAmount.y};const c=EB(i),f=this._viewportRect,g=Math.max(o.x+c.width-f.width,0),v=Math.max(o.y+c.height-f.height,0),w=Math.max(f.top-s.top-o.y,0),T=Math.max(f.left-s.left-o.x,0);let A=0,k=0;return A=c.width<=f.width?T||-g:o.x<this._viewportMargin?f.left-s.left-o.x:0,k=c.height<=f.height?w||-v:o.y<this._viewportMargin?f.top-s.top-o.y:0,this._previousPushAmount={x:A,y:k},{x:o.x+A,y:o.y+k}}_applyPosition(o,i){if(this._setTransformOrigin(o),this._setOverlayElementStyles(i,o),this._setBoundingBoxStyles(i,o),o.panelClass&&this._addPanelClasses(o.panelClass),this._lastPosition=o,this._positionChanges.observers.length){const s=this._getScrollVisibility(),c=new WG(o,s);this._positionChanges.next(c)}this._isInitialRender=!1}_setTransformOrigin(o){if(!this._transformOriginSelector)return;const i=this._boundingBox.querySelectorAll(this._transformOriginSelector);let s,c=o.overlayY;s="center"===o.overlayX?"center":this._isRtl()?"start"===o.overlayX?"right":"left":"start"===o.overlayX?"left":"right";for(let f=0;f<i.length;f++)i[f].style.transformOrigin=`${s} ${c}`}_calculateBoundingBoxRect(o,i){const s=this._viewportRect,c=this._isRtl();let f,g,v,A,k,B;if("top"===i.overlayY)g=o.y,f=s.height-g+this._viewportMargin;else if("bottom"===i.overlayY)v=s.height-o.y+2*this._viewportMargin,f=s.height-v+this._viewportMargin;else{const $=Math.min(s.bottom-o.y+s.top,o.y),K=this._lastBoundingBoxSize.height;f=2*$,g=o.y-$,f>K&&!this._isInitialRender&&!this._growAfterOpen&&(g=o.y-K/2)}if("end"===i.overlayX&&!c||"start"===i.overlayX&&c)B=s.width-o.x+this._viewportMargin,A=o.x-this._viewportMargin;else if("start"===i.overlayX&&!c||"end"===i.overlayX&&c)k=o.x,A=s.right-o.x;else{const $=Math.min(s.right-o.x+s.left,o.x),K=this._lastBoundingBoxSize.width;A=2*$,k=o.x-$,A>K&&!this._isInitialRender&&!this._growAfterOpen&&(k=o.x-K/2)}return{top:g,left:k,bottom:v,right:B,width:A,height:f}}_setBoundingBoxStyles(o,i){const s=this._calculateBoundingBoxRect(o,i);!this._isInitialRender&&!this._growAfterOpen&&(s.height=Math.min(s.height,this._lastBoundingBoxSize.height),s.width=Math.min(s.width,this._lastBoundingBoxSize.width));const c={};if(this._hasExactPosition())c.top=c.left="0",c.bottom=c.right=c.maxHeight=c.maxWidth="",c.width=c.height="100%";else{const f=this._overlayRef.getConfig().maxHeight,g=this._overlayRef.getConfig().maxWidth;c.height=yo(s.height),c.top=yo(s.top),c.bottom=yo(s.bottom),c.width=yo(s.width),c.left=yo(s.left),c.right=yo(s.right),c.alignItems="center"===i.overlayX?"center":"end"===i.overlayX?"flex-end":"flex-start",c.justifyContent="center"===i.overlayY?"center":"bottom"===i.overlayY?"flex-end":"flex-start",f&&(c.maxHeight=yo(f)),g&&(c.maxWidth=yo(g))}this._lastBoundingBoxSize=s,Ag(this._boundingBox.style,c)}_resetBoundingBoxStyles(){Ag(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Ag(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(o,i){const s={},c=this._hasExactPosition(),f=this._hasFlexibleDimensions,g=this._overlayRef.getConfig();if(c){const A=this._viewportRuler.getViewportScrollPosition();Ag(s,this._getExactOverlayY(i,o,A)),Ag(s,this._getExactOverlayX(i,o,A))}else s.position="static";let v="",w=this._getOffset(i,"x"),T=this._getOffset(i,"y");w&&(v+=`translateX(${w}px) `),T&&(v+=`translateY(${T}px)`),s.transform=v.trim(),g.maxHeight&&(c?s.maxHeight=yo(g.maxHeight):f&&(s.maxHeight="")),g.maxWidth&&(c?s.maxWidth=yo(g.maxWidth):f&&(s.maxWidth="")),Ag(this._pane.style,s)}_getExactOverlayY(o,i,s){let c={top:"",bottom:""},f=this._getOverlayPoint(i,this._overlayRect,o);return this._isPushed&&(f=this._pushOverlayOnScreen(f,this._overlayRect,s)),"bottom"===o.overlayY?c.bottom=this._document.documentElement.clientHeight-(f.y+this._overlayRect.height)+"px":c.top=yo(f.y),c}_getExactOverlayX(o,i,s){let g,c={left:"",right:""},f=this._getOverlayPoint(i,this._overlayRect,o);return this._isPushed&&(f=this._pushOverlayOnScreen(f,this._overlayRect,s)),g=this._isRtl()?"end"===o.overlayX?"left":"right":"end"===o.overlayX?"right":"left","right"===g?c.right=this._document.documentElement.clientWidth-(f.x+this._overlayRect.width)+"px":c.left=yo(f.x),c}_getScrollVisibility(){const o=this._getOriginRect(),i=this._pane.getBoundingClientRect(),s=this._scrollables.map(c=>c.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:_B(o,s),isOriginOutsideView:Mk(o,s),isOverlayClipped:_B(i,s),isOverlayOutsideView:Mk(i,s)}}_subtractOverflows(o,...i){return i.reduce((s,c)=>s-Math.max(c,0),o)}_getNarrowedViewportRect(){const o=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,s=this._viewportRuler.getViewportScrollPosition();return{top:s.top+this._viewportMargin,left:s.left+this._viewportMargin,right:s.left+o-this._viewportMargin,bottom:s.top+i-this._viewportMargin,width:o-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(o,i){return"x"===i?null==o.offsetX?this._offsetX:o.offsetX:null==o.offsetY?this._offsetY:o.offsetY}_validatePositions(){}_addPanelClasses(o){this._pane&&sI(o).forEach(i=>{""!==i&&-1===this._appliedPanelClasses.indexOf(i)&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(o=>{this._pane.classList.remove(o)}),this._appliedPanelClasses=[])}_getOriginRect(){const o=this._origin;if(o instanceof Oi)return o.nativeElement.getBoundingClientRect();if(o instanceof Element)return o.getBoundingClientRect();const i=o.width||0,s=o.height||0;return{top:o.y,bottom:o.y+s,left:o.x,right:o.x+i,height:s,width:i}}}function Ag(e,o){for(let i in o)o.hasOwnProperty(i)&&(e[i]=o[i]);return e}function wB(e){if("number"!=typeof e&&null!=e){const[o,i]=e.split(KG);return i&&"px"!==i?null:parseFloat(o)}return e||null}function EB(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const CB="cdk-global-overlay-wrapper";class QG{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(o){const i=o.getConfig();this._overlayRef=o,this._width&&!i.width&&o.updateSize({width:this._width}),this._height&&!i.height&&o.updateSize({height:this._height}),o.hostElement.classList.add(CB),this._isDisposed=!1}top(o=""){return this._bottomOffset="",this._topOffset=o,this._alignItems="flex-start",this}left(o=""){return this._xOffset=o,this._xPosition="left",this}bottom(o=""){return this._topOffset="",this._bottomOffset=o,this._alignItems="flex-end",this}right(o=""){return this._xOffset=o,this._xPosition="right",this}start(o=""){return this._xOffset=o,this._xPosition="start",this}end(o=""){return this._xOffset=o,this._xPosition="end",this}width(o=""){return this._overlayRef?this._overlayRef.updateSize({width:o}):this._width=o,this}height(o=""){return this._overlayRef?this._overlayRef.updateSize({height:o}):this._height=o,this}centerHorizontally(o=""){return this.left(o),this._xPosition="center",this}centerVertically(o=""){return this.top(o),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const o=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,s=this._overlayRef.getConfig(),{width:c,height:f,maxWidth:g,maxHeight:v}=s,w=!("100%"!==c&&"100vw"!==c||g&&"100%"!==g&&"100vw"!==g),T=!("100%"!==f&&"100vh"!==f||v&&"100%"!==v&&"100vh"!==v),A=this._xPosition,k=this._xOffset,B="rtl"===this._overlayRef.getConfig().direction;let $="",K="",Q="";w?Q="flex-start":"center"===A?(Q="center",B?K=k:$=k):B?"left"===A||"end"===A?(Q="flex-end",$=k):("right"===A||"start"===A)&&(Q="flex-start",K=k):"left"===A||"start"===A?(Q="flex-start",$=k):("right"===A||"end"===A)&&(Q="flex-end",K=k),o.position=this._cssPosition,o.marginLeft=w?"0":$,o.marginTop=T?"0":this._topOffset,o.marginBottom=this._bottomOffset,o.marginRight=w?"0":K,i.justifyContent=Q,i.alignItems=T?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const o=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,s=i.style;i.classList.remove(CB),s.justifyContent=s.alignItems=o.marginTop=o.marginBottom=o.marginLeft=o.marginRight=o.position="",this._overlayRef=null,this._isDisposed=!0}}let tq=(()=>{class e{constructor(i,s,c,f){this._viewportRuler=i,this._document=s,this._platform=c,this._overlayContainer=f}global(){return new QG}flexibleConnectedTo(i){return new JG(i,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(wk),bt(Qn),bt(oa),bt(xB))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),eq=0,vI=(()=>{class e{constructor(i,s,c,f,g,v,w,T,A,k,B,$){this.scrollStrategies=i,this._overlayContainer=s,this._componentFactoryResolver=c,this._positionBuilder=f,this._keyboardDispatcher=g,this._injector=v,this._ngZone=w,this._document=T,this._directionality=A,this._location=k,this._outsideClickDispatcher=B,this._animationsModuleType=$}create(i){const s=this._createHostElement(),c=this._createPaneElement(s),f=this._createPortalOutlet(c),g=new yB(i);return g.direction=g.direction||this._directionality.value,new YG(f,s,c,g,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(i){const s=this._document.createElement("div");return s.id="cdk-overlay-"+eq++,s.classList.add("cdk-overlay-pane"),i.appendChild(s),s}_createHostElement(){const i=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(i),i}_createPortalOutlet(i){return this._appRef||(this._appRef=this._injector.get(ct)),new jG(i,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(qG),bt(xB),bt(pm),bt(tq),bt(ZG),bt(Fr),bt(Xe),bt(Qn),bt(dI),bt(hD),bt(XG),bt(xu,8))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const nq=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],MB=new $t("cdk-connected-overlay-scroll-strategy");let Sk=(()=>{class e{constructor(i){this.elementRef=i}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"],standalone:!0})}return e})(),SB=(()=>{class e{get offsetX(){return this._offsetX}set offsetX(i){this._offsetX=i,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(i){this._offsetY=i,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(i){this._hasBackdrop=Lo(i)}get lockPosition(){return this._lockPosition}set lockPosition(i){this._lockPosition=Lo(i)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(i){this._flexibleDimensions=Lo(i)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(i){this._growAfterOpen=Lo(i)}get push(){return this._push}set push(i){this._push=Lo(i)}constructor(i,s,c,f,g){this._overlay=i,this._dir=g,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=st.EMPTY,this._attachSubscription=st.EMPTY,this._detachSubscription=st.EMPTY,this._positionSubscription=st.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new oi,this.positionChange=new oi,this.attach=new oi,this.detach=new oi,this.overlayKeydown=new oi,this.overlayOutsideClick=new oi,this._templatePortal=new pB(s,c),this._scrollStrategyFactory=f,this.scrollStrategy=this._scrollStrategyFactory()}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(i){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),i.origin&&this.open&&this._position.apply()),i.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=nq);const i=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=i.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=i.detachments().subscribe(()=>this.detach.emit()),i.keydownEvents().subscribe(s=>{this.overlayKeydown.next(s),27===s.keyCode&&!this.disableClose&&!Ow(s)&&(s.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(s=>{this.overlayOutsideClick.next(s)})}_buildConfig(){const i=this._position=this.positionStrategy||this._createPositionStrategy(),s=new yB({direction:this._dir,positionStrategy:i,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(s.width=this.width),(this.height||0===this.height)&&(s.height=this.height),(this.minWidth||0===this.minWidth)&&(s.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(s.minHeight=this.minHeight),this.backdropClass&&(s.backdropClass=this.backdropClass),this.panelClass&&(s.panelClass=this.panelClass),s}_updatePositionStrategy(i){const s=this.positions.map(c=>({originX:c.originX,originY:c.originY,overlayX:c.overlayX,overlayY:c.overlayY,offsetX:c.offsetX||this.offsetX,offsetY:c.offsetY||this.offsetY,panelClass:c.panelClass||void 0}));return i.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(s).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const i=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(i),i}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof Sk?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(i=>{this.backdropClick.emit(i)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(function NG(e,o=!1){return ar((i,s)=>{let c=0;i.subscribe(Di(s,f=>{const g=e(f,c++);(g||o)&&s.next(f),!g&&s.complete()}))})}(()=>this.positionChange.observers.length>0)).subscribe(i=>{this.positionChange.emit(i),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}static#t=this.\u0275fac=function(s){return new(s||e)(_t(vI),_t(Wl),_t(ds),_t(MB),_t(dI,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],standalone:!0,features:[qo]})}return e})();const rq={provide:MB,deps:[vI],useFactory:function iq(e){return()=>e.scrollStrategies.reposition()}};let oq=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({providers:[vI,rq],imports:[Fw,UG,fB,fB]})}return e})();class sq extends on{constructor(o=1/0,i=1/0,s=pk){super(),this._bufferSize=o,this._windowTime=i,this._timestampProvider=s,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=i===1/0,this._bufferSize=Math.max(1,o),this._windowTime=Math.max(1,i)}next(o){const{isStopped:i,_buffer:s,_infiniteTimeWindow:c,_timestampProvider:f,_windowTime:g}=this;i||(s.push(o),!c&&s.push(f.now()+g)),this._trimBuffer(),super.next(o)}_subscribe(o){this._throwIfClosed(),this._trimBuffer();const i=this._innerSubscribe(o),{_infiniteTimeWindow:s,_buffer:c}=this,f=c.slice();for(let g=0;g<f.length&&!o.closed;g+=s?1:2)o.next(f[g]);return this._checkFinalizedStatuses(o),i}_trimBuffer(){const{_bufferSize:o,_timestampProvider:i,_buffer:s,_infiniteTimeWindow:c}=this,f=(c?1:2)*o;if(o<1/0&&f<s.length&&s.splice(0,s.length-f),!c){const g=i.now();let v=0;for(let w=1;w<s.length&&s[w]<=g;w+=2)v=w;v&&s.splice(0,v+1)}}}class lq{constructor(o){this._box=o,this._destroyed=new on,this._resizeSubject=new on,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(i=>this._resizeSubject.next(i)))}observe(o){return this._elementObservables.has(o)||this._elementObservables.set(o,new $n(i=>{const s=this._resizeSubject.subscribe(i);return this._resizeObserver?.observe(o,{box:this._box}),()=>{this._resizeObserver?.unobserve(o),s.unsubscribe(),this._elementObservables.delete(o)}}).pipe(Os(i=>i.some(s=>s.target===o)),function aq(e,o,i){let s,c=!1;return e&&"object"==typeof e?({bufferSize:s=1/0,windowTime:o=1/0,refCount:c=!1,scheduler:i}=e):s=e??1/0,zn({connector:()=>new sq(s,o,i),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:c})}({bufferSize:1,refCount:!0}),Da(this._destroyed))),this._elementObservables.get(o)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let cq=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=ne(Xe)}ngOnDestroy(){for(const[,i]of this._observers)i.destroy();this._observers.clear()}observe(i,s){const c=s?.box||"content-box";return this._observers.has(c)||this._observers.set(c,new lq(c)),this._observers.get(c).observe(i)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),uq=(()=>{class e{create(i){return typeof MutationObserver>"u"?null:new MutationObserver(i)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),dq=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({providers:[uq]})}return e})();const hq=["notch"],fq=["matFormFieldNotchedOutline",""],pq=["*"],mq=["textField"],gq=["iconPrefixContainer"],_q=["textPrefixContainer"];function yq(e,o){1&e&&oo(0,"span",19)}function vq(e,o){if(1&e&&(un(0,"label",17),jr(1,1),Ji(2,yq,1,0,"span",18),mn()),2&e){const i=so(2);Cn("floating",i._shouldLabelFloat())("monitorResize",i._hasOutline())("id",i._labelId),ro("for",i._control.id),pn(2),Cn("ngIf",!i.hideRequiredMarker&&i._control.required)}}function xq(e,o){1&e&&Ji(0,vq,3,5,"label",16),2&e&&Cn("ngIf",so()._hasFloatingLabel())}function bq(e,o){1&e&&oo(0,"div",20)}function wq(e,o){}function Eq(e,o){1&e&&Ji(0,wq,0,0,"ng-template",22),2&e&&(so(2),Cn("ngTemplateOutlet",Bm(1)))}function Cq(e,o){if(1&e&&(un(0,"div",21),Ji(1,Eq,1,1,"ng-template",9),mn()),2&e){const i=so();Cn("matFormFieldNotchedOutlineOpen",i._shouldLabelFloat()),pn(1),Cn("ngIf",!i._forceDisplayInfixLabel())}}function Mq(e,o){1&e&&(un(0,"div",23,24),jr(2,2),mn())}function Sq(e,o){1&e&&(un(0,"div",25,26),jr(2,3),mn())}function Tq(e,o){}function Dq(e,o){1&e&&Ji(0,Tq,0,0,"ng-template",22),2&e&&(so(),Cn("ngTemplateOutlet",Bm(1)))}function Iq(e,o){1&e&&(un(0,"div",27),jr(1,4),mn())}function Aq(e,o){1&e&&(un(0,"div",28),jr(1,5),mn())}function Rq(e,o){1&e&&oo(0,"div",29)}function Pq(e,o){1&e&&(un(0,"div",30),jr(1,6),mn()),2&e&&Cn("@transitionMessages",so()._subscriptAnimationState)}function Oq(e,o){if(1&e&&(un(0,"mat-hint",34),us(1),mn()),2&e){const i=so(2);Cn("id",i._hintLabelId),pn(1),Zm(i.hintLabel)}}function kq(e,o){if(1&e&&(un(0,"div",31),Ji(1,Oq,2,2,"mat-hint",32),jr(2,7),oo(3,"div",33),jr(4,8),mn()),2&e){const i=so();Cn("@transitionMessages",i._subscriptAnimationState),pn(1),Cn("ngIf",i.hintLabel)}}const Fq=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],Lq=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];let Tk=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275dir=Ee({type:e,selectors:[["mat-label"]]})}return e})();const Nq=new $t("MatError");let zq=0,TB=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+zq++}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275dir=Ee({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(s,c){2&s&&(Df("id",c.id),ro("align",null),Ir("mat-mdc-form-field-hint-end","end"===c.align))},inputs:{align:"align",id:"id"}})}return e})();const Bq=new $t("MatPrefix"),Vq=new $t("MatSuffix"),DB=new $t("FloatingLabelParent");let IB=(()=>{class e{get floating(){return this._floating}set floating(i){this._floating=i,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(i){this._monitorResize=i,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(i){this._elementRef=i,this._floating=!1,this._monitorResize=!1,this._resizeObserver=ne(cq),this._ngZone=ne(Xe),this._parent=ne(DB),this._resizeSubscription=new st}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function jq(e){if(null!==e.offsetParent)return e.scrollWidth;const i=e.cloneNode(!0);i.style.setProperty("position","absolute"),i.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(i);const s=i.scrollWidth;return i.remove(),s}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi))};static#e=this.\u0275dir=Ee({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(s,c){2&s&&Ir("mdc-floating-label--float-above",c.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"}})}return e})();const AB="mdc-line-ripple--active",xI="mdc-line-ripple--deactivating";let RB=(()=>{class e{constructor(i,s){this._elementRef=i,this._handleTransitionEnd=c=>{const f=this._elementRef.nativeElement.classList,g=f.contains(xI);"opacity"===c.propertyName&&g&&f.remove(AB,xI)},s.runOutsideAngular(()=>{i.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const i=this._elementRef.nativeElement.classList;i.remove(xI),i.add(AB)}deactivate(){this._elementRef.nativeElement.classList.add(xI)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi),_t(Xe))};static#e=this.\u0275dir=Ee({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"]})}return e})(),PB=(()=>{class e{constructor(i,s){this._elementRef=i,this._ngZone=s,this.open=!1}ngAfterViewInit(){const i=this._elementRef.nativeElement.querySelector(".mdc-floating-label");i?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(i.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>i.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(i){this._notch.nativeElement.style.width=this.open&&i?`calc(${i}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi),_t(Xe))};static#e=this.\u0275cmp=os({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(s,c){if(1&s&&Ta(hq,5),2&s){let f;br(f=rr())&&(c._notch=f.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(s,c){2&s&&Ir("mdc-notched-outline--notched",c.open)},inputs:{open:["matFormFieldNotchedOutlineOpen","open"]},attrs:fq,ngContentSelectors:pq,decls:5,vars:0,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],["notch",""],[1,"mdc-notched-outline__trailing"]],template:function(s,c){1&s&&(Fc(),oo(0,"div",0),un(1,"div",1,2),jr(3),mn(),oo(4,"div",3))},encapsulation:2,changeDetection:0})}return e})();const Uq={transitionMessages:dO("transitionMessages",[dN("enter",xg({opacity:1,transform:"translateY(0%)"})),TD("void => enter",[xg({opacity:0,transform:"translateY(-5px)"}),hO("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let Dk=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275dir=Ee({type:e})}return e})();const Ik=new $t("MatFormField"),Hq=new $t("MAT_FORM_FIELD_DEFAULT_OPTIONS");let OB=0,qq=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(i){this._hideRequiredMarker=Lo(i)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(i){i!==this._floatLabel&&(this._floatLabel=i,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(i){const s=this._appearance;this._appearance=i||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==s&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(i){this._subscriptSizing=i||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(i){this._hintLabel=i,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(i){this._explicitFormFieldControl=i}constructor(i,s,c,f,g,v,w,T){this._elementRef=i,this._changeDetectorRef=s,this._ngZone=c,this._dir=f,this._platform=g,this._defaults=v,this._animationMode=w,this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+OB++,this._hintLabelId="mat-mdc-hint-"+OB++,this._subscriptAnimationState="",this._destroyed=new on,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,v&&(v.appearance&&(this.appearance=v.appearance),this._hideRequiredMarker=!!v?.hideRequiredMarker,v.color&&(this.color=v.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){const i=this._control;i.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${i.controlType}`),i.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),i.ngControl&&i.ngControl.valueChanges&&i.ngControl.valueChanges.pipe(Da(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(i=>!i._isText),this._hasTextPrefix=!!this._prefixChildren.find(i=>i._isText),this._hasIconSuffix=!!this._suffixChildren.find(i=>!i._isText),this._hasTextSuffix=!!this._suffixChildren.find(i=>i._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),uc(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Da(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(Da(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(i){const s=this._control?this._control.ngControl:null;return s&&s[i]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let i=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&i.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const s=this._hintChildren?this._hintChildren.find(f=>"start"===f.align):null,c=this._hintChildren?this._hintChildren.find(f=>"end"===f.align):null;s?i.push(s.id):this._hintLabel&&i.push(this._hintLabelId),c&&i.push(c.id)}else this._errorChildren&&i.push(...this._errorChildren.map(s=>s.id));this._control.setDescribedByIds(i)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;const i=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(i.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdateOnStable=!0);const s=this._iconPrefixContainer?.nativeElement,c=this._textPrefixContainer?.nativeElement,f=s?.getBoundingClientRect().width??0,g=c?.getBoundingClientRect().width??0;i.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${f+g}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`}_isAttachedToDom(){const i=this._elementRef.nativeElement;if(i.getRootNode){const s=i.getRootNode();return s&&s!==i}return document.documentElement.contains(i)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi),_t(Le),_t(Xe),_t(dI),_t(oa),_t(Hq,8),_t(xu,8),_t(Qn))};static#e=this.\u0275cmp=os({type:e,selectors:[["mat-form-field"]],contentQueries:function(s,c,f){if(1&s&&(Qs(f,Tk,5),Qs(f,Tk,7),Qs(f,Dk,5),Qs(f,Bq,5),Qs(f,Vq,5),Qs(f,Nq,5),Qs(f,TB,5)),2&s){let g;br(g=rr())&&(c._labelChildNonStatic=g.first),br(g=rr())&&(c._labelChildStatic=g.first),br(g=rr())&&(c._formFieldControl=g.first),br(g=rr())&&(c._prefixChildren=g),br(g=rr())&&(c._suffixChildren=g),br(g=rr())&&(c._errorChildren=g),br(g=rr())&&(c._hintChildren=g)}},viewQuery:function(s,c){if(1&s&&(Ta(mq,5),Ta(gq,5),Ta(_q,5),Ta(IB,5),Ta(PB,5),Ta(RB,5)),2&s){let f;br(f=rr())&&(c._textField=f.first),br(f=rr())&&(c._iconPrefixContainer=f.first),br(f=rr())&&(c._textPrefixContainer=f.first),br(f=rr())&&(c._floatingLabel=f.first),br(f=rr())&&(c._notchedOutline=f.first),br(f=rr())&&(c._lineRipple=f.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(s,c){2&s&&Ir("mat-mdc-form-field-label-always-float",c._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",c._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",c._hasIconSuffix)("mat-form-field-invalid",c._control.errorState)("mat-form-field-disabled",c._control.disabled)("mat-form-field-autofilled",c._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===c._animationMode)("mat-form-field-appearance-fill","fill"==c.appearance)("mat-form-field-appearance-outline","outline"==c.appearance)("mat-form-field-hide-placeholder",c._hasFloatingLabel()&&!c._shouldLabelFloat())("mat-focused",c._control.focused)("mat-primary","accent"!==c.color&&"warn"!==c.color)("mat-accent","accent"===c.color)("mat-warn","warn"===c.color)("ng-untouched",c._shouldForward("untouched"))("ng-touched",c._shouldForward("touched"))("ng-pristine",c._shouldForward("pristine"))("ng-dirty",c._shouldForward("dirty"))("ng-valid",c._shouldForward("valid"))("ng-invalid",c._shouldForward("invalid"))("ng-pending",c._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],features:[Wi([{provide:Ik,useExisting:e},{provide:DB,useExisting:e}])],ngContentSelectors:Lq,decls:18,vars:23,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay",4,"ngIf"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen",4,"ngIf"],["class","mat-mdc-form-field-icon-prefix",4,"ngIf"],["class","mat-mdc-form-field-text-prefix",4,"ngIf"],[1,"mat-mdc-form-field-infix"],[3,"ngIf"],["class","mat-mdc-form-field-text-suffix",4,"ngIf"],["class","mat-mdc-form-field-icon-suffix",4,"ngIf"],["matFormFieldLineRipple","",4,"ngIf"],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align",3,"ngSwitch"],["class","mat-mdc-form-field-error-wrapper",4,"ngSwitchCase"],["class","mat-mdc-form-field-hint-wrapper",4,"ngSwitchCase"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id",4,"ngIf"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required",4,"ngIf"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id",4,"ngIf"],[1,"mat-mdc-form-field-hint-spacer"],[3,"id"]],template:function(s,c){1&s&&(Fc(Fq),Ji(0,xq,1,1,"ng-template",null,0,qT),un(2,"div",1,2),cr("click",function(g){return c._control.onContainerClick(g)}),Ji(4,bq,1,0,"div",3),un(5,"div",4),Ji(6,Cq,2,2,"div",5),Ji(7,Mq,3,0,"div",6),Ji(8,Sq,3,0,"div",7),un(9,"div",8),Ji(10,Dq,1,1,"ng-template",9),jr(11),mn(),Ji(12,Iq,2,0,"div",10),Ji(13,Aq,2,0,"div",11),mn(),Ji(14,Rq,1,0,"div",12),mn(),un(15,"div",13),Ji(16,Pq,2,1,"div",14),Ji(17,kq,5,2,"div",15),mn()),2&s&&(pn(2),Ir("mdc-text-field--filled",!c._hasOutline())("mdc-text-field--outlined",c._hasOutline())("mdc-text-field--no-label",!c._hasFloatingLabel())("mdc-text-field--disabled",c._control.disabled)("mdc-text-field--invalid",c._control.errorState),pn(2),Cn("ngIf",!c._hasOutline()&&!c._control.disabled),pn(2),Cn("ngIf",c._hasOutline()),pn(1),Cn("ngIf",c._hasIconPrefix),pn(1),Cn("ngIf",c._hasTextPrefix),pn(2),Cn("ngIf",!c._hasOutline()||c._forceDisplayInfixLabel()),pn(2),Cn("ngIf",c._hasTextSuffix),pn(1),Cn("ngIf",c._hasIconSuffix),pn(1),Cn("ngIf",!c._hasOutline()),pn(1),Ir("mat-mdc-form-field-subscript-dynamic-size","dynamic"===c.subscriptSizing),Cn("ngSwitch",c._getDisplayedMessages()),pn(1),Cn("ngSwitchCase","error"),pn(1),Cn("ngSwitchCase","hint"))},dependencies:[ZP,LL,mw,YP,TB,IB,PB,RB],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 96px / 0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px * 2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{--mdc-filled-text-field-active-indicator-height:1px;--mdc-filled-text-field-focus-active-indicator-height:2px;--mdc-filled-text-field-container-shape:4px;border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined{--mdc-outlined-text-field-outline-width:1px;--mdc-outlined-text-field-focus-outline-width:2px;--mdc-outlined-text-field-container-shape:4px}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size) * var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:12px;box-sizing:content-box}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[Uq.transitionMessages]},changeDetection:0})}return e})(),bI=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Ia,ED,dq,Ia]})}return e})();class Wq{get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}constructor(o=!1,i,s=!0,c){this._multiple=o,this._emitChanges=s,this.compareWith=c,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new on,i&&i.length&&(o?i.forEach(f=>this._markSelected(f)):this._markSelected(i[0]),this._selectedToEmit.length=0)}select(...o){this._verifyValueAssignment(o),o.forEach(s=>this._markSelected(s));const i=this._hasQueuedChanges();return this._emitChangeEvent(),i}deselect(...o){this._verifyValueAssignment(o),o.forEach(s=>this._unmarkSelected(s));const i=this._hasQueuedChanges();return this._emitChangeEvent(),i}setSelection(...o){this._verifyValueAssignment(o);const i=this.selected,s=new Set(o);o.forEach(f=>this._markSelected(f)),i.filter(f=>!s.has(f)).forEach(f=>this._unmarkSelected(f));const c=this._hasQueuedChanges();return this._emitChangeEvent(),c}toggle(o){return this.isSelected(o)?this.deselect(o):this.select(o)}clear(o=!0){this._unmarkAll();const i=this._hasQueuedChanges();return o&&this._emitChangeEvent(),i}isSelected(o){return this._selection.has(this._getConcreteValue(o))}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(o){this._multiple&&this.selected&&this._selected.sort(o)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(o){o=this._getConcreteValue(o),this.isSelected(o)||(this._multiple||this._unmarkAll(),this.isSelected(o)||this._selection.add(o),this._emitChanges&&this._selectedToEmit.push(o))}_unmarkSelected(o){o=this._getConcreteValue(o),this.isSelected(o)&&(this._selection.delete(o),this._emitChanges&&this._deselectedToEmit.push(o))}_unmarkAll(){this.isEmpty()||this._selection.forEach(o=>this._unmarkSelected(o))}_verifyValueAssignment(o){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}_getConcreteValue(o){if(this.compareWith){for(let i of this._selection)if(this.compareWith(o,i))return i;return o}return o}}function Ak(e){return new $n(o=>{En(e()).subscribe(o)})}const Zq=["trigger"],Xq=["panel"];function Yq(e,o){if(1&e&&(un(0,"span",10),us(1),mn()),2&e){const i=so();pn(1),Zm(i.placeholder)}}function Kq(e,o){if(1&e&&(un(0,"span",14),us(1),mn()),2&e){const i=so(2);pn(1),Zm(i.triggerValue)}}function Jq(e,o){1&e&&jr(0,0,["*ngSwitchCase","true"])}function Qq(e,o){1&e&&(un(0,"span",11),Ji(1,Kq,2,1,"span",12),Ji(2,Jq,1,0,"ng-content",13),mn()),2&e&&(Cn("ngSwitch",!!so().customTrigger),pn(2),Cn("ngSwitchCase",!0))}function t7(e,o){if(1&e){const i=function hS(){return Nt()}();Pl(),function Fp(){!function K0(){qe.lFrame.currentNamespace=null}()}(),un(0,"div",15,16),cr("@transformPanel.done",function(c){return Wo(i),Al(so()._panelDoneAnimatingStream.next(c.toState))})("keydown",function(c){return Wo(i),Al(so()._handleKeydown(c))}),jr(2,1),mn()}if(2&e){const i=so();VS("mat-mdc-select-panel mdc-menu-surface mdc-menu-surface--open ",i._getPanelTheme(),""),Cn("ngClass",i.panelClass)("@transformPanel","showing"),ro("id",i.id+"-panel")("aria-multiselectable",i.multiple)("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby())}}const e7=[[["mat-select-trigger"]],"*"],n7=["mat-select-trigger","*"],i7={transformPanelWrap:dO("transformPanelWrap",[TD("* => void",Kj("@transformPanel",[Yj()],{optional:!0}))]),transformPanel:dO("transformPanel",[dN("void",xg({opacity:0,transform:"scale(1, 0.8)"})),TD("void => showing",hO("120ms cubic-bezier(0, 0, 0.2, 1)",xg({opacity:1,transform:"scale(1, 1)"}))),TD("* => void",hO("100ms linear",xg({opacity:0})))])};let LB=0;const NB=new $t("mat-select-scroll-strategy"),o7=new $t("MAT_SELECT_CONFIG"),s7={provide:NB,deps:[vI],useFactory:function r7(e){return()=>e.scrollStrategies.reposition()}},a7=new $t("MatSelectTrigger");class l7{constructor(o,i){this.source=o,this.value=i}}const c7=Vz(O$(zz(jz(class{constructor(e,o,i,s,c){this._elementRef=e,this._defaultErrorStateMatcher=o,this._parentForm=i,this._parentFormGroup=s,this.ngControl=c,this.stateChanges=new on}}))));let u7=(()=>{class e extends c7{get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(i){this._placeholder=i,this.stateChanges.next()}get required(){return this._required??this.ngControl?.control?.hasValidator(p3.required)??!1}set required(i){this._required=Lo(i),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(i){this._multiple=Lo(i)}get disableOptionCentering(){return this._disableOptionCentering}set disableOptionCentering(i){this._disableOptionCentering=Lo(i)}get compareWith(){return this._compareWith}set compareWith(i){this._compareWith=i,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(i){this._assignValue(i)&&this._onChange(i)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(i){this._typeaheadDebounceInterval=Ez(i)}get id(){return this._id}set id(i){this._id=i||this._uid,this.stateChanges.next()}constructor(i,s,c,f,g,v,w,T,A,k,B,$,K,Q){super(g,f,w,T,k),this._viewportRuler=i,this._changeDetectorRef=s,this._ngZone=c,this._dir=v,this._parentFormField=A,this._liveAnnouncer=K,this._defaultOptions=Q,this._panelOpen=!1,this._compareWith=(ut,yt)=>ut===yt,this._uid="mat-select-"+LB++,this._triggerAriaLabelledBy=null,this._destroy=new on,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="mat-select-value-"+LB++,this._panelDoneAnimatingStream=new on,this._overlayPanelClass=this._defaultOptions?.overlayPanelClass||"",this._focused=!1,this.controlType="mat-select",this._multiple=!1,this._disableOptionCentering=this._defaultOptions?.disableOptionCentering??!1,this.ariaLabel="",this.optionSelectionChanges=Ak(()=>{const ut=this.options;return ut?ut.changes.pipe(cI(ut),Gr(()=>uc(...ut.map(yt=>yt.onSelectionChange)))):this._ngZone.onStable.pipe($c(1),Gr(()=>this.optionSelectionChanges))}),this.openedChange=new oi,this._openedStream=this.openedChange.pipe(Os(ut=>ut),dn(()=>{})),this._closedStream=this.openedChange.pipe(Os(ut=>!ut),dn(()=>{})),this.selectionChange=new oi,this.valueChange=new oi,this._trackedModal=null,this.ngControl&&(this.ngControl.valueAccessor=this),null!=Q?.typeaheadDebounceInterval&&(this._typeaheadDebounceInterval=Q.typeaheadDebounceInterval),this._scrollStrategyFactory=$,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(B)||0,this.id=this.id}ngOnInit(){this._selectionModel=new Wq(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(Ku(),Da(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen))}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Da(this._destroy)).subscribe(i=>{i.added.forEach(s=>s.select()),i.removed.forEach(s=>s.deselect())}),this.options.changes.pipe(cI(null),Da(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const i=this._getTriggerAriaLabelledby(),s=this.ngControl;if(i!==this._triggerAriaLabelledBy){const c=this._elementRef.nativeElement;this._triggerAriaLabelledBy=i,i?c.setAttribute("aria-labelledby",i):c.removeAttribute("aria-labelledby")}s&&(this._previousControl!==s.control&&(void 0!==this._previousControl&&null!==s.disabled&&s.disabled!==this.disabled&&(this.disabled=s.disabled),this._previousControl=s.control),this.updateErrorState())}ngOnChanges(i){(i.disabled||i.userAriaDescribedBy)&&this.stateChanges.next(),i.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._keyManager?.destroy(),this._destroy.next(),this._destroy.complete(),this.stateChanges.complete(),this._clearFromModal()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._applyModalPanelOwnership(),this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck())}_applyModalPanelOwnership(){const i=this._elementRef.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!i)return;const s=`${this.id}-panel`;this._trackedModal&&Dz(this._trackedModal,"aria-owns",s),function t$(e,o,i){const s=Iz(e,o);s.some(c=>c.trim()==i.trim())||(s.push(i.trim()),e.setAttribute(o,s.join(" ")))}(i,"aria-owns",s),this._trackedModal=i}_clearFromModal(){this._trackedModal&&(Dz(this._trackedModal,"aria-owns",`${this.id}-panel`),this._trackedModal=null)}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(i){this._assignValue(i)}registerOnChange(i){this._onChange=i}registerOnTouched(i){this._onTouched=i}setDisabledState(i){this.disabled=i,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel?.selected||[]:this._selectionModel?.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){const i=this._selectionModel.selected.map(s=>s.viewValue);return this._isRtl()&&i.reverse(),i.join(", ")}return this._selectionModel.selected[0].viewValue}_isRtl(){return!!this._dir&&"rtl"===this._dir.value}_handleKeydown(i){this.disabled||(this.panelOpen?this._handleOpenKeydown(i):this._handleClosedKeydown(i))}_handleClosedKeydown(i){const s=i.keyCode,c=40===s||38===s||37===s||39===s,f=13===s||32===s,g=this._keyManager;if(!g.isTyping()&&f&&!Ow(i)||(this.multiple||i.altKey)&&c)i.preventDefault(),this.open();else if(!this.multiple){const v=this.selected;g.onKeydown(i);const w=this.selected;w&&v!==w&&this._liveAnnouncer.announce(w.viewValue,1e4)}}_handleOpenKeydown(i){const s=this._keyManager,c=i.keyCode,f=40===c||38===c,g=s.isTyping();if(f&&i.altKey)i.preventDefault(),this.close();else if(g||13!==c&&32!==c||!s.activeItem||Ow(i))if(!g&&this._multiple&&65===c&&i.ctrlKey){i.preventDefault();const v=this.options.some(w=>!w.disabled&&!w.selected);this.options.forEach(w=>{w.disabled||(v?w.select():w.deselect())})}else{const v=s.activeItemIndex;s.onKeydown(i),this._multiple&&f&&i.shiftKey&&s.activeItem&&s.activeItemIndex!==v&&s.activeItem._selectViaInteraction()}else i.preventDefault(),s.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,this._keyManager?.cancelTypeahead(),!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this._overlayDir.positionChange.pipe($c(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(i){if(this.options.forEach(s=>s.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&i)Array.isArray(i),i.forEach(s=>this._selectOptionByValue(s)),this._sortValues();else{const s=this._selectOptionByValue(i);s?this._keyManager.updateActiveItem(s):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(i){const s=this.options.find(c=>{if(this._selectionModel.isSelected(c))return!1;try{return null!=c.value&&this._compareWith(c.value,i)}catch{return!1}});return s&&this._selectionModel.select(s),s}_assignValue(i){return!!(i!==this._value||this._multiple&&Array.isArray(i))&&(this.options&&this._setSelectionByValue(i),this._value=i,!0)}_skipPredicate(i){return i.disabled}_initKeyManager(){this._keyManager=new r$(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withPageUpDown().withAllowedModifierKeys(["shiftKey"]).skipPredicate(this._skipPredicate),this._keyManager.tabOut.subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const i=uc(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Da(i)).subscribe(s=>{this._onSelect(s.source,s.isUserInput),s.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),uc(...this.options.map(s=>s._stateChanges)).pipe(Da(i)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this.stateChanges.next()})}_onSelect(i,s){const c=this._selectionModel.isSelected(i);null!=i.value||this._multiple?(c!==i.selected&&(i.selected?this._selectionModel.select(i):this._selectionModel.deselect(i)),s&&this._keyManager.setActiveItem(i),this.multiple&&(this._sortValues(),s&&this.focus())):(i.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(i.value)),c!==this._selectionModel.isSelected(i)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const i=this.options.toArray();this._selectionModel.sort((s,c)=>this.sortComparator?this.sortComparator(s,c,i):i.indexOf(s)-i.indexOf(c)),this.stateChanges.next()}}_propagateChanges(i){let s=null;s=this.multiple?this.selected.map(c=>c.value):this.selected?this.selected.value:i,this._value=s,this.valueChange.emit(s),this._onChange(s),this.selectionChange.emit(this._getChangeEvent(s)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){if(this._keyManager)if(this.empty){let i=-1;for(let s=0;s<this.options.length;s++)if(!this.options.get(s).disabled){i=s;break}this._keyManager.setActiveItem(i)}else this._keyManager.setActiveItem(this._selectionModel.selected[0])}_canOpen(){return!this._panelOpen&&!this.disabled&&this.options?.length>0}focus(i){this._elementRef.nativeElement.focus(i)}_getPanelAriaLabelledby(){if(this.ariaLabel)return null;const i=this._parentFormField?.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){if(this.ariaLabel)return null;const i=this._parentFormField?.getLabelId();let s=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(s+=" "+this.ariaLabelledby),s}_panelDoneAnimating(i){this.openedChange.emit(i)}setDescribedByIds(i){i.length?this._elementRef.nativeElement.setAttribute("aria-describedby",i.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this._panelOpen||!this.empty||this._focused&&!!this._placeholder}static#t=this.\u0275fac=function(s){return new(s||e)(_t(wk),_t(Le),_t(Xe),_t(Uz),_t(Oi),_t(dI,8),_t(Iw,8),_t(Aw,8),_t(Ik,8),_t(Uu,10),fd("tabindex"),_t(NB),_t(_$),_t(o7,8))};static#e=this.\u0275dir=Ee({type:e,viewQuery:function(s,c){if(1&s&&(Ta(Zq,5),Ta(Xq,5),Ta(SB,5)),2&s){let f;br(f=rr())&&(c.trigger=f.first),br(f=rr())&&(c.panel=f.first),br(f=rr())&&(c._overlayDir=f.first)}},inputs:{userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",disableOptionCentering:"disableOptionCentering",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},features:[jn,qo]})}return e})(),d7=(()=>{class e extends u7{constructor(){super(...arguments),this.panelWidth=this._defaultOptions&&typeof this._defaultOptions.panelWidth<"u"?this._defaultOptions.panelWidth:"auto",this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:"mat-mdc-select-panel-above"}],this._hideSingleSelectionIndicator=this._defaultOptions?.hideSingleSelectionIndicator??!1,this._skipPredicate=i=>!this.panelOpen&&i.disabled}get shouldLabelFloat(){return this.panelOpen||!this.empty||this.focused&&!!this.placeholder}ngOnInit(){super.ngOnInit(),this._viewportRuler.change().pipe(Da(this._destroy)).subscribe(()=>{this.panelOpen&&(this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),this._changeDetectorRef.detectChanges())})}open(){this._parentFormField&&(this._preferredOverlayOrigin=this._parentFormField.getConnectedOverlayOrigin()),this._overlayWidth=this._getOverlayWidth(this._preferredOverlayOrigin),super.open(),this.stateChanges.next()}close(){super.close(),this.stateChanges.next()}_scrollOptionIntoView(i){const s=this.options.toArray()[i];if(s){const c=this.panel.nativeElement,f=function $$(e,o,i){if(i.length){let s=o.toArray(),c=i.toArray(),f=0;for(let g=0;g<e+1;g++)s[g].group&&s[g].group===c[f]&&f++;return f}return 0}(i,this.options,this.optionGroups),g=s._getHostElement();c.scrollTop=0===i&&1===f?0:function G$(e,o,i,s){return e<i?e:e+o>i+s?Math.max(0,e-s+o):i}(g.offsetTop,g.offsetHeight,c.scrollTop,c.offsetHeight)}}_positioningSettled(){this._scrollOptionIntoView(this._keyManager.activeItemIndex||0)}_getChangeEvent(i){return new l7(this,i)}_getOverlayWidth(i){return"auto"===this.panelWidth?(i instanceof Sk?i.elementRef:i||this._elementRef).nativeElement.getBoundingClientRect().width:null===this.panelWidth?"":this.panelWidth}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(i){this._hideSingleSelectionIndicator=Lo(i),this._syncParentProperties()}_syncParentProperties(){if(this.options)for(const i of this.options)i._changeDetectorRef.markForCheck()}static#t=this.\u0275fac=function(){let i;return function(c){return(i||(i=xr(e)))(c||e)}}();static#e=this.\u0275cmp=os({type:e,selectors:[["mat-select"]],contentQueries:function(s,c,f){if(1&s&&(Qs(f,a7,5),Qs(f,Qz,5),Qs(f,Jz,5)),2&s){let g;br(g=rr())&&(c.customTrigger=g.first),br(g=rr())&&(c.options=g),br(g=rr())&&(c.optionGroups=g)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","listbox","ngSkipHydration","",1,"mat-mdc-select"],hostVars:19,hostBindings:function(s,c){1&s&&cr("keydown",function(g){return c._handleKeydown(g)})("focus",function(){return c._onFocus()})("blur",function(){return c._onBlur()}),2&s&&(ro("id",c.id)("tabindex",c.tabIndex)("aria-controls",c.panelOpen?c.id+"-panel":null)("aria-expanded",c.panelOpen)("aria-label",c.ariaLabel||null)("aria-required",c.required.toString())("aria-disabled",c.disabled.toString())("aria-invalid",c.errorState)("aria-activedescendant",c._getAriaActiveDescendant()),Ir("mat-mdc-select-disabled",c.disabled)("mat-mdc-select-invalid",c.errorState)("mat-mdc-select-required",c.required)("mat-mdc-select-empty",c.empty)("mat-mdc-select-multiple",c.multiple))},inputs:{disabled:"disabled",disableRipple:"disableRipple",tabIndex:"tabIndex",panelWidth:"panelWidth",hideSingleSelectionIndicator:"hideSingleSelectionIndicator"},exportAs:["matSelect"],features:[Wi([{provide:Dk,useExisting:e},{provide:Kz,useExisting:e}]),jn],ngContentSelectors:n7,decls:11,vars:10,consts:[["cdk-overlay-origin","",1,"mat-mdc-select-trigger",3,"click"],["fallbackOverlayOrigin","cdkOverlayOrigin","trigger",""],[1,"mat-mdc-select-value",3,"ngSwitch"],["class","mat-mdc-select-placeholder mat-mdc-select-min-line",4,"ngSwitchCase"],["class","mat-mdc-select-value-text",3,"ngSwitch",4,"ngSwitchCase"],[1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],["viewBox","0 0 24 24","width","24px","height","24px","focusable","false","aria-hidden","true"],["d","M7 10l5 5 5-5z"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","backdropClick","attach","detach"],[1,"mat-mdc-select-placeholder","mat-mdc-select-min-line"],[1,"mat-mdc-select-value-text",3,"ngSwitch"],["class","mat-mdc-select-min-line",4,"ngSwitchDefault"],[4,"ngSwitchCase"],[1,"mat-mdc-select-min-line"],["role","listbox","tabindex","-1",3,"ngClass","keydown"],["panel",""]],template:function(s,c){if(1&s&&(Fc(e7),un(0,"div",0,1),cr("click",function(){return c.toggle()}),un(3,"div",2),Ji(4,Yq,2,1,"span",3),Ji(5,Qq,3,2,"span",4),mn(),un(6,"div",5)(7,"div",6),Pl(),un(8,"svg",7),oo(9,"path",8),mn()()()(),Ji(10,t7,3,9,"ng-template",9),cr("backdropClick",function(){return c.close()})("attach",function(){return c._onAttached()})("detach",function(){return c.close()})),2&s){const f=Bm(1);pn(3),Cn("ngSwitch",c.empty),ro("id",c._valueId),pn(1),Cn("ngSwitchCase",!0),pn(1),Cn("ngSwitchCase",!1),pn(5),Cn("cdkConnectedOverlayPanelClass",c._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",c._scrollStrategy)("cdkConnectedOverlayOrigin",c._preferredOverlayOrigin||f)("cdkConnectedOverlayOpen",c.panelOpen)("cdkConnectedOverlayPositions",c._positions)("cdkConnectedOverlayWidth",c._overlayWidth)}},dependencies:[AL,mw,YP,kL,SB,Sk],styles:['.mat-mdc-select{display:inline-block;width:100%;outline:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-select-enabled-trigger-text-color);font-family:var(--mat-select-trigger-text-font);line-height:var(--mat-select-trigger-text-line-height);font-size:var(--mat-select-trigger-text-size);font-weight:var(--mat-select-trigger-text-weight);letter-spacing:var(--mat-select-trigger-text-tracking)}.mat-mdc-select-disabled{color:var(--mat-select-disabled-trigger-text-color)}.mat-mdc-select-trigger{display:inline-flex;align-items:center;cursor:pointer;position:relative;box-sizing:border-box;width:100%}.mat-mdc-select-disabled .mat-mdc-select-trigger{-webkit-user-select:none;user-select:none;cursor:default}.mat-mdc-select-value{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-mdc-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-mdc-select-arrow-wrapper{height:24px;flex-shrink:0;display:inline-flex;align-items:center}.mat-form-field-appearance-fill .mat-mdc-select-arrow-wrapper{transform:translateY(-8px)}.mat-form-field-appearance-fill .mdc-text-field--no-label .mat-mdc-select-arrow-wrapper{transform:none}.mat-mdc-select-arrow{width:10px;height:5px;position:relative;color:var(--mat-select-enabled-arrow-color)}.mat-mdc-form-field.mat-focused .mat-mdc-select-arrow{color:var(--mat-select-focused-arrow-color)}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-invalid .mat-mdc-select-arrow{color:var(--mat-select-invalid-arrow-color)}.mat-mdc-form-field .mat-mdc-select.mat-mdc-select-disabled .mat-mdc-select-arrow{color:var(--mat-select-disabled-arrow-color)}.mat-mdc-select-arrow svg{fill:currentColor;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:CanvasText}.mat-mdc-select-disabled .cdk-high-contrast-active .mat-mdc-select-arrow svg{fill:GrayText}div.mat-mdc-select-panel{box-shadow:0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12);width:100%;max-height:275px;outline:0;overflow:auto;padding:8px 0;border-radius:4px;box-sizing:border-box;position:static;background-color:var(--mat-select-panel-background-color)}.cdk-high-contrast-active div.mat-mdc-select-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-select-panel-above) div.mat-mdc-select-panel{border-top-left-radius:0;border-top-right-radius:0;transform-origin:top center}.mat-mdc-select-panel-above div.mat-mdc-select-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:bottom center}.mat-mdc-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1);color:var(--mat-select-placeholder-text-color)}._mat-animation-noopable .mat-mdc-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-mdc-select-placeholder{color:rgba(0,0,0,0);-webkit-text-fill-color:rgba(0,0,0,0);transition:none;display:block}.mat-mdc-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper{cursor:pointer}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mat-mdc-floating-label{max-width:calc(100% - 18px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-fill .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 24px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mat-mdc-form-field-type-mat-select.mat-form-field-appearance-outline .mdc-text-field--label-floating .mdc-notched-outline__notch{max-width:calc(100% - 24px)}.mat-mdc-select-min-line:empty::before{content:" ";white-space:pre;width:1px;display:inline-block;visibility:hidden}'],encapsulation:2,data:{animation:[i7.transformPanel]},changeDetection:0})}return e})(),h7=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({providers:[s7],imports:[ED,oq,tB,Ia,Ek,bI,tB,Ia]})}return e})();const zB=Pw({passive:!0});let f7=(()=>{class e{constructor(i,s){this._platform=i,this._ngZone=s,this._monitoredElements=new Map}monitor(i){if(!this._platform.isBrowser)return ca;const s=Jf(i),c=this._monitoredElements.get(s);if(c)return c.subject;const f=new on,g="cdk-text-field-autofilled",v=w=>{"cdk-text-field-autofill-start"!==w.animationName||s.classList.contains(g)?"cdk-text-field-autofill-end"===w.animationName&&s.classList.contains(g)&&(s.classList.remove(g),this._ngZone.run(()=>f.next({target:w.target,isAutofilled:!1}))):(s.classList.add(g),this._ngZone.run(()=>f.next({target:w.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{s.addEventListener("animationstart",v,zB),s.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(s,{subject:f,unlisten:()=>{s.removeEventListener("animationstart",v,zB)}}),f}stopMonitoring(i){const s=Jf(i),c=this._monitoredElements.get(s);c&&(c.unlisten(),c.subject.complete(),s.classList.remove("cdk-text-field-autofill-monitored"),s.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(s))}ngOnDestroy(){this._monitoredElements.forEach((i,s)=>this.stopMonitoring(s))}static#t=this.\u0275fac=function(s){return new(s||e)(bt(oa),bt(Xe))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),p7=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({})}return e})();const m7=new $t("MAT_INPUT_VALUE_ACCESSOR"),g7=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let _7=0;const y7=jz(class{constructor(e,o,i,s){this._defaultErrorStateMatcher=e,this._parentForm=o,this._parentFormGroup=i,this.ngControl=s,this.stateChanges=new on}});let v7=(()=>{class e extends y7{get disabled(){return this._disabled}set disabled(i){this._disabled=Lo(i),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(i){this._id=i||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(p3.required)??!1}set required(i){this._required=Lo(i)}get type(){return this._type}set type(i){this._type=i||"text",this._validateType(),!this._isTextarea&&_z().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(i){i!==this.value&&(this._inputValueAccessor.value=i,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(i){this._readonly=Lo(i)}constructor(i,s,c,f,g,v,w,T,A,k){super(v,f,g,c),this._elementRef=i,this._platform=s,this._autofillMonitor=T,this._formField=k,this._uid="mat-input-"+_7++,this.focused=!1,this.stateChanges=new on,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(K=>_z().has(K)),this._iOSKeyupListener=K=>{const Q=K.target;!Q.value&&0===Q.selectionStart&&0===Q.selectionEnd&&(Q.setSelectionRange(1,1),Q.setSelectionRange(0,0))};const B=this._elementRef.nativeElement,$=B.nodeName.toLowerCase();this._inputValueAccessor=w||B,this._previousNativeValue=this.value,this.id=this.id,s.IOS&&A.runOutsideAngular(()=>{i.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===$,this._isTextarea="textarea"===$,this._isInFormField=!!k,this._isNativeSelect&&(this.controlType=B.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(i=>{this.autofilled=i.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(i){this._elementRef.nativeElement.focus(i)}_focusChanged(i){i!==this.focused&&(this.focused=i,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const i=this._elementRef.nativeElement.value;this._previousNativeValue!==i&&(this._previousNativeValue=i,this.stateChanges.next())}_dirtyCheckPlaceholder(){const i=this._getPlaceholder();if(i!==this._previousPlaceholder){const s=this._elementRef.nativeElement;this._previousPlaceholder=i,i?s.setAttribute("placeholder",i):s.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){g7.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let i=this._elementRef.nativeElement.validity;return i&&i.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const i=this._elementRef.nativeElement,s=i.options[0];return this.focused||i.multiple||!this.empty||!!(i.selectedIndex>-1&&s&&s.label)}return this.focused||!this.empty}setDescribedByIds(i){i.length?this._elementRef.nativeElement.setAttribute("aria-describedby",i.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const i=this._elementRef.nativeElement;return this._isNativeSelect&&(i.multiple||i.size>1)}static#t=this.\u0275fac=function(s){return new(s||e)(_t(Oi),_t(oa),_t(Uu,10),_t(Iw,8),_t(Aw,8),_t(Uz),_t(m7,10),_t(f7),_t(Xe),_t(Ik,8))};static#e=this.\u0275dir=Ee({type:e,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(s,c){1&s&&cr("focus",function(){return c._focusChanged(!0)})("blur",function(){return c._focusChanged(!1)})("input",function(){return c._onInput()}),2&s&&(Df("id",c.id)("disabled",c.disabled)("required",c.required),ro("name",c.name||null)("readonly",c.readonly&&!c._isNativeSelect||null)("aria-invalid",c.empty&&c.required?null:c.errorState)("aria-required",c.required)("id",c.id),Ir("mat-input-server",c._isServer)("mat-mdc-form-field-textarea-control",c._isInFormField&&c._isTextarea)("mat-mdc-form-field-input-control",c._isInFormField)("mdc-text-field__input",c._isInFormField)("mat-mdc-native-select-inline",c._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],features:[Wi([{provide:Dk,useExisting:e}]),jn,qo]})}return e})(),x7=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[Ia,bI,bI,p7,Ia]})}return e})();const wI=rp(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Rk(){return ar((e,o)=>{let i=null;e._refCount++;const s=Di(o,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(i=null);const c=e._connection,f=i;i=null,c&&(!f||c===f)&&c.unsubscribe(),o.unsubscribe()});e.subscribe(s),s.closed||(i=e.connect())})}class BB extends $n{constructor(o,i){super(),this.source=o,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,ns(o)&&(this.lift=o.lift)}_subscribe(o){return this.getSubject().subscribe(o)}getSubject(){const o=this._subject;return(!o||o.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:o}=this;this._subject=this._connection=null,o?.unsubscribe()}connect(){let o=this._connection;if(!o){o=this._connection=new st;const i=this.getSubject();o.add(this.source.subscribe(Di(i,void 0,()=>{this._teardown(),i.complete()},s=>{this._teardown(),i.error(s)},()=>this._teardown()))),o.closed&&(this._connection=null,o=st.EMPTY)}return o}refCount(){return Rk()(this)}}function EI(e){return ar((o,i)=>{let s=!1;o.subscribe(Di(i,c=>{s=!0,i.next(c)},()=>{s||i.next(e),i.complete()}))})}function VB(e=w7){return ar((o,i)=>{let s=!1;o.subscribe(Di(i,c=>{s=!0,i.next(c)},()=>s?i.complete():i.error(e())))})}function w7(){return new wI}function Rg(e,o){const i=arguments.length>=2;return s=>s.pipe(e?Os((c,f)=>e(c,f,s)):xl,$c(1),i?EI(o):VB(()=>new wI))}function Pk(e){return e<=0?()=>ca:ar((o,i)=>{let s=[];o.subscribe(Di(i,c=>{s.push(c),e<s.length&&s.shift()},()=>{for(const c of s)i.next(c);i.complete()},void 0,()=>{s=null}))})}const An="primary",Bw=Symbol("RouteTitle");class T7{constructor(o){this.params=o||{}}has(o){return Object.prototype.hasOwnProperty.call(this.params,o)}get(o){if(this.has(o)){const i=this.params[o];return Array.isArray(i)?i[0]:i}return null}getAll(o){if(this.has(o)){const i=this.params[o];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function Yv(e){return new T7(e)}function D7(e,o,i){const s=i.path.split("/");if(s.length>e.length||"full"===i.pathMatch&&(o.hasChildren()||s.length<e.length))return null;const c={};for(let f=0;f<s.length;f++){const g=s[f],v=e[f];if(g.startsWith(":"))c[g.substring(1)]=v;else if(g!==v.path)return null}return{consumed:e.slice(0,s.length),posParams:c}}function Hu(e,o){const i=e?Object.keys(e):void 0,s=o?Object.keys(o):void 0;if(!i||!s||i.length!=s.length)return!1;let c;for(let f=0;f<i.length;f++)if(c=i[f],!jB(e[c],o[c]))return!1;return!0}function jB(e,o){if(Array.isArray(e)&&Array.isArray(o)){if(e.length!==o.length)return!1;const i=[...e].sort(),s=[...o].sort();return i.every((c,f)=>s[f]===c)}return e===o}function UB(e){return e.length>0?e[e.length-1]:null}function tp(e){return function b7(e){return!!e&&(e instanceof $n||qn(e.lift)&&qn(e.subscribe))}(e)?e:Ef(e)?Pr(Promise.resolve(e)):kt(e)}const A7={exact:function GB(e,o,i){if(!Pg(e.segments,o.segments)||!CI(e.segments,o.segments,i)||e.numberOfChildren!==o.numberOfChildren)return!1;for(const s in o.children)if(!e.children[s]||!GB(e.children[s],o.children[s],i))return!1;return!0},subset:qB},HB={exact:function R7(e,o){return Hu(e,o)},subset:function P7(e,o){return Object.keys(o).length<=Object.keys(e).length&&Object.keys(o).every(i=>jB(e[i],o[i]))},ignored:()=>!0};function $B(e,o,i){return A7[i.paths](e.root,o.root,i.matrixParams)&&HB[i.queryParams](e.queryParams,o.queryParams)&&!("exact"===i.fragment&&e.fragment!==o.fragment)}function qB(e,o,i){return WB(e,o,o.segments,i)}function WB(e,o,i,s){if(e.segments.length>i.length){const c=e.segments.slice(0,i.length);return!(!Pg(c,i)||o.hasChildren()||!CI(c,i,s))}if(e.segments.length===i.length){if(!Pg(e.segments,i)||!CI(e.segments,i,s))return!1;for(const c in o.children)if(!e.children[c]||!qB(e.children[c],o.children[c],s))return!1;return!0}{const c=i.slice(0,e.segments.length),f=i.slice(e.segments.length);return!!(Pg(e.segments,c)&&CI(e.segments,c,s)&&e.children[An])&&WB(e.children[An],o,f,s)}}function CI(e,o,i){return o.every((s,c)=>HB[i](e[c].parameters,s.parameters))}class Kv{constructor(o=new Zi([],{}),i={},s=null){this.root=o,this.queryParams=i,this.fragment=s}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Yv(this.queryParams)),this._queryParamMap}toString(){return F7.serialize(this)}}class Zi{constructor(o,i){this.segments=o,this.children=i,this.parent=null,Object.values(i).forEach(s=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return MI(this)}}class Vw{constructor(o,i){this.path=o,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=Yv(this.parameters)),this._parameterMap}toString(){return YB(this)}}function Pg(e,o){return e.length===o.length&&e.every((i,s)=>i.path===o[s].path)}let jw=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:function(){return new Ok},providedIn:"root"})}return e})();class Ok{parse(o){const i=new q7(o);return new Kv(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(o){const i=`/${Uw(o.root,!0)}`,s=function z7(e){const o=Object.keys(e).map(i=>{const s=e[i];return Array.isArray(s)?s.map(c=>`${SI(i)}=${SI(c)}`).join("&"):`${SI(i)}=${SI(s)}`}).filter(i=>!!i);return o.length?`?${o.join("&")}`:""}(o.queryParams);return`${i}${s}${"string"==typeof o.fragment?`#${function L7(e){return encodeURI(e)}(o.fragment)}`:""}`}}const F7=new Ok;function MI(e){return e.segments.map(o=>YB(o)).join("/")}function Uw(e,o){if(!e.hasChildren())return MI(e);if(o){const i=e.children[An]?Uw(e.children[An],!1):"",s=[];return Object.entries(e.children).forEach(([c,f])=>{c!==An&&s.push(`${c}:${Uw(f,!1)}`)}),s.length>0?`${i}(${s.join("//")})`:i}{const i=function k7(e,o){let i=[];return Object.entries(e.children).forEach(([s,c])=>{s===An&&(i=i.concat(o(c,s)))}),Object.entries(e.children).forEach(([s,c])=>{s!==An&&(i=i.concat(o(c,s)))}),i}(e,(s,c)=>c===An?[Uw(e.children[An],!1)]:[`${c}:${Uw(s,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[An]?`${MI(e)}/${i[0]}`:`${MI(e)}/(${i.join("//")})`}}function ZB(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function SI(e){return ZB(e).replace(/%3B/gi,";")}function kk(e){return ZB(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function TI(e){return decodeURIComponent(e)}function XB(e){return TI(e.replace(/\+/g,"%20"))}function YB(e){return`${kk(e.path)}${function N7(e){return Object.keys(e).map(o=>`;${kk(o)}=${kk(e[o])}`).join("")}(e.parameters)}`}const B7=/^[^\/()?;#]+/;function Fk(e){const o=e.match(B7);return o?o[0]:""}const V7=/^[^\/()?;=#]+/,U7=/^[^=?&#]+/,$7=/^[^&#]+/;class q7{constructor(o){this.url=o,this.remaining=o}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Zi([],{}):new Zi([],this.parseChildren())}parseQueryParams(){const o={};if(this.consumeOptional("?"))do{this.parseQueryParam(o)}while(this.consumeOptional("&"));return o}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const o=[];for(this.peekStartsWith("(")||o.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),o.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(o.length>0||Object.keys(i).length>0)&&(s[An]=new Zi(o,i)),s}parseSegment(){const o=Fk(this.remaining);if(""===o&&this.peekStartsWith(";"))throw new at(4009,!1);return this.capture(o),new Vw(TI(o),this.parseMatrixParams())}parseMatrixParams(){const o={};for(;this.consumeOptional(";");)this.parseParam(o);return o}parseParam(o){const i=function j7(e){const o=e.match(V7);return o?o[0]:""}(this.remaining);if(!i)return;this.capture(i);let s="";if(this.consumeOptional("=")){const c=Fk(this.remaining);c&&(s=c,this.capture(s))}o[TI(i)]=TI(s)}parseQueryParam(o){const i=function H7(e){const o=e.match(U7);return o?o[0]:""}(this.remaining);if(!i)return;this.capture(i);let s="";if(this.consumeOptional("=")){const g=function G7(e){const o=e.match($7);return o?o[0]:""}(this.remaining);g&&(s=g,this.capture(s))}const c=XB(i),f=XB(s);if(o.hasOwnProperty(c)){let g=o[c];Array.isArray(g)||(g=[g],o[c]=g),g.push(f)}else o[c]=f}parseParens(o){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const s=Fk(this.remaining),c=this.remaining[s.length];if("/"!==c&&")"!==c&&";"!==c)throw new at(4010,!1);let f;s.indexOf(":")>-1?(f=s.slice(0,s.indexOf(":")),this.capture(f),this.capture(":")):o&&(f=An);const g=this.parseChildren();i[f]=1===Object.keys(g).length?g[An]:new Zi([],g),this.consumeOptional("//")}return i}peekStartsWith(o){return this.remaining.startsWith(o)}consumeOptional(o){return!!this.peekStartsWith(o)&&(this.remaining=this.remaining.substring(o.length),!0)}capture(o){if(!this.consumeOptional(o))throw new at(4011,!1)}}function KB(e){return e.segments.length>0?new Zi([],{[An]:e}):e}function JB(e){const o={};for(const s of Object.keys(e.children)){const f=JB(e.children[s]);if(s===An&&0===f.segments.length&&f.hasChildren())for(const[g,v]of Object.entries(f.children))o[g]=v;else(f.segments.length>0||f.hasChildren())&&(o[s]=f)}return function W7(e){if(1===e.numberOfChildren&&e.children[An]){const o=e.children[An];return new Zi(e.segments.concat(o.segments),o.children)}return e}(new Zi(e.segments,o))}function Og(e){return e instanceof Kv}function QB(e){let o;const c=KB(function i(f){const g={};for(const w of f.children){const T=i(w);g[w.outlet]=T}const v=new Zi(f.url,g);return f===e&&(o=v),v}(e.root));return o??c}function t4(e,o,i,s){let c=e;for(;c.parent;)c=c.parent;if(0===o.length)return Lk(c,c,c,i,s);const f=function X7(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new n4(!0,0,e);let o=0,i=!1;const s=e.reduce((c,f,g)=>{if("object"==typeof f&&null!=f){if(f.outlets){const v={};return Object.entries(f.outlets).forEach(([w,T])=>{v[w]="string"==typeof T?T.split("/"):T}),[...c,{outlets:v}]}if(f.segmentPath)return[...c,f.segmentPath]}return"string"!=typeof f?[...c,f]:0===g?(f.split("/").forEach((v,w)=>{0==w&&"."===v||(0==w&&""===v?i=!0:".."===v?o++:""!=v&&c.push(v))}),c):[...c,f]},[]);return new n4(i,o,s)}(o);if(f.toRoot())return Lk(c,c,new Zi([],{}),i,s);const g=function Y7(e,o,i){if(e.isAbsolute)return new II(o,!0,0);if(!i)return new II(o,!1,NaN);if(null===i.parent)return new II(i,!0,0);const s=DI(e.commands[0])?0:1;return function K7(e,o,i){let s=e,c=o,f=i;for(;f>c;){if(f-=c,s=s.parent,!s)throw new at(4005,!1);c=s.segments.length}return new II(s,!1,c-f)}(i,i.segments.length-1+s,e.numberOfDoubleDots)}(f,c,e),v=g.processChildren?$w(g.segmentGroup,g.index,f.commands):i4(g.segmentGroup,g.index,f.commands);return Lk(c,g.segmentGroup,v,i,s)}function DI(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Hw(e){return"object"==typeof e&&null!=e&&e.outlets}function Lk(e,o,i,s,c){let g,f={};s&&Object.entries(s).forEach(([w,T])=>{f[w]=Array.isArray(T)?T.map(A=>`${A}`):`${T}`}),g=e===o?i:e4(e,o,i);const v=KB(JB(g));return new Kv(v,f,c)}function e4(e,o,i){const s={};return Object.entries(e.children).forEach(([c,f])=>{s[c]=f===o?i:e4(f,o,i)}),new Zi(e.segments,s)}class n4{constructor(o,i,s){if(this.isAbsolute=o,this.numberOfDoubleDots=i,this.commands=s,o&&s.length>0&&DI(s[0]))throw new at(4003,!1);const c=s.find(Hw);if(c&&c!==UB(s))throw new at(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class II{constructor(o,i,s){this.segmentGroup=o,this.processChildren=i,this.index=s}}function i4(e,o,i){if(e||(e=new Zi([],{})),0===e.segments.length&&e.hasChildren())return $w(e,o,i);const s=function Q7(e,o,i){let s=0,c=o;const f={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(s>=i.length)return f;const g=e.segments[c],v=i[s];if(Hw(v))break;const w=`${v}`,T=s<i.length-1?i[s+1]:null;if(c>0&&void 0===w)break;if(w&&T&&"object"==typeof T&&void 0===T.outlets){if(!o4(w,T,g))return f;s+=2}else{if(!o4(w,{},g))return f;s++}c++}return{match:!0,pathIndex:c,commandIndex:s}}(e,o,i),c=i.slice(s.commandIndex);if(s.match&&s.pathIndex<e.segments.length){const f=new Zi(e.segments.slice(0,s.pathIndex),{});return f.children[An]=new Zi(e.segments.slice(s.pathIndex),e.children),$w(f,0,c)}return s.match&&0===c.length?new Zi(e.segments,{}):s.match&&!e.hasChildren()?Nk(e,o,i):s.match?$w(e,0,c):Nk(e,o,i)}function $w(e,o,i){if(0===i.length)return new Zi(e.segments,{});{const s=function J7(e){return Hw(e[0])?e[0].outlets:{[An]:e}}(i),c={};if(Object.keys(s).some(f=>f!==An)&&e.children[An]&&1===e.numberOfChildren&&0===e.children[An].segments.length){const f=$w(e.children[An],o,i);return new Zi(e.segments,f.children)}return Object.entries(s).forEach(([f,g])=>{"string"==typeof g&&(g=[g]),null!==g&&(c[f]=i4(e.children[f],o,g))}),Object.entries(e.children).forEach(([f,g])=>{void 0===s[f]&&(c[f]=g)}),new Zi(e.segments,c)}}function Nk(e,o,i){const s=e.segments.slice(0,o);let c=0;for(;c<i.length;){const f=i[c];if(Hw(f)){const w=t9(f.outlets);return new Zi(s,w)}if(0===c&&DI(i[0])){s.push(new Vw(e.segments[o].path,r4(i[0]))),c++;continue}const g=Hw(f)?f.outlets[An]:`${f}`,v=c<i.length-1?i[c+1]:null;g&&v&&DI(v)?(s.push(new Vw(g,r4(v))),c+=2):(s.push(new Vw(g,{})),c++)}return new Zi(s,{})}function t9(e){const o={};return Object.entries(e).forEach(([i,s])=>{"string"==typeof s&&(s=[s]),null!==s&&(o[i]=Nk(new Zi([],{}),0,s))}),o}function r4(e){const o={};return Object.entries(e).forEach(([i,s])=>o[i]=`${s}`),o}function o4(e,o,i){return e==i.path&&Hu(o,i.parameters)}const Gw="imperative";class $u{constructor(o,i){this.id=o,this.url=i}}class AI extends $u{constructor(o,i,s="imperative",c=null){super(o,i),this.type=0,this.navigationTrigger=s,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ep extends $u{constructor(o,i,s){super(o,i),this.urlAfterRedirects=s,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class qw extends $u{constructor(o,i,s,c){super(o,i),this.reason=s,this.code=c,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Jv extends $u{constructor(o,i,s,c){super(o,i),this.reason=s,this.code=c,this.type=16}}class RI extends $u{constructor(o,i,s,c){super(o,i),this.error=s,this.target=c,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class s4 extends $u{constructor(o,i,s,c){super(o,i),this.urlAfterRedirects=s,this.state=c,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class e9 extends $u{constructor(o,i,s,c){super(o,i),this.urlAfterRedirects=s,this.state=c,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class n9 extends $u{constructor(o,i,s,c,f){super(o,i),this.urlAfterRedirects=s,this.state=c,this.shouldActivate=f,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class i9 extends $u{constructor(o,i,s,c){super(o,i),this.urlAfterRedirects=s,this.state=c,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class r9 extends $u{constructor(o,i,s,c){super(o,i),this.urlAfterRedirects=s,this.state=c,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class o9{constructor(o){this.route=o,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class s9{constructor(o){this.route=o,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class a9{constructor(o){this.snapshot=o,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class l9{constructor(o){this.snapshot=o,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class c9{constructor(o){this.snapshot=o,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class u9{constructor(o){this.snapshot=o,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class a4{constructor(o,i,s){this.routerEvent=o,this.position=i,this.anchor=s,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class zk{}class Bk{constructor(o){this.url=o}}class d9{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Ww,this.attachRef=null}}let Ww=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(i,s){const c=this.getOrCreateContext(i);c.outlet=s,this.contexts.set(i,c)}onChildOutletDestroyed(i){const s=this.getContext(i);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){const i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let s=this.getContext(i);return s||(s=new d9,this.contexts.set(i,s)),s}getContext(i){return this.contexts.get(i)||null}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class l4{constructor(o){this._root=o}get root(){return this._root.value}parent(o){const i=this.pathFromRoot(o);return i.length>1?i[i.length-2]:null}children(o){const i=Vk(o,this._root);return i?i.children.map(s=>s.value):[]}firstChild(o){const i=Vk(o,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(o){const i=jk(o,this._root);return i.length<2?[]:i[i.length-2].children.map(c=>c.value).filter(c=>c!==o)}pathFromRoot(o){return jk(o,this._root).map(i=>i.value)}}function Vk(e,o){if(e===o.value)return o;for(const i of o.children){const s=Vk(e,i);if(s)return s}return null}function jk(e,o){if(e===o.value)return[o];for(const i of o.children){const s=jk(e,i);if(s.length)return s.unshift(o),s}return[]}class Zd{constructor(o,i){this.value=o,this.children=i}toString(){return`TreeNode(${this.value})`}}function Qv(e){const o={};return e&&e.children.forEach(i=>o[i.value.outlet]=i),o}class c4 extends l4{constructor(o,i){super(o),this.snapshot=i,Uk(this,o)}toString(){return this.snapshot.toString()}}function u4(e,o){const i=function h9(e,o){const g=new PI([],{},{},"",{},An,o,null,{});return new h4("",new Zd(g,[]))}(0,o),s=new $r([new Vw("",{})]),c=new $r({}),f=new $r({}),g=new $r({}),v=new $r(""),w=new t0(s,c,g,v,f,An,o,i.root);return w.snapshot=i.root,new c4(new Zd(w,[]),i)}class t0{constructor(o,i,s,c,f,g,v,w){this.urlSubject=o,this.paramsSubject=i,this.queryParamsSubject=s,this.fragmentSubject=c,this.dataSubject=f,this.outlet=g,this.component=v,this._futureSnapshot=w,this.title=this.dataSubject?.pipe(dn(T=>T[Bw]))??kt(void 0),this.url=o,this.params=i,this.queryParams=s,this.fragment=c,this.data=f}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(dn(o=>Yv(o)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(dn(o=>Yv(o)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function d4(e,o="emptyOnly"){const i=e.pathFromRoot;let s=0;if("always"!==o)for(s=i.length-1;s>=1;){const c=i[s],f=i[s-1];if(c.routeConfig&&""===c.routeConfig.path)s--;else{if(f.component)break;s--}}return function f9(e){return e.reduce((o,i)=>({params:{...o.params,...i.params},data:{...o.data,...i.data},resolve:{...i.data,...o.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(s))}class PI{get title(){return this.data?.[Bw]}constructor(o,i,s,c,f,g,v,w,T){this.url=o,this.params=i,this.queryParams=s,this.fragment=c,this.data=f,this.outlet=g,this.component=v,this.routeConfig=w,this._resolve=T}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Yv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Yv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(s=>s.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class h4 extends l4{constructor(o,i){super(i),this.url=o,Uk(this,i)}toString(){return f4(this._root)}}function Uk(e,o){o.value._routerState=e,o.children.forEach(i=>Uk(e,i))}function f4(e){const o=e.children.length>0?` { ${e.children.map(f4).join(", ")} } `:"";return`${e.value}${o}`}function Hk(e){if(e.snapshot){const o=e.snapshot,i=e._futureSnapshot;e.snapshot=i,Hu(o.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),o.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),Hu(o.params,i.params)||e.paramsSubject.next(i.params),function I7(e,o){if(e.length!==o.length)return!1;for(let i=0;i<e.length;++i)if(!Hu(e[i],o[i]))return!1;return!0}(o.url,i.url)||e.urlSubject.next(i.url),Hu(o.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function $k(e,o){const i=Hu(e.params,o.params)&&function O7(e,o){return Pg(e,o)&&e.every((i,s)=>Hu(i.parameters,o[s].parameters))}(e.url,o.url);return i&&!(!e.parent!=!o.parent)&&(!e.parent||$k(e.parent,o.parent))}let p4=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=An,this.activateEvents=new oi,this.deactivateEvents=new oi,this.attachEvents=new oi,this.detachEvents=new oi,this.parentContexts=ne(Ww),this.location=ne(ds),this.changeDetector=ne(Le),this.environmentInjector=ne(Ds),this.inputBinder=ne(OI,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(i){if(i.name){const{firstChange:s,previousValue:c}=i.name;if(s)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new at(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new at(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new at(4012,!1);this.location.detach();const i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,s){this.activated=i,this._activatedRoute=s,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){const i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,s){if(this.isActivated)throw new at(4013,!1);this._activatedRoute=i;const c=this.location,g=i.snapshot.component,v=this.parentContexts.getOrCreateContext(this.name).children,w=new p9(i,v,c.injector);this.activated=c.createComponent(g,{index:c.length,injector:w,environmentInjector:s??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275dir=Ee({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[qo]})}return e})();class p9{constructor(o,i,s){this.route=o,this.childContexts=i,this.parent=s}get(o,i){return o===t0?this.route:o===Ww?this.childContexts:this.parent.get(o,i)}}const OI=new $t("");let m4=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(i){this.unsubscribeFromRouteData(i),this.subscribeToRouteData(i)}unsubscribeFromRouteData(i){this.outletDataSubscriptions.get(i)?.unsubscribe(),this.outletDataSubscriptions.delete(i)}subscribeToRouteData(i){const{activatedRoute:s}=i,c=aI([s.queryParams,s.params,s.data]).pipe(Gr(([f,g,v],w)=>(v={...f,...g,...v},0===w?kt(v):Promise.resolve(v)))).subscribe(f=>{if(!i.isActivated||!i.activatedComponentRef||i.activatedRoute!==s||null===s.component)return void this.unsubscribeFromRouteData(i);const g=function S5(e){const o=Kn(e);if(!o)return null;const i=new uf(o);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return o.standalone},get isSignal(){return o.signals}}}(s.component);if(g)for(const{templateName:v}of g.inputs)i.activatedComponentRef.setInput(v,f[v]);else this.unsubscribeFromRouteData(i)});this.outletDataSubscriptions.set(i,c)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();function Zw(e,o,i){if(i&&e.shouldReuseRoute(o.value,i.value.snapshot)){const s=i.value;s._futureSnapshot=o.value;const c=function g9(e,o,i){return o.children.map(s=>{for(const c of i.children)if(e.shouldReuseRoute(s.value,c.value.snapshot))return Zw(e,s,c);return Zw(e,s)})}(e,o,i);return new Zd(s,c)}{if(e.shouldAttach(o.value)){const f=e.retrieve(o.value);if(null!==f){const g=f.route;return g.value._futureSnapshot=o.value,g.children=o.children.map(v=>Zw(e,v)),g}}const s=function _9(e){return new t0(new $r(e.url),new $r(e.params),new $r(e.queryParams),new $r(e.fragment),new $r(e.data),e.outlet,e.component,e)}(o.value),c=o.children.map(f=>Zw(e,f));return new Zd(s,c)}}const Gk="ngNavigationCancelingError";function g4(e,o){const{redirectTo:i,navigationBehaviorOptions:s}=Og(o)?{redirectTo:o,navigationBehaviorOptions:void 0}:o,c=_4(!1,0,o);return c.url=i,c.navigationBehaviorOptions=s,c}function _4(e,o,i){const s=new Error("NavigationCancelingError: "+(e||""));return s[Gk]=!0,s.cancellationCode=o,i&&(s.url=i),s}function y4(e){return e&&e[Gk]}let v4=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275cmp=os({type:e,selectors:[["ng-component"]],standalone:!0,features:[T1],decls:1,vars:0,template:function(s,c){1&s&&oo(0,"router-outlet")},dependencies:[p4],encapsulation:2})}return e})();function qk(e){const o=e.children&&e.children.map(qk),i=o?{...e,children:o}:{...e};return!i.component&&!i.loadComponent&&(o||i.loadChildren)&&i.outlet&&i.outlet!==An&&(i.component=v4),i}function Gc(e){return e.outlet||An}function Xw(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let o=e.parent;o;o=o.parent){const i=o.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class M9{constructor(o,i,s,c,f){this.routeReuseStrategy=o,this.futureState=i,this.currState=s,this.forwardEvent=c,this.inputBindingEnabled=f}activate(o){const i=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,s,o),Hk(this.futureState.root),this.activateChildRoutes(i,s,o)}deactivateChildRoutes(o,i,s){const c=Qv(i);o.children.forEach(f=>{const g=f.value.outlet;this.deactivateRoutes(f,c[g],s),delete c[g]}),Object.values(c).forEach(f=>{this.deactivateRouteAndItsChildren(f,s)})}deactivateRoutes(o,i,s){const c=o.value,f=i?i.value:null;if(c===f)if(c.component){const g=s.getContext(c.outlet);g&&this.deactivateChildRoutes(o,i,g.children)}else this.deactivateChildRoutes(o,i,s);else f&&this.deactivateRouteAndItsChildren(i,s)}deactivateRouteAndItsChildren(o,i){o.value.component&&this.routeReuseStrategy.shouldDetach(o.value.snapshot)?this.detachAndStoreRouteSubtree(o,i):this.deactivateRouteAndOutlet(o,i)}detachAndStoreRouteSubtree(o,i){const s=i.getContext(o.value.outlet),c=s&&o.value.component?s.children:i,f=Qv(o);for(const g of Object.keys(f))this.deactivateRouteAndItsChildren(f[g],c);if(s&&s.outlet){const g=s.outlet.detach(),v=s.children.onOutletDeactivated();this.routeReuseStrategy.store(o.value.snapshot,{componentRef:g,route:o,contexts:v})}}deactivateRouteAndOutlet(o,i){const s=i.getContext(o.value.outlet),c=s&&o.value.component?s.children:i,f=Qv(o);for(const g of Object.keys(f))this.deactivateRouteAndItsChildren(f[g],c);s&&(s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated()),s.attachRef=null,s.route=null)}activateChildRoutes(o,i,s){const c=Qv(i);o.children.forEach(f=>{this.activateRoutes(f,c[f.value.outlet],s),this.forwardEvent(new u9(f.value.snapshot))}),o.children.length&&this.forwardEvent(new l9(o.value.snapshot))}activateRoutes(o,i,s){const c=o.value,f=i?i.value:null;if(Hk(c),c===f)if(c.component){const g=s.getOrCreateContext(c.outlet);this.activateChildRoutes(o,i,g.children)}else this.activateChildRoutes(o,i,s);else if(c.component){const g=s.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const v=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),g.children.onOutletReAttached(v.contexts),g.attachRef=v.componentRef,g.route=v.route.value,g.outlet&&g.outlet.attach(v.componentRef,v.route.value),Hk(v.route.value),this.activateChildRoutes(o,null,g.children)}else{const v=Xw(c.snapshot);g.attachRef=null,g.route=c,g.injector=v,g.outlet&&g.outlet.activateWith(c,g.injector),this.activateChildRoutes(o,null,g.children)}}else this.activateChildRoutes(o,null,s)}}class x4{constructor(o){this.path=o,this.route=this.path[this.path.length-1]}}class kI{constructor(o,i){this.component=o,this.route=i}}function S9(e,o,i){const s=e._root;return Yw(s,o?o._root:null,i,[s.value])}function e0(e,o){const i=Symbol(),s=o.get(e,i);return s===i?"function"!=typeof e||function Kg(e){return null!==up(e)}(e)?o.get(e):e:s}function Yw(e,o,i,s,c={canDeactivateChecks:[],canActivateChecks:[]}){const f=Qv(o);return e.children.forEach(g=>{(function D9(e,o,i,s,c={canDeactivateChecks:[],canActivateChecks:[]}){const f=e.value,g=o?o.value:null,v=i?i.getContext(e.value.outlet):null;if(g&&f.routeConfig===g.routeConfig){const w=function I9(e,o,i){if("function"==typeof i)return i(e,o);switch(i){case"pathParamsChange":return!Pg(e.url,o.url);case"pathParamsOrQueryParamsChange":return!Pg(e.url,o.url)||!Hu(e.queryParams,o.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!$k(e,o)||!Hu(e.queryParams,o.queryParams);default:return!$k(e,o)}}(g,f,f.routeConfig.runGuardsAndResolvers);w?c.canActivateChecks.push(new x4(s)):(f.data=g.data,f._resolvedData=g._resolvedData),Yw(e,o,f.component?v?v.children:null:i,s,c),w&&v&&v.outlet&&v.outlet.isActivated&&c.canDeactivateChecks.push(new kI(v.outlet.component,g))}else g&&Kw(o,v,c),c.canActivateChecks.push(new x4(s)),Yw(e,null,f.component?v?v.children:null:i,s,c)})(g,f[g.value.outlet],i,s.concat([g.value]),c),delete f[g.value.outlet]}),Object.entries(f).forEach(([g,v])=>Kw(v,i.getContext(g),c)),c}function Kw(e,o,i){const s=Qv(e),c=e.value;Object.entries(s).forEach(([f,g])=>{Kw(g,c.component?o?o.children.getContext(f):null:o,i)}),i.canDeactivateChecks.push(new kI(c.component&&o&&o.outlet&&o.outlet.isActivated?o.outlet.component:null,c))}function Jw(e){return"function"==typeof e}function b4(e){return e instanceof wI||"EmptyError"===e?.name}const FI=Symbol("INITIAL_VALUE");function n0(){return Gr(e=>aI(e.map(o=>o.pipe($c(1),cI(FI)))).pipe(dn(o=>{for(const i of o)if(!0!==i){if(i===FI)return FI;if(!1===i||i instanceof Kv)return i}return!0}),Os(o=>o!==FI),$c(1)))}function w4(e){return function Xu(...e){return Qc(e)}(_o(o=>{if(Og(o))throw g4(0,o)}),dn(o=>!0===o))}class LI{constructor(o){this.segmentGroup=o||null}}class E4{constructor(o){this.urlTree=o}}function r0(e){return Xv(new LI(e))}function C4(e){return Xv(new E4(e))}class X9{constructor(o,i){this.urlSerializer=o,this.urlTree=i}noMatchError(o){return new at(4002,!1)}lineralizeSegments(o,i){let s=[],c=i.root;for(;;){if(s=s.concat(c.segments),0===c.numberOfChildren)return kt(s);if(c.numberOfChildren>1||!c.children[An])return Xv(new at(4e3,!1));c=c.children[An]}}applyRedirectCommands(o,i,s){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),o,s)}applyRedirectCreateUrlTree(o,i,s,c){const f=this.createSegmentGroup(o,i.root,s,c);return new Kv(f,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(o,i){const s={};return Object.entries(o).forEach(([c,f])=>{if("string"==typeof f&&f.startsWith(":")){const v=f.substring(1);s[c]=i[v]}else s[c]=f}),s}createSegmentGroup(o,i,s,c){const f=this.createSegments(o,i.segments,s,c);let g={};return Object.entries(i.children).forEach(([v,w])=>{g[v]=this.createSegmentGroup(o,w,s,c)}),new Zi(f,g)}createSegments(o,i,s,c){return i.map(f=>f.path.startsWith(":")?this.findPosParam(o,f,c):this.findOrReturn(f,s))}findPosParam(o,i,s){const c=s[i.path.substring(1)];if(!c)throw new at(4001,!1);return c}findOrReturn(o,i){let s=0;for(const c of i){if(c.path===o.path)return i.splice(s),c;s++}return o}}const Wk={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Y9(e,o,i,s,c){const f=Zk(e,o,i);return f.matched?(s=function v9(e,o){return e.providers&&!e._injector&&(e._injector=Pf(e.providers,o,`Route: ${e.path}`)),e._injector??o}(o,s),function q9(e,o,i,s){const c=o.canMatch;return c&&0!==c.length?kt(c.map(g=>{const v=e0(g,e);return tp(function F9(e){return e&&Jw(e.canMatch)}(v)?v.canMatch(o,i):e.runInContext(()=>v(o,i)))})).pipe(n0(),w4()):kt(!0)}(s,o,i).pipe(dn(g=>!0===g?f:{...Wk}))):kt(f)}function Zk(e,o,i){if(""===o.path)return"full"===o.pathMatch&&(e.hasChildren()||i.length>0)?{...Wk}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const c=(o.matcher||D7)(i,e,o);if(!c)return{...Wk};const f={};Object.entries(c.posParams??{}).forEach(([v,w])=>{f[v]=w.path});const g=c.consumed.length>0?{...f,...c.consumed[c.consumed.length-1].parameters}:f;return{matched:!0,consumedSegments:c.consumed,remainingSegments:i.slice(c.consumed.length),parameters:g,positionalParamSegments:c.posParams??{}}}function M4(e,o,i,s){return i.length>0&&function Q9(e,o,i){return i.some(s=>NI(e,o,s)&&Gc(s)!==An)}(e,i,s)?{segmentGroup:new Zi(o,J9(s,new Zi(i,e.children))),slicedSegments:[]}:0===i.length&&function tW(e,o,i){return i.some(s=>NI(e,o,s))}(e,i,s)?{segmentGroup:new Zi(e.segments,K9(e,0,i,s,e.children)),slicedSegments:i}:{segmentGroup:new Zi(e.segments,e.children),slicedSegments:i}}function K9(e,o,i,s,c){const f={};for(const g of s)if(NI(e,i,g)&&!c[Gc(g)]){const v=new Zi([],{});f[Gc(g)]=v}return{...c,...f}}function J9(e,o){const i={};i[An]=o;for(const s of e)if(""===s.path&&Gc(s)!==An){const c=new Zi([],{});i[Gc(s)]=c}return i}function NI(e,o,i){return(!(e.hasChildren()||o.length>0)||"full"!==i.pathMatch)&&""===i.path}class rW{constructor(o,i,s,c,f,g,v){this.injector=o,this.configLoader=i,this.rootComponentType=s,this.config=c,this.urlTree=f,this.paramsInheritanceStrategy=g,this.urlSerializer=v,this.allowRedirects=!0,this.applyRedirects=new X9(this.urlSerializer,this.urlTree)}noMatchError(o){return new at(4002,!1)}recognize(){const o=M4(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,o,An).pipe(Qf(i=>{if(i instanceof E4)return this.allowRedirects=!1,this.urlTree=i.urlTree,this.match(i.urlTree);throw i instanceof LI?this.noMatchError(i):i}),dn(i=>{const s=new PI([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},An,this.rootComponentType,null,{}),c=new Zd(s,i),f=new h4("",c),g=function Z7(e,o,i=null,s=null){return t4(QB(e),o,i,s)}(s,[],this.urlTree.queryParams,this.urlTree.fragment);return g.queryParams=this.urlTree.queryParams,f.url=this.urlSerializer.serialize(g),this.inheritParamsAndData(f._root),{state:f,tree:g}}))}match(o){return this.processSegmentGroup(this.injector,this.config,o.root,An).pipe(Qf(s=>{throw s instanceof LI?this.noMatchError(s):s}))}inheritParamsAndData(o){const i=o.value,s=d4(i,this.paramsInheritanceStrategy);i.params=Object.freeze(s.params),i.data=Object.freeze(s.data),o.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(o,i,s,c){return 0===s.segments.length&&s.hasChildren()?this.processChildren(o,i,s):this.processSegment(o,i,s,s.segments,c,!0)}processChildren(o,i,s){const c=[];for(const f of Object.keys(s.children))"primary"===f?c.unshift(f):c.push(f);return Pr(c).pipe(jv(f=>{const g=s.children[f],v=function E9(e,o){const i=e.filter(s=>Gc(s)===o);return i.push(...e.filter(s=>Gc(s)!==o)),i}(i,f);return this.processSegmentGroup(o,v,g,f)}),function C7(e,o){return ar(function E7(e,o,i,s,c){return(f,g)=>{let v=i,w=o,T=0;f.subscribe(Di(g,A=>{const k=T++;w=v?e(w,A,k):(v=!0,A),s&&g.next(w)},c&&(()=>{v&&g.next(w),g.complete()})))}}(e,o,arguments.length>=2,!0))}((f,g)=>(f.push(...g),f)),EI(null),function M7(e,o){const i=arguments.length>=2;return s=>s.pipe(e?Os((c,f)=>e(c,f,s)):xl,Pk(1),i?EI(o):VB(()=>new wI))}(),mr(f=>{if(null===f)return r0(s);const g=S4(f);return function oW(e){e.sort((o,i)=>o.value.outlet===An?-1:i.value.outlet===An?1:o.value.outlet.localeCompare(i.value.outlet))}(g),kt(g)}))}processSegment(o,i,s,c,f,g){return Pr(i).pipe(jv(v=>this.processSegmentAgainstRoute(v._injector??o,i,v,s,c,f,g).pipe(Qf(w=>{if(w instanceof LI)return kt(null);throw w}))),Rg(v=>!!v),Qf(v=>{if(b4(v))return function nW(e,o,i){return 0===o.length&&!e.children[i]}(s,c,f)?kt([]):r0(s);throw v}))}processSegmentAgainstRoute(o,i,s,c,f,g,v){return function eW(e,o,i,s){return!!(Gc(e)===s||s!==An&&NI(o,i,e))&&("**"===e.path||Zk(o,e,i).matched)}(s,c,f,g)?void 0===s.redirectTo?this.matchSegmentAgainstRoute(o,c,s,f,g,v):v&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(o,c,i,s,f,g):r0(c):r0(c)}expandSegmentAgainstRouteUsingRedirect(o,i,s,c,f,g){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(o,s,c,g):this.expandRegularSegmentAgainstRouteUsingRedirect(o,i,s,c,f,g)}expandWildCardWithParamsAgainstRouteUsingRedirect(o,i,s,c){const f=this.applyRedirects.applyRedirectCommands([],s.redirectTo,{});return s.redirectTo.startsWith("/")?C4(f):this.applyRedirects.lineralizeSegments(s,f).pipe(mr(g=>{const v=new Zi(g,{});return this.processSegment(o,i,v,g,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(o,i,s,c,f,g){const{matched:v,consumedSegments:w,remainingSegments:T,positionalParamSegments:A}=Zk(i,c,f);if(!v)return r0(i);const k=this.applyRedirects.applyRedirectCommands(w,c.redirectTo,A);return c.redirectTo.startsWith("/")?C4(k):this.applyRedirects.lineralizeSegments(c,k).pipe(mr(B=>this.processSegment(o,s,i,B.concat(T),g,!1)))}matchSegmentAgainstRoute(o,i,s,c,f,g){let v;if("**"===s.path){const w=c.length>0?UB(c).parameters:{};v=kt({snapshot:new PI(c,w,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,T4(s),Gc(s),s.component??s._loadedComponent??null,s,D4(s)),consumedSegments:[],remainingSegments:[]}),i.children={}}else v=Y9(i,s,c,o).pipe(dn(({matched:w,consumedSegments:T,remainingSegments:A,parameters:k})=>w?{snapshot:new PI(T,k,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,T4(s),Gc(s),s.component??s._loadedComponent??null,s,D4(s)),consumedSegments:T,remainingSegments:A}:null));return v.pipe(Gr(w=>null===w?r0(i):this.getChildConfig(o=s._injector??o,s,c).pipe(Gr(({routes:T})=>{const A=s._loadedInjector??o,{snapshot:k,consumedSegments:B,remainingSegments:$}=w,{segmentGroup:K,slicedSegments:Q}=M4(i,B,$,T);if(0===Q.length&&K.hasChildren())return this.processChildren(A,T,K).pipe(dn(yt=>null===yt?null:[new Zd(k,yt)]));if(0===T.length&&0===Q.length)return kt([new Zd(k,[])]);const ut=Gc(s)===f;return this.processSegment(A,T,K,Q,ut?An:f,!0).pipe(dn(yt=>[new Zd(k,yt)]))}))))}getChildConfig(o,i,s){return i.children?kt({routes:i.children,injector:o}):i.loadChildren?void 0!==i._loadedRoutes?kt({routes:i._loadedRoutes,injector:i._loadedInjector}):function G9(e,o,i,s){const c=o.canLoad;return void 0===c||0===c.length?kt(!0):kt(c.map(g=>{const v=e0(g,e);return tp(function R9(e){return e&&Jw(e.canLoad)}(v)?v.canLoad(o,i):e.runInContext(()=>v(o,i)))})).pipe(n0(),w4())}(o,i,s).pipe(mr(c=>c?this.configLoader.loadChildren(o,i).pipe(_o(f=>{i._loadedRoutes=f.routes,i._loadedInjector=f.injector})):function Z9(e){return Xv(_4(!1,3))}())):kt({routes:[],injector:o})}}function sW(e){const o=e.value.routeConfig;return o&&""===o.path}function S4(e){const o=[],i=new Set;for(const s of e){if(!sW(s)){o.push(s);continue}const c=o.find(f=>s.value.routeConfig===f.value.routeConfig);void 0!==c?(c.children.push(...s.children),i.add(c)):o.push(s)}for(const s of i){const c=S4(s.children);o.push(new Zd(s.value,c))}return o.filter(s=>!i.has(s))}function T4(e){return e.data||{}}function D4(e){return e.resolve||{}}function I4(e){return"string"==typeof e.title||null===e.title}function Xk(e){return Gr(o=>{const i=e(o);return i?Pr(i).pipe(dn(()=>o)):kt(o)})}const o0=new $t("ROUTES");let Yk=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ne(ow)}loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return kt(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const s=tp(i.loadComponent()).pipe(dn(A4),_o(f=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=f}),Uv(()=>{this.componentLoaders.delete(i)})),c=new BB(s,()=>new on).pipe(Rk());return this.componentLoaders.set(i,c),c}loadChildren(i,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return kt({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);const f=function fW(e,o,i,s){return tp(e.loadChildren()).pipe(dn(A4),mr(c=>c instanceof M1||Array.isArray(c)?kt(c):Pr(o.compileModuleAsync(c))),dn(c=>{s&&s(e);let f,g,v=!1;return Array.isArray(c)?(g=c,!0):(f=c.create(i).injector,g=f.get(o0,[],{optional:!0,self:!0}).flat()),{routes:g.map(qk),injector:f}}))}(s,this.compiler,i,this.onLoadEndListener).pipe(Uv(()=>{this.childrenLoaders.delete(s)})),g=new BB(f,()=>new on).pipe(Rk());return this.childrenLoaders.set(s,g),g}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function A4(e){return function pW(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let zI=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new on,this.transitionAbortSubject=new on,this.configLoader=ne(Yk),this.environmentInjector=ne(Ds),this.urlSerializer=ne(jw),this.rootContexts=ne(Ww),this.inputBindingEnabled=null!==ne(OI,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>kt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new s9(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new o9(c))}complete(){this.transitions?.complete()}handleNavigationRequest(i){const s=++this.navigationId;this.transitions?.next({...this.transitions.value,...i,id:s})}setupNavigations(i,s,c){return this.transitions=new $r({id:0,currentUrlTree:s,currentRawUrl:s,currentBrowserUrl:s,extractedUrl:i.urlHandlingStrategy.extract(s),urlAfterRedirects:i.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Gw,restoredState:null,currentSnapshot:c.snapshot,targetSnapshot:null,currentRouterState:c,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Os(f=>0!==f.id),dn(f=>({...f,extractedUrl:i.urlHandlingStrategy.extract(f.rawUrl)})),Gr(f=>{this.currentTransition=f;let g=!1,v=!1;return kt(f).pipe(_o(w=>{this.currentNavigation={id:w.id,initialUrl:w.rawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Gr(w=>{const T=w.currentBrowserUrl.toString(),A=!i.navigated||w.extractedUrl.toString()!==T||T!==w.currentUrlTree.toString();if(!A&&"reload"!==(w.extras.onSameUrlNavigation??i.onSameUrlNavigation)){const B="";return this.events.next(new Jv(w.id,this.urlSerializer.serialize(w.rawUrl),B,0)),w.resolve(null),ca}if(i.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return kt(w).pipe(Gr(B=>{const $=this.transitions?.getValue();return this.events.next(new AI(B.id,this.urlSerializer.serialize(B.extractedUrl),B.source,B.restoredState)),$!==this.transitions?.getValue()?ca:Promise.resolve(B)}),function aW(e,o,i,s,c,f){return mr(g=>function iW(e,o,i,s,c,f,g="emptyOnly"){return new rW(e,o,i,s,c,g,f).recognize()}(e,o,i,s,g.extractedUrl,c,f).pipe(dn(({state:v,tree:w})=>({...g,targetSnapshot:v,urlAfterRedirects:w}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,i.paramsInheritanceStrategy),_o(B=>{f.targetSnapshot=B.targetSnapshot,f.urlAfterRedirects=B.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:B.urlAfterRedirects};const $=new s4(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects),B.targetSnapshot);this.events.next($)}));if(A&&i.urlHandlingStrategy.shouldProcessUrl(w.currentRawUrl)){const{id:B,extractedUrl:$,source:K,restoredState:Q,extras:ut}=w,yt=new AI(B,this.urlSerializer.serialize($),K,Q);this.events.next(yt);const pt=u4(0,this.rootComponentType).snapshot;return this.currentTransition=f={...w,targetSnapshot:pt,urlAfterRedirects:$,extras:{...ut,skipLocationChange:!1,replaceUrl:!1}},kt(f)}{const B="";return this.events.next(new Jv(w.id,this.urlSerializer.serialize(w.extractedUrl),B,1)),w.resolve(null),ca}}),_o(w=>{const T=new e9(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(T)}),dn(w=>(this.currentTransition=f={...w,guards:S9(w.targetSnapshot,w.currentSnapshot,this.rootContexts)},f)),function N9(e,o){return mr(i=>{const{targetSnapshot:s,currentSnapshot:c,guards:{canActivateChecks:f,canDeactivateChecks:g}}=i;return 0===g.length&&0===f.length?kt({...i,guardsResult:!0}):function z9(e,o,i,s){return Pr(e).pipe(mr(c=>function $9(e,o,i,s,c){const f=o&&o.routeConfig?o.routeConfig.canDeactivate:null;return f&&0!==f.length?kt(f.map(v=>{const w=Xw(o)??c,T=e0(v,w);return tp(function k9(e){return e&&Jw(e.canDeactivate)}(T)?T.canDeactivate(e,o,i,s):w.runInContext(()=>T(e,o,i,s))).pipe(Rg())})).pipe(n0()):kt(!0)}(c.component,c.route,i,o,s)),Rg(c=>!0!==c,!0))}(g,s,c,e).pipe(mr(v=>v&&function A9(e){return"boolean"==typeof e}(v)?function B9(e,o,i,s){return Pr(o).pipe(jv(c=>lI(function j9(e,o){return null!==e&&o&&o(new a9(e)),kt(!0)}(c.route.parent,s),function V9(e,o){return null!==e&&o&&o(new c9(e)),kt(!0)}(c.route,s),function H9(e,o,i){const s=o[o.length-1],f=o.slice(0,o.length-1).reverse().map(g=>function T9(e){const o=e.routeConfig?e.routeConfig.canActivateChild:null;return o&&0!==o.length?{node:e,guards:o}:null}(g)).filter(g=>null!==g).map(g=>Ak(()=>kt(g.guards.map(w=>{const T=Xw(g.node)??i,A=e0(w,T);return tp(function O9(e){return e&&Jw(e.canActivateChild)}(A)?A.canActivateChild(s,e):T.runInContext(()=>A(s,e))).pipe(Rg())})).pipe(n0())));return kt(f).pipe(n0())}(e,c.path,i),function U9(e,o,i){const s=o.routeConfig?o.routeConfig.canActivate:null;if(!s||0===s.length)return kt(!0);const c=s.map(f=>Ak(()=>{const g=Xw(o)??i,v=e0(f,g);return tp(function P9(e){return e&&Jw(e.canActivate)}(v)?v.canActivate(o,e):g.runInContext(()=>v(o,e))).pipe(Rg())}));return kt(c).pipe(n0())}(e,c.route,i))),Rg(c=>!0!==c,!0))}(s,f,e,o):kt(v)),dn(v=>({...i,guardsResult:v})))})}(this.environmentInjector,w=>this.events.next(w)),_o(w=>{if(f.guardsResult=w.guardsResult,Og(w.guardsResult))throw g4(0,w.guardsResult);const T=new n9(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.events.next(T)}),Os(w=>!!w.guardsResult||(this.cancelNavigationTransition(w,"",3),!1)),Xk(w=>{if(w.guards.canActivateChecks.length)return kt(w).pipe(_o(T=>{const A=new i9(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(A)}),Gr(T=>{let A=!1;return kt(T).pipe(function lW(e,o){return mr(i=>{const{targetSnapshot:s,guards:{canActivateChecks:c}}=i;if(!c.length)return kt(i);let f=0;return Pr(c).pipe(jv(g=>function cW(e,o,i,s){const c=e.routeConfig,f=e._resolve;return void 0!==c?.title&&!I4(c)&&(f[Bw]=c.title),function uW(e,o,i,s){const c=function dW(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===c.length)return kt({});const f={};return Pr(c).pipe(mr(g=>function hW(e,o,i,s){const c=Xw(o)??s,f=e0(e,c);return tp(f.resolve?f.resolve(o,i):c.runInContext(()=>f(o,i)))}(e[g],o,i,s).pipe(Rg(),_o(v=>{f[g]=v}))),Pk(1),function S7(e){return dn(()=>e)}(f),Qf(g=>b4(g)?ca:Xv(g)))}(f,e,o,s).pipe(dn(g=>(e._resolvedData=g,e.data=d4(e,i).resolve,c&&I4(c)&&(e.data[Bw]=c.title),null)))}(g.route,s,e,o)),_o(()=>f++),Pk(1),mr(g=>f===c.length?kt(i):ca))})}(i.paramsInheritanceStrategy,this.environmentInjector),_o({next:()=>A=!0,complete:()=>{A||this.cancelNavigationTransition(T,"",2)}}))}),_o(T=>{const A=new r9(T.id,this.urlSerializer.serialize(T.extractedUrl),this.urlSerializer.serialize(T.urlAfterRedirects),T.targetSnapshot);this.events.next(A)}))}),Xk(w=>{const T=A=>{const k=[];A.routeConfig?.loadComponent&&!A.routeConfig._loadedComponent&&k.push(this.configLoader.loadComponent(A.routeConfig).pipe(_o(B=>{A.component=B}),dn(()=>{})));for(const B of A.children)k.push(...T(B));return k};return aI(T(w.targetSnapshot.root)).pipe(EI(),$c(1))}),Xk(()=>this.afterPreactivation()),dn(w=>{const T=function m9(e,o,i){const s=Zw(e,o._root,i?i._root:void 0);return new c4(s,o)}(i.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return this.currentTransition=f={...w,targetRouterState:T},f}),_o(()=>{this.events.next(new zk)}),((e,o,i,s)=>dn(c=>(new M9(o,c.targetRouterState,c.currentRouterState,i,s).activate(e),c)))(this.rootContexts,i.routeReuseStrategy,w=>this.events.next(w),this.inputBindingEnabled),$c(1),_o({next:w=>{g=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new ep(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects))),i.titleStrategy?.updateTitle(w.targetRouterState.snapshot),w.resolve(!0)},complete:()=>{g=!0}}),Da(this.transitionAbortSubject.pipe(_o(w=>{throw w}))),Uv(()=>{g||v||this.cancelNavigationTransition(f,"",1),this.currentNavigation?.id===f.id&&(this.currentNavigation=null)}),Qf(w=>{if(v=!0,y4(w))this.events.next(new qw(f.id,this.urlSerializer.serialize(f.extractedUrl),w.message,w.cancellationCode)),function y9(e){return y4(e)&&Og(e.url)}(w)?this.events.next(new Bk(w.url)):f.resolve(!1);else{this.events.next(new RI(f.id,this.urlSerializer.serialize(f.extractedUrl),w,f.targetSnapshot??void 0));try{f.resolve(i.errorHandler(w))}catch(T){f.reject(T)}}return ca}))}))}cancelNavigationTransition(i,s,c){const f=new qw(i.id,this.urlSerializer.serialize(i.extractedUrl),s,c);this.events.next(f),i.resolve(!1)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function R4(e){return e!==Gw}let P4=(()=>{class e{buildTitle(i){let s,c=i.root;for(;void 0!==c;)s=this.getResolvedTitleForRoute(c)??s,c=c.children.find(f=>f.outlet===An);return s}getResolvedTitleForRoute(i){return i.data[Bw]}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:function(){return ne(mW)},providedIn:"root"})}return e})(),mW=(()=>{class e extends P4{constructor(i){super(),this.title=i}updateTitle(i){const s=this.buildTitle(i);void 0!==s&&this.title.setTitle(s)}static#t=this.\u0275fac=function(s){return new(s||e)(bt(rN))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),gW=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:function(){return ne(yW)},providedIn:"root"})}return e})();class _W{shouldDetach(o){return!1}store(o,i){}shouldAttach(o){return!1}retrieve(o){return null}shouldReuseRoute(o,i){return o.routeConfig===i.routeConfig}}let yW=(()=>{class e extends _W{static#t=this.\u0275fac=function(){let i;return function(c){return(i||(i=xr(e)))(c||e)}}();static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const BI=new $t("",{providedIn:"root",factory:()=>({})});let vW=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:function(){return ne(xW)},providedIn:"root"})}return e})(),xW=(()=>{class e{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,s){return i}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Qw=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(Qw||{});function O4(e,o){e.events.pipe(Os(i=>i instanceof ep||i instanceof qw||i instanceof RI||i instanceof Jv),dn(i=>i instanceof ep||i instanceof Jv?Qw.COMPLETE:i instanceof qw&&(0===i.code||1===i.code)?Qw.REDIRECTING:Qw.FAILED),Os(i=>i!==Qw.REDIRECTING),$c(1)).subscribe(()=>{o()})}function bW(e){throw e}function wW(e,o,i){return o.parse("/")}const EW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},CW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ec=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=ne(sD),this.isNgZoneEnabled=!1,this._events=new on,this.options=ne(BI,{optional:!0})||{},this.pendingTasks=ne(Bd),this.errorHandler=this.options.errorHandler||bW,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||wW,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=ne(vW),this.routeReuseStrategy=ne(gW),this.titleStrategy=ne(P4),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=ne(o0,{optional:!0})?.flat()??[],this.navigationTransitions=ne(zI),this.urlSerializer=ne(jw),this.location=ne(hD),this.componentInputBindingEnabled=!!ne(OI,{optional:!0}),this.eventsSubscription=new st,this.isNgZoneEnabled=ne(Xe)instanceof Xe&&Xe.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Kv,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=u4(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(i=>{this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId},i=>{this.console.warn(`Unhandled Navigation Error: ${i}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const i=this.navigationTransitions.events.subscribe(s=>{try{const{currentTransition:c}=this.navigationTransitions;if(null===c)return void(k4(s)&&this._events.next(s));if(s instanceof AI)R4(c.source)&&(this.browserUrlTree=c.extractedUrl);else if(s instanceof Jv)this.rawUrlTree=c.rawUrl;else if(s instanceof s4){if("eager"===this.urlUpdateStrategy){if(!c.extras.skipLocationChange){const f=this.urlHandlingStrategy.merge(c.urlAfterRedirects,c.rawUrl);this.setBrowserUrl(f,c)}this.browserUrlTree=c.urlAfterRedirects}}else if(s instanceof zk)this.currentUrlTree=c.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(c.urlAfterRedirects,c.rawUrl),this.routerState=c.targetRouterState,"deferred"===this.urlUpdateStrategy&&(c.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,c),this.browserUrlTree=c.urlAfterRedirects);else if(s instanceof qw)0!==s.code&&1!==s.code&&(this.navigated=!0),(3===s.code||2===s.code)&&this.restoreHistory(c);else if(s instanceof Bk){const f=this.urlHandlingStrategy.merge(s.url,c.currentRawUrl),g={skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||R4(c.source)};this.scheduleNavigation(f,Gw,null,g,{resolve:c.resolve,reject:c.reject,promise:c.promise})}s instanceof RI&&this.restoreHistory(c,!0),s instanceof ep&&(this.navigated=!0),k4(s)&&this._events.next(s)}catch(c){this.navigationTransitions.transitionAbortSubject.next(c)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const i=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Gw,i)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(i=>{const s="popstate"===i.type?"popstate":"hashchange";"popstate"===s&&setTimeout(()=>{this.navigateToSyncWithBrowser(i.url,s,i.state)},0)}))}navigateToSyncWithBrowser(i,s,c){const f={replaceUrl:!0},g=c?.navigationId?c:null;if(c){const w={...c};delete w.navigationId,delete w.\u0275routerPageId,0!==Object.keys(w).length&&(f.state=w)}const v=this.parseUrl(i);this.scheduleNavigation(v,s,g,f)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(qk),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,s={}){const{relativeTo:c,queryParams:f,fragment:g,queryParamsHandling:v,preserveFragment:w}=s,T=w?this.currentUrlTree.fragment:g;let k,A=null;switch(v){case"merge":A={...this.currentUrlTree.queryParams,...f};break;case"preserve":A=this.currentUrlTree.queryParams;break;default:A=f||null}null!==A&&(A=this.removeEmptyProps(A));try{k=QB(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof i[0]||!i[0].startsWith("/"))&&(i=[]),k=this.currentUrlTree.root}return t4(k,i,A,T??null)}navigateByUrl(i,s={skipLocationChange:!1}){const c=Og(i)?i:this.parseUrl(i),f=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(f,Gw,null,s)}navigate(i,s={skipLocationChange:!1}){return function MW(e){for(let o=0;o<e.length;o++)if(null==e[o])throw new at(4008,!1)}(i),this.navigateByUrl(this.createUrlTree(i,s),s)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){let s;try{s=this.urlSerializer.parse(i)}catch(c){s=this.malformedUriErrorHandler(c,this.urlSerializer,i)}return s}isActive(i,s){let c;if(c=!0===s?{...EW}:!1===s?{...CW}:s,Og(i))return $B(this.currentUrlTree,i,c);const f=this.parseUrl(i);return $B(this.currentUrlTree,f,c)}removeEmptyProps(i){return Object.keys(i).reduce((s,c)=>{const f=i[c];return null!=f&&(s[c]=f),s},{})}scheduleNavigation(i,s,c,f,g){if(this.disposed)return Promise.resolve(!1);let v,w,T;g?(v=g.resolve,w=g.reject,T=g.promise):T=new Promise((k,B)=>{v=k,w=B});const A=this.pendingTasks.add();return O4(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(A))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:i,extras:f,resolve:v,reject:w,promise:T,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),T.catch(k=>Promise.reject(k))}setBrowserUrl(i,s){const c=this.urlSerializer.serialize(i);if(this.location.isCurrentPathEqualTo(c)||s.extras.replaceUrl){const g={...s.extras.state,...this.generateNgRouterState(s.id,this.browserPageId)};this.location.replaceState(c,"",g)}else{const f={...s.extras.state,...this.generateNgRouterState(s.id,this.browserPageId+1)};this.location.go(c,"",f)}}restoreHistory(i,s=!1){if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-this.browserPageId;0!==f?this.location.historyGo(f):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===f&&(this.resetState(i),this.browserUrlTree=i.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(s&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=i.currentRouterState,this.currentUrlTree=i.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,s){return"computed"===this.canceledNavigationResolution?{navigationId:i,\u0275routerPageId:s}:{navigationId:i}}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function k4(e){return!(e instanceof zk||e instanceof Bk)}class F4{}let DW=(()=>{class e{constructor(i,s,c,f,g){this.router=i,this.injector=c,this.preloadingStrategy=f,this.loader=g}setUpPreloading(){this.subscription=this.router.events.pipe(Os(i=>i instanceof ep),jv(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,s){const c=[];for(const f of s){f.providers&&!f._injector&&(f._injector=Pf(f.providers,i,`Route: ${f.path}`));const g=f._injector??i,v=f._loadedInjector??g;(f.loadChildren&&!f._loadedRoutes&&void 0===f.canLoad||f.loadComponent&&!f._loadedComponent)&&c.push(this.preloadConfig(g,f)),(f.children||f._loadedRoutes)&&c.push(this.processRoutes(v,f.children??f._loadedRoutes))}return Pr(c).pipe(iu())}preloadConfig(i,s){return this.preloadingStrategy.preload(s,()=>{let c;c=s.loadChildren&&void 0===s.canLoad?this.loader.loadChildren(i,s):kt(null);const f=c.pipe(mr(g=>null===g?kt(void 0):(s._loadedRoutes=g.routes,s._loadedInjector=g.injector,this.processRoutes(g.injector??i,g.routes))));return s.loadComponent&&!s._loadedComponent?Pr([f,this.loader.loadComponent(s)]).pipe(iu()):f})}static#t=this.\u0275fac=function(s){return new(s||e)(bt(ec),bt(ow),bt(Ds),bt(F4),bt(Yk))};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Jk=new $t("");let L4=(()=>{class e{constructor(i,s,c,f,g={}){this.urlSerializer=i,this.transitions=s,this.viewportScroller=c,this.zone=f,this.options=g,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},g.scrollPositionRestoration=g.scrollPositionRestoration||"disabled",g.anchorScrolling=g.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof AI?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof ep?(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment)):i instanceof Jv&&0===i.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof a4&&(i.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(i.position):i.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(i.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(i,s){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new a4(i,"popstate"===this.lastSource?this.store[this.restoredId]:null,s))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#t=this.\u0275fac=function(s){ti()};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac})}return e})();function Xd(e,o){return{\u0275kind:e,\u0275providers:o}}function z4(){const e=ne(Fr);return o=>{const i=e.get(ct);if(o!==i.components[0])return;const s=e.get(ec),c=e.get(B4);1===e.get(Qk)&&s.initialNavigation(),e.get(V4,null,Ke.Optional)?.setUpPreloading(),e.get(Jk,null,Ke.Optional)?.init(),s.resetRootComponentType(i.componentTypes[0]),c.closed||(c.next(),c.complete(),c.unsubscribe())}}const B4=new $t("",{factory:()=>new on}),Qk=new $t("",{providedIn:"root",factory:()=>1}),V4=new $t("");function PW(e){return Xd(0,[{provide:V4,useExisting:DW},{provide:F4,useExisting:e}])}const j4=new $t("ROUTER_FORROOT_GUARD"),kW=[hD,{provide:jw,useClass:Ok},ec,Ww,{provide:t0,useFactory:function N4(e){return e.routerState.root},deps:[ec]},Yk,[]];function FW(){return new z("Router",ec)}let U4=(()=>{class e{constructor(i){}static forRoot(i,s){return{ngModule:e,providers:[kW,[],{provide:o0,multi:!0,useValue:i},{provide:j4,useFactory:BW,deps:[[ec,new gu,new kh]]},{provide:BI,useValue:s||{}},s?.useHash?{provide:vg,useClass:R5}:{provide:vg,useClass:yL},{provide:Jk,useFactory:()=>{const e=ne(YV),o=ne(Xe),i=ne(BI),s=ne(zI),c=ne(jw);return i.scrollOffset&&e.setOffset(i.scrollOffset),new L4(c,s,e,o,i)}},s?.preloadingStrategy?PW(s.preloadingStrategy).\u0275providers:[],{provide:z,multi:!0,useFactory:FW},s?.initialNavigation?VW(s):[],s?.bindToComponentInputs?Xd(8,[m4,{provide:OI,useExisting:m4}]).\u0275providers:[],[{provide:H4,useFactory:z4},{provide:I,multi:!0,useExisting:H4}]]}}static forChild(i){return{ngModule:e,providers:[{provide:o0,multi:!0,useValue:i}]}}static#t=this.\u0275fac=function(s){return new(s||e)(bt(j4,8))};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({})}return e})();function BW(e){return"guarded"}function VW(e){return["disabled"===e.initialNavigation?Xd(3,[{provide:nw,multi:!0,useFactory:()=>{const o=ne(ec);return()=>{o.setUpLocationChangeListener()}}},{provide:Qk,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Xd(2,[{provide:Qk,useValue:0},{provide:nw,multi:!0,deps:[Fr],useFactory:o=>{const i=o.get(I5,Promise.resolve());return()=>i.then(()=>new Promise(s=>{const c=o.get(ec),f=o.get(B4);O4(c,()=>{s(!0)}),o.get(zI).afterPreactivation=()=>(s(!0),f.closed?kt(void 0):f),c.initialNavigation()}))}}]).\u0275providers:[]]}const H4=new $t("");var UW=qu(574),s0=qu.n(UW),ts=Math.PI,wr=2*ts,kg=ts/180,$4=180/ts,Aa=6378.135,Gu=60/Math.sqrt(Aa*Aa*Aa/398600.8),VI=Aa*Gu/60,W4=1/Gu,np=.001082616,X4=-165597e-11,ip=-253881e-11/np,a0=2/3;function K4(e,o,i,s,c,f){var g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return 367*e-Math.floor(7*(e+Math.floor((o+9)/12))*.25)+Math.floor(275*o/9)+i+1721013.5+((g/6e4+f/60+c)/60+s)/24}function tF(e,o,i,s,c,f,g){if(e instanceof Date){var v=e;return K4(v.getUTCFullYear(),v.getUTCMonth()+1,v.getUTCDate(),v.getUTCHours(),v.getUTCMinutes(),v.getUTCSeconds(),v.getUTCMilliseconds())}return K4(e,o,i,s,c,f,g)}function J4(e,o){var Ue,en,Mn,Rn,Xn,xi,ai,Li,Ar,bi,mi,Ni,li,Hn,fr,Er,Ui,Qi,i=e.e3,s=e.ee2,c=e.peo,f=e.pgho,g=e.pho,v=e.pinco,w=e.plo,T=e.se2,A=e.se3,k=e.sgh2,B=e.sgh3,$=e.sgh4,K=e.sh2,Q=e.sh3,ut=e.si2,yt=e.si3,pt=e.sl2,Ft=e.sl3,Zt=e.sl4,de=e.t,oe=e.xgh2,Te=e.xgh3,gn=e.xgh4,bn=e.xh2,si=e.xh3,fi=e.xi2,Dn=e.xi3,ji=e.xl2,Xi=e.xl3,hr=e.xl4,Gt=e.zmol,fe=e.zmos,pe=o.init,Pe=o.opsmode,Un=o.ep,pi=o.inclp,Ve=o.nodep,sr=o.argpp,wn=o.mp;Qi=fe+119459e-10*de,"y"===pe&&(Qi=fe),Ui=Qi+.0335*Math.sin(Qi);var Fs=T*(ai=.5*(Hn=Math.sin(Ui))*Hn-.25)+A*(Li=-.5*Hn*Math.cos(Ui)),Ls=ut*ai+yt*Li,bo=pt*ai+Ft*Li+Zt*Hn,ho=k*ai+B*Li+$*Hn,wo=K*ai+Q*Li;return Qi=Gt+.00015835218*de,"y"===pe&&(Qi=Gt),Ui=Qi+.1098*Math.sin(Qi),Ar=Fs+(s*(ai=.5*(Hn=Math.sin(Ui))*Hn-.25)+i*(Li=-.5*Hn*Math.cos(Ui))),Ni=Ls+(fi*ai+Dn*Li),li=bo+(ji*ai+Xi*Li+hr*Hn),bi=ho+(oe*ai+Te*Li+gn*Hn),mi=wo+(bn*ai+si*Li),"n"===pe&&(li-=w,bi-=f,mi-=g,pi+=Ni-=v,Un+=Ar-=c,Rn=Math.sin(pi),Mn=Math.cos(pi),pi>=.2?(sr+=bi-=Mn*(mi/=Rn),Ve+=mi,wn+=li):(Ue=Rn*(xi=Math.sin(Ve)),en=Rn*(Xn=Math.cos(Ve)),Ue+=mi*Xn+Ni*Mn*xi,en+=-mi*xi+Ni*Mn*Xn,(Ve%=wr)<0&&"a"===Pe&&(Ve+=wr),fr=wn+sr+Mn*Ve,fr+=li+bi-Ni*Ve*Rn,Er=Ve,(Ve=Math.atan2(Ue,en))<0&&"a"===Pe&&(Ve+=wr),Math.abs(Er-Ve)>ts&&(Ve<Er?Ve+=wr:Ve-=wr),sr=fr-(wn+=li)-Mn*Ve)),{ep:Un,inclp:pi,nodep:Ve,argpp:sr,mp:wn}}function Q4(e){var o=(e-2451545)/36525,i=-62e-7*o*o*o+.093104*o*o+3164400184.812866*o+67310.54841;return(i=i*kg/240%wr)<0&&(i+=wr),i}function eF(){return(arguments.length<=0?void 0:arguments[0])instanceof Date||arguments.length>1?Q4(tF.apply(void 0,arguments)):Q4.apply(void 0,arguments)}function t5(e,o){var i,s,c,f,g,w,T,A,k,B,$,K,ut,yt,pt,Ft,Zt,de,oe,Te,gn,bn,si,fi,Dn;e.t=o,e.error=0;var Xi=e.mo+e.mdot*e.t,hr=e.argpo+e.argpdot*e.t;A=hr,oe=Xi;var fe=e.t*e.t;if(gn=e.nodeo+e.nodedot*e.t+e.nodecf*fe,pt=1-e.cc1*e.t,Ft=e.bstar*e.cc4*e.t,Zt=e.t2cof*fe,1!==e.isimp){w=e.omgcof*e.t;var pe=1+e.eta*Math.cos(Xi);oe=Xi+(yt=w+e.xmcof*(pe*pe*pe-e.delmo)),A=hr-yt,pt=pt-e.d2*fe-e.d3*($=fe*e.t)-e.d4*(K=$*e.t),Ft+=e.bstar*e.cc5*(Math.sin(oe)-e.sinmao),Zt=Zt+e.t3cof*$+K*(e.t4cof+e.t*e.t5cof)}Te=e.no;var Pe=e.ecco;if(de=e.inclo,"d"===e.method){var pi=function qW(e){var vo,ai,Li,Ar,bi,mi,Ni,li,o=e.irez,i=e.d2201,s=e.d2211,c=e.d3210,f=e.d3222,g=e.d4410,v=e.d4422,w=e.d5220,T=e.d5232,A=e.d5421,k=e.d5433,$=e.del1,K=e.del2,Q=e.del3,Zt=e.argpo,de=e.argpdot,oe=e.t,bn=e.xfact,si=e.xlamo,fi=e.no,Dn=e.atime,ji=e.em,Xi=e.argpm,hr=e.inclm,Gt=e.xli,fe=e.mm,pe=e.xni,Pe=e.nodem,Un=e.nm,pi=.13130908,Ve=2.8843198,sr=.37448087,wn=5.7686396,Ue=.95240898,en=1.8014998,Mn=1.050833,Rn=4.4108898,Hn=0,fr=0,Er=(e.gsto+.0043752690880113*e.tc)%wr;if(ji+=e.dedt*oe,hr+=e.didt*oe,Xi+=e.domdt*oe,Pe+=e.dnodt*oe,fe+=e.dmdt*oe,0!==o){(0===Dn||oe*Dn<=0||Math.abs(oe)<Math.abs(Dn))&&(Dn=0,pe=fi,Gt=si),vo=oe>0?720:-720;for(var Ui=381;381===Ui;)2!==o?(Ni=$*Math.sin(Gt-pi)+K*Math.sin(2*(Gt-Ve))+Q*Math.sin(3*(Gt-sr)),bi=pe+bn,mi=$*Math.cos(Gt-pi)+2*K*Math.cos(2*(Gt-Ve))+3*Q*Math.cos(3*(Gt-sr)),mi*=bi):(Li=(li=Zt+de*Dn)+li,ai=Gt+Gt,Ni=i*Math.sin(Li+Gt-wn)+s*Math.sin(Gt-wn)+c*Math.sin(li+Gt-Ue)+f*Math.sin(-li+Gt-Ue)+g*Math.sin(Li+ai-en)+v*Math.sin(ai-en)+w*Math.sin(li+Gt-Mn)+T*Math.sin(-li+Gt-Mn)+A*Math.sin(li+ai-Rn)+k*Math.sin(-li+ai-Rn),bi=pe+bn,mi=i*Math.cos(Li+Gt-wn)+s*Math.cos(Gt-wn)+c*Math.cos(li+Gt-Ue)+f*Math.cos(-li+Gt-Ue)+w*Math.cos(li+Gt-Mn)+T*Math.cos(-li+Gt-Mn)+2*(g*Math.cos(Li+ai-en)+v*Math.cos(ai-en)+A*Math.cos(li+ai-Rn)+k*Math.cos(-li+ai-Rn)),mi*=bi),Math.abs(oe-Dn)>=720?Ui=381:(fr=oe-Dn,Ui=0),381===Ui&&(Gt+=bi*vo+259200*Ni,pe+=Ni*vo+259200*mi,Dn+=vo);Un=pe+Ni*fr+mi*fr*fr*.5,Ar=Gt+bi*fr+Ni*fr*fr*.5,1!==o?(fe=Ar-2*Pe+2*Er,Hn=Un-fi):(fe=Ar-Pe-Xi+Er,Hn=Un-fi),Un=fi+Hn}return{atime:Dn,em:ji,argpm:Xi,inclm:hr,xli:Gt,mm:fe,xni:pe,nodem:Pe,dndt:Hn,nm:Un}}({irez:e.irez,d2201:e.d2201,d2211:e.d2211,d3210:e.d3210,d3222:e.d3222,d4410:e.d4410,d4422:e.d4422,d5220:e.d5220,d5232:e.d5232,d5421:e.d5421,d5433:e.d5433,dedt:e.dedt,del1:e.del1,del2:e.del2,del3:e.del3,didt:e.didt,dmdt:e.dmdt,dnodt:e.dnodt,domdt:e.domdt,argpo:e.argpo,argpdot:e.argpdot,t:e.t,tc:e.t,gsto:e.gsto,xfact:e.xfact,xlamo:e.xlamo,no:e.no,atime:e.atime,em:Pe,argpm:A,inclm:de,xli:e.xli,mm:oe,xni:e.xni,nodem:gn,nm:Te});Pe=pi.em,A=pi.argpm,de=pi.inclm,oe=pi.mm,gn=pi.nodem,Te=pi.nm}if(Te<=0)return e.error=2,[!1,!1];var Ve=Math.pow(Gu/Te,a0)*pt*pt;if(Te=Gu/Math.pow(Ve,1.5),(Pe-=Ft)>=1||Pe<-.001)return e.error=1,[!1,!1];Pe<1e-6&&(Pe=1e-6),si=(oe+=e.no*Zt)+A+gn;var Ue=Pe;if(bn=de,k=A%=wr,Dn=gn%=wr,fi=oe=((si%=wr)-A-gn)%wr,f=Math.sin(de),c=Math.cos(de),"d"===e.method){var Mn=J4(e,{inclo:e.inclo,init:"n",ep:Ue,inclp:bn,nodep:Dn,argpp:k,mp:fi,opsmode:e.operationmode});if(Dn=Mn.nodep,k=Mn.argpp,fi=Mn.mp,(bn=Mn.inclp)<0&&(bn=-bn,Dn+=ts,k-=ts),(Ue=Mn.ep)<0||Ue>1)return e.error=3,[!1,!1]}"d"===e.method&&(f=Math.sin(bn),c=Math.cos(bn),e.aycof=-.5*ip*f,e.xlcof=Math.abs(c+1)>15e-13?-.25*ip*f*(3+5*c)/(1+c):-.25*ip*f*(3+5*c)/15e-13);var Rn=Ue*Math.cos(k);yt=1/(Ve*(1-Ue*Ue));var Xn=Ue*Math.sin(k)+yt*e.aycof,co=(fi+k+Dn+yt*e.xlcof*Rn-Dn)%wr;T=co,ut=9999.9;for(var Nr=1;Math.abs(ut)>=1e-12&&Nr<=10;)s=Math.sin(T),ut=(co-Xn*(i=Math.cos(T))+Rn*s-T)/(ut=1-i*Rn-s*Xn),Math.abs(ut)>=.95&&(ut=ut>0?.95:-.95),T+=ut,Nr+=1;var vo=Rn*i+Xn*s,ai=Rn*s-Xn*i,Li=Rn*Rn+Xn*Xn,Ar=Ve*(1-Li);if(Ar<0)return e.error=4,[!1,!1];var bi=Ve*(1-vo),mi=Math.sqrt(Ve)*ai/bi,Ni=Math.sqrt(Ar)/bi,li=Math.sqrt(1-Li),Hn=Ve/bi*(s-Xn-Rn*(yt=ai/(1+li))),fr=Ve/bi*(i-Rn+Xn*yt);B=Math.atan2(Hn,fr);var Er=(fr+fr)*Hn,Ui=1-2*Hn*Hn,Qi=.5*np*(yt=1/Ar),xo=Qi*yt;"d"===e.method&&(e.con41=3*(g=c*c)-1,e.x1mth2=1-g,e.x7thm1=7*g-1);var uo=bi*(1-1.5*xo*li*e.con41)+.5*Qi*e.x1mth2*Ui;if(uo<1)return e.error=6,{position:!1,velocity:!1};B-=.25*xo*e.x7thm1*Er;var es=Dn+1.5*xo*c*Er,No=bn+1.5*xo*c*f*Ui,Fs=mi-Te*Qi*e.x1mth2*Er/Gu,Ls=Ni+Te*Qi*(e.x1mth2*Ui+1.5*e.con41)/Gu,bo=Math.sin(B),ho=Math.cos(B),wo=Math.sin(es),fl=Math.cos(es),sa=Math.sin(No),zr=Math.cos(No),Eo=-wo*zr,qc=fl*zr,Ra=Eo*bo+fl*ho,Co=qc*bo+wo*ho,Yd=sa*bo;return{position:{x:uo*Ra*Aa,y:uo*Co*Aa,z:uo*Yd*Aa},velocity:{x:(Fs*Ra+Ls*(Eo*ho-fl*bo))*VI,y:(Fs*Co+Ls*(qc*ho-wo*bo))*VI,z:(Fs*Yd+Ls*(sa*ho))*VI}}}function e5(e,o){var c,s=1440/(2*ts),f={error:0};f.satnum=e.substring(2,7),f.epochyr=parseInt(e.substring(18,20),10),f.epochdays=parseFloat(e.substring(20,32)),f.ndot=parseFloat(e.substring(33,43)),f.nddot=parseFloat(".".concat(parseInt(e.substring(44,50),10),"E").concat(e.substring(50,52))),f.bstar=parseFloat("".concat(e.substring(53,54),".").concat(parseInt(e.substring(54,59),10),"E").concat(e.substring(59,61))),f.inclo=parseFloat(o.substring(8,16)),f.nodeo=parseFloat(o.substring(17,25)),f.ecco=parseFloat(".".concat(o.substring(26,33))),f.argpo=parseFloat(o.substring(34,42)),f.mo=parseFloat(o.substring(43,51)),f.no=parseFloat(o.substring(52,63)),f.no/=s,f.inclo*=kg,f.nodeo*=kg,f.argpo*=kg,f.mo*=kg;var g=function Y4(e,o){for(var i=[31,e%4==0?29:28,31,30,31,30,31,31,30,31,30,31],s=Math.floor(o),c=1,f=0;s>f+i[c-1]&&c<12;)f+=i[c-1],c+=1;var g=c,v=s-f,w=24*(o-s),T=Math.floor(w);w=60*(w-T);var A=Math.floor(w);return{mon:g,day:v,hr:T,minute:A,sec:60*(w-A)}}(c=f.epochyr<57?f.epochyr+2e3:f.epochyr+1900,f.epochdays);return f.jdsatepoch=tF(c,g.mon,g.day,g.hr,g.minute,g.sec),function WW(e,o){var B,$,K,ut,yt,pt,Ft,Zt,de,oe,Te,si,Dn,ji,Xi,hr,Gt,fe,pe,Pe,Un,pi,Ve,sr,wn,Ue,en,Mn,Rn,Xn,xi,co,Nr,vo,ai,Li,bi,mi,Ni,li,Hn,fr,Er,Ui,Qi,xo,uo,es,No,Fs,Ls,i=o.opsmode,s=o.satn,c=o.epoch,f=o.xbstar,g=o.xecco,v=o.xargpo,w=o.xinclo,T=o.xmo,A=o.xno,k=o.xnodeo;e.isimp=0,e.method="n",e.aycof=0,e.con41=0,e.cc1=0,e.cc4=0,e.cc5=0,e.d2=0,e.d3=0,e.d4=0,e.delmo=0,e.eta=0,e.argpdot=0,e.omgcof=0,e.sinmao=0,e.t=0,e.t2cof=0,e.t3cof=0,e.t4cof=0,e.t5cof=0,e.x1mth2=0,e.x7thm1=0,e.mdot=0,e.nodedot=0,e.xlcof=0,e.xmcof=0,e.nodecf=0,e.irez=0,e.d2201=0,e.d2211=0,e.d3210=0,e.d3222=0,e.d4410=0,e.d4422=0,e.d5220=0,e.d5232=0,e.d5421=0,e.d5433=0,e.dedt=0,e.del1=0,e.del2=0,e.del3=0,e.didt=0,e.dmdt=0,e.dnodt=0,e.domdt=0,e.e3=0,e.ee2=0,e.peo=0,e.pgho=0,e.pho=0,e.pinco=0,e.plo=0,e.se2=0,e.se3=0,e.sgh2=0,e.sgh3=0,e.sgh4=0,e.sh2=0,e.sh3=0,e.si2=0,e.si3=0,e.sl2=0,e.sl3=0,e.sl4=0,e.gsto=0,e.xfact=0,e.xgh2=0,e.xgh3=0,e.xgh4=0,e.xh2=0,e.xh3=0,e.xi2=0,e.xi3=0,e.xl2=0,e.xl3=0,e.xl4=0,e.xlamo=0,e.zmol=0,e.zmos=0,e.atime=0,e.xli=0,e.xni=0,e.bstar=f,e.ecco=g,e.argpo=v,e.inclo=w,e.mo=T,e.no=A,e.nodeo=k,e.operationmode=i;var ho=78/Aa+1,wo=42/Aa,fl=wo*wo*wo*wo;e.init="y",e.t=0;var zr=function GW(e){var o=e.ecco,i=e.epoch,s=e.inclo,c=e.opsmode,f=e.no,g=o*o,v=1-g,w=Math.sqrt(v),T=Math.cos(s),A=T*T,k=Math.pow(Gu/f,a0),B=.75*np*(3*A-1)/(w*v),$=B/(k*k),K=k*(1-$*$-$*(1/3+134*$*$/81));f/=1+($=B/(K*K));var gn,Q=Math.pow(Gu/f,a0),ut=Math.sin(s),yt=Q*v,pt=1-5*A,Ft=-pt-A-A,Zt=1/Q,de=yt*yt,oe=Q*(1-o);if("a"===c){var bn=i-7305,si=Math.floor(bn+1e-8),Dn=.017202791694070362;(gn=(1.7321343856509375+Dn*si+(Dn+wr)*(bn-si)+bn*bn*5075514194322695e-30)%wr)<0&&(gn+=wr)}else gn=eF(i+2433281.5);return{no:f,method:"n",ainv:Zt,ao:Q,con41:Ft,con42:pt,cosio:T,cosio2:A,eccsq:g,omeosq:v,posq:de,rp:oe,rteosq:w,sinio:ut,gsto:gn}}({satn:s,ecco:e.ecco,epoch:c,inclo:e.inclo,no:e.no,method:e.method,opsmode:e.operationmode}),Eo=zr.ao,qc=zr.con42,Ra=zr.cosio,Co=zr.cosio2,Yd=zr.eccsq,nc=zr.omeosq,Wc=zr.posq,ic=zr.rp,rc=zr.rteosq,ps=zr.sinio;if(e.no=zr.no,e.con41=zr.con41,e.gsto=zr.gsto,e.a=Math.pow(e.no*W4,-2/3),e.alta=e.a*(1+e.ecco)-1,e.altp=e.a*(1-e.ecco)-1,e.error=0,nc>=0||e.no>=0){if(e.isimp=0,ic<220/Aa+1&&(e.isimp=1),Ve=ho,Gt=fl,(ji=(ic-1)*Aa)<156){Ve=ji-78,ji<98&&(Ve=20);var aa=(120-Ve)/Aa;Gt=aa*aa*aa*aa,Ve=Ve/Aa+1}Xi=1/Wc,e.eta=Eo*e.ecco*(Hn=1/(Eo-Ve)),Te=e.eta*e.eta,oe=e.ecco*e.eta,hr=Math.abs(1-Te),pt=(yt=Gt*Math.pow(Hn,4))/Math.pow(hr,3.5),e.cc1=e.bstar*(pt*e.no*(Eo*(1+1.5*Te+oe*(4+Te))+.375*np*Hn/hr*e.con41*(8+3*Te*(8+Te)))),ut=0,e.ecco>1e-4&&(ut=-2*yt*Hn*ip*e.no*ps/e.ecco),e.x1mth2=1-Co,e.cc4=2*e.no*pt*Eo*nc*(e.eta*(2+.5*Te)+e.ecco*(.5+2*Te)-np*Hn/(Eo*hr)*(-3*e.con41*(1-2*oe+Te*(1.5-.5*oe))+.75*e.x1mth2*(2*Te-oe*(1+Te))*Math.cos(2*e.argpo))),e.cc5=2*pt*Eo*nc*(1+2.75*(Te+oe)+oe*Te),li=-.46875*X4*Xi*Xi*e.no,e.mdot=e.no+.5*(mi=1.5*np*Xi*e.no)*rc*e.con41+.0625*(Ni=.5*mi*np*Xi)*rc*(13-78*Co+137*(Ft=Co*Co)),e.argpdot=-.5*mi*qc+.0625*Ni*(7-114*Co+395*Ft)+li*(3-36*Co+49*Ft),e.nodedot=(Er=-mi*Ra)+(.5*Ni*(4-19*Co)+2*li*(3-7*Co))*Ra,fr=e.argpdot+e.nodedot,e.omgcof=e.bstar*ut*Math.cos(e.argpo),e.xmcof=0,e.ecco>1e-4&&(e.xmcof=-a0*yt*e.bstar/oe),e.nodecf=3.5*nc*Er*e.cc1,e.t2cof=1.5*e.cc1,e.xlcof=Math.abs(Ra+1)>15e-13?-.25*ip*ps*(3+5*Ra)/(1+Ra):-.25*ip*ps*(3+5*Ra)/15e-13,e.aycof=-.5*ip*ps;var oc=1+e.eta*Math.cos(e.mo);if(e.delmo=oc*oc*oc,e.sinmao=Math.sin(e.mo),e.x7thm1=7*Co-1,2*ts/e.no>=225){e.method="d",e.isimp=1,si=e.inclo;var le=function HW(e){var w,T,A,k,B,$,K,Q,ut,yt,pt,Ft,Zt,de,oe,Te,gn,bn,si,fi,Dn,ji,Xi,hr,Gt,fe,pe,Pe,Un,pi,Ve,sr,wn,Ue,en,Mn,Rn,Xn,xi,co,Nr,vo,ai,Li,Ar,bi,mi,Ni,li,Hn,fr,Er,Ui,Qi,xo,uo,es,No,Fs,Ls,bo,ho,wo,o=e.epoch,s=e.argpp,c=e.tc,f=e.inclp,g=e.nodep,nc=e.np,Wc=e.ep,ic=Math.sin(g),rc=Math.cos(g),ps=Math.sin(s),aa=Math.cos(s),oc=Math.sin(f),Zc=Math.cos(f),le=Wc*Wc,sc=1-le,pl=Math.sqrt(sc),Kd=o+18261.5+c/1440,Xc=(4.523602-.00092422029*Kd)%wr,zo=Math.sin(Xc),ac=Math.cos(Xc),c0=.91375164-.03568096*ac,u0=Math.sqrt(1-c0*c0),Ns=.089683511*zo/u0,zs=Math.sqrt(1-Ns*Ns),Hr=5.8351514+.001944368*Kd,Lg=.39785416*zo/u0;Lg=Math.atan2(Lg,zs*ac+.91744867*Ns*zo),Lg+=Hr-Xc;var rF=Math.cos(Lg),oF=Math.sin(Lg);fi=.1945905,Dn=-.98088458,hr=.91744867,Gt=.39785416,ji=rc,Xi=ic,pt=29864797e-13;for(var sF=1/nc,nE=0;nE<2;)xo=-6*(w=fi*ji+Dn*hr*Xi)*(B=-oc*(K=-fi*Xi+Dn*hr*ji)+Zc*(Q=Dn*Gt))+le*(-24*(Ft=w*aa+(T=Zc*K+oc*Q)*ps)*(bn=B*aa)-6*(de=-w*ps+T*aa)*(Te=B*ps)),uo=-6*(w*($=-oc*(ut=Dn*Xi+fi*hr*ji)+Zc*(yt=fi*Gt))+(A=-Dn*ji+fi*hr*Xi)*B)+le*(-24*((Zt=A*aa+(k=Zc*ut+oc*yt)*ps)*bn+Ft*(si=$*aa))+-6*(de*(gn=$*ps)+(oe=-A*ps+k*aa)*Te)),es=-6*A*$+le*(-24*Zt*si-6*oe*gn),No=6*T*B+le*(24*Ft*Te-6*de*bn),Fs=6*(k*B+T*$)+le*(24*(Zt*Te+Ft*gn)-6*(oe*bn+de*si)),Ls=6*k*$+le*(24*Zt*gn-6*oe*si),Er=(Er=3*(w*w+T*T)+(bo=12*Ft*Ft-3*de*de)*le)+Er+sc*bo,Ui=(Ui=6*(w*A+T*k)+(ho=24*Ft*Zt-6*de*oe)*le)+Ui+sc*ho,Qi=(Qi=3*(A*A+k*k)+(wo=12*Zt*Zt-3*oe*oe)*le)+Qi+sc*wo,bi=-.5*(mi=pt*sF)/pl,Ar=-15*Wc*(Ni=mi*pl),li=Ft*de+Zt*oe,Hn=Zt*de+Ft*oe,fr=Zt*oe-Ft*de,1===(nE+=1)&&(fe=Ar,pe=bi,Pe=mi,Un=Ni,pi=li,Ve=Hn,sr=fr,wn=Er,Ue=Ui,en=Qi,Mn=xo,Rn=uo,Xn=es,xi=No,co=Fs,Nr=Ls,vo=bo,ai=ho,Li=wo,fi=rF,Dn=oF,hr=c0,Gt=u0,ji=zs*rc+Ns*ic,Xi=ic*zs-rc*Ns,pt=4.7968065e-7);return{snodm:ic,cnodm:rc,sinim:oc,cosim:Zc,sinomm:ps,cosomm:aa,day:Kd,e3:2*Ar*fr,ee2:2*Ar*Hn,em:Wc,emsq:le,gam:Hr,peo:0,pgho:0,pho:0,pinco:0,plo:0,rtemsq:pl,se2:2*fe*Ve,se3:2*fe*sr,sgh2:2*Un*ai,sgh3:2*Un*(Li-vo),sgh4:-18*Un*.01675,sh2:-2*pe*co,sh3:-2*pe*(Nr-xi),si2:2*pe*Rn,si3:2*pe*(Xn-Mn),sl2:-2*Pe*Ue,sl3:-2*Pe*(en-wn),sl4:-2*Pe*(-21-9*le)*.01675,s1:Ar,s2:bi,s3:mi,s4:Ni,s5:li,s6:Hn,s7:fr,ss1:fe,ss2:pe,ss3:Pe,ss4:Un,ss5:pi,ss6:Ve,ss7:sr,sz1:wn,sz2:Ue,sz3:en,sz11:Mn,sz12:Rn,sz13:Xn,sz21:xi,sz22:co,sz23:Nr,sz31:vo,sz32:ai,sz33:Li,xgh2:2*Ni*ho,xgh3:2*Ni*(wo-bo),xgh4:-18*Ni*.0549,xh2:-2*bi*Fs,xh3:-2*bi*(Ls-No),xi2:2*bi*uo,xi3:2*bi*(es-xo),xl2:-2*mi*Ui,xl3:-2*mi*(Qi-Er),xl4:-2*mi*(-21-9*le)*.0549,nm:nc,z1:Er,z2:Ui,z3:Qi,z11:xo,z12:uo,z13:es,z21:No,z22:Fs,z23:Ls,z31:bo,z32:ho,z33:wo,zmol:(.2299715*Kd-Hr+4.7199672)%wr,zmos:(6.2565837+.017201977*Kd)%wr}}({epoch:c,ep:e.ecco,argpp:e.argpo,tc:0,inclp:e.inclo,nodep:e.nodeo,np:e.no,e3:e.e3,ee2:e.ee2,peo:e.peo,pgho:e.pgho,pho:e.pho,pinco:e.pinco,plo:e.plo,se2:e.se2,se3:e.se3,sgh2:e.sgh2,sgh3:e.sgh3,sgh4:e.sgh4,sh2:e.sh2,sh3:e.sh3,si2:e.si2,si3:e.si3,sl2:e.sl2,sl3:e.sl3,sl4:e.sl4,xgh2:e.xgh2,xgh3:e.xgh3,xgh4:e.xgh4,xh2:e.xh2,xh3:e.xh3,xi2:e.xi2,xi3:e.xi3,xl2:e.xl2,xl3:e.xl3,xl4:e.xl4,zmol:e.zmol,zmos:e.zmos});e.e3=le.e3,e.ee2=le.ee2,e.peo=le.peo,e.pgho=le.pgho,e.pho=le.pho,e.pinco=le.pinco,e.plo=le.plo,e.se2=le.se2,e.se3=le.se3,e.sgh2=le.sgh2,e.sgh3=le.sgh3,e.sgh4=le.sgh4,e.sh2=le.sh2,e.sh3=le.sh3,e.si2=le.si2,e.si3=le.si3,e.sl2=le.sl2,e.sl3=le.sl3,e.sl4=le.sl4,$=le.sinim,B=le.cosim,Zt=le.em,de=le.emsq,fe=le.s1,pe=le.s2,Pe=le.s3,Un=le.s4,pi=le.s5,sr=le.ss1,wn=le.ss2,Ue=le.ss3,en=le.ss4,Mn=le.ss5,Rn=le.sz1,Xn=le.sz3,xi=le.sz11,co=le.sz13,Nr=le.sz21,vo=le.sz23,ai=le.sz31,Li=le.sz33,e.xgh2=le.xgh2,e.xgh3=le.xgh3,e.xgh4=le.xgh4,e.xh2=le.xh2,e.xh3=le.xh3,e.xi2=le.xi2,e.xi3=le.xi3,e.xl2=le.xl2,e.xl3=le.xl3,e.xl4=le.xl4,e.zmol=le.zmol,e.zmos=le.zmos,Dn=le.nm,Ui=le.z1,Qi=le.z3,xo=le.z11,uo=le.z13,es=le.z21,No=le.z23,Fs=le.z31,Ls=le.z33;var pl=J4(e,{inclo:si,init:e.init,ep:e.ecco,inclp:e.inclo,nodep:e.nodeo,argpp:e.argpo,mp:e.mo,opsmode:e.operationmode});e.ecco=pl.ep,e.inclo=pl.inclp,e.nodeo=pl.nodep,e.argpo=pl.argpp,e.mo=pl.mp;var Hi=function $W(e){var Ui,Qi,xo,sa,Co,Zc,sc,pl,Fg,Hi,l0,tE,eE,Kd,Xc,zo,ac,Ns,zs,Hr,o=e.cosim,i=e.argpo,c=e.s2,w=e.sinim,A=e.ss2,oe=e.t,bn=e.mo,si=e.mdot,fi=e.no,Dn=e.nodeo,ji=e.nodedot,Xi=e.xpidot,sr=e.ecco,wn=e.eccsq,Ue=e.emsq,en=e.em,Mn=e.argpm,Rn=e.inclm,Xn=e.mm,xi=e.nm,co=e.nodem,Nr=e.irez,vo=e.atime,ai=e.d2201,Li=e.d2211,Ar=e.d3210,bi=e.d3222,mi=e.d4410,Ni=e.d4422,li=e.d5220,Hn=e.d5232,fr=e.d5421,Er=e.d5433,uo=e.dnodt,es=e.domdt,No=e.del1,Fs=e.del2,Ls=e.del3,bo=e.xfact,ho=e.xlamo,wo=e.xli,fl=e.xni,iE=.0043752690880113,Ng=.00015835218,zg=119459e-10;Nr=0,xi<.0052359877&&xi>.0034906585&&(Nr=1),xi>=.00826&&xi<=.00924&&en>=.5&&(Nr=2);var d0=-zg*A*(e.sz21+e.sz23);(Rn<.052359877||Rn>ts-.052359877)&&(d0=0),0!==w&&(d0/=w);var rE=-Ng*c*(e.z21+e.z23);(Rn<.052359877||Rn>ts-.052359877)&&(rE=0),es=e.ss4*zg*(e.sz31+e.sz33-6)-o*d0+e.s4*Ng*(e.z31+e.z33-6),uo=d0,0!==w&&(es-=o/w*rE,uo+=rE/w);var oE=(e.gsto+e.tc*iE)%wr;if(en+=(Ui=e.ss1*zg*e.ss5+e.s1*Ng*e.s5)*oe,Rn+=(Qi=A*zg*(e.sz11+e.sz13)+c*Ng*(e.z11+e.z13))*oe,Mn+=es*oe,co+=uo*oe,Xn+=(xo=-zg*e.ss3*(e.sz1+e.sz3-14-6*Ue)-Ng*e.s3*(e.z1+e.z3-14-6*Ue))*oe,0!==Nr){if(Ns=Math.pow(xi/Gu,a0),2===Nr){var mF=en,gF=Ue;Hr=(en=sr)*(Ue=wn),en<=.65?(Zc=3.616-13.247*en+16.29*Ue,sc=117.39*en-19.302-228.419*Ue+156.591*Hr,pl=109.7927*en-18.9068-214.6334*Ue+146.5816*Hr,Fg=242.694*en-41.122-471.094*Ue+313.953*Hr,Hi=841.88*en-146.407-1629.014*Ue+1083.435*Hr,l0=3017.977*en-532.114-5740.032*Ue+3708.276*Hr):(Zc=331.819*en-72.099-508.738*Ue+266.724*Hr,sc=1582.851*en-346.844-2415.925*Ue+1246.113*Hr,pl=1554.908*en-342.585-2366.899*Ue+1215.972*Hr,Fg=4758.686*en-1052.797-7193.992*Ue+3651.957*Hr,Hi=16178.11*en-3581.69-24462.77*Ue+12422.52*Hr,l0=en>.715?29936.92*en-5149.66-54087.36*Ue+31324.56*Hr:1464.74-4664.75*en+3763.64*Ue),en<.7?(Kd=4988.61*en-919.2277-9064.77*Ue+5542.21*Hr,tE=4568.6173*en-822.71072-8491.4146*Ue+5337.524*Hr,eE=4690.25*en-853.666-8624.77*Ue+5341.4*Hr):(Kd=161616.52*en-37995.78-229838.2*Ue+109377.94*Hr,tE=218913.95*en-51752.104-309468.16*Ue+146349.42*Hr,eE=170470.89*en-40023.88-242699.48*Ue+115605.82*Hr),ai=(zo=17891679e-13*(ac=xi*xi*3*(Ns*Ns)))*(sa=.75*(1+2*o+(zs=o*o)))*(-.306-.44*(en-.64)),Li=zo*(1.5*(Xc=w*w))*Zc,Ar=(zo=3.7393792e-7*(ac*=Ns))*(1.875*w*(1-2*o-3*zs))*sc,bi=zo*(-1.875*w*(1+2*o-3*zs))*pl,mi=(zo=2*(ac*=Ns)*7.3636953e-9)*(35*Xc*sa)*Fg,Ni=zo*(39.375*Xc*Xc)*Hi,li=(zo=1.1428639e-7*(ac*=Ns))*(9.84375*w*(Xc*(1-2*o-5*zs)+.33333333*(4*o-2+6*zs)))*l0,Hn=zo*(w*(4.92187512*Xc*(-2-4*o+10*zs)+6.56250012*(1+2*o-3*zs)))*eE,fr=(zo=2*ac*2.1765803e-9)*(29.53125*w*(2-8*o+zs*(8*o-12+10*zs)))*tE,Er=zo*(29.53125*w*(-2-8*o+zs*(12+8*o-10*zs)))*Kd,ho=(bn+Dn+Dn-(oE+oE))%wr,bo=si+xo+2*(ji+uo-iE)-fi,en=mF,Ue=gF}1===Nr&&(Co=1+o,Fs=2*(No=3*xi*xi*Ns*Ns)*(sa=.75*(1+o)*(1+o))*(1+Ue*(.8125*Ue-2.5))*17891679e-13,Ls=3*No*(Co*=1.875*Co*Co)*(1+Ue*(6.60937*Ue-6))*2.2123015e-7*Ns,No=No*(.9375*w*w*(1+3*o)-.75*(1+o))*(sc=1+2*Ue)*21460748e-13*Ns,ho=(bn+Dn+i-oE)%wr,bo=si+Xi+xo+es+uo-(fi+iE)),wo=ho,fl=fi,vo=0,xi=fi+0}return{em:en,argpm:Mn,inclm:Rn,mm:Xn,nm:xi,nodem:co,irez:Nr,atime:vo,d2201:ai,d2211:Li,d3210:Ar,d3222:bi,d4410:mi,d4422:Ni,d5220:li,d5232:Hn,d5421:fr,d5433:Er,dedt:Ui,didt:Qi,dmdt:xo,dndt:0,dnodt:uo,domdt:es,del1:No,del2:Fs,del3:Ls,xfact:bo,xlamo:ho,xli:wo,xni:fl}}({cosim:B,emsq:de,argpo:e.argpo,s1:fe,s2:pe,s3:Pe,s4:Un,s5:pi,sinim:$,ss1:sr,ss2:wn,ss3:Ue,ss4:en,ss5:Mn,sz1:Rn,sz3:Xn,sz11:xi,sz13:co,sz21:Nr,sz23:vo,sz31:ai,sz33:Li,t:e.t,tc:0,gsto:e.gsto,mo:e.mo,mdot:e.mdot,no:e.no,nodeo:e.nodeo,nodedot:e.nodedot,xpidot:fr,z1:Ui,z3:Qi,z11:xo,z13:uo,z21:es,z23:No,z31:Fs,z33:Ls,ecco:e.ecco,eccsq:Yd,em:Zt,argpm:0,inclm:si,mm:0,nm:Dn,nodem:0,irez:e.irez,atime:e.atime,d2201:e.d2201,d2211:e.d2211,d3210:e.d3210,d3222:e.d3222,d4410:e.d4410,d4422:e.d4422,d5220:e.d5220,d5232:e.d5232,d5421:e.d5421,d5433:e.d5433,dedt:e.dedt,didt:e.didt,dmdt:e.dmdt,dnodt:e.dnodt,domdt:e.domdt,del1:e.del1,del2:e.del2,del3:e.del3,xfact:e.xfact,xlamo:e.xlamo,xli:e.xli,xni:e.xni});e.irez=Hi.irez,e.atime=Hi.atime,e.d2201=Hi.d2201,e.d2211=Hi.d2211,e.d3210=Hi.d3210,e.d3222=Hi.d3222,e.d4410=Hi.d4410,e.d4422=Hi.d4422,e.d5220=Hi.d5220,e.d5232=Hi.d5232,e.d5421=Hi.d5421,e.d5433=Hi.d5433,e.dedt=Hi.dedt,e.didt=Hi.didt,e.dmdt=Hi.dmdt,e.dnodt=Hi.dnodt,e.domdt=Hi.domdt,e.del1=Hi.del1,e.del2=Hi.del2,e.del3=Hi.del3,e.xfact=Hi.xfact,e.xlamo=Hi.xlamo,e.xli=Hi.xli,e.xni=Hi.xni}1!==e.isimp&&(e.d2=4*Eo*Hn*(K=e.cc1*e.cc1),e.d3=(17*Eo+Ve)*(bi=e.d2*Hn*e.cc1/3),e.d4=.5*bi*Eo*Hn*(221*Eo+31*Ve)*e.cc1,e.t3cof=e.d2+2*K,e.t4cof=.25*(3*e.d3+e.cc1*(12*e.d2+10*K)),e.t5cof=.2*(3*e.d4+12*e.cc1*e.d3+6*e.d2*e.d2+15*K*(2*e.d2+K)))}t5(e,0),e.init="n"}(f,{opsmode:"i",satn:f.satnum,epoch:f.jdsatepoch-2433281.5,xbstar:f.bstar,xecco:f.ecco,xargpo:f.argpo,xinclo:f.inclo,xmo:f.mo,xno:f.no,xnodeo:f.nodeo}),f}function nF(e,o){(null==o||o>e.length)&&(o=e.length);for(var i=0,s=new Array(o);i<o;i++)s[i]=e[i];return s}function n5(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];var s=o[0],c=Array.prototype.slice.call(o,1);return t5(s,1440*(tF.apply(void 0,function ZW(e){return function XW(e){if(Array.isArray(e))return nF(e)}(e)||function YW(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function KW(e,o){if(e){if("string"==typeof e)return nF(e,o);var i=Object.prototype.toString.call(e).slice(8,-1);if("Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return nF(e,o)}}(e)||function JW(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(c))-s.jdsatepoch))}function i5(e){return e*$4}function o5(e){if(e<-ts/2||e>ts/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return i5(e)}function s5(e){if(e<-ts||e>ts)throw new RangeError("Longitude radians must be in range [-pi; pi].");return i5(e)}function a5(e,o){for(var i=6378.137,c=Math.sqrt(e.x*e.x+e.y*e.y),f=(i-6356.7523142)/i,g=2*f-f*f,v=Math.atan2(e.y,e.x)-o;v<-ts;)v+=wr;for(;v>ts;)v-=wr;for(var k,T=0,A=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y));T<20;)k=1/Math.sqrt(1-g*(Math.sin(A)*Math.sin(A))),A=Math.atan2(e.z+i*k*g*Math.sin(A),c),T+=1;return{longitude:v,latitude:A,height:c/Math.cos(A)-i*k}}let l5=(()=>{class e{constructor(){this.coordinatesSubject=new on,this.satelliteJsonSubject=new on,this.satelliteArraySubject=new on,this.tleLine1="",this.tleLine2="",this.updateSatelliteData(),this.calculateSatelliteCoordinatesFor24Hours()}get coordinates$(){return this.coordinatesSubject.asObservable()}get satelliteJson$(){return this.satelliteJsonSubject.asObservable()}get satelliteArray$(){return this.satelliteArraySubject.asObservable()}updateSatelliteData(){this.intervalId=setInterval(()=>{const i=new Date,v=a5(n5(e5(this.tleLine1,this.tleLine2),i).position,eF(i)),w=o5(v.latitude),T=s5(v.longitude);this.coordinatesSubject.next({latitude:w,longitude:T,altitude:v.height})},0)}calculateSatelliteCoordinatesFor24Hours(){const i=[],s=new Date,c=s.getMinutes();for(let g=c;g<=c+1380;g+=.01){const v=new Date(s.getTime()+6e4*(g-c)),B=a5(n5(e5(this.tleLine1,this.tleLine2),v).position,eF(v)),$=o5(B.latitude),K=s5(B.longitude);i.push([K,$,B.height])}this.satelliteArraySubject.next(i)}updateTLE(i,s){clearInterval(this.intervalId),this.tleLine1=i,this.tleLine2=s,this.updateSatelliteData(),this.calculateSatelliteCoordinatesFor24Hours()}updateJson(i){this.satelliteJsonSubject.next(i)}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275prov=ee({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function c5(e,o,i,s,c,f,g){try{var v=e[f](g),w=v.value}catch(T){return void i(T)}v.done?o(w):Promise.resolve(w).then(s,c)}let u5=(()=>{class e{constructor(i,s){this.http=i,this.satelliteService=s,this.selectedSatellite="",this.manualSatellite="",this.satelliteInfo="",this.satelliteName="",this.satelliteJson=""}getSatelliteInfo(){var i=this;return function nZ(e){return function(){var o=this,i=arguments;return new Promise(function(s,c){var f=e.apply(o,i);function g(w){c5(f,s,c,g,v,"next",w)}function v(w){c5(f,s,c,g,v,"throw",w)}g(void 0)})}}(function*(){let s=i.selectedSatellite;if(i.manualSatellite&&""!==i.manualSatellite.trim()&&(s=i.manualSatellite.trim()),s)try{const c=yield i.http.get(`https://us-central1-orbital-trackr.cloudfunctions.net/app/satellite/${s}`,{responseType:"text"}).toPromise();if(void 0!==c){i.satelliteInfo=c;const g=c.split(/\r?\n/).filter(v=>v.trim().length>0);if(g.length>=3){i.satelliteName=g[0].trim();const v=g[1].trim(),w=g[2].trim();i.satelliteService.updateTLE(v,w)}else console.error("La respuesta del servidor no tiene el formato esperado")}else console.error("La respuesta del servidor est\xe1 vac\xeda");const f=yield i.http.get(`https://us-central1-orbital-trackr.cloudfunctions.net/app/info/${s}`).toPromise();void 0!==f&&f.length>0?i.satelliteService.updateJson(f[0]):console.error("La respuesta del servidor est\xe1 vac\xeda")}catch(c){console.error("Hubo un error al obtener la informaci\xf3n del sat\xe9lite:",c)}else console.error("Por favor, selecciona o ingresa un sat\xe9lite")})()}onSatelliteSelect(i){this.manualSatellite="",this.getSatelliteInfo()}onManualSatelliteInput(){this.selectedSatellite=""}static#t=this.\u0275fac=function(s){return new(s||e)(_t(GD),_t(l5))};static#e=this.\u0275cmp=os({type:e,selectors:[["app-satellite-info"]],decls:20,vars:2,consts:[["matFormField","",1,"selector-satellite"],["for","satelliteSelector"],["id","satelliteSelector",3,"ngModel","ngModelChange","selectionChange"],["value","SSOT"],["value","EROS C3"],["value","EROS B"],["value","ISS (ZARYA)"],["value","SDO"],["matFormField","",1,"input-satellite"],["matInput","","placeholder","Ingresar Sat\xe9lite Manualmente",3,"ngModel","ngModelChange","input"],["mat-raised-button","","color","primary",2,"margin-left","10px",3,"click"]],template:function(s,c){1&s&&(Iu(0,0),un(1,"mat-form-field")(2,"mat-label",1),us(3,"Seleccionar Sat\xe9lite"),mn(),un(4,"mat-select",2),cr("ngModelChange",function(g){return c.selectedSatellite=g})("selectionChange",function(g){return c.onSatelliteSelect(g)}),un(5,"mat-option",3),us(6,"SSOT"),mn(),un(7,"mat-option",4),us(8,"EROS C3"),mn(),un(9,"mat-option",5),us(10,"EROS B"),mn(),un(11,"mat-option",6),us(12,"INTERNATIONAL SPACE STATION (ISS)"),mn(),un(13,"mat-option",7),us(14,"SOLAR DATA OBSERVATORY (SDO)"),mn()()(),wf(),Iu(15,8),un(16,"mat-form-field")(17,"input",9),cr("ngModelChange",function(g){return c.manualSatellite=g})("input",function(){return c.onManualSatelliteInput()}),mn()(),un(18,"button",10),cr("click",function(){return c.getSatelliteInfo()}),us(19,"Buscar"),mn(),wf()),2&s&&(pn(4),Cn("ngModel",c.selectedSatellite),pn(13),Cn("ngModel",c.manualSatellite))},dependencies:[WD,N3,tk,rB,qq,Tk,d7,Qz,v7],styles:["[_ngcontent-%COMP%]::placeholder{color:#999;font-size:13px}mat-option[_ngcontent-%COMP%]{font-size:13px}mat-label[_ngcontent-%COMP%]{font-size:13px}selector-satellite[_ngcontent-%COMP%]{font-size:13px}"]})}return e})(),d5=(()=>{class e{constructor(i){this.satelliteService=i,this.mapInitialized=!1,this.satelliteJson="",this.coordinatesArray=[]}ngOnInit(){this.initializeMap(),this.satelliteSubscription=this.satelliteService.coordinates$.subscribe(i=>{this.satelliteCoordinates=i,this.updateMarkerPosition(),this.initializeMap()}),this.satelliteService.satelliteJson$.subscribe(i=>{this.flyToSatellite(),this.satelliteJson=i,this.mapInitialized&&this.addOrUpdateMarker()}),this.satelliteArraySubscription=this.satelliteService.satelliteArray$.subscribe(i=>{this.coordinatesArray=i,this.mapInitialized&&this.drawSatellitePath(i)})}ngOnDestroy(){this.satelliteSubscription&&this.satelliteSubscription.unsubscribe(),this.satelliteArraySubscription&&this.satelliteArraySubscription.unsubscribe()}ngAfterViewInit(){this.initializeMap()}initializeMap(){this.mapInitialized||(s0().accessToken="pk.eyJ1Ijoic2hpemExOTkxIiwiYSI6ImNscWZ5eGo0ZTE0NGUya3F3eDA5bzh6bXoifQ.ru0c29-QaQzDC_AefTP9tA",this.satelliteSubscription=this.satelliteService.coordinates$.subscribe(i=>{this.satelliteCoordinates=i,this.satelliteCoordinates&&!this.map&&(this.map=new(s0().Map)({container:"map",style:"mapbox://styles/shiza1991/clqrjzve800ld01pd59dg9y7s",center:[-70.648,-33.456],zoom:1}),this.map.addControl(new(s0().NavigationControl)),this.map.on("style.load",()=>{this.mapInitialized=!0,this.addOrUpdateMarker()}))}))}flyToSatellite(){if(this.satelliteCoordinates&&this.map){const{latitude:i,longitude:s}=this.satelliteCoordinates;this.map.flyTo({center:[s,i],zoom:1,essential:!0})}}updateMarkerPosition(){this.mapInitialized&&this.map&&this.satelliteCoordinates&&this.addOrUpdateMarker()}addOrUpdateMarker(){if(!this.map||!this.satelliteCoordinates||!this.satelliteJson)return;const{latitude:i,longitude:s}=this.satelliteCoordinates,c=this.createCustomMarker();if(this.marker){this.marker.setLngLat([s,i]),this.marker.getElement()&&this.marker.getElement().remove(),this.marker=new(s0().Marker)(c).setLngLat([s,i]).addTo(this.map);const f=document.createElement("div");f.id="satelliteNameLabel",f.innerHTML=this.satelliteJson.OBJECT_NAME,f.style.color="#ffffff",f.style.fontSize="10px",f.style.height="30px",f.style.textAlign="center",f.style.backgroundColor="#000000",f.style.padding="10px",f.style.marginTop="-50px",f.style.borderRadius="5px",f.style.width="70px",f.style.display="flex",f.style.justifyContent="center",f.style.alignItems="center",this.marker.getElement().appendChild(f);const g=this.generatePopupContent(),v=new(s0().Popup)({closeButton:!1}).setHTML(g);this.marker.setPopup(v),this.marker.getElement().addEventListener("click",()=>{this.marker?.getPopup&&this.marker.getPopup().remove()});const w=this.marker.getElement().querySelector("#satelliteNameLabel");w&&(w.innerHTML=this.satelliteJson.OBJECT_NAME);const T=this.marker.getPopup();T&&T.setHTML(g)}else this.marker=new(s0().Marker)(c).setLngLat([s,i]).addTo(this.map)}createCustomMarker(){const i=document.createElement("div");switch(i.className="custom-marker",this.satelliteJson.OBJECT_NAME){case"SSOT":i.style.backgroundImage="url('../../assets/img/fasat.png')",i.style.width="50px",i.style.height="50px";break;case"ISS (ZARYA)":i.style.backgroundImage="url('../../assets/img/iss.png')",i.style.width="50px",i.style.height="50px";break;default:i.style.backgroundImage="url('../../assets/img/sat.png')",i.style.width="50px",i.style.height="50px"}return i.style.backgroundSize="contain",i.style.backgroundPosition="center center",i.style.backgroundRepeat="no-repeat",i.style.cursor="pointer",i}generatePopupContent(){return`\n    <style>\n      table {\n        width: auto;\n        font-size: 8px; \n      }\n    </style>\n    <h6>${this.satelliteJson.OBJECT_NAME}</h6>  \n        <table>\n        <tr>\n            <td><strong>OBJECT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.OBJECT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ECCENTRICITY:</strong></td>\n            <td><pre>${this.satelliteJson.ECCENTRICITY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>INCLINATION:</strong></td>\n            <td><pre>${this.satelliteJson.INCLINATION}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>RA_OF_ASC_NODE:</strong></td>\n            <td><pre>${this.satelliteJson.RA_OF_ASC_NODE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ARG_OF_PERICENTER:</strong></td>\n            <td><pre>${this.satelliteJson.ARG_OF_PERICENTER}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_ANOMALY:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_ANOMALY}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>EPHEMERIS_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.EPHEMERIS_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>CLASSIFICATION_TYPE:</strong></td>\n            <td><pre>${this.satelliteJson.CLASSIFICATION_TYPE}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>NORAD_CAT_ID:</strong></td>\n            <td><pre>${this.satelliteJson.NORAD_CAT_ID}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>ELEMENT_SET_NO:</strong></td>\n            <td><pre>${this.satelliteJson.ELEMENT_SET_NO}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>REV_AT_EPOCH:</strong></td>\n            <td><pre>${this.satelliteJson.REV_AT_EPOCH}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>BSTAR:</strong></td>\n            <td><pre>${this.satelliteJson.BSTAR}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DOT}</pre></td>\n        </tr>\n        <tr>\n            <td><strong>MEAN_MOTION_DDOT:</strong></td>\n            <td><pre>${this.satelliteJson.MEAN_MOTION_DDOT}</pre></td>\n        </tr>\n        </table>\n  `}drawSatellitePath(i){if(this.map&&i&&!(i.length<2))if(this.map.getSource("satellitePath")){const s=this.map.getSource("satellitePath");s&&s.setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:i}})}else this.map.addSource("satellitePath",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:i}}}),this.map.addLayer({id:"satellitePath",type:"line",source:"satellitePath",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FF0000","line-opacity":.8,"line-width":2}}),this.mapInitialized=!0}static#t=this.\u0275fac=function(s){return new(s||e)(_t(l5))};static#e=this.\u0275cmp=os({type:e,selectors:[["app-satellite-map"]],decls:8,vars:0,consts:[[1,"container"],[1,"flex-container"],["mat-stroked-button","","color","accent",1,"fly-button",3,"click"],["id","map",1,"map-container"]],template:function(s,c){1&s&&(un(0,"div",0)(1,"div",1),oo(2,"app-satellite-info"),un(3,"button",2),cr("click",function(){return c.flyToSatellite()}),un(4,"mat-icon"),us(5,"center_focus_strong"),mn(),us(6,"Centrar Sat\xe9lite"),mn()()(),oo(7,"div",3))},dependencies:[rB,fG,u5],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding-bottom:10px}.flex-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;justify-content:center;width:100%;max-width:800px}.fly-button[_ngcontent-%COMP%]{color:#c3c5c3!important;background-color:#05014d;flex:1 1 auto;max-width:200px;height:50px}app-satellite-info[_ngcontent-%COMP%]{flex:1 1 30%;max-width:30%}.map-container[_ngcontent-%COMP%]{margin-top:3%;margin-left:5%;height:600px;width:90%;align-items:center}.mapboxgl-map[_ngcontent-%COMP%]{font:9px/15px Helvetica Neue,Arial,Helvetica,sans-serif}@media (max-width: 768px){.map-container[_ngcontent-%COMP%]{height:600px;overflow:hidden}.flex-container[_ngcontent-%COMP%]{flex-direction:column;align-items:center}app-satellite-info[_ngcontent-%COMP%], .fly-button[_ngcontent-%COMP%]{flex:1 1 auto;min-width:55%;max-width:45%}}"]})}return e})();const iZ=[{path:"satellite",component:d5},{path:"satelliteInfo",component:u5}];let rZ=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e});static#n=this.\u0275inj=gi({imports:[U4.forRoot(iZ),U4]})}return e})(),oZ=(()=>{class e{constructor(){this.title="Orbital"}static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275cmp=os({type:e,selectors:[["app-root"]],decls:2,vars:0,consts:[[1,"app-container"]],template:function(s,c){1&s&&(un(0,"div",0),oo(1,"app-satellite-map"),mn())},dependencies:[d5],styles:[".app-container[_ngcontent-%COMP%]{margin-top:5%;justify-content:center;align-items:center;height:100vh;text-align:center}"]})}return e})(),sZ=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=ci({type:e,bootstrap:[oZ]});static#n=this.\u0275inj=gi({imports:[iN,q6,rZ,g8,SH,eG,pG,h7,bI,x7]})}return e})();jj().bootstrapModule(sZ).catch(e=>console.error(e))},574:function(h0){h0.exports=function(){"use strict";var Jd,qu,qn;function rp(Qt,st){if(Jd)if(qu){var Pa="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Jd+")(sharedChunk); ("+qu+")(sharedChunk); self.onerror = null;",ml={};Jd(ml),qn=st(ml),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(qn.workerUrl=window.URL.createObjectURL(new Blob([Pa],{type:"text/javascript"})))}else qu=st;else Jd=st}return rp(0,function(Qt){var st=typeof self<"u"?self:{},Pa="3.0.1";let ml;const He={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ml){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ml=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{ml=n}}return ml},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!He.API_URL)return null;try{const n=new URL(He.API_URL);return"api.mapbox.cn"===n.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===n.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},Bs={supported:!1,testSupport:function(n){!Wu&&lc&&(Yc?Bg(n):Oa=n)}};let Oa,lc,Wu=!1,Yc=!1;function Bg(n){const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,lc),n.isContextLost())return;Bs.supported=!0}catch{}n.deleteTexture(t),Wu=!0}st.document&&(lc=st.document.createElement("img"),lc.onload=function(){Oa&&Bg(Oa),Oa=null,Yc=!0},lc.onerror=function(){Wu=!0,Oa=null},lc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const op="01";function ms(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var gl=_l;function _l(n,t,r,a){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=a}_l.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(void 0===t&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,a=0;a<8;a++){var l=this.sampleCurveX(r)-n;if(Math.abs(l)<t)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var d=0,h=1;for(r=n,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-n)<t));a++)n>l?d=r:h=r,r=.5*(h-d)+d;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Vg=ms(gl),Kc=yl;function yl(n,t){this.x=n,this.y=t}yl.prototype={clone:function(){return new yl(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),r=Math.sin(n),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround:function(n,t){var r=Math.cos(n),a=Math.sin(n),l=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yl.convert=function(n){return n instanceof yl?n:Array.isArray(n)?new yl(n[0],n[1]):n};var nt=ms(Kc);function cn(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!cn(n[r],t[r]))return!1;return!0}if("object"==typeof n&&null!==n&&null!==t){if("object"!=typeof t||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!cn(n[r],t[r]))return!1;return!0}return n===t}const Zu=Math.PI/180,vl=180/Math.PI;function Ie(n){return n*Zu}function Cr(n){return n*vl}const p0=[[0,0],[1,0],[1,1],[0,1]];function Jc(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function xl(n){let t=1/0,r=1/0,a=-1/0,l=-1/0;for(const u of n)t=Math.min(t,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),l=Math.max(l,u.y);return{min:new nt(t,r),max:new nt(a,l)}}function Xu(n,t,r=0,a=!0){const l=new nt(r,r),u=n.sub(l),d=t.add(l),h=[u,new nt(d.x,u.y),d,new nt(u.x,d.y)];return a&&h.push(u.clone()),h}function Qc(n,t,r,a){const l=new Vg(n,t,r,a);return function(u){return l.solve(u)}}const $n=Qc(.25,.1,.25,1);function Jt(n,t,r){return Math.min(r,Math.max(t,n))}function bl(n,t,r){return(r=Jt((r-n)/(t-n),0,1))*r*(3-2*r)}function wl(n,t,r){const a=r-t,l=((n-t)%a+a)%a+t;return l===t?r:l}function Yu(n,t,r){if(!n.length)return r(null,[]);let a=n.length;const l=new Array(n.length);let u=null;n.forEach((d,h)=>{t(d,(p,m)=>{p&&(u=p),l[h]=m,0==--a&&r(u,l)})})}function on(n){const t=[];for(const r in n)t.push(n[r]);return t}function Yt(n,...t){for(const r of t)for(const a in r)n[a]=r[a];return n}function ns(n,t){const r={};for(let a=0;a<t.length;a++){const l=t[a];l in n&&(r[l]=n[l])}return r}let ar=1;function Di(){return ar++}function jg(){return function n(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function dn(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Qd(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Rr(n,t){n.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function tu(n,t){return-1!==n.indexOf(t,n.length-t.length)}function th(n,t,r){const a={};for(const l in n)a[l]=t.call(r||this,n[l],l,n);return a}function Pt(n,t,r){const a={};for(const l in n)t.call(r||this,n[l],l,n)&&(a[l]=n[l]);return a}function H(n){return Array.isArray(n)?n.map(H):"object"==typeof n&&n?th(n,H):n}const W={};function tt(n){W[n]||(typeof console<"u"&&console.warn(n),W[n]=!0)}function wt(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function Mt(n){let t=0;for(let r,a,l=0,u=n.length,d=u-1;l<u;d=l++)r=n[l],a=n[d],t+=(a.x-r.x)*(r.y+a.y);return t}function qt([n,t,r]){const a=Ie(t+90),l=Ie(r);return{x:n*Math.cos(a)*Math.sin(l),y:n*Math.sin(a)*Math.sin(l),z:n*Math.cos(l),azimuthal:t,polar:r}}function te(n,t,r){const a=Math.sqrt(n*n+t*t+r*r),l=a>0?Math.acos(r/a)*vl:0;let u=0!==n||0!==t?Math.atan2(-t,-n)*vl+90:0;return u<0&&(u+=360),[a,u,l]}function Ct(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ae(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,u)=>{const d=l||u;return t[a]=!d||d.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let xe=null;function be(){return!!st.document.fullscreenElement||!!st.document.webkitFullscreenElement}function Yn(n){try{const t=st[n];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function zi(n,t){return[n[4*t],n[4*t+1],n[4*t+2],n[4*t+3]]}function Br(n,t,r){n[4*t+0]=r[0],n[4*t+1]=r[1],n[4*t+2]=r[2],n[4*t+3]=r[3]}function Bi(n,t){return[Math.pow(n[0],2.2)*t,Math.pow(n[1],2.2)*t,Math.pow(n[2],2.2)*t]}function ni(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]}const ii="mapbox-tiles";let is,ka,Mo=500,Bo=50;function eh(){try{return st.caches}catch{}}function gs(){eh()&&!is&&(is=st.caches.open(ii))}function cc(n){const t=n.indexOf("?");if(t<0)return n;const a=function(l){const u=l.indexOf("?");return u>0?l.slice(u+1).split("&"):[]}(n).filter(l=>{const u=l.split("=");return"language"===u[0]||"worldview"===u[0]});return a.length?`${n.slice(0,t)}?${a.join("&")}`:n.slice(0,t)}let eu=1/0;function nh(n){eu++,eu>Bo&&(n.getActor().send("enforceCacheSizeLimit",Mo),eu=0)}const gt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(gt);class xt extends Error{constructor(t,r,a){401===r&&En(a)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Tt=Ct()?()=>self.worker&&self.worker.referrer:()=>("blob:"===st.location.protocol?st.parent:st).location.href,Ot=function(n,t){if(!(/^file:/.test(r=n.url)||/^file:/.test(Tt())&&!/^\w+:/.test(r))){if(st.fetch&&st.Request&&st.AbortController&&st.Request.prototype.hasOwnProperty("signal"))return function(a,l){const u=new st.AbortController,d=new st.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Tt(),referrerPolicy:a.referrerPolicy,signal:u.signal});let h=!1,p=!1;const m=(_=d.url).indexOf("sku=")>0&&En(_);var _;"json"===a.type&&d.headers.set("Accept","application/json");const y=(b,E,C)=>{if(p)return;if(b&&"SecurityError"!==b.message&&tt(b.toString()),E&&C)return x(E);const S=Date.now();st.fetch(d).then(M=>{if(M.ok){const D=m?M.clone():null;return x(M,D,S)}return l(new xt(M.statusText,M.status,a.url))}).catch(M=>{"AbortError"!==M.name&&l(new Error(`${M.message} ${a.url}`))})},x=(b,E,C)=>{("arrayBuffer"===a.type?b.arrayBuffer():"json"===a.type?b.json():b.text()).then(S=>{p||(E&&C&&function(M,D,R){if(gs(),!is)return;const P={status:D.status,statusText:D.statusText,headers:new st.Headers};D.headers.forEach((F,L)=>P.headers.set(L,F));const I=ae(D.headers.get("Cache-Control")||"");if(I["no-store"])return;I["max-age"]&&P.headers.set("Expires",new Date(R+1e3*I["max-age"]).toUTCString());const O=P.headers.get("Expires");O&&(new Date(O).getTime()-R<42e4||function(F,L){if(void 0===ka)try{new Response(new ReadableStream),ka=!0}catch{ka=!1}ka?L(F.body):F.blob().then(L)}(D,F=>{const L=new st.Response(F,P);gs(),is&&is.then(N=>N.put(cc(M.url),L)).catch(N=>tt(N.message))}))}(d,E,C),h=!0,l(null,S,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(S=>{p||l(new Error(S.message))})};return m?function(b,E){if(gs(),!is)return E(null);const C=cc(b.url);is.then(S=>{S.match(C).then(M=>{const D=function(R){if(!R)return!1;const P=new Date(R.headers.get("Expires")||0),I=ae(R.headers.get("Cache-Control")||"");return P>Date.now()&&!I["no-cache"]}(M);S.delete(C),D&&S.put(C,M.clone()),E(null,M,D)}).catch(E)}).catch(E)}(d,y):y(null,null),{cancel:()=>{p=!0,h||u.abort()}}}(n,t);if(Ct()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var r;return function(a,l){const u=new st.XMLHttpRequest;u.open(a.method||"GET",a.url,!0),"arrayBuffer"===a.type&&(u.responseType="arraybuffer");for(const d in a.headers)u.setRequestHeader(d,a.headers[d]);return"json"===a.type&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials="include"===a.credentials,u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||0===u.status)&&null!==u.response){let d=u.response;if("json"===a.type)try{d=JSON.parse(u.response)}catch(h){return l(h)}l(null,d,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new xt(u.statusText,u.status,a.url))},u.send(a.body),{cancel:()=>u.abort()}}(n,t)},At=function(n,t){return Ot(Yt(n,{type:"json"}),t)},zt=function(n,t){return Ot(Yt(n,{type:"arrayBuffer"}),t)};function Ut(n){const t=st.document.createElement("a");return t.href=n,t.protocol===st.document.location.protocol&&t.host===st.document.location.host}const Lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Kt,Bt;Kt=[],Bt=0;const Oe=function(n,t){if(Bs.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Bt>=He.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:n,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Kt.push(u),u}Bt++;let r=!1;const a=()=>{if(!r)for(r=!0,Bt--;Kt.length&&Bt<He.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Kt.shift(),{requestParameters:d,callback:h,cancelled:p}=u;p||(u.cancel=Oe(d,h).cancel)}},l=zt(n,(u,d,h,p)=>{a(),u?t(u):d&&(st.createImageBitmap?function(m,_){const y=new st.Blob([new Uint8Array(m)],{type:"image/png"});st.createImageBitmap(y).then(x=>{_(null,x)}).catch(x=>{_(new Error(`Could not load image because of ${x.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(m,_)=>t(m,_,h,p)):function(m,_){const y=new st.Image,x=st.URL;y.onload=()=>{_(null,y),x.revokeObjectURL(y.src),y.onload=null,st.requestAnimationFrame(()=>{y.src=Lt})},y.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new st.Blob([new Uint8Array(m)],{type:"image/png"});y.src=m.byteLength?x.createObjectURL(b):Lt}(d,(m,_)=>t(m,_,h,p)))});return{cancel:()=>{l.cancel(),a()}}},Pn="NO_ACCESS_TOKEN";class ce{constructor(t,r,a){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",op,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!In(t))return t;const a=Mr(t);return a.params.push(`sdk=js-${Pa}`),a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!In(t))return t;const a=Mr(t);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeModelURL(t,r){if(!In(t))return t;const a=Mr(t);return a.path=`/models/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(t,r,a,l){if(!In(t))return t;const u=Mr(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),a&&u.params.push(`language=${a}`),l&&u.params.push(`worldview=${l}`),this._makeAPIURL(u,this._customAccessToken||r)}normalizeSpriteURL(t,r,a,l){const u=Mr(t);return In(t)?(u.path=`/styles/v1${u.path}/sprite${r}${a}`,this._makeAPIURL(u,this._customAccessToken||l)):(u.path+=`${r}${a}`,rs(u))}normalizeTileURL(t,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!In(t))return t;const l=Mr(t);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==l.authority&&512===a?"@2x":""}${Bs.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${He.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${He.TILE_URL_VERSION}${l.path}`);const u=this._customAccessToken||function(d){for(const h of d){const p=h.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(l.params)||He.ACCESS_TOKEN;return He.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,u)}canonicalizeTileURL(t,r){const a=Mr(t);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return t;let l="mapbox://";a.path.match(/^\/raster\/v1\//)?l+=`raster/${a.path.replace(`/${He.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${a.path.replace(`/${He.TILE_URL_VERSION}/`,"")}`;let u=a.params;return r&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(l+=`?${u.join("&")}`),l}canonicalizeTileset(t,r){const a=!!r&&In(r),l=[];for(const u of t.tiles||[])En(u)?l.push(this.canonicalizeTileURL(u,a)):l.push(u);return l}_makeAPIURL(t,r){const a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=Mr(He.API_URL);if(t.protocol=l.protocol,t.authority=l.authority,"http"===t.protocol){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if("/"!==l.path&&(t.path=`${l.path}${t.path}`),!He.REQUIRE_ACCESS_TOKEN)return rs(t);if(r=r||He.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return t.params=t.params.filter(u=>-1===u.indexOf("access_token")),t.params.push(`access_token=${r||""}`),rs(t)}}function In(n){return 0===n.indexOf("mapbox:")}function En(n){return He.API_URL_REGEX.test(n)}function Yi(n){return He.API_CDN_URL_REGEX.test(n)}function pr(n){return He.API_STYLE_REGEX.test(n)&&!So(n)}function So(n){return He.API_SPRITE_REGEX.test(n)}const la=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mr(n){const t=n.match(la);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function rs(n){const t=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${t}`}const To="mapbox.eventData";function _s(n){if(!n)return null;const t=n.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(st.atob(t[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class nu{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=_s(He.ACCESS_TOKEN);let a="";return a=r&&r.u?st.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(+("0x"+u)))):He.ACCESS_TOKEN||"",t?`${To}.${t}:${a}`:`${To}:${a}`}fetchEventData(){const t=Yn("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{const l=st.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const u=st.localStorage.getItem(a);u&&(this.anonId=u)}catch{tt("Unable to read from LocalStorage")}}saveEventData(){const t=Yn("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(t)try{st.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&st.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{tt("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,a,l){if(!He.EVENTS_URL)return;const u=Mr(He.EVENTS_URL);u.params.push(`access_token=${l||He.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(t).toISOString()},h=r?Yt(d,r):d,p={url:rs(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([h])};var _;this.pendingRequest=(_=m=>{this.pendingRequest=null,a(m),this.saveEventData(),this.processRequests(l)},Ot(Yt(p,{method:"POST"}),_))}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const mr=new class extends nu{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,t){He.EVENTS_URL&&He.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>In(r)||En(r))&&this.queueRequest(Date.now(),t)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=_s(He.ACCESS_TOKEN),r=t?t.u:He.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;Qd(this.anonId)||(this.anonId=jg(),a=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),d=new Date(l),h=(l-this.eventData.lastSuccess)/864e5;a=a||h>=1||h<-1||u.getDate()!==d.getDate()}else a=!0;a?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Pa,skuId:op,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},n):this.processRequests()}},iu=mr.postTurnstileEvent.bind(mr),ca=new class extends nu{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,t,r,a){this.skuToken=t,this.errorCb=a,He.EVENTS_URL&&(r||He.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Pn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Qd(this.anonId)||(this.anonId=jg()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Pa,skuId:op,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},n))}},_F=ca.postMapLoadEvent.bind(ca),sE=new class extends nu{constructor(){super("gljs.performance")}postPerformanceEvent(n,t){He.EVENTS_URL&&(n||He.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:r}=this.queue.shift(),a=function(l){const u=st.performance.getEntriesByType("resource"),d=st.performance.getEntriesByType("mark"),h=function(x){const b={};if(x)for(const E in x)if("other"!==E)for(const C of x[E]){const S=`${E}ResolveRangeMin`,M=`${E}ResolveRangeMax`,D=`${E}RequestCount`,R=`${E}RequestCachedCount`;b[S]=Math.min(b[S]||1/0,C.startTime),b[M]=Math.max(b[M]||-1/0,C.responseEnd);const P=I=>{void 0===b[I]&&(b[I]=0),++b[I]};void 0!==C.transferSize&&0===C.transferSize&&P(R),P(D)}return b}(function(x,b){const E={};if(x)for(const C of x){const S=b(C);void 0===E[S]&&(E[S]=[]),E[S].push(C)}return E}(u,UI)),p=st.devicePixelRatio,m=st.navigator.connection||st.navigator.mozConnection||st.navigator.webkitConnection,_={counters:[],metadata:[],attributes:[]},y=(x,b,E)=>{null!=E&&x.push({name:b,value:E.toString()})};for(const x in h)y(_.counters,x,h[x]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(y(_.counters,"interactionRangeMin",l.interactionRange[0]),y(_.counters,"interactionRangeMax",l.interactionRange[1])),d)for(const x of Object.keys(sp)){const b=sp[x],E=d.find(C=>C.name===b);E&&y(_.counters,b,E.startTime)}return y(_.counters,"visibilityHidden",l.visibilityHidden),y(_.attributes,"style",function(x){if(x)for(const b of x){const E=b.name.split("?")[0];if(pr(E)){const C=E.split("/").slice(-2);if(2===C.length)return`mapbox://styles/${C[0]}/${C[1]}`}}}(u)),y(_.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),y(_.attributes,"fogEnabled",l.fogEnabled?"true":"false"),y(_.attributes,"projection",l.projection),y(_.attributes,"zoom",l.zoom),y(_.metadata,"devicePixelRatio",p),y(_.metadata,"connectionEffectiveType",m?m.effectiveType:void 0),y(_.metadata,"navigatorUserAgent",st.navigator.userAgent),y(_.metadata,"screenWidth",st.screen.width),y(_.metadata,"screenHeight",st.screen.height),y(_.metadata,"windowWidth",st.innerWidth),y(_.metadata,"windowHeight",st.innerHeight),y(_.metadata,"mapWidth",l.width/p),y(_.metadata,"mapHeight",l.height/p),y(_.metadata,"webglRenderer",l.renderer),y(_.metadata,"webglVendor",l.vendor),y(_.metadata,"sdkVersion",Pa),y(_.metadata,"sdkIdentifier","mapbox-gl-js"),_}(r);for(const l of a.metadata);for(const l of a.counters);for(const l of a.attributes);this.postEvent(t,a,()=>{},n)}},aE=sE.postPerformanceEvent.bind(sE),Ug=new class extends nu{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,t,r,a){if(!He.API_URL||!He.SESSION_PATH)return;const l=Mr(He.API_URL+He.SESSION_PATH);l.params.push(`sku=${t||""}`),l.params.push(`access_token=${a||He.ACCESS_TOKEN||""}`);const u={url:rs(l),headers:{"Content-Type":"text/plain"}};var h;this.pendingRequest=(h=d=>{this.pendingRequest=null,r(d),this.saveEventData(),this.processRequests(a)},Ot(Yt(u,{method:"GET"}),h))}getSessionAPI(n,t,r,a){this.skuToken=t,this.errorCb=a,He.SESSION_PATH&&He.API_URL&&(r||He.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Pn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):t&&(this.success[t]=!0)},n)}},lE=Ug.getSessionAPI.bind(Ug),ru=new Set;function cE(n,t){t?ru.add(n):ru.delete(n)}const sp={create:"create",load:"load",fullLoad:"fullLoad"},m0={mark(n){st.performance.mark(n)},measure(n,t,r){st.performance.measure(n,t,r)}};function UI(n){const t=n.name.split("?")[0];return Yi(t)&&t.includes("mapbox-gl.js")?"javascript":Yi(t)&&t.includes("mapbox-gl.css")?"css":He.API_FONTS_REGEX.test(t)?"fontRange":So(t)?"sprite":pr(t)?"style":He.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const HI=st.performance;function uE(n){const t=n?n.url.toString():void 0;return HI.getEntriesByName(t)}var dE=Hg;function Hg(n){return t=n,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,l,u=new Blob([""],{type:"text/javascript"}),d=URL.createObjectURL(u);try{l=new Worker(d),a=!0}catch{a=!1}return l&&l.terminate(),URL.revokeObjectURL(d),a}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var a=document.createElement("canvas");a.width=a.height=1;var l=a.getContext("2d");if(!l)return!1;var u=l.getImageData(0,0,1,1);return u&&u.width===a.width}()||(void 0===g0[r=t&&t.failIfMajorPerformanceCaveat]&&(g0[r]=function(a){var l,d,h,p,u=(d=a,h=document.createElement("canvas"),(p=Object.create(Hg.webGLContextAttributes)).failIfMajorPerformanceCaveat=d,h.getContext("webgl",p)||h.getContext("experimental-webgl",p));if(!u)return!1;try{l=u.createShader(u.VERTEX_SHADER)}catch{return!1}return!(!l||u.isContextLost())&&(u.shaderSource(l,"void main() {}"),u.compileShader(l),!0===u.getShaderParameter(l,u.COMPILE_STATUS))}(r)),!g0[r]||document.documentMode));var t,r}var g0={};let $g,Pr,uc,$r;Hg.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const kt={now:()=>void 0!==uc?uc:st.performance.now(),setNow(n){uc=n},restoreNow(){uc=void 0},frame(n){const t=st.requestAnimationFrame(n);return{cancel:()=>st.cancelAnimationFrame(t)}},getImageData(n,t=0){const{width:r,height:a}=n;$r||($r=st.document.createElement("canvas"));const l=$r.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(r>$r.width||a>$r.height)&&($r.width=r,$r.height=a),l.clearRect(-t,-t,r+2*t,a+2*t),l.drawImage(n,0,0,r,a),l.getImageData(-t,-t,r+2*t,a+2*t)},resolveURL:n=>($g||($g=st.document.createElement("a")),$g.href=n,$g.href),get devicePixelRatio(){return st.devicePixelRatio},get prefersReducedMotion(){return!!st.matchMedia&&(null==Pr&&(Pr=st.matchMedia("(prefers-reduced-motion: reduce)")),Pr.matches)}};function zn(n,t,r){const a=st.document.createElement(n);return void 0!==t&&(a.className=t),r&&r.appendChild(a),a}function Fa(n,t,r){const a=st.document.createElementNS("http://www.w3.org/2000/svg",n);for(const l of Object.keys(t))a.setAttributeNS(null,l,t[l]);return r&&r.appendChild(a),a}const Gr=st.document&&st.document.documentElement.style,Ku=Gr&&void 0!==Gr.userSelect?"userSelect":"WebkitUserSelect";let hE;function wi(){Gr&&Ku&&(hE=Gr[Ku],Gr[Ku]="none")}function ap(){Gr&&Ku&&(Gr[Ku]=hE)}function Or(n){n.preventDefault(),n.stopPropagation(),st.removeEventListener("click",Or,!0)}function lp(){st.addEventListener("click",Or,!0),st.setTimeout(()=>{st.removeEventListener("click",Or,!0)},0)}function cp(n,t){const r=n.getBoundingClientRect();return Gg(n,r,t)}function Ii(n,t){const r=n.getBoundingClientRect(),a=[];for(let l=0;l<t.length;l++)a.push(Gg(n,r,t[l]));return a}function Qe(n){return void 0!==st.InstallTrigger&&2===n.button&&n.ctrlKey&&st.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button}function Gg(n,t,r){const a=n.offsetWidth===t.width?1:n.offsetWidth/t.width;return new nt((r.clientX-t.left)*a,(r.clientY-t.top)*a)}function qg(n,t,r){r[n]&&-1!==r[n].indexOf(t)||(r[n]=r[n]||[],r[n].push(t))}function fE(n,t,r){if(r&&r[n]){const a=r[n].indexOf(t);-1!==a&&r[n].splice(a,1)}}class St{constructor(t,r={}){Yt(this,r),this.type=t}}class at extends St{constructor(t,r={}){super("error",Yt({error:t},r))}}class $i{on(t,r){return this._listeners=this._listeners||{},qg(t,r,this._listeners),this}off(t,r){return fE(t,r,this._listeners),fE(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},qg(t,r,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,r){"string"==typeof t&&(t=new St(t,r||{}));const a=t.type;if(this.listens(a)){t.target=this;const l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const h of l)h.call(this,t);const u=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const h of u)fE(a,h,this._oneTimeListeners),h.call(this,t);const d=this._eventedParent;d&&(Yt(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),d.fire(t))}else t instanceof at&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var J=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class It{constructor(t,r,a,l){this.message=(t?`${t}: `:"")+a,l&&(this.identifier=l),null!=r&&r.__line__&&(this.line=r.__line__)}}class Ju extends It{}function ou(n,...t){for(const r of t)for(const a in r)n[a]=r[a];return n}function gr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function La(n){if(Array.isArray(n))return n.map(La);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=La(n[r]);return t}return gr(n)}class Vs extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}var dc=Vs;class _0{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[a,l]of r)this.bindings[a]=l}concat(t){return new _0(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var yF=_0;const ua={kind:"null"},Wt={kind:"number"},hn={kind:"string"},Sn={kind:"boolean"},Na={kind:"color"},ih={kind:"object"},_n={kind:"value"},Wg={kind:"collator"},Zg={kind:"formatted"},Vo={kind:"resolvedImage"};function Se(n,t){return{kind:"array",itemType:n,N:t}}function _r(n){if("array"===n.kind){const t=_r(n.itemType);return"number"==typeof n.N?`array<${t}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${t}>`}return n.kind}const vF=[ua,Wt,hn,Sn,Na,Zg,ih,Se(_n),Vo];function Xg(n,t){if("error"===t.kind)return null;if("array"===n.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Xg(n.itemType,t.itemType))&&("number"!=typeof n.N||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if("value"===n.kind)for(const r of vF)if(!Xg(r,t))return null}return`Expected ${_r(n)} but found ${_r(t)} instead.`}function ee(n,t){return t.some(r=>r.kind===n.kind)}function Yg(n,t){return t.some(r=>"null"===r?null===n:"array"===r?Array.isArray(n):"object"===r?n&&!Array.isArray(n)&&"object"==typeof n:r===typeof n)}var gi,up={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Kg(n){return(n=Math.round(n))<0?0:n>255?255:n}function Jg(n){return Kg("%"===n[n.length-1]?parseFloat(n)/100*255:parseInt(n))}function Qg(n){return(t="%"===n[n.length-1]?parseFloat(n)/100:parseFloat(n))<0?0:t>1?1:t;var t}function rh(n,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?n+(t-n)*r*6:2*r<1?t:3*r<2?n+(t-n)*(2/3-r)*6:n}try{gi={}.parseCSSColor=function(n){var t,r=n.replace(/ /g,"").toLowerCase();if(r in up)return up[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var a=r.indexOf("("),l=r.indexOf(")");if(-1!==a&&l+1===r.length){var u=r.substr(0,a),d=r.substr(a+1,l-(a+1)).split(","),h=1;switch(u){case"rgba":if(4!==d.length)return null;h=Qg(d.pop());case"rgb":return 3!==d.length?null:[Jg(d[0]),Jg(d[1]),Jg(d[2]),h];case"hsla":if(4!==d.length)return null;h=Qg(d.pop());case"hsl":if(3!==d.length)return null;var p=(parseFloat(d[0])%360+360)%360/360,m=Qg(d[1]),_=Qg(d[2]),y=_<=.5?_*(m+1):_+m-_*m,x=2*_-y;return[Kg(255*rh(x,y,p+1/3)),Kg(255*rh(x,y,p)),Kg(255*rh(x,y,p-1/3)),h];default:return null}}return null}}catch{}class Do{constructor(t,r,a,l=1){this.r=t,this.g=r,this.b=a,this.a=l}static parse(t){if(!t)return;if(t instanceof Do)return t;if("string"!=typeof t)return;const r=gi(t);return r?new Do(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[t,r,a,l]=this.toArray();return`rgba(${Math.round(t)},${Math.round(r)},${Math.round(a)},${l})`}toArray(){const{r:t,g:r,b:a,a:l}=this;return 0===l?[0,0,0,0]:[255*t/l,255*r/l,255*a/l,l]}toArray01(){const{r:t,g:r,b:a,a:l}=this;return 0===l?[0,0,0,0]:[t/l,r/l,a/l,l]}toArray01Scaled(t){const{r,g:a,b:l,a:u}=this;return 0===u?[0,0,0]:[r/u*t,a/u*t,l/u*t]}toArray01PremultipliedAlpha(){const{r:t,g:r,b:a,a:l}=this;return[t,r,a,l]}toArray01Linear(){const{r:t,g:r,b:a,a:l}=this;return 0===l?[0,0,0,0]:[Math.pow(t/l,2.2),Math.pow(r/l,2.2),Math.pow(a/l,2.2),l]}}Do.black=new Do(0,0,0,1),Do.white=new Do(1,1,1,1),Do.transparent=new Do(0,0,0,0),Do.red=new Do(1,0,0,1),Do.blue=new Do(0,0,1,1);var Ne=Do;class t_{constructor(t,r,a){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class y0{constructor(t,r,a,l,u){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=a,this.fontStack=l,this.textColor=u}}class Ke{constructor(t){this.sections=t}static fromString(t){return new Ke([new y0(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length)}static factory(t){return t instanceof Ke?t:Ke.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){t.push(["image",r.image.namePrimary]);continue}t.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(a)}return t}}class ys{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,r){return t?new ys({namePrimary:t,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function v0(n,t,r,a){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[n,t,r,a]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qr(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof Ne||n instanceof t_||n instanceof Ke||n instanceof ys)return!0;if(Array.isArray(n)){for(const t of n)if(!qr(t))return!1;return!0}if("object"==typeof n){for(const t in n)if(!qr(n[t]))return!1;return!0}return!1}function Sr(n){if(null===n)return ua;if("string"==typeof n)return hn;if("boolean"==typeof n)return Sn;if("number"==typeof n)return Wt;if(n instanceof Ne)return Na;if(n instanceof t_)return Wg;if(n instanceof Ke)return Zg;if(n instanceof ys)return Vo;if(Array.isArray(n)){const t=n.length;let r;for(const a of n){const l=Sr(a);if(r){if(r===l)continue;r=_n;break}r=l}return Se(r||_n,t)}return ih}function e_(n){const t=typeof n;return null===n?"":"string"===t||"number"===t||"boolean"===t?String(n):n instanceof Ne||n instanceof Ke||n instanceof ys?n.toString():JSON.stringify(n)}class Vi{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(2!==t.length)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!qr(t[1]))return r.error("invalid value");const a=t[1];let l=Sr(a);const u=r.expectedType;return"array"!==l.kind||0!==l.N||!u||"array"!==u.kind||"number"==typeof u.N&&0!==u.N||(l=u),new Vi(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ne?["rgba"].concat(this.value.toArray()):this.value instanceof Ke?this.value.serialize():this.value}}var n_=Vi,Wr=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const $t={string:hn,number:Wt,boolean:Sn,object:ih};class dp{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a,l=1;const u=t[0];if("array"===u){let h,p;if(t.length>2){const m=t[1];if("string"!=typeof m||!(m in $t)||"object"===m)return r.error('The item type argument of "array" must be one of string, number, boolean',1);h=$t[m],l++}else h=_n;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);p=t[2],l++}a=Se(h,p)}else a=$t[u];const d=[];for(;l<t.length;l++){const h=r.parse(t[l],l,_n);if(!h)return null;d.push(h)}return new dp(a,d)}evaluate(t){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(t);if(!Xg(this.type,Sr(a)))return a;if(r===this.args.length-1)throw new Wr(`Expected value to be of type ${_r(this.type)}, but found ${_r(Sr(a))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if("array"===t.kind){const a=t.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){r.push(a.kind);const l=t.N;("number"==typeof l||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(a=>a.serialize()))}}var za=dp;class oh{constructor(t){this.type=Zg,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&"object"==typeof a)return r.error("First argument must be an image or text section.");const l=[];let u=!1;for(let d=1;d<=t.length-1;++d){const h=t[d];if(u&&"object"==typeof h&&!Array.isArray(h)){u=!1;let p=null;if(h["font-scale"]&&(p=r.parse(h["font-scale"],1,Wt),!p))return null;let m=null;if(h["text-font"]&&(m=r.parse(h["text-font"],1,Se(hn)),!m))return null;let _=null;if(h["text-color"]&&(_=r.parse(h["text-color"],1,Na),!_))return null;const y=l[l.length-1];y.scale=p,y.font=m,y.textColor=_}else{const p=r.parse(t[d],1,_n);if(!p)return null;const m=p.type.kind;if("string"!==m&&"value"!==m&&"null"!==m&&"resolvedImage"!==m)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:p,scale:null,font:null,textColor:null})}}return new oh(l)}evaluate(t){return new Ke(this.sections.map(r=>{const a=r.content.evaluate(t);return Sr(a)===Vo?new y0("",a,null,null,null):new y0(e_(a),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),t.push(a)}return t}}class Qu{constructor(t,r){this.type=Vo,this.inputPrimary=t,this.inputSecondary=r}static parse(t,r){if(t.length<2)return r.error("Expected two or more arguments.");const a=r.parse(t[1],1,hn);if(!a)return r.error("No image name provided.");if(2===t.length)return new Qu(a);const l=r.parse(t[2],1,hn);return l?new Qu(a,l):r.error("Secondary image variant is not a string.")}evaluate(t){const r=ys.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&t.availableImages&&(r.available=t.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function On(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}const x0={"to-boolean":Sn,"to-color":Na,"to-number":Wt,"to-string":hn};class pE{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const a=t[0],l=[];let u=ua;if("to-array"===a){if(!Array.isArray(t[1]))return null;const d=t[1].length;if(r.expectedType){if("array"!==r.expectedType.kind)return r.error(`Expected ${r.expectedType.kind} but found array.`);u=Se(r.expectedType.itemType,d)}else{if(!(d>0&&qr(t[1][0])))return null;u=Se(Sr(t[1][0]),d)}for(let h=0;h<d;h++){const p=t[1][h];let m;if("array"===On(p))m=r.parse(p,void 0,u.itemType);else{const _=On(p);if(_!==u.itemType.kind)return r.error(`Expected ${u.itemType.kind} but found ${_}.`);m=r.registry.literal.parse(["literal",void 0===p?null:p],r)}if(!m)return null;l.push(m)}}else{if(("to-boolean"===a||"to-string"===a)&&2!==t.length)return r.error("Expected one argument.");u=x0[a];for(let d=1;d<t.length;d++){const h=r.parse(t[d],d,_n);if(!h)return null;l.push(h)}}return new pE(u,l)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let r,a;for(const l of this.args){if(r=l.evaluate(t),a=null,r instanceof Ne)return r;if("string"==typeof r){const u=t.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:v0(r[0],r[1],r[2],r[3]),!a))return new Ne(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Wr(a||`Could not parse color from value '${"string"==typeof r?r:String(JSON.stringify(r))}'`)}if("number"===this.type.kind){let r=null;for(const a of this.args){if(r=a.evaluate(t),null===r)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Wr(`Could not convert ${JSON.stringify(r)} to number.`)}return"formatted"===this.type.kind?Ke.fromString(e_(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ys.fromString(e_(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map(r=>r.evaluate(t)):e_(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new oh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Qu(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}var sh=pE;const xF=["Unknown","Point","LineString","Polygon"];var $I=class{constructor(n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=n}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?xF[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-n[0])+this.featureDistanceData.bearing[1]*(a*t-n[1])}return 0}parseColor(n){let t=this._parseColorCache[n];return t||(t=this._parseColorCache[n]=Ne.parse(n)),t}getConfig(n){return this.options?this.options.get(n):null}};class hp{constructor(t,r,a,l){this.name=t,this.type=r,this._evaluate=a,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const a=t[0],l=hp.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,h=d.filter(([m])=>!Array.isArray(m)||m.length===t.length-1);let p=null;for(const[m,_]of h){p=new Ho(r.registry,r.path,null,r.scope,void 0,r.options);const y=[];let x=!1;for(let b=1;b<t.length;b++){const E=t[b],C=Array.isArray(m)?m[b-1]:m.type,S=p.parse(E,1+y.length,C);if(!S){x=!0;break}y.push(S)}if(!x)if(Array.isArray(m)&&m.length!==y.length)p.error(`Expected ${m.length} arguments, but found ${y.length} instead.`);else{for(let b=0;b<y.length;b++){const E=Array.isArray(m)?m[b]:m.type,C=y[b];p.concat(b+1).checkSubtype(E,C.type)}if(0===p.errors.length)return new hp(a,u,_,y)}}if(1===h.length)r.errors.push(...p.errors);else{const m=(h.length?h:d).map(([y])=>{return x=y,Array.isArray(x)?`(${x.map(_r).join(", ")})`:`(${_r(x.type)}...)`;var x}).join(" | "),_=[];for(let y=1;y<t.length;y++){const x=r.parse(t[y],1+_.length);if(!x)return null;_.push(_r(x.type))}r.error(`Expected arguments of type ${m}, but found (${_.join(", ")}) instead.`)}return null}static register(t,r){hp.definitions=r;for(const a in r)t[a]=hp}}var vs=hp;class ah{constructor(t,r,a){this.type=Wg,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(2!==t.length)return r.error("Expected one argument.");const a=t[1];if("object"!=typeof a||Array.isArray(a))return r.error("Collator options argument must be an object.");const l=r.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,Sn);if(!l)return null;const u=r.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,Sn);if(!u)return null;let d=null;return a.locale&&(d=r.parse(a.locale,1,hn),!d)?null:new ah(l,u,d)}evaluate(t){return new t_(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var fp={exports:{}};fp.exports=function(){function n(a,l,u,d,h){for(;d>u;){if(d-u>600){var p=d-u+1,m=l-u+1,_=Math.log(p),y=.5*Math.exp(2*_/3),x=.5*Math.sqrt(_*y*(p-y)/p)*(m-p/2<0?-1:1);n(a,l,Math.max(u,Math.floor(l-m*y/p+x)),Math.min(d,Math.floor(l+(p-m)*y/p+x)),h)}var b=a[l],E=u,C=d;for(t(a,u,l),h(a[d],b)>0&&t(a,u,d);E<C;){for(t(a,E,C),E++,C--;h(a[E],b)<0;)E++;for(;h(a[C],b)>0;)C--}0===h(a[u],b)?t(a,u,C):t(a,++C,d),C<=l&&(u=C+1),l<=C&&(d=C-1)}}function t(a,l,u){var d=a[l];a[l]=a[u],a[u]=d}function r(a,l){return a<l?-1:a>l?1:0}return function(a,l,u,d,h){n(a,l,u||0,d||a.length-1,h||r)}}();var GI=ms(fp.exports);function qI(n){let t=0;for(let r,a,l=0,u=n.length,d=u-1;l<u;d=l++)r=n[l],a=n[d],t+=(a.x-r.x)*(r.y+a.y);return t}function pp(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function lh(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function ch(n,t,r){const a=n[0]-t[0],l=n[1]-t[1],u=n[0]-r[0],d=n[1]-r[1];return a*d-u*l==0&&a*u<=0&&l*d<=0}function uh(n,t,r=!1){let a=!1;for(let h=0,p=t.length;h<p;h++){const m=t[h];for(let _=0,y=m.length,x=y-1;_<y;x=_++){const b=m[x],E=m[_];if(ch(n,b,E))return r;(u=b)[1]>(l=n)[1]!=(d=E)[1]>l[1]&&l[0]<(d[0]-u[0])*(l[1]-u[1])/(d[1]-u[1])+u[0]&&(a=!a)}}var l,u,d;return a}function hc(n,t,r,a){const l=a[0]-r[0],u=a[1]-r[1],d=(n[0]-r[0])*u-l*(n[1]-r[1]),h=(t[0]-r[0])*u-l*(t[1]-r[1]);return d>0&&h<0||d<0&&h>0}function i_(n,t,r,a){return(l=[a[0]-r[0],a[1]-r[1]])[0]*(u=[t[0]-n[0],t[1]-n[1]])[1]-l[1]*u[0]!=0&&!(!hc(n,t,r,a)||!hc(r,a,n,t));var l,u}const bt=8192;function mE(n,t){const r=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*bt),Math.round(a*l*bt)]}function ne(n,t){for(let r=0;r<t.length;r++)if(uh(n,t[r]))return!0;return!1}function r_(n,t,r){for(const a of r)for(let l=0,u=a.length,d=u-1;l<u;d=l++)if(i_(n,t,a[d],a[l]))return!0;return!1}function o_(n,t){for(let r=0;r<n.length;++r)if(!uh(n[r],t))return!1;for(let r=0;r<n.length-1;++r)if(r_(n[r],n[r+1],t))return!1;return!0}function mp(n,t){for(let r=0;r<t.length;r++)if(o_(n,t[r]))return!0;return!1}function b0(n,t,r){const a=[];for(let l=0;l<n.length;l++){const u=[];for(let d=0;d<n[l].length;d++){const h=mE(n[l][d],r);pp(t,h),u.push(h)}a.push(u)}return a}function gE(n,t,r){const a=[];for(let l=0;l<n.length;l++){const u=b0(n[l],t,r);a.push(u)}return a}function _E(n,t,r,a){if(n[0]<r[0]||n[0]>r[2]){const l=.5*a;let u=n[0]-r[0]>l?-a:r[0]-n[0]>l?a:0;0===u&&(u=n[0]-r[2]>l?-a:r[2]-n[0]>l?a:0),n[0]+=u}pp(t,n)}function El(n,t,r,a){const l=Math.pow(2,a.z)*bt,u=[a.x*bt,a.y*bt],d=[];if(!n)return d;for(const h of n)for(const p of h){const m=[p.x+u[0],p.y+u[1]];_E(m,t,r,l),d.push(m)}return d}function gp(n,t,r,a){const l=Math.pow(2,a.z)*bt,u=[a.x*bt,a.y*bt],d=[];if(!n)return d;for(const p of n){const m=[];for(const _ of p){const y=[_.x+u[0],_.y+u[1]];pp(t,y),m.push(y)}d.push(m)}if(t[2]-t[0]<=l/2){(h=t)[0]=h[1]=1/0,h[2]=h[3]=-1/0;for(const p of d)for(const m of p)_E(m,t,r,l)}var h;return d}class jo{constructor(t,r){this.type=Sn,this.geojson=t,this.geometries=r}static parse(t,r){if(2!==t.length)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(qr(t[1])){const a=t[1];if("FeatureCollection"===a.type)for(let l=0;l<a.features.length;++l){const u=a.features[l].geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new jo(a,a.features[l].geometry)}else if("Feature"===a.type){const l=a.geometry.type;if("Polygon"===l||"MultiPolygon"===l)return new jo(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new jo(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(r,a){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if("Polygon"===a.type){const h=b0(a.coordinates,u,d),p=El(r.geometry(),l,u,d);if(!lh(l,u))return!1;for(const m of p)if(!uh(m,h))return!1}if("MultiPolygon"===a.type){const h=gE(a.coordinates,u,d),p=El(r.geometry(),l,u,d);if(!lh(l,u))return!1;for(const m of p)if(!ne(m,h))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(r,a){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if("Polygon"===a.type){const h=b0(a.coordinates,u,d),p=gp(r.geometry(),l,u,d);if(!lh(l,u))return!1;for(const m of p)if(!o_(m,h))return!1}if("MultiPolygon"===a.type){const h=gE(a.coordinates,u,d),p=gp(r.geometry(),l,u,d);if(!lh(l,u))return!1;for(const m of p)if(!mp(m,h))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var da=jo,ri={exports:{}};ri.exports=function(){var n={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,r=t*(2-t),a=Math.PI/180,l=function(m,_){if(void 0===m)throw new Error("No latitude given.");if(_&&!n[_])throw new Error("Unknown unit "+_+". Use one of: "+Object.keys(n).join(", "));var y=6378.137*a*(_?n[_]:1),x=Math.cos(m*a),b=1/(1-r*(1-x*x)),E=Math.sqrt(b);this.kx=y*E*x,this.ky=y*E*b*(1-r)},u={units:{configurable:!0}};function d(m,_){return m[0]===_[0]&&m[1]===_[1]}function h(m,_,y){var x=p(_[0]-m[0]);return[m[0]+x*y,m[1]+(_[1]-m[1])*y]}function p(m){for(;m<-180;)m+=360;for(;m>180;)m-=360;return m}return l.fromTile=function(m,_,y){var x=Math.PI*(1-2*(m+.5)/Math.pow(2,_)),b=Math.atan(.5*(Math.exp(x)-Math.exp(-x)))/a;return new l(b,y)},u.units.get=function(){return n},l.prototype.distance=function(m,_){var y=p(m[0]-_[0])*this.kx,x=(m[1]-_[1])*this.ky;return Math.sqrt(y*y+x*x)},l.prototype.bearing=function(m,_){var y=p(_[0]-m[0])*this.kx;return Math.atan2(y,(_[1]-m[1])*this.ky)/a},l.prototype.destination=function(m,_,y){var x=y*a;return this.offset(m,Math.sin(x)*_,Math.cos(x)*_)},l.prototype.offset=function(m,_,y){return[m[0]+_/this.kx,m[1]+y/this.ky]},l.prototype.lineDistance=function(m){for(var _=0,y=0;y<m.length-1;y++)_+=this.distance(m[y],m[y+1]);return _},l.prototype.area=function(m){for(var _=0,y=0;y<m.length;y++)for(var x=m[y],b=0,E=x.length,C=E-1;b<E;C=b++)_+=p(x[b][0]-x[C][0])*(x[b][1]+x[C][1])*(y?-1:1);return Math.abs(_)/2*this.kx*this.ky},l.prototype.along=function(m,_){var y=0;if(_<=0)return m[0];for(var x=0;x<m.length-1;x++){var b=m[x],E=m[x+1],C=this.distance(b,E);if((y+=C)>_)return h(b,E,(_-(y-C))/C)}return m[m.length-1]},l.prototype.pointToSegmentDistance=function(m,_,y){var x=_[0],b=_[1],E=p(y[0]-x)*this.kx,C=(y[1]-b)*this.ky,S=0;return 0===E&&0===C||((S=(p(m[0]-x)*this.kx*E+(m[1]-b)*this.ky*C)/(E*E+C*C))>1?(x=y[0],b=y[1]):S>0&&(x+=E/this.kx*S,b+=C/this.ky*S)),E=p(m[0]-x)*this.kx,C=(m[1]-b)*this.ky,Math.sqrt(E*E+C*C)},l.prototype.pointOnLine=function(m,_){for(var y,x,b,E,C=1/0,S=0;S<m.length-1;S++){var M=m[S][0],D=m[S][1],R=p(m[S+1][0]-M)*this.kx,P=(m[S+1][1]-D)*this.ky,I=0;0===R&&0===P||((I=(p(_[0]-M)*this.kx*R+(_[1]-D)*this.ky*P)/(R*R+P*P))>1?(M=m[S+1][0],D=m[S+1][1]):I>0&&(M+=R/this.kx*I,D+=P/this.ky*I));var O=(R=p(_[0]-M)*this.kx)*R+(P=(_[1]-D)*this.ky)*P;O<C&&(C=O,y=M,x=D,b=S,E=I)}return{point:[y,x],index:b,t:Math.max(0,Math.min(1,E))}},l.prototype.lineSlice=function(m,_,y){var x=this.pointOnLine(y,m),b=this.pointOnLine(y,_);if(x.index>b.index||x.index===b.index&&x.t>b.t){var E=x;x=b,b=E}var C=[x.point],S=x.index+1,M=b.index;!d(y[S],C[0])&&S<=M&&C.push(y[S]);for(var D=S+1;D<=M;D++)C.push(y[D]);return d(y[M],b.point)||C.push(b.point),C},l.prototype.lineSliceAlong=function(m,_,y){for(var x=0,b=[],E=0;E<y.length-1;E++){var C=y[E],S=y[E+1],M=this.distance(C,S);if((x+=M)>m&&0===b.length&&b.push(h(C,S,(m-(x-M))/M)),x>=_)return b.push(h(C,S,(_-(x-M))/M)),b;x>m&&b.push(S)}return b},l.prototype.bufferPoint=function(m,_){var y=_/this.ky,x=_/this.kx;return[m[0]-x,m[1]-y,m[0]+x,m[1]+y]},l.prototype.bufferBBox=function(m,_){var y=_/this.ky,x=_/this.kx;return[m[0]-x,m[1]-y,m[2]+x,m[3]+y]},l.prototype.insideBBox=function(m,_){return p(m[0]-_[0])>=0&&p(m[0]-_[2])<=0&&m[1]>=_[1]&&m[1]<=_[3]},Object.defineProperties(l,u),l}();var dh=ms(ri.exports),s_={exports:{}};s_.exports=function(){var n=function(r,a){if(void 0===r&&(r=[]),void 0===a&&(a=t),this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function t(r,a){return r<a?-1:r>a?1:0}return n.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(0!==this.length){var r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(r){for(var a=this.data,l=this.compare,u=a[r];r>0;){var d=r-1>>1,h=a[d];if(l(u,h)>=0)break;a[r]=h,r=d}a[r]=u},n.prototype._down=function(r){for(var a=this.data,l=this.compare,u=this.length>>1,d=a[r];r<u;){var h=1+(r<<1),p=a[h],m=h+1;if(m<this.length&&l(a[m],p)<0&&(h=m,p=a[m]),l(p,d)>=0)break;a[r]=p,r=h}a[r]=d},n}();var _p=ms(s_.exports),dt=8192;function Cl(n,t){return t.dist-n.dist}const td=100,a_=50;function w0(n){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==n[r])return!1;return!0}function hh(n){return n[1]-n[0]+1}function Ml(n,t){const r=n[1]>=n[0]&&n[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function l_(n,t){if(n[0]>n[1])return[null,null];const r=hh(n);if(t){if(2===r)return[n,null];const a=Math.floor(r/2);return[[n[0],n[0]+a],[n[0]+a,n[1]]]}{if(1===r)return[n,null];const a=Math.floor(r/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}}function Ba(n,t){const r=[1/0,1/0,-1/0,-1/0];if(!Ml(t,n.length))return r;for(let a=t[0];a<=t[1];++a)pp(r,n[a]);return r}function yp(n){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<n.length;++r)for(let a=0;a<n[r].length;++a)pp(t,n[r][a]);return t}function ed(n,t,r){if(w0(n)||w0(t))return NaN;let a=0,l=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(l=n[1]-t[3]),n[3]<t[1]&&(l=t[1]-n[3]),r.distance([0,0],[a,l])}function E0(n,t){const r=Math.pow(2,t.z);return[(l=(n.x/dt+t.x)/r,360*l-180),(a=(n.y/dt+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,l}function yE(n,t){const r=[];for(let a=0;a<n.length;++a)r.push(E0(n[a],t));return r}function vE(n,t,r){const a=r.pointOnLine(t,n).point;return r.distance(n,a)}function xE(n,t,r,a,l){const u=r.slice(a[0],a[1]+1);let d=1/0;for(let h=t[0];h<=t[1];++h)if(0===(d=Math.min(d,vE(n[h],u,l))))return 0;return d}function js(n,t,r,a,l){const u=Math.min(l.pointToSegmentDistance(n,r,a),l.pointToSegmentDistance(t,r,a)),d=Math.min(l.pointToSegmentDistance(r,n,t),l.pointToSegmentDistance(a,n,t));return Math.min(u,d)}function WI(n,t,r,a,l){if(!Ml(t,n.length)||!Ml(a,r.length))return NaN;let u=1/0;for(let d=t[0];d<t[1];++d)for(let h=a[0];h<a[1];++h){if(i_(n[d],n[d+1],r[h],r[h+1]))return 0;u=Math.min(u,js(n[d],n[d+1],r[h],r[h+1],l))}return u}function bE(n,t,r,a,l){if(!Ml(t,n.length)||!Ml(a,r.length))return NaN;let u=1/0;for(let d=t[0];d<=t[1];++d)for(let h=a[0];h<=a[1];++h)if(0===(u=Math.min(u,l.distance(n[d],r[h]))))return u;return u}function ZI(n,t,r){if(uh(n,t,!0))return 0;let a=1/0;for(const l of t){const u=l.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[u-1]&&0===(a=Math.min(a,r.pointToSegmentDistance(n,l[u-1],l[0])))||0===(a=Math.min(a,vE(n,l,r))))return a}return a}function XI(n,t,r,a){if(!Ml(t,n.length))return NaN;for(let u=t[0];u<=t[1];++u)if(uh(n[u],r,!0))return 0;let l=1/0;for(let u=t[0];u<t[1];++u)for(const d of r)for(let h=0,p=d.length,m=p-1;h<p;m=h++){if(i_(n[u],n[u+1],d[m],d[h]))return 0;l=Math.min(l,js(n[u],n[u+1],d[m],d[h],a))}return l}function wE(n,t){for(const r of n)for(let a=0;a<=r.length-1;++a)if(uh(r[a],t,!0))return!0;return!1}function YI(n,t,r,a=1/0){const l=yp(n),u=yp(t);if(a!==1/0&&ed(l,u,r)>=a)return a;if(lh(l,u)){if(wE(n,t))return 0}else if(wE(t,n))return 0;let d=a;for(const h of n)for(let p=0,m=h.length,_=m-1;p<m;_=p++)for(const y of t)for(let x=0,b=y.length,E=b-1;x<b;E=x++){if(i_(h[_],h[p],y[E],y[x]))return 0;d=Math.min(d,js(h[_],h[p],y[E],y[x],r))}return d}function vp(n,t,r,a,l,u,d){if(null===u||null===d)return;const h=ed(Ba(a,u),Ba(l,d),r);h<t&&n.push({dist:h,range1:u,range2:d})}function KI(n,t,r,a,l=1/0){let u=Math.min(a.distance(n[0],r[0][0]),l);if(0===u)return u;const d=new _p([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Cl),h=t?a_:td,p=yp(r);for(;d.length;){const m=d.pop();if(m.dist>=u)continue;const _=m.range1;if(hh(_)<=h){if(!Ml(_,n.length))return NaN;if(t){const y=XI(n,_,r,a);if(0===(u=Math.min(u,y)))return u}else for(let y=_[0];y<=_[1];++y){const x=ZI(n[y],r,a);if(0===(u=Math.min(u,x)))return u}}else{const y=l_(_,t);if(null!==y[0]){const x=ed(Ba(n,y[0]),p,a);x<u&&d.push({dist:x,range1:y[0],range2:[0,0]})}if(null!==y[1]){const x=ed(Ba(n,y[1]),p,a);x<u&&d.push({dist:x,range1:y[1],range2:[0,0]})}}}return u}function EE(n,t,r,a,l,u=1/0){let d=Math.min(u,l.distance(n[0],r[0]));if(0===d)return d;const h=new _p([{dist:0,range1:[0,n.length-1],range2:[0,r.length-1]}],Cl),p=t?a_:td,m=a?a_:td;for(;h.length;){const _=h.pop();if(_.dist>=d)continue;const y=_.range1,x=_.range2;if(hh(y)<=p&&hh(x)<=m){if(!Ml(y,n.length)||!Ml(x,r.length))return NaN;if(t&&a?d=Math.min(d,WI(n,y,r,x,l)):t||a?t&&!a?d=Math.min(d,xE(r,x,n,y,l)):!t&&a&&(d=Math.min(d,xE(n,y,r,x,l))):d=Math.min(d,bE(n,y,r,x,l)),0===d)return d}else{const b=l_(y,t),E=l_(x,a);vp(h,d,l,n,r,b[0],E[0]),vp(h,d,l,n,r,b[0],E[1]),vp(h,d,l,n,r,b[1],E[0]),vp(h,d,l,n,r,b[1],E[1])}}return d}function C0(n,t,r,a,l=1/0){let u=l;const d=Ba(n,[0,n.length-1]);for(const h of r)if(!(u!==1/0&&ed(d,Ba(h,[0,h.length-1]),a)>=u)&&(u=Math.min(u,EE(n,t,h,!0,a,u)),0===u))return u;return u}function os(n,t,r,a,l=1/0){let u=l;const d=Ba(n,[0,n.length-1]);for(const h of r){if(u!==1/0&&ed(d,yp(h),a)>=u)continue;const p=KI(n,t,h,a,u);if(isNaN(p))return p;if(0===(u=Math.min(u,p)))return u}return u}function M0(n){return"Point"===n||"MultiPoint"===n||"LineString"===n||"MultiLineString"===n||"Polygon"===n||"MultiPolygon"===n}class xp{constructor(t,r){this.type=Wt,this.geojson=t,this.geometries=r}static parse(t,r){if(2!==t.length)return r.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(qr(t[1])){const a=t[1];if("FeatureCollection"===a.type){for(let l=0;l<a.features.length;++l)if(M0(a.features[l].geometry.type))return new xp(a,a.features[l].geometry)}else if("Feature"===a.type){if(M0(a.geometry.type))return new xp(a,a.geometry)}else if(M0(a.type))return new xp(a,a)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const r=t.geometry(),a=t.canonicalID();if(null!=r&&null!=a){if("Point"===t.geometryType())return function(l,u,d){const h=[];for(const m of l)for(const _ of m)h.push(E0(_,u));const p=new dh(h[0][1],"meters");return"Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type?EE(h,!1,"Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,p):"MultiLineString"===d.type?C0(h,!1,d.coordinates,p):"Polygon"===d.type||"MultiPolygon"===d.type?os(h,!1,"Polygon"===d.type?[d.coordinates]:d.coordinates,p):null}(r,a,this.geometries);if("LineString"===t.geometryType())return function(l,u,d){const h=[];for(const m of l){const _=[];for(const y of m)_.push(E0(y,u));h.push(_)}const p=new dh(h[0][0][1],"meters");if("Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type)return C0("Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,h,p);if("MultiLineString"===d.type){let m=1/0;for(let _=0;_<d.coordinates.length;_++){const y=C0(d.coordinates[_],!0,h,p,m);if(isNaN(y))return y;if(0===(m=Math.min(m,y)))return m}return m}if("Polygon"===d.type||"MultiPolygon"===d.type){let m=1/0;for(let _=0;_<h.length;_++){const y=os(h[_],!0,"Polygon"===d.type?[d.coordinates]:d.coordinates,p,m);if(isNaN(y))return y;if(0===(m=Math.min(m,y)))return m}return m}return null}(r,a,this.geometries);if("Polygon"===t.geometryType())return function(l,u,d){const h=[];for(const m of function(_,y){const x=_.length;if(x<=1)return[_];const b=[];let E,C;for(let S=0;S<x;S++){const M=qI(_[S]);0!==M&&(_[S].area=Math.abs(M),void 0===C&&(C=M<0),C===M<0?(E&&b.push(E),E=[_[S]]):E.push(_[S]))}return E&&b.push(E),b}(l)){const _=[];for(let y=0;y<m.length;++y)_.push(yE(m[y],u));h.push(_)}const p=new dh(h[0][0][0][1],"meters");if("Point"===d.type||"MultiPoint"===d.type||"LineString"===d.type)return os("Point"===d.type?[d.coordinates]:d.coordinates,"LineString"===d.type,h,p);if("MultiLineString"===d.type){let m=1/0;for(let _=0;_<d.coordinates.length;_++){const y=os(d.coordinates[_],!0,h,p,m);if(isNaN(y))return y;if(0===(m=Math.min(m,y)))return m}return m}return"Polygon"===d.type||"MultiPolygon"===d.type?function(m,_,y){let x=1/0;for(const b of m)for(const E of _){const C=YI(b,E,y,x);if(isNaN(C))return C;if(0===(x=Math.min(x,C)))return x}return x}("Polygon"===d.type?[d.coordinates]:d.coordinates,h,p):null}(r,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var S0=xp;function ci(n){if(n instanceof vs&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof da||n instanceof S0)return!1;let t=!0;return n.eachChild(r=>{t&&!ci(r)&&(t=!1)}),t}function c_(n){if(n instanceof vs&&"feature-state"===n.name)return!1;let t=!0;return n.eachChild(r=>{t&&!c_(r)&&(t=!1)}),t}function u_(n){if(n instanceof vs&&"config"===n.name)return!1;let t=!0;return n.eachChild(r=>{t&&!u_(r)&&(t=!1)}),t}function Ee(n,t){if(n instanceof vs&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(a=>{r&&!Ee(a,t)&&(r=!1)}),r}class Uo{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(2!==t.length||"string"!=typeof t[1])return r.error("'var' expression requires exactly one string literal argument.");const a=t[1];return r.scope.has(a)?new Uo(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Kn=Uo;class Zr{constructor(t,r=[],a,l=new yF,u=[],d){this.registry=t,this.path=r,this.key=r.map(h=>`[${h}]`).join(""),this.scope=l,this.errors=u,this.expectedType=a,this.options=d}parse(t,r,a,l,u={}){return r||a?this.concat(r,a,l)._parse(t,u):this._parse(t,u)}_parse(t,r){function a(l,u,d){return"assert"===d?new za(u,[l]):"coerce"===d?new sh(u,[l]):l}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l="string"==typeof t[0]?this.registry[t[0]]:void 0;if(l){let u=l.parse(t,this);if(!u)return null;if(this.expectedType){const d=this.expectedType,h=u.type;if("string"!==d.kind&&"number"!==d.kind&&"boolean"!==d.kind&&"object"!==d.kind&&"array"!==d.kind||"value"!==h.kind)if("color"!==d.kind&&"formatted"!==d.kind&&"resolvedImage"!==d.kind||"value"!==h.kind&&"string"!==h.kind){if(this.checkSubtype(d,h))return null}else u=a(u,d,r.typeAnnotation||"coerce");else u=a(u,d,r.typeAnnotation||"assert")}if(!(u instanceof n_)&&"resolvedImage"!==u.type.kind&&su(u)){const d=new $I(this.options);try{u=new n_(u.type,u.evaluate(d))}catch(h){return this.error(h.message),null}}return u}return sh.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,a){const l="number"==typeof t?this.path.concat(t):this.path,u=a?this.scope.concat(a):this.scope;return new Zr(this.registry,l,r||null,u,this.errors,this.options)}error(t,...r){const a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new dc(a,t))}checkSubtype(t,r){const a=Xg(t,r);return a&&this.error(a),a}}var Ho=Zr;function su(n){if(n instanceof Kn)return su(n.boundExpression);if(n instanceof vs&&"error"===n.name||n instanceof vs&&"config"===n.name||n instanceof ah||n instanceof da||n instanceof S0)return!1;const t=n instanceof sh||n instanceof za;let r=!0;return n.eachChild(a=>{r=t?r&&su(a):r&&a instanceof n_}),!!r&&ci(n)&&Ee(n,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function $o(n,t){const r=n.length-1;let a,l,u=0,d=r,h=0;for(;u<=d;)if(h=Math.floor((u+d)/2),a=n[h],l=n[h+1],a<=t){if(h===r||t<l)return h;u=h+1}else{if(!(a>t))throw new Wr("Input is not a number.");d=h-1}return 0}class d_{constructor(t,r,a){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,u]of a)this.labels.push(l),this.outputs.push(u)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(t[1],1,Wt);if(!a)return null;const l=[];let u=null;r.expectedType&&"value"!==r.expectedType.kind&&(u=r.expectedType);for(let d=1;d<t.length;d+=2){const h=1===d?-1/0:t[d],p=t[d+1],m=d,_=d+1;if("number"!=typeof h)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',m);if(l.length&&l[l.length-1][0]>=h)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',m);const y=r.parse(p,_,u);if(!y)return null;u=u||y.type,l.push([h,y])}return new d_(u,a,l)}evaluate(t){const r=this.labels,a=this.outputs;if(1===r.length)return a[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return a[0].evaluate(t);const u=r.length;return l>=r[u-1]?a[u-1].evaluate(t):a[$o(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}var h_=d_;function _e(n,t,r){return n*(1-r)+t*r}function CE(n,t,r){return n.map((a,l)=>_e(a,t[l],r))}var f_=Object.freeze({__proto__:null,array:CE,color:function(n,t,r){return new Ne(_e(n.r,t.r,r),_e(n.g,t.g,r),_e(n.b,t.b,r),_e(n.a,t.a,r))},number:_e});const fn=4/29,Ai=6/29,ha=3*Ai*Ai,bp=Ai*Ai*Ai,Go=Math.PI/180,fh=180/Math.PI;function vr(n){return n>bp?Math.pow(n,1/3):n/ha+fn}function Sl(n){return n>Ai?n*n*n:ha*(n-fn)}function au(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function nn(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ph(n){const t=nn(n.r),r=nn(n.g),a=nn(n.b),l=vr((.4124564*t+.3575761*r+.1804375*a)/.95047),u=vr((.2126729*t+.7151522*r+.072175*a)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-vr((.0193339*t+.119192*r+.9503041*a)/1.08883)),alpha:n.a}}function T0(n){let t=(n.l+16)/116,r=isNaN(n.a)?t:t+n.a/500,a=isNaN(n.b)?t:t-n.b/200;return t=1*Sl(t),r=.95047*Sl(r),a=1.08883*Sl(a),new Ne(au(3.2404542*r-1.5371385*t-.4985314*a),au(-.969266*r+1.8760108*t+.041556*a),au(.0556434*r-.2040259*t+1.0572252*a),n.alpha)}function mh(n,t,r){const a=t-n;return n+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const tr={forward:ph,reverse:T0,interpolate:function(n,t,r){return{l:_e(n.l,t.l,r),a:_e(n.a,t.a,r),b:_e(n.b,t.b,r),alpha:_e(n.alpha,t.alpha,r)}}},fc={forward:function(n){const{l:t,a:r,b:a}=ph(n),l=Math.atan2(a,r)*fh;return{h:l<0?l+360:l,c:Math.sqrt(r*r+a*a),l:t,alpha:n.a}},reverse:function(n){const t=n.h*Go,r=n.c;return T0({l:n.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:n.alpha})},interpolate:function(n,t,r){return{h:mh(n.h,t.h,r),c:_e(n.c,t.c,r),l:_e(n.l,t.l,r),alpha:_e(n.alpha,t.alpha,r)}}};var nd=Object.freeze({__proto__:null,hcl:fc,lab:tr});class Us{constructor(t,r,a,l,u){this.type=t,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(const[d,h]of u)this.labels.push(d),this.outputs.push(h)}static interpolationFactor(t,r,a,l){let u=0;if("exponential"===t.name)u=id(r,t.base,a,l);else if("linear"===t.name)u=id(r,1,a,l);else if("cubic-bezier"===t.name){const d=t.controlPoints;u=new Vg(d[0],d[1],d[2],d[3]).solve(id(r,1,a,l))}return u}static parse(t,r){let[a,l,u,...d]=t;if(!Array.isArray(l)||0===l.length)return r.error("Expected an interpolation type expression.",1);if("linear"===l[0])l={name:"linear"};else if("exponential"===l[0]){const m=l[1];if("number"!=typeof m)return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:m}}else{if("cubic-bezier"!==l[0])return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const m=l.slice(1);if(4!==m.length||m.some(_=>"number"!=typeof _||_<0||_>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:m}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,Wt),!u)return null;const h=[];let p=null;"interpolate-hcl"===a||"interpolate-lab"===a?p=Na:r.expectedType&&"value"!==r.expectedType.kind&&(p=r.expectedType);for(let m=0;m<d.length;m+=2){const _=d[m],y=d[m+1],x=m+3,b=m+4;if("number"!=typeof _)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(h.length&&h[h.length-1][0]>=_)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',x);const E=r.parse(y,b,p);if(!E)return null;p=p||E.type,h.push([_,E])}return"number"===p.kind||"color"===p.kind||"array"===p.kind&&"number"===p.itemType.kind&&"number"==typeof p.N?new Us(p,a,l,u,h):r.error(`Type ${_r(p)} is not interpolatable.`)}evaluate(t){const r=this.labels,a=this.outputs;if(1===r.length)return a[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return a[0].evaluate(t);const u=r.length;if(l>=r[u-1])return a[u-1].evaluate(t);const d=$o(r,l),h=Us.interpolationFactor(this.interpolation,l,r[d],r[d+1]),p=a[d].evaluate(t),m=a[d+1].evaluate(t);return"interpolate"===this.operator?f_[this.type.kind.toLowerCase()](p,m,h):"interpolate-hcl"===this.operator?fc.reverse(fc.interpolate(fc.forward(p),fc.forward(m),h)):tr.reverse(tr.interpolate(tr.forward(p),tr.forward(m),h))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,t,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function id(n,t,r,a){const l=a-r,u=n-r;return 0===l?0:1===t?u/l:(Math.pow(t,u)-1)/(Math.pow(t,l)-1)}var Va=Us;class Tl{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let a=null;const l=r.expectedType;l&&"value"!==l.kind&&(a=l);const u=[];for(const h of t.slice(1)){const p=r.parse(h,1+u.length,a,void 0,{typeAnnotation:"omit"});if(!p)return null;a=a||p.type,u.push(p)}const d=l&&u.some(h=>Xg(l,h.type));return new Tl(d?_n:a,u)}evaluate(t){let r,a=null,l=0;for(const u of this.args){if(l++,a=u.evaluate(t),a&&a instanceof ys&&!a.available&&(r||(r=a),a=null,l===this.args.length))return r;if(null!==a)break}return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var Dl=Tl;class rd{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let u=1;u<t.length-1;u+=2){const d=t[u];if("string"!=typeof d)return r.error(`Expected string, but found ${typeof d} instead.`,u);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const h=r.parse(t[u+1],u+1);if(!h)return null;a.push([d,h])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,a);return l?new rd(a,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,a]of this.bindings)t.push(r,a.serialize());return t.push(this.result.serialize()),t}}var gh=rd;class kn{constructor(t,r,a){this.type=t,this.index=r,this.input=a}static parse(t,r){if(3!==t.length)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,Wt),l=r.parse(t[2],2,Se(r.expectedType||_n));return a&&l?new kn(l.type.itemType,a,l):null}evaluate(t){const r=this.index.evaluate(t),a=this.input.evaluate(t);if(r<0)throw new Wr(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Wr(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Wr(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var bF=kn;class wp{constructor(t,r){this.type=Sn,this.needle=t,this.haystack=r}static parse(t,r){if(3!==t.length)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,_n),l=r.parse(t[2],2,_n);return a&&l?ee(a.type,[Sn,hn,Wt,ua,_n])?new wp(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${_r(a.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(null==a)return!1;if(!Yg(r,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${_r(Sr(r))} instead.`);if(!Yg(a,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${_r(Sr(a))} instead.`);return a.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ME=wp;class Hs{constructor(t,r,a){this.type=Wt,this.needle=t,this.haystack=r,this.fromIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,_n),l=r.parse(t[2],2,_n);if(!a||!l)return null;if(!ee(a.type,[Sn,hn,Wt,ua,_n]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${_r(a.type)} instead`);if(4===t.length){const u=r.parse(t[3],3,Wt);return u?new Hs(a,l,u):null}return new Hs(a,l)}evaluate(t){const r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Yg(r,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${_r(Sr(r))} instead.`);if(!Yg(a,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${_r(Sr(a))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(t);return a.indexOf(r,l)}return a.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var p_=Hs;class lu{constructor(t,r,a,l,u,d){this.inputType=t,this.type=r,this.input=a,this.cases=l,this.outputs=u,this.otherwise=d}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&"value"!==r.expectedType.kind&&(l=r.expectedType);const u={},d=[];for(let m=2;m<t.length-1;m+=2){let _=t[m];const y=t[m+1];Array.isArray(_)||(_=[_]);const x=r.concat(m);if(0===_.length)return x.error("Expected at least one branch label.");for(const E of _){if("number"!=typeof E&&"string"!=typeof E)return x.error("Branch labels must be numbers or strings.");if("number"==typeof E&&Math.abs(E)>Number.MAX_SAFE_INTEGER)return x.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof E&&Math.floor(E)!==E)return x.error("Numeric branch labels must be integer values.");if(a){if(x.checkSubtype(a,Sr(E)))return null}else a=Sr(E);if(void 0!==u[String(E)])return x.error("Branch labels must be unique.");u[String(E)]=d.length}const b=r.parse(y,m,l);if(!b)return null;l=l||b.type,d.push(b)}const h=r.parse(t[1],1,_n);if(!h)return null;const p=r.parse(t[t.length-1],t.length-1,l);return p?"value"!==h.type.kind&&r.concat(1).checkSubtype(a,h.type)?null:new lu(a,l,h,u,d,p):null}evaluate(t){const r=this.input.evaluate(t);return(Sr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],l={};for(const d of r){const h=l[this.cases[d]];void 0===h?(l[this.cases[d]]=a.length,a.push([this.cases[d],[d]])):a[h][1].push(d)}const u=d=>"number"===this.inputType.kind?Number(d):d;for(const[d,h]of a)t.push(1===h.length?u(h[0]):h.map(u)),t.push(this.outputs[d].serialize());return t.push(this.otherwise.serialize()),t}}var Ep=lu;class Xr{constructor(t,r,a){this.type=t,this.branches=r,this.otherwise=a}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&"value"!==r.expectedType.kind&&(a=r.expectedType);const l=[];for(let d=1;d<t.length-1;d+=2){const h=r.parse(t[d],d,Sn);if(!h)return null;const p=r.parse(t[d+1],d+1,a);if(!p)return null;l.push([h,p]),a=a||p.type}const u=r.parse(t[t.length-1],t.length-1,a);return u?new Xr(a,l,u):null}evaluate(t){for(const[r,a]of this.branches)if(r.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,a]of this.branches)t(r),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var wF=Xr;class Io{constructor(t,r,a,l){this.type=t,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,_n),l=r.parse(t[2],2,Wt);if(!a||!l)return null;if(!ee(a.type,[Se(_n),hn,_n]))return r.error(`Expected first argument to be of type array or string, but found ${_r(a.type)} instead`);if(4===t.length){const u=r.parse(t[3],3,Wt);return u?new Io(a.type,a,l,u):null}return new Io(a.type,a,l)}evaluate(t){const r=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!Yg(r,["string","array"]))throw new Wr(`Expected first argument to be of type array or string, but found ${_r(Sr(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(t);return r.slice(a,l)}return r.slice(a)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ss=Io;function m_(n,t){return"=="===n||"!="===n?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function cu(n,t,r,a){return 0===a.compare(t,r)}function pc(n,t,r){const a="=="!==n&&"!="!==n;return class h5{constructor(u,d,h){this.type=Sn,this.lhs=u,this.rhs=d,this.collator=h,this.hasUntypedArgument="value"===u.type.kind||"value"===d.type.kind}static parse(u,d){if(3!==u.length&&4!==u.length)return d.error("Expected two or three arguments.");const h=u[0];let p=d.parse(u[1],1,_n);if(!p)return null;if(!m_(h,p.type))return d.concat(1).error(`"${h}" comparisons are not supported for type '${_r(p.type)}'.`);let m=d.parse(u[2],2,_n);if(!m)return null;if(!m_(h,m.type))return d.concat(2).error(`"${h}" comparisons are not supported for type '${_r(m.type)}'.`);if(p.type.kind!==m.type.kind&&"value"!==p.type.kind&&"value"!==m.type.kind)return d.error(`Cannot compare types '${_r(p.type)}' and '${_r(m.type)}'.`);a&&("value"===p.type.kind&&"value"!==m.type.kind?p=new za(m.type,[p]):"value"!==p.type.kind&&"value"===m.type.kind&&(m=new za(p.type,[m])));let _=null;if(4===u.length){if("string"!==p.type.kind&&"string"!==m.type.kind&&"value"!==p.type.kind&&"value"!==m.type.kind)return d.error("Cannot use collator to compare non-string types.");if(_=d.parse(u[3],3,Wg),!_)return null}return new h5(p,m,_)}evaluate(u){const d=this.lhs.evaluate(u),h=this.rhs.evaluate(u);if(a&&this.hasUntypedArgument){const p=Sr(d),m=Sr(h);if(p.kind!==m.kind||"string"!==p.kind&&"number"!==p.kind)throw new Wr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${p.kind}, ${m.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const p=Sr(d),m=Sr(h);if("string"!==p.kind||"string"!==m.kind)return t(u,d,h)}return this.collator?r(u,d,h,this.collator.evaluate(u)):t(u,d,h)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[n];return this.eachChild(d=>{u.push(d.serialize())}),u}}}const ja=pc("==",function(n,t,r){return t===r},cu),D0=pc("!=",function(n,t,r){return t!==r},function(n,t,r,a){return!cu(0,t,r,a)}),JI=pc("<",function(n,t,r){return t<r},function(n,t,r,a){return a.compare(t,r)<0}),QI=pc(">",function(n,t,r){return t>r},function(n,t,r,a){return a.compare(t,r)>0}),EF=pc("<=",function(n,t,r){return t<=r},function(n,t,r,a){return a.compare(t,r)<=0}),tA=pc(">=",function(n,t,r){return t>=r},function(n,t,r,a){return a.compare(t,r)>=0});class I0{constructor(t,r,a,l,u,d){this.type=hn,this.number=t,this.locale=r,this.currency=a,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(t,r){if(3!==t.length)return r.error("Expected two arguments.");const a=r.parse(t[1],1,Wt);if(!a)return null;const l=t[2];if("object"!=typeof l||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=r.parse(l.locale,1,hn),!u))return null;let d=null;if(l.currency&&(d=r.parse(l.currency,1,hn),!d))return null;let h=null;if(l.unit&&(h=r.parse(l.unit,1,hn),!h))return null;let p=null;if(l["min-fraction-digits"]&&(p=r.parse(l["min-fraction-digits"],1,Wt),!p))return null;let m=null;return l["max-fraction-digits"]&&(m=r.parse(l["max-fraction-digits"],1,Wt),!m)?null:new I0(a,u,d,h,p,m)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class SE{constructor(t){this.type=Wt,this.input=t}static parse(t,r){if(2!==t.length)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=r.parse(t[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?r.error(`Expected argument of type string or array, but found ${_r(a.type)} instead.`):new SE(a):null}evaluate(t){const r=this.input.evaluate(t);if("string"==typeof r||Array.isArray(r))return r.length;throw new Wr(`Expected value to be of type string or array, but found ${_r(Sr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}function TE(n){return function(){n=1831565813+(n|=0)|0;let t=Math.imul(n^n>>>15,1|n);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const eA={"==":ja,"!=":D0,">":QI,"<":JI,">=":tA,"<=":EF,array:za,at:bF,boolean:za,case:wF,coalesce:Dl,collator:ah,format:oh,image:Qu,in:ME,"index-of":p_,interpolate:Va,"interpolate-hcl":Va,"interpolate-lab":Va,length:SE,let:gh,literal:n_,match:Ep,number:za,"number-format":I0,object:za,slice:ss,step:h_,string:za,"to-boolean":sh,"to-color":sh,"to-number":sh,"to-string":sh,var:Kn,within:da,distance:S0};function nA(n,[t,r,a,l]){t=t.evaluate(n),r=r.evaluate(n),a=a.evaluate(n);const u=l?l.evaluate(n):1,d=v0(t,r,a,u);if(d)throw new Wr(d);return new Ne(t/255*u,r/255*u,a/255*u,u)}function iA(n,[t,r,a,l]){t=t.evaluate(n),r=r.evaluate(n),a=a.evaluate(n);const u=l?l.evaluate(n):1,d=(_=r,y=a,x=u,"number"==typeof(m=t)&&m>=0&&m<=360?"number"==typeof _&&_>=0&&_<=100&&"number"==typeof y&&y>=0&&y<=100?void 0===x||"number"==typeof x&&x>=0&&x<=1?null:`Invalid hsla value [${[m,_,y,x].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof x?[m,_,y,x]:[m,_,y]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof x?[m,_,y,x]:[m,_,y]).join(", ")}]: 'h' must be between 0 and 360.`);var m,_,y,x;if(d)throw new Wr(d);const h=`hsla(${t}, ${r}%, ${a}%, ${u})`,p=Ne.parse(h);if(!p)throw new Wr(`Failed to parse HSLA color: ${h}`);return p}function rA(n,t){return n in t}function DE(n,t){const r=t[n];return void 0===r?null:r}function oA(n,t,r){r.length&&(t+=`\x1f${r}`);const a=n.getConfig(t);return a?a.evaluate(n):null}function _h(n){return{type:n}}vs.register(eA,{error:[{kind:"error"},[hn],(n,[t])=>{throw new Wr(t.evaluate(n))}],typeof:[hn,[_n],(n,[t])=>_r(Sr(t.evaluate(n)))],"to-rgba":[Se(Wt,4),[Na],(n,[t])=>t.evaluate(n).toArray()],rgb:[Na,[Wt,Wt,Wt],nA],rgba:[Na,[Wt,Wt,Wt,Wt],nA],hsl:[Na,[Wt,Wt,Wt],iA],hsla:[Na,[Wt,Wt,Wt,Wt],iA],has:{type:Sn,overloads:[[[hn],(n,[t])=>rA(t.evaluate(n),n.properties())],[[hn,ih],(n,[t,r])=>rA(t.evaluate(n),r.evaluate(n))]]},get:{type:_n,overloads:[[[hn],(n,[t])=>DE(t.evaluate(n),n.properties())],[[hn,ih],(n,[t,r])=>DE(t.evaluate(n),r.evaluate(n))]]},config:{type:_n,overloads:[[[hn],(n,[t])=>oA(n,t.evaluate(n),"")],[[hn,hn],(n,[t,r])=>oA(n,t.evaluate(n),r.evaluate(n))]]},"feature-state":[_n,[hn],(n,[t])=>DE(t.evaluate(n),n.featureState||{})],properties:[ih,[],n=>n.properties()],"geometry-type":[hn,[],n=>n.geometryType()],id:[_n,[],n=>n.id()],zoom:[Wt,[],n=>n.globals.zoom],pitch:[Wt,[],n=>n.globals.pitch||0],"distance-from-center":[Wt,[],n=>n.distanceFromCenter()],"measure-light":[Wt,[hn],(n,[t])=>n.measureLight(t.evaluate(n))],"heatmap-density":[Wt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Wt,[],n=>n.globals.lineProgress||0],"raster-value":[Wt,[],n=>n.globals.rasterValue||0],"sky-radial-progress":[Wt,[],n=>n.globals.skyRadialProgress||0],accumulated:[_n,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Wt,_h(Wt),(n,t)=>{let r=0;for(const a of t)r+=a.evaluate(n);return r}],"*":[Wt,_h(Wt),(n,t)=>{let r=1;for(const a of t)r*=a.evaluate(n);return r}],"-":{type:Wt,overloads:[[[Wt,Wt],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Wt],(n,[t])=>-t.evaluate(n)]]},"/":[Wt,[Wt,Wt],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Wt,[Wt,Wt],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Wt,[Wt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))],log2:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Wt,[Wt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Wt,[Wt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Wt,[Wt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Wt,[Wt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Wt,[Wt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Wt,[Wt],(n,[t])=>Math.atan(t.evaluate(n))],min:[Wt,_h(Wt),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[Wt,_h(Wt),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[Wt,[Wt],(n,[t])=>Math.abs(t.evaluate(n))],round:[Wt,[Wt],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Wt,[Wt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Wt,[Wt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Sn,[hn,_n],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Sn,[_n],(n,[t])=>n.id()===t.value],"filter-type-==":[Sn,[hn],(n,[t])=>n.geometryType()===t.value],"filter-<":[Sn,[hn,_n],(n,[t,r])=>{const a=n.properties()[t.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[Sn,[_n],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r<a}],"filter->":[Sn,[hn,_n],(n,[t,r])=>{const a=n.properties()[t.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[Sn,[_n],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r>a}],"filter-<=":[Sn,[hn,_n],(n,[t,r])=>{const a=n.properties()[t.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[Sn,[_n],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r<=a}],"filter->=":[Sn,[hn,_n],(n,[t,r])=>{const a=n.properties()[t.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[Sn,[_n],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r>=a}],"filter-has":[Sn,[_n],(n,[t])=>t.value in n.properties()],"filter-has-id":[Sn,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Sn,[Se(hn)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Sn,[Se(_n)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Sn,[hn,Se(_n)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Sn,[hn,Se(_n)],(n,[t,r])=>function(a,l,u,d){for(;u<=d;){const h=u+d>>1;if(l[h]===a)return!0;l[h]>a?d=h-1:u=h+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Sn,overloads:[[[Sn,Sn],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[_h(Sn),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Sn,overloads:[[[Sn,Sn],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[_h(Sn),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Sn,[Sn],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Sn,[hn],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[hn,[hn],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[hn,[hn],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[hn,_h(_n),(n,t)=>t.map(r=>e_(r.evaluate(n))).join("")],"resolved-locale":[hn,[Wg],(n,[t])=>t.evaluate(n).resolvedLocale()],random:[Wt,[Wt,Wt,_n],(n,t)=>{const[r,a,l]=t.map(d=>d.evaluate(n));if(r>a||r===a)return r;let u;if("string"==typeof l)u=function(d){let h=0;if(0===d.length)return h;for(let p=0;p<d.length;p++)h=(h<<5)-h+d.charCodeAt(p),h&=h;return h}(l);else{if("number"!=typeof l)throw new Wr(`Invalid seed input: ${l}`);u=l}return r+TE(u)()*(a-r)}]});var g_=eA;function sA(n){return{result:"success",value:n}}function yh(n){return{result:"error",value:n}}function A0(n,t){return!!n&&!!n.parameters&&n.parameters.indexOf(t)>-1}function uu(n){return"data-driven"===n["property-type"]}function aA(n){return A0(n.expression,"measure-light")}function IE(n){return A0(n.expression,"zoom")}function AE(n){return!!n.expression&&n.expression.interpolated}function Il(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function du(n){return n}function lA(n,t){const r="color"===t.type,a=n.stops&&"object"==typeof n.stops[0][0],l=a||!(a||void 0!==n.property),u=n.type||(AE(t)?"exponential":"interval");if(r&&((n=ou({},n)).stops&&(n.stops=n.stops.map(m=>[m[0],Ne.parse(m[1])])),n.default=Ne.parse(n.default?n.default:t.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!nd[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let d,h,p;if("exponential"===u)d=$s;else if("interval"===u)d=y_;else if("categorical"===u){d=Ao,h=Object.create(null);for(const m of n.stops)h[m[0]]=m[1];p=typeof n.stops[0][0]}else{if("identity"!==u)throw new Error(`Unknown function type "${u}"`);d=RE}if(a){const m={},_=[];for(let b=0;b<n.stops.length;b++){const E=n.stops[b],C=E[0].zoom;void 0===m[C]&&(m[C]={zoom:C,type:n.type,property:n.property,default:n.default,stops:[]},_.push(C)),m[C].stops.push([E[0].value,E[1]])}const y=[];for(const b of _)y.push([m[b].zoom,lA(m[b],t)]);const x={name:"linear"};return{kind:"composite",interpolationType:x,interpolationFactor:Va.interpolationFactor.bind(void 0,x),zoomStops:y.map(b=>b[0]),evaluate:({zoom:b},E)=>$s({stops:y,base:n.base},t,b).evaluate(b,E)}}if(l){const m="exponential"===u?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:m,interpolationFactor:Va.interpolationFactor.bind(void 0,m),zoomStops:n.stops.map(_=>_[0]),evaluate:({zoom:_})=>d(n,t,_,h,p)}}return{kind:"source",evaluate(m,_){const y=_&&_.properties?_.properties[n.property]:void 0;return void 0===y?__(n.default,t.default):d(n,t,y,h,p)}}}function __(n,t,r){return void 0!==n?n:void 0!==t?t:void 0!==r?r:void 0}function Ao(n,t,r,a,l){return __(typeof r===l?a[r]:void 0,n.default,t.default)}function y_(n,t,r){if("number"!==On(r))return __(n.default,t.default);const a=n.stops.length;if(1===a||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[a-1][0])return n.stops[a-1][1];const l=$o(n.stops.map(u=>u[0]),r);return n.stops[l][1]}function $s(n,t,r){const a=void 0!==n.base?n.base:1;if("number"!==On(r))return __(n.default,t.default);const l=n.stops.length;if(1===l||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[l-1][0])return n.stops[l-1][1];const u=$o(n.stops.map(_=>_[0]),r),d=function(_,y,x,b){const E=b-x,C=_-x;return 0===E?0:1===y?C/E:(Math.pow(y,C)-1)/(Math.pow(y,E)-1)}(r,a,n.stops[u][0],n.stops[u+1][0]),h=n.stops[u][1],p=n.stops[u+1][1];let m=f_[t.type]||du;if(n.colorSpace&&"rgb"!==n.colorSpace){const _=nd[n.colorSpace];m=(y,x)=>_.reverse(_.interpolate(_.forward(y),_.forward(x),d))}return"function"==typeof h.evaluate?{evaluate(..._){const y=h.evaluate.apply(void 0,_),x=p.evaluate.apply(void 0,_);if(void 0!==y&&void 0!==x)return m(y,x,d)}}:m(h,p,d)}function RE(n,t,r){return"color"===t.type?r=Ne.parse(r):"formatted"===t.type?r=Ke.fromString(r.toString()):"resolvedImage"===t.type?r=ys.fromString(r.toString()):On(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),__(r,n.default,t.default)}class v_{constructor(t,r,a){var l;this.expression=t,this._warningHistory={},this._evaluator=new $I(a),this._defaultValue=r?"color"===(l=r).type&&(Il(l.default)||Array.isArray(l.default))?new Ne(0,0,0,0):"color"===l.type?Ne.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=r&&"enum"===r.type?r.values:null}evaluateWithoutErrorHandling(t,r,a,l,u,d,h,p){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=h||null,this._evaluator.featureDistanceData=p||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,a,l,u,d,h,p){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=h||null,this._evaluator.featureDistanceData=p||null;try{const m=this.expression.evaluate(this._evaluator);if(null==m||"number"==typeof m&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Wr(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function Cp(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in g_}function mc(n,t,r){const a=new Ho(g_,[],t?function(u){const d={color:Na,string:hn,number:Wt,enum:hn,boolean:Sn,formatted:Zg,resolvedImage:Vo};return"array"===u.type?Se(d[u.value]||_n,u.length):d[u.type]}(t):void 0,void 0,void 0,r),l=a.parse(n,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return l?sA(new v_(l,t,r)):yh(a.errors)}class Mp{constructor(t,r,a){this.kind=t,this._styleExpression=r,this.isLightConstant=a,this.isStateDependent="constant"!==t&&!c_(r.expression),this.isConfigDependent=!u_(r.expression)}evaluateWithoutErrorHandling(t,r,a,l,u,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,l,u,d)}evaluate(t,r,a,l,u,d){return this._styleExpression.evaluate(t,r,a,l,u,d)}}class gc{constructor(t,r,a,l,u){this.kind=t,this.zoomStops=a,this._styleExpression=r,this.isStateDependent="camera"!==t&&!c_(r.expression),this.isLightConstant=u,this.isConfigDependent=!u_(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,a,l,u,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,l,u,d)}evaluate(t,r,a,l,u,d){return this._styleExpression.evaluate(t,r,a,l,u,d)}interpolationFactor(t,r,a){return this.interpolationType?Va.interpolationFactor(this.interpolationType,t,r,a):0}}function Sp(n,t,r){if("error"===(n=mc(n,t,r)).result)return n;const a=n.value.expression,l=ci(a);if(!l&&!uu(t))return yh([new dc("","data expressions not supported")]);const u=Ee(a,["zoom","pitch","distance-from-center"]);if(!u&&!IE(t))return yh([new dc("","zoom expressions not supported")]);const d=Ee(a,["measure-light"]);if(!d&&!aA(t))return yh([new dc("","measure-light expression not supported")]);const h=t.expression&&t.expression.relaxZoomRestriction,p=Tp(a);return p||u||h?p instanceof dc?yh([p]):p instanceof Va&&!AE(t)?yh([new dc("",'"interpolate" expressions cannot be used with this property')]):sA(p?new gc(l?"camera":"composite",n.value,p.labels,p instanceof Va?p.interpolation:void 0,d):new Mp(l?"constant":"source",n.value,d)):yh([new dc("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class vh{constructor(t,r){this._parameters=t,this._specification=r,ou(this,lA(this._parameters,this._specification))}static deserialize(t){return new vh(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Tp(n){let t=null;if(n instanceof gh)t=Tp(n.result);else if(n instanceof Dl){for(const r of n.args)if(t=Tp(r),t)break}else(n instanceof h_||n instanceof Va)&&n.input instanceof vs&&"zoom"===n.input.name&&(t=n);return t instanceof dc||n.eachChild(r=>{const a=Tp(r);a instanceof dc?t=a:t&&a&&t!==a&&(t=new dc("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Gs(n){const t=n.key,r=n.value,a=n.valueSpec||{},l=n.objectElementValidators||{},u=n.style,d=n.styleSpec;let h=[];const p=On(r);if("object"!==p)return[new It(t,r,`object expected, ${p} found`)];for(const m in r){const _=m.split(".")[0];let y;l[_]?y=l[_]:a[_]?y=Yr:l["*"]?y=l["*"]:a["*"]&&(y=Yr),y?h=h.concat(y({key:(t&&`${t}.`)+m,value:r[m],valueSpec:a[_]||a["*"],style:u,styleSpec:d,object:r,objectKey:m},r)):h.push(new Ju(t,r[m],`unknown property "${m}"`))}for(const m in a)l[m]||a[m].required&&void 0===a[m].default&&void 0===r[m]&&h.push(new It(t,r,`missing required property "${m}"`));return h}function R0(n){const t=n.value,r=n.valueSpec,a=n.style,l=n.styleSpec,u=n.key,d=n.arrayElementValidator||Yr;if("array"!==On(t))return[new It(u,t,`array expected, ${On(t)} found`)];if(r.length&&t.length!==r.length)return[new It(u,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new It(u,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let h={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(h.function=r.function),"object"===On(r.value)&&(h=r.value);let p=[];for(let m=0;m<t.length;m++)p=p.concat(d({array:t,arrayIndex:m,value:t[m],valueSpec:h,style:a,styleSpec:l,key:`${u}[${m}]`},!0));return p}function Dp(n){const t=n.key,r=n.value,a=n.valueSpec;let l=On(r);if("number"===l&&r!=r&&(l="NaN"),"number"!==l)return[new It(t,r,`number expected, ${l} found`)];if("minimum"in a){let u=a.minimum;if("array"===On(a.minimum)&&(u=a.minimum[n.arrayIndex]),r<u)return[new It(t,r,`${r} is less than the minimum value ${u}`)]}if("maximum"in a){let u=a.maximum;if("array"===On(a.maximum)&&(u=a.maximum[n.arrayIndex]),r>u)return[new It(t,r,`${r} is greater than the maximum value ${u}`)]}return[]}function xh(n){const t=n.valueSpec,r=gr(n.value.type);let a,l,u,d={};const h="categorical"!==r&&void 0===n.value.property,p=!h,m="array"===On(n.value.stops)&&"array"===On(n.value.stops[0])&&"object"===On(n.value.stops[0][0]),_=Gs({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(b){if("identity"===r)return[new It(b.key,b.value,'identity function may not have a "stops" property')];let E=[];const C=b.value;return E=E.concat(R0({key:b.key,value:C,valueSpec:b.valueSpec,style:b.style,styleSpec:b.styleSpec,arrayElementValidator:y})),"array"===On(C)&&0===C.length&&E.push(new It(b.key,C,"array must have at least one stop")),E},default:function(b){return Yr({key:b.key,value:b.value,valueSpec:t,style:b.style,styleSpec:b.styleSpec})}}});return"identity"===r&&h&&_.push(new It(n.key,n.value,'missing required property "property"')),"identity"===r||n.value.stops||_.push(new It(n.key,n.value,'missing required property "stops"')),"exponential"===r&&n.valueSpec.expression&&!AE(n.valueSpec)&&_.push(new It(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(p&&!uu(n.valueSpec)?_.push(new It(n.key,n.value,"property functions not supported")):h&&!IE(n.valueSpec)&&_.push(new It(n.key,n.value,"zoom functions not supported"))),"categorical"!==r&&!m||void 0!==n.value.property||_.push(new It(n.key,n.value,'"property" property is required')),_;function y(b){let E=[];const C=b.value,S=b.key;if("array"!==On(C))return[new It(S,C,`array expected, ${On(C)} found`)];if(2!==C.length)return[new It(S,C,`array length 2 expected, length ${C.length} found`)];if(m){if("object"!==On(C[0]))return[new It(S,C,`object expected, ${On(C[0])} found`)];if(void 0===C[0].zoom)return[new It(S,C,"object stop key must have zoom")];if(void 0===C[0].value)return[new It(S,C,"object stop key must have value")];const M=gr(C[0].zoom);if("number"!=typeof M)return[new It(S,C[0].zoom,"stop zoom values must be numbers")];if(u&&u>M)return[new It(S,C[0].zoom,"stop zoom values must appear in ascending order")];M!==u&&(u=M,l=void 0,d={}),E=E.concat(Gs({key:`${S}[0]`,value:C[0],valueSpec:{zoom:{}},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{zoom:Dp,value:x}}))}else E=E.concat(x({key:`${S}[0]`,value:C[0],valueSpec:{},style:b.style,styleSpec:b.styleSpec},C));return Cp(La(C[1]))?E.concat([new It(`${S}[1]`,C[1],"expressions are not allowed in function stops.")]):E.concat(Yr({key:`${S}[1]`,value:C[1],valueSpec:t,style:b.style,styleSpec:b.styleSpec}))}function x(b,E){const C=On(b.value),S=gr(b.value),M=null!==b.value?b.value:E;if(a){if(C!==a)return[new It(b.key,M,`${C} stop domain type must match previous stop domain type ${a}`)]}else a=C;if("number"!==C&&"string"!==C&&"boolean"!==C&&"number"!=typeof S&&"string"!=typeof S&&"boolean"!=typeof S)return[new It(b.key,M,"stop domain value must be a number, string, or boolean")];if("number"!==C&&"categorical"!==r){let D=`number expected, ${C} found`;return uu(t)&&void 0===r&&(D+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(b.key,M,D)]}return"categorical"!==r||"number"!==C||"number"==typeof S&&isFinite(S)&&Math.floor(S)===S?"categorical"!==r&&"number"===C&&"number"==typeof S&&"number"==typeof l&&void 0!==l&&S<l?[new It(b.key,M,"stop domain values must appear in ascending order")]:(l=S,"categorical"===r&&S in d?[new It(b.key,M,"stop domain values must be unique")]:(d[S]=!0,[])):[new It(b.key,M,`integer expected, found ${String(S)}`)]}}function fa(n){const t=("property"===n.expressionContext?Sp:mc)(La(n.value),n.valueSpec);if("error"===t.result)return t.value.map(a=>new It(`${n.key}${a.key}`,n.value,a.message));const r=t.value.expression||t.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!r.outputDefined())return[new It(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!c_(r))return[new It(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return P0(r,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Ee(r,["zoom","feature-state"]))return[new It(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!ci(r))return[new It(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function P0(n,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const l of t.valueSpec.expression.parameters)r.delete(l);if(0===r.size)return[];const a=[];return n instanceof vs&&r.has(n.name)?[new It(t.key,t.value,`["${n.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(n.eachChild(l=>{a.push(...P0(l,t))}),a)}function O0(n){const t=n.key,r=n.value,a=n.valueSpec,l=[];return Array.isArray(a.values)?-1===a.values.indexOf(gr(r))&&l.push(new It(t,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(a.values).indexOf(gr(r))&&l.push(new It(t,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function PE(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!PE(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function k0(n,t="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};PE(n)||(n=bh(n));const r=n;let a=!0;try{a=function(m){if(!Ip(m))return m;let _=La(m);return kE(_),_=OE(_),_}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const l=J[`filter_${t}`],u=mc(a,l);let d=null;if("error"===u.result)throw new Error(u.value.map(m=>`${m.key}: ${m.message}`).join(", "));d=(m,_,y)=>u.value.evaluate(m,_,{},y);let h=null,p=null;if(a!==r){const m=mc(r,l);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));h=(_,y,x,b,E)=>m.value.evaluate(_,y,{},x,void 0,void 0,b,E),p=!ci(m.value.expression)}return{filter:d,dynamicFilter:h||void 0,needGeometry:LE(a),needFeature:!!p}}function OE(n){if(!Array.isArray(n))return n;const t=function(r){if(FE.has(r[0]))for(let a=1;a<r.length;a++)if(Ip(r[a]))return!0;return r}(n);return!0===t?t:t.map(r=>OE(r))}function kE(n){let t=!1;const r=[];if("case"===n[0]){for(let a=1;a<n.length-1;a+=2)t=t||Ip(n[a]),r.push(n[a+1]);r.push(n[n.length-1])}else if("match"===n[0]){t=t||Ip(n[1]);for(let a=2;a<n.length-1;a+=2)r.push(n[a+1]);r.push(n[n.length-1])}else if("step"===n[0]){t=t||Ip(n[1]);for(let a=1;a<n.length-1;a+=2)r.push(n[a+1])}t&&(n.length=0,n.push("any",...r));for(let a=1;a<n.length;a++)kE(n[a])}function Ip(n){if(!Array.isArray(n))return!1;if("pitch"===(t=n[0])||"distance-from-center"===t)return!0;var t;for(let r=1;r<n.length;r++)if(Ip(n[r]))return!0;return!1}const FE=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function F0(n,t){return n<t?-1:n>t?1:0}function LE(n){if(!Array.isArray(n))return!1;if("within"===n[0]||"distance"===n[0])return!0;for(let t=1;t<n.length;t++)if(LE(n[t]))return!0;return!1}function bh(n){if(!n)return!0;const t=n[0];return n.length<=1?"any"!==t:"=="===t?NE(n[1],n[2],"=="):"!="===t?Ap(NE(n[1],n[2],"==")):"<"===t||">"===t||"<="===t||">="===t?NE(n[1],n[2],t):"any"===t?(r=n.slice(1),["any"].concat(r.map(bh))):"all"===t?["all"].concat(n.slice(1).map(bh)):"none"===t?["all"].concat(n.slice(1).map(bh).map(Ap)):"in"===t?cA(n[1],n.slice(2)):"!in"===t?Ap(cA(n[1],n.slice(2))):"has"===t?zE(n[1]):"!has"!==t||Ap(zE(n[1]));var r}function NE(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function cA(n,t){if(0===t.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(F0)]]:["filter-in-small",n,["literal",t]]}}function zE(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ap(n){return["!",n]}function x_(n){return PE(La(n.value))?fa(ou({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):BE(n)}function BE(n){const t=n.value,r=n.key;if("array"!==On(t))return[new It(r,t,`array expected, ${On(t)} found`)];const a=n.styleSpec;let l,u=[];if(t.length<1)return[new It(r,t,"filter array must have at least 1 element")];switch(u=u.concat(O0({key:`${r}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),gr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===gr(t[1])&&u.push(new It(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&u.push(new It(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=On(t[1]),"string"!==l&&u.push(new It(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let d=2;d<t.length;d++)l=On(t[d]),"$type"===gr(t[1])?u=u.concat(O0({key:`${r}[${d}]`,value:t[d],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==l&&"number"!==l&&"boolean"!==l&&u.push(new It(`${r}[${d}]`,t[d],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let d=1;d<t.length;d++)u=u.concat(BE({key:`${r}[${d}]`,value:t[d],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":l=On(t[1]),2!==t.length?u.push(new It(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==l&&u.push(new It(`${r}[1]`,t[1],`string expected, ${l} found`))}return u}function VE(n,t){const r=n.key,a=n.style,l=n.layer,u=n.styleSpec,d=n.value,h=n.objectKey,p=u[`${t}_${n.layerType}`];if(!p)return[];const m=h.match(/^(.*)-transition$/);if("paint"===t&&m&&p[m[1]]&&p[m[1]].transition)return Yr({key:r,value:d,valueSpec:u.transition,style:a,styleSpec:u});const _=n.valueSpec||p[h];if(!_)return[new Ju(r,d,`unknown property "${h}"`)];let y;if("string"===On(d)&&uu(_)&&!_.tokens&&(y=/^{([^}]+)}$/.exec(d))){const b=`\`{ "type": "identity", "property": ${y?JSON.stringify(y[1]):'"_"'} }\``;return[new It(r,d,`"${h}" does not support interpolation syntax\nUse an identity property function instead: ${b}.`)]}const x=[];if("symbol"===n.layerType)"text-field"!==h||!a||a.glyphs||a.imports||x.push(new It(r,d,'use of "text-field" requires a style "glyphs" property')),"text-font"===h&&Il(La(d))&&"identity"===gr(d.type)&&x.push(new It(r,d,'"text-font" does not support identity functions'));else if("model"===n.layerType&&"paint"===t&&l&&l.layout&&l.layout.hasOwnProperty("model-id")&&uu(_)&&(aA(_)||IE(_))){const b=Sp(La(d),_),E=b.value.expression||b.value._styleExpression.expression;E&&!Ee(E,["measure-light"])&&x.push(new It(r,d,`${h} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`))}return x.concat(Yr({key:n.key,value:d,valueSpec:_,style:a,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:h}))}function jE(n){return VE(n,"paint")}function L0(n){return VE(n,"layout")}function UE(n){let t=[];const r=n.value,a=n.key,l=n.style,u=n.styleSpec;r.type||r.ref||t.push(new It(a,r,'either "type" or "ref" is required'));let d=gr(r.type);const h=gr(r.ref);if(r.id){const p=gr(r.id);for(let m=0;m<n.arrayIndex;m++){const _=l.layers[m];gr(_.id)===p&&t.push(new It(a,r.id,`duplicate layer id "${r.id}", previously used at line ${_.id.__line__}`))}}if("ref"in r){let p;["type","source","source-layer","filter","layout"].forEach(m=>{m in r&&t.push(new It(a,r[m],`"${m}" is prohibited for ref layers`))}),l.layers.forEach(m=>{gr(m.id)===h&&(p=m)}),p?p.ref?t.push(new It(a,r.ref,"ref cannot reference another ref layer")):d=gr(p.type):"string"==typeof h&&t.push(new It(a,r.ref,`ref layer "${h}" not found`))}else if("background"!==d&&"sky"!==d&&"slot"!==d)if(r.source){const p=l.sources&&l.sources[r.source],m=p&&gr(p.type);p?"vector"===m&&"raster"===d?t.push(new It(a,r.source,`layer "${r.id}" requires a raster source`)):"raster"===m&&"raster"!==d?t.push(new It(a,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==m||r["source-layer"]?"raster-dem"===m&&"hillshade"!==d?t.push(new It(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==d||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===m&&p.lineMetrics||t.push(new It(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new It(a,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new It(a,r.source,`source "${r.source}" not found`))}else t.push(new It(a,r,'missing required property "source"'));return t=t.concat(Gs({key:a,value:r,valueSpec:u.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Yr({key:`${a}.type`,value:r.type,valueSpec:u.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:p=>x_(ou({layerType:d},p)),layout:p=>Gs({layer:r,key:p.key,value:p.value,valueSpec:{},style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":m=>L0(ou({layerType:d},m))}}),paint:p=>Gs({layer:r,key:p.key,value:p.value,valueSpec:{},style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":m=>jE(ou({layerType:d,layer:r},m))}})}})),t}function od(n){const t=n.value,r=n.key,a=On(t);return"string"!==a?[new It(r,t,`string expected, ${a} found`)]:[]}const HE={promoteId:function({key:n,value:t}){if("string"===On(t))return od({key:n,value:t});{const r=[];for(const a in t)r.push(...od({key:`${n}.${a}`,value:t[a]}));return r}}};function uA(n){const t=n.value,r=n.key,a=n.styleSpec,l=n.style;if(!t.type)return[new It(r,t,'"type" is required')];const u=gr(t.type);let d;switch(u){case"vector":case"raster":case"raster-dem":return d=Gs({key:r,value:t,valueSpec:a[`source_${u.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:HE}),d;case"geojson":if(d=Gs({key:r,value:t,valueSpec:a.source_geojson,style:l,styleSpec:a,objectElementValidators:HE}),t.cluster)for(const h in t.clusterProperties){const[p,m]=t.clusterProperties[h],_="string"==typeof p?[p,["accumulated"],["get",h]]:p;d.push(...fa({key:`${r}.${h}.map`,value:m,expressionContext:"cluster-map"})),d.push(...fa({key:`${r}.${h}.reduce`,value:_,expressionContext:"cluster-reduce"}))}return d;case"video":return Gs({key:r,value:t,valueSpec:a.source_video,style:l,styleSpec:a});case"image":return Gs({key:r,value:t,valueSpec:a.source_image,style:l,styleSpec:a});case"canvas":return[new It(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return O0({key:`${r}.type`,value:t.type,valueSpec:{values:dA(a)},style:l,styleSpec:a})}}function dA(n){return n.source.reduce((t,r)=>{const a=n[r];return"enum"===a.type.type&&(t=t.concat(Object.keys(a.type.values))),t},[])}function qo(n){const t=n.value;let r=[];if(!t)return r;const a=On(t);return"string"!==a?(r=r.concat([new It(n.key,t,`string expected, "${a}" found`)]),r):(function(l){const u=-1===l.indexOf("://");try{return new URL(l,u?"http://example.com":void 0),!0}catch{return!1}}(t)||(r=r.concat([new It(n.key,t,`invalid url "${t}"`)])),r)}function N0(n){const t=n.value,r=n.styleSpec,a=r.light,l=n.style;let u=[];const d=On(t);if(void 0===t)return u;if("object"!==d)return u=u.concat([new It("light",t,`object expected, ${d} found`)]),u;for(const h in t){const p=h.match(/^(.*)-transition$/);u=u.concat(p&&a[p[1]]&&a[p[1]].transition?Yr({key:h,value:t[h],valueSpec:r.transition,style:l,styleSpec:r}):a[h]?Yr({key:h,value:t[h],valueSpec:a[h],style:l,styleSpec:r}):[new It(h,t[h],`unknown property "${h}"`)])}return u}function $E(n){const t=n.value;let r=[];if(!t)return r;const a=On(t);if("object"!==a)return r=r.concat([new It("light-3d",t,`object expected, ${a} found`)]),r;const l=n.styleSpec,u=l["light-3d"],d=n.key,h=n.style,p=n.style.lights;for(const y of["type","id"])if(!(y in t))return r=r.concat([new It("light-3d",t,`missing property ${y} on light`)]),r;if(t.type&&p)for(let y=0;y<n.arrayIndex;y++){const x=gr(t.type),b=p[y];gr(b.type)===x&&r.push(new It(d,t.id,`duplicate light type "${t.type}", previously defined at line ${b.id.__line__}`))}const m=`properties_light_${t.type}`;if(!(m in l))return r=r.concat([new It("light-3d",t,`Invalid light type ${t.type}`)]),r;const _=l[m];for(const y in t)if("properties"===y){const x=t[y],b=On(x);if("object"!==b)return r=r.concat([new It("properties",x,`object expected, ${b} found`)]),r;for(const E in x)r=r.concat(_[E]?Yr({key:E,value:x[E],valueSpec:_[E],style:h,styleSpec:l}):[new Ju(n.key,x[E],`unknown property "${E}"`)])}else{const x=y.match(/^(.*)-transition$/);r=r.concat(x&&u[x[1]]&&u[x[1]].transition?Yr({key:y,value:t[y],valueSpec:l.transition,style:h,styleSpec:l}):u[y]?Yr({key:y,value:t[y],valueSpec:u[y],style:h,styleSpec:l}):[new Ju(y,t[y],`unknown property "${y}"`)])}return r}function GE(n){const t=n.value,r=n.key,a=n.style,l=n.styleSpec,u=l.terrain;let d=[];const h=On(t);if(void 0===t)return d;if("object"!==h)return d=d.concat([new It("terrain",t,`object expected, ${h} found`)]),d;for(const p in t){const m=p.match(/^(.*)-transition$/);d=d.concat(m&&u[m[1]]&&u[m[1]].transition?Yr({key:p,value:t[p],valueSpec:l.transition,style:a,styleSpec:l}):u[p]?Yr({key:p,value:t[p],valueSpec:u[p],style:a,styleSpec:l}):[new Ju(p,t[p],`unknown property "${p}"`)])}if(t.source){const p=a.sources&&a.sources[t.source],m=p&&gr(p.type);p?"raster-dem"!==m&&d.push(new It(r,t.source,`terrain cannot be used with a source of type ${String(m)}, it only be used with a "raster-dem" source type`)):d.push(new It(r,t.source,`source "${t.source}" not found`))}else d.push(new It(r,t,'terrain is missing required property "source"'));return d}function z0(n){const t=n.value,r=n.style,a=n.styleSpec,l=a.fog;let u=[];const d=On(t);if(void 0===t)return u;if("object"!==d)return u=u.concat([new It("fog",t,`object expected, ${d} found`)]),u;for(const h in t){const p=h.match(/^(.*)-transition$/);u=u.concat(p&&l[p[1]]&&l[p[1]].transition?Yr({key:h,value:t[h],valueSpec:a.transition,style:r,styleSpec:a}):l[h]?Yr({key:h,value:t[h],valueSpec:l[h],style:r,styleSpec:a}):[new Ju(h,t[h],`unknown property "${h}"`)])}return u}const B0={"*":()=>[],array:R0,boolean:function(n){const t=n.value,r=n.key,a=On(t);return"boolean"!==a?[new It(r,t,`boolean expected, ${a} found`)]:[]},number:Dp,color:function(n){const t=n.key,r=n.value,a=On(r);return"string"!==a?[new It(t,r,`color expected, ${a} found`)]:null===gi(r)?[new It(t,r,`color expected, "${r}" found`)]:[]},enum:O0,filter:x_,function:xh,layer:UE,object:Gs,source:uA,model:qo,light:N0,"light-3d":$E,terrain:GE,fog:z0,string:od,formatted:function(n){return 0===od(n).length?[]:fa(n)},resolvedImage:function(n){return 0===od(n).length?[]:fa(n)},projection:function(n){const t=n.value,r=n.styleSpec,a=r.projection,l=n.style;let u=[];const d=On(t);if("object"===d)for(const h in t)u=u.concat(Yr({key:h,value:t[h],valueSpec:a[h],style:l,styleSpec:r}));else"string"!==d&&(u=u.concat([new It("projection",t,`object or string expected, ${d} found`)]));return u},import:function(n){const{value:t,styleSpec:r}=n,{data:a,...l}=t;Object.defineProperty(l,"__line__",{value:t.__line__,enumerable:!1});let u=Gs(ou({},n,{value:l,valueSpec:r.import}));return""===gr(l.id)&&u.push(new It(`${n.key}.id`,l,"import id can't be an empty string")),a&&(u=u.concat(qE(a,r,{key:`${n.key}.data`}))),u}};function Yr(n,t=!1){const r=n.value,a=n.valueSpec,l=n.styleSpec;if(a.expression&&Il(gr(r)))return xh(n);if(a.expression&&Cp(La(r)))return fa(n);if(a.type&&B0[a.type]){const u=B0[a.type](n);return!0===t&&u.length>0&&"array"===On(n.value)?fa(n):u}return Gs(ou({},n,{valueSpec:a.type?l[a.type]:a}))}function V0(n){const t=n.value,r=n.key,a=od(n);return a.length||(-1===t.indexOf("{fontstack}")&&a.push(new It(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&a.push(new It(r,t,'"glyphs" url must include a "{range}" token'))),a}function qE(n,t=J,r={}){return Yr({key:r.key||"",value:n,valueSpec:t.$root,styleSpec:t,style:n,objectElementValidators:{glyphs:V0,"*":()=>[]}})}function as(n,t=J){return Ua(qE(n,t))}const WE=n=>Ua(uA(n)),ZE=n=>Ua(N0(n)),Ki=n=>Ua($E(n)),j0=n=>Ua(GE(n)),b_=n=>Ua(z0(n)),xs=n=>Ua(UE(n)),U0=n=>Ua(x_(n)),XE=n=>Ua(jE(n)),wh=n=>Ua(L0(n)),qs=n=>Ua(qo(n));function Ua(n){return n.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function w_(n,t){let r=!1;if(t&&t.length)for(const a of t)a instanceof Ju?tt(a.message):(n.fire(new at(new Error(a.message))),r=!0);return r}var hA=Ha,ls=3;function Ha(n,t,r){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var l=new Int32Array(this.arrayBuffer);n=l[0],this.d=(t=l[1])+2*(r=l[2]);for(var u=0;u<this.d*this.d;u++){var d=l[ls+u],h=l[ls+u+1];a.push(d===h?null:l.subarray(d,h))}var p=l[ls+a.length+1];this.keys=l.subarray(l[ls+a.length],p),this.bboxes=l.subarray(p),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var m=0;m<this.d*this.d;m++)a.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=n,this.padding=r,this.scale=t/n,this.uid=0;var _=r/t*n;this.min=-_,this.max=n+_}Ha.prototype.insert=function(n,t,r,a,l){this._forEachCell(t,r,a,l,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l)},Ha.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ha.prototype._insertCell=function(n,t,r,a,l,u){this.cells[l].push(u)},Ha.prototype.query=function(n,t,r,a,l){var u=this.min,d=this.max;if(n<=u&&t<=u&&d<=r&&d<=a&&!l)return Array.prototype.slice.call(this.keys);var h=[];return this._forEachCell(n,t,r,a,this._queryCell,h,{},l),h},Ha.prototype._queryCell=function(n,t,r,a,l,u,d,h){var p=this.cells[l];if(null!==p)for(var m=this.keys,_=this.bboxes,y=0;y<p.length;y++){var x=p[y];if(void 0===d[x]){var b=4*x;(h?h(_[b+0],_[b+1],_[b+2],_[b+3]):n<=_[b+2]&&t<=_[b+3]&&r>=_[b+0]&&a>=_[b+1])?(d[x]=!0,u.push(m[x])):d[x]=!1}}},Ha.prototype._forEachCell=function(n,t,r,a,l,u,d,h){for(var p=this._convertToCellCoord(n),m=this._convertToCellCoord(t),_=this._convertToCellCoord(r),y=this._convertToCellCoord(a),x=p;x<=_;x++)for(var b=m;b<=y;b++){var E=this.d*b+x;if((!h||h(this._convertFromCellCoord(x),this._convertFromCellCoord(b),this._convertFromCellCoord(x+1),this._convertFromCellCoord(b+1)))&&l.call(this,n,t,r,a,E,u,d,h))return}},Ha.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Ha.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Ha.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,t=ls+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var l=new Int32Array(t+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=t,d=0;d<n.length;d++){var h=n[d];l[ls+d]=u,l.set(h,u),u+=h.length}return l[ls+n.length]=u,l.set(this.keys,u),l[ls+n.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};var Eh=ms(hA);const Rp={};function Xt(n,t,r={}){Object.defineProperty(n,"_classRegistryKey",{value:t,writeable:!1}),Rp[t]={klass:n,omit:r.omit||[]}}Xt(Object,"Object"),Eh.serialize=function(n,t){const r=n.toArrayBuffer();return t&&t.add(r),{buffer:r}},Eh.deserialize=function(n){return new Eh(n.buffer)},Object.defineProperty(Eh,"name",{value:"Grid"}),Xt(Eh,"Grid"),Xt(Ne,"Color"),Xt(Error,"Error"),Xt(xt,"AJAXError"),Xt(ys,"ResolvedImage"),Xt(vh,"StylePropertyFunction"),Xt(v_,"StyleExpression",{omit:["_evaluator"]}),Xt(gc,"ZoomDependentExpression"),Xt(Mp,"ZoomConstantExpression"),Xt(vs,"CompoundExpression",{omit:["_evaluate"]});for(const n in g_)Rp[g_[n]._classRegistryKey]||Xt(g_[n],`Expression${n}`);function H0(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function YE(n){return st.ImageBitmap&&n instanceof st.ImageBitmap}function qe(n,t){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(H0(n)||YE(n))return t&&t.add(n),n;if(ArrayBuffer.isView(n)){const r=n;return t&&t.add(r.buffer),r}if(n instanceof st.ImageData)return t&&t.add(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const a of n)r.push(qe(a,t));return r}if(n instanceof Map){const r={$name:"Map"};for(const[a,l]of n.entries())r[a]=qe(l);return r}if("object"==typeof n){const r=n.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const l=r.serialize?r.serialize(n,t):{};if(!r.serialize){for(const u in n)n.hasOwnProperty(u)&&(Rp[a].omit.indexOf(u)>=0||(l[u]=qe(n[u],t)));n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(l.$name=a),l}throw new Error("can't serialize object of type "+typeof n)}function sd(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||H0(n)||YE(n)||ArrayBuffer.isView(n)||n instanceof st.ImageData)return n;if(Array.isArray(n))return n.map(sd);if("object"==typeof n){const t=n.$name||"Object";if("Map"===t){const l=new Map;for(const u of Object.keys(n))"$name"!==u&&l.set(u,sd(n[u]));return l}const{klass:r}=Rp[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const a=Object.create(r.prototype);for(const l of Object.keys(n))"$name"!==l&&(a[l]=sd(n[l]));return a}throw new Error("can't deserialize object of type "+typeof n)}const ie={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function $0(n){for(const t of n)if(E_(t.charCodeAt(0)))return!0;return!1}function fA(n){for(const t of n)if(!pA(t.charCodeAt(0)))return!1;return!0}function pA(n){return!(ie.Arabic(n)||ie["Arabic Supplement"](n)||ie["Arabic Extended-A"](n)||ie["Arabic Presentation Forms-A"](n)||ie["Arabic Presentation Forms-B"](n))}function E_(n){return!(746!==n&&747!==n&&(n<4352||!(ie["Bopomofo Extended"](n)||ie.Bopomofo(n)||ie["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||ie["CJK Compatibility Ideographs"](n)||ie["CJK Compatibility"](n)||ie["CJK Radicals Supplement"](n)||ie["CJK Strokes"](n)||!(!ie["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||ie["CJK Unified Ideographs Extension A"](n)||ie["CJK Unified Ideographs"](n)||ie["Enclosed CJK Letters and Months"](n)||ie["Hangul Compatibility Jamo"](n)||ie["Hangul Jamo Extended-A"](n)||ie["Hangul Jamo Extended-B"](n)||ie["Hangul Jamo"](n)||ie["Hangul Syllables"](n)||ie.Hiragana(n)||ie["Ideographic Description Characters"](n)||ie.Kanbun(n)||ie["Kangxi Radicals"](n)||ie["Katakana Phonetic Extensions"](n)||ie.Katakana(n)&&12540!==n||!(!ie["Halfwidth and Fullwidth Forms"](n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!ie["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||ie["Unified Canadian Aboriginal Syllabics"](n)||ie["Unified Canadian Aboriginal Syllabics Extended"](n)||ie["Vertical Forms"](n)||ie["Yijing Hexagram Symbols"](n)||ie["Yi Syllables"](n)||ie["Yi Radicals"](n))))}function ad(n){return!(E_(n)||(t=n,ie["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ie["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ie["Letterlike Symbols"](t)||ie["Number Forms"](t)||ie["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ie["Control Pictures"](t)&&9251!==t||ie["Optical Character Recognition"](t)||ie["Enclosed Alphanumerics"](t)||ie["Geometric Shapes"](t)||ie["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ie["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ie["CJK Symbols and Punctuation"](t)||ie.Katakana(t)||ie["Private Use Area"](t)||ie["CJK Compatibility Forms"](t)||ie["Small Form Variants"](t)||ie["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function KE(n){return n>=1424&&n<=2303||ie["Arabic Presentation Forms-A"](n)||ie["Arabic Presentation Forms-B"](n)}function mA(n,t){return!(!t&&KE(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||ie.Khmer(n))}function gA(n){for(const t of n)if(KE(t.charCodeAt(0)))return!0;return!1}const G0="deferred",q0="loading",Nt="loaded";let Wn=null,Wo="unavailable",Al=null;const fo=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(Wo="error"),Wn&&Wn(n)};function C_(){ld.fire(new St("pluginStateChange",{pluginStatus:Wo,pluginURL:Al}))}const ld=new $i,pa=function(){return Wo},M_=function(){if(Wo!==G0||!Al)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Wo=q0,C_(),Al&&zt({url:Al},n=>{n?fo(n):(Wo=Nt,C_())})},bs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Wo===Nt||null!=bs.applyArabicShaping,isLoading:()=>Wo===q0,setState(n){Wo=n.pluginStatus,Al=n.pluginURL},isParsed:()=>null!=bs.applyArabicShaping&&null!=bs.processBidirectionalText&&null!=bs.processStyledBidirectionalText,getPluginURL:()=>Al};class Ei{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(r,a){for(const l of r)if(!mA(l.charCodeAt(0),a))return!1;return!0}(t,bs.isLoaded())}}class W0{constructor(t,r,a){this.property=t,this.value=r,this.expression=function(l,u,d){if(Il(l))return new vh(l,u);if(Cp(l)||Array.isArray(l)&&l.length>0){const h=Sp(l,u,d);if("error"===h.result)throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=l;return"string"==typeof l&&"color"===u.type&&(h=Ne.parse(l)),{kind:"constant",isConfigDependent:!1,evaluate:()=>h}}}(void 0===r?t.specification.default:r,t.specification,a)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,r,a){return this.property.possiblyEvaluate(this,t,r,a)}}class S_{constructor(t,r){this.property=t,this.value=new W0(t,void 0,r)}transitioned(t,r){return new Rl(this.property,this.value,r,Yt({},t.transition,this.transition),t.now)}untransitioned(){return new Rl(this.property,this.value,null,{},0)}}class Kr{constructor(t,r){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=r,this.isConfigDependent=!1}getValue(t){return H(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new S_(this._values[t].property,this._options)),this._values[t].value=new W0(this._values[t].property,null===r?void 0:H(r),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,r){r&&(this._options=r);const a=this._properties.properties;if(t)for(const l in t){const u=t[l];if(tu(l,"-transition")){const d=l.slice(0,-11);a[d]&&this.setTransition(d,u)}else a[l]&&this.setValue(l,u)}}getTransition(t){return H(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new S_(this._values[t].property)),this._values[t].transition=H(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const a=this.getValue(r);void 0!==a&&(t[r]=a);const l=this.getTransition(r);void 0!==l&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const a=new Z0(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(t,r._values[l]);return a}untransitioned(){const t=new Z0(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Rl{constructor(t,r,a,l,u){const d=l.delay||0,h=l.duration||0;u=u||0,this.property=t,this.value=r,this.begin=u+d,this.end=this.begin+h,t.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(t,r,a){const l=t.now||0,u=this.value.possiblyEvaluate(t,r,a),d=this.prior;if(d){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return d.possiblyEvaluate(t,r,a);{const h=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(t,r,a),u,Jc(h))}}return u}}class Z0{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,a){const l=new Pp(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(t,r,a);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ch{constructor(t,r){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=r,this.isConfigDependent=!1}getValue(t){return H(this._values[t].value)}setValue(t,r){this._values[t]=new W0(this._values[t].property,null===r?void 0:H(r),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const r of Object.keys(this._values)){const a=this.getValue(r);void 0!==a&&(t[r]=a)}return t}possiblyEvaluate(t,r,a){const l=new Pp(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(t,r,a);return l}}class ws{constructor(t,r,a){this.property=t,this.value=r,this.parameters=a}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,r,a,l){return this.property.evaluate(this.value,this.parameters,t,r,a,l)}}class Pp{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Dt{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,a){const l=f_[this.specification.type];return l?l(t,r,a):t}}class se{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,a,l){return new ws(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(r,null,{},a,l)}:t.expression,r)}interpolate(t,r,a){if("constant"!==t.value.kind||"constant"!==r.value.kind)return t;if(void 0===t.value.value||void 0===r.value.value)return new ws(this,{kind:"constant",value:void 0},t.parameters);const l=f_[this.specification.type];return l?new ws(this,{kind:"constant",value:l(t.value.value,r.value.value,a)},t.parameters):t}evaluate(t,r,a,l,u,d){return"constant"===t.kind?t.value:t.evaluate(r,a,l,u,d)}}class Op{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,l){return!!t.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class Ci{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new Ei(0,{});for(const a in t){const l=t[a];l.specification.overridable&&this.overridableProperties.push(a);const u=this.defaultPropertyValues[a]=new W0(l,void 0),d=this.defaultTransitionablePropertyValues[a]=new S_(l);this.defaultTransitioningPropertyValues[a]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=u.possiblyEvaluate(r)}}}function Jr(n,t){return t?`${n}\x1f${t}`:n}function T_(n){const t=n.indexOf("\x1f");return t>=0?n.slice(0,t):n}Xt(se,"DataDrivenProperty"),Xt(Dt,"DataConstantProperty"),Xt(Op,"ColorRampProperty");const D_="-transition";class Ws extends $i{constructor(t,r,a){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=a,t.slot&&(this.slot=t.slot),r.layout&&(this._unevaluatedLayout=new Ch(r.layout,a),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new Kr(r.paint,a);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pp(r.paint)}}setScope(t){this.scope=t,this.fqid=Jr(this.id,t)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,a={}){if(null!=r&&this._validate(wh,`layers.${this.id}.layout.${t}`,t,r,a))return;if("custom"===this.type&&"visibility"===t)return void(this.visibility=r);const l=this._unevaluatedLayout;l._properties.properties[t]&&(l.setValue(t,r),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return tu(t,D_)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,a={}){if(null!=r&&this._validate(XE,`layers.${this.id}.paint.${t}`,t,r,a))return!1;const l=this._transitionablePaint,u=l._properties.properties;if(tu(t,D_)){const x=t.slice(0,-11);return u[x]&&l.setTransition(x,r||void 0),!1}if(!u[t])return!1;const d=l._values[t],h=d.value.isDataDriven(),p=d.value;l.setValue(t,r),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const m=l._values[t].value,_=m.isDataDriven(),y=tu(t,"pattern")||"line-dasharray"===t;return _||h||y||this._handleOverridablePaintPropertyUpdate(t,p,m)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,r){return null}_handleOverridablePaintPropertyUpdate(t,r,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){return Pt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,r)=>!(void 0===t||"layout"===r&&!Object.keys(t).length||"paint"===r&&!Object.keys(t).length))}_validate(t,r,a,l,u={}){return(!u||!1!==u.validate)&&w_(this,t.call(as,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:J,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof ws&&uu(r.property.specification)&&("source"===r.value.kind||"composite"===r.value.kind)&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=k0(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class JE{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id)}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this.updatedPaintProps.delete(t.fqid)}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const X0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class kp{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _i{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function yn(n,t=1){let r=0,a=0;return{members:n.map(l=>{const u=X0[l.type].BYTES_PER_ELEMENT,d=r=Y0(r,Math.max(t,u)),h=l.components||1;return a=Math.max(a,u),r+=u*h,{name:l.name,type:l.type,components:h,offset:d}}),size:Y0(r,Math.max(a,t)),alignment:t}}function Y0(n,t){return Math.ceil(n/t)*t}class Zo extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=a,t}}Zo.prototype.bytesPerElement=4,Xt(Zo,"StructArrayLayout2i4");class I_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){const u=3*t;return this.int16[u+0]=r,this.int16[u+1]=a,this.int16[u+2]=l,t}}I_.prototype.bytesPerElement=6,Xt(I_,"StructArrayLayout3i6");class cd extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){const d=4*t;return this.int16[d+0]=r,this.int16[d+1]=a,this.int16[d+2]=l,this.int16[d+3]=u,t}}cd.prototype.bytesPerElement=8,Xt(cd,"StructArrayLayout4i8");class Ro extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,a,l,u)}emplace(t,r,a,l,u,d){const h=5*t;return this.int16[h+0]=r,this.int16[h+1]=a,this.int16[h+2]=l,this.int16[h+3]=u,this.int16[h+4]=d,t}}Ro.prototype.bytesPerElement=10,Xt(Ro,"StructArrayLayout5i10");class _c extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,l,u,d,h)}emplace(t,r,a,l,u,d,h,p){const m=6*t,_=12*t,y=3*t;return this.int16[m+0]=r,this.int16[m+1]=a,this.uint8[_+4]=l,this.uint8[_+5]=u,this.uint8[_+6]=d,this.uint8[_+7]=h,this.float32[y+2]=p,t}}_c.prototype.bytesPerElement=12,Xt(_c,"StructArrayLayout2i4ub1f12");class Mi extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){const d=4*t;return this.float32[d+0]=r,this.float32[d+1]=a,this.float32[d+2]=l,this.float32[d+3]=u,t}}Mi.prototype.bytesPerElement=16,Xt(Mi,"StructArrayLayout4f16");class Pl extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,a,l,u)}emplace(t,r,a,l,u,d){const h=6*t,p=3*t;return this.uint16[h+0]=r,this.uint16[h+1]=a,this.uint16[h+2]=l,this.uint16[h+3]=u,this.float32[p+2]=d,t}}Pl.prototype.bytesPerElement=12,Xt(Pl,"StructArrayLayout4ui1f12");class A_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){const d=4*t;return this.uint16[d+0]=r,this.uint16[d+1]=a,this.uint16[d+2]=l,this.uint16[d+3]=u,t}}A_.prototype.bytesPerElement=8,Xt(A_,"StructArrayLayout4ui8");class Fp extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,a,l,u,d)}emplace(t,r,a,l,u,d,h){const p=6*t;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=l,this.int16[p+3]=u,this.int16[p+4]=d,this.int16[p+5]=h,t}}Fp.prototype.bytesPerElement=12,Xt(Fp,"StructArrayLayout6i12");class K0 extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h,p,m,_,y,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,r,a,l,u,d,h,p,m,_,y,x)}emplace(t,r,a,l,u,d,h,p,m,_,y,x,b){const E=12*t;return this.int16[E+0]=r,this.int16[E+1]=a,this.int16[E+2]=l,this.int16[E+3]=u,this.uint16[E+4]=d,this.uint16[E+5]=h,this.uint16[E+6]=p,this.uint16[E+7]=m,this.int16[E+8]=_,this.int16[E+9]=y,this.int16[E+10]=x,this.int16[E+11]=b,t}}K0.prototype.bytesPerElement=24,Xt(K0,"StructArrayLayout4i4ui4i24");class R_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,a,l,u,d)}emplace(t,r,a,l,u,d,h){const p=10*t,m=5*t;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=l,this.float32[m+2]=u,this.float32[m+3]=d,this.float32[m+4]=h,t}}R_.prototype.bytesPerElement=20,Xt(R_,"StructArrayLayout3i3f20");class P_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}P_.prototype.bytesPerElement=4,Xt(P_,"StructArrayLayout1ul4");class $a extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=a,t}}$a.prototype.bytesPerElement=4,Xt($a,"StructArrayLayout2ui4");class Ol extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h,p,m,_,y,x,b){const E=this.length;return this.resize(E+1),this.emplace(E,t,r,a,l,u,d,h,p,m,_,y,x,b)}emplace(t,r,a,l,u,d,h,p,m,_,y,x,b,E){const C=20*t,S=10*t;return this.int16[C+0]=r,this.int16[C+1]=a,this.int16[C+2]=l,this.int16[C+3]=u,this.int16[C+4]=d,this.float32[S+3]=h,this.float32[S+4]=p,this.float32[S+5]=m,this.float32[S+6]=_,this.int16[C+14]=y,this.uint32[S+8]=x,this.uint16[C+18]=b,this.uint16[C+19]=E,t}}Ol.prototype.bytesPerElement=40,Xt(Ol,"StructArrayLayout5i4f1i1ul2ui40");class O_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,l,u,d,h)}emplace(t,r,a,l,u,d,h,p){const m=8*t;return this.int16[m+0]=r,this.int16[m+1]=a,this.int16[m+2]=l,this.int16[m+4]=u,this.int16[m+5]=d,this.int16[m+6]=h,this.int16[m+7]=p,t}}O_.prototype.bytesPerElement=16,Xt(O_,"StructArrayLayout3i2i2i16");class Mh extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,a,l,u)}emplace(t,r,a,l,u,d){const h=4*t,p=8*t;return this.float32[h+0]=r,this.float32[h+1]=a,this.float32[h+2]=l,this.int16[p+6]=u,this.int16[p+7]=d,t}}Mh.prototype.bytesPerElement=16,Xt(Mh,"StructArrayLayout2f1f2i16");class Sh extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){const d=12*t,h=3*t;return this.uint8[d+0]=r,this.uint8[d+1]=a,this.float32[h+1]=l,this.float32[h+2]=u,t}}Sh.prototype.bytesPerElement=12,Xt(Sh,"StructArrayLayout2ub2f12");class Ga extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){const u=3*t;return this.float32[u+0]=r,this.float32[u+1]=a,this.float32[u+2]=l,t}}Ga.prototype.bytesPerElement=12,Xt(Ga,"StructArrayLayout3f12");class er extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){const u=3*t;return this.uint16[u+0]=r,this.uint16[u+1]=a,this.uint16[u+2]=l,t}}er.prototype.bytesPerElement=6,Xt(er,"StructArrayLayout3ui6");class k_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D,R,P,I){const O=this.length;return this.resize(O+1),this.emplace(O,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D,R,P,I)}emplace(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D,R,P,I,O){const F=30*t,L=15*t,N=60*t;return this.int16[F+0]=r,this.int16[F+1]=a,this.int16[F+2]=l,this.float32[L+2]=u,this.float32[L+3]=d,this.uint16[F+8]=h,this.uint16[F+9]=p,this.uint32[L+5]=m,this.uint32[L+6]=_,this.uint32[L+7]=y,this.uint16[F+16]=x,this.uint16[F+17]=b,this.uint16[F+18]=E,this.float32[L+10]=C,this.float32[L+11]=S,this.uint8[N+48]=M,this.uint8[N+49]=D,this.uint8[N+50]=R,this.uint32[L+13]=P,this.int16[F+28]=I,this.uint8[N+58]=O,t}}k_.prototype.bytesPerElement=60,Xt(k_,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class F_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D,R,P,I,O,F,L,N,z,U,V,G,j,Z,et){const it=this.length;return this.resize(it+1),this.emplace(it,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D,R,P,I,O,F,L,N,z,U,V,G,j,Z,et)}emplace(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D,R,P,I,O,F,L,N,z,U,V,G,j,Z,et,it){const X=20*t,Y=40*t,ot=80*t;return this.float32[X+0]=r,this.float32[X+1]=a,this.int16[Y+4]=l,this.int16[Y+5]=u,this.int16[Y+6]=d,this.int16[Y+7]=h,this.int16[Y+8]=p,this.int16[Y+9]=m,this.int16[Y+10]=_,this.int16[Y+11]=y,this.int16[Y+12]=x,this.uint16[Y+13]=b,this.uint16[Y+14]=E,this.uint16[Y+15]=C,this.uint16[Y+16]=S,this.uint16[Y+17]=M,this.uint16[Y+18]=D,this.uint16[Y+19]=R,this.uint16[Y+20]=P,this.uint16[Y+21]=I,this.uint16[Y+22]=O,this.uint16[Y+23]=F,this.uint16[Y+24]=L,this.uint16[Y+25]=N,this.uint16[Y+26]=z,this.uint16[Y+27]=U,this.uint32[X+14]=V,this.float32[X+15]=G,this.float32[X+16]=j,this.float32[X+17]=Z,this.float32[X+18]=et,this.uint8[ot+76]=it,t}}F_.prototype.bytesPerElement=80,Xt(F_,"StructArrayLayout2f9i15ui1ul4f1ub80");class Lp extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Lp.prototype.bytesPerElement=4,Xt(Lp,"StructArrayLayout1f4");class ma extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,a,l,u)}emplace(t,r,a,l,u,d){const h=5*t;return this.float32[h+0]=r,this.float32[h+1]=a,this.float32[h+2]=l,this.float32[h+3]=u,this.float32[h+4]=d,t}}ma.prototype.bytesPerElement=20,Xt(ma,"StructArrayLayout5f20");class ud extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,l,u,d,h)}emplace(t,r,a,l,u,d,h,p){const m=7*t;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=l,this.float32[m+3]=u,this.float32[m+4]=d,this.float32[m+5]=h,this.float32[m+6]=p,t}}ud.prototype.bytesPerElement=28,Xt(ud,"StructArrayLayout7f28");class J0 extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){const d=6*t;return this.uint32[3*t+0]=r,this.uint16[d+2]=a,this.uint16[d+3]=l,this.uint16[d+4]=u,t}}J0.prototype.bytesPerElement=12,Xt(J0,"StructArrayLayout1ul3ui12");class L_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}L_.prototype.bytesPerElement=2,Xt(L_,"StructArrayLayout1ui2");class dd extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=a,t}}dd.prototype.bytesPerElement=8,Xt(dd,"StructArrayLayout2f8");class QE extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S)}emplace(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M){const D=16*t;return this.float32[D+0]=r,this.float32[D+1]=a,this.float32[D+2]=l,this.float32[D+3]=u,this.float32[D+4]=d,this.float32[D+5]=h,this.float32[D+6]=p,this.float32[D+7]=m,this.float32[D+8]=_,this.float32[D+9]=y,this.float32[D+10]=x,this.float32[D+11]=b,this.float32[D+12]=E,this.float32[D+13]=C,this.float32[D+14]=S,this.float32[D+15]=M,t}}QE.prototype.bytesPerElement=64,Xt(QE,"StructArrayLayout16f64");class N_ extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,l,u,d,h)}emplace(t,r,a,l,u,d,h,p){const m=10*t,_=5*t;return this.uint16[m+0]=r,this.uint16[m+1]=a,this.uint16[m+2]=l,this.uint16[m+3]=u,this.float32[_+2]=d,this.float32[_+3]=h,this.float32[_+4]=p,t}}N_.prototype.bytesPerElement=20,Xt(N_,"StructArrayLayout4ui3f20");class Q0 extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint8[1*t+0]=r,t}}Q0.prototype.bytesPerElement=1,Xt(Q0,"StructArrayLayout1ub1");class _A extends kp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_A.prototype.size=40;class tC extends Ol{get(t){return new _A(this,t)}}Xt(tC,"CollisionBoxArray");class z_ extends kp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}z_.prototype.size=60;class Th extends k_{get(t){return new z_(this,t)}}Xt(Th,"PlacedSymbolArray");class eC extends kp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}eC.prototype.size=80;class Dh extends F_{get(t){return new eC(this,t)}}Xt(Dh,"SymbolInstanceArray");class B_ extends Lp{getoffsetX(t){return this.float32[1*t+0]}}Xt(B_,"GlyphOffsetArray");class Np extends Zo{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Xt(Np,"SymbolLineVertexArray");class yA extends kp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}yA.prototype.size=12;class tx extends J0{get(t){return new yA(this,t)}}Xt(tx,"FeatureIndexArray");class ex extends $a{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Xt(ex,"FillExtrusionCentroidArray");const vA=yn([{name:"a_pos",components:2,type:"Int16"}],4),kl=yn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Bn{constructor(t=[]){this.segments=t}_prepareSegment(t,r,a,l){let u=this.segments[this.segments.length-1];return t>Bn.MAX_VERTEX_ARRAY_LENGTH&&tt(`Max vertices per segment is ${Bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!u||u.vertexLength+t>Bn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:r,primitiveOffset:a,vertexLength:0,primitiveLength:0},void 0!==l&&(u.sortKey=l),this.segments.push(u)),u}prepareSegment(t,r,a,l){return this._prepareSegment(t,r.length,a.length,l)}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,a,l){return new Bn([{vertexOffset:t,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function zp(n,t){return 256*(n=Jt(Math.floor(n),0,255))+Jt(Math.floor(t),0,255)}Bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt(Bn,"SegmentVector");const nx=yn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),nC=yn([{name:"a_dash",components:4,type:"Uint16"}]);var hd={exports:{}},xA={exports:function(t,r){var a,l,u,d,h,p,m,_;for(l=t.length-(a=3&t.length),u=r,h=3432918353,p=461845907,_=0;_<l;)m=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24,++_,u=27492+(65535&(d=5*(65535&(u=(u^=m=(65535&(m=(m=(65535&m)*h+(((m>>>16)*h&65535)<<16)&4294967295)<<15|m>>>17))*p+(((m>>>16)*p&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(m=0,a){case 3:m^=(255&t.charCodeAt(_+2))<<16;case 2:m^=(255&t.charCodeAt(_+1))<<8;case 1:u^=m=(65535&(m=(m=(65535&(m^=255&t.charCodeAt(_)))*h+(((m>>>16)*h&65535)<<16)&4294967295)<<15|m>>>17))*p+(((m>>>16)*p&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}.exports,ix={exports:{}};ix.exports=function(t,r){for(var a,l=t.length,u=r^l,d=0;l>=4;)a=1540483477*(65535&(a=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(a>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),l-=4,++d;switch(l){case 3:u^=(255&t.charCodeAt(d+2))<<16;case 2:u^=(255&t.charCodeAt(d+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(d)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var rx=xA,iC=ix.exports;hd.exports=rx,hd.exports.murmur3=rx,hd.exports.murmur2=iC;var j_=ms(hd.exports);class Bp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,r,a,l){this.ids.push(Vp(t)),this.positions.push(r,a,l)}eachPosition(t,r){const a=Vp(t);let l=0,u=this.ids.length-1;for(;l<u;){const d=l+u>>1;this.ids[d]>=a?u=d:l=d+1}for(;this.ids[l]===a;)r(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(t,r){const a=new Float64Array(t.ids),l=new Uint32Array(t.positions);return yc(a,l,0,a.length-1),r&&(r.add(a.buffer),r.add(l.buffer)),{ids:a,positions:l}}static deserialize(t){const r=new Bp;let a;r.ids=t.ids,r.positions=t.positions;for(const l of r.ids)l!==a&&r.uniqueIds.push(l),a=l;return r.indexed=!0,r}}function Vp(n){const t=+n;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:j_(String(n))}function yc(n,t,r,a){for(;r<a;){const l=n[r+a>>1];let u=r-1,d=a+1;for(;;){do{u++}while(n[u]<l);do{d--}while(n[d]>l);if(u>=d)break;U_(n,u,d),U_(t,3*u,3*d),U_(t,3*u+1,3*d+1),U_(t,3*u+2,3*d+2)}d-r<a-d?(yc(n,t,r,d),r=d+1):(yc(n,t,d+1,a),a=d)}}function U_(n,t,r){const a=n[t];n[t]=n[r],n[r]=a}Xt(Bp,"FeaturePositionMap");class Fl{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}}class $e extends Fl{constructor(t){super(t),this.current=0}set(t,r,a){this.fetchUniformLocation(t,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Et extends Fl{constructor(t){super(t),this.current=0}set(t,r,a){this.fetchUniformLocation(t,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ze extends Fl{constructor(t){super(t),this.current=[0,0]}set(t,r,a){this.fetchUniformLocation(t,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class me extends Fl{constructor(t){super(t),this.current=[0,0,0]}set(t,r,a){this.fetchUniformLocation(t,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Es extends Fl{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,a){this.fetchUniformLocation(t,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class xr extends Fl{constructor(t){super(t),this.current=Ne.transparent}set(t,r,a){this.fetchUniformLocation(t,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const ox=new Float32Array(16);class De extends Fl{constructor(t){super(t),this.current=ox}set(t,r,a){if(this.fetchUniformLocation(t,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let l=1;l<16;l++)if(a[l]!==this.current[l]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const rC=new Float32Array(9);class fd extends Fl{constructor(t){super(t),this.current=rC}set(t,r,a){if(this.fetchUniformLocation(t,r))for(let l=0;l<9;l++)if(a[l]!==this.current[l]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}const Ih=new Float32Array(4);class hu extends Fl{constructor(t){super(t),this.current=Ih}set(t,r,a){if(this.fetchUniformLocation(t,r))for(let l=0;l<4;l++)if(a[l]!==this.current[l]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}function fu(n){return[zp(255*n.r,255*n.g),zp(255*n.b,255*n.a)]}class Ah{constructor(t,r,a){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(t,r,a,l,u){r.set(t,u,l.constantOr(this.value))}getBinding(t,r){return"color"===this.type?new xr(t):new Et(t)}}class pu{constructor(t,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,r,a,l,u){const d="u_pattern"===u||"u_dash"===u?this.pattern:"u_pixel_ratio"===u?this.pixelRatio:null;d&&r.set(t,u,d)}getBinding(t,r){return"u_pattern"===r||"u_dash"===r?new Es(t):new Et(t)}}class Cs{constructor(t,r,a,l){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:"color"===a?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,a,l,u,d,h){const p=this.paintVertexArray.length,m=this.expression.evaluate(new Ei(0,{brightness:d}),r,{},u,l,h);this.paintVertexArray.resize(t),this._setPaintValue(p,t,m)}updatePaintArray(t,r,a,l,u,d,h){const p=this.expression.evaluate({zoom:0,brightness:h},a,l,void 0,u);this._setPaintValue(t,r,p)}_setPaintValue(t,r,a){if("color"===this.type){const l=fu(a);for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ll{constructor(t,r,a,l,u,d){this.expression=t,this.uniformNames=r.map(h=>`u_${h}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:"color"===a?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,a,l,u,d,h){const p=this.expression.evaluate(new Ei(this.zoom,{brightness:d}),r,{},u,l,h),m=this.expression.evaluate(new Ei(this.zoom+1,{brightness:d}),r,{},u,l,h),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,p,m)}updatePaintArray(t,r,a,l,u,d,h){const p=this.expression.evaluate({zoom:this.zoom,brightness:h},a,l,void 0,u),m=this.expression.evaluate({zoom:this.zoom+1,brightness:h},a,l,void 0,u);this._setPaintValue(t,r,p,m)}_setPaintValue(t,r,a,l){if("color"===this.type){const u=fu(a),d=fu(l);for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,u[0],u[1],d[0],d[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,a,l,u){const d=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=Jt(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);r.set(t,u,h)}getBinding(t,r){return new Et(t)}}class mu{constructor(t,r,a,l,u){this.expression=t,this.layerId=u,this.paintVertexAttributes=("array"===a?nC:nx).members;for(let d=0;d<r.length;++d);this.paintVertexArray=new l}populatePaintArray(t,r,a){const l=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(t,r,a,l,u,d,h){this._setPaintValues(t,r,a.patterns&&a.patterns[this.layerId],d)}_setPaintValues(t,r,a,l){if(!l||!a)return;const u=l[a];if(!u)return;const{tl:d,br:h,pixelRatio:p}=u;for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,d[0],d[1],h[0],h[1],p)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rh{constructor(t,r,a=(()=>!0)){this.binders={},this._buffers=[];const l=[];for(const u in t.paint._values){const d=t.paint.get(u);if(!a(u)||!(d instanceof ws&&uu(d.property.specification)))continue;const h=MF(u,t.type),p=d.value,m=d.property.specification.type,_=!!d.property.useIntegerZoom,y="line-dasharray"===u||u.endsWith("pattern"),x="line-dasharray"===u&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==p.kind||x)if("source"===p.kind||x||y){const b=md(u,m,"source");this.binders[u]=y?new mu(p,h,m,b,t.id):new Cs(p,h,m,b),l.push(`/a_${u}`)}else{const b=md(u,m,"composite");this.binders[u]=new Ll(p,h,m,_,r,b),l.push(`/z_${u}`)}else this.binders[u]=y?new pu(p.value,h):new Ah(p.value,h,m),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Cs||r instanceof Ll?r.maxValue:0}populatePaintArrays(t,r,a,l,u,d,h){for(const p in this.binders){const m=this.binders[p];(m instanceof Cs||m instanceof Ll||m instanceof mu)&&m.populatePaintArray(t,r,a,l,u,d,h)}}setConstantPatternPositions(t){for(const r in this.binders){const a=this.binders[r];a instanceof pu&&a.setConstantPatternPositions(t)}}updatePaintArrays(t,r,a,l,u,d,h,p){let m=!1;const _=Object.keys(t),y=0!==_.length,x=y?_:r.uniqueIds;for(const b in this.binders){const E=this.binders[b];if((E instanceof Cs||E instanceof Ll||E instanceof mu)&&(!0===E.expression.isStateDependent||!1===E.expression.isLightConstant)){const C=u.paint.get(b);E.expression=C.value;for(const S of x){const M=t[S.toString()];r.eachPosition(S,(D,R,P)=>{const I=l.feature(D);E.updatePaintArray(R,P,I,M,d,h,p)})}if(!y)for(const S of a.uniqueIds){const M=t[S.toString()];a.eachPosition(S,(D,R,P)=>{const I=l.feature(D);E.updatePaintArray(R,P,I,M,d,h,p)})}m=!0}}return m}defines(){const t=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Ah||a instanceof pu)&&t.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Cs||a instanceof Ll||a instanceof mu)for(let l=0;l<a.paintVertexAttributes.length;l++)t.push(a.paintVertexAttributes[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Ah||a instanceof pu||a instanceof Ll)for(const l of a.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof Ah||l instanceof pu||l instanceof Ll)for(const u of l.uniformNames)r.push({name:u,property:a,binding:l.getBinding(t,u)})}return r}setUniforms(t,r,a,l,u){for(const{name:d,property:h,binding:p}of a)this.binders[h].setUniform(t,p,u,l.get(h),d)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Cs||r instanceof Ll||r instanceof mu)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(t){for(const r in this.binders){const a=this.binders[r];(a instanceof Cs||a instanceof Ll||a instanceof mu)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Cs||r instanceof Ll||r instanceof mu)&&r.destroy()}}}class pd{constructor(t,r,a=(()=>!0)){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new Rh(l,r,a);this.needsUpload=!1,this._featureMap=new Bp,this._featureMapWithoutIds=new Bp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,r,a,l,u,d,h,p){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,r,l,u,d,h,p);void 0!==r.id?this._featureMap.add(r.id,a,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,a,l,u,d){for(const h of a)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,r,h,l,u,d||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const CF={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function MF(n,t){return CF[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}const SF={"line-pattern":{source:Pl,composite:Pl},"fill-pattern":{source:Pl,composite:Pl},"fill-extrusion-pattern":{source:Pl,composite:Pl},"line-dasharray":{source:A_,composite:A_}},TF={color:{source:dd,composite:Mi},number:{source:Lp,composite:dd}};function md(n,t,r){const a=SF[n];return a&&a[r]||TF[t][r]}Xt(Ah,"ConstantBinder"),Xt(pu,"PatternConstantBinder"),Xt(Cs,"SourceExpressionBinder"),Xt(mu,"PatternCompositeBinder"),Xt(Ll,"CompositeExpressionBinder"),Xt(Rh,"ProgramConfiguration",{omit:["_buffers"]}),Xt(pd,"ProgramConfigurationSet");class Zs{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof we?new we(t.lng,t.lat):we.convert(t),this}setSouthWest(t){return this._sw=t instanceof we?new we(t.lng,t.lat):we.convert(t),this}extend(t){const r=this._sw,a=this._ne;let l,u;if(t instanceof we)l=t,u=t;else{if(!(t instanceof Zs))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Zs.convert(t)):this.extend(we.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(we.convert(t)):this;if(l=t._sw,u=t._ne,!l||!u)return this}return r||a?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),a.lng=Math.max(u.lng,a.lng),a.lat=Math.max(u.lat,a.lat)):(this._sw=new we(l.lng,l.lat),this._ne=new we(u.lng,u.lat)),this}getCenter(){return new we((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new we(this.getWest(),this.getNorth())}getSouthEast(){return new we(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:a}=we.convert(t);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(t){return!t||t instanceof Zs?t:new Zs(t)}}var kr={},Fn={};Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.setMatrixArrayType=function(n){Fn.ARRAY_TYPE=Ph=n},Fn.toRadian=function(n){return n*ga},Fn.equals=function(n,t){return Math.abs(n-t)<=oC*Math.max(1,Math.abs(n),Math.abs(t))},Fn.RANDOM=Fn.ARRAY_TYPE=Fn.EPSILON=void 0;var oC=1e-6;Fn.EPSILON=oC;var Ph=typeof Float32Array<"u"?Float32Array:Array;Fn.ARRAY_TYPE=Ph;var bA=Math.random;Fn.RANDOM=bA;var ga=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Jn={};function H_(n){return(H_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.create=function(){var n=new qa.ARRAY_TYPE(4);return qa.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},Jn.clone=function(n){var t=new qa.ARRAY_TYPE(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},Jn.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},Jn.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},Jn.fromValues=function(n,t,r,a){var l=new qa.ARRAY_TYPE(4);return l[0]=n,l[1]=t,l[2]=r,l[3]=a,l},Jn.set=function(n,t,r,a,l){return n[0]=t,n[1]=r,n[2]=a,n[3]=l,n},Jn.transpose=function(n,t){if(n===t){var r=t[1];n[1]=t[2],n[2]=r}else n[0]=t[0],n[1]=t[2],n[2]=t[1],n[3]=t[3];return n},Jn.invert=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=r*u-l*a;return d?(n[0]=u*(d=1/d),n[1]=-a*d,n[2]=-l*d,n[3]=r*d,n):null},Jn.adjoint=function(n,t){var r=t[0];return n[0]=t[3],n[1]=-t[1],n[2]=-t[2],n[3]=r,n},Jn.determinant=function(n){return n[0]*n[3]-n[2]*n[1]},Jn.multiply=sC,Jn.rotate=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=Math.sin(r),p=Math.cos(r);return n[0]=a*p+u*h,n[1]=l*p+d*h,n[2]=a*-h+u*p,n[3]=l*-h+d*p,n},Jn.scale=function(n,t,r){var a=t[1],l=t[2],u=t[3],d=r[0],h=r[1];return n[0]=t[0]*d,n[1]=a*d,n[2]=l*h,n[3]=u*h,n},Jn.fromRotation=function(n,t){var r=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=r,n[2]=-r,n[3]=a,n},Jn.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=t[1],n},Jn.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},Jn.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},Jn.LDU=function(n,t,r,a){return n[2]=a[2]/a[0],r[0]=a[0],r[1]=a[1],r[3]=a[3]-n[2]*r[1],[n,t,r]},Jn.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n},Jn.subtract=wA,Jn.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},Jn.equals=function(n,t){var r=n[0],a=n[1],l=n[2],u=n[3],d=t[0],h=t[1],p=t[2],m=t[3];return Math.abs(r-d)<=qa.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-h)<=qa.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(l-p)<=qa.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(u-m)<=qa.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))},Jn.multiplyScalar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},Jn.multiplyScalarAndAdd=function(n,t,r,a){return n[0]=t[0]+r[0]*a,n[1]=t[1]+r[1]*a,n[2]=t[2]+r[2]*a,n[3]=t[3]+r[3]*a,n},Jn.sub=Jn.mul=void 0;var qa=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==H_(n)&&"function"!=typeof n)return{default:n};var r=Oh(void 0);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}(Fn);function Oh(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Oh=function(a){return a?r:t})(n)}function sC(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=r[0],p=r[1],m=r[2],_=r[3];return n[0]=a*h+u*p,n[1]=l*h+d*p,n[2]=a*m+u*_,n[3]=l*m+d*_,n}function wA(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n}Jn.mul=sC,Jn.sub=wA;var Ri={};function aC(n){return(aC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.create=function(){var n=new Tr.ARRAY_TYPE(6);return Tr.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n},Ri.clone=function(n){var t=new Tr.ARRAY_TYPE(6);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},Ri.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},Ri.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},Ri.fromValues=function(n,t,r,a,l,u){var d=new Tr.ARRAY_TYPE(6);return d[0]=n,d[1]=t,d[2]=r,d[3]=a,d[4]=l,d[5]=u,d},Ri.set=function(n,t,r,a,l,u,d){return n[0]=t,n[1]=r,n[2]=a,n[3]=l,n[4]=u,n[5]=d,n},Ri.invert=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=t[4],h=t[5],p=r*u-a*l;return p?(n[0]=u*(p=1/p),n[1]=-a*p,n[2]=-l*p,n[3]=r*p,n[4]=(l*h-u*d)*p,n[5]=(a*d-r*h)*p,n):null},Ri.determinant=function(n){return n[0]*n[3]-n[1]*n[2]},Ri.multiply=gd,Ri.rotate=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],m=Math.sin(r),_=Math.cos(r);return n[0]=a*_+u*m,n[1]=l*_+d*m,n[2]=a*-m+u*_,n[3]=l*-m+d*_,n[4]=h,n[5]=p,n},Ri.scale=function(n,t,r){var a=t[1],l=t[2],u=t[3],d=t[4],h=t[5],p=r[0],m=r[1];return n[0]=t[0]*p,n[1]=a*p,n[2]=l*m,n[3]=u*m,n[4]=d,n[5]=h,n},Ri.translate=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],m=r[0],_=r[1];return n[0]=a,n[1]=l,n[2]=u,n[3]=d,n[4]=a*m+u*_+h,n[5]=l*m+d*_+p,n},Ri.fromRotation=function(n,t){var r=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=r,n[2]=-r,n[3]=a,n[4]=0,n[5]=0,n},Ri.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=t[1],n[4]=0,n[5]=0,n},Ri.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=t[0],n[5]=t[1],n},Ri.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"},Ri.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],1)},Ri.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n[4]=t[4]+r[4],n[5]=t[5]+r[5],n},Ri.subtract=EA,Ri.multiplyScalar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*r,n[5]=t[5]*r,n},Ri.multiplyScalarAndAdd=function(n,t,r,a){return n[0]=t[0]+r[0]*a,n[1]=t[1]+r[1]*a,n[2]=t[2]+r[2]*a,n[3]=t[3]+r[3]*a,n[4]=t[4]+r[4]*a,n[5]=t[5]+r[5]*a,n},Ri.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]},Ri.equals=function(n,t){var r=n[0],a=n[1],l=n[2],u=n[3],d=n[4],h=n[5],p=t[0],m=t[1],_=t[2],y=t[3],x=t[4],b=t[5];return Math.abs(r-p)<=Tr.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(a-m)<=Tr.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-_)<=Tr.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-y)<=Tr.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-x)<=Tr.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(h-b)<=Tr.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))},Ri.sub=Ri.mul=void 0;var Tr=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==aC(n)&&"function"!=typeof n)return{default:n};var r=$_(void 0);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}(Fn);function $_(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return($_=function(a){return a?r:t})(n)}function gd(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],m=r[0],_=r[1],y=r[2],x=r[3],b=r[4],E=r[5];return n[0]=a*m+u*_,n[1]=l*m+d*_,n[2]=a*y+u*x,n[3]=l*y+d*x,n[4]=a*b+u*E+h,n[5]=l*b+d*E+p,n}function EA(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n[4]=t[4]-r[4],n[5]=t[5]-r[5],n}Ri.mul=gd,Ri.sub=EA;var Vn={};function sx(n){return(sx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.create=function(){var n=new Xs.ARRAY_TYPE(9);return Xs.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},Vn.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},Vn.clone=function(n){var t=new Xs.ARRAY_TYPE(9);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},Vn.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},Vn.fromValues=function(n,t,r,a,l,u,d,h,p){var m=new Xs.ARRAY_TYPE(9);return m[0]=n,m[1]=t,m[2]=r,m[3]=a,m[4]=l,m[5]=u,m[6]=d,m[7]=h,m[8]=p,m},Vn.set=function(n,t,r,a,l,u,d,h,p,m){return n[0]=t,n[1]=r,n[2]=a,n[3]=l,n[4]=u,n[5]=d,n[6]=h,n[7]=p,n[8]=m,n},Vn.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},Vn.transpose=function(n,t){if(n===t){var r=t[1],a=t[2],l=t[5];n[1]=t[3],n[2]=t[6],n[3]=r,n[5]=t[7],n[6]=a,n[7]=l}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n},Vn.invert=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8],y=_*d-h*m,x=-_*u+h*p,b=m*u-d*p,E=r*y+a*x+l*b;return E?(n[0]=y*(E=1/E),n[1]=(-_*a+l*m)*E,n[2]=(h*a-l*d)*E,n[3]=x*E,n[4]=(_*r-l*p)*E,n[5]=(-h*r+l*u)*E,n[6]=b*E,n[7]=(-m*r+a*p)*E,n[8]=(d*r-a*u)*E,n):null},Vn.adjoint=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8];return n[0]=d*_-h*m,n[1]=l*m-a*_,n[2]=a*h-l*d,n[3]=h*p-u*_,n[4]=r*_-l*p,n[5]=l*u-r*h,n[6]=u*m-d*p,n[7]=a*p-r*m,n[8]=r*d-a*u,n},Vn.determinant=function(n){var t=n[3],r=n[4],a=n[5],l=n[6],u=n[7],d=n[8];return n[0]*(d*r-a*u)+n[1]*(-d*t+a*l)+n[2]*(u*t-r*l)},Vn.multiply=cC,Vn.translate=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],x=r[0],b=r[1];return n[0]=a,n[1]=l,n[2]=u,n[3]=d,n[4]=h,n[5]=p,n[6]=x*a+b*d+m,n[7]=x*l+b*h+_,n[8]=x*u+b*p+y,n},Vn.rotate=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],x=Math.sin(r),b=Math.cos(r);return n[0]=b*a+x*d,n[1]=b*l+x*h,n[2]=b*u+x*p,n[3]=b*d-x*a,n[4]=b*h-x*l,n[5]=b*p-x*u,n[6]=m,n[7]=_,n[8]=y,n},Vn.scale=function(n,t,r){var a=r[0],l=r[1];return n[0]=a*t[0],n[1]=a*t[1],n[2]=a*t[2],n[3]=l*t[3],n[4]=l*t[4],n[5]=l*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},Vn.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=t[0],n[7]=t[1],n[8]=1,n},Vn.fromRotation=function(n,t){var r=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=r,n[2]=0,n[3]=-r,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},Vn.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=t[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},Vn.fromMat2d=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=0,n[3]=t[2],n[4]=t[3],n[5]=0,n[6]=t[4],n[7]=t[5],n[8]=1,n},Vn.fromQuat=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=r+r,h=a+a,p=l+l,m=r*d,_=a*d,y=a*h,x=l*d,b=l*h,E=l*p,C=u*d,S=u*h,M=u*p;return n[0]=1-y-E,n[3]=_-M,n[6]=x+S,n[1]=_+M,n[4]=1-m-E,n[7]=b-C,n[2]=x-S,n[5]=b+C,n[8]=1-m-y,n},Vn.normalFromMat4=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8],y=t[9],x=t[10],b=t[11],E=t[12],C=t[13],S=t[14],M=t[15],D=r*h-a*d,R=r*p-l*d,P=r*m-u*d,I=a*p-l*h,O=a*m-u*h,F=l*m-u*p,L=_*C-y*E,N=_*S-x*E,z=_*M-b*E,U=y*S-x*C,V=y*M-b*C,G=x*M-b*S,j=D*G-R*V+P*U+I*z-O*N+F*L;return j?(n[0]=(h*G-p*V+m*U)*(j=1/j),n[1]=(p*z-d*G-m*N)*j,n[2]=(d*V-h*z+m*L)*j,n[3]=(l*V-a*G-u*U)*j,n[4]=(r*G-l*z+u*N)*j,n[5]=(a*z-r*V-u*L)*j,n[6]=(C*F-S*O+M*I)*j,n[7]=(S*P-E*F-M*R)*j,n[8]=(E*O-C*P+M*D)*j,n):null},Vn.projection=function(n,t,r){return n[0]=2/t,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/r,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n},Vn.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"},Vn.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},Vn.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n[4]=t[4]+r[4],n[5]=t[5]+r[5],n[6]=t[6]+r[6],n[7]=t[7]+r[7],n[8]=t[8]+r[8],n},Vn.subtract=uC,Vn.multiplyScalar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*r,n},Vn.multiplyScalarAndAdd=function(n,t,r,a){return n[0]=t[0]+r[0]*a,n[1]=t[1]+r[1]*a,n[2]=t[2]+r[2]*a,n[3]=t[3]+r[3]*a,n[4]=t[4]+r[4]*a,n[5]=t[5]+r[5]*a,n[6]=t[6]+r[6]*a,n[7]=t[7]+r[7]*a,n[8]=t[8]+r[8]*a,n},Vn.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]},Vn.equals=function(n,t){var r=n[0],a=n[1],l=n[2],u=n[3],d=n[4],h=n[5],p=n[6],m=n[7],_=n[8],y=t[0],x=t[1],b=t[2],E=t[3],C=t[4],S=t[5],M=t[6],D=t[7],R=t[8];return Math.abs(r-y)<=Xs.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(a-x)<=Xs.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-b)<=Xs.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-E)<=Xs.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-C)<=Xs.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(h-S)<=Xs.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(p-M)<=Xs.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(m-D)<=Xs.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(_-R)<=Xs.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},Vn.sub=Vn.mul=void 0;var Xs=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==sx(n)&&"function"!=typeof n)return{default:n};var r=lC(void 0);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}(Fn);function lC(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(lC=function(a){return a?r:t})(n)}function cC(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],x=r[0],b=r[1],E=r[2],C=r[3],S=r[4],M=r[5],D=r[6],R=r[7],P=r[8];return n[0]=x*a+b*d+E*m,n[1]=x*l+b*h+E*_,n[2]=x*u+b*p+E*y,n[3]=C*a+S*d+M*m,n[4]=C*l+S*h+M*_,n[5]=C*u+S*p+M*y,n[6]=D*a+R*d+P*m,n[7]=D*l+R*h+P*_,n[8]=D*u+R*p+P*y,n}function uC(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n[4]=t[4]-r[4],n[5]=t[5]-r[5],n[6]=t[6]-r[6],n[7]=t[7]-r[7],n[8]=t[8]-r[8],n}Vn.mul=cC,Vn.sub=uC;var ke={};function jp(n){return(jp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(ke,"__esModule",{value:!0}),ke.create=function(){var n=new Si.ARRAY_TYPE(16);return Si.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},ke.clone=function(n){var t=new Si.ARRAY_TYPE(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},ke.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},ke.fromValues=function(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C){var S=new Si.ARRAY_TYPE(16);return S[0]=n,S[1]=t,S[2]=r,S[3]=a,S[4]=l,S[5]=u,S[6]=d,S[7]=h,S[8]=p,S[9]=m,S[10]=_,S[11]=y,S[12]=x,S[13]=b,S[14]=E,S[15]=C,S},ke.set=function(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S){return n[0]=t,n[1]=r,n[2]=a,n[3]=l,n[4]=u,n[5]=d,n[6]=h,n[7]=p,n[8]=m,n[9]=_,n[10]=y,n[11]=x,n[12]=b,n[13]=E,n[14]=C,n[15]=S,n},ke.identity=gu,ke.transpose=function(n,t){if(n===t){var r=t[1],a=t[2],l=t[3],u=t[6],d=t[7],h=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=r,n[6]=t[9],n[7]=t[13],n[8]=a,n[9]=u,n[11]=t[14],n[12]=l,n[13]=d,n[14]=h}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n},ke.invert=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8],y=t[9],x=t[10],b=t[11],E=t[12],C=t[13],S=t[14],M=t[15],D=r*h-a*d,R=r*p-l*d,P=r*m-u*d,I=a*p-l*h,O=a*m-u*h,F=l*m-u*p,L=_*C-y*E,N=_*S-x*E,z=_*M-b*E,U=y*S-x*C,V=y*M-b*C,G=x*M-b*S,j=D*G-R*V+P*U+I*z-O*N+F*L;return j?(n[0]=(h*G-p*V+m*U)*(j=1/j),n[1]=(l*V-a*G-u*U)*j,n[2]=(C*F-S*O+M*I)*j,n[3]=(x*O-y*F-b*I)*j,n[4]=(p*z-d*G-m*N)*j,n[5]=(r*G-l*z+u*N)*j,n[6]=(S*P-E*F-M*R)*j,n[7]=(_*F-x*P+b*R)*j,n[8]=(d*V-h*z+m*L)*j,n[9]=(a*z-r*V-u*L)*j,n[10]=(E*O-C*P+M*D)*j,n[11]=(y*P-_*O-b*D)*j,n[12]=(h*N-d*U-p*L)*j,n[13]=(r*U-a*N+l*L)*j,n[14]=(C*R-E*I-S*D)*j,n[15]=(_*I-y*R+x*D)*j,n):null},ke.adjoint=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=t[4],h=t[5],p=t[6],m=t[7],_=t[8],y=t[9],x=t[10],b=t[11],E=t[12],C=t[13],S=t[14],M=t[15];return n[0]=h*(x*M-b*S)-y*(p*M-m*S)+C*(p*b-m*x),n[1]=-(a*(x*M-b*S)-y*(l*M-u*S)+C*(l*b-u*x)),n[2]=a*(p*M-m*S)-h*(l*M-u*S)+C*(l*m-u*p),n[3]=-(a*(p*b-m*x)-h*(l*b-u*x)+y*(l*m-u*p)),n[4]=-(d*(x*M-b*S)-_*(p*M-m*S)+E*(p*b-m*x)),n[5]=r*(x*M-b*S)-_*(l*M-u*S)+E*(l*b-u*x),n[6]=-(r*(p*M-m*S)-d*(l*M-u*S)+E*(l*m-u*p)),n[7]=r*(p*b-m*x)-d*(l*b-u*x)+_*(l*m-u*p),n[8]=d*(y*M-b*C)-_*(h*M-m*C)+E*(h*b-m*y),n[9]=-(r*(y*M-b*C)-_*(a*M-u*C)+E*(a*b-u*y)),n[10]=r*(h*M-m*C)-d*(a*M-u*C)+E*(a*m-u*h),n[11]=-(r*(h*b-m*y)-d*(a*b-u*y)+_*(a*m-u*h)),n[12]=-(d*(y*S-x*C)-_*(h*S-p*C)+E*(h*x-p*y)),n[13]=r*(y*S-x*C)-_*(a*S-l*C)+E*(a*x-l*y),n[14]=-(r*(h*S-p*C)-d*(a*S-l*C)+E*(a*p-l*h)),n[15]=r*(h*x-p*y)-d*(a*x-l*y)+_*(a*p-l*h),n},ke.determinant=function(n){var t=n[0],r=n[1],a=n[2],l=n[3],u=n[4],d=n[5],h=n[6],p=n[7],m=n[8],_=n[9],y=n[10],x=n[11],b=n[12],E=n[13],C=n[14],S=n[15];return(t*d-r*u)*(y*S-x*C)-(t*h-a*u)*(_*S-x*E)+(t*p-l*u)*(_*C-y*E)+(r*h-a*d)*(m*S-x*b)-(r*p-l*d)*(m*C-y*b)+(a*p-l*h)*(m*E-_*b)},ke.multiply=hC,ke.translate=function(n,t,r){var a,l,u,d,h,p,m,_,y,x,b,E,C=r[0],S=r[1],M=r[2];return t===n?(n[12]=t[0]*C+t[4]*S+t[8]*M+t[12],n[13]=t[1]*C+t[5]*S+t[9]*M+t[13],n[14]=t[2]*C+t[6]*S+t[10]*M+t[14],n[15]=t[3]*C+t[7]*S+t[11]*M+t[15]):(l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],x=t[9],b=t[10],E=t[11],n[0]=a=t[0],n[1]=l,n[2]=u,n[3]=d,n[4]=h,n[5]=p,n[6]=m,n[7]=_,n[8]=y,n[9]=x,n[10]=b,n[11]=E,n[12]=a*C+h*S+y*M+t[12],n[13]=l*C+p*S+x*M+t[13],n[14]=u*C+m*S+b*M+t[14],n[15]=d*C+_*S+E*M+t[15]),n},ke.scale=function(n,t,r){var a=r[0],l=r[1],u=r[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*l,n[5]=t[5]*l,n[6]=t[6]*l,n[7]=t[7]*l,n[8]=t[8]*u,n[9]=t[9]*u,n[10]=t[10]*u,n[11]=t[11]*u,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},ke.rotate=function(n,t,r,a){var l,u,d,h,p,m,_,y,x,b,E,C,S,M,D,R,P,I,O,F,L,N,z,U,V=a[0],G=a[1],j=a[2],Z=Math.hypot(V,G,j);return Z<Si.EPSILON?null:(V*=Z=1/Z,G*=Z,j*=Z,l=Math.sin(r),u=Math.cos(r),p=t[1],m=t[2],_=t[3],x=t[5],b=t[6],E=t[7],S=t[9],M=t[10],D=t[11],O=V*G*(d=1-u)-j*l,F=G*G*d+u,L=j*G*d+V*l,N=V*j*d+G*l,z=G*j*d-V*l,U=j*j*d+u,n[0]=(h=t[0])*(R=V*V*d+u)+(y=t[4])*(P=G*V*d+j*l)+(C=t[8])*(I=j*V*d-G*l),n[1]=p*R+x*P+S*I,n[2]=m*R+b*P+M*I,n[3]=_*R+E*P+D*I,n[4]=h*O+y*F+C*L,n[5]=p*O+x*F+S*L,n[6]=m*O+b*F+M*L,n[7]=_*O+E*F+D*L,n[8]=h*N+y*z+C*U,n[9]=p*N+x*z+S*U,n[10]=m*N+b*z+M*U,n[11]=_*N+E*z+D*U,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)},ke.rotateX=function(n,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[4],d=t[5],h=t[6],p=t[7],m=t[8],_=t[9],y=t[10],x=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=u*l+m*a,n[5]=d*l+_*a,n[6]=h*l+y*a,n[7]=p*l+x*a,n[8]=m*l-u*a,n[9]=_*l-d*a,n[10]=y*l-h*a,n[11]=x*l-p*a,n},ke.rotateY=function(n,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[0],d=t[1],h=t[2],p=t[3],m=t[8],_=t[9],y=t[10],x=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=u*l-m*a,n[1]=d*l-_*a,n[2]=h*l-y*a,n[3]=p*l-x*a,n[8]=u*a+m*l,n[9]=d*a+_*l,n[10]=h*a+y*l,n[11]=p*a+x*l,n},ke.rotateZ=function(n,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[0],d=t[1],h=t[2],p=t[3],m=t[4],_=t[5],y=t[6],x=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=u*l+m*a,n[1]=d*l+_*a,n[2]=h*l+y*a,n[3]=p*l+x*a,n[4]=m*l-u*a,n[5]=_*l-d*a,n[6]=y*l-h*a,n[7]=x*l-p*a,n},ke.fromTranslation=function(n,t){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},ke.fromScaling=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.fromRotation=function(n,t,r){var a,l,u,d=r[0],h=r[1],p=r[2],m=Math.hypot(d,h,p);return m<Si.EPSILON?null:(d*=m=1/m,h*=m,p*=m,a=Math.sin(t),l=Math.cos(t),n[0]=d*d*(u=1-l)+l,n[1]=h*d*u+p*a,n[2]=p*d*u-h*a,n[3]=0,n[4]=d*h*u-p*a,n[5]=h*h*u+l,n[6]=p*h*u+d*a,n[7]=0,n[8]=d*p*u+h*a,n[9]=h*p*u-d*a,n[10]=p*p*u+l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)},ke.fromXRotation=function(n,t){var r=Math.sin(t),a=Math.cos(t);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=r,n[7]=0,n[8]=0,n[9]=-r,n[10]=a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.fromYRotation=function(n,t){var r=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=0,n[2]=-r,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=r,n[9]=0,n[10]=a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.fromZRotation=function(n,t){var r=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=r,n[2]=0,n[3]=0,n[4]=-r,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.fromRotationTranslation=kh,ke.fromQuat2=function(n,t){var r=new Si.ARRAY_TYPE(3),a=-t[0],l=-t[1],u=-t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=a*a+l*l+u*u+d*d;return y>0?(r[0]=2*(h*d+_*a+p*u-m*l)/y,r[1]=2*(p*d+_*l+m*a-h*u)/y,r[2]=2*(m*d+_*u+h*l-p*a)/y):(r[0]=2*(h*d+_*a+p*u-m*l),r[1]=2*(p*d+_*l+m*a-h*u),r[2]=2*(m*d+_*u+h*l-p*a)),kh(n,t,r),n},ke.getTranslation=function(n,t){return n[0]=t[12],n[1]=t[13],n[2]=t[14],n},ke.getScaling=fC,ke.getRotation=function(n,t){var r=new Si.ARRAY_TYPE(3);fC(r,t);var a=1/r[0],l=1/r[1],u=1/r[2],d=t[0]*a,h=t[1]*l,p=t[2]*u,m=t[4]*a,_=t[5]*l,y=t[6]*u,x=t[8]*a,b=t[9]*l,E=t[10]*u,C=d+_+E,S=0;return C>0?(S=2*Math.sqrt(C+1),n[3]=.25*S,n[0]=(y-b)/S,n[1]=(x-p)/S,n[2]=(h-m)/S):d>_&&d>E?(S=2*Math.sqrt(1+d-_-E),n[3]=(y-b)/S,n[0]=.25*S,n[1]=(h+m)/S,n[2]=(x+p)/S):_>E?(S=2*Math.sqrt(1+_-d-E),n[3]=(x-p)/S,n[0]=(h+m)/S,n[1]=.25*S,n[2]=(y+b)/S):(S=2*Math.sqrt(1+E-d-_),n[3]=(h-m)/S,n[0]=(x+p)/S,n[1]=(y+b)/S,n[2]=.25*S),n},ke.fromRotationTranslationScale=function(n,t,r,a){var l=t[0],u=t[1],d=t[2],h=t[3],p=l+l,m=u+u,_=d+d,y=l*p,x=l*m,b=l*_,E=u*m,C=u*_,S=d*_,M=h*p,D=h*m,R=h*_,P=a[0],I=a[1],O=a[2];return n[0]=(1-(E+S))*P,n[1]=(x+R)*P,n[2]=(b-D)*P,n[3]=0,n[4]=(x-R)*I,n[5]=(1-(y+S))*I,n[6]=(C+M)*I,n[7]=0,n[8]=(b+D)*O,n[9]=(C-M)*O,n[10]=(1-(y+E))*O,n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n},ke.fromRotationTranslationScaleOrigin=function(n,t,r,a,l){var u=t[0],d=t[1],h=t[2],p=t[3],m=u+u,_=d+d,y=h+h,x=u*m,b=u*_,E=u*y,C=d*_,S=d*y,M=h*y,D=p*m,R=p*_,P=p*y,I=a[0],O=a[1],F=a[2],L=l[0],N=l[1],z=l[2],U=(1-(C+M))*I,V=(b+P)*I,G=(E-R)*I,j=(b-P)*O,Z=(1-(x+M))*O,et=(S+D)*O,it=(E+R)*F,X=(S-D)*F,Y=(1-(x+C))*F;return n[0]=U,n[1]=V,n[2]=G,n[3]=0,n[4]=j,n[5]=Z,n[6]=et,n[7]=0,n[8]=it,n[9]=X,n[10]=Y,n[11]=0,n[12]=r[0]+L-(U*L+j*N+it*z),n[13]=r[1]+N-(V*L+Z*N+X*z),n[14]=r[2]+z-(G*L+et*N+Y*z),n[15]=1,n},ke.fromQuat=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=r+r,h=a+a,p=l+l,m=r*d,_=a*d,y=a*h,x=l*d,b=l*h,E=l*p,C=u*d,S=u*h,M=u*p;return n[0]=1-y-E,n[1]=_+M,n[2]=x-S,n[3]=0,n[4]=_-M,n[5]=1-m-E,n[6]=b+C,n[7]=0,n[8]=x+S,n[9]=b-C,n[10]=1-m-y,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},ke.frustum=function(n,t,r,a,l,u,d){var h=1/(r-t),p=1/(l-a),m=1/(u-d);return n[0]=2*u*h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*u*p,n[6]=0,n[7]=0,n[8]=(r+t)*h,n[9]=(l+a)*p,n[10]=(d+u)*m,n[11]=-1,n[12]=0,n[13]=0,n[14]=d*u*2*m,n[15]=0,n},ke.perspectiveNO=ax,ke.perspectiveZO=function(n,t,r,a,l){var u,d=1/Math.tan(t/2);return n[0]=d/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=l&&l!==1/0?(n[10]=l*(u=1/(a-l)),n[14]=l*a*u):(n[10]=-1,n[14]=-a),n},ke.perspectiveFromFieldOfView=function(n,t,r,a){var l=Math.tan(t.upDegrees*Math.PI/180),u=Math.tan(t.downDegrees*Math.PI/180),d=Math.tan(t.leftDegrees*Math.PI/180),h=Math.tan(t.rightDegrees*Math.PI/180),p=2/(d+h),m=2/(l+u);return n[0]=p,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=-(d-h)*p*.5,n[9]=(l-u)*m*.5,n[10]=a/(r-a),n[11]=-1,n[12]=0,n[13]=0,n[14]=a*r/(r-a),n[15]=0,n},ke.orthoNO=G_,ke.orthoZO=function(n,t,r,a,l,u,d){var h=1/(t-r),p=1/(a-l),m=1/(u-d);return n[0]=-2*h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=m,n[11]=0,n[12]=(t+r)*h,n[13]=(l+a)*p,n[14]=u*m,n[15]=1,n},ke.lookAt=function(n,t,r,a){var l,u,d,h,p,m,_,y,x,b,E=t[0],C=t[1],S=t[2],M=a[0],D=a[1],R=a[2],P=r[0],I=r[1],O=r[2];return Math.abs(E-P)<Si.EPSILON&&Math.abs(C-I)<Si.EPSILON&&Math.abs(S-O)<Si.EPSILON?gu(n):(_=E-P,y=C-I,x=S-O,l=D*(x*=b=1/Math.hypot(_,y,x))-R*(y*=b),u=R*(_*=b)-M*x,d=M*y-D*_,(b=Math.hypot(l,u,d))?(l*=b=1/b,u*=b,d*=b):(l=0,u=0,d=0),h=y*d-x*u,p=x*l-_*d,m=_*u-y*l,(b=Math.hypot(h,p,m))?(h*=b=1/b,p*=b,m*=b):(h=0,p=0,m=0),n[0]=l,n[1]=h,n[2]=_,n[3]=0,n[4]=u,n[5]=p,n[6]=y,n[7]=0,n[8]=d,n[9]=m,n[10]=x,n[11]=0,n[12]=-(l*E+u*C+d*S),n[13]=-(h*E+p*C+m*S),n[14]=-(_*E+y*C+x*S),n[15]=1,n)},ke.targetTo=function(n,t,r,a){var l=t[0],u=t[1],d=t[2],h=a[0],p=a[1],m=a[2],_=l-r[0],y=u-r[1],x=d-r[2],b=_*_+y*y+x*x;b>0&&(_*=b=1/Math.sqrt(b),y*=b,x*=b);var E=p*x-m*y,C=m*_-h*x,S=h*y-p*_;return(b=E*E+C*C+S*S)>0&&(E*=b=1/Math.sqrt(b),C*=b,S*=b),n[0]=E,n[1]=C,n[2]=S,n[3]=0,n[4]=y*S-x*C,n[5]=x*E-_*S,n[6]=_*C-y*E,n[7]=0,n[8]=_,n[9]=y,n[10]=x,n[11]=0,n[12]=l,n[13]=u,n[14]=d,n[15]=1,n},ke.str=function(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"},ke.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])},ke.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n[4]=t[4]+r[4],n[5]=t[5]+r[5],n[6]=t[6]+r[6],n[7]=t[7]+r[7],n[8]=t[8]+r[8],n[9]=t[9]+r[9],n[10]=t[10]+r[10],n[11]=t[11]+r[11],n[12]=t[12]+r[12],n[13]=t[13]+r[13],n[14]=t[14]+r[14],n[15]=t[15]+r[15],n},ke.subtract=Up,ke.multiplyScalar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*r,n[9]=t[9]*r,n[10]=t[10]*r,n[11]=t[11]*r,n[12]=t[12]*r,n[13]=t[13]*r,n[14]=t[14]*r,n[15]=t[15]*r,n},ke.multiplyScalarAndAdd=function(n,t,r,a){return n[0]=t[0]+r[0]*a,n[1]=t[1]+r[1]*a,n[2]=t[2]+r[2]*a,n[3]=t[3]+r[3]*a,n[4]=t[4]+r[4]*a,n[5]=t[5]+r[5]*a,n[6]=t[6]+r[6]*a,n[7]=t[7]+r[7]*a,n[8]=t[8]+r[8]*a,n[9]=t[9]+r[9]*a,n[10]=t[10]+r[10]*a,n[11]=t[11]+r[11]*a,n[12]=t[12]+r[12]*a,n[13]=t[13]+r[13]*a,n[14]=t[14]+r[14]*a,n[15]=t[15]+r[15]*a,n},ke.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},ke.equals=function(n,t){var r=n[0],a=n[1],l=n[2],u=n[3],d=n[4],h=n[5],p=n[6],m=n[7],_=n[8],y=n[9],x=n[10],b=n[11],E=n[12],C=n[13],S=n[14],M=n[15],D=t[0],R=t[1],P=t[2],I=t[3],O=t[4],F=t[5],L=t[6],N=t[7],z=t[8],U=t[9],V=t[10],G=t[11],j=t[12],Z=t[13],et=t[14],it=t[15];return Math.abs(r-D)<=Si.EPSILON*Math.max(1,Math.abs(r),Math.abs(D))&&Math.abs(a-R)<=Si.EPSILON*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-P)<=Si.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(u-I)<=Si.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(d-O)<=Si.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(h-F)<=Si.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(p-L)<=Si.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(m-N)<=Si.EPSILON*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(_-z)<=Si.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(y-U)<=Si.EPSILON*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(x-V)<=Si.EPSILON*Math.max(1,Math.abs(x),Math.abs(V))&&Math.abs(b-G)<=Si.EPSILON*Math.max(1,Math.abs(b),Math.abs(G))&&Math.abs(E-j)<=Si.EPSILON*Math.max(1,Math.abs(E),Math.abs(j))&&Math.abs(C-Z)<=Si.EPSILON*Math.max(1,Math.abs(C),Math.abs(Z))&&Math.abs(S-et)<=Si.EPSILON*Math.max(1,Math.abs(S),Math.abs(et))&&Math.abs(M-it)<=Si.EPSILON*Math.max(1,Math.abs(M),Math.abs(it))},ke.sub=ke.mul=ke.ortho=ke.perspective=void 0;var Si=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==jp(n)&&"function"!=typeof n)return{default:n};var r=dC(void 0);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}(Fn);function dC(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(dC=function(a){return a?r:t})(n)}function gu(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function hC(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=t[8],x=t[9],b=t[10],E=t[11],C=t[12],S=t[13],M=t[14],D=t[15],R=r[0],P=r[1],I=r[2],O=r[3];return n[0]=R*a+P*h+I*y+O*C,n[1]=R*l+P*p+I*x+O*S,n[2]=R*u+P*m+I*b+O*M,n[3]=R*d+P*_+I*E+O*D,n[4]=(R=r[4])*a+(P=r[5])*h+(I=r[6])*y+(O=r[7])*C,n[5]=R*l+P*p+I*x+O*S,n[6]=R*u+P*m+I*b+O*M,n[7]=R*d+P*_+I*E+O*D,n[8]=(R=r[8])*a+(P=r[9])*h+(I=r[10])*y+(O=r[11])*C,n[9]=R*l+P*p+I*x+O*S,n[10]=R*u+P*m+I*b+O*M,n[11]=R*d+P*_+I*E+O*D,n[12]=(R=r[12])*a+(P=r[13])*h+(I=r[14])*y+(O=r[15])*C,n[13]=R*l+P*p+I*x+O*S,n[14]=R*u+P*m+I*b+O*M,n[15]=R*d+P*_+I*E+O*D,n}function kh(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=a+a,p=l+l,m=u+u,_=a*h,y=a*p,x=a*m,b=l*p,E=l*m,C=u*m,S=d*h,M=d*p,D=d*m;return n[0]=1-(b+C),n[1]=y+D,n[2]=x-M,n[3]=0,n[4]=y-D,n[5]=1-(_+C),n[6]=E+S,n[7]=0,n[8]=x+M,n[9]=E-S,n[10]=1-(_+b),n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n}function fC(n,t){var r=t[4],a=t[5],l=t[6],u=t[8],d=t[9],h=t[10];return n[0]=Math.hypot(t[0],t[1],t[2]),n[1]=Math.hypot(r,a,l),n[2]=Math.hypot(u,d,h),n}function ax(n,t,r,a,l){var u,d=1/Math.tan(t/2);return n[0]=d/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=l&&l!==1/0?(n[10]=(l+a)*(u=1/(a-l)),n[14]=2*l*a*u):(n[10]=-1,n[14]=-2*a),n}function G_(n,t,r,a,l,u,d){var h=1/(t-r),p=1/(a-l),m=1/(u-d);return n[0]=-2*h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*m,n[11]=0,n[12]=(t+r)*h,n[13]=(l+a)*p,n[14]=(d+u)*m,n[15]=1,n}function Up(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n[4]=t[4]-r[4],n[5]=t[5]-r[5],n[6]=t[6]-r[6],n[7]=t[7]-r[7],n[8]=t[8]-r[8],n[9]=t[9]-r[9],n[10]=t[10]-r[10],n[11]=t[11]-r[11],n[12]=t[12]-r[12],n[13]=t[13]-r[13],n[14]=t[14]-r[14],n[15]=t[15]-r[15],n}ke.perspective=ax,ke.ortho=G_,ke.mul=hC,ke.sub=Up;var Ce={},Ae={};function lx(n){return(lx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.create=pC,Ae.clone=function(n){var t=new Ms.ARRAY_TYPE(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},Ae.length=CA,Ae.fromValues=function(n,t,r){var a=new Ms.ARRAY_TYPE(3);return a[0]=n,a[1]=t,a[2]=r,a},Ae.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},Ae.set=function(n,t,r,a){return n[0]=t,n[1]=r,n[2]=a,n},Ae.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n},Ae.subtract=cx,Ae.multiply=mC,Ae.divide=MA,Ae.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n},Ae.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n},Ae.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n[2]=Math.min(t[2],r[2]),n},Ae.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n[2]=Math.max(t[2],r[2]),n},Ae.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n},Ae.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n},Ae.scaleAndAdd=function(n,t,r,a){return n[0]=t[0]+r[0]*a,n[1]=t[1]+r[1]*a,n[2]=t[2]+r[2]*a,n},Ae.distance=gC,Ae.squaredDistance=_C,Ae.squaredLength=yC,Ae.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n},Ae.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n},Ae.normalize=function(n,t){var r=t[0],a=t[1],l=t[2],u=r*r+a*a+l*l;return u>0&&(u=1/Math.sqrt(u)),n[0]=t[0]*u,n[1]=t[1]*u,n[2]=t[2]*u,n},Ae.dot=Hp,Ae.cross=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=r[0],h=r[1],p=r[2];return n[0]=l*p-u*h,n[1]=u*d-a*p,n[2]=a*h-l*d,n},Ae.lerp=function(n,t,r,a){var l=t[0],u=t[1],d=t[2];return n[0]=l+a*(r[0]-l),n[1]=u+a*(r[1]-u),n[2]=d+a*(r[2]-d),n},Ae.hermite=function(n,t,r,a,l,u){var d=u*u,h=d*(2*u-3)+1,p=d*(u-2)+u,m=d*(u-1),_=d*(3-2*u);return n[0]=t[0]*h+r[0]*p+a[0]*m+l[0]*_,n[1]=t[1]*h+r[1]*p+a[1]*m+l[1]*_,n[2]=t[2]*h+r[2]*p+a[2]*m+l[2]*_,n},Ae.bezier=function(n,t,r,a,l,u){var d=1-u,h=d*d,p=u*u,m=h*d,_=3*u*h,y=3*p*d,x=p*u;return n[0]=t[0]*m+r[0]*_+a[0]*y+l[0]*x,n[1]=t[1]*m+r[1]*_+a[1]*y+l[1]*x,n[2]=t[2]*m+r[2]*_+a[2]*y+l[2]*x,n},Ae.random=function(n,t){t=t||1;var r=2*Ms.RANDOM()*Math.PI,a=2*Ms.RANDOM()-1,l=Math.sqrt(1-a*a)*t;return n[0]=Math.cos(r)*l,n[1]=Math.sin(r)*l,n[2]=a*t,n},Ae.transformMat4=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=r[3]*a+r[7]*l+r[11]*u+r[15];return n[0]=(r[0]*a+r[4]*l+r[8]*u+r[12])/(d=d||1),n[1]=(r[1]*a+r[5]*l+r[9]*u+r[13])/d,n[2]=(r[2]*a+r[6]*l+r[10]*u+r[14])/d,n},Ae.transformMat3=function(n,t,r){var a=t[0],l=t[1],u=t[2];return n[0]=a*r[0]+l*r[3]+u*r[6],n[1]=a*r[1]+l*r[4]+u*r[7],n[2]=a*r[2]+l*r[5]+u*r[8],n},Ae.transformQuat=function(n,t,r){var a=r[0],l=r[1],u=r[2],d=t[0],h=t[1],p=t[2],m=l*p-u*h,_=u*d-a*p,y=a*h-l*d,x=l*y-u*_,b=u*m-a*y,E=a*_-l*m,C=2*r[3];return _*=C,y*=C,b*=2,E*=2,n[0]=d+(m*=C)+(x*=2),n[1]=h+_+b,n[2]=p+y+E,n},Ae.rotateX=function(n,t,r,a){var l=[],u=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],u[0]=l[0],u[1]=l[1]*Math.cos(a)-l[2]*Math.sin(a),u[2]=l[1]*Math.sin(a)+l[2]*Math.cos(a),n[0]=u[0]+r[0],n[1]=u[1]+r[1],n[2]=u[2]+r[2],n},Ae.rotateY=function(n,t,r,a){var l=[],u=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],u[0]=l[2]*Math.sin(a)+l[0]*Math.cos(a),u[1]=l[1],u[2]=l[2]*Math.cos(a)-l[0]*Math.sin(a),n[0]=u[0]+r[0],n[1]=u[1]+r[1],n[2]=u[2]+r[2],n},Ae.rotateZ=function(n,t,r,a){var l=[],u=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],u[0]=l[0]*Math.cos(a)-l[1]*Math.sin(a),u[1]=l[0]*Math.sin(a)+l[1]*Math.cos(a),u[2]=l[2],n[0]=u[0]+r[0],n[1]=u[1]+r[1],n[2]=u[2]+r[2],n},Ae.angle=function(n,t){var r=n[0],a=n[1],l=n[2],u=t[0],d=t[1],h=t[2],p=Math.sqrt(r*r+a*a+l*l)*Math.sqrt(u*u+d*d+h*h),m=p&&Hp(n,t)/p;return Math.acos(Math.min(Math.max(m,-1),1))},Ae.zero=function(n){return n[0]=0,n[1]=0,n[2]=0,n},Ae.str=function(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"},Ae.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]},Ae.equals=function(n,t){var r=n[0],a=n[1],l=n[2],u=t[0],d=t[1],h=t[2];return Math.abs(r-u)<=Ms.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-d)<=Ms.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(l-h)<=Ms.EPSILON*Math.max(1,Math.abs(l),Math.abs(h))},Ae.forEach=Ae.sqrLen=Ae.len=Ae.sqrDist=Ae.dist=Ae.div=Ae.mul=Ae.sub=void 0;var Ms=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==lx(n)&&"function"!=typeof n)return{default:n};var r=Fh(void 0);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}(Fn);function Fh(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Fh=function(a){return a?r:t})(n)}function pC(){var n=new Ms.ARRAY_TYPE(3);return Ms.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function CA(n){return Math.hypot(n[0],n[1],n[2])}function cx(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n}function mC(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n}function MA(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n}function gC(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2])}function _C(n,t){var r=t[0]-n[0],a=t[1]-n[1],l=t[2]-n[2];return r*r+a*a+l*l}function yC(n){var t=n[0],r=n[1],a=n[2];return t*t+r*r+a*a}function Hp(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}Ae.sub=cx,Ae.mul=mC,Ae.div=MA,Ae.dist=gC,Ae.sqrDist=_C,Ae.len=CA,Ae.sqrLen=yC;var Nl,SA=(Nl=pC(),function(n,t,r,a,l,u){var d,h;for(t||(t=3),r||(r=0),h=a?Math.min(a*t+r,n.length):n.length,d=r;d<h;d+=t)Nl[0]=n[d],Nl[1]=n[d+1],Nl[2]=n[d+2],l(Nl,Nl,u),n[d]=Nl[0],n[d+1]=Nl[1],n[d+2]=Nl[2];return n});Ae.forEach=SA;var We={};function vC(n){return(vC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(We,"__esModule",{value:!0}),We.create=xC,We.clone=function(n){var t=new Ys.ARRAY_TYPE(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},We.fromValues=function(n,t,r,a){var l=new Ys.ARRAY_TYPE(4);return l[0]=n,l[1]=t,l[2]=r,l[3]=a,l},We.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},We.set=function(n,t,r,a,l){return n[0]=t,n[1]=r,n[2]=a,n[3]=l,n},We.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n},We.subtract=bC,We.multiply=q_,We.divide=DA,We.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n[3]=Math.ceil(t[3]),n},We.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n[3]=Math.floor(t[3]),n},We.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n[2]=Math.min(t[2],r[2]),n[3]=Math.min(t[3],r[3]),n},We.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n[2]=Math.max(t[2],r[2]),n[3]=Math.max(t[3],r[3]),n},We.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n[3]=Math.round(t[3]),n},We.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},We.scaleAndAdd=function(n,t,r,a){return n[0]=t[0]+r[0]*a,n[1]=t[1]+r[1]*a,n[2]=t[2]+r[2]*a,n[3]=t[3]+r[3]*a,n},We.distance=IA,We.squaredDistance=W_,We.length=AA,We.squaredLength=RA,We.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n},We.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n[3]=1/t[3],n},We.normalize=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=r*r+a*a+l*l+u*u;return d>0&&(d=1/Math.sqrt(d)),n[0]=r*d,n[1]=a*d,n[2]=l*d,n[3]=u*d,n},We.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},We.cross=function(n,t,r,a){var l=r[0]*a[1]-r[1]*a[0],u=r[0]*a[2]-r[2]*a[0],d=r[0]*a[3]-r[3]*a[0],h=r[1]*a[2]-r[2]*a[1],p=r[1]*a[3]-r[3]*a[1],m=r[2]*a[3]-r[3]*a[2],_=t[0],y=t[1],x=t[2],b=t[3];return n[0]=y*m-x*p+b*h,n[1]=-_*m+x*d-b*u,n[2]=_*p-y*d+b*l,n[3]=-_*h+y*u-x*l,n},We.lerp=function(n,t,r,a){var l=t[0],u=t[1],d=t[2],h=t[3];return n[0]=l+a*(r[0]-l),n[1]=u+a*(r[1]-u),n[2]=d+a*(r[2]-d),n[3]=h+a*(r[3]-h),n},We.random=function(n,t){var r,a,l,u,d,h;t=t||1;do{d=(r=2*Ys.RANDOM()-1)*r+(a=2*Ys.RANDOM()-1)*a}while(d>=1);do{h=(l=2*Ys.RANDOM()-1)*l+(u=2*Ys.RANDOM()-1)*u}while(h>=1);var p=Math.sqrt((1-d)/h);return n[0]=t*r,n[1]=t*a,n[2]=t*l*p,n[3]=t*u*p,n},We.transformMat4=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3];return n[0]=r[0]*a+r[4]*l+r[8]*u+r[12]*d,n[1]=r[1]*a+r[5]*l+r[9]*u+r[13]*d,n[2]=r[2]*a+r[6]*l+r[10]*u+r[14]*d,n[3]=r[3]*a+r[7]*l+r[11]*u+r[15]*d,n},We.transformQuat=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=r[0],h=r[1],p=r[2],m=r[3],_=m*a+h*u-p*l,y=m*l+p*a-d*u,x=m*u+d*l-h*a,b=-d*a-h*l-p*u;return n[0]=_*m+b*-d+y*-p-x*-h,n[1]=y*m+b*-h+x*-d-_*-p,n[2]=x*m+b*-p+_*-h-y*-d,n[3]=t[3],n},We.zero=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},We.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},We.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},We.equals=function(n,t){var r=n[0],a=n[1],l=n[2],u=n[3],d=t[0],h=t[1],p=t[2],m=t[3];return Math.abs(r-d)<=Ys.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-h)<=Ys.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(l-p)<=Ys.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(u-m)<=Ys.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))},We.forEach=We.sqrLen=We.len=We.sqrDist=We.dist=We.div=We.mul=We.sub=void 0;var Ys=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==vC(n)&&"function"!=typeof n)return{default:n};var r=TA(void 0);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}(Fn);function TA(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(TA=function(a){return a?r:t})(n)}function xC(){var n=new Ys.ARRAY_TYPE(4);return Ys.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function bC(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n}function q_(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n}function DA(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n[3]=t[3]/r[3],n}function IA(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2],t[3]-n[3])}function W_(n,t){var r=t[0]-n[0],a=t[1]-n[1],l=t[2]-n[2],u=t[3]-n[3];return r*r+a*a+l*l+u*u}function AA(n){return Math.hypot(n[0],n[1],n[2],n[3])}function RA(n){var t=n[0],r=n[1],a=n[2],l=n[3];return t*t+r*r+a*a+l*l}We.sub=bC,We.mul=q_,We.div=DA,We.dist=IA,We.sqrDist=W_,We.len=AA,We.sqrLen=RA;var DF=function(){var n=xC();return function(t,r,a,l,u,d){var h,p;for(r||(r=4),a||(a=0),p=l?Math.min(l*r+a,t.length):t.length,h=a;h<p;h+=r)n[0]=t[h],n[1]=t[h+1],n[2]=t[h+2],n[3]=t[h+3],u(n,n,d),t[h]=n[0],t[h+1]=n[1],t[h+2]=n[2],t[h+3]=n[3];return t}}();function wC(n){return(wC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}We.forEach=DF,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.create=Z_,Ce.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},Ce.setAxisAngle=_d,Ce.getAxisAngle=function(n,t){var r=2*Math.acos(t[3]),a=Math.sin(r/2);return a>Lh.EPSILON?(n[0]=t[0]/a,n[1]=t[1]/a,n[2]=t[2]/a):(n[0]=1,n[1]=0,n[2]=0),r},Ce.getAngle=function(n,t){var r=CC(n,t);return Math.acos(2*r*r-1)},Ce.multiply=dx,Ce.rotateX=function(n,t,r){r*=.5;var a=t[0],l=t[1],u=t[2],d=t[3],h=Math.sin(r),p=Math.cos(r);return n[0]=a*p+d*h,n[1]=l*p+u*h,n[2]=u*p-l*h,n[3]=d*p-a*h,n},Ce.rotateY=function(n,t,r){r*=.5;var a=t[0],l=t[1],u=t[2],d=t[3],h=Math.sin(r),p=Math.cos(r);return n[0]=a*p-u*h,n[1]=l*p+d*h,n[2]=u*p+a*h,n[3]=d*p-l*h,n},Ce.rotateZ=function(n,t,r){r*=.5;var a=t[0],l=t[1],u=t[2],d=t[3],h=Math.sin(r),p=Math.cos(r);return n[0]=a*p+l*h,n[1]=l*p-a*h,n[2]=u*p+d*h,n[3]=d*p-u*h,n},Ce.calculateW=function(n,t){var r=t[0],a=t[1],l=t[2];return n[0]=r,n[1]=a,n[2]=l,n[3]=Math.sqrt(Math.abs(1-r*r-a*a-l*l)),n},Ce.exp=hx,Ce.ln=Gp,Ce.pow=function(n,t,r){return Gp(n,t),EC(n,n,r),hx(n,n),n},Ce.slerp=yd,Ce.random=function(n){var t=Lh.RANDOM(),r=Lh.RANDOM(),a=Lh.RANDOM(),l=Math.sqrt(1-t),u=Math.sqrt(t);return n[0]=l*Math.sin(2*Math.PI*r),n[1]=l*Math.cos(2*Math.PI*r),n[2]=u*Math.sin(2*Math.PI*a),n[3]=u*Math.cos(2*Math.PI*a),n},Ce.invert=function(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=r*r+a*a+l*l+u*u,h=d?1/d:0;return n[0]=-r*h,n[1]=-a*h,n[2]=-l*h,n[3]=u*h,n},Ce.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n},Ce.fromMat3=vc,Ce.fromEuler=function(n,t,r,a){var l=.5*Math.PI/180;t*=l,r*=l,a*=l;var u=Math.sin(t),d=Math.cos(t),h=Math.sin(r),p=Math.cos(r),m=Math.sin(a),_=Math.cos(a);return n[0]=u*p*_-d*h*m,n[1]=d*h*_+u*p*m,n[2]=d*p*m-u*h*_,n[3]=d*p*_+u*h*m,n},Ce.str=function(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},Ce.setAxes=Ce.sqlerp=Ce.rotationTo=Ce.equals=Ce.exactEquals=Ce.normalize=Ce.sqrLen=Ce.squaredLength=Ce.len=Ce.length=Ce.lerp=Ce.dot=Ce.scale=Ce.mul=Ce.add=Ce.set=Ce.copy=Ce.fromValues=Ce.clone=void 0;var Lh=$p(Fn),PA=$p(Vn),_a=$p(Ae),Xo=$p(We);function ux(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(ux=function(a){return a?r:t})(n)}function $p(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==wC(n)&&"function"!=typeof n)return{default:n};var r=ux(t);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}function Z_(){var n=new Lh.ARRAY_TYPE(4);return Lh.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function _d(n,t,r){r*=.5;var a=Math.sin(r);return n[0]=a*t[0],n[1]=a*t[1],n[2]=a*t[2],n[3]=Math.cos(r),n}function dx(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=r[0],p=r[1],m=r[2],_=r[3];return n[0]=a*_+d*h+l*m-u*p,n[1]=l*_+d*p+u*h-a*m,n[2]=u*_+d*m+a*p-l*h,n[3]=d*_-a*h-l*p-u*m,n}function hx(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=Math.sqrt(r*r+a*a+l*l),h=Math.exp(u),p=d>0?h*Math.sin(d)/d:0;return n[0]=r*p,n[1]=a*p,n[2]=l*p,n[3]=h*Math.cos(d),n}function Gp(n,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=Math.sqrt(r*r+a*a+l*l),h=d>0?Math.atan2(d,u)/d:0;return n[0]=r*h,n[1]=a*h,n[2]=l*h,n[3]=.5*Math.log(r*r+a*a+l*l+u*u),n}function yd(n,t,r,a){var l,u,d,h,p,m=t[0],_=t[1],y=t[2],x=t[3],b=r[0],E=r[1],C=r[2],S=r[3];return(u=m*b+_*E+y*C+x*S)<0&&(u=-u,b=-b,E=-E,C=-C,S=-S),1-u>Lh.EPSILON?(l=Math.acos(u),d=Math.sin(l),h=Math.sin((1-a)*l)/d,p=Math.sin(a*l)/d):(h=1-a,p=a),n[0]=h*m+p*b,n[1]=h*_+p*E,n[2]=h*y+p*C,n[3]=h*x+p*S,n}function vc(n,t){var r,a=t[0]+t[4]+t[8];if(a>0)r=Math.sqrt(a+1),n[3]=.5*r,n[0]=(t[5]-t[7])*(r=.5/r),n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{var l=0;t[4]>t[0]&&(l=1),t[8]>t[3*l+l]&&(l=2);var u=(l+1)%3,d=(l+2)%3;r=Math.sqrt(t[3*l+l]-t[3*u+u]-t[3*d+d]+1),n[l]=.5*r,n[3]=(t[3*u+d]-t[3*d+u])*(r=.5/r),n[u]=(t[3*u+l]+t[3*l+u])*r,n[d]=(t[3*d+l]+t[3*l+d])*r}return n}Ce.clone=Xo.clone,Ce.fromValues=Xo.fromValues,Ce.copy=Xo.copy,Ce.set=Xo.set,Ce.add=Xo.add,Ce.mul=dx;var EC=Xo.scale;Ce.scale=EC;var CC=Xo.dot;Ce.dot=CC,Ce.lerp=Xo.lerp;var MC=Xo.length;Ce.length=MC,Ce.len=MC;var fx=Xo.squaredLength;Ce.squaredLength=fx,Ce.sqrLen=fx;var qp=Xo.normalize;Ce.normalize=qp,Ce.exactEquals=Xo.exactEquals,Ce.equals=Xo.equals;var Wa,SC,TC,DC=(Wa=_a.create(),SC=_a.fromValues(1,0,0),TC=_a.fromValues(0,1,0),function(n,t,r){var a=_a.dot(t,r);return a<-.999999?(_a.cross(Wa,SC,t),_a.len(Wa)<1e-6&&_a.cross(Wa,TC,t),_a.normalize(Wa,Wa),_d(n,Wa,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(_a.cross(Wa,t,r),n[0]=Wa[0],n[1]=Wa[1],n[2]=Wa[2],n[3]=1+a,qp(n,n))});Ce.rotationTo=DC;var px,mx,Ss=(px=Z_(),mx=Z_(),function(n,t,r,a,l,u){return yd(px,t,l,u),yd(mx,r,a,u),yd(n,px,mx,2*u*(1-u)),n});Ce.sqlerp=Ss;var Ks,IC=(Ks=PA.create(),function(n,t,r,a){return Ks[0]=r[0],Ks[3]=r[1],Ks[6]=r[2],Ks[1]=a[0],Ks[4]=a[1],Ks[7]=a[2],Ks[2]=-t[0],Ks[5]=-t[1],Ks[8]=-t[2],qp(n,vc(n,Ks))});Ce.setAxes=IC;var Ye={};function po(n){return(po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.create=function(){var n=new Qr.ARRAY_TYPE(8);return Qr.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0),n[3]=1,n},Ye.clone=function(n){var t=new Qr.ARRAY_TYPE(8);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t},Ye.fromValues=function(n,t,r,a,l,u,d,h){var p=new Qr.ARRAY_TYPE(8);return p[0]=n,p[1]=t,p[2]=r,p[3]=a,p[4]=l,p[5]=u,p[6]=d,p[7]=h,p},Ye.fromRotationTranslationValues=function(n,t,r,a,l,u,d){var h=new Qr.ARRAY_TYPE(8);h[0]=n,h[1]=t,h[2]=r,h[3]=a;var p=.5*l,m=.5*u,_=.5*d;return h[4]=p*a+m*r-_*t,h[5]=m*a+_*n-p*r,h[6]=_*a+p*t-m*n,h[7]=-p*n-m*t-_*r,h},Ye.fromRotationTranslation=RC,Ye.fromTranslation=function(n,t){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=.5*t[0],n[5]=.5*t[1],n[6]=.5*t[2],n[7]=0,n},Ye.fromRotation=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=0,n[5]=0,n[6]=0,n[7]=0,n},Ye.fromMat4=function(n,t){var r=zl.create();gx.getRotation(r,t);var a=new Qr.ARRAY_TYPE(3);return gx.getTranslation(a,t),RC(n,r,a),n},Ye.copy=_x,Ye.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n},Ye.set=function(n,t,r,a,l,u,d,h,p){return n[0]=t,n[1]=r,n[2]=a,n[3]=l,n[4]=u,n[5]=d,n[6]=h,n[7]=p,n},Ye.getDual=function(n,t){return n[0]=t[4],n[1]=t[5],n[2]=t[6],n[3]=t[7],n},Ye.setDual=function(n,t){return n[4]=t[0],n[5]=t[1],n[6]=t[2],n[7]=t[3],n},Ye.getTranslation=function(n,t){var r=t[4],a=t[5],l=t[6],u=t[7],d=-t[0],h=-t[1],p=-t[2],m=t[3];return n[0]=2*(r*m+u*d+a*p-l*h),n[1]=2*(a*m+u*h+l*d-r*p),n[2]=2*(l*m+u*p+r*h-a*d),n},Ye.translate=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=.5*r[0],p=.5*r[1],m=.5*r[2],_=t[4],y=t[5],x=t[6],b=t[7];return n[0]=a,n[1]=l,n[2]=u,n[3]=d,n[4]=d*h+l*m-u*p+_,n[5]=d*p+u*h-a*m+y,n[6]=d*m+a*p-l*h+x,n[7]=-a*h-l*p-u*m+b,n},Ye.rotateX=function(n,t,r){var a=-t[0],l=-t[1],u=-t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=h*d+_*a+p*u-m*l,x=p*d+_*l+m*a-h*u,b=m*d+_*u+h*l-p*a,E=_*d-h*a-p*l-m*u;return zl.rotateX(n,t,r),n[4]=y*(d=n[3])+E*(a=n[0])+x*(u=n[2])-b*(l=n[1]),n[5]=x*d+E*l+b*a-y*u,n[6]=b*d+E*u+y*l-x*a,n[7]=E*d-y*a-x*l-b*u,n},Ye.rotateY=function(n,t,r){var a=-t[0],l=-t[1],u=-t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=h*d+_*a+p*u-m*l,x=p*d+_*l+m*a-h*u,b=m*d+_*u+h*l-p*a,E=_*d-h*a-p*l-m*u;return zl.rotateY(n,t,r),n[4]=y*(d=n[3])+E*(a=n[0])+x*(u=n[2])-b*(l=n[1]),n[5]=x*d+E*l+b*a-y*u,n[6]=b*d+E*u+y*l-x*a,n[7]=E*d-y*a-x*l-b*u,n},Ye.rotateZ=function(n,t,r){var a=-t[0],l=-t[1],u=-t[2],d=t[3],h=t[4],p=t[5],m=t[6],_=t[7],y=h*d+_*a+p*u-m*l,x=p*d+_*l+m*a-h*u,b=m*d+_*u+h*l-p*a,E=_*d-h*a-p*l-m*u;return zl.rotateZ(n,t,r),n[4]=y*(d=n[3])+E*(a=n[0])+x*(u=n[2])-b*(l=n[1]),n[5]=x*d+E*l+b*a-y*u,n[6]=b*d+E*u+y*l-x*a,n[7]=E*d-y*a-x*l-b*u,n},Ye.rotateByQuatAppend=function(n,t,r){var a=r[0],l=r[1],u=r[2],d=r[3],h=t[0],p=t[1],m=t[2],_=t[3];return n[0]=h*d+_*a+p*u-m*l,n[1]=p*d+_*l+m*a-h*u,n[2]=m*d+_*u+h*l-p*a,n[3]=_*d-h*a-p*l-m*u,n[4]=(h=t[4])*d+(_=t[7])*a+(p=t[5])*u-(m=t[6])*l,n[5]=p*d+_*l+m*a-h*u,n[6]=m*d+_*u+h*l-p*a,n[7]=_*d-h*a-p*l-m*u,n},Ye.rotateByQuatPrepend=function(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=r[0],p=r[1],m=r[2],_=r[3];return n[0]=a*_+d*h+l*m-u*p,n[1]=l*_+d*p+u*h-a*m,n[2]=u*_+d*m+a*p-l*h,n[3]=d*_-a*h-l*p-u*m,n[4]=a*(_=r[7])+d*(h=r[4])+l*(m=r[6])-u*(p=r[5]),n[5]=l*_+d*p+u*h-a*m,n[6]=u*_+d*m+a*p-l*h,n[7]=d*_-a*h-l*p-u*m,n},Ye.rotateAroundAxis=function(n,t,r,a){if(Math.abs(a)<Qr.EPSILON)return _x(n,t);var l=Math.hypot(r[0],r[1],r[2]);a*=.5;var u=Math.sin(a),d=u*r[0]/l,h=u*r[1]/l,p=u*r[2]/l,m=Math.cos(a),_=t[0],y=t[1],x=t[2],b=t[3];n[0]=_*m+b*d+y*p-x*h,n[1]=y*m+b*h+x*d-_*p,n[2]=x*m+b*p+_*h-y*d,n[3]=b*m-_*d-y*h-x*p;var E=t[4],C=t[5],S=t[6],M=t[7];return n[4]=E*m+M*d+C*p-S*h,n[5]=C*m+M*h+S*d-E*p,n[6]=S*m+M*p+E*h-C*d,n[7]=M*m-E*d-C*h-S*p,n},Ye.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n[4]=t[4]+r[4],n[5]=t[5]+r[5],n[6]=t[6]+r[6],n[7]=t[7]+r[7],n},Ye.multiply=PC,Ye.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n},Ye.lerp=function(n,t,r,a){var l=1-a;return yx(t,r)<0&&(a=-a),n[0]=t[0]*l+r[0]*a,n[1]=t[1]*l+r[1]*a,n[2]=t[2]*l+r[2]*a,n[3]=t[3]*l+r[3]*a,n[4]=t[4]*l+r[4]*a,n[5]=t[5]*l+r[5]*a,n[6]=t[6]*l+r[6]*a,n[7]=t[7]*l+r[7]*a,n},Ye.invert=function(n,t){var r=Y_(t);return n[0]=-t[0]/r,n[1]=-t[1]/r,n[2]=-t[2]/r,n[3]=t[3]/r,n[4]=-t[4]/r,n[5]=-t[5]/r,n[6]=-t[6]/r,n[7]=t[7]/r,n},Ye.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=t[7],n},Ye.normalize=function(n,t){var r=Y_(t);if(r>0){r=Math.sqrt(r);var a=t[0]/r,l=t[1]/r,u=t[2]/r,d=t[3]/r,h=t[4],p=t[5],m=t[6],_=t[7],y=a*h+l*p+u*m+d*_;n[0]=a,n[1]=l,n[2]=u,n[3]=d,n[4]=(h-a*y)/r,n[5]=(p-l*y)/r,n[6]=(m-u*y)/r,n[7]=(_-d*y)/r}return n},Ye.str=function(n){return"quat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+")"},Ye.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]},Ye.equals=function(n,t){var r=n[0],a=n[1],l=n[2],u=n[3],d=n[4],h=n[5],p=n[6],m=n[7],_=t[0],y=t[1],x=t[2],b=t[3],E=t[4],C=t[5],S=t[6],M=t[7];return Math.abs(r-_)<=Qr.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(a-y)<=Qr.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(l-x)<=Qr.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(u-b)<=Qr.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-E)<=Qr.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(h-C)<=Qr.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-S)<=Qr.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(m-M)<=Qr.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))},Ye.sqrLen=Ye.squaredLength=Ye.len=Ye.length=Ye.dot=Ye.mul=Ye.setReal=Ye.getReal=void 0;var Qr=X_(Fn),zl=X_(Ce),gx=X_(ke);function AC(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(AC=function(a){return a?r:t})(n)}function X_(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==po(n)&&"function"!=typeof n)return{default:n};var r=AC(t);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}function RC(n,t,r){var a=.5*r[0],l=.5*r[1],u=.5*r[2],d=t[0],h=t[1],p=t[2],m=t[3];return n[0]=d,n[1]=h,n[2]=p,n[3]=m,n[4]=a*m+l*p-u*h,n[5]=l*m+u*d-a*p,n[6]=u*m+a*h-l*d,n[7]=-a*d-l*h-u*p,n}function _x(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n}function PC(n,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],h=r[4],p=r[5],m=r[6],_=r[7],y=t[4],x=t[5],b=t[6],E=t[7],C=r[0],S=r[1],M=r[2],D=r[3];return n[0]=a*D+d*C+l*M-u*S,n[1]=l*D+d*S+u*C-a*M,n[2]=u*D+d*M+a*S-l*C,n[3]=d*D-a*C-l*S-u*M,n[4]=a*_+d*h+l*m-u*p+y*D+E*C+x*M-b*S,n[5]=l*_+d*p+u*h-a*m+x*D+E*S+b*C-y*M,n[6]=u*_+d*m+a*p-l*h+b*D+E*M+y*S-x*C,n[7]=d*_-a*h-l*p-u*m+E*D-y*C-x*S-b*M,n}Ye.getReal=zl.copy,Ye.setReal=zl.copy,Ye.mul=PC;var yx=zl.dot;Ye.dot=yx;var OC=zl.length;Ye.length=OC,Ye.len=OC;var Y_=zl.squaredLength;Ye.squaredLength=Y_,Ye.sqrLen=Y_;var ze={};function Wp(n){return(Wp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}Object.defineProperty(ze,"__esModule",{value:!0}),ze.create=kC,ze.clone=function(n){var t=new vd.ARRAY_TYPE(2);return t[0]=n[0],t[1]=n[1],t},ze.fromValues=function(n,t){var r=new vd.ARRAY_TYPE(2);return r[0]=n,r[1]=t,r},ze.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n},ze.set=function(n,t,r){return n[0]=t,n[1]=r,n},ze.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n},ze.subtract=FC,ze.multiply=vx,ze.divide=xx,ze.ceil=function(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n},ze.floor=function(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n},ze.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n},ze.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n},ze.round=function(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n},ze.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},ze.scaleAndAdd=function(n,t,r,a){return n[0]=t[0]+r[0]*a,n[1]=t[1]+r[1]*a,n},ze.distance=bx,ze.squaredDistance=xd,ze.length=Zp,ze.squaredLength=wx,ze.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n},ze.inverse=function(n,t){return n[0]=1/t[0],n[1]=1/t[1],n},ze.normalize=function(n,t){var r=t[0],a=t[1],l=r*r+a*a;return l>0&&(l=1/Math.sqrt(l)),n[0]=t[0]*l,n[1]=t[1]*l,n},ze.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]},ze.cross=function(n,t,r){var a=t[0]*r[1]-t[1]*r[0];return n[0]=n[1]=0,n[2]=a,n},ze.lerp=function(n,t,r,a){var l=t[0],u=t[1];return n[0]=l+a*(r[0]-l),n[1]=u+a*(r[1]-u),n},ze.random=function(n,t){t=t||1;var r=2*vd.RANDOM()*Math.PI;return n[0]=Math.cos(r)*t,n[1]=Math.sin(r)*t,n},ze.transformMat2=function(n,t,r){var a=t[0],l=t[1];return n[0]=r[0]*a+r[2]*l,n[1]=r[1]*a+r[3]*l,n},ze.transformMat2d=function(n,t,r){var a=t[0],l=t[1];return n[0]=r[0]*a+r[2]*l+r[4],n[1]=r[1]*a+r[3]*l+r[5],n},ze.transformMat3=function(n,t,r){var a=t[0],l=t[1];return n[0]=r[0]*a+r[3]*l+r[6],n[1]=r[1]*a+r[4]*l+r[7],n},ze.transformMat4=function(n,t,r){var a=t[0],l=t[1];return n[0]=r[0]*a+r[4]*l+r[12],n[1]=r[1]*a+r[5]*l+r[13],n},ze.rotate=function(n,t,r,a){var l=t[0]-r[0],u=t[1]-r[1],d=Math.sin(a),h=Math.cos(a);return n[0]=l*h-u*d+r[0],n[1]=l*d+u*h+r[1],n},ze.angle=function(n,t){var r=n[0],a=n[1],l=t[0],u=t[1],d=Math.sqrt(r*r+a*a)*Math.sqrt(l*l+u*u);return Math.acos(Math.min(Math.max(d&&(r*l+a*u)/d,-1),1))},ze.zero=function(n){return n[0]=0,n[1]=0,n},ze.str=function(n){return"vec2("+n[0]+", "+n[1]+")"},ze.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]},ze.equals=function(n,t){var r=n[0],a=n[1],l=t[0],u=t[1];return Math.abs(r-l)<=vd.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-u)<=vd.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},ze.forEach=ze.sqrLen=ze.sqrDist=ze.dist=ze.div=ze.mul=ze.sub=ze.len=void 0;var vd=function(n,t){if(n&&n.__esModule)return n;if(null===n||"object"!==Wp(n)&&"function"!=typeof n)return{default:n};var r=Nh(void 0);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}(Fn);function Nh(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Nh=function(a){return a?r:t})(n)}function kC(){var n=new vd.ARRAY_TYPE(2);return vd.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0),n}function FC(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n}function vx(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n}function xx(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n}function bx(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1])}function xd(n,t){var r=t[0]-n[0],a=t[1]-n[1];return r*r+a*a}function Zp(n){return Math.hypot(n[0],n[1])}function wx(n){var t=n[0],r=n[1];return t*t+r*r}ze.len=Zp,ze.sub=FC,ze.mul=vx,ze.div=xx,ze.dist=bx,ze.sqrDist=xd,ze.sqrLen=wx;var Ex=function(){var n=kC();return function(t,r,a,l,u,d){var h,p;for(r||(r=2),a||(a=0),p=l?Math.min(l*r+a,t.length):t.length,h=a;h<p;h+=r)n[0]=t[h],n[1]=t[h+1],u(n,n,d),t[h]=n[0],t[h+1]=n[1];return t}}();function zh(n){return(zh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}ze.forEach=Ex,Object.defineProperty(kr,"__esModule",{value:!0});var Ln=kr.vec4=q=kr.vec3=kr.vec2=kr.quat2=to=kr.quat=rt=kr.mat4=Yo=kr.mat3=kr.mat2d=Bh=kr.mat2=kr.glMatrix=void 0,OA=Bl(Fn);kr.glMatrix=OA;var kA=Bl(Jn),Bh=kr.mat2=kA,FA=Bl(Ri);kr.mat2d=FA;var LA=Bl(Vn),Yo=kr.mat3=LA,K_=Bl(ke),rt=kr.mat4=K_,Cx=Bl(Ce),to=kr.quat=Cx,NA=Bl(Ye);kr.quat2=NA;var Mx=Bl(ze);kr.vec2=Mx;var LC=Bl(Ae),q=kr.vec3=LC,NC=Bl(We);function Sx(n){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Sx=function(a){return a?r:t})(n)}function Bl(n,t){if(!t&&n&&n.__esModule)return n;if(null===n||"object"!==zh(n)&&"function"!=typeof n)return{default:n};var r=Sx(t);if(r&&r.has(n))return r.get(n);var a={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in n)if("default"!==u&&Object.prototype.hasOwnProperty.call(n,u)){var d=l?Object.getOwnPropertyDescriptor(n,u):null;d&&(d.get||d.set)?Object.defineProperty(a,u,d):a[u]=n[u]}return a.default=n,r&&r.set(n,a),a}Ln=kr.vec4=NC;const IF=yn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:bd}=IF,zC=yn([{name:"a_pos_3",components:3,type:"Int16"}]);var xc=yn([{name:"a_pos",type:"Int16",components:2}]),Tx={};!function(r){function a(u,d,h){var p=l(256*u,256*(d=Math.pow(2,h)-d-1),h),m=l(256*(u+1),256*(d+1),h);return p[0]+","+p[1]+","+m[0]+","+m[1]}function l(u,d,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[u*p-2*Math.PI*6378137/2,d*p-2*Math.PI*6378137/2]}r.getURL=function(u,d,h,p,m,_){return _=_||{},u+"?"+["bbox="+a(h,p,m),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+d].join("&")},r.getTileBBox=a,r.getMercCoords=l,Object.defineProperty(r,"__esModule",{value:!0})}(Tx);var BC=Tx;class ya{constructor(t,r,a){this.z=t,this.x=r,this.y=a,this.key=bc(0,t,t,r,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r){const a=BC.getTileBBox(this.x,this.y,this.z),l=function(u,d,h){let p,m="";for(let _=u;_>0;_--)p=1<<_-1,m+=(d&p?1:0)+(h&p?2:0);return m}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class J_{constructor(t,r){this.wrap=t,this.canonical=r,this.key=bc(t,r.z,r.z,r.x,r.y)}}class tn{constructor(t,r,a,l,u){this.overscaledZ=t,this.wrap=r,this.canonical=new ya(a,+l,+u),this.key=0===r&&t===a?this.canonical.key:bc(r,t,a,l,u)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new tn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new tn(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return bc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-t;return bc(this.wrap*+r,t,t,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new tn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new tn(r,this.wrap,r,a,l),new tn(r,this.wrap,r,a+1,l),new tn(r,this.wrap,r,a,l+1),new tn(r,this.wrap,r,a+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new tn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new tn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new J_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function bc(n,t,r,a,l){const u=1<<Math.min(r,22);let d=u*(l%u)+a%u;return n&&r<22&&(d+=u*u*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*d+r)+(t-r)}const Dx=[n=>{let t=n.canonical.x-1,r=n.wrap;return t<0&&(t=(1<<n.canonical.z)-1,r--),new tn(n.overscaledZ,r,n.canonical.z,t,n.canonical.y)},n=>{let t=n.canonical.x+1,r=n.wrap;return t===1<<n.canonical.z&&(t=0,r++),new tn(n.overscaledZ,r,n.canonical.z,t,n.canonical.y)},n=>new tn(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(0===n.canonical.y?1<<n.canonical.z:n.canonical.y)-1),n=>new tn(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Xt(ya,"CanonicalTileID"),Xt(tn,"OverscaledTileID",{omit:["projMatrix"]});class Vh{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,a){const l=q.dot(r,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/l;return a[0]=this.pos[0]+this.dir[0]*u,a[1]=this.pos[1]+this.dir[1]*u,a[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(t,r,a){if(q.equals(this.pos,t)||0===r)return a[0]=a[1]=a[2]=0,!1;const[l,u,d]=this.dir,h=this.pos[0]-t[0],p=this.pos[1]-t[1],m=this.pos[2]-t[2],_=l*l+u*u+d*d,y=2*(h*l+p*u+m*d),x=y*y-4*_*(h*h+p*p+m*m-r*r);if(x<0){const b=Math.max(-y/2,0),E=h+l*b,C=p+u*b,S=m+d*b,M=Math.hypot(E,C,S);return a[0]=E*r/M,a[1]=C*r/M,a[2]=S*r/M,!1}{const b=(-y-Math.sqrt(x))/(2*_);if(b<0){const E=Math.hypot(h,p,m);return a[0]=h*r/E,a[1]=p*r/E,a[2]=m*r/E,!1}return a[0]=h+l*b,a[1]=p+u*b,a[2]=m+d*b,!0}}}class jh{constructor(t,r,a,l,u){this.TL=t,this.TR=r,this.BR=a,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(t,r,a){const l=[-1,1,1],u=[1,1,1],d=[1,-1,1],h=[-1,-1,1],p=q.transformMat4(l,l,t),m=q.transformMat4(u,u,t),_=q.transformMat4(d,d,t),y=q.transformMat4(h,h,t);return new jh(p,m,_,y,r/a)}}function Uh(n,t,r){let a=1/0,l=-1/0;const u=[];for(const d of n){q.sub(u,d,t);const h=q.dot(u,r);a=Math.min(a,h),l=Math.max(l,h)}return[a,l]}function Q_(n,t){let r=!0;for(let a=0;a<n.planes.length;a++){const l=n.planes[a];let u=0;for(let d=0;d<t.length;d++)u+=q.dot(l,t[d])+l[3]>=0;if(0===u)return 0;u!==t.length&&(r=!1)}return r?2:1}function Hh(n,t){for(const r of n.projections){const a=Uh(t,n.points[0],r.axis);if(r.projection[1]<a[0]||r.projection[0]>a[1])return 0}return 1}function VC(n,t){let r=0;const a=[0,0,0,0];for(let l=0;l<n.length;l++)a[0]=n[l][0],a[1]=n[l][1],a[2]=n[l][2],a[3]=1,Ln.dot(a,t)>=0&&r++;return r}class Vl{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=ui.fromPoints(this.points),this.projections=[],this.frustumEdges=[q.sub([],this.points[2],this.points[3]),q.sub([],this.points[0],this.points[3]),q.sub([],this.points[4],this.points[0]),q.sub([],this.points[5],this.points[1]),q.sub([],this.points[6],this.points[2]),q.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const l=[0,-a[2],a[1]],u=[a[2],0,-a[0]];this.projections.push({axis:l,projection:Uh(this.points,this.points[0],l)}),this.projections.push({axis:u,projection:Uh(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(t,r,a,l){const u=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(m=>{const _=Ln.transformMat4([],m,t),y=1/_[3]/r*u;return Ln.mul(_,_,[y,y,l?1/_[3]:y,y])}),h=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(m=>{const _=q.sub([],d[m[0]],d[m[1]]),y=q.sub([],d[m[2]],d[m[1]]),x=q.normalize([],q.cross([],_,y)),b=-q.dot(x,d[m[1]]);return x.concat(b)}),p=[];for(let m=0;m<d.length;m++)p.push([d[m][0],d[m][1],d[m][2]]);return new Vl(p,h)}intersectsPrecise(t,r,a){for(let l=0;l<r.length;l++)if(!VC(t,r[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!VC(t,this.planes[l]))return 0;for(const l of a)for(const u of this.frustumEdges){const d=q.cross([],l,u),h=q.length(d);if(0===h)continue;q.scale(d,d,1/h);const p=Uh(this.points,this.points[0],d),m=Uh(t,this.points[0],d);if(p[0]>m[1]||m[0]>p[1])return 0}return 1}}class ui{static fromPoints(t){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const l of t)q.min(r,r,l),q.max(a,a,l);return new ui(r,a)}static fromTileIdAndHeight(t,r,a){const l=1<<t.canonical.z,u=t.canonical.x,d=t.canonical.y;return new ui([u/l,d/l,r],[(u+1)/l,(d+1)/l,a])}static applyTransform(t,r){const a=t.getCorners();for(let l=0;l<a.length;++l)q.transformMat4(a[l],a[l],r);return ui.fromPoints(a)}static projectAabbCorners(t,r){const a=t.getCorners();for(let l=0;l<a.length;++l)q.transformMat4(a[l],a[l],r);return a}constructor(t,r){this.min=t,this.max=r,this.center=q.scale([],q.add([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],a=q.clone(this.min),l=q.clone(this.max);for(let u=0;u<r.length;u++)a[u]=r[u]?this.min[u]:this.center[u],l[u]=r[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new ui(a,l)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Q_(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Q_(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,r){return r||this.intersects(t)?Hh(t,this.getCorners()):0}intersectsPreciseFlat(t,r){return r||this.intersectsFlat(t)?Hh(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let r=0;r<3;++r)if(this.min[r]>t.max[r]||t.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t.min[r]),this.max[r]=Math.max(this.max[r],t.max[r])}encapsulatePoint(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t[r]),this.max[r]=Math.max(this.max[r],t[r])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Xt(ui,"Aabb");const Xp=5,_u=6,Po=dt/Math.PI/2,jC=16383,Yp=[64,32,16],Oo=-Po,va=Po,zA=[new ui([Oo,Oo,Oo],[va,va,va]),new ui([Oo,Oo,Oo],[0,0,va]),new ui([0,Oo,Oo],[va,0,va]),new ui([Oo,0,Oo],[0,va,va]),new ui([0,0,Oo],[va,va,va])];function Ix(n){return n*Po/wd}function UC(n,t,r,a=!0){const l=q.scale([],n._camera.position,n.worldSize),u=[t,r,1,1];Ln.transformMat4(u,u,n.pixelMatrixInverse),Ln.scale(u,u,1/u[3]);const d=q.sub([],u,l),h=q.normalize([],d),p=n.globeMatrix,m=[p[12],p[13],p[14]],_=q.sub([],m,l),y=q.length(_),x=q.normalize([],_),b=n.worldSize/(2*Math.PI),E=q.dot(x,h),C=Math.asin(b/y);if(C<Math.acos(E)){if(!a)return null;const U=[],V=[];q.scale(U,h,y/E),q.normalize(V,q.sub(V,U,_)),q.normalize(h,q.add(h,_,q.scale(h,V,Math.tan(C)*y)))}const S=[];new Vh(l,h).closestPointOnSphere(m,b,S);const M=q.normalize([],zi(p,0)),D=q.normalize([],zi(p,1)),R=q.normalize([],zi(p,2)),P=q.dot(M,S),I=q.dot(D,S),O=q.dot(R,S),F=Cr(Math.asin(-I/b));let L=Cr(Math.atan2(P,O));L=n.center.lng+function(U,V){const G=(V-U+180)%360-180;return G<-180?G+360:G}(n.center.lng,L);const N=no(L),z=Jt(mo(F),0,1);return new Je(N,z)}class Ax{constructor(t,r,a){this.a=q.sub([],t,a),this.b=q.sub([],r,a),this.center=a;const l=q.normalize([],this.a),u=q.normalize([],this.b);this.angle=Math.acos(q.dot(l,u))}}function Rx(n,t){if(0===n.angle)return null;let r;return r=0===n.a[t]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[t]/n.a[t]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(a,l,u,d){const h=Math.sin(u);return a*(Math.sin((1-d)*u)/h)+l*(Math.sin(d*u)/h)}(n.a[t],n.b[t],n.angle,Jt(r,0,1))+n.center[t]}function ko(n){if(n.z<=1)return zA[n.z+2*n.y+n.x];const t=Ec(Kp(n));return ui.fromPoints(t)}function xa(n,t,r){return q.scale(n,n,1-r),q.scaleAndAdd(n,n,t,r)}function ty(n,t){const r=Vr(t.zoom);if(0===r)return ko(n);const a=Kp(n),l=Ec(a),u=no(a.getWest())*t.worldSize,d=no(a.getEast())*t.worldSize,h=mo(a.getNorth())*t.worldSize,p=mo(a.getSouth())*t.worldSize,m=[u,h,0],_=[d,h,0],y=[u,p,0],x=[d,p,0],b=rt.invert([],t.globeMatrix);return q.transformMat4(m,m,b),q.transformMat4(_,_,b),q.transformMat4(y,y,b),q.transformMat4(x,x,b),l[0]=xa(l[0],y,r),l[1]=xa(l[1],x,r),l[2]=xa(l[2],_,r),l[3]=xa(l[3],m,r),ui.fromPoints(l)}function Px(n,t,r){for(const a of n)q.transformMat4(a,a,t),q.scale(a,a,r)}function ey(n,t,r,a){const l=t/n.worldSize,u=n.globeMatrix;if(r.z<=1){const N=ko(r).getCorners();return Px(N,u,l),ui.fromPoints(N)}const d=Kp(r,a),h=Ec(d);Px(h,u,l);const p=Number.MAX_VALUE,m=[-p,-p,-p],_=[p,p,p];if(d.contains(n.center)){for(const U of h)q.min(_,_,U),q.max(m,m,U);m[2]=0;const N=n.point,z=[N.x*l,N.y*l,0];return q.min(_,_,z),q.max(m,m,z),new ui(_,m)}const y=[u[12]*l,u[13]*l,u[14]*l],x=d.getCenter(),b=Jt(n.center.lat,-Gi,Gi),E=Jt(x.lat,-Gi,Gi),C=no(n.center.lng),S=mo(b);let M=C-no(x.lng);const D=S-mo(E);M>.5?M-=1:M<-.5&&(M+=1);let R=0;if(Math.abs(M)>Math.abs(D))R=M>=0?1:3;else{R=D>=0?0:2;const N=[u[4]*l,u[5]*l,u[6]*l],z=-Math.sin(Ie(D>=0?d.getSouth():d.getNorth()))*Po;q.scaleAndAdd(y,y,N,z)}const P=h[R],I=h[(R+1)%4],O=new Ax(P,I,y),F=[Rx(O,0)||P[0],Rx(O,1)||P[1],Rx(O,2)||P[2]],L=Vr(n.zoom);if(L>0){const N=function({x:U,y:V,z:G},j,Z,et,it){const X=1/(1<<G);let Y=U*X,ot=Y+X,lt=V*X,ht=lt+X,mt=0;const vt=(Y+ot)/2-et;return vt>.5?mt=-1:vt<-.5&&(mt=1),Y=((Y+mt)*j-(et*=j))*Z+et,ot=((ot+mt)*j-et)*Z+et,lt=(lt*j-(it*=j))*Z+it,ht=(ht*j-it)*Z+it,[[Y,ht,0],[ot,ht,0],[ot,lt,0],[Y,lt,0]]}(r,t,n._pixelsPerMercatorPixel,C,S);for(let U=0;U<h.length;U++)xa(h[U],N[U],L);const z=q.add([],N[R],N[(R+1)%4]);q.scale(z,z,.5),xa(F,z,L)}for(const N of h)q.min(_,_,N),q.max(m,m,N);return _[2]=Math.min(P[2],I[2]),q.min(_,_,F),q.max(m,m,F),new ui(_,m)}function Kp({x:n,y:t,z:r},a=!1){const l=1/(1<<r),u=new we(Ts(n*l),t===(1<<r)-1&&a?-90:lr((t+1)*l)),d=new we(Ts((n+1)*l),0===t&&a?90:lr(t*l));return new Zs(u,d)}function Ec(n){const t=Ie(n.getNorth()),r=Ie(n.getSouth()),a=Math.cos(t),l=Math.cos(r),u=Math.sin(t),d=Math.sin(r),h=n.getWest(),p=n.getEast();return[$h(l,d,h),$h(l,d,p),$h(a,u,p),$h(a,u,h)]}function $h(n,t,r,a=Po){return r=Ie(r),[n*Math.sin(r)*a,-t*a,n*Math.cos(r)*a]}function cs(n,t,r){return $h(Math.cos(Ie(n)),Math.sin(Ie(n)),t,r)}function Jp(n,t,r,a){const l=1<<r.z,u=(n/dt+r.x)/l;return cs(lr((t/dt+r.y)/l),Ts(u),a)}function ny({min:n,max:t}){return jC/Math.max(t[0]-n[0],t[1]-n[1],t[2]-n[2])}const HC=new Float64Array(16);function eo(n){const t=ny(n),r=rt.fromScaling(HC,[t,t,t]);return rt.translate(r,r,q.negate([],n.min))}function ba(n){const t=rt.fromTranslation(HC,n.min),r=1/ny(n);return rt.scale(t,t,[r,r,r])}function Ox(n){const t=dt/(2*Math.PI);return n/(2*Math.PI)/t}function $C(n,t){return dt/(512*Math.pow(2,n))*ny(ko(t))}function GC(n,t,r,a,l){const u=Ox(r),d=[n,t,-r/(2*Math.PI)],h=rt.identity(new Float64Array(16));return rt.translate(h,h,d),rt.scale(h,h,[u,u,u]),rt.rotateX(h,h,Ie(-l)),rt.rotateY(h,h,Ie(-a)),h}function Vr(n){return bl(Xp,_u,n)}function qC(n,t,r){const a=rt.identity(new Float64Array(16)),l=(t/(1<<n)-.5)*Math.PI*2;return rt.rotateY(a,r.globeMatrix,l),Float32Array.from(a)}function WC(n,t,r){const a=Vr(r.zoom),l=n.style.map._antialias,u=t.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===a&&!l&&!u}function ZC(n,t,r,a){const l=t.getNorth(),u=t.getSouth(),d=t.getWest(),h=t.getEast(),p=1<<n.z,m=h-d,_=l-u,y=m/64,x=-_/Yp[r],b=[0,y,0,x,0,0,l,d,0];if(n.z>0){const E=180/a;Yo.multiply(b,b,[E/m+1,0,0,0,E/_+1,0,-.5*E/y,.5*E/x,1])}return b[2]=p,b[5]=n.x,b[8]=n.y,b}function BA(n){const t=Gi-5;n=Jt(n,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(Ie(n))),3);return Math.round(r*(Yp.length-1))}function XC(n){const t=[0,0,0],r=rt.identity(new Float64Array(16));return rt.multiply(r,n.pixelMatrix,n.globeMatrix),q.transformMat4(t,t,r),new nt(t[0],t[1])}function YC(n,t){const r=cs(t.lat,t.lng),a=function(u){const d=cs(u._center.lat,u._center.lng),h=q.fromValues(0,1,0);let p=q.cross([],h,d);const m=rt.fromRotation([],-u.angle,d);p=q.transformMat4(p,p,m),rt.fromRotation(m,-u._pitch,p);const _=q.normalize([],d);return q.scale(_,_,Ix(u.cameraToCenterDistance/u.pixelsPerMeter)),q.transformMat4(_,_,m),q.add([],d,_)}(n),l=q.subtract([],a,r);return q.angle(l,r)}function iy(n,t){return YC(n,t)>Math.PI/2*1.01}const Qp=Ie(85),Cc=Math.cos(Qp),tm=Math.sin(Qp);class KC{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,r){const a=new Zo,l=new er,u=[],d=t+1+2,h=r[0]+1,p=r[0]+1+(1+r.length),m=(_,y,x)=>{let b=_===d-1?_-2:0===_?_:_-1;return b+=x?24575:0,[b,y]};for(let _=0;_<d;++_)a.emplaceBack(...m(_,0,!0));for(let _=0;_<h;++_)for(let y=0;y<d;++y)a.emplaceBack(...m(y,_,(0===y||y===d-1)&&!0));for(let _=0;_<r.length;++_){const y=r[_];for(let x=0;x<d;++x)a.emplaceBack(...m(x,y,!0))}for(let _=0;_<r.length;++_){const y=l.length,x=r[_]+1+2,b=new er;for(let S=0;S<x-1;S++){const M=S===x-2,D=M?d*(p-r.length+_-S):d;for(let R=0;R<d-1;R++){const P=S*d+R;0===S||M||0===R||R===d-2?(b.emplaceBack(P+1,P,P+D),b.emplaceBack(P+D,P+D+1,P+1)):(l.emplaceBack(P+1,P,P+D),l.emplaceBack(P+D,P+D+1,P+1))}}const E=Bn.simpleSegment(0,y,a.length,l.length-y);for(let S=0;S<b.uint16.length;S+=3)l.emplaceBack(b.uint16[S],b.uint16[S+1],b.uint16[S+2]);const C=Bn.simpleSegment(0,y,a.length,l.length-y);u.push({withoutSkirts:E,withSkirts:C})}return{vertices:a,indices:l,segments:u}}_createGrid(t){const r=this._fillGridMeshWithLods(64,Yp);this._gridSegments=r.segments,this._gridBuffer=t.createVertexBuffer(r.vertices,xc.members),this._gridIndexBuffer=t.createIndexBuffer(r.indices,!0)}_createPoles(t){const r=new er;for(let h=0;h<=64;h++)r.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(r,!0);const a=new ma,l=new ma,u=new ma,d=new ma;this._poleSegments=[];for(let h=0,p=0;h<Xp;h++){const m=360/(1<<h);a.emplaceBack(0,-Po,0,.5,0),l.emplaceBack(0,-Po,0,.5,1),u.emplaceBack(0,-Po,0,.5,.5),d.emplaceBack(0,-Po,0,.5,.5);for(let _=0;_<=64;_++){let y=_/64,x=0;const b=_e(0,m,y),[E,C,S]=$h(Cc,tm,b,Po);a.emplaceBack(E,C,S,y,x),l.emplaceBack(E,C,S,y,1-x);const M=Ie(b);y=.5+.5*Math.sin(M),x=.5+.5*Math.cos(M),u.emplaceBack(E,C,S,y,x),d.emplaceBack(E,C,S,y,1-x)}this._poleSegments.push(Bn.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(a,bd,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(l,bd,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,bd,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,bd,!1)}getGridBuffers(t,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}const wd=6371008.8,ry=2*Math.PI*wd;class Ed{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ed(wl(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,a=this.lat*r,l=t.lat*r,u=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return wd*Math.acos(Math.min(u,1))}toBounds(t=0){const r=360*t/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Zs(new Ed(this.lng-a,this.lat-r),new Ed(this.lng+a,this.lat+r))}toEcef(t){const r=Ix(t);return cs(this.lat,this.lng,Po+r)}static convert(t){if(t instanceof Ed)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Ed(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Ed(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var we=Ed;const AF=0,kx=25.5;function Gh(n){return ry*Math.cos(n*Math.PI/180)}function no(n){return(180+n)/360}function mo(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Nn(n,t){return n/Gh(t)}function Ts(n){return 360*n-180}function lr(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function JC(n,t){return n*Gh(lr(t))}const Gi=85.051129;function Fx(n){return Math.cos(Ie(Jt(n,-Gi,Gi)))}function Za(n,t){const r=Jt(t,AF,kx),a=Math.pow(2,r);return Fx(n)*ry/(512*a)}function oy(n){return 1/Math.cos(n*Math.PI/180)}function Cd(n,t=0){const r=Math.exp(Math.PI*(1-(n.y+t/dt)/(1<<n.z)*2));return 80150034*r/(r*r+1)/dt/(1<<n.z)}class Je{constructor(t,r,a=0){this.x=+t,this.y=+r,this.z=+a}static fromLngLat(t,r=0){const a=we.convert(t);return new Je(no(a.lng),mo(a.lat),Nn(r,a.lat))}toLngLat(){return new we(Ts(this.x),lr(this.y))}toAltitude(){return JC(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ry*oy(lr(this.y))}}function io(n,t,r,a,l,u,d,h,p){const m=(t+a)/2,_=(r+l)/2,y=new nt(m,_);h(y),function(x,b,E,C,S,M){const D=E-S,R=C-M;return Math.abs((C-b)*D-(E-x)*R)/Math.hypot(D,R)}(y.x,y.y,u.x,u.y,d.x,d.y)>=p?(io(n,t,r,m,_,u,y,h,p),io(n,m,_,a,l,y,d,h,p)):n.push(d)}function QC(n,t,r){let a=n[0],l=a.x,u=a.y;t(a);const d=[a];for(let h=1;h<n.length;h++){const p=n[h],{x:m,y:_}=p;t(p),io(d,l,u,m,_,a,p,t,r),l=m,u=_,a=p}return d}function Lx(n,t,r,a){if(a(t,r)){const l=t.add(r)._mult(.5);Lx(n,t,l,a),Lx(n,l,r,a)}else n.push(r)}function tM(n,t){let r=n[0];const a=[r];for(let l=1;l<n.length;l++){const u=n[l];Lx(a,r,u,t),r=u}return a}const sy=Math.pow(2,14)-1,eM=-sy-1;function VA(n,t){const r=Math.round(n.x*t),a=Math.round(n.y*t);return n.x=Jt(r,eM,sy),n.y=Jt(a,eM,sy),(r<n.x||r>n.x+1||a<n.y||a>n.y+1)&&tt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function jl(n,t,r){const a=n.loadGeometry(),l=n.extent,u=dt/l;if(t&&r&&r.projection.isReprojectedInTileSpace){const d=1<<t.z,{scale:h,x:p,y:m,projection:_}=r,y=x=>{const b=Ts((t.x+x.x/l)/d),E=lr((t.y+x.y/l)/d),C=_.project(b,E);x.x=(C.x*h-p)*l,x.y=(C.y*h-m)*l};for(let x=0;x<a.length;x++)if(1!==n.type)a[x]=QC(a[x],y,1);else{const b=[];for(const E of a[x])E.x<0||E.x>=l||E.y<0||E.y>=l||(y(E),b.push(E));a[x]=b}}for(const d of a)for(const h of d)VA(h,u);return a}function yu(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?jl(n):[]}}function em(n,t,r,a,l){n.emplaceBack(2*t+(a+1)/2,2*r+(l+1)/2)}function Nx(n,t,r){n.emplaceBack(t.x,t.y,t.z,16384*r[0],16384*r[1],16384*r[2])}class nM{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Zo,this.indexArray=new er,this.segments=new Bn,this.programConfigurations=new pd(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a,l){const u=this.layers[0],d=[];let h=null;"circle"===u.type&&(h=u.layout.get("circle-sort-key"));for(const{feature:m,id:_,index:y,sourceLayerIndex:x}of t){const b=this.layers[0]._featureFilter.needGeometry,E=yu(m,b);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),E,a))continue;const C=h?h.evaluate(E,{},a):void 0,S={id:_,properties:m.properties,type:m.type,sourceLayerIndex:x,index:y,geometry:b?E.geometry:jl(m,a,l),patterns:{},sortKey:C};d.push(S)}h&&d.sort((m,_)=>m.sortKey-_.sortKey);let p=null;"globe"===l.projection.name&&(this.globeExtVertexArray=new Fp,p=l.projection);for(const m of d){const{geometry:_,index:y,sourceLayerIndex:x}=m,b=t[y].feature;this.addFeature(m,_,y,r.availableImages,a,p,r.brightness),r.featureIndex.insert(b,_,y,x,this.index)}}update(t,r,a,l,u){const d=0!==Object.keys(t).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,d?this.stateDependentLayers:this.layers,a,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vA.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,kl.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,r,a,l,u,d,h){for(const p of r)for(const m of p){const _=m.x,y=m.y;if(_<0||_>=dt||y<0||y>=dt)continue;if(d){const E=d.projectTilePoint(_,y,u),C=d.upVector(u,_,y),S=this.globeExtVertexArray;Nx(S,E,C),Nx(S,E,C),Nx(S,E,C),Nx(S,E,C)}const x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),b=x.vertexLength;em(this.layoutVertexArray,_,y,-1,-1),em(this.layoutVertexArray,_,y,1,-1),em(this.layoutVertexArray,_,y,1,1),em(this.layoutVertexArray,_,y,-1,1),this.indexArray.emplaceBack(b,b+1,b+2),this.indexArray.emplaceBack(b,b+2,b+3),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},l,u,h)}}function qh(n,t){for(let r=0;r<n.length;r++)if(Xa(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Xa(n,t[r]))return!0;return!!im(n,t)}function nm(n,t,r){return!!Xa(n,t)||!!Vx(t,n,r)}function zx(n,t){if(1===n.length)return Ux(t,n[0]);for(let r=0;r<t.length;r++){const a=t[r];for(let l=0;l<a.length;l++)if(Xa(n,a[l]))return!0}for(let r=0;r<n.length;r++)if(Ux(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(im(n,t[r]))return!0;return!1}function iM(n,t,r){if(n.length>1){if(im(n,t))return!0;for(let a=0;a<t.length;a++)if(Vx(t[a],n,r))return!0}for(let a=0;a<n.length;a++)if(Vx(n[a],t,r))return!0;return!1}function im(n,t){if(0===n.length||0===t.length)return!1;for(let r=0;r<n.length-1;r++){const a=n[r],l=n[r+1];for(let u=0;u<t.length-1;u++)if(Bx(a,l,t[u],t[u+1]))return!0}return!1}function Bx(n,t,r,a){return wt(n,r,a)!==wt(t,r,a)&&wt(n,t,r)!==wt(n,t,a)}function Vx(n,t,r){const a=r*r;if(1===t.length)return n.distSqr(t[0])<a;for(let l=1;l<t.length;l++)if(jx(n,t[l-1],t[l])<a)return!0;return!1}function jx(n,t,r){const a=t.distSqr(r);if(0===a)return n.distSqr(t);const l=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/a;return n.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function Ux(n,t){let r,a,l,u=!1;for(let d=0;d<n.length;d++){r=n[d];for(let h=0,p=r.length-1;h<r.length;p=h++)a=r[h],l=r[p],a.y>t.y!=l.y>t.y&&t.x<(l.x-a.x)*(t.y-a.y)/(l.y-a.y)+a.x&&(u=!u)}return u}function Xa(n,t){let r=!1;for(let a=0,l=n.length-1;a<n.length;l=a++){const u=n[a],d=n[l];u.y>t.y!=d.y>t.y&&t.x<(d.x-u.x)*(t.y-u.y)/(d.y-u.y)+u.x&&(r=!r)}return r}function jA(n,t,r,a,l){for(const d of n)if(t<=d.x&&r<=d.y&&a>=d.x&&l>=d.y)return!0;const u=[new nt(t,r),new nt(t,l),new nt(a,l),new nt(a,r)];if(n.length>2)for(const d of u)if(Xa(n,d))return!0;for(let d=0;d<n.length-1;d++)if(Hx(n[d],n[d+1],u))return!0;return!1}function Hx(n,t,r){const a=r[0],l=r[2];if(n.x<a.x&&t.x<a.x||n.x>l.x&&t.x>l.x||n.y<a.y&&t.y<a.y||n.y>l.y&&t.y>l.y)return!1;const u=wt(n,t,r[0]);return u!==wt(n,t,r[1])||u!==wt(n,t,r[2])||u!==wt(n,t,r[3])}function Wh(n,t,r,a,l,u){let d=t.y-n.y,h=n.x-t.x;if(u=u||0){const p=d*d+h*h;if(0===p)return!0;const m=Math.sqrt(p);d/=m,h/=m}return!((r.x-n.x)*d+(r.y-n.y)*h-u<0||(a.x-n.x)*d+(a.y-n.y)*h-u<0||(l.x-n.x)*d+(l.y-n.y)*h-u<0)}function rm(n,t,r,a,l,u,d){return!(Wh(n,t,a,l,u,d)||Wh(t,r,a,l,u,d)||Wh(r,n,a,l,u,d)||Wh(a,l,n,t,r,d)||Wh(l,u,n,t,r,d)||Wh(u,a,n,t,r,d))}function Md(n,t,r){const a=t.paint.get(n).value;return"constant"===a.kind?a.value:r.programConfigurations.get(t.id).getMaxValue(n)}function om(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function vu(n,t,r,a,l){if(!t[0]&&!t[1])return n;const u=nt.convert(t)._mult(l);"viewport"===r&&u._rotate(-a);const d=[];for(let h=0;h<n.length;h++)d.push(n[h].sub(u));return d}function rM(n,t,r,a){const l=nt.convert(n)._mult(a);return"viewport"===t&&l._rotate(-r),l}Xt(nM,"CircleBucket",{omit:["layers"]});const $x=new Ci({"circle-sort-key":new se(J.layout_circle["circle-sort-key"]),visibility:new Dt(J.layout_circle.visibility)});var ay={paint:new Ci({"circle-radius":new se(J.paint_circle["circle-radius"]),"circle-color":new se(J.paint_circle["circle-color"]),"circle-blur":new se(J.paint_circle["circle-blur"]),"circle-opacity":new se(J.paint_circle["circle-opacity"]),"circle-translate":new Dt(J.paint_circle["circle-translate"]),"circle-translate-anchor":new Dt(J.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dt(J.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dt(J.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new se(J.paint_circle["circle-stroke-width"]),"circle-stroke-color":new se(J.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new se(J.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Dt(J.paint_circle["circle-emissive-strength"])}),layout:$x};const UA=rt.create(),Gx=(n,t,r,a,l,u)=>{const d=n.transform,h="globe"===d.projection.name;let p;if("map"===u.paint.get("circle-pitch-alignment"))if(h){const _=$C(d.zoom,t.canonical)*d._pixelsPerMercatorPixel;p=Float32Array.from([_,0,0,_])}else p=d.calculatePixelsToTileUnitsMatrix(r);else p=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const m={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(d.projection),u_matrix:n.translatePosMatrix(t.projMatrix,r,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:kt.devicePixelRatio,u_extrude_scale:p,u_inv_rot_matrix:UA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(h){m.u_inv_rot_matrix=a,m.u_merc_center=l,m.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],m.u_zoom_transition=Vr(d.zoom);const _=l[0]*dt,y=l[1]*dt;m.u_up_dir=d.projection.upVector(new ya(0,0,0),_,y)}return m},sm=n=>{const t=[];return"map"===n.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===n.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Ds(n,t,r,a,l,u,d,h,p){if(u&&n.queryGeometry.isAboveHorizon)return!1;u&&(p*=n.pixelToTileUnitsFactor);const m=n.tileID.canonical,_=r.projection.upVectorScale(m,r.center.lat,r.worldSize).metersToTile;for(const y of t)for(const x of y){const b=x.add(h),E=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(b.x,b.y,!0):0,C=r.projection.projectTilePoint(b.x,b.y,m);if(E>0){const R=r.projection.upVector(m,b.x,b.y);C.x+=R[0]*_*E,C.y+=R[1]*_*E,C.z+=R[2]*_*E}const S=u?b:Zh(C.x,C.y,C.z,a),M=u?n.tilespaceRays.map(R=>$A(R,E)):n.queryGeometry.screenGeometry,D=Ln.transformMat4([],[C.x,C.y,C.z,1],a);if(!d&&u?p*=D[3]/r.cameraToCenterDistance:d&&!u&&(p*=r.cameraToCenterDistance/D[3]),u){const R=lr((x.y/dt+m.y)/(1<<m.z));p/=r.projection.pixelsPerMeter(R,1)/Nn(1,R)}if(nm(M,S,p))return!0}return!1}function Zh(n,t,r,a){const l=Ln.transformMat4([],[n,t,r,1],a);return new nt(l[0]/l[3],l[1]/l[3])}const ly=q.fromValues(0,0,0),HA=q.fromValues(0,0,1);function $A(n,t){const r=q.create();return ly[2]=t,n.intersectsPlane(ly,HA,r),new nt(r[0],r[1])}class qx extends nM{}function Sd(n,{width:t,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*a)throw new RangeError("mismatched image size")}else l=new Uint8Array(t*r*a);return n.width=t,n.height=r,n.data=l,n}function oM(n,t,r){const{width:a,height:l}=t;a===n.width&&l===n.height||(Wx(n,t,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,l)},r),n.width=a,n.height=l,n.data=t.data)}function Wx(n,t,r,a,l,u){if(0===l.width||0===l.height)return t;if(l.width>n.width||l.height>n.height||r.x>n.width-l.width||r.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||a.x>t.width-l.width||a.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const d=n.data,h=t.data;for(let p=0;p<l.height;p++){const m=((r.y+p)*n.width+r.x)*u,_=((a.y+p)*t.width+a.x)*u;for(let y=0;y<l.width*u;y++)h[_+y]=d[m+y]}return t}Xt(qx,"HeatmapBucket",{omit:["layers"]});class Mc{constructor(t,r){Sd(this,t,1,r)}resize(t){oM(this,new Mc(t),1)}clone(){return new Mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,l,u){Wx(t,r,a,l,u,1)}}class Pi{constructor(t,r){Sd(this,t,4,r)}resize(t){oM(this,new Pi(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Pi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,l,u){Wx(t,r,a,l,u,4)}}class am{constructor(t,r){this.width=t.width,this.height=t.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}Xt(Mc,"AlphaImage"),Xt(Pi,"RGBAImage");const GA=new Ci({visibility:new Dt(J.layout_heatmap.visibility)});var sM={paint:new Ci({"heatmap-radius":new se(J.paint_heatmap["heatmap-radius"]),"heatmap-weight":new se(J.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dt(J.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Op(J.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dt(J.paint_heatmap["heatmap-opacity"])}),layout:GA};function Ya(n){const t={},r=n.resolution||256,a=n.clips?n.clips.length:1,l=n.image||new Pi({width:r,height:a}),u=(d,h,p)=>{t[n.evaluationKey]=p;const m=n.expression.evaluate(t);m&&(l.data[d+h+0]=Math.floor(255*m.r/m.a),l.data[d+h+1]=Math.floor(255*m.g/m.a),l.data[d+h+2]=Math.floor(255*m.b/m.a),l.data[d+h+3]=Math.floor(255*m.a))};if(n.clips)for(let d=0,h=0;d<a;++d,h+=4*r)for(let p=0,m=0;p<r;p++,m+=4){const _=p/(r-1),{start:y,end:x}=n.clips[d];u(h,m,y*(1-_)+x*_)}else for(let d=0,h=0;d<r;d++,h+=4)u(0,h,d/(r-1));return l}const RF=new Ci({visibility:new Dt(J.layout_hillshade.visibility)});var xu={paint:new Ci({"hillshade-illumination-direction":new Dt(J.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Dt(J.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dt(J.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dt(J.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dt(J.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dt(J.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Dt(J.paint_hillshade["hillshade-emissive-strength"])}),layout:RF};const Zx=yn([{name:"a_pos",components:2,type:"Int16"}],4),{members:qA}=Zx;var aM={exports:{}};function Xx(n,t,r){r=r||2;var a,l,u,d,h,p,m,_=t&&t.length,y=_?t[0]*r:n.length,x=lm(n,0,y,r,!0),b=[];if(!x||x.next===x.prev)return b;if(_&&(x=function(C,S,M,D){var R,P,I,O=[];for(R=0,P=S.length;R<P;R++)(I=lm(C,S[R]*D,R<P-1?S[R+1]*D:C.length,D,!1))===I.next&&(I.steiner=!0),O.push(Qx(I));for(O.sort(cm),R=0;R<O.length;R++)M=cy(O[R],M);return M}(n,t,x,r)),n.length>80*r){a=u=n[0],l=d=n[1];for(var E=r;E<y;E+=r)(h=n[E])<a&&(a=h),(p=n[E+1])<l&&(l=p),h>u&&(u=h),p>d&&(d=p);m=0!==(m=Math.max(u-a,d-l))?32767/m:0}return Dd(x,b,r,a,l,m,0),b}function lm(n,t,r,a,l){var u,d;if(l===cM(n,t,r,a)>0)for(u=t;u<r;u+=a)d=tb(u,n[u],n[u+1],d);else for(u=r-a;u>=t;u-=a)d=tb(u,n[u],n[u+1],d);return d&&bu(d,d.next)&&(fm(d),d=d.next),d}function Td(n,t){if(!n)return n;t||(t=n);var r,a=n;do{if(r=!1,a.steiner||!bu(a,a.next)&&0!==nr(a.prev,a,a.next))a=a.next;else{if(fm(a),(a=t=a.prev)===a.next)break;r=!0}}while(r||a!==t);return t}function Dd(n,t,r,a,l,u,d){if(n){!d&&u&&function(_,y,x,b){var E=_;do{0===E.z&&(E.z=um(E.x,E.y,y,x,b)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next}while(E!==_);E.prevZ.nextZ=null,E.prevZ=null,function(C){var S,M,D,R,P,I,O,F,L=1;do{for(M=C,C=null,P=null,I=0;M;){for(I++,D=M,O=0,S=0;S<L&&(O++,D=D.nextZ);S++);for(F=L;O>0||F>0&&D;)0!==O&&(0===F||!D||M.z<=D.z)?(R=M,M=M.nextZ,O--):(R=D,D=D.nextZ,F--),P?P.nextZ=R:C=R,R.prevZ=P,P=R;M=D}P.nextZ=null,L*=2}while(I>1)}(E)}(n,a,l,u);for(var h,p,m=n;n.prev!==n.next;)if(h=n.prev,p=n.next,u?Xh(n,a,l,u):Yx(n))t.push(h.i/r|0),t.push(n.i/r|0),t.push(p.i/r|0),fm(n),n=p.next,m=p.next;else if((n=p)===m){d?1===d?Dd(n=Kx(Td(n),t,r),t,r,a,l,u,2):2===d&&Jx(n,t,r,a,l,u):Dd(Td(n),t,r,a,l,u,1);break}}}function Yx(n){var t=n.prev,r=n,a=n.next;if(nr(t,r,a)>=0)return!1;for(var l=t.x,u=r.x,d=a.x,h=t.y,p=r.y,m=a.y,_=l<u?l<d?l:d:u<d?u:d,y=h<p?h<m?h:m:p<m?p:m,x=l>u?l>d?l:d:u>d?u:d,b=h>p?h>m?h:m:p>m?p:m,E=a.next;E!==t;){if(E.x>=_&&E.x<=x&&E.y>=y&&E.y<=b&&Sc(l,h,u,p,d,m,E.x,E.y)&&nr(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function Xh(n,t,r,a){var l=n.prev,u=n,d=n.next;if(nr(l,u,d)>=0)return!1;for(var h=l.x,p=u.x,m=d.x,_=l.y,y=u.y,x=d.y,b=h<p?h<m?h:m:p<m?p:m,E=_<y?_<x?_:x:y<x?y:x,C=h>p?h>m?h:m:p>m?p:m,S=_>y?_>x?_:x:y>x?y:x,M=um(b,E,t,r,a),D=um(C,S,t,r,a),R=n.prevZ,P=n.nextZ;R&&R.z>=M&&P&&P.z<=D;){if(R.x>=b&&R.x<=C&&R.y>=E&&R.y<=S&&R!==l&&R!==d&&Sc(h,_,p,y,m,x,R.x,R.y)&&nr(R.prev,R,R.next)>=0||(R=R.prevZ,P.x>=b&&P.x<=C&&P.y>=E&&P.y<=S&&P!==l&&P!==d&&Sc(h,_,p,y,m,x,P.x,P.y)&&nr(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;R&&R.z>=M;){if(R.x>=b&&R.x<=C&&R.y>=E&&R.y<=S&&R!==l&&R!==d&&Sc(h,_,p,y,m,x,R.x,R.y)&&nr(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;P&&P.z<=D;){if(P.x>=b&&P.x<=C&&P.y>=E&&P.y<=S&&P!==l&&P!==d&&Sc(h,_,p,y,m,x,P.x,P.y)&&nr(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function Kx(n,t,r){var a=n;do{var l=a.prev,u=a.next.next;!bu(l,u)&&lM(l,a,a.next,u)&&hm(l,u)&&hm(u,l)&&(t.push(l.i/r|0),t.push(a.i/r|0),t.push(u.i/r|0),fm(a),fm(a.next),a=n=u),a=a.next}while(a!==n);return Td(a)}function Jx(n,t,r,a,l,u){var d=n;do{for(var h=d.next.next;h!==d.prev;){if(d.i!==h.i&&PF(d,h)){var p=dy(d,h);return d=Td(d,d.next),p=Td(p,p.next),Dd(d,t,r,a,l,u,0),void Dd(p,t,r,a,l,u,0)}h=h.next}d=d.next}while(d!==n)}function cm(n,t){return n.x-t.x}function cy(n,t){var r=function(l,u){var d,h=u,p=l.x,m=l.y,_=-1/0;do{if(m<=h.y&&m>=h.next.y&&h.next.y!==h.y){var y=h.x+(m-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(y<=p&&y>_&&(_=y,d=h.x<h.next.x?h:h.next,y===p))return d}h=h.next}while(h!==u);if(!d)return null;var x,b=d,E=d.x,C=d.y,S=1/0;h=d;do{p>=h.x&&h.x>=E&&p!==h.x&&Sc(m<C?p:_,m,E,C,m<C?_:p,m,h.x,h.y)&&(x=Math.abs(m-h.y)/(p-h.x),hm(h,l)&&(x<S||x===S&&(h.x>d.x||h.x===d.x&&Yh(d,h)))&&(d=h,S=x)),h=h.next}while(h!==b);return d}(n,t);if(!r)return t;var a=dy(r,n);return Td(a,a.next),Td(r,r.next)}function Yh(n,t){return nr(n.prev,n,t.prev)<0&&nr(t.next,n,n.next)<0}function um(n,t,r,a,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qx(n){var t=n,r=n;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==n);return r}function Sc(n,t,r,a,l,u,d,h){return(l-d)*(t-h)>=(n-d)*(u-h)&&(n-d)*(a-h)>=(r-d)*(t-h)&&(r-d)*(u-h)>=(l-d)*(a-h)}function PF(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,a){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&lM(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(n,t)&&(hm(n,t)&&hm(t,n)&&function(r,a){var l=r,u=!1,d=(r.x+a.x)/2,h=(r.y+a.y)/2;do{l.y>h!=l.next.y>h&&l.next.y!==l.y&&d<(l.next.x-l.x)*(h-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next}while(l!==r);return u}(n,t)&&(nr(n.prev,n,t.prev)||nr(n,t.prev,t))||bu(n,t)&&nr(n.prev,n,n.next)>0&&nr(t.prev,t,t.next)>0)}function nr(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function bu(n,t){return n.x===t.x&&n.y===t.y}function lM(n,t,r,a){var l=uy(nr(n,t,r)),u=uy(nr(n,t,a)),d=uy(nr(r,a,n)),h=uy(nr(r,a,t));return l!==u&&d!==h||!(0!==l||!dm(n,r,t))||!(0!==u||!dm(n,a,t))||!(0!==d||!dm(r,n,a))||!(0!==h||!dm(r,t,a))}function dm(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function uy(n){return n>0?1:n<0?-1:0}function hm(n,t){return nr(n.prev,n,n.next)<0?nr(n,t,n.next)>=0&&nr(n,n.prev,t)>=0:nr(n,t,n.prev)<0||nr(n,n.next,t)<0}function dy(n,t){var r=new eb(n.i,n.x,n.y),a=new eb(t.i,t.x,t.y),l=n.next,u=t.prev;return n.next=t,t.prev=n,r.next=l,l.prev=r,a.next=r,r.prev=a,u.next=a,a.prev=u,a}function tb(n,t,r,a){var l=new eb(n,t,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function fm(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function eb(n,t,r){this.i=n,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function cM(n,t,r,a){for(var l=0,u=t,d=r-a;u<r;u+=a)l+=(n[d]-n[u])*(n[u+1]+n[d+1]),d=u;return l}aM.exports=Xx,aM.exports.default=Xx,Xx.deviation=function(n,t,r,a){var l=t&&t.length,u=Math.abs(cM(n,0,l?t[0]*r:n.length,r));if(l)for(var d=0,h=t.length;d<h;d++)u-=Math.abs(cM(n,t[d]*r,d<h-1?t[d+1]*r:n.length,r));var p=0;for(d=0;d<a.length;d+=3){var m=a[d]*r,_=a[d+1]*r,y=a[d+2]*r;p+=Math.abs((n[m]-n[y])*(n[_+1]-n[m+1])-(n[m]-n[_])*(n[y+1]-n[m+1]))}return 0===u&&0===p?0:Math.abs((p-u)/u)},Xx.flatten=function(n){for(var t=n[0][0].length,r={vertices:[],holes:[],dimensions:t},a=0,l=0;l<n.length;l++){for(var u=0;u<n[l].length;u++)for(var d=0;d<t;d++)r.vertices.push(n[l][u][d]);l>0&&r.holes.push(a+=n[l-1].length)}return r};var hy=ms(aM.exports);function Kh(n,t){const r=n.length;if(r<=1)return[n];const a=[];let l,u;for(let d=0;d<r;d++){const h=Mt(n[d]);0!==h&&(n[d].area=Math.abs(h),void 0===u&&(u=h<0),u===h<0?(l&&a.push(l),l=[n[d]]):l.push(n[d]))}if(l&&a.push(l),t>1)for(let d=0;d<a.length;d++)a[d].length<=t||(GI(a[d],t,1,a[d].length-1,nb),a[d]=a[d].slice(0,t));return a}function nb(n,t){return t.area-n.area}function ib(n,t,r){const a=r.patternDependencies;let l=!1;for(const u of t){const d=u.paint.get(`${n}-pattern`);d.isConstant()||(l=!0);const h=d.constantOr(null);h&&(l=!0,a[h]=!0)}return l}function fy(n,t,r,a,l){const u=l.patternDependencies;for(const d of t){const h=d.paint.get(`${n}-pattern`).value;if("constant"!==h.kind){let p=h.evaluate({zoom:a},r,{},l.availableImages);p=p&&p.name?p.name:p,u[p]=!0,r.patterns[d.id]=p}}return r}class Jh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Zo,this.indexArray=new er,this.indexArray2=new $a,this.programConfigurations=new pd(t.layers,t.zoom),this.segments=new Bn,this.segments2=new Bn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection}populate(t,r,a,l){this.hasPattern=ib("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:h,id:p,index:m,sourceLayerIndex:_}of t){const y=this.layers[0]._featureFilter.needGeometry,x=yu(h,y);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),x,a))continue;const b=u?u.evaluate(x,{},a,r.availableImages):void 0,E={id:p,properties:h.properties,type:h.type,sourceLayerIndex:_,index:m,geometry:y?x.geometry:jl(h,a,l),patterns:{},sortKey:b};d.push(E)}u&&d.sort((h,p)=>h.sortKey-p.sortKey);for(const h of d){const{geometry:p,index:m,sourceLayerIndex:_}=h;if(this.hasPattern){const y=fy("fill",this.layers,h,this.zoom,r);this.patternFeatures.push(y)}else this.addFeature(h,p,m,a,{},r.availableImages,r.brightness);r.featureIndex.insert(t[m].feature,p,m,_,this.index)}}update(t,r,a,l,u){const d=0!==Object.keys(t).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,d?this.stateDependentLayers:this.layers,a,l,u)}addFeatures(t,r,a,l,u,d){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,a,l,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qA),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,a,l,u,d=[],h){for(const p of Kh(r,500)){let m=0;for(const C of p)m+=C.length;const _=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),y=_.vertexLength,x=[],b=[];for(const C of p){if(0===C.length)continue;C!==p[0]&&b.push(x.length/2);const S=this.segments2.prepareSegment(C.length,this.layoutVertexArray,this.indexArray2),M=S.vertexLength;this.layoutVertexArray.emplaceBack(C[0].x,C[0].y),this.indexArray2.emplaceBack(M+C.length-1,M),x.push(C[0].x),x.push(C[0].y);for(let D=1;D<C.length;D++)this.layoutVertexArray.emplaceBack(C[D].x,C[D].y),this.indexArray2.emplaceBack(M+D-1,M+D),x.push(C[D].x),x.push(C[D].y);S.vertexLength+=C.length,S.primitiveLength+=C.length}const E=hy(x,b);for(let C=0;C<E.length;C+=3)this.indexArray.emplaceBack(y+E[C],y+E[C+1],y+E[C+2]);_.vertexLength+=m,_.primitiveLength+=E.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,d,l,h)}}Xt(Jh,"FillBucket",{omit:["layers","patternFeatures"]});const py=new Ci({"fill-sort-key":new se(J.layout_fill["fill-sort-key"]),visibility:new Dt(J.layout_fill.visibility)});var WA={paint:new Ci({"fill-antialias":new Dt(J.paint_fill["fill-antialias"]),"fill-opacity":new se(J.paint_fill["fill-opacity"]),"fill-color":new se(J.paint_fill["fill-color"]),"fill-outline-color":new se(J.paint_fill["fill-outline-color"]),"fill-translate":new Dt(J.paint_fill["fill-translate"]),"fill-translate-anchor":new Dt(J.paint_fill["fill-translate-anchor"]),"fill-pattern":new se(J.paint_fill["fill-pattern"]),"fill-emissive-strength":new Dt(J.paint_fill["fill-emissive-strength"])}),layout:py};const uM=yn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ZA=yn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dM=yn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),OF=yn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),XA=yn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:pm}=uM;var my={},Qh=Kc,Oi=tf;function tf(n,t,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=l,n.readFields(mm,this,t)}function mm(n,t,r){1==n?t.id=r.readVarint():2==n?function(a,l){for(var u=a.readVarint()+a.pos;a.pos<u;){var d=l._keys[a.readVarint()],h=l._values[a.readVarint()];l.properties[d]=h}}(r,t):3==n?t.type=r.readVarint():4==n&&(t._geometry=r.pos)}function Tc(n){for(var t,r,a=0,l=0,u=n.length,d=u-1;l<u;d=l++)a+=((r=n[d]).x-(t=n[l]).x)*(t.y+r.y);return a}tf.types=["Unknown","Point","LineString","Polygon"],tf.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,r=n.readVarint()+n.pos,a=1,l=0,u=0,d=0,h=[];n.pos<r;){if(l<=0){var p=n.readVarint();a=7&p,l=p>>3}if(l--,1===a||2===a)u+=n.readSVarint(),d+=n.readSVarint(),1===a&&(t&&h.push(t),t=[]),t.push(new Qh(u,d));else{if(7!==a)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&h.push(t),h},tf.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,r=1,a=0,l=0,u=0,d=1/0,h=-1/0,p=1/0,m=-1/0;n.pos<t;){if(a<=0){var _=n.readVarint();r=7&_,a=_>>3}if(a--,1===r||2===r)(l+=n.readSVarint())<d&&(d=l),l>h&&(h=l),(u+=n.readSVarint())<p&&(p=u),u>m&&(m=u);else if(7!==r)throw new Error("unknown command "+r)}return[d,p,h,m]},tf.prototype.toGeoJSON=function(n,t,r){var a,l,u=this.extent*Math.pow(2,r),d=this.extent*n,h=this.extent*t,p=this.loadGeometry(),m=tf.types[this.type];function _(b){for(var E=0;E<b.length;E++){var C=b[E];b[E]=[360*(C.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(C.y+h)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var y=[];for(a=0;a<p.length;a++)y[a]=p[a][0];_(p=y);break;case 2:for(a=0;a<p.length;a++)_(p[a]);break;case 3:for(p=function(b){var E=b.length;if(E<=1)return[b];for(var C,S,M=[],D=0;D<E;D++){var R=Tc(b[D]);0!==R&&(void 0===S&&(S=R<0),S===R<0?(C&&M.push(C),C=[b[D]]):C.push(b[D]))}return C&&M.push(C),M}(p),a=0;a<p.length;a++)for(l=0;l<p[a].length;l++)_(p[a][l])}1===p.length?p=p[0]:m="Multi"+m;var x={type:"Feature",geometry:{type:m,coordinates:p},properties:this.properties};return"id"in this&&(x.id=this.id),x};var YA=Oi,hM=wu;function wu(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(KA,this,t),this.length=this._features.length}function KA(n,t,r){15===n?t.version=r.readVarint():1===n?t.name=r.readString():5===n?t.extent=r.readVarint():2===n?t._features.push(r.pos):3===n?t._keys.push(r.readString()):4===n&&t._values.push(function(a){for(var l=null,u=a.readVarint()+a.pos;a.pos<u;){var d=a.readVarint()>>3;l=1===d?a.readString():2===d?a.readFloat():3===d?a.readDouble():4===d?a.readVarint64():5===d?a.readVarint():6===d?a.readSVarint():7===d?a.readBoolean():null}return l}(r))}wu.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new YA(this._pbf,t,this.extent,this._keys,this._values)};var rb=hM;function kF(n,t,r){if(3===n){var a=new rb(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}var gm=my.VectorTile=function(n,t){this.layers=n.readFields(kF,{},t)},_m=my.VectorTileFeature=Oi;function gy(n,t,r,a){const l=[],u=0===a?(d,h,p,m,_,y)=>{d.push(new nt(y,p+(y-h)/(m-h)*(_-p)))}:(d,h,p,m,_,y)=>{d.push(new nt(h+(y-p)/(_-p)*(m-h),y))};for(const d of n){const h=[];for(const p of d){if(p.length<=2)continue;const m=[];for(let x=0;x<p.length-1;x++){const b=p[x].x,E=p[x].y,C=p[x+1].x,S=p[x+1].y,M=0===a?b:E,D=0===a?C:S;M<t?D>t&&u(m,b,E,C,S,t):M>r?D<r&&u(m,b,E,C,S,r):m.push(p[x]),D<t&&M>=t&&u(m,b,E,C,S,t),D>r&&M<=r&&u(m,b,E,C,S,r)}let _=p[p.length-1];const y=0===a?_.x:_.y;y>=t&&y<=r&&m.push(_),m.length&&(_=m[m.length-1],m[0].x===_.x&&m[0].y===_.y||m.push(m[0]),h.push(m))}h.length&&l.push(h)}return l}my.VectorTileLayer=hM;class fM{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const a=t[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var pM={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(n,t,r,a,l){var u,d,h=8*l-a-1,p=(1<<h)-1,m=p>>1,_=-7,y=r?l-1:0,x=r?-1:1,b=n[t+y];for(y+=x,u=b&(1<<-_)-1,b>>=-_,_+=h;_>0;u=256*u+n[t+y],y+=x,_-=8);for(d=u&(1<<-_)-1,u>>=-_,_+=a;_>0;d=256*d+n[t+y],y+=x,_-=8);if(0===u)u=1-m;else{if(u===p)return d?NaN:1/0*(b?-1:1);d+=Math.pow(2,a),u-=m}return(b?-1:1)*d*Math.pow(2,u-a)},write:function(n,t,r,a,l,u){var d,h,p,m=8*u-l-1,_=(1<<m)-1,y=_>>1,x=23===l?Math.pow(2,-24)-Math.pow(2,-77):0,b=a?0:u-1,E=a?1:-1,C=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(h=isNaN(t)?1:0,d=_):(d=Math.floor(Math.log(t)/Math.LN2),t*(p=Math.pow(2,-d))<1&&(d--,p*=2),(t+=d+y>=1?x/p:x*Math.pow(2,1-y))*p>=2&&(d++,p/=2),d+y>=_?(h=0,d=_):d+y>=1?(h=(t*p-1)*Math.pow(2,l),d+=y):(h=t*Math.pow(2,y-1)*Math.pow(2,l),d=0));l>=8;n[r+b]=255&h,b+=E,h/=256,l-=8);for(d=d<<l|h,m+=l;m>0;n[r+b]=255&d,b+=E,d/=256,m-=8);n[r+b-E]|=128*C}},mM=yi,ym=pM;function yi(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}yi.Varint=0,yi.Fixed64=1,yi.Bytes=2,yi.Fixed32=5;var ob=4294967296,JA=1/ob,sb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ul(n){return n.type===yi.Bytes?n.readVarint()+n.pos:n.pos+1}function ab(n,t,r){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=n;l--)r.buf[l+a]=r.buf[l]}function FF(n,t){for(var r=0;r<n.length;r++)t.writeVarint(n[r])}function lb(n,t){for(var r=0;r<n.length;r++)t.writeSVarint(n[r])}function wa(n,t){for(var r=0;r<n.length;r++)t.writeFloat(n[r])}function cb(n,t){for(var r=0;r<n.length;r++)t.writeDouble(n[r])}function QA(n,t){for(var r=0;r<n.length;r++)t.writeBoolean(n[r])}function LF(n,t){for(var r=0;r<n.length;r++)t.writeFixed32(n[r])}function t2(n,t){for(var r=0;r<n.length;r++)t.writeSFixed32(n[r])}function ub(n,t){for(var r=0;r<n.length;r++)t.writeFixed64(n[r])}function oi(n,t){for(var r=0;r<n.length;r++)t.writeSFixed64(n[r])}function vm(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function ef(n,t,r){n[r]=t,n[r+1]=t>>>8,n[r+2]=t>>>16,n[r+3]=t>>>24}function e2(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}yi.prototype={destroy:function(){this.buf=null},readFields:function(n,t,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,u=this.pos;this.type=7&a,n(l,t,this),this.pos===u&&this.skip(a)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=vm(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=e2(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=vm(this.buf,this.pos)+vm(this.buf,this.pos+4)*ob;return this.pos+=8,n},readSFixed64:function(){var n=vm(this.buf,this.pos)+e2(this.buf,this.pos+4)*ob;return this.pos+=8,n},readFloat:function(){var n=ym.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=ym.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,r,a=this.buf;return t=127&(r=a[this.pos++]),r<128?t:(t|=(127&(r=a[this.pos++]))<<7,r<128?t:(t|=(127&(r=a[this.pos++]))<<14,r<128?t:(t|=(127&(r=a[this.pos++]))<<21,r<128?t:function(l,u,d){var h,p,m=d.buf;if(h=(112&(p=m[d.pos++]))>>4,p<128||(h|=(127&(p=m[d.pos++]))<<3,p<128)||(h|=(127&(p=m[d.pos++]))<<10,p<128)||(h|=(127&(p=m[d.pos++]))<<17,p<128)||(h|=(127&(p=m[d.pos++]))<<24,p<128)||(h|=(1&(p=m[d.pos++]))<<31,p<128))return function Fr(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}(l,h,u);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&sb?sb.decode(this.buf.subarray(t,n)):function(r,a,l){for(var u="",d=a;d<l;){var h,p,m,_=r[d],y=null,x=_>239?4:_>223?3:_>191?2:1;if(d+x>l)break;1===x?_<128&&(y=_):2===x?128==(192&(h=r[d+1]))&&(y=(31&_)<<6|63&h)<=127&&(y=null):3===x?(p=r[d+2],128==(192&(h=r[d+1]))&&128==(192&p)&&((y=(15&_)<<12|(63&h)<<6|63&p)<=2047||y>=55296&&y<=57343)&&(y=null)):4===x&&(p=r[d+2],m=r[d+3],128==(192&(h=r[d+1]))&&128==(192&p)&&128==(192&m)&&((y=(15&_)<<18|(63&h)<<12|(63&p)<<6|63&m)<=65535||y>=1114112)&&(y=null)),null===y?(y=65533,x=1):y>65535&&(y-=65536,u+=String.fromCharCode(y>>>10&1023|55296),y=56320|1023&y),u+=String.fromCharCode(y),d+=x}return u}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==yi.Bytes)return n.push(this.readVarint(t));var r=Ul(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==yi.Bytes)return n.push(this.readSVarint());var t=Ul(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==yi.Bytes)return n.push(this.readBoolean());var t=Ul(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==yi.Bytes)return n.push(this.readFloat());var t=Ul(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==yi.Bytes)return n.push(this.readDouble());var t=Ul(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==yi.Bytes)return n.push(this.readFixed32());var t=Ul(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==yi.Bytes)return n.push(this.readSFixed32());var t=Ul(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==yi.Bytes)return n.push(this.readFixed64());var t=Ul(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==yi.Bytes)return n.push(this.readSFixed64());var t=Ul(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===yi.Varint)for(;this.buf[this.pos++]>127;);else if(t===yi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===yi.Fixed32)this.pos+=4;else{if(t!==yi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),ef(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),ef(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),ef(this.buf,-1&n,this.pos),ef(this.buf,Math.floor(n*JA),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),ef(this.buf,-1&n,this.pos),ef(this.buf,Math.floor(n*JA),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,r){var a,l,u,h;if(t>=0?(a=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,l=l+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),u=a,(h=r).buf[h.pos++]=127&u|128,u>>>=7,h.buf[h.pos++]=127&u|128,u>>>=7,h.buf[h.pos++]=127&u|128,u>>>=7,h.buf[h.pos++]=127&u|128,h.buf[h.pos]=127&(u>>>=7),function(u,d){var h=(7&u)<<4;d.buf[d.pos++]|=h|((u>>>=3)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u)))))}(l,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(a,l,u){for(var d,h,p=0;p<l.length;p++){if((d=l.charCodeAt(p))>55295&&d<57344){if(!h){d>56319||p+1===l.length?(a[u++]=239,a[u++]=191,a[u++]=189):h=d;continue}if(d<56320){a[u++]=239,a[u++]=191,a[u++]=189,h=d;continue}d=h-55296<<10|d-56320|65536,h=null}else h&&(a[u++]=239,a[u++]=191,a[u++]=189,h=null);d<128?a[u++]=d:(d<2048?a[u++]=d>>6|192:(d<65536?a[u++]=d>>12|224:(a[u++]=d>>18|240,a[u++]=d>>12&63|128),a[u++]=d>>6&63|128),a[u++]=63&d|128)}return u}(this.buf,n,this.pos);var r=this.pos-t;r>=128&&ab(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),ym.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),ym.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,t){this.pos++;var r=this.pos;n(t,this);var a=this.pos-r;a>=128&&ab(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,t,r){this.writeTag(n,yi.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,FF,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,lb,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,QA,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,wa,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,cb,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,LF,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,t2,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,ub,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,oi,t)},writeBytesField:function(n,t){this.writeTag(n,yi.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,yi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,yi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,yi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,yi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,yi.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,yi.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,yi.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,yi.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,yi.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var Xe=ms(mM);const n2=["tile","layer","source","sourceLayer","state"];class _y{constructor(t,r,a,l,u){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=a,this._y=l,this.properties=t.properties,this.id=u}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const r of n2)void 0!==this[r]&&(t[r]=this[r]);return t}}class r2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,a){const l=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][l]=this.stateChanges[t][l]||{},Yt(this.stateChanges[t][l],a),null===this.deletedStates[t]){this.deletedStates[t]={};for(const u in this.state[t])u!==l&&(this.deletedStates[t][u]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][l]){this.deletedStates[t][l]={};for(const u in this.state[t][l])a[u]||(this.deletedStates[t][l][u]=null)}else for(const u in a)this.deletedStates[t]&&this.deletedStates[t][l]&&null===this.deletedStates[t][l][u]&&delete this.deletedStates[t][l][u]}removeFeatureState(t,r,a){if(null===this.deletedStates[t])return;const l=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&void 0!==r)null!==this.deletedStates[t][l]&&(this.deletedStates[t][l]=this.deletedStates[t][l]||{},this.deletedStates[t][l][a]=null);else if(void 0!==r)if(this.stateChanges[t]&&this.stateChanges[t][l])for(a in this.deletedStates[t][l]={},this.stateChanges[t][l])this.deletedStates[t][l][a]=null;else this.deletedStates[t][l]=null;else this.deletedStates[t]=null}getState(t,r){const a=String(r),l=Yt({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const u=this.deletedStates[t][r];if(null===u)return{};for(const d in u)delete l[d]}return l}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const d in this.stateChanges[l])this.state[l][d]||(this.state[l][d]={}),Yt(this.state[l][d],this.stateChanges[l][d]),u[d]=this.state[l][d];a[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(null===this.deletedStates[l])for(const d in this.state[l])u[d]={},this.state[l][d]={};else for(const d in this.deletedStates[l]){if(null===this.deletedStates[l][d])this.state[l][d]={};else if(this.state[l][d])for(const h of Object.keys(this.deletedStates[l][d]))delete this.state[l][d][h];u[d]=this.state[l][d]}a[l]=a[l]||{},Yt(a[l],u)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(const l in t)t[l].setFeatureState(a,r)}}class gM{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const a=this.toIdx(t,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function yy(n,t,r,a){let l=0,u=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(a[d])<1e-15){if(r[d]<n[d]||r[d]>t[d])return null}else{const h=1/a[d];let p=(n[d]-r[d])*h,m=(t[d]-r[d])*h;if(p>m){const _=p;p=m,m=_}if(p>l&&(l=p),m<u&&(u=m),l>u)return null}return l}function db(n,t,r,a,l,u,d,h,p,m,_){const y=a-n,x=l-t,b=u-r,E=d-n,C=h-t,S=p-r,M=_[1]*S-_[2]*C,D=_[2]*E-_[0]*S,R=_[0]*C-_[1]*E,P=y*M+x*D+b*R;if(Math.abs(P)<1e-15)return null;const I=1/P,O=m[0]-n,F=m[1]-t,L=m[2]-r,N=(O*M+F*D+L*R)*I;if(N<0||N>1)return null;const z=F*b-L*x,U=L*y-O*b,V=O*x-F*y,G=(_[0]*z+_[1]*U+_[2]*V)*I;return G<0||N+G>1?null:(E*z+C*U+S*V)*I}function hb(n,t,r){return(n-t)/(r-t)}function _M(n,t,r,a,l,u,d,h,p){const m=1<<r,_=u-a,y=d-l,x=(n+1)/m*_+a,b=(t+0)/m*y+l,E=(t+1)/m*y+l;h[0]=(n+0)/m*_+a,h[1]=b,p[0]=x,p[1]=E}class fb{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(u){const d=Math.ceil(Math.log2(u.dim/8)),h=[];let p=Math.ceil(Math.pow(2,d));const m=1/p,_=(b,E,C,S,M)=>{const D=S?1:0,R=(b+1)*C-D,P=E*C,I=(E+1)*C-D;M[0]=b*C,M[1]=P,M[2]=R,M[3]=I};let y=new gM(p);const x=[];for(let b=0;b<p*p;b++){_(b%p,Math.floor(b/p),m,!1,x);const E=Eu(x[0],x[1],u),C=Eu(x[2],x[1],u),S=Eu(x[2],x[3],u),M=Eu(x[0],x[3],u);y.minimums.push(Math.min(E,C,S,M)),y.maximums.push(Math.max(E,C,S,M)),y.leaves.push(1)}for(h.push(y),p/=2;p>=1;p/=2){const b=h[h.length-1];y=new gM(p);for(let E=0;E<p*p;E++){_(E%p,Math.floor(E/p),2,!0,x);const C=b.getElevation(x[0],x[1]),S=b.getElevation(x[2],x[1]),M=b.getElevation(x[2],x[3]),D=b.getElevation(x[0],x[3]),R=b.isLeaf(x[0],x[1]),P=b.isLeaf(x[2],x[1]),I=b.isLeaf(x[2],x[3]),O=b.isLeaf(x[0],x[3]),F=Math.min(C.min,S.min,M.min,D.min),L=Math.max(C.max,S.max,M.max,D.max),N=R&&P&&I&&O;y.maximums.push(L),y.minimums.push(F),y.leaves.push(L-F<=5&&N?1:0)}h.push(y)}return h}(this.dem),a=r.length-1,l=r[a];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(t,r,a,l,u,d,h=1){return yy([t,r,-100],[a,l,this.maximums[0]*h],u,d)}raycast(t,r,a,l,u,d,h=1){if(!this.nodeCount)return null;const p=this.raycastRoot(t,r,a,l,u,d,h);if(null==p)return null;const m=[],_=[],y=[],x=[],b=[{idx:0,t:p,nodex:0,nodey:0,depth:0}];for(;b.length>0;){const{idx:E,t:C,nodex:S,nodey:M,depth:D}=b.pop();if(this.leaves[E]){_M(S,M,D,t,r,a,l,y,x);const P=1<<D,I=(S+0)/P,O=(S+1)/P,F=(M+0)/P,L=(M+1)/P,N=Eu(I,F,this.dem)*h,z=Eu(O,F,this.dem)*h,U=Eu(O,L,this.dem)*h,V=Eu(I,L,this.dem)*h,G=db(y[0],y[1],N,x[0],y[1],z,x[0],x[1],U,u,d),j=db(x[0],x[1],U,y[0],x[1],V,y[0],y[1],N,u,d),Z=Math.min(null!==G?G:Number.MAX_VALUE,null!==j?j:Number.MAX_VALUE);if(Z!==Number.MAX_VALUE)return Z;{const et=q.scaleAndAdd([],u,d,C);if(pb(N,z,V,U,hb(et[0],y[0],x[0]),hb(et[1],y[1],x[1]))>=et[2])return C}continue}let R=0;for(let P=0;P<this._siblingOffset.length;P++){_M((S<<1)+this._siblingOffset[P][0],(M<<1)+this._siblingOffset[P][1],D+1,t,r,a,l,y,x),y[2]=-100,x[2]=this.maximums[this.childOffsets[E]+P]*h;const I=yy(y,x,u,d);if(null!=I){const O=I;m[P]=O;let F=!1;for(let L=0;L<R&&!F;L++)O>=m[_[L]]&&(_.splice(L,0,P),F=!0);F||(_[R]=P),R++}}for(let P=0;P<R;P++){const I=_[P];b.push({idx:this.childOffsets[E]+I,t:m[I],nodex:(S<<1)+this._siblingOffset[I][0],nodey:(M<<1)+this._siblingOffset[I][1],depth:D+1})}}return null}_addNode(t,r,a){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,a,l,u){if(1===t[l].isLeaf(r,a))return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const d=l-1,h=t[d];let p=0,m=0;for(let _=0;_<this._siblingOffset.length;_++){const y=2*r+this._siblingOffset[_][0],x=2*a+this._siblingOffset[_][1],b=h.getElevation(y,x),E=h.isLeaf(y,x),C=this._addNode(b.min,b.max,E);E&&(p|=1<<_),m||(m=C)}for(let _=0;_<this._siblingOffset.length;_++)p&1<<_||this._construct(t,2*r+this._siblingOffset[_][0],2*a+this._siblingOffset[_][1],d,m+_)}}function pb(n,t,r,a,l,u){return _e(_e(n,r,u),_e(t,a,u),l)}function Eu(n,t,r){const a=r.dim,l=Jt(n*a-.5,0,a-1),u=Jt(t*a-.5,0,a-1),d=Math.floor(l),h=Math.floor(u),p=Math.min(d+1,a-1),m=Math.min(h+1,a-1);return pb(r.get(d,h),r.get(p,h),r.get(d,m),r.get(p,m),l-d,u-h)}const yM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function mb(n,t,r){return(256*n*256+256*t+r)/10-1e4}function vy(n,t,r){return 256*n+t+r/256-32768}class Ea{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,a,l,u=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return tt(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const d=this.dim=r.height-2,h=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,this._modifiedForSources={},!u){for(let p=0;p<d;p++)h[this._idx(-1,p)]=h[this._idx(0,p)],h[this._idx(d,p)]=h[this._idx(d-1,p)],h[this._idx(p,-1)]=h[this._idx(p,0)],h[this._idx(p,d)]=h[this._idx(p,d-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(d,-1)]=h[this._idx(d-1,0)],h[this._idx(-1,d)]=h[this._idx(0,d-1)],h[this._idx(d,d)]=h[this._idx(d-1,d-1)]}if(l){const p=new Float32Array(r.data.buffer),m="terrarium"===this.encoding?vy:mb;for(let _=0;_<h.length;++_){const y=4*_;p[_]=m(this.pixels[y],this.pixels[y+1],this.pixels[y+2])}this.encoding="float"}this._timestamp=kt.now()}_buildQuadTree(){this._tree=new fb(this)}get(t,r,a=!1){a&&(t=Jt(t,-1,this.dim),r=Jt(r,-1,this.dim));const l=this._idx(t,r);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[l];const u=4*l;return("terrarium"===this.encoding?vy:mb)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}set(t,r,a){const l=this._idx(t,r);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const p=this.floatView[l];return this.floatView[l]=a,a-p}const u=4*l,d=("terrarium"===this.encoding?vy:mb)(this.pixels[u],this.pixels[u+1],this.pixels[u+2]),h=Ea.pack(a,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[u]=h[0],this.pixels[u+1]=h[1],this.pixels[u+2]=h[2],a-d}static getUnpackVector(t){return yM[t]}get unpackVector(){return yM[this.encoding]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}static pack(t,r){const a=[0,0,0,0],l=Ea.getUnpackVector(r);let u=Math.floor((t+l[3])/l[2]);return a[2]=u%256,u=Math.floor(u/256),a[1]=u%256,u=Math.floor(u/256),a[0]=u,a}getPixels(){return"float"===this.encoding?new am({width:this.stride,height:this.stride},this.pixels):new Pi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,u=r*this.dim+this.dim,d=a*this.dim,h=a*this.dim+this.dim;switch(r){case-1:l=u-1;break;case 1:u=l+1}switch(a){case-1:d=h-1;break;case 1:h=d+1}const p=-r*this.dim,m=-a*this.dim;for(let _=d;_<h;_++)for(let y=l;y<u;y++){const x=4*this._idx(y,_),b=4*this._idx(y+p,_+m);this.pixels[x+0]=t.pixels[b+0],this.pixels[x+1]=t.pixels[b+1],this.pixels[x+2]=t.pixels[b+2],this.pixels[x+3]=t.pixels[b+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Xt(Ea,"DEMData"),Xt(fb,"DemMinMaxQuadTree",{omit:["dem"]});class Dc{isDataAvailableAtPoint(t){const r=this._source();if(this.isUsingMockSource()||!r||t.y<0||t.y>1)return!1;const a=r.getSource().maxzoom,l=1<<a,u=Math.floor(t.x),d=Math.floor((t.x-u)*l),h=Math.floor(t.y*l),p=this.findDEMTileFor(new tn(a,u,a,d,h));return!(!p||!p.dem)}getAtPointOrZero(t,r=0){return this.getAtPoint(t,r)||0}getAtPoint(t,r,a=!0){if(this.isUsingMockSource())return null;null==r&&(r=null);const l=this._source();if(!l||t.y<0||t.y>1)return r;const u=l.getSource().maxzoom,d=1<<u,h=Math.floor(t.x),p=t.x-h,m=new tn(u,h,u,Math.floor(p*d),Math.floor(t.y*d)),_=this.findDEMTileFor(m);if(!_||!_.dem)return r;const y=_.dem,x=1<<_.tileID.canonical.z,b=(p*x-_.tileID.canonical.x)*y.dim,E=(t.y*x-_.tileID.canonical.y)*y.dim,C=Math.floor(b),S=Math.floor(E);return(a?this.exaggeration():1)*_e(_e(y.get(C,S),y.get(C,S+1),E-S),_e(y.get(C+1,S),y.get(C+1,S+1),E-S),b-C)}getAtTileOffset(t,r,a){const l=1<<t.canonical.z;return this.getAtPointOrZero(new Je(t.wrap+(t.canonical.x+r/dt)/l,(t.canonical.y+a/dt)/l))}getAtTileOffsetFunc(t,r,a,l){return u=>{const d=this.getAtTileOffset(t,u.x,u.y),h=l.upVector(t.canonical,u.x,u.y),p=l.upVectorScale(t.canonical,r,a).metersToTile;return q.scale(h,h,d*p),h}}getForTilePoints(t,r,a,l){if(this.isUsingMockSource())return!1;const u=Ka.create(this,t,l);return!!u&&(r.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],a)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(t);if(!r||!r.dem)return null;const a=r.dem.tree,l=r.tileID,u=1<<t.canonical.z-l.canonical.z;let d=t.canonical.x/u-l.canonical.x,h=t.canonical.y/u-l.canonical.y,p=0;for(let m=0;m<t.canonical.z-l.canonical.z&&!a.leaves[p];m++){d*=2,h*=2;const _=2*Math.floor(h)+Math.floor(d);p=a.childOffsets[p]+_,d%=1,h%=1}return{min:this.exaggeration()*a.minimums[p],max:this.exaggeration()*a.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}class Ka{constructor(t,r,a){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(t,r,a){const l=a||t.findDEMTileFor(r);if(!l||!l.dem)return;const u=l.dem,d=l.tileID,h=1<<r.canonical.z-d.canonical.z;return new Ka(l,u.dim/dt/h,[(r.canonical.x/h-d.canonical.x)*u.dim,(r.canonical.y/h-d.canonical.y)*u.dim])}tileCoordToPixel(t,r){const a=r*this._scale+this._offset[1],l=Math.floor(t*this._scale+this._offset[0]),u=Math.floor(a);return new nt(l,u)}getElevationAt(t,r,a,l){const u=t*this._scale+this._offset[0],d=r*this._scale+this._offset[1],h=Math.floor(u),p=Math.floor(d),m=this._dem;return l=!!l,a?_e(_e(m.get(h,p,l),m.get(h,p+1,l),d-p),_e(m.get(h+1,p,l),m.get(h+1,p+1,l),d-p),u-h):m.get(h,p,l)}getElevationAtPixel(t,r,a){return this._dem.get(t,r,!!a)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Nn(1,t)*this._dem.stride}}class gb{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Eh(dt,16,0),this.featureIndexArray=new tx,this.promoteId=r}insert(t,r,a,l,u,d=0){const h=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,u,d);const p=this.grid;for(let m=0;m<r.length;m++){const _=r[m],y=[1/0,1/0,-1/0,-1/0];for(let x=0;x<_.length;x++){const b=_[x];y[0]=Math.min(y[0],b.x),y[1]=Math.min(y[1],b.y),y[2]=Math.max(y[2],b.x),y[3]=Math.max(y[3],b.y)}y[0]<dt&&y[1]<dt&&y[2]>=0&&y[3]>=0&&p.insert(h,y[0],y[1],y[2],y[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gm(new Xe(this.rawTileData)).layers,this.sourceLayerCoder=new fM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r,a,l){this.loadVTLayers();const u=t.params||{},d=k0(u.filter),h=t.tileResult,p=t.transform,m=h.bufferedTilespaceBounds,_=this.grid.query(m.min.x,m.min.y,m.max.x,m.max.y,(E,C,S,M)=>jA(h.bufferedTilespaceGeometry,E,C,S,M));_.sort(xM);let y=null;p.elevation&&_.length>0&&(y=Ka.create(p.elevation,this.tileID));const x={};let b;for(let E=0;E<_.length;E++){const C=_[E];if(C===b)continue;b=C;const S=this.featureIndexArray.get(C);let M=null;this.loadMatchingFeature(x,S,d,u.layers,u.availableImages,r,a,l,(D,R,P,I=0)=>(M||(M=jl(D,this.tileID.canonical,t.tileTransform)),R.queryIntersectsFeature(h,D,P,M,this.z,t.transform,t.pixelPosMatrix,y,I)))}return x}loadMatchingFeature(t,r,a,l,u,d,h,p,m){const{featureIndex:_,bucketIndex:y,sourceLayerIndex:x,layoutVertexArrayOffset:b}=r,E=this.bucketLayerIDs[y];if(l&&!function(D,R){for(let P=0;P<D.length;P++)if(R.indexOf(D[P])>=0)return!0;return!1}(l,E))return;const C=this.sourceLayerCoder.decode(x),S=this.vtLayers[C].feature(_);if(a.needGeometry){const D=yu(S,!0);if(!a.filter(new Ei(this.tileID.overscaledZ),D,this.tileID.canonical))return}else if(!a.filter(new Ei(this.tileID.overscaledZ),S))return;const M=this.getId(S,C);for(let D=0;D<E.length;D++){const R=E[D];if(l&&l.indexOf(R)<0)continue;const P=d[R];if(!P)continue;let I={};void 0!==M&&p&&(I=p.getState(P.sourceLayer||"_geojsonTileLayer",M));const O=Yt({},h[R]);O.paint=vM(O.paint,P.paint,S,I,u),O.layout=vM(O.layout,P.layout,S,I,u);const F=!m||m(S,P,I,b);if(!F)continue;const L=new _y(S,this.z,this.x,this.y,M);L.layer=O;let N=t[R];void 0===N&&(N=t[R]=[]),N.push({featureIndex:_,feature:L,intersectionZ:F})}}lookupSymbolFeatures(t,r,a,l,u,d,h,p){const m={};this.loadVTLayers();const _=k0(u);for(const y of t)this.loadMatchingFeature(m,{bucketIndex:a,sourceLayerIndex:l,featureIndex:y,layoutVertexArrayOffset:0},_,d,h,p,r);return m}loadFeature(t){const{featureIndex:r,sourceLayerIndex:a}=t;this.loadVTLayers();const l=this.sourceLayerCoder.decode(a),u=this.vtFeatures[l];if(u[r])return u[r];const d=this.vtLayers[l].feature(r);return u[r]=d,d}hasLayer(t){for(const r of this.bucketLayerIDs)for(const a of r)if(t===a)return!0;return!1}getId(t,r){let a=t.id;if(this.promoteId){const l="string"==typeof this.promoteId?this.promoteId:this.promoteId[r];null!=l&&(a=t.properties[l]),"boolean"==typeof a&&(a=Number(a))}return a}}function vM(n,t,r,a,l){return th(n,(u,d)=>{const h=t instanceof Pp?t.get(d):null;return h&&h.evaluate?h.evaluate(r,a,l):h})}function xM(n,t){return t-n}Xt(gb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const bM=yn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_b=yn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),xm=yn([{name:"a_projected_pos",components:4,type:"Float32"}],4);yn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xy=yn([{name:"a_z_offset",components:1,type:"Float32"}],4),wM=yn([{name:"a_texb",components:2,type:"Uint16"}]),EM=yn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),o2=yn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);yn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const CM=yn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),s2=yn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);yn([{name:"triangle",components:3,type:"Uint16"}]),yn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),yn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),yn([{type:"Float32",name:"offsetX"}]),yn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Lr=24;const Ca=128;function MM(n,t){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new Ei(n+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:a,interpolationType:l}=r;let u=0;for(;u<a.length&&a[u]<=n;)u++;u=Math.max(0,u-1);let d=u;for(;d<a.length&&a[d]<n+1;)d++;d=Math.min(a.length-1,d);const h=a[u],p=a[d];return"composite"===r.kind?{kind:"composite",minZoom:h,maxZoom:p,interpolationType:l}:{kind:"camera",minZoom:h,maxZoom:p,minSize:r.evaluate(new Ei(h)),maxSize:r.evaluate(new Ei(p)),interpolationType:l}}}function bm(n,{uSize:t,uSizeT:r},{lowerSize:a,upperSize:l}){return"source"===n.kind?a/Ca:"composite"===n.kind?_e(a/Ca,l/Ca,r):t}function Ic(n,t){let r=0,a=0;if("constant"===n.kind)a=n.layoutSize;else if("source"!==n.kind){const{interpolationType:l,minZoom:u,maxZoom:d}=n,h=l?Jt(Va.interpolationFactor(l,t,u,d),0,1):0;"camera"===n.kind?a=_e(n.minSize,n.maxSize,h):r=h}return{uSizeT:r,uSize:a}}var NF=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ca,evaluateSizeForFeature:bm,evaluateSizeForZoom:Ic,getSizeData:MM});function SM(n,t,r){return n.sections.forEach(a=>{a.text=function(l,u,d){const h=u.layout.get("text-transform").evaluate(d,{});return"uppercase"===h?l=l.toLocaleUpperCase():"lowercase"===h&&(l=l.toLocaleLowerCase()),bs.applyArabicShaping&&(l=bs.applyArabicShaping(l)),l}(a.text,t,r)}),n}const nf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function zF(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function by(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}const wy=3;function TM(n,t,r){t.glyphs=[],1===n&&r.readMessage(a2,t)}function a2(n,t,r){if(3===n){const{id:a,bitmap:l,width:u,height:d,left:h,top:p,advance:m}=r.readMessage(DM,{});t.glyphs.push({id:a,bitmap:new Mc({width:u+2*wy,height:d+2*wy},l),metrics:{width:u,height:d,left:h,top:p,advance:m}})}else 4===n?t.ascender=r.readSVarint():5===n&&(t.descender=r.readSVarint())}function DM(n,t,r){1===n?t.id=r.readVarint():2===n?t.bitmap=r.readBytes():3===n?t.width=r.readVarint():4===n?t.height=r.readVarint():5===n?t.left=r.readSVarint():6===n?t.top=r.readSVarint():7===n&&(t.advance=r.readVarint())}const yb=wy;function sn(n){let t=0,r=0;for(const d of n)t+=d.w*d.h,r=Math.max(r,d.w);n.sort((d,h)=>h.h-d.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,u=0;for(const d of n)for(let h=a.length-1;h>=0;h--){const p=a[h];if(!(d.w>p.w||d.h>p.h)){if(d.x=p.x,d.y=p.y,u=Math.max(u,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===p.w&&d.h===p.h){const m=a.pop();h<a.length&&(a[h]=m)}else d.h===p.h?(p.x+=d.w,p.w-=d.w):d.w===p.w?(p.y+=d.h,p.h-=d.h):(a.push({x:p.x+d.w,y:p.y,w:p.w-d.w,h:d.h}),p.y+=d.h,p.h-=d.h);break}}return{w:l,h:u,fill:t/(l*u)||0}}const pn=1;class Ey{constructor(t,{pixelRatio:r,version:a,stretchX:l,stretchY:u,content:d}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=u,this.content=d,this.version=a}get tl(){return[this.paddedRect.x+pn,this.paddedRect.y+pn]}get br(){return[this.paddedRect.x+this.paddedRect.w-pn,this.paddedRect.y+this.paddedRect.h-pn]}get displaySize(){return[(this.paddedRect.w-2*pn)/this.pixelRatio,(this.paddedRect.h-2*pn)/this.pixelRatio]}}class _t{constructor(t,r){const a={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(t,a,u),this.addImages(r,l,u);const{w:d,h}=sn(u),p=new Pi({width:d||1,height:h||1});for(const m in t){const _=t[m],y=a[m].paddedRect;Pi.copy(_.data,p,{x:0,y:0},{x:y.x+pn,y:y.y+pn},_.data)}for(const m in r){const _=r[m],y=l[m].paddedRect,x=y.x+pn,b=y.y+pn,E=_.data.width,C=_.data.height;Pi.copy(_.data,p,{x:0,y:0},{x,y:b},_.data),Pi.copy(_.data,p,{x:0,y:C-1},{x,y:b-1},{width:E,height:1}),Pi.copy(_.data,p,{x:0,y:0},{x,y:b+C},{width:E,height:1}),Pi.copy(_.data,p,{x:E-1,y:0},{x:x-1,y:b},{width:1,height:C}),Pi.copy(_.data,p,{x:0,y:0},{x:x+E,y:b},{width:1,height:C})}this.image=p,this.iconPositions=a,this.patternPositions=l}addImages(t,r,a){for(const l in t){const u=t[l],d={x:0,y:0,w:u.data.width+2*pn,h:u.data.height+2*pn};a.push(d),r[l]=new Ey(d,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>t.hasImage(l,a)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const l in t.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[l],t.getImage(l,a),r),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l,a),r)}patchUpdatedImage(t,r,a){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,u]=t.tl;a.update(r.data,void 0,{x:l,y:u})}}Xt(Ey,"ImagePosition"),Xt(_t,"ImageAtlas");const ti={horizontal:1,vertical:2,horizontalOnly:3},IM=-17;class Cu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const a=new Cu;return a.scale=t||1,a.fontStack=r,a}static forImage(t){const r=new Cu;return r.imageName=t,r}}class Ja{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const a=new Ja;for(let l=0;l<t.sections.length;l++){const u=t.sections[l];u.image?a.addImageSection(u):a.addTextSection(u,r)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(r,a){let l="";for(let u=0;u<r.length;u++){const d=r.charCodeAt(u+1)||null,h=r.charCodeAt(u-1)||null;l+=!a&&(d&&ad(d)&&!nf[r[u+1]]||h&&ad(h)&&!nf[r[u-1]])||!nf[r[u]]?r[u]:nf[r[u]]}return l}(this.text,t)}trim(){let t=0;for(let a=0;a<this.text.length&&Mu[this.text.charCodeAt(a)];a++)t++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Mu[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const a=new Ja;return a.text=this.text.substring(t,r),a.sectionIndex=this.sectionIndex.slice(t,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Cu.forText(t.scale,t.fontStack||r));const a=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(a)}addImageSection(t){const r=t.image?t.image.namePrimary:"";if(0===r.length)return void tt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Cu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):tt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wm(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E){const C=Ja.fromFeature(n,l);y===ti.vertical&&C.verticalizePunctuation(x);let S=[];const M=function(O,F,L,N,z,U){if(!O)return[];const V=[],G=function(it,X,Y,ot,lt,ht){let mt=0;for(let vt=0;vt<it.length();vt++){const ct=it.getSection(vt);mt+=Cy(it.getCodePoint(vt),ct,ot,lt,X,ht)}return mt/Math.max(1,Math.ceil(mt/Y))}(O,F,L,N,z,U),j=O.text.indexOf("\u200b")>=0;let Z=0;for(let it=0;it<O.length();it++){const X=O.getSection(it),Y=O.getCodePoint(it);if(Mu[Y]||(Z+=Cy(Y,X,N,z,F,U)),it<O.length()-1){const ot=!((et=Y)<11904||!(ie["Bopomofo Extended"](et)||ie.Bopomofo(et)||ie["CJK Compatibility Forms"](et)||ie["CJK Compatibility Ideographs"](et)||ie["CJK Compatibility"](et)||ie["CJK Radicals Supplement"](et)||ie["CJK Strokes"](et)||ie["CJK Symbols and Punctuation"](et)||ie["CJK Unified Ideographs Extension A"](et)||ie["CJK Unified Ideographs"](et)||ie["Enclosed CJK Letters and Months"](et)||ie["Halfwidth and Fullwidth Forms"](et)||ie.Hiragana(et)||ie["Ideographic Description Characters"](et)||ie["Kangxi Radicals"](et)||ie["Katakana Phonetic Extensions"](et)||ie.Katakana(et)||ie["Vertical Forms"](et)||ie["Yi Radicals"](et)||ie["Yi Syllables"](et)));(AM[Y]||ot||X.imageName)&&V.push(xb(it+1,Z,G,V,vb(Y,O.getCodePoint(it+1),ot&&j),!1))}}var et;return Sy(xb(O.length(),Z,G,V,0,!0))}(C,m,u,t,a,b),{processBidirectionalText:D,processStyledBidirectionalText:R}=bs;if(D&&1===C.sections.length){const O=D(C.toString(),M);for(const F of O){const L=new Ja;L.text=F,L.sections=C.sections;for(let N=0;N<F.length;N++)L.sectionIndex.push(0);S.push(L)}}else if(R){const O=R(C.text,C.sectionIndex,M);for(const F of O){const L=new Ja;L.text=F[0],L.sectionIndex=F[1],L.sections=C.sections,S.push(L)}}else S=function(O,F){const L=[],N=O.text;let z=0;for(const U of F)L.push(O.substring(z,U)),z=U;return z<N.length&&L.push(O.substring(z,N.length)),L}(C,M);const P=[],I={positionedLines:P,text:C.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:y,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(O,F,L,N,z,U,V,G,j,Z,et,it){let X=0,Y=0,ot=0;const lt="right"===G?1:"left"===G?0:.5;let ht=!1;for(const Vt of z){const jt=Vt.getSections();for(const Ht of jt){if(Ht.imageName)continue;const re=F[Ht.fontStack];if(re&&(ht=void 0!==re.ascender&&void 0!==re.descender,!ht))break}if(!ht)break}let mt=0;for(const Vt of z){Vt.trim();const jt=Vt.getMaxScale(),Ht=(jt-1)*Lr,re={positionedGlyphs:[],lineOffset:0};O.positionedLines[mt]=re;const ye=re.positionedGlyphs;let je=0;if(!Vt.length()){Y+=U,++mt;continue}let rn=0,Re=0;for(let ge=0;ge<Vt.length();ge++){const ue=Vt.getSection(ge),Le=Vt.getSectionIndex(ge),ln=Vt.getCodePoint(ge);let Be=ue.scale,Zn=null,Ti=null,di=null,ei=Lr,ur=0;const vi=!(j===ti.horizontal||!et&&!E_(ln)||et&&(Mu[ln]||(vt=ln,ie.Arabic(vt)||ie["Arabic Supplement"](vt)||ie["Arabic Extended-A"](vt)||ie["Arabic Presentation Forms-A"](vt)||ie["Arabic Presentation Forms-B"](vt))));if(ue.imageName){const hi=N[ue.imageName];if(!hi)continue;di=ue.imageName,O.iconsInText=O.iconsInText||!0,Ti=hi.paddedRect;const Gn=hi.displaySize;Be=Be*Lr/it,Zn={width:Gn[0],height:Gn[1],left:pn,top:-yb,advance:vi?Gn[1]:Gn[0],localGlyph:!1},ur=ht?-Zn.height*Be:IM+jt*Lr-Gn[1]*Be,ei=Zn.advance;const Qo=(vi?Gn[0]:Gn[1])*Be-Lr*jt;Qo>0&&Qo>je&&(je=Qo)}else{const hi=L[ue.fontStack];if(!hi)continue;hi[ln]&&(Ti=hi[ln]);const Gn=F[ue.fontStack];if(!Gn)continue;const Qo=Gn.glyphs[ln];if(!Qo)continue;if(Zn=Qo.metrics,ei=8203!==ln?Lr:0,ht){const cl=void 0!==Gn.ascender?Math.abs(Gn.ascender):0,hs=void 0!==Gn.descender?Math.abs(Gn.descender):0,Xl=(cl+hs)*Be;rn<Xl&&(rn=Xl,Re=(cl-hs)/2*Be),ur=-cl*Be}else ur=IM+(jt-Be)*Lr}vi?(O.verticalizable=!0,ye.push({glyph:ln,imageName:di,x:X,y:Y+ur,vertical:vi,scale:Be,localGlyph:Zn.localGlyph,fontStack:ue.fontStack,sectionIndex:Le,metrics:Zn,rect:Ti}),X+=ei*Be+Z):(ye.push({glyph:ln,imageName:di,x:X,y:Y+ur,vertical:vi,scale:Be,localGlyph:Zn.localGlyph,fontStack:ue.fontStack,sectionIndex:Le,metrics:Zn,rect:Ti}),X+=Zn.advance*Be+Z)}0!==ye.length&&(ot=Math.max(X-Z,ot),ht?RM(ye,lt,je,Re,U*jt/2):RM(ye,lt,je,0,U/2)),X=0;const Me=U*jt+je;re.lineOffset=Math.max(je,Ht),Y+=Me,++mt}var vt;const ct=Y,{horizontalAlign:ft,verticalAlign:Rt}=Ty(V);(function(Vt,jt,Ht,re,ye,je){const rn=(jt-Ht)*ye,Re=-je*re;for(const Me of Vt)for(const ge of Me.positionedGlyphs)ge.x+=rn,ge.y+=Re})(O.positionedLines,lt,ft,Rt,ot,ct),O.top+=-Rt*ct,O.bottom=O.top+ct,O.left+=-ft*ot,O.right=O.left+ot,O.hasBaseline=ht}(I,t,r,a,S,d,h,p,y,m,x,E),!function(O){for(const F of O)if(0!==F.positionedGlyphs.length)return!1;return!0}(P)&&I}const Mu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},AM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Cy(n,t,r,a,l,u){if(t.imageName){const d=a[t.imageName];return d?d.displaySize[0]*t.scale*Lr/u+l:0}{const d=r[t.fontStack],h=d&&d.glyphs[n];return h?h.metrics.advance*t.scale+l:0}}function My(n,t,r,a){const l=Math.pow(n-t,2);return a?n<t?l/2:2*l:l+Math.abs(r)*r}function vb(n,t,r){let a=0;return 10===n&&(a-=1e4),r&&(a+=150),40!==n&&65288!==n||(a+=50),41!==t&&65289!==t||(a+=50),a}function xb(n,t,r,a,l,u){let d=null,h=My(t,r,l,u);for(const p of a){const m=My(t-p.x,r,l,u)+p.badness;m<=h&&(d=p,h=m)}return{index:n,x:t,priorBreak:d,badness:h}}function Sy(n){return n?Sy(n.priorBreak).concat(n.index):[]}function Ty(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function RM(n,t,r,a,l){if(!(t||r||a||l))return;const u=n.length-1,d=n[u],h=(d.x+d.metrics.advance*d.scale)*t;for(let p=0;p<=u;p++)n[p].x-=h,n[p].y+=r+a+l}function l2(n,t,r,a){const{horizontalAlign:l,verticalAlign:u}=Ty(a),d=r[0]-n.displaySize[0]*l,h=r[1]-n.displaySize[1]*u;return{imagePrimary:n,imageSecondary:t,top:h,bottom:h+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function bb(n,t,r,a,l,u){const d=n.imagePrimary;let h;if(d.content){const S=d.content,M=d.pixelRatio||1;h=[S[0]/M,S[1]/M,d.displaySize[0]-S[2]/M,d.displaySize[1]-S[3]/M]}const p=t.left*u,m=t.right*u;let _,y,x,b;"width"===r||"both"===r?(b=l[0]+p-a[3],y=l[0]+m+a[1]):(b=l[0]+(p+m-d.displaySize[0])/2,y=b+d.displaySize[0]);const E=t.top*u,C=t.bottom*u;return"height"===r||"both"===r?(_=l[1]+E-a[0],x=l[1]+C+a[2]):(_=l[1]+(E+C-d.displaySize[1])/2,x=_+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:_,right:y,bottom:x,left:b,collisionPadding:h}}class Ac extends nt{constructor(t,r,a,l,u){super(t,r),this.angle=l,this.z=a,void 0!==u&&(this.segment=u)}clone(){return new Ac(this.x,this.y,this.z,this.angle,this.segment)}}function PM(n,t,r,a,l){if(void 0===t.segment)return!0;let u=t,d=t.segment+1,h=0;for(;h>-r/2;){if(d--,d<0)return!1;h-=n[d].dist(u),u=n[d]}h+=n[d].dist(n[d+1]),d++;const p=[];let m=0;for(;h<r/2;){const _=n[d],y=n[d+1];if(!y)return!1;let x=n[d-1].angleTo(_)-_.angleTo(y);for(x=Math.abs((x+3*Math.PI)%(2*Math.PI)-Math.PI),p.push({distance:h,angleDelta:x}),m+=x;h-p[0].distance>a;)m-=p.shift().angleDelta;if(m>l)return!1;d++,h+=_.dist(y)}return!0}function OM(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function kM(n,t,r){return n?.6*t*r:0}function wb(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function FM(n,t,r,a,l,u){const d=kM(r,l,u),h=wb(r,a)*u;let p=0;const m=OM(n)/2;for(let _=0;_<n.length-1;_++){const y=n[_],x=n[_+1],b=y.dist(x);if(p+b>m){const E=(m-p)/b,C=_e(y.x,x.x,E),S=_e(y.y,x.y,E),M=new Ac(C,S,0,x.angleTo(y),_);return!d||PM(n,M,h,d,t)?M:void 0}p+=b}}function c2(n,t,r,a,l,u,d,h,p){const m=kM(a,u,d),_=wb(a,l),y=_*d,x=0===n[0].x||n[0].x===p||0===n[0].y||n[0].y===p;return t-y<t/4&&(t=y+t/4),LM(n,x?t/2*h%t:(_/2+2*u)*d*h%t,t,m,r,y,x,!1,p)}function LM(n,t,r,a,l,u,d,h,p){const m=u/2,_=OM(n);let y=0,x=t-r,b=[];for(let E=0;E<n.length-1;E++){const C=n[E],S=n[E+1],M=C.dist(S),D=S.angleTo(C);for(;x+r<y+M;){x+=r;const R=(x-y)/M,P=_e(C.x,S.x,R),I=_e(C.y,S.y,R);if(P>=0&&P<p&&I>=0&&I<p&&x-m>=0&&x+m<=_){const O=new Ac(P,I,0,D,E);a&&!PM(n,O,u,a,l)||b.push(O)}}y+=M}return h||b.length||d||(b=LM(n,y/2,r,a,l,u,d,!0,p)),b}function Is(n,t,r,a,l){const u=[];for(let d=0;d<n.length;d++){const h=n[d];let p;for(let m=0;m<h.length-1;m++){let _=h[m],y=h[m+1];_.x<t&&y.x<t||(_.x<t?_=new nt(t,_.y+(t-_.x)/(y.x-_.x)*(y.y-_.y))._round():y.x<t&&(y=new nt(t,_.y+(t-_.x)/(y.x-_.x)*(y.y-_.y))._round()),_.y<r&&y.y<r||(_.y<r?_=new nt(_.x+(r-_.y)/(y.y-_.y)*(y.x-_.x),r)._round():y.y<r&&(y=new nt(_.x+(r-_.y)/(y.y-_.y)*(y.x-_.x),r)._round()),_.x>=a&&y.x>=a||(_.x>=a?_=new nt(a,_.y+(a-_.x)/(y.x-_.x)*(y.y-_.y))._round():y.x>=a&&(y=new nt(a,_.y+(a-_.x)/(y.x-_.x)*(y.y-_.y))._round()),_.y>=l&&y.y>=l||(_.y>=l?_=new nt(_.x+(l-_.y)/(y.y-_.y)*(y.x-_.x),l)._round():y.y>=l&&(y=new nt(_.x+(l-_.y)/(y.y-_.y)*(y.x-_.x),l)._round()),p&&_.equals(p[p.length-1])||(p=[_],u.push(p)),p.push(y)))))}}return u}Xt(Ac,"Anchor");const Em=1e20;function NM(n,t,r,a,l,u,d,h,p){for(let m=t;m<t+a;m++)u2(n,r*u+m,u,l,d,h,p);for(let m=r;m<r+l;m++)u2(n,m*u+t,1,a,d,h,p)}function u2(n,t,r,a,l,u,d){u[0]=0,d[0]=-Em,d[1]=Em,l[0]=n[t];for(let h=1,p=0,m=0;h<a;h++){l[h]=n[t+h*r];const _=h*h;do{const y=u[p];m=(l[h]-l[y]+_-y*y)/(h-y)/2}while(m<=d[p]&&--p>-1);p++,u[p]=h,d[p]=m,d[p+1]=Em}for(let h=0,p=0;h<a;h++){for(;d[p+1]<h;)p++;const m=u[p],_=h-m;n[t+h*r]=l[m]+_*_}}const Js=2;class Id{constructor(t,r,a){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,r){this.urls[r]=t}getGlyphs(t,r,a){const l=[],u=this.urls[r]||He.GLYPHS_URL;for(const d in t)for(const h of t[d])l.push({stack:d,id:h});Yu(l,({stack:d,id:h},p)=>{let m=this.entries[d];m||(m=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=m.glyphs[h];if(void 0!==_)return void p(null,{stack:d,id:h,glyph:_});if(_=this._tinySDF(m,d,h),_)return m.glyphs[h]=_,void p(null,{stack:d,id:h,glyph:_});const y=Math.floor(h/256);if(256*y>65535)return void p(new Error("glyphs > 65535 not supported"));if(m.ranges[y])return void p(null,{stack:d,id:h,glyph:_});let x=m.requests[y];x||(x=m.requests[y]=[],Id.loadGlyphRange(d,y,u,this.requestManager,(b,E)=>{if(E){m.ascender=E.ascender,m.descender=E.descender;for(const C in E.glyphs)this._doesCharSupportLocalGlyph(+C)||(m.glyphs[+C]=E.glyphs[+C]);m.ranges[y]=!0}for(const C of x)C(b,E);delete m.requests[y]})),x.push((b,E)=>{b?p(b):E&&p(null,{stack:d,id:h,glyph:E.glyphs[h]||null})})},(d,h)=>{if(d)a(d);else if(h){const p={};for(const{stack:m,id:_,glyph:y}of h)void 0===p[m]&&(p[m]={}),void 0===p[m].glyphs&&(p[m].glyphs={}),p[m].glyphs[_]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics},p[m].ascender=this.entries[m].ascender,p[m].descender=this.entries[m].descender;a(null,p)}})}_doesCharSupportLocalGlyph(t){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(ie["CJK Unified Ideographs"](t)||ie["Hangul Syllables"](t)||ie.Hiragana(t)||ie.Katakana(t)||ie["CJK Symbols and Punctuation"](t)||ie["CJK Unified Ideographs Extension A"](t)||ie["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,r,a){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let u=t.tinySDF;if(!u){let C="400";/bold/i.test(r)?C="900":/medium/i.test(r)?C="500":/light/i.test(r)&&(C="200"),u=t.tinySDF=new Id.TinySDF({fontFamily:l,fontWeight:C,fontSize:24*Js,buffer:3*Js,radius:8*Js}),u.fontWeight=C}if(this.localGlyphs[u.fontWeight][a])return this.localGlyphs[u.fontWeight][a];const d=String.fromCodePoint(a),{data:h,width:p,height:m,glyphWidth:_,glyphHeight:y,glyphLeft:x,glyphTop:b,glyphAdvance:E}=u.draw(d);return this.localGlyphs[u.fontWeight][a]={id:a,bitmap:new Mc({width:p,height:m},h),metrics:{width:_/Js,height:y/Js,left:x/Js,top:b/Js-27,advance:E/Js,localGlyph:!0}}}}Id.loadGlyphRange=function(n,t,r,a,l){const u=256*t,d=u+255,h=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${u}-${d}`),gt.Glyphs);zt(h,(p,m)=>{if(p)l(p);else if(m){const _={},y=new Xe(m).readFields(TM,{});for(const x of y.glyphs)_[x.id]=x;l(null,{glyphs:_,ascender:y.ascender,descender:y.descender})}})},Id.TinySDF=class{constructor({fontSize:n=24,buffer:t=3,radius:r=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:d="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=r;const h=this.size=n+4*t,p=this._createCanvas(h),m=this.ctx=p.getContext("2d",{willReadFrequently:!0});m.font=`${d} ${u} ${n}px ${l}`,m.textBaseline="alphabetic",m.textAlign="left",m.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(n){const t=document.createElement("canvas");return t.width=t.height=n,t}draw(n){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(n),d=Math.ceil(r),h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-l))),p=Math.min(this.size-this.buffer,d+Math.ceil(a)),m=h+2*this.buffer,_=p+2*this.buffer,y=Math.max(m*_,0),x=new Uint8ClampedArray(y),b={data:x,width:m,height:_,glyphWidth:h,glyphHeight:p,glyphTop:d,glyphLeft:0,glyphAdvance:t};if(0===h||0===p)return b;const{ctx:E,buffer:C,gridInner:S,gridOuter:M}=this;E.clearRect(C,C,h,p),E.fillText(n,C,C+d);const D=E.getImageData(C,C,h,p);M.fill(Em,0,y),S.fill(0,0,y);for(let R=0;R<p;R++)for(let P=0;P<h;P++){const I=D.data[4*(R*h+P)+3]/255;if(0===I)continue;const O=(R+C)*m+P+C;if(1===I)M[O]=0,S[O]=Em;else{const F=.5-I;M[O]=F>0?F*F:0,S[O]=F<0?F*F:0}}NM(M,0,0,m,_,m,this.f,this.v,this.z),NM(S,C,C,h,p,m,this.f,this.v,this.z);for(let R=0;R<y;R++){const P=Math.sqrt(M[R])-Math.sqrt(S[R]);x[R]=Math.round(255-255*(P/this.radius+this.cutoff))}return b}};const Su=pn;function zM(n,t,r,a){const l=[],u=n.imagePrimary,d=u.pixelRatio,h=u.paddedRect.w-2*Su,p=u.paddedRect.h-2*Su,m=n.right-n.left,_=n.bottom-n.top,y=u.stretchX||[[0,h]],x=u.stretchY||[[0,p]],b=(U,V)=>U+V[1]-V[0],E=y.reduce(b,0),C=x.reduce(b,0),S=h-E,M=p-C;let D=0,R=E,P=0,I=C,O=0,F=S,L=0,N=M;if(u.content&&a){const U=u.content;D=Dy(y,0,U[0]),P=Dy(x,0,U[1]),R=Dy(y,U[0],U[2]),I=Dy(x,U[1],U[3]),O=U[0]-D,L=U[1]-P,F=U[2]-U[0]-R,N=U[3]-U[1]-I}const z=(U,V,G,j)=>{const Z=Iy(U.stretch-D,R,m,n.left),et=Ay(U.fixed-O,F,U.stretch,E),it=Iy(V.stretch-P,I,_,n.top),X=Ay(V.fixed-L,N,V.stretch,C),Y=Iy(G.stretch-D,R,m,n.left),ot=Ay(G.fixed-O,F,G.stretch,E),lt=Iy(j.stretch-P,I,_,n.top),ht=Ay(j.fixed-L,N,j.stretch,C),mt=new nt(Z,it),vt=new nt(Y,it),ct=new nt(Y,lt),ft=new nt(Z,lt),Rt=new nt(et/d,X/d),Vt=new nt(ot/d,ht/d),jt=t*Math.PI/180;if(jt){const Re=Math.sin(jt),Me=Math.cos(jt),ge=[Me,-Re,Re,Me];mt._matMult(ge),vt._matMult(ge),ft._matMult(ge),ct._matMult(ge)}const Ht=U.stretch+U.fixed,re=G.stretch+G.fixed,ye=V.stretch+V.fixed,je=j.stretch+j.fixed,rn=n.imageSecondary;return{tl:mt,tr:vt,bl:ft,br:ct,texPrimary:{x:u.paddedRect.x+Su+Ht,y:u.paddedRect.y+Su+ye,w:re-Ht,h:je-ye},texSecondary:rn?{x:rn.paddedRect.x+Su+Ht,y:rn.paddedRect.y+Su+ye,w:re-Ht,h:je-ye}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rt,pixelOffsetBR:Vt,minFontScaleX:F/d/m,minFontScaleY:N/d/_,isSDF:r}};if(a&&(u.stretchX||u.stretchY)){const U=Eb(y,S,E),V=Eb(x,M,C);for(let G=0;G<U.length-1;G++){const j=U[G],Z=U[G+1];for(let et=0;et<V.length-1;et++)l.push(z(j,V[et],Z,V[et+1]))}}else l.push(z({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:h+1},{fixed:0,stretch:p+1}));return l}function Dy(n,t,r){let a=0;for(const l of n)a+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return a}function Eb(n,t,r){const a=[{fixed:-Su,stretch:0}];for(const[l,u]of n){const d=a[a.length-1];a.push({fixed:l-d.stretch,stretch:d.stretch}),a.push({fixed:l-d.stretch,stretch:d.stretch+(u-l)})}return a.push({fixed:t+Su,stretch:r}),a}function Iy(n,t,r,a){return n/t*r+a}function Ay(n,t,r,a){return n-t*r/a}function Cb(n,t,r,a){const l=t+n.positionedLines[a].lineOffset;return 0===a?r+l/2:r+(l+(t+n.positionedLines[a-1].lineOffset))/2}function d2(n,t=1,r=!1){let a=1/0,l=1/0,u=-1/0,d=-1/0;const h=n[0];for(let b=0;b<h.length;b++){const E=h[b];(!b||E.x<a)&&(a=E.x),(!b||E.y<l)&&(l=E.y),(!b||E.x>u)&&(u=E.x),(!b||E.y>d)&&(d=E.y)}const p=Math.min(u-a,d-l);let m=p/2;const _=new _p([],h2);if(0===p)return new nt(a,l);for(let b=a;b<u;b+=p)for(let E=l;E<d;E+=p)_.push(new rf(b+m,E+m,m,n));let y=function(b){let E=0,C=0,S=0;const M=b[0];for(let D=0,R=M.length,P=R-1;D<R;P=D++){const I=M[D],O=M[P],F=I.x*O.y-O.x*I.y;C+=(I.x+O.x)*F,S+=(I.y+O.y)*F,E+=3*F}return new rf(C/E,S/E,0,b)}(n),x=_.length;for(;_.length;){const b=_.pop();(b.d>y.d||!y.d)&&(y=b,r&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,x)),b.max-y.d<=t||(m=b.h/2,_.push(new rf(b.p.x-m,b.p.y-m,m,n)),_.push(new rf(b.p.x+m,b.p.y-m,m,n)),_.push(new rf(b.p.x-m,b.p.y+m,m,n)),_.push(new rf(b.p.x+m,b.p.y+m,m,n)),x+=4)}return r&&(console.log(`num probes: ${x}`),console.log(`best distance: ${y.d}`)),y.p}function h2(n,t){return t.max-n.max}class rf{constructor(t,r,a,l){this.p=new nt(t,r),this.h=a,this.d=function(u,d){let h=!1,p=1/0;for(let m=0;m<d.length;m++){const _=d[m];for(let y=0,x=_.length,b=x-1;y<x;b=y++){const E=_[y],C=_[b];E.y>u.y!=C.y>u.y&&u.x<(C.x-E.x)*(u.y-E.y)/(C.y-E.y)+E.x&&(h=!h),p=Math.min(p,jx(u,E,C))}}return(h?1:-1)*Math.sqrt(p)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const sf=7,Mb=Number.POSITIVE_INFINITY,Hl=Math.sqrt(2);function Cm(n,[t,r]){let a=0,l=0;if(r===Mb){t<0&&(t=0);const u=t/Hl;switch(n){case"top-right":case"top-left":l=u-sf;break;case"bottom-right":case"bottom-left":l=-u+sf;break;case"bottom":l=-t+sf;break;case"top":l=t-sf}switch(n){case"top-right":case"bottom-right":a=-u;break;case"top-left":case"bottom-left":a=u;break;case"left":a=t;break;case"right":a=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),n){case"top-right":case"top-left":case"top":l=r-sf;break;case"bottom-right":case"bottom-left":case"bottom":l=-r+sf}switch(n){case"top-right":case"bottom-right":case"right":a=-t;break;case"top-left":case"bottom-left":case"left":a=t}}return[a,l]}function f2(n,t,r,a,l,u,d,h,p,m,_){n.createArrays(),n.tilePixelRatio=dt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const y=n.layers[0].layout,x=n.layers[0]._unevaluatedLayout._values,b={};if("composite"===n.textSizeData.kind){const{minZoom:M,maxZoom:D}=n.textSizeData;b.compositeTextSizes=[x["text-size"].possiblyEvaluate(new Ei(M),h),x["text-size"].possiblyEvaluate(new Ei(D),h)]}if("composite"===n.iconSizeData.kind){const{minZoom:M,maxZoom:D}=n.iconSizeData;b.compositeIconSizes=[x["icon-size"].possiblyEvaluate(new Ei(M),h),x["icon-size"].possiblyEvaluate(new Ei(D),h)]}b.layoutTextSize=x["text-size"].possiblyEvaluate(new Ei(p+1),h),b.layoutIconSize=x["icon-size"].possiblyEvaluate(new Ei(p+1),h),b.textMaxSize=x["text-size"].possiblyEvaluate(new Ei(18),h);const E="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement"),C=y.get("text-size");let S=!1;for(const M of n.features)if(M.icon&&M.icon.nameSecondary){S=!0;break}for(const M of n.features){const D=y.get("text-font").evaluate(M,{},h).join(","),R=C.evaluate(M,{},h),P=b.layoutTextSize.evaluate(M,{},h),I=(b.layoutIconSize.evaluate(M,{},h),{horizontal:{},vertical:void 0}),O=M.text;let F,L=[0,0];if(O){const U=O.toString(),V=y.get("text-letter-spacing").evaluate(M,{},h)*Lr,G=y.get("text-line-height").evaluate(M,{},h)*Lr,j=fA(U)?V:0,Z=y.get("text-anchor").evaluate(M,{},h),et=y.get("text-variable-anchor");if(!et){const lt=y.get("text-radial-offset").evaluate(M,{},h);L=lt?Cm(Z,[lt*Lr,Mb]):y.get("text-offset").evaluate(M,{},h).map(ht=>ht*Lr)}let it=E?"center":y.get("text-justify").evaluate(M,{},h);const X="point"===y.get("symbol-placement"),Y=X?y.get("text-max-width").evaluate(M,{},h)*Lr:1/0,ot=lt=>{n.allowVerticalPlacement&&$0(U)&&(I.vertical=wm(O,t,r,l,D,Y,G,Z,lt,j,L,ti.vertical,!0,P,R))};if(!E&&et){const lt="auto"===it?et.map(mt=>Ry(mt)):[it];let ht=!1;for(let mt=0;mt<lt.length;mt++){const vt=lt[mt];if(!I.horizontal[vt])if(ht)I.horizontal[vt]=I.horizontal[0];else{const ct=wm(O,t,r,l,D,Y,G,"center",vt,j,L,ti.horizontal,!1,P,R);ct&&(I.horizontal[vt]=ct,ht=1===ct.positionedLines.length)}}ot("left")}else{if("auto"===it&&(it=Ry(Z)),X||y.get("text-writing-mode").indexOf("horizontal")>=0||!$0(U)){const lt=wm(O,t,r,l,D,Y,G,Z,it,j,L,ti.horizontal,!1,P,R);lt&&(I.horizontal[it]=lt)}ot(X?"left":it)}}let N=!1;if(M.icon&&M.icon.namePrimary){const U=a[M.icon.namePrimary];U&&(F=l2(l[M.icon.namePrimary],M.icon.nameSecondary?l[M.icon.nameSecondary]:void 0,y.get("icon-offset").evaluate(M,{},h),y.get("icon-anchor").evaluate(M,{},h)),N=U.sdf,void 0===n.sdfIcons?n.sdfIcons=U.sdf:n.sdfIcons!==U.sdf&&tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(U.pixelRatio!==n.pixelRatio||0!==y.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const z=Py(I.horizontal)||I.vertical;n.iconsInText||(n.iconsInText=!!z&&z.iconsInText),(z||F)&&p2(n,M,I,F,a,b,P,0,L,N,d,h,m,_,S)}u&&n.generateCollisionDebugBuffers(p,n.collisionBoxArray)}function Ry(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function p2(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E){let C=u.textMaxSize.evaluate(t,{},y);void 0===C&&(C=d);const S=n.layers[0].layout,M=S.get("icon-offset").evaluate(t,{},y),D=Py(r.horizontal)||r.vertical,R="globe"===x.name,P=Lr,I=d/P,O=n.tilePixelRatio*C/P,F=(Z=n.overscaling,n.zoom>18&&Z>2&&(Z>>=1),Math.max(dt/(512*Z),1)*S.get("symbol-spacing")),L=S.get("text-padding")*n.tilePixelRatio,N=S.get("icon-padding")*n.tilePixelRatio,z=Ie(S.get("text-max-angle")),U="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),V="map"===S.get("icon-rotation-alignment")&&"point"!==S.get("symbol-placement"),G=S.get("symbol-placement"),j=F/2;var Z;const et=S.get("icon-text-fit").evaluate(t,{},y),it=S.get("icon-text-fit-padding").evaluate(t,{},y),X="none"!==et;let Y;!1===n.hasAnyIconTextFit&&X&&(n.hasAnyIconTextFit=!0),a&&X&&(n.allowVerticalPlacement&&r.vertical&&(Y=bb(a,r.vertical,et,it,M,I)),D&&(a=bb(a,D,et,it,M,I)));const ot=(lt,ht,mt)=>{if(ht.x<0||ht.x>=dt||ht.y<0||ht.y>=dt)return;let vt=null;if(R){const{x:ct,y:ft,z:Rt}=x.projectTilePoint(ht.x,ht.y,mt);vt={anchor:new Ac(ct,ft,Rt,0,void 0),up:x.upVector(mt,ht.x,ht.y)}}!function(ct,ft,Rt,Vt,jt,Ht,re,ye,je,rn,Re,Me,ge,ue,Le,ln,Be,Zn,Ti,di,ei,ur,vi,hi,Gn,Qo,cl){const hs=ct.addToLineVertexArray(ft,Vt);let Xl,Vd,jd,Rv,Pv,Ov,yg,RP=0,PP=0,OP=0,cw=0,uw=-1,dw=-1;const Yl={};let cD=j_("");const Nu=Rt?Rt.anchor:ft,kv="none"!==je.layout.get("icon-text-fit").evaluate(ei,{},Gn);let Fv=0,hw=0;if(void 0===je._unevaluatedLayout.getValue("text-radial-offset")?[Fv,hw]=je.layout.get("text-offset").evaluate(ei,{},Gn).map(na=>na*Lr):(Fv=je.layout.get("text-radial-offset").evaluate(ei,{},Gn)*Lr,hw=Mb),ct.allowVerticalPlacement&&jt.vertical){const na=jt.vertical;if(Le)Ov=Oy(na),ye&&(yg=Oy(ye));else{const fs=je.layout.get("text-rotate").evaluate(ei,{},Gn)+90;jd=Sb(rn,Nu,ft,Re,Me,ge,na,ue,fs,ln),ye&&(Rv=Sb(rn,Nu,ft,Re,Me,ge,ye,Zn,fs))}}if(Ht){const na=je.layout.get("icon-rotate").evaluate(ei,{},Gn),fs=zM(Ht,na,vi,kv),Kl=ye?zM(ye,na,vi,kv):void 0;Vd=Sb(rn,Nu,ft,Re,Me,ge,Ht,Zn,na),RP=4*fs.length;const uD=ct.iconSizeData;let Ud=null;"source"===uD.kind?(Ud=[Ca*je.layout.get("icon-size").evaluate(ei,{},Gn)],Ud[0]>Rc&&tt(`${ct.layerIds[0]}: Value for "icon-size" is >= ${af}. Reduce your "icon-size".`)):"composite"===uD.kind&&(Ud=[Ca*ur.compositeIconSizes[0].evaluate(ei,{},Gn),Ca*ur.compositeIconSizes[1].evaluate(ei,{},Gn)],(Ud[0]>Rc||Ud[1]>Rc)&&tt(`${ct.layerIds[0]}: Value for "icon-size" is >= ${af}. Reduce your "icon-size".`)),ct.addSymbols(ct.icon,fs,Ud,di,Ti,ei,!1,Rt,ft,hs.lineStartIndex,hs.lineLength,-1,hi,Gn,Qo,cl),uw=ct.icon.placedSymbolArray.length-1,Kl&&(PP=4*Kl.length,ct.addSymbols(ct.icon,Kl,Ud,di,Ti,ei,ti.vertical,Rt,ft,hs.lineStartIndex,hs.lineLength,-1,hi,Gn,Qo,cl),dw=ct.icon.placedSymbolArray.length-1)}for(const na in jt.horizontal){const fs=jt.horizontal[na];Xl||(cD=j_(fs.text),Le?Pv=Oy(fs):Xl=Sb(rn,Nu,ft,Re,Me,ge,fs,ue,je.layout.get("text-rotate").evaluate(ei,{},Gn),ln));const Kl=1===fs.positionedLines.length;if(OP+=Mm(ct,Rt,ft,fs,re,je,Le,ei,ln,hs,jt.vertical?ti.horizontal:ti.horizontalOnly,Kl?Object.keys(jt.horizontal):[na],Yl,uw,ur,hi,Gn,Qo),Kl)break}jt.vertical&&(cw+=Mm(ct,Rt,ft,jt.vertical,re,je,Le,ei,ln,hs,ti.vertical,["vertical"],Yl,dw,ur,hi,Gn,Qo));let zu=-1;const Lv=(na,fs)=>na?Math.max(na,fs):fs;zu=Lv(Pv,zu),zu=Lv(Ov,zu),zu=Lv(yg,zu);const Nv=zu>-1?1:0;ct.glyphOffsetArray.length>=Rm.MAX_GLYPHS&&tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ei.sortKey&&ct.addToSortKeyRanges(ct.symbolInstances.length,ei.sortKey),ct.symbolInstances.emplaceBack(ft.x,ft.y,Nu.x,Nu.y,Nu.z,Yl.right>=0?Yl.right:-1,Yl.center>=0?Yl.center:-1,Yl.left>=0?Yl.left:-1,Yl.vertical>=0?Yl.vertical:-1,uw,dw,cD,void 0!==Xl?Xl:ct.collisionBoxArray.length,void 0!==Xl?Xl+1:ct.collisionBoxArray.length,void 0!==jd?jd:ct.collisionBoxArray.length,void 0!==jd?jd+1:ct.collisionBoxArray.length,void 0!==Vd?Vd:ct.collisionBoxArray.length,void 0!==Vd?Vd+1:ct.collisionBoxArray.length,Rv||ct.collisionBoxArray.length,Rv?Rv+1:ct.collisionBoxArray.length,Re,OP,cw,RP,PP,Nv,0,Fv,hw,zu,0,kv?1:0)}(n,ht,vt,lt,r,a,l,Y,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,L,U,p,0,N,V,M,t,u,m,_,y,b,E)};if("line"===G)for(const lt of Is(t.geometry,0,0,dt,dt)){const ht=c2(lt,F,z,r.vertical||D,a,P,O,n.overscaling,dt);for(const mt of ht)D&&BM(n,D.text,j,mt)||ot(lt,mt,y)}else if("line-center"===G){for(const lt of t.geometry)if(lt.length>1){const ht=FM(lt,z,r.vertical||D,a,P,O);ht&&ot(lt,ht,y)}}else if("Polygon"===t.type)for(const lt of Kh(t.geometry,0)){const ht=d2(lt,16);ot(lt[0],new Ac(ht.x,ht.y,0,0,void 0),y)}else if("LineString"===t.type)for(const lt of t.geometry)ot(lt,new Ac(lt[0].x,lt[0].y,0,0,void 0),y);else if("Point"===t.type)for(const lt of t.geometry)for(const ht of lt)ot([ht],new Ac(ht.x,ht.y,0,0,void 0),y)}const af=255,Rc=af*Ca;function Mm(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M){const D=function(I,O,F,L,N,z,U,V){const G=[];if(0===O.positionedLines.length)return G;const j=L.layout.get("text-rotate").evaluate(z,{})*Math.PI/180,Z=function(ot){const lt=ot[0],ht=ot[1],mt=lt*ht;return mt>0?[lt,-ht]:mt<0?[-lt,ht]:0===lt?[ht,lt]:[ht,-lt]}(F);let et=Math.abs(O.top-O.bottom);for(const ot of O.positionedLines)et-=ot.lineOffset;const it=O.positionedLines.length,X=et/it;let Y=O.top-F[1];for(let ot=0;ot<it;++ot){const lt=O.positionedLines[ot];Y=Cb(O,X,Y,ot);for(const ht of lt.positionedGlyphs){if(!ht.rect)continue;const mt=ht.rect||{};let vt=yb+1,ct=!0,ft=1,Rt=0;if(ht.imageName){const di=U[ht.imageName];if(!di)continue;if(di.sdf){tt("SDF images are not supported in formatted text and will be ignored.");continue}ct=!1,ft=di.pixelRatio,vt=pn/ft}const Vt=(N||V)&&ht.vertical,jt=ht.metrics.advance*ht.scale/2,Ht=ht.metrics,re=ht.rect;if(null===re)continue;V&&O.verticalizable&&(Rt=ht.imageName?jt-ht.metrics.width*ht.scale/2:0);const ye=N?[ht.x+jt,ht.y]:[0,0];let je=[0,0],rn=[0,0],Re=!1;N||(Vt?(rn=[ht.x+jt+Z[0],ht.y+Z[1]-Rt],Re=!0):je=[ht.x+jt+F[0],ht.y+F[1]-Rt]);const Me=re.w*ht.scale/(ft*(ht.localGlyph?Js:1)),ge=re.h*ht.scale/(ft*(ht.localGlyph?Js:1));let ue,Le,ln,Be;if(Vt){const di=ht.y-Y,ei=new nt(-jt,jt-di),ur=-Math.PI/2,vi=new nt(...rn);ue=new nt(-jt+je[0],je[1]),ue._rotateAround(ur,ei)._add(vi),ue.x+=-di+jt,ue.y-=(Ht.left-vt)*ht.scale;const hi=ht.imageName?Ht.advance*ht.scale:Lr*ht.scale,Gn=String.fromCodePoint(ht.glyph);zF(Gn)?ue.x+=(1-vt)*ht.scale:by(Gn)?ue.x+=hi-Ht.height*ht.scale+(-vt-1)*ht.scale:ue.x+=ht.imageName||Ht.width+2*vt===re.w&&Ht.height+2*vt===re.h?(hi-ge)/2:(hi-(Ht.height+2*vt)*ht.scale)/2,Le=new nt(ue.x,ue.y-Me),ln=new nt(ue.x+ge,ue.y),Be=new nt(ue.x+ge,ue.y-Me)}else{const di=(Ht.left-vt)*ht.scale-jt+je[0],ei=(-Ht.top-vt)*ht.scale+je[1],ur=di+Me,vi=ei+ge;ue=new nt(di,ei),Le=new nt(ur,ei),ln=new nt(di,vi),Be=new nt(ur,vi)}if(j){let di;di=N?new nt(0,0):Re?new nt(Z[0],Z[1]):new nt(F[0],F[1]),ue._rotateAround(j,di),Le._rotateAround(j,di),ln._rotateAround(j,di),Be._rotateAround(j,di)}const Zn=new nt(0,0),Ti=new nt(0,0);G.push({tl:ue,tr:Le,bl:ln,br:Be,texPrimary:mt,texSecondary:void 0,writingMode:O.writingMode,glyphOffset:ye,sectionIndex:ht.sectionIndex,isSDF:ct,pixelOffsetTL:Zn,pixelOffsetBR:Ti,minFontScaleX:0,minFontScaleY:0})}}return G}(0,a,p,u,d,h,l,n.allowVerticalPlacement),R=n.textSizeData;let P=null;"source"===R.kind?(P=[Ca*u.layout.get("text-size").evaluate(h,{},S)],P[0]>Rc&&tt(`${n.layerIds[0]}: Value for "text-size" is >= ${af}. Reduce your "text-size".`)):"composite"===R.kind&&(P=[Ca*E.compositeTextSizes[0].evaluate(h,{},S),Ca*E.compositeTextSizes[1].evaluate(h,{},S)],(P[0]>Rc||P[1]>Rc)&&tt(`${n.layerIds[0]}: Value for "text-size" is >= ${af}. Reduce your "text-size".`)),n.addSymbols(n.text,D,P,p,d,h,_,t,r,m.lineStartIndex,m.lineLength,b,C,S,M,!1);for(const I of y)x[I]=n.text.placedSymbolArray.length-1;return 4*D.length}function Py(n){for(const t in n)return n[t];return null}function Sb(n,t,r,a,l,u,d,h,p,m){let _=d.top,y=d.bottom,x=d.left,b=d.right;const E=d.collisionPadding;if(E&&(x-=E[0],_-=E[1],b+=E[2],y+=E[3]),p){const C=new nt(x,_),S=new nt(b,_),M=new nt(x,y),D=new nt(b,y),R=Ie(p);let P=new nt(0,0);m&&(P=new nt(m[0],m[1])),C._rotateAround(R,P),S._rotateAround(R,P),M._rotateAround(R,P),D._rotateAround(R,P),x=Math.min(C.x,S.x,M.x,D.x),b=Math.max(C.x,S.x,M.x,D.x),_=Math.min(C.y,S.y,M.y,D.y),y=Math.max(C.y,S.y,M.y,D.y)}return n.emplaceBack(t.x,t.y,t.z,r.x,r.y,x,_,b,y,h,a,l,u),n.length-1}function Oy(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const t=n.bottom-n.top;return t>0?Math.max(10,t):null}function BM(n,t,r,a){const l=n.compareText;if(t in l){const u=l[t];for(let d=u.length-1;d>=0;d--)if(a.dist(u[d])<r)return!0}else l[t]=[];return l[t].push(a),!1}function Tb(n,t){const r=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*t:0,l=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),u=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01)),d=Math.sin(n._pitch)*u+l;return Math.min(1.01*d,l*(1/n._horizonShift))}function Tu(n,t){if(!t.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:t};const r=Math.pow(2,-n.z),a=n.x*r,l=(n.x+1)*r,u=n.y*r,d=(n.y+1)*r,h=Ts(a),p=Ts(l),m=lr(u),_=lr(d),y=t.project(h,m),x=t.project(p,m),b=t.project(p,_),E=t.project(h,_);let C=Math.min(y.x,x.x,b.x,E.x),S=Math.min(y.y,x.y,b.y,E.y),M=Math.max(y.x,x.x,b.x,E.x),D=Math.max(y.y,x.y,b.y,E.y);const R=r/16;function P(O,F,L,N,z,U){const V=(L+z)/2,G=(N+U)/2,j=t.project(Ts(V),lr(G)),Z=Math.max(0,C-j.x,S-j.y,j.x-M,j.y-D);C=Math.min(C,j.x),M=Math.max(M,j.x),S=Math.min(S,j.y),D=Math.max(D,j.y),Z>R&&(P(O,j,L,N,V,G),P(j,F,V,G,z,U))}P(y,x,a,u,l,u),P(x,b,l,u,l,d),P(b,E,l,d,a,d),P(E,y,a,d,a,u),C-=R,S-=R,M+=R,D+=R;const I=1/Math.max(M-C,D-S);return{scale:I,x:C*I,y:S*I,x2:M*I,y2:D*I,projection:t}}function ky(n,t,r,a,l,u,d,h,p){if("globe"===p.name)return ey(n,t,new ya(r,a,l),!1);const m=Tu({z:r,x:a,y:l},p);return new ui([(u+m.x/m.scale)*t,t*(m.y/m.scale),d],[(u+m.x2/m.scale)*t,t*(m.y2/m.scale),h])}function $l(n,{x:t,y:r},a=0){return new nt(((t-a)*n.scale-n.x)*dt,(r*n.scale-n.y)*dt)}function VM(n,t,r=0){return q.fromValues(((t.x-r)*n.scale-n.x)*dt,(t.y*n.scale-n.y)*dt,JC(t.z,t.y))}const m2=rt.identity(new Float32Array(16));class Gl{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new we(0,0)}projectTilePoint(t,r,a){return{x:t,y:r,z:0}}locationPoint(t,r,a=!0){return t._coordinatePoint(t.locationCoordinate(r),a)}pixelsPerMeter(t,r){return Nn(1,t)*r}pixelSpaceConversion(t,r,a){return 1}farthestPixelDistance(t){return Tb(t,t.pixelsPerMeter)}pointCoordinate(t,r,a,l){const u=t.horizonLineFromTop(!1),d=new nt(r,Math.max(u,a));return t.rayIntersectionCoordinate(t.pointRayIntersection(d,l))}pointCoordinate3D(t,r,a){const l=new nt(r,a);if(t.elevation)return t.elevation.pointCoordinate(l);{const u=this.pointCoordinate(t,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(t,r){if(t.elevation)return!this.pointCoordinate3D(t,r.x,r.y);const a=t.horizonLineFromTop();return r.y<a}createInversionMatrix(t,r){return m2}createTileMatrix(t,r,a){let l,u,d;const h=a.canonical,p=rt.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const m=Tu(h,this);l=1,u=m.x+a.wrap*m.scale,d=m.y,rt.scale(p,p,[l/m.scale,l/m.scale,t.pixelsPerMeter/r])}else l=r/t.zoomScale(h.z),u=(h.x+Math.pow(2,h.z)*a.wrap)*l,d=h.y*l;return rt.translate(p,p,[u,d,0]),rt.scale(p,p,[l/dt,l/dt,1]),p}upVector(t,r,a){return[0,0,1]}upVectorScale(t,r,a){return{metersToTile:1}}}class g2 extends Gl{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,a]=this.parallels=t.parallels||[29.5,45.5],l=Math.sin(Ie(r));this.n=(l+Math.sin(Ie(a)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:a,c:l,r0:u}=this,d=Ie(t-this.center[0]),h=Ie(r),p=Math.sqrt(l-2*a*Math.sin(h))/a;return{x:p*Math.sin(d*a),y:p*Math.cos(d*a)-u,z:0}}unproject(t,r){const{n:a,c:l,r0:u}=this,d=u+r;let h=Math.atan2(t,Math.abs(d))*Math.sign(d);d*a<0&&(h-=Math.PI*Math.sign(t)*Math.sign(d));const p=Ie(this.center[0])*a;h=wl(h,-Math.PI-p,Math.PI-p);const m=Jt(Cr(h/a)+this.center[0],-180,180),_=Math.asin(Jt((l-(t*t+d*d)*a*a)/(2*a),-1,1)),y=Jt(Cr(_),-Gi,Gi);return new we(m,y)}}const lf=1.340264,Sm=-.081106,Du=893e-6,Pc=.003796,Tm=Math.sqrt(3)/2;class Fy extends Gl{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const a=Math.asin(Tm*Math.sin(r)),l=a*a,u=l*l*l;return{x:.5*(t*Math.cos(a)/(Tm*(lf+3*Sm*l+u*(7*Du+9*Pc*l)))/Math.PI+.5),y:1-.5*(a*(lf+Sm*l+u*(Du+Pc*l))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=a*a,u=l*l*l;for(let _,y,x,b=0;b<12&&(y=a*(lf+Sm*l+u*(Du+Pc*l))-r,x=lf+3*Sm*l+u*(7*Du+9*Pc*l),_=y/x,a=Jt(a-_,-Math.PI/3,Math.PI/3),l=a*a,u=l*l*l,!(Math.abs(_)<1e-12));++b);const d=Tm*t*(lf+3*Sm*l+u*(7*Du+9*Pc*l))/Math.cos(a),h=Math.asin(Math.sin(a)/Tm),p=Jt(180*d/Math.PI,-180,180),m=Jt(180*h/Math.PI,-Gi,Gi);return new we(p,m)}}class BF extends Gl{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const a=360*(t-.5),l=Jt(360*(.5-r),-Gi,Gi);return new we(a,l)}}const cf=Math.PI/2;function Dm(n){return Math.tan((cf+n)/2)}class jM extends Gl{constructor(t){super(t),this.center=t.center||[0,30];const[r,a]=this.parallels=t.parallels||[30,30];let l=Ie(r),u=Ie(a);this.southernCenter=l+u<0,this.southernCenter&&(l=-l,u=-u);const d=Math.cos(l),h=Dm(l);this.n=l===u?Math.sin(l):Math.log(d/Math.cos(u))/Math.log(Dm(u)/h),this.f=d*Math.pow(Dm(l),this.n)/this.n}project(t,r){r=Ie(r),this.southernCenter&&(r=-r),t=Ie(t-this.center[0]);const a=1e-6,{n:l,f:u}=this;u>0?r<-cf+a&&(r=-cf+a):r>cf-a&&(r=cf-a);const d=u/Math.pow(Dm(r),l);let h=d*Math.sin(l*t),p=u-d*Math.cos(l*t);return h=.5*(h/Math.PI+.5),p=.5*(p/Math.PI+.5),{x:h,y:this.southernCenter?p:1-p,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:l}=this,u=l-r,d=Math.sign(u),h=Math.sign(a)*Math.sqrt(t*t+u*u);let p=Math.atan2(t,Math.abs(u))*d;u*a<0&&(p-=Math.PI*Math.sign(t)*d);const m=Jt(Cr(p/a)+this.center[0],-180,180),_=Jt(Cr(2*Math.atan(Math.pow(l/h,1/a))-cf),-Gi,Gi);return new we(m,this.southernCenter?-_:_)}}class UM extends Gl{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:no(t),y:mo(r),z:0}}unproject(t,r){const a=Ts(t),l=lr(r);return new we(a,l)}}const HM=Ie(Gi);class $M extends Gl{project(t,r){const a=(r=Ie(r))*r,l=a*a;return{x:.5*((t=Ie(t))*(.8707-.131979*a+l*(l*(.003971*a-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+l*(.028874*a-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,l=25,u=0,d=a*a;do{d=a*a;const m=d*d;u=(a*(1.007226+d*(.015085+m*(.028874*d-.044475-.005916*m)))-r)/(1.007226+d*(.045255+m*(.259866*d-.311325-.005916*11*m))),a=Jt(a-u,-HM,HM)}while(Math.abs(u)>1e-6&&--l>0);d=a*a;const h=Jt(Cr(t/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),p=Cr(a);return new we(h,p)}}const Db=Ie(Gi);class Im extends Gl{project(t,r){r=Ie(r),t=Ie(t);const a=Math.cos(r),l=2/Math.PI,u=Math.acos(a*Math.cos(t/2)),d=Math.sin(u)/u,h=.5*(t*l+2*a*Math.sin(t/2)/d)||0,p=.5*(r+Math.sin(r)/d)||0;return{x:.5*(h/Math.PI+.5),y:1-.5*(p/Math.PI+1),z:0}}unproject(t,r){let a=t=(2*t-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,u=25;const d=1e-6;let h=0,p=0;do{const m=Math.cos(l),_=Math.sin(l),y=2*_*m,x=_*_,b=m*m,E=Math.cos(a/2),C=Math.sin(a/2),S=2*E*C,M=C*C,D=1-b*E*E,R=D?1/D:0,P=D?Math.acos(m*E)*Math.sqrt(1/D):0,I=.5*(2*P*m*C+2*a/Math.PI)-t,O=.5*(P*_+l)-r,F=.5*R*(b*M+P*m*E*x)+1/Math.PI,L=R*(S*y/4-P*_*C),N=.125*R*(y*C-P*_*b*S),z=.5*R*(x*E+P*M*m)+.5,U=L*N-z*F;h=(O*L-I*z)/U,p=(I*N-O*F)/U,a=Jt(a-h,-Math.PI,Math.PI),l=Jt(l-p,-Db,Db)}while((Math.abs(h)>d||Math.abs(p)>d)&&--u>0);return new we(Cr(a),Cr(l))}}class GM extends Gl{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ie(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:a,cosPhi:l}=this;return{x:Ie(t)*l*a+.5,y:-Math.sin(Ie(r))/l*a+.5,z:0}}unproject(t,r){const{scale:a,cosPhi:l}=this,u=-(r-.5)/a,d=Jt(Cr((t-.5)/a)/l,-180,180),h=Math.asin(Jt(u*l,-1,1)),p=Jt(Cr(h),-Gi,Gi);return new we(d,p)}}class qM extends UM{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,a){const l=Jp(t,r,a),u=eo(ko(a));return q.transformMat4(l,l,u),{x:l[0],y:l[1],z:l[2]}}locationPoint(t,r){const a=cs(r.lat,r.lng),l=q.normalize([],a),u=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude,d=Nn(1,0)*dt*u;q.scaleAndAdd(a,a,l,d);const h=rt.identity(new Float64Array(16));return rt.multiply(h,t.pixelMatrix,t.globeMatrix),q.transformMat4(a,a,h),new nt(a[0],a[1])}pixelsPerMeter(t,r){return Nn(1,0)*r}pixelSpaceConversion(t,r,a){const l=Nn(1,t)*r,u=_e(Nn(1,45)*r,l,a);return this.pixelsPerMeter(t,r)/u}createTileMatrix(t,r,a){const l=ba(ko(a.canonical));return rt.multiply(new Float64Array(16),t.globeMatrix,l)}createInversionMatrix(t,r){const{center:a}=t,l=eo(ko(r));return rt.rotateY(l,l,Ie(a.lng)),rt.rotateX(l,l,Ie(a.lat)),rt.scale(l,l,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(t,r,a,l){return UC(t,r,a,!0)||new Je(0,0)}pointCoordinate3D(t,r,a){const l=this.pointCoordinate(t,r,a,0);return[l.x,l.y,l.z]}isPointAboveHorizon(t,r){return!UC(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=function(l,u){const d=l.cameraToCenterDistance,h=l._centerAltitude*u,p=l._camera,m=l._camera.forward(),_=q.add([],q.scale([],m,-d),[0,0,h]),y=l.worldSize/(2*Math.PI),x=[0,0,-y],b=l.width/l.height,E=Math.tan(l.fovAboveCenter),C=q.scale([],p.up(),E),S=q.scale([],p.right(),E*b),M=q.normalize([],q.add([],q.add([],m,C),S)),D=[];let R;if(new Vh(_,M).closestPointOnSphere(x,y,D)){const P=q.add([],D,x),I=q.sub([],P,_);R=Math.cos(l.fovAboveCenter)*q.length(I)}else{const P=q.sub([],_,x),I=q.sub([],x,_);q.normalize(I,I);const O=q.length(P)-y;R=Math.sqrt(O*(O+2*y));const F=Math.acos(R/(y+O))-Math.acos(q.dot(m,I));R*=Math.cos(F)}return 1.01*R}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),a=Vr(t.zoom);if(a>0){const l=Tb(t,Nn(1,t.center.lat)*t.worldSize),u=t.worldSize/(2*Math.PI),d=Math.max(t.width,t.height)/t.worldSize*Math.PI;return _e(r,l+u*(1-Math.cos(d)),Math.pow(a,10))}return r}upVector(t,r,a){return Jp(r,a,t,1)}upVectorScale(t){return{metersToTile:Ix(ny(ko(t)))}}}function Am(n){const t=n.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(n.name){case"mercator":return new UM(n);case"equirectangular":return new BF(n);case"naturalEarth":return new $M(n);case"equalEarth":return new Fy(n);case"winkelTripel":return new Im(n);case"albers":return r?new GM(n):new g2(n);case"lambertConformalConic":return r?new GM(n):new jM(n);case"globe":return new qM(n)}throw new Error(`Invalid projection name: ${n.name}`)}const _2=new Ci({"symbol-placement":new Dt(J.layout_symbol["symbol-placement"]),"symbol-spacing":new Dt(J.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dt(J.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new se(J.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dt(J.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Dt(J.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Dt(J.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Dt(J.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dt(J.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dt(J.layout_symbol["icon-rotation-alignment"]),"icon-size":new se(J.layout_symbol["icon-size"]),"icon-text-fit":new se(J.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new se(J.layout_symbol["icon-text-fit-padding"]),"icon-image":new se(J.layout_symbol["icon-image"]),"icon-rotate":new se(J.layout_symbol["icon-rotate"]),"icon-padding":new Dt(J.layout_symbol["icon-padding"]),"icon-keep-upright":new Dt(J.layout_symbol["icon-keep-upright"]),"icon-offset":new se(J.layout_symbol["icon-offset"]),"icon-anchor":new se(J.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dt(J.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dt(J.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dt(J.layout_symbol["text-rotation-alignment"]),"text-field":new se(J.layout_symbol["text-field"]),"text-font":new se(J.layout_symbol["text-font"]),"text-size":new se(J.layout_symbol["text-size"]),"text-max-width":new se(J.layout_symbol["text-max-width"]),"text-line-height":new se(J.layout_symbol["text-line-height"]),"text-letter-spacing":new se(J.layout_symbol["text-letter-spacing"]),"text-justify":new se(J.layout_symbol["text-justify"]),"text-radial-offset":new se(J.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dt(J.layout_symbol["text-variable-anchor"]),"text-anchor":new se(J.layout_symbol["text-anchor"]),"text-max-angle":new Dt(J.layout_symbol["text-max-angle"]),"text-writing-mode":new Dt(J.layout_symbol["text-writing-mode"]),"text-rotate":new se(J.layout_symbol["text-rotate"]),"text-padding":new Dt(J.layout_symbol["text-padding"]),"text-keep-upright":new Dt(J.layout_symbol["text-keep-upright"]),"text-transform":new se(J.layout_symbol["text-transform"]),"text-offset":new se(J.layout_symbol["text-offset"]),"text-allow-overlap":new Dt(J.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Dt(J.layout_symbol["text-ignore-placement"]),"text-optional":new Dt(J.layout_symbol["text-optional"]),visibility:new Dt(J.layout_symbol.visibility)});var Ib={paint:new Ci({"icon-opacity":new se(J.paint_symbol["icon-opacity"]),"icon-emissive-strength":new se(J.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new se(J.paint_symbol["text-emissive-strength"]),"icon-color":new se(J.paint_symbol["icon-color"]),"icon-halo-color":new se(J.paint_symbol["icon-halo-color"]),"icon-halo-width":new se(J.paint_symbol["icon-halo-width"]),"icon-halo-blur":new se(J.paint_symbol["icon-halo-blur"]),"icon-translate":new Dt(J.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dt(J.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new se(J.paint_symbol["icon-image-cross-fade"]),"text-opacity":new se(J.paint_symbol["text-opacity"]),"text-color":new se(J.paint_symbol["text-color"],{runtimeType:Na,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new se(J.paint_symbol["text-halo-color"]),"text-halo-width":new se(J.paint_symbol["text-halo-width"]),"text-halo-blur":new se(J.paint_symbol["text-halo-blur"]),"text-translate":new Dt(J.paint_symbol["text-translate"]),"text-translate-anchor":new Dt(J.paint_symbol["text-translate-anchor"])}),layout:_2};class uf{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ua,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xt(uf,"FormatSectionOverride",{omit:["defaultValue"]});class Ly extends Ws{constructor(t,r){super(t,Ib,r)}recalculate(t,r){super.recalculate(t,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const l=[];for(const u of a)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,r,a,l){const u=this.layout.get(t).evaluate(r,{},a,l),d=this._unevaluatedLayout._values[t];return d.isDataDriven()||Cp(d.value)||!u?u:(h=r.properties,u.replace(/{([^{}]+)}/g,(m,_)=>_ in h?String(h[_]):""));var h}createBucket(t){return new Rm(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Ib.paint.overridableProperties){if(!Ly.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),a=new uf(r),l=new v_(a,r.property.specification);let u=null;u="constant"===r.value.kind||"source"===r.value.kind?new Mp("source",l):new gc("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[t]=new ws(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Ly.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const a=t.get("text-field"),l=Ib.paint.properties[r];let u=!1;const d=h=>{for(const p of h)if(l.overrides&&l.overrides.hasOverride(p))return void(u=!0)};if("constant"===a.value.kind&&a.value.value instanceof Ke)d(a.value.value.sections);else if("source"===a.value.kind){const h=m=>{u||(m instanceof n_&&Sr(m.value)===Zg?d(m.value.sections):m instanceof oh?d(m.sections):m.eachChild(h))},p=a.value;p._styleExpression&&h(p._styleExpression.expression)}return u}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),r=0!==this.paint.get("text-opacity").constantOr(1),a=[];return t&&a.push("symbolIcon"),r&&a.push("symbolSDF"),a}getDefaultProgramParams(t,r){return{config:new Rh(this,r),overrideFog:!1}}}const y2=_m.types,v2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ny(n,t,r,a,l,u,d,h,p,m,_,y,x){const b=h?Math.min(Rc,Math.round(h[0])):0,E=h?Math.min(Rc,Math.round(h[1])):0;n.emplaceBack(t,r,Math.round(32*a),Math.round(32*l),u,d,(b<<1)+(p?1:0),E,16*m,16*_,256*y,256*x)}function zy(n,t,r){n.emplaceBack(t,r)}function By(n,t,r,a,l,u,d){n.emplaceBack(t,r,a,l,u,d)}function Vy(n,t,r,a,l){const u=5*t+2;n.float32[u+0]=r,n.float32[u+1]=a,n.float32[u+2]=l}function df(n,t,r,a,l){n.emplaceBack(t,r,a,l),n.emplaceBack(t,r,a,l),n.emplaceBack(t,r,a,l),n.emplaceBack(t,r,a,l)}function WM(n){for(const t of n.sections)if(gA(t.text))return!0;return!1}class jn{constructor(t){this.layoutVertexArray=new K0,this.indexArray=new er,this.programConfigurations=t,this.segments=new Bn,this.dynamicLayoutVertexArray=new Mi,this.opacityVertexArray=new P_,this.placedSymbolArray=new Th,this.iconTransitioningVertexArray=new $a,this.globeExtVertexArray=new R_,this.zOffsetVertexArray=new Lp}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,r,a,l,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bM.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,xm.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,v2,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,wM.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,_b.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,xy.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Xt(jn,"SymbolBuffers");class Ab{constructor(t,r,a){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Bn,this.collisionVertexArray=new Sh,this.collisionVertexArrayExt=new Ga}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,EM.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,o2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xt(Ab,"CollisionBuffers");class Ad{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rt.identity([]),this.placementViewportMatrix=rt.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=MM(this.zoom,r["text-size"]),this.iconSizeData=MM(this.zoom,r["icon-size"]);const a=this.layers[0].layout,l=a.get("symbol-sort-key"),u=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==u&&void 0!==l.constantOr(1),this.sortFeaturesByY=("viewport-y"===u||"auto"===u&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(d=>ti[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate")}createArrays(){this.text=new jn(new pd(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new jn(new pd(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new B_,this.lineVertexArray=new Np,this.symbolInstances=new Dh}calculateGlyphDependencies(t,r,a,l,u){for(let d=0;d<t.length;d++){const h=t.codePointAt(d);if(void 0===h)break;if(r[h]=!0,l&&u&&h<=65535){const p=nf[t.charAt(d)];p&&(r[p.charCodeAt(0)]=!0)}}}populate(t,r,a,l){const u=this.layers[0],d=u.layout,h="globe"===this.projection.name,p=d.get("text-font"),m=d.get("text-field"),_=d.get("icon-image"),y=("constant"!==m.value.kind||m.value.value instanceof Ke&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&("constant"!==p.value.kind||p.value.value.length>0),x="constant"!==_.value.kind||!!_.value.value||Object.keys(_.parameters).length>0,b=d.get("symbol-sort-key");if(this.features=[],!y&&!x)return;const E=r.iconDependencies,C=r.glyphDependencies,S=r.availableImages,M=new Ei(this.zoom);for(const{feature:D,id:R,index:P,sourceLayerIndex:I}of t){const O=u._featureFilter.needGeometry,F=yu(D,O);if(!u._featureFilter.filter(M,F,a))continue;if(O||(F.geometry=jl(D,a,l)),h&&1!==D.type&&a.z<=5){const U=F.geometry,V=.98078528056,G=(j,Z)=>{const et=Jp(j.x,j.y,a,1),it=Jp(Z.x,Z.y,a,1);return q.dot(et,it)<V};for(let j=0;j<U.length;j++)U[j]=tM(U[j],G)}let L,N;if(y){const U=u.getValueAndResolveTokens("text-field",F,a,S),V=Ke.factory(U);WM(V)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===pa()||this.hasRTLText&&bs.isParsed())&&(L=SM(V,u,F))}if(x){const U=u.getValueAndResolveTokens("icon-image",F,a,S);N=U instanceof ys?U:ys.fromString(U)}if(!L&&!N)continue;const z=this.sortFeaturesByKey?b.evaluate(F,{},a):void 0;if(this.features.push({id:R,text:L,icon:N,index:P,sourceLayerIndex:I,geometry:F.geometry,properties:D.properties,type:y2[D.type],sortKey:z}),N&&(E[N.namePrimary]=!0,N.nameSecondary&&(E[N.nameSecondary]=!0)),L){const U=p.evaluate(F,{},a).join(","),V="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ti.vertical)>=0;for(const G of L.sections)if(G.image)E[G.image.namePrimary]=!0;else{const j=$0(L.toString()),Z=G.fontStack||U,et=C[Z]=C[Z]||{};this.calculateGlyphDependencies(G.text,et,V,this.allowVerticalPlacement,j)}}}"line"===d.get("symbol-placement")&&(this.features=function(D){const R={},P={},I=[];let O=0;function F(U){I.push(D[U]),O++}function L(U,V,G){const j=P[U];return delete P[U],P[V]=j,I[j].geometry[0].pop(),I[j].geometry[0]=I[j].geometry[0].concat(G[0]),j}function N(U,V,G){const j=R[V];return delete R[V],R[U]=j,I[j].geometry[0].shift(),I[j].geometry[0]=G[0].concat(I[j].geometry[0]),j}function z(U,V,G){const j=G?V[0][V[0].length-1]:V[0][0];return`${U}:${j.x}:${j.y}`}for(let U=0;U<D.length;U++){const V=D[U],G=V.geometry,j=V.text?V.text.toString():null;if(!j){F(U);continue}const Z=z(j,G),et=z(j,G,!0);if(Z in P&&et in R&&P[Z]!==R[et]){const it=N(Z,et,G),X=L(Z,et,I[it].geometry);delete R[Z],delete P[et],P[z(j,I[X].geometry,!0)]=X,I[it].geometry=null}else Z in P?L(Z,et,G):et in R?N(Z,et,G):(F(U),R[Z]=O-1,P[et]=O-1)}return I.filter(U=>U.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((D,R)=>D.sortKey-R.sortKey)}update(t,r,a,l,u){const d=0!==Object.keys(t).length;if(d&&!this.stateDependentLayers.length)return;const h=d?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,r,h,a,l,u),this.icon.programConfigurations.updatePaintArrays(t,r,h,a,l,u)}updateZOffset(){const t=(u,d,h)=>{a+=d,a>u.length&&u.resize(a);for(let p=-d;p<0;p++)u.emplace(p+a,h)},r=(u,d,h)=>{l+=d,l>u.length&&u.resize(l);for(let p=-d;p<0;p++)u.emplace(p+l,h)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,l=0;for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u),{numHorizontalGlyphVertices:h,numVerticalGlyphVertices:p,numIconVertices:m}=d,_=d.zOffset,y=m>0;if((h>0||p>0)&&(t(this.text.zOffsetVertexArray,h,_),t(this.text.zOffsetVertexArray,p,_)),y){const{placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:b}=d;x>=0&&r(this.icon.zOffsetVertexArray,m,_),b>=0&&r(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Am(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const a=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:l,y:u}of r)this.lineVertexArray.emplaceBack(l,u);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S){const M=t.indexArray,D=t.layoutVertexArray,R=t.globeExtVertexArray,P=t.segments.prepareSegment(4*r.length,D,M,this.canOverlap?d.sortKey:void 0),I=this.glyphOffsetArray.length,O=P.vertexLength,F=this.allowVerticalPlacement&&h===ti.vertical?Math.PI/2:0,L=d.text&&d.text.sections;for(let z=0;z<r.length;z++){const{tl:U,tr:V,bl:G,br:j,texPrimary:Z,texSecondary:et,pixelOffsetTL:it,pixelOffsetBR:X,minFontScaleX:Y,minFontScaleY:ot,glyphOffset:lt,isSDF:ht,sectionIndex:mt}=r[z],vt=P.vertexLength,ct=lt[1];if(Ny(D,m.x,m.y,U.x,ct+U.y,Z.x,Z.y,a,ht,it.x,it.y,Y,ot),Ny(D,m.x,m.y,V.x,ct+V.y,Z.x+Z.w,Z.y,a,ht,X.x,it.y,Y,ot),Ny(D,m.x,m.y,G.x,ct+G.y,Z.x,Z.y+Z.h,a,ht,it.x,X.y,Y,ot),Ny(D,m.x,m.y,j.x,ct+j.y,Z.x+Z.w,Z.y+Z.h,a,ht,X.x,X.y,Y,ot),p){const{x:ft,y:Rt,z:Vt}=p.anchor,[jt,Ht,re]=p.up;By(R,ft,Rt,Vt,jt,Ht,re),By(R,ft,Rt,Vt,jt,Ht,re),By(R,ft,Rt,Vt,jt,Ht,re),By(R,ft,Rt,Vt,jt,Ht,re),df(t.dynamicLayoutVertexArray,ft,Rt,Vt,F)}else df(t.dynamicLayoutVertexArray,m.x,m.y,m.z,F);if(S){const ft=et||Z;zy(t.iconTransitioningVertexArray,ft.x,ft.y),zy(t.iconTransitioningVertexArray,ft.x+ft.w,ft.y),zy(t.iconTransitioningVertexArray,ft.x,ft.y+ft.h),zy(t.iconTransitioningVertexArray,ft.x+ft.w,ft.y+ft.h)}M.emplaceBack(vt,vt+1,vt+2),M.emplaceBack(vt+1,vt+2,vt+3),P.vertexLength+=4,P.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(lt[0]),z!==r.length-1&&mt===r[z+1].sectionIndex||t.programConfigurations.populatePaintArrays(D.length,d,d.index,{},b,E,C,L&&L[mt])}const N=p?p.anchor:m;t.placedSymbolArray.emplaceBack(N.x,N.y,N.z,m.x,m.y,I,this.glyphOffsetArray.length-I,O,_,y,m.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],h,0,!1,0,x,0)}_commitLayoutVertex(t,r,a,l,u,d,h){t.emplaceBack(r,a,l,u,d,Math.round(h.x),Math.round(h.y))}_addCollisionDebugVertices(t,r,a,l,u,d,h){const p=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),m=p.vertexLength,_=h.tileAnchorX,y=h.tileAnchorY;for(let b=0;b<4;b++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(r,t.padding,-t.padding),a.collisionVertexArrayExt.emplaceBack(r,t.padding,t.padding),a.collisionVertexArrayExt.emplaceBack(r,-t.padding,t.padding),this._commitLayoutVertex(a.layoutVertexArray,l,u,d,_,y,new nt(t.x1,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,u,d,_,y,new nt(t.x2,t.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,u,d,_,y,new nt(t.x2,t.y2)),this._commitLayoutVertex(a.layoutVertexArray,l,u,d,_,y,new nt(t.x1,t.y2)),p.vertexLength+=4;const x=a.indexArray;x.emplaceBack(m,m+1),x.emplaceBack(m+1,m+2),x.emplaceBack(m+2,m+3),x.emplaceBack(m+3,m),p.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,a,l,u,d){for(let h=l;h<u;h++){const p=a.get(h),m=this.getSymbolInstanceTextSize(t,d,r,h);this._addCollisionDebugVertices(p,m,this.textCollisionBox,p.projectedAnchorX,p.projectedAnchorY,p.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(t,r,a,l,u,d){for(let h=l;h<u;h++){const p=a.get(h),m=this.getSymbolInstanceIconSize(t,r,d.placedIconSymbolIndex);this._addCollisionDebugVertices(p,m,this.iconCollisionBox,p.projectedAnchorX,p.projectedAnchorY,p.projectedAnchorZ,d)}}generateCollisionDebugBuffers(t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ab(O_,CM.members,$a),this.iconCollisionBox=new Ab(O_,CM.members,$a);const a=Ic(this.iconSizeData,t),l=Ic(this.textSizeData,t);for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,t,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(l,t,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(a,t,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(a,t,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(t,r,a,l){const u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),d=bm(this.textSizeData,t,u)/Lr;return this.tilePixelRatio*d}getSymbolInstanceIconSize(t,r,a){const l=this.icon.placedSymbolArray.get(a),u=bm(this.iconSizeData,t,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(t,r,a){t.emplaceBack(r,-a,-a),t.emplaceBack(r,a,-a),t.emplaceBack(r,a,a),t.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(t,r,a,l,u,d){for(let h=l;h<u;h++){const p=a.get(h),m=this.getSymbolInstanceTextSize(t,d,r,h);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,m,p.padding)}}_updateIconDebugCollisionBoxes(t,r,a,l,u,d){for(let h=l;h<u;h++){const p=a.get(h),m=this.getSymbolInstanceIconSize(t,r,d);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,m,p.padding)}}updateCollisionDebugBuffers(t,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Ic(this.iconSizeData,t),l=Ic(this.textSizeData,t);for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,t,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(l,t,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(a,t,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,t,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,a,l,u,d,h,p,m){const _={};if(r<a){const{x1:y,y1:x,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(r);_.textBox={x1:y,y1:x,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P},_.textFeatureIndex=I}if(l<u){const{x1:y,y1:x,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(l);_.verticalTextBox={x1:y,y1:x,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P},_.verticalTextFeatureIndex=I}if(d<h){const{x1:y,y1:x,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(d);_.iconBox={x1:y,y1:x,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P},_.iconFeatureIndex=I}if(p<m){const{x1:y,y1:x,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P,featureIndex:I}=t.get(p);_.verticalIconBox={x1:y,y1:x,x2:b,y2:E,padding:C,projectedAnchorX:S,projectedAnchorY:M,projectedAnchorZ:D,tileAnchorX:R,tileAnchorY:P},_.verticalIconFeatureIndex=I}return _}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,r){const a=t.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let u=a.vertexStartIndex;u<l;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const r=Math.sin(t),a=Math.cos(t),l=[],u=[],d=[];for(let h=0;h<this.symbolInstances.length;++h){d.push(h);const p=this.symbolInstances.get(h);l.push(0|Math.round(r*p.tileAnchorX+a*p.tileAnchorY)),u.push(p.featureIndex)}return d.sort((h,p)=>l[h]-l[p]||u[p]-u[h]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:h,placedIconSymbolIndex:p,verticalPlacedIconSymbolIndex:m}=a;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&d!==u&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p),m>=0&&this.addIndicesForPlacedSymbol(this.icon,m)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xt(Ad,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ad.MAX_GLYPHS=65535,Ad.addDynamicAttributes=df;var Rm=Ad;const x2=yn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:b2}=x2,w2=yn([{name:"a_packed",components:4,type:"Float32"}]),{members:E2}=w2,C2=_m.types,M2=Math.cos(Math.PI/180*37.5);class Pm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new _c,this.layoutVertexArray2=new Mi,this.indexArray=new er,this.programConfigurations=new pd(t.layers,t.zoom),this.segments=new Bn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a,l){this.hasPattern=ib("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:_,id:y,index:x,sourceLayerIndex:b}of t){const E=this.layers[0]._featureFilter.needGeometry,C=yu(_,E);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),C,a))continue;const S=u?u.evaluate(C,{},a):void 0,M={id:y,properties:_.properties,type:_.type,sourceLayerIndex:b,index:x,geometry:E?C.geometry:jl(_,a,l),patterns:{},sortKey:S};d.push(M)}u&&d.sort((_,y)=>_.sortKey-y.sortKey);const{lineAtlas:h,featureIndex:p}=r,m=this.addConstantDashes(h);for(const _ of d){const{geometry:y,index:x,sourceLayerIndex:b}=_;if(m&&this.addFeatureDashes(_,h),this.hasPattern){const E=fy("line",this.layers,_,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(_,y,x,a,h.positions,r.availableImages,r.brightness);p.insert(t[x].feature,y,x,b,this.index)}}addConstantDashes(t){let r=!1;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,u=a.layout.get("line-cap").value;if("constant"!==l.kind||"constant"!==u.kind)r=!0;else{const d=u.value,h=l.value;if(!h)continue;t.addDash(h,d)}}return r}addFeatureDashes(t,r){const a=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,d=l.layout.get("line-cap").value;if("constant"===u.kind&&"constant"===d.kind)continue;let h,p;if("constant"===u.kind){if(h=u.value,!h)continue}else h=u.evaluate({zoom:a},t);p="constant"===d.kind?d.value:d.evaluate({zoom:a},t),r.addDash(h,p),t.patterns[l.id]=r.getKey(h,p)}}update(t,r,a,l,u){const d=0!==Object.keys(t).length;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,d?this.stateDependentLayers:this.layers,a,l,u)}addFeatures(t,r,a,l,u,d){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,a,l,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,E2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,b2),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,a,l,u,d,h){const p=this.layers[0].layout,m=p.get("line-join").evaluate(t,{}),_=p.get("line-cap").evaluate(t,{}),y=p.get("line-miter-limit"),x=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const b of r)this.addLine(b,t,m,_,y,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,d,l,h)}addLine(t,r,a,l,u,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let M=0;M<t.length-1;M++)this.totalDistance+=t[M].dist(t[M+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const h="Polygon"===C2[r.type];let p=t.length;for(;p>=2&&t[p-1].equals(t[p-2]);)p--;let m=0;for(;m<p-1&&t[m].equals(t[m+1]);)m++;if(p<(h?3:2))return;"bevel"===a&&(u=1.05);const _=this.overscaling<=16?15*dt/(512*this.overscaling):0,y=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);let x,b,E,C,S;this.e1=this.e2=-1,h&&(x=t[p-2],S=t[m].sub(x)._unit()._perp());for(let M=m;M<p;M++){if(E=M===p-1?h?t[m+1]:void 0:t[M+1],E&&t[M].equals(E))continue;S&&(C=S),x&&(b=x),x=t[M],S=E?E.sub(x)._unit()._perp():C,C=C||S;let D=C.add(S);0===D.x&&0===D.y||D._unit();const R=C.x*S.x+C.y*S.y,P=D.x*S.x+D.y*S.y,I=0!==P?1/P:1/0,O=2*Math.sqrt(2-2*P),F=P<M2&&b&&E,L=C.x*S.y-C.y*S.x>0;if(F&&M>m){const U=x.dist(b);if(U>2*_){const V=x.sub(x.sub(b)._mult(_/U)._round());this.updateDistance(b,V),this.addCurrentVertex(V,C,0,0,y),b=V}}const N=b&&E;let z=N?a:h?"butt":l;if(N&&"round"===z&&(I<d?z="miter":I<=2&&(z="fakeround")),"miter"===z&&I>u&&(z="bevel"),"bevel"===z&&(I>2&&(z="flipbevel"),I<u&&(z="miter")),b&&this.updateDistance(b,x),"miter"===z)D._mult(I),this.addCurrentVertex(x,D,0,0,y);else if("flipbevel"===z){if(I>100)D=S.mult(-1);else{const U=I*C.add(S).mag()/C.sub(S).mag();D._perp()._mult(U*(L?-1:1))}this.addCurrentVertex(x,D,0,0,y),this.addCurrentVertex(x,D.mult(-1),0,0,y)}else if("bevel"===z||"fakeround"===z){const U=-Math.sqrt(I*I-1),V=L?U:0,G=L?0:U;if(b&&this.addCurrentVertex(x,C,V,G,y),"fakeround"===z){const j=Math.round(180*O/Math.PI/20);for(let Z=1;Z<j;Z++){let et=Z/j;if(.5!==et){const X=et-.5;et+=et*X*(et-1)*((1.0904+R*(R*(3.55645-1.43519*R)-3.2452))*X*X+(.848013+R*(.215638*R-1.06021)))}const it=S.sub(C)._mult(et)._add(C)._unit()._mult(L?-1:1);this.addHalfVertex(x,it.x,it.y,!1,L,0,y)}}E&&this.addCurrentVertex(x,S,-V,-G,y)}else if("butt"===z)this.addCurrentVertex(x,D,0,0,y);else if("square"===z){const U=b?1:-1;b||this.addCurrentVertex(x,D,U,U,y),this.addCurrentVertex(x,D,0,0,y),b&&this.addCurrentVertex(x,D,U,U,y)}else"round"===z&&(b&&(this.addCurrentVertex(x,C,0,0,y),this.addCurrentVertex(x,C,1,1,y,!0)),E&&(this.addCurrentVertex(x,S,-1,-1,y,!0),this.addCurrentVertex(x,S,0,0,y)));if(F&&M<p-1){const U=x.dist(E);if(U>2*_){const V=x.add(E.sub(x)._mult(_/U)._round());this.updateDistance(x,V),this.addCurrentVertex(V,S,0,0,y),x=V}}}}addCurrentVertex(t,r,a,l,u,d=!1){const h=r.y*l-r.x,p=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*a,r.y-r.x*a,d,!1,a,u),this.addHalfVertex(t,h,p,d,!0,-l,u)}addHalfVertex({x:t,y:r},a,l,u,d,h,p){this.layoutVertexArray.emplaceBack((t<<1)+(u?1:0),(r<<1)+(d?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(0===h?0:h<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const m=p.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,m),p.primitiveLength++),d?this.e2=m:this.e1=m}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}Xt(Pm,"LineBucket",{omit:["layers","patternFeatures"]});class ir{constructor(t,r,a,l){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(r,l)}update(t,r,a){const{width:l,height:u}=t,{context:d}=this,{gl:h}=d,{HTMLImageElement:p,HTMLCanvasElement:m,HTMLVideoElement:_,ImageData:y,ImageBitmap:x}=st;if(h.bindTexture(h.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA&&(!r||!1!==r.premultiply)),a||this.size&&this.size[0]===l&&this.size[1]===u){const{x:b,y:E}=a||{x:0,y:0};if(t instanceof p||t instanceof m||t instanceof _||t instanceof y||x&&t instanceof x)h.texSubImage2D(h.TEXTURE_2D,0,b,E,h.RGBA,h.UNSIGNED_BYTE,t);else{let C=this.format,S=h.UNSIGNED_BYTE;this.format===h.R32F&&(C=h.RED,S=h.FLOAT),h.texSubImage2D(h.TEXTURE_2D,0,b,E,l,u,C,S,t.data)}}else if(this.size=[l,u],t instanceof p||t instanceof m||t instanceof _||t instanceof y||x&&t instanceof x){let b=this.format;this.format===h.R8&&(b=h.RED),h.texImage2D(h.TEXTURE_2D,0,this.format,b,h.UNSIGNED_BYTE,t)}else{let b=this.format,E=this.format,C=h.UNSIGNED_BYTE;this.format===h.DEPTH_COMPONENT&&(b=h.DEPTH_COMPONENT16,C=h.UNSIGNED_SHORT),this.format===h.R32F&&(C=h.FLOAT,E=h.RED),h.texImage2D(h.TEXTURE_2D,0,b,l,u,0,E,C,t.data)}this.useMipmap=!(!r||!r.useMipmap),this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(t,r){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),t!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?t===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),r!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(t,r,a,l){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),this.magFilter=r),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?t===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),this.wrapS=a),l!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class jy{constructor(t,r){this.context=t,this.texture=r}bind(t,r){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),t!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,t),this.minFilter=t),r!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrapS=r)}}const Oc=new Uint16Array(8184);for(let n=0;n<2046;n++){let t=n+2,r=0,a=0,l=0,u=0,d=0,h=0;for(1&t?l=u=d=32:r=a=h=32;(t>>=1)>1;){const m=r+l>>1,_=a+u>>1;1&t?(l=r,u=a,r=d,a=h):(r=l,a=u,l=d,u=h),d=m,h=_}const p=4*n;Oc[p+0]=r,Oc[p+1]=a,Oc[p+2]=l,Oc[p+3]=u}const kc=new Uint16Array(2178),el=new Uint8Array(1089),Uy=new Uint16Array(1089);function ZM(n){return 0===n?-.03125:32===n?.03125:0}var Om=yn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const XM={type:2,extent:dt,loadGeometry:()=>[[new nt(0,0),new nt(dt+1,0),new nt(dt+1,dt+1),new nt(0,dt+1),new nt(0,0)]]};class As{constructor(t,r,a,l,u){this.tileID=t,this.uid=Di(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,l&&l.style&&(this._lastUpdatedBrightness=l.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<kt.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Tu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,a){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(l,u){const d={};if(!u)return d;for(const h of l){const p=h.layerIds.map(m=>u.getLayer(m)).filter(Boolean);if(0!==p.length){h.layers=p,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(m=>p.filter(_=>_.id===m)[0]));for(const m of p)d[m.fqid]=h}}return d}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Rm){if(this.hasSymbolBuckets=!0,!a)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Rm&&u.hasRTLText){this.hasRTLText=!0,bs.isLoading()||bs.isLoaded()||"deferred"!==pa()||M_();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l],d=r.style.getOwnLayer(l);if(!d)continue;const h=d.queryRadius(u);this.queryPadding=Math.max(this.queryPadding,h)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new tC}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ir(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ir(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ir(t,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,r,a){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,a),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const l=r.style.getBrightness();(this._lastUpdatedBrightness||l)&&(this._lastUpdatedBrightness&&l&&Math.abs(this._lastUpdatedBrightness-l)<.001||(this._lastUpdatedBrightness=l,this.updateBuckets(void 0,r)))}queryRenderedFeatures(t,r,a,l,u,d,h,p){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:h,transform:d,params:u,tileTransform:this.tileTransform},t,r,a):{}}querySourceFeatures(t,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),u=r?r.sourceLayer:"",d=l._geojsonTileLayer||l[u];if(!d)return;const h=k0(r&&r.filter),{z:p,x:m,y:_}=this.tileID.canonical,y={z:p,x:m,y:_};for(let x=0;x<d.length;x++){const b=d.feature(x);if(h.needGeometry){const S=yu(b,!0);if(!h.filter(new Ei(this.tileID.overscaledZ),S,this.tileID.canonical))continue}else if(!h.filter(new Ei(this.tileID.overscaledZ),b))continue;const E=a.getId(b,u),C=new _y(b,p,m,_,E);C.tile=y,t.push(C)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const a=ae(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const u=this.expirationTime-r;u?this.expirationTime=a+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&r&&this.updateBuckets(t,r)}updateBuckets(t,r){if(!this.latestFeatureIndex)return;const a=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages(),u=r.style.getBrightness();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const h=this.buckets[d],p=h.layers[0].sourceLayer||"_geojsonTileLayer",m=a[p];let _={};if(t&&(_=t[p],!m||!_||0===Object.keys(_).length))continue;if(h.update(_,m,l,this.imageAtlas&&this.imageAtlas.patternPositions||{},u),h instanceof Pm||h instanceof Jh){const x=r.style.getOwnSourceCache(h.layers[0].source);r._terrain&&r._terrain.enabled&&x&&h.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(x.id,this.tileID)}const y=r&&r.style&&r.style.getOwnLayer(d);y&&(this.queryPadding=Math.max(this.queryPadding,y.queryRadius(h)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<kt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=kt.now()+t}setTexture(t,r){const a=r.context,l=a.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new ir(a,t,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(t,r){const a={};for(const l of r)a[l]=!0;this.dependencies[t]=a}hasDependency(t,r){for(const a of t){const l=this.dependencies[a];if(l)for(const u of r)if(l[u])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const a=jl(XM,this.tileID.canonical,this.tileTransform)[0],l=new Zo,u=new L_;for(let d=0;d<a.length;d++){const{x:h,y:p}=a[d];l.emplaceBack(h,p),u.emplaceBack(d)}u.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(u),this._tileDebugBuffer=t.createVertexBuffer(l,xc.members),this._tileDebugSegments=Bn.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const a=jl(XM,this.tileID.canonical,this.tileTransform)[0];let l,u;if(this.isRaster){const d=function(h,p){const m=Tu(h,p),_=Math.pow(2,h.z);for(let S=0;S<33;S++)for(let M=0;M<33;M++){const D=Ts((h.x+(M+ZM(M))/32)/_),R=lr((h.y+(S+ZM(S))/32)/_),P=p.project(D,R),I=33*S+M;kc[2*I+0]=Math.round((P.x*m.scale-m.x)*dt),kc[2*I+1]=Math.round((P.y*m.scale-m.y)*dt)}el.fill(0),Uy.fill(0);for(let S=2045;S>=0;S--){const M=4*S,D=Oc[M+0],R=Oc[M+1],P=Oc[M+2],I=Oc[M+3],O=D+P>>1,F=R+I>>1,L=O+F-R,N=F+D-O,z=33*R+D,U=33*I+P,V=33*F+O,G=Math.hypot((kc[2*z+0]+kc[2*U+0])/2-kc[2*V+0],(kc[2*z+1]+kc[2*U+1])/2-kc[2*V+1])>=16;el[V]=el[V]||(G?1:0),S<1022&&(el[V]=el[V]||el[33*(R+N>>1)+(D+L>>1)]||el[33*(I+N>>1)+(P+L>>1)])}const y=new cd,x=new er;let b=0;function E(S,M){const D=33*M+S;return 0===Uy[D]&&(y.emplaceBack(kc[2*D+0],kc[2*D+1],S*dt/32,M*dt/32),Uy[D]=++b),Uy[D]-1}function C(S,M,D,R,P,I){const O=S+D>>1,F=M+R>>1;if(Math.abs(S-P)+Math.abs(M-I)>1&&el[33*F+O])C(P,I,S,M,O,F),C(D,R,P,I,O,F);else{const L=E(S,M),N=E(D,R),z=E(P,I);x.emplaceBack(L,N,z)}}return C(0,0,32,32,32,0),C(32,32,0,0,0,32),{vertices:y,indices:x}}(this.tileID.canonical,r);l=d.vertices,u=d.indices}else{l=new cd,u=new er;for(const{x:h,y:p}of a)l.emplaceBack(h,p,0,0);const d=hy(l.int16,void 0,4);for(let h=0;h<d.length;h+=3)u.emplaceBack(d[h],d[h+1],d[h+2])}this._tileBoundsBuffer=t.createVertexBuffer(l,Om.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(u),this._tileBoundsSegments=Bn.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(t,r){const a=r.projection;if(!a||"globe"!==a.name||r.freezeTileCoverage)return;const l=this.tileID.canonical,u=eo(ty(l,r)),d=Vr(r.zoom);let h;d>0&&(h=rt.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,l,r,u,h,d),this._makeGlobeTileDebugTextBuffer(t,l,r,u,h,d)}_globePoint(t,r,a,l,u,d,h){let p=Jp(t,r,a);if(d){const m=1<<a.z,_=no(l.center.lng),y=mo(l.center.lat),x=(a.x+.5)/m-_;let b=0;x>.5?b=-1:x<-.5&&(b=1);let E=(t/dt+a.x)/m+b,C=(r/dt+a.y)/m;E=(E-_)*l._pixelsPerMercatorPixel+_,C=(C-y)*l._pixelsPerMercatorPixel+y;const S=[E*l.worldSize,C*l.worldSize,0];q.transformMat4(S,S,d),p=xa(p,S,h)}return q.transformMat4(p,p,u)}_makeGlobeTileDebugBorderBuffer(t,r,a,l,u,d){const h=new Zo,p=new L_,m=new I_,_=(x,b,E,C,S)=>{const M=(E-x)/(S-1),D=(C-b)/(S-1),R=h.length;for(let P=0;P<S;P++){const I=x+P*M,O=b+P*D;h.emplaceBack(I,O);const F=this._globePoint(I,O,r,a,l,u,d);m.emplaceBack(F[0],F[1],F[2]),p.emplaceBack(R+P)}},y=dt;_(0,0,y,0,16),_(y,0,y,y,16),_(y,y,0,y,16),_(0,y,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(h,xc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(m,zC.members),this._tileDebugSegments=Bn.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugTextBuffer(t,r,a,l,u,d){const h=dt/4,p=new Zo,m=new er,_=new I_,y=25;m.reserve(32),p.reserve(y),_.reserve(y);const x=(b,E)=>y*b+E;for(let b=0;b<y;b++){const E=b*h;for(let C=0;C<y;C++){const S=C*h;p.emplaceBack(S,E);const M=this._globePoint(S,E,r,a,l,u,d);_.emplaceBack(M[0],M[1],M[2])}}for(let b=0;b<4;b++)for(let E=0;E<4;E++){const C=x(b,E),S=x(b,E+1),M=x(b+1,E),D=x(b+1,E+1);m.emplaceBack(C,S,M),m.emplaceBack(M,S,D)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(m),this._tileDebugTextBuffer=t.createVertexBuffer(p,xc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(_,zC.members),this._tileDebugTextSegments=Bn.simpleSegment(0,0,y,32)}}class km{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,a){const l=t.wrapped().key;void 0===this.data[l]&&(this.data[l]=[]);const u={value:r,timeout:void 0};if(void 0!==a&&(u.timeout=setTimeout(()=>{this.remove(t,u)},a)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const a=t.wrapped().key,l=void 0===r?0:this.data[a].indexOf(r),u=this.data[a][l];return this.data[a].splice(l,1),u.timeout&&clearTimeout(u.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(u.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const a in this.data)for(const l of this.data[a])t(l.value)||r.push(l);for(const a of r)this.remove(a.value.tileID,a)}}let Fo=(()=>{class n{constructor(r,a,l,u){this.id=n.uniqueIdxCounter,n.uniqueIdxCounter++,this.context=r;const d=r.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||u||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=n.uniqueIdxCounter,n.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return n.uniqueIdxCounter=0,n})();const Rd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hy{constructor(t,r,a,l,u,d){this.length=r.length,this.attributes=a,this.itemSize=r.bytesPerElement,this.dynamicDraw=l,this.instanceCount=d,this.context=t;const h=t.gl;this.buffer=h.createBuffer(),t.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||u||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let a=0;a<this.attributes.length;a++){const l=r.attributes[this.attributes[a].name];void 0!==l&&t.enableVertexAttribArray(l)}}setVertexAttribPointers(t,r,a){for(let l=0;l<this.attributes.length;l++){const u=this.attributes[l],d=r.attributes[u.name];void 0!==d&&t.vertexAttribPointer(d,u.components,t[Rd[u.type]],!1,this.itemSize,u.offset+this.itemSize*(a||0))}}setVertexAttribDivisor(t,r,a){for(let l=0;l<this.attributes.length;l++){const u=r.attributes[this.attributes[l].name];void 0!==u&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(u,a)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ro extends vn{getDefault(){return Ne.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class hf extends vn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ff extends vn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class pf extends vn{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class mf extends vn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class gf extends vn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class _f extends vn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class yf extends vn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class vf extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class xf extends vn{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class YM extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class KM extends vn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class JM extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class QM extends vn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tS extends vn{getDefault(){return Ne.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class eS extends vn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class nS extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class iS extends vn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class rS extends vn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Rb=class extends vn{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}};class S2 extends vn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class VF extends vn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class jF extends vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class T2 extends vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class D2 extends vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class UF extends vn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class I2 extends vn{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class HF extends vn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class A2 extends vn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class R2 extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class P2 extends vn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Fm extends vn{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Lm extends Fm{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class $y extends Fm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Gy extends Fm{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class oS extends $y{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Nm{constructor(t,r,a,l,u){this.context=t,this.width=r,this.height=a;const d=this.framebuffer=t.gl.createFramebuffer();l&&(this.colorAttachment=new Lm(t,d)),u&&(this.depthAttachmentType=u,this.depthAttachment="renderbuffer"===u?new $y(t,d):new Gy(t,d))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class ve{constructor(t,r,a){this.func=t,this.mask=r,this.range=a}}ve.ReadOnly=!1,ve.ReadWrite=!0,ve.disabled=new ve(519,ve.ReadOnly,[0,1]);class Fe{constructor(t,r,a,l,u,d){this.test=t,this.ref=r,this.mask=a,this.fail=l,this.depthFail=u,this.pass=d}}Fe.disabled=new Fe({func:519,mask:0},0,0,7680,7680,7680);class an{constructor(t,r,a,l){this.blendFunction=t,this.blendColor=r,this.mask=a,this.blendEquation=l}}an.Replace=[1,0,1,0],an.disabled=new an(an.Replace,Ne.transparent,[!1,!1,!1,!1]),an.unblended=new an(an.Replace,Ne.transparent,[!0,!0,!0,!0]),an.alphaBlended=new an([1,771,1,771],Ne.transparent,[!0,!0,!0,!0]),an.multiply=new an([774,0,774,0],Ne.transparent,[!0,!0,!0,!0]);class Ge{constructor(t,r,a){this.enable=t,this.mode=r,this.frontFace=a}}Ge.disabled=new Ge(!1,1029,2305),Ge.backCCW=new Ge(!0,1029,2305),Ge.backCW=new Ge(!0,1029,2304),Ge.frontCW=new Ge(!0,1028,2304),Ge.frontCCW=new Ge(!0,1028,2305);class Wy{constructor(t){this.gl=t,this.clearColor=new ro(this),this.clearDepth=new hf(this),this.clearStencil=new ff(this),this.colorMask=new pf(this),this.depthMask=new mf(this),this.stencilMask=new gf(this),this.stencilFunc=new _f(this),this.stencilOp=new yf(this),this.stencilTest=new vf(this),this.depthRange=new xf(this),this.depthTest=new YM(this),this.depthFunc=new KM(this),this.blend=new JM(this),this.blendFunc=new QM(this),this.blendColor=new tS(this),this.blendEquation=new eS(this),this.cullFace=new nS(this),this.cullFaceSide=new iS(this),this.frontFace=new rS(this),this.program=new Rb(this),this.activeTexture=new S2(this),this.viewport=new VF(this),this.bindFramebuffer=new jF(this),this.bindRenderbuffer=new T2(this),this.bindTexture=new D2(this),this.bindVertexBuffer=new UF(this),this.bindElementBuffer=new I2(this),this.bindVertexArrayOES=new HF(this),this.pixelStoreUnpack=new A2(this),this.pixelStoreUnpackPremultiplyAlpha=new R2(this),this.pixelStoreUnpackFlipY=new P2(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,a){return new Fo(this,t,r,a)}createVertexBuffer(t,r,a,l,u){return new Hy(this,t,r,a,l,u)}createRenderbuffer(t,r,a){const l=this.gl,u=l.createRenderbuffer();return this.bindRenderbuffer.set(u),l.renderbufferStorage(l.RENDERBUFFER,t,r,a),this.bindRenderbuffer.set(null),u}createFramebuffer(t,r,a,l){return new Nm(this,t,r,a,l)}clear({color:t,depth:r,stencil:a,colorMask:l}){const u=this.gl;let d=0;t&&(d|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(l||[!0,!0,!0,!0])),void 0!==r&&(d|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),void 0!==a&&(d|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),u.clear(d)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){cn(t.blendFunction,an.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Rs extends $i{constructor(t,r,a){super(),this.id=t,this._onlySymbols=a,r.on("data",l=>{"source"===l.dataType&&"metadata"===l.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===l.dataType&&"content"===l.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new km(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new r2,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if("errored"!==r.state&&("loaded"!==r.state||!r.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(t),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return on(this._tiles).map(t=>t.tileID).sort(O2).map(t=>t.key)}getRenderableIds(t,r){const a=[];for(const l in this._tiles)this._isIdRenderable(+l,t,r)&&a.push(this._tiles[l]);return t?a.sort((l,u)=>{const d=l.tileID,h=u.tileID,p=new nt(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),m=new nt(h.canonical.x,h.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-h.overscaledZ||m.y-p.y||m.x-p.x}).map(l=>l.tileID.key):a.map(l=>l.tileID).sort(O2).map(l=>l.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(a||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const a=this._tiles[t];a&&("loading"!==a.state&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,t,r)))}_tileLoaded(t,r,a,l){if(l)if(t.state="errored",404!==l.status)this._source.fire(new at(l,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=kt.now(),"expired"===a&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new St("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const u=r[l];if(t.neighboringTiles&&t.neighboringTiles[u]){const d=this.getTileByID(u);a(t,d),a(d,t)}}function a(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let d=u.tileID.canonical.x-l.tileID.canonical.x;const h=u.tileID.canonical.y-l.tileID.canonical.y,p=Math.pow(2,l.tileID.canonical.z),m=u.tileID.key;0===d&&0===h||Math.abs(h)>1||(Math.abs(d)>1&&(1===Math.abs(d+p)?d+=p:1===Math.abs(d-p)&&(d-=p)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,d,h),l.neighboringTiles&&l.neighboringTiles[m]&&(l.neighboringTiles[m].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,a,l){for(const u in this._tiles){let d=this._tiles[u];if(l[u]||!d.hasData()||d.tileID.overscaledZ<=r||d.tileID.overscaledZ>a)continue;let h=d.tileID;for(;d&&d.tileID.overscaledZ>r+1;){const m=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[m.key],d&&d.hasData()&&(h=m)}let p=h;for(;p.overscaledZ>r;)if(p=p.scaledTo(p.overscaledZ-1),t[p.key]){l[h.key]=h;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=t.overscaledZ-1;a>=r;a--){const l=t.scaledTo(a),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const a=Math.ceil(t.width/r)+1,l=Math.ceil(t.height/r)+1,u=Math.floor(a*l*5),d="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,u):u,h="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(h)}handleWrapJump(t){const r=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,r){const a={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+r),a[u.tileID.key]=u}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(t,r,a,l){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;if(this.updateCacheSize(t,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new tn(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(u=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(p=>this._source.hasTile(p)))):u=[],u.length>0&&this.castsShadows&&l&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Fb(this._source.type)){const p=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),m=Math.min(p,this._source.maxzoom),_=t.extendTileCoverForShadows(u,l,m);for(const y of _)this._shadowCasterTiles[y.key]=!0,u.push(y)}const d=this._updateRetainedTiles(u);if(Fb(this._source.type)&&0!==u.length){const p={},m={},_=Object.keys(d);for(const x of _){const b=d[x],E=this._tiles[x];if(!E||E.fadeEndTime&&E.fadeEndTime<=kt.now())continue;const C=this.findLoadedParent(b,Math.max(b.overscaledZ-Rs.maxOverzooming,this._source.minzoom));C&&(this._addTile(C.tileID),p[C.tileID.key]=C.tileID),m[x]=b}const y=u[u.length-1].overscaledZ;for(const x in this._tiles){const b=this._tiles[x];if(d[x]||!b.hasData())continue;let E=b.tileID;for(;E.overscaledZ>y;){E=E.scaledTo(E.overscaledZ-1);const C=this._tiles[E.key];if(C&&C.hasData()&&m[E.key]){d[x]=b.tileID;break}}}for(const x in p)d[x]||(this._coveredTiles[x]=!0,d[x]=p[x])}for(const p in d)this._tiles[p].clearFadeHold();const h=function(p,m){const _=[];for(const y in p)y in m||_.push(y);return _}(this._tiles,d);for(const p of h){const m=this._tiles[p];m.hasSymbolBuckets&&!m.holdingForFade()?m.setHoldDuration(this.map._fadeDuration):m.hasSymbolBuckets&&!m.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(0===t.length)return r;const a={},l=t.reduce((m,_)=>Math.min(m,_.overscaledZ),1/0),u=t[0].overscaledZ,d=Math.max(u-Rs.maxOverzooming,this._source.minzoom),h=Math.max(u+Rs.maxUnderzooming,this._source.minzoom),p={};for(const m of t){const _=this._addTile(m);r[m.key]=m,_.hasData()||l<this._source.maxzoom&&(p[m.key]=m)}this._retainLoadedChildren(p,l,h,r);for(const m of t){let _=this._tiles[m.key];if(_.hasData())continue;if(m.canonical.z>=this._source.maxzoom){const x=m.children(this._source.maxzoom)[0],b=this.getTile(x);if(b&&b.hasData()){r[x.key]=x;continue}}else{const x=m.children(this._source.maxzoom);if(r[x[0].key]&&r[x[1].key]&&r[x[2].key]&&r[x[3].key])continue}let y=_.wasRequested();for(let x=m.overscaledZ-1;x>=d;--x){const b=m.scaledTo(x);if(a[b.key]||(a[b.key]=!0,_=this.getTile(b),!_&&y&&(_=this._addTile(b)),_&&(r[b.key]=b,y=_.wasRequested(),_.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let a,l=this._tiles[t].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}r.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(u),a)break;l=u}for(const u of r)this._loadedParentTiles[u]=a}}_addTile(t){let r=this._tiles[t.key];if(r)return!0!==r.isExtraShadowCaster||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const a=!!r;if(!a){const l=this.map?this.map.painter:null;r=new As(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,a||this._source.fire(new St("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=r.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&"reloading"!==r.state?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,a){const l=[],u=this.transform;if(!u)return l;const d="globe"===u.projection.name,h=no(u.center.lng);for(const p in this._tiles){const m=this._tiles[p];if(a&&m.clearQueryDebugViz(),m.holdingForFade())continue;let _;if(d){const y=m.tileID.canonical;if(0===y.z){const x=[Math.abs(Jt(h,...zm(y,-1))-h),Math.abs(Jt(h,...zm(y,1))-h)];_=[0,2*x.indexOf(Math.min(...x))-1]}else{const x=[Math.abs(Jt(h,...zm(y,-1))-h),Math.abs(Jt(h,...zm(y,0))-h),Math.abs(Jt(h,...zm(y,1))-h)];_=[x.indexOf(Math.min(...x))-1]}}else _=[0];for(const y of _){const x=t.containsTile(m,u,r,y);x&&l.push(x)}}return l}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const a=this.getRenderableIds(t,r).map(l=>this._tiles[l].tileID);for(const l of a)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return a}sortCoordinatesByDistance(t){const r=t.slice(),a=this.transform._camera.position,l=this.transform._camera.forward(),u={};for(const d of r){const h=1/(1<<d.canonical.z);u[d.key]=((d.canonical.x+.5)*h+d.wrap-a[0])*l[0]+((d.canonical.y+.5)*h-a[1])*l[1]-a[2]*l[2]}return r.sort((d,h)=>u[d.key]-u[h.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(Fb(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=kt.now())return!0}return!1}setFeatureState(t,r,a){this._state.updateState(t=t||"_geojsonTileLayer",r,a)}removeFeatureState(t,r,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,a)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,a){const l=this._tiles[t];l&&l.setDependencies(r,a)}reloadTilesForDependencies(t,r){for(const a in this._tiles)this._tiles[a].hasDependency(t,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const h=()=>{this._sourceLoaded&&(this._source.off("data",h),this._preloadTiles(t,r))};return void this._source.on("data",h)}const a=new Map,l=Array.isArray(t)?t:[t],u=this.map.painter.terrain,d=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const h of l){const p=h.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const m of p)a.set(m.key,m);this.usedForTerrain&&h.updateElevation(!1)}Yu(Array.from(a.values()),(h,p)=>{const m=new As(h,this._source.tileSize*h.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(m,_=>{"raster-dem"===this._source.type&&m.dem&&this._backfillDEM(m),p(_,m)})},r)}}function O2(n,t){const r=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return n.overscaledZ-t.overscaledZ||a-r||t.canonical.y-n.canonical.y||t.canonical.x-n.canonical.x}function Fb(n){return"raster"===n||"image"===n||"video"===n||"custom"===n}function zm(n,t){const r=1<<n.z;return[n.x/r+t,(n.x+1)/r+t]}Rs.maxOverzooming=10,Rs.maxUnderzooming=3;const Lb=yn([{name:"a_pos_3f",components:3,type:"Float32"}]),k2=yn([{name:"a_color_3f",components:3,type:"Float32"}]),sS=yn([{name:"a_color_4f",components:4,type:"Float32"}]),F2=yn([{name:"a_uv_2f",components:2,type:"Float32"}]),L2=yn([{name:"a_normal_3f",components:3,type:"Float32"}]),Ji=yn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),aS=yn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Zy{constructor(t=0,r=0,a=0,l=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=a,this.right=l}interpolate(t,r,a){return null!=r.top&&null!=t.top&&(this.top=_e(t.top,r.top,a)),null!=r.bottom&&null!=t.bottom&&(this.bottom=_e(t.bottom,r.bottom,a)),null!=r.left&&null!=t.left&&(this.left=_e(t.left,r.left,a)),null!=r.right&&null!=t.right&&(this.right=_e(t.right,r.right,a)),this}getCenter(t,r){const a=Jt((this.left+t-this.right)/2,0,t),l=Jt((this.top+r-this.bottom)/2,0,r);return new nt(a,l)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Zy(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function lS(n,t){const r=zi(n,3);rt.fromQuat(n,t),Br(n,3,r)}function Nb(n,t){const r=to.identity([]);return to.rotateZ(r,r,-t),to.rotateX(r,r,-n),r}function cS(n,t){const r=[n[0],n[1],0],a=[t[0],t[1],0];if(q.length(r)>=1e-15){const d=q.normalize([],r);q.scale(a,d,q.dot(a,d)),t[0]=a[0],t[1]=a[1]}const l=q.cross([],t,n);if(q.len(l)<1e-15)return null;const u=Math.atan2(-l[1],l[0]);return Nb(Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2]),u)}class Bm{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof Je?t:new Je(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=wl(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const a=this.position,l=this._elevation?this._elevation.getAtPointOrZero(Je.fromLngLat(t)):0,u=Je.fromLngLat(t,l),d=[u.x-a.x,u.y-a.y,u.z-a.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=cS(d,r)}setPitchBearing(t,r){this.orientation=Nb(Ie(t),Ie(-r))}}class Cn{constructor(t,r){this._transform=rt.identity([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new Je(t[0],t[1],t[2])}get position(){const t=zi(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&Br(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||to.identity([]),t&&lS(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Nb(t,r),lS(this._transform,this._orientation)}forward(){const t=zi(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=zi(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=zi(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const a=new Float64Array(16);return rt.invert(a,this.getWorldToCamera(t,r)),a}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,a){const l=this.position;q.scale(l,l,-t);const u=new Float64Array(16);return rt.fromScaling(u,[a,a,a]),rt.translate(u,u,l),u[10]*=r,u}getWorldToCamera(t,r){const a=new Float64Array(16),l=new Float64Array(4),u=this.position;return to.conjugate(l,this._orientation),q.scale(u,u,-t),rt.fromQuat(a,l),rt.translate(a,a,u),a[1]*=-1,a[5]*=-1,a[9]*=-1,a[13]*=-1,a[8]*=r,a[9]*=r,a[10]*=r,a[11]*=r,a}getCameraToClipPerspective(t,r,a,l){const u=new Float64Array(16);return rt.perspective(u,t,r,a,l),u}getCameraToClipOrthographic(t,r,a,l,u,d){const h=new Float64Array(16);return rt.ortho(h,t,r,a,l,u,d),h}getDistanceToElevation(t,r=!1){const a=0===t?0:Nn(t,r?lr(this.position[1]):this.position[1]),l=this.forward();return(a-this.position[2])/l[2]}clone(){return new Cn([...this.position],[...this.orientation])}}function Xy(n,t){const r=un(n.projection,n.zoom,n.width,n.height),a=function(u,d,h,p,m){const _=new we(h.lng-180*mn,h.lat),y=new we(h.lng+180*mn,h.lat),x=u.project(_.lng,_.lat),b=u.project(y.lng,y.lat),E=-Math.atan2(b.y-x.y,b.x-x.x),C=Je.fromLngLat(h);C.y=Jt(C.y,-1+mn,1-mn);const S=C.toLngLat(),M=u.project(S.lng,S.lat),D=Je.fromLngLat(S);D.x+=mn;const R=D.toLngLat(),P=u.project(R.lng,R.lat),I=zb(P.x-M.x,P.y-M.y,E),O=Je.fromLngLat(S);O.y+=mn;const F=O.toLngLat(),L=u.project(F.lng,F.lat),N=zb(L.x-M.x,L.y-M.y,E),z=Math.abs(I.x)/Math.abs(N.y),U=rt.identity([]);rt.rotateZ(U,U,-E*(1-(m?0:p)));const V=rt.identity([]);return rt.scale(V,V,[1,1-(1-z)*p,1]),V[4]=-N.x/N.y*p,rt.rotateZ(V,V,E),rt.multiply(V,U,V),V}(n.projection,0,n.center,r,t),l=uS(n);return rt.scale(a,a,[l,l,1]),a}function uS(n){const t=n.projection,r=un(n.projection,n.zoom,n.width,n.height),a=oo(t,n.center),l=oo(t,we.convert(t.center));return Math.pow(2,a*r+(1-r)*l)}function un(n,t,r,a,l=1/0){const u=n.range;if(!u)return 0;const d=Math.min(l,Math.max(r,a)),h=Math.log(d/1024)/Math.LN2;return bl(u[0]+h,u[1]+h,t)}const mn=1/4e4;function oo(n,t){const r=Jt(t.lat,-Gi,Gi),a=new we(t.lng-180*mn,r),l=new we(t.lng+180*mn,r),u=n.project(a.lng,r),d=n.project(l.lng,r),h=Je.fromLngLat(a),p=Je.fromLngLat(l),m=d.x-u.x,_=d.y-u.y,y=p.x-h.x,x=p.y-h.y,b=Math.sqrt((y*y+x*x)/(m*m+_*_));return Math.log(b)/Math.LN2}function zb(n,t,r){const a=Math.cos(r),l=Math.sin(r);return{x:n*a-t*l,y:n*l+t*a}}function Pd(n,t,r){return t*(dt/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}const bf={unknown:0,flipRequired:1,flipNotRequired:2},N2=Math.tan(85*Math.PI/180);function Iu(n,t,r,a,l,u,d){const h=rt.create();if(r)if("globe"===u.name){const p=function(m,_){const{x:y,y:x}=m.point,b=GC(y,x,m.worldSize/m._pixelsPerMercatorPixel,0,0);return rt.multiply(b,b,ba(ko(_)))}(l,t);rt.multiply(h,h,p)}else{const p=Bh.invert([],d);h[0]=p[0],h[1]=p[1],h[4]=p[2],h[5]=p[3],a||rt.rotateZ(h,h,l.angle)}else rt.multiply(h,l.labelPlaneMatrix,n);return h}function wf(n,t,r,a,l,u,d){const h=Iu(n,t,r,a,l,u,d);return"globe"===u.name&&r||(h[2]=h[6]=h[10]=h[14]=0),h}function Bb(n,t,r,a,l,u,d){if(r){if("globe"===u.name){const h=Iu(n,t,r,a,l,u,d);return rt.invert(h,h),rt.multiply(h,n,h),h}{const h=rt.clone(n),p=rt.identity([]);return p[0]=d[0],p[1]=d[1],p[4]=d[2],p[5]=d[3],rt.multiply(h,h,p),a||rt.rotateZ(h,h,-l.angle),h}}return l.glCoordMatrix}function Ma(n,t,r,a){const l=[n,t,r,1];r?Ln.transformMat4(l,l,a):Ub(l,l,a);const u=l[3];return l[0]/=u,l[1]/=u,l[2]/=u,l}function dS(n,t){return Math.min(.5+n/t*.5,1.5)}function z2(n,t){const r=n[0]/n[3],a=n[1]/n[3];return r>=-t[0]&&r<=t[0]&&a>=-t[1]&&a<=t[1]}function hS(n,t,r,a,l,u,d,h,p,m){const _=r.transform,y=a?n.textSizeData:n.iconSizeData,x=Ic(y,r.transform.zoom),b="globe"===_.projection.name,E=[256/r.width*2+1,256/r.height*2+1],C=a?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;C.clear();let S=null;b&&(S=a?n.text.globeExtVertexArray:n.icon.globeExtVertexArray);const M=n.lineVertexArray,D=a?n.text.placedSymbolArray:n.icon.placedSymbolArray,R=r.transform.width/r.transform.height;let P,I=!1;for(let O=0;O<D.length;O++){const F=D.get(O),{numGlyphs:L,writingMode:N}=F;if(N!==ti.vertical||I||P===ti.horizontal||(I=!0),P=N,(F.hidden||N===ti.vertical)&&!I){Od(L,C);continue}I=!1;const z=new nt(F.tileAnchorX,F.tileAnchorY);let{x:U,y:V,z:G}=_.projection.projectTilePoint(z.x,z.y,m.canonical);if(p){const[mt,vt,ct]=p(z);U+=mt,V+=vt,G+=ct}const j=[U,V,G,1];if(Ln.transformMat4(j,j,t),!z2(j,E)){Od(L,C);continue}const Z=j[3],et=dS(r.transform.getCameraToCenterDistance(_.projection),Z),it=bm(y,x,F),X=d?it/et:it*et,Y=Ma(U,V,G,l);if(Y[3]<=0){Od(L,C);continue}let ot={};const lt=d?null:p,ht=cr(F,X,!1,h,t,l,u,n.glyphOffsetArray,M,C,S,Y,z,ot,R,lt,_.projection,m,d);I=ht.useVertical,lt&&ht.needsFlipping&&(ot={}),(ht.notEnoughRoom||I||ht.needsFlipping&&cr(F,X,!0,h,t,l,u,n.glyphOffsetArray,M,C,S,Y,z,ot,R,lt,_.projection,m,d).notEnoughRoom)&&Od(L,C)}a?(n.text.dynamicLayoutVertexBuffer.updateData(C),S&&n.text.globeExtVertexBuffer&&n.text.globeExtVertexBuffer.updateData(S)):(n.icon.dynamicLayoutVertexBuffer.updateData(C),S&&n.icon.globeExtVertexBuffer&&n.icon.globeExtVertexBuffer.updateData(S))}function Ef(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C){const{lineStartIndex:S,glyphStartIndex:M,segment:D}=h,R=M+h.numGlyphs,P=S+h.lineLength,I=t.getoffsetX(M),O=t.getoffsetX(R-1),F=Vm(n*I,r,a,l,u,d,D,S,P,p,m,_,y,x,!0,b,E,C);if(!F)return null;const L=Vm(n*O,r,a,l,u,d,D,S,P,p,m,_,y,x,!0,b,E,C);return L?{first:F,last:L}:null}function Vb(n,t,r,a){return n===ti.horizontal&&Math.abs(a)>Math.abs(r)?{useVertical:!0}:n===ti.vertical?a>0?{needsFlipping:!0}:null:t!==bf.unknown&&(0===(l=r)||Math.abs(a/l)>N2)?t===bf.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null;var l}function cr(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D){const R=t/24,P=n.lineOffsetX*R,I=n.lineOffsetY*R,{lineStartIndex:O,glyphStartIndex:F,numGlyphs:L,segment:N,writingMode:z,flipState:U}=n,V=O+n.lineLength,G=j=>{if(_){const[X,Y,ot]=j.up,lt=m.length;Vy(_,lt+0,X,Y,ot),Vy(_,lt+1,X,Y,ot),Vy(_,lt+2,X,Y,ot),Vy(_,lt+3,X,Y,ot)}const[Z,et,it]=j.point;df(m,Z,et,it,j.angle)};if(L>1){const j=Ef(R,h,P,I,r,y,x,n,p,u,b,C,!1,S,M,D);if(!j)return{notEnoughRoom:!0};if(a&&!r){let[Z,et,it]=j.first.point,[X,Y,ot]=j.last.point;[Z,et]=Ma(Z,et,it,d),[X,Y]=Ma(X,Y,ot,d);const lt=Vb(z,U,(X-Z)*E,Y-et);if(n.flipState=lt&&lt.needsFlipping?bf.flipRequired:bf.flipNotRequired,lt)return lt}G(j.first);for(let Z=F+1;Z<F+L-1;Z++){const et=Vm(R*h.getoffsetX(Z),P,I,r,y,x,N,O,V,p,u,b,C,!1,!1,S,M,D);if(!et)return m.length-=4*(Z-F),{notEnoughRoom:!0};G(et)}G(j.last)}else{if(a&&!r){const Z=Ma(x.x,x.y,0,l),et=O+N+1,it=new nt(p.getx(et),p.gety(et)),X=Ma(it.x,it.y,0,l),Y=X[3]>0?X:fS(x,it,Z,1,l,void 0,S,M.canonical),ot=Vb(z,U,(Y[0]-Z[0])*E,Y[1]-Z[1]);if(n.flipState=ot&&ot.needsFlipping?bf.flipRequired:bf.flipNotRequired,ot)return ot}const j=Vm(R*h.getoffsetX(F),P,I,r,y,x,N,O,V,p,u,b,C,!1,!1,S,M,D);if(!j)return{notEnoughRoom:!0};G(j)}return{}}function jb(n,t,r,a,l){const{x:u,y:d,z:h}=a.projectTilePoint(n.x,n.y,t);if(!l)return Ma(u,d,h,r);const[p,m,_]=l(n);return Ma(u+p,d+m,h+_,r)}function fS(n,t,r,a,l,u,d,h){const p=jb(n.sub(t)._unit()._add(n),h,l,d,u);return q.sub(p,r,p),q.normalize(p,p),q.scaleAndAdd(p,r,p,a)}function Vm(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M){const D=a?n-t:n+t;let R=D>0?1:-1,P=0;a&&(R*=-1,P=Math.PI),R<0&&(P+=Math.PI);let I=h+d+(R>0?0:1)|0,O=l,F=l,L=0,N=0;const z=Math.abs(D),U=[],V=[];let G=u,j=G;const Z=()=>fS(j,G,F,z-L+1,_,x,C,S.canonical);for(;L+N<=z;){if(I+=R,I<h||I>=p)return null;if(F=O,j=G,U.push(F),b&&V.push(j),G=new nt(m.getx(I),m.gety(I)),O=y[I],!O){const vt=jb(G,S.canonical,_,C,x);O=vt[3]>0?y[I]=vt:Z()}L+=N,N=q.distance(F,O)}E&&x&&(y[I]&&(O=Z(),N=q.distance(F,O)),y[I]=O);const et=(z-L)/N,it=G.sub(j)._mult(et)._add(j),X=q.sub([],O,F),Y=q.scaleAndAdd([],F,X,et);let ot=[0,0,1],lt=X[0],ht=X[1];if(M&&(ot=C.upVector(S.canonical,it.x,it.y),0!==ot[0]||0!==ot[1]||1!==ot[2])){const vt=[ot[2],0,-ot[0]],ct=q.cross([],ot,vt);q.normalize(vt,vt),q.normalize(ct,ct),lt=q.dot(X,vt),ht=q.dot(X,ct)}if(r){const vt=q.cross([],ot,X);q.normalize(vt,vt),q.scaleAndAdd(Y,Y,vt,r*R)}const mt=P+Math.atan2(ht,lt);return U.push(Y),b&&V.push(it),{point:Y,angle:mt,path:U,tilePath:V,up:ot}}function Od(n,t){const r=t.length,a=r+4*n;t.resize(a),t.float32.fill(-1/0,4*r,4*a)}function Ub(n,t,r){const a=t[0],l=t[1];return n[0]=r[0]*a+r[4]*l+r[12],n[1]=r[1]*a+r[5]*l+r[13],n[3]=r[3]*a+r[7]*l+r[15],n}const so=(n,t,r)=>(1-r)*n+r*t,pS=n=>n*n*n*n*n;class Fc{constructor(t,r,a,l,u,d,h){this.tileSize=512,this._renderWorldCopies=void 0===u||u,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=a??0,this._maxPitch=l??60,this.setProjection(d),this.setMaxBounds(h),this.width=0,this.height=0,this._center=new we(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Zy,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Cn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Fc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,r=!1){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||a)&&this._updateCameraOnTerrain(),(t||a)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return ns(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=Am(this.projectionOptions);const a=!cn(r,this.getProjection());return a&&this._calcMatrices(),this.mercatorFromTransition=!1,a}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Am({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Nn(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new nt(this.width,this.height)}get bearing(){return wl(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=Bh.create(),Bh.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=Jt(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=Ie(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&a.exaggeration()&&this._centerAltitudeValidForExaggeration!==a.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*a.exaggeration(),this._centerAltitudeValidForExaggeration=a.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=a.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],a=this.horizonLineFromTop();let l=0,u=0;for(let d=0;d<r.length;d++){const h=new nt(r[d][0]*this.width,a+r[d][1]*(this.height-a)),p=t.pointCoordinate(h);if(!p)continue;const m=1/Math.hypot(p[0]-this._camera.position[0],p[1]-this._camera.position[1]);l+=p[3]*m,u+=m}return 0===u?NaN:l/u}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),a=this.pixelsPerMeter/this.worldSize*r,l=this._mercatorZfromZoom(t),u=this._mercatorZfromZoom(this._maxZoom),d=Math.max(l-a,u);this._setZoom(this._zoomFromMercatorZ(d))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let a;a=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const l=q.length(q.sub([],this._camera.position,a));return Jt(this._zoomFromMercatorZ(l),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!to.exactEquals(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const a=[t.position.x,t.position.y,t.position.z];q.exactEquals(a,this._camera.position)||(this._setCameraPosition(a),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new Bm;return r.position=new Je(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!to.length(t))return!1;to.normalize(t,t);const r=q.transformQuat([],[0,0,-1],t),a=q.transformQuat([],[0,-1,0],t);if(a[2]<0)return!1;const l=cS(r,a);return!!l&&(this._camera.orientation=l,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,a=this.zoomScale(this.maxZoom)*this.tileSize,l=this.cameraToCenterDistance;t[2]=Jt(t[2],l/a,l/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,a){this._unmodified=!1,this._edgeInsets.interpolate(t,r,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new J_(0,t)];if(this.renderWorldCopies){const a=this.pointCoordinate(new nt(0,0)),l=this.pointCoordinate(new nt(this.width,0)),u=this.pointCoordinate(new nt(this.width,this.height)),d=this.pointCoordinate(new nt(0,this.height)),h=Math.floor(Math.min(a.x,l.x,u.x,d.x)),p=Math.floor(Math.max(a.x,l.x,u.x,d.x)),m=1;for(let _=h-m;_<=p+m;_++)0!==_&&r.push(new J_(_,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,r,a){let l=[];if(0===r[0]&&0===r[1])return l;for(const d of t){const h=d.canonical,p=d.overscaledZ,m=d.wrap,_=1<<h.z,y=h.x+1<_,x=h.x>0,b=h.y+1<_,E=h.y>0,C=d.wrap-(x?0:1),S=d.wrap+(y?0:1),M=x?h.x-1:_-1,D=y?h.x+1:0;r[0]<0?(l.push(new tn(p,S,h.z,D,h.y)),r[1]<0&&b&&(l.push(new tn(p,m,h.z,h.x,h.y+1)),l.push(new tn(p,S,h.z,D,h.y+1))),r[1]>0&&E&&(l.push(new tn(p,m,h.z,h.x,h.y-1)),l.push(new tn(p,S,h.z,D,h.y-1)))):r[0]>0?(l.push(new tn(p,C,h.z,M,h.y)),r[1]<0&&b&&(l.push(new tn(p,m,h.z,h.x,h.y+1)),l.push(new tn(p,C,h.z,M,h.y+1))),r[1]>0&&E&&(l.push(new tn(p,m,h.z,h.x,h.y-1)),l.push(new tn(p,C,h.z,M,h.y-1)))):r[1]<0&&b?l.push(new tn(p,m,h.z,h.x,h.y+1)):E&&l.push(new tn(p,m,h.z,h.x,h.y-1))}if(l.length>1){l.sort((p,m)=>p.overscaledZ-m.overscaledZ||p.wrap-m.wrap||p.canonical.z-m.canonical.z||p.canonical.x-m.canonical.x||p.canonical.y-m.canonical.y);let d=0,h=0;for(;h<l.length;)l[h].equals(l[d])?++h:l[++d]=l[h++];l.length=d+1}const u=[];for(const d of l)l.some(h=>d.isChildOf(h))||u.push(d);return l=u.filter(d=>!t.some(h=>!!(d.overscaledZ<a&&h.isChildOf(d))||d.equals(h)||d.isChildOf(h))),l}coveringTiles(t){let r=this.coveringZoomLevel(t);const a=r,l=this.elevation&&this.elevation.exaggeration(),u=l&&!t.isTerrainDEM,d="mercator"===this.projection.name;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);const h=this.locationCoordinate(this.center),p=this.center.lat,m=1<<r,_=[m*h.x,m*h.y,0],y="globe"===this.projection.name,x=!y,b=Vl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,x),E=y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),C=m*Nn(1,this.center.lat),S=this._camera.position[2]/Nn(1,this.center.lat),M=[m*E.x,m*E.y,S*(x?1:C)],D=y||l,R=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),P=this.isLODDisabled(!0)?r:0,I=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,O=t.isTerrainDEM?-I:this._elevation?this._elevation.getMinElevationBelowMSL():0,F=this.projection.isReprojectedInTileSpace?uS(this):1,L=X=>{const ot=new Je(X.x+25e-6,X.y,X.z),lt=new Je(X.x,X.y+25e-6,X.z),ht=X.toLngLat(),mt=ot.toLngLat(),vt=lt.toLngLat(),ct=this.locationCoordinate(ht),ft=this.locationCoordinate(mt),Rt=this.locationCoordinate(vt),Vt=Math.hypot(ft.x-ct.x,ft.y-ct.y),jt=Math.hypot(Rt.x-ct.x,Rt.y-ct.y);return Math.sqrt(Vt*jt)*F/25e-6},N=X=>{const Y=I,ot=O;return{aabb:ky(this,m,0,0,0,X,ot,Y,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:Y,wrap:X,fullyVisible:!1}},z=[];let U=[];const V=r,G=t.reparseOverscaled?a:r,j=X=>X*X,Z=j((S-this._centerAltitude)*C),et=X=>{if(!this._elevation||!X.tileID||!d)return;const Y=this._elevation.getMinMaxForTile(X.tileID),ot=X.aabb;Y?(ot.min[2]=Y.min,ot.max[2]=Y.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(X.shouldSplit=it(X),X.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},it=X=>{if(X.zoom<P)return!0;if(X.zoom===V)return!1;if(null!=X.shouldSplit)return X.shouldSplit;const Y=X.aabb.distanceX(M),ot=X.aabb.distanceY(M);let lt=Z,ht=1;if(y){lt=j(X.aabb.distanceZ(M));const ct=Math.pow(2,X.zoom),ft=lr((X.y+1)/ct),Rt=lr(X.y/ct),Vt=Math.min(Math.max(p,ft),Rt),jt=Gh(Vt)/Gh(p);if(ht=Vt===p?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,jt/this._mercatorScaleRatio),this.zoom<=Xp&&X.zoom===V-1&&jt>=.9)return!0}else if(u&&(lt=j(X.aabb.distanceZ(M)*C)),this.projection.isReprojectedInTileSpace&&a<=5){const ct=Math.pow(2,X.zoom),ft=L(new Je((X.x+.5)/ct,(X.y+.5)/ct));ht=ft>.85?1:ft}const mt=Y*Y+ot*ot+lt;return mt<j((1<<V-X.zoom)*R*ht*((ct,ft)=>{if(ft*j(.707)<ct)return 1;const Rt=Math.sqrt(ft/ct);return Rt/(1.4144271570014144+(Math.pow(1.1,Rt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(lt,Z),mt))};if(this.renderWorldCopies)for(let X=1;X<=3;X++)z.push(N(-X)),z.push(N(X));for(z.push(N(0));z.length>0;){const X=z.pop(),Y=X.x,ot=X.y;let lt=X.fullyVisible;const ht=()=>"globe"===this.projection.name&&(0===X.y||X.y===(1<<X.zoom)-1);if(!lt){let mt=D?X.aabb.intersects(b):X.aabb.intersectsFlat(b);if(0===mt&&ht()){const vt=new ya(X.zoom,Y,ot);mt=ey(this,m,vt,!0).intersects(b)}if(0===mt)continue;lt=2===mt}if(X.zoom!==V&&it(X))for(let mt=0;mt<4;mt++){const vt=(Y<<1)+mt%2,ct=(ot<<1)+(mt>>1),ft={aabb:d?X.aabb.quadrant(mt):ky(this,m,X.zoom+1,vt,ct,X.wrap,X.minZ,X.maxZ,this.projection),zoom:X.zoom+1,x:vt,y:ct,wrap:X.wrap,fullyVisible:lt,tileID:void 0,shouldSplit:void 0,minZ:X.minZ,maxZ:X.maxZ};u&&!y&&(ft.tileID=new tn(X.zoom+1===V?G:X.zoom+1,X.wrap,X.zoom+1,vt,ct),et(ft)),z.push(ft)}else{const mt=X.zoom===V?G:X.zoom;if(t.minzoom&&t.minzoom>mt)continue;if(!lt){let Rt=D?X.aabb.intersectsPrecise(b):X.aabb.intersectsPreciseFlat(b);if(0===Rt&&ht()){const Vt=new ya(X.zoom,Y,ot);Rt=ey(this,m,Vt,!0).intersectsPrecise(b)}if(0===Rt)continue}const vt=_[0]-(.5+Y+(X.wrap<<X.zoom))*(1<<r-X.zoom),ct=_[1]-.5-ot,ft=X.tileID?X.tileID:new tn(mt,X.wrap,X.zoom,Y,ot);U.push({tileID:ft,distanceSq:vt*vt+ct*ct})}}if(this.fogCullDistSq){const X=this.fogCullDistSq,Y=this.horizonLineFromTop();U=U.filter(ot=>{const lt=[0,0,0,1],ht=[dt,dt,0,1],mt=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());Ln.transformMat4(lt,lt,mt),Ln.transformMat4(ht,ht,mt);const vt=function(Rt,Vt,jt){let Ht=0;for(let re=0;re<2;++re)Rt[re]>0&&(Ht+=(Rt[re]-0)*(Rt[re]-0)),Vt[re]<0&&(Ht+=(0-Vt[re])*(0-Vt[re]));return Ht}(Ln.min([],lt,ht),Ln.max([],lt,ht));if(0===vt)return!0;let ct=!1;const ft=this._elevation;if(ft&&vt>X&&0!==Y){const Rt=this.calculateProjMatrix(ot.tileID.toUnwrapped());let Vt;t.isTerrainDEM||(Vt=ft.getMinMaxForTile(ot.tileID)),Vt||(Vt={min:O,max:I});const jt=function(re){const ye=Math.round((re+45+360)%360/90)%4;return p0[ye]}(this.rotation),Ht=[jt[0]*dt,jt[1]*dt,Vt.max];q.transformMat4(Ht,Ht,Rt),ct=(1-Ht[1])*this.height*.5<Y}return vt<X||ct})}return U.sort((X,Y)=>X.distanceSq-Y.distanceSq).map(X=>X.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=Jt(t.lat,-Gi,Gi),a=this.projection.project(t.lng,r);return new nt(a.x*this.worldSize,a.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Nn(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let a,l;const u=this.centerPoint;if("globe"===this.projection.name){const h=this.worldSize;a=(r.x-u.x)/h,l=(r.y-u.y)/h}else{const h=this.pointCoordinate(r),p=this.pointCoordinate(u);a=h.x-p.x,l=h.y-p.y}const d=this.locationCoordinate(t);this.setLocation(new Je(d.x-a,d.y-l))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,r){const a=r?Nn(r,t.lat):void 0,l=this.projection.project(t.lng,t.lat);return new Je(l.x,l.y,a)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const a=r??this._centerAltitude,l=[t.x,t.y,0,1],u=[t.x,t.y,1,1];Ln.transformMat4(l,l,this.pixelMatrixInverse),Ln.transformMat4(u,u,this.pixelMatrixInverse);const d=u[3];Ln.scale(l,l,1/l[3]),Ln.scale(u,u,1/d);const h=l[2],p=u[2];return{p0:l,p1:u,t:h===p?0:(a-h)/(p-h)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],a=[t.x,t.y,1,1];return Ln.transformMat4(r,r,this.pixelMatrixInverse),Ln.transformMat4(a,a,this.pixelMatrixInverse),Ln.scale(r,r,1/r[3]),Ln.scale(a,a,1/a[3]),r[2]=Nn(r[2],this._center.lat)*this.worldSize,a[2]=Nn(a[2],this._center.lat)*this.worldSize,Ln.scale(r,r,1/this.worldSize),Ln.scale(a,a,1/this.worldSize),new Vh([r[0],r[1],r[2]],q.normalize([],q.sub([],a,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:a,t:l}=t,u=Nn(r[2],this._center.lat),d=Nn(a[2],this._center.lat);return new Je(_e(r[0],a[0],l)/this.worldSize,_e(r[1],a[1],l)/this.worldSize,_e(u,d,l))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new Je(r[0],r[1],r[2]);let a=0,l=this.horizonLineFromTop();if(t.y>l)return this.pointCoordinate(t);const u=.02*l,d=t.clone();for(let h=0;h<10&&l-a>u;h++){d.y=_e(a,l,.66);const p=this.projection.pointCoordinate3D(this,d.x,d.y);p?(l=d.y,r=p):a=d.y}return r?new Je(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=_u)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const a=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,l=[t.x*this.worldSize,t.y*this.worldSize,a+t.toAltitude(),1];return Ln.transformMat4(l,l,this.pixelMatrix),l[3]>0?new nt(l[0]/l[3],l[1]/l[3]):new nt(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,a=this.height-this._edgeInsets.bottom,l=this.width-this._edgeInsets.right,u=this.pointLocation3D(new nt(r,t)),d=this.pointLocation3D(new nt(l,t)),h=this.pointLocation3D(new nt(l,a)),p=this.pointLocation3D(new nt(r,a));let m=Math.min(u.lng,d.lng,h.lng,p.lng),_=Math.max(u.lng,d.lng,h.lng,p.lng),y=Math.min(u.lat,d.lat,h.lat,p.lat),x=Math.max(u.lat,d.lat,h.lat,p.lat);const b=Math.pow(2,-this.zoom)/16*270,E="globe"===this.projection.name?1:4,C=(S,M,D,R,P)=>{const I=(S+D)/2,O=(M+R)/2,F=new nt(I,O),{lng:L,lat:N}=this.pointLocation3D(F),z=Math.max(0,m-L,y-N,L-_,N-x);m=Math.min(m,L),_=Math.max(_,L),y=Math.min(y,N),x=Math.max(x,N),(P<E||z>b)&&(C(S,M,I,O,P+1),C(I,O,D,R,P+1))};if(C(r,t,l,t,1),C(l,t,l,a,1),C(l,a,r,a,1),C(r,a,r,t,1),"globe"===this.projection.name){const[S,M]=function(D){const R=rt.identity(new Float64Array(16));rt.multiply(R,D.pixelMatrix,D.globeMatrix);const P=[0,Oo,0],I=[0,va,0];return q.transformMat4(P,P,R),q.transformMat4(I,I,R),[P[0]>0&&P[0]<=D.width&&P[1]>0&&P[1]<=D.height&&!iy(D,new we(D.center.lat,90)),I[0]>0&&I[0]<=D.width&&I[1]>0&&I[1]<=D.height&&!iy(D,new we(D.center.lat,-90))]}(this);S?(x=90,_=180,m=-180):M&&(y=-90,_=180,m=-180)}return new Zs(new we(m,y),new we(_,x))}_getBoundsRectangular(t,r){const{top:a,left:l}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,h=new nt(l,a),p=new nt(d,a),m=new nt(d,u),_=new nt(l,u);let y=this.pointCoordinate(h,t),x=this.pointCoordinate(p,t);const b=this.pointCoordinate(m,r),E=this.pointCoordinate(_,r),C=(S,M)=>(M.y-S.y)/(M.x-S.x);return y.y>1&&x.y>=0?y=new Je((1-E.y)/C(E,y)+E.x,1):y.y<0&&x.y<=1&&(y=new Je(-E.y/C(E,y)+E.x,0)),x.y>1&&y.y>=0?x=new Je((1-b.y)/C(b,x)+b.x,1):x.y<0&&y.y<=1&&(x=new Je(-b.y/C(b,x)+b.x,0)),(new Zs).extend(this.coordinateLocation(y)).extend(this.coordinateLocation(x)).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(b))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((a,l)=>{if(l.dem){const u=l.dem.tree;a.min=Math.min(a.min,u.minimums[0]),a.max=Math.max(a.max,u.maximums[0])}return a},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,a=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,a):a}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-Gi,this.maxLat=Gi,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=no(this.minLng)*this.tileSize,this.worldMaxX=no(this.maxLng)*this.tileSize,this.worldMinY=mo(this.maxLat)*this.tileSize,this.worldMaxY=mo(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,a=this._distanceTileDataCache;if(a[r])return a[r];const l=t.canonical,u=1/this.height,d=this.cameraWorldSize,h=d/this.zoomScale(l.z),p=(l.x+Math.pow(2,l.z)*t.wrap)*h,m=l.y*h,_=this.point;_.x*=d/this.worldSize,_.y*=d/this.worldSize;const y=this.angle,x=Math.sin(-y),b=-Math.cos(-y);return a[r]={bearing:[x,b],center:[(_.x-p)*u,(_.y-m)*u],scale:h/dt*u},a[r]}calculateFogTileMatrix(t){const r=t.key,a=this._fogTileMatrixCache;if(a[r])return a[r];const l=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return rt.multiply(l,this.worldToFogMatrix,l),a[r]=new Float32Array(l),a[r]}calculateProjMatrix(t,r=!1){const a=t.key,l=r?this._alignedProjMatrixCache:this._projMatrixCache;if(l[a])return l[a];const u=this.calculatePosMatrix(t,this.worldSize);return rt.multiply(u,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.alignedProjMatrix:this.projMatrix,u),l[a]=new Float32Array(u),l[a]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,a=this._pixelsToTileUnitsCache;if(a[r])return a[r];const l=function(u,d){const{scale:h}=u.tileTransform,p=h*dt/(u.tileSize*Math.pow(2,d.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return Bh.scale(new Float32Array(4),d.inverseAdjustmentMatrix,[p,p])}(t,this);return a[r]=l,a[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,r=rt.fromScaling([],[t,t,t]);return rt.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const r=Nn(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(r),l=this._camera.forward(),u=Nn(1,this._center.lat);a[2]/=u,l[2]/=u,q.normalize(l,l);const d=t.raycast(a,l,t.exaggeration());if(d){const h=q.scaleAndAdd([],a,l,d),p=new Je(h[0],h[1],Nn(h[2],lr(h[1]))),m=(p.z+q.length([p.x-a[0],p.y-a[1],p.z-a[2]*u]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(m),this._centerAltitude=p.toAltitude(),this._center=this.coordinateLocation(p),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,a=Nn(1,this._center.lat)*this.worldSize,l=this._computeCameraPosition(a),u=r.getAtPointOrZero(new Je(...l)),d=this.pixelsPerMeter/this.worldSize*u,h=this._minimumHeightOverTerrain(),p=l[2]-d;if(p<=h)if(p<0||t){const m=this.locationCoordinate(this._center,this._centerAltitude),_=[l[0],l[1],m.z-l[2]],y=q.length(_);_[2]-=(h-p)/this._pixelsPerMercatorPixel;const x=q.length(_);if(0===x)return;q.scale(_,_,y/x*this._pixelsPerMercatorPixel),this._camera.position=[l[0],l[1],m.z*this._pixelsPerMercatorPixel-_[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const x=this.center;return x.lat=Jt(x.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(x.lng=Jt(x.lng,this.minLng,this.maxLng)),this.center=x,void(this._constraining=!1)}const r=this._unmodified,{x:a,y:l}=this.point;let u=0,d=a,h=l;const p=this.width/2,m=this.height/2,_=this.worldMinY*this.scale,y=this.worldMaxY*this.scale;if(l-m<_&&(h=_+m),l+m>y&&(h=y-m),y-_<this.height&&(u=Math.max(u,this.height/(y-_)),h=(y+_)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const x=this.worldMinX*this.scale,b=this.worldMaxX*this.scale,E=this.worldSize/2-(x+b)/2;d=(a+E+this.worldSize)%this.worldSize-E,d-p<x&&(d=x+p),d+p>b&&(d=b-p),b-x<this.width&&(u=Math.max(u,this.width/(b-x)),d=(b+x)/2)}d===a&&h===l||(this.center=this.unproject(new nt(d,h))),u&&(this.zoom+=this.scaleZoom(u)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r="globe"===this.projection.name,a=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=Nn(1,this.center.lat)/Nn(1,45));const l=un(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,l),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const u="meters"===this.projection.zAxisUnit?a:1,d=this._camera.getWorldToCamera(this.worldSize,u);let h;const p=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height,this.isOrthographic){let N=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),z=N*this.aspect,U=-z,V=-N;z-=t.x,U-=t.x,N+=t.y,V+=t.y,h=this._camera.getCameraToClipOrthographic(U,z,V,N,this._nearZ,this._farZ),((G,j,Z,et)=>{for(let it=0;it<16;it++)G[it]=so(j[it],Z[it],et)})(h,h,p,pS(this.pitch>=15?1:this.pitch/15))}else h=p;const m=rt.mul([],p,d);let _=rt.mul([],h,d);if(this.projection.isReprojectedInTileSpace){const N=this.locationCoordinate(this.center),z=rt.identity([]);rt.translate(z,z,[N.x*this.worldSize,N.y*this.worldSize,0]),rt.multiply(z,z,Xy(this)),rt.translate(z,z,[-N.x*this.worldSize,-N.y*this.worldSize,0]),rt.multiply(_,_,z),rt.multiply(m,m,z),this.inverseAdjustmentMatrix=function(U){const V=Xy(U,!0);return Bh.invert([],[V[0],V[1],V[4],V[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=rt.scale([],_,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=_,this.invProjMatrix=rt.invert(new Float64Array(16),this.projMatrix);const y=rt.invert([],h);this.frustumCorners=jh.fromInvProjectionMatrix(y,this.horizonLineFromTop(),this.height),this.cameraFrustum=Vl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const x=new Float32Array(16);rt.identity(x),rt.scale(x,x,[1,-1,1]),rt.rotateX(x,x,this._pitch),rt.rotateZ(x,x,this.angle);const b=rt.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=rt.clone(b);const E=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;b[8]=2*-t.x/this.width,b[9]=2*(t.y+E)/this.height,this.skyboxMatrix=rt.multiply(x,b,x);const C=this.point,S=C.x,M=C.y,D=this.width%2/2,R=this.height%2/2,P=Math.cos(this.angle),I=Math.sin(this.angle),O=S-Math.round(S)+P*D+I*R,F=M-Math.round(M)+P*R+I*D,L=new Float64Array(_);if(rt.translate(L,L,[O>.5?O-1:O,F>.5?F-1:F,0]),this.alignedProjMatrix=L,_=rt.create(),rt.scale(_,_,[this.width/2,-this.height/2,1]),rt.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=rt.create(),rt.scale(_,_,[1,-1,1]),rt.translate(_,_,[-1,-1,0]),rt.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.pixelMatrix=rt.multiply(new Float64Array(16),this.labelPlaneMatrix,m),this._calcFogMatrices(),this._distanceTileDataCache={},_=rt.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=_,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(z){const{x:U,y:V}=z.point,{lng:G,lat:j}=z._center;return GC(U,V,z.worldSize,G,j)}(this);const N=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=q.transformMat4(N,N,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=_;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,a=this._camera.position,l=1/this.height/this._pixelsPerMercatorPixel,u=[t,t,r];q.scale(u,u,l),q.scale(a,a,-1),q.multiply(a,a,u);const d=rt.create();rt.translate(d,d,a),rt.scale(d,d,u),this.mercatorFogMatrix=d,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,l)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,a=this._camera.forward(),l=this.point,u=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[l.x/this.worldSize-a[0]*u,l.y/this.worldSize-a[1]*u,t/this.worldSize*this._centerAltitude-a[2]*u]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),a=this._camera.position[2],l=t[2];let u=1;this.projection.wrap&&(this.center=this.center.wrap()),l>0&&(u=Math.min((r-a)/l,1)),this._camera.position=q.scaleAndAdd([],this._camera.position,t,u),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:a,bearing:l}=this._camera.getPitchBearing(),u=Nn(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,d=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Ie(this._maxPitch)),h=Math.max((t[2]-u)/Math.cos(a),d),p=this._zoomFromMercatorZ(h);q.scaleAndAdd(t,t,r,h),this._pitch=Jt(a,Ie(this.minPitch),Ie(this.maxPitch)),this.angle=wl(l,-Math.PI,Math.PI),this._setZoom(Jt(p,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Je(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,a=_u,l=0,u=1/0;for(;a-r>1e-6&&a>r;){const d=r+.5*(a-r),h=this.tileSize*Math.pow(2,d),p=this.getCameraToCenterDistance(this.projection,d,h),m=this.scaleZoom(p/(t*this.tileSize)),_=Math.abs(d-m);_<u&&(u=_,l=d),d<m?r=d:a=d}return l}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(tt("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const a=Math.min(t.x,r.x),l=Math.max(t.x,r.x),u=Math.min(t.y,r.y),d=Math.max(t.y,r.y);if(u<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const h=[new nt(a,u),new nt(l,d),new nt(a,d),new nt(l,u)],p=this.renderWorldCopies?-3:0,m=this.renderWorldCopies?4:1;for(const _ of h){const y=this.pointRayIntersection(_);if(y.t<0)return!0;const x=this.rayIntersectionCoordinate(y);if(x.x<p||x.y<0||x.x>m||x.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+Cr(this.fovAboveCenter)>88||this.anyCornerOffEdge(new nt(0,0),new nt(this.width,this.height))}zoomDeltaToMovement(t,r){const a=q.length(q.sub([],this._camera.position,t)),l=this._zoomFromMercatorZ(a)+r;return a-this._mercatorZfromZoom(l)}getCameraPoint(){if("globe"===this.projection.name){const t=function([r,a,l],u){const d=[r,a,l,1];Ln.transformMat4(d,d,u);const h=d[3]=Math.max(d[3],1e-6);return d[0]/=h,d[1]/=h,d[2]/=h,d}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new nt(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new nt(0,t))}}getCameraToCenterDistance(t,r=this.zoom,a=this.worldSize){const l=un(t,r,this.width,this.height,1024),u=t.pixelSpaceConversion(this.center.lat,a,l);let d=.5/Math.tan(.5*this._fov)*this.height*u;return this.isOrthographic&&(d=so(1,d,pS(this.pitch>=15?1:this.pitch/15))),d}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&rt.multiply(t,t,this.globeMatrix),t}getFrustum(t){return Vl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}function jr(n,t,r){rt.identity(n),rt.rotateZ(n,n,Ie(t[2])),rt.rotateX(n,n,Ie(t[0])),rt.rotateY(n,n,Ie(t[1])),rt.scale(n,n,r),rt.multiply(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function jm(n,t,r,a,l,u,d,h){const p=[r[0]-t[0],r[1]-t[1],0],m=[a[0]-t[0],a[1]-t[1],0];if(q.length(p)<1e-12||q.length(m)<1e-12)return to.identity(n);const _=q.cross([],p,m);q.normalize(_,_),q.subtract(m,a,t),p[2]=(u-l)*h,m[2]=(d-l)*h;const y=p;return q.cross(y,p,m),q.normalize(y,y),to.rotationTo(n,_,y)}function Yy(n,t,r=!1){const a=Vr(t.zoom),l=function(u,d,h){const p=d.worldSize,m=[u[12],u[13],u[14]],_=lr(m[1]/p),y=Ts(m[0]/p),x=rt.identity([]),b=Nn(1,_)*p,E=Nn(1,0)*p*Za(_,d.zoom),C=1/Ox(p);let S=E*C;if(h){const P=un(d.projection,d.zoom,d.width,d.height,1024);S=C*d.projection.pixelSpaceConversion(d.center.lat,p,P)}const M=cs(_,y);q.add(M,M,q.scale([],q.normalize([],M),b*S*m[2]));const D=function(P){const I=[P[0],P[1],P[2]];let O=[0,1,0];const F=q.cross([],O,I);return q.cross(O,I,F),0===q.squaredLength(O)&&(O=[0,1,0],q.cross(F,I,O)),q.normalize(F,F),q.normalize(O,O),q.normalize(I,I),[F[0],F[1],F[2],0,O[0],O[1],O[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],1]}(M);rt.scale(x,x,[S,S,S*b]),rt.translate(x,x,[-m[0],-m[1],-m[2]]);const R=rt.multiply([],d.globeMatrix,D);return rt.multiply(R,R,x),rt.multiply(R,R,u),R}(n,t,r);return a>0?function(d,h,p){const m=(E,C,S)=>{const M=q.length(E),D=q.length(C),R=xa(E,C,S);return q.scale(R,R,1/q.length(R)*_e(M,D,S))},_=m([d[0],d[1],d[2]],[h[0],h[1],h[2]],p),y=m([d[4],d[5],d[6]],[h[4],h[5],h[6]],p),x=m([d[8],d[9],d[10]],[h[8],h[9],h[10]],p),b=xa([d[12],d[13],d[14]],[h[12],h[13],h[14]],p);return[_[0],_[1],_[2],0,y[0],y[1],y[2],0,x[0],x[1],x[2],0,b[0],b[1],b[2],1]}(l,function(d,h){const p=h.worldSize,m=Nn(1,0)*p*Za(h.center.lat,h.zoom)/Ox(p),_=Nn(1,h.center.lat)*p,y=rt.identity([]);return rt.rotateY(y,y,Ie(h.center.lng)),rt.rotateX(y,y,Ie(h.center.lat)),rt.translate(y,y,[0,0,Po]),rt.scale(y,y,[m,m,m*_]),rt.translate(y,y,[h.point.x-.5*p,h.point.y-.5*p,0]),rt.multiply(y,y,d),rt.multiply(y,h.globeMatrix,y)}(n,t),a):l}const mS=[1,1,1];class Hb{constructor(t,r,a,l){this.id=t,this.position=null!=r?new we(r[0],r[1]):new we(0,0),this.orientation=a??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,r){if(rt.multiply(t.matrix,r,t.matrix),t.meshes)for(const a of t.meshes){const l=ui.applyTransform(a.aabb,t.matrix);this.aabb.encapsulate(l)}if(t.children)for(const a of t.children)this._applyTransformations(a,t.matrix)}computeBoundsAndApplyParent(){const t=rt.identity([]);for(const r of this.nodes)this._applyTransformations(r,t)}_positionModelOnTerrain(t,r){const a=t.elevation;if(!a)return 0;const l=ui.projectAabbCorners(this.aabb,this.matrix),u=Nn(1,this.position.lat)*t.worldSize,d=function(M,D){const R=[0,0,1],P=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const I of P){const O=M[I.corners[0]],F=M[I.corners[1]],L=M[I.corners[2]],N=[F[0]-O[0],F[1]-O[1],D*(F[2]-O[2])],z=q.cross(N,N,[L[0]-O[0],L[1]-O[1],D*(L[2]-O[2])]);q.normalize(z,z),I.dotProductWithUp=q.dot(z,R)}return P.sort((I,O)=>I.dotProductWithUp-O.dotProductWithUp),P[0].corners}(l,u),h=l[d[0]],p=l[d[1]],m=l[d[2]],_=l[d[3]],y=a.getAtPointOrZero(new Je(h[0]/t.worldSize,h[1]/t.worldSize),0),x=a.getAtPointOrZero(new Je(p[0]/t.worldSize,p[1]/t.worldSize),0),b=a.getAtPointOrZero(new Je(m[0]/t.worldSize,m[1]/t.worldSize),0),E=a.getAtPointOrZero(new Je(_[0]/t.worldSize,_[1]/t.worldSize),0),C=(y+E)/2,S=(x+b)/2;return C>S?x<b?jm(r,p,_,h,x,E,y,u):jm(r,m,h,_,b,y,E,u):y<E?jm(r,h,p,m,y,x,b,u):jm(r,_,m,p,E,b,x,u),Math.max(C,S)}computeModelMatrix(t,r,a,l,u,d,h=!1){const p=t.transform,m=p.zoom,_=p.project(this.position),y=Za(this.position.lat,m),x=1/y;rt.identity(this.matrix),rt.translate(this.matrix,this.matrix,[_.x+l[0]*x,_.y+l[1]*x,l[2]]);let b=1,E=1;const C=p.worldSize;if(h){if("mercator"===p.projection.name){let R=0;p.elevation&&(R=p.elevation.getAtPointOrZero(new Je(_.x/C,_.y/C),0));const P=Ln.transformMat4([],[_.x,_.y,R,1],p.projMatrix)[3]/p.cameraToCenterDistance;b=P,E=P*Za(p.center.lat,m)}else if("globe"===p.projection.name){const R=Yy(this.matrix,p),P=rt.multiply([],p.projMatrix,R),I=[0,0,0,1];Ln.transformMat4(I,I,P);const O=I[3]/p.cameraToCenterDistance,F=Vr(m),L=p.projection.pixelsPerMeter(this.position.lat,C)*Za(this.position.lat,m),N=p.projection.pixelsPerMeter(p.center.lat,C)*Za(p.center.lat,m);b=O/_e(L,Fx(p.center.lat),F),E=O*y/L,b*=N,E*=N}}else b=x;rt.scale(this.matrix,this.matrix,[b,b,E]);const S=[...this.matrix],M=this.orientation,D=[];if(jr(D,[M[0]+r[0],M[1]+r[1],M[2]+r[2]],a),rt.multiply(this.matrix,S,D),u&&p.elevation){let R=0;const P=[];if(d&&p.elevation){R=this._positionModelOnTerrain(p,P);const I=rt.fromQuat([],P),O=rt.multiply([],I,D);rt.multiply(this.matrix,S,O)}else R=p.elevation.getAtPointOrZero(new Je(_.x/C,_.y/C),0);0!==R&&(this.matrix[14]+=R)}}upload(t){if(!this.uploaded){for(const r of this.nodes)Ky(r,t);for(const r of this.nodes)Um(r);this.uploaded=!0}}destroy(){for(const t of this.nodes)Hm(t)}}function Cf(n,t,r=!1){n.uploaded||(n.gfxTexture=new ir(t,n.image,r?t.gl.R8:t.gl.RGBA,{useMipmap:n.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function gS(n,t,r){n.indexBuffer=t.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=t.createVertexBuffer(n.vertexArray,Lb.members,!1,!0),n.normalArray&&(n.normalBuffer=t.createVertexBuffer(n.normalArray,L2.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=t.createVertexBuffer(n.texcoordArray,F2.members,!1,!0)),n.colorArray&&(n.colorBuffer=t.createVertexBuffer(n.colorArray,(12===n.colorArray.bytesPerElement?k2:sS).members,!1,!0)),n.featureArray&&(n.pbrBuffer=t.createVertexBuffer(n.featureArray,aS.members,!0)),n.segments=Bn.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const a=n.material;a.pbrMetallicRoughness.baseColorTexture&&Cf(a.pbrMetallicRoughness.baseColorTexture,t),a.pbrMetallicRoughness.metallicRoughnessTexture&&Cf(a.pbrMetallicRoughness.metallicRoughnessTexture,t),a.normalTexture&&Cf(a.normalTexture,t),a.occlusionTexture&&Cf(a.occlusionTexture,t,r),a.emissionTexture&&Cf(a.emissionTexture,t)}function Ky(n,t,r){if(n.meshes)for(const a of n.meshes)gS(a,t,r);if(n.children)for(const a of n.children)Ky(a,t,r)}function Um(n){if(n.meshes)for(const t of n.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(n.children)for(const t of n.children)Um(t)}function Hm(n){if(n.meshes)for(const r of n.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(n.children)for(const r of n.children)Hm(r)}class $m{constructor(t,r){this.feature=t,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Lc{constructor(){this.instancedDataArray=new QE,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class _S{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,r,a,l){this.tileToMeter=Cd(a);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:h,index:p,sourceLayerIndex:m}of t){const _=yu(d,u);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),_,a))continue;const y={id:h,sourceLayerIndex:m,index:p,geometry:u?_.geometry:jl(d,a,l),properties:d.properties,type:d.type,patterns:{}},x=this.addFeature(y,y.geometry,_);x&&r.featureIndex.insert(d,y.geometry,p,m,this.index,this.instancesPerModel[x].instancedDataArray.length)}this.lookup=null}update(t,r,a,l){for(const u in this.instancesPerModel){const d=this.instancesPerModel[u];for(const h in t)d.idToFeaturesIndex.hasOwnProperty(h)&&this.evaluate(d.features[d.idToFeaturesIndex[h]],t[h],d,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];for(const l of a.features){const u=this.layers[0],d=l.feature,h=this.canonical,p=u.paint.get("model-rotation").evaluate(d,{},h),m=u.paint.get("model-scale").evaluate(d,{},h),_=u.paint.get("model-translation").evaluate(d,{},h);q.exactEquals(l.rotation,p)&&q.exactEquals(l.scale,m)&&q.exactEquals(l.translation,_)||(this.evaluate(l,l.featureStates,a,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];a.instancedDataArray.length<0||0===a.instancedDataArray.length||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=t.createVertexBuffer(a.instancedDataArray,Ji.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];0!==r.instancedDataArray.length&&r.instancedDataBuffer&&r.instancedDataBuffer.destroy()}}addFeature(t,r,a){const l=this.layers[0],u=l.layout.get("model-id").evaluate(a,{},this.canonical);if(!u)return tt(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new Lc);const d=this.instancesPerModel[u],h=d.instancedDataArray,p=new $m(a,h.length);for(const m of r)for(const _ of m){if(_.x<0||_.x>=dt||_.y<0||_.y>=dt)continue;const y=(this.lookupDim-1)/dt,x=this.lookupDim*(_.y*y|0)+_.x*y|0;if(this.lookup){if(0!==this.lookup[x])continue;this.lookup[x]=1}this.instanceCount++;const b=h.length;h.resize(b+1),d.instancesEvaluatedElevation.push(0),h.float32[16*b]=_.x,h.float32[16*b+1]=_.y}return p.instancedDataCount=d.instancedDataArray.length-p.instancedDataOffset,p.instancedDataCount>0&&(t.id&&(d.idToFeaturesIndex[t.id]=d.features.length),d.features.push(p),this.evaluate(p,{},d,!1)),u}evaluate(t,r,a,l){const u=this.layers[0],d=t.feature,h=this.canonical,p=t.rotation=u.paint.get("model-rotation").evaluate(d,r,h),m=t.scale=u.paint.get("model-scale").evaluate(d,r,h),_=t.translation=u.paint.get("model-translation").evaluate(d,r,h),y=u.paint.get("model-color").evaluate(d,r,h);y.a=u.paint.get("model-color-mix-intensity").evaluate(d,r,h);const x=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,m[0]),Math.max(m[1],m[2])),jr(x,p,m);const b=Math.round(100*y.a)+y.b/1.05;for(let E=0;E<t.instancedDataCount;++E){const C=t.instancedDataOffset+E,S=16*C,M=a.instancedDataArray.float32;let D=0;l&&(D=M[S+6]-a.instancesEvaluatedElevation[C]);const R=0|M[S+1];M[S]=(0|M[S])+y.r/1.05,M[S+1]=R+y.g/1.05,M[S+2]=b,M[S+3]=1/(h.z>10?this.tileToMeter:Cd(h,R)),M[S+4]=_[0],M[S+5]=_[1],M[S+6]=_[2]+D,M[S+7]=x[0],M[S+8]=x[1],M[S+9]=x[2],M[S+10]=x[4],M[S+11]=x[5],M[S+12]=x[6],M[S+13]=x[8],M[S+14]=x[9],M[S+15]=x[10],a.instancesEvaluatedElevation[C]=_[2]}}}Xt(_S,"ModelBucket",{omit:["layers"]}),Xt(Lc,"PerModelAttributes"),Xt($m,"ModelFeature");const B2=new Ci({visibility:new Dt(J.layout_model.visibility),"model-id":new se(J.layout_model["model-id"])});var $b={paint:new Ci({"model-opacity":new Dt(J.paint_model["model-opacity"]),"model-rotation":new se(J.paint_model["model-rotation"]),"model-scale":new se(J.paint_model["model-scale"]),"model-translation":new se(J.paint_model["model-translation"]),"model-color":new se(J.paint_model["model-color"]),"model-color-mix-intensity":new se(J.paint_model["model-color-mix-intensity"]),"model-type":new Dt(J.paint_model["model-type"]),"model-cast-shadows":new Dt(J.paint_model["model-cast-shadows"]),"model-receive-shadows":new Dt(J.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Dt(J.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new se(J.paint_model["model-emissive-strength"]),"model-roughness":new se(J.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new se(J.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Dt(J.paint_model["model-cutoff-fade-range"])}),layout:B2};const Nc=new Float32Array(262144),zc=new Uint8Array(262144);function yS(n){let t=0;if(n.meshes)for(const r of n.meshes)t=Math.max(t,r.aabb.max[2]);if(n.children)for(const r of n.children)t=Math.max(t,yS(r));return t}const Jy=["","wall","door","roof","window","lamp","logo"];class V2{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:yS(t)}}}}class j2{constructor(t,r,a,l){this.nodes=t,this.id=r,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const a of r){const l=a.node;this.uploaded?this.updatePbrBuffer(l):Ky(l,t,!0)}for(const a of r)Um(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let r=!1;if(!t.meshes)return r;for(const a of t.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),r=!0);return r}needsReEvaluation(t,r,a){const l=t.transform.projectionOptions,u=t.style.getBrightness(),d=this.brightness!==u;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||Gm(a.paint.get("model-color").value,d)||Gm(a.paint.get("model-color-mix-intensity").value,d)||Gm(a.paint.get("model-roughness").value,d)||Gm(a.paint.get("model-emissive-strength").value,d)||Gm(a.paint.get("model-height-based-emissive-strength-multiplier").value,d))&&(this.projection=l,this.brightness=u,!0)}evaluateScale(t,r){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const a=this.getNodesInfo(),l=this.id.canonical;for(const u of a){const d=u.feature;u.evaluatedScale=r.paint.get("model-scale").evaluate(d,{},l)}}evaluate(t){const r=this.getNodesInfo();for(const a of r){if(!a.node.meshes)continue;const l=a.feature,u=a.node.meshes&&a.node.meshes[0].featureData,d=a.evaluatedColor[2],h=a.evaluatedRMEA[2],p=this.id.canonical;if(a.hasTranslucentParts=!1,u){for(let m=0;m<Jy.length;m++){const _=Jy[m];_.length&&(l.properties.part=_);const y=t.paint.get("model-color").evaluate(l,{},p),x=t.paint.get("model-color-mix-intensity").evaluate(l,{},p);a.evaluatedColor[m]=[y.r,y.g,y.b,x],a.evaluatedRMEA[m][0]=t.paint.get("model-roughness").evaluate(l,{},p),a.evaluatedRMEA[m][2]=t.paint.get("model-emissive-strength").evaluate(l,{},p),a.evaluatedRMEA[m][3]=y.a,a.emissionHeightBasedParams[m]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},p),!a.hasTranslucentParts&&y.a<1&&(a.hasTranslucentParts=!0)}delete l.properties.part,vS(a,d!==a.evaluatedColor[2]||h!==a.evaluatedRMEA[2])}a.evaluatedScale=t.paint.get("model-scale").evaluate(l,{},p),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,r,a,l){const u=t.findDEMTileFor(a);if(u&&(u.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const d=Ka.create(t,a,u);if(!d)return;4&this.modelTraits&&this.updateDEM(t,d,a,l);for(const h of this.getNodesInfo()){const p=h.node;if(!p.footprint||!p.footprint.vertices||!p.footprint.vertices.length)continue;const m=p.footprint.vertices;let _=d.getElevationAt(m[0].x,m[0].y,!0,!0);for(let y=1;y<m.length;y++)_=Math.min(_,d.getElevationAt(m[y].x,m[y].y,!0,!0));p.elevation=_}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=r}}updateDEM(t,r,a,l){let u=r._dem._modifiedForSources[l];if(void 0===u&&(r._dem._modifiedForSources[l]=[],u=r._dem._modifiedForSources[l]),u.includes(a.canonical))return;const d=r._dem.dim;u.push(a.canonical);let h=!1;for(const p of this.getNodesInfo()){const m=p.node;if(!m.footprint||!m.footprint.grid)continue;const _=m.footprint.grid,y=r.tileCoordToPixel(_.min.x,_.min.y),x=r.tileCoordToPixel(_.max.x,_.max.y),b=Math.min(Math.min(d-x.y,y.x),Math.min(y.y,d-x.x));if(b<0)continue;const E=Jt(b,2,5);let C=Math.max(0,y.x-E),S=Math.max(0,y.y-E),M=Math.min(x.x+E,d-1),D=Math.min(x.y+E,d-1);for(let O=S;O<=D;++O)for(let F=C;F<=M;++F)zc[O*d+F]=255;let R=0,P=0;for(let O=0;O<_.cellsY;++O)for(let F=0;F<_.cellsX;++F){if(!_.cells[O*_.cellsX+F])continue;const L=r.tileCoordToPixel(_.min.x+F/_.xScale,_.min.y+O/_.yScale),N=r.tileCoordToPixel(_.min.x+(F+1)/_.xScale,_.min.y+(O+1)/_.yScale);for(let z=L.y;z<=Math.min(N.y+1,d-1);++z)for(let U=L.x;U<=Math.min(N.x+1,d-1);++U)255===zc[z*d+U]&&(zc[z*d+U]=0,R+=r.getElevationAtPixel(U,z),P++)}const I=R/P;C=Math.max(1,y.x-E),S=Math.max(1,y.y-E),M=Math.min(x.x+E,d-2),D=Math.min(x.y+E,d-2),h=!0;for(let O=S;O<=D;++O)for(let F=C;F<=M;++F)0===zc[O*d+F]&&(Nc[O*d+F]=r._dem.set(F,O,I));for(let O=1;O<E;++O){C=Math.max(1,y.x-O),S=Math.max(1,y.y-O),M=Math.min(x.x+O,d-2),D=Math.min(x.y+O,d-2);for(let F=S;F<=D;++F)for(let L=C;L<=M;++L){const N=F*d+L;if(255===zc[N]){let z=0,U=0,V=-1,G=-1;for(let j=-1;j<=1;++j)for(let Z=-1;Z<=1;++Z){const et=(F+j)*d+L+Z;if(zc[et]>=O)continue;const it=Nc[et],X=Math.abs(it);X>U&&(z=it,U=X,V=Z,G=j)}if(U>.1){const j=1-(O+.5*Math.abs(V*G))/E;let Z=r._dem.get(L,F)+z*j;const et=r._dem.get(L+V,F+G),it=r._dem.get(L-V,F-G,!0);(Z-et)*(Z-it)>0&&(Z=(et+it)/2),Nc[N]=r._dem.set(L,F,Z),zc[N]=O}}}}}h&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=kt.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new V2(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)Hm(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const r of t)Um(r.node),Hm(r.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(t.toUnwrapped()),l=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){const d=l[u].node;l[u].hiddenByReplacement=!!d.footprint&&!a.find(h=>h.footprint===d.footprint)}}getHeightAtTileCoord(t,r){const a=this.getNodesInfo(),l=[];for(let u=0;u<this.nodesInfo.length;u++){const d=a[u],h=d.node.meshes[0];if(t<h.aabb.min[0]||r<h.aabb.min[1]||t>h.aabb.max[0]||r>h.aabb.max[1])continue;const p=(t-h.aabb.min[0])/(h.aabb.max[0]-h.aabb.min[0])*64|0,m=64*Math.min(63,(r-h.aabb.min[1])/(h.aabb.max[1]-h.aabb.min[1])*64|0)+Math.min(63,p);if(!(h.heightmap[m]<0&&d.node.footprint))return d.hiddenByReplacement?void 0:{height:h.heightmap[m],maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};if(d.node.footprint.grid.query(new nt(t,r),new nt(t,r),l),l.length>0)return{height:void 0,maxHeight:d.feature.properties.height,hidden:d.hiddenByReplacement,verticalScale:d.evaluatedScale[2]}}}}function Gm(n,t){return!n.isLightConstant&&t}function U2(n,t,r,a,l,u,d,h){let p=(61440&t|(61440&t)>>4)>>8,m=(3840&t|(3840&t)>>4)>>4,_=240&t|(240&t)>>4;r[3]>0&&(p=_e(p,255*r[0],r[3]),m=_e(m,255*r[1],r[3]),_=_e(_,255*r[2],r[3]));const y=p<<8|m,x=_<<8|Math.floor(255*a[3]),b=function(O){const F=Jt(O,0,2);return Math.min(Math.round(.5*F*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],E=Jt(l[0],0,1),C=Jt(l[1],0,1),S=Jt(l[2],0,1),M=Jt(l[3],0,1);let D,R,P,I;if(E!==C&&d!==u&&C!==E){const O=d-u;R=1/(O*(C-E)),P=-(u+O*E)/(O*(C-E));const F=Jt(l[4],-1,1);I=Math.pow(10,F),D=255*S<<8|255*M}else D=65535,R=0,P=1,I=1;if(n.emplaceBack(y,x,b,D,R,P,I),h){const O=h.length;h.clear();for(let F=0;F<O;F++)h.emplaceBack(y,x,b,D,R,P,I)}}function vS(n,t){const r=n.node;let a=0;for(const l of r.meshes){if(r.lights&&r.lightMeshIndex===a||!l.featureData)continue;l.featureArray=new N_,l.featureArray.reserve(l.featureData.length);let u=t;for(const d of l.featureData){let h;const p=65535&d,m=(15&p)<8?15&p:0,_=d>>16&65535,y=n.evaluatedRMEA[m],x=n.evaluatedColor[m],b=n.emissionHeightBasedParams[m];if(u&&2===m&&r.lights&&(h=new N_,h.resize(10*r.lights.length)),U2(l.featureArray,_,x,y,b,l.aabb.min[2],l.aabb.max[2],h),h&&u){u=!1;const E=r.meshes[r.lightMeshIndex];E.featureArray=h,E.featureArray._trim()}}l.featureArray._trim(),a++}}Xt(j2,"Tiled3dModelBucket",{omit:["layers"]}),Xt(V2,"Tiled3dModelFeature");class H2{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const r=bS(new nt(0,0),new nt(dt,dt),t),a=[];for(const l of this._activeRegions){if(l.hiddenByOverlap||!xS(r,l))continue;const u=wS(l.min,l.max,t);a.push({min:u.min,max:u.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId})}return a}setSources(t){this._setSources(t.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const a=[];for(const l of r.cache.getVisibleCoordinates()){const u=r.cache.getTile(l).buckets[r.layer];if(u)for(const d of u.getNodesInfo()){const h=d.node;h.footprint&&a.push({footprint:h.footprint,id:l.toUnwrapped()})}}return a}})))}_addSource(t){const r=t.getFootprints();if(0!==r.length){for(const a of r){if(!a.footprint)continue;const l=bS(a.footprint.min,a.footprint.max,a.id);this._activeRegions.push({min:l.min,max:l.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:a.id,footprint:a.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((r,a)=>r.priority-a.priority||Dr(r.min,a.min)||Dr(r.max,a.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let r=0,a=0;for(;!t&&r!==this._activeRegions.length;){const l=this._activeRegions[r],u=this._prevRegions[a];t=l.priority!==u.priority||!Gb(l,u),++r,++a}}if(t){++this._updateTime;const r=a=>{const l=this._activeRegions;if(a>=l.length)return a;const u=l[a].priority;for(;a<l.length&&l[a].priority===u;)++a;return a};if(this._sourceIds.length>1){let a=0,l=r(a);for(;a!==l;){let u=a;const d=a;for(;u!==l;){const h=this._activeRegions[u];h.hiddenByOverlap=!1;for(let p=0;p<d;p++){const m=this._activeRegions[p];if(!m.hiddenByOverlap&&xS(h,m)&&(h.hiddenByOverlap=qb(h.footprint,h.tileId,m.footprint,m.tileId),h.hiddenByOverlap))break}++u}a=l,l=r(a)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=t.length-1;r>=0;r--)this._addSource(t[r]);this._computeReplacement()}}function Dr(n,t){return n.x-t.x||n.y-t.y}function Gb(n,t){return 0===Dr(n.min,t.min)&&0===Dr(n.max,t.max)}function xS(n,t){return!(n.min.x>t.max.x||n.max.x<t.min.x||n.min.y>t.max.y||n.max.y<t.min.y)}function bS(n,t,r){const a=1/dt,l=1/(1<<r.canonical.z),u=(t.x*a+r.canonical.x)*l+r.wrap,d=(t.y*a+r.canonical.y)*l;return{min:new nt((n.x*a+r.canonical.x)*l+r.wrap,(n.y*a+r.canonical.y)*l),max:new nt(u,d)}}function wS(n,t,r){const a=1<<r.canonical.z,l=((t.x-r.wrap)*a-r.canonical.x)*dt,u=(t.y*a-r.canonical.y)*dt;return{min:new nt(((n.x-r.wrap)*a-r.canonical.x)*dt,(n.y*a-r.canonical.y)*dt),max:new nt(l,u)}}function ES(n,t,r,a,l,u,d){const h=n.indices,p=n.vertices,m=[];for(let _=a;_<a+l;_+=3){const y=t[r[_+0]+u],x=t[r[_+1]+u],b=t[r[_+2]+u],E=Math.min(y.x,x.x,b.x),C=Math.max(y.x,x.x,b.x),S=Math.min(y.y,x.y,b.y),M=Math.max(y.y,x.y,b.y);m.length=0,n.grid.query(new nt(E,S),new nt(C,M),m);for(let D=0;D<m.length;D++){const R=m[D];if(rm(p[h[3*R+0]],p[h[3*R+1]],p[h[3*R+2]],y,x,b,d))return!0}}return!1}function qb(n,t,r,a){if(!n||!r)return!1;let l=n.vertices;if(!t.canonical.equals(a.canonical)||t.wrap!==a.wrap){if(r.vertices.length<n.vertices.length)return qb(r,a,n,t);const u=t.canonical,d=a.canonical,h=Math.pow(2,d.z-u.z);l=n.vertices.map(p=>new nt(p.x*u.x*dt*h-d.x*dt,p.y*u.y*dt*h-d.y*dt))}return ES(r,l,n.indices,0,n.indices.length,0,0)}const CS=_m.types,Mf=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],$2=["fill-extrusion-flood-light-ground-radius"],G2=Math.pow(2,13),MS=Math.pow(2,15)-1,SS=new nt(0,1),nl=2147483648;function Qy(n,t,r,a,l,u,d,h){n.emplaceBack((t<<1)+d,(r<<1)+u,(Math.floor(a*G2)<<1)+l,Math.round(h))}function qm(n,t,r,a,l,u){n.emplaceBack(t.x,t.y,(r.x<<1)+a,(r.y<<1)+l,u)}function Ir(n,t,r){n.emplaceBack(t.x,t.y,t.z,16384*r[0],16384*r[1],16384*r[2])}class il{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class TS{constructor(){this.centroidXY=new nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class DS{constructor(){this.acc=new nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,r){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=r.x,t.min.y=t.max.y=r.y)}appendEdge(t,r,a){this.accCount++,this.acc._add(r);let l=!!this.borders;r.x<t.min.x?(t.min.x=r.x,l=!0):r.x>t.max.x&&(t.max.x=r.x,l=!0),r.y<t.min.y?(t.min.y=r.y,l=!0):r.y>t.max.y&&(t.max.y=r.y,l=!0),((0===r.x||r.x===dt)&&r.x===a.x)!=((0===r.y||r.y===dt)&&r.y===a.y)&&this.processBorderOverlap(r,a),l&&this.checkBorderIntersection(r,a)}checkBorderIntersection(t,r){r.x<0!=t.x<0&&this.addBorderIntersection(0,_e(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>dt!=t.x>dt&&this.addBorderIntersection(1,_e(r.y,t.y,(dt-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,_e(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>dt!=t.y>dt&&this.addBorderIntersection(3,_e(r.x,t.x,(dt-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[t];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const a=0===t.x?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,t.y)}else{const a=0===t.y?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,t.x)}}centroid(){return 0===this.accCount?new nt(0,0):new nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0):0}}function rl(n,t){const r=n.add(t)._unit(),a=Jt(n.x*r.x+n.y*r.y,-1,1);var l,u,d;return l=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(l)))/4*MS*((u=n).x*(d=t).y-u.y*d.x<0?-1:1)}const ol=[n=>n.x<0,n=>n.x>dt,n=>n.y<0,n=>n.y>dt];function sl(n,t,r,a){const l=[4];if(0===a)return l;r._mult(a);const u=n.sub(r),d=t.sub(r),h=[n,t,u,d];for(let p=0;p<4;p++)for(const m of h)if(ol[p](m)){l.push(p);break}return l}class Wb{constructor(t){this.vertexArray=new Ro,this.indexArray=new er,this.programConfigurations=new pd(t.layers,t.zoom,r=>$2.includes(r)),this._segments=new Bn,this.hiddenByLandmarkVertexArray=new Q0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Bn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,r,a,l=!1){const u=t.length;if(u>2){let d=Math.max(0,this._segments.get().length-1);const h=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let p;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const m=t[0],_=t[1];p=rl(m.sub(t[u-1])._perp()._unit(),_.sub(m)._perp()._unit())}for(let m=0;m<u;m++){const _=m===u-1?0:m+1,y=t[m],x=t[_],b=t[_===u-1?0:_+1],E=x.sub(y)._perp()._unit(),C=rl(E,b.sub(x)._perp()._unit()),S=p,M=C;if(Zb(y,x,r)||l&&tv(y,r)&&tv(x,r)){p=C;continue}const D=h.vertexLength;qm(this.vertexArray,y,x,1,1,S),qm(this.vertexArray,y,x,1,0,S),qm(this.vertexArray,y,x,0,1,M),qm(this.vertexArray,y,x,0,0,M),h.vertexLength+=4;const R=sl(y,x,E,a);for(const P of R)this._segmentToGroundQuads[d].push({id:D,region:P}),this._segmentToRegionTriCounts[d][P]+=2,h.primitiveLength+=2;p=C}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),r=t.length;for(let a=0;a<r;a++)this._segmentToGroundQuads[a].sort((l,u)=>l.region-u.region);for(let a=0;a<r;a++){const l=this._segmentToGroundQuads[a],u=t[a],d=this._segmentToRegionTriCounts[a];d.reduce((p,m)=>p+m,0);let h=0;for(let p=0;p<=4;p++){const m=d[p];if(0!==m){let _=this.regionSegments[p];_||(_=this.regionSegments[p]=new Bn);const y={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+h,vertexLength:u.vertexLength,primitiveLength:m};_.get().push(y)}h+=m}for(let p=0;p<l.length;p++){const m=l[p].id;this.indexArray.emplaceBack(m,m+1,m+3),this.indexArray.emplaceBack(m,m+3,m+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,r,a,l,u,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,r,a,l,u,d)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ZA.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,r,a,l,u,d){this.hasData()&&this.programConfigurations.updatePaintArrays(t,r,a,l,u,d)}updateHiddenByLandmark(t){if(!this.hasData())return;const r=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const a=t.flags&nl?1:0;for(let l=t.groundVertexArrayOffset;l<r;++l)this.hiddenByLandmarkVertexArray.emplace(l,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,OF.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const r=this.regionSegments[t];r&&r.destroy()}}}}class Sf{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new er,this.footprintVertices=new Zo,this.footprintSegments=[],this.layoutVertexArray=new cd,this.centroidVertexArray=new ex,this.indexArray=new er,this.programConfigurations=new pd(t.layers,t.zoom,r=>Mf.includes(r)),this.segments=new Bn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new Wb(t),this.maxHeight=0,this.partLookup={}}populate(t,r,a,l){this.features=[],this.hasPattern=ib("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Cd(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:d,index:h,sourceLayerIndex:p}of t){const m=this.layers[0]._featureFilter.needGeometry,_=yu(u,m);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),_,a))continue;const y={id:d,sourceLayerIndex:p,index:h,geometry:m?_.geometry:jl(u,a,l),properties:u.properties,type:u.type,patterns:{}},x=this.layoutVertexArray.length;this.hasPattern?this.features.push(fy("fill-extrusion",this.layers,y,this.zoom,r)):this.addFeature(y,y.geometry,h,a,{},r.availableImages,l,r.brightness),r.featureIndex.insert(u,y.geometry,h,p,this.index,x)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(t,r,a,l,u,d){for(const h of this.features){const{geometry:p}=h;this.addFeature(h,p,h.index,r,a,l,u,d)}this.sortBorders()}update(t,r,a,l,u){const d=0!==Object.keys(t).length;if(d&&!this.stateDependentLayers.length)return;const h=d?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,r,h,a,l,u),this.groundEffect.update(t,r,h,a,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,XA.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,dM.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,a,l,u,d,h,p){const m=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,_=[new nt(0,0),new nt(dt,dt)],y=h.projection,x="globe"===y.name,b="Polygon"===CS[t.type],E=new DS;E.centroidDataIndex=this.centroidData.length;const C=new TS,S=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},l)<=0,M=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},l);C.height=M,C.vertexArrayOffset=this.layoutVertexArray.length,C.groundVertexArrayOffset=this.groundEffect.vertexArray.length,x&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Fp);const D=Kh(r,500);for(let L=D.length-1;L>=0;L--){const N=D[L];(0===N.length||(R=N[0]).every(z=>z.x<=0)||R.every(z=>z.x>=dt)||R.every(z=>z.y<=0)||R.every(z=>z.y>=dt))&&D.splice(L,1)}var R;let P;if(x)P=PS(D,_,l);else{P=[];for(const L of D)P.push({polygon:L,bounds:_})}const I=b?this.edgeRadius:0,O=I>0&&this.zoom<17,F=(L,N)=>{if(0===L.length)return!1;const z=L[L.length-1];return N.x===z.x&&N.y===z.y};for(const{polygon:L,bounds:N}of P){let z=0,U=0;for(const j of L)b&&!j[0].equals(j[j.length-1])&&j.push(j[0]),U+=b?j.length-1:j.length;const V=this.segments.prepareSegment((b?5:4)*U,this.layoutVertexArray,this.indexArray);C.footprintSegIdx<0&&(C.footprintSegIdx=this.footprintSegments.length);const G=new il;if(G.vertexOffset=this.footprintVertices.length,G.indexOffset=3*this.footprintIndices.length,G.ringIndices=[],b){const j=[],Z=[];z=V.vertexLength;for(let it=0;it<L.length;it++){const X=L[it];X.length&&0!==it&&Z.push(j.length/2);const Y=[];let ot,lt;ot=X[1].sub(X[0])._perp()._unit(),G.ringIndices.push(X.length-1);for(let ht=1;ht<X.length;ht++){const mt=X[ht],vt=X[ht===X.length-1?1:ht+1],ct=mt.clone();if(I){lt=vt.sub(mt)._perp()._unit();const ft=ot.add(lt)._unit(),Rt=I*Math.min(4,1/(ot.x*ft.x+ot.y*ft.y));ct.x+=Rt*ft.x,ct.y+=Rt*ft.y,ct.x=Math.round(ct.x),ct.y=Math.round(ct.y),ot=lt}!S||0!==I&&!O||F(Y,ct)||Y.push(ct),Qy(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),V.vertexLength++,this.footprintVertices.emplaceBack(mt.x,mt.y),j.push(mt.x,mt.y),x&&Ir(this.layoutVertexExtArray,y.projectTilePoint(ct.x,ct.y,l),y.upVector(l,ct.x,ct.y))}S&&(0===I||O)&&(0!==Y.length&&F(Y,Y[0])&&Y.pop(),this.groundEffect.addData(Y,N,m))}const et=hy(j,Z);for(let it=0;it<et.length;it+=3)this.footprintIndices.emplaceBack(G.vertexOffset+et[it+0],G.vertexOffset+et[it+1],G.vertexOffset+et[it+2]),this.indexArray.emplaceBack(z+et[it],z+et[it+2],z+et[it+1]),V.primitiveLength++;G.indexCount+=et.length,G.vertexCount+=this.footprintVertices.length-G.vertexOffset}for(let j=0;j<L.length;j++){const Z=L[j];E.startRing(C,Z[0]);let et=Z.length>4&&Tf(Z[Z.length-2],Z[0],Z[1]),it=I?q2(Z[Z.length-2],Z[0],Z[1],I):0;const X=[];let Y,ot,lt;ot=Z[1].sub(Z[0])._perp()._unit();let ht=!0;for(let mt=1,vt=0;mt<Z.length;mt++){let ct=Z[mt-1],ft=Z[mt];const Rt=Z[mt===Z.length-1?1:mt+1];if(E.appendEdge(C,ft,ct),Zb(ft,ct,N)){I&&(ot=Rt.sub(ft)._perp()._unit(),ht=!ht);continue}const Vt=ft.sub(ct)._perp(),jt=Vt.x/(Math.abs(Vt.x)+Math.abs(Vt.y)),Ht=Vt.y>0?1:0,re=ct.dist(ft);if(vt+re>32768&&(vt=0),I){lt=Rt.sub(ft)._perp()._unit();let Re=AS(ct,ft,Rt,IS(ot,lt),I);isNaN(Re)&&(Re=0);const Me=ft.sub(ct)._unit();ct=ct.add(Me.mult(it))._round(),ft=ft.add(Me.mult(-Re))._round(),it=Re,ot=lt,S&&this.zoom>=17&&(F(X,ct)||X.push(ct),F(X,ft)||X.push(ft))}const ye=V.vertexLength,je=Z.length>4&&Tf(ct,ft,Rt);let rn=RS(vt,et,ht);if(Qy(this.layoutVertexArray,ct.x,ct.y,jt,Ht,0,0,rn),Qy(this.layoutVertexArray,ct.x,ct.y,jt,Ht,0,1,rn),vt+=re,rn=RS(vt,je,!ht),et=je,Qy(this.layoutVertexArray,ft.x,ft.y,jt,Ht,0,0,rn),Qy(this.layoutVertexArray,ft.x,ft.y,jt,Ht,0,1,rn),V.vertexLength+=4,this.indexArray.emplaceBack(ye+0,ye+1,ye+2),this.indexArray.emplaceBack(ye+1,ye+3,ye+2),V.primitiveLength+=2,I){const Re=z+(1===mt?Z.length-2:mt-2),Me=1===mt?z:Re+1;if(this.indexArray.emplaceBack(ye+1,Re,ye+3),this.indexArray.emplaceBack(Re,Me,ye+3),V.primitiveLength+=2,void 0===Y&&(Y=ye),!Zb(Rt,Z[mt],N)){const ge=mt===Z.length-1?Y:V.vertexLength;this.indexArray.emplaceBack(ye+2,ye+3,ge),this.indexArray.emplaceBack(ye+3,ge+1,ge),this.indexArray.emplaceBack(ye+3,Me,ge+1),V.primitiveLength+=3}ht=!ht}if(x){const Re=this.layoutVertexExtArray,Me=y.projectTilePoint(ct.x,ct.y,l),ge=y.projectTilePoint(ft.x,ft.y,l),ue=y.upVector(l,ct.x,ct.y),Le=y.upVector(l,ft.x,ft.y);Ir(Re,Me,ue),Ir(Re,Me,ue),Ir(Re,ge,Le),Ir(Re,ge,Le)}}b&&(z+=Z.length-1),S&&I&&this.zoom>=17&&(0!==X.length&&F(X,X[0])&&X.pop(),this.groundEffect.addData(X,N,m,I>0))}this.footprintSegments.push(G),++C.footprintSegLen}if(C.vertexCount=this.layoutVertexArray.length-C.vertexArrayOffset,C.groundVertexCount=this.groundEffect.vertexArray.length-C.groundVertexArrayOffset,0!==C.vertexCount){if(C.centroidXY=E.borders?SS:this.encodeCentroid(E,C),this.centroidData.push(C),E.borders){this.featuresOnBorder.push(E);const L=this.featuresOnBorder.length-1;for(let N=0;N<E.borders.length;N++)E.borders[N][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[N].push(L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,d,l,p),this.groundEffect.addPaintPropertiesData(t,a,u,d,l,p),this.maxHeight=Math.max(this.maxHeight,M)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((r,a)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[a].borders[t][0])}encodeCentroid(t,r){const a=t.centroid(),l=r.span(),u=Math.min(7,Math.round(l.x*this.tileToMeter/10)),d=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new nt(Jt(a.x,1,dt-1)<<3|u,Jt(a.y,1,dt-1)<<3|d)}showCentroid(t){const r=this.centroidData[t.centroidDataIndex];r.flags&=nl,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const r=t.vertexArrayOffset,a=t.vertexCount+t.vertexArrayOffset,l=t.flags&nl?SS:t.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==l.y||u!==l.x){for(let d=r;d<a;++d)this.centroidVertexArray.emplace(d,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(t.toUnwrapped());if(function(u,d){if(u.length!==d.length)return!1;for(let h=0;h<u.length;h++)if(u[h].sourceId!==d[h].sourceId||!Gb(u[h],d[h]))return!1;return!0}(this.activeReplacements,a))return;if(this.activeReplacements=a,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const u of this.centroidData)u.flags&=2147483647;const l=[];for(const u of this.activeReplacements){const d=Math.pow(2,u.footprintTileId.canonical.z-t.canonical.z);for(const h of this.centroidData)if(!(h.flags&nl||u.min.x>h.max.x||h.min.x>u.max.x||u.min.y>h.max.y||h.min.y>u.max.y))for(let p=0;p<h.footprintSegLen;p++){const m=this.footprintSegments[h.footprintSegIdx+p];if(l.length=0,W2(this.footprintVertices,m.vertexOffset,m.vertexCount,u.footprintTileId.canonical,t.canonical,l),ES(u.footprint,l,this.footprintIndices.uint16,m.indexOffset,m.indexCount,-m.vertexOffset,-d)){h.flags|=nl;break}}}for(const u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,r,a){let l=!1;for(let u=0;u<a.footprintSegLen;u++){const d=this.footprintSegments[a.footprintSegIdx+u];let h=0;for(const p of d.ringIndices){for(let m=h,_=p+h-1;m<p+h;_=m++){const y=this.footprintVertices.int16[2*(m+d.vertexOffset)+0],x=this.footprintVertices.int16[2*(m+d.vertexOffset)+1],b=this.footprintVertices.int16[2*(_+d.vertexOffset)+1];x>r!=b>r&&t<(this.footprintVertices.int16[2*(_+d.vertexOffset)+0]-y)*(r-x)/(b-x)+y&&(l=!l)}h=p}}return l}getHeightAtTileCoord(t,r){let a=Number.NEGATIVE_INFINITY,l=!0;const u=4*(t+dt)*dt+(r+dt);if(this.partLookup.hasOwnProperty(u)){const d=this.partLookup[u];return d?{height:d.height,hidden:!!(d.flags&nl)}:void 0}for(const d of this.centroidData)t>d.max.x||d.min.x>t||r>d.max.y||d.min.y>r||this.footprintContainsPoint(t,r,d)&&d&&d.height>a&&(a=d.height,this.partLookup[u]=d,l=!!(d.flags&nl));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:l};this.partLookup[u]=void 0}}function IS(n,t){const r=n.add(t)._unit();return n.x*r.x+n.y*r.y}function q2(n,t,r,a){const l=t.sub(n)._perp()._unit(),u=r.sub(t)._perp()._unit();return AS(n,t,r,IS(l,u),a)}function AS(n,t,r,a,l){const u=Math.sqrt(1-a*a);return Math.min(n.dist(t)/3,t.dist(r)/3,l*u/a)}function Zb(n,t,r){return n.x<r[0].x&&t.x<r[0].x||n.x>r[1].x&&t.x>r[1].x||n.y<r[0].y&&t.y<r[0].y||n.y>r[1].y&&t.y>r[1].y}function tv(n,t){return n.x<t[0].x||n.x>t[1].x||n.y<t[0].y||n.y>t[1].y}function Tf(n,t,r){if(n.x<0||n.x>=dt||t.x<0||t.x>=dt||r.x<0||r.x>=dt)return!1;const a=r.sub(t),l=a.perp(),u=n.sub(t);return(a.x*u.x+a.y*u.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function RS(n,t,r){const a=t?2|n:-3&n;return r?1|a:-2&a}function Xb(){const n=Math.PI/32,t=Math.tan(n),r=wd;return r*Math.sqrt(1+2*t*t)-r}function PS(n,t,r){const a=1<<r.z,l=Ts(r.x/a),u=Ts((r.x+1)/a),d=lr(r.y/a),h=lr((r.y+1)/a);return function(p,m,_,y,x=0,b){const E=[];if(!p.length||!_||!y)return E;const C=(O,F)=>{for(const L of O)E.push({polygon:L,bounds:F})},S=Math.ceil(Math.log2(_)),M=Math.ceil(Math.log2(y)),D=S-M,R=[];for(let O=0;O<Math.abs(D);O++)R.push(D>0?0:1);for(let O=0;O<Math.min(S,M);O++)R.push(0),R.push(1);let P=p;if(P=gy(P,m[0].y-x,m[1].y+x,1),P=gy(P,m[0].x-x,m[1].x+x,0),!P.length)return E;const I=[];for(R.length?I.push({polygons:P,bounds:m,depth:0}):C(P,m);I.length;){const O=I.pop(),F=O.depth,L=R[F],N=O.bounds[0],z=O.bounds[1],U=0===L?N.x:N.y,V=0===L?z.x:z.y,G=b?b(L,U,V):.5*(U+V),j=gy(O.polygons,U-x,G+x,L),Z=gy(O.polygons,G-x,V+x,L);if(j.length){const et=[N,new nt(0===L?G:z.x,1===L?G:z.y)];R.length>F+1?I.push({polygons:j,bounds:et,depth:F+1}):C(j,et)}if(Z.length){const et=[new nt(0===L?G:N.x,1===L?G:N.y),z];R.length>F+1?I.push({polygons:Z,bounds:et,depth:F+1}):C(Z,et)}}return E}(n,t,Math.ceil((u-l)/11.25),Math.ceil((d-h)/11.25),1,(p,m,_)=>{if(0===p)return.5*(m+_);{const y=lr((r.y+m/dt)/a);return(mo(.5*(lr((r.y+_/dt)/a)+y))*a-r.y)*dt}})}function W2(n,t,r,a,l,u){const d=Math.pow(2,a.z-l.z);for(let h=0;h<r;h++){let p=n.int16[2*(h+t)+0],m=n.int16[2*(h+t)+1];p=(p+l.x*dt)*d-a.x*dt,m=(m+l.y*dt)*d-a.y*dt,u.push(new nt(p,m))}}Xt(Sf,"FillExtrusionBucket",{omit:["layers","features"]}),Xt(TS,"PartData"),Xt(il,"FootprintSegment"),Xt(DS,"BorderCentroidData"),Xt(Wb,"GroundEffect");const OS=new Ci({visibility:new Dt(J["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Dt(J["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var kS={paint:new Ci({"fill-extrusion-opacity":new Dt(J["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new se(J["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dt(J["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dt(J["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new se(J["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new se(J["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new se(J["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Dt(J["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Dt(J["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Dt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Dt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new se(J["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new se(J["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Dt(J["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Dt(J["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Dt(J["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Dt(J["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:OS};class Bc extends nt{constructor(t,r,a){super(t,r),this.z=a}}function Wm(n,t){return n.x*t.x+n.y*t.y}function Yb(n,t){if(1===n.length){let r=0;const a=t[r++];let l;for(;!l||a.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const u=t[r],d=n[0],h=l.sub(a),p=u.sub(a),m=d.sub(a),_=Wm(h,h),y=Wm(h,p),x=Wm(p,p),b=Wm(m,h),E=Wm(m,p),C=_*x-y*y,S=(x*b-y*E)/C,M=(_*E-y*b)/C,D=a.z*(1-S-M)+l.z*S+u.z*M;if(isFinite(D))return D}return 1/0}{let r=1/0;for(const a of t)r=Math.min(r,a.z);return r}}function us(n,t,r,a,l,u,d,h){const p=d*l.getElevationAt(n,t,!0,!0),m=0!==u[0],_=m?0===u[1]?d*(u[0]/7-450):d*function(y,x,b){const E=Math.floor(x[0]/8),C=Math.floor(x[1]/8),S=10*(x[0]-8*E),M=10*(x[1]-8*C),D=y.getElevationAt(E,C,!0,!0),R=y.getMeterToDEM(b),P=Math.floor(.5*(S*R-1)),I=Math.floor(.5*(M*R-1)),O=y.tileCoordToPixel(E,C),F=2*P+1,L=2*I+1,N=(X=F,Y=L,[(Z=y).getElevationAtPixel(et=O.x-P,it=O.y-I,!0),Z.getElevationAtPixel(et+Y,it,!0),Z.getElevationAtPixel(et,it+Y,!0),Z.getElevationAtPixel(et+X,it+Y,!0)]),z=Math.abs(N[0]-N[1]),U=Math.abs(N[2]-N[3]),V=Math.abs(N[0]-N[2])+Math.abs(N[1]-N[3]),G=Math.min(.25,.5*R*(z+U)/F),j=Math.min(.25,.5*R*V/L);var Z,et,it,X,Y;return D+Math.max(G*S,j*M)}(l,u,h):p;return{base:p+(0===r)?-1:r,top:m?Math.max(_+a,p+r+2):p+a}}const FS=new Ci({"line-cap":new se(J.layout_line["line-cap"]),"line-join":new se(J.layout_line["line-join"]),"line-miter-limit":new Dt(J.layout_line["line-miter-limit"]),"line-round-limit":new Dt(J.layout_line["line-round-limit"]),"line-sort-key":new se(J.layout_line["line-sort-key"]),visibility:new Dt(J.layout_line.visibility)});var LS={paint:new Ci({"line-opacity":new se(J.paint_line["line-opacity"]),"line-color":new se(J.paint_line["line-color"]),"line-translate":new Dt(J.paint_line["line-translate"]),"line-translate-anchor":new Dt(J.paint_line["line-translate-anchor"]),"line-width":new se(J.paint_line["line-width"]),"line-gap-width":new se(J.paint_line["line-gap-width"]),"line-offset":new se(J.paint_line["line-offset"]),"line-blur":new se(J.paint_line["line-blur"]),"line-dasharray":new se(J.paint_line["line-dasharray"]),"line-pattern":new se(J.paint_line["line-pattern"]),"line-gradient":new Op(J.paint_line["line-gradient"]),"line-trim-offset":new Dt(J.paint_line["line-trim-offset"]),"line-emissive-strength":new Dt(J.paint_line["line-emissive-strength"]),"line-border-width":new se(J.paint_line["line-border-width"]),"line-border-color":new se(J.paint_line["line-border-color"])}),layout:FS};const Z2=(n,t,r,a,l,u,d)=>{const h=n.transform,p=h.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Kb(n,t,r,a),u_pixels_to_tile_units:p,u_device_pixel_ratio:u,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:Qb(r)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Xm(t,n.transform),u_alpha_discard_threshold:0,u_trim_offset:d,u_emissive_strength:r.paint.get("line-emissive-strength")}},Zm=(n,t,r,a,l)=>{const u=n.transform;return{u_matrix:Kb(n,t,r,a),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:Xm(t,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Xm(n,t){return 1/Pd(n,1,t.tileZoom)}function Kb(n,t,r,a){return n.translatePosMatrix(a||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Jb=n=>{const t=[];Qb(n)&&t.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=n.paint.get("line-trim-offset");return 0===r[0]&&0===r[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==n.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function Qb(n){const t=n.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const t1=new class extends se{possiblyEvaluate(n,t){return t=new Ei(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(n,t)}evaluate(n,t,r,a){return t=Yt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(n,t,r,a)}}(LS.paint.properties["line-width"].specification);function e1(n,t){return t>0?t+2*n:n}t1.useIntegerZoom=!0;const NS=new Ci({visibility:new Dt(J.layout_background.visibility)});var zS={paint:new Ci({"background-color":new Dt(J.paint_background["background-color"]),"background-pattern":new Dt(J.paint_background["background-pattern"]),"background-opacity":new Dt(J.paint_background["background-opacity"]),"background-emissive-strength":new Dt(J.paint_background["background-emissive-strength"])}),layout:NS};const BS=new Ci({visibility:new Dt(J.layout_raster.visibility)});var VS={paint:new Ci({"raster-opacity":new Dt(J.paint_raster["raster-opacity"]),"raster-color":new Op(J.paint_raster["raster-color"]),"raster-color-mix":new Dt(J.paint_raster["raster-color-mix"]),"raster-color-range":new Dt(J.paint_raster["raster-color-range"]),"raster-hue-rotate":new Dt(J.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dt(J.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dt(J.paint_raster["raster-brightness-max"]),"raster-saturation":new Dt(J.paint_raster["raster-saturation"]),"raster-contrast":new Dt(J.paint_raster["raster-contrast"]),"raster-resampling":new Dt(J.paint_raster["raster-resampling"]),"raster-fade-duration":new Dt(J.paint_raster["raster-fade-duration"])}),layout:BS};function jS(n,t,r,a,l,u,d,h){const p=[n,r,l,t,a,u,1,1,1],m=[d,h,1],_=Yo.adjoint([],p),[y,x,b]=q.transformMat3(m,m,Yo.transpose(_,_));return Yo.multiply(p,[y,0,0,0,x,0,0,0,b],p)}class ql extends $i{constructor(t,r,a,l){super(),this.id=t,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=r,this._dirty=!1}load(t,r){if(this._loaded=r||!1,this.fire(new St("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Oe(this.map._requestManager.transformRequest(this.url,gt.Image),(a,l)=>{if(this._imageRequest=null,this._loaded=!0,a)this.fire(new at(a));else if(l){const{HTMLImageElement:u}=st;this.image=l instanceof u?kt.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new jy(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof jy||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=t[0][1],a=t[0][1];for(const u of t)u[1]>a&&(a=u[1]),u[1]<r&&(r=u[1]);const l=(a+r)/2;if(l>Gi?this.onNorthPole=!0:l<-Gi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=t.map(Je.fromLngLat);this.tileID=function(d){let h=1/0,p=1/0,m=-1/0,_=-1/0;for(const E of d)h=Math.min(h,E.x),p=Math.min(p,E.y),m=Math.max(m,E.x),_=Math.max(_,E.y);const y=Math.max(m-h,_-p),x=Math.max(0,Math.floor(-Math.log(y)/Math.LN2)),b=Math.pow(2,x);return new ya(x,Math.floor((h+m)/2*b),Math.floor((p+_)/2*b))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new St("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const p in this.tiles){const m=this.tiles[p];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}if(this._boundsArray)return;const r=Tu(this.tileID,this.map.transform.projection),[a,l,u,d]=this.coordinates.map(p=>{const m=r.projection.project(p[0],p[1]);return $l(r,m)._round()});this.perspectiveTransform=function(p,m,_,y,x,b,E,C,S,M){const D=jS(0,0,p,0,0,m,p,m),R=jS(_,y,x,b,E,C,S,M);return Yo.multiply(R,Yo.adjoint(D,D),R),[R[6]/R[8]*p/dt,R[7]/R[8]*m/dt]}(this.width,this.height,a.x,a.y,l.x,l.y,d.x,d.y,u.x,u.y);const h=this._boundsArray=new cd;h.emplaceBack(a.x,a.y,0,0),h.emplaceBack(l.x,l.y,dt,0),h.emplaceBack(d.x,d.y,0,dt),h.emplaceBack(u.x,u.y,dt,dt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(h,Om.members),this.boundsSegments=Bn.simpleSegment(0,0,4,2)}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const r=this.map.painter.context,a=r.gl;!this._dirty||this.texture instanceof jy||(this.texture?this.texture.update(this.image):(this.texture=new ir(r,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(r)}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class X2 extends Ws{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const Y2=new Ci({visibility:new Dt(J.layout_sky.visibility)});var K2={paint:new Ci({"sky-type":new Dt(J.paint_sky["sky-type"]),"sky-atmosphere-sun":new Dt(J.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Dt(J.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Dt(J.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Dt(J.paint_sky["sky-gradient-radius"]),"sky-gradient":new Op(J.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Dt(J.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Dt(J.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Dt(J.paint_sky["sky-opacity"])}),layout:Y2};function n1(n,t,r){const a=[0,0,1],l=to.identity([]);return to.rotateY(l,l,r?-Ie(n)+Math.PI:Ie(n)),to.rotateX(l,l,-Ie(t)),q.transformQuat(a,a,l),q.normalize(a,a)}var J2={paint:new Ci({})};const Q2={circle:class extends Ws{constructor(n,t){super(n,ay,t)}createBucket(n){return new nM(n)}queryRadius(n){const t=n;return Md("circle-radius",this,t)+Md("circle-stroke-width",this,t)+om(this.paint.get("circle-translate"))}queryIntersectsFeature(n,t,r,a,l,u,d,h){const p=rM(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),m=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Ds(n,a,u,d,h,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),p,m)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,t){const r=sm(this);return{config:new Rh(this,t),defines:r,overrideFog:!1}}},heatmap:class extends Ws{createBucket(n){return new qx(n)}constructor(n,t){super(n,sM,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ya({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Md("heatmap-radius",this,n)}queryIntersectsFeature(n,t,r,a,l,u,d,h){const p=this.paint.get("heatmap-radius").evaluate(t,r);return Ds(n,a,u,d,h,!0,!0,new nt(0,0),p)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,t){return"heatmap"===n?{config:new Rh(this,t),overrideFog:!1}:{}}},hillshade:class extends Ws{constructor(n,t){super(n,xu,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,t){return{overrideFog:!1}}},fill:class extends Ws{constructor(n,t){super(n,WA,t)}getProgramIds(){const n=this.paint.get("fill-pattern"),t=n&&n.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(n,t){return{config:new Rh(this,t),overrideFog:!1}}recalculate(n,t){super.recalculate(n,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Jh(n)}queryRadius(){return om(this.paint.get("fill-translate"))}queryIntersectsFeature(n,t,r,a,l,u){return!n.queryGeometry.isAboveHorizon&&zx(vu(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Ws{constructor(n,t){super(n,kS,t)}createBucket(n){return new Sf(n)}queryRadius(){return om(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,t,r,a,l,u,d,h,p){const m=rM(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(t,r),y=this.paint.get("fill-extrusion-base").evaluate(t,r),x=[0,0],b=h&&u.elevation,E=u.elevation?u.elevation.exaggeration():1,C=n.tile.getBucket(this);if(b&&C instanceof Sf){const P=C.centroidVertexArray,I=p+1;I<P.length&&(x[0]=P.geta_centroid_pos0(I),x[1]=P.geta_centroid_pos1(I))}if(0===x[0]&&1===x[1])return!1;"globe"===u.projection.name&&(a=PS([a],[new nt(0,0),new nt(dt,dt)],n.tileID.canonical).map(P=>P.polygon).flat());const S=b?h:null,[M,D]=(I=a,O=y,F=_,L=m,N=d,z=S,U=x,V=E,G=u.center.lat,"globe"===(P=u).projection.name?function(Z,et,it,X,Y,ot,lt,ht,mt,vt,ct){const ft=[],Rt=[],Vt=Z.projection.upVectorScale(ct,Z.center.lat,Z.worldSize).metersToTile,jt=[0,0,0,1],Ht=[0,0,0,1],re=(je,rn,Re,Me)=>{je[0]=rn,je[1]=Re,je[2]=Me,je[3]=1},ye=Xb();it>0&&(it+=ye),X+=ye;for(const je of et){const rn=[],Re=[];for(const Me of je){const ge=Me.x+Y.x,ue=Me.y+Y.y,Le=Z.projection.projectTilePoint(ge,ue,ct),ln=Z.projection.upVector(ct,Me.x,Me.y);let Be=it,Zn=X;if(lt){const Ti=us(ge,ue,it,X,lt,ht,mt,vt);Be+=Ti.base,Zn+=Ti.top}0!==it?re(jt,Le.x+ln[0]*Vt*Be,Le.y+ln[1]*Vt*Be,Le.z+ln[2]*Vt*Be):re(jt,Le.x,Le.y,Le.z),re(Ht,Le.x+ln[0]*Vt*Zn,Le.y+ln[1]*Vt*Zn,Le.z+ln[2]*Vt*Zn),q.transformMat4(jt,jt,ot),q.transformMat4(Ht,Ht,ot),rn.push(new Bc(jt[0],jt[1],jt[2])),Re.push(new Bc(Ht[0],Ht[1],Ht[2]))}ft.push(rn),Rt.push(Re)}return[ft,Rt]}(P,I,O,F,L,N,z,U,V,G,n.tileID.canonical):z?function(Z,et,it,X,Y,ot,lt,ht,mt){const vt=[],ct=[],ft=[0,0,0,1];for(const Rt of Z){const Vt=[],jt=[];for(const Ht of Rt){const re=Ht.x+X.x,ye=Ht.y+X.y,je=us(re,ye,et,it,ot,lt,ht,mt);ft[0]=re,ft[1]=ye,ft[2]=je.base,ft[3]=1,Ln.transformMat4(ft,ft,Y),ft[3]=Math.max(ft[3],1e-5);const rn=new Bc(ft[0]/ft[3],ft[1]/ft[3],ft[2]/ft[3]);ft[0]=re,ft[1]=ye,ft[2]=je.top,ft[3]=1,Ln.transformMat4(ft,ft,Y),ft[3]=Math.max(ft[3],1e-5);const Re=new Bc(ft[0]/ft[3],ft[1]/ft[3],ft[2]/ft[3]);Vt.push(rn),jt.push(Re)}vt.push(Vt),ct.push(jt)}return[vt,ct]}(I,O,F,L,N,z,U,V,G):function(Z,et,it,X,Y){const ot=[],lt=[],ht=Y[8]*et,mt=Y[9]*et,vt=Y[10]*et,ct=Y[11]*et,ft=Y[8]*it,Rt=Y[9]*it,Vt=Y[10]*it,jt=Y[11]*it;for(const Ht of Z){const re=[],ye=[];for(const je of Ht){const rn=je.x+X.x,Re=je.y+X.y,Me=Y[0]*rn+Y[4]*Re+Y[12],ge=Y[1]*rn+Y[5]*Re+Y[13],ue=Y[2]*rn+Y[6]*Re+Y[14],Le=Y[3]*rn+Y[7]*Re+Y[15],ln=Me+ht,Be=ge+mt,Zn=ue+vt,Ti=Math.max(Le+ct,1e-5),di=Me+ft,ei=ge+Rt,ur=ue+Vt,vi=Math.max(Le+jt,1e-5);re.push(new Bc(ln/Ti,Be/Ti,Zn/Ti)),ye.push(new Bc(di/vi,ei/vi,ur/vi))}ot.push(re),lt.push(ye)}return[ot,lt]}(I,O,F,L,N)),R=n.queryGeometry;var P,I,O,F,L,N,z,U,V,G;return function(P,I,O){let F=1/0;zx(O,I)&&(F=Yb(O,I[0]));for(let L=0;L<I.length;L++){const N=I[L],z=P[L];for(let U=0;U<N.length-1;U++){const V=N[U],G=[V,N[U+1],z[U+1],z[U],V];qh(O,G)&&(F=Math.min(F,Yb(O,G)))}}return F!==1/0&&F}(M,D,R.isPointQuery()?R.screenBounds:R.screenGeometry)}},line:class extends Ws{constructor(n,t){super(n,LS,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof h_,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,t){super.recalculate(n,t),this.paint._values["line-floorwidth"]=t1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Pm(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,t){const r=Jb(this);return{config:new Rh(this,t),defines:r,overrideFog:!1}}queryRadius(n){const t=n,r=e1(Md("line-width",this,t),Md("line-gap-width",this,t)),a=Md("line-offset",this,t);return r/2+Math.abs(a)+om(this.paint.get("line-translate"))}queryIntersectsFeature(n,t,r,a,l,u){if(n.queryGeometry.isAboveHorizon)return!1;const d=vu(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),h=n.pixelToTileUnitsFactor/2*e1(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),p=this.paint.get("line-offset").evaluate(t,r);return p&&(a=function(m,_){const y=[],x=new nt(0,0);for(let b=0;b<m.length;b++){const E=m[b],C=[];for(let S=0;S<E.length;S++){const M=E[S],D=E[S+1],R=0===S?x:M.sub(E[S-1])._unit()._perp(),P=S===E.length-1?x:D.sub(M)._unit()._perp(),I=R._add(P)._unit();I._mult(1/(I.x*P.x+I.y*P.y)),C.push(I._mult(_)._add(M))}y.push(C)}return y}(a,p*n.pixelToTileUnitsFactor)),function(m,_,y){for(let x=0;x<_.length;x++){const b=_[x];if(m.length>=3)for(let E=0;E<b.length;E++)if(Xa(m,b[E]))return!0;if(iM(m,b,y))return!0}return!1}(d,a,h)}isTileClipped(){return!0}},symbol:Ly,background:class extends Ws{constructor(n,t){super(n,zS,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,t){return{overrideFog:!1}}},raster:class extends Ws{constructor(n,t){super(n,VS,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(n){return!(n&&n._source instanceof ql&&(n._source.onNorthPole||n._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(n){"raster-color"!==n&&"raster-color-range"!==n||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-color"].value.expression,[t,r]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Ya({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:r}],resolution:256}),this.colorRampTexture=null}},sky:class extends Ws{constructor(n,t){super(n,K2,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ya({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(n,t){if("atmosphere"===this.paint.get("sky-type")){const a=this.paint.get("sky-atmosphere-sun"),l=!a,u=n.style.light,d=u.properties.get("position");return l&&"viewport"===u.properties.get("anchor")&&tt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?n1(d.azimuthal,90-d.polar,t):n1(a[0],90-a[1],t)}const r=this.paint.get("sky-gradient-center");return n1(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}},slot:class extends Ws{constructor(n,t){super(n,J2)}},model:class extends Ws{constructor(n,t){super(n,$b,t)}createBucket(n){return new _S(n)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(n,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||"model-color"!==n&&"model-color-mix-intensity"!==n&&"model-rotation"!==n&&"model-scale"!==n&&"model-translation"!==n&&"model-emissive-strength"!==n)}_isPropertyZoomDependent(n){const t=this._transitionablePaint._values[n];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof gc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function ev(n,t){return"custom"===n.type?new X2(n):new Q2[n.type](n,t)}function tR(n){const{userImage:t}=n;return!!(t&&t.render&&t.render())&&(n.data.replace(new Uint8Array(t.data.buffer)),!0)}class eR extends $i{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new Pi({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,r){if(this.loaded[r]!==t&&(this.loaded[r]=t,t)){for(const{ids:a,callback:l}of this.requestors)this._notify(a,r,l);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images[r][t]}addImage(t,r,a){this._validate(t,a)&&(this.images[r][t]=a)}_validate(t,r){let a=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new at(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new at(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(r.content,r)||(this.fire(new at(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,r){if(!t)return!0;let a=0;for(const l of t){if(l[0]<a||l[1]<l[0]||r<l[1])return!1;a=l[1]}return!0}_validateContent(t,r){return!(t&&(4!==t.length||t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,r,a){a.version=this.images[r][t].version+1,this.images[r][t]=a,this.updatedImages[r][t]=!0}removeImage(t,r){const a=this.images[r][t];delete this.images[r][t],delete this.patterns[r][t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,r,a){let l=!0;const u=!!this.loaded[r];if(!u)for(const d of t)this.images[r][d]||(l=!1);u||l?this._notify(t,r,a):this.requestors.push({ids:t,scope:r,callback:a})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,r,a){const l={};for(const u of t){this.images[r][u]||this.fire(new St("styleimagemissing",{id:u}));const d=this.images[r][u];d?l[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:!(!d.userImage||!d.userImage.render)}:tt(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,l)}getPixelSize(t){const{width:r,height:a}=this.atlasImage[t];return{width:r,height:a}}getPattern(t,r){const a=this.patterns[r][t],l=this.getImage(t,r);if(!l)return null;if(a&&a.position.version===l.version)return a.position;if(a)a.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},d=new Ey(u,l);this.patterns[r][t]={bin:u,position:d}}return this._updatePatternAtlas(r),this.patterns[r][t].position}bind(t,r){const a=t.gl;let l=this.atlasTexture[r];l?this.dirty&&(l.update(this.atlasImage[r]),this.dirty=!1):(l=new ir(t,this.atlasImage[r],a.RGBA),this.atlasTexture[r]=l),l.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const r=[];for(const d in this.patterns[t])r.push(this.patterns[t][d].bin);const{w:a,h:l}=sn(r),u=this.atlasImage[t];u.resize({width:a||1,height:l||1});for(const d in this.patterns[t]){const{bin:h}=this.patterns[t][d],p=h.x+1,m=h.y+1,_=this.images[t][d].data,y=_.width,x=_.height;Pi.copy(_,u,{x:0,y:0},{x:p,y:m},{width:y,height:x}),Pi.copy(_,u,{x:0,y:x-1},{x:p,y:m-1},{width:y,height:1}),Pi.copy(_,u,{x:0,y:0},{x:p,y:m+x},{width:y,height:1}),Pi.copy(_,u,{x:y-1,y:0},{x:p-1,y:m},{width:1,height:x}),Pi.copy(_,u,{x:0,y:0},{x:p+y,y:m},{width:1,height:x})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,r){for(const a of t){if(this.callbackDispatchedThisFrame[r][a])continue;this.callbackDispatchedThisFrame[r][a]=!0;const l=this.images[r][a];tR(l)&&this.updateImage(a,r,l)}}}const nR=new Ci({anchor:new Dt(J.light.anchor),position:new class{constructor(n){this.specification=n}possiblyEvaluate(n,t){return qt(n.expression.evaluate(t))}interpolate(n,t,r){return{x:_e(n.x,t.x,r),y:_e(n.y,t.y,r),z:_e(n.z,t.z,r),azimuthal:_e(n.azimuthal,t.azimuthal,r),polar:_e(n.polar,t.polar,r)}}}(J.light.position),color:new Dt(J.light.color),intensity:new Dt(J.light.intensity)});class US extends $i{constructor(t,r="flat"){super(),this._transitionable=new Kr(nR),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,a={}){this._validate(ZE,t,a)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,a){return(!a||!1!==a.validate)&&w_(this,t.call(as,Yt({value:r,style:{glyphs:!0,sprite:!0},styleSpec:J})))}}const iR=new Ci({source:new Dt(J.terrain.source),exaggeration:new Dt(J.terrain.exaggeration)});let rR=class extends $i{constructor(n,t){super(),this._transitionable=new Kr(iR),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}setScope(n){this.scope=n}get(){return this._transitionable.serialize()}set(n){this._transitionable.setTransitionOrValue(n)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}getExaggeration(n){return this._transitioning.possiblyEvaluate(new Ei(n)).get("exaggeration")}isZoomDependent(){const n=this._transitionable._values.exaggeration;return null!=n&&null!=n.value&&null!=n.value.expression&&n.value.expression instanceof gc}};const HS=45,$S=65,Ru=.05;function Ym(n,t,r,a){const l=bl(HS,$S,r),[u,d]=r1(n,a);let h=1-Math.min(1,Math.exp((t-u)/(d-u)*-6));return h*=h*h,h=Math.min(1,1.00747*h),h*l*n.alpha}function r1(n,t){const r=.5/Math.tan(.5*t);return[n.range[0]+r,n.range[1]+r]}function o1(n,t,r,a,l){const u=q.transformMat4([],[t,r,a],l.mercatorFogMatrix);return Ym(n,q.length(u),l.pitch,l._fov)}function s1(n,t,r,a,l,u,d){const h=[[r,a,0],[l,a,0],[l,u,0],[r,u,0]];let p=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(const _ of h){const y=q.transformMat4([],_,t),x=q.length(y);p=Math.min(p,x),m=Math.max(m,x)}return[Ym(n,p,d.pitch,d._fov),Ym(n,m,d.pitch,d._fov)]}const GS=new Ci({range:new Dt(J.fog.range),color:new Dt(J.fog.color),"high-color":new Dt(J.fog["high-color"]),"space-color":new Dt(J.fog["space-color"]),"horizon-blend":new Dt(J.fog["horizon-blend"]),"star-intensity":new Dt(J.fog["star-intensity"]),"vertical-range":new Dt(J.fog["vertical-range"])});class qS extends $i{constructor(t,r){super(),this._transitionable=new Kr(GS),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=r}get state(){const t=this._transform,r="globe"===t.projection.name,a=Vr(t.zoom),l=this.properties.get("range"),u=[.5,3];return{range:r?[_e(u[0],l[0],a),_e(u[1],l[1],a)]:l,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r={}){if(this._validate(b_,t,r))return;const a=Yt({},t);for(const l of Object.keys(J.fog))void 0===a[l]&&(a[l]=J.fog[l].default);this._transitionable.setTransitionOrValue(a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:bl(HS,$S,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(a,l,u){const d=Je.fromLngLat(l),h=u.elevation?u.elevation.getAtPointOrZero(d):0;return o1(a,d.x,d.y,h,u)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return s1(this.state,r,0,0,dt,dt,this._transform)}getOpacityForBounds(t,r,a,l,u){return this._transform.projection.supportsFog?s1(this.state,t,r,a,l,u,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?r1(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const a of r){const l=t.points[a];let u;if(l[2]>=0)u=l;else{const d=t.points[a-4];u=CE(d,l,d[2]/(d[2]-l[2]))}if(o1(this.state,u[0],u[1],0,this._transform)>=Ru)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,a){return(!a||!1!==a.validate)&&w_(this,t.call(as,Yt({value:r,style:{glyphs:!0,sprite:!0},styleSpec:J})))}}class WS{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZS{constructor(){this.tasks={},this.taskQueue=[],Rr(["process"],this),this.invoker=new WS(this.process),this.nextId=0}add(t,r){const a=this.nextId++,l=function({type:u,isSymbolTile:d,zoom:h}){return h=h||0,"message"===u?0:"maybePrepare"!==u||d?"parseTile"!==u||d?"parseTile"===u&&d?300-h:"maybePrepare"===u&&d?400-h:500:200-h:100-h}(r);if(0===l){Ct();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:t,metadata:r,priority:l,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Ct();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<r&&(r=u.priority,t=l)}if(null===t)return null;const a=this.taskQueue[t];return this.taskQueue.splice(t,1),a}remove(){this.invoker.remove()}}class Df{constructor(t,r,a){this.target=t,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Rr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ZS}send(t,r,a,l,u=!1,d){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=d,this.callbacks[h]=a);const p=new Set;return this.target.postMessage({id:h,type:t,hasCallback:!!a,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:qe(r,p)},p),{cancel:()=>{a&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(t){const r=t.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const l=this.cancelCallbacks[a];delete this.cancelCallbacks[a],l&&l.cancel()}else if(r.mustQueue||Ct()){const l=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),l&&l.metadata||{type:"message"})}else this.processTask(a,r)}processTask(t,r){if("<response>"===r.type){const a=this.callbacks[t];delete this.callbacks[t],a&&(r.error?a(sd(r.error)):a(null,sd(r.data)))}else{const a=new Set,l=r.hasCallback?(d,h)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:d?qe(d):null,data:qe(h,a)},a)}:d=>{},u=sd(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,u,l);else if(this.parent.getWorkerSource){const d=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,d[0],u.source,u.scope)[d[1]](u,l)}else l(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Km=(()=>{class n{constructor(r,a){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Di();const l=this.workerPool.acquire(this.id);for(let u=0;u<l.length;u++){const d=new n.Actor(l[u],a,this.id);d.name=`Worker ${u}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,a,l){Yu(this.actors,(u,d)=>{u.send(r,a,d)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}return n.Actor=Df,n})();class Pu extends $i{constructor(t,r,a,l){super(),this.scope=a,this._options=t,this.properties=new Pp(r),this._transitionable=new Kr(r,new Map(l)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const oR=new Ci({color:new Dt(J.properties_light_ambient.color),intensity:new Dt(J.properties_light_ambient.intensity)}),sR=new Ci({direction:new class{constructor(n){this.specification=n}possiblyEvaluate(n,t){return function([r,a]){const l=qt([1,r,a]);return{x:l.x,y:l.y,z:l.z}}(n.expression.evaluate(t))}interpolate(n,t,r){return{x:_e(n.x,t.x,r),y:_e(n.y,t.y,r),z:_e(n.z,t.z,r)}}}(J.properties_light_directional.direction),color:new Dt(J.properties_light_directional.color),intensity:new Dt(J.properties_light_directional.intensity),"cast-shadows":new Dt(J.properties_light_directional["cast-shadows"]),"shadow-intensity":new Dt(J.properties_light_directional["shadow-intensity"])});class Ou{constructor(t,r,a,l){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,l)}static createFromScreenPoints(t,r){let a,l;if(t instanceof nt||"number"==typeof t[0]){const u=nt.convert(t);a=[u],l=r.isPointAboveHorizon(u)}else{const u=nt.convert(t[0]),d=nt.convert(t[1]);a=[u,d],l=Xu(u,d).every(h=>r.isPointAboveHorizon(h))}return new Ou(a,r.getCameraPoint(),l,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return Xu(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],a=1===this.screenBounds.length?this.screenBounds[0].add(new nt(1,1)):this.screenBounds[1],l=Xu(r,a,0,!1);return this.cameraPoint.y>a.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<a.x?l.splice(3,0,this.cameraPoint):this.cameraPoint.x>=a.x?l[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(l[3]=this.cameraPoint)),function(u,d){const h=[];for(let p=0;p<u.length;p++){const m=wl(p-1,-1,u.length-1),_=wl(p+1,-1,u.length-1),y=u[p],x=u[_],b=u[m].sub(y).unit(),E=x.sub(y).unit(),C=E.angleWithSep(b.x,b.y),S=b.add(E).unit().mult(-1*d/Math.sin(C/2));h.push(y.add(S))}return h}(l,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],a=1===this.screenBounds.length?this.screenBounds[0].add(new nt(1,1)):this.screenBounds[1],l=Xu(r,a,t),u=this.cameraPoint.clone();switch(3*((u.y>r.y)+(u.y>a.y))+((u.x>r.x)+(u.x>a.x))){case 0:l[0]=u,l[4]=u.clone();break;case 1:l.splice(1,0,u);break;case 2:l[1]=u;break;case 3:l.splice(4,0,u);break;case 5:l.splice(2,0,u);break;case 6:l[3]=u;break;case 7:l.splice(3,0,u);break;case 8:l[2]=u}return l}containsTile(t,r,a,l=0){const u=t.queryPadding/r._pixelsPerMercatorPixel+1,d=a?this._bufferedCameraMercator(u,r):this._bufferedScreenMercator(u,r);let h=t.tileID.wrap+(d.unwrapped?l:0);const p=d.polygon.map(S=>$l(t.tileTransform,S,h));if(!jA(p,0,0,dt,dt))return;h=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?l:0);const m=this.screenGeometryMercator.polygon.map(S=>VM(t.tileTransform,S,h)),_=m.map(S=>new nt(S[0],S[1])),y=r.getFreeCameraOptions().position||new Je(0,0,0),x=VM(t.tileTransform,y,h),b=m.map(S=>{const M=q.sub(S,S,x);return q.normalize(M,M),new Vh(x,M)}),E=Pd(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:_,tilespaceRays:b,bufferedTilespaceGeometry:p,bufferedTilespaceBounds:(C=xl(p),C.min.x=Jt(C.min.x,0,dt),C.min.y=Jt(C.min.y,0,dt),C.max.x=Jt(C.max.x,0,dt),C.max.y=Jt(C.max.y,0,dt),C),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:E};var C}_bufferedScreenMercator(t,r){const a=aR(t);if(this._screenRaycastCache[a])return this._screenRaycastCache[a];{let l;return l="globe"===r.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(u=>r.pointCoordinate3D(u)),unwrapped:!0},this._screenRaycastCache[a]=l,l}}_bufferedCameraMercator(t,r){const a=aR(t);if(this._cameraRaycastCache[a])return this._cameraRaycastCache[a];{let l;return l="globe"===r.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(u=>r.pointCoordinate3D(u)),unwrapped:!0},this._cameraRaycastCache[a]=l,l}}_projectAndResample(t,r){const a=function(u,d){const h=rt.multiply([],d.pixelMatrix,d.globeMatrix),p=[0,-Po,0,1],m=[0,Po,0,1],_=[0,0,0,1];Ln.transformMat4(p,p,h),Ln.transformMat4(m,m,h),Ln.transformMat4(_,_,h);const y=new nt(p[0]/p[3],p[1]/p[3]),x=new nt(m[0]/m[3],m[1]/m[3]),b=Xa(u,y)&&p[3]<_[3],E=Xa(u,x)&&m[3]<_[3];if(!b&&!E)return null;const C=function(F,L,N){for(let z=1;z<F.length;z++){const U=ao(L.pointCoordinate3D(F[z-1]).x),V=ao(L.pointCoordinate3D(F[z]).x);if(N<0){if(U<V)return{idx:z,t:-U/(V-1-U)}}else if(V<U)return{idx:z,t:(1-U)/(V+1-U)}}return null}(u,d,b?-1:1);if(!C)return null;const{idx:S,t:M}=C;let D=S>1?XS(u.slice(0,S),d):[],R=S<u.length?XS(u.slice(S),d):[];D=D.map(F=>new nt(ao(F.x),F.y)),R=R.map(F=>new nt(ao(F.x),F.y));const P=[...D];0===P.length&&P.push(R[R.length-1]);const I=_e(P[P.length-1].y,(0===R.length?D[0]:R[0]).y,M);let O;return O=b?[new nt(0,I),new nt(0,0),new nt(1,0),new nt(1,I)]:[new nt(1,I),new nt(1,1),new nt(0,1),new nt(0,I)],P.push(...O),0===R.length?P.push(D[0]):P.push(...R),{polygon:P.map(F=>new Je(F.x,F.y)),unwrapped:!1}}(t,r);if(a)return a;const l=function(u,d){let h=!1,p=-1/0,m=0;for(let y=0;y<u.length-1;y++)u[y].x>p&&(p=u[y].x,m=y);for(let y=0;y<u.length-1;y++){const x=(m+y)%(u.length-1),b=u[x],E=u[x+1];Math.abs(b.x-E.x)>.5&&(b.x<E.x?(b.x+=1,0===x&&(u[u.length-1].x+=1)):(E.x+=1,x+1===u.length-1&&(u[0].x+=1)),h=!0)}const _=no(d.center.lng);return h&&_<Math.abs(_-1)&&u.forEach(y=>{y.x-=1}),{polygon:u,unwrapped:h}}(XS(t,r).map(u=>new nt(ao(u.x),u.y)),r);return{polygon:l.polygon.map(u=>new Je(u.x,u.y)),unwrapped:l.unwrapped}}}function XS(n,t){return QC(n,r=>{const a=t.pointCoordinate3D(r);r.x=a.x,r.y=a.y},1/256)}function ao(n){return n<0?1+n%1:n%1}function aR(n){return 100*n|0}function nv(n,t,r,a,l){const u=function(d,h){if(d)return l(d);if(h){n.url&&h.tiles&&n.tiles&&delete n.tiles;const p=ns(Yt(h,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);h.vector_layers&&(p.vectorLayers=h.vector_layers,p.vectorLayerIds=p.vectorLayers.map(m=>m.id)),p.tiles=t.canonicalizeTileset(p,n.url),l(null,p)}};return n.url?At(t.transformRequest(t.normalizeSourceURL(n.url,null,r,a),gt.Source),u):kt.frame(()=>u(null,n))}class Jm{constructor(t,r,a){this.bounds=Zs.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),a=Math.floor(no(this.bounds.getWest())*r),l=Math.floor(mo(this.bounds.getNorth())*r),u=Math.ceil(no(this.bounds.getEast())*r),d=Math.ceil(mo(this.bounds.getSouth())*r);return t.x>=a&&t.x<u&&t.y>=l&&t.y<d}}class lR{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new Mc({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const a=this.getKey(t,r);return this.positions[a]}trim(){const t=this.width,r=this.height=dn(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,a){const l=[];let u=t.length%2==1?-t[t.length-1]*a:0,d=t[0]*a,h=!0;l.push({left:u,right:d,isDash:h,zeroLength:0===t[0]});let p=t[0];for(let m=1;m<t.length;m++){h=!h;const _=t[m];u=p*a,p+=_,d=p*a,l.push({left:u,right:d,isDash:h,zeroLength:0===_})}return l}addRoundDash(t,r,a){const l=r/2;for(let u=-a;u<=a;u++){const d=this.width*(this.nextRow+a+u);let h=0,p=t[h];for(let m=0;m<this.width;m++){m/p.right>1&&(p=t[++h]);const _=Math.abs(m-p.left),y=Math.abs(m-p.right),x=Math.min(_,y);let b;const E=u/a*(l+1);if(p.isDash){const C=l-Math.abs(E);b=Math.sqrt(x*x+C*C)}else b=l-Math.sqrt(x*x+E*E);this.image.data[d+m]=Math.max(0,Math.min(255,b+128))}}}addRegularDash(t,r){for(let p=t.length-1;p>=0;--p){const m=t[p],_=t[p+1];m.zeroLength?t.splice(p,1):_&&_.isDash===m.isDash&&(_.left=m.left,t.splice(p,1))}const a=t[0],l=t[t.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const u=this.width*this.nextRow;let d=0,h=t[d];for(let p=0;p<this.width;p++){p/h.right>1&&(h=t[++d]);const m=Math.abs(p-h.left),_=Math.abs(p-h.right),y=Math.min(m,_);this.image.data[u+p]=Math.max(0,Math.min(255,(h.isDash?y:-y)+r+128))}}addDash(t,r){const a=this.getKey(t,r);if(this.positions[a])return this.positions[a];const l="round"===r,u=l?7:0,d=2*u+1;if(this.nextRow+d>this.height)return tt("LineAtlas out of space"),null;0===t.length&&t.push(1);let h=0;for(let _=0;_<t.length;_++)t[_]<0&&(tt("Negative value is found in line dasharray, replacing values with 0"),t[_]=0),h+=t[_];if(0!==h){const _=this.width/h,y=this.getDashRanges(t,this.width,_);l?this.addRoundDash(y,_,u):this.addRegularDash(y,"square"===r?.5*_:0)}const p=this.nextRow+u;this.nextRow+=d;const m={tl:[p,u],br:[h,0]};return this.positions[a]=m,m}}Xt(lR,"LineAtlas");const qi=1*Js;class YS{constructor(t){const r={},a=[];for(const h in t){const p=t[h],m=r[h]={};for(const _ in p.glyphs){const y=p.glyphs[+_];if(!y||0===y.bitmap.width||0===y.bitmap.height)continue;const x=y.metrics.localGlyph?qi:1,b={x:0,y:0,w:y.bitmap.width+2*x,h:y.bitmap.height+2*x};a.push(b),m[_]=b}}const{w:l,h:u}=sn(a),d=new Mc({width:l||1,height:u||1});for(const h in t){const p=t[h];for(const m in p.glyphs){const _=p.glyphs[+m];if(!_||0===_.bitmap.width||0===_.bitmap.height)continue;const y=r[h][m],x=_.metrics.localGlyph?qi:1;Mc.copy(_.bitmap,d,{x:0,y:0},{x:y.x+x,y:y.y+x},_.bitmap)}}this.image=d,this.positions=r}}Xt(YS,"GlyphAtlas");class cR{constructor(t){this.tileID=new tn(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Tu(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,r,a,l,u){this.status="parsing",this.data=t,this.collisionBoxArray=new tC;const d=new fM(Object.keys(t.layers).sort()),h=new gb(this.tileID,this.promoteId);h.bucketLayerIDs=[];const p={},m=new lR(256,256),_={featureIndex:h,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:m,availableImages:a,brightness:this.brightness},y=r.familiesBySource[this.source];for(const D in y){const R=t.layers[D];if(!R)continue;let P=!1,I=!1,O=!1;for(const N of y[D])"symbol"===N[0].type?P=!0:I=!0,N[0].is3D()&&"model"!==N[0].type&&(O=!0);if(this.extraShadowCaster&&!O||!0===this.isSymbolTile&&!P||!1===this.isSymbolTile&&!I)continue;1===R.version&&tt(`Vector tile source "${this.source}" layer "${D}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const F=d.encode(D),L=[];for(let N=0;N<R.length;N++){const z=R.feature(N),U=h.getId(z,D);L.push({feature:z,id:U,index:N,sourceLayerIndex:F})}for(const N of y[D]){const z=N[0];(!this.extraShadowCaster||z.is3D()&&"model"!==z.type)&&(void 0!==this.isSymbolTile&&"symbol"===z.type!==this.isSymbolTile||z.minzoom&&this.zoom<Math.floor(z.minzoom)||z.maxzoom&&this.zoom>=z.maxzoom||"none"!==z.visibility&&(a1(N,this.zoom,_.brightness,a),(p[z.id]=z.createBucket({index:h.bucketLayerIDs.length,layers:N,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:F,sourceID:this.source,projection:this.projection.spec})).populate(L,_,this.tileID.canonical,this.tileTransform),h.bucketLayerIDs.push(N.map(U=>U.id))))}}let x,b,E,C;m.trim();const S={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},M=()=>{if(x)return u(x);if(this.extraShadowCaster)this.status="done",u(null,{buckets:on(p).filter(D=>!D.isEmpty()),featureIndex:h,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:_.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(b&&E&&C){const D=new YS(b),R=new _t(E,C);for(const P in p){const I=p[P];I instanceof Rm?(a1(I.layers,this.zoom,_.brightness,a),f2(I,b,D.positions,E,R.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):I.hasPattern&&(I instanceof Pm||I instanceof Jh||I instanceof Sf)&&(a1(I.layers,this.zoom,_.brightness,a),I.addFeatures(_,this.tileID.canonical,R.patternPositions,a,this.tileTransform,this.brightness))}this.status="done",u(null,{buckets:on(p).filter(P=>!P.isEmpty()),featureIndex:h,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:D.image,lineAtlas:m,imageAtlas:R,brightness:_.brightness})}};if(!this.extraShadowCaster){const D=th(_.glyphDependencies,I=>Object.keys(I).map(Number));Object.keys(D).length?l.send("getGlyphs",{uid:this.uid,stacks:D,scope:this.scope},(I,O)=>{x||(x=I,b=O,M())},void 0,!1,S):b={};const R=Object.keys(_.iconDependencies);R.length?l.send("getImages",{icons:R,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(I,O)=>{x||(x=I,E=O,M())},void 0,!1,S):E={};const P=Object.keys(_.patternDependencies);P.length?l.send("getImages",{icons:P,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(I,O)=>{x||(x=I,C=O,M())},void 0,!1,S):C={}}M()}}function a1(n,t,r,a){const l=new Ei(t,{brightness:r});for(const u of n)u.recalculate(l,a)}class kd{constructor(t){this.entries={},this.scheduler=t}request(t,r,a,l){const u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){const[d,h]=u.result;return this.scheduler?this.scheduler.add(()=>{l(d,h)},r):l(d,h),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=a((d,h)=>{u.result=[d,h];for(const p of u.callbacks)this.scheduler?this.scheduler.add(()=>{p(d,h)},r):p(d,h);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(d=>d!==l),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}}function KS(n,t,r){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},l=>{const u=zt(n.request,(d,h,p,m)=>{d?l(d):h&&l(null,{vectorTile:r?void 0:new gm(new Xe(h)),rawData:h,cacheControl:p,expires:m})});return()=>{u.cancel(),l()}},t)}class Qm extends $i{constructor(t,r,a,l){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Yt(this,ns(r,["url","scheme","tileSize","promoteId"])),this._options=Yt({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l),this._tileWorkers={},this._deduped=new kd}load(t){this._loaded=!1,this.fire(new St("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=nv(this._options,this.map._requestManager,r,a,(l,u)=>{this._tileJSONRequest=null,this._loaded=!0,l?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),a&&2!==a.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new at(l))):u&&(Yt(this,u),u.bounds&&(this.tileBounds=new Jm(u.bounds,this.minzoom,this.maxzoom)),iu(u.tiles,this.map._requestManager._customAccessToken),this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))),t&&t(l)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=Jr(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Yt({},this._options)}loadTile(t,r){const a=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),l={request:this.map._requestManager.transformRequest(a,gt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:kt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=r:t.request=t.actor.send("reloadTile",l,u.bind(this));else if(t.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,u.bind(this),void 0,!0);else{const d=KS.call({deduped:this._deduped},l,(h,p)=>{h||!p?u.call(this,h):(l.data={cacheControl:p.cacheControl,expires:p.expires,rawData:p.rawData.slice(0)},t.actor&&t.actor.send("loadTile",l,u.bind(this),void 0,!0))},!0);t.request={cancel:d}}function u(d,h){return delete t.request,t.aborted?r(null):d&&404!==d.status?r(d):(h&&h.resourceTiming&&(t.resourceTiming=h.resourceTiming),this.map._refreshExpiredTiles&&h&&t.setExpiryData(h),t.loadVectorData(h,this.map.painter),nh(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ku extends $i{constructor(t,r,a,l){super(),this.id=t,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Yt({type:"raster"},r),Yt(this,ns(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new St("dataloading",{dataType:"source"})),this._tileJSONRequest=nv(this._options,this.map._requestManager,null,null,(r,a)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new at(r)):a&&(Yt(this,a),a.bounds&&(this.tileBounds=new Jm(a.bounds,this.minzoom,this.maxzoom)),iu(a.tiles),this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=Jr(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Yt({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const a=kt.devicePixelRatio>=2,l=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),a,this.tileSize);t.request=Oe(this.map._requestManager.transformRequest(l,gt.Tile),(u,d,h,p)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):u?(t.state="errored",r(u)):d?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:h,expires:p}),t.setTexture(d,this.map.painter),t.state="loaded",nh(this.dispatcher),void r(null)):r(null)))}static loadTileData(t,r,a){t.setTexture(r,a)}static unloadTileData(t,r){t.texture&&r.saveTileTexture(t.texture)}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r()}unloadTile(t,r){t.texture&&this.map.painter.saveTileTexture(t.texture),r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Ko;function $F(){return null!=Av.workerClass?new Av.workerClass:new st.Worker(Av.workerUrl)}const iv="mapboxgl_preloaded_worker_pool";class Fd{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Fd.workerCount;)this.workers.push(new $F);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[iv]}numActive(){return Object.keys(this.active).length}}let tg;function If(){return tg||(tg=new Fd),tg}Fd.workerCount=2;let eg,rv,Sa,l1=null;function JS(){return Ct()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:rv||He.DRACO_URL}const c1=5123,Ld=5126,u1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[c1]:Uint16Array,5125:Uint32Array,[Ld]:Float32Array},uR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[c1]:"DT_UINT16",5125:"DT_UINT32",[Ld]:"DT_FLOAT32"},d1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function ng(n,t,r){const a=r.json.bufferViews.length,l=r.buffers.length;t.bufferView=a,r.json.bufferViews[a]={buffer:l,byteLength:n.byteLength},r.buffers[l]=n}const ov="KHR_draco_mesh_compression";function QS(n,t){const r=n.extensions&&n.extensions[ov];if(!r)return;const a=new Sa.Decoder,l=eT(t,r.bufferView),u=new Sa.Mesh;if(!a.DecodeArrayToMesh(l,l.byteLength,u))throw new Error("Failed to decode Draco mesh");const d=t.json.accessors[n.indices],h=u1[d.componentType],p=d.count*h.BYTES_PER_ELEMENT,m=Sa._malloc(p);h===Uint16Array?a.GetTrianglesUInt16Array(u,p,m):a.GetTrianglesUInt32Array(u,p,m),ng(Sa.memory.buffer.slice(m,m+p),d,t),Sa._free(m);for(const _ of Object.keys(r.attributes)){const y=a.GetAttributeByUniqueId(u,r.attributes[_]),x=t.json.accessors[n.attributes[_]],b=uR[x.componentType],E=x.count*d1[x.type]*u1[x.componentType].BYTES_PER_ELEMENT,C=Sa._malloc(E);a.GetAttributeDataArrayForAllPoints(u,y,Sa[b],E,C),ng(Sa.memory.buffer.slice(C,C+E),x,t),Sa._free(C)}a.destroy(),u.destroy(),delete n.extensions[ov]}const h1=1179937895,tT=new TextDecoder("utf8");function Af(n,t){return new URL(n,t).href}function ig(n,t,r,a){return fetch(Af(n.uri,a)).then(l=>l.arrayBuffer()).then(l=>{t.buffers[r]=l})}function eT(n,t){const r=n.json.bufferViews[t];return new Uint8Array(n.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function dR(n,t,r,a){if(n.uri){const l=Af(n.uri,a);return fetch(l).then(u=>u.blob()).then(u=>st.createImageBitmap(u)).then(u=>{t.images[r]=u})}if(void 0!==n.bufferView){const l=eT(t,n.bufferView),u=new st.Blob([l],{type:n.mimeType});return st.createImageBitmap(u).then(d=>{t.images[r]=d})}}function nT(n,t=0,r){const a={json:null,images:[],buffers:[]};if(new Uint32Array(n,t,1)[0]===h1){const m=new Uint32Array(n,t);let _=2;const y=(m[_++]>>2)-3,x=m[_++]>>2;if(_++,a.json=JSON.parse(tT.decode(m.subarray(_,_+x))),_+=x,_<y){const b=m[_++];_++;const E=t+(_<<2);a.buffers[0]=n.slice(E,E+b)}}else a.json=JSON.parse(tT.decode(new Uint8Array(n,t)));const{buffers:l,images:u,meshes:d,extensionsUsed:h}=a.json;let p=Promise.resolve();if(l){const m=[];for(let _=0;_<l.length;_++){const y=l[_];y.uri?m.push(ig(y,a,_,r)):a.buffers[_]||(a.buffers[_]=null)}p=Promise.all(m)}return p.then(()=>{const m=[],_=h&&h.includes(ov);if(_&&m.push(function(){if(!Sa)return eg||(eg=function(y){let x,b=null;function E(){x=new Uint8Array(b.buffer)}function C(){throw new Error("Unexpected Draco error.")}const S={a:{a:C,d:function(M,D,R){return x.copyWithin(M,D,D+R)},c:function(M){const D=x.length,R=Math.max(M>>>0,Math.ceil(1.2*D)),P=Math.ceil((R-D)/65536);try{return b.grow(P),E(),!0}catch{return!1}},b:C}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(y,S):y.then(M=>M.arrayBuffer()).then(M=>WebAssembly.instantiate(M,S))).then(M=>{const{Rb:D,Qb:R,P,T:I,X:O,Ja:F,La:L,Qa:N,Va:z,Wa:U,eb:V,jb:G,f:j,e:Z,yb:et,zb:it,Ab:X,Bb:Y,Db:ot,Gb:lt}=M.instance.exports;b=Z;const ht=(()=>{let mt=0,vt=0,ct=0,ft=0;return Rt=>{ct&&(D(ft),D(mt),vt+=ct,ct=mt=0),mt||(vt+=128,mt=R(vt));const Vt=Rt.length+7&-8;let jt=mt;Vt>=vt&&(ct=Vt,jt=ft=R(Vt));for(let Ht=0;Ht<Rt.length;Ht++)x[jt+Ht]=Rt[Ht];return jt}})();return E(),j(),{memory:Z,_free:D,_malloc:R,Mesh:class{constructor(){this.ptr=P()}destroy(){I(this.ptr)}},Decoder:class{constructor(){this.ptr=F()}destroy(){G(this.ptr)}DecodeArrayToMesh(mt,vt,ct){const ft=ht(mt),Rt=L(this.ptr,ft,vt,ct.ptr);return!!O(Rt)}GetAttributeByUniqueId(mt,vt){return{ptr:N(this.ptr,mt.ptr,vt)}}GetTrianglesUInt16Array(mt,vt,ct){z(this.ptr,mt.ptr,vt,ct)}GetTrianglesUInt32Array(mt,vt,ct){U(this.ptr,mt.ptr,vt,ct)}GetAttributeDataArrayForAllPoints(mt,vt,ct,ft,Rt){V(this.ptr,mt.ptr,vt.ptr,ct,ft,Rt)}},DT_INT8:et(),DT_UINT8:it(),DT_INT16:X(),DT_UINT16:Y(),DT_UINT32:ot(),DT_FLOAT32:lt()}})}(fetch(JS())),eg.then(y=>{Sa=y,eg=void 0}))}()),u)for(let y=0;y<u.length;y++)m.push(dR(u[y],a,y,r));return(m.length?Promise.all(m):Promise.resolve()).then(()=>{if(_&&d)for(const{primitives:y}of d)for(const x of y)QS(x,a);return a})})}function f1(n){return fetch(n).then(t=>t.arrayBuffer()).then(t=>nT(t,0,n))}class p1{constructor(t,r,a){if(this.triangleCount=r.length/3,this.min=new nt(0,0),this.max=new nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===a)return;const l=t.map(_=>_.x),u=t.map(_=>_.y);this.min=new nt(Math.min(...l),Math.min(...u)),this.max=new nt(Math.max(...l),Math.max(...u));const d=this.max.sub(this.min);d.x=Math.max(d.x,1),d.y=Math.max(d.y,1);const h=Math.max(d.x,d.y)/a;this.cellsX=Math.max(1,Math.ceil(d.x/h)),this.cellsY=Math.max(1,Math.ceil(d.y/h)),this.xScale=1/h,this.yScale=1/h;const p=[];for(let _=0;_<this.triangleCount;_++){const y=t[r[3*_+0]].sub(this.min),x=t[r[3*_+1]].sub(this.min),b=t[r[3*_+2]].sub(this.min),E=Vc(Math.floor(Math.min(y.x,x.x,b.x)),this.xScale,this.cellsX),C=Vc(Math.floor(Math.max(y.x,x.x,b.x)),this.xScale,this.cellsX),S=Vc(Math.floor(Math.min(y.y,x.y,b.y)),this.yScale,this.cellsY),M=Vc(Math.floor(Math.max(y.y,x.y,b.y)),this.yScale,this.cellsY),D=new nt(0,0),R=new nt(0,0),P=new nt(0,0),I=new nt(0,0);for(let O=S;O<=M;++O){D.y=R.y=O*h,P.y=I.y=(O+1)*h;for(let F=E;F<=C;++F)D.x=P.x=F*h,R.x=I.x=(F+1)*h,(rm(y,x,b,D,R,I)||rm(y,x,b,D,I,P))&&p.push({cellIdx:O*this.cellsX+F,triIdx:_})}}if(0===p.length)return;p.sort((_,y)=>_.cellIdx-y.cellIdx||_.triIdx-y.triIdx);let m=0;for(;m<p.length;){const _=p[m].cellIdx,y={start:this.payload.length,len:0};for(;m<p.length&&p[m].cellIdx===_;)++y.len,this.payload.push(p[m++].triIdx);this.cells[_]=y}}query(t,r,a){if(0===this.triangleCount||0===this.cells.length||t.x>this.max.x||this.min.x>r.x||t.y>this.max.y||this.min.y>r.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let p=0;p<this.lookup.length;p++)this.lookup[p]=0;const l=Vc(t.x-this.min.x,this.xScale,this.cellsX),u=Vc(r.x-this.min.x,this.xScale,this.cellsX),d=Vc(t.y-this.min.y,this.yScale,this.cellsY),h=Vc(r.y-this.min.y,this.yScale,this.cellsY);for(let p=d;p<=h;p++)for(let m=l;m<=u;m++){const _=this.cells[p*this.cellsX+m];if(_)for(let y=0;y<_.len;y++){const x=this.payload[_.start+y],b=Math.floor(x/8),E=1<<x%8;if(!(this.lookup[b]&E)&&(this.lookup[b]|=E,a.push(x),a.length===this.triangleCount))return}}}}function Vc(n,t,r){return Math.max(0,Math.min(r-1,Math.floor(n*t)))}function Nd(n,t){const r=n.json.bufferViews[t.bufferView];return new u1[t.componentType](n.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*d1[t.type])}function iT(n,t,r){const a=n.indices,l=n.attributes,u={};u.indexArray=new er;const d=t.json.accessors[a],h=d.count/3;u.indexArray.reserve(h);const p=Nd(t,d);for(let x=0;x<h;x++)u.indexArray.emplaceBack(p[3*x],p[3*x+1],p[3*x+2]);u.indexArray._trim(),u.vertexArray=new Ga;const m=t.json.accessors[l.POSITION];u.vertexArray.reserve(m.count);const _=Nd(t,m);for(let x=0;x<m.count;x++)u.vertexArray.emplaceBack(_[3*x],_[3*x+1],_[3*x+2]);if(u.vertexArray._trim(),u.aabb=new ui(m.min,m.max),u.centroid=function(x,b){const E=[0,0,0],C=x.length;if(C>0){for(let S=0;S<C;S++){const M=3*x[S];E[0]+=b[M],E[1]+=b[M+1],E[2]+=b[M+2]}E[0]/=C,E[1]/=C,E[2]/=C}return E}(p,_),void 0!==l.COLOR_0){const x=t.json.accessors[l.COLOR_0],b=d1[x.type];if(x.componentType===Ld){u.colorArray=3===b?new Ga:new Mi,u.colorArray.reserve(x.count);const E=Nd(t,x);if(3===b)for(let C=0;C<x.count;C++)u.colorArray.emplaceBack(E[3*C],E[3*C+1],E[3*C+2]);else for(let C=0;C<x.count;C++)u.colorArray.emplaceBack(E[4*C],E[4*C+1],E[4*C+2],E[4*C+3]);u.colorArray._trim()}else if(x.componentType===c1&&4===b){u.colorArray=new Mi,u.colorArray.resize(x.count);const E=Nd(t,x),C=1/65535,S=u.colorArray.float32;for(let M=0;M<4*E.length;++M)S[M]=E[M]*C}else tt(`glTF color buffer parsing for accessor ${JSON.stringify(x)} is not supported`)}if(void 0!==l.NORMAL){u.normalArray=new Ga;const x=t.json.accessors[l.NORMAL];u.normalArray.reserve(x.count);const b=Nd(t,x);for(let E=0;E<x.count;E++)u.normalArray.emplaceBack(b[3*E],b[3*E+1],b[3*E+2]);u.normalArray._trim()}if(void 0!==l.TEXCOORD_0&&r.length>0){u.texcoordArray=new dd;const x=t.json.accessors[l.TEXCOORD_0];u.texcoordArray.reserve(x.count);const b=Nd(t,x);for(let E=0;E<x.count;E++)u.texcoordArray.emplaceBack(b[2*E],b[2*E+1]);u.texcoordArray._trim()}const y=n.material;return u.material=function(x,b){const{emissiveFactor:E=[0,0,0],alphaMode:C="OPAQUE",alphaCutoff:S=.5,normalTexture:M,occlusionTexture:D,emissiveTexture:R,doubleSided:P}=x,{baseColorFactor:I=[1,1,1,1],metallicFactor:O=1,roughnessFactor:F=1,baseColorTexture:L,metallicRoughnessTexture:N}=x.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Ne(...I),metallicFactor:O,roughnessFactor:F,baseColorTexture:L?b[L.index]:void 0,metallicRoughnessTexture:N?b[N.index]:void 0},doubleSided:P,emissiveFactor:E,alphaMode:C,alphaCutoff:S,normalTexture:M?b[M.index]:void 0,occlusionTexture:D?b[D.index]:void 0,emissionTexture:R?b[R.index]:void 0,defined:void 0===x.defined}}(void 0!==y?t.json.materials[y]:{defined:!1},r),void 0!==l._FEATURE_RGBA4444&&(u.featureData=new Uint32Array(Nd(t,t.json.accessors[l._FEATURE_RGBA4444]).buffer)),u}function rT(n,t,r){const{matrix:a,rotation:l,translation:u,scale:d,mesh:h,extras:p,children:m}=n,_={};if(_.matrix=a||rt.fromRotationTranslationScale([],l||[0,0,0,1],u||[0,0,0],d||[1,1,1]),void 0!==h){_.meshes=r[h];const y=_.anchor=[0,0];for(const x of _.meshes){const{min:b,max:E}=x.aabb;y[0]+=b[0]+E[0],y[1]+=b[1]+E[1]}y[0]=Math.floor(y[0]/_.meshes.length/2),y[1]=Math.floor(y[1]/_.meshes.length/2)}if(p&&(p.id&&(_.id=p.id),p.lights&&(_.lights=function(y){if(!y.length)return[];const x=function(M){const D=atob(M),R=new Uint8Array(D.length);for(let P=0;P<D.length;P++)R[P]=D.codePointAt(P);return R}(y),b=[],E=x.length/24,C=new Uint16Array(x.buffer),S=new Float32Array(x.buffer);for(let M=0;M<E;M++){const D=C[2*M*6]/30,R=C[2*M*6+1]/30,P=C[2*M*6+10]/100,I=S[6*M+1],O=S[6*M+2],F=S[6*M+3],L=S[6*M+4],N=F-I,z=L-O,U=Math.hypot(N,z);b.push({pos:[I+.5*N,O+.5*z,R],normal:[z/U,-N/U,0],width:U,height:D,depth:P,points:[I,O,F,L]})}return b}(p.lights))),m){const y=[];for(const x of m)y.push(rT(t.json.nodes[x],t,r));_.children=y}return _}function hR(n){if(0===n.vertices.length||0===n.indices.length)return null;const[t,r]=[n.vertices[0].clone(),n.vertices[0].clone()];for(let d=1;d<n.vertices.length;++d){const h=n.vertices[d];t.x=Math.min(t.x,h.x),t.y=Math.min(t.y,h.y),r.x=Math.max(r.x,h.x),r.y=Math.max(r.y,h.y)}const a=Math.ceil(Math.max(r.x-t.x,r.y-t.y)/256),l=Math.max(8,a),u=new p1(n.vertices,n.indices,l);return{vertices:n.vertices,indices:n.indices,grid:u,min:t,max:r}}function GF(n){if(!n.extras||!n.extras.ground)return null;const t=n.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const r=t[0];if(!r||!Array.isArray(r)||0===r.length)return null;const a=[];for(const d of r){if(!Array.isArray(d)||2!==d.length)continue;const h=d[0],p=d[1];"number"==typeof h&&"number"==typeof p&&a.push(new nt(h,p))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let l=0;for(let d=0;d<a.length;d++){const h=a[d],p=a[(d+1)%a.length],m=a[(d+2)%a.length];l+=(h.x-p.x)*(m.y-p.y)-(m.x-p.x)*(h.y-p.y)}l>0&&a.reverse();const u=hy(a.flatMap(d=>[d.x,d.y]),[]);return 0===u.length?null:{vertices:a,indices:u}}function qF(n){const t=[],r=[];let a=0;for(const l of n){a=t.length;const u=l.vertexArray.float32,d=l.indexArray.uint16;for(let h=0;h<l.vertexArray.length;h++)t.push(new nt(u[3*h+0],u[3*h+1]));for(let h=0;h<3*l.indexArray.length;h++)r.push(d[h]+a)}if(r.length%3!=0)return null;for(let l=0;l<r.length;l+=3){const u=t[r[l+0]],d=t[r[l+1]],h=t[r[l+2]];(u.x-d.x)*(h.y-d.y)-(h.x-d.x)*(u.y-d.y)>0&&([r[l+1],r[l+2]]=[r[l+2],r[l+1]])}return{vertices:t,indices:r}}function oT(n){const r=function(p,m){const _=[];for(const y of p.json.meshes){const x=[];for(const b of y.primitives)x.push(iT(b,p,m));_.push(x)}return _}(n,function(p,m){const _=[],y=st.WebGL2RenderingContext;if(p.json.textures)for(const x of p.json.textures){const b={magFilter:y.LINEAR,minFilter:y.NEAREST,wrapS:y.REPEAT,wrapT:y.REPEAT};void 0!==x.sampler&&Object.assign(b,p.json.samplers[x.sampler]),_.push({image:m[x.source],sampler:b,uploaded:!1})}return _}(n,n.images)),{scenes:a,scene:l,nodes:u}=n.json,d=a?a[l||0].nodes:u,h=[];for(const p of d)h.push(rT(u[p],n,r));return function(p,m,_){const y={},x=new Set;for(let b=0;b<p.length;b++){const E=_[m[b]];if(!E.extras)continue;const C=E.extras["mapbox:footprint:version"],S=E.extras["mapbox:footprint:id"];(C||S)&&x.add(b),"1.0.0"===C&&S&&(y[S]=b)}for(let b=0;b<p.length;b++){if(x.has(b))continue;const E=p[b],C=_[m[b]];if(!C.extras)continue;let S=null;E.id in y&&(S=qF(p[y[E.id]].meshes)),S||(S=GF(C)),S&&(E.footprint=hR(S))}if(x.size>0){const b=Array.from(x.values()).sort((E,C)=>E-C);for(let E=b.length-1;E>=0;E--)p.splice(b[E],1)}}(h,d,n.json.nodes),h}function WF(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const t=n.vertexArray.float32,r=n.aabb.min[0]-1,a=n.aabb.min[1]-1,l=64/(n.aabb.max[0]-r+2),u=64/(n.aabb.max[1]-a+2);for(let d=0;d<t.length;d+=3){const h=t[d+2],p=(t[d+0]-r)*l|0,m=(t[d+1]-a)*u|0;h>n.heightmap[64*m+p]&&(n.heightmap[64*m+p]=h)}}function sT(n,t){const r={};r.indexArray=new er,r.indexArray.reserve(4*n.length),r.vertexArray=new Ga,r.vertexArray.reserve(10*n.length),r.colorArray=new Mi,r.vertexArray.reserve(10*n.length);let a=0;for(const d of n){const h=Math.min(10,Math.max(4,1.3*d.height))*t,p=[-d.normal[1],d.normal[0],0],m=Math.min(.29,.1*d.width/d.depth),_=d.width-2*d.depth*t*(m+.01),y=q.scaleAndAdd([],d.pos,p,_/2),x=q.scaleAndAdd([],d.pos,p,-_/2),b=[y[0],y[1],y[2]+d.height],E=[x[0],x[1],x[2]+d.height],C=q.scaleAndAdd([],d.normal,p,m);q.scale(C,C,h);const S=q.scaleAndAdd([],d.normal,p,-m);q.scale(S,S,h),q.add(C,y,C),q.add(S,x,S),y[2]+=.1,x[2]+=.1,r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(y[0],y[1],y[2]),r.vertexArray.emplaceBack(x[0],x[1],x[2]),r.vertexArray.emplaceBack(b[0],b[1],b[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(y[0],y[1],y[2]),r.vertexArray.emplaceBack(x[0],x[1],x[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]);const M=_/h/2;r.colorArray.emplaceBack(-M-m,-1,M,.8),r.colorArray.emplaceBack(M+m,-1,M,.8),r.colorArray.emplaceBack(-M,0,M,1.3),r.colorArray.emplaceBack(M,0,M,1.3),r.colorArray.emplaceBack(M+m,-.8,M,.7),r.colorArray.emplaceBack(M+m,-.8,M,.7),r.colorArray.emplaceBack(0,0,M,1.3),r.colorArray.emplaceBack(0,0,M,1.3),r.colorArray.emplaceBack(M+m,-1.2,M,.8),r.colorArray.emplaceBack(M+m,-1.2,M,.8),r.indexArray.emplaceBack(6+a,4+a,8+a),r.indexArray.emplaceBack(7+a,9+a,5+a),r.indexArray.emplaceBack(0+a,1+a,2+a),r.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const l={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Ne.white,l.pbrMetallicRoughness=u,r.material=l,r.aabb=new ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}Xt(p1,"TriangleGridIndex");const Rf={vector:Qm,raster:ku,"raster-dem":class extends ku{constructor(n,t,r,a){super(n,t,r,a),this.type="raster-dem",this.maxzoom=22,this._options=Yt({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(n,t){const r=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);n.request=Oe(this.map._requestManager.transformRequest(r,gt.Tile),function(u,d,h,p){if(delete n.request,n.aborted)n.state="unloaded",t(null);else if(u)n.state="errored",t(u);else if(d){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:h,expires:p});const _=st.ImageBitmap&&d instanceof st.ImageBitmap&&(null==Ko&&(Ko=st.OffscreenCanvas&&new st.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof st.createImageBitmap),Ko),y=1-(d.width-((m=d.width)<=1?1:Math.pow(2,Math.floor(Math.log(m)/Math.LN2))))/2;y<1||n.neighboringTiles||(n.neighboringTiles=this._getNeighboringTiles(n.tileID));const x=_?d:kt.getImageData(d,y),b={uid:n.uid,coord:n.tileID,source:this.id,scope:this.scope,rawImageData:x,encoding:this.encoding,padding:y,convertToFloat:a};n.actor&&"expired"!==n.state||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",b,l.bind(this),void 0,!0))}var m}.bind(this));const a=this.map?.painter?.terrainUseFloatDEM();function l(u,d){u&&(n.state="errored",t(u)),d&&(n.dem=d,n.dem.onDeserialize(),n.needsHillshadePrepare=!0,n.needsDEMTextureUpload=!0,n.state="loaded",t(null))}}_getNeighboringTiles(n){const t=n.canonical,r=Math.pow(2,t.z),a=(t.x-1+r)%r,l=0===t.x?n.wrap-1:n.wrap,u=(t.x+1+r)%r,d=t.x+1===r?n.wrap+1:n.wrap,h={};return h[new tn(n.overscaledZ,l,t.z,a,t.y).key]={backfilled:!1},h[new tn(n.overscaledZ,d,t.z,u,t.y).key]={backfilled:!1},t.y>0&&(h[new tn(n.overscaledZ,l,t.z,a,t.y-1).key]={backfilled:!1},h[new tn(n.overscaledZ,n.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},h[new tn(n.overscaledZ,d,t.z,u,t.y-1).key]={backfilled:!1}),t.y+1<r&&(h[new tn(n.overscaledZ,l,t.z,a,t.y+1).key]={backfilled:!1},h[new tn(n.overscaledZ,n.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},h[new tn(n.overscaledZ,d,t.z,u,t.y+1).key]={backfilled:!1}),h}unloadTile(n){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.hillshadeFBO&&(n.hillshadeFBO.destroy(),delete n.hillshadeFBO),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded"}},geojson:class extends $i{constructor(n,t,r,a){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(a),this._data=t.data,this._options=Yt({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const l=dt/this.tileSize;this.workerOptions=Yt({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*l,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*l,extent:dt,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:dt,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*l,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(n){this.map=n,this.setData(this._data)}setData(n){return this._data=n,this._updateWorkerData(),this}getClusterExpansionZoom(n,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:n,source:this.id,scope:this.scope},t),this}getClusterChildren(n,t){return this.actor.send("geojson.getClusterChildren",{clusterId:n,source:this.id,scope:this.scope},t),this}getClusterLeaves(n,t,r,a){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:n,limit:t,offset:r},a),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new St("dataloading",{dataType:"source"})),this._loaded=!1;const n=Yt({},this.workerOptions);n.scope=this.scope;const t=this._data;"string"==typeof t?(n.request=this.map._requestManager.transformRequest(kt.resolveURL(t),gt.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(r,a)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new at(r));else{const l={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&a&&a.resourceTiming&&a.resourceTiming[this.id]&&(l.resourceTiming=a.resourceTiming[this.id]),this.fire(new St("data",l)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(n,t){const r=n.actor?"reloadTile":"loadTile";n.actor=this.actor;const a={type:this.type,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:kt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};n.request=this.actor.send(r,a,(l,u)=>(delete n.request,n.unloadVectorData(),n.aborted?t(null):l?t(l):(n.loadVectorData(u,this.map.painter,"reloadTile"===r),t(null))),void 0,"loadTile"===r)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.aborted=!0}unloadTile(n){n.unloadVectorData(),this.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Yt({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ql{constructor(n,t,r,a){super(n,t,r,a),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const n=this.options;this.urls=[];for(const t of n.urls)this.urls.push(this.map._requestManager.transformRequest(t,gt.Source).url);!function(t,r){const a=st.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let l=0;l<t.length;l++){const u=st.document.createElement("source");Ut(t[l])||(a.crossOrigin="Anonymous"),u.src=t[l],a.appendChild(u)}}(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new at(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const t=this.video.seekable;n<t.start(0)||n>t.end(0)?this.fire(new at(new It(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const n=this.map.painter.context,t=n.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new ir(n,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(n)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ql,model:class extends $i{constructor(n,t,r,a){super(),this.id=n,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const n=[];for(const t in this._options.models){const r=this._options.models[t],a=f1(this.map._requestManager.transformRequest(r.uri,gt.Model).url).then(l=>{if(!l)return;const u=oT(l),d=new Hb(t,r.position,r.orientation,u);d.computeBoundsAndApplyParent(),this.models.push(d)}).catch(l=>{this.fire(new at(new Error(`Could not load model ${t} from ${r.uri}: ${l.message}`)))});n.push(a)}return Promise.allSettled(n).then(()=>{this._loaded=!0,this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new at(new Error(`Could not load models: ${t.message}`)))})}onAdd(n){this.map=n,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(n,t){}serialize(){return{type:"model"}}},"batched-model":class extends $i{constructor(n,t,r,a){super(),this.type="batched-model",this.id=n,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(a)}onAdd(n){this.map=n,this.load()}load(n){this._loaded=!1,this.fire(new St("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=nv(this._options,this.map._requestManager,t,r,(a,l)=>{this._tileJSONRequest=null,this._loaded=!0,a?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new at(a))):l&&(Yt(this,l),l.bounds&&(this.tileBounds=new Jm(l.bounds,this.minzoom,this.maxzoom)),iu(l.tiles,this.map._requestManager._customAccessToken),this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)})}hasTransition(){return!1}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loaded(){return this._loaded}loadTile(n,t){const r=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(r,gt.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(n.actor&&"expired"!==n.state)if("loading"===n.state)n.reloadCallback=t;else{if(n.buckets){const u=Object.values(n.buckets);for(const d of u)d.dirty=!0;return void(n.state="loaded")}n.request=n.actor.send("reloadTile",a,l.bind(this))}else n.actor=this.dispatcher.getActor(),n.request=n.actor.send("loadTile",a,l.bind(this),void 0,!0);function l(u,d){return n.aborted?t(null):u&&404!==u.status?t(u):(d&&(d.resourceTiming&&(n.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&n.setExpiryData(d),n.buckets={...n.buckets,...d.buckets}),n.state="loaded",void t(null))}}serialize(){return Yt({},this._options)}},canvas:class extends ql{constructor(n,t,r,a){super(n,t,r,a),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(l=>!Array.isArray(l)||2!==l.length||l.some(u=>"number"!=typeof u))||this.fire(new at(new It(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new at(new It(`sources.${n}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new at(new It(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof st.HTMLCanvasElement||this.fire(new at(new It(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new at(new It(`sources.${n}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof st.HTMLCanvasElement?this.options.canvas:st.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new at(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!n&&!this._playing||this.texture instanceof jy||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ir(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}},custom:class extends $i{constructor(n,t,r,a){super(),this.id=n,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(a),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new at(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new at(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jm(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Yt(this,ns(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return ns(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new St("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(n){this._map=n,this._loaded=!1,this.fire(new St("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(n),this.load()}onRemove(n){this._implementation.onRemove&&this._implementation.onRemove(n)}hasTile(n){if(this._implementation.hasTile){const{x:t,y:r,z:a}=n.canonical;return this._implementation.hasTile({x:t,y:r,z:a})}return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,t){const{x:r,y:a,z:l}=n.tileID.canonical,u=new st.AbortController;n.request=Promise.resolve(this._implementation.loadTile({x:r,y:a,z:l},{signal:u.signal})).then(function(d){return delete n.request,n.aborted?(n.state="unloaded",t(null)):void 0===d?(n.state="errored",t(null)):null===d?(this.loadTileData(n,{width:this.tileSize,height:this.tileSize,data:null}),n.state="loaded",t(null)):(h=d)instanceof st.ImageData||h instanceof st.HTMLCanvasElement||h instanceof st.ImageBitmap||h instanceof st.HTMLImageElement?(this.loadTileData(n,d),n.state="loaded",void t(null)):(n.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var h}.bind(this)).catch(d=>{20!==d.code&&(n.state="errored",t(d))}),n.request.cancel=()=>u.abort()}loadTileData(n,t){ku.loadTileData(n,t,this._map.painter)}unloadTileData(n){ku.unloadTileData(n,this._map.painter)}unloadTile(n,t){if(this.unloadTileData(n),this._implementation.unloadTile){const{x:r,y:a,z:l}=n.tileID.canonical;this._implementation.unloadTile({x:r,y:a,z:l})}t()}abortTile(n,t){n.request&&n.request.cancel&&(n.request.cancel(),delete n.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(n=>({x:n.canonical.x,y:n.canonical.y,z:n.canonical.z}))}_clearTiles(){const n=Jr(this.id,this.scope);this._map.style.clearSource(n)}_update(){this.fire(new St("data",{dataType:"source",sourceDataType:"content"}))}}},m1=function(n,t,r,a){const l=new Rf[t.type](n,t,r,a);if(l.id!==n)throw new Error(`Expected Source id to be ${n} instead of ${l.id}`);return Rr(["load","abort","unload","serialize","prepare"],l),l};function fR(n,t){const r=rt.identity([]);return rt.scale(r,r,[.5*n.width,.5*-n.height,1]),rt.translate(r,r,[1,-1,0]),rt.multiply(r,r,n.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(r)}function aT(n,t,r,a,l,u,d,h=!1){const p=n.tilesIn(a,d,h);p.sort(lT);const m=[];for(const y of p)m.push({wrappedTileID:y.tile.tileID.wrapped().key,queryResults:y.tile.queryRenderedFeatures(t,r,n._state,y,l,u,fR(n.transform,y.tile.tileID),h)});const _=function(y){const x={},b={};for(const E of y){const C=E.queryResults,S=E.wrappedTileID,M=b[S]=b[S]||{};for(const D in C){const R=C[D],P=M[D]=M[D]||{},I=x[D]=x[D]||[];for(const O of R)P[O.featureIndex]||(P[O.featureIndex]=!0,I.push(O))}}return x}(m);for(const y in _)_[y].forEach(x=>{const b=x.feature,E=b.layer;E&&"background"!==E.type&&"sky"!==E.type&&"slot"!==E.type&&(b.source=E.source,E["source-layer"]&&(b.sourceLayer=E["source-layer"]),b.state=void 0!==b.id?n.getFeatureState(E["source-layer"],b.id):{})});return _}function rg(n,t){const r=n.getRenderableIds().map(u=>n.getTileByID(u)),a=[],l={};for(let u=0;u<r.length;u++){const d=r[u],h=d.tileID.canonical.key;l[h]||(l[h]=!0,d.querySourceFeatures(a,t))}return a}function lT(n,t){const r=n.tileID,a=t.tileID;return r.overscaledZ-a.overscaledZ||r.canonical.y-a.canonical.y||r.wrap-a.wrap||r.canonical.x-a.canonical.x}class pR{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(const t in this.style._mergedLayers){const r=this.style._mergedLayers[t];if("fill-extrusion"===r.type)this.layers.push(r);else if("model"===r.type){const a=this.style.getLayerSource(r);a&&"batched-model"===a.type&&this.layers.push(r)}}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(let l=0;l<this.layers.length;++l){const u=this.layers[l],d=this.style.getLayerSourceCache(u);let h=1;"fill-extrusion"===u.type&&(h=u.paint.get("fill-extrusion-opacity")>0?u.paint.get("fill-extrusion-vertical-scale"):0);let p=d?d.getTile(r):null;if(!p&&d&&r.canonical.z>d.getSource().minzoom){let m=r.scaledTo(Math.min(d.getSource().maxzoom,r.overscaledZ-1));for(;m.overscaledZ>=d.getSource().minzoom&&(p=d.getTile(m),!p&&0!==m.overscaledZ);)m=m.scaledTo(m.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:p?p.getBucket(u):null,tileID:p?p.tileID:r,verticalScale:h})}t.hasAnyZOffset=!1;let a=!1;for(let l=0;l<t.symbolInstances.length;l++){const u=t.symbolInstances.get(l),d=u.zOffset,h=this._getHeightAtTileOffset(r,u.tileAnchorX,u.tileAnchorY);u.zOffset=-1!==h?h:d,a||d===u.zOffset||(a=!0),t.hasAnyZOffset||0===u.zOffset||(t.hasAnyZOffset=!0)}a&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,a,l){let u=r,d=a;if(t.canonical.z!==l.canonical.z){const h=l.canonical,p=1/(1<<t.canonical.z-h.z);u=(r+t.canonical.x*dt)*p-h.x*dt|0,d=(a+t.canonical.y*dt)*p-h.y*dt|0}return{tileX:u,tileY:d}}_getHeightAtTileOffset(t,r,a){let l;for(let u=0;u<this.layers.length;++u){if("fill-extrusion"!==this.layers[u].type)continue;const{bucket:d,tileID:h,verticalScale:p}=this.currentBuildingBuckets[u];if(!d)continue;const{tileX:m,tileY:_}=this._mapCoordToOverlappingTile(t,r,a,h),y=d.getHeightAtTileCoord(m,_);if(y&&void 0!==y.height){if(!y.hidden)return y.height*p;l=y.height}}for(let u=0;u<this.layers.length;++u){if("model"!==this.layers[u].type)continue;const{bucket:d,tileID:h}=this.currentBuildingBuckets[u];if(!d)continue;const{tileX:p,tileY:m}=this._mapCoordToOverlappingTile(t,r,a,h),_=d.getHeightAtTileCoord(p,m);if(_&&!_.hidden)return void 0===_.height&&void 0!==l?Math.min(_.maxHeight,l)*_.verticalScale:(_.height||0)*_.verticalScale}return-1}}var cT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function mR(n,t){const r={};for(const a in n)"ref"!==a&&(r[a]=n[a]);return cT.forEach(a=>{a in t&&(r[a]=t[a])}),r}function gR(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=mR(n[r],t[n[r].ref]));return n}const xn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function g1(n,t,r){r.push({command:xn.addSource,args:[n,t[n]]})}function uT(n,t,r){t.push({command:xn.removeSource,args:[n]}),r[n]=!0}function _R(n,t,r,a){uT(n,r,a),g1(n,t,r)}function og(n,t,r){let a;for(a in n[r])if(n[r].hasOwnProperty(a)&&"data"!==a&&!cn(n[r][a],t[r][a]))return!1;for(a in t[r])if(t[r].hasOwnProperty(a)&&"data"!==a&&!cn(n[r][a],t[r][a]))return!1;return!0}function sv(n,t,r,a,l,u){let d;for(d in t=t||{},n=n||{})n.hasOwnProperty(d)&&(cn(n[d],t[d])||r.push({command:u,args:[a,d,t[d],l]}));for(d in t)t.hasOwnProperty(d)&&!n.hasOwnProperty(d)&&(cn(n[d],t[d])||r.push({command:u,args:[a,d,t[d],l]}))}function sg(n){return n.id}function av(n,t){return n[t.id]=t,n}class dT{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=Jt(t,0,1);let r=1,a=this._distances[r];const l=t*this.paddedLength+this.padding;for(;a<l&&r<this._distances.length;)a=this._distances[++r];const u=r-1,d=this._distances[u],h=a-d,p=h>0?(l-d)/h:0;return this.points[u].mult(1-p).add(this.points[r].mult(p))}}class hT{constructor(t,r,a){const l=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(r/a);for(let d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,a,l,u){this._forEachCell(r,a,l,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(u)}insertCircle(t,r,a,l){this._forEachCell(r-l,a-l,r+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(a),this.circles.push(l)}_insertBoxCell(t,r,a,l,u,d){this.boxCells[u].push(d)}_insertCircleCell(t,r,a,l,u,d){this.circleCells[u].push(d)}_query(t,r,a,l,u,d){if(a<0||t>this.width||l<0||r>this.height)return!u&&[];const h=[];if(t<=0&&r<=0&&this.width<=a&&this.height<=l){if(u)return!0;for(let p=0;p<this.boxKeys.length;p++)h.push({key:this.boxKeys[p],x1:this.bboxes[4*p],y1:this.bboxes[4*p+1],x2:this.bboxes[4*p+2],y2:this.bboxes[4*p+3]});for(let p=0;p<this.circleKeys.length;p++){const m=this.circles[3*p],_=this.circles[3*p+1],y=this.circles[3*p+2];h.push({key:this.circleKeys[p],x1:m-y,y1:_-y,x2:m+y,y2:_+y})}return d?h.filter(d):h}return this._forEachCell(t,r,a,l,this._queryCell,h,{hitTest:u,seenUids:{box:{},circle:{}}},d),u?h.length>0:h}_queryCircle(t,r,a,l,u){const d=t-a,h=t+a,p=r-a,m=r+a;if(h<0||d>this.width||m<0||p>this.height)return!l&&[];const _=[];return this._forEachCell(d,p,h,m,this._queryCellCircle,_,{hitTest:l,circle:{x:t,y:r,radius:a},seenUids:{box:{},circle:{}}},u),l?_.length>0:_}query(t,r,a,l,u){return this._query(t,r,a,l,!1,u)}hitTest(t,r,a,l,u){return this._query(t,r,a,l,!0,u)}hitTestCircle(t,r,a,l){return this._queryCircle(t,r,a,!0,l)}_queryCell(t,r,a,l,u,d,h,p){const m=h.seenUids,_=this.boxCells[u];if(null!==_){const x=this.bboxes;for(const b of _)if(!m.box[b]){m.box[b]=!0;const E=4*b;if(t<=x[E+2]&&r<=x[E+3]&&a>=x[E+0]&&l>=x[E+1]&&(!p||p(this.boxKeys[b]))){if(h.hitTest)return d.push(!0),!0;d.push({key:this.boxKeys[b],x1:x[E],y1:x[E+1],x2:x[E+2],y2:x[E+3]})}}}const y=this.circleCells[u];if(null!==y){const x=this.circles;for(const b of y)if(!m.circle[b]){m.circle[b]=!0;const E=3*b;if(this._circleAndRectCollide(x[E],x[E+1],x[E+2],t,r,a,l)&&(!p||p(this.circleKeys[b]))){if(h.hitTest)return d.push(!0),!0;{const C=x[E],S=x[E+1],M=x[E+2];d.push({key:this.circleKeys[b],x1:C-M,y1:S-M,x2:C+M,y2:S+M})}}}}}_queryCellCircle(t,r,a,l,u,d,h,p){const m=h.circle,_=h.seenUids,y=this.boxCells[u];if(null!==y){const b=this.bboxes;for(const E of y)if(!_.box[E]){_.box[E]=!0;const C=4*E;if(this._circleAndRectCollide(m.x,m.y,m.radius,b[C+0],b[C+1],b[C+2],b[C+3])&&(!p||p(this.boxKeys[E])))return d.push(!0),!0}}const x=this.circleCells[u];if(null!==x){const b=this.circles;for(const E of x)if(!_.circle[E]){_.circle[E]=!0;const C=3*E;if(this._circlesCollide(b[C],b[C+1],b[C+2],m.x,m.y,m.radius)&&(!p||p(this.circleKeys[E])))return d.push(!0),!0}}}_forEachCell(t,r,a,l,u,d,h,p){const m=this._convertToXCellCoord(t),_=this._convertToYCellCoord(r),y=this._convertToXCellCoord(a),x=this._convertToYCellCoord(l);for(let b=m;b<=y;b++)for(let E=_;E<=x;E++)if(u.call(this,t,r,a,l,this.xCellCount*E+b,d,h,p))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,a,l,u,d){const h=l-t,p=u-r,m=a+d;return m*m>h*h+p*p}_circleAndRectCollide(t,r,a,l,u,d,h){const p=(d-l)/2,m=Math.abs(t-(l+p));if(m>p+a)return!1;const _=(h-u)/2,y=Math.abs(r-(u+_));if(y>_+a)return!1;if(m<=p||y<=_)return!0;const x=m-p,b=y-_;return x*x+b*b<=a*a}}const al=100;class yR{constructor(t,r,a=new hT(t.width+200,t.height+200,25),l=new hT(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+al,this.screenBottomBoundary=t.height+al,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,a,l,u,d,h,p){let m=a.projectedAnchorX,_=a.projectedAnchorY,y=a.projectedAnchorZ;const x=a.elevation,b=a.tileID,E=t.getProjection();if(x&&b){const[O,F,L]=E.upVector(b.canonical,a.tileAnchorX,a.tileAnchorY),N=E.upVectorScale(b.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;m+=O*x*N,_+=F*x*N,y+=L*x*N}const C=this.projectAndGetPerspectiveRatio(h,m,_,y,a.tileID,"globe"===E.name||!!x||this.transform.pitch>0,E),S=d*C.perspectiveRatio,M=(a.x1*r+l.x-a.padding)*S+C.point.x,D=(a.y1*r+l.y-a.padding)*S+C.point.y,R=(a.x2*r+l.x+a.padding)*S+C.point.x,P=(a.y2*r+l.y+a.padding)*S+C.point.y,I=C.perspectiveRatio<=.55||C.occluded;return!this.isInsideGrid(M,D,R,P)||!u&&this.grid.hitTest(M,D,R,P,p)||I?{box:[],offscreen:!1,occluded:C.occluded}:{box:[M,D,R,P],offscreen:this.isOffscreen(M,D,R,P),occluded:!1}}placeCollisionCircles(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C){const S=[],M=this.transform.elevation,D=t.getProjection(),R=M?M.getAtTileOffsetFunc(C,this.transform.center.lat,this.transform.worldSize,D):null,P=new nt(a.tileAnchorX,a.tileAnchorY);let{x:I,y:O,z:F}=D.projectTilePoint(P.x,P.y,C.canonical);if(R){const[it,X,Y]=R(P);I+=it,O+=X,F+=Y}const L="globe"===D.name,N=this.projectAndGetPerspectiveRatio(h,I,O,F,C,L||!!M||this.transform.pitch>0,D),{perspectiveRatio:z}=N,U=(y?d/z:d*z)/Lr,V=Ma(I,O,F,p),G=N.signedDistanceFromCamera>0?Ef(U,u,a.lineOffsetX*U,a.lineOffsetY*U,!1,V,P,a,l,p,{},M&&!y?R:null,y&&!!M,D,C,y):null;let j=!1,Z=!1,et=!0;if(G&&!N.occluded){const it=.5*b*z+E,X=new nt(-100,-100),Y=new nt(this.screenRightBoundary,this.screenBottomBoundary),ot=new dT,{first:lt,last:ht}=G,mt=lt.path.length;let vt=[];for(let Rt=mt-1;Rt>=1;Rt--)vt.push(lt.path[Rt]);for(let Rt=1;Rt<ht.path.length;Rt++)vt.push(ht.path[Rt]);const ct=2.5*it;m&&(vt=vt.map(([Rt,Vt,jt],Ht)=>(R&&!L&&(jt=R(Ht<mt-1?lt.tilePath[mt-1-Ht]:ht.tilePath[Ht-mt+2])[2]),Ma(Rt,Vt,jt,m))),vt.some(Rt=>Rt[3]<=0)&&(vt=[]));let ft=[];if(vt.length>0){let Rt=1/0,Vt=-1/0,jt=1/0,Ht=-1/0;for(const re of vt)Rt=Math.min(Rt,re[0]),jt=Math.min(jt,re[1]),Vt=Math.max(Vt,re[0]),Ht=Math.max(Ht,re[1]);Vt>=X.x&&Rt<=Y.x&&Ht>=X.y&&jt<=Y.y&&(ft=[vt.map(re=>new nt(re[0],re[1]))],(Rt<X.x||Vt>Y.x||jt<X.y||Ht>Y.y)&&(ft=Is(ft,X.x,X.y,Y.x,Y.y)))}for(const Rt of ft){ot.reset(Rt,.25*it);let Vt=0;Vt=ot.length<=.5*it?1:Math.ceil(ot.paddedLength/ct)+1;for(let jt=0;jt<Vt;jt++){const Ht=jt/Math.max(Vt-1,1),re=ot.lerp(Ht),ye=re.x+al,je=re.y+al;S.push(ye,je,it,0);const rn=ye-it,Re=je-it,Me=ye+it,ge=je+it;if(et=et&&this.isOffscreen(rn,Re,Me,ge),Z=Z||this.isInsideGrid(rn,Re,Me,ge),!r&&this.grid.hitTestCircle(ye,je,it,x)&&(j=!0,!_))return{circles:[],offscreen:!1,collisionDetected:j,occluded:!1}}}}return{circles:!_&&j||!Z?[]:S,offscreen:et,collisionDetected:j,occluded:N.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let a=1/0,l=1/0,u=-1/0,d=-1/0;for(const _ of t){const y=new nt(_.x+al,_.y+al);a=Math.min(a,y.x),l=Math.min(l,y.y),u=Math.max(u,y.x),d=Math.max(d,y.y),r.push(y)}const h=this.grid.query(a,l,u,d).concat(this.ignoredGrid.query(a,l,u,d)),p={},m={};for(const _ of h){const y=_.key;void 0===p[y.bucketInstanceId]&&(p[y.bucketInstanceId]={}),p[y.bucketInstanceId][y.featureIndex]||qh(r,[new nt(_.x1,_.y1),new nt(_.x2,_.y1),new nt(_.x2,_.y2),new nt(_.x1,_.y2)])&&(p[y.bucketInstanceId][y.featureIndex]=!0,void 0===m[y.bucketInstanceId]&&(m[y.bucketInstanceId]=[]),m[y.bucketInstanceId].push(y.featureIndex))}return m}insertCollisionBox(t,r,a,l,u){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:l,collisionGroupID:u},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,a,l,u){const d=r?this.ignoredGrid:this.grid,h={bucketInstanceId:a,featureIndex:l,collisionGroupID:u};for(let p=0;p<t.length;p+=4)d.insertCircle(h,t[p],t[p+1],t[p+2])}projectAndGetPerspectiveRatio(t,r,a,l,u,d,h){const p=[r,a,l,1];let m=!1;l||this.transform.pitch>0?(Ln.transformMat4(p,p,t),this.fogState&&u&&"globe"!==h.name&&(m=function(x,b,E,C,S,M){const D=M.calculateFogTileMatrix(S),R=[b,E,C];return q.transformMat4(R,R,D),Ym(x,q.length(R),M.pitch,M._fov)}(this.fogState,r,a,l,u.toUnwrapped(),this.transform)>.9)):Ub(p,p,t);const _=p[3];return{point:new nt((p[0]/_+1)/2*this.transform.width+al,(-p[1]/_+1)/2*this.transform.height+al),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(h)/_*.5,1.5),signedDistanceFromCamera:_,occluded:d&&p[2]>_||m}}isOffscreen(t,r,a,l){return a<al||t>=this.screenRightBoundary||l<al||r>this.screenBottomBoundary}isInsideGrid(t,r,a,l){return a>=0&&t<this.gridRightBoundary&&l>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=rt.identity([]);return rt.translate(t,t,[-100,-100,0]),t}}function ag(n,t,r){const a=t.createTileMatrix(n,n.worldSize,r.toUnwrapped());return rt.multiply(new Float32Array(16),n.projMatrix,a)}function vR(n,t,r){if(t.projection.name===r.projection.name)return n.projMatrix;const a=r.clone();return a.setProjection(t.projection),ag(a,t.getProjection(),n)}function lv(n,t,r){return t.name===r.projection.name?n.projMatrix:ag(r,t,n)}class _1{constructor(t,r,a,l){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):l&&a?1:0,this.placed=a}isHidden(){return 0===this.opacity&&!this.placed}}class lg{constructor(t,r,a,l,u,d=!1){this.text=new _1(t?t.text:null,r,a,u),this.icon=new _1(t?t.icon:null,r,l,u),this.clipped=d}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class y1{constructor(t,r,a,l=!1){this.text=t,this.icon=r,this.skipFade=a,this.clipped=l}}class xR{constructor(){this.invProjMatrix=rt.create(),this.viewportMatrix=rt.create(),this.circles=[]}}class v1{constructor(t,r,a,l,u){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=u}}class bR{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:a=>a.collisionGroupID===r}}return this.collisionGroups[t]}}function x1(n,t,r,a,l){const{horizontalAlign:u,verticalAlign:d}=Ty(n),h=-(u-.5)*t,p=-(d-.5)*r,m=Cm(n,a);return new nt(h+m[0]*l,p+m[1]*l)}function b1(n,t,r,a,l){const u=new nt(n,t);return r&&u._rotate(a?l:-l),u}class wR{constructor(t,r,a,l,u,d){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new yR(this.transform,u),this.buildingIndex=d,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new bR(a),this.collisionCircleArrays={},this.prevPlacement=l,l&&(l.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,a,l){const u=a.getBucket(r),d=a.latestFeatureIndex;if(!u||!d||r.fqid!==u.layerIds[0])return;const h=u.layers[0].layout,p=a.collisionBoxArray,m=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),_=a.tileSize/dt,y=a.tileID.toUnwrapped();this.transform.setProjection(u.projection);const x=(b=a.tileID,E=u.getProjection(),C=this.transform,E.name===this.projection?C.calculateProjMatrix(b.toUnwrapped()):ag(C,E,b));var b,E,C;const S="map"===h.get("text-pitch-alignment"),M="map"===h.get("text-rotation-alignment");r.compileFilter();const D=r.dynamicFilter(),R=r.dynamicFilterNeedsFeature(),P=this.transform.calculatePixelsToTileUnitsMatrix(a),I=wf(x,a.tileID.canonical,S,M,this.transform,u.getProjection(),P);let O=null;if(S){const N=Bb(x,a.tileID.canonical,S,M,this.transform,u.getProjection(),P);O=rt.multiply([],this.transform.labelPlaneMatrix,N)}let F=null;D&&a.latestFeatureIndex&&(F={unwrappedTileID:y,dynamicFilter:D,dynamicFilterNeedsFeature:R,featureIndex:a.latestFeatureIndex}),this.retainedQueryData[u.bucketInstanceId]=new v1(u.bucketInstanceId,d,u.sourceLayerIndex,u.index,a.tileID);const L={bucket:u,layout:h,posMatrix:x,textLabelPlaneMatrix:I,labelToScreenMatrix:O,clippingData:F,scale:m,textPixelRatio:_,holdingForFade:a.holdingForFade(),collisionBoxArray:p,partiallyEvaluatedTextSize:Ic(u.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Ic(u.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(l)for(const N of u.sortKeyRanges){const{sortKey:z,symbolInstanceStart:U,symbolInstanceEnd:V}=N;t.push({sortKey:z,symbolInstanceStart:U,symbolInstanceEnd:V,parameters:L})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:L})}attemptAnchorPlacement(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D){const{textOffset0:R,textOffset1:P,crossTileID:I}=x,O=[R,P],F=x1(t,a,l,O,u),L=this.collisionIndex.placeCollisionBox(E,u,r,b1(F.x,F.y,d,h,this.transform.angle),y,p,m,_.predicate);if(S){const N=E.getSymbolInstanceIconSize(D,this.transform.zoom,x.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(E,N,S,b1(F.x,F.y,d,h,this.transform.angle),y,p,m,_.predicate).box.length)return}if(L.box.length>0){let N;return this.prevPlacement&&this.prevPlacement.variableOffsets[I]&&this.prevPlacement.placements[I]&&this.prevPlacement.placements[I].text&&(N=this.prevPlacement.variableOffsets[I].anchor),this.variableOffsets[I]={textOffset:O,width:a,height:l,anchor:t,textScale:u,prevAnchor:N},this.markUsedJustification(E,t,x,C),E.allowVerticalPlacement&&(this.markUsedOrientation(E,C,x),this.placedOrientations[I]=C),{shift:F,placedGlyphBoxes:L}}}placeLayerBucketPart(t,r,a,l){const{bucket:u,layout:d,posMatrix:h,textLabelPlaneMatrix:p,labelToScreenMatrix:m,clippingData:_,textPixelRatio:y,holdingForFade:x,collisionBoxArray:b,partiallyEvaluatedTextSize:E,partiallyEvaluatedIconSize:C,collisionGroup:S}=t.parameters,M=d.get("text-optional"),D=d.get("icon-optional"),R=d.get("text-allow-overlap"),P=d.get("icon-allow-overlap"),I="map"===d.get("text-rotation-alignment"),O="map"===d.get("text-pitch-alignment"),F="viewport-y"===d.get("symbol-z-order"),L=d.get("symbol-z-elevate");this.transform.setProjection(u.projection);let N=R&&(P||!u.hasIconData()||D),z=P&&(R||!u.hasTextData()||M);!u.collisionArrays&&b&&u.deserializeCollisionBoxes(b),a&&l&&u.updateCollisionDebugBuffers(this.transform.zoom,b);const U=(V,G,j)=>{const{crossTileID:Z,numVerticalGlyphVertices:et}=V;if(_){const Me={zoom:this.transform.zoom,pitch:this.transform.pitch};let ge=null;if(_.dynamicFilterNeedsFeature){const ue=this.retainedQueryData[u.bucketInstanceId];ge=_.featureIndex.loadFeature({featureIndex:V.featureIndex,bucketIndex:ue.bucketIndex,sourceLayerIndex:ue.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,_.dynamicFilter)(Me,ge,this.retainedQueryData[u.bucketInstanceId].tileID.canonical,new nt(V.tileAnchorX,V.tileAnchorY),this.transform.calculateDistanceTileData(_.unwrappedTileID)))return this.placements[Z]=new y1(!1,!1,!1,!0),void r.add(Z)}if(r.has(Z))return;if(x)return void(this.placements[Z]=new y1(!1,!1,!1));let it=!1,X=!1,Y=!0,ot=!1,lt=!1,ht=null,mt={box:null,offscreen:null,occluded:null},vt={box:null,offscreen:null,occluded:null},ct=null,ft=null,Rt=null,Vt=0,jt=0,Ht=0;j.textFeatureIndex?Vt=j.textFeatureIndex:V.useRuntimeCollisionCircles&&(Vt=V.featureIndex),j.verticalTextFeatureIndex&&(jt=j.verticalTextFeatureIndex);const re=Me=>{Me.tileID=this.retainedQueryData[u.bucketInstanceId].tileID;const ge=this.transform.elevation;Me.elevation=V.zOffset+(ge?ge.getAtTileOffset(Me.tileID,Me.tileAnchorX,Me.tileAnchorY):0)},ye=j.textBox;if(ye){re(ye);const Me=ue=>{let Le=ti.horizontal;if(u.allowVerticalPlacement&&!ue&&this.prevPlacement){const ln=this.prevPlacement.placedOrientations[Z];ln&&(this.placedOrientations[Z]=ln,Le=ln,this.markUsedOrientation(u,Le,V))}return Le},ge=(ue,Le)=>{if(u.allowVerticalPlacement&&et>0&&j.verticalTextBox){for(const ln of u.writingModes)if(ln===ti.vertical?(mt=Le(),vt=mt):mt=ue(),mt&&mt.box&&mt.box.length)break}else mt=ue()};if(d.get("text-variable-anchor")){let ue=d.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z]){const Be=this.prevPlacement.variableOffsets[Z];ue.indexOf(Be.anchor)>0&&(ue=ue.filter(Zn=>Zn!==Be.anchor),ue.unshift(Be.anchor))}const Le=(Be,Zn,Ti)=>{const di=u.getSymbolInstanceTextSize(E,V,this.transform.zoom,G),ei=(Be.x2-Be.x1)*di+2*Be.padding,ur=(Be.y2-Be.y1)*di+2*Be.padding,vi=V.hasIconTextFit&&!P?Zn:null;vi&&re(vi);let hi={box:[],offscreen:!1,occluded:!1};const Gn=R?2*ue.length:ue.length;for(let Qo=0;Qo<Gn;++Qo){const cl=this.attemptAnchorPlacement(ue[Qo%ue.length],Be,ei,ur,di,I,O,y,h,S,Qo>=ue.length,V,G,u,Ti,vi,E,C);if(cl&&(hi=cl.placedGlyphBoxes,hi&&hi.box&&hi.box.length)){it=!0,ht=cl.shift;break}}return hi};ge(()=>Le(ye,j.iconBox,ti.horizontal),()=>{const Be=j.verticalTextBox;return Be&&re(Be),u.allowVerticalPlacement&&!(mt&&mt.box&&mt.box.length)&&et>0&&Be?Le(Be,j.verticalIconBox,ti.vertical):{box:null,offscreen:null,occluded:null}}),mt&&(it=mt.box,Y=mt.offscreen,ot=mt.occluded);const ln=Me(!(!mt||!mt.box));if(!it&&this.prevPlacement){const Be=this.prevPlacement.variableOffsets[Z];Be&&(this.variableOffsets[Z]=Be,this.markUsedJustification(u,Be.anchor,V,ln))}}else{const ue=(Le,ln)=>{const Be=u.getSymbolInstanceTextSize(E,V,this.transform.zoom,G),Zn=this.collisionIndex.placeCollisionBox(u,Be,Le,new nt(0,0),R,y,h,S.predicate);return Zn&&Zn.box&&Zn.box.length&&(this.markUsedOrientation(u,ln,V),this.placedOrientations[Z]=ln),Zn};ge(()=>ue(ye,ti.horizontal),()=>{const Le=j.verticalTextBox;return u.allowVerticalPlacement&&et>0&&Le?(re(Le),ue(Le,ti.vertical)):{box:null,offscreen:null,occluded:null}}),Me(!!(mt&&mt.box&&mt.box.length))}}if(ct=mt,it=ct&&ct.box&&ct.box.length>0,Y=ct&&ct.offscreen,ot=ct&&ct.occluded,V.useRuntimeCollisionCircles){const Me=u.text.placedSymbolArray.get(V.centerJustifiedTextSymbolIndex>=0?V.centerJustifiedTextSymbolIndex:V.verticalPlacedTextSymbolIndex),ge=bm(u.textSizeData,E,Me),ue=d.get("text-padding");ft=this.collisionIndex.placeCollisionCircles(u,R,Me,u.lineVertexArray,u.glyphOffsetArray,ge,h,p,m,a,O,S.predicate,V.collisionCircleDiameter*ge/Lr,ue,this.retainedQueryData[u.bucketInstanceId].tileID),it=R||ft.circles.length>0&&!ft.collisionDetected,Y=Y&&ft.offscreen,ot=ft.occluded}if(j.iconFeatureIndex&&(Ht=j.iconFeatureIndex),j.iconBox){const Me=ge=>{re(ge);const ue=V.hasIconTextFit&&ht?b1(ht.x,ht.y,I,O,this.transform.angle):new nt(0,0),Le=u.getSymbolInstanceIconSize(C,this.transform.zoom,V.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(u,Le,ge,ue,P,y,h,S.predicate)};vt&&vt.box&&vt.box.length&&j.verticalIconBox?(Rt=Me(j.verticalIconBox),X=Rt.box.length>0):(Rt=Me(j.iconBox),X=Rt.box.length>0),Y=Y&&Rt.offscreen,lt=Rt.occluded}const je=M||0===V.numHorizontalGlyphVertices&&0===et,rn=D||0===V.numIconVertices;if(je||rn?rn?je||(X=X&&it):it=X&&it:X=it=X&&it,it&&ct&&ct.box&&this.collisionIndex.insertCollisionBox(ct.box,d.get("text-ignore-placement"),u.bucketInstanceId,vt&&vt.box&&jt?jt:Vt,S.ID),X&&Rt&&this.collisionIndex.insertCollisionBox(Rt.box,d.get("icon-ignore-placement"),u.bucketInstanceId,Ht,S.ID),ft&&(it&&this.collisionIndex.insertCollisionCircles(ft.circles,d.get("text-ignore-placement"),u.bucketInstanceId,Vt,S.ID),a)){const Me=u.bucketInstanceId;let ge=this.collisionCircleArrays[Me];void 0===ge&&(ge=this.collisionCircleArrays[Me]=new xR);for(let ue=0;ue<ft.circles.length;ue+=4)ge.circles.push(ft.circles[ue+0]),ge.circles.push(ft.circles[ue+1]),ge.circles.push(ft.circles[ue+2]),ge.circles.push(ft.collisionDetected?1:0)}const Re="globe"!==u.projection.name;N=N&&(Re||!ot),z=z&&(Re||!lt),this.placements[Z]=new y1(it||N,X||z,Y||u.justReloaded),r.add(Z)};if(L&&this.buildingIndex&&(this.buildingIndex.updateZOffset(u,this.retainedQueryData[u.bucketInstanceId].tileID),u.updateZOffset()),F){const V=u.getSortedSymbolIndexes(this.transform.angle);for(let G=V.length-1;G>=0;--G){const j=V[G];U(u.symbolInstances.get(j),j,u.collisionArrays[j])}u.hasAnyZOffset&&tt(`${u.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(u.hasAnyZOffset){const V=u.getSortedIndexesByZOffset();for(let G=0;G<V.length;++G){const j=V[G];U(u.symbolInstances.get(j),j,u.collisionArrays[j])}}else for(let V=t.symbolInstanceStart;V<t.symbolInstanceEnd;V++)U(u.symbolInstances.get(V),V,u.collisionArrays[V]);if(a&&u.bucketInstanceId in this.collisionCircleArrays){const V=this.collisionCircleArrays[u.bucketInstanceId];rt.invert(V.invProjMatrix,h),V.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(t,r,a,l){const{leftJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,rightJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:p,crossTileID:m}=a,_=Ry(r),y=l===ti.vertical?p:"left"===_?u:"center"===_?d:"right"===_?h:-1;u>=0&&(t.text.placedSymbolArray.get(u).crossTileID=y>=0&&u!==y?0:m),d>=0&&(t.text.placedSymbolArray.get(d).crossTileID=y>=0&&d!==y?0:m),h>=0&&(t.text.placedSymbolArray.get(h).crossTileID=y>=0&&h!==y?0:m),p>=0&&(t.text.placedSymbolArray.get(p).crossTileID=y>=0&&p!==y?0:m)}markUsedOrientation(t,r,a){const l=r===ti.horizontal||r===ti.horizontalOnly?r:0,u=r===ti.vertical?r:0,{leftJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:h,rightJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:m}=a,_=t.text.placedSymbolArray;d>=0&&(_.get(d).placedOrientation=l),h>=0&&(_.get(h).placedOrientation=l),p>=0&&(_.get(p).placedOrientation=l),m>=0&&(_.get(m).placedOrientation=u)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let a=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const l=r?r.symbolFadeChange(t):1,u=r?r.opacities:{},d=r?r.variableOffsets:{},h=r?r.placedOrientations:{};for(const p in this.placements){const m=this.placements[p],_=u[p];_?(this.opacities[p]=new lg(_,l,m.text,m.icon,null,m.clipped),a=a||m.text!==_.text.placed||m.icon!==_.icon.placed):(this.opacities[p]=new lg(null,l,m.text,m.icon,m.skipFade,m.clipped),a=a||m.text||m.icon)}for(const p in u){const m=u[p];if(!this.opacities[p]){const _=new lg(m,l,!1,!1);_.isHidden()||(this.opacities[p]=_,a=a||m.text.placed||m.icon.placed)}}for(const p in d)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=d[p]);for(const p in h)this.placedOrientations[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.placedOrientations[p]=h[p]);a?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const a=new Set;for(const l of r){const u=l.getBucket(t);u&&l.latestFeatureIndex&&t.fqid===u.layerIds[0]&&(this.updateBucketOpacities(u,a,l.collisionBoxArray),u.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(u,l.tileID),u.updateZOffset()))}}updateBucketOpacities(t,r,a){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const l=t.layers[0].layout,u=!!t.layers[0].dynamicFilter(),d=new lg(null,0,!1,!1,!0),h=l.get("text-allow-overlap"),p=l.get("icon-allow-overlap"),m=l.get("text-variable-anchor"),_="map"===l.get("text-rotation-alignment"),y="map"===l.get("text-pitch-alignment"),x=new lg(null,0,h&&(p||!t.hasIconData()||l.get("icon-optional")),p&&(h||!t.hasTextData()||l.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const b=(C,S,M)=>{for(let D=0;D<S/4;D++)C.opacityVertexArray.emplaceBack(M)};let E=0;for(let C=0;C<t.symbolInstances.length;C++){const S=t.symbolInstances.get(C),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:D,crossTileID:R,numIconVertices:P}=S,I=r.has(R);let O=this.opacities[R];I?O=d:O||(O=x,this.opacities[R]=O),r.add(R);const F=M>0||D>0,L=P>0,N=this.placedOrientations[R],z=N===ti.vertical,U=N===ti.horizontal||N===ti.horizontalOnly;if(!F&&!L||O.isHidden()||E++,F){const V=mT(O.text);b(t.text,M,z?uv:V),b(t.text,D,U?uv:V);const G=O.text.isHidden(),{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:Z,rightJustifiedTextSymbolIndex:et,verticalPlacedTextSymbolIndex:it}=S,X=t.text.placedSymbolArray,Y=G||z?1:0;j>=0&&(X.get(j).hidden=Y),Z>=0&&(X.get(Z).hidden=Y),et>=0&&(X.get(et).hidden=Y),it>=0&&(X.get(it).hidden=G||U?1:0);const ot=this.variableOffsets[R];ot&&this.markUsedJustification(t,ot.anchor,S,N);const lt=this.placedOrientations[R];lt&&(this.markUsedJustification(t,"left",S,lt),this.markUsedOrientation(t,lt,S))}if(L){const V=mT(O.icon),{placedIconSymbolIndex:G,verticalPlacedIconSymbolIndex:j}=S,Z=t.icon.placedSymbolArray,et=O.icon.isHidden()?1:0;G>=0&&(b(t.icon,P,z?uv:V),Z.get(G).hidden=et),j>=0&&(b(t.icon,S.numVerticalIconVertices,U?uv:V),Z.get(j).hidden=et)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const V=t.collisionArrays[C];if(V){let G=new nt(0,0),j=!0;if(V.textBox||V.verticalTextBox){if(m){const et=this.variableOffsets[R];et?(G=x1(et.anchor,et.width,et.height,et.textOffset,et.textScale),_&&G._rotate(y?this.transform.angle:-this.transform.angle)):j=!1}u&&(j=!O.clipped),V.textBox&&cv(t.textCollisionBox.collisionVertexArray,O.text.placed,!j||z,G.x,G.y),V.verticalTextBox&&cv(t.textCollisionBox.collisionVertexArray,O.text.placed,!j||U,G.x,G.y)}const Z=j&&!(U||!V.verticalIconBox);V.iconBox&&cv(t.iconCollisionBox.collisionVertexArray,O.icon.placed,Z,S.hasIconTextFit?G.x:0,S.hasIconTextFit?G.y:0),V.verticalIconBox&&cv(t.iconCollisionBox.collisionVertexArray,O.icon.placed,!Z,S.hasIconTextFit?G.x:0,S.hasIconTextFit?G.y:0)}}}if(t.fullyClipped=0===E,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const C=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=C.invProjMatrix,t.placementViewportMatrix=C.viewportMatrix,t.collisionCircleArray=C.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const a=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function cv(n,t,r,a,l){n.emplaceBack(t?1:0,r?1:0,a||0,l||0),n.emplaceBack(t?1:0,r?1:0,a||0,l||0),n.emplaceBack(t?1:0,r?1:0,a||0,l||0),n.emplaceBack(t?1:0,r?1:0,a||0,l||0)}const ER=Math.pow(2,25),CR=Math.pow(2,24),MR=Math.pow(2,17),SR=Math.pow(2,16),TR=Math.pow(2,9),fT=Math.pow(2,8),pT=Math.pow(2,1);function mT(n){if(0===n.opacity&&!n.placed)return 0;if(1===n.opacity&&n.placed)return 4294967295;const t=n.placed?1:0,r=Math.floor(127*n.opacity);return r*ER+t*CR+r*MR+t*SR+r*TR+t*fT+r*pT+t}const uv=0;class gT{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,a,l,u){const d=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(d,l,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,d.sort((h,p)=>h.sortKey-p.sortKey));this._currentPartIndex<d.length;){const h=d[this._currentPartIndex];if(r.placeLayerBucketPart(h,this._seenCrossTileIDs,a,0===h.symbolInstanceStart),this._currentPartIndex++,u())return!0}return!1}}class DR{constructor(t,r,a,l,u,d,h,p,m){this.placement=new wR(t,u,d,h,p,m),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=l,this._done=!1}isDone(){return this._done}continuePlacement(t,r,a,l){const u=kt.now(),d=()=>{const h=kt.now()-u;return!this._forceFullPlacement&&h>2};for(;this._currentPlacementIndex>=0;){const h=r[t[this._currentPlacementIndex]],p=this.placement.collisionIndex.transform.zoom;if("symbol"===h.type&&(!h.minzoom||h.minzoom<=p)&&(!h.maxzoom||h.maxzoom>p)){const m=h,_=m.layout.get("symbol-z-elevate"),y=this._inProgressLayer=this._inProgressLayer||new gT(m),x=Jr(h.source,h.scope);if(y.continuePlacement(_?l[x]:a[x],this.placement,this._showCollisionBoxes,h,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const _T=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dv{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(t,0,2);if(219!==r)throw new Error("Data does not appear to be in a KDBush format.");const l=a>>4;if(1!==l)throw new Error(`Got v${l} data when expected v1.`);const u=_T[15&a];if(!u)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,2,1),[h]=new Uint32Array(t,4,1);return new dv(h,d,u,t)}constructor(t,r=64,a=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const u=_T.indexOf(this.ArrayType),d=2*t*this.ArrayType.BYTES_PER_ELEMENT,h=t*this.IndexArrayType.BYTES_PER_ELEMENT,p=(8-h%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+h+p,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+d+h+p),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+h+p,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=r,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return w1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:d,nodeSize:h}=this,p=[0,u.length-1,0],m=[];for(;p.length;){const _=p.pop()||0,y=p.pop()||0,x=p.pop()||0;if(y-x<=h){for(let S=x;S<=y;S++){const M=d[2*S],D=d[2*S+1];M>=t&&M<=a&&D>=r&&D<=l&&m.push(u[S])}continue}const b=x+y>>1,E=d[2*b],C=d[2*b+1];E>=t&&E<=a&&C>=r&&C<=l&&m.push(u[b]),(0===_?t<=E:r<=C)&&(p.push(x),p.push(b-1),p.push(1-_)),(0===_?a>=E:l>=C)&&(p.push(b+1),p.push(y),p.push(1-_))}return m}within(t,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:u,nodeSize:d}=this,h=[0,l.length-1,0],p=[],m=a*a;for(;h.length;){const _=h.pop()||0,y=h.pop()||0,x=h.pop()||0;if(y-x<=d){for(let S=x;S<=y;S++)pv(u[2*S],u[2*S+1],t,r)<=m&&p.push(l[S]);continue}const b=x+y>>1,E=u[2*b],C=u[2*b+1];pv(E,C,t,r)<=m&&p.push(l[b]),(0===_?t-a<=E:r-a<=C)&&(h.push(x),h.push(b-1),h.push(1-_)),(0===_?t+a>=E:r+a>=C)&&(h.push(b+1),h.push(y),h.push(1-_))}return p}}function w1(n,t,r,a,l,u){if(l-a<=r)return;const d=a+l>>1;hv(n,t,d,a,l,u),w1(n,t,r,a,d-1,1-u),w1(n,t,r,d+1,l,1-u)}function hv(n,t,r,a,l,u){for(;l>a;){if(l-a>600){const m=l-a+1,_=r-a+1,y=Math.log(m),x=.5*Math.exp(2*y/3),b=.5*Math.sqrt(y*x*(m-x)/m)*(_-m/2<0?-1:1);hv(n,t,r,Math.max(a,Math.floor(r-_*x/m+b)),Math.min(l,Math.floor(r+(m-_)*x/m+b)),u)}const d=t[2*r+u];let h=a,p=l;for(zd(n,t,a,r),t[2*l+u]>d&&zd(n,t,a,l);h<p;){for(zd(n,t,h,p),h++,p--;t[2*h+u]<d;)h++;for(;t[2*p+u]>d;)p--}t[2*a+u]===d?zd(n,t,a,p):(p++,zd(n,t,p,l)),p<=r&&(a=p+1),r<=p&&(l=p-1)}}function zd(n,t,r,a){fv(n,r,a),fv(t,2*r,2*a),fv(t,2*r+1,2*a+1)}function fv(n,t,r){const a=n[t];n[t]=n[r],n[r]=a}function pv(n,t,r,a){const l=n-r,u=t-a;return l*l+u*u}const E1=512/dt/2;class IR{constructor(t,r,a){this.tileID=t,this.bucketInstanceId=a,this.index=new dv(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const l=t.canonical.x*dt,u=t.canonical.y*dt;for(let d=0;d<r.length;d++){const{key:h,crossTileID:p,tileAnchorX:m,tileAnchorY:_}=r.get(d),y=Math.floor((l+m)*E1),x=Math.floor((u+_)*E1);this.index.add(y,x),this.keys.push(h),this.crossTileIDs.push(p)}this.index.finish()}findMatches(t,r,a){const l=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),u=E1/Math.pow(2,r.canonical.z-this.tileID.canonical.z),d=r.canonical.x*dt,h=r.canonical.y*dt;for(let p=0;p<t.length;p++){const m=t.get(p);if(m.crossTileID)continue;const{key:_,tileAnchorX:y,tileAnchorY:x}=m,b=Math.floor((d+y)*u),E=Math.floor((h+x)*u),C=this.index.range(b-l,E-l,b+l,E+l);for(const S of C){const M=this.crossTileIDs[S];if(this.keys[S]===_&&!a.has(M)){a.add(M),m.crossTileID=M;break}}}}}class C1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class AR{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(0!==r)for(const a in this.indexes){const l=this.indexes[a],u={};for(const d in l){const h=l[d];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+r),u[h.tileID.key]=h}this.indexes[a]=u}this.lng=t}addBucket(t,r,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let u=0;u<r.symbolInstances.length;u++)r.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const l=this.usedCrossTileIDs[t.overscaledZ];for(const u in this.indexes){const d=this.indexes[u];if(Number(u)>t.overscaledZ)for(const h in d){const p=d[h];p.tileID.isChildOf(t)&&p.findMatches(r.symbolInstances,t,l)}else{const h=d[t.scaledTo(Number(u)).key];h&&h.findMatches(r.symbolInstances,t,l)}}for(let u=0;u<r.symbolInstances.length;u++){const d=r.symbolInstances.get(u);d.crossTileID||(d.crossTileID=a.generate(),l.add(d.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new IR(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const a of r.crossTileIDs)this.usedCrossTileIDs[t].delete(a)}removeStaleBuckets(t){let r=!1;for(const a in this.indexes){const l=this.indexes[a];for(const u in l)t[l[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[u]),delete l[u],r=!0)}return r}}class Wi{constructor(){this.layerIndexes={},this.crossTileIDs=new C1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,a,l){let u=this.layerIndexes[t.fqid];void 0===u&&(u=this.layerIndexes[t.fqid]=new AR);let d=!1;const h={};"globe"!==l.name&&u.handleWrapJump(a);for(const p of r){const m=p.getBucket(t);m&&t.fqid===m.layerIds[0]&&(m.bucketInstanceId||(m.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(p.tileID,m,this.crossTileIDs)&&(d=!0),h[m.bucketInstanceId]=!0)}return u.removeStaleBuckets(h)&&(d=!0),d}pruneUnusedLayers(t){const r={};t.forEach(a=>{r[a]=!0});for(const a in this.layerIndexes)r[a]||delete this.layerIndexes[a]}}var Fu="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\n{return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn)\n{return pow(srgbIn,vec3(2.2));}vec3 linearProduct(vec3 srgbIn,vec3 k)\n{return srgbIn*pow(k,vec3(1./2.2));}\n#if __VERSION__ >=300\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define _HANDLE_WIREFRAME_DEPTH\n#endif\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\n_HANDLE_WIREFRAME_DEPTH;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",M1="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",yT="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",RR="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",mv="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",gv="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",vT="#ifdef RENDER_SHADOWS\n#if defined(NATIVE) && __VERSION__ >=300\n#define TEXTURE_GATHER\n#endif\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const S1=[];cg(Fu,S1);const Pf={"_prelude_fog.vertex.glsl":RR,"_prelude_terrain.vertex.glsl":yT,"_prelude_shadow.vertex.glsl":gv,"_prelude_fog.fragment.glsl":mv,"_prelude_shadow.fragment.glsl":vT,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE"},_v={};Tn("",yT),Tn(mv,RR),Tn(vT,gv);const T1=Tn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),yv=Fu;var D1={background:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;varying vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Tn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Tn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Tn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Tn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#if __VERSION__ >=300\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:Tn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nvarying highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Tn('#include "_prelude_shadow.fragment.glsl"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 u_ground_shadow_factor;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\ngl_FragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;attribute vec2 a_pos;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Tn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\ngl_FragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\ngl_FragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nattribute highp vec4 a_pos_end;attribute highp float a_angular_offset_factor;attribute highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Tn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture(u_image,coord).r/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec2 u_colorization_scale;uniform highp vec4 u_colorization_mix;highp vec4 colormap (highp float value) {highp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;highp vec2 coords=vec2(scaled_value,0.5);return texture2D(u_color_ramp,coords);}\n#endif\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);vec4 color;\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);color=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;if (color.a > 0.0) {color.rgb/=color.a;}\n#else\nif (color0.a > 0.0) {color0.rgb/=color0.a;}if (color1.a > 0.0) {color1.rgb/=color1.a;}color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_ground(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;attribute vec2 a_texture_pos;\n#endif\nvarying vec2 v_pos0;varying vec2 v_pos1;void main() {vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),symbolIcon:Tn('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nvarying float v_fade_opacity;varying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture2D(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nattribute vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\nvarying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Tn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Tn('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture2D(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:Tn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Tn('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',M1),skyboxGradient:Tn('#include "_prelude_fog.fragment.glsl"\nvarying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',M1),skyboxCapture:Tn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Tn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\ngl_FragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\n#else\ngl_FragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);gl_FragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\ngl_FragColor=vec4(c*t,t);\n#endif\n}',"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Tn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;varying highp vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\nconst float M_PI=3.141592653589793;\n#define saturate(_x) clamp(_x,0.,1.)\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(M_PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/M_PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\ngl_FragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nattribute vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\nvarying vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\nvoid main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Tn("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}","attribute vec3 a_pos_3f;uniform mat4 u_matrix;varying highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Tn("varying highp vec2 v_uv;varying mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;gl_FragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;varying highp vec2 v_uv;varying mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function cg(n,t){const r=n.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let a of r)if(a=a.trim(),"#"===a[0]&&a.includes("if")&&!a.includes("endif")){a=a.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const l=a.split(" ");for(const u of l)t.includes(u)||t.push(u)}}function Tn(n,t){const r=/#include\s+"([^"]+)"/g,a=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let l=t.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);l&&(l=l.filter((m,_)=>l.indexOf(m)===_));const u={},d=[],h=[];n=n.replace(r,(m,_)=>(h.push(_),"")),t=t.replace(r,(m,_)=>(d.push(_),""));let p=[...S1];cg(n,p),cg(t,p);for(const m of[...d,...h])Pf[m]||console.error(`Undefined include: ${m}`),_v[m]||(_v[m]=[],cg(Pf[m],_v[m])),p=[...p,..._v[m]];return{fragmentSource:n=n.replace(a,(m,_,y,x,b)=>(u[b]=!0,"define"===_?`\n#ifndef HAS_UNIFORM_u_${b}\nvarying ${y} ${x} ${b};\n#else\nuniform ${y} ${x} u_${b};\n#endif\n`:"initialize"===_?`\n#ifdef HAS_UNIFORM_u_${b}\n    ${y} ${x} ${b} = u_${b};\n#endif\n`:"define-attribute"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\n    varying ${y} ${x} ${b};\n#endif\n`:"initialize-attribute"===_?"":void 0)),vertexSource:t=t.replace(a,(m,_,y,x,b)=>{const E="float"===x?"vec2":x,C=b.match(/color/)?"color":E;return"define-attribute-vertex-shader-only"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\nattribute ${y} ${x} a_${b};\n#endif\n`:u[b]?"define"===_?`\n#ifndef HAS_UNIFORM_u_${b}\nuniform lowp float u_${b}_t;\nattribute ${y} ${E} a_${b};\nvarying ${y} ${x} ${b};\n#else\nuniform ${y} ${x} u_${b};\n#endif\n`:"initialize"===_?"vec4"===C?`\n#ifndef HAS_UNIFORM_u_${b}\n    ${b} = a_${b};\n#else\n    ${y} ${x} ${b} = u_${b};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${b}\n    ${b} = unpack_mix_${C}(a_${b}, u_${b}_t);\n#else\n    ${y} ${x} ${b} = u_${b};\n#endif\n`:"define-attribute"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\n    attribute ${y} ${x} a_${b};\n    varying ${y} ${x} ${b};\n#endif\n`:"initialize-attribute"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\n    ${b} = a_${b};\n#endif\n`:void 0:"define"===_?`\n#ifndef HAS_UNIFORM_u_${b}\nuniform lowp float u_${b}_t;\nattribute ${y} ${E} a_${b};\n#else\nuniform ${y} ${x} u_${b};\n#endif\n`:"define-instanced"===_?"mat4"===C?`\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_${b}0;\nattribute vec4 a_${b}1;\nattribute vec4 a_${b}2;\nattribute vec4 a_${b}3;\n#else\nuniform ${y} ${x} u_${b};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nattribute ${y} ${E} a_${b};\n#else\nuniform ${y} ${x} u_${b};\n#endif\n`:"initialize-attribute-custom"===_?`\n#ifdef HAS_ATTRIBUTE_a_${b}\n    ${y} ${x} ${b} = a_${b};\n#endif\n`:"vec4"===C?`\n#ifndef HAS_UNIFORM_u_${b}\n    ${y} ${x} ${b} = a_${b};\n#else\n    ${y} ${x} ${b} = u_${b};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${b}\n    ${y} ${x} ${b} = unpack_mix_${C}(a_${b}, u_${b}_t);\n#else\n    ${y} ${x} ${b} = u_${b};\n#endif\n`}),staticAttributes:l,usedDefines:p,vertexIncludes:d,fragmentIncludes:h}}class xT{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,a,l,u,d,h,p){this.context=t;let m=this.boundPaintVertexBuffers.length!==l.length;for(let y=0;!m&&y<l.length;y++)this.boundPaintVertexBuffers[y]!==l[y]&&(m=!0);let _=this.boundDynamicVertexBuffers.length!==h.length;for(let y=0;!_&&y<h.length;y++)this.boundDynamicVertexBuffers[y]!==h[y]&&(_=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==a||m||_||this.boundIndexBuffer!==u||this.boundVertexOffset!==d)this.freshBind(r,a,l,u,d,h,p);else{t.bindVertexArrayOES.set(this.vao);for(const y of h)y&&(y.bind(),p&&y.instanceCount&&y.setVertexAttribDivisor(t.gl,r,p));u&&u.dynamicDraw&&u.bind()}}freshBind(t,r,a,l,u,d,h){const p=t.numAttributes,m=this.context,_=m.gl;this.vao&&this.destroy(),this.vao=m.gl.createVertexArray(),m.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=u,this.boundDynamicVertexBuffers=d,r.enableAttributes(_,t),r.bind(),r.setVertexAttribPointers(_,t,u);for(const y of a)y.enableAttributes(_,t),y.bind(),y.setVertexAttribPointers(_,t,u);for(const y of d)y&&(y.enableAttributes(_,t),y.bind(),y.setVertexAttribPointers(_,t,u),h&&y.instanceCount&&y.setVertexAttribDivisor(_,t,h));l&&l.bind(),m.currentNumAttributes=p}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function PR(n,t){const r=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new Je(0,a/r).toLngLat().lat,new Je(0,(a+1)/r).toLngLat().lat]}function OR(n,t,r,a,l,u,d){const h=n.context,p=h.gl,m=r.hillshadeFBO;if(!m)return;n.prepareDrawTile();const _=n.isTileAffectedByFog(t),y=n.getOrCreateProgram("hillshade",{overrideFog:_});h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,m.colorAttachment.get());const x=((S,M,D,R)=>{const P=D.paint.get("hillshade-shadow-color"),I=D.paint.get("hillshade-highlight-color"),O=D.paint.get("hillshade-accent-color"),F=D.paint.get("hillshade-emissive-strength");let L=Ie(D.paint.get("hillshade-illumination-direction"));if("viewport"===D.paint.get("hillshade-illumination-anchor"))L-=S.transform.angle;else if(S.style&&S.style.enable3dLights()&&S.style.directionalLight){const z=S.style.directionalLight.properties.get("direction");L=Ie(te(z.x,z.y,z.z)[1])}const N=!S.options.moving;return{u_matrix:R||S.transform.calculateProjMatrix(M.tileID.toUnwrapped(),N),u_image:0,u_latrange:PR(0,M.tileID),u_light:[D.paint.get("hillshade-exaggeration"),L],u_shadow:P,u_highlight:I,u_emissive_strength:F,u_accent:O}})(n,r,a,n.terrain?t.projMatrix:null);n.uploadCommonUniforms(h,y,t.toUnwrapped());const{tileBoundsBuffer:b,tileBoundsIndexBuffer:E,tileBoundsSegments:C}=n.getTileBoundsBuffers(r);y.draw(n,p.TRIANGLES,l,u,d,Ge.disabled,x,a.id,b,E,C)}function bT(n,t,r){if(!t.needsDEMTextureUpload)return;const a=n.context,l=a.gl;a.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||n.getTileTexture(r.stride);const u=r.getPixels();t.demTexture?t.demTexture.update(u,{premultiply:!1}):t.demTexture=new ir(a,u,n.terrainUseFloatDEM()?l.R32F:l.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function kR(n,t,r){const a=n.context,l=a.gl;if(!t.dem)return;const u=t.dem;if(a.activeTexture.set(l.TEXTURE1),bT(n,t,u),!t.demTexture)return;t.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const d=u.dim;a.activeTexture.set(l.TEXTURE0);let h=t.hillshadeFBO;if(!h){const x=new ir(a,{width:d,height:d,data:null},l.RGBA);x.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=t.hillshadeFBO=a.createFramebuffer(d,d,!0,"renderbuffer"),h.colorAttachment.set(x.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,d,d]);const{tileBoundsBuffer:p,tileBoundsIndexBuffer:m,tileBoundsSegments:_}=n.getMercatorTileBoundsBuffers(),y=[];n.terrainUseFloatDEM()&&y.push("TERRAIN_DEM_FLOAT_FORMAT"),n.getOrCreateProgram("hillshadePrepare",{defines:y}).draw(n,l.TRIANGLES,ve.disabled,Fe.disabled,an.unblended,Ge.disabled,((x,b)=>{const E=b.stride,C=rt.create();return rt.ortho(C,0,dt,-dt,0,0,1),rt.translate(C,C,[0,-dt,0]),{u_matrix:C,u_image:1,u_dimension:[E,E],u_zoom:x.overscaledZ,u_unpack:b.unpackVector}})(t.tileID,u),r.id,p,m,_),t.needsHillshadePrepare=!1}const I1=n=>({u_matrix:new De(n),u_image0:new $e(n),u_skirt_height:new Et(n),u_ground_shadow_factor:new me(n)}),FR=(n,t,r)=>({u_matrix:n,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),A1=(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E)=>({u_proj_matrix:Float32Array.from(n),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(a),u_merc_matrix:r,u_zoom_transition:l,u_merc_center:u,u_image0:0,u_frustum_tl:d,u_frustum_tr:h,u_frustum_br:p,u_frustum_bl:m,u_globe_pos:_,u_globe_radius:y,u_viewport:x,u_grid_matrix:E?Float32Array.from(E):new Float32Array(9),u_skirt_height:b}),Of=(n,t)=>{if(t>0&&n.terrain&&tt("Cutoff is currently disabled on terrain"),t<=0||n.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const r=n.transform,a=Math.max(Math.abs(r._zoom-(n.minCutoffZoom-1)),1),l=r.isLODDisabled(!1)?bl(60,45,r.pitch):bl(30,15,r.pitch),u=r._farZ-r._nearZ,d=t*r.height,h=((1-(p=l))*(.75*r.cameraToCenterDistance)+p*(r._farZ+d))*a;var p;return{shouldRenderCutoff:l<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(h-r._nearZ)/u,(h-d-r._nearZ)/u]}}};function wT(n,t){return null!=n&&null!=t&&!(!n.hasData()||!t.hasData())&&null!=n.demTexture&&null!=t.demTexture&&n.tileID.key!==t.tileID.key}const ug=new class{constructor(){this.operations={}}newMorphing(n,t,r,a,l){if(n in this.operations){const u=this.operations[n];u.to.tileID.key!==r.tileID.key&&(u.queued=r)}else this.operations[n]={startTime:a,phase:0,duration:l,from:t,to:r,queued:null}}getMorphValuesForProxy(n){if(!(n in this.operations))return null;const t=this.operations[n];return{from:t.from,to:t.to,phase:t.phase}}update(n){for(const t in this.operations){const r=this.operations[t];for(r.phase=(n-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,n)){delete this.operations[t];break}}}_nextOp(n,t){return!!n.queued&&(n.from=n.to,n.to=n.queued,n.queued=null,n.phase=0,n.startTime=t,!0)}_validOp(n){return n.from.hasData()&&n.to.hasData()}},ET={0:null,1:"TERRAIN_VERTEX_MORPHING"};function CT(n,t,r){if(0===t)return 0;const a=t<1&&514===r?.25/t:1;return 6*Math.pow(1.5,22-n)*Math.max(t,1)*a}function LR(n,t){const r=1<<n.z;return!t&&(0===n.x||n.x===r-1)||0===n.y||n.y===r-1}const R1=n=>({u_matrix:n});function MT(n,t,r,a,l){if(l>0){const u=kt.now(),d=(u-n.timeAdded)/l,h=t?(u-t.timeAdded)/l:-1,p=r.getSource(),m=a.coveringZoomLevel({tileSize:p.tileSize,roundZoom:p.roundZoom}),_=!t||Math.abs(t.tileID.overscaledZ-m)>Math.abs(n.tileID.overscaledZ-m),y=_&&n.refreshedUponExpiration?1:Jt(_?d:1-h,0,1);return n.refreshedUponExpiration&&d>=1&&(n.refreshedUponExpiration=!1),t?{opacity:1,mix:1-y}:{opacity:y,mix:0}}return{opacity:1,mix:0}}class NR extends Rs{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},a=new Km(If(),null),l=m1("mock-dem",r,a,t.style);super("mock-dem",l,!1),l.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class zR extends Rs{constructor(t){const r=m1("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Km(If(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,a){if(t.freezeTileCoverage)return;this.transform=t;const l=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((u,d)=>{if(u[d.key]="",!this._tiles[d.key]){const h=new As(d,this._source.tileSize*d.overscaleFactor(),t.tileZoom);h.state="loaded",this._tiles[d.key]=h}return u},{});for(const u in this._tiles)u in l||(this.freeFBO(u),this._tiles[u].unloadVectorData(),delete this._tiles[u])}freeFBO(t){const r=this.proxyCachedFBO[t];if(void 0!==r){const a=Object.values(r);this.renderCachePool.push(...a),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ST extends tn{constructor(t,r,a){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=a}}class BR extends Dc{constructor(t,r){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[a,l,u]=function(p){const m=new Zo,_=new er,y=131;m.reserve(17161),_.reserve(33800);const x=dt/128,b=dt+x/2,E=b+x;for(let S=-x;S<E;S+=x)for(let M=-x;M<E;M+=x){const D=M<0||M>b||S<0||S>b?24575:0,R=Jt(Math.round(M),0,dt),P=Jt(Math.round(S),0,dt);m.emplaceBack(R+D,P)}const C=(S,M)=>{const D=M*y+S;_.emplaceBack(D+1,D,D+y),_.emplaceBack(D+y,D+y+1,D+1)};for(let S=1;S<129;S++)for(let M=1;M<129;M++)C(M,S);return[0,129].forEach(S=>{for(let M=0;M<130;M++)C(M,S),C(S,M)}),[m,_,32768]}(),d=t.context;this.gridBuffer=d.createVertexBuffer(a,xc.members),this.gridIndexBuffer=d.createIndexBuffer(l),this.gridSegments=Bn.simpleSegment(0,0,a.length,l.length),this.gridNoSkirtSegments=Bn.simpleSegment(0,0,a.length,u),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new zR(r.map),this.orthoMatrix=rt.create(),rt.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,dt,0,dt,0,1);const h=d.gl;this._overlapStencilMode=new Fe({func:h.GEQUAL,mask:255},0,255,h.KEEP,h.KEEP,h.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new NR(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,a){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const l=t.terrain.properties,u=0===t.terrain.drapeRenderMode,d=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=kt.now();const h=t.terrain&&t.terrain.scope,p=l.get("source"),m=u?this._mockSourceCache:t.getSourceCache(p,h);if(!m)return void tt(`Couldn't find terrain source "${p}".`);if(this.sourceCache=m,this._exaggeration=d?this.calculateExaggeration(r):l.get("exaggeration"),!r.projection.requiresDraping&&d&&0===this._exaggeration)return void this._disable();this.enabled=!0;const _=()=>{this.sourceCache.used&&tt(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const y=this.getScaledDemTileSize();this.sourceCache.update(r,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),r.updateElevation(!0,a),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){const r=this._previousCameraAltitude,a=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=a;const l=null!=r?a-r:Number.MAX_VALUE;if(Math.abs(l)<2)return this._exaggeration;const u=t.zoom,d=this._style.terrain;if(!this._previousUpdateTimestamp)return d.getExaggeration(u);let h=u-this._previousZoom;const p=this._previousUpdateTimestamp;let m=u;null!=this._evaluationZoom&&(m=this._evaluationZoom,Math.abs(u-m)>.5&&(h=.5*(u-m+h)),h*l<0&&(m+=h)),this._evaluationZoom=m;const _=d.getExaggeration(m),y=_===d.getExaggeration(Math.max(0,m-.1));if(y&&Math.abs(_-this._exaggeration)<.01)return _;let x=Math.min(.1,.00375*(this._updateTimestamp-p));return(y||_<.1||Math.abs(h)<1e-4)&&(x=Math.min(.2,4*x)),_e(this._exaggeration,_,x)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,a=this.painter.transform;this._initializing&&(this._initializing=0===a._centerAltitude&&-1===this.getAtPointOrZero(Je.fromLngLat(a.center),-1),this._emptyDEMTextureDirty=!this._initializing);const l=this.proxyCoords=r.getIds().map(p=>{const m=r.getTileByID(p).tileID;return m.projMatrix=a.calculateProjMatrix(m.toUnwrapped()),m});!function(p,m){const _=m.transform.pointCoordinate(m.transform.getCameraPoint()),y=new nt(_.x,_.y);p.sort((x,b)=>{if(b.overscaledZ-x.overscaledZ)return b.overscaledZ-x.overscaledZ;const E=new nt(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),C=new nt(b.canonical.x+(1<<b.canonical.z)*b.wrap,b.canonical.y),S=y.mult(1<<x.canonical.z);return S.x-=.5,S.y-=.5,S.distSqr(E)-S.distSqr(C)})}(l,this.painter);const u=this.proxyToSource||{};this.proxyToSource={},l.forEach(p=>{this.proxyToSource[p.key]={}}),this.terrainTileForTile={};const d=this._style._mergedSourceCaches;for(const p in d){const m=d[p];if(!m.used||(m!==this.sourceCache&&this.resetTileLookupCache(m.id),this._setupProxiedCoordsForOrtho(m,t[p],u),m.usedForTerrain))continue;const _=t[p];m.getSource().reparseOverscaled&&this._assignTerrainTiles(_)}this.proxiedCoords[r.id]=l.map(p=>new ST(p,p.key,this.orthoMatrix)),this._assignTerrainTiles(l),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(u),this.renderingToTexture=!1;const h={};this._visibleDemTiles=[];for(const p of this.proxyCoords){const m=this.terrainTileForTile[p.key];if(!m)continue;const _=m.tileID.key;_ in h||(this._visibleDemTiles.push(m),h[_]=_)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const a=this._findTileCoveringTileID(r,this.sourceCache);a&&(this.terrainTileForTile[r.key]=a)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const a in this.terrainTileForTile){const l=this.terrainTileForTile[a],u=l.dem;!u||l.demTexture&&!l.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),bT(this.painter,l,u))}}_prepareDemTileUniforms(t,r,a,l){if(!r||null==r.demTexture)return!1;const u=t.tileID.canonical,d=Math.pow(2,r.tileID.canonical.z-u.z),h=l||"";return a[`u_dem_tl${h}`]=[u.x*d%1,u.y*d%1],a[`u_dem_scale${h}`]=d,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,r=t.gl;if(!this._emptyDepthBufferTexture){const a=new Pi({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new ir(t,a,r.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const r=this._visibleDemTiles.reduce((a,l)=>{if(!l.dem)return a;const u=l.dem.tree.minimums[0];return u>0&&t++,a+u},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const a=this._getLoadedAreaMinimum(),[l,u]=(()=>{if(this.painter.terrainUseFloatDEM()){const h=new am({width:1,height:1},new Float32Array([a]));return[r.R32F,h]}{const h=new Pi({width:1,height:1},new Uint8Array(Ea.pack(a,this.sourceCache.getSource().encoding)));return[r.RGBA,h]}})();this._emptyDEMTextureDirty=!1;let d=this._emptyDEMTexture;return d?d.update(u,{premultiply:!1}):d=this._emptyDEMTexture=new ir(t,u,l,{premultiply:!1}),d}setupElevationDraw(t,r,a){const l=this.painter.context,u=l.gl,d=(h=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:Ea.getUnpackVector(h),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var h;d.u_exaggeration=this.exaggeration();let p=null,m=null,_=1;if(a&&a.morphing&&this._useVertexMorphing){const b=a.morphing.srcDemTile,E=a.morphing.dstDemTile;_=a.morphing.phase,b&&E&&(this._prepareDemTileUniforms(t,b,d,"_prev")&&(m=b),this._prepareDemTileUniforms(t,E,d)&&(p=E))}const y=b=>b&&b.demTexture&&this.painter.terrainUseFloatDEM()?u.LINEAR:u.NEAREST,x=b=>{d.u_dem_size=1===b.size[0]?1:b.size[0]-2};if(m&&p)l.activeTexture.set(u.TEXTURE2),p.demTexture.bind(y(p),u.CLAMP_TO_EDGE),l.activeTexture.set(u.TEXTURE4),m.demTexture.bind(y(m),u.CLAMP_TO_EDGE),p.demTexture&&x(p.demTexture),d.u_dem_lerp=_;else{p=this.terrainTileForTile[t.tileID.key],l.activeTexture.set(u.TEXTURE2);const b=this._prepareDemTileUniforms(t,p,d)?p.demTexture:this.emptyDEMTexture;b.bind(y(p),u.CLAMP_TO_EDGE),x(b)}if(l.activeTexture.set(u.TEXTURE3),a&&a.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),this._depthFBO&&(d.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE),d.u_depth_size_inv=[1,1]),a&&a.useMeterToDem&&p){const b=(1<<p.tileID.canonical.z)*Nn(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;d.u_meter_to_dem=b}if(a&&a.labelPlaneMatrixInv&&(d.u_label_plane_matrix_inv=a.labelPlaneMatrixInv),r.setTerrainUniformValues(l,d),"globe"===this.painter.transform.projection.name){const b=this.globeUniformValues(this.painter.transform,t.tileID.canonical,a&&a.useDenormalizedUpVectorScale);r.setGlobeUniformValues(l,b)}}globeUniformValues(t,r,a){const l=t.projection;return{u_tile_tl_up:l.upVector(r,0,0),u_tile_tr_up:l.upVector(r,dt,0),u_tile_br_up:l.upVector(r,dt,dt),u_tile_bl_up:l.upVector(r,0,dt),u_tile_up_scale:a?Ix(1):l.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,a=this.painter.context;0!==t.length&&(a.bindFramebuffer.set(null),a.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(l,u,d,h,p){if("globe"===l.transform.projection.name)!function(m,_,y,x,b){const E=m.context,C=E.gl;let S,M;const D=m.transform,R=WC(m,E,D),P=(G,j)=>{if(M===j)return;const Z=[ET[j],"PROJECTION_GLOBE_VIEW"];R&&Z.push("CUSTOM_ANTIALIASING");const et=m.isTileAffectedByFog(G);S=m.getOrCreateProgram("globeRaster",{defines:Z,overrideFog:et}),M=j},I=m.colorModeForRenderPass(),O=new ve(C.LEQUAL,ve.ReadWrite,m.depthRangeFor3D);ug.update(b);const F=function(G){const j=G.pixelsPerMeter,Z=j/Nn(1,G.center.lat),et=rt.identity(new Float64Array(16));return rt.translate(et,et,[G.point.x,G.point.y,0]),rt.scale(et,et,[Z,Z,j]),Float32Array.from(et)}(D),L=[no(D.center.lng),mo(D.center.lat)],N=m.globeSharedBuffers,z=[D.width*kt.devicePixelRatio,D.height*kt.devicePixelRatio],U=Float32Array.from(D.globeMatrix),V={useDenormalizedUpVectorScale:!0};{const G=m.transform,j=CT(G.zoom,_.exaggeration(),_.sourceCache._source.tileSize);M=-1;const Z=C.TRIANGLES;for(const et of x){const it=y.getTile(et),X=Fe.disabled,Y=_.prevTerrainTileForTile[et.key],ot=_.terrainTileForTile[et.key];wT(Y,ot)&&ug.newMorphing(et.key,Y,ot,b,250),E.activeTexture.set(C.TEXTURE0),it.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const lt=ug.getMorphValuesForProxy(et.key),ht=lt?1:0;lt&&ou(V,{morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:Jc(lt.phase)}});const mt=Kp(et.canonical),vt=BA(mt.getCenter().lat),ct=ZC(et.canonical,mt,vt,G.worldSize/G._pixelsPerMercatorPixel),ft=eo(ko(et.canonical)),Rt=A1(G.projMatrix,U,F,ft,Vr(G.zoom),L,G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.globeCenterInViewSpace,G.globeRadius,z,j,ct);if(P(et,ht),S&&(_.setupElevationDraw(it,S,V),m.uploadCommonUniforms(E,S,et.toUnwrapped()),N)){const[Vt,jt,Ht]=N.getGridBuffers(vt,0!==j);S.draw(m,Z,O,X,I,Ge.backCCW,Rt,"globe_raster",Vt,jt,Ht)}}}if(N&&(m.renderDefaultNorthPole||m.renderDefaultSouthPole)){const G=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];R&&G.push("CUSTOM_ANTIALIASING"),S=m.getOrCreateProgram("globeRaster",{defines:G});for(const j of x){const{x:Z,y:et,z:it}=j.canonical,X=0===et,Y=et===(1<<it)-1,[ot,lt,ht,mt]=N.getPoleBuffers(it,!1);if(mt&&(X||Y)){const vt=y.getTile(j);E.activeTexture.set(C.TEXTURE0),vt.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE);let ct=qC(it,Z,D);const ft=eo(ko(j.canonical)),Rt=(Vt,jt)=>Vt.draw(m,C.TRIANGLES,O,Fe.disabled,I,Ge.disabled,A1(D.projMatrix,ct,ct,ft,0,L,D.frustumCorners.TL,D.frustumCorners.TR,D.frustumCorners.BR,D.frustumCorners.BL,D.globeCenterInViewSpace,D.globeRadius,z,0),"globe_pole_raster",jt,ht,mt);_.setupElevationDraw(vt,S,V),m.uploadCommonUniforms(E,S,j.toUnwrapped()),X&&m.renderDefaultNorthPole&&Rt(S,ot),Y&&m.renderDefaultSouthPole&&(ct=rt.scale(rt.create(),ct,[1,-1,1]),Rt(S,lt))}}}}(l,u,d,h,p);else{const m=l.context,_=m.gl;let y,x;const b=l.shadowRenderer,E=Of(l,l.longestCutoffRange),C=I=>{if(x===I)return;const O=[];O.push(ET[I]),E.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),y=l.getOrCreateProgram("terrainRaster",{defines:O}),x=I},S=l.colorModeForRenderPass(),M=new ve(_.LEQUAL,ve.ReadWrite,l.depthRangeFor3D);ug.update(p);const D=l.transform,R=CT(D.zoom,u.exaggeration(),u.sourceCache._source.tileSize);let P=[0,0,0];if(b){const I=l.style.directionalLight,O=l.style.ambientLight;I&&O&&(P=q1(I,O))}{x=-1;const I=_.TRIANGLES,[O,F]=[u.gridIndexBuffer,u.gridSegments];for(const L of h){const N=d.getTile(L),z=Fe.disabled,U=u.prevTerrainTileForTile[L.key],V=u.terrainTileForTile[L.key];wT(U,V)&&ug.newMorphing(L.key,U,V,p,250),m.activeTexture.set(_.TEXTURE0),N.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST);const G=ug.getMorphValuesForProxy(L.key),j=G?1:0;let Z;G&&(Z={morphing:{srcDemTile:G.from,dstDemTile:G.to,phase:Jc(G.phase)}});const et=FR(L.projMatrix,LR(L.canonical,D.renderWorldCopies)?R/10:R,P);if(C(j),!y)continue;u.setupElevationDraw(N,y,Z);const it=L.toUnwrapped();b&&b.setupShadows(it,y),l.uploadCommonUniforms(m,y,it,null,E),y.draw(l,I,M,z,S,Ge.backCCW,et,"terrain_raster",u.gridBuffer,O,F)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const r=this.painter,a=this.painter.context,l=this.proxySourceCache,u=this.proxiedCoords[l.id],d=this._drapedRenderBatches.shift(),h=r.style.order,p=[];let m=0;for(const _ of u){const y=l.getTileByID(_.proxyTileKey),x=l.proxyCachedFBO[_.key]?l.proxyCachedFBO[_.key][t]:void 0,b=void 0!==x?l.renderCache[x]:this.pool[m++],E=void 0!==x;if(y.texture=b.tex,E&&!b.dirty){p.push(y.tileID);continue}let C;a.bindFramebuffer.set(b.fb.framebuffer),this.renderedToTile=!1,b.dirty&&(a.clear({color:Ne.transparent,stencil:0}),b.dirty=!1);for(let S=d.start;S<=d.end;++S){const M=r.style._mergedLayers[h[S]];if(M.isHidden(r.transform.zoom))continue;const D=r.style.getLayerSourceCache(M),R=D?this.proxyToSource[_.key][D.id]:[_];if(!R)continue;const P=R;a.viewport.set([0,0,b.fb.width,b.fb.height]),C!==(D?D.id:null)&&(this._setupStencil(b,R,M,D),C=D?D.id:null),r.renderLayer(r,D,M,P)}if(0===this._drapedRenderBatches.length)for(const S of this._pendingGroundEffectLayers){const M=r.style._mergedLayers[h[S]];if(M.isHidden(r.transform.zoom))continue;const D=r.style.getLayerSourceCache(M),R=D?this.proxyToSource[_.key][D.id]:[_];if(!R)continue;const P=R;a.viewport.set([0,0,b.fb.width,b.fb.height]),C!==(D?D.id:null)&&(this._setupStencil(b,R,M,D),C=D?D.id:null),r.renderLayer(r,D,M,P)}this.renderedToTile?(b.dirty=!0,p.push(y.tileID)):E||--m,5===m&&(m=0,this.renderToBackBuffer(p))}return this.renderToBackBuffer(p),this.renderingToTexture=!1,a.bindFramebuffer.set(null),a.viewport.set([0,0,r.width,r.height]),d.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let a=-1,l=r;for(let u=0;u<r;++u)this._style.isLayerDraped(t._mergedLayers[t.order[u]])?a=Math.max(a,u):l=Math.min(l,u);return l>a}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,r,a){if(!this._visibleDemTiles)return null;const l=this._visibleDemTiles.filter(u=>u.dem).map(u=>{const d=u.tileID,h=1<<d.overscaledZ,{x:p,y:m}=d.canonical,_=p/h,y=(p+1)/h,x=m/h,b=(m+1)/h;return{minx:_,miny:x,maxx:y,maxy:b,t:u.dem.tree.raycastRoot(_,x,y,b,t,r,a),tile:u}});l.sort((u,d)=>(null!==u.t?u.t:Number.MAX_VALUE)-(null!==d.t?d.t:Number.MAX_VALUE));for(const u of l){if(null==u.t)return null;const d=u.tile.dem.tree.raycast(u.minx,u.miny,u.maxx,u.maxy,t,r,a);if(null!=d)return d}return null}_createFBO(){const t=this.painter.context,r=t.gl,a=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const l=new ir(t,{width:a[0],height:a[1],data:null},r.RGBA);l.bind(r.LINEAR,r.CLAMP_TO_EDGE);const u=t.createFramebuffer(a[0],a[1],!0,null);return u.colorAttachment.set(l.texture),u.depthAttachment=new oS(t,u.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,a[0],a[1]),this._stencilRef=0,u.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):u.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:u,tex:l,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],a=r.isHidden(this.painter.transform.zoom);return"custom"===r.type?!a&&r.shouldRedrape():!a&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const a of this._style.getSources())if(a instanceof Qm){t=!0;break}if(!t)return;const r={};for(let a=0;a<this._style.order.length;++a){const l=this._style._mergedLayers[this._style.order[a]],u=this._style.getLayerSourceCache(l);if(u&&!r[u.id]&&!l.isHidden(this.painter.transform.zoom)&&"line"===l.type&&l.widthExpression()instanceof gc){r[u.id]=!0;for(const d of this.proxyCoords){const h=this.proxyToSource[d.key][u.id];if(h)for(const p of h)this._clearRenderCacheForTile(u.id,p)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a]._source instanceof ku){t=!0;break}if(!t)return;const r={};for(let a=0;a<this._style.order.length;++a){const l=this._style._mergedLayers[this._style.order[a]],u=this._style.getLayerSourceCache(l);if(!u||r[u.id]||l.isHidden(this.painter.transform.zoom)||"raster"!==l.type)continue;const d=l.paint.get("raster-fade-duration");for(const h of this.proxyCoords){const p=this.proxyToSource[h.key][u.id];if(p)for(const m of p){const _=MT(u.getTile(m),u.findLoadedParent(m,0),u,this.painter.transform,d);(1!==_.opacity||0!==_.mix)&&this._clearRenderCacheForTile(u.id,m)}}}}_setupDrapedRenderBatches(){const t=this._style.order,r=t.length;if(0===r)return;const a=[];this._pendingGroundEffectLayers=[];let l,u=0,d=this._style._mergedLayers[t[u]];for(;!this._style.isLayerDraped(d)&&d.isHidden(this.painter.transform.zoom)&&++u<r;)d=this._style._mergedLayers[t[u]];for(;u<r;++u){const h=this._style._mergedLayers[t[u]];h.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(h)?void 0===l&&(l=u):("fill-extrusion"===h.type&&this._pendingGroundEffectLayers.push(u),void 0!==l&&(a.push({start:l,end:u-1}),l=void 0)))}if(void 0!==l&&a.push({start:l,end:u-1}),0!==a.length){const h=a[a.length-1];this._pendingGroundEffectLayers.every(m=>m>h.end)||tt("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=a}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const d=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let h=0;h<d.length;++h){const p=Object.values(d[h]);r.renderCachePool.push(...p)}}return}this._clearRasterLayersFromRenderCache();const a=this.proxyCoords,l=this._tilesDirty;for(let d=a.length-1;d>=0;d--){const h=a[d];if(r.getTileByID(h.key),void 0!==r.proxyCachedFBO[h.key]){const p=t[h.key],m=this.proxyToSource[h.key];let _=0;for(const y in m){const x=m[y],b=p[y];if(!b||b.length!==x.length||x.some((E,C)=>E!==b[C]||l[y]&&l[y].hasOwnProperty(E.key))){_=-1;break}++_}for(const y in r.proxyCachedFBO[h.key])r.renderCache[r.proxyCachedFBO[h.key][y]].dirty=_<0||_!==Object.values(p).length}}const u=[...this._drapedRenderBatches];u.sort((d,h)=>h.end-h.start-(d.end-d.start));for(const d of u)for(const h of a){if(r.proxyCachedFBO[h.key])continue;let p=r.renderCachePool.pop();void 0===p&&r.renderCache.length<50&&(p=r.renderCache.length,r.renderCache.push(this._createFBO())),void 0!==p&&(r.proxyCachedFBO[h.key]={},r.proxyCachedFBO[h.key][d.start]=p,r.renderCache[p].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,a,l){if(!l||!this._sourceTilesOverlap[l.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const u=this.painter.context,d=u.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let h;if(a.isTileClipped())h=r.length,this._overlapStencilMode.test={func:d.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);h=1,this._overlapStencilMode.test={func:d.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+h>255&&(u.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=h,this._overlapStencilMode.ref=this._stencilRef,a.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Fe.disabled}_renderTileClippingMasks(t,r){const a=this.painter,l=this.painter.context,u=l.gl;a._tileClippingMaskIDs={},l.setColorMode(an.disabled),l.setDepthMode(ve.disabled);const d=a.getOrCreateProgram("clippingMask");for(const h of t){const p=a._tileClippingMaskIDs[h.key]=--r;d.draw(a,u.TRIANGLES,ve.disabled,new Fe({func:u.ALWAYS,mask:0},p,255,u.KEEP,u.KEEP,u.REPLACE),an.disabled,Ge.disabled,R1(h.projMatrix),"$clipping",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const a=[t.x,t.y,1,1];Ln.transformMat4(a,a,r.pixelMatrixInverse),Ln.scale(a,a,1/a[3]),a[0]/=r.worldSize,a[1]/=r.worldSize;const l=r._camera.position,u=Nn(1,r.center.lat),d=[l[0],l[1],l[2]/u,0],h=q.subtract([],a.slice(0,3),d);q.normalize(h,h);const p=this.raycast(d,h,this._exaggeration);return null!==p&&p?(q.scaleAndAdd(d,d,h,p),d[3]=d[2],d[2]*=u,d):null}drawDepth(){const t=this.painter,r=t.context,a=this.proxySourceCache,l=Math.ceil(t.width),u=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===l&&this._depthFBO.height===u||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const d=r.gl,h=r.createFramebuffer(l,u,!0,"renderbuffer");r.activeTexture.set(d.TEXTURE0);const p=new ir(r,{width:l,height:u,data:null},d.RGBA);p.bind(d.NEAREST,d.CLAMP_TO_EDGE),h.colorAttachment.set(p.texture);const m=r.createRenderbuffer(r.gl.DEPTH_COMPONENT16,l,u);h.depthAttachment.set(m),this._depthFBO=h,this._depthTexture=p}r.bindFramebuffer.set(this._depthFBO.framebuffer),r.viewport.set([0,0,l,u]),function(d,h,p,m){if("globe"===d.transform.projection.name)return;const _=d.context,y=_.gl;_.clear({depth:1});const x=d.getOrCreateProgram("terrainDepth"),b=new ve(y.LESS,ve.ReadWrite,d.depthRangeFor3D);for(const E of m){const C=p.getTile(E),S=FR(E.projMatrix,0,[0,0,0]);h.setupElevationDraw(C,x),x.draw(d,y.TRIANGLES,b,Fe.disabled,an.unblended,Ge.backCCW,S,"terrain_depth",h.gridBuffer,h.gridIndexBuffer,h.gridNoSkirtSegments)}}(t,this,a,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,r,a){if(t.getSource()instanceof ql)return this._setupProxiedCoordsForImageSource(t,r,a);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const l=this.proxiedCoords[t.id]=[],u=this.proxyCoords;for(let h=0;h<u.length;h++){const p=u[h],m=this._findTileCoveringTileID(p,t);if(m){const _=this._createProxiedId(p,m,a[p.key]&&a[p.key][t.id]);l.push(_),this.proxyToSource[p.key][t.id]=[_]}}let d=!1;for(let h=0;h<r.length;h++){const p=t.getTile(r[h]);if(!p||!p.hasData())continue;const m=this._findTileCoveringTileID(p.tileID,this.proxySourceCache);if(m&&m.tileID.canonical.z!==p.tileID.canonical.z){const _=this.proxyToSource[m.tileID.key][t.id],y=this._createProxiedId(m.tileID,p,a[m.tileID.key]&&a[m.tileID.key][t.id]);_?_.splice(_.length-1,0,y):this.proxyToSource[m.tileID.key][t.id]=[y],l.push(y),d=!0}}this._sourceTilesOverlap[t.id]=d}_setupProxiedCoordsForImageSource(t,r,a){if(!t.getSource().loaded())return;const l=this.proxiedCoords[t.id]=[],u=this.proxyCoords,d=t.getSource(),h=d.tileID;if(!h)return;const p=new nt(h.x,h.y)._div(1<<h.z),m=d.coordinates.map(Je.fromLngLat).reduce((y,x)=>(y.min.x=Math.min(y.min.x,x.x-p.x),y.min.y=Math.min(y.min.y,x.y-p.y),y.max.x=Math.max(y.max.x,x.x-p.x),y.max.y=Math.max(y.max.y,x.y-p.y),y),{min:new nt(Number.MAX_VALUE,Number.MAX_VALUE),max:new nt(-Number.MAX_VALUE,-Number.MAX_VALUE)}),_=(y,x)=>{const b=y.wrap+y.canonical.x/(1<<y.canonical.z),E=y.canonical.y/(1<<y.canonical.z),C=dt/(1<<y.canonical.z),S=x.wrap+x.canonical.x/(1<<x.canonical.z),M=x.canonical.y/(1<<x.canonical.z);return b+C<S+m.min.x||b>S+m.max.x||E+C<M+m.min.y||E>M+m.max.y};for(let y=0;y<u.length;y++){const x=u[y];for(let b=0;b<r.length;b++){const E=t.getTile(r[b]);if(!E||!E.hasData()||_(x,E.tileID))continue;const C=this._createProxiedId(x,E,a[x.key]&&a[x.key][t.id]),S=this.proxyToSource[x.key][t.id];S?S.push(C):this.proxyToSource[x.key][t.id]=[C],l.push(C)}}}_createProxiedId(t,r,a){let l=this.orthoMatrix;if(a){const u=a.find(d=>d.key===r.tileID.key);if(u)return u}if(r.tileID.key!==t.key){const u=t.canonical.z-r.tileID.canonical.z;let d,h,p;l=rt.create();const m=r.tileID.wrap-t.wrap<<t.overscaledZ;u>0?(d=dt>>u,h=d*((r.tileID.canonical.x<<u)-t.canonical.x+m),p=d*((r.tileID.canonical.y<<u)-t.canonical.y)):(d=dt<<-u,h=dt*(r.tileID.canonical.x-(t.canonical.x+m<<-u)),p=dt*(r.tileID.canonical.y-(t.canonical.y<<-u))),rt.ortho(l,0,d,0,d,0,1),rt.translate(l,l,[h,p,0])}return new ST(r.tileID,t.key,l)}_findTileCoveringTileID(t,r){let a=r.getTile(t);if(a&&a.hasData())return a;const l=this._findCoveringTileCache[r.id],u=l[t.key];if(a=u?r.getTileByID(u):null,a&&a.hasData()||null===u)return a;let d=a?a.tileID:t,h=d.overscaledZ;const p=r.getSource().minzoom,m=[];if(!u){const y=r.getSource().maxzoom;if(t.canonical.z>=y){const x=t.canonical.z-y;r.getSource().reparseOverscaled?(h=Math.max(t.canonical.z+2,r.transform.tileZoom),d=new tn(h,t.wrap,y,t.canonical.x>>x,t.canonical.y>>x)):0!==x&&(h=y,d=new tn(h,t.wrap,y,t.canonical.x>>x,t.canonical.y>>x))}d.key!==t.key&&(m.push(d.key),a=r.getTile(d))}const _=y=>{m.forEach(x=>{l[x]=y}),m.length=0};for(h-=1;h>=p&&(!a||!a.hasData());h--){a&&_(a.tileID.key);const y=d.calculateScaledKey(h);if(a=r.getTileByID(y),a&&a.hasData())break;const x=l[y];if(null===x)break;void 0===x?m.push(y):a=r.getTileByID(x)}return _(a?a.tileID.key:null),a&&a.hasData()?a:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let a=this._tilesDirty[t];a||(a=this._tilesDirty[t]={}),a[r.key]=!0}}function VR(n,t,r){const a=function(h,p,m){const _=q.dot(p,h),y=q.dot(m,[.2126,.7152,.0722]),x=(E,C,S)=>(1-S)*E+S*C,b=x(1-.3*Math.min(y,1),1,Math.min(_+1,1));return x(.92,1,Math.asin(Jt(p[2],-1,1))/Math.PI+.5)*b}(n,[0,0,1],t),l=[0,0,0];q.scale(l,r.slice(0,3),a);const u=[0,0,0];q.scale(u,t.slice(0,3),n[2]);const d=[0,0,0];return q.add(d,l,u),ni(d)}const jR=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],UR=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class kf{static cacheKey(t,r,a,l){let u=`${r}${l?l.cacheKey:""}`;for(const d of a)t.usedDefines.includes(d)&&(u+=`/${d}`);return u}constructor(t,r,a,l,u,d){const h=t.gl;this.program=h.createProgram(),this.configuration=l,this.name=r,this.fixedDefines=[...d];const p=function(M){const D=[];for(let R=0;R<M.length;R++){if(null===M[R])continue;const P=M[R].split(" ");D.push(P.pop())}return D}(a.staticAttributes),m=l?l.getBinderAttributes():[],_=p.concat(m);let y=l?l.defines():[];y=y.concat(d.map(M=>`#define ${M}`));const x="#version 300 es\n";let b=x+y.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",yv,T1.fragmentSource).join("\n");for(const M of a.fragmentIncludes)b+=`\n${Pf[M]}`;b+=`\n${a.fragmentSource}`;let E=x+y.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",yv,T1.vertexSource).join("\n");for(const M of a.vertexIncludes)E+=`\n${Pf[M]}`;E+=`\n${a.vertexSource}`;const C=h.createShader(h.FRAGMENT_SHADER);if(h.isContextLost())return void(this.failedToCreate=!0);h.shaderSource(C,b),h.compileShader(C),h.attachShader(this.program,C);const S=h.createShader(h.VERTEX_SHADER);if(h.isContextLost())this.failedToCreate=!0;else{h.shaderSource(S,E),h.compileShader(S),h.attachShader(this.program,S),this.attributes={},this.numAttributes=_.length;for(let M=0;M<this.numAttributes;M++)if(_[M]){const D=_[M].startsWith("a_")?_[M]:`a_${_[M]}`;h.bindAttribLocation(this.program,M,D),this.attributes[D]=M}h.linkProgram(this.program),h.deleteShader(S),h.deleteShader(C),this.fixedUniforms=u(t),this.binderUniforms=l?l.getUniforms(t):[],d.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new $e(M=t),u_dem_prev:new $e(M),u_dem_unpack:new Es(M),u_dem_tl:new Ze(M),u_dem_scale:new Et(M),u_dem_tl_prev:new Ze(M),u_dem_scale_prev:new Et(M),u_dem_size:new Et(M),u_dem_lerp:new Et(M),u_exaggeration:new Et(M),u_depth:new $e(M),u_depth_size_inv:new Ze(M),u_meter_to_dem:new Et(M),u_label_plane_matrix_inv:new De(M)}),d.includes("GLOBE")&&(this.globeUniforms=(M=>({u_tile_tl_up:new me(M),u_tile_tr_up:new me(M),u_tile_br_up:new me(M),u_tile_bl_up:new me(M),u_tile_up_scale:new Et(M)}))(t)),d.includes("FOG")&&(this.fogUniforms=(M=>({u_fog_matrix:new De(M),u_fog_range:new Ze(M),u_fog_color:new Es(M),u_fog_horizon_blend:new Et(M),u_fog_vertical_limit:new Ze(M),u_fog_temporal_offset:new Et(M),u_frustum_tl:new me(M),u_frustum_tr:new me(M),u_frustum_br:new me(M),u_frustum_bl:new me(M),u_globe_pos:new me(M),u_globe_radius:new Et(M),u_globe_transition:new Et(M),u_is_globe:new $e(M),u_viewport:new Ze(M)}))(t)),d.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(M=>({u_cutoff_params:new Es(M)}))(t)),d.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(M=>({u_lighting_ambient_color:new me(M),u_lighting_directional_dir:new me(M),u_lighting_directional_color:new me(M),u_ground_radiance:new me(M)}))(t)),d.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(M=>({u_light_matrix_0:new De(M),u_light_matrix_1:new De(M),u_fade_range:new Ze(M),u_shadow_normal_offset:new me(M),u_shadow_intensity:new Et(M),u_shadow_texel_size:new Et(M),u_shadow_map_resolution:new Et(M),u_shadow_direction:new me(M),u_shadow_bias:new me(M),u_shadowmap_0:new $e(M),u_shadowmap_1:new $e(M)}))(t))}var M}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const a=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)a[l]&&a[l].set(this.program,l,r[l])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const a=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)a[l]&&a[l].set(this.program,l,r[l])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const a=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)a[l].set(this.program,l,r[l])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const a=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)a[l].set(this.program,l,r[l])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const a=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const l in r)a[l].set(this.program,l,r[l])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const a=this.shadowUniforms;t.program.set(this.program);for(const l in r)a[l].set(this.program,l,r[l])}_drawDebugWireframe(t,r,a,l,u,d,h,p,m,_){const y=t.options.wireframe;if(!1===y.terrain&&!1===y.layers2D&&!1===y.layers3D)return;const x=t.context;if(!(()=>!(!y.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!y.layers2D||t._terrain&&t._terrain.renderingToTexture||!jR.includes(this.name))||!(!y.layers3D||!UR.includes(this.name)))())return;const b=x.gl,E=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,u,x);if(!E)return;const C=[...this.fixedDefines];C.push("DEBUG_WIREFRAME");const S=t.getOrCreateProgram(this.name,{config:this.configuration,defines:C});x.program.set(S.program);const M=(P,I,O)=>{if(I[P]&&O[P])for(const F in I[P])O[P][F]&&O[P][F].set(O.program,F,I[P][F].current)};m&&m.setUniforms(S.program,x,S.binderUniforms,h,{zoom:p}),M("fixedUniforms",this,S),M("terrainUniforms",this,S),M("globeUniforms",this,S),M("fogUniforms",this,S),M("lightsUniforms",this,S),M("shadowUniforms",this,S),E.bind(),x.setColorMode(new an([b.ONE,b.ONE_MINUS_SRC_ALPHA,b.ZERO,b.ONE],Ne.transparent,[!0,!0,!0,!1])),x.setDepthMode(new ve(r.func===b.LESS?b.LEQUAL:r.func,ve.ReadOnly,r.range)),x.setStencilMode(Fe.disabled);const D=3*d.primitiveLength*2,R=3*d.primitiveOffset*2*2;_&&_>1?b.drawElementsInstanced(b.LINES,D,b.UNSIGNED_SHORT,R,_):b.drawElements(b.LINES,D,b.UNSIGNED_SHORT,R),u.bind(),x.program.set(this.program),x.setDepthMode(r),x.setStencilMode(a),x.setColorMode(l)}draw(t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S){const M=t.context,D=M.gl;if(this.failedToCreate)return;M.program.set(this.program),M.setDepthMode(a),M.setStencilMode(l),M.setColorMode(u),M.setCullFace(d);for(const I of Object.keys(this.fixedUniforms))this.fixedUniforms[I].set(this.program,I,h[I]);E&&E.setUniforms(this.program,M,this.binderUniforms,x,{zoom:b});const R={[D.LINES]:2,[D.TRIANGLES]:3,[D.LINE_STRIP]:1}[r],P=S&&S>0?1:void 0;for(const I of y.get()){const O=I.vaos||(I.vaos={});(O[p]||(O[p]=new xT)).bind(M,this,m,E?E.getPaintVertexBuffers():[],_,I.vertexOffset,C||[],P),S&&S>1?D.drawElementsInstanced(r,I.primitiveLength*R,D.UNSIGNED_SHORT,I.primitiveOffset*R*2,S):D.drawElements(r,I.primitiveLength*R,D.UNSIGNED_SHORT,I.primitiveOffset*R*2),r===D.TRIANGLES&&this._drawDebugWireframe(t,a,l,u,_,I,x,b,E,S)}}}function P1(n,t){const r=Math.pow(2,t.tileID.overscaledZ),a=t.tileSize*Math.pow(2,n.transform.tileZoom)/r,l=a*(t.tileID.canonical.x+t.tileID.wrap*r),u=a*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/Pd(t,1,n.transform.tileZoom),u_pixel_coord_upper:[l>>16,u>>16],u_pixel_coord_lower:[65535&l,65535&u]}}const TT=rt.create(),O1=(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E)=>{const C=t.style.light,S=C.properties.get("position"),M=[S.x,S.y,S.z],D=Yo.create();"viewport"===C.properties.get("anchor")&&(Yo.fromRotation(D,-t.transform.angle),q.transformMat3(M,M,D));const R=C.properties.get("color"),P=t.transform,I={u_matrix:n,u_lightpos:M,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+r,u_opacity:a,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:TT,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:l,u_edge_radius:u,u_flood_light_color:y,u_vertical_scale:x,u_flood_light_intensity:b,u_ground_shadow_factor:E};return"globe"===P.projection.name&&(I.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],I.u_zoom_transition=p,I.u_inv_rot_matrix=_,I.u_merc_center=m,I.u_up_dir=P.projection.upVector(new ya(0,0,0),m[0]*dt,m[1]*dt),I.u_height_lift=h),I},DT=(n,t,r)=>({u_matrix:n,u_edge_radius:t,u_vertical_scale:r}),IT=(n,t,r,a,l,u,d,h,p,m,_,y,x,b)=>{const E=O1(n,t,r,a,l,u,d,p,m,_,y,x,b,1,[0,0,0]),C={u_height_factor:-Math.pow(2,d.overscaledZ)/h.tileSize/8};return Yt(E,P1(t,h),C)},AT=(n,t)=>({u_matrix:n,u_emissive_strength:t}),RT=(n,t,r,a)=>Yt(AT(n,t),P1(r,a)),ZF=(n,t,r)=>({u_matrix:n,u_world:r,u_emissive_strength:t}),XF=(n,t,r,a,l)=>Yt(RT(n,t,r,a),{u_world:l}),HR=(n,t,r,a)=>{const l=dt/r.tileSize;return{u_matrix:n,u_camera_to_center_distance:t.getCameraToCenterDistance(a),u_extrude_scale:[t.pixelsToGLUnits[0]/l,t.pixelsToGLUnits[1]/l]}},PT=(n,t,r=1)=>({u_matrix:n,u_color:t,u_overlay:0,u_overlay_scale:r}),$R=rt.create(),GR=(n,t,r,a,l,u,d)=>{const h=n.transform,p="globe"===h.projection.name,m=p?$C(h.zoom,t.canonical)*h._pixelsPerMercatorPixel:Pd(r,1,u),_={u_matrix:t.projMatrix,u_extrude_scale:m,u_intensity:d,u_inv_rot_matrix:$R,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(p){_.u_inv_rot_matrix=a,_.u_merc_center=l,_.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],_.u_zoom_transition=Vr(h.zoom);const y=l[0]*dt,x=l[1]*dt;_.u_up_dir=h.projection.upVector(new ya(0,0,0),y,x)}return _},OT=(n,t,r,a,l,u,d,h,p,m,_)=>{return{u_matrix:n,u_normalize_matrix:t,u_globe_matrix:r,u_tl_parent:a,u_scale_parent:l,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(x=d.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(y=d.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:dg(d.paint.get("raster-hue-rotate")),u_perspective_transform:h,u_colorization_mix:m,u_colorization_scale:qR(_),u_color_ramp:p};var y,x};function dg(n){n*=Math.PI/180;const t=Math.sin(n),r=Math.cos(n);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}function qR([n,t]){if(n===t)return[n,t];const r=(t+n)/2,a=(t-n)/2*256/255;return[-(n=r-a)/((t=r+a)-n),1/(t-n)]}const Ff=rt.create(),kT=(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S)=>{const M=l.transform,D={u_is_size_zoom_constant:+("constant"===n||"source"===n),u_is_size_feature_constant:+("constant"===n||"camera"===n),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:M.getCameraToCenterDistance(C),u_rotate_symbol:+r,u_aspect_ratio:M.width/M.height,u_fade_change:l.options.fadeDuration?l.symbolFadeChange:1,u_matrix:u,u_label_plane_matrix:d,u_coord_matrix:h,u_is_text:+p,u_pitch_with_map:+a,u_texsize:m,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ff,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ff,u_up_vector:[0,-1,0],u_icon_transition:S||0};return"globe"===C.name&&(D.u_tile_id=[_.canonical.x,_.canonical.y,1<<_.canonical.z],D.u_zoom_transition=y,D.u_inv_rot_matrix=b,D.u_merc_center=x,D.u_camera_forward=M._camera.forward(),D.u_ecef_origin=function(R,P){const I=[0,0,0],O=eo(ko(P.canonical));return q.transformMat4(I,I,O),q.transformMat4(I,I,R),I}(M.globeMatrix,_.toUnwrapped()),D.u_tile_matrix=Float32Array.from(M.globeMatrix),D.u_up_vector=E),D},WR=(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S)=>Yt(kT(n,t,r,a,l,u,d,h,p,m,y,x,b,E,C,S),{u_gamma_scale:a?l.transform.getCameraToCenterDistance(S)*Math.cos(l.terrain?0:l.transform._pitch):1,u_device_pixel_ratio:kt.devicePixelRatio,u_is_halo:+_,undefined:void 0}),ZR=(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C)=>Yt(WR(n,t,r,a,l,u,d,h,!0,p,!0,_,y,x,b,E,C),{u_texsize_icon:m,u_texture_icon:1}),YF=(n,t,r,a)=>({u_matrix:n,u_emissive_strength:t,u_opacity:r,u_color:a}),Wl=(n,t,r,a,l,u,d)=>Yt(function(h,p,m,_){const y=m.imageManager.getPattern(h.toString(),p),{width:x,height:b}=m.imageManager.getPixelSize(p),E=Math.pow(2,_.tileID.overscaledZ),C=_.tileSize*Math.pow(2,m.transform.tileZoom)/E,S=C*(_.tileID.canonical.x+_.tileID.wrap*E),M=C*_.tileID.canonical.y;return{u_image:0,u_pattern_tl:y.tl,u_pattern_br:y.br,u_texsize:[x,b],u_pattern_size:y.displaySize,u_tile_units_to_pixels:1/Pd(_,1,m.transform.tileZoom),u_pixel_coord_upper:[S>>16,M>>16],u_pixel_coord_lower:[65535&S,65535&M]}}(l,u,a,d),{u_matrix:n,u_emissive_strength:t,u_opacity:r}),Ps={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},k1=(n,t,r,a,l,u,d,h,p,m,_,y=[0,0,0])=>{const x=a.style.light,b=x.properties.get("position"),E=[-b.x,-b.y,b.z],C=Yo.create();"viewport"===x.properties.get("anchor")&&(Yo.fromRotation(C,-a.transform.angle),q.transformMat3(E,E,C));const S="MASK"===m.alphaMode,M=x.properties.get("color"),D=_.paint.get("model-ambient-occlusion-intensity"),R=_.paint.get("model-color").constantOr(Ne.white),P=_.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:n,u_lighting_matrix:t,u_normal_matrix:r,u_lightpos:E,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_camera_pos:y,u_opacity:l,u_baseTextureIsAlpha:0,u_alphaMask:+S,u_alphaCutoff:m.alphaCutoff,u_baseColorFactor:[u.r,u.g,u.b,u.a],u_emissiveFactor:[d[0],d[1],d[2],1],u_metallicFactor:h,u_roughnessFactor:p,u_baseColorTexture:Ps.BaseColor,u_metallicRoughnessTexture:Ps.MetallicRoughness,u_normalTexture:Ps.Normal,u_occlusionTexture:Ps.Occlusion,u_emissionTexture:Ps.Emission,u_color_mix:[R.r,R.g,R.b,P],u_aoIntensity:D}},FT=new Float32Array(16),hg=(n,t=FT,r=FT)=>({u_matrix:n,u_instance:t,u_node_matrix:r}),LT={fillExtrusion:n=>({u_matrix:new De(n),u_lightpos:new me(n),u_lightintensity:new Et(n),u_lightcolor:new me(n),u_vertical_gradient:new Et(n),u_opacity:new Et(n),u_edge_radius:new Et(n),u_ao:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_up_dir:new me(n),u_height_lift:new Et(n),u_flood_light_color:new me(n),u_vertical_scale:new Et(n),u_flood_light_intensity:new Et(n),u_ground_shadow_factor:new me(n)}),fillExtrusionDepth:n=>({u_matrix:new De(n),u_edge_radius:new Et(n),u_vertical_scale:new Et(n)}),fillExtrusionPattern:n=>({u_matrix:new De(n),u_lightpos:new me(n),u_lightintensity:new Et(n),u_lightcolor:new me(n),u_vertical_gradient:new Et(n),u_height_factor:new Et(n),u_edge_radius:new Et(n),u_ao:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_up_dir:new me(n),u_height_lift:new Et(n),u_image:new $e(n),u_texsize:new Ze(n),u_pixel_coord_upper:new Ze(n),u_pixel_coord_lower:new Ze(n),u_tile_units_to_pixels:new Et(n),u_opacity:new Et(n)}),fillExtrusionGroundEffect:n=>({u_matrix:new De(n),u_opacity:new Et(n),u_ao_pass:new Et(n),u_meter_to_tile:new Et(n),u_ao:new Ze(n),u_flood_light_intensity:new Et(n),u_flood_light_color:new me(n),u_attenuation:new Et(n),u_edge_radius:new Et(n),u_fb:new $e(n),u_fb_size:new Et(n)}),fill:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n)}),fillPattern:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_image:new $e(n),u_texsize:new Ze(n),u_pixel_coord_upper:new Ze(n),u_pixel_coord_lower:new Ze(n),u_tile_units_to_pixels:new Et(n)}),fillOutline:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_world:new Ze(n)}),fillOutlinePattern:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_world:new Ze(n),u_image:new $e(n),u_texsize:new Ze(n),u_pixel_coord_upper:new Ze(n),u_pixel_coord_lower:new Ze(n),u_tile_units_to_pixels:new Et(n)}),circle:n=>({u_camera_to_center_distance:new Et(n),u_extrude_scale:new hu(n),u_device_pixel_ratio:new Et(n),u_matrix:new De(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_up_dir:new me(n),u_emissive_strength:new Et(n)}),collisionBox:n=>({u_matrix:new De(n),u_camera_to_center_distance:new Et(n),u_extrude_scale:new Ze(n)}),collisionCircle:n=>({u_matrix:new De(n),u_inv_matrix:new De(n),u_camera_to_center_distance:new Et(n),u_viewport_size:new Ze(n)}),debug:n=>({u_color:new xr(n),u_matrix:new De(n),u_overlay:new $e(n),u_overlay_scale:new Et(n)}),clippingMask:n=>({u_matrix:new De(n)}),heatmap:n=>({u_extrude_scale:new Et(n),u_intensity:new Et(n),u_matrix:new De(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_up_dir:new me(n)}),heatmapTexture:n=>({u_image:new $e(n),u_color_ramp:new $e(n),u_opacity:new Et(n)}),hillshade:n=>({u_matrix:new De(n),u_image:new $e(n),u_latrange:new Ze(n),u_light:new Ze(n),u_shadow:new xr(n),u_highlight:new xr(n),u_emissive_strength:new Et(n),u_accent:new xr(n)}),hillshadePrepare:n=>({u_matrix:new De(n),u_image:new $e(n),u_dimension:new Ze(n),u_zoom:new Et(n),u_unpack:new Es(n)}),line:n=>({u_matrix:new De(n),u_pixels_to_tile_units:new hu(n),u_device_pixel_ratio:new Et(n),u_units_to_pixels:new Ze(n),u_dash_image:new $e(n),u_gradient_image:new $e(n),u_image_height:new Et(n),u_texsize:new Ze(n),u_tile_units_to_pixels:new Et(n),u_alpha_discard_threshold:new Et(n),u_trim_offset:new Ze(n),u_emissive_strength:new Et(n)}),linePattern:n=>({u_matrix:new De(n),u_texsize:new Ze(n),u_pixels_to_tile_units:new hu(n),u_device_pixel_ratio:new Et(n),u_image:new $e(n),u_units_to_pixels:new Ze(n),u_tile_units_to_pixels:new Et(n),u_alpha_discard_threshold:new Et(n)}),raster:n=>({u_matrix:new De(n),u_normalize_matrix:new De(n),u_globe_matrix:new De(n),u_tl_parent:new Ze(n),u_scale_parent:new Et(n),u_fade_t:new Et(n),u_opacity:new Et(n),u_image0:new $e(n),u_image1:new $e(n),u_brightness_low:new Et(n),u_brightness_high:new Et(n),u_saturation_factor:new Et(n),u_contrast_factor:new Et(n),u_spin_weights:new me(n),u_perspective_transform:new Ze(n),u_colorization_mix:new Es(n),u_colorization_scale:new Ze(n),u_color_ramp:new $e(n)}),symbolIcon:n=>({u_is_size_zoom_constant:new $e(n),u_is_size_feature_constant:new $e(n),u_size_t:new Et(n),u_size:new Et(n),u_camera_to_center_distance:new Et(n),u_rotate_symbol:new $e(n),u_aspect_ratio:new Et(n),u_fade_change:new Et(n),u_matrix:new De(n),u_label_plane_matrix:new De(n),u_coord_matrix:new De(n),u_is_text:new $e(n),u_pitch_with_map:new $e(n),u_texsize:new Ze(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_camera_forward:new me(n),u_tile_matrix:new De(n),u_up_vector:new me(n),u_ecef_origin:new me(n),u_texture:new $e(n),u_icon_transition:new Et(n)}),symbolSDF:n=>({u_is_size_zoom_constant:new $e(n),u_is_size_feature_constant:new $e(n),u_size_t:new Et(n),u_size:new Et(n),u_camera_to_center_distance:new Et(n),u_rotate_symbol:new $e(n),u_aspect_ratio:new Et(n),u_fade_change:new Et(n),u_matrix:new De(n),u_label_plane_matrix:new De(n),u_coord_matrix:new De(n),u_is_text:new $e(n),u_pitch_with_map:new $e(n),u_texsize:new Ze(n),u_texture:new $e(n),u_gamma_scale:new Et(n),u_device_pixel_ratio:new Et(n),u_tile_id:new me(n),u_zoom_transition:new Et(n),u_inv_rot_matrix:new De(n),u_merc_center:new Ze(n),u_camera_forward:new me(n),u_tile_matrix:new De(n),u_up_vector:new me(n),u_ecef_origin:new me(n),u_is_halo:new $e(n)}),symbolTextAndIcon:n=>({u_is_size_zoom_constant:new $e(n),u_is_size_feature_constant:new $e(n),u_size_t:new Et(n),u_size:new Et(n),u_camera_to_center_distance:new Et(n),u_rotate_symbol:new $e(n),u_aspect_ratio:new Et(n),u_fade_change:new Et(n),u_matrix:new De(n),u_label_plane_matrix:new De(n),u_coord_matrix:new De(n),u_is_text:new $e(n),u_pitch_with_map:new $e(n),u_texsize:new Ze(n),u_texsize_icon:new Ze(n),u_texture:new $e(n),u_texture_icon:new $e(n),u_gamma_scale:new Et(n),u_device_pixel_ratio:new Et(n),u_is_halo:new $e(n)}),background:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_opacity:new Et(n),u_color:new xr(n)}),backgroundPattern:n=>({u_matrix:new De(n),u_emissive_strength:new Et(n),u_opacity:new Et(n),u_image:new $e(n),u_pattern_tl:new Ze(n),u_pattern_br:new Ze(n),u_texsize:new Ze(n),u_pattern_size:new Ze(n),u_pixel_coord_upper:new Ze(n),u_pixel_coord_lower:new Ze(n),u_tile_units_to_pixels:new Et(n)}),terrainRaster:I1,terrainDepth:I1,skybox:n=>({u_matrix:new De(n),u_sun_direction:new me(n),u_cubemap:new $e(n),u_opacity:new Et(n),u_temporal_offset:new Et(n)}),skyboxGradient:n=>({u_matrix:new De(n),u_color_ramp:new $e(n),u_center_direction:new me(n),u_radius:new Et(n),u_opacity:new Et(n),u_temporal_offset:new Et(n)}),skyboxCapture:n=>({u_matrix_3f:new fd(n),u_sun_direction:new me(n),u_sun_intensity:new Et(n),u_color_tint_r:new Es(n),u_color_tint_m:new Es(n),u_luminance:new Et(n)}),globeRaster:n=>({u_proj_matrix:new De(n),u_globe_matrix:new De(n),u_normalize_matrix:new De(n),u_merc_matrix:new De(n),u_zoom_transition:new Et(n),u_merc_center:new Ze(n),u_image0:new $e(n),u_grid_matrix:new fd(n),u_skirt_height:new Et(n),u_frustum_tl:new me(n),u_frustum_tr:new me(n),u_frustum_br:new me(n),u_frustum_bl:new me(n),u_globe_pos:new me(n),u_globe_radius:new Et(n),u_viewport:new Ze(n)}),globeAtmosphere:n=>({u_frustum_tl:new me(n),u_frustum_tr:new me(n),u_frustum_br:new me(n),u_frustum_bl:new me(n),u_horizon:new Et(n),u_transition:new Et(n),u_fadeout_range:new Et(n),u_color:new Es(n),u_high_color:new Es(n),u_space_color:new Es(n),u_temporal_offset:new Et(n),u_horizon_angle:new Et(n)}),model:n=>({u_matrix:new De(n),u_lighting_matrix:new De(n),u_normal_matrix:new De(n),u_lightpos:new me(n),u_lightintensity:new Et(n),u_lightcolor:new me(n),u_camera_pos:new me(n),u_opacity:new Et(n),u_baseColorFactor:new Es(n),u_emissiveFactor:new Es(n),u_metallicFactor:new Et(n),u_roughnessFactor:new Et(n),u_baseTextureIsAlpha:new $e(n),u_alphaMask:new $e(n),u_alphaCutoff:new Et(n),u_baseColorTexture:new $e(n),u_metallicRoughnessTexture:new $e(n),u_normalTexture:new $e(n),u_occlusionTexture:new $e(n),u_emissionTexture:new $e(n),u_color_mix:new Es(n),u_aoIntensity:new Et(n)}),modelDepth:n=>({u_matrix:new De(n),u_instance:new De(n),u_node_matrix:new De(n)}),groundShadow:n=>({u_matrix:new De(n),u_ground_shadow_factor:new me(n)}),stars:n=>({u_matrix:new De(n),u_up:new me(n),u_right:new me(n),u_intensity_multiplier:new Et(n)})};let vv;function F1(n,t,r,a,l,u,d){const h=n.context,p=h.gl,m=n.transform,_=n.getOrCreateProgram("collisionBox"),y=[];let x=0,b=0;for(let P=0;P<a.length;P++){const I=a[P],O=t.getTile(I),F=O.getBucket(r);if(!F)continue;const L=vR(I,F,m);let N=L;0===l[0]&&0===l[1]||(N=n.translatePosMatrix(L,O,l,u));const z=d?F.textCollisionBox:F.iconCollisionBox,U=F.collisionCircleArray;if(U.length>0){const V=rt.create(),G=N;rt.mul(V,F.placementInvProjMatrix,m.glCoordMatrix),rt.mul(V,V,F.placementViewportMatrix),y.push({circleArray:U,circleOffset:b,transform:G,invTransform:V,projection:F.getProjection()}),x+=U.length/4,b=x}z&&(n.terrain&&n.terrain.setupElevationDraw(O,_),_.draw(n,p.LINES,ve.disabled,Fe.disabled,n.colorModeForRenderPass(),Ge.disabled,HR(N,m,O,F.getProjection()),r.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,null,m.zoom,null,[z.collisionVertexBuffer,z.collisionVertexBufferExt]))}if(!d||!y.length)return;const E=n.getOrCreateProgram("collisionCircle"),C=new Mh;C.resize(4*x),C._trim();let S=0;for(const P of y)for(let I=0;I<P.circleArray.length/4;I++){const O=4*I,F=P.circleArray[O+0],L=P.circleArray[O+1],N=P.circleArray[O+2],z=P.circleArray[O+3];C.emplace(S++,F,L,N,z,0),C.emplace(S++,F,L,N,z,1),C.emplace(S++,F,L,N,z,2),C.emplace(S++,F,L,N,z,3)}(!vv||vv.length<2*x)&&(vv=function(P){const I=2*P,O=new er;O.resize(I),O._trim();for(let F=0;F<I;F++){const L=6*F;O.uint16[L+0]=4*F+0,O.uint16[L+1]=4*F+1,O.uint16[L+2]=4*F+2,O.uint16[L+3]=4*F+2,O.uint16[L+4]=4*F+3,O.uint16[L+5]=4*F+0}return O}(x));const M=h.createIndexBuffer(vv,!0),D=h.createVertexBuffer(C,s2.members,!0);for(const P of y){const I={u_matrix:P.transform,u_inv_matrix:P.invTransform,u_camera_to_center_distance:(R=m).getCameraToCenterDistance(P.projection),u_viewport_size:[R.width,R.height]};E.draw(n,p.TRIANGLES,ve.disabled,Fe.disabled,n.colorModeForRenderPass(),Ge.disabled,I,r.id,D,M,Bn.simpleSegment(0,2*P.circleOffset,P.circleArray.length,P.circleArray.length/2),null,m.zoom)}var R;D.destroy(),M.destroy()}const fg=rt.create();function XR({width:n,height:t,anchor:r,textOffset:a,textScale:l},u){const{horizontalAlign:d,verticalAlign:h}=Ty(r),p=-(d-.5)*n,m=-(h-.5)*t,_=Cm(r,a);return new nt((p/l+_[0])*u,(m/l+_[1])*u)}function YR(n,t,r,a,l,u,d,h,p,m,_){const y=n.text.placedSymbolArray,x=n.text.dynamicLayoutVertexArray,b=n.icon.dynamicLayoutVertexArray,E={},C=n.getProjection(),S=lv(h,C,u),M=u.elevation,D=C.upVectorScale(h.canonical,u.center.lat,u.worldSize).metersToTile;x.clear();for(let R=0;R<y.length;R++){const P=y.get(R),{tileAnchorX:I,tileAnchorY:O,numGlyphs:F}=P,L=P.hidden||!P.crossTileID||n.allowVerticalPlacement&&!P.placedOrientation?null:a[P.crossTileID];if(L){let N=0,z=0,U=0;if(M){const ot=M?M.getAtTileOffset(h,I,O):0,[lt,ht,mt]=C.upVector(h.canonical,I,O);N=ot*lt*D,z=ot*ht*D,U=ot*mt*D}let[V,G,j,Z]=Ma(P.projectedAnchorX+N,P.projectedAnchorY+z,P.projectedAnchorZ+U,r?S:d);const et=dS(u.getCameraToCenterDistance(C),Z);let it=l.evaluateSizeForFeature(n.textSizeData,m,P)*et/Lr;r&&(it*=n.tilePixelRatio/p);const X=XR(L,it);r?(({x:V,y:G,z:j}=C.projectTilePoint(I+X.x,O+X.y,h.canonical)),[V,G,j]=Ma(V+N,G+z,j+U,d)):(t&&X._rotate(-u.angle),V+=X.x,G+=X.y,j=0);const Y=n.allowVerticalPlacement&&P.placedOrientation===ti.vertical?Math.PI/2:0;for(let ot=0;ot<F;ot++)df(x,V,G,j,Y);_&&P.associatedIconIndex>=0&&(E[P.associatedIconIndex]={x:V,y:G,z:j,angle:Y})}else Od(F,x)}if(_){b.clear();const R=n.icon.placedSymbolArray;for(let P=0;P<R.length;P++){const I=R.get(P),{numGlyphs:O}=I,F=E[P];if(I.hidden||!F)Od(O,b);else{const{x:L,y:N,z,angle:U}=F;for(let V=0;V<O;V++)df(b,L,N,z,U)}}n.icon.dynamicLayoutVertexBuffer.updateData(b)}n.text.dynamicLayoutVertexBuffer.updateData(x)}function NT(n,t,r){return r.iconsInText&&t?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function zT(n,t,r,a,l,u,d,h,p,m,_,y){const x=n.context,b=x.gl,E=n.transform,C="map"===h,S="map"===p,M=C&&"point"!==r.layout.get("symbol-placement"),D=C&&!S&&!M,R=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let P=!1;const I=n.depthModeForSublayer(0,ve.ReadOnly),O=[no(E.center.lng),mo(E.center.lat)],F=r.layout.get("text-variable-anchor"),L="globe"===E.projection.name,N=[],z=[0,-1,0];let U=z;!L&&!E.mercatorFromTransition||C||(U=function(V){const G=V._camera.getWorldToCamera(V.worldSize,1),j=rt.multiply([],G,V.globeMatrix);rt.invert(j,j);const Z=[0,0,0],et=[0,1,0,0];return Ln.transformMat4(et,et,j),Z[0]=et[0],Z[1]=et[1],Z[2]=et[2],q.normalize(Z,Z),Z}(E));for(const V of a){const G=t.getTile(V),j=G.getBucket(r);if(!j||"mercator"===j.projection.name&&L)continue;const Z=l?j.text:j.icon;if(!Z||j.fullyClipped||!Z.segments.get().length)continue;const et=Z.programConfigurations.get(r.id),it=l||j.sdfIcons,X=l?j.textSizeData:j.iconSizeData,Y=S||0!==E.pitch,ot=Ic(X,E.zoom);let lt,ht,mt,vt,ct=[0,0],ft=null;if(l)ht=G.glyphAtlasTexture,mt=b.LINEAR,lt=G.glyphAtlasTexture.size,j.iconsInText&&(ct=G.imageAtlasTexture.size,ft=G.imageAtlasTexture,vt=Y||n.options.rotating||n.options.zooming||"composite"===X.kind||"camera"===X.kind?b.LINEAR:b.NEAREST);else{const vi=1!==r.layout.get("icon-size").constantOr(0)||j.iconsNeedLinear;ht=G.imageAtlasTexture,mt=it||n.options.rotating||n.options.zooming||vi||Y?b.LINEAR:b.NEAREST,lt=G.imageAtlasTexture.size}const Rt="globe"===j.projection.name,Vt=Rt?U:z,jt=Rt?Vr(E.zoom):0,Ht=lv(V,j.getProjection(),E),re=E.calculatePixelsToTileUnitsMatrix(G),ye=Iu(Ht,G.tileID.canonical,S,C,E,j.getProjection(),re),je=n.terrain&&S&&M?rt.invert(rt.create(),ye):fg,rn=Bb(Ht,G.tileID.canonical,S,C,E,j.getProjection(),re),Re=F&&j.hasTextData(),Me=j.hasIconTextFit()&&Re&&j.hasIconData();if(M){const vi=E.elevation,hi=vi?vi.getAtTileOffsetFunc(V,E.center.lat,E.worldSize,j.getProjection()):null,Gn=wf(Ht,G.tileID.canonical,S,C,E,j.getProjection(),re);hS(j,Ht,n,l,Gn,rn,S,m,hi,V)}const ge=M||l&&F||Me,ue=n.translatePosMatrix(Ht,G,u,d),Le=ge?fg:ye,ln=n.translatePosMatrix(rn,G,u,d,!0),Be=j.getProjection().createInversionMatrix(E,V.canonical),Zn=r.paint.get("icon-image-cross-fade").constantOr(0),Ti=[];n.terrainRenderModeElevated()&&S&&Ti.push("PITCH_WITH_MAP_TERRAIN"),Rt&&(Ti.push("PROJECTION_GLOBE_VIEW"),ge&&Ti.push("PROJECTED_POS_ON_VIEWPORT")),Zn>0&&Ti.push("ICON_TRANSITION"),Z.zOffsetVertexBuffer&&Ti.push("Z_OFFSET");const di=it&&0!==r.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1);let ei;ei=it?j.iconsInText?ZR(X.kind,ot,D,S,n,ue,Le,ln,lt,ct,V,jt,O,Be,Vt,j.getProjection()):WR(X.kind,ot,D,S,n,ue,Le,ln,l,lt,!0,V,jt,O,Be,Vt,j.getProjection()):kT(X.kind,ot,D,S,n,ue,Le,ln,l,lt,V,jt,O,Be,Vt,j.getProjection(),Zn);const ur={program:n.getOrCreateProgram(NT(it,l,j),{config:et,defines:Ti}),buffers:Z,uniformValues:ei,atlasTexture:ht,atlasTextureIcon:ft,atlasInterpolation:mt,atlasInterpolationIcon:vt,isSDF:it,hasHalo:di,tile:G,labelPlaneMatrixInv:je};if(R&&j.canOverlap){P=!0;const vi=Z.segments.get();for(const hi of vi)N.push({segments:new Bn([hi]),sortKey:hi.sortKey,state:ur})}else N.push({segments:Z.segments,sortKey:0,state:ur})}P&&N.sort((V,G)=>V.sortKey-G.sortKey);for(const V of N){const G=V.state;if(n.terrain&&n.terrain.setupElevationDraw(G.tile,G.program,{useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:G.labelPlaneMatrixInv}),x.activeTexture.set(b.TEXTURE0),G.atlasTexture.bind(G.atlasInterpolation,b.CLAMP_TO_EDGE),G.atlasTextureIcon&&(x.activeTexture.set(b.TEXTURE1),G.atlasTextureIcon&&G.atlasTextureIcon.bind(G.atlasInterpolationIcon,b.CLAMP_TO_EDGE)),n.uploadCommonLightUniforms(n.context,G.program),G.hasHalo){const j=G.uniformValues;j.u_is_halo=1,L1(G.buffers,V.segments,r,n,G.program,I,_,y,j,2),j.u_is_halo=0}else{if(G.isSDF){const j=G.uniformValues;G.hasHalo&&(j.u_is_halo=1,L1(G.buffers,V.segments,r,n,G.program,I,_,y,j,1)),j.u_is_halo=0}L1(G.buffers,V.segments,r,n,G.program,I,_,y,G.uniformValues,1)}}}function L1(n,t,r,a,l,u,d,h,p,m){const _=[n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer,n.iconTransitioningVertexBuffer,n.globeExtVertexBuffer,n.zOffsetVertexBuffer];l.draw(a,a.context.gl.TRIANGLES,u,d,h,Ge.disabled,p,r.id,n.layoutVertexBuffer,n.indexBuffer,t,r.paint,a.transform.zoom,n.programConfigurations.get(r.id),_,m)}function N1(n,t,r,a,l,u,d){const h=n.context.gl,p=r.paint.get("fill-pattern"),m=p&&p.constantOr(1);let _,y,x,b,E;d?(y=m&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_=h.LINES):(y=m?"fillPattern":"fill",_=h.TRIANGLES);for(const C of a){const S=t.getTile(C);if(m&&!S.patternsLoaded())continue;const M=S.getBucket(r);if(!M)continue;n.prepareDrawTile();const D=M.programConfigurations.get(r.id),R=n.isTileAffectedByFog(C),P=n.getOrCreateProgram(y,{config:D,overrideFog:R});m&&(n.context.activeTexture.set(h.TEXTURE0),S.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),D.updatePaintBuffers());const I=p.constantOr(null);if(I&&S.imageAtlas){const L=S.imageAtlas.patternPositions[I.toString()];L&&D.setConstantPatternPositions(L)}const O=n.translatePosMatrix(C.projMatrix,S,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),F=r.paint.get("fill-emissive-strength");if(d){b=M.indexBuffer2,E=M.segments2;const L=n.terrain&&n.terrain.renderingToTexture?n.terrain.drapeBufferSize:[h.drawingBufferWidth,h.drawingBufferHeight];x="fillOutlinePattern"===y&&m?XF(O,F,n,S,L):ZF(O,F,L)}else b=M.indexBuffer,E=M.segments,x=m?RT(O,F,n,S):AT(O,F);n.uploadCommonUniforms(n.context,P,C.toUnwrapped()),P.draw(n,_,l,n.stencilModeForClipping(C),u,Ge.disabled,x,r.id,M.layoutVertexBuffer,b,E,r.paint,n.transform.zoom,D,void 0)}}function ds(n,t,r,a,l,u,d,h){const p=n.context,m=p.gl,_=n.transform,y=r.paint.get("fill-extrusion-pattern"),x=y.constantOr(1),b=r.paint.get("fill-extrusion-opacity"),E=n.style.enable3dLights(),C=r.paint.get(E&&!x?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),S=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),C],M=r.layout.get("fill-extrusion-edge-radius"),D=M>0&&!r.paint.get("fill-extrusion-rounded-roof"),R=D?0:M,P="globe"===_.projection.name?Xb():0,I="globe"===_.projection.name,O=I?Vr(_.zoom):0,F=[no(_.center.lng),mo(_.center.lat)],L=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=r.paint.get("fill-extrusion-flood-light-intensity"),z=r.paint.get("fill-extrusion-vertical-scale"),U=Of(n,r.paint.get("fill-extrusion-cutoff-fade-range")),V=[];let G;I&&V.push("PROJECTION_GLOBE_VIEW"),S[0]>0&&V.push("FAUX_AO"),D&&V.push("ZERO_ROOF_RADIUS"),h&&V.push("HAS_CENTROID"),N>0&&V.push("FLOOD_LIGHT"),U.shouldRenderCutoff&&V.push("RENDER_CUTOFF");const j="shadow"===n.renderPass,Z=n.shadowRenderer,et=j&&!!Z;n.shadowRenderer&&(n.shadowRenderer.useNormalOffset=!0);let it=[0,0,0];if(Z){const Y=n.style.directionalLight,ot=n.style.ambientLight;Y&&ot&&(it=q1(Y,ot)),G=V.concat(["SHADOWS_SINGLE_CASCADE"])}const X=et?"fillExtrusionDepth":x?"fillExtrusionPattern":"fillExtrusion";for(const Y of a){const ot=t.getTile(Y),lt=ot.getBucket(r);if(!lt||lt.projection.name!==_.projection.name)continue;let ht=!1;Z&&(ht=0===Z.getMaxCascadeForTile(Y.toUnwrapped()));const mt=n.isTileAffectedByFog(Y),vt=lt.programConfigurations.get(r.id),ct=n.getOrCreateProgram(X,{config:vt,defines:ht?G:V,overrideFog:mt});if(n.terrain){const Ht=n.terrain;n.style.terrainSetForDrapingOnly(),Ht.setupElevationDraw(ot,ct,{useMeterToDem:!0})}if(!lt.centroidVertexBuffer){const Ht=ct.attributes.a_centroid_pos;void 0!==Ht&&m.vertexAttrib2f(Ht,0,0)}!j&&Z&&Z.setupShadows(ot.tileID.toUnwrapped(),ct,"vector-tile",ot.tileID.overscaledZ),x&&(n.context.activeTexture.set(m.TEXTURE0),ot.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),vt.updatePaintBuffers());const ft=y.constantOr(null);if(ft&&ot.imageAtlas){const Ht=ot.imageAtlas.patternPositions[ft.toString()];Ht&&vt.setConstantPatternPositions(Ht)}const Rt=r.paint.get("fill-extrusion-vertical-gradient");let Vt;if(j&&Z){if(jT(ot.tileID,lt,n))continue;const Ht=Z.calculateShadowPassMatrixFromTile(ot.tileID.toUnwrapped());Vt=DT(Ht,R,z)}else{const Ht=n.translatePosMatrix(Y.projMatrix,ot,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),re=_.projection.createInversionMatrix(_,Y.canonical);Vt=x?IT(Ht,n,Rt,b,S,R,Y,ot,P,O,F,re,L,z):O1(Ht,n,Rt,b,S,R,Y,P,O,F,re,L,z,N,it)}n.uploadCommonUniforms(p,ct,Y.toUnwrapped(),null,U);const jt=[];(n.terrain||h)&&jt.push(lt.centroidVertexBuffer),I&&jt.push(lt.layoutVertexExtBuffer),ct.draw(n,p.gl.TRIANGLES,l,u,d,Ge.backCCW,Vt,r.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,r.paint,n.transform.zoom,vt,jt)}n.shadowRenderer&&(n.shadowRenderer.useNormalOffset=!1)}function Lf(n,t,r,a,l,u,d,h,p,m,_,y,x,b,E,C,S,M,D){const R=n.context,P=R.gl,I=n.transform,O=n.transform.zoom,F=[],L=Of(n,r.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===m?(F.push("CLEAR_SUBPASS"),D&&(F.push("CLEAR_FROM_TEXTURE"),R.activeTexture.set(P.TEXTURE0),D.bind(P.LINEAR,P.CLAMP_TO_EDGE))):"sdf"===m&&F.push("SDF_SUBPASS"),S&&F.push("HAS_CENTROID"),L.shouldRenderCutoff&&F.push("RENDER_CUTOFF");const N=r.layout.get("fill-extrusion-edge-radius"),z=(U,V,G,j,Z)=>{const et=V.programConfigurations.get(r.id),it=n.isTileAffectedByFog(U),X=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:et,defines:F,overrideFog:it}),Y={u_matrix:j,u_opacity:_,u_ao_pass:p?1:0,u_meter_to_tile:Z,u_ao:[y,x*Z],u_flood_light_intensity:b,u_flood_light_color:E,u_attenuation:C,u_edge_radius:O>=17?0:N*Z,u_fb:0,u_fb_size:D?D.size[0]:0},ot=[];S&&ot.push(V.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(R,X,U.toUnwrapped(),null,L),X.draw(n,R.gl.TRIANGLES,l,u,d,h,Y,r.id,V.vertexBuffer,V.indexBuffer,G,r.paint,O,et,ot)};for(const U of a){const V=t.getTile(U),G=V.getBucket(r);if(!G||G.projection.name!==I.projection.name||!G.groundEffect||G.groundEffect&&!G.groundEffect.hasData())continue;const j=G.groundEffect,Z=1/G.tileToMeter;{const et=n.translatePosMatrix(U.projMatrix,V,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),it=j.getDefaultSegment();z(U,j,it,et,Z)}if(M)for(let et=0;et<4;et++){const it=Dx[et](U),X=t.getTile(it);if(!X)continue;const Y=X.getBucket(r);if(!Y||Y.projection.name!==I.projection.name||!Y.groundEffect||Y.groundEffect&&!Y.groundEffect.hasData())continue;const ot=Y.groundEffect;let lt,ht;0===et?(lt=[-dt,0,0],ht=1):1===et?(lt=[dt,0,0],ht=0):2===et?(lt=[0,-dt,0],ht=3):(lt=[0,dt,0],ht=2);const mt=ot.regionSegments[ht];if(!mt)continue;const vt=new Float32Array(16);rt.translate(vt,U.projMatrix,lt),z(U,ot,mt,n.translatePosMatrix(vt,V,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Z)}}}function KR(n,t,r,a,l,u,d){0===a.centroidVertexArray.length&&a.createCentroidsBuffer();const h=u?u.findDEMTileFor(r):null;if(!(h&&h.dem||d))return;const p=M=>{const D=t.getSource().minzoom,R=I=>{const O=t.getTileByID(I);if(O&&O.hasData())return O.getBucket(l)},P=[0,-1,1];for(const I of P){if(M.overscaledZ+I<D)continue;const O=R(M.calculateScaledKey(M.overscaledZ+I));if(O)return O}},m=[0,0,0],_=(M,D)=>(m[0]=Math.min(M.min.y,D.min.y),m[1]=Math.max(M.max.y,D.max.y),m[2]=dt-D.min.x>M.max.x?D.min.x-dt:M.max.x,m),y=(M,D)=>(m[0]=Math.min(M.min.x,D.min.x),m[1]=Math.max(M.max.x,D.max.x),m[2]=dt-D.min.y>M.max.y?D.min.y-dt:M.max.y,m),x=[(M,D)=>_(M,D),(M,D)=>_(D,M),(M,D)=>y(M,D),(M,D)=>y(D,M)],b=(M,D,R,P,I,O,F)=>{if(!u)return 0;const L=[[O?R:M,O?M:R,0],[O?R:D,O?D:R,0]],N=F<0?dt+F:F,z=[O?N:(M+D)/2,O?(M+D)/2:N,0];return 0===R&&F<0||0!==R&&F>0?u.getForTilePoints(I,[z],!0,P):L.push(z),u.getForTilePoints(r,L,!0,h),Math.max(L[0][2],L[1][2],z[2])/u.exaggeration()};for(let M=0;M<4;M++){const D=a.borderFeatureIndices[M];if(0===D.length)continue;const R=Dx[M](r),P=p(R);if(!(P&&P instanceof Sf)||a.borderDoneWithNeighborZ[M]===P.canonical.z)continue;0===P.centroidVertexArray.length&&P.createCentroidsBuffer();const I=u?u.findDEMTileFor(R):null;if(!(I&&I.dem||d))continue;const O=(M<2?1:5)-M,F=P.borderDoneWithNeighborZ[O]!==a.canonical.z,L=P.borderFeatureIndices[O];let N=0;if(a.canonical.z!==P.canonical.z){for(const z of D)a.showCentroid(a.featuresOnBorder[z]);if(F)for(const z of L)P.showCentroid(P.featuresOnBorder[z]);a.borderDoneWithNeighborZ[M]=P.canonical.z,P.borderDoneWithNeighborZ[O]=a.canonical.z}for(const z of D){const U=a.featuresOnBorder[z],V=a.centroidData[U.centroidDataIndex],G=U.borders[M];let j;for(;N<L.length;){j=P.featuresOnBorder[L[N]];const Z=j.borders[O];if(Z[1]>G[0]+3||Z[0]>G[0]-3)break;P.showCentroid(j),N++}if(j&&N<L.length){const Z=N;let et=0;for(;!(j.borders[O][0]>G[1]-3)&&(et++,++N!==L.length);)j=P.featuresOnBorder[L[N]];if(j=P.featuresOnBorder[L[Z]],et>1){const Y=j.borders[O];Math.abs(G[0]-Y[0])<3&&Math.abs(G[1]-Y[1])<3&&(et=1,N=Z+1)}else if(0===et){a.showCentroid(U);continue}const it=P.centroidData[j.centroidDataIndex];d&&1===et&&(((C=V).flags|(S=it).flags)&nl?(C.flags|=nl,S.flags|=nl):(C.flags&=2147483647,S.flags&=2147483647));let X=new nt(0,0);if(et>1)N=Z;else if(I&&I.dem&&!(U.intersectsCount()>1||j.intersectsCount()>1)){const Y=x[M](V,it),ot=M%2?dt-1:0;E=b(Y[0],Math.min(dt-1,Y[1]),ot,I,R,M<2,Y[2]),X=new nt(Math.ceil(7*(E+450)),0)}V.centroidXY=it.centroidXY=X,a.writeCentroidToBuffer(V),P.writeCentroidToBuffer(it)}else a.showCentroid(U)}a.borderDoneWithNeighborZ[M]=P.canonical.z,P.borderDoneWithNeighborZ[O]=a.canonical.z}var E,C,S;(a.needsCentroidUpdate||!a.centroidVertexBuffer&&0!==a.centroidVertexArray.length)&&a.uploadCentroid(n)}const BT=[1,0,0],VT=[0,1,0],z1=[0,0,1];function jT(n,t,r){const a=r.transform,l=r.shadowRenderer;if(!l)return!0;const u=n.toUnwrapped(),d=a.tileSize*l._cascades[r.currentShadowCascade].scale;let h=t.maxHeight;if(a.elevation){const C=a.elevation.getMinMaxForTile(n);C&&(h+=C.max)}const p=[...l.shadowDirection];p[2]=-p[2];const m=l.computeSimplifiedTileShadowVolume(u,h,d,p);if(!m)return!1;const _=[BT,VT,z1,p,[p[0],0,p[2]],[0,p[1],p[2]]],y="globe"===a.projection.name,x=a.scaleZoom(d),b=Vl.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,x,!y),E=l.getCurrentCascadeFrustum();return 0===b.intersectsPrecise(m.vertices,m.planes,_)||0===E.intersectsPrecise(m.vertices,m.planes,_)}const JR=new Ne(1,0,0,1),UT=new Ne(0,1,0,1),HT=new Ne(0,0,1,1),QR=new Ne(1,0,1,1),tP=new Ne(0,1,1,1);function B1(n,t,r){const a=n.context,l=n.transform,u=a.gl,d="globe"===l.projection.name,h=d?["PROJECTION_GLOBE_VIEW"]:[];let p=r.projMatrix;if(d&&Vr(l.zoom)>0){const z=ba(ty(r.canonical,l));p=rt.multiply(new Float32Array(16),l.globeMatrix,z),rt.multiply(p,l.projMatrix,p)}const m=n.getOrCreateProgram("debug",{defines:h}),_=t.getTileByID(r.key);n.terrain&&n.terrain.setupElevationDraw(_,m);const y=ve.disabled,x=Fe.disabled,b=n.colorModeForRenderPass(),E="$debug";a.activeTexture.set(u.TEXTURE0),n.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),d?_._makeGlobeTileDebugBuffers(n.context,l):_._makeDebugTileBoundsBuffers(n.context,l.projection);const C=_._tileDebugBuffer||n.debugBuffer,S=_._tileDebugIndexBuffer||n.debugIndexBuffer,M=_._tileDebugSegments||n.debugSegments;m.draw(n,u.LINE_STRIP,y,x,b,Ge.disabled,PT(p,Ne.red),E,C,S,M,null,null,null,[_._globeTileDebugBorderBuffer]);const D=_.latestRawTileData,R=Math.floor((D&&D.byteLength||0)/1024),P=t.getTile(r).tileSize,I=512/Math.min(P,512)*(r.overscaledZ/l.zoom)*.5;let O=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(O+=` => ${r.overscaledZ}`),O+=` ${R}kb`,function(z,U){z.initDebugOverlayCanvas();const V=z.debugOverlayCanvas,G=z.context.gl,j=z.debugOverlayCanvas.getContext("2d");j.clearRect(0,0,V.width,V.height),j.shadowColor="white",j.shadowBlur=2,j.lineWidth=1.5,j.strokeStyle="white",j.textBaseline="top",j.font="bold 36px Open Sans, sans-serif",j.fillText(U,5,5),j.strokeText(U,5,5),z.debugOverlayTexture.update(V),z.debugOverlayTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE)}(n,O);const F=_._tileDebugTextBuffer||n.debugBuffer,L=_._tileDebugTextIndexBuffer||n.quadTriangleIndexBuffer,N=_._tileDebugTextSegments||n.debugSegments;m.draw(n,u.TRIANGLES,y,x,an.alphaBlended,Ge.disabled,PT(p,Ne.transparent,I),E,F,L,N,null,null,null,[_._globeTileDebugTextBuffer])}function xv(n,t,r,a){Nf(n,0,t+r/2,n.transform.width,r,a)}function V1(n,t,r,a){Nf(n,t-r/2,0,r,n.transform.height,a)}function Nf(n,t,r,a,l,u){const d=n.context,h=d.gl;h.enable(h.SCISSOR_TEST),h.scissor(t*kt.devicePixelRatio,r*kt.devicePixelRatio,a*kt.devicePixelRatio,l*kt.devicePixelRatio),d.clear({color:u}),h.disable(h.SCISSOR_TEST)}const j1=yn([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:eP}=j1;function Lu(n,t,r,a){n.emplaceBack(t,r,a)}class $T{constructor(t){this.vertexArray=new Ga,this.indices=new er,Lu(this.vertexArray,-1,-1,1),Lu(this.vertexArray,1,-1,1),Lu(this.vertexArray,-1,1,1),Lu(this.vertexArray,1,1,1),Lu(this.vertexArray,-1,-1,-1),Lu(this.vertexArray,1,-1,-1),Lu(this.vertexArray,-1,1,-1),Lu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,eP),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=Bn.simpleSegment(0,0,36,12)}}function zf(n,t,r,a,l,u){const d=n.context.gl,h=t.paint.get("sky-atmosphere-color"),p=t.paint.get("sky-atmosphere-halo-color"),m=t.paint.get("sky-atmosphere-sun-intensity"),_={u_matrix_3f:Yo.fromMat4(Yo.create(),a),u_sun_direction:l,u_sun_intensity:m,u_color_tint_r:[(E=h).r,E.g,E.b,E.a],u_color_tint_m:[(C=p).r,C.g,C.b,C.a],u_luminance:5e-5};var E,C;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+u,t.skyboxTexture,0),r.draw(n,d.TRIANGLES,ve.disabled,Fe.disabled,an.unblended,Ge.frontCW,_,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const GT=yn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class U1{constructor(t){const r=new ma;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const a=new er;a.emplaceBack(0,1,2),a.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,GT.members),this.indexBuffer=t.createIndexBuffer(a),this.segments=Bn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const br=yn([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ta{constructor(){this.colorModeAlphaBlendedWriteRGB=new an([1,771,1,771],Ne.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new an([1,0,1,0],Ne.transparent,[!1,!1,!1,!0])}update(t){const r=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new U1(r);const a=100,l=200,u=function(_){const y=TE(30),x=[];for(let b=0;b<16e3;++b){const E=2*Math.PI*y(),C=Math.acos(1-2*y())-.5*Math.PI;x.push(q.fromValues(Math.cos(C)*Math.cos(E),Math.cos(C)*Math.sin(E),Math.sin(C)))}return x}(),d=TE(300),h=new ud,p=new er;let m=0;for(let _=0;_<u.length;++_){const y=q.scale([],u[_],200),x=Math.max(0,1+.01*a*(1*d()-.5)),b=Math.max(0,1+.01*l*(1*d()-.5));h.emplaceBack(y[0],y[1],y[2],-1,-1,x,b),h.emplaceBack(y[0],y[1],y[2],1,-1,x,b),h.emplaceBack(y[0],y[1],y[2],1,1,x,b),h.emplaceBack(y[0],y[1],y[2],-1,1,x,b),p.emplaceBack(m+0,m+1,m+2),p.emplaceBack(m+0,m+2,m+3),m+=4}this.starsVx=r.createVertexBuffer(h,br.members),this.starsIdx=r.createIndexBuffer(p),this.starsSegments=Bn.simpleSegment(0,0,h.length,p.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const a=t.context,l=a.gl,u=t.transform,d=new ve(l.LEQUAL,ve.ReadOnly,[0,1]),h=Vr(u.zoom),p=r.properties.get("color").toArray01(),m=r.properties.get("high-color").toArray01(),_=r.properties.get("space-color").toArray01PremultipliedAlpha(),y=5e-4,x=Jt((r.properties.get("horizon-blend")-0)/1*.2495+y,5e-4,.25),b=WC(t,a,u)&&x===y?u.worldSize/(2*Math.PI*1.025)-1:u.globeRadius,E=t.frameCounter/1e3%1,C=q.length(u.globeCenterInViewSpace),S=Math.sqrt(Math.pow(C,2)-Math.pow(b,2)),M=Math.acos(S/C),D=R=>{const P="globe"===u.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];R&&P.push("ALPHA_PASS");const I=t.getOrCreateProgram("globeAtmosphere",{defines:P}),O={u_frustum_tl:u.frustumCorners.TL,u_frustum_tr:u.frustumCorners.TR,u_frustum_br:u.frustumCorners.BR,u_frustum_bl:u.frustumCorners.BL,u_horizon:u.frustumCorners.horizon,u_transition:h,u_fadeout_range:x,u_color:p,u_high_color:m,u_space_color:_,u_temporal_offset:E,u_horizon_angle:M};t.uploadCommonUniforms(a,I);const F=this.atmosphereBuffer;F&&I.draw(t,l.TRIANGLES,d,Fe.disabled,R?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ge.backCW,O,R?"atmosphere_glow_alpha":"atmosphere_glow",F.vertexBuffer,F.indexBuffer,F.segments)};D(!1),D(!0)}drawStars(t,r){const a=Jt(r.properties.get("star-intensity"),0,1);if(0===a)return;const l=t.context,u=l.gl,d=t.transform,h=t.getOrCreateProgram("stars"),p=to.identity([]);to.rotateX(p,p,-d._pitch),to.rotateZ(p,p,-d.angle),to.rotateX(p,p,Ie(d._center.lat)),to.rotateY(p,p,-Ie(d._center.lng));const m=rt.fromQuat(new Float32Array(16),p),_=rt.multiply([],d.starsProjMatrix,m),y=Yo.fromMat4([],m),x=Yo.invert([],y),b=[0,1,0];q.transformMat3(b,b,x),q.scale(b,b,.15);const E=[1,0,0];q.transformMat3(E,E,x),q.scale(E,E,.15);const C=(M=b,D=E,R=a,{u_matrix:Float32Array.from(_),u_up:M,u_right:D,u_intensity_multiplier:R});var M,D,R;t.uploadCommonUniforms(l,h),this.starsVx&&this.starsIdx&&h.draw(t,u.TRIANGLES,ve.disabled,Fe.disabled,this.colorModeAlphaBlendedWriteRGB,Ge.disabled,C,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Qs(n,t){const r=[...n],a=t.cameraWorldSizeForFog/t.worldSize,l=rt.identity([]);return rt.scale(l,l,[a,a,1]),rt.multiply(r,l,r),rt.multiply(r,t.worldToFogMatrix,r),r}function rr(n,t,r,a){const l=r.material,u=a.context,{baseColorTexture:d,metallicRoughnessTexture:h}=l.pbrMetallicRoughness,{normalTexture:p,occlusionTexture:m,emissionTexture:_}=l;function y(x,b,E){if(x&&(n.push(b),u.activeTexture.set(u.gl.TEXTURE0+E),x.gfxTexture)){const{minFilter:C,magFilter:S,wrapS:M,wrapT:D}=x.sampler;x.gfxTexture.bindExtraParam(C,S,M,D)}}y(d,"HAS_TEXTURE_u_baseColorTexture",Ps.BaseColor),y(h,"HAS_TEXTURE_u_metallicRoughnessTexture",Ps.MetallicRoughness),y(p,"HAS_TEXTURE_u_normalTexture",Ps.Normal),y(m,"HAS_TEXTURE_u_occlusionTexture",Ps.Occlusion),y(_,"HAS_TEXTURE_u_emissionTexture",Ps.Emission),r.texcoordBuffer&&(n.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(n.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(n.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(n.push("HAS_ATTRIBUTE_a_pbr"),n.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),"OPAQUE"!==l.alphaMode&&"MASK"!==l.alphaMode||n.push("UNPREMULT_TEXTURE_IN_SHADER"),l.defined||n.push("DIFFUSE_SHADED"),n.push("USE_STANDARD_DERIVATIVES")}function bv(n,t,r,a,l,u){const d=r.paint.get("model-opacity"),h=t.context,p=new ve(t.context.gl.LEQUAL,ve.ReadWrite,t.depthRangeFor3D),m=t.transform,_=n.mesh,y=_.material,x=y.pbrMetallicRoughness,b=t.style.fog;let E;E="pixels"===t.transform.projection.zAxisUnit?[...n.nodeModelMatrix]:rt.multiply([],a.zScaleMatrix,n.nodeModelMatrix),rt.multiply(E,a.negCameraPosMatrix,E);const C=rt.invert([],E);rt.transpose(C,C);const S=k1(new Float32Array(n.worldViewProjection),new Float32Array(E),new Float32Array(C),t,d,x.baseColorFactor,y.emissiveFactor,x.metallicFactor,x.roughnessFactor,y,r),M={defines:[]},D=[];rr(M.defines,D,_,t);const R=t.shadowRenderer;R&&(R.useNormalOffset=!1);let P=null;if(b){const F=Qs(n.nodeModelMatrix,t.transform);if(P=new Float32Array(F),"globe"!==m.projection.name){const L=_.aabb.min,N=_.aabb.max,[z,U]=b.getOpacityForBounds(F,L[0],L[1],N[0],N[1]);M.overrideFog=z>=Ru||U>=Ru}}const I=Of(t,r.paint.get("model-cutoff-fade-range"));I.shouldRenderCutoff&&M.defines.push("RENDER_CUTOFF");const O=t.getOrCreateProgram("model",M);t.uploadCommonUniforms(h,O,null,P,I),"shadow"!==t.renderPass&&R&&R.setupShadowsFromMatrix(n.nodeModelMatrix,O),O.draw(t,h.gl.TRIANGLES,p,l,u,_.material.doubleSided?Ge.disabled:Ge.backCCW,S,r.id,_.vertexBuffer,_.indexBuffer,_.segments,r.paint,t.transform.zoom,void 0,D)}function H1(n,t,r,a,l,u,d){let h;h="globe"===n.projection.name?Yy(r,n):[...r],rt.multiply(h,h,t.matrix);const p=rt.multiply([],a,h);if(t.meshes)for(const m of t.meshes){if("BLEND"!==m.material.alphaMode){d.push({mesh:m,depth:0,modelIndex:l,worldViewProjection:p,nodeModelMatrix:h});continue}const _=q.transformMat4([],m.centroid,p);_[2]>0&&u.push({mesh:m,depth:_[2],modelIndex:l,worldViewProjection:p,nodeModelMatrix:h})}if(t.children)for(const m of t.children)H1(n,m,r,a,l,u,d)}function wv(n,t,r,a){const l=r.shadowRenderer;if(!l)return;const u=l.getShadowPassDepthMode(),d=l.getShadowPassColorMode(),h=l.calculateShadowPassMatrixFromMatrix(t),p=hg(h);r.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,u,Fe.disabled,d,Ge.backCCW,p,a.id,n.vertexBuffer,n.indexBuffer,n.segments,a.paint,r.transform.zoom,void 0,void 0)}function nP(n,t,r){const a=t.updateZoomBasedPaintProperties(),l=function(u,d,h){let p,m,_,y=u.terrain?u.terrain.exaggeration():0;if(u.terrain&&y>0){const x=u.terrain,b=x.findDEMTileFor(h);b&&b.dem?p=Ka.create(x,h,b):y=0}if(0===y&&(d.terrainElevationMin=0,d.terrainElevationMax=0),y===d.validForExaggeration&&(0===y||p&&p._demTile&&p._demTile.tileID===d.validForDEMTile.id&&p._dem._timestamp===d.validForDEMTile.timestamp))return!1;for(const x in d.instancesPerModel){const b=d.instancesPerModel[x];for(let E=0;E<b.instancedDataArray.length;++E){const C=(p?y*p.getElevationAt(0|b.instancedDataArray.float32[16*E],0|b.instancedDataArray.float32[16*E+1],!0,!0):0)+b.instancesEvaluatedElevation[E];b.instancedDataArray.float32[16*E+6]=C,m=m?Math.min(d.terrainElevationMin,C):C,_=_?Math.max(d.terrainElevationMax,C):C}}return d.terrainElevationMin=m||0,d.terrainElevationMax=_||0,d.validForExaggeration=y,d.validForDEMTile=p&&p._demTile?{id:p._demTile.tileID,timestamp:p._dem._timestamp}:{id:void 0,timestamp:0},!0}(n,t,r);(a||l)&&(t.uploaded=!1,t.upload(n.context))}const ll={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new ui([0,0,0],[dt,dt,0])};function qT(n,t){const r=1<<n.canonical.z,a=t.getFreeCameraOptions().position,l=t.elevation,u=n.canonical.x/r,d=(n.canonical.x+1)/r,h=n.canonical.y/r,p=(n.canonical.y+1)/r;let m=t._centerAltitude;if(l){const b=l.getMinMaxForTile(n);b&&b.max>m&&(m=b.max)}const _=Jt(a.x,u,d)-a.x,y=Jt(a.y,h,p)-a.y,x=Nn(m,t.center.lat)-a.z;return t._zoomFromMercatorZ(Math.sqrt(_*_+y*y+x*x))}function Jo(n,t,r,a,l,u,d){const h=n.context,p="shadow"===n.renderPass,m=n.shadowRenderer,_=p&&m?m.getShadowPassDepthMode():new ve(h.gl.LEQUAL,ve.ReadWrite,n.depthRangeFor3D),y=n.isTileAffectedByFog(u);if(r.meshes)for(const x of r.meshes){const b=["MODEL_POSITION_ON_GPU"],E=[];let C,S,M;a.instancedDataArray.length>20&&b.push("INSTANCED_ARRAYS");const D=Of(n,t.paint.get("model-cutoff-fade-range"));if(D.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),p&&m)C=n.getOrCreateProgram("modelDepth",{defines:b}),S=hg(d.shadowTileMatrix,d.shadowTileMatrix,Float32Array.from(r.matrix)),M=m.getShadowPassColorMode();else{rr(b,E,x,n),C=n.getOrCreateProgram("model",{defines:b,overrideFog:y});const P=x.material,I=P.pbrMetallicRoughness,O=t.paint.get("model-opacity");S=k1(u.projMatrix,Float32Array.from(r.matrix),new Float32Array(16),n,O,I.baseColorFactor,P.emissiveFactor,I.metallicFactor,I.roughnessFactor,P,t,l),m&&(d.shadowUniformsInitialized?C.setShadowUniformValues(h,m.getShadowUniformValues()):(m.setupShadows(u.toUnwrapped(),C,"model-tile",u.overscaledZ),d.shadowUniformsInitialized=!0)),M=D.shouldRenderCutoff||O<1||"OPAQUE"!==P.alphaMode?an.alphaBlended:an.unblended}n.uploadCommonUniforms(h,C,u.toUnwrapped(),null,D);const R=x.material.doubleSided?Ge.disabled:Ge.backCCW;if(a.instancedDataArray.length>20)E.push(a.instancedDataBuffer),C.draw(n,h.gl.TRIANGLES,_,Fe.disabled,M,R,S,t.id,x.vertexBuffer,x.indexBuffer,x.segments,t.paint,n.transform.zoom,void 0,E,a.instancedDataArray.length);else{const P=p?"u_instance":"u_normal_matrix";for(let I=0;I<a.instancedDataArray.length;++I)S[P]=new Float32Array(a.instancedDataArray.arrayBuffer,64*I,16),C.draw(n,h.gl.TRIANGLES,_,Fe.disabled,M,R,S,t.id,x.vertexBuffer,x.indexBuffer,x.segments,t.paint,n.transform.zoom,void 0,E)}}if(r.children)for(const x of r.children)Jo(n,t,x,a,l,u,d)}const Bf=[1,-1,1];function iP(n,t,r,a){if(!r.modelManager)return!0;const l=r.modelManager;if(!r.shadowRenderer)return!0;const u=r.shadowRenderer,d=t.aabb;let h=!0,p=n.maxHeight;if(0===p){let _=0;for(const y in n.instancesPerModel){const x=l.getModel(y,a);x?_=Math.max(_,Math.max(Math.max(x.aabb.max[0],x.aabb.max[1]),x.aabb.max[2])):h=!1}p=n.maxScale*_*1.41+n.maxVerticalOffset,h&&(n.maxHeight=p)}d.max[2]=p,d.min[2]+=n.terrainElevationMin,d.max[2]+=n.terrainElevationMax,q.transformMat4(d.min,d.min,t.tileMatrix),q.transformMat4(d.max,d.max,t.tileMatrix);const m=d.intersects(u.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(n.isInsideFirstShadowMapFrustum=2===m),0===m}class rP{}class KF{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,a){{const y=this._storage.get(r.id);if(y)return y.lastUsedFrameIdx=t,y.buf}const l=a.gl,u=l.getBufferParameter(l.ELEMENT_ARRAY_BUFFER,l.BUFFER_SIZE),d=new ArrayBuffer(u),h=new Int16Array(d);l.getBufferSubData(l.ELEMENT_ARRAY_BUFFER,0,new Int16Array(d));const p=new $a;for(let y=0;y<u/2;y+=3){const x=h[y],b=h[y+1],E=h[y+2];p.emplaceBack(x,b),p.emplaceBack(b,E),p.emplaceBack(E,x)}const m=a.bindVertexArrayOES.current,_=new rP;return _.buf=new Fo(a,p),_.lastUsedFrameIdx=t,this._storage.set(r.id,_),a.bindVertexArrayOES.set(m),_.buf}update(t){for(const[r,a]of this._storage)t-a.lastUsedFrameIdx>30&&(a.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}const oP={symbol:function(n,t,r,a,l){if("translucent"!==n.renderPass)return;const u=Fe.disabled,d=n.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(h,p,m,_,y,x,b){const E=p.transform,C="map"===y,S="map"===x;for(const M of h){const D=_.getTile(M),R=D.getBucket(m);if(!R||!R.text||!R.text.segments.get().length)continue;const P=Ic(R.textSizeData,E.zoom),I=lv(M,R.getProjection(),E),O=E.calculatePixelsToTileUnitsMatrix(D),F=Iu(I,D.tileID.canonical,S,C,E,R.getProjection(),O),L=R.hasIconTextFit()&&R.hasIconData();if(P){const N=Math.pow(2,E.zoom-D.tileID.overscaledZ);YR(R,C,S,b,NF,E,F,M,N,P,L)}}}(a,n,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),l),0!==r.paint.get("icon-opacity").constantOr(1)&&zT(n,t,r,a,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),u,d),0!==r.paint.get("text-opacity").constantOr(1)&&zT(n,t,r,a,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),u,d),t.map.showCollisionBoxes&&(F1(n,t,r,a,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),F1(n,t,r,a,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(n,t,r,a){if("translucent"!==n.renderPass)return;const l=r.paint.get("circle-opacity"),u=r.paint.get("circle-stroke-width"),d=r.paint.get("circle-stroke-opacity"),h=void 0!==r.layout.get("circle-sort-key").constantOr(1),p=r.paint.get("circle-emissive-strength");if(0===l.constantOr(1)&&(0===u.constantOr(1)||0===d.constantOr(1)))return;const m=n.context,_=m.gl,y=n.transform,x=n.depthModeForSublayer(0,ve.ReadOnly),b=Fe.disabled,E=n.colorModeForDrapableLayerRenderPass(p),C="globe"===y.projection.name,S=[no(y.center.lng),mo(y.center.lat)],M=[];for(let R=0;R<a.length;R++){const P=a[R],I=t.getTile(P),O=I.getBucket(r);if(!O||O.projection.name!==y.projection.name)continue;const F=O.programConfigurations.get(r.id),L=sm(r),N=n.isTileAffectedByFog(P);C&&L.push("PROJECTION_GLOBE_VIEW");const z=n.getOrCreateProgram("circle",{config:F,defines:L,overrideFog:N}),U=O.layoutVertexBuffer,V=O.globeExtVertexBuffer,G=O.indexBuffer,j=y.projection.createInversionMatrix(y,P.canonical),Z={programConfiguration:F,program:z,layoutVertexBuffer:U,globeExtVertexBuffer:V,indexBuffer:G,uniformValues:Gx(n,P,I,j,S,r),tile:I};if(h){const et=O.segments.get();for(const it of et)M.push({segments:new Bn([it]),sortKey:it.sortKey,state:Z})}else M.push({segments:O.segments,sortKey:0,state:Z})}h&&M.sort((R,P)=>R.sortKey-P.sortKey);const D={useDepthForOcclusion:y.depthOcclusionForSymbolsAndCircles};for(const R of M){const{programConfiguration:P,program:I,layoutVertexBuffer:O,globeExtVertexBuffer:F,indexBuffer:L,uniformValues:N,tile:z}=R.state,U=R.segments;n.terrain&&n.terrain.setupElevationDraw(z,I,D),n.uploadCommonUniforms(m,I,z.tileID.toUnwrapped()),I.draw(n,_.TRIANGLES,x,b,E,Ge.disabled,N,r.id,O,L,U,r.paint,y.zoom,P,[F])}},heatmap:function(n,t,r,a){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===n.renderPass){const l=n.context,u=l.gl,d=Fe.disabled,h=new an([u.ONE,u.ONE,u.ONE,u.ONE],Ne.transparent,[!0,!0,!0,!0]);(function(b,E,C,S){const M=b.gl,D=E.width*S,R=E.height*S;b.activeTexture.set(M.TEXTURE1),b.viewport.set([0,0,D,R]);let P=C.heatmapFbo;if(!P||P&&(P.width!==D||P.height!==R)){P&&P.destroy();const I=M.createTexture();M.bindTexture(M.TEXTURE_2D,I),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.LINEAR),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.LINEAR),P=C.heatmapFbo=b.createFramebuffer(D,R,!0,null),function(O,F,L,N,z,U){const V=O.gl;V.texImage2D(V.TEXTURE_2D,0,O.extRenderToTextureHalfFloat?V.RGBA16F:V.RGBA,z,U,0,V.RGBA,O.extRenderToTextureHalfFloat?V.HALF_FLOAT:V.UNSIGNED_BYTE,null),N.colorAttachment.set(L)}(b,0,I,P,D,R)}else M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),b.bindFramebuffer.set(P.framebuffer)})(l,n,r,"globe"===n.transform.projection.name?.5:.25),l.clear({color:Ne.transparent});const p=n.transform,m="globe"===p.projection.name,_=m?["PROJECTION_GLOBE_VIEW"]:[],y=m?Ge.frontCCW:Ge.disabled,x=[no(p.center.lng),mo(p.center.lat)];for(let b=0;b<a.length;b++){const E=a[b];if(t.hasRenderableParent(E))continue;const C=t.getTile(E),S=C.getBucket(r);if(!S||S.projection.name!==p.projection.name)continue;const M=n.isTileAffectedByFog(E),D=S.programConfigurations.get(r.id),R=n.getOrCreateProgram("heatmap",{config:D,defines:_,overrideFog:M}),{zoom:P}=n.transform;n.terrain&&n.terrain.setupElevationDraw(C,R),n.uploadCommonUniforms(l,R,E.toUnwrapped());const I=p.projection.createInversionMatrix(p,E.canonical);R.draw(n,u.TRIANGLES,ve.disabled,d,h,y,GR(n,E,C,I,x,P,r.paint.get("heatmap-intensity")),r.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,r.paint,n.transform.zoom,D,m?[S.globeExtVertexBuffer]:null)}l.viewport.set([0,0,n.width,n.height])}else"translucent"===n.renderPass&&(n.context.setColorMode(n.colorModeForRenderPass()),function(l,u){const d=l.context,h=d.gl,p=u.heatmapFbo;if(!p)return;d.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,p.colorAttachment.get()),d.activeTexture.set(h.TEXTURE1);let m=u.colorRampTexture;m||(m=u.colorRampTexture=new ir(d,u.colorRamp,h.RGBA)),m.bind(h.LINEAR,h.CLAMP_TO_EDGE),l.getOrCreateProgram("heatmapTexture").draw(l,h.TRIANGLES,ve.disabled,Fe.disabled,l.colorModeForRenderPass(),Ge.disabled,{u_image:0,u_color_ramp:1,u_opacity:u.paint.get("heatmap-opacity")},u.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments,u.paint,l.transform.zoom)}(n,r))},line:function(n,t,r,a){if("translucent"!==n.renderPass)return;const l=r.paint.get("line-opacity"),u=r.paint.get("line-width");if(0===l.constantOr(1)||0===u.constantOr(1))return;const d=r.paint.get("line-emissive-strength"),h=n.depthModeForSublayer(0,ve.ReadOnly),p=n.colorModeForDrapableLayerRenderPass(d),m=n.terrain&&n.terrain.renderingToTexture?1:kt.devicePixelRatio,_=r.paint.get("line-dasharray"),y=_.constantOr(1),x=r.layout.get("line-cap"),b=r.paint.get("line-pattern"),E=b.constantOr(1),C=r.paint.get("line-pattern").constantOr(1),S=1!==r.paint.get("line-opacity").constantOr(1);let M=!C&&S;const D=r.paint.get("line-gradient"),R=E?"linePattern":"line",P=n.context,I=P.gl,O=Jb(r);n.terrain&&n.terrain.clipOrMaskOverlapStencilType()&&(M=!1);for(const F of a){const L=t.getTile(F);if(E&&!L.patternsLoaded())continue;const N=L.getBucket(r);if(!N)continue;n.prepareDrawTile();const z=N.programConfigurations.get(r.id),U=n.isTileAffectedByFog(F),V=n.getOrCreateProgram(R,{config:z,defines:O,overrideFog:U}),G=b.constantOr(null);if(G&&L.imageAtlas){const lt=L.imageAtlas.patternPositions[G.toString()];lt&&z.setConstantPatternPositions(lt)}const j=_.constantOr(null),Z=x.constantOr(null);if(!E&&j&&Z&&L.lineAtlas){const lt=L.lineAtlas.getDash(j,Z);lt&&z.setConstantPatternPositions(lt)}let[et,it]=r.paint.get("line-trim-offset");("round"===Z||"square"===Z)&&et!==it&&(0===et&&(et-=1),1===it&&(it+=1));const X=n.terrain?F.projMatrix:null,Y=E?Zm(n,L,r,X,m):Z2(n,L,r,X,N.lineClipsArray.length,m,[et,it]);if(D){const lt=N.gradients[r.id];let ht=lt.texture;if(r.gradientVersion!==lt.version){let mt=256;if(r.stepInterpolant){const vt=t.getSource().maxzoom,ct=F.canonical.z===vt?Math.ceil(1<<n.transform.maxZoom-F.canonical.z):1;mt=Jt(dn(N.maxLineLength/dt*1024*ct),256,P.maxTextureSize)}lt.gradient=Ya({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:mt,image:lt.gradient||void 0,clips:N.lineClipsArray}),lt.texture?lt.texture.update(lt.gradient):lt.texture=new ir(P,lt.gradient,I.RGBA),lt.version=r.gradientVersion,ht=lt.texture}P.activeTexture.set(I.TEXTURE1),ht.bind(r.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE)}y&&(P.activeTexture.set(I.TEXTURE0),L.lineAtlasTexture.bind(I.LINEAR,I.REPEAT),z.updatePaintBuffers()),E&&(P.activeTexture.set(I.TEXTURE0),L.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),z.updatePaintBuffers()),n.uploadCommonUniforms(P,V,F.toUnwrapped());const ot=lt=>{V.draw(n,I.TRIANGLES,h,lt,p,Ge.disabled,Y,r.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,r.paint,n.transform.zoom,z,[N.layoutVertexBuffer2])};if(M){const lt=n.stencilModeForClipping(F).ref;0===lt&&n.terrain&&P.clear({stencil:0});const ht={func:I.EQUAL,mask:255};Y.u_alpha_discard_threshold=.8,ot(new Fe(ht,lt,255,I.KEEP,I.KEEP,I.INVERT)),Y.u_alpha_discard_threshold=0,ot(new Fe(ht,lt,255,I.KEEP,I.KEEP,I.KEEP))}else ot(n.stencilModeForClipping(F))}M&&(n.resetStencilClippingMasks(),n.terrain&&P.clear({stencil:0}))},fill:function(n,t,r,a){const l=r.paint.get("fill-color"),u=r.paint.get("fill-opacity");if(0===u.constantOr(1))return;const d=r.paint.get("fill-emissive-strength"),h=n.colorModeForDrapableLayerRenderPass(d),p=r.paint.get("fill-pattern"),m=n.opaquePassEnabledForLayer()&&!p.constantOr(1)&&1===l.constantOr(Ne.transparent).a&&1===u.constantOr(0)?"opaque":"translucent";if(n.renderPass===m){const _=n.depthModeForSublayer(1,"opaque"===n.renderPass?ve.ReadWrite:ve.ReadOnly);N1(n,t,r,a,_,h,!1)}if("translucent"===n.renderPass&&r.paint.get("fill-antialias")){const _=n.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,ve.ReadOnly);N1(n,t,r,a,_,h,!0)}},"fill-extrusion":function(n,t,r,a){const l=r.paint.get("fill-extrusion-opacity"),u=n.context,d=u.gl,h=n.terrain,p=h&&h.renderingToTexture,m=r.paint.get("fill-extrusion-cutoff-fade-range");if(0===l)return;const _=n.conflationActive&&n.layerUsedInConflation(r,t.getSource());if(_&&function(y,x,b,E){for(const C of E){const S=x.getTile(C).getBucket(b);S&&(S.updateReplacement(C,y.replacementSource),S.uploadCentroid(y.context))}}(n,t,r,a),h||_)for(const y of a){const x=t.getTile(y).getBucket(r);x&&KR(n.context,t,y,x,r,h,_)}if("shadow"===n.renderPass&&n.shadowRenderer){const y=n.shadowRenderer;if(h&&l<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof gc)return;const x=y.getShadowPassDepthMode(),b=y.getShadowPassColorMode();ds(n,t,r,a,x,Fe.disabled,b,_)}else if("translucent"===n.renderPass){const y=!r.paint.get("fill-extrusion-pattern").constantOr(1);if(!p){const x=new ve(n.context.gl.LEQUAL,ve.ReadWrite,n.depthRangeFor3D);0===m&&1===l&&y?ds(n,t,r,a,x,Fe.disabled,an.unblended,_):(ds(n,t,r,a,x,Fe.disabled,an.disabled,_),ds(n,t,r,a,x,n.stencilModeFor3D(),n.colorModeForRenderPass(),_),n.resetStencilClippingMasks())}if(n.style.enable3dLights()&&y&&(!h&&"globe"!==n.transform.projection.name||p)){const x=r.paint.get("fill-extrusion-opacity"),b=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),E=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),C=r.paint.get("fill-extrusion-flood-light-intensity"),S=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),M=b>0&&E>0,D=C>0,R=(I,O,F)=>(1-F)*I+F*O,P=I=>{const O=n.depthModeForSublayer(1,ve.ReadOnly,d.LEQUAL,!0),F=r.paint.get(I?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),L=R(.1,3,F),N=n._showOverdrawInspector;if(!N){const z=new Fe({func:d.ALWAYS,mask:255},255,255,d.KEEP,d.KEEP,d.REPLACE),U=new an([d.ONE,d.ONE,d.ONE,d.ONE],Ne.transparent,[!1,!1,!1,!0],d.MIN);Lf(n,t,r,a,O,z,U,Ge.disabled,I,"sdf",x,b,E,C,S,L,_,!1)}{const z=N?Fe.disabled:new Fe({func:d.EQUAL,mask:255},255,255,d.KEEP,d.DECR,d.DECR),U=N?n.colorModeForRenderPass():new an([d.ONE_MINUS_DST_ALPHA,d.DST_ALPHA,d.ONE,d.ONE],Ne.transparent,[!0,!0,!0,!0]);Lf(n,t,r,a,O,z,U,Ge.disabled,I,"color",x,b,E,C,S,L,_,!1)}};if(p){const I=(O,F,L)=>{const N=n.depthModeForSublayer(1,ve.ReadOnly,d.LEQUAL,!1),z=r.paint.get(O?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),U=R(.1,3,z);{const V=new an([d.ONE,d.ONE,d.ONE,d.ONE],Ne.transparent,[!1,!1,!1,!0]);Lf(n,t,r,a,N,Fe.disabled,V,Ge.disabled,O,"clear",x,b,E,C,S,U,_,F)}{const V=new Fe({func:d.ALWAYS,mask:255},255,255,d.KEEP,d.KEEP,d.REPLACE),G=new an([d.ONE,d.ONE,d.ONE,d.ONE],Ne.transparent,[!1,!1,!1,!0],d.MIN);Lf(n,t,r,a,N,V,G,Ge.disabled,O,"sdf",x,b,E,C,S,U,_,F)}{const V=O?d.ZERO:d.ONE_MINUS_DST_ALPHA,G=new Fe({func:d.EQUAL,mask:255},255,255,d.KEEP,d.DECR,d.DECR),j=new an([V,d.DST_ALPHA,d.ONE_MINUS_DST_ALPHA,d.ZERO],Ne.transparent,[!0,!0,!0,!0]);Lf(n,t,r,a,N,G,j,Ge.disabled,O,"color",x,b,E,C,S,U,_,F)}{const V=new an([d.ONE,d.ONE,d.ONE,O?d.ZERO:d.ONE],Ne.transparent,[!1,!1,!1,!0],O?d.FUNC_ADD:d.MAX);Lf(n,t,r,a,N,Fe.disabled,V,Ge.disabled,O,"clear",x,b,E,C,S,U,_,F,L)}};if(M||D){let O;if(n.prepareDrawTile(),h){const F=h.drapeBufferSize[0],L=h.drapeBufferSize[1];O=h.framebufferCopyTexture,O&&(!O||O.size[0]===F&&O.size[1]===L)||(O&&O.destroy(),O=h.framebufferCopyTexture=new ir(u,new Pi({width:F,height:L}),d.RGBA)),O.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,0,0,F,L,0)}M&&I(!0,!1,O),D&&I(!1,!0,O)}}else M&&P(!0),D&&P(!1)}}},hillshade:function(n,t,r,a){if("offscreen"!==n.renderPass&&"translucent"!==n.renderPass)return;const l=n.context,u=n.terrain&&n.terrain.renderingToTexture,[d,h]="translucent"!==n.renderPass||u?[{},a]:n.stencilConfigForOverlap(a);for(const p of h){const m=t.getTile(p);if(m.needsHillshadePrepare&&"offscreen"===n.renderPass)kR(n,m,r);else if("translucent"===n.renderPass){const _=n.depthModeForSublayer(0,ve.ReadOnly),y=r.paint.get("hillshade-emissive-strength"),x=n.colorModeForDrapableLayerRenderPass(y),b=u&&n.terrain?n.terrain.stencilModeForRTTOverlap(p):d[p.overscaledZ];OR(n,p,m,r,_,b,x)}}l.viewport.set([0,0,n.width,n.height]),n.resetStencilClippingMasks()},raster:function(n,t,r,a,l,u){if("translucent"!==n.renderPass||0===r.paint.get("raster-opacity"))return;const d=n.context,h=d.gl,p=t.getSource(),m=function(R,P,I){const O=[];let F,L;if(R.paint.get("raster-color")){O.push("RASTER_COLOR"),F=R.paint.get("raster-color-mix"),L=R.paint.get("raster-color-range"),P.activeTexture.set(I.TEXTURE2);let N=R.colorRampTexture;N||(N=R.colorRampTexture=new ir(P,R.colorRamp,I.RGBA)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE)}return{mix:F,range:L,defines:O}}(r,d,h),_=m.defines;let y=!1;if(p instanceof ql&&!a.length){if("globe"!==n.transform.projection.name)return;if(p.onNorthPole)y=!0,_.push("PROJECTION_GLOBE_VIEW");else{if(!p.onSouthPole)return;y=!0,_.push("PROJECTION_GLOBE_VIEW")}}const x=n.colorModeForDrapableLayerRenderPass(),b=n.terrain&&n.terrain.renderingToTexture,E=!n.options.moving,C="nearest"===r.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(y){const R=t.getSource();if(!(R instanceof ql))return;const P=R.texture;if(!P)return;const I=n.globeSharedBuffers;if(!I)return;const O=new ve(h.LEQUAL,ve.ReadWrite,n.depthRangeFor3D),F=Float32Array.from(n.transform.projMatrix);let L=qC(0,0,n.transform);const N=Float32Array.from(eo(ko(new ya(0,0,0)))),z={opacity:1,mix:0};n.terrain&&n.terrain.prepareDrawTile(),d.activeTexture.set(h.TEXTURE0),P.bind(C,h.CLAMP_TO_EDGE),d.activeTexture.set(h.TEXTURE1),P.bind(C,h.CLAMP_TO_EDGE),P.useMipmap&&d.extTextureFilterAnisotropic&&n.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax);const[U,V,G,j]=I.getPoleBuffers(0,!0);let Z;R.onNorthPole?(Z=U,n.renderDefaultNorthPole=!1):(L=rt.scale(rt.create(),L,[1,-1,1]),Z=V,n.renderDefaultSouthPole=!1);const et=OT(F,N,L,[0,0],1,z,r,R.perspectiveTransform||[0,0],2,m.mix||[0,0,0,0],m.range||[0,0]),it=n.getOrCreateProgram("raster",{defines:m.defines});return n.uploadCommonUniforms(d,it,null),void it.draw(n,h.TRIANGLES,O,Fe.disabled,x,Ge.disabled,et,r.id,Z,G,j)}if(!a.length)return;const[S,M]=p instanceof ql||b?[{},a]:n.stencilConfigForOverlap(a),D=M[M.length-1].overscaledZ;for(const R of M){const P=b?ve.disabled:n.depthModeForSublayer(R.overscaledZ-D,1===r.paint.get("raster-opacity")?ve.ReadWrite:ve.ReadOnly,h.LESS),I=R.toUnwrapped(),O=t.getTile(R);if(b&&(!O||!O.hasData())||!O.texture)continue;const F=b?R.projMatrix:n.transform.calculateProjMatrix(I,E),L=n.terrain&&b?n.terrain.stencilModeForRTTOverlap(R):S[R.overscaledZ],N=u?0:r.paint.get("raster-fade-duration");O.registerFadeDuration(N);const z=t.findLoadedParent(R,0),U=MT(O,z,t,n.transform,N);let V,G;n.terrain&&n.terrain.prepareDrawTile(),d.activeTexture.set(h.TEXTURE0),O.texture.bind(C,h.CLAMP_TO_EDGE),d.activeTexture.set(h.TEXTURE1),z?(z.texture.bind(C,h.CLAMP_TO_EDGE),V=Math.pow(2,z.tileID.overscaledZ-O.tileID.overscaledZ),G=[O.tileID.canonical.x*V%1,O.tileID.canonical.y*V%1]):O.texture.bind(C,h.CLAMP_TO_EDGE),O.texture.useMipmap&&d.extTextureFilterAnisotropic&&n.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax);const j=p instanceof ql?p.perspectiveTransform:[0,0],Z=new Float32Array(16),et=OT(F,Z,Z,G||[0,0],V||1,U,r,j,2,m.mix||[0,0,0,0],m.range||[0,0]),it=n.isTileAffectedByFog(R),X=n.getOrCreateProgram("raster",{defines:m.defines,overrideFog:it});if(n.uploadCommonUniforms(d,X,I),p instanceof ql)p.boundsBuffer&&p.boundsSegments&&X.draw(n,h.TRIANGLES,P,Fe.disabled,x,Ge.disabled,et,r.id,p.boundsBuffer,n.quadTriangleIndexBuffer,p.boundsSegments);else{const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:ot,tileBoundsSegments:lt}=n.getTileBoundsBuffers(O);X.draw(n,h.TRIANGLES,P,L,x,Ge.disabled,et,r.id,Y,ot,lt)}}n.resetStencilClippingMasks()},background:function(n,t,r,a){const l=r.paint.get("background-color"),u=r.paint.get("background-opacity"),d=r.paint.get("background-emissive-strength");if(0===u)return;const h=n.context,p=h.gl,m=n.transform,_=m.tileSize,y=r.paint.get("background-pattern");if(n.isPatternMissing(y,r.scope))return;const x=!y&&1===l.a&&1===u&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass!==x)return;const b=Fe.disabled,E=n.depthModeForSublayer(0,"opaque"===x?ve.ReadWrite:ve.ReadOnly),C=n.colorModeForDrapableLayerRenderPass(d),S=y?"backgroundPattern":"background";let M,D=a;D||(M=n.getBackgroundTiles(),D=Object.values(M).map(R=>R.tileID)),y&&(h.activeTexture.set(p.TEXTURE0),n.imageManager.bind(n.context,r.scope));for(const R of D){const P=n.isTileAffectedByFog(R),I=n.getOrCreateProgram(S,{overrideFog:P}),O=R.toUnwrapped(),F=a?R.projMatrix:n.transform.calculateProjMatrix(O);n.prepareDrawTile();const L=t?t.getTile(R):M?M[R.key]:new As(R,_,m.zoom,n),N=y?Wl(F,d,u,n,y,r.scope,{tileID:R,tileSize:_}):YF(F,d,u,l);n.uploadCommonUniforms(h,I,O);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:V}=n.getTileBoundsBuffers(L);I.draw(n,p.TRIANGLES,E,b,C,Ge.disabled,N,r.id,z,U,V)}},sky:function(n,t,r){const a=n._atmosphere?Vr(n.transform.zoom):1,l=r.paint.get("sky-opacity")*a;if(0===l)return;const u=n.context,d=r.paint.get("sky-type"),h=new ve(u.gl.LEQUAL,ve.ReadOnly,[0,1]),p=n.frameCounter/1e3%1;"atmosphere"===d?"offscreen"===n.renderPass?r.needsSkyboxCapture(n)&&(function(m,_,y,x){const b=m.context,E=b.gl;let C=_.skyboxFbo;if(!C){C=_.skyboxFbo=b.createFramebuffer(32,32,!0,null),_.skyboxGeometry=new $T(b),_.skyboxTexture=b.gl.createTexture(),E.bindTexture(E.TEXTURE_CUBE_MAP,_.skyboxTexture),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,E.LINEAR);for(let R=0;R<6;++R)E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,E.RGBA,32,32,0,E.RGBA,E.UNSIGNED_BYTE,null)}b.bindFramebuffer.set(C.framebuffer),b.viewport.set([0,0,32,32]);const S=_.getCenter(m,!0),M=m.getOrCreateProgram("skyboxCapture"),D=new Float64Array(16);rt.identity(D),rt.rotateY(D,D,.5*-Math.PI),zf(m,_,M,D,S,0),rt.identity(D),rt.rotateY(D,D,.5*Math.PI),zf(m,_,M,D,S,1),rt.identity(D),rt.rotateX(D,D,.5*-Math.PI),zf(m,_,M,D,S,2),rt.identity(D),rt.rotateX(D,D,.5*Math.PI),zf(m,_,M,D,S,3),rt.identity(D),zf(m,_,M,D,S,4),rt.identity(D),rt.rotateY(D,D,Math.PI),zf(m,_,M,D,S,5),b.viewport.set([0,0,m.width,m.height])}(n,r),r.markSkyboxValid(n)):"sky"===n.renderPass&&function(m,_,y,x,b){const E=m.context,C=E.gl,S=m.transform,M=m.getOrCreateProgram("skybox");E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_CUBE_MAP,_.skyboxTexture);const D={u_matrix:S.skyboxMatrix,u_sun_direction:_.getCenter(m,!1),u_cubemap:0,u_opacity:x,u_temporal_offset:b};m.uploadCommonUniforms(E,M),M.draw(m,C.TRIANGLES,y,Fe.disabled,m.colorModeForRenderPass(),Ge.backCW,D,"skybox",_.skyboxGeometry.vertexBuffer,_.skyboxGeometry.indexBuffer,_.skyboxGeometry.segment)}(n,r,h,l,p):"gradient"===d&&"sky"===n.renderPass&&function(m,_,y,x,b){const E=m.context,C=E.gl,S=m.transform,M=m.getOrCreateProgram("skyboxGradient");_.skyboxGeometry||(_.skyboxGeometry=new $T(E)),E.activeTexture.set(C.TEXTURE0);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new ir(E,_.colorRamp,C.RGBA)),D.bind(C.LINEAR,C.CLAMP_TO_EDGE);const R=(F=x,L=b,{u_matrix:S.skyboxMatrix,u_color_ramp:0,u_center_direction:_.getCenter(m,!1),u_radius:Ie(_.paint.get("sky-gradient-radius")),u_opacity:F,u_temporal_offset:L});var F,L;m.uploadCommonUniforms(E,M),M.draw(m,C.TRIANGLES,y,Fe.disabled,m.colorModeForRenderPass(),Ge.backCW,R,"skyboxGradient",_.skyboxGeometry.vertexBuffer,_.skyboxGeometry.indexBuffer,_.skyboxGeometry.segment)}(n,r,h,l,p)},debug:function(n,t,r){for(let a=0;a<r.length;a++)B1(n,t,r[a])},custom:function(n,t,r,a){const l=n.context,u=r.implementation;if(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes("custom")||n.terrain&&(n.terrain.renderingToTexture||"offscreen"===n.renderPass)&&r.isLayerDraped(t)){if("offscreen"===n.renderPass){const d=u.prerender;if(d){if(n.setCustomLayerDefaults(),l.setColorMode(n.colorModeForRenderPass()),"globe"===n.transform.projection.name){const h=n.transform.pointMerc;d.call(u,l.gl,n.transform.customLayerMatrix(),n.transform.getProjection(),n.transform.globeToMercatorMatrix(),Vr(n.transform.zoom),[h.x,h.y],n.transform.pixelsPerMeterRatio)}else d.call(u,l.gl,n.transform.customLayerMatrix());l.setDirty(),n.setBaseState()}}else if("translucent"===n.renderPass){if(n.terrain&&n.terrain.renderingToTexture){const h=u.renderToTile;if(h){const p=a[0].canonical,m=new Je(p.x+a[0].wrap*(1<<p.z),p.y,p.z);l.setDepthMode(ve.disabled),l.setStencilMode(Fe.disabled),l.setColorMode(n.colorModeForRenderPass()),n.setCustomLayerDefaults(),h.call(u,l.gl,m),l.setDirty(),n.setBaseState()}return}n.setCustomLayerDefaults(),l.setColorMode(n.colorModeForRenderPass()),l.setStencilMode(Fe.disabled);const d="3d"===u.renderingMode?new ve(n.context.gl.LEQUAL,ve.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,ve.ReadOnly);if(l.setDepthMode(d),"globe"===n.transform.projection.name){const h=n.transform.pointMerc;u.render(l.gl,n.transform.customLayerMatrix(),n.transform.getProjection(),n.transform.globeToMercatorMatrix(),Vr(n.transform.zoom),[h.x,h.y],n.transform.pixelsPerMeterRatio)}else u.render(l.gl,n.transform.customLayerMatrix());l.setDirty(),n.setBaseState(),l.bindFramebuffer.set(null)}}else tt("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(n,t,r,a){if("opaque"===n.renderPass)return;const l=r.paint.get("model-opacity");if(0===l)return;const u=r.paint.get("model-cast-shadows");if("shadow"===n.renderPass&&(!u||n.terrain&&l<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof gc))return;const d=n.shadowRenderer,h=r.paint.get("model-receive-shadows");d&&(d.useNormalOffset=!0,h||(d.enabled=!1));const p=()=>{d&&(d.useNormalOffset=!0,h||(d.enabled=!0))},m=t.getSource();if("light-beam"===n.renderPass&&"batched-model"!==m.type)return;if("vector"===m.type||"geojson"===m.type)return function(M,D,R,P){const I=M.transform;if("mercator"!==I.projection.name)return void tt(`Drawing 3D models for ${I.projection.name} projection is not yet implemented`);const O=I.getFreeCameraOptions().position;if(!M.modelManager)return;const F=M.modelManager,L=M.shadowRenderer;if(!R._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const N=R._unevaluatedLayout._values["model-id"],z={...R.layout.get("model-id").parameters};for(const U of P){const V=D.getTile(U).getBucket(R);if(!V||V.projection.name!==I.projection.name)continue;const G=qT(U,I);z.zoom=G;const j=N.possiblyEvaluate(z);if(nP(M,V,U),ll.shadowUniformsInitialized=!1,ll.useSingleShadowCascade=!!L&&0===L.getMaxCascadeForTile(U.toUnwrapped()),"shadow"===M.renderPass&&L){if(1===M.currentShadowCascade&&V.isInsideFirstShadowMapFrustum)continue;const it=I.calculatePosMatrix(U.toUnwrapped(),I.worldSize);if(ll.tileMatrix.set(it),ll.shadowTileMatrix=Float32Array.from(L.calculateShadowPassMatrixFromMatrix(it)),ll.aabb.min.fill(0),ll.aabb.max[0]=ll.aabb.max[1]=dt,ll.aabb.max[2]=0,iP(V,ll,M,R.scope))continue}const Z=1<<U.canonical.z,et=[((O.x-U.wrap)*Z-U.canonical.x)*dt,(O.y*Z-U.canonical.y)*dt,O.z*Z*dt];for(let it in V.instancesPerModel){const X=V.instancesPerModel[it];X.features.length>0&&(it=j.evaluate(X.features[0].feature,{}));const Y=F.getModel(it,R.scope);if(Y&&Y.uploaded)for(const ot of Y.nodes)Jo(M,R,ot,X,et,U,ll)}}}(n,t,r,a),void p();if(!m.loaded())return;if("batched-model"===m.type)return function(M,D,R,P){const I=M.context,O=M.transform,F=M.style.fog,L=M.shadowRenderer;if("mercator"!==O.projection.name)return void tt(`Drawing 3D landmark models for ${O.projection.name} projection is not yet implemented`);const N=M.transform.getFreeCameraOptions().position,z=q.scale([],[N.x,N.y,N.z],M.transform.worldSize);q.negate(z,z);const U=rt.identity([]),V=Za(O.center.lat,O.zoom),G=rt.fromScaling([],[1,1,1/V]);rt.translate(U,U,z);const j=R.paint.get("model-opacity"),Z=new ve(I.gl.LEQUAL,ve.ReadWrite,M.depthRangeFor3D),et=new ve(I.gl.LEQUAL,ve.ReadOnly,M.depthRangeFor3D),it=function(X,Y){for(const ot of P){const lt=D.getTile(ot).getBucket(R);if(!lt||!lt.uploaded)continue;let ht=!1;L&&(ht=0===L.getMaxCascadeForTile(ot.toUnwrapped()));const mt=O.calculatePosMatrix(ot.toUnwrapped(),O.worldSize),vt=lt.modelTraits;for(const ct of lt.getNodesInfo()){if(ct.hiddenByReplacement||!ct.node.meshes)continue;const ft=ct.node,Rt="light-beam"===M.renderPass,Vt=[...mt],jt=ct.evaluatedScale;let Ht=0;M.terrain&&ft.elevation&&(Ht=ft.elevation*M.terrain.exaggeration()),rt.translate(Vt,Vt,[(ft.anchor?ft.anchor[0]:0)*(jt[0]-1),(ft.anchor?ft.anchor[1]:0)*(jt[1]-1),Ht]),jt!==mS&&rt.scale(Vt,Vt,jt),rt.multiply(Vt,Vt,ft.matrix);const re=rt.multiply([],G,Vt);rt.multiply(re,U,re);const ye=rt.invert([],re);rt.transpose(ye,ye),rt.scale(ye,ye,Bf);const je=rt.multiply([],O.projMatrix,Vt);for(let rn=0;rn<ft.meshes.length;++rn){const Re=ft.meshes[rn],Me=rn===ft.lightMeshIndex;if(Me){if(!Rt&&!M.terrain&&M.shadowRenderer){M.currentLayer<M.firstLightBeamLayer&&(M.firstLightBeamLayer=M.currentLayer);continue}}else if(Rt)continue;const ge={defines:[]},ue=[];rr(ge.defines,ue,Re,M),4&vt||ge.defines.push("DIFFUSE_SHADED"),ht&&ge.defines.push("SHADOWS_SINGLE_CASCADE");const Le="shadow"===M.renderPass;if(Le){wv(Re,Vt,M,R);continue}let ln=null;if(F){const ei=Qs(Vt,M.transform);if(ln=new Float32Array(ei),"globe"!==O.projection.name){const ur=Re.aabb.min,vi=Re.aabb.max,[hi,Gn]=F.getOpacityForBounds(ei,ur[0],ur[1],vi[0],vi[1]);ge.overrideFog=hi>=Ru||Gn>=Ru}}const Be=M.getOrCreateProgram("model",ge);!Le&&L&&(L.useNormalOffset=!!Re.normalBuffer,L.setupShadowsFromMatrix(Vt,Be,L.useNormalOffset)),M.uploadCommonUniforms(I,Be,ot.toUnwrapped(),ln);const Zn=Re.material,Ti=Zn.pbrMetallicRoughness;Ti.metallicFactor=.9,Ti.roughnessFactor=.5;const di=k1(new Float32Array(je),new Float32Array(re),new Float32Array(ye),M,j,Ti.baseColorFactor,Zn.emissiveFactor,Ti.metallicFactor,Ti.roughnessFactor,Zn,R);Be.draw(M,I.gl.TRIANGLES,Y&&!Me?Z:et,Fe.disabled,X?Me||j<1||ct.hasTranslucentParts?an.alphaBlended:an.unblended:an.disabled,Ge.backCCW,di,R.id,Re.vertexBuffer,Re.indexBuffer,Re.segments,R.paint,M.transform.zoom,void 0,ue)}}}};(function(X,Y,ot,lt){const ht=X.terrain?X.terrain.exaggeration():0,mt=X.transform.zoom;for(const vt of lt){const ct=Y.getTile(vt).getBucket(ot);ct&&(X.conflationActive&&ct.updateReplacement(vt,X.replacementSource),ct.evaluateScale(X,ot),X.terrain&&ht>0&&ct.elevationUpdate(X.terrain,ht,vt,ot.source),ct.needsReEvaluation(X,mt,ot)&&ct.evaluate(ot))}})(M,D,R,P),1===j?it(!0,!0):(it(!1,!0),it(!0,!1))}(n,t,r,a),void p();const _=m.getModels(),y=[],x=n.transform.getFreeCameraOptions().position,b=q.scale([],[x.x,x.y,x.z],n.transform.worldSize);q.negate(b,b);const E=[],C=[];let S=0;for(const M of _){const D=r.paint.get("model-rotation").constantOr(null),R=r.paint.get("model-scale").constantOr(null),P=r.paint.get("model-translation").constantOr(null);M.computeModelMatrix(n,D,R,P,!0,!0,!1);const I=rt.identity([]),O=Za(M.position.lat,n.transform.zoom),F=rt.fromScaling([],[1,1,1/O]);rt.translate(I,I,b),y.push({zScaleMatrix:F,negCameraPosMatrix:I});for(const L of M.nodes)H1(n.transform,L,M.matrix,n.transform.projMatrix,S,E,C);S++}if(E.sort((M,D)=>D.depth-M.depth),"shadow"!==n.renderPass){if(1===l)for(const M of C)bv(M,n,r,y[M.modelIndex],Fe.disabled,n.colorModeForRenderPass());else{for(const M of C)bv(M,n,r,y[M.modelIndex],Fe.disabled,an.disabled);for(const M of C)bv(M,n,r,y[M.modelIndex],n.stencilModeFor3D(),n.colorModeForRenderPass());n.resetStencilClippingMasks()}for(const M of E)bv(M,n,r,y[M.modelIndex],Fe.disabled,n.colorModeForRenderPass());p()}else{for(const M of C)wv(M.mesh,M.nodeModelMatrix,n,r);for(const M of E)wv(M.mesh,M.nodeModelMatrix,n,r);p()}}},$1={modelUpload:function(n,t,r){const a=t.getSource();if(!a.loaded())return;if("vector"===a.type||"geojson"===a.type)return void(n.modelManager&&n.modelManager.upload(n,r));if("batched-model"===a.type)return;const l=a.getModels();for(const u of l)u.upload(n.context)}};class G1{constructor(t,r){this.context=new Wy(t),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Rs.maxUnderzooming+Rs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new H2,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new pg(this),this._wireframeDebugCache=new KF,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,r){const a=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(a||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new BR(this,t));const l=this._terrain;this.transform.elevation=a?l:null,l.update(t,this.transform,r),this.transform.elevation&&!l.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||"globe"===this.transform.projection.name||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[a,l]=r.getFovAdjustedRange(this.transform._fov);if(a>l)return void(this.transform.fogCullDistSq=null);const u=a+.78*(l-a);this.transform.fogCullDistSq=u*u}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*kt.devicePixelRatio,this.height=r*kt.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const a of this.style.order)this.style._mergedLayers[a].resize()}setup(){const t=this.context,r=new Zo;r.emplaceBack(0,0),r.emplaceBack(dt,0),r.emplaceBack(0,dt),r.emplaceBack(dt,dt),this.tileExtentBuffer=t.createVertexBuffer(r,xc.members),this.tileExtentSegments=Bn.simpleSegment(0,0,4,2);const a=new Zo;a.emplaceBack(0,0),a.emplaceBack(dt,0),a.emplaceBack(0,dt),a.emplaceBack(dt,dt),this.debugBuffer=t.createVertexBuffer(a,xc.members),this.debugSegments=Bn.simpleSegment(0,0,4,5);const l=new Zo;l.emplaceBack(-1,-1),l.emplaceBack(1,-1),l.emplaceBack(-1,1),l.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(l,xc.members),this.viewportSegments=Bn.simpleSegment(0,0,4,2);const u=new cd;u.emplaceBack(0,0,0,0),u.emplaceBack(dt,0,dt,0),u.emplaceBack(0,dt,0,dt),u.emplaceBack(dt,dt,dt,dt),this.mercatorBoundsBuffer=t.createVertexBuffer(u,Om.members),this.mercatorBoundsSegments=Bn.simpleSegment(0,0,4,2);const d=new er;d.emplaceBack(0,1,2),d.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(d);const h=new L_;for(const m of[0,1,3,2,0])h.emplaceBack(m);this.debugIndexBuffer=t.createIndexBuffer(h),this.emptyTexture=new ir(t,new Pi({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=rt.create();const p=this.context.gl;this.stencilClearMode=new Fe({func:p.ALWAYS,mask:0},0,255,p.ZERO,p.ZERO,p.ZERO),this.loadTimeStamps.push(st.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ve.disabled,this.stencilClearMode,an.disabled,Ge.disabled,R1(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,a){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!a||0===a.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let h=!1;for(const p of a)if(void 0===this._tileClippingMaskIDs[p.key]){h=!0;break}if(!h)return}this.currentStencilSource=r.id;const l=this.context,u=l.gl;this.nextStencilID+a.length>256&&this.clearStencil(),l.setColorMode(an.disabled),l.setDepthMode(ve.disabled);const d=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const h of a){const p=r.getTile(h),m=this._tileClippingMaskIDs[h.key]=this.nextStencilID++,{tileBoundsBuffer:_,tileBoundsIndexBuffer:y,tileBoundsSegments:x}=this.getTileBoundsBuffers(p);d.draw(this,u.TRIANGLES,ve.disabled,new Fe({func:u.ALWAYS,mask:0},m,255,u.KEEP,u.KEEP,u.REPLACE),an.disabled,Ge.disabled,R1(h.projMatrix),"$clipping",_,y,x)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Fe({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new Fe({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,a=t.sort((d,h)=>h.overscaledZ-d.overscaledZ),l=a[a.length-1].overscaledZ,u=a[0].overscaledZ-l+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();const d={};for(let h=0;h<u;h++)d[h+l]=new Fe({func:r.GEQUAL,mask:255},h+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=u,[d,a]}return[{[l]:Fe.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new an([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new Ne(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?an.unblended:an.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new an([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new Ne(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,a,l=!1){if(!this.opaquePassEnabledForLayer()&&!l)return ve.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ve(a||this.context.gl.LEQUAL,r,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=r;const a=this.style._mergedLayers,l=this.style.order,u=l.map(I=>a[I]),d=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(kt.now()),this.imageManager.beginFrame();let h=0,p=!1;for(const I in d){const O=d[I];O.used&&(O.prepare(this.context),O.getSource().usedInConflation&&++h)}const m={},_={},y={},x={},b={};for(const I in d){const O=d[I];m[I]=O.getVisibleCoordinates(),_[I]=m[I].slice().reverse(),y[I]=O.getVisibleCoordinates(!0).reverse(),x[I]=O.getShadowCasterCoordinates(),b[I]=O.sortCoordinatesByDistance(m[I])}const E=I=>{const O=this.style.getLayerSourceCache(I);return O&&O.used?O.getSource():null};if(h){const I=[];for(const O of u)this.layerUsedInConflation(O,E(O))&&I.push(O);if(I&&I.length>1){const O=[];for(const F of I){const L=this.style.getLayerSourceCache(F);L&&L.used&&L.getSource().usedInConflation&&O.push({layer:F.fqid,cache:L})}this.replacementSource.setSources(O),p=!0}}p||this.replacementSource.clear(),this.conflationActive=p,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const I of u){const O=I.cutoffRange();if(this.longestCutoffRange=Math.max(O,this.longestCutoffRange),O>0){const F=E(I);F&&(this.minCutoffZoom=Math.max(F.minzoom,this.minCutoffZoom)),I.minzoom&&(this.minCutoffZoom=Math.max(I.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let I=0;I<u.length;I++)if(u[I].is3D()){this.opaquePassCutoff=I;break}const C=this.style&&this.style.fog;C?(this._fogVisible=0!==C.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=C.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0);const S=this._shadowRenderer;if(S){S.updateShadowParameters(this.transform,this.style.directionalLight);for(const I in d)for(const O of m[I]){let F={min:0,max:0};this.terrain&&(F=this.terrain.getMinMaxForTile(O)||F),S.addShadowReceiver(O.toUnwrapped(),F.min,F.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new KC(this.context));for(const I of u){if(I.isHidden(this.transform.zoom))continue;const O=t.getLayerSourceCache(I);this.uploadLayer(this,I,O)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ta),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!ru.has(this.context.gl))return;this.renderPass="offscreen";for(const I of u){const O=t.getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const F=O?_[O.id]:void 0;("custom"===I.type||"raster"===I.type||I.isSky()||F&&F.length)&&this.renderLayer(this,O,I,F)}this.depthRangeFor3D=[0,1-(u.length+2)*this.numSublayers*this.depthEpsilon];const M=this.terrain;M&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&M.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,x)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const D="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),R=(()=>{if(r.showOverdrawInspector)return Ne.black;if(this.style.fog&&this.transform.projection.supportsFog&&!D){const I=this.style.fog.properties.get("color").toArray01();return new Ne(...I)}if(this.style.fog&&this.transform.projection.supportsFog&&D){const I=this.style.fog.properties.get("space-color").toArray01();return new Ne(...I)}return Ne.transparent})();if(this.context.clear({color:R,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&D&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const I=u[this.currentLayer],O=t.getLayerSourceCache(I);if(I.isSky())continue;const F=O?(I.is3D()?b:_)[O.id]:void 0;this._renderTileClippingMasks(I,O,F),this.renderLayer(this,O,I,F)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&D&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Vr(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const I=u[this.currentLayer],O=t.getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,O,I,O?_[O.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let P=0;for(S&&(P=S.getShadowCastingLayerCount());this.currentLayer<l.length;){const I=u[this.currentLayer],O=t.getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(M&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=M.renderBatch(this.currentLayer);continue}let F;if(O&&(F=("symbol"===I.type?y:I.is3D()?b:_)[O.id]),this._renderTileClippingMasks(I,O,O?m[O.id]:void 0),this.renderLayer(this,O,I,F),!M&&S&&P>0&&I.hasShadowPass()&&0==--P&&(S.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const L=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=L;this.currentLayer++){const N=u[this.currentLayer];if(!N.hasLightBeamPass())continue;const z=t.getLayerSourceCache(N);this.renderLayer(this,z,N,z?_[z.id]:void 0)}this.currentLayer=L,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;u.forEach(O=>{const F=t.getLayerSourceCache(O);F&&!O.isHidden(this.transform.zoom)&&F.getVisibleCoordinates().length&&(!I||I.getSource().maxzoom<F.getSource().maxzoom)&&(I=F)}),I&&this.options.showTileBoundaries&&oP.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const O=I.transform.padding;xv(I,I.transform.height-(O.top||0),3,JR),xv(I,O.bottom||0,3,UT),V1(I,O.left||0,3,HT),V1(I,I.transform.width-(O.right||0),3,QR);const F=I.transform.centerPoint;var L,N,z,U;Nf(L=I,(N=F.x)-1,(z=I.transform.height-F.y)-10,2,20,U=tP),Nf(L,N-10,z-1,20,2,U)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(st.performance.now()),this.saveCanvasCopy()),p||(this.conflationActive=!1)}uploadLayer(t,r,a){this.gpuTimingStart(r),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(r.type)||t.terrain&&"custom"===r.type)&&$1[`${r.type}Upload`]&&$1[`${r.type}Upload`](t,a,r.scope),this.gpuTimingEnd()}renderLayer(t,r,a,l){a.isHidden(this.transform.zoom)||("background"===a.type||"sky"===a.type||"custom"===a.type||"model"===a.type||"raster"===a.type||l&&l.length)&&(this.id=a.id,this.gpuTimingStart(a),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(a.type)||t.terrain&&"custom"===a.type)&&oP[a.type](t,r,a,l,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,a=this.context.gl;let l=this.gpuTimers[t.id];l||(l=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:a.createQuery()}),l.calls++,a.beginQuery(r.TIME_ELAPSED_EXT,l.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,a=r.createQuery();this.deferredRenderGpuTimeQueries.push(a),r.beginQuery(t.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const a in t){const l=t[a],u=this.context.extTimerQuery,d=u.getQueryParameter(l.query,this.context.gl.QUERY_RESULT)/1e6;u.deleteQueryEXT(l.query),r[a]=d}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.extTimerQuery,a=this.context.gl;let l=0;for(const u of t)l+=r.getQueryParameter(u,a.QUERY_RESULT)/1e6,r.deleteQueryEXT(u);return l}translatePosMatrix(t,r,a,l,u){if(!a[0]&&!a[1])return t;const d=u?"map"===l?this.transform.angle:0:"viewport"===l?-this.transform.angle:0;if(d){const m=Math.sin(d),_=Math.cos(d);a=[a[0]*_-a[1]*m,a[0]*m+a[1]*_]}const h=[u?a[0]:Pd(r,a[0],this.transform.zoom),u?a[1]:Pd(r,a[1],this.transform.zoom),0],p=new Float32Array(16);return rt.translate(p,t,h),p}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t,r){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString(),r)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,r,a){const l=void 0===a?this.terrain&&this.terrain.renderingToTexture:a,u=this.terrain&&0===this.terrain.exaggeration(),d=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(d.push("LIGHTING_3D_MODE"),d.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):l||d.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||d.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?d.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):d.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(d.push("TERRAIN"),this.terrainUseFloatDEM()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),u&&d.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&d.push("GLOBE"),!this._fogVisible||l||void 0!==r&&!r||d.push("FOG","FOG_DITHERING"),l&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}getOrCreateProgram(t,r){this.cache=this.cache||{};const a=r&&r.defines||[],l=r&&r.config,u=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(a),d=kf.cacheKey(D1[t],t,u,l);return this.cache[d]||(this.cache[d]=new kf(this.context,t,D1[t],l,LT[t],u)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=st.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ir(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const a=this.style.directionalLight,l=this.style.ambientLight;if(a&&l){const u=((d,h)=>{const p=d.properties.get("direction"),m=d.properties.get("color").toArray01(),_=d.properties.get("intensity"),y=h.properties.get("color").toArray01(),x=h.properties.get("intensity"),b=[p.x,p.y,p.z],E=Bi(y,x),C=Bi(m,_);return{u_lighting_ambient_color:E,u_lighting_directional_dir:b,u_lighting_directional_color:C,u_ground_radiance:VR(b,C,E)}})(a,l);r.setLightsUniformValues(t,u)}}}uploadCommonUniforms(t,r,a,l,u){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const h=d.getOpacity(this.transform.pitch),p=((m,_,y,x,b,E,C,S,M,D,R,P)=>{const I=m.transform,O=_.properties.get("color").toArray01();O[3]=x;const F=m.frameCounter/1e3%1,[L,N]=_.properties.get("vertical-range");return{u_fog_matrix:y?I.calculateFogTileMatrix(y):P||m.identityMat,u_fog_range:_.getFovAdjustedRange(I._fov),u_fog_color:O,u_fog_horizon_blend:_.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(L,N),N],u_fog_temporal_offset:F,u_frustum_tl:b,u_frustum_tr:E,u_frustum_br:C,u_frustum_bl:S,u_globe_pos:M,u_globe_radius:D,u_viewport:R,u_globe_transition:Vr(I.zoom),u_is_globe:+("globe"===I.projection.name)}})(this,d,a,h,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*kt.devicePixelRatio,this.transform.height*kt.devicePixelRatio],l);r.setFogUniformValues(t,p)}u&&r.setCutoffUniformValues(t,u.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},a=this.transform.coveringTiles({tileSize:512});for(const l of a)r[l.key]=t[l.key]||new As(l,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,r){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||"building"!==t.sourceLayer&&(!r||"batched-model"!==r.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=Ru||r[1]>=Ru}}const Vf=2048;class JF{constructor(t,r){this.aabb=t,this.lastCascade=r}}class QF{add(t,r){const a=this.receivers[t.key];void 0!==a?(a.aabb.min[0]=Math.min(a.aabb.min[0],r.min[0]),a.aabb.min[1]=Math.min(a.aabb.min[1],r.min[1]),a.aabb.min[2]=Math.min(a.aabb.min[2],r.min[2]),a.aabb.max[0]=Math.max(a.aabb.max[0],r.max[0]),a.aabb.max[1]=Math.max(a.aabb.max[1],r.max[1]),a.aabb.max[2]=Math.max(a.aabb.max[2],r.max[2])):this.receivers[t.key]=new JF(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,a){const l=ui.fromPoints(t.points);let u=0;for(const d in this.receivers){const h=this.receivers[d];if(!h||!l.intersectsAabb(h.aabb))continue;h.aabb.min=l.closestPoint(h.aabb.min),h.aabb.max=l.closestPoint(h.aabb.max);const p=h.aabb.getCorners();for(let m=0;m<a.length;m++){let _=!0;for(const y of p){const x=[y[0]*r,y[1]*r,y[2]];if(q.transformMat4(x,x,a[m].matrix),x[0]<-1||x[0]>1||x[1]<-1||x[1]>1){_=!1;break}}if(h.lastCascade=m,u=Math.max(u,m),_)break}}return u+1}}class pg{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new QF,this._depthMode=new ve(t.context.gl.LEQUAL,ve.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const a=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const l=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||l<=0||(this._shadowLayerCount=a.style.order.reduce((b,E)=>{const C=a.style._mergedLayers[E];return b+(C.hasShadowPass()&&!C.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const u=a.context,d=Vf,h=Vf;if(0===this._cascades.length)for(let b=0;b<2;++b){const E=a._shadowMapDebug,C=u.gl,S=u.createFramebuffer(d,h,E,"texture"),M=new ir(u,{width:d,height:h,data:null},C.DEPTH_COMPONENT);if(S.depthAttachment.set(M.texture),E){const D=new ir(u,{width:d,height:h,data:null},C.RGBA);S.colorAttachment.set(D.texture)}this._cascades.push({framebuffer:S,texture:M,matrix:[],far:0,boundingSphereRadius:0,frustum:new Vl,scale:0})}this.shadowDirection=Cv(r);let p=0;if(t.elevation){const b=t.elevation,E=[1e4,-1e4];b.visibleDemTiles.filter(C=>C.dem).forEach(C=>{const S=C.dem.tree;E[0]=Math.min(E[0],S.minimums[0]),E[1]=Math.max(E[1],S.maximums[0])}),1e4!==E[0]&&(p=(E[1]-E[0])*b.exaggeration())}const m=1.5*t.cameraToCenterDistance,_=3*m,y=new Float64Array(16);for(let b=0;b<2;++b){const E=this._cascades[b];let C=t.height/50,S=1;0===b?S=m:(C=m,S=_);const[M,D]=WT(t,this.shadowDirection,C,S,Vf,p);E.scale=t.scale,E.matrix=M,E.boundingSphereRadius=D,rt.invert(y,E.matrix),E.frustum=Vl.fromInvProjectionMatrix(y,1,0,!0),E.far=S}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=l,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Vf,this._uniformValues.u_shadowmap_0=Ps.ShadowMap0,this._uniformValues.u_shadowmap_1=Ps.ShadowMap0+1,this._groundShadowTiles=a.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const x=a.transform.elevation;for(const b of this._groundShadowTiles){let E={min:0,max:0};if(x){const C=x.getMinMaxForTile(b);C&&(E=C)}this.addShadowReceiver(b.toUnwrapped(),E.min,E.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this._enabled)return;const a=this.painter,l=a.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(a.transform.getFrustum(0),a.transform.worldSize,this._cascades),l.viewport.set([0,0,Vf,Vf]);for(let u=0;u<this._numCascadesToRender;++u){a.currentShadowCascade=u,l.bindFramebuffer.set(this._cascades[u].framebuffer.framebuffer),l.clear({color:Ne.white,depth:1});for(const d of t.order){const h=t._mergedLayers[d];if(!h.hasShadowPass()||h.isHidden(a.transform.zoom))continue;const p=t.getLayerSourceCache(h),m=p?r[p.id]:void 0;("model"===h.type||m&&m.length)&&a.renderLayer(a,p,h,m)}}a.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,r=t.style,a=t.context,l=r.directionalLight,u=r.ambientLight;if(!l||!u)return;const d=[],h=Of(t,t.longestCutoffRange);h.shouldRenderCutoff&&d.push("RENDER_CUTOFF");const p=q1(l,u),m=new ve(a.gl.LEQUAL,ve.ReadOnly,t.depthRangeFor3D);for(const _ of this._groundShadowTiles){const y=_.toUnwrapped(),x=t.isTileAffectedByFog(_),b=t.getOrCreateProgram("groundShadow",{defines:d,overrideFog:x});this.setupShadows(y,b),t.uploadCommonUniforms(a,b,y,null,h);const E={u_matrix:t.transform.calculateProjMatrix(y),u_ground_shadow_factor:p};b.draw(t,a.gl.TRIANGLES,m,Fe.disabled,an.multiply,Ge.disabled,E,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?an.unblended:an.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,a=r.calculatePosMatrix(t,r.worldSize);return rt.multiply(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}calculateShadowPassMatrixFromMatrix(t){return rt.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,a,l=0){if(!this._enabled)return;const u=this.painter.transform,d=this.painter.context,h=d.gl,p=this._uniformValues,m=new Float64Array(16),_=u.calculatePosMatrix(t,u.worldSize);for(let y=0;y<2;y++)rt.multiply(m,this._cascades[y].matrix,_),p[0===y?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(m),d.activeTexture.set(h.TEXTURE0+Ps.ShadowMap0+y),this._cascades[y].texture.bind(h.NEAREST,h.CLAMP_TO_EDGE);if(this.useNormalOffset=!!a,this.useNormalOffset){const y=Cd(t.canonical),x=2/u.tileSize*dt/Vf,b=x*this._cascades[0].boundingSphereRadius,E=x*this._cascades[1].boundingSphereRadius,C=("vector-tile"===a?1:3)/Math.pow(2,l-t.canonical.z-(1-u.zoom+Math.floor(u.zoom)));p.u_shadow_normal_offset=[y,b*C,E*C],p.u_shadow_bias=[6e-5,.0012,.012]}else p.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(d,p)}setupShadowsFromMatrix(t,r,a=!1){if(!this._enabled)return;const l=this.painter.context,u=l.gl,d=this._uniformValues,h=new Float64Array(16);for(let p=0;p<2;p++)rt.multiply(h,this._cascades[p].matrix,t),d[0===p?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(h),l.activeTexture.set(u.TEXTURE0+Ps.ShadowMap0+p),this._cascades[p].texture.bind(u.NEAREST,u.CLAMP_TO_EDGE);this.useNormalOffset=a,a?(d.u_shadow_normal_offset=[1,5,5],d.u_shadow_bias=[6e-5,.0012,.012]):d.u_shadow_bias=[36e-5,.0012,.012],r.setShadowUniformValues(l,d)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,a,l){if(l[2]>=0)return{};const u=function(p,m,_){const y=_/(1<<p.canonical.z);return new ui([p.canonical.x*y+p.wrap*_,p.canonical.y*y+p.wrap*_,0],[(p.canonical.x+1)*y+p.wrap*_,(p.canonical.y+1)*y+p.wrap*_,m])}(t,r,a).getCorners(),d=r/-l[2];l[0]<0?(q.add(u[0],u[0],[l[0]*d,0,0]),q.add(u[3],u[3],[l[0]*d,0,0])):l[0]>0&&(q.add(u[1],u[1],[l[0]*d,0,0]),q.add(u[2],u[2],[l[0]*d,0,0])),l[1]<0?(q.add(u[0],u[0],[0,l[1]*d,0]),q.add(u[1],u[1],[0,l[1]*d,0])):l[1]>0&&(q.add(u[2],u[2],[0,l[1]*d,0]),q.add(u[3],u[3],[0,l[1]*d,0]));const h={};return h.vertices=u,h.planes=[Ev(u[1],u[0],u[4]),Ev(u[2],u[1],u[5]),Ev(u[3],u[2],u[6]),Ev(u[0],u[3],u[7])],h}addShadowReceiver(t,r,a){this._receivers.add(t,ui.fromTileIdAndHeight(t,r,a))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function Ev(n,t,r){const a=q.sub([],r,t),l=q.sub([],n,t),u=q.cross([],a,l),d=q.length(u);return 0===d?[0,0,1,0]:(q.scale(u,u,1/d),[u[0],u[1],u[2],-q.dot(u,t)])}function Cv(n){const t=n.properties.get("direction"),r=te(t.x,t.y,t.z);r[2]=Jt(r[2],0,75);const a=qt([r[0],r[1],r[2]]);return q.fromValues(a.x,a.y,a.z)}function q1(n,t){const r=n.properties.get("color"),a=n.properties.get("intensity"),l=n.properties.get("direction"),u=[l.x,l.y,l.z],d=t.properties.get("color"),h=t.properties.get("intensity"),p=Math.max(q.dot([0,0,1],u),0),m=[0,0,0];q.scale(m,d.toArray01Linear().slice(0,3),h);const _=[0,0,0];return q.scale(_,r.toArray01Linear().slice(0,3),p*a),ni([m[0]>0?m[0]/(m[0]+_[0]):0,m[1]>0?m[1]/(m[1]+_[1]):0,m[2]>0?m[2]/(m[2]+_[2]):0])}function WT(n,t,r,a,l,u){const d=n.zoom,h=n.scale,p=n.worldSize,m=1/p,_=n.aspect,y=Math.sqrt(1+_*_)*Math.tan(.5*n.fovX),x=y*y,b=a-r,E=a+r;let C,S;x>b/E?(C=a,S=a*y):(C=.5*E*(1+x),S=.5*Math.sqrt(b*b+2*(a*a+r*r)*x+E*E*x*x));const M=n.projection.pixelsPerMeter(n.center.lat,p),D=n._camera.getCameraToWorldMercator(),R=[0,0,-C*m];q.transformMat4(R,R,D);let P=S*m;const I=n._edgeInsets;if(!(0===I.left&&0===I.top&&0===I.right&&0===I.bottom||I.left===I.right&&I.top===I.bottom)){const lt=n._camera.getWorldToCamera(n.worldSize,"meters"===n.projection.zAxisUnit?M:1),ht=n._camera.getCameraToClipPerspective(n._fov,n.width/n.height,r,a);ht[8]=2*-n.centerOffset.x/n.width,ht[9]=2*n.centerOffset.y/n.height;const mt=new Float64Array(16);rt.mul(mt,ht,lt);const vt=new Float64Array(16);rt.invert(vt,mt);const ct=Vl.fromInvProjectionMatrix(vt,p,d,!0);for(const ft of ct.points){const Rt=((O=ft)[0]/=h,O[1]/=h,O[2]=Nn(O[2],n._center.lat),O);P=Math.max(P,q.len(q.subtract([],R,Rt)))}}var O;P*=l/(l-1);const F=Math.acos(t[2]),L=Math.atan2(-t[0],-t[1]),N=new Cn;N.position=R,N.setPitchBearing(F,L);const z=N.getWorldToCamera(p,M),U=P*p,V=Math.min(n._mercatorZfromZoom(17)*p*-2,-2*U),G=N.getCameraToClipOrthographic(-U,U,-U,U,V,(U+u*M)/t[2]),j=new Float64Array(16);rt.multiply(j,G,z);const Z=q.fromValues(Math.floor(1e6*R[0])/1e6*p,Math.floor(1e6*R[1])/1e6*p,0),et=.5*l,it=[0,0,0];q.transformMat4(it,Z,j),q.scale(it,it,et);const X=[Math.floor(it[0]),Math.floor(it[1]),Math.floor(it[2])],Y=[0,0,0];q.sub(Y,it,X),q.scale(Y,Y,-1/et);const ot=new Float64Array(16);return rt.identity(ot),rt.translate(ot,ot,Y),rt.multiply(j,ot,j),[j,U]}class sP extends $i{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,r){return f1(this.requestManager.transformRequest(r,gt.Model).url).then(a=>{if(!a)return;const l=oT(a),u=new Hb(t,void 0,void 0,l);return u.computeBoundsAndApplyParent(),u}).catch(a=>{this.fire(new at(new Error(`Could not load model ${t} from ${r}: ${a.message}`)))})}load(t,r){this.models[r]||(this.models[r]={});const a=Object.keys(t);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+a.length;const l=[];for(const u of a)l.push(this.loadModel(u,t[u]));Promise.allSettled(l).then(u=>{for(let d=0;d<u.length;d++){const{status:h,value:p}=u[d];"fulfilled"===h&&p&&(this.models[r][a[d]]=p)}this.numModelsLoading[r]-=a.length,this.fire(new St("data",{dataType:"style"}))}).catch(u=>{this.fire(new at(new Error(`Could not load models: ${u.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r){return!!this.getModel(t,r)}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]}addModel(t,r,a){this.models[a]||(this.models[a]={}),this.hasModel(t,a)&&this.removeModel(t,a),this.load({[t]:this.requestManager.normalizeModelURL(r)},a)}addModels(t,r){const a={};for(const l in t)a[l]=this.requestManager.normalizeModelURL(t[l]);this.load(a,r)}removeModel(t,r){this.models[r]||(this.models[r]={});const a=this.models[r][t];delete this.models[r][t],a.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const a in this.models[r])this.models[r][a].upload(t.context)}}const mg=(n,t)=>w_(n,t&&t.filter(r=>"source.canvas"!==r.identifier)),aP=ns(xn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),W1=ns(xn,["setCenter","setZoom","setBearing","setPitch"]),Z1={version:8,layers:[],sources:{}},ZT={duration:300,delay:0},Mv=new Set(["fill","line","background","hillshade","raster"]);class ta extends $i{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=Yt({},ZT),this._buildingIndex=new pR(this),this.crossTileSymbolIndex=new Wi,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new JE,this.dispatcher=r.dispatcher?r.dispatcher:new Km(If(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new eR,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new Id(t._requestManager,r.localFontFamily?2:r.localIdeographFontFamily?1:0,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new sP(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",Tt());const a=this;this._rtlTextPluginCallback=ta.registerForPluginStateChange(l=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:l.pluginStatus,pluginURL:l.pluginURL},(u,d)=>{if(fo(u),d&&d.every(h=>h))for(const h in a._sourceCaches){const p=a._sourceCaches[h],m=p.getSource().type;"vector"!==m&&"geojson"!==m||p.reload()}})}),this.on("data",l=>{if("source"!==l.dataType||"metadata"!==l.sourceDataType)return;const u=this.getOwnSource(l.sourceId);if(u&&u.vectorLayerIds)for(const d in this._layers){const h=this._layers[d];h.source===u.id&&this._validateLayer(h)}})}loadURL(t,r={}){this.fire(new St("dataloading",{dataType:"style"}));const a="boolean"==typeof r.validate?r.validate:!In(t);t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const l=this.importsCache.get(t);if(l)return this._load(l,a);const u=this.map._requestManager.transformRequest(t,gt.Style);this._request=At(u,(d,h)=>{if(this._request=null,d)this.fire(new at(d));else if(h)return this.importsCache.set(t,h),this._load(h,a)})}loadJSON(t,r={}){this.fire(new St("dataloading",{dataType:"style"})),this._request=kt.frame(()=>{this._request=null,this._load(t,!1!==r.validate)})}loadEmpty(){this.fire(new St("dataloading",{dataType:"style"})),this._load(Z1,!1)}_loadImports(t,r){if(this.importDepth>=4)return tt("Style doesn't support nesting deeper than 5"),this._reloadImports();const a=[];for(const l of t){const u=this._createFragmentStyle(l),d=new Promise(p=>u.on("style.import.load",p));if(a.push(d),this.resolvedImports.has(l.url)){u.loadEmpty();continue}const h=l.data||this.importsCache.get(l.url);h?u.loadJSON(h,{validate:r}):l.url?u.loadURL(l.url,{validate:r}):u.loadEmpty(),this.fragments.push({style:u,id:l.id,config:l.config})}Promise.all(a).then(()=>this._reloadImports())}_createFragmentStyle(t){const r=this.scope?Jr(t.id,this.scope):t.id,a=new ta(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return a.setEventedParent(this.map,{style:a}),a.setConfig(t.config),a}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new St("data",{dataType:"style"})),this.fire(new St(t?"style.load":"style.import.load"))}_load(t,r){const a=t.schema;if(this.isRootStyle()&&(t.fragment||a&&!1!==t.fragment)){const d=Yt({},Z1,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(d,r)}if(this.updateSchema(a),r&&mg(this,as(t)))return;this._loaded=!0,this.stylesheet=H(t);for(const d in t.sources)this.addSource(d,t.sources[d],{validate:!1});this._changes.changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const l=gR(this.stylesheet.layers);if(this._order=l.map(d=>d.id),this.stylesheet.light&&tt("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const d=this.stylesheet.lights[0];this.light=new US(d.properties,d.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new US(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const d of l){const h=ev(d,this.options);h.setScope(this.scope),h.isConfigDependent&&this._configDependentLayers.add(h.fqid),h.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=h,this._layers[h.id]=h,this._serializedLayers[h.id]=h.serialize();const p=this.getOwnLayerSourceCache(h),m=!!this.directionalLight&&this.directionalLight.shadowsEnabled();p&&h.canCastShadows()&&m&&(p.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const u=this.stylesheet.terrain;if(u&&!this.terrainSetForDrapingOnly()&&this._createTerrain(u,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new St("data",{dataType:"style"})),t.imports)this._loadImports(t.imports,r);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const d=this.isRootStyle();this._shouldPrecompile=d,this.fire(new St(d?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,r,a,l,u,d,h,p;this.forEachFragmentStyle(m=>{if(m.stylesheet){if(null!=m.light&&(t=m.light),m.stylesheet.lights)for(const _ of m.stylesheet.lights)"ambient"===_.type&&null!=m.ambientLight&&(r=m.ambientLight),"directional"===_.type&&null!=m.directionalLight&&(a=m.directionalLight);(m.stylesheet.terrain||m.stylesheet.projection&&"globe"===m.stylesheet.projection.name)&&null!=m.terrain&&(!l||l&&0===l.drapeRenderMode||1===m.terrain.drapeRenderMode)&&(l=m.terrain),m.stylesheet.fog&&null!=m.fog&&(u=m.fog),null!=m.stylesheet.camera&&(p=m.stylesheet.camera),null!=m.stylesheet.projection&&(d=m.stylesheet.projection),null!=m.stylesheet.transition&&(h=m.stylesheet.transition)}}),this.light=t,this.ambientLight=r,this.directionalLight=a,this.terrain=l,this.fog=u,this.camera=p||{"camera-projection":"perspective"},this.projection=d||{name:"mercator"},this.transition=Yt({},ZT,h),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=a=>{for(const l of a.fragments)r(l.style);t(a)};r(this)}mergeTerrain(){let t;this.forEachFragmentStyle(r=>{null!=r.terrain&&(!t||t&&0===t.drapeRenderMode||1===r.terrain.drapeRenderMode)&&(t=r.terrain)}),this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{null!=r.stylesheet.projection&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},a={};this.forEachFragmentStyle(l=>{for(const u in l._sourceCaches){const d=Jr(u,l.scope);t[d]=l._sourceCaches[u]}for(const u in l._otherSourceCaches){const d=Jr(u,l.scope);r[d]=l._otherSourceCaches[u]}for(const u in l._symbolSourceCaches){const d=Jr(u,l.scope);a[d]=l._symbolSourceCaches[u]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=a}mergeLayers(){const t={},r=[],a={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(u=>{for(const d of u._order){const h=u._layers[d];if("slot"===h.type){const p=T_(d);if(t[p])continue;t[p]=[]}h.slot&&t[h.slot]?t[h.slot].push(h):r.push(h)}}),this._mergedOrder=[];const l=(u=[])=>{for(const d of u)if("slot"===d.type){const h=T_(d.id);t[h]&&l(t[h])}else{const h=Jr(d.id,d.scope);this._mergedOrder.push(h),a[h]=d,d.is3D()&&(this._has3DLayers=!0),"circle"===d.type&&(this._hasCircleLayers=!0),"symbol"===d.type&&(this._hasSymbolLayers=!0)}};l(r),this._mergedLayers=a,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Yt({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,a,l){let u,d,h;const p=kt.devicePixelRatio>1?"@2x":"";let m=At(a.transformRequest(a.normalizeSpriteURL(r,p,".json"),gt.SpriteJSON),(x,b)=>{m=null,h||(h=x,u=b,y())}),_=Oe(a.transformRequest(a.normalizeSpriteURL(r,p,".png"),gt.SpriteImage),(x,b)=>{_=null,h||(h=x,d=b,y())});function y(){if(h)l(h);else if(u&&d){const x=kt.getImageData(d),b={};for(const E in u){const{width:C,height:S,x:M,y:D,sdf:R,pixelRatio:P,stretchX:I,stretchY:O,content:F}=u[E],L=new Pi({width:C,height:S});Pi.copy(x,L,{x:M,y:D},{x:0,y:0},{width:C,height:S}),b[E]={data:L,pixelRatio:P,sdf:R,stretchX:I,stretchY:O,content:F}}l(null,b)}}return{cancel(){m&&(m.cancel(),m=null),_&&(_.cancel(),_=null)}}}(t,this.map._requestManager,(r,a)=>{if(this._spriteRequest=null,r)this.fire(new at(r));else if(a)for(const l in a)this.imageManager.addImage(l,this.scope,a[l]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new St("data",{dataType:"style"}))})}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const a=t.sourceLayer;a&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(a))&&this.fire(new at(new Error(`Source layer "${a}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const a=this.fragments[r];return a&&a.style&&(t.data=a.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const a=this._sourceCaches[r].getSource();t[a.id]||(t[a.id]=a.serialize())}return t}_serializeLayers(t){const r=[];for(const a of t){const l=this._layers[a];l&&"custom"!==l.type&&r.push(l.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped(this.getLayerSourceCache(t)):Mv.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new at(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new at(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const a=this._changes.changed;if(this._changes.changed){const u=this._changes.getLayerUpdatesByScope();for(const d in u){const{updatedIds:h,removedIds:p}=u[d];(h||p)&&this._updateWorkerLayers(d,h,p)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const l={};for(const u in this._mergedSourceCaches){const d=this._mergedSourceCaches[u];l[u]=d.used,d.used=!1}for(const u of this._mergedOrder){const d=this._mergedLayers[u];if(d.recalculate(t,this._availableImages),!d.isHidden(t.zoom)){const h=this.getOwnLayerSourceCache(d);h&&(h.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let h=d.minzoom||0;h<(d.maxzoom||25.5);h++){const p=this.map.painter;if(p){const m=d.getProgramIds();if(!m)continue;for(const _ of m){const y=d.getDefaultProgramParams(_,t.zoom);y&&(p.style=this,this.fog&&(p._fogVisible=!0,y.overrideFog=!0,p.getOrCreateProgram(_,y)),p._fogVisible=!1,y.overrideFog=!1,p.getOrCreateProgram(_,y),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(y.overrideRtt=!0,p.getOrCreateProgram(_,y)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const u in l){const d=this._mergedSourceCaches[u];l[u]!==d.used&&d.getSource().fire(new St("data",{sourceDataType:"visibility",dataType:"source",sourceId:d.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new St("data",{dataType:"style"}));for(const{style:u}of this.fragments)u.update(t)}_updateTilesForChangedImages(){const t=Array.from(this._changes.changedImages.keys());if(t.length){for(const r in this._sourceCaches)this._sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changes.changedImages.clear()}}_updateWorkerLayers(t,r,a){const l=this.getFragmentStyle(t);this.dispatcher.broadcast("updateLayers",{layers:r?l._serializeLayers(r):[],scope:t,removedIds:a||[],options:l.options})}setState(t){if(this._checkLoaded(),mg(this,as(t)))return!1;(t=H(t)).layers=gR(t.layers);const r=function(l,u){if(!l)return[{command:xn.setStyle,args:[u]}];let d=[];try{if(!cn(l.version,u.version))return[{command:xn.setStyle,args:[u]}];cn(l.center,u.center)||d.push({command:xn.setCenter,args:[u.center]}),cn(l.zoom,u.zoom)||d.push({command:xn.setZoom,args:[u.zoom]}),cn(l.bearing,u.bearing)||d.push({command:xn.setBearing,args:[u.bearing]}),cn(l.pitch,u.pitch)||d.push({command:xn.setPitch,args:[u.pitch]}),cn(l.sprite,u.sprite)||d.push({command:xn.setSprite,args:[u.sprite]}),cn(l.glyphs,u.glyphs)||d.push({command:xn.setGlyphs,args:[u.glyphs]}),cn(l.transition,u.transition)||d.push({command:xn.setTransition,args:[u.transition]}),cn(l.light,u.light)||d.push({command:xn.setLight,args:[u.light]}),cn(l.fog,u.fog)||d.push({command:xn.setFog,args:[u.fog]}),cn(l.projection,u.projection)||d.push({command:xn.setProjection,args:[u.projection]}),cn(l.lights,u.lights)||d.push({command:xn.setLights,args:[u.lights]}),cn(l.camera,u.camera)||d.push({command:xn.setCamera,args:[u.camera]});const h={},p=[];!function(y,x,b,E){let C;for(C in x=x||{},y=y||{})y.hasOwnProperty(C)&&(x.hasOwnProperty(C)||uT(C,b,E));for(C in x){if(!x.hasOwnProperty(C))continue;const S=x[C];y.hasOwnProperty(C)?cn(y[C],S)||("geojson"===y[C].type&&"geojson"===S.type&&og(y,x,C)?b.push({command:xn.setGeoJSONSourceData,args:[C,S.data]}):_R(C,x,b,E)):g1(C,x,b)}}(l.sources,u.sources,p,h);const m=[];l.layers&&l.layers.forEach(y=>{y.source&&h[y.source]?d.push({command:xn.removeLayer,args:[y.id]}):m.push(y)});let _=l.terrain;_&&h[_.source]&&(d.push({command:xn.setTerrain,args:[void 0]}),_=void 0),d=d.concat(p),cn(_,u.terrain)||d.push({command:xn.setTerrain,args:[u.terrain]}),function(y,x,b){x=x||[];const E=(y=y||[]).map(sg),C=x.map(sg),S=y.reduce(av,{}),M=x.reduce(av,{}),D=E.slice(),R=Object.create(null);let P,I,O,F,L,N,z;for(P=0,I=0;P<E.length;P++)O=E[P],M.hasOwnProperty(O)?I++:(b.push({command:xn.removeLayer,args:[O]}),D.splice(D.indexOf(O,I),1));for(P=0,I=0;P<C.length;P++)O=C[C.length-1-P],D[D.length-1-P]!==O&&(S.hasOwnProperty(O)?(b.push({command:xn.removeLayer,args:[O]}),D.splice(D.lastIndexOf(O,D.length-I),1)):I++,N=D[D.length-P],b.push({command:xn.addLayer,args:[M[O],N]}),D.splice(D.length-P,0,O),R[O]=!0);for(P=0;P<C.length;P++)if(O=C[P],F=S[O],L=M[O],!R[O]&&!cn(F,L))if(cn(F.source,L.source)&&cn(F["source-layer"],L["source-layer"])&&cn(F.type,L.type)){for(z in sv(F.layout,L.layout,b,O,null,xn.setLayoutProperty),sv(F.paint,L.paint,b,O,null,xn.setPaintProperty),cn(F.slot,L.slot)||b.push({command:xn.setSlot,args:[O,L.slot]}),cn(F.filter,L.filter)||b.push({command:xn.setFilter,args:[O,L.filter]}),cn(F.minzoom,L.minzoom)&&cn(F.maxzoom,L.maxzoom)||b.push({command:xn.setLayerZoomRange,args:[O,L.minzoom,L.maxzoom]}),F)F.hasOwnProperty(z)&&"layout"!==z&&"paint"!==z&&"filter"!==z&&"metadata"!==z&&"minzoom"!==z&&"maxzoom"!==z&&"slot"!==z&&(0===z.indexOf("paint.")?sv(F[z],L[z],b,O,z.slice(6),xn.setPaintProperty):cn(F[z],L[z])||b.push({command:xn.setLayerProperty,args:[O,z,L[z]]}));for(z in L)L.hasOwnProperty(z)&&!F.hasOwnProperty(z)&&"layout"!==z&&"paint"!==z&&"filter"!==z&&"metadata"!==z&&"minzoom"!==z&&"maxzoom"!==z&&"slot"!==z&&(0===z.indexOf("paint.")?sv(F[z],L[z],b,O,z.slice(6),xn.setPaintProperty):cn(F[z],L[z])||b.push({command:xn.setLayerProperty,args:[O,z,L[z]]}))}else b.push({command:xn.removeLayer,args:[O]}),N=D[D.lastIndexOf(O)+1],b.push({command:xn.addLayer,args:[L,N]})}(m,u.layers,d),function(y=[],x=[],b){x=x||[];const E=(y=y||[]).map(sg),C=x.map(sg),S=y.reduce(av,{}),M=x.reduce(av,{}),D=E.slice();let R,P,I,O;for(R=0,P=0;R<E.length;R++)I=E[R],M.hasOwnProperty(I)?P++:(b.push({command:xn.removeImport,args:[I]}),D.splice(D.indexOf(I,P),1));for(R=0,P=0;R<C.length;R++)I=C[C.length-1-R],D[D.length-1-R]!==I&&(S.hasOwnProperty(I)?(b.push({command:xn.removeImport,args:[I]}),D.splice(D.lastIndexOf(I,D.length-P),1)):P++,O=D[D.length-R],b.push({command:xn.addImport,args:[M[I],O]}),D.splice(D.length-R,0,I));for(const F of x){const L=S[F.id];if(!L||cn(L,F))continue;cn(L.config,F.config)||b.push({command:xn.setImportConfig,args:[F.id,F.config]}),cn(L.url,F.url)||b.push({command:xn.setImportUrl,args:[F.id,F.url]});const N=F.data;cn(L&&L.data,N)||b.push({command:xn.setImportData,args:[F.id,N]})}}(l.imports,u.imports,d)}catch(h){console.warn("Unable to compute style diff:",h),d=[{command:xn.setStyle,args:[u]}]}return d}(this.serialize(),t).filter(l=>!(l.command in W1));if(0===r.length)return!1;const a=r.filter(l=>!(l.command in aP));if(a.length>0)throw new Error(`Unimplemented: ${a.map(l=>l.command).join(", ")}.`);return r.forEach(l=>{this[l.command].apply(this,l.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,r){return this.getImage(t)?this.fire(new at(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,r),this._afterImageUpdated(t),this)}updateImage(t,r){this.imageManager.updateImage(t,this.scope,r)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new at(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(t),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new St("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,r,a={}){return this._checkLoaded(),this._validate(qs,`models.${t}`,r,null,a)||(this.modelManager.addModel(t,r,this.scope),this._changes.changed=!0),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new at(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,a={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(WE,`sources.${t}`,r,null,a))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const l=m1(t,r,this.dispatcher,this);l.scope=this.scope,l.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l.id),source:l.serialize(),sourceId:l.id}));const u=d=>{const h=(d?"symbol:":"other:")+l.id,p=Jr(h,this.scope),m=this._sourceCaches[h]=new Rs(p,l,d);(d?this._symbolSourceCaches:this._otherSourceCaches)[l.id]=m,m.onAdd(this.map)};u(!1),"vector"!==r.type&&"geojson"!==r.type||u(!0),l.onAdd&&l.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new at(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new at(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const a=this.getOwnSourceCaches(t);for(const l of a){const u=T_(l.id);delete this._sourceCaches[u],delete this._changes.updatedSourceCaches[l.id],l.fire(new St("data",{sourceDataType:"metadata",dataType:"source",sourceId:l.getSource().id})),l.setEventedParent(null),l.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.changed=!0}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const a=this.getOwnSourceCache(r);a&&t.push(a.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const l of t){if(this._validate(Ki,"lights",l))return;switch(l.type){case"ambient":if(this.ambientLight){const u=this.ambientLight;u.set(l),u.updateTransitions(r)}else this.ambientLight=new Pu(l,oR,this.scope,this.options);break;case"directional":if(this.directionalLight){const u=this.directionalLight;u.set(l),u.updateTransitions(r)}else this.directionalLight=new Pu(l,sR,this.scope,this.options)}}const a=new Ei(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const a=y=>.2126*(y[0]<=.03928?y[0]/12.92:Math.pow((y[0]+.055)/1.055,2.4))+.7152*(y[1]<=.03928?y[1]/12.92:Math.pow((y[1]+.055)/1.055,2.4))+.0722*(y[2]<=.03928?y[2]/12.92:Math.pow((y[2]+.055)/1.055,2.4)),l=t.properties.get("color").toArray01(),u=t.properties.get("intensity"),d=t.properties.get("direction"),h=1-te(d.x,d.y,d.z)[2]/90,p=a(l)*u*h,m=r.properties.get("color").toArray01(),_=r.properties.get("intensity");return(p+a(m)*_)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;const r=this.fragments.find(({id:a})=>a===t);if(!r)throw new Error(`Style import not found: ${t}`);return r.style}setConfigProperty(t,r,a){const l=mc(a);if("success"!==l.result)return void mg(this,l.value);const u=l.value.expression,d=this.getFragmentStyle(t);d.options.set(r,u),d.updateConfigDependencies()}setConfig(t,r){if(this.options.clear(),t){for(const a in t){const l=mc(t[a]);"success"===l.result&&this.options.set(a,l.value.expression)}this.updateSchema(r)}}updateSchema(t){if(t)for(const r in t){if(this.options.has(r))continue;const a=mc(t[r].default);"success"===a.result&&this.options.set(r,a.value.expression)}}updateConfigDependencies(){for(const t of this._configDependentLayers){const r=this.getLayer(t);r&&(r.possiblyEvaluateVisibility(),this._updateLayer(r))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(t,r,a={}){this._checkLoaded();const l=t.id;if(this._layers[l])return void this.fire(new at(new Error(`Layer with id "${l}" already exists on this map`)));let u;if("custom"===t.type){if(mg(this,function(_){const y=[],x=_.id;return void 0===x&&y.push({message:`layers.${x}: missing required property "id"`}),void 0===_.render&&y.push({message:`layers.${x}: missing required method "render"`}),_.renderingMode&&"2d"!==_.renderingMode&&"3d"!==_.renderingMode&&y.push({message:`layers.${x}: property "renderingMode" must be either "2d" or "3d"`}),y}(t)))return;u=ev(t,this.options)}else{if("object"==typeof t.source&&(this.addSource(l,t.source),t=Yt(t=H(t),{source:l})),this._validate(xs,`layers.${l}`,t,{arrayIndex:-1},a))return;u=ev(t,this.options),this._validateLayer(u),u.setEventedParent(this,{layer:{id:l}}),this._serializedLayers[u.id]=u.serialize()}u.isConfigDependent&&this._configDependentLayers.add(u.fqid),u.setScope(this.scope);const d=r?this._order.indexOf(r):this._order.length;if(r&&-1===d)return void this.fire(new at(new Error(`Layer with id "${r}" does not exist on this map.`)));this._order.splice(d,0,l),this._layerOrderChanged=!0,this._layers[l]=u;const h=this.getOwnLayerSourceCache(u),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();h&&u.canCastShadows()&&p&&(h.castsShadows=!0);const m=this._changes.getRemovedLayer(u);if(m&&u.source&&h&&"custom"!==u.type){this._changes.discardLayerRemoval(u);const _=Jr(u.source,u.scope);m.type!==u.type?this._changes.updatedSourceCaches[_]="clear":(this._changes.updatedSourceCaches[_]="reload",h.pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map),u.scope=this.scope,this.mergeLayers()}moveLayer(t,r){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(t)||t===r)return;const a=this._order.indexOf(t);this._order.splice(a,1);const l=r?this._order.indexOf(r):this._order.length;r&&-1===l?this.fire(new at(new Error(`Layer with id "${r}" does not exist on this map.`))):(this._order.splice(l,0,t),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const l=this.getOwnLayerSourceCache(r);if(l&&l.castsShadows){let u=!1;for(const d in this._layers)if(this._layers[d].source===r.source&&this._layers[d].canCastShadows()){u=!0;break}l.castsShadows=u}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,a){this._checkLoaded();const l=this._checkLayer(t);l&&(l.minzoom===r&&l.maxzoom===a||(null!=r&&(l.minzoom=r),null!=a&&(l.maxzoom=a),this._updateLayer(l)))}setSlot(t,r){this._checkLoaded();const a=this._checkLayer(t);a&&a.slot!==r&&(a.slot=r,this._updateLayer(a))}setFilter(t,r,a={}){this._checkLoaded();const l=this._checkLayer(t);if(l&&!cn(l.filter,r))return null==r?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(U0,`layers.${l.id}.filter`,r,{layerType:l.type},a)||(l.filter=H(r),this._updateLayer(l)))}getFilter(t){const r=this._checkLayer(t);if(r)return H(r.filter)}setLayoutProperty(t,r,a,l={}){this._checkLoaded();const u=this._checkLayer(t);u&&(cn(u.getLayoutProperty(r),a)||(u.setLayoutProperty(r,a,l),u.isConfigDependent&&this._configDependentLayers.add(u.fqid),this._updateLayer(u)))}getLayoutProperty(t,r){const a=this._checkLayer(t);if(a)return a.getLayoutProperty(r)}setPaintProperty(t,r,a,l={}){this._checkLoaded();const u=this._checkLayer(t);if(!u||cn(u.getPaintProperty(r),a))return;const d=u.setPaintProperty(r,a,l);u.isConfigDependent&&this._configDependentLayers.add(u.fqid),d&&this._updateLayer(u),this._changes.changed=!0,this._changes.updatedPaintProps.add(u.fqid)}getPaintProperty(t,r){const a=this._checkLayer(t);if(a)return a.getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const a=t.source,l=t.sourceLayer,u=this._checkSource(a);if(!u)return;const d=u.type;if("geojson"===d&&l)return void this.fire(new at(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===d&&!l)return void this.fire(new at(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new at(new Error("The feature id parameter must be provided.")));const h=this.getOwnSourceCaches(a);for(const p of h)p.setFeatureState(l,t.id,r)}removeFeatureState(t,r){this._checkLoaded();const a=t.source,l=this._checkSource(a);if(!l)return;const u=l.type,d="vector"===u?t.sourceLayer:void 0;if("vector"===u&&!d)return void this.fire(new at(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new at(new Error("A feature id is required to remove its specific state property.")));const h=this.getOwnSourceCaches(a);for(const p of h)p.removeFeatureState(d,t.id,r)}getFeatureState(t){this._checkLoaded();const r=t.source,a=t.sourceLayer,l=this._checkSource(r);if(l){if("vector"!==l.type||a)return void 0===t.id&&this.fire(new at(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(a,t.id);this.fire(new at(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Yt({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Yt({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:void 0;return Pt({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},a=>void 0!==a)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),a=Jr(t.source,t.scope);t.source&&!this._changes.updatedSourceCaches[a]&&r&&"raster"!==r.getSource().type&&(this._changes.updatedSourceCaches[a]="reload",r.pause()),this._changes.changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=h=>"fill-extrusion"===this._mergedLayers[h].type,a=this.order,l={},u=[];for(let h=a.length-1;h>=0;h--){const p=a[h];if(r(p)){l[p]=h;for(const m of t){const _=m[p];if(_)for(const y of _)u.push(y)}}}u.sort((h,p)=>p.intersectionZ-h.intersectionZ);const d=[];for(let h=a.length-1;h>=0;h--){const p=a[h];if(r(p))for(let m=u.length-1;m>=0;m--){const _=u[m].feature;if(l[_.layer.id]<h)break;d.push(_),u.pop()}else for(const m of t){const _=m[p];if(_)for(const y of _)d.push(y.feature)}}return d}queryRenderedFeatures(t,r,a){r&&r.filter&&this._validate(U0,"queryRenderedFeatures.filter",r.filter,null,r),r.scope=this.scope,r.availableImages=this._availableImages,r.serializedLayers=this._serializedLayers;const l={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new at(new Error("parameters.layers must be an Array."))),[];for(const m of r.layers){const _=this._mergedLayers[m];if(!_)return this.fire(new at(new Error(`The layer '${m}' does not exist in the map's style and cannot be queried for features.`))),[];l[_.source]=!0}}const u=[],d=r.serializedLayers||{},h=r&&r.layers?r.layers.some(m=>{const _=this.getLayer(m);return _&&_.is3D()}):this.has3DLayers(),p=Ou.createFromScreenPoints(t,a);for(const m in this._mergedSourceCaches){const _=this._mergedSourceCaches[m].getSource();if(!_||_.scope!==r.scope)continue;const y=this._mergedSourceCaches[m].getSource().id;r.layers&&!l[y]||u.push(aT(this._mergedSourceCaches[m],this._mergedLayers,d,p,r,a,h,!!this.map._showQueryGeometry))}return this.placement&&u.push(function(m,_,y,x,b,E,C){const S={},M=E.queryRenderedSymbols(x),D=[];for(const R of Object.keys(M).map(Number))D.push(C[R]);D.sort(lT);for(const R of D){const P=R.featureIndex.lookupSymbolFeatures(M[R.bucketInstanceId],_,R.bucketIndex,R.sourceLayerIndex,b.filter,b.layers,b.availableImages,m);for(const I in P){const O=S[I]=S[I]||[],F=P[I];F.sort((L,N)=>{const z=R.featureSortOrder;if(z){const U=z.indexOf(L.featureIndex);return z.indexOf(N.featureIndex)-U}return N.featureIndex-L.featureIndex});for(const L of F)O.push(L)}}for(const R in S)S[R].forEach(P=>{const I=P.feature,O=y(m[R]);if(!O)return;const F=O.getFeatureState(I.layer["source-layer"],I.id);I.source=I.layer.source,I.layer["source-layer"]&&(I.sourceLayer=I.layer["source-layer"]),I.state=F});return S}(this._mergedLayers,d,this.getLayerSourceCache.bind(this),p.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(t,r){r&&r.filter&&this._validate(U0,"querySourceFeatures.filter",r.filter,null,r);const a=this.getOwnSourceCaches(t);let l=[];for(const u of a)l=l.concat(rg(u,r));return l}addSourceType(t,r,a){return ta.getSourceType(t)?a(new Error(`A source type called "${t}" already exists.`)):(ta.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},a):a(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,a={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const h in t)if(!cn(t[h],l[h])){u=!0;break}if(!u)return;const d=this._getTransitionParameters();this.light.setLight(t,r,a),this.light.updateTransitions(d)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,r=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let a=t;if(1===r){if("object"==typeof a.source){const l="terrain-dem-src";this.addSource(l,a.source),a=H(a),a=Yt(a,{source:l})}if(this._validate(j0,"terrain",a))return}if(!this.terrain||this.terrain&&r!==this.terrain.drapeRenderMode){if(!a)return;this._createTerrain(a,r),this.fire(new St("data",{dataType:"style"}))}else{const l=this.terrain,u=l.get();for(const d of Object.keys(J.terrain))!a.hasOwnProperty(d)&&J.terrain[d].default&&(a[d]=J.terrain[d].default);for(const d in t)if(!cn(t[d],u[d])){l.set(t),this.stylesheet.terrain=t;const h=this._getTransitionParameters({duration:0});l.updateTransitions(h),this.fire(new St("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new qS(t,this.map.transform);this.stylesheet.fog=r.get();const a=this._getTransitionParameters({duration:0});r.updateTransitions(a)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!cn(r.get(),t)){r.set(t),this.stylesheet.fog=r.get();const a=this._getTransitionParameters({duration:0});r.updateTransitions(a)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:kt.now(),transition:Yt(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const a in this._mergedLayers)this.isLayerDraped(this._mergedLayers[a])?t.push(a):r.push(a);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const a=this.terrain=new rR(t,r);a.setScope(this.scope),this.stylesheet.terrain=t,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const l=this._getTransitionParameters({duration:0});a.updateTransitions(l)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];"fill-extrusion"===r.type&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];"symbol"===r.type&&this._updateLayer(r)}}_validate(t,r,a,l,u={}){if(u&&!1===u.validate)return!1;const d=Yt({},this.serialize());return mg(this,t.call(as,Yt({key:r,style:d,value:a,styleSpec:J},l)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),ld.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const a of r)a.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const a of r)a.resume(),a.reload()}updateSources(t){let r;this.directionalLight&&(r=Cv(this.directionalLight));for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].update(t,void 0,void 0,r)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,a,l,u=!1){let d=!1,h=!1;const p={},m={};for(const _ of this._mergedOrder){const y=this._mergedLayers[_];if("symbol"!==y.type)continue;const x=Jr(y.source,y.scope);let b=p[x];if(!b){const C=this.getLayerSourceCache(y);if(!C)continue;const S=C.getRenderableIds(!0).map(M=>C.getTileByID(M));m[x]=S.slice(),b=p[x]=S.sort((M,D)=>D.tileID.overscaledZ-M.tileID.overscaledZ||(M.tileID.isLessThan(D.tileID)?-1:1))}const E=this.crossTileSymbolIndex.addLayer(y,b,t.center.lng,t.projection);d=d||E}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),u=u||this._layerOrderChanged||0===a,this._layerOrderChanged&&this.fire(new St("neworder")),(u||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(kt.now(),t.zoom))&&(this.pauseablePlacement=new DR(t,this._mergedOrder,u,r,a,l,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,p,m),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(kt.now()),h=!0),d&&this.pauseablePlacement.placement.setStale()),h||d)for(const _ of this._mergedOrder){const y=this._mergedLayers[_];"symbol"===y.type&&this.placement.updateLayerOpacities(y,p[Jr(y.source,y.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(kt.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const r=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==r.findIndex(({id:l})=>l===t.id)?this.fire(new at(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(r.push(t),this._loadImports([t],!0),this)}setImportUrl(t,r){this._checkLoaded();const a=this.stylesheet.imports||[],l=this.getImportIndex(t);if(-1===l)return this;a[l].url=r;const u=this.fragments[l];u.style=this._createFragmentStyle({id:t,url:r});const d=new Promise(h=>u.style.on("style.import.load",h));return u.style.loadURL(r),d.then(()=>this._reloadImports()),this}setImportData(t,r){this._checkLoaded();const a=this.getImportIndex(t),l=this.stylesheet.imports||[];return-1===a?this:r?(this.fragments[a].style.setState(r),this._reloadImports(),this):(delete l[a].data,this.setImportUrl(t,l[a].url))}setImportConfig(t,r){this._checkLoaded();const a=this.getImportIndex(t),l=this.stylesheet.imports||[];if(-1===a)return this;r?l[a].config=r:delete l[a].config;const u=this.fragments[a],d=u.style.stylesheet&&u.style.stylesheet.schema;return u.config=r,u.style.setConfig(r,d),u.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],a=this.getImportIndex(t);return-1===a||(r.splice(a,1),this.fragments[a].style._remove(),this.fragments.splice(a,1),this._reloadImports()),this}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(a=>a.id===t);return-1===r&&this.fire(new at(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const a=this._mergedOtherSourceCaches[r];a&&t.push(a.getSource())}return t}getSource(t,r){const a=this.getSourceCache(t,r);return a&&a.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const a=Jr(t,r);return this._mergedOtherSourceCaches[a]}getLayerSourceCache(t){const r=Jr(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){for(const t in this._changes.updatedSourceCaches){const r=this._changes.updatedSourceCaches[t];"reload"===r?this.reloadSource(t):"clear"===r&&this.clearSource(t)}}updateLayers(t){for(const r of this._changes.updatedPaintProps){const a=this.getLayer(r);a&&a.updateTransitions(t)}}getImages(t,r,a){this.imageManager.getImages(r.icons,r.scope,a),this._updateTilesForChangedImages();const l=u=>{u&&u.setDependencies(r.tileID.key,r.type,r.icons)};l(this._otherSourceCaches[r.source]),l(this._symbolSourceCaches[r.source])}getGlyphs(t,r,a){this.glyphManager.getGlyphs(r.stacks,r.scope,a)}getResource(t,r,a){return Ot(r,a)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return 0===r.length?(this.fire(new at(new Error(`There is no source with ID '${t}'`))),!1):r.every(a=>a.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function lP(n,t){let r=!1,a=null;const l=()=>{a=null,r&&(n(),a=setTimeout(l,t),r=!1)};return()=>(r=!0,a||l(),a)}ta.getSourceType=function(n){return Rf[n]},ta.setSourceType=function(n,t){Rf[n]=t},ta.registerForPluginStateChange=function(n){return n({pluginStatus:Wo,pluginURL:Al}),ld.on("pluginStateChange",n),n};class XT{constructor(t){this._hashName=t&&encodeURIComponent(t),Rr(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=lP(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,st.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),st.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=YT(t);if(this._hashName){const a=this._hashName;let l=!1;const u=st.location.hash.slice(1).split("&").map(d=>{const h=d.split("=")[0];return h===a?(l=!0,`${h}=${r}`):d}).filter(d=>d);return l||u.push(`${a}=${r}`),`#${u.join("&")}`}return`#${r}`}_getCurrentHash(){const t=st.location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(r=a)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(a=>isNaN(a))){const a=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:a,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=st.location.href.replace(/(#.+)?$/,this.getHashString());st.history.replaceState(st.history.state,null,t)}}function YT(n,t){const r=n.getCenter(),a=Math.round(100*n.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,l),d=Math.round(r.lng*u)/u,h=Math.round(r.lat*u)/u,p=n.getBearing(),m=n.getPitch();let _=t?`/${d}/${h}/${a}`:`${a}/${h}/${d}`;return(p||m)&&(_+="/"+Math.round(10*p)/10),m&&(_+=`/${Math.round(m)}`),_}const gg={linearity:.3,easing:Qc(0,0,.3,1)},jf=Yt({deceleration:2500,maxSpeed:1400},gg),cP=Yt({deceleration:20,maxSpeed:1400},gg),KT=Yt({deceleration:1e3,maxSpeed:360},gg),X1=Yt({deceleration:1e3,maxSpeed:90},gg);class tL{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:kt.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=kt.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new nt(0,0),pinchAround:void 0,around:void 0};for(const{settings:u}of this._inertiaBuffer)r.zoom+=u.zoomDelta||0,r.bearing+=u.bearingDelta||0,r.pitch+=u.pitchDelta||0,u.panDelta&&r.pan._add(u.panDelta),u.around&&(r.around=u.around),u.pinchAround&&(r.pinchAround=u.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(r.pan.mag()){const u=Y1(r.pan.mag(),a,Yt({},jf,t||{}));l.offset=r.pan.mult(u.amount/r.pan.mag()),l.center=this._map.transform.center,Sv(l,u)}if(r.zoom){const u=Y1(r.zoom,a,cP);l.zoom=this._map.transform.zoom+u.amount,Sv(l,u)}if(r.bearing){const u=Y1(r.bearing,a,KT);l.bearing=this._map.transform.bearing+Jt(u.amount,-179,179),Sv(l,u)}if(r.pitch){const u=Y1(r.pitch,a,X1);l.pitch=this._map.transform.pitch+u.amount,Sv(l,u)}if(l.zoom||l.bearing){const u=void 0===r.pinchAround?r.around:r.pinchAround;l.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),l.noMoveStart=!0,l}}function Sv(n,t){(!n.duration||n.duration<t.duration)&&(n.duration=t.duration,n.easing=t.easing)}function Y1(n,t,r){const{maxSpeed:a,linearity:l,deceleration:u}=r,d=Jt(n*l/(t/1e3),-a,a),h=Math.abs(d)/(u*l);return{easing:r.easing,duration:1e3*h,amount:d*(h/2)}}class ea extends St{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a,l={}){const u=cp(r.getCanvasContainer(),a);super(t,Yt({point:u,lngLat:r.unproject(u),originalEvent:a},l)),this._defaultPrevented=!1,this.target=r}}class Tv extends St{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a){const l="touchend"===t?a.changedTouches:a.touches,u=Ii(r.getCanvasContainer(),l),d=u.map(p=>r.unproject(p)),h=u.reduce((p,m,_,y)=>p.add(m.div(y.length)),new nt(0,0));super(t,{points:u,point:h,lngLats:d,lngLat:r.unproject(h),originalEvent:a}),this._defaultPrevented=!1}}class uP extends St{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class JT{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new uP(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new ea(t.type,this._map,t))}mouseup(t){this._map.fire(new ea(t.type,this._map,t))}preclick(t){const r=Yt({},t);r.type="preclick",this._map.fire(new ea(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ea(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ea(t.type,this._map,t))}mouseover(t){this._map.fire(new ea(t.type,this._map,t))}mouseout(t){this._map.fire(new ea(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Tv(t.type,this._map,t))}touchmove(t){this._map.fire(new Tv(t.type,this._map,t))}touchend(t){this._map.fire(new Tv(t.type,this._map,t))}touchcancel(t){this._map.fire(new Tv(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class QT{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new ea(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ea("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ea(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dP{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&0===t.button&&(wi(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const a=r,l=this._startPos,u=this._lastPos;if(!l||!u||u.equals(a)||!this._box&&a.dist(l)<this._clickTolerance)return;this._lastPos=a,this._box||(this._box=zn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const d=Math.min(l.x,a.x),h=Math.max(l.x,a.x),p=Math.min(l.y,a.y),m=Math.max(l.y,a.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${d}px,${p}px)`,this._box.style.width=h-d+"px",this._box.style.height=m-p+"px")})}mouseupWindow(t,r){if(!this._active)return;const a=this._startPos,l=r;if(a&&0===t.button){if(this.reset(),lp(),a.x!==l.x||a.y!==l.y)return this._map.fire(new St("boxzoomend",{originalEvent:t})),{cameraAnimation:u=>u.fitScreenCoordinates(a,l,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ap(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new St(t,{originalEvent:r}))}}function Dv(n,t){const r={};for(let a=0;a<n.length;a++)r[n[a].identifier]=t[a];return r}class tD{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const u=new nt(0,0);for(const d of l)u._add(d);return u.div(l.length)}(r),this.touches=Dv(a,r)))}touchmove(t,r,a){if(this.aborted||!this.centroid)return;const l=Dv(a,r);for(const u in this.touches){const d=l[u];(!d||d.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(t,r,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===a.length){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class K1{constructor(t){this.singleTap=new tD(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,a){this.singleTap.touchstart(t,r,a)}touchmove(t,r,a){this.singleTap.touchmove(t,r,a)}touchend(t,r,a){const l=this.singleTap.touchend(t,r,a);if(l){const u=t.timeStamp-this.lastTime<500,d=!this.lastTap||this.lastTap.dist(l)<30;if(u&&d||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class hP{constructor(){this._zoomIn=new K1({numTouches:1,numTaps:2}),this._zoomOut=new K1({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,a){this._zoomIn.touchstart(t,r,a),this._zoomOut.touchstart(t,r,a)}touchmove(t,r,a){this._zoomIn.touchmove(t,r,a),this._zoomOut.touchmove(t,r,a)}touchend(t,r,a){const l=this._zoomIn.touchend(t,r,a),u=this._zoomOut.touchend(t,r,a);return l?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:d.getZoom()+1,around:d.unproject(l)},{originalEvent:t})}):u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:d.getZoom()-1,around:d.unproject(u)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const eD={0:1,2:2};class J1{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const a=Qe(t);this._correctButton(t,a)&&(this._lastPoint=r,this._eventButton=a)}mousemoveWindow(t,r){const a=this._lastPoint;if(a)if(t.preventDefault(),null!=this._eventButton&&function(l,u){const d=eD[u];return void 0===l.buttons||(l.buttons&d)!==d}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(a,r)}mouseupWindow(t){this._lastPoint&&Qe(t)===this._eventButton&&(this._moved&&lp(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nD extends J1{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return 0===r&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class Q1 extends J1{_correctButton(t,r){return 0===r&&t.ctrlKey||2===r}_move(t,r){const a=.8*(r.x-t.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(t){t.preventDefault()}}class tw extends J1{_correctButton(t,r){return 0===r&&t.ctrlKey||2===r}_move(t,r){const a=-.5*(r.y-t.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(t){t.preventDefault()}}class iD{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),Rr(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new nt(0,0)}touchstart(t,r,a){return this._calculateTransform(t,r,a)}touchmove(t,r,a){if(this._active&&!(a.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===a.length&&!be())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,a)}}touchend(t,r,a){this._calculateTransform(t,r,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,a){a.length>0&&(this._active=!0);const l=Dv(a,r),u=new nt(0,0),d=new nt(0,0);let h=0;for(const m in l){const _=l[m],y=this._touches[m];y&&(u._add(_),d._add(_.sub(y)),h++,l[m]=_)}if(this._touches=l,h<this._minTouches||!d.mag())return;const p=d.div(h);return this._sum._add(p),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(h),panDelta:p}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=zn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ew{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,a){return{}}touchstart(t,r,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,a){const l=this._firstTwoTouches;if(!l)return;t.preventDefault();const[u,d]=l,h=Iv(a,r,u),p=Iv(a,r,d);if(!h||!p)return;const m=this._aroundCenter?null:h.add(p).div(2);return this._move([h,p],m,t)}touchend(t,r,a){if(!this._firstTwoTouches)return;const[l,u]=this._firstTwoTouches,d=Iv(a,r,l),h=Iv(a,r,u);d&&h||(this._active&&lp(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Iv(n,t,r){for(let a=0;a<n.length;a++)if(n[a].identifier===r)return t[a]}function fP(n,t){return Math.log(n/t)/Math.LN2}class rD extends ew{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(fP(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fP(this._distance,a),pinchAround:r}}}function pP(n,t){return 180*n.angleWith(t)/Math.PI}class eL extends ew{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const a=this._vector;if(this._vector=t[0].sub(t[1]),a&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:pP(this._vector,a),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,a=this._startVector;if(!a)return!1;const l=pP(t,a);return Math.abs(l)<r}}function oD(n){return Math.abs(n.y)>Math.abs(n.x)}class nL extends ew{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,oD(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,a){const l=this._lastPoints;if(!l)return;const u=t[0].sub(l[0]),d=t[1].sub(l[1]);return this._map._cooperativeGestures&&!be()&&a.touches.length<3||(this._valid=this.gestureBeginsVertically(u,d,a.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+d.y)/2*-.5})}gestureBeginsVertically(t,r,a){if(void 0!==this._valid)return this._valid;const l=t.mag()>=2,u=r.mag()>=2;if(!l&&!u)return;if(!l||!u)return null==this._firstMove&&(this._firstMove=a),a-this._firstMove<100&&void 0;const d=t.y>0==r.y>0;return oD(t)&&oD(r)&&d}}const iL={panStep:100,bearingStep:15,pitchStep:10};class rL{constructor(){const t=iL;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,a=0,l=0,u=0,d=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),u=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),u=1);break;case 38:t.shiftKey?l=1:(t.preventDefault(),d=-1);break;case 40:t.shiftKey?l=-1:(t.preventDefault(),d=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:h=>{const p=h.getZoom();h.easeTo({duration:300,easeId:"keyboardHandler",easing:oL,zoom:r?Math.round(p)+r*(t.shiftKey?2:1):p,bearing:h.getBearing()+a*this._bearingStep,pitch:h.getPitch()+l*this._pitchStep,offset:[-u*this._panStep,-d*this._panStep],center:h.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function oL(n){return n*(2-n)}const mP=4.000244140625;class sL{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Rr(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||be()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===st.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=kt.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,0!==r&&r%mP==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(l*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=cp(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const m="wheel"===this._type&&Math.abs(this._delta)>mP?this._wheelZoomRate:this._defaultZoomRate;let _=2/(1+Math.exp(-Math.abs(this._delta*m)));this._delta<0&&0!==_&&(_=1/_);const y=r(),x=Math.pow(2,y),b="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):x;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(b*_))),"wheel"===this._type&&(this._startZoom=y,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const a="number"==typeof this._targetZoom?this._targetZoom:r(),l=this._startZoom,u=this._easing;let d,h=!1;if("wheel"===this._type&&l&&u){const m=Math.min((kt.now()-this._lastWheelEventTime)/200,1);d=_e(l,a,u(m)),m<1?this._frameId||(this._frameId=!0):h=!0}else d=a,h=!0;this._active=!0,h&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let p=d-r();return p*this._lastDelta<0&&(p=0),{noInertia:!0,needsRenderFrame:!h,zoomDelta:p,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=$n;if(this._prevEase){const a=this._prevEase,l=(kt.now()-a.start)/a.duration,u=a.easing(l+.01)-a.easing(l),d=.27/Math.sqrt(u*u+1e-4)*.01;r=Qc(d,Math.sqrt(.0729-d*d),.25,1)}return this._prevEase={start:kt.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=zn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(st.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class nw{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class iw{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:a.getZoom()+(t.shiftKey?-1:1),around:a.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sD{constructor(){this._tap=new K1({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,a){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=r[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(t,r,a))}touchmove(t,r,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=r[0],u=l.y-this._swipePoint.y;return this._swipePoint=l,t.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(t,r,a)}touchend(t,r,a){this._tapTime?this._swipePoint&&0===a.length&&this.reset():this._tap.touchend(t,r,a)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gP{constructor(t,r,a){this._el=t,this._mousePan=r,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zl{constructor(t,r,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _P{constructor(t,r,a,l){this._el=t,this._touchZoom=r,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const rw=n=>n.zoom||n.drag||n.pitch||n.rotate;class aL extends St{}class yP{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const a=q.sub([],r,t);this.radius=q.length(a[2]<0?q.div([],a,this.constants):[a[0],a[1],0])}projectRay(t){q.div(t,t,this.constants),q.normalize(t,t),q.mul(t,t,this.constants);const r=q.scale([],t,this.radius);if(r[2]>0){const a=q.scale([],[0,0,1],q.dot(r,[0,0,1])),l=q.scale([],q.normalize([],[r[0],r[1],0]),this.radius),u=q.add([],r,q.scale([],q.sub([],q.add([],l,a),r),2));r[0]=u[0],r[1]=u[1]}return r}}function Bd(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}class vP{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tL(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new yP,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),Rr(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[st.document,"mousemove",{capture:!0}],[st.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[st,"blur",void 0]];for(const[l,u,d]of this._listeners)l.addEventListener(u,l===st.document?this.handleWindowEvent:this.handleEvent,d)}destroy(){for(const[t,r,a]of this._listeners)t.removeEventListener(r,t===st.document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const r=this._map,a=r.getCanvasContainer();this._add("mapEvent",new JT(r,t));const l=r.boxZoom=new dP(r,t);this._add("boxZoom",l);const u=new hP,d=new iw;r.doubleClickZoom=new nw(d,u),this._add("tapZoom",u),this._add("clickZoom",d);const h=new sD;this._add("tapDragZoom",h);const p=r.touchPitch=new nL(r);this._add("touchPitch",p);const m=new Q1(t),_=new tw(t);r.dragRotate=new Zl(t,m,_),this._add("mouseRotate",m,["mousePitch"]),this._add("mousePitch",_,["mouseRotate"]);const y=new nD(t),x=new iD(r,t);r.dragPan=new gP(a,y,x),this._add("mousePan",y),this._add("touchPan",x,["touchZoom","touchRotate"]);const b=new eL,E=new rD;r.touchZoomRotate=new _P(a,E,b,h),this._add("touchRotate",b,["touchPan","touchZoom"]),this._add("touchZoom",E,["touchPan","touchRotate"]),this._add("blockableMapEvent",new QT(r));const C=r.scrollZoom=new sL(r,this);this._add("scrollZoom",C,["mousePan"]);const S=r.keyboard=new rL;this._add("keyboard",S);for(const M of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[M]&&r[M].enable(t[M])}_add(t,r,a){this._handlers.push({handlerName:t,handler:r,allowed:a}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!rw(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,a){for(const l in t)if(l!==a&&(!r||r.indexOf(l)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const a of t)this._el.contains(a.target)&&r.push(a);return r}handleEvent(t,r){this._updatingCamera=!0;const a="renderFrame"===t.type,l=a?void 0:t,u={needsRenderFrame:!1},d={},h={},p=t.touches?this._getMapTouches(t.touches):void 0,m=p?Ii(this._el,p):a?void 0:cp(this._el,t);for(const{handlerName:x,handler:b,allowed:E}of this._handlers){if(!b.isEnabled())continue;let C;this._blockedByActive(h,E,x)?b.reset():b[r||t.type]&&(C=b[r||t.type](t,m,p),this.mergeHandlerResult(u,d,C,x,l),C&&C.needsRenderFrame&&this._triggerRenderFrame()),(C||b.isActive())&&(h[x]=b)}const _={};for(const x in this._previousActiveHandlers)h[x]||(_[x]=l);this._previousActiveHandlers=h,(Object.keys(_).length||Bd(u))&&(this._changes.push([u,d,_]),this._triggerRenderFrame()),(Object.keys(h).length||Bd(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:y}=u;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}mergeHandlerResult(t,r,a,l,u){if(!a)return;Yt(t,a);const d={handlerName:l,originalEvent:a.originalEvent||u};void 0!==a.zoomDelta&&(r.zoom=d),void 0!==a.panDelta&&(r.drag=d),void 0!==a.pitchDelta&&(r.pitch=d),void 0!==a.bearingDelta&&(r.rotate=d)}_applyChanges(){const t={},r={},a={};for(const[l,u,d]of this._changes)l.panDelta&&(t.panDelta=(t.panDelta||new nt(0,0))._add(l.panDelta)),l.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+l.pitchDelta),void 0!==l.around&&(t.around=l.around),void 0!==l.aroundCoord&&(t.aroundCoord=l.aroundCoord),void 0!==l.pinchAround&&(t.pinchAround=l.pinchAround),l.noInertia&&(t.noInertia=l.noInertia),Yt(r,u),Yt(a,d);this._updateMapTransform(t,r,a),this._changes=[]}_updateMapTransform(t,r,a){const l=this._map,u=l.transform,d=D=>[D.x,D.y,D.z];if((D=>{const R=this._eventsInProgress.drag;return R&&!this._handlersById[R.handlerName].isActive()})()&&!Bd(t)){const D=u.zoom;u.cameraElevationReference="sea",null!=this._originalZoom&&u._orthographicProjectionAtLowPitch&&"globe"!==u.projection.name&&0===u.pitch?(u.cameraElevationReference="ground",u.zoom=this._originalZoom):(u.recenterOnTerrain(),u.cameraElevationReference="ground"),D!==u.zoom&&this._map._update(!0)}if(u._isCameraConstrained&&l._stop(!0),!Bd(t))return void this._fireEvents(r,a,!0);let{panDelta:h,zoomDelta:p,bearingDelta:m,pitchDelta:_,around:y,aroundCoord:x,pinchAround:b}=t;u._isCameraConstrained&&(p>0&&(p=0),u._isCameraConstrained=!1),void 0!==b&&(y=b),(p||(D=>r[D]&&!this._eventsInProgress[D])("drag"))&&y&&(this._dragOrigin=d(u.pointCoordinate3D(y)),this._originalZoom=u.zoom,this._trackingEllipsoid.setup(u._camera.position,this._dragOrigin)),u.cameraElevationReference="sea",l._stop(!0),y=y||l.transform.centerPoint,m&&(u.bearing+=m),_&&(u.pitch+=_),u._updateCameraState();const E=[0,0,0];if(h)if("mercator"===u.projection.name){const D=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(y).dir),R=this._trackingEllipsoid.projectRay(u.screenPointToMercatorRay(y.sub(h)).dir);E[0]=R[0]-D[0],E[1]=R[1]-D[1]}else{const D=u.pointCoordinate(y);if("globe"===u.projection.name){h=h.rotate(-u.angle);const R=u._pixelsPerMercatorPixel/u.worldSize;E[0]=-h.x*oy(lr(D.y))*R,E[1]=-h.y*oy(u.center.lat)*R}else{const R=u.pointCoordinate(y.sub(h));D&&R&&(E[0]=R.x-D.x,E[1]=R.y-D.y)}}const C=u.zoom,S=[0,0,0];if(p){const D=d(x||u.pointCoordinate3D(y)),R={dir:q.normalize([],q.sub([],D,u._camera.position))};if(R.dir[2]<0){const P=u.zoomDeltaToMovement(D,p);q.scale(S,R.dir,P)}}const M=q.add(E,E,S);u._translateCameraConstrained(M),p&&Math.abs(u.zoom-C)>1e-4&&u.recenterOnTerrain(),u.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,a,!0)}_fireEvents(t,r,a){const l=rw(this._eventsInProgress),u=rw(t),d={};for(const _ in t){const{originalEvent:y}=t[_];this._eventsInProgress[_]||(d[`${_}start`]=y),this._eventsInProgress[_]=t[_]}!l&&u&&this._fireEvent("movestart",u.originalEvent);for(const _ in d)this._fireEvent(_,d[_]);u&&this._fireEvent("move",u.originalEvent);for(const _ in t){const{originalEvent:y}=t[_];this._fireEvent(_,y)}const h={};let p;for(const _ in this._eventsInProgress){const{handlerName:y,originalEvent:x}=this._eventsInProgress[_];this._handlersById[y].isActive()||(delete this._eventsInProgress[_],p=r[y]||x,h[`${_}end`]=p)}for(const _ in h)this._fireEvent(_,h[_]);const m=rw(this._eventsInProgress);if(a&&(l||u)&&!m){this._updatingCamera=!0;const _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),y=x=>0!==x&&-this._bearingSnap<x&&x<this._bearingSnap;_?(y(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:p})):(this._map.fire(new St("moveend",{originalEvent:p})),y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new St(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new aL("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ow="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class xP extends $i{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,Rr(["_renderFrameCallback"],this)}getCenter(){return new we(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,a){return t=nt.convert(t).mult(-1),this.panTo(this.transform.center,Yt({offset:t},r),a)}panTo(t,r,a){return this.easeTo(Yt({center:t},r),a)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,a){return this.easeTo(Yt({zoom:t},r),a)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,a){return this.easeTo(Yt({bearing:t},r),a)}resetNorth(t,r){return this.rotateTo(0,Yt({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(Yt({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=Zs.convert(t);const a=r&&r.bearing||0,l=r&&r.pitch||0,u=t.getNorthWest(),d=t.getSouthEast();return this._cameraForBounds(this.transform,u,d,a,l,r)}_extendCameraOptions(t){const r={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=Yt({padding:r,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const a=t.padding;t.padding={top:a,bottom:a,right:a,left:a}}return t.padding=Yt(r,t.padding),t}_minimumAABBFrustumDistance(t,r){const a=r.max[0]-r.min[0],l=r.max[1]-r.min[1];return a/l>t.aspect?a/(2*Math.tan(.5*t.fovX)*t.aspect):l/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,a,l,u,d){const h=t.clone(),p=this._extendCameraOptions(d);h.bearing=l,h.pitch=u;const m=we.convert(r),_=we.convert(a),y=.5*(m.lat+_.lat),x=.5*(m.lng+_.lng),b=cs(y,x),E=q.normalize([],b),C=q.normalize([],q.cross([],E,[0,1,0])),S=q.cross([],C,E),M=[C[0],C[1],C[2],0,S[0],S[1],S[2],0,E[0],E[1],E[2],0,0,0,0,1],D=[b,cs(m.lat,m.lng),cs(_.lat,m.lng),cs(_.lat,_.lng),cs(m.lat,_.lng),cs(y,m.lng),cs(y,_.lng),cs(m.lat,x),cs(_.lat,x)];let R=ui.fromPoints(D.map(Y=>[q.dot(C,Y),q.dot(S,Y),q.dot(E,Y)]));const P=q.transformMat4([],R.center,M);0===q.squaredLength(P)&&q.set(P,0,0,1),q.normalize(P,P),q.scale(P,P,Po),h.center=function([Y,ot,lt]){const ht=Math.hypot(Y,ot,lt),mt=Math.atan2(Y,lt),vt=.5*Math.PI-Math.acos(-ot/ht);return new we(Cr(mt),Cr(vt))}(P);const I=h.getWorldToCameraMatrix(),O=rt.invert(new Float64Array(16),I);R=ui.applyTransform(R,rt.multiply([],I,M)),q.transformMat4(P,P,I);const F=.5*(R.max[2]-R.min[2]),L=this._minimumAABBFrustumDistance(h,R),N=q.scale([],[0,0,1],F),z=q.add(N,P,N),U=L+(0===h.pitch?0:q.distance(P,z)),V=h.globeCenterInViewSpace,G=q.sub([],P,[V[0],V[1],V[2]]);q.normalize(G,G),q.scale(G,G,U);const j=q.add([],P,G);q.transformMat4(j,j,O);const Z=wd/Po,et=q.length(j),it=Nn(Math.max(et*Z-wd,Number.EPSILON),0),X=Math.min(h.zoomFromMercatorZAdjusted(it),p.maxZoom);return X>.5*(Xp+_u)?(h.setProjection({name:"mercator"}),h.zoom=X,this._cameraForBounds(h,r,a,l,u,d)):{center:h.center,zoom:X,bearing:l,pitch:u}}queryTerrainElevation(t,r){const a=this.transform.elevation;return a?(r=Yt({},{exaggerated:!0},r),a.getAtPoint(Je.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,a,l,u,d){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,r,a,l,u,d);const h=t.clone(),p=this._extendCameraOptions(d),m=h.padding;h.bearing=l,h.pitch=u;const _=we.convert(r),y=we.convert(a),x=new we(_.lng,y.lat),b=new we(y.lng,_.lat),E=h.project(_),C=h.project(y),S=this.queryTerrainElevation(_),M=this.queryTerrainElevation(y),D=this.queryTerrainElevation(x),R=this.queryTerrainElevation(b),P=[[E.x,E.y,Math.min(S||0,M||0,D||0,R||0)],[C.x,C.y,Math.max(S||0,M||0,D||0,R||0)]];let I=ui.fromPoints(P);const O=h.getWorldToCameraMatrix(),F=rt.invert(new Float64Array(16),O);I=ui.applyTransform(I,O);const L=q.sub([],I.max,I.min),N=m.left||0,z=m.right||0,U=m.bottom||0,V=m.top||0,{left:G,right:j,top:Z,bottom:et}=p.padding,it=.5*(N+z),X=.5*(V+U),Y=Math.min(h.scaleZoom(h.scale*Math.min((h.width-(N+z+G+j))/L[0],(h.height-(U+V+et+Z))/L[1])),p.maxZoom),ot=h.scale/h.zoomScale(Y);I=new ui([I.min[0]-(G+it)*ot,I.min[1]-(et+X)*ot,I.min[2]],[I.max[0]+(j+it)*ot,I.max[1]+(Z+X)*ot,I.max[2]]);const lt=.5*L[2],ht=this._minimumAABBFrustumDistance(h,I),mt=[0,0,1,0];Ln.transformMat4(mt,mt,O),Ln.normalize(mt,mt);const vt=q.scale([],mt,ht+lt),ct=q.add([],I.center,vt),ft=("number"==typeof p.offset.x&&"number"==typeof p.offset.y?new nt(p.offset.x,p.offset.y):nt.convert(p.offset)).rotate(-Ie(l));I.center[0]-=ft.x*ot,I.center[1]+=ft.y*ot,q.transformMat4(I.center,I.center,F),q.transformMat4(ct,ct,F);const Rt=[I.center[0],I.center[1],ct[2]*h.pixelsPerMeter];q.scale(Rt,Rt,1/h.worldSize);const Vt=Ts(Rt[0]),jt=lr(Rt[1]),Ht=Math.min(h._zoomFromMercatorZ(Rt[2]),p.maxZoom),re=new we(Vt,jt);return h.mercatorFromTransition&&Ht<.5*(Xp+_u)?(h.setProjection({name:"globe"}),h.zoom=Ht,this._cameraForBounds(h,r,a,l,u,d)):{center:re,zoom:Ht,bearing:l,pitch:u}}fitBounds(t,r,a){const l=this.cameraForBounds(t,r);return this._fitInternal(l,r,a)}fitScreenCoordinates(t,r,a,l,u){const d=nt.convert(t),h=nt.convert(r),p=new nt(Math.min(d.x,h.x),Math.min(d.y,h.y)),m=new nt(Math.max(d.x,h.x),Math.max(d.y,h.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(d,h))return this;const _=this.transform.pointLocation3D(p),y=this.transform.pointLocation3D(m),x=this.transform.pointLocation3D(new nt(p.x,m.y)),b=this.transform.pointLocation3D(new nt(m.x,p.y)),E=[Math.min(_.lng,y.lng,x.lng,b.lng),Math.min(_.lat,y.lat,x.lat,b.lat)],C=[Math.max(_.lng,y.lng,x.lng,b.lng),Math.max(_.lat,y.lat,x.lat,b.lat)],S=l&&l.pitch?l.pitch:this.getPitch(),M=this._cameraForBounds(this.transform,E,C,a,S,l);return this._fitInternal(M,l,u)}_fitInternal(t,r,a){return t?(delete(r=Yt(t,r)).padding,r.linear?this.easeTo(r,a):this.flyTo(r,a)):this}jumpTo(t,r){this.stop();const a=t.preloadOnly?this.transform.clone():this.transform;let l=!1,u=!1,d=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(l=!0,a.zoom=+t.zoom),void 0!==t.center&&(a.center=we.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(u=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(d=!0,a.pitch=+t.pitch),null==t.padding||a.isPaddingEqual(t.padding)||(a.padding=t.padding),t.preloadOnly?(this._preloadTiles(a),this):(this.fire(new St("movestart",r)).fire(new St("move",r)),l&&this.fire(new St("zoomstart",r)).fire(new St("zoom",r)).fire(new St("zoomend",r)),u&&this.fire(new St("rotatestart",r)).fire(new St("rotate",r)).fire(new St("rotateend",r)),d&&this.fire(new St("pitchstart",r)).fire(new St("pitch",r)).fire(new St("pitchend",r)),this.fire(new St("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||tt(ow),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const a=this.transform;if(!a.projection.supportsFreeCamera)return tt(ow),this;this.stop();const l=a.zoom,u=a.pitch,d=a.bearing;a.setFreeCameraOptions(t);const h=l!==a.zoom,p=u!==a.pitch,m=d!==a.bearing;return this.fire(new St("movestart",r)).fire(new St("move",r)),h&&this.fire(new St("zoomstart",r)).fire(new St("zoom",r)).fire(new St("zoomend",r)),m&&this.fire(new St("rotatestart",r)).fire(new St("rotate",r)).fire(new St("rotateend",r)),p&&this.fire(new St("pitchstart",r)).fire(new St("pitch",r)).fire(new St("pitchend",r)),this.fire(new St("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),(!1===(t=Yt({offset:[0,0],duration:500,easing:$n},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const a=this.transform,l=this.getZoom(),u=this.getBearing(),d=this.getPitch(),h=this.getPadding(),p="zoom"in t?+t.zoom:l,m="bearing"in t?this._normalizeBearing(t.bearing,u):u,_="pitch"in t?+t.pitch:d,y="padding"in t?t.padding:a.padding,x=nt.convert(t.offset);let b,E,C;if("globe"===a.projection.name){const N=Je.fromLngLat(a.center),z=x.rotate(-a.angle);N.x+=z.x/a.worldSize,N.y+=z.y/a.worldSize;const U=N.toLngLat(),V=we.convert(t.center||U);this._normalizeCenter(V),b=a.centerPoint.add(z),E=new nt(N.x,N.y).mult(a.worldSize),C=new nt(no(V.lng),mo(V.lat)).mult(a.worldSize).sub(E)}else{b=a.centerPoint.add(x);const N=a.pointLocation(b),z=we.convert(t.center||N);this._normalizeCenter(z),E=a.project(N),C=a.project(z).sub(E)}const S=a.zoomScale(p-l);let M,D;t.around&&(M=we.convert(t.around),D=a.locationPoint(M));const R=this._zooming||p!==l,P=this._rotating||u!==m,I=this._pitching||_!==d,O=!a.isPaddingEqual(y),F=N=>z=>{if(R&&(N.zoom=_e(l,p,z)),P&&(N.bearing=_e(u,m,z)),I&&(N.pitch=_e(d,_,z)),O&&(N.interpolatePadding(h,y,z),b=N.centerPoint.add(x)),M)N.setLocationAtPoint(M,D);else{const U=N.zoomScale(N.zoom-l),V=p>l?Math.min(2,S):Math.max(.5,S),G=Math.pow(V,1-z),j=N.unproject(E.add(C.mult(z*G)).mult(U));N.setLocationAtPoint(N.renderWorldCopies?j.wrap():j,b)}return t.preloadOnly||this._fireMoveEvents(r),N};if(t.preloadOnly){const N=this._emulate(F,t.duration,a);return this._preloadTiles(N),this}const L={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=R,this._rotating=P,this._pitching=I,this._padding=O,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,L),this._ease(F(a),N=>{"sea"===a.cameraElevationReference&&a.recenterOnTerrain(),this._afterEase(r,N)},t),this}_prepareEase(t,r,a={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||a.moving||this.fire(new St("movestart",t)),this._zooming&&!a.zooming&&this.fire(new St("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new St("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new St("pitchstart",t))}_fireMoveEvents(t){this.fire(new St("move",t)),this._zooming&&this.fire(new St("zoom",t)),this._rotating&&this.fire(new St("rotate",t)),this._pitching&&this.fire(new St("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const a=this._zooming,l=this._rotating,u=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new St("zoomend",t)),l&&this.fire(new St("rotateend",t)),u&&this.fire(new St("pitchend",t)),this.fire(new St("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const Y=ns(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Y,r)}this.stop(),t=Yt({offset:[0,0],speed:1.2,curve:1.42,easing:$n},t);const a=this.transform,l=this.getZoom(),u=this.getBearing(),d=this.getPitch(),h=this.getPadding(),p="zoom"in t?Jt(+t.zoom,a.minZoom,a.maxZoom):l,m="bearing"in t?this._normalizeBearing(t.bearing,u):u,_="pitch"in t?+t.pitch:d,y="padding"in t?t.padding:a.padding,x=a.zoomScale(p-l),b=nt.convert(t.offset);let E=a.centerPoint.add(b);const C=a.pointLocation(E),S=we.convert(t.center||C);this._normalizeCenter(S);const M=a.project(C),D=a.project(S).sub(M);let R=t.curve;const P=Math.max(a.width,a.height),I=P/x,O=D.mag();if("minZoom"in t){const Y=Jt(Math.min(t.minZoom,l,p),a.minZoom,a.maxZoom),ot=P/a.zoomScale(Y-l);R=Math.sqrt(ot/O*2)}const F=R*R;function L(Y){const ot=(I*I-P*P+(Y?-1:1)*F*F*O*O)/(2*(Y?I:P)*F*O);return Math.log(Math.sqrt(ot*ot+1)-ot)}function N(Y){return(Math.exp(Y)-Math.exp(-Y))/2}function z(Y){return(Math.exp(Y)+Math.exp(-Y))/2}const U=L(0);let V=function(Y){return z(U)/z(U+R*Y)},G=function(Y){return P*((z(U)*(N(ot=U+R*Y)/z(ot))-N(U))/F)/O;var ot},j=(L(1)-U)/R;if(Math.abs(O)<1e-6||!isFinite(j)){if(Math.abs(P-I)<1e-6)return this.easeTo(t,r);const Y=I<P?-1:1;j=Math.abs(Math.log(I/P))/R,G=function(){return 0},V=function(ot){return Math.exp(Y*R*ot)}}t.duration="duration"in t?+t.duration:1e3*j/("screenSpeed"in t?+t.screenSpeed/R:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Z=u!==m,et=_!==d,it=!a.isPaddingEqual(y),X=Y=>ot=>{const lt=ot*j,ht=1/V(lt);Y.zoom=1===ot?p:l+Y.scaleZoom(ht),Z&&(Y.bearing=_e(u,m,ot)),et&&(Y.pitch=_e(d,_,ot)),it&&(Y.interpolatePadding(h,y,ot),E=Y.centerPoint.add(b));const mt=1===ot?S:Y.unproject(M.add(D.mult(G(lt))).mult(ht));return Y.setLocationAtPoint(Y.renderWorldCopies?mt.wrap():mt,E),Y._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),Y};if(t.preloadOnly){const Y=this._emulate(X,t.duration,a);return this._preloadTiles(Y),this}return this._zooming=!0,this._rotating=Z,this._pitching=et,this._padding=it,this._prepareEase(r,!1),this._ease(X(a),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const a=this._onEaseEnd;this._onEaseEnd=void 0,a.call(this,r)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,r,a){!1===a.animate||0===a.duration?(t(1),r()):(this._easeStart=kt.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((kt.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=wl(t,-180,180);const a=Math.abs(t-r);return Math.abs(t-360-r)<a&&(t-=360),Math.abs(t+360-r)<a&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.maxBounds)return;const a=t.lng-r.center.lng;t.lng+=a>180?-360:a<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&kt.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,a){const l=Math.ceil(15*r/1e3),u=[],d=t(a.clone());for(let h=0;h<=l;h++){const p=d(h/l);u.push(p.clone())}return u}}class bP{constructor(t={}){this.options=t,Rr(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact;return this._map=t,this._container=zn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=zn("button","mapboxgl-ctrl-attrib-button",this._container),zn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=zn("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===r&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const a=this._map._getUIString(`AttributionControl.${r}`);t.setAttribute("aria-label",a),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",a)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||He.ACCESS_TOKEN}];if(t){const a=r.reduce((l,u,d)=>(u.value&&(l+=`${u.key}=${u.value}${d<r.length-1?"&":""}`),l),"?");t.href=`${He.FEEDBACK_URL}/${a}#${YT(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const r=this._map.style._mergedSourceCaches;for(const l in r){const u=r[l];if(u.used){const d=u.getSource();d.attribution&&t.indexOf(d.attribution)<0&&t.push(d.attribution)}}t.sort((l,u)=>l.length-u.length),t=t.filter((l,u)=>{for(let d=u+1;d<t.length;d++)if(t[d].indexOf(l)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class aD{constructor(){Rr(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=zn("div","mapboxgl-ctrl");const r=zn("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const r in t){const a=t[r].getSource();if(a.hasOwnProperty("mapbox_logo")&&!a.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class Uf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,a=r?this._queue.concat(r):this._queue;for(const l of a)if(l.id===t)return void(l.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const a of r)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function _g(n,t,r){if(n=new we(n.lng,n.lat),t){const a=new we(n.lng-360,n.lat),l=new we(n.lng+360,n.lat),u=360*Math.ceil(Math.abs(n.lng-r.center.lng)/360),d=r.locationPoint(n).distSqr(t),h=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint(a).distSqr(t)<d&&(h||Math.abs(a.lng-r.center.lng)<u)?n=a:r.locationPoint(l).distSqr(t)<d&&(h||Math.abs(l.lng-r.center.lng)<u)&&(n=l)}for(;Math.abs(n.lng-r.center.lng)>180;){const a=r.locationPoint(n);if(a.x>=0&&a.y>=0&&a.x<=r.width&&a.y<=r.height)break;n.lng>r.center.lng?n.lng-=360:n.lng+=360}return n}const sw={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class aw extends $i{constructor(t,r){if(super(),(t instanceof st.HTMLElement||r)&&(t=Yt({element:t},r)),Rr(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=nt.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=zn("div");const u=41,d=27,h=Fa("svg",{display:"block",height:u*this._scale+"px",width:d*this._scale+"px",viewBox:`0 0 ${d} ${u}`},this._element),p=Fa("radialGradient",{id:"shadowGradient"},Fa("defs",{},h));Fa("stop",{offset:"10%","stop-opacity":.4},p),Fa("stop",{offset:"100%","stop-opacity":.05},p),Fa("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h),Fa("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),Fa("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),Fa("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),this._offset=nt.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()});const a=this._element.classList;for(const u in sw)a.remove(`mapboxgl-marker-anchor-${u}`);a.add(`mapboxgl-marker-anchor-${this._anchor}`);const l=t&&t.className?t.className.trim().split(/\s+/):[];a.add(...l),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=we.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const l=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(24.6+l)],"bottom-right":[-l,-1*(24.6+l)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,a=t.charCode||t.keyCode;"Space"!==r&&"Enter"!==r&&32!==a&&13!==a||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,a=this._element;this._popup&&(r===a||a.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const a=t.unproject(r),l=t.getFreeCameraOptions();if(!l.position)return!1;const u=l.position.toLngLat();return u.distanceTo(a)<.9*u.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const a=t.unproject(r);let l;t._showingGlobe()&&iy(t.transform,this._lngLat)?l=0:(l=1-t._queryFogOpacity(a),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(l*=this._occludedOpacity)),this._element.style.opacity=`${l}`,this._element.style.pointerEvents=l>0?"auto":"none",this._popup&&this._popup._setOpacity(l),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${sw[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${r.x}px,${r.y}px)\n        `}_calculateXYTransform(){const t=this._pos,r=this._map,a=this.getPitchAlignment();if(!r||!t||"map"!==a)return"";if(!r._showingGlobe()){const p=r.getPitch();return p?`rotateX(${p}deg)`:""}const l=Cr(YC(r.transform,this._lngLat)),u=t.sub(XC(r.transform)),d=Math.abs(u.x)+Math.abs(u.y);if(0===d)return"";const h=l/d;return`rotateX(${-u.y*h}deg) rotateY(${u.x*h}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let a=0;const l=this.getRotationAlignment();if("map"===l)if(r._showingGlobe()){const u=r.project(new we(this._lngLat.lng,this._lngLat.lat+.001)),d=r.project(new we(this._lngLat.lng,this._lngLat.lat-.001)).sub(u);a=Cr(Math.atan2(d.y,d.x))-90}else a=-r.getBearing();else if("horizon"===l){const u=bl(4,6,r.getZoom()),d=XC(r.transform);d.y+=u*r.transform.height;const h=t.sub(d),p=Cr(Math.atan2(h.y,h.x));a=(p>90?p-270:p+90)*(1-u)}return a+=this._rotation,a?`rotateZ(${a}deg)`:""}_update(t){st.cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=_g(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat),!0===t?this._updateFrameId=st.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=nt.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const a=this._pointerdownPos,l=this._positionDelta;if(a&&l){if(!this._isDragging){const u=this._clickTolerance||r._clickTolerance;if(t.point.dist(a)<u)return;this._isDragging=!0}this._pos=t.point.sub(l),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new St("dragstart"))),this.fire(new St("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new St("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,a=this._pos;r&&a&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(a),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const wP={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},EP=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lD(n=new nt(0,0),t="bottom"){if("number"==typeof n){const r=Math.round(Math.sqrt(.5*Math.pow(n,2)));switch(t){case"top":return new nt(0,n);case"top-left":return new nt(r,r);case"top-right":return new nt(-r,r);case"bottom":return new nt(0,-n);case"bottom-left":return new nt(r,-r);case"bottom-right":return new nt(-r,-r);case"left":return new nt(n,0);case"right":return new nt(-n,0)}return new nt(0,0)}return n instanceof nt||Array.isArray(n)?nt.convert(n):nt.convert(n[t]||[0,0])}class CP{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=Jc((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,a){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+a}}const lw={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},MP={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},SP={showCompass:!0,showZoom:!0,visualizePitch:!1};class TP{constructor(t,r,a=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new Q1({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,a&&(this.mousePitch=new tw({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),Rr(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),wi()}move(t,r){const a=this.map,l=this.mouseRotate.mousemoveWindow(t,r),u=l&&l.bearingDelta;if(u&&a.setBearing(a.getBearing()+u),this.mousePitch){const d=this.mousePitch.mousemoveWindow(t,r),h=d&&d.pitchDelta;h&&a.setPitch(a.getPitch()+h)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ap(),st.removeEventListener("mousemove",this.mousemove),st.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Yt({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),cp(this.element,t)),st.addEventListener("mousemove",this.mousemove),st.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,cp(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ii(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=Ii(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const DP={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},IP={maxWidth:100,unit:"metric"},AP={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Av={version:Pa,supported:dE,setRTLTextPlugin:function(n,t,r=!1){if(Wo===G0||Wo===q0||Wo===Nt)throw new Error("setRTLTextPlugin cannot be called multiple times.");Al=kt.resolveURL(n),Wo=G0,Wn=t,C_(),r||M_()},getRTLTextPluginStatus:pa,Map:class extends xP{constructor(n){if(m0.mark(sp.create),null!=(n=Yt({},MP,n)).minZoom&&null!=n.maxZoom&&n.minZoom>n.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=n.minPitch&&null!=n.maxPitch&&n.minPitch>n.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=n.minPitch&&n.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=n.maxPitch&&n.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(n.antialias&&function(t){const r=t.navigator?t.navigator.userAgent:null;return!!function(a){if(null==xe){const l=a.navigator?a.navigator.userAgent:null;xe=!!a.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return xe}(t)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(st)&&(n.antialias=!1,tt("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fc(n.minZoom,n.maxZoom,n.minPitch,n.maxPitch,n.renderWorldCopies),n),this._interactive=n.interactive,this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._failIfMajorPerformanceCaveat=n.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=n.preserveDrawingBuffer,this._antialias=n.antialias,this._trackResize=n.trackResize,this._bearingSnap=n.bearingSnap,this._refreshExpiredTiles=n.refreshExpiredTiles,this._fadeDuration=n.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=n.crossSourceCollisions,this._collectResourceTiming=n.collectResourceTiming,this._language=this._parseLanguage(n.language),this._worldview=n.worldview,this._renderTaskQueue=new Uf,this._domRenderTaskQueue=new Uf,this._controls=[],this._markers=[],this._popups=[],this._mapId=Di(),this._locale=Yt({},lw,n.locale),this._clickTolerance=n.clickTolerance,this._cooperativeGestures=n.cooperativeGestures,this._performanceMetricsCollection=n.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new CP(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new ce(n.transformRequest,n.accessToken,n.testMode),this._silenceAuthErrors=!!n.testMode,"string"==typeof n.container){if(this._container=st.document.getElementById(n.container),!this._container)throw new Error(`Container '${n.container.toString()}' not found.`)}else{if(!(n.container instanceof st.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=n.container}if(this._container.childNodes.length>0&&tt("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),n.maxBounds&&this.setMaxBounds(n.maxBounds),Rr(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==st&&(this._fullscreenchangeEvent="onfullscreenchange"in st.document?"fullscreenchange":"webkitfullscreenchange",st.addEventListener("online",this._onWindowOnline,!1),st.addEventListener("resize",this._onWindowResize,!1),st.addEventListener("orientationchange",this._onWindowResize,!1),st.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),st.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new vP(this,n),this._localFontFamily=n.localFontFamily,this._localIdeographFontFamily=n.localIdeographFontFamily,(n.style||!n.testMode)&&this.setStyle(n.style||He.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),n.projection&&this.setProjection(n.projection),n.hash&&(this._hash=new XT("string"==typeof n.hash&&n.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch});const t=n.bounds;t&&(this.resize(),this.fitBounds(t,Yt({},n.fitBoundsOptions,{duration:0})))}this.resize(),n.attributionControl&&this.addControl(new bP({customAttribution:n.customAttribution})),this._logoControl=new aD,this.addControl(this._logoControl,n.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new St(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new St(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(n,t){if(void 0===t&&(t=n.getDefaultPosition?n.getDefaultPosition():"top-right"),!n||!n.onAdd)return this.fire(new at(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=n.onAdd(this);this._controls.push(n);const a=this._controlPositions[t];return-1!==t.indexOf("bottom")?a.insertBefore(r,a.firstChild):a.appendChild(r),this}removeControl(n){if(!n||!n.onRemove)return this.fire(new at(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(n);return t>-1&&this._controls.splice(t,1),n.onRemove(this),this}hasControl(n){return this._controls.indexOf(n)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(n){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new St("movestart",n)).fire(new St("move",n)),this.fire(new St("resize",n)),t&&this.fire(new St("moveend",n)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(n){return this.transform.setMaxBounds(Zs.convert(n)),this._update()}setMinZoom(n){if((n=n??-2)>=-2&&n<=this.transform.maxZoom)return this.transform.minZoom=n,this._update(),this.getZoom()<n?this.setZoom(n):this.fire(new St("zoomstart")).fire(new St("zoom")).fire(new St("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(n){if((n=n??22)>=this.transform.minZoom)return this.transform.maxZoom=n,this._update(),this.getZoom()>n?this.setZoom(n):this.fire(new St("zoomstart")).fire(new St("zoom")).fire(new St("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(n){if((n=n??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(n>=0&&n<=this.transform.maxPitch)return this.transform.minPitch=n,this._update(),this.getPitch()<n?this.setPitch(n):this.fire(new St("pitchstart")).fire(new St("pitch")).fire(new St("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(n){if((n=n??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(n>=this.transform.minPitch)return this.transform.maxPitch=n,this._update(),this.getPitch()>n?this.setPitch(n):this.fire(new St("pitchstart")).fire(new St("pitch")).fire(new St("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(n){return this.transform.renderWorldCopies=n,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(n){return"auto"===n?st.navigator.language:Array.isArray(n)?0===n.length?void 0:n.map(t=>"auto"===t?st.navigator.language:t):n}setLanguage(n){const t=this._parseLanguage(n);if(!this.style||t===this._language)return this;this._language=t,this.style.clearSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(n){return this.style&&n!==this._worldview?(this._worldview=n,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(n){return this._lazyInitEmptyStyle(),n?"string"==typeof n&&(n={name:n}):n=null,this._useExplicitProjection=!!n,this._prioritizeAndUpdateProjection(n,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const n=this.transform,t=n.projection.name;let r;"globe"===t&&n.zoom>=_u?(n.setMercatorFromTransition(),r=!0):"mercator"===t&&n.zoom<_u&&(n.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(n,t){return this._updateProjection(n||t||{name:"mercator"})}_updateProjection(n){let t;return t="globe"===n.name&&this.transform.zoom>=_u?this.transform.setMercatorFromTransition():this.transform.setProjection(n),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(n){return this.transform.locationPoint3D(we.convert(n))}unproject(n){return this.transform.pointLocation3D(nt.convert(n))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(n,t,r){if("mouseenter"===n||"mouseover"===n){let a=!1;const l=d=>{const h=t.filter(m=>this.getLayer(m)),p=h.length?this.queryRenderedFeatures(d.point,{layers:h}):[];p.length?a||(a=!0,r.call(this,new ea(n,this,d.originalEvent,{features:p}))):a=!1},u=()=>{a=!1};return{layers:new Set(t),listener:r,delegates:{mousemove:l,mouseout:u}}}if("mouseleave"===n||"mouseout"===n){let a=!1;const l=d=>{const h=t.filter(p=>this.getLayer(p));(h.length?this.queryRenderedFeatures(d.point,{layers:h}):[]).length?a=!0:a&&(a=!1,r.call(this,new ea(n,this,d.originalEvent)))},u=d=>{a&&(a=!1,r.call(this,new ea(n,this,d.originalEvent)))};return{layers:new Set(t),listener:r,delegates:{mousemove:l,mouseout:u}}}{const a=l=>{const u=t.filter(h=>this.getLayer(h)),d=u.length?this.queryRenderedFeatures(l.point,{layers:u}):[];d.length&&(l.features=d,r.call(this,l),delete l.features)};return{layers:new Set(t),listener:r,delegates:{[n]:a}}}}on(n,t,r){if(void 0===r)return super.on(n,t);if(Array.isArray(t)||(t=[t]),t)for(const l of t)if(!this._isValidId(l))return this;const a=this._createDelegatedListener(n,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[n]=this._delegatedListeners[n]||[],this._delegatedListeners[n].push(a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(n,t,r){if(void 0===r)return super.once(n,t);if(Array.isArray(t)||(t=[t]),t)for(const l of t)if(!this._isValidId(l))return this;const a=this._createDelegatedListener(n,t,r);for(const l in a.delegates)this.once(l,a.delegates[l]);return this}off(n,t,r){if(void 0===r)return super.off(n,t);t=new Set(Array.isArray(t)?t:[t]);for(const u of t)if(!this._isValidId(u))return this;const a=(u,d)=>{if(u.size!==d.size)return!1;for(const h of u)if(!d.has(h))return!1;return!0},l=this._delegatedListeners?this._delegatedListeners[n]:void 0;return l&&(u=>{for(let d=0;d<u.length;d++){const h=u[d];if(h.listener===r&&a(h.layers,t)){for(const p in h.delegates)this.off(p,h.delegates[p]);return u.splice(d,1),this}}})(l),this}queryRenderedFeatures(n,t){if(!this.style)return[];if(void 0!==t||void 0===n||n instanceof nt||Array.isArray(n)||(t=n,n=void 0),n=n||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const r of t.layers)if(!this._isValidId(r))return[];return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(n,t){return this._isValidId(n)?this.style.querySourceFeatures(n,t):[]}isPointOnSurface(n){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&tt(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(nt.convert(n))}setStyle(n,t){return!1!==(t=Yt({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&n?(this._diffStyle(n,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(n,t))}_getUIString(n){const t=this._locale[n];if(null==t)throw new Error(`Missing UI string '${n}'`);return t}_updateStyle(n,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),n&&(this.style=new ta(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof n?this.style.loadURL(n):this.style.loadJSON(n)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ta(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(n,t){if("string"==typeof n){const r=this._requestManager.normalizeStyleURL(n),a=this._requestManager.transformRequest(r,gt.Style);At(a,(l,u)=>{l?this.fire(new at(l)):u&&this._updateDiff(u,t)})}else"object"==typeof n&&this._updateDiff(n,t)}_updateDiff(n,t){try{this.style.setState(n)&&this._update(!0)}catch(r){tt(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(n,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(tt("There is no style added to the map."),!1)}_isValidId(n){return!(t=n,t.indexOf("\x1f")>=0&&(this.fire(new at(new Error(`IDs can't contain special symbols: "${n}".`))),1));var t}addSource(n,t){return this._isValidId(n)?(this._lazyInitEmptyStyle(),this.style.addSource(n,t),this._update(!0)):this}isSourceLoaded(n){return!!this._isValidId(n)&&!!this.style&&this.style._isSourceCacheLoaded(n)}areTilesLoaded(){const n=this.style&&this.style._sourceCaches;for(const t in n){const r=n[t]._tiles;for(const a in r){const l=r[a];if("loaded"!==l.state&&"errored"!==l.state)return!1}}return!0}addSourceType(n,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(n,t,r)}removeSource(n){return this._isValidId(n)?(this.style.removeSource(n),this._updateTerrain(),this._update(!0)):this}getSource(n){return this._isValidId(n)?this.style.getOwnSource(n):null}addImage(n,t,{pixelRatio:r=1,sdf:a=!1,stretchX:l,stretchY:u,content:d}={}){if(this._lazyInitEmptyStyle(),t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap){const{width:h,height:p,data:m}=kt.getImageData(t);this.style.addImage(n,{data:new Pi({width:h,height:p},m),pixelRatio:r,stretchX:l,stretchY:u,content:d,sdf:a,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new at(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:h,height:p}=t,m=t;this.style.addImage(n,{data:new Pi({width:h,height:p},new Uint8Array(m.data)),pixelRatio:r,stretchX:l,stretchY:u,content:d,sdf:a,version:0,userImage:m}),m.onAdd&&m.onAdd(this,n)}}updateImage(n,t){this._lazyInitEmptyStyle();const r=this.style.getImage(n);if(!r)return void this.fire(new at(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap?kt.getImageData(t):t,{width:l,height:u}=a;void 0!==l&&void 0!==u?l===r.data.width&&u===r.data.height?(r.data.replace(a.data,!(t instanceof st.HTMLImageElement||st.ImageBitmap&&t instanceof st.ImageBitmap)),this.style.updateImage(n,r)):this.fire(new at(new Error(`The width and height of the updated image (${l}, ${u})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`))):this.fire(new at(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(n){return n?!!this.style&&!!this.style.getImage(n):(this.fire(new at(new Error("Missing required image id"))),!1)}removeImage(n){this.style.removeImage(n)}loadImage(n,t){Oe(this._requestManager.transformRequest(n,gt.Image),(r,a)=>{t(r,a instanceof st.HTMLImageElement?kt.getImageData(a):a)})}listImages(){return this.style.listImages()}addModel(n,t){this._lazyInitEmptyStyle(),this.style.addModel(n,t)}hasModel(n){return n?this.style.hasModel(n):(this.fire(new at(new Error("Missing required model id"))),!1)}removeModel(n){this.style.removeModel(n)}listModels(){return this.style.listModels()}addLayer(n,t){return this._isValidId(n.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(n,t),this._update(!0)):this}moveLayer(n,t){return this._isValidId(n)?(this.style.moveLayer(n,t),this._update(!0)):this}removeLayer(n){return this._isValidId(n)?(this.style.removeLayer(n),this._update(!0)):this}getLayer(n){return this._isValidId(n)?this.style.getOwnLayer(n):null}setLayerZoomRange(n,t,r){return this._isValidId(n)?(this.style.setLayerZoomRange(n,t,r),this._update(!0)):this}setFilter(n,t,r={}){return this._isValidId(n)?(this.style.setFilter(n,t,r),this._update(!0)):this}getFilter(n){return this._isValidId(n)?this.style.getFilter(n):null}setPaintProperty(n,t,r,a={}){return this._isValidId(n)?(this.style.setPaintProperty(n,t,r,a),this._update(!0)):this}getPaintProperty(n,t){return this._isValidId(n)?this.style.getPaintProperty(n,t):null}setLayoutProperty(n,t,r,a={}){return this._isValidId(n)?(this.style.setLayoutProperty(n,t,r,a),this._update(!0)):this}getLayoutProperty(n,t){return this._isValidId(n)?this.style.getLayoutProperty(n,t):null}setConfigProperty(n,t,r){return this.style.setConfigProperty(n,t,r),this._update(!0)}setLights(n){if(this._lazyInitEmptyStyle(),n&&1===n.length&&"flat"===n[0].type){const t=n[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(n),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const n=this.style.getLights()||[];return 0===n.length&&n.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),n}setLight(n,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:n}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(n){return this._lazyInitEmptyStyle(),!n&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(n),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(n){return this._lazyInitEmptyStyle(),this.style.setFog(n),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(n){return this.style.setCamera(n),this._triggerCameraUpdate(n)}_triggerCameraUpdate(n){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===n["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(n){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(we.convert(n),this.transform):0}setFeatureState(n,t){return this._isValidId(n.source)?(this.style.setFeatureState(n,t),this._update()):this}removeFeatureState(n,t){return this._isValidId(n.source)?(this.style.removeFeatureState(n,t),this._update()):this}getFeatureState(n){return this._isValidId(n.source)?this.style.getFeatureState(n):null}_updateContainerDimensions(){if(!this._container)return;const n=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,a,l,u=this._container;for(;u&&(!a||!l);){const d=st.getComputedStyle(u).transform;d&&"none"!==d&&(r=d.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(a=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(l=r[3])),u=u.parentElement}this._containerWidth=a?Math.abs(n/a):n,this._containerHeight=l?Math.abs(t/l):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==st.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&tt("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const n=this._container;n.classList.add("mapboxgl-map"),(this._missingCSSCanary=zn("div","mapboxgl-canary",n)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=zn("div","mapboxgl-canvas-container",n);this._canvas=zn("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=zn("div","mapboxgl-control-container",n),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(l=>{a[l]=zn("div",`mapboxgl-ctrl-${l}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(n,t){const r=kt.devicePixelRatio||1;this._canvas.width=r*Math.ceil(n),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${n}px`,this._canvas.style.height=`${t}px`}_addMarker(n){this._markers.push(n)}_removeMarker(n){const t=this._markers.indexOf(n);-1!==t&&this._markers.splice(t,1)}_addPopup(n){this._popups.push(n)}_removePopup(n){const t=this._popups.indexOf(n);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const n=Yt({},dE.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",n);t?(cE(t,!0),this.painter=new G1(t,this.transform),this.on("data",r=>{"source"===r.dataType&&this.painter.setTileLoadedFlag(!0)}),Bs.testSupport(t)):this.fire(new at(new Error("Failed to initialize WebGL")))}_contextLost(n){n.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new St("webglcontextlost",{originalEvent:n}))}_contextRestored(n){this._setupPainter(),this.resize(),this._update(),this.fire(new St("webglcontextrestored",{originalEvent:n}))}_onMapScroll(n){if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(n){return this.style?(this._styleDirty=this._styleDirty||n,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(n){return this._update(),this._renderTaskQueue.add(n)}_cancelRenderFrame(n){this._renderTaskQueue.remove(n)}_requestDomTask(n){!this.loaded()||this.loaded()&&!this.isMoving()?n():this._domRenderTaskQueue.add(n)}_render(n){let t;this.fire(new St("renderstart"));const r=this.painter.context.extTimerQuery,a=kt.now(),l=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=l.createQuery(),l.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],st.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],st.performance.now())),this._renderTaskQueue.run(n),this._domRenderTaskQueue.run(n),this._removed)return;this._updateProjectionTransition();const u=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,m=this.transform.pitch,_=kt.now(),y=new Ei(p,{now:_,fadeDuration:u,pitch:m,transition:this.style.transition});this.style.update(y)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let d=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),d=this._updateAverageElevation(a),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):d=this._updateAverageElevation(a),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,u,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:u,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new St("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new St("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const p=kt.now()-a;l.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const m=l.getQueryParameter(t,l.QUERY_RESULT)/1e6;l.deleteQuery(t),this.fire(new St("gpu-timing-frame",{cpuTime:p,gpuTime:m})),st.performance.mark("frame-gpu",{startTime:a,detail:{gpuTime:m}})},50)}if(this.listens("gpu-timing-layer")){const p=this.painter.collectGpuTimers();setTimeout(()=>{const m=this.painter.queryGpuTimers(p);this.fire(new St("gpu-timing-layer",{layerTimes:m}))},50)}if(this.listens("gpu-timing-deferred-render")){const p=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const m=this.painter.queryGpuTimeDeferredRender(p);this.fire(new St("gpu-timing-deferred-render",{gpuTime:m}))},50)}const h=this._sourcesDirty||this._styleDirty||this._placementDirty||d;if(h||this._repaint)this.triggerRepaint();else{const p=!this.isMoving()&&this.loaded();if(p&&(d=this._updateAverageElevation(a,!0)),d)this.triggerRepaint();else if(this._triggerFrame(!1),p&&(this.fire(new St("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const m=this._calculateSpeedIndex();this.fire(new St("speedindexcompleted",{speedIndex:m})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,m0.mark(sp.fullLoad),this._performanceMetricsCollection&&aE(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(n){for(const t of this._markers)n&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!n||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(n,t=!1){const r=l=>(this.transform.averageElevation=l,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const a=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(a||(t||n-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(n)){const l=this.transform.averageElevation;let u=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(u)?u=0:this._averageElevationLastSampledAt=n;const d=Math.abs(l-u);if(d>1){if(this._isInitialLoad||a)return this._averageElevation.jumpTo(u),r(u);this._averageElevation.easeTo(u,n,300)}else if(d>1e-4)return this._averageElevation.jumpTo(u),r(u)}return!!this._averageElevation.isEasing(n)&&r(this._averageElevation.getValue(n))}_authenticate(){lE(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,n=>{if(n&&(n.message===Pn||401===n.status)){const t=this.painter.context.gl;cE(t,!1),this._logoControl instanceof aD&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new at(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),_F(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const n=this._isDragging();this.painter.updateTerrain(this.style,n)}_calculateSpeedIndex(){const n=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,a=r.createFramebuffer();function l(u){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,u,0);const d=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,d),d}return r.bindFramebuffer(r.FRAMEBUFFER,a),this._canvasPixelComparison(l(n),t.canvasCopies.map(l),t.timeStamps)}_canvasPixelComparison(n,t,r){let a=r[1]-r[0];const l=n.length/4;for(let u=0;u<t.length;u++){const d=t[u];let h=0;for(let p=0;p<d.length;p+=4)d[p]===n[p]&&d[p+1]===n[p+1]&&d[p+2]===n[p+2]&&d[p+3]===n[p+3]&&(h+=1);a+=(r[u+2]-r[u+1])*(1-h/l)}return a}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==st&&(st.removeEventListener("resize",this._onWindowResize,!1),st.removeEventListener("orientationchange",this._onWindowResize,!1),st.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),st.removeEventListener("online",this._onWindowOnline,!1),st.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ru.delete(this.painter.context.gl),this._removed=!0,this.fire(new St("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(n){this._renderNextFrame=this._renderNextFrame||n,this.style&&!this._frame&&(this._frame=kt.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(n){return Yu(this.style?Object.values(this.style._sourceCaches):[],(t,r)=>t._preloadTiles(n,r),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(n){this._trackResize&&this.resize({originalEvent:n})._update()}_onVisibilityChange(){"hidden"===st.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(n){this._showTileBoundaries!==n&&(this._showTileBoundaries=n,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(n){this._showTerrainWireframe!==n&&(this._showTerrainWireframe=n,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(n){this._showLayers2DWireframe!==n&&(this._showLayers2DWireframe=n,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(n){this._showLayers3DWireframe!==n&&(this._showLayers3DWireframe=n,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(n){this._speedIndexTiming!==n&&(this._speedIndexTiming=n,this._update())}get showPadding(){return!!this._showPadding}set showPadding(n){this._showPadding!==n&&(this._showPadding=n,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(n){this._showCollisionBoxes!==n&&(this._showCollisionBoxes=n,n?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(n){this._showOverdrawInspector!==n&&(this._showOverdrawInspector=n,this._update())}get repaint(){return!!this._repaint}set repaint(n){this._repaint!==n&&(this._repaint=n,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(n){this._vertices=n,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(n){this._showTileAABBs!==n&&(this._showTileAABBs=n,n&&this._update())}_setCacheLimits(n,t){Mo=n,Bo=t}get version(){return Pa}},NavigationControl:class{constructor(n){this.options=Yt({},SP,n),this._container=zn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(Rr(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),zn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),zn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Rr(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=zn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const n=this._map;if(!n)return;const t=n.getZoom(),r=t===n.getMaxZoom(),a=t===n.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const n=this._map;if(!n)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(n.transform.pitch*(Math.PI/180)),.5)}) rotateX(${n.transform.pitch}deg) rotateZ(${n.transform.angle*(180/Math.PI)}deg)`:`rotate(${n.transform.angle*(180/Math.PI)}deg)`;n._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),n.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&n.on("pitch",this._rotateCompassArrow),n.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new TP(n,this._compass,this.options.visualizePitch)),this._container}onRemove(){const n=this._map;n&&(this._container.remove(),this.options.showZoom&&n.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&n.off("pitch",this._rotateCompassArrow),n.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(n,t){const r=zn("button",n,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(n,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);n.setAttribute("aria-label",r),n.firstElementChild&&n.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends $i{constructor(n){super(),this.options=Yt({geolocation:st.navigator.geolocation},DP,n),Rr(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=lP(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(n){return this._map=n,this._container=zn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(n){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,n(r)};void 0!==this._supportsGeolocation?n(this._supportsGeolocation):void 0!==st.navigator.permissions?st.navigator.permissions.query({name:"geolocation"}).then(r=>t("denied"!==r.state)).catch(()=>t()):t()}_isOutOfMapMaxBounds(n){const t=this._map.getMaxBounds(),r=n.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(n){if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new St("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(n),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(n),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new St("geolocate",n)),this._finish()}}_updateCamera(n){const t=new we(n.coords.longitude,n.coords.latitude),r=n.coords.accuracy,a=Yt({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),a,{geolocateSource:!0})}_updateMarker(n){if(n){const t=new we(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const n=this._map.transform,t=Nn(1,n._center.lat)*n.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(n){if(this._map){if(this.options.trackUserLocation)if(1===n.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===n.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new St("error",n)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(n){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=zn("button","mapboxgl-ctrl-geolocate",this._container),zn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===n){tt("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=zn("div","mapboxgl-user-location"),this._dotElement.appendChild(zn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(zn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new aw({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=zn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new aw({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new St("trackuserlocationend")))})}}_onDeviceOrientation(n){this._userLocationDotMarker&&(n.webkitCompassHeading?this._heading=n.webkitCompassHeading:!0===n.absolute&&(this._heading=-1*n.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return tt("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new St("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new St("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new St("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let n;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(n={maximumAge:6e5,timeout:0},this._noTimeout=!0):(n=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,n),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const n=()=>{st.addEventListener("ondeviceorientationabsolute"in st?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==st.DeviceMotionEvent&&"function"==typeof st.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&n()}).catch(console.error):n()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),st.removeEventListener("deviceorientation",this._onDeviceOrientation),st.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bP,ScaleControl:class{constructor(n){this.options=Yt({},IP,n),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Rr(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const n=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,a=t._containerWidth/2-n/2,l=t.unproject([a,r]),u=t.unproject([a+n,r]),d=l.distanceTo(u);if("imperial"===this.options.unit){const h=3.2808*d;h>5280?this._setScale(n,h/5280,"mile"):this._setScale(n,h,"foot")}else"nautical"===this.options.unit?this._setScale(n,d/1852,"nautical-mile"):d>=1e3?this._setScale(n,d/1e3,"kilometer"):this._setScale(n,d,"meter")}_setScale(n,t,r){this._map._requestDomTask(()=>{const a=function(u){const d=Math.pow(10,`${Math.floor(u)}`.length-1);let h=u/d;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(p){const m=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*m)/m}(h),d*h}(t),l=a/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(a):`${a}&nbsp;${AP[r]}`,this._container.style.width=n*l+"px"})}onAdd(n){return this._map=n,this._language=n.getLanguage(),this._container=zn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(n){this._language=n,this._update()}setUnit(n){this.options.unit=n,this._update()}},FullscreenControl:class{constructor(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof st.HTMLElement?this._container=n.container:tt("Full screen control 'container' must be a DOM element.")),Rr(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in st.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in st.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=zn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",tt("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,st.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!st.document.fullscreenEnabled&&!st.document.webkitFullscreenEnabled)}_setupUI(){const n=this._fullscreenButton=zn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);zn("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),st.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",n)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(st.document.fullscreenElement||st.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?st.document.exitFullscreen?st.document.exitFullscreen():st.document.webkitCancelFullScreen&&st.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends $i{constructor(n){super(),this.options=Yt(Object.create(wP),n),Rr(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(n&&n.className?n.className.trim().split(/\s+/):[])}addTo(n){return this._map&&this.remove(),this._map=n,this.options.closeOnClick&&n.on("preclick",this._onClose),this.options.closeOnMove&&n.on("move",this._onClose),n.on("remove",this.remove),this._update(),n._addPopup(this),this._focusFirstElement(),this._trackPointer?(n.on("mousemove",this._onMouseEvent),n.on("mouseup",this._onMouseEvent),n._canvasContainer.classList.add("mapboxgl-track-pointer")):n.on("move",this._update),this.fire(new St("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const n=this._map;return n&&(n.off("move",this._update),n.off("move",this._onClose),n.off("preclick",this._onClose),n.off("click",this._onClose),n.off("remove",this.remove),n.off("mousemove",this._onMouseEvent),n.off("mouseup",this._onMouseEvent),n.off("drag",this._onMouseEvent),n._canvasContainer&&n._canvasContainer.classList.remove("mapboxgl-track-pointer"),n._removePopup(this),this._map=void 0),this.fire(new St("close")),this}getLngLat(){return this._lngLat}setLngLat(n){this._lngLat=we.convert(n),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const n=this._map;return n&&(n.off("move",this._update),n.on("mousemove",this._onMouseEvent),n.on("drag",this._onMouseEvent),n._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(n){return this.setDOMContent(st.document.createTextNode(n))}setHTML(n){const t=st.document.createDocumentFragment(),r=st.document.createElement("body");let a;for(r.innerHTML=n;a=r.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(n){return this.options.maxWidth=n,this._update(),this}setDOMContent(n){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=zn("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(n),this.options.closeButton){const r=this._closeButton=zn("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.setAttribute("aria-hidden","true"),r.innerHTML="&#215;",r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(n){return this._classList.add(n),this._updateClassList(),this}removeClassName(n){return this._classList.delete(n),this._updateClassList(),this}setOffset(n){return this.options.offset=n,this._update(),this}toggleClassName(n){let t;return this._classList.delete(n)?t=!1:(this._classList.add(n),t=!0),this._updateClassList(),t}_onMouseEvent(n){this._update(n.point)}_getAnchor(n){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,a=this._pos;if(!t||!r||!a)return"bottom";const l=r.offsetWidth,u=r.offsetHeight,d=a.x<l/2,h=a.x>t.transform.width-l/2;if(a.y+n<u)return d?"top-left":h?"top-right":"top";if(a.y>t.transform.height-u){if(d)return"bottom-left";if(h)return"bottom-right"}return d?"left":h?"right":"bottom"}_updateClassList(){const n=this._container;if(!n)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),n.className=t.join(" ")}_update(n){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let a=this._container;if(a||(a=this._container=zn("div","mapboxgl-popup",t.getContainer()),this._tip=zn("div","mapboxgl-popup-tip",a),a.appendChild(r)),this.options.maxWidth&&a.style.maxWidth!==this.options.maxWidth&&(a.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_g(this._lngLat,this._pos,t.transform)),!this._trackPointer||n){const l=this._pos=this._trackPointer&&n?n:t.project(this._lngLat),u=lD(this.options.offset),d=this._anchor=this._getAnchor(u.y),h=lD(this.options.offset,d),p=l.add(h).round();t._requestDomTask(()=>{this._container&&d&&(this._container.style.transform=`${sw[d]} translate(${p.x}px,${p.y}px)`)})}if(!this._marker&&t._showingGlobe()){const l=iy(t.transform,this._lngLat)?0:1;this._setOpacity(l)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const n=this._container.querySelector(EP);n&&n.focus()}_onClose(){this.remove()}_setOpacity(n){this._container&&(this._container.style.opacity=`${n}`),this._content&&(this._content.style.pointerEvents=n?"auto":"none")}},Marker:aw,Style:ta,LngLat:we,LngLatBounds:Zs,Point:nt,MercatorCoordinate:Je,FreeCameraOptions:Bm,Evented:$i,config:He,prewarm:function(){If().acquire(iv)},clearPrewarmedResources:function(){const n=tg;n&&(n.isPreloaded()&&1===n.numActive()?(n.release(iv),tg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return He.ACCESS_TOKEN},set accessToken(n){He.ACCESS_TOKEN=n},get baseApiUrl(){return He.API_URL},set baseApiUrl(n){He.API_URL=n},get workerCount(){return Fd.workerCount},set workerCount(n){Fd.workerCount=n},get maxParallelImageRequests(){return He.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){He.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage(n){!function(t){if(!eh())return;const r=st.caches.delete(ii);t&&r.catch(t).then(()=>t())}(n)},workerUrl:"",workerClass:null,get dracoUrl(){return JS()},set dracoUrl(n){rv=kt.resolveURL(n),l1||(l1=new Km(If(),new $i)),l1.broadcast("setDracoUrl",rv)},setNow:kt.setNow,restoreNow:kt.restoreNow};Qt.A=Df,Qt.D=Ea,Qt.E=dt,Qt.F=gb,Qt.K=dv,Qt.O=tn,Qt.P=nt,Qt.T=j2,Qt.V=_m,Qt.a=my,Qt.b=mM,Qt.c=ev,Qt.d=class extends $i{constructor(n,t,r,a,l,u){super(),this.actor=n,this.layerIndex=t,this.availableImages=r,this.loadVectorData=l||KS,this.loading={},this.loaded={},this.deduped=new kd(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler,this.brightness=u}loadTile(n,t){const r=n.uid,a=n&&n.request,l=a&&a.collectResourceTiming,u=this.loading[r]=new cR(n);u.abort=this.loadVectorData(n,(d,h)=>{const p=!this.loading[r];if(delete this.loading[r],p||d||!h)return u.status="done",p||(this.loaded[r]=u),t(d);const m=h.rawData,_={};h.expires&&(_.expires=h.expires),h.cacheControl&&(_.cacheControl=h.cacheControl),u.vectorTile=h.vectorTile||new gm(new Xe(m));const y=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(x,b)=>{if(x||!b)return t(x);const E={};if(l){const C=uE(a);C.length>0&&(E.resourceTiming=JSON.parse(JSON.stringify(C)))}t(null,Yt({rawTileData:m.slice(0)},b,_,E))})};this.isSpriteLoaded?y():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(y,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):y()}),this.loaded=this.loaded||{},this.loaded[r]=u})}reloadTile(n,t){const r=this.loaded,a=n.uid,l=this;if(r&&r[a]){const u=r[a];u.showCollisionBoxes=n.showCollisionBoxes,u.projection=n.projection,u.brightness=n.brightness,u.tileTransform=Tu(n.tileID.canonical,n.projection),u.extraShadowCaster=n.extraShadowCaster;const d=(h,p)=>{const m=u.reloadCallback;m&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,m)),t(h,p)};"parsing"===u.status?u.reloadCallback=d:"done"===u.status&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,d):d())}}abortTile(n,t){const r=n.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),t()}removeTile(n,t){const r=this.loaded,a=n.uid;r&&r[a]&&delete r[a],t()}},Qt.e=mc,Qt.f=uE,Qt.g=ms,Qt.h=At,Qt.i=zt,Qt.j=function(n,t){const r=oT(n);for(const a of r){for(const l of a.meshes)WF(l);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(sT(a.lights,t)))}return r},Qt.k=Ei,Qt.l=function(n){let t=0;if(new Uint32Array(n,0,1)[0]!==h1){const r=new Uint32Array(n,0,7),[,,a,l,u,d]=r;t=r.byteLength+l+u+d+u,(a!==n.byteLength||t>=n.byteLength)&&tt("Invalid b3dm header information.")}return nT(n,t)},Qt.m=Am,Qt.n=bs,Qt.o=St,Qt.p=Kc,Qt.q=function(n){gs(),is&&is.then(t=>{t.keys().then(r=>{for(let a=0;a<r.length-n;a++)t.delete(r[a])})})},Qt.r=cT,Qt.s=Av,Qt.t=Cd,Qt.v=on,Qt.w=st}),rp(0,function(Qt){function st(Pt){if("number"==typeof Pt||"boolean"==typeof Pt||"string"==typeof Pt||null==Pt)return JSON.stringify(Pt);if(Array.isArray(Pt)){let W="[";for(const tt of Pt)W+=`${st(tt)},`;return`${W}]`}let H="{";for(const W of Object.keys(Pt).sort())H+=`${W}:${st(Pt[W])},`;return`${H}}`}function Pa(Pt){let H="";for(const W of Qt.r)H+=`/${st(Pt[W])}`;return H}class ml{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H,W){this._layerConfigs={},this._layers={},this.update(H,[],W)}update(H,W,tt){this._options=tt;for(const Mt of H){this._layerConfigs[Mt.id]=Mt;const qt=this._layers[Mt.id]=Qt.c(Mt,this._options);qt.setScope(this.scope),qt.compileFilter(),this.keyCache[Mt.id]&&delete this.keyCache[Mt.id]}for(const Mt of W)delete this.keyCache[Mt],delete this._layerConfigs[Mt],delete this._layers[Mt];this.familiesBySource={};const wt=function(Mt,qt){const te={};for(let ae=0;ae<Mt.length;ae++){const xe=qt&&qt[Mt[ae].id]||Pa(Mt[ae]);qt&&(qt[Mt[ae].id]=xe);let be=te[xe];be||(be=te[xe]=[]),be.push(Mt[ae])}const Ct=[];for(const ae in te)Ct.push(te[ae]);return Ct}(Qt.v(this._layerConfigs),this.keyCache);for(const Mt of wt){const qt=Mt.map(Yn=>this._layers[Yn.id]),te=qt[0];if("none"===te.visibility)continue;const Ct=te.source||"";let ae=this.familiesBySource[Ct];ae||(ae=this.familiesBySource[Ct]={});const xe=te.sourceLayer||"_geojsonTileLayer";let be=ae[xe];be||(be=ae[xe]=[]),be.push(qt)}}}class He{loadTile(H,W){const{uid:tt,encoding:wt,rawImageData:Mt,padding:qt}=H,te=Qt.w.ImageBitmap&&Mt instanceof Qt.w.ImageBitmap?this.getImageData(Mt,qt):Mt;W(null,new Qt.D(tt,te,wt,H.convertToFloat,qt<1))}getImageData(H,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const tt=this.offscreenCanvasContext.getImageData(-W,-W,H.width+2*W,H.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),tt}}function Bs(Pt,H){if(0!==Pt.length){Oa(Pt[0],H);for(var W=1;W<Pt.length;W++)Oa(Pt[W],!H)}}function Oa(Pt,H){for(var W=0,tt=0,wt=0,Mt=Pt.length,qt=Mt-1;wt<Mt;qt=wt++){var te=(Pt[wt][0]-Pt[qt][0])*(Pt[qt][1]+Pt[wt][1]),Ct=W+te;tt+=Math.abs(W)>=Math.abs(te)?W-Ct+te:te-Ct+W,W=Ct}W+tt>=0!=!!H&&Pt.reverse()}var lc=Qt.g(function Pt(H,W){var tt,wt=H&&H.type;if("FeatureCollection"===wt)for(tt=0;tt<H.features.length;tt++)Pt(H.features[tt],W);else if("GeometryCollection"===wt)for(tt=0;tt<H.geometries.length;tt++)Pt(H.geometries[tt],W);else if("Feature"===wt)Pt(H.geometry,W);else if("Polygon"===wt)Bs(H.coordinates,W);else if("MultiPolygon"===wt)for(tt=0;tt<H.coordinates.length;tt++)Bs(H.coordinates[tt],W);return H});const Wu=Qt.V.prototype.toGeoJSON;var Yc={exports:{}},Bg=Qt.p,op=Qt.a.VectorTileFeature,ms=gl;function gl(Pt,H){this.options=H||{},this.features=Pt,this.length=Pt.length}function _l(Pt,H){this.id="number"==typeof Pt.id?Pt.id:void 0,this.type=Pt.type,this.rawGeometry=1===Pt.type?[Pt.geometry]:Pt.geometry,this.properties=Pt.tags,this.extent=H||4096}gl.prototype.feature=function(Pt){return new _l(this.features[Pt],this.options.extent)},_l.prototype.loadGeometry=function(){var Pt=this.rawGeometry;this.geometry=[];for(var H=0;H<Pt.length;H++){for(var W=Pt[H],tt=[],wt=0;wt<W.length;wt++)tt.push(new Bg(W[wt][0],W[wt][1]));this.geometry.push(tt)}return this.geometry},_l.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Pt=this.geometry,H=1/0,W=-1/0,tt=1/0,wt=-1/0,Mt=0;Mt<Pt.length;Mt++)for(var qt=Pt[Mt],te=0;te<qt.length;te++){var Ct=qt[te];H=Math.min(H,Ct.x),W=Math.max(W,Ct.x),tt=Math.min(tt,Ct.y),wt=Math.max(wt,Ct.y)}return[H,tt,W,wt]},_l.prototype.toGeoJSON=op.prototype.toGeoJSON;var Vg=Qt.b,Kc=ms;function yl(Pt){var H=new Vg;return function(W,tt){for(var wt in W.layers)tt.writeMessage(3,nt,W.layers[wt])}(Pt,H),H.finish()}function nt(Pt,H){var W;H.writeVarintField(15,Pt.version||1),H.writeStringField(1,Pt.name||""),H.writeVarintField(5,Pt.extent||4096);var tt={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<Pt.length;W++)tt.feature=Pt.feature(W),H.writeMessage(2,cn,tt);var wt=tt.keys;for(W=0;W<wt.length;W++)H.writeStringField(3,wt[W]);var Mt=tt.values;for(W=0;W<Mt.length;W++)H.writeMessage(4,p0,Mt[W])}function cn(Pt,H){var W=Pt.feature;void 0!==W.id&&H.writeVarintField(1,W.id),H.writeMessage(2,Zu,Pt),H.writeVarintField(3,W.type),H.writeMessage(4,Cr,W)}function Zu(Pt,H){var W=Pt.feature,tt=Pt.keys,wt=Pt.values,Mt=Pt.keycache,qt=Pt.valuecache;for(var te in W.properties){var Ct=W.properties[te],ae=Mt[te];if(null!==Ct){void 0===ae&&(tt.push(te),Mt[te]=ae=tt.length-1),H.writeVarint(ae);var xe=typeof Ct;"string"!==xe&&"boolean"!==xe&&"number"!==xe&&(Ct=JSON.stringify(Ct));var be=xe+":"+Ct,Yn=qt[be];void 0===Yn&&(wt.push(Ct),qt[be]=Yn=wt.length-1),H.writeVarint(Yn)}}}function vl(Pt,H){return(H<<3)+(7&Pt)}function Ie(Pt){return Pt<<1^Pt>>31}function Cr(Pt,H){for(var W=Pt.loadGeometry(),tt=Pt.type,wt=0,Mt=0,qt=W.length,te=0;te<qt;te++){var Ct=W[te],ae=1;1===tt&&(ae=Ct.length),H.writeVarint(vl(1,ae));for(var xe=3===tt?Ct.length-1:Ct.length,be=0;be<xe;be++){1===be&&1!==tt&&H.writeVarint(vl(2,xe-1));var Yn=Ct[be].x-wt,zi=Ct[be].y-Mt;H.writeVarint(Ie(Yn)),H.writeVarint(Ie(zi)),wt+=Yn,Mt+=zi}3===tt&&H.writeVarint(vl(7,1))}}function p0(Pt,H){var W=typeof Pt;"string"===W?H.writeStringField(1,Pt):"boolean"===W?H.writeBooleanField(7,Pt):"number"===W&&(Pt%1!=0?H.writeDoubleField(3,Pt):Pt<0?H.writeSVarintField(6,Pt):H.writeVarintField(5,Pt))}Yc.exports=yl,Yc.exports.fromVectorTileJs=yl,Yc.exports.fromGeojsonVt=function(Pt,H){H=H||{};var W={};for(var tt in Pt)W[tt]=new Kc(Pt[tt].features,H),W[tt].name=tt,W[tt].version=H.version,W[tt].extent=H.extent;return yl({layers:W})},Yc.exports.GeoJSONWrapper=Kc;var Jc=Qt.g(Yc.exports);const xl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pt=>Pt},Xu=Math.fround||(Qc=new Float32Array(1),Pt=>(Qc[0]=+Pt,Qc[0]));var Qc;const $n=3,Jt=5,bl=6;class wl{constructor(H){this.options=Object.assign(Object.create(xl),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:W,minZoom:tt,maxZoom:wt}=this.options;W&&console.time("total time");const Mt=`prepare ${H.length} points`;W&&console.time(Mt),this.points=H;const qt=[];for(let Ct=0;Ct<H.length;Ct++){const ae=H[Ct];if(!ae.geometry)continue;const[xe,be]=ae.geometry.coordinates,Yn=Xu(Yt(xe)),zi=Xu(ns(be));qt.push(Yn,zi,1/0,Ct,-1,1),this.options.reduce&&qt.push(0)}let te=this.trees[wt+1]=this._createTree(qt);W&&console.timeEnd(Mt);for(let Ct=wt;Ct>=tt;Ct--){const ae=+Date.now();te=this.trees[Ct]=this._createTree(this._cluster(te,Ct)),W&&console.log("z%d: %d clusters in %dms",Ct,te.numItems,+Date.now()-ae)}return W&&console.timeEnd("total time"),this}getClusters(H,W){let tt=((H[0]+180)%360+360)%360-180;const wt=Math.max(-90,Math.min(90,H[1]));let Mt=180===H[2]?180:((H[2]+180)%360+360)%360-180;const qt=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)tt=-180,Mt=180;else if(tt>Mt){const be=this.getClusters([tt,wt,180,qt],W),Yn=this.getClusters([-180,wt,Mt,qt],W);return be.concat(Yn)}const te=this.trees[this._limitZoom(W)],Ct=te.range(Yt(tt),ns(qt),Yt(Mt),ns(wt)),ae=te.data,xe=[];for(const be of Ct){const Yn=this.stride*be;xe.push(ae[Yn+Jt]>1?Yu(ae,Yn,this.clusterProps):this.points[ae[Yn+$n]])}return xe}getChildren(H){const W=this._getOriginId(H),tt=this._getOriginZoom(H),wt="No cluster with the specified id.",Mt=this.trees[tt];if(!Mt)throw new Error(wt);const qt=Mt.data;if(W*this.stride>=qt.length)throw new Error(wt);const te=this.options.radius/(this.options.extent*Math.pow(2,tt-1)),Ct=Mt.within(qt[W*this.stride],qt[W*this.stride+1],te),ae=[];for(const xe of Ct){const be=xe*this.stride;qt[be+4]===H&&ae.push(qt[be+Jt]>1?Yu(qt,be,this.clusterProps):this.points[qt[be+$n]])}if(0===ae.length)throw new Error(wt);return ae}getLeaves(H,W,tt){const wt=[];return this._appendLeaves(wt,H,W=W||10,tt=tt||0,0),wt}getTile(H,W,tt){const wt=this.trees[this._limitZoom(H)],Mt=Math.pow(2,H),{extent:qt,radius:te}=this.options,Ct=te/qt,ae=(tt-Ct)/Mt,xe=(tt+1+Ct)/Mt,be={features:[]};return this._addTileFeatures(wt.range((W-Ct)/Mt,ae,(W+1+Ct)/Mt,xe),wt.data,W,tt,Mt,be),0===W&&this._addTileFeatures(wt.range(1-Ct/Mt,ae,1,xe),wt.data,Mt,tt,Mt,be),W===Mt-1&&this._addTileFeatures(wt.range(0,ae,Ct/Mt,xe),wt.data,-1,tt,Mt,be),be.features.length?be:null}getClusterExpansionZoom(H){let W=this._getOriginZoom(H)-1;for(;W<=this.options.maxZoom;){const tt=this.getChildren(H);if(W++,1!==tt.length)break;H=tt[0].properties.cluster_id}return W}_appendLeaves(H,W,tt,wt,Mt){const qt=this.getChildren(W);for(const te of qt){const Ct=te.properties;if(Ct&&Ct.cluster?Mt+Ct.point_count<=wt?Mt+=Ct.point_count:Mt=this._appendLeaves(H,Ct.cluster_id,tt,wt,Mt):Mt<wt?Mt++:H.push(te),H.length===tt)break}return Mt}_createTree(H){const W=new Qt.K(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let tt=0;tt<H.length;tt+=this.stride)W.add(H[tt],H[tt+1]);return W.finish(),W.data=H,W}_addTileFeatures(H,W,tt,wt,Mt,qt){for(const te of H){const Ct=te*this.stride,ae=W[Ct+Jt]>1;let xe,be,Yn;if(ae)xe=on(W,Ct,this.clusterProps),be=W[Ct],Yn=W[Ct+1];else{const Bi=this.points[W[Ct+$n]];xe=Bi.properties;const[ni,ii]=Bi.geometry.coordinates;be=Yt(ni),Yn=ns(ii)}const zi={type:1,geometry:[[Math.round(this.options.extent*(be*Mt-tt)),Math.round(this.options.extent*(Yn*Mt-wt))]],tags:xe};let Br;Br=ae||this.options.generateId?W[Ct+$n]:this.points[W[Ct+$n]].id,void 0!==Br&&(zi.id=Br),qt.features.push(zi)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,W){const{radius:tt,extent:wt,reduce:Mt,minPoints:qt}=this.options,te=tt/(wt*Math.pow(2,W)),Ct=H.data,ae=[],xe=this.stride;for(let be=0;be<Ct.length;be+=xe){if(Ct[be+2]<=W)continue;Ct[be+2]=W;const Yn=Ct[be],zi=Ct[be+1],Br=H.within(Ct[be],Ct[be+1],te),Bi=Ct[be+Jt];let ni=Bi;for(const ii of Br){const Mo=ii*xe;Ct[Mo+2]>W&&(ni+=Ct[Mo+Jt])}if(ni>Bi&&ni>=qt){let ii,Mo=Yn*Bi,Bo=zi*Bi,is=-1;const ka=((be/xe|0)<<5)+(W+1)+this.points.length;for(const eh of Br){const gs=eh*xe;if(Ct[gs+2]<=W)continue;Ct[gs+2]=W;const cc=Ct[gs+Jt];Mo+=Ct[gs]*cc,Bo+=Ct[gs+1]*cc,Ct[gs+4]=ka,Mt&&(ii||(ii=this._map(Ct,be,!0),is=this.clusterProps.length,this.clusterProps.push(ii)),Mt(ii,this._map(Ct,gs)))}Ct[be+4]=ka,ae.push(Mo/ni,Bo/ni,1/0,ka,-1,ni),Mt&&ae.push(is)}else{for(let ii=0;ii<xe;ii++)ae.push(Ct[be+ii]);if(ni>1)for(const ii of Br){const Mo=ii*xe;if(!(Ct[Mo+2]<=W)){Ct[Mo+2]=W;for(let Bo=0;Bo<xe;Bo++)ae.push(Ct[Mo+Bo])}}}}return ae}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,W,tt){if(H[W+Jt]>1){const qt=this.clusterProps[H[W+bl]];return tt?Object.assign({},qt):qt}const wt=this.points[H[W+$n]].properties,Mt=this.options.map(wt);return tt&&Mt===wt?Object.assign({},Mt):Mt}}function Yu(Pt,H,W){return{type:"Feature",id:Pt[H+$n],properties:on(Pt,H,W),geometry:{type:"Point",coordinates:[(tt=Pt[H],360*(tt-.5)),ar(Pt[H+1])]}};var tt}function on(Pt,H,W){const tt=Pt[H+Jt],wt=tt>=1e4?`${Math.round(tt/1e3)}k`:tt>=1e3?Math.round(tt/100)/10+"k":tt,Mt=Pt[H+bl],qt=-1===Mt?{}:Object.assign({},W[Mt]);return Object.assign(qt,{cluster:!0,cluster_id:Pt[H+$n],point_count:tt,point_count_abbreviated:wt})}function Yt(Pt){return Pt/360+.5}function ns(Pt){const H=Math.sin(Pt*Math.PI/180),W=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return W<0?0:W>1?1:W}function ar(Pt){const H=(180-360*Pt)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}var Di={exports:{}};Di.exports=function(){function Pt(gt,xt,Tt,Ot){for(var At,zt=Ot,Ut=Tt-xt>>1,Lt=Tt-xt,Kt=gt[xt],Bt=gt[xt+1],Oe=gt[Tt],Pn=gt[Tt+1],ce=xt+3;ce<Tt;ce+=3){var In=H(gt[ce],gt[ce+1],Kt,Bt,Oe,Pn);if(In>zt)At=ce,zt=In;else if(In===zt){var En=Math.abs(ce-Ut);En<Lt&&(At=ce,Lt=En)}}zt>Ot&&(At-xt>3&&Pt(gt,xt,At,Ot),gt[At+2]=zt,Tt-At>3&&Pt(gt,At,Tt,Ot))}function H(gt,xt,Tt,Ot,At,zt){var Ut=At-Tt,Lt=zt-Ot;if(0!==Ut||0!==Lt){var Kt=((gt-Tt)*Ut+(xt-Ot)*Lt)/(Ut*Ut+Lt*Lt);Kt>1?(Tt=At,Ot=zt):Kt>0&&(Tt+=Ut*Kt,Ot+=Lt*Kt)}return(Ut=gt-Tt)*Ut+(Lt=xt-Ot)*Lt}function W(gt,xt,Tt,Ot){var At={id:void 0===gt?null:gt,type:xt,geometry:Tt,tags:Ot,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(zt){var Ut=zt.geometry,Lt=zt.type;if("Point"===Lt||"MultiPoint"===Lt||"LineString"===Lt)tt(zt,Ut);else if("Polygon"===Lt||"MultiLineString"===Lt)for(var Kt=0;Kt<Ut.length;Kt++)tt(zt,Ut[Kt]);else if("MultiPolygon"===Lt)for(Kt=0;Kt<Ut.length;Kt++)for(var Bt=0;Bt<Ut[Kt].length;Bt++)tt(zt,Ut[Kt][Bt])}(At),At}function tt(gt,xt){for(var Tt=0;Tt<xt.length;Tt+=3)gt.minX=Math.min(gt.minX,xt[Tt]),gt.minY=Math.min(gt.minY,xt[Tt+1]),gt.maxX=Math.max(gt.maxX,xt[Tt]),gt.maxY=Math.max(gt.maxY,xt[Tt+1])}function wt(gt,xt,Tt,Ot){if(xt.geometry){var At=xt.geometry.coordinates,zt=xt.geometry.type,Ut=Math.pow(Tt.tolerance/((1<<Tt.maxZoom)*Tt.extent),2),Lt=[],Kt=xt.id;if(Tt.promoteId?Kt=xt.properties[Tt.promoteId]:Tt.generateId&&(Kt=Ot||0),"Point"===zt)Mt(At,Lt);else if("MultiPoint"===zt)for(var Bt=0;Bt<At.length;Bt++)Mt(At[Bt],Lt);else if("LineString"===zt)qt(At,Lt,Ut,!1);else if("MultiLineString"===zt){if(Tt.lineMetrics){for(Bt=0;Bt<At.length;Bt++)qt(At[Bt],Lt=[],Ut,!1),gt.push(W(Kt,"LineString",Lt,xt.properties));return}te(At,Lt,Ut,!1)}else if("Polygon"===zt)te(At,Lt,Ut,!0);else{if("MultiPolygon"!==zt){if("GeometryCollection"===zt){for(Bt=0;Bt<xt.geometry.geometries.length;Bt++)wt(gt,{id:Kt,geometry:xt.geometry.geometries[Bt],properties:xt.properties},Tt,Ot);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Bt=0;Bt<At.length;Bt++){var Oe=[];te(At[Bt],Oe,Ut,!0),Lt.push(Oe)}}gt.push(W(Kt,zt,Lt,xt.properties))}}function Mt(gt,xt){xt.push(Ct(gt[0])),xt.push(ae(gt[1])),xt.push(0)}function qt(gt,xt,Tt,Ot){for(var At,zt,Ut=0,Lt=0;Lt<gt.length;Lt++){var Kt=Ct(gt[Lt][0]),Bt=ae(gt[Lt][1]);xt.push(Kt),xt.push(Bt),xt.push(0),Lt>0&&(Ut+=Ot?(At*Bt-Kt*zt)/2:Math.sqrt(Math.pow(Kt-At,2)+Math.pow(Bt-zt,2))),At=Kt,zt=Bt}var Oe=xt.length-3;xt[2]=1,Pt(xt,0,Oe,Tt),xt[Oe+2]=1,xt.size=Math.abs(Ut),xt.start=0,xt.end=xt.size}function te(gt,xt,Tt,Ot){for(var At=0;At<gt.length;At++){var zt=[];qt(gt[At],zt,Tt,Ot),xt.push(zt)}}function Ct(gt){return gt/360+.5}function ae(gt){var xt=Math.sin(gt*Math.PI/180),Tt=.5-.25*Math.log((1+xt)/(1-xt))/Math.PI;return Tt<0?0:Tt>1?1:Tt}function xe(gt,xt,Tt,Ot,At,zt,Ut,Lt){if(Ot/=xt,zt>=(Tt/=xt)&&Ut<Ot)return gt;if(Ut<Tt||zt>=Ot)return null;for(var Kt=[],Bt=0;Bt<gt.length;Bt++){var Oe=gt[Bt],Pn=Oe.geometry,ce=Oe.type,In=0===At?Oe.minX:Oe.minY,En=0===At?Oe.maxX:Oe.maxY;if(In>=Tt&&En<Ot)Kt.push(Oe);else if(!(En<Tt||In>=Ot)){var Yi=[];if("Point"===ce||"MultiPoint"===ce)be(Pn,Yi,Tt,Ot,At);else if("LineString"===ce)Yn(Pn,Yi,Tt,Ot,At,!1,Lt.lineMetrics);else if("MultiLineString"===ce)Br(Pn,Yi,Tt,Ot,At,!1);else if("Polygon"===ce)Br(Pn,Yi,Tt,Ot,At,!0);else if("MultiPolygon"===ce)for(var pr=0;pr<Pn.length;pr++){var So=[];Br(Pn[pr],So,Tt,Ot,At,!0),So.length&&Yi.push(So)}if(Yi.length){if(Lt.lineMetrics&&"LineString"===ce){for(pr=0;pr<Yi.length;pr++)Kt.push(W(Oe.id,ce,Yi[pr],Oe.tags));continue}"LineString"!==ce&&"MultiLineString"!==ce||(1===Yi.length?(ce="LineString",Yi=Yi[0]):ce="MultiLineString"),"Point"!==ce&&"MultiPoint"!==ce||(ce=3===Yi.length?"Point":"MultiPoint"),Kt.push(W(Oe.id,ce,Yi,Oe.tags))}}}return Kt.length?Kt:null}function be(gt,xt,Tt,Ot,At){for(var zt=0;zt<gt.length;zt+=3){var Ut=gt[zt+At];Ut>=Tt&&Ut<=Ot&&(xt.push(gt[zt]),xt.push(gt[zt+1]),xt.push(gt[zt+2]))}}function Yn(gt,xt,Tt,Ot,At,zt,Ut){for(var Lt,Kt,Bt=zi(gt),Oe=0===At?ni:ii,Pn=gt.start,ce=0;ce<gt.length-3;ce+=3){var In=gt[ce],En=gt[ce+1],Yi=gt[ce+2],pr=gt[ce+3],So=gt[ce+4],la=0===At?In:En,Mr=0===At?pr:So,rs=!1;Ut&&(Lt=Math.sqrt(Math.pow(In-pr,2)+Math.pow(En-So,2))),la<Tt?Mr>Tt&&(Kt=Oe(Bt,In,En,pr,So,Tt),Ut&&(Bt.start=Pn+Lt*Kt)):la>Ot?Mr<Ot&&(Kt=Oe(Bt,In,En,pr,So,Ot),Ut&&(Bt.start=Pn+Lt*Kt)):Bi(Bt,In,En,Yi),Mr<Tt&&la>=Tt&&(Kt=Oe(Bt,In,En,pr,So,Tt),rs=!0),Mr>Ot&&la<=Ot&&(Kt=Oe(Bt,In,En,pr,So,Ot),rs=!0),!zt&&rs&&(Ut&&(Bt.end=Pn+Lt*Kt),xt.push(Bt),Bt=zi(gt)),Ut&&(Pn+=Lt)}var To=gt.length-3;In=gt[To],En=gt[To+1],Yi=gt[To+2],(la=0===At?In:En)>=Tt&&la<=Ot&&Bi(Bt,In,En,Yi),To=Bt.length-3,zt&&To>=3&&(Bt[To]!==Bt[0]||Bt[To+1]!==Bt[1])&&Bi(Bt,Bt[0],Bt[1],Bt[2]),Bt.length&&xt.push(Bt)}function zi(gt){var xt=[];return xt.size=gt.size,xt.start=gt.start,xt.end=gt.end,xt}function Br(gt,xt,Tt,Ot,At,zt){for(var Ut=0;Ut<gt.length;Ut++)Yn(gt[Ut],xt,Tt,Ot,At,zt,!1)}function Bi(gt,xt,Tt,Ot){gt.push(xt),gt.push(Tt),gt.push(Ot)}function ni(gt,xt,Tt,Ot,At,zt){var Ut=(zt-xt)/(Ot-xt);return gt.push(zt),gt.push(Tt+(At-Tt)*Ut),gt.push(1),Ut}function ii(gt,xt,Tt,Ot,At,zt){var Ut=(zt-Tt)/(At-Tt);return gt.push(xt+(Ot-xt)*Ut),gt.push(zt),gt.push(1),Ut}function Mo(gt,xt){for(var Tt=[],Ot=0;Ot<gt.length;Ot++){var At,zt=gt[Ot],Ut=zt.type;if("Point"===Ut||"MultiPoint"===Ut||"LineString"===Ut)At=Bo(zt.geometry,xt);else if("MultiLineString"===Ut||"Polygon"===Ut){At=[];for(var Lt=0;Lt<zt.geometry.length;Lt++)At.push(Bo(zt.geometry[Lt],xt))}else if("MultiPolygon"===Ut)for(At=[],Lt=0;Lt<zt.geometry.length;Lt++){for(var Kt=[],Bt=0;Bt<zt.geometry[Lt].length;Bt++)Kt.push(Bo(zt.geometry[Lt][Bt],xt));At.push(Kt)}Tt.push(W(zt.id,Ut,At,zt.tags))}return Tt}function Bo(gt,xt){var Tt=[];Tt.size=gt.size,void 0!==gt.start&&(Tt.start=gt.start,Tt.end=gt.end);for(var Ot=0;Ot<gt.length;Ot+=3)Tt.push(gt[Ot]+xt,gt[Ot+1],gt[Ot+2]);return Tt}function is(gt,xt){if(gt.transformed)return gt;var Tt,Ot,At,zt=1<<gt.z,Ut=gt.x,Lt=gt.y;for(Tt=0;Tt<gt.features.length;Tt++){var Kt=gt.features[Tt],Bt=Kt.geometry,Oe=Kt.type;if(Kt.geometry=[],1===Oe)for(Ot=0;Ot<Bt.length;Ot+=2)Kt.geometry.push(ka(Bt[Ot],Bt[Ot+1],xt,zt,Ut,Lt));else for(Ot=0;Ot<Bt.length;Ot++){var Pn=[];for(At=0;At<Bt[Ot].length;At+=2)Pn.push(ka(Bt[Ot][At],Bt[Ot][At+1],xt,zt,Ut,Lt));Kt.geometry.push(Pn)}}return gt.transformed=!0,gt}function ka(gt,xt,Tt,Ot,At,zt){return[Math.round(Tt*(gt*Ot-At)),Math.round(Tt*(xt*Ot-zt))]}function eh(gt,xt,Tt,Ot,At){for(var zt=xt===At.maxZoom?0:At.tolerance/((1<<xt)*At.extent),Ut={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Tt,y:Ot,z:xt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Lt=0;Lt<gt.length;Lt++){Ut.numFeatures++,gs(Ut,gt[Lt],zt,At);var Kt=gt[Lt].minX,Bt=gt[Lt].minY,Oe=gt[Lt].maxX,Pn=gt[Lt].maxY;Kt<Ut.minX&&(Ut.minX=Kt),Bt<Ut.minY&&(Ut.minY=Bt),Oe>Ut.maxX&&(Ut.maxX=Oe),Pn>Ut.maxY&&(Ut.maxY=Pn)}return Ut}function gs(gt,xt,Tt,Ot){var At=xt.geometry,zt=xt.type,Ut=[];if("Point"===zt||"MultiPoint"===zt)for(var Lt=0;Lt<At.length;Lt+=3)Ut.push(At[Lt]),Ut.push(At[Lt+1]),gt.numPoints++,gt.numSimplified++;else if("LineString"===zt)cc(Ut,At,gt,Tt,!1,!1);else if("MultiLineString"===zt||"Polygon"===zt)for(Lt=0;Lt<At.length;Lt++)cc(Ut,At[Lt],gt,Tt,"Polygon"===zt,0===Lt);else if("MultiPolygon"===zt)for(var Kt=0;Kt<At.length;Kt++){var Bt=At[Kt];for(Lt=0;Lt<Bt.length;Lt++)cc(Ut,Bt[Lt],gt,Tt,!0,0===Lt)}if(Ut.length){var Oe=xt.tags||null;if("LineString"===zt&&Ot.lineMetrics){for(var Pn in Oe={},xt.tags)Oe[Pn]=xt.tags[Pn];Oe.mapbox_clip_start=At.start/At.size,Oe.mapbox_clip_end=At.end/At.size}var ce={geometry:Ut,type:"Polygon"===zt||"MultiPolygon"===zt?3:"LineString"===zt||"MultiLineString"===zt?2:1,tags:Oe};null!==xt.id&&(ce.id=xt.id),gt.features.push(ce)}}function cc(gt,xt,Tt,Ot,At,zt){var Ut=Ot*Ot;if(Ot>0&&xt.size<(At?Ut:Ot))Tt.numPoints+=xt.length/3;else{for(var Lt=[],Kt=0;Kt<xt.length;Kt+=3)(0===Ot||xt[Kt+2]>Ut)&&(Tt.numSimplified++,Lt.push(xt[Kt]),Lt.push(xt[Kt+1])),Tt.numPoints++;At&&function(Bt,Oe){for(var Pn=0,ce=0,In=Bt.length,En=In-2;ce<In;En=ce,ce+=2)Pn+=(Bt[ce]-Bt[En])*(Bt[ce+1]+Bt[En+1]);if(Pn>0===Oe)for(ce=0,In=Bt.length;ce<In/2;ce+=2){var Yi=Bt[ce],pr=Bt[ce+1];Bt[ce]=Bt[In-2-ce],Bt[ce+1]=Bt[In-1-ce],Bt[In-2-ce]=Yi,Bt[In-1-ce]=pr}}(Lt,zt),gt.push(Lt)}}function eu(gt,xt){var Tt=(xt=this.options=function(At,zt){for(var Ut in zt)At[Ut]=zt[Ut];return At}(Object.create(this.options),xt)).debug;if(Tt&&console.time("preprocess data"),xt.maxZoom<0||xt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(xt.promoteId&&xt.generateId)throw new Error("promoteId and generateId cannot be used together.");var At,zt,Ut,Lt,Kt,Bt,Ot=function(At,zt){var Ut=[];if("FeatureCollection"===At.type)for(var Lt=0;Lt<At.features.length;Lt++)wt(Ut,At.features[Lt],zt,Lt);else wt(Ut,"Feature"===At.type?At:{geometry:At},zt);return Ut}(gt,xt);this.tiles={},this.tileCoords=[],Tt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",xt.indexMaxZoom,xt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(At=Ot,zt=xt,Ut=zt.buffer/zt.extent,Lt=At,Kt=xe(At,1,-1-Ut,Ut,0,-1,2,zt),Bt=xe(At,1,1-Ut,2+Ut,0,-1,2,zt),(Kt||Bt)&&(Lt=xe(At,1,-Ut,1+Ut,0,-1,2,zt)||[],Kt&&(Lt=Mo(Kt,1).concat(Lt)),Bt&&(Lt=Lt.concat(Mo(Bt,-1)))),Ot=Lt).length&&this.splitTile(Ot,0,0,0),Tt&&(Ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function nh(gt,xt,Tt){return 32*((1<<gt)*Tt+xt)+gt}return eu.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},eu.prototype.splitTile=function(gt,xt,Tt,Ot,At,zt,Ut){for(var Lt=[gt,xt,Tt,Ot],Kt=this.options,Bt=Kt.debug;Lt.length;){Ot=Lt.pop(),Tt=Lt.pop(),xt=Lt.pop(),gt=Lt.pop();var Oe=1<<xt,Pn=nh(xt,Tt,Ot),ce=this.tiles[Pn];if(!ce&&(Bt>1&&console.time("creation"),ce=this.tiles[Pn]=eh(gt,xt,Tt,Ot,Kt),this.tileCoords.push({z:xt,x:Tt,y:Ot}),Bt)){Bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",xt,Tt,Ot,ce.numFeatures,ce.numPoints,ce.numSimplified),console.timeEnd("creation"));var In="z"+xt;this.stats[In]=(this.stats[In]||0)+1,this.total++}if(ce.source=gt,At){if(xt===Kt.maxZoom||xt===At)continue;var En=1<<At-xt;if(Tt!==Math.floor(zt/En)||Ot!==Math.floor(Ut/En))continue}else if(xt===Kt.indexMaxZoom||ce.numPoints<=Kt.indexMaxPoints)continue;if(ce.source=null,0!==gt.length){Bt>1&&console.time("clipping");var Yi,pr,So,la,Mr,rs,To=.5*Kt.buffer/Kt.extent,_s=.5-To,nu=.5+To,mr=1+To;Yi=pr=So=la=null,Mr=xe(gt,Oe,Tt-To,Tt+nu,0,ce.minX,ce.maxX,Kt),rs=xe(gt,Oe,Tt+_s,Tt+mr,0,ce.minX,ce.maxX,Kt),gt=null,Mr&&(Yi=xe(Mr,Oe,Ot-To,Ot+nu,1,ce.minY,ce.maxY,Kt),pr=xe(Mr,Oe,Ot+_s,Ot+mr,1,ce.minY,ce.maxY,Kt),Mr=null),rs&&(So=xe(rs,Oe,Ot-To,Ot+nu,1,ce.minY,ce.maxY,Kt),la=xe(rs,Oe,Ot+_s,Ot+mr,1,ce.minY,ce.maxY,Kt),rs=null),Bt>1&&console.timeEnd("clipping"),Lt.push(Yi||[],xt+1,2*Tt,2*Ot),Lt.push(pr||[],xt+1,2*Tt,2*Ot+1),Lt.push(So||[],xt+1,2*Tt+1,2*Ot),Lt.push(la||[],xt+1,2*Tt+1,2*Ot+1)}}},eu.prototype.getTile=function(gt,xt,Tt){var Ot=this.options,At=Ot.extent,zt=Ot.debug;if(gt<0||gt>24)return null;var Ut=1<<gt,Lt=nh(gt,xt=(xt%Ut+Ut)%Ut,Tt);if(this.tiles[Lt])return is(this.tiles[Lt],At);zt>1&&console.log("drilling down to z%d-%d-%d",gt,xt,Tt);for(var Kt,Bt=gt,Oe=xt,Pn=Tt;!Kt&&Bt>0;)Bt--,Oe=Math.floor(Oe/2),Pn=Math.floor(Pn/2),Kt=this.tiles[nh(Bt,Oe,Pn)];return Kt&&Kt.source?(zt>1&&console.log("found parent tile z%d-%d-%d",Bt,Oe,Pn),zt>1&&console.time("drilling down"),this.splitTile(Kt.source,Bt,Oe,Pn,gt,xt,Tt),zt>1&&console.timeEnd("drilling down"),this.tiles[Lt]?is(this.tiles[Lt],At):null):null},function(gt,xt){return new eu(gt,xt)}}();var jg=Qt.g(Di.exports);function dn(Pt,H){const W=Pt.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const tt=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!tt)return H(null,null);const wt=new class{constructor(qt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Qt.E,this.length=qt.length,this._features=qt}feature(qt){return new class{constructor(te){this._feature=te,this.extent=Qt.E,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(1===this._feature.type){const te=[];for(const Ct of this._feature.geometry)te.push([new Qt.P(Ct[0],Ct[1])]);return te}{const te=[];for(const Ct of this._feature.geometry){const ae=[];for(const xe of Ct)ae.push(new Qt.P(xe[0],xe[1]));te.push(ae)}return te}}toGeoJSON(te,Ct,ae){return Wu.call(this,te,Ct,ae)}}(this._features[qt])}}(tt.features);let Mt=Jc(wt);0===Mt.byteOffset&&Mt.byteLength===Mt.buffer.byteLength||(Mt=new Uint8Array(Mt)),H(null,{vectorTile:wt,rawData:Mt.buffer})}class Qd extends Qt.d{constructor(H,W,tt,wt,Mt,qt){super(H,W,tt,wt,dn,qt),Mt&&(this.loadGeoJSON=Mt)}loadData(H,W){const tt=H&&H.request,wt=tt&&tt.collectResourceTiming;this.loadGeoJSON(H,(Mt,qt)=>{if(Mt||!qt)return W(Mt);if("object"!=typeof qt)return W(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{lc(qt,!0);try{if(H.filter){const Ct=Qt.e(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ct.result)throw new Error(Ct.value.map(xe=>`${xe.key}: ${xe.message}`).join(", "));qt={type:"FeatureCollection",features:qt.features.filter(xe=>Ct.value.evaluate({zoom:0},xe))}}this._geoJSONIndex=H.cluster?new wl(function({superclusterOptions:Ct,clusterProperties:ae}){if(!ae||!Ct)return Ct;const xe={},be={},Yn={accumulated:null,zoom:0},zi={properties:null},Br=Object.keys(ae);for(const Bi of Br){const[ni,ii]=ae[Bi],Mo=Qt.e(ii),Bo=Qt.e("string"==typeof ni?[ni,["accumulated"],["get",Bi]]:ni);xe[Bi]=Mo.value,be[Bi]=Bo.value}return Ct.map=Bi=>{zi.properties=Bi;const ni={};for(const ii of Br)ni[ii]=xe[ii].evaluate(Yn,zi);return ni},Ct.reduce=(Bi,ni)=>{zi.properties=ni;for(const ii of Br)Yn.accumulated=Bi[ii],Bi[ii]=be[ii].evaluate(Yn,zi)},Ct}(H)).load(qt.features):jg(qt,H.geojsonVtOptions)}catch(Ct){return W(Ct)}this.loaded={};const te={};if(wt){const Ct=Qt.f(tt);Ct&&(te.resourceTiming={},te.resourceTiming[H.source]=JSON.parse(JSON.stringify(Ct)))}W(null,te)}})}reloadTile(H,W){const tt=this.loaded;return tt&&tt[H.uid]?super.reloadTile(H,W):this.loadTile(H,W)}loadGeoJSON(H,W){if(H.request)Qt.h(H.request,W);else{if("string"!=typeof H.data)return W(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse(H.data))}catch{return W(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(H,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(tt){W(tt)}}getClusterChildren(H,W){try{W(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(tt){W(tt)}}getClusterLeaves(H,W){try{W(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(tt){W(tt)}}}class Rr{constructor(H,W){this.tileID=new Qt.O(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=H.projection,this.brightness=W}parse(H,W,tt,wt){this.status="parsing";const Mt=new Qt.O(tt.tileID.overscaledZ,tt.tileID.wrap,tt.tileID.canonical.z,tt.tileID.canonical.x,tt.tileID.canonical.y),qt={},te=W.familiesBySource[tt.source],Ct=new Qt.F(Mt,tt.promoteId);return Ct.bucketLayerIDs=[],Qt.l(H).then(ae=>{if(!ae)return wt(new Error("Could not parse tile"));const xe=Qt.j(ae,1/Qt.t(tt.tileID.canonical)),be=ae.json.extensionsUsed&&ae.json.extensionsUsed.includes("MAPBOX_mesh_features"),Yn=new Qt.k(this.zoom,{brightness:this.brightness});for(const zi in te)for(const Br of te[zi]){const Bi=Br[0],ni=ae.json.extensionsUsed;Bi.recalculate(Yn,[]);const ii=new Qt.T(xe,Mt,ni&&ni.includes("MAPBOX_mesh_features"),this.brightness);be||(ii.needsUpload=!0),qt[Bi.fqid]=ii,ii.evaluate(Bi)}this.status="done",wt(null,{buckets:qt,featureIndex:Ct})}).catch(ae=>wt(new Error(ae.message)))}}class tu{constructor(H,W,tt,wt,Mt,qt){this.actor=H,this.layerIndex=W,this.brightness=qt,this.loading={},this.loaded={}}loadTile(H,W){const tt=H.uid,wt=this.loading[tt]=new Rr(H,this.brightness);Qt.i(H.request,(Mt,qt)=>{const te=!this.loading[tt];return delete this.loading[tt],te||Mt?(wt.status="done",te||(this.loaded[tt]=wt),W(Mt)):qt&&0!==qt.byteLength?void wt.parse(qt,this.layerIndex,H,(Ct,ae)=>{wt.status="done",this.loaded=this.loaded||{},this.loaded[tt]=wt,Ct||!ae?W(Ct):W(null,ae)}):(wt.status="done",this.loaded[tt]=wt,W())})}reloadTile(H,W){const tt=this.loaded,wt=H.uid;if(tt&&tt[wt]){const Mt=tt[wt];Mt.projection=H.projection,Mt.brightness=H.brightness;const qt=(te,Ct)=>{Mt.reloadCallback&&(delete Mt.reloadCallback,this.loadTile(H,W)),W(te,Ct)};"parsing"===Mt.status?Mt.reloadCallback=qt:"done"===Mt.status&&this.loadTile(H,W)}}abortTile(H,W){const tt=H.uid;this.loading[tt]&&delete this.loading[tt],W()}removeTile(H,W){const tt=this.loaded,wt=H.uid;tt&&tt[wt]&&delete tt[wt],W()}}class th{constructor(H){this.self=H,this.actor=new Qt.A(H,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=Qt.m({name:"mercator"}),this.workerSourceTypes={vector:Qt.d,geojson:Qd,"batched-model":tu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,tt)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=tt},this.self.registerRTLTextPlugin=W=>{if(Qt.n.isParsed())throw new Error("RTL text plugin already registered.");Qt.n.applyArabicShaping=W.applyArabicShaping,Qt.n.processBidirectionalText=W.processBidirectionalText,Qt.n.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches(H,W,tt){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H],tt()}checkIfReady(H,W,tt){tt()}setReferrer(H,W){this.referrer=W}spriteLoaded(H,{scope:W,isLoaded:tt}){if(this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={}),this.isSpriteLoaded[H][W]=tt,this.workerSources[H]&&this.workerSources[H][W])for(const wt in this.workerSources[H][W]){const Mt=this.workerSources[H][W][wt];for(const qt in Mt)Mt[qt]instanceof Qt.d&&(Mt[qt].isSpriteLoaded=tt,Mt[qt].fire(new Qt.o("isSpriteLoaded")))}}setImages(H,{scope:W,images:tt},wt){if(this.availableImages[H]||(this.availableImages[H]={}),this.availableImages[H][W]=tt,this.workerSources[H]&&this.workerSources[H][W]){for(const Mt in this.workerSources[H][W]){const qt=this.workerSources[H][W][Mt];for(const te in qt)qt[te].availableImages=tt}wt()}else wt()}setProjection(H,W){this.projections[H]=Qt.m(W)}setBrightness(H,W,tt){this.brightness=W,tt()}setLayers(H,W,tt){this.getLayerIndex(H,W.scope).replace(W.layers,W.options),tt()}updateLayers(H,W,tt){this.getLayerIndex(H,W.scope).update(W.layers,W.removedIds,W.options),tt()}loadTile(H,W,tt){W.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,W.type,W.source,W.scope).loadTile(W,tt)}loadDEMTile(H,W,tt){this.getDEMWorkerSource(H,W.source,W.scope).loadTile(W,tt)}reloadTile(H,W,tt){W.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,W.type,W.source,W.scope).reloadTile(W,tt)}abortTile(H,W,tt){this.getWorkerSource(H,W.type,W.source,W.scope).abortTile(W,tt)}removeTile(H,W,tt){this.getWorkerSource(H,W.type,W.source,W.scope).removeTile(W,tt)}removeSource(H,W,tt){if(!(this.workerSources[H]&&this.workerSources[H][W.scope]&&this.workerSources[H][W.scope][W.type]&&this.workerSources[H][W.scope][W.type][W.source]))return;const wt=this.workerSources[H][W.scope][W.type][W.source];delete this.workerSources[H][W.scope][W.type][W.source],void 0!==wt.removeSource?wt.removeSource(W,tt):tt()}loadWorkerSource(H,W,tt){try{this.self.importScripts(W.url),tt()}catch(wt){tt(wt.toString())}}syncRTLPluginState(H,W,tt){try{Qt.n.setState(W);const wt=Qt.n.getPluginURL();if(Qt.n.isLoaded()&&!Qt.n.isParsed()&&null!=wt){this.self.importScripts(wt);const Mt=Qt.n.isParsed();tt(Mt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${wt}`),Mt)}}catch(wt){tt(wt.toString())}}setDracoUrl(H,W){this.dracoUrl=W}getAvailableImages(H,W){this.availableImages[H]||(this.availableImages[H]={});let tt=this.availableImages[H][W];return tt||(tt=[]),tt}getLayerIndex(H,W){this.layerIndexes[H]||(this.layerIndexes[H]={});let tt=this.layerIndexes[H][W];return tt||(tt=this.layerIndexes[H][W]=new ml,tt.scope=W),tt}getWorkerSource(H,W,tt,wt){return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][wt]||(this.workerSources[H][wt]={}),this.workerSources[H][wt][W]||(this.workerSources[H][wt][W]={}),this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={}),this.workerSources[H][wt][W][tt]||(this.workerSources[H][wt][W][tt]=new this.workerSourceTypes[W]({send:(qt,te,Ct,ae,xe,be)=>{this.actor.send(qt,te,Ct,H,xe,be)},scheduler:this.actor.scheduler},this.getLayerIndex(H,wt),this.getAvailableImages(H,wt),this.isSpriteLoaded[H][wt],void 0,this.brightness)),this.workerSources[H][wt][W][tt]}getDEMWorkerSource(H,W,tt){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][tt]||(this.demWorkerSources[H][tt]={}),this.demWorkerSources[H][tt][W]||(this.demWorkerSources[H][tt][W]=new He),this.demWorkerSources[H][tt][W]}enforceCacheSizeLimit(H,W){Qt.q(W)}getWorkerPerformanceMetrics(H,W,tt){tt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new th(self)),th}),rp(0,function(Qt){return Qt.s}),qn}()}},h0=>{h0(h0.s=47)}]);